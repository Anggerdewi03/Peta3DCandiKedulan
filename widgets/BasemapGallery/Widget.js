// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"esri/widgets/BasemapGallery":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../assets ../core/Handles ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./BasemapGallery/BasemapGalleryViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(t,g,d,A,n,u,v,q,D,G,x,y,C,z,E,h,b,f,k){q=function(p){function l(c,e){c=p.call(this,c,e)||this;c._handles=new n;c.activeBasemap=null;c.disabled=!1;c.headingLevel=2;c.iconClass="esri-icon-basemap";c.label=void 0;c.messages=null;c.source=null;c.view=null;c.viewModel=new z;return c}g._inheritsLoose(l,p);var r=l.prototype;r.initialize=function(){const c=this._handles;this.own([u.on(()=>this.viewModel.items,"change",e=>{const {added:a,moved:m}=e;c.remove("basemap-gallery-item-changes");c.add([...a,
...m].map(w=>u.watch(()=>w.state,()=>this.scheduleRender())),"basemap-gallery-item-changes");this.scheduleRender()}),c,u.when(()=>this.source,()=>this.viewModel.load(),{initial:!0,once:!0})])};r.destroy=function(){this._handles.destroy()};r.loadDependencies=function(){return new Promise((c,e)=>t(["../chunks/calcite-scrim"],c,e))};r.render=function(){var c="loading"===this.get("source.state"),e=this.disabled||"disabled"===this.get("viewModel.state");const a=this.get("viewModel.items").toArray().map(this._renderBasemapGalleryItem,
this);e={["esri-basemap-gallery--source-loading"]:c,["esri-disabled"]:e};const m=c?f.tsx("div",{class:"esri-basemap-gallery__loader",key:"esri-basemap-gallery__loader"}):null;c=c?null:0<a.length?f.tsx("ul",{class:"esri-basemap-gallery__item-container",key:"esri-basemap-gallery__item-container",role:"menu"},a):f.tsx("div",{class:"esri-widget__content--empty",key:"esri-basemap-gallery__empty-message"},f.tsx(E.Heading,{level:this.headingLevel},this.messages.noBasemaps));return f.tsx("div",{class:this.classes("esri-basemap-gallery esri-widget esri-widget--panel-height-only",
e)},m,c)};r._handleClick=function(c){c=c.currentTarget["data-item"];"ready"===c.state&&(this.viewModel.activeBasemap=c.basemap)};r._renderBasemapGalleryItem=function(c){const e=c.get("basemap.thumbnailUrl")||A.getAssetUrl("esri/themes/base/images/basemap-toggle-64.svg"),a=c.get("basemap.title");var m=c.get("basemap.portalItem.snippet");m=c.get("error.message")||m||a;var {viewModel:w}=this;const F=this.disabled||"disabled"===w.state||"ready"!==c.state?-1:0,B=w.basemapEquals(c.basemap,this.activeBasemap);
w="loading"===w.state;return f.tsx("li",{"aria-selected":B.toString(),bind:this,class:this.classes("esri-basemap-gallery__item",{["esri-basemap-gallery__item--selected"]:B,["esri-basemap-gallery__item--error"]:"error"===c.state}),"data-item":c,onkeydown:this._handleClick,onclick:this._handleClick,role:"menuitem",tabIndex:F,title:m},f.tsx("img",{alt:"",class:"esri-basemap-gallery__item-thumbnail",src:e}),f.tsx("div",{class:"esri-basemap-gallery__item-title"},a),"loading"===c.state||B&&w?f.tsx("calcite-scrim",
null,f.tsx("span",{"aria-hidden":"true",role:"presentation",class:"esri-widget__loader-animation"})):null)};return l}(C);d.__decorate([v.aliasOf("viewModel.activeBasemap")],q.prototype,"activeBasemap",void 0);d.__decorate([x.property()],q.prototype,"disabled",void 0);d.__decorate([x.property()],q.prototype,"headingLevel",void 0);d.__decorate([x.property()],q.prototype,"iconClass",void 0);d.__decorate([x.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],q.prototype,"label",void 0);
d.__decorate([x.property(),b.messageBundle("esri/widgets/BasemapGallery/t9n/BasemapGallery")],q.prototype,"messages",void 0);d.__decorate([v.aliasOf("viewModel.source")],q.prototype,"source",void 0);d.__decorate([v.aliasOf("viewModel.view")],q.prototype,"view",void 0);d.__decorate([x.property()],q.prototype,"viewModel",void 0);d.__decorate([h.accessibleHandler()],q.prototype,"_handleClick",null);return q=d.__decorate([y.subclass("esri.widgets.BasemapGallery")],q)})},"esri/widgets/BasemapGallery/BasemapGalleryViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Basemap ../../core/Collection ../../core/HandleOwner ../../core/Loadable ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../geometry/projection ../../geometry/support/spatialReferenceUtils ../../support/basemapUtils ./support/basemapCompatibilityUtils ./support/BasemapGalleryItem ./support/LocalBasemapsSource ./support/PortalBasemapsSource".split(" "),
function(t,g,d,A,n,u,v,q,D,G,x,y,C,z,E,h,b,f,k,p){const l=A.ofType(f);n=function(r){function c(a){a=r.call(this,a)||this;a._loadingProjectionEngine=!1;a.items=new l;a.source=new p;a.view=null;return a}t._inheritsLoose(c,r);var e=c.prototype;e.initialize=function(){const a=()=>this._recreateItems();this.handles.add([q.watch(()=>"ready"===this.state?this.compatibilityFunction:null,()=>this._updateItems()),q.on(()=>{var m;return null==(m=this.source)?void 0:m.basemaps},"change",a,{onListenerAdd:a})])};
e.castSource=function(a){return Array.isArray(a)||A.isCollection(a)?new k({basemaps:a}):a&&"esri.portal.Portal"===a.declaredClass?new p({portal:a}):!a||a instanceof p||!a.portal&&!a.query?a&&"basemaps"in a&&"state"in a&&"refresh"in a?a:null:new p(a)};e.basemapEquals=function(a,m){return h.contentEquals(a,m)};e.refresh=function(){this._recreateItems()};e.load=function(a){this.addResolvingPromise(u.isLoadable(this.source)?this.source.load(a):null);return Promise.resolve(this)};e._recreateItems=function(){var a;
const m=null==(a=this.source)?void 0:a.basemaps,{view:w,compatibilityFunction:F}=this;this.items.removeAll().forEach(B=>B.destroy());m&&this.items.addMany(m.map(B=>new f({basemap:B,compatibilityFunction:F,view:w})))};e._updateItems=function(){for(const a of this.items)a.compatibilityFunction=this.compatibilityFunction,a.view=this.view};t._createClass(c,[{key:"activeBasemap",get:function(){var a,m,w;return null!=(a=null==(m=this.view)?void 0:null==(w=m.map)?void 0:w.basemap)?a:null},set:function(a){var m,
w;if(this.view.map){var F="string"===typeof a?d.fromId(a):a;if(F&&this.view.ready){var B=F.spatialReference||(null==(m=this.items)?void 0:null==(w=m.find(H=>this.basemapEquals(F,H.basemap)))?void 0:w.spatialReference);B&&"spatialReferenceLocked"in this.view&&!this.view.spatialReferenceLocked?(m=this.view.spatialReference,!v.isSome(B)||E.equals(m,B)||z.canProjectWithoutEngine(this.view.spatialReference,B)||z.isLoaded()?(this.view.map.basemap=F,this._clearOverride("activeBasemap"),v.isSome(B)&&!E.equals(this.view.spatialReference,
B)&&(this.view.spatialReference=B)):(this._override("activeBasemap",F),this._loadingProjectionEngine=!0,z.load().then(()=>{this._get("activeBasemap")===a&&(this.view.map.basemap=a,this.view.spatialReference=B,this._clearOverride("activeBasemap"))},()=>{}).then(()=>{this._loadingProjectionEngine=!1}))):(this.view.map.basemap=F,this._clearOverride("activeBasemap"))}else this.view.map.basemap=F,this._clearOverride("activeBasemap")}}},{key:"compatibilityFunction",get:function(){var a;return"3d"===(null==
(a=this.view)?void 0:a.type)?b.default3DCompatibility:b.default2DCompatibility},set:function(a){v.isSome(a)?this._override("compatibilityFunction",a):this._clearOverride("compatibilityFunction")}},{key:"state",get:function(){var a;return null!=(a=this.view)&&a.ready&&this.source?this._loadingProjectionEngine?"loading":"ready":"disabled"}}]);return c}(n.HandleOwnerMixin(u));g.__decorate([D.property()],n.prototype,"_loadingProjectionEngine",void 0);g.__decorate([D.property()],n.prototype,"activeBasemap",
null);g.__decorate([D.property()],n.prototype,"compatibilityFunction",null);g.__decorate([D.property({readOnly:!0,type:l})],n.prototype,"items",void 0);g.__decorate([D.property()],n.prototype,"source",void 0);g.__decorate([y.cast("source")],n.prototype,"castSource",null);g.__decorate([D.property({readOnly:!0})],n.prototype,"state",null);g.__decorate([D.property()],n.prototype,"view",void 0);return n=g.__decorate([C.subclass("esri.widgets.BasemapGallery.BasemapGalleryViewModel")],n)})},"esri/widgets/BasemapGallery/support/basemapCompatibilityUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../layers/support/layerUtils ../../../views/ViewingMode ../../../views/3d/terrain/terrainUtils ../../../views/3d/terrain/TilingScheme ../../../views/support/spatialReferenceSupport".split(" "),
function(t,g,d,A,n,u,v,q,D,G){function x(){x=g._asyncToGenerator(function*(b,f={}){yield z(b,f);n.throwIfAborted(f)});return x.apply(this,arguments)}function y(){y=g._asyncToGenerator(function*(b,f={}){const {basemap:k,view:p}=b;n.throwIfAborted(f);if(!("spatialReferenceLocked"in p)||p.spatialReferenceLocked)if(yield k.load(f),n.throwIfAborted(f),0!==k.baseLayers.length&&(b=k.baseLayers.getItemAt(0),u.isTiledLayer(b))){if(k.spatialReference){if(p.spatialReference.equals(k.spatialReference))return;
C()}yield b.load(f);n.throwIfAborted(f);f=(("supportedSpatialReferences"in b?b.supportedSpatialReferences:null)||["tileInfo"in b?b.tileInfo.spatialReference:null]).filter(Boolean);0!==f.length&&f.every(l=>!p.spatialReference.equals(l))&&C()}});return y.apply(this,arguments)}function C(){throw new d("basemap-compatibility:incompatible-spatial-reference","Basemap spatial reference is not compatible with the view");}function z(b,f){return E.apply(this,arguments)}function E(){E=g._asyncToGenerator(function*(b,
f){const {basemap:k,view:p}=b;yield k.load(f);if(0!==k.baseLayers.length){b=k.baseLayers.concat(k.referenceLayers).toArray().filter(l=>!u.isBasemapSupportedLayer(l)).map(l=>new d("basemap-compatibility:unsupported-basemap-layer-type","Unsupported basemap layer type ${operationalLayerType}",{layer:l,operationalLayerType:l.operationalLayerType||"unknown"}));if(b.length)throw b[0];b=k.baseLayers.getItemAt(0);if(u.isBasemapSupportedLayer(b)){try{yield b.load(f)}catch(l){const {name:r="basemap-compatibility:unknown-error",
message:c="Unknown basemap compatibility error",details:e}=l;throw new d(r,c,e);}h(b,p)}}});return E.apply(this,arguments)}function h(b,f){const k=f.state.viewingMode;if(k){if("wmts"===(null==b?void 0:b.type)){var p=q.getTileInfoAndExtentFromWMTSLayer(b,f.spatialReference,k);if(A.isNone(p.tileInfo))throw new d("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");var l=p.tileInfo;p=p.fullExtent}else l=b.tileInfo,p=b.fullExtent;if(!A.isNone(l)){if(!G.isSpatialReferenceSupported(l.spatialReference,
k))throw new d(`basemapgalleryitem:spatial-reference-unsupported-${v.stringFromViewingMode(k)}`,`Basemap spatial reference is unsupported in ${v.stringFromViewingMode(k)} mode`);var r=l.spatialReference.isGeographic;r="vector-tile"===(null==b?void 0:b.type)?l.getOrCreateCompatible(256,r?1:2):null;if(k===v.ViewingMode.Global){let c=q.checkIfTileInfoSupportedForView(l,p,null,k);c&&"vector-tile"===(null==b?void 0:b.type)&&A.isSome(p)&&r&&!q.checkIfTileInfoSupportedForView(r,p,null,k)&&(c=null);if(c)throw new d(`basemapgalleryitem:tiling-scheme-unsupported-${l.spatialReference.isWebMercator?
"web-mercator":"wgs84"}-global`,"Basemap tiling scheme is unsupported in global mode",{error:c});}else if(D.TilingScheme.checkUnsupported(l))throw new d("basemapgalleryitem:tiling-scheme-unsupported-local","Basemap tiling scheme is unsupported in local mode");f=f.get("basemapTerrain.tilingScheme");if(!(!f||f.compatibleWith(l)||"vector-tile"===(null==b?void 0:b.type)&&r&&f.compatibleWith(r)))throw new d("basemapgalleryitem:tiling-scheme-incompatible","Basemap tiling scheme is incompatible with the view");
}}}t.default2DCompatibility=function(b){return y.apply(this,arguments)};t.default3DCompatibility=function(b){return x.apply(this,arguments)};Object.defineProperties(t,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/BasemapGallery/support/BasemapGalleryItem":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/HandleOwner ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../support/basemapUtils".split(" "),
function(t,g,d,A,n,u,v,q,D,G,x,y){d=function(C){function z(h){h=C.call(this,h)||this;h.compatibilityFunction=null;h.error=null;h.state="loading";h.view=null;return h}t._inheritsLoose(z,C);var E=z.prototype;E.initialize=function(){const h=()=>this.refresh();this.handles.add([u.watch(()=>{var b;return null==(b=this.basemap)?void 0:b.loadStatus},h),u.watch(()=>this.compatibilityFunction,h),u.watch(()=>{var b;return this.view&&"basemapTerrain"in this.view&&(null==(b=this.view.basemapTerrain)?void 0:b.tilingScheme)},
h),u.watch(()=>{var b;return null==(b=this.view)?void 0:b.ready},h),u.watch(()=>{var b;return null==(b=this.view)?void 0:b.spatialReference},h)]);this.refresh()};E.destroy=function(){this._cancelRefresh();this.view=this.compatibilityFunction=this.basemap=null};E.refresh=function(){var h;this._cancelRefresh();this._set("state","loading");const b=null==(h=this.basemap)?void 0:h.loadStatus;if("loaded"===b||"failed"===b)if(this.compatibilityFunction){h=new AbortController;var {signal:f}=h;this.compatibilityFunction(this,
{signal:f}).then(()=>u.whenOnce(()=>!this._spatialReferenceTask.updating,f)).then(()=>{this._set("state","ready");this._set("error",null)}).catch(k=>{n.isAbortError(k)||(this._set("state","error"),this._set("error",k))});this._refreshController=h}else"loaded"===b?(this._set("state","ready"),this._set("error",null)):(this._set("state","error"),this._set("error",this.basemap.loadError))};E._cancelRefresh=function(){this._refreshController&&(this._refreshController.abort(),this._refreshController=null)};
t._createClass(z,[{key:"_spatialReferenceTask",get:function(){return y.findSpatialReference(this.view,this.basemap)}},{key:"basemap",set:function(h){const b=this._get("basemap");b&&b.cancelLoad();h&&h.load().catch(()=>{});this._set("basemap",h)}},{key:"spatialReference",get:function(){return this._spatialReferenceTask.spatialReference}}]);return z}(A.HandleOwnerMixin(d));g.__decorate([v.property({readOnly:!0})],d.prototype,"_spatialReferenceTask",null);g.__decorate([v.property()],d.prototype,"basemap",
null);g.__decorate([v.property()],d.prototype,"compatibilityFunction",void 0);g.__decorate([v.property({readOnly:!0})],d.prototype,"error",void 0);g.__decorate([v.property({readOnly:!0})],d.prototype,"spatialReference",null);g.__decorate([v.property({readOnly:!0})],d.prototype,"state",void 0);g.__decorate([v.property()],d.prototype,"view",void 0);return d=g.__decorate([x.subclass("esri.widgets.BasemapGallery.support.BasemapGalleryItem")],d)})},"esri/widgets/BasemapGallery/support/LocalBasemapsSource":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Basemap ../../../core/Accessor ../../../core/Collection ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(t,g,d,A,n,u,v,q,D,G){const x=n.ofType(d);d=function(y){function C(z){z=y.call(this,z)||this;z.basemaps=new x;return z}t._inheritsLoose(C,y);C.prototype.refresh=function(){};t._createClass(C,[{key:"state",get:function(){return"ready"}}]);return C}(A);g.__decorate([u.property({type:x})],d.prototype,"basemaps",void 0);g.__decorate([u.property({readOnly:!0})],d.prototype,"state",null);return d=g.__decorate([G.subclass("esri.widgets.BasemapGallery.support.LocalBasemapsSource")],d)})},"esri/widgets/BasemapGallery/support/PortalBasemapsSource":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Basemap ../../../core/Collection ../../../core/Error ../../../core/Handles ../../../core/Loadable ../../../core/Logger ../../../core/Promise ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../portal/Portal ./LocalBasemapsSource".split(" "),
function(t,g,d,A,n,u,v,q,D,G,x,y,C,z,E,h,b,f){const k=A.ofType(d),p=q.getLogger("esri.widgets.BasemapGallery.support.PortalBasemapsSource");d=function(l){function r(e){e=l.call(this,e)||this;e._handles=new u;e.basemaps=new k;e.filterFunction=null;e.portal=b.getDefault();e.query=null;e.updateBasemapsCallback=null;return e}t._inheritsLoose(r,l);var c=r.prototype;c.initialize=function(){this._handles.add([x.watch(()=>{var e,a;return[this.filterFunction,this.loadStatus,null==(e=this.portal)?void 0:e.basemapGalleryGroupQuery,
null==(a=this.portal)?void 0:a.user,this.query,this.updateBasemapsCallback]},()=>this.refresh(),x.initial)])};c.destroy=function(){this._handles.destroy();this.portal=this.filterFunction=this._handles=null};c.load=function(e){this.addResolvingPromise(this.portal.load(e));this.notifyChange("state");return Promise.resolve(this)};c.refresh=function(){var e=t._asyncToGenerator(function*(){if("ready"===this.state){this._lastPortalBasemapFetchController&&(this._lastPortalBasemapFetchController.abort(),
this._lastPortalBasemapFetchController=null);var a=this.portal,m=new AbortController;this._lastPortalBasemapFetchController=m;this.notifyChange("state");try{const w=yield a.fetchBasemaps(this._toQueryString(this.query),m);this._updateBasemaps(w)}catch(w){if(G.isAbortError(w))throw w;p.warn(new n("basemap-source:fetch-basemaps-error","Could not fetch basemaps from portal.",{error:w}));this._updateBasemaps()}this._lastPortalBasemapFetchController=null;this.notifyChange("state")}});return function(){return e.apply(this,
arguments)}}();c._toQueryString=function(e){return e&&"string"!==typeof e?Object.keys(e).map(a=>`${a}:${e[a]}`).join(" AND "):e};c._updateBasemaps=function(e=[]){e=this.filterFunction?e.filter(this.filterFunction):e;e=this.updateBasemapsCallback?this.updateBasemapsCallback(e):e;this.basemaps.removeAll();this.basemaps.addMany(e)};t._createClass(r,[{key:"state",get:function(){return"not-loaded"===this.loadStatus?"not-loaded":"loading"===this.loadStatus||this._lastPortalBasemapFetchController?"loading":
"ready"}}]);return r}(v.LoadableMixin(D.EsriPromiseMixin(f)));g.__decorate([y.property({readOnly:!0,type:k})],d.prototype,"basemaps",void 0);g.__decorate([y.property()],d.prototype,"filterFunction",void 0);g.__decorate([y.property({type:b})],d.prototype,"portal",void 0);g.__decorate([y.property()],d.prototype,"query",void 0);g.__decorate([y.property({readOnly:!0})],d.prototype,"state",null);g.__decorate([y.property()],d.prototype,"updateBasemapsCallback",void 0);return d=g.__decorate([h.subclass("esri.widgets.BasemapGallery.support.PortalBasemapsSource")],
d)})},"widgets/BasemapGallery/_build-generate_module":function(){define(["dojo/text!./Widget.html","dojo/text!./css/style.css","dojo/i18n!./nls/strings"],function(){})},"url:widgets/BasemapGallery/Widget.html":"\x3cdiv\x3e\r\n  \x3cdiv data-dojo-attach-point\x3d'basemapGalleryNode'\x3e\x3c/div\x3e\r\n\x3c/div\x3e","url:widgets/BasemapGallery/css/style.css":".jimu-widget-basemap-gallery{width: 100%; height: 100%;}.jimu-widget-basemap-gallery .esri-basemap-gallery.esri-widget{width: 100%; height: 100%; max-height: 100%; background-color: transparent;}.jimu-widget-basemap-gallery .esri-basemap-gallery {max-width: none;}",
"*now":function(t){t(['dojo/i18n!*preload*widgets/BasemapGallery/nls/Widget*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])}}});
define(["dojo/_base/declare","jimu/BaseWidget","esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/BasemapGalleryViewModel"],function(t,g,d,A){return t([g],{name:"BasemapGallery",baseClass:"jimu-widget-basemap-gallery",postCreate:function(){this.inherited(arguments)},startup:function(){this.basemapGallery=new d({container:this.basemapGalleryNode,viewModel:new A({view:this.sceneView})});this.basemapGallery.render()},destroy:function(){this.basemapGallery&&this.basemapGallery.destroy();this.inherited(arguments)}})});