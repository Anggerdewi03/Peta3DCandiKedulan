// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.15/esri/copyright.txt and http://www.arcgis.com/apps/webappbuilder/copyright.txt for details.
//>>built
require({cache:{"jimu/ConfigManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/Deferred dojo/on ./utils ./WidgetManager ./shared/AppVersionManager ./ConfigLoader ./tokenUtils ./portalUrlUtils ./portalUtils esri/config".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){function k(f,w){var z=b.clone(f),A=m.widgetProperties;"undefined"===typeof w&&(w=!1);delete z.mode;m.visitElement(z,function(x,B){x.widgets?(delete x.isOnScreen,delete x.gid,
"jimu.js/images/group_icon.png"===x.icon&&delete x.icon,delete x.openType,B.isOnScreen&&x.panel&&m.isEqual(x.panel,z.widgetOnScreen.panel)&&delete x.panel):(x.icon&&x.icon===x.folderUrl+"images/icon.png?wab_dv\x3d"+window.deployVersion&&delete x.icon,delete x.panel,delete x.folderUrl,delete x.amdFolder,delete x.thumbnail,delete x.configFile,delete x.gid,delete x.isOnScreen,A.forEach(function(C){delete x[C]}),w?("undefined"===typeof x.openAtStart&&(x.openAtStart=!1),x.config||delete x.config):(x.visible&&
delete x.visible,x.manifest&&x.label===x.manifest.label&&delete x.label,x.isDefaultConfig&&(delete x.config,delete x.isDefaultConfig)),delete x.manifest)});delete z.rawAppConfig;delete z._ssl;delete z.getConfigElementById;delete z.getConfigElementsByName;delete z.getConfigElementByLabel;delete z.processNoUriWidgets;delete z.addElementId;delete z.getCleanConfig;delete z.visitElement;delete z.agolConfig;delete z._itemData;delete z.oldWabVersion;return z}var r=null;var y=a(null,{urlParams:null,appConfig:null,
configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(f){this.urlParams=f||{};this.listenBuilderEvents();this.versionManager=new d;this.widgetManager=h.getInstance();this.configLoader=e.getInstance(this.urlParams,{versionManager:this.versionManager});"config"===this.urlParams.mode&&window.parent.setConfigViewerTopic&&b.isFunction(window.parent.setConfigViewerTopic)&&window.parent.setConfigViewerTopic(l);"preview"===this.urlParams.mode&&window.parent.setPreviewViewerTopic&&b.isFunction(window.parent.setPreviewViewerTopic)&&
window.parent.setPreviewViewerTopic(l);v(window,"resize",b.hitch(this,this._onWindowResize))},listenBuilderEvents:function(){l.subscribe("builder/widgetChanged",b.hitch(this,this._onWidgetChanged));l.subscribe("builder/groupChanged",b.hitch(this,this._onGroupChanged));l.subscribe("builder/widgetPoolChanged",b.hitch(this,this._onWidgetPoolChanged));l.subscribe("builder/openAtStartChange",b.hitch(this,this._onOpenAtStartChanged));l.subscribe("builder/onScreenOrderChanged",b.hitch(this,this._onScreenOrderChanged));
l.subscribe("builder/layoutDefinitionChanged",b.hitch(this,this._onLayoutDefinitionChanged));l.subscribe("builder/sceneViewChanged",b.hitch(this,this._onSceneViewChanged));l.subscribe("builder/mapOptionsChanged",b.hitch(this,this._onMapOptionsChanged));l.subscribe("builder/appAttributeChanged",b.hitch(this,this._onAppAttributeChanged));l.subscribe("builder/setAppConfig",b.hitch(this,this._onAppConfigSet));l.subscribe("builder/themeChanged",b.hitch(this,this._onThemeChanged));l.subscribe("builder/layoutChanged",
b.hitch(this,this._onLayoutChanged));l.subscribe("builder/styleChanged",b.hitch(this,this._onStyleChanged));l.subscribe("builder/syncExtent",b.hitch(this,this._onSyncExtent));l.subscribe("builder/loadingPageChanged",b.hitch(this,this._onLoadingPageChanged));l.subscribe("builder/templateConfigChanged",b.hitch(this,this._onTemplateConfigChanged));l.subscribe("builder/sharedThemeChanged",b.hitch(this,this._onSharedThemeChanged))},loadConfig:function(){if("preview"!==this.urlParams.mode&&"config"!==this.urlParams.mode)return this.configLoader.loadConfig().then(b.hitch(this,
function(f){this.portalSelf=this.configLoader.portalSelf;this.appConfig=this._addDefaultValues(f);window.appInfo.isRunInMobile=this._isRunInMobile();console.timeEnd("Load Config");f=this.getAppConfig();l.publish("appConfigLoaded",f);return f}),b.hitch(this,function(f){console.error(f);f&&f.message&&"string"===typeof f.message&&this._showErrorMessage(f)}))},_showErrorMessage:function(f){if(!1===f.isSelfOrigin){n.create("div",{"class":"app-error",innerHTML:m.sanitizeHTML(f.message||f)},document.body);
f=n.create("div",{"class":"app-error",innerHTML:m.sanitizeHTML(window.jimuNls.common.close)},document.body);n.setStyle(f,{"margin-top":"80px","padding-top":0,background:"none",cursor:"pointer"});v(f,"click",b.hitch(this,function(){window.close()}));n.setStyle(f,"display","none");f=n.create("div",{"class":"app-error"},document.body);n.setStyle(f,{"margin-top":"90px","padding-top":0,background:"none"});f=n.create("div",{"class":"app-error-advanced-button",innerHTML:m.sanitizeHTML(window.jimuNls.advancedOptions)},
f);n.setStyle(f,{margin:"0 auto 0 auto",padding:"8px 12px 8px 12px",color:"#666",background:"none",border:"1px solid #ccc",display:"inline-block","border-radius":"4px",cursor:"pointer"});v(f,"click",b.hitch(this,function(){n.setStyle(z,"display","block")}));f=window.location.href;var w=p.getStandardPortalUrl(window.location.origin);w=p.getArcgisOnlineUrl(w);f=f.replace(window.location.origin,w);f=window.jimuNls.proceedTo.replace("${value}","\x3ca href\x3d"+f+"\x3e"+f+"\x3c/a\x3e");var z=n.create("div",
{"class":"app-error",innerHTML:m.sanitizeHTML(f)},document.body);n.setStyle(z,{"margin-top":"140px",display:"none","padding-top":0,background:"none"});n.setStyle(jimuConfig.loadingId,"display","none")}else n.create("div",{"class":"app-error",innerHTML:m.sanitizeHTML("Unable to create map: "+(f.message||f))},document.body)},getAppConfig:function(){if(window.appInfo.isRunInMobile){var f=b.clone(this._getMobileConfig(this.appConfig));f._originConfig=b.clone(this.appConfig)}else f=b.clone(this.appConfig);
f.getConfigElementById=function(w){return m.getConfigElementById(this,w)};f.getConfigElementByLabel=function(w){return m.getConfigElementByLabel(this,w)};f.getConfigElementsByName=function(w){return m.getConfigElementsByName(this,w)};f.getCleanConfig=function(w){return this._originConfig?k(this._originConfig,w):k(this,w)};f.visitElement=function(w){m.visitElement(this,w)};return f},_onWindowResize:function(){var f=this._isRunInMobile();window.appInfo.isRunInMobile!==f&&(window.appInfo.isRunInMobile=
f,this.appConfig&&l.publish("appConfigChanged",this.getAppConfig(),"layoutChange"))},_isRunInMobile:function(){var f=n.getMarginBox(window.jimuConfig.layoutId);if(f.w<=window.jimuConfig.breakPoints[0]||f.h<=window.jimuConfig.breakPoints[0])return n.addClass(window.jimuConfig.layoutId,"jimu-ismobile"),!0;n.removeClass(window.jimuConfig.layoutId,"jimu-ismobile");return!1},_getMobileConfig:function(f){return m.mixinAppConfigPosition(f,f.mobileLayout)},_onWidgetChanged:function(f){var w=m.reCreateObject(f);
f=m.getConfigElementById(this.appConfig,f.id);!1!==w.inPanel||f.uri||(w.closeable=!0);for(var z in w)f[z]=w[z];delete f.isDefaultConfig;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);l.publish("appConfigChanged",this.getAppConfig(),"widgetChange",w)},_onGroupChanged:function(f){var w=m.reCreateObject(f);f=m.getConfigElementById(this.appConfig,f.id);for(var z in w)f[z]=w[z];this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
l.publish("appConfigChanged",this.getAppConfig(),"groupChange",w)},_onWidgetPoolChanged:function(f){f=m.reCreateObject(f);if(1===this.widgetManager.getControllerWidgets().length)this.appConfig.widgetPool.widgets=f.widgets,this.appConfig.widgetPool.groups=f.groups;else{var w=m.getConfigElementById(this.appConfig,f.controllerId);c.forEach(w.controlledWidgets,function(z){this._removeWidgetOrGroupFromPoolById(this.appConfig,z)},this);c.forEach(w.controlledGroups,function(z){this._removeWidgetOrGroupFromPoolById(this.appConfig,
z)},this);this.appConfig.widgetPool.widgets="undefined"===typeof this.appConfig.widgetPool.widgets?f.widgets:this.appConfig.widgetPool.widgets.concat(f.widgets);this.appConfig.widgetPool.groups="undefined"===typeof this.appConfig.widgetPool.groups?f.groups:this.appConfig.widgetPool.groups.concat(f.groups);this.configLoader.addNeedValues(this.appConfig);w.controlledWidgets=c.map(f.widgets,function(z){return z.id});w.controlledGroups=c.map(f.groups,function(z){return z.id})}this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);l.publish("appConfigChanged",this.getAppConfig(),"widgetPoolChange",f)},_removeWidgetOrGroupFromPoolById:function(f,w){c.some(f.widgetPool.widgets,function(z,A){if(z.id===w)return f.widgetPool.widgets.splice(A,1),!0});c.some(f.widgetPool.groups,function(z,A){if(z.id===w)return f.widgetPool.groups.splice(A,1),!0})},_onOpenAtStartChanged:function(f){var w=m.reCreateObject(f),z=this.appConfig;f.isOnScreen?(z=z.widgetOnScreen&&z.widgetOnScreen.widgets)&&0<z.length&&
c.forEach(z,b.hitch(this,function(A){A.id===f.id?A.openAtStart=!A.openAtStart:delete A.openAtStart})):((z=z.widgetPool)&&z.groups&&0<z.groups.length&&c.forEach(z.groups,b.hitch(this,function(A){A.id===f.id?A.openAtStart=!A.openAtStart:delete A.openAtStart})),z&&z.widgets&&0<z.widgets.length&&c.forEach(z.widgets,b.hitch(this,function(A){A.id===f.id?A.openAtStart=!A.openAtStart:delete A.openAtStart})));l.publish("appConfigChanged",this.getAppConfig(),"openAtStartChange",w)},_onScreenOrderChanged:function(f){var w=
m.reCreateObject(f);c.forEach(this.appConfig.widgetOnScreen.widgets,function(z){z.isController||(!1!==z.inPanel||!0!==z.closeable)&&!0!==z.inPanel&&z.uri||c.some(w,function(A){if(z.id===A.id)return z.position=A.position,!0})},this);l.publish("appConfigChanged",this.getAppConfig(),"onScreenOrderChange",w)},_onAppAttributeChanged:function(f){f=m.reCreateObject(f);b.mixin(this.appConfig,f);this.configLoader.processProxy(this.appConfig);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);
l.publish("appConfigChanged",this.getAppConfig(),"attributeChange",f)},_onLoadingPageChanged:function(f){f=m.reCreateObject(f);if("backgroundColor"in f)this.appConfig.loadingPage.backgroundColor=f.backgroundColor;else if("backgroundImage"in f){var w=this.appConfig.loadingPage.backgroundImage||{};this.appConfig.loadingPage.backgroundImage=b.mixin(w,f.backgroundImage)}else"loadingGif"in f&&(w=this.appConfig.loadingPage.loadingGif||{},this.appConfig.loadingPage.loadingGif=b.mixin(w,f.loadingGif));this.configLoader.addNeedValues(this.appConfig);
this._addDefaultValues(this.appConfig);l.publish("appConfigChanged",this.getAppConfig(),"loadingPageChange",f)},_onTemplateConfigChanged:function(f){f=m.reCreateObject(f);this.appConfig.templateConfig=f;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);l.publish("appConfigChanged",this.getAppConfig(),"templateConfigChange",f)},_onLayoutDefinitionChanged:function(f){f=m.reCreateObject(f);m.isEqual(this.appConfig.layoutDefinition,f.layoutDefinition)||(this.appConfig.layoutDefinition=
f.layoutDefinition,this.appConfig.widgetOnScreen.groups=m.handleGridLayoutOnScreenGroupChange(this.appConfig.widgetOnScreen.groups,f.groupIds),this.configLoader.addNeedValues(this.appConfig),this._addDefaultValues(this.appConfig),l.publish("appConfigChanged",this.getAppConfig(),"layoutDefinitionChange",f.layoutDefinition))},_onSceneViewChanged:function(f){f=m.reCreateObject(f);f.itemId&&f.itemId!==this.appConfig.map.itemId&&this.appConfig.map.mapOptions&&m.deleteMapOptions(this.appConfig.map.mapOptions);
b.mixin(this.appConfig.map,f);this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);l.publish("appConfigChanged",this.getAppConfig(),"mapChange",f)},_onMapOptionsChanged:function(f){f=m.reCreateObject(f);this.appConfig.map.mapOptions||(this.appConfig.map.mapOptions={});b.mixin(this.appConfig.map.mapOptions,f);l.publish("appConfigChanged",this.getAppConfig(),"mapOptionsChange",f)},_onThemeChanged:function(f){this._getAppConfigFromTheme(f).then(b.hitch(this,function(w){this.appConfig=
w;l.publish("appConfigChanged",this.getAppConfig(),"themeChange",f.getName())}))},_onLayoutChanged:function(f){this.appConfig=m.mixinAppConfigPosition(this.appConfig,f.layoutConfig);this.appConfig.layoutDefinition=f.layoutConfig.layoutDefinition;this.configLoader.addNeedValues(this.appConfig);this._addDefaultValues(this.appConfig);this._addDefaultPanelAndPosition(this.appConfig);l.publish("appConfigChanged",this.getAppConfig(),"layoutChange",f.name)},_onStyleChanged:function(f){this.appConfig.theme.styles=
this._genStyles(this.appConfig.theme.styles,f.name);f.isCustom?this.appConfig.theme.customStyles={mainBackgroundColor:f.styleColor}:(delete this.appConfig.theme.customStyles,delete this.appConfig.titleColor,this.appConfig.theme.sharedTheme={isPortalSupport:this.appConfig.theme.sharedTheme.isPortalSupport,useHeader:!1,useLogo:!1});l.publish("appConfigChanged",this.getAppConfig(),"styleChange",f.name)},_onSharedThemeChanged:function(f){var w=this.appConfig.theme.sharedTheme;f=m.reCreateObject(f);f.useHeader&&
!w.useHeader&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},this.appConfig.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor})):console.error("Portal does not support sharedTheme."));!f.useHeader&&w.useHeader&&(delete this.appConfig.titleColor,this._onAppAttributeChanged({titleColor:this.appConfig.titleColor}));
f.useLogo&&!w.useLogo&&(this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(this.appConfig.logo=this.portalSelf.portalProperties.sharedTheme.logo&&this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",this.appConfig.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link,this._onAppAttributeChanged({logo:this.appConfig.logo,logoLink:this.appConfig.logoLink})):console.error("Portal does not support sharedTheme."));
!f.useLogo&&w.useLogo&&this._onAppAttributeChanged({logo:this.appConfig.logo});b.mixin(w,f);l.publish("appConfigChanged",this.getAppConfig(),"sharedThemeChange",f)},_onSyncExtent:function(f){l.publish("syncExtent",f)},_genStyles:function(f,w){var z=[];z.push(w);c.forEach(f,function(A){0>z.indexOf(A)&&z.push(A)});return z},_getAppConfigFromTheme:function(f){var w=new u,z=[],A=this.getAppConfig().getCleanConfig();A.mode=this.urlParams.mode;c.forEach(A.widgetPool.groups,function(C){delete C.panel},this);
if(f.appConfig){var x=b.clone(f.appConfig);x.map=A.map;x.map.position=f.appConfig.map.position;this._copyPoolToThemePool(A,x);x.links=A.links;x.title=A.title;x.subtitle=A.subtitle;x.logo=A.logo}else{var B=f.getCurrentLayout();z=f.getCurrentStyle();x=b.clone(A);B=b.clone(B.layoutConfig);x.widgetOnScreen=B.widgetOnScreen;B.widgetPool&&(c.forEach(B.widgetPool.widgets,function(C){C.isPreconfiguredInTheme=!0}),c.forEach(B.widgetPool.groups,function(C){C.isPreconfiguredInTheme=!0}));this._copyPoolToThemePool(A,
B);x.widgetPool=B.widgetPool;B.map&&B.map.position&&(x.map.position=B.map.position);x.mobileLayout=B.mobileLayout;x.layoutDefinition=B.layoutDefinition;z=this._genStyles(c.map(f.getStyles(),function(C){return C.name}),z.name);x.theme={name:f.getName(),styles:z,version:f.getVersion()};this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?(x.theme.sharedTheme={useHeader:!0,useLogo:!0,isPortalSupport:!0},x.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background}):
(x.theme.sharedTheme={useHeader:!1,useLogo:!1,isPortalSupport:!1},x.theme.customStyles={mainBackgroundColor:""});x.titleColor=A.titleColor;x.logoLink=A.logoLink}this.configLoader.addNeedValues(x);this.configLoader.loadWidgetsManifest(x).then(b.hitch(this,function(){this._addDefaultValues(x);w.resolve(x)}));return w},_copyPoolToThemePool:function(f,w){var z=f.widgetPool;w.widgetPool||(w.widgetPool={});f=w.widgetPool;var A=c.filter(f.widgets,function(D){if(D.isPreconfiguredInTheme||!c.some(z.widgets,
function(E){return E.name===D.name}))return!0}),x=c.filter(f.groups,function(D){return D.isPreconfiguredInTheme}),B=c.filter(z.widgets,function(D){return!D.isPreconfiguredInTheme}),C=c.filter(z.groups,function(D){return!D.isPreconfiguredInTheme});B=this._getPoolWidgetsWithoutDuplicated(B,w.widgetOnScreen.widgets||[]);f.widgets=B.concat(A);f.groups=C.concat(x)},_getPoolWidgetsWithoutDuplicated:function(f,w){for(var z=b.clone(f),A=this.getAppConfig(),x=f.length-1;0<=x;x--)for(var B=w.length-1;0<=B;B--)if(w[B].uri){var C=
w[B].name;C||(C=m.getWidgetNameFromUri(w[B].uri));var D=A.getConfigElementById(f[x].id);f[x]&&f[x].name===C&&!1===D.supportMultiInstance&&(console.log("Widget",f[x].name,"is not copied to new theme because this widget exists in new theme."),z.splice(x,1))}return z},_onAppConfigSet:function(f){f=m.reCreateObject(f);window.appInfo.isRunInMobile=this._isRunInMobile();this.configLoader.processProxy(f);this.configLoader.addNeedValues(f);this._addDefaultValues(f);g.setPortalUrl(f.portalUrl);window.portalUrl=
f.portalUrl;this.appConfig?(f.map.itemId&&f.map.itemId!==this.appConfig.map.itemId&&m.deleteMapOptions(f.map.mapOptions),this.appConfig=f,l.publish("appConfigChanged",this.getAppConfig(),"resetConfig",f)):(this.appConfig=f,t.getPortal(f.portalUrl).loadSelfInfo().then(b.hitch(this,function(w){this.portalSelf=w;l.publish("appConfigLoaded",this.getAppConfig())})))},_addDefaultValues:function(f){this._addDefaultPortalUrl(f);this._addDefaultGeometryService(f);this._addDefaultStyle(f);this._addDefaultMap(f);
this._addDefaultVisible(f);this._addDefaultSharedTheme(f);"undefined"===typeof f.widgetOnScreen&&(f.widgetOnScreen={});"undefined"===typeof f.widgetPool&&(f.widgetPool={});this._addDefaultPanelAndPosition(f);this._addDefaultOfWidgetGroup(f);(f.widgetPool.widgets&&0<f.widgetPool.widgets.length&&void 0===f.widgetPool.widgets[0].index||f.widgetPool.groups&&0<f.widgetPool.groups.length&&void 0===f.widgetPool.groups[0].index)&&this._addIndexForWidgetPool(f);return f},_addDefaultPortalUrl:function(f){"undefined"===
typeof f.portalUrl&&(f.portalUrl="http://www.arcgis.com/");f.portalUrl&&"/"!==f.portalUrl.substr(f.portalUrl.length-1)&&(f.portalUrl+="/")},_addDefaultGeometryService:function(f){var w=f&&f.geometryService;w=w&&"string"===typeof w&&b.trim(w)?b.trim(w):this.portalSelf.helperServices.geometry.url;f.geometryService=w;q.geometryServiceUrl=w;m.setGlobalGeometryService(f.geometryService)},_addDefaultStyle:function(f){!f.theme||f.theme.styles&&0!==f.theme.styles.length||(f.theme.styles=["default"])},_addDefaultMap:function(f){f.map.id=
"map";"undefined"===typeof f.map["3D"]&&"undefined"===typeof f.map["2D"]&&(f.map["2D"]=!0);"undefined"===typeof f.map.position&&(f.map.position={left:0,right:0,top:0,bottom:0});"undefined"===typeof f.map.portalUrl&&(f.map.portalUrl=f.portalUrl)},_addDefaultVisible:function(f){m.visitElement(f,function(w){void 0===w.visible&&(w.visible=!0)})},_addDefaultSharedTheme:function(f){f.theme.sharedTheme?("undefined"===typeof f.theme.sharedTheme.useHeader&&(f.theme.sharedTheme.useHeader=!1),"undefined"===
typeof f.theme.sharedTheme.useLogo&&(f.theme.sharedTheme.useLogo=!1)):f.theme.sharedTheme={useHeader:!1,useLogo:!1}},_addDefaultPanelAndPosition:function(f){this._addOnScreenDefaultPanelAndPosition(f);this._addPoolDefaultPanelAndPosition(f)},_addOnScreenDefaultPanelAndPosition:function(f){var w;if(f=f.widgetOnScreen){var z=f.panel&&f.panel.positionRelativeTo?f.panel.positionRelativeTo:"map";"undefined"===typeof f.panel||"undefined"===typeof f.panel.uri?f.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:z}}:
"undefined"===typeof f.panel.position?f.panel.position={relativeTo:z}:"undefined"===typeof f.panel.position.relativeTo&&(f.panel.position.relativeTo=z);if(f.widgets)for(z=0;z<f.widgets.length;z++)f.widgets[z].position||(f.widgets[z].position={}),f.widgets[z].position.relativeTo||(f.widgets[z].position.relativeTo=f.widgets[z]&&f.widgets[z].positionRelativeTo?f.widgets[z].positionRelativeTo:"map"),!0!==f.widgets[z].inPanel||f.widgets[z].panel||(f.widgets[z].panel=b.clone(f.panel),f.widgets[z].panel.position=
f.widgets[z].position,f.widgets[z].panel.position.relativeTo=f.widgets[z].position.relativeTo);if(f.groups)for(z=0;z<f.groups.length;z++)for(f.groups[z].panel||(f.groups[z].panel=f.panel),f.groups[z].panel&&!f.groups[z].panel.position&&(f.groups[z].panel.position={}),f.groups[z].panel.position.relativeTo||(f.groups[z].panel.position.relativeTo=f.groups[z].panel.positionRelativeTo?f.groups[z].panel.positionRelativeTo:"map"),f.groups[z].widgets||(f.groups[z].widgets=[]),w=0;w<f.groups[z].widgets.length;w++)f.groups[z].widgets[w].panel=
f.groups[z].panel}},_addPoolDefaultPanelAndPosition:function(f){var w,z=f.widgetPool;if(z){var A=z.panel&&z.panel.positionRelativeTo?z.panel.positionRelativeTo:"map";"undefined"===typeof z.panel||"undefined"===typeof z.panel.uri?z.panel={uri:"jimu/OnScreenWidgetPanel",position:{relativeTo:A}}:"undefined"===typeof z.panel.position?z.panel.position={relativeTo:A}:"undefined"===typeof z.panel.position.relativeTo&&(z.panel.position.relativeTo=A);if(z.groups)for(A=0;A<z.groups.length;A++)for(z.groups[A].panel?
z.groups[A].panel.position.relativeTo||(z.groups[A].panel.position.relativeTo=z.groups[A].panel.positionRelativeTo?z.groups[A].panel.positionRelativeTo:"map"):z.groups[A].panel=z.panel,z.groups[A].widgets||(z.groups[A].widgets=[]),w=0;w<z.groups[A].widgets.length;w++)z.groups[A].widgets[w].panel=z.groups[A].panel;if(z.widgets)for(A=0;A<z.widgets.length;A++)!1===z.widgets[A].inPanel?(w=z.widgets[A].positionRelativeTo?z.widgets[A].positionRelativeTo:"map",z.widgets[A].position)?z.widgets[A].position.relativeTo||
(z.widgets[A].position.relativeTo=w):z.widgets[A].position={relativeTo:w}:z.widgets[A].panel||(z.widgets[A].panel=f.widgetPool.panel)}},_addDefaultOfWidgetGroup:function(f){m.visitElement(f,b.hitch(this,function(w,z){w.isOnScreen=z.isOnScreen;w.widgets?(w.gid=w.id,1===w.widgets.length?(w.label||(w.label=w.widgets[0].label?w.widgets[0].label:"Group"),w.icon||(w.icon=w.widgets[0].uri?this._getDefaultIconFromUri(w.widgets[0].uri):"jimu.js/images/group_icon.png")):(w.icon=w.icon?w.icon:"jimu.js/images/group_icon.png",
w.label=w.label?w.label:window.jimuNls.common.group+"_"+z.index)):(w.gid=z.groupId,w.uri&&m.processWidgetSetting(w))}))},_getDefaultIconFromUri:function(f){f=f.split("/");f.pop();return f.join("/")+"/images/icon.png"},_addIndexForWidgetPool:function(f){var w=0,z,A;if(f.widgetPool.widgets)for(z=0;z<f.widgetPool.widgets.length;z++)f.widgetPool.widgets[z].index=w,w++;if(f.widgetPool.groups)for(z=0;z<f.widgetPool.groups.length;z++)for(f.widgetPool.groups[z].index=w,w++,A=0;A<f.widgetPool.groups[z].widgets.length;A++)f.widgetPool.groups[z].widgets[A].index=
A}});y.getInstance=function(f){null===r?r=new y(f):f&&(r.urlParams=f);window.getAppConfig=b.hitch(r,r.getAppConfig);return r};return y})},"dojo/_base/html":function(){define("./kernel ../dom ../dom-style ../dom-attr ../dom-prop ../dom-class ../dom-construct ../dom-geometry".split(" "),function(a,b,c,n,l,u,v,m){a.byId=b.byId;a.isDescendant=b.isDescendant;a.setSelectable=b.setSelectable;a.getAttr=n.get;a.setAttr=n.set;a.hasAttr=n.has;a.removeAttr=n.remove;a.getNodeProp=n.getNodeProp;a.attr=function(h,
d,e){return 2==arguments.length?n["string"==typeof d?"get":"set"](h,d):n.set(h,d,e)};a.hasClass=u.contains;a.addClass=u.add;a.removeClass=u.remove;a.toggleClass=u.toggle;a.replaceClass=u.replace;a._toDom=a.toDom=v.toDom;a.place=v.place;a.create=v.create;a.empty=function(h){v.empty(h)};a._destroyElement=a.destroy=function(h){v.destroy(h)};a._getPadExtents=a.getPadExtents=m.getPadExtents;a._getBorderExtents=a.getBorderExtents=m.getBorderExtents;a._getPadBorderExtents=a.getPadBorderExtents=m.getPadBorderExtents;
a._getMarginExtents=a.getMarginExtents=m.getMarginExtents;a._getMarginSize=a.getMarginSize=m.getMarginSize;a._getMarginBox=a.getMarginBox=m.getMarginBox;a.setMarginBox=m.setMarginBox;a._getContentBox=a.getContentBox=m.getContentBox;a.setContentSize=m.setContentSize;a._isBodyLtr=a.isBodyLtr=m.isBodyLtr;a._docScroll=a.docScroll=m.docScroll;a._getIeDocumentElementOffset=a.getIeDocumentElementOffset=m.getIeDocumentElementOffset;a._fixIeBiDiScrollLeft=a.fixIeBiDiScrollLeft=m.fixIeBiDiScrollLeft;a.position=
m.position;a.marginBox=function(h,d){return d?m.setMarginBox(h,d):m.getMarginBox(h)};a.contentBox=function(h,d){return d?m.setContentSize(h,d):m.getContentBox(h)};a.coords=function(h,d){a.deprecated("dojo.coords()","Use dojo.position() or dojo.marginBox().");h=b.byId(h);var e=c.getComputedStyle(h);e=m.getMarginBox(h,e);h=m.position(h,d);e.x=h.x;e.y=h.y;return e};a.getProp=l.get;a.setProp=l.set;a.prop=function(h,d,e){return 2==arguments.length?l["string"==typeof d?"get":"set"](h,d):l.set(h,d,e)};a.getStyle=
c.get;a.setStyle=c.set;a.getComputedStyle=c.getComputedStyle;a.__toPixelValue=a.toPixelValue=c.toPixelValue;a.style=function(h,d,e){switch(arguments.length){case 1:return c.get(h);case 2:return c["string"==typeof d?"get":"set"](h,d)}return c.set(h,d,e)};return a})},"jimu/utils":function(){define("dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/sniff dojo/_base/config dojo/io-query dojo/query dojo/NodeList-traverse dojo/Deferred dojo/promise/all dojo/on dojo/json dojo/cookie dojo/number dojo/date/locale dojo/i18n!dojo/cldr/nls/number dojox/encoding/base64 esri/kernel esri/config esri/geometry/SpatialReference esri/geometry/Extent esri/geometry/Multipoint esri/geometry/Polyline esri/geometry/Polygon esri/geometry/support/webMercatorUtils esri/rest/geometryService esri/rest/support/ProjectParameters esri/core/urlUtils esri/request ./shared/utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O){function K(H,U){var W=H.match(/url\([^)]+\)/gi),Q;if(null===W||""===U)return H;for(Q=0;Q<W.length;Q++){var X=W[Q].match(/(url\(["|']?)(.*)((?:['|"]?)\))/i);if(4<=X.length){var ba=X[2];/^data:image\/.*;/.test(ba)||(U.endWith("/")||(U+="/"),H=H.replace(X[1]+ba+X[3],X[1]+U+ba+X[3]))}}return H}function L(H,U){var W=Array.isArray(U),Q=W&&[]||{};W?(H=H||[],Q=Q.concat(H),U.forEach(function(X,ba){"undefined"===typeof H[ba]?Q[ba]=X:"object"===
typeof X?Q[ba]=L(H[ba],X):-1===H.indexOf(X)&&Q.push(X)})):(H&&"object"===typeof H&&Object.keys(H).forEach(function(X){Q[X]=H[X]}),Object.keys(U).forEach(function(X){Q[X]="object"===typeof U[X]&&U[X]?H[X]?L(H[X],U[X]):U[X]:U[X]}));return Q}function R(H){var U={};var W=H.indexOf("/");H.substring(0,W);W=H.substring(0,H.lastIndexOf("/")+1);U.folderUrl=require(N.getRequireConfig()).toUrl(W);U.amdFolder=W;U.url=U.folderUrl;if(/^http(s)?:\/\//.test(H)||/^\/\//.test(H))U.isRemote=!0;return U}function M(H){H.panels.forEach(function(U){U.uri=
"panels/"+U.name+"/Panel.js"});H.styles.forEach(function(U){U.uri="styles/"+U.name+"/style.css"});H.layouts.forEach(function(U){U.uri="layouts/"+U.name+"/config.json";U.icon="layouts/"+U.name+"/icon.png";U.RTLIcon="layouts/"+U.name+"/icon_rtl.png"})}function J(H,U){var W=H.map(function(ba){return ba.id});b.forEach(U,function(ba){0>W.indexOf(ba)&&H.push({id:ba,widgets:[]})},this);var Q=[];H=b.filter(H,function(ba){return 0>U.indexOf(ba.id)?(Q.push(ba),!1):!0},this);if(0===H.length)return[];var X=H[H.length-
1];b.forEach(Q,function(ba){X.widgets=X.widgets.concat(ba.widgets)},this);return H=H.sort(function(ba,aa){return U.indexOf(ba.id)-U.indexOf(aa.id)})}function I(H,U,W){function Q(ba,aa){return a.isArray(ba[aa.key])?ba[aa.key][aa.index]:ba[aa.key]}U=function(ba){var aa=[];ba.split("_").forEach(function(ea){var ia=!1;"--"===ea.slice(ea.length-2)&&(ia=!0,ea=ea.slice(0,ea.length-2));var ka=ea.search(/\[[0-9]+\]/);-1===ka&&(ka=ea.length);aa.push({key:ea.slice(0,ka),index:Number(ea.slice(ka+1,-1)),deleteFlag:ia})});
return aa}(U);for(var X=1;X<U.length-1;X++)if(H=Q(H,U[X]),!H)return;if(U[U.length-1].deleteFlag)!0===W&&(a.isArray(H[U[U.length-1].key])?delete H[U[U.length-1].key][U[U.length-1].index]:delete H[U[U.length-1].key]);else if(a.isArray(H[U[U.length-1].key])){if(void 0===W)return H[U[U.length-1].key][U[U.length-1].index];H[U[U.length-1].key][U[U.length-1].index]=W}else{if(void 0===W)return H[U[U.length-1].key];H[U[U.length-1].key]=W}}function P(H,U,W){function Q(ea){ea=N.template.getSearchRange(U,ea,
"]");var ia=U.slice(ea.firstPos,ea.lastPos);return-1!==ea.firstPos?(ia=U.slice(ea.firstPos+ia.indexOf("[")+1,ea.lastPos-1),ea=U.slice(ea.lastPos+1),(ia=N.getConfigElementById(H,ia))?{object:ia,key:"section_"+ea,state:"isSection"}:{state:"deleted"}):{state:"isNotSection"}}var X=H,ba=U=U.replace(/\//g,"_"),aa=Q("groups\\[.+\\]");if("deleted"!==aa.state&&("isSection"===aa.state&&(X=aa.object,ba=aa.key),aa=Q("widgets\\[.+\\]"),"delete"!==aa.state))return"isSection"===aa.state&&(X=aa.object,ba=aa.key),
I(X,ba,W)}var N={},V={geometryService:"http://utility.arcgisonline.com/arcgis/rest/services/Geometry/GeometryServer"};a.mixin(N,O);window.atob||(window.atob=function(H){H=r.decode(H);for(var U="",W=0,Q=H.length;W<Q;W++)U+=String.fromCharCode(H[W]);return U});window.btob||(window.btob=function(H){for(var U=[],W=0,Q=H.length;W<Q;W++)U.push(String.charCodeAt(H[W]));return r.encode(U)});var S=[];require.on("error",function(H){b.forEach(S,function(U){H.info[0]&&-1<H.info[0].indexOf(U.resKey)&&U.def.reject(H);
for(var W in H.info)-1<W.indexOf(U.resKey)&&U.def.reject(H)})});N.checkError=function(H,U){S.push({resKey:H,def:U})};N.replacePlaceHolder=function(H,U){var W=g.stringify(H),Q=W.match(/\$\{(\w)+\}/g);if(null===Q)return H;for(H=0;H<Q.length;H++){var X=Q[H].match(/(\w)+/g)[0];U[X]&&(W=W.replace(Q[H],U[X]))}return g.parse(W)};N.changeUnit=function(H){var U=Math.abs(H);H=Math.floor(U);var W=Math.floor(60*(U-H));U=(60*(60*(U-H)-W)).toFixed(2);return H+"\u00b0"+(10>W?"0"+W:W)+"'"+(10>U?"0"+U:U)+'"'};N.formatTime=
function(H){var U=H/1E3;H=Math.floor(U/60);U=Number(U-60*H).toFixed(1);return(10>H?"0"+H:H)+":"+(10>U?"0"+U:U)};N.parseTime=function(H){var U=/(\d{2,}):(\d{2})\.(\d{1})/;if(!U.test(H))return console.log("wrong time format."),-1;H=H.match(U);return 1E3*(60*parseInt(H[1],10)+parseInt(H[2],10)+parseInt(H[3],10)/10)};N.preloadImg=function(H,U){var W=[];W="string"===typeof H?[H]:H;b.forEach(W,function(Q){(new Image).src=U?U+Q:Q})};N.setWABLogoDefaultAlt=function(H){if(H){H=v("img",H);for(var U=["img_1412759111499",
"img_1545621838463","img_1560482577021"],W=0,Q=H.length;W<Q;W++){var X=H[W];-1<U.indexOf(c.getAttr(X,"id"))&&!c.getAttr(X,"alt")&&c.setAttr(X,"alt","ArcGIS Web AppBuilder.png")}}};var T=null;N.getImagesSize=function(H){var U=new h;if(!H||0!==H.indexOf("http"))return U.reject(),U;null===T&&(T=c.create("img",{id:"__test-image-size",style:{position:"absolute",left:"-9999px",top:"-9999px"}},document.body));var W=e(T,"load",function(){clearTimeout(Q);Q=null;W.remove();var X=c.getContentBox(T);1===X.w&&
1===X.h||0===X.w||0===X.h?U.reject():U.resolve([X.w,X.h])},{}),Q=setTimeout(function(){clearTimeout(Q);Q=null;U.reject()},5E3);c.setAttr(T,"src",H);return U};N.getPositionStyle=function(H){var U={};if(!H)return U;H=a.clone(H);if(window.isRTL){if("undefined"!==typeof H.left&&"undefined"!==typeof H.right){var W=H.left;H.left=H.right;H.right=W}else"undefined"!==typeof H.left?(H.right=H.left,delete H.left):"undefined"!==typeof H.right&&(H.left=H.right,delete H.right);"undefined"!==typeof H.paddingLeft&&
"undefined"!==typeof H.paddingRight?(W=H.paddingLeft,H.paddingLeft=H.paddingRight,H.paddingRight=W):"undefined"!==typeof H.paddingLeft?(H.paddingRight=H.paddingLeft,delete H.paddingLeft):"undefined"!==typeof H.paddingRight&&(H.paddingLeft=H.paddingRight,delete H.paddingRight);"undefined"!==typeof H.marginLeft&&"undefined"!==typeof H.marginRight?(W=H.marginLeft,H.marginLeft=H.marginRight,H.marginRight=W):"undefined"!==typeof H.marginLeft?(H.marginRight=H.marginLeft,delete H.marginLeft):"undefined"!==
typeof H.marginRight&&(H.marginLeft=H.marginRight,delete H.marginRight)}W="left top right bottom width height padding paddingLeft paddingRight paddingTop paddingBottom margin marginLeft marginRight marginTop marginBottom".split(" ");for(var Q=0;Q<W.length;Q++){var X=W[Q];"number"===typeof H[X]?U[X]=H[X]+"px":"undefined"!==typeof H[X]?U[X]=H[X]:"padding"===X.substr(0,7)||"margin"===X.substr(0,7)?U[X]=0:U[X]="auto"}U.zIndex="undefined"===typeof H.zIndex?"auto":H.zIndex;return U};N.isEqual=function(H,
U){function W(ba,aa){var ea;if(null===ba&&null===aa||"undefined"===typeof ba&&"undefined"===typeof aa)return!0;if(null===ba&&null!==aa||null===aa&&null!==ba||"undefined"===typeof ba&&"undefined"!==typeof aa||"undefined"===typeof aa&&"undefined"!==typeof ba)return!1;if(isNaN(ba)&&isNaN(aa)&&"number"===typeof ba&&"number"===typeof aa||ba===aa)return!0;if("function"===typeof ba&&"function"===typeof aa||ba instanceof Date&&aa instanceof Date||ba instanceof RegExp&&aa instanceof RegExp||ba instanceof String&&
aa instanceof String||ba instanceof Number&&aa instanceof Number)return ba.toString()===aa.toString();if(-1<Q.indexOf(ba)||-1<X.indexOf(aa))return!1;if(null!==aa){for(ea in aa)if(aa.hasOwnProperty(ea)!==ba.hasOwnProperty(ea)||typeof aa[ea]!==typeof ba[ea])return!1;for(ea in ba){if(aa.hasOwnProperty(ea)!==ba.hasOwnProperty(ea)||typeof aa[ea]!==typeof ba[ea])return!1;switch(typeof ba[ea]){case "object":case "function":Q.push(ba);X.push(aa);if(!W(ba[ea],aa[ea]))return!1;Q.pop();X.pop();break;default:if(ba[ea]!==
aa[ea])return!1}}}return!0}var Q=[];var X=[];return W(H,U)?!0:!1};N.getUriInfo=R;N.file={loadFileAPI:function(){var H=new h;H.resolve();return H},supportHTML5:function(){return window.File&&window.FileReader&&window.FileList&&window.Blob?!0:!1},supportFileAPI:function(){return n("safari")&&6>n("safari")?!1:window.FileAPI&&window.FileAPI.readAsDataURL?!0:!1},isEnabledFlash:function(){var H=null;if(document.all)try{H=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(U){H=null}else navigator.plugins&&
0<navigator.plugins.length&&(H=navigator.plugins["Shockwave Flash"]);return!!H},containSeparator:function(H){return 0<=H.indexOf("/")?!0:0<=H.indexOf("\\")?!0:!1},getNameFromPath:function(H){var U="";U=0<=H.indexOf("/")?"/":"\\";H=H.split(U);return 0<H.length?H[H.length-1]:null},getFolderFromPath:function(H){return H.substr(0,H.length-N.file.getNameFromPath(H).length)},readFile:function(H,U,W,Q){if(this.supportHTML5()){var X=H.target.files[0];X&&(X.type.match(U)?X.size>=W?Q({errCode:"exceed"}):(H=
new FileReader,H.onload=function(aa){Q(null,X.name,aa.target.result)},H.readAsDataURL(X)):Q({errCode:"invalidType"}))}else if(this.supportFileAPI()){var ba=window.FileAPI.getFiles(H);ba[0].type.match(U)?ba[0].size>=W?Q({errCode:"exceed"}):window.FileAPI.readAsDataURL(ba[0],function(aa){aa&&aa.result?Q(null,ba[0].name,aa.result):Q({errCode:"readError"})}):Q({errCode:"invalidType"})}}};N.processWidgetSetting=function(H){if(!H.uri)return H;a.mixin(H,R(H.uri));H.icon||(H.icon=H.amdFolder+"images/icon.png");
H.thumbnail||(H.thumbnail=H.amdFolder+"images/thumbnail.png");return H};N.getRequireConfig=function(){if(jimuConfig){var H=[];jimuConfig.widgetsPackage&&(H=H.concat(jimuConfig.widgetsPackage));jimuConfig.themesPackage&&(H=H.concat(jimuConfig.themesPackage));jimuConfig.configsPackage&&(H=H.concat(jimuConfig.configsPackage));return{packages:H}}return{}};N.getTypeByGeometryType=function(H){var U="",W="esriGeometryLine esriGeometryCircularArc esriGeometryEllipticArc esriGeometryBezier3Curve esriGeometryPath esriGeometryPolyline".split(" "),
Q=["esriGeometryRing","esriGeometryPolygon","esriGeometryEnvelope"];0<=["esriGeometryPoint","esriGeometryMultipoint"].indexOf(H)?U="point":0<=W.indexOf(H)?U="polyline":0<=Q.indexOf(H)&&(U="polygon");return U};N.getSymbolTypeByGeometryType=function(H){var U=null;H=N.getTypeByGeometryType(H);"point"===H?U="marker":"polyline"===H?U="line":"polygon"===H&&(U="fill");return U};N.getServices=function(){return V};N.restoreToDefaultWebMapExtent=function(H,U,W){var Q=new h;if(!H||"esri.Map"!==H.declaredClass)return setTimeout(function(){Q.reject("Invalid map.")},
0),Q;U=U&&U.itemInfo;if(!U)return setTimeout(function(){Q.reject("Invalid itemInfo")},0),Q;U=U.item&&U.item.extent;if(!U)return setTimeout(function(){Q.reject("Invalid itemInfo.item.extent")}),Q;var X=new w({wkid:4326});X=new z(U[0][0],U[0][1],U[1][0],U[1][1],X);if(4326===parseInt(H.spatialReference.wkid,10))return H.setExtent(X);if(H.spatialReference.isWebMercator)return X=C.geographicToWebMercator(X),H.setExtent(X);U=new E;U.geometries=[X];U.outSR=H.spatialReference;X=null;if(X=f&&f.defaults&&f.defaults.geometryServiceUrl&&
"string"===typeof f.defaults.geometryServiceUrl&&a.trim(f.defaults.geometryServiceUrl)?f.defaults.geometryServiceUrl:W&&"string"===typeof W&&a.trim(W)?W:N.getServices()&&N.getServices().geometryService)return X=a.trim(X),D.project(X,U).then(function(ba){if(ba=ba&&ba[0])return H.setExtent(ba);Q.reject("Invalid projected geometry.");return Q},function(ba){console.error(ba);Q.reject(ba);return Q}),Q};N.getAncestorWindow=function(){for(var H=window;H&&H.parent&&H!==H.parent;)H=H.parent;return H};N.getAncestorDom=
function(H,U,W){if(H&&1===H.nodeType&&U&&"function"===typeof U){var Q=100,X=document.body;W&&("number"===typeof W?(W=parseInt(W,10),0<W&&(Q=W)):1===W.nodeType&&(X=W));for(W=0;H.parentNode&&W<Q&&c.isDescendant(H.parentNode,X);){if(U(H.parentNode))return H.parentNode;H=H.parentNode;W++}}return null};N.bindClickAndDblclickEvents=function(H,U,W,Q){var X=null;if(H&&1===H.nodeType&&U&&"function"===typeof U&&W&&"function"===typeof W){var ba=200;Q&&"number"===typeof Q&&(Q=parseInt(Q,10),0<Q&&(ba=Q));var aa=
0;X=e(H,"click",function(ea){aa++;1===aa?setTimeout(function(){1===aa&&(aa=0,U(ea))},ba):2===aa&&(aa=0,W(ea))})}return X};N.isScrollToBottom=function(H){var U=c.getContentBox(H);return 1>H.scrollHeight-(H.scrollTop+U.h)};N.getAllItemTypes=function(){var H=[];H=H.concat(["Web Map","Web Scene","CityEngine Web Scene"]).concat("Feature Service;Map Service;Image Service;KML;WMS;Feature Collection;Feature Collection Template;Geodata Service;Globe Service".split(";")).concat(["Geometry Service","Geocoding Service",
"Network Analysis Service","Geoprocessing Service"]).concat(["Web Mapping Application","Mobile Application","Code Attachment","Operations Dashboard Add In","Operation View"]).concat("Symbol Set;Color Set;Shapefile;CSV;Service Definition;Document Link;Microsoft Word;Microsoft PowerPoint;Microsoft Excel;PDF;Image;Visio Document".split(";"));return H=H.concat("Map Document;Map Package;Tile Package;ArcPad Package;Explorer Map;Globe Document;Scene Document;Published Map;Map Template;Windows Mobile Package".split(";")).concat(["Layer",
"Layer Package","Explorer Layer"]).concat(["Geoprocessing Package","Geoprocessing Sample","Locator Package","Rule Package"]).concat("Workflow Manager Package;Desktop Application;Desktop Application Template;Code Sample;Desktop Add In;Explorer Add In".split(";"))};N.getItemQueryStringByTypes=function(H){var U="",W=N.getAllItemTypes();if(H&&0<H.length&&0<H.length){var Q="";b.forEach(H,function(X,ba){Q+=' type:"'+X+'" ';ba!==H.length-1&&(Q+=" OR ")});U=" ( "+Q+" ) ";W=H.concat(W);W=b.filter(W,function(X){return b.every(H,
function(ba){return 0>ba.toLowerCase().indexOf(X.toLowerCase())})});b.forEach(W,function(X){U+=' -type:"'+X+'" '})}return U};N.getItemQueryStringByTypeKeywords=function(H){var U="";H&&0<H.length&&(U=' typekeywords:"'+H.join(",")+'" ');return U};N.isNotEmptyString=function(H,U){var W=H&&"string"===typeof H;return W?U?W&&a.trim(H):!0:!1};N.isValidNumber=function(H){return"number"===typeof H&&!isNaN(H)};N.isObject=function(H){return H&&"object"===typeof H};N.getRandomString=function(){var H=Math.random().toString();
return H=H.slice(2,H.length)};N._getDomainsByServerName=function(H){var U=H.split("."),W=U.length;return b.map(U,a.hitch(this,function(Q,X){Q=U.slice(X,W);var ba="",aa=Q.length-1;b.forEach(Q,a.hitch(this,function(ea,ia){ba+=ea;ia!==aa&&(ba+=".")}));return ba}))};N.removeCookie=function(H,U){var W=this._getDomainsByServerName(window.location.hostname);b.forEach(W,a.hitch(this,function(Q){p(H,null,{expires:-1,path:U});p(H,null,{expires:-1,path:U,domain:Q});p(H,null,{expires:-1,path:U,domain:"."+Q})}))};
N.isLocaleChanged=function(H,U){return!H.startWith(U)};N.hashToObject=function(H){H=H.replace("#","");H=u.queryToObject(H);for(var U in H)if(H.hasOwnProperty(U))try{H[U]=g.parse(H[U])}catch(W){}return H};N.reCreateObject=function(H){function U(Q){var X=[];Q.forEach(function(ba){Array.isArray(ba)?X.push(U(ba)):"object"===typeof ba?X.push(W(ba)):X.push(ba)});return X}function W(Q){var X={},ba;for(ba in Q)Q.hasOwnProperty(ba)&&(null===Q[ba]?X[ba]=null:Array.isArray(Q[ba])?X[ba]=U(Q[ba]):X[ba]="object"===
typeof Q[ba]?W(Q[ba]):Q[ba]);return X}return Array.isArray(H)?U(H):W(H)};N.setVerticalCenter=function(H){setTimeout(function(){var U=v(".jimu-vcenter-text",H),W,Q;b.forEach(U,function(X){W=c.getContentBox(X).h;c.setStyle(X,{lineHeight:W+"px"})},this);U=v(".jimu-vcenter",H);b.forEach(U,function(X){W=c.getContentBox(X).h;Q=c.getContentBox(v(X).parent()[0]).h;c.setStyle(X,{marginTop:(Q-W)/2+"px"})},this)},10)};N.merge=L;N.loadStyleLink=function(H,U,W){var Q=new h,X=require(N.getRequireConfig()).toUrl(U);
if(require.cache["url:"+X]){var ba=require.cache["url:"+X];var aa=X.split("/").pop();X=X.substr(0,X.length-aa.length);ba=K(ba,X);H=W?c.create("style",{id:H,type:"text/css"},c.byId(W),"before"):c.create("style",{id:H,type:"text/css"},document.getElementsByTagName("head")[0]);H.styleSheet&&!H.sheet?H.styleSheet.cssText=ba:H.appendChild(c.toDom(ba));Q.resolve("load");return Q}ba=W?c.create("link",{id:H,rel:"stylesheet",type:"text/css",href:X},c.byId(W),"before"):c.create("link",{id:H,rel:"stylesheet",
type:"text/css",href:X},document.getElementsByTagName("head")[0]);e(ba,"load",function(){Q.resolve("load")});var ea=setInterval(function(){var ia;if(b.some(document.styleSheets,function(ka){if(ka.href&&ka.href.substr(ka.href.indexOf(U),ka.href.length)===U)return ia=ka,!0}))try{!Q.isFulfilled()&&(ia.cssRules&&ia.cssRules.length||ia.rules&&ia.rules.length)&&Q.resolve("load"),clearInterval(ea)}catch(ka){}},50);return Q};N.changeLocation=function(H){window.history.pushState&&window.history.pushState({path:H},
"",H)};N.urlToObject=function(H){var U=null;-1===H.indexOf("#")?(U=F.urlToObject(H),U.hash=null):(H=H.split("#"),U=F.urlToObject(H[0]),U.hash=H[1]?-1<H[1].indexOf("\x3d")?u.queryToObject(H[1]):H[1]:null);return U};N.addManifestProperies=function(H){H.icon=H.url+"images/icon.png";"theme"===H.category?M(H):("undefined"!==typeof H["2D"]&&(H.support2D=H["2D"]),"undefined"!==typeof H["3D"]&&(H.support3D=H["3D"]),"undefined"===typeof H["2D"]&&"undefined"===typeof H["3D"]&&(H.support2D=!0),delete H["2D"],
delete H["3D"],"undefined"===typeof H.properties&&(H.properties={}),O.processWidgetProperties(H))};N.getUniqueValues=function(H,U){var W=new h;H=H.replace(/\/*$/g,"")+"/generateRenderer";U=g.stringify({type:"uniqueValueDef",uniqueValueFields:[U]});G(H,{query:{classificationDef:U,f:"json"},responseType:"json",callbackParamName:"callback"}).then(a.hitch(this,function(Q){var X=Q.data;Q=[];(X=X&&X.uniqueValueInfos)&&0<X.length&&(Q=b.map(X,a.hitch(this,function(ba){return ba.value})));W.resolve(Q)}),a.hitch(this,
function(Q){W.reject(Q)}));return W};N.combineRadioCheckBoxWithLabel=function(H,U){var W=!1;if(H&&1===H.nodeType&&"input"===H.tagName.toLowerCase()){var Q=H.getAttribute("type")||"";Q=Q.toLowerCase();if("radio"===Q||"checkbox"===Q)W=!0}Q=!1;U&&1===U.nodeType&&"label"===U.tagName.toLowerCase()&&(Q=!0);W&&Q&&(W=H.getAttribute("id"),W||(W="input_"+N.getRandomString(),H.setAttribute("id",W)),U.setAttribute("for",W),c.setStyle(U,"cursor","pointer"))};N.convertExtentToPolygon=function(H){var U=H.xmin,W=
H.xmax,Q=H.ymin,X=H.ymax;return new B({rings:[[[U,X],[W,X],[W,Q],[U,Q],[U,X]]],spatialReference:H.toJson()})};N.combineGeometries=function(H){function U(la){var Z={points:[],spatialReference:la[0].spatialReference.toJson()};b.forEach(la,function(ca){Z.points=Z.points.concat(ca.points)});return new A(Z)}function W(la){var Z={paths:[],spatialReference:la[0].spatialReference.toJson()};b.forEach(la,function(ca){Z.paths=Z.paths.concat(ca.paths)});return new x(Z)}function Q(la){var Z={rings:[],spatialReference:la[0].spatialReference.toJson()};
b.forEach(la,function(ca){"polygon"===ca.type?Z.rings=Z.rings.concat(ca.rings):"extent"===ca.type&&(ca=N.convertExtentToPolygon(ca),Z.rings=Z.rings.concat(ca.rings))});return new B(Z)}var X=null;if(H&&0<H.length)if(1===H.length)X=H[0];else{for(var ba=null,aa=null,ea=null,ia=null,ka=0;ka<H.length;ka++){ba=H[ka];switch(ba.type){case "point":case "multipoint":ia="point";break;case "polyline":ia="polyline";break;case "polygon":case "extent":ia="polygon";break;default:return null}if(0===ka)ea=ia;else if(ea!==
ia)return null;if(ka!==H.length-1&&(aa=H[ka+1],!ba.spatialReference.equals(aa.spatialReference)))return null}"point"===ia?X=U(H):"polyline"===ia?X=W(H):"polygon"===ia&&(X=Q(H))}return X};N.isFeaturelayerUrlSupportQuery=function(H,U){var W=!1,Q=/\/featureserver\//gi.test(H);H=/\/mapserver\//gi.test(H);U=(U||"").toLowerCase();Q?W=0<=U.indexOf("query"):H&&(W=0<=U.indexOf("data"));return W};N.isImageServiceSupportQuery=function(H){return 0<=(H||"").toLowerCase().indexOf("catalog")};N.isStringEndWith=
function(H,U){return H.lastIndexOf(U)+U.length===H.length};N.processManifestLabel=function(H,U){var W=U.split("-")[0];H.label=H.i18nLabels&&(H.i18nLabels[U]||H.i18nLabels[W]||H.i18nLabels.defaultLabel)||H.label||H.name;H.layouts&&b.forEach(H.layouts,function(Q){var X="i18nLabels_layout_"+Q.name;Q.label=H[X]&&(H[X][U]||H[X].defaultLabel)||Q.label||Q.name});H.styles&&b.forEach(H.styles,function(Q){var X="i18nLabels_style_"+Q.name;Q.label=H[X]&&(H[X][U]||H[X].defaultLabel)||Q.label||Q.name})};N.addManifest2WidgetJson=
function(H,U){a.mixin(H,U.properties);H.name=U.name;H.label||(H.label=U.label);H.manifest=U};N.widgetJson=function(){var H={addManifest2WidgetJson:function(U,W){a.mixin(U,W.properties);U.name=W.name;U.label||(U.label=W.label);U.manifest=W;U.isRemote=W.isRemote;U.isRemote&&(U.itemId=W.itemId);W.featureActions&&(U.featureActions=W.featureActions);U.icon||(U.icon=W.icon);U.thumbnail||(U.thumbnail=W.thumbnail);U.folderUrl=W.folderUrl;U.amdFolder=W.amdFolder},removeManifestFromWidgetJson:function(U){if(U.manifest){for(var W in U.manifest.properties)U[W]=
void 0;U.name=void 0;U.label=void 0;U.featureActions=void 0;U.manifest=void 0}},getUriFromItem:function(U){return U.url?H.getFolderUrlFromItem(U)+"Widget":null},getFolderUrlFromItem:function(U){if(!U.url)return null;U=/manifest\.json$/.test(U.url)?U.url.substring(0,U.url.length-13):/\/$/.test(U.url)?U.url:U.url+"/";"https:"===window.location.protocol&&(U=U.replace(/^http:\/\//,"https://"));return U}};return H}();N.addI18NLabel=function(H){var U=new h;if(H.i18nLabels)return U.resolve(H),U;H.i18nLabels=
{};if(H.properties&&!1===H.properties.hasLocale)return U.resolve(H),U;var W="widget"===H.category?"_widgetLabel":"_themeLabel";require(N.getRequireConfig(),["dojo/i18n!"+H.amdFolder+"nls/strings"],function(Q){H.i18nLabels[dojoConfig.locale]=Q[W];"theme"===H.category&&(H.layouts&&H.layouts.forEach(function(X){H["i18nLabels_layout_"+X.name]={};H["i18nLabels_layout_"+X.name][dojoConfig.locale]=Q["_layout_"+X.name]}),H.styles&&H.styles.forEach(function(X){H["i18nLabels_style_"+X.name]={};H["i18nLabels_style_"+
X.name][dojoConfig.locale]=Q["_style_"+X.name]}));U.resolve(H)});return U};N.localizeNumber=function(H,U){var W=(H.toString().split(".")[1]||"").length,Q="";Q=U&&isFinite(U.places)&&U.places;Q=0<Q||0<W?"#,###,###,##0.0"+Array.prototype.join.call({length:0<Q?Q+1:W},"0"):"#,###,###,##0";W={locale:l.locale,pattern:Q};a.mixin(W,U||{});try{return t.format(H,W)}catch(X){return console.error(X),H.toLocaleString()}};N.parseNumber=function(H,U){var W={locale:l.locale};a.mixin(W,U||{});try{return t.parse(H,
W)}catch(Q){return console.error(Q),H}};N.localizeDate=function(H,U){var W={locale:l.locale,fullYear:!0};a.mixin(W,U||{});try{return q.format(H,W)}catch(Q){return console.error(Q),"date"===W.selector?H.toLocaleDateString():"time"===W.selector?H.toLocaleTimeString():H.toLocaleString()}};N.localizeNumberByFieldInfo=function(H,U){var W=null;W=a.exists("format.places",U)&&U.format.places;W=N.localizeNumber(H,{places:W});return a.exists("format.digitSeparator",U)&&!U.format.digitSeparator?W.toString().replace(new RegExp("\\"+
k.group,"g"),""):W};N.fieldFormatter={getFormattedUrl:function(H){if(H&&"string"===typeof H){var U=H.indexOf("http:");-1===U&&(U=H.indexOf("https:"));if(-1<U&&-1===H.indexOf("href\x3d")){var W=H.indexOf(" ",U);-1===W&&(W=H.length);var Q=H.substring(U,W);H=H.substring(0,U)+'\x3cA href\x3d"'+Q+'" target\x3d"_blank"\x3e'+Q+"\x3c/A\x3e"+H.substring(W,H.length)}}return H||""},getFormattedNumber:function(H,U){if("number"===typeof H){var W=(H.toString().split(".")[1]||"").length;H=N.localizeNumberByFieldInfo(H,
{format:{places:U&&"number"===typeof U.places?parseInt(U.places,10):W,digitSeparator:U&&U.digitSeparator}});return'\x3cspan class\x3d"jimu-numeric-value"\x3e'+(H||"")+"\x3c/span\x3e"}return H},getFormattedDate:function(H){H&&(H=N.localizeDate(new Date(H),{fullYear:!0}));return H||""},getCodedValue:function(H,U){if(H&&H.codedValues){for(var W=0,Q=H.codedValues.length;W<Q;W++){var X=H.codedValues[W];if(N.isDefined(U)&&a.exists("code",X)&&U.toString()===X.code.toString())return X.name}return U}return U||
null},getTypeName:function(H,U){for(var W=U.length,Q=0;Q<W;Q++)if(H===U[Q].id)return U[Q].name;return H}};N.addRelativePathInCss=K;N.url={isAbsolute:function(H){return H?H.startWith("http")||H.startWith("/"):!1},removeQueryParamFromUrl:function(H,U){H=F.urlToObject(H);H.query&&delete H.query[U];U=H.path;for(var W in H.query)U=U===H.path?U+"?"+W+"\x3d"+H.query[W]:U+"\x26"+W+"\x3d"+H.query[W];return U},addQueryParamToUrl:function(H,U,W){H=F.urlToObject(H);H.query||(H.query={});H.query[U]=W;U=H.path;
for(var Q in H.query)U=U===H.path?U+"?"+Q+"\x3d"+H.query[Q]:U+"\x26"+Q+"\x3d"+H.query[Q];return U}};N.processUrlInWidgetConfig=function(H,U){if(H)return H.startWith("data:")||H.startWith("http")||H.startWith("/")?H:H.startWith("${appPath}")?H.replace("${appPath}",window.appInfo.appPath):U+H};N.processUrlInAppConfig=function(H){if(H)return H.startWith("data:")||H.startWith("http")||H.startWith("/")?H:window.appInfo.appPath+H};N.getLocationUrlWithoutHashAndQueryParams=function(){var H=window.location,
U=H.protocol+"//"+H.host+H.pathname;H=F.urlToObject(H.href);H.query&&H.query.apiurl&&(U=N.url.addQueryParamToUrl(U,"apiurl",H.query.apiurl));return U};N.getDefaultWebMapThumbnail=function(){return require.toUrl("jimu/images/webmap.png")};N.invertColor=function(H){H=H.substring(1);3===H.length&&(H=H.slice(0,1)+H.slice(0,1)+H.slice(1,1)+H.slice(1,1)+H.slice(2,1)+H.slice(2,1));H=parseInt(H,16);return 7829367<H?"#000000":"#ffffff"};N.mixinAppConfigPosition=function(H,U){var W=a.clone(H);if(!U)return W;
U=a.clone(U);var Q=W.widgetOnScreen,X=U.widgetOnScreen;X&&X.widgets&&("[object Object]"===Object.prototype.toString.call(X.widgets)?b.forEach(Q.widgets,function(ba,aa){aa=ba.uri?ba.uri:"ph_"+aa;X.widgets[aa]&&X.widgets[aa].position&&(X.widgets[aa].position.relativeTo||(X.widgets[aa].position.relativeTo="map"),ba.position=X.widgets[aa].position)},this):b.forEach(X.widgets,function(ba,aa){ba.position&&!ba.position.relativeTo&&(ba.position.relativeTo="map");Q.widgets[aa]&&ba.position&&(Q.widgets[aa].position=
ba.position)}));X&&X.groups&&("[object Object]"===Object.prototype.toString.call(X.groups)?b.forEach(Q.groups,function(ba,aa){aa=ba.label?ba.label:"g_"+aa;X.groups[aa]&&X.groups[aa].panel&&X.groups[aa].panel.position&&(X.groups[aa].panel.position.relativeTo||(X.groups[aa].panel.position.relativeTo="map"),ba.panel.position=X.groups[aa].panel.position)},this):(H=H.layoutDefinition?H.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager","jimu/layoutManagers/AbsolutePositionLayoutManager"===
H?b.forEach(X.groups,function(ba,aa){ba.panel&&ba.panel.position&&!ba.panel.position.relativeTo&&(ba.panel.position.relativeTo="map");Q.groups[aa]&&ba.panel&&ba.panel.position&&(Q.groups[aa].panel.position=ba.panel.position)}):"jimu/layoutManagers/GridLayoutManager"===H&&(Q.groups=J(Q.groups,X.groups.map(function(ba){return ba.id})))));U.map&&U.map.position&&(W.map?W.map.position=U.map.position:W.map={position:U.map.position});U.widgetPool&&U.widgetPool.panel&&(U.widgetPool.panel.position&&!U.widgetPool.panel.position.relativeTo&&
(U.widgetPool.panel.position.relativeTo="map"),W.widgetPool.panel.position=U.widgetPool.panel.position);U.mobileLayout&&(W.mobileLayout=U.mobileLayout);return W};N.handleGridLayoutOnScreenGroupChange=J;N.template={groupIdentification:"groups\\[.+\\]",widgetIdentification:"widgets\\[.+\\]",getSearchRange:function(H,U,W){var Q=-1;U=H.search(new RegExp(U));0<=U&&(H=H.slice(U,H.length),H=H.indexOf(W),Q=U+H+W.length);return{firstPos:U,lastPos:Q}},setConfigValue:function(H,U,W){I(H,U,W)},getConfigValue:function(H,
U){return I(H,U)},setConfigValueWithId:function(H,U,W){P(H,U,W)},getConfigValueWithId:function(H,U){return P(H,U)},getKeyInfo:function(H){var U=this.getWidgetIdByKey(H);if(null!==U)return{type:"widget",id:U};H=this.getGroupIdByKey(H);return null!==H?{type:"group",id:H}:{type:"unknow",id:null}},getWidgetIdByKey:function(H){var U=N.template.getSearchRange(H,N.template.widgetIdentification,"]");if(-1===U.firstPos)H=null;else{var W=H.slice(U.firstPos,U.lastPos);H=H.slice(U.firstPos+W.indexOf("[")+1,U.lastPos-
1)}return H},getGroupIdByKey:function(H){var U=N.template.getSearchRange(H,N.template.groupIdentification,"]");if(-1===U.firstPos)H=null;else{var W=H.slice(U.firstPos,U.lastPos);H=H.slice(U.firstPos+W.indexOf("[")+1,U.lastPos-1)}return H},getConfigedWidgetsByTemplateConfig:function(H){var U=[],W=N.template.widgetIdentification+"_config",Q;b.forEach(H.configurationSettings,function(X){b.forEach(X.fields,function(ba){ba.fieldName&&(Q=N.template.getSearchRange(ba.fieldName,W,"]"),0<=Q.firstPos&&(ba=
N.template.getWidgetIdByKey(ba.fieldName),-1===U.indexOf(ba)&&U.push(ba)))},this)},this);return U},mergeTemplateAppConfigToAppConfig:function(H,U,W){function Q(ea){var ia=[];b.forEach(ea,function(ka){ka&&ia.push(ka)},this);return ia}var X=H.widgetOnScreen,ba=H.portalUrl;U.values.webmap&&(H.map.itemId=U.values.webmap);W&&(H.map.mapOptions&&N.deleteMapOptions(H.map.mapOptions),H.map.portalUrl=ba,U.values.app_title||(U.values.app_title=W.title),U.values.app_subtitle||(U.values.app_subtitle=W.snippet));
for(var aa in U.values)"webmap"!==aa&&N.template.setConfigValueWithId(H,aa,U.values[aa]);H.widgetPool.widgets=Q(H.widgetPool.widgets);X.widgets=Q(X.widgets);if(H.widgetPool.groups)for(U=0;U<H.widgetPool.groups.length;U++)H.widgetPool.groups[U].widgets=Q(H.widgetPool.groups[U].widgets);if(X.groups)for(U=0;U<X.groups.length;U++)X.groups[U].widgets=Q(X.groups[U].widgets);return H}};N.deleteMapOptions=function(H){H&&(delete H.extent,delete H.lods,delete H.center,delete H.scale,delete H.zoom,delete H.maxScale,
delete H.maxZoom,delete H.minScale,delete H.minZoom,delete H.initialState)};N.localeIsSame=function(H,U){return H.split("-")[0]===U.split("-")[0]};N.graphicsExtent=function(){return null};N.sanitizeHTML=function(H){return html_sanitize(H,function(U){return U},function(U){return U})};N.stripHTML=function(H){return H?-1<H.indexOf("\x3c")&&-1<H.indexOf("\x3e")?H.replace(/<(?:.|\s)*?>/g,""):H:H};N.removeSuffixSlashes=function(H){return H.replace(/\/*$/g,"")};N.getBestDisplayAttributes=function(H,U){var W=
{},Q=null,X;for(X in H)Q=N.getBestDisplayValue(X,H,U),W[X]=Q;return W};N.getBestDisplayValue=function(H,U,W){var Q="",X=null;a.isArrayLike(W)?X=N.getFieldInfoByFieldName(W,H):"object"===typeof W&&W.name===H&&(X=W);X&&(Q=U[H],"esriFieldTypeDate"===X.type?Q&&(H=new Date(parseInt(Q,10)),Q=N._tryLocaleDate(H)):"number"===typeof Q&&(X.domain&&"codedValue"===X.domain.type?b.some(X.domain.codedValues,function(ba){if(ba.code===Q)return Q=ba.name,!0}):Q=N._tryLocaleNumber(Q)));if(null===Q||void 0===Q)Q="";
return Q};N._tryLocaleNumber=function(H){var U=N.localizeNumber(H);if(null===U||void 0===U)U=H;return U};N._tryLocaleDate=function(H){var U=N.localizeDate(H);U||(U=H.toLocaleDateString());return U};N.getFieldInfoByFieldName=function(H,U){var W=null;H&&0<H.length&&b.some(H,a.hitch(this,function(Q){return Q.name===U?(W=Q,!0):!1}));return W};N.containsNonLatinCharacter=function(H){for(var U=0;U<H.length;U++)if(255<H.charCodeAt(U))return!0;return!1};N.isVersion4API=function(){return 0===y.version.indexOf("4")};
N.getEsriConfig=function(){return f};N.getEsriConfigRequestObject=function(){var H=null;return H=N.isVersion4API()?f.request:f.defaults.io};N.setGlobalGeometryService=function(H){N.isVersion4API()?f.geometryServiceUrl=H:f.defaults.geometryServiceUrl=H;return H};N.getQueryableFeatureLayersFromMap=function(H){var U=[];H.layers&&(U=H.layers.filter(function(W){return"esri.layers.FeatureLayer"===W.declaredClass&&W.url&&W.supportedQueryFormats&&0<=W.supportedQueryFormats.toUpperCase().indexOf("JSON")}));
return U};N.has=function(H){var U=n(H);if(U)return U;if("ie"===H.toLowerCase()){H=0;var W=/MSIE (\d+\.\d+);/.test(navigator.userAgent),Q=!!navigator.userAgent.match(/Trident\/7.0/),X=navigator.userAgent.indexOf("rv:11.0");W&&(H=Number(RegExp.$1));-1!==navigator.appVersion.indexOf("MSIE 10")&&(H=10);Q&&-1!==X&&(H=11);return 11===H&&11||U}if("edge"===H.toLowerCase())return navigator.userAgent.split("Edge/")[1]||U};N.detectUserAgent=function(){var H={},U={},W=navigator.userAgent,Q=navigator.platform,
X=W.match(/Web[kK]it[\/]{0,1}([\d.]+)/),ba=W.match(/(Android);?[\s\/]+([\d.]+)?/),aa=!!W.match(/\(Macintosh; Intel /),ea=W.match(/(iPad).*OS\s([\d_]+)/),ia=W.match(/(iPod)(.*OS\s([\d_]+))?/),ka=!ea&&W.match(/(iPhone\sOS)\s([\d_]+)/),la=W.match(/(webOS|hpwOS)[\s\/]([\d.]+)/);Q=/Win\d{2}|Windows/.test(Q);var Z=W.match(/Windows Phone ([\d.]+)/),ca=la&&W.match(/TouchPad/),Y=W.match(/Kindle\/([\d.]+)/),da=W.match(/Silk\/([\d._]+)/),ha=W.match(/(BlackBerry).*Version\/([\d.]+)/),ja=W.match(/(BB10).*Version\/([\d.]+)/),
ma=W.match(/(RIM\sTablet\sOS)\s([\d.]+)/),pa=W.match(/PlayBook/),na=W.match(/Chrome\/([\d.]+)/)||W.match(/CriOS\/([\d.]+)/),wa=W.match(/Firefox\/([\d.]+)/),xa=W.match(/\((?:Mobile|Tablet); rv:([\d.]+)\).*Firefox\/[\d.]+/),sa=W.match(/MSIE\s([\d.]+)/)||W.match(/Trident\/[\d](?=[^\?]+).*rv:([0-9.].)/),ya=!na&&W.match(/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/),ra=ya||W.match(/Version\/([\d.]+)([^S](Safari)|[^M]*(Mobile)[^S]*(Safari))/);U.webkit=!!X;U.webkit&&(U.version=X[1]);ba&&(H.android=!0,H.version=
ba[2]);ka&&!ia&&(H.ios=H.iphone=!0,H.version=ka[2].replace(/_/g,"."));ea&&(H.ios=H.ipad=!0,H.version=ea[2].replace(/_/g,"."));ia&&(H.ios=H.ipod=!0,H.version=ia[3]?ia[3].replace(/_/g,"."):null);Z&&(H.wp=!0,H.version=Z[1]);la&&(H.webos=!0,H.version=la[2]);ca&&(H.touchpad=!0);ha&&(H.blackberry=!0,H.version=ha[2]);ja&&(H.bb10=!0,H.version=ja[2]);ma&&(H.rimtabletos=!0,H.version=ma[2]);pa&&(U.playbook=!0);Y&&(H.kindle=!0,H.version=Y[1]);da&&(U.silk=!0,U.version=da[1]);!da&&H.android&&W.match(/Kindle Fire/)&&
(U.silk=!0);na&&(U.chrome=!0,U.version=na[1]);wa&&(U.firefox=!0,U.version=wa[1]);xa&&(H.firefoxos=!0,H.version=xa[1]);sa&&(U.ie=!0,U.version=sa[1]);ra&&(aa||H.ios||Q)&&(U.safari=!0,H.ios||(U.version=ra[1]));ya&&(U.webview=!0);H.tablet=!!(ea||pa||ba&&!W.match(/Mobile/)||wa&&W.match(/Tablet/)||sa&&!W.match(/Phone/)&&W.match(/Touch/));H.phone=!(H.tablet||H.ipod||!(ba||ka||la||ha||ja||na&&W.match(/Android/)||na&&W.match(/CriOS\/([\d.]+)/)||wa&&W.match(/Mobile/)||sa&&W.match(/Touch/)));return{os:H,browser:U}};
N.isMobileUa=function(){var H=N.detectUserAgent();return!0===H.os.phone||!0===H.os.tablet?!0:!1};N.isNeedHttpsButNot=function(){var H=navigator.geolocation,U=window.hasOwnProperty("isSecureContext");return(U&&window.isSecureContext||!U&&"https:"===window.location.protocol)&&H?!1:!0};N.isInConfigOrPreviewWindow=function(){var H=!1;try{H=!window.isBuilder&&window.parent&&window.parent!==window&&window.parent.isBuilder}catch(U){H=!1}return!!H};N.getAppHref=function(){var H="";return H=N.isInConfigOrPreviewWindow()?
window.parent.location.href:window.location.href};N.getAppIdFromUrl=function(){var H=!0,U=N.getAppHref();if(-1!==U.indexOf("id\x3d")||-1!==U.indexOf("appid\x3d")||-1!==U.indexOf("apps"))H=!1;if(!0===H)return U;H=this.urlToObject(window.location.href);if(H.query&&(H.query.id||H.query.appid))return H.query.id||H.query.appid;if(window.appInfo){if(window.appInfo.id)return window.appInfo.id;if(window.appInfo.appPath){if(H=window.appInfo.appPath.split("/"),H.length&&2<H.length)return H[H.length-2]}else console.error("CAN NOT getAppIdFromUrl")}};
N.getEditorContentHeight=function(H,U,W){var Q=new h;this._content=H;this._dom=U;this._domParam=W;var X=setTimeout(a.hitch(this,function(){clearTimeout(X);X=null;var ba=0,aa=this._domParam.contentWidth;try{var ea=document.createElement("div");ea.setAttribute("id","fakeContent");c.setStyle(ea,"background-size","contain");ea.innerHTML=this._content;this._dom.appendChild(ea);if(ea){var ia=v("img",ea);if(ia&&ia.length)for(var ka=0,la=ia.length;ka<la;ka++)c.setStyle(ia[ka],"maxWidth",aa-20+"px");c.setStyle(ea,
"position","absolute");c.setStyle(ea,"width",aa+"px");c.setStyle(ea,"left","-99999px");c.setStyle(ea,"top","-99999px");c.setStyle(ea,"visibility","hidden");var Z=c.getContentBox(ea);Z.h&&(ba=Z.h,ba+=this._domParam.contentMarginTop+this._domParam.footerHeight+8)}}catch(ca){console.error("can't getEditorContentHeight"+ca),ba=200}Q.resolve(ba)}),1500);return Q};N.getEditorTextColor=function(H,U){return{name:"dijit.editor.plugins.EditorTextColor",custom:{recordUID:N.getColorRecordName(H),forceAttr:U}}};
N.getEditorBackgroundColor=function(H){return{name:"dijit.editor.plugins.EditorBackgroundColor",custom:{recordUID:N.getColorRecordName(H)}}};N.getColorRecordName=function(H){return"wab_cr_"+(H||"")};N.isEsriDomain=function(H){return/^https?:\/\/(?:[\w\-_]+\.)+(?:esri|arcgis)\.com/.test(H)};N.b64toBlob=function(H,U,W){U=U||"";W=W||512;H=window.atob(H.replace(/^data:image\/(png|jpg|jpeg|gif);base64,/,""));for(var Q=[],X=0;X<H.length;X+=W){for(var ba=H.slice(X,X+W),aa=Array(ba.length),ea=0;ea<ba.length;ea++)aa[ea]=
ba.charCodeAt(ea);ba=new Uint8Array(aa);Q.push(ba)}return new Blob(Q,{type:U})};N.subtractionArray=function(H,U){for(var W=H.length-1;0<=W;W--)for(var Q=H[W],X=U.length-1;0<=X;X--)if(Q===U[X]){H.splice(W,1);U.splice(X,1);break}return H};N.resourcesUrlToBlob=function(H){return G({url:H,handleAs:"blob"})};N.processItemResourceOfAppConfig=function(H,U){function W(ia){var ka=ia.obj,la=ia.key,Z={obj:ka,key:la};"number"===typeof ia.i?(Z.i=ia.i,Z.value=ka[la][ia.i]):Z.value=ka[la];return Z}function Q(ia){for(var ka in ia)if("object"===
typeof ia[ka])if(Array.isArray(ia[ka]))for(var la=ia,Z=ka,ca=0;ca<la[Z].length;ca++)"string"===typeof la[Z][ca]?X(la,Z,ca):"object"===typeof la[Z][ca]&&Q(la[Z][ca]);else Q(ia[ka]);else"string"===typeof ia[ka]&&X(ia,ka)}function X(ia,ka,la){"number"===typeof la?U.test(ia[ka][la])&&(ea=U.func(W({obj:ia,key:ka,i:la})),"function"===typeof ea.then?aa.push(ea):ba.push(ea)):U.test(ia[ka])&&(ea=U.func(W({obj:ia,key:ka})),"function"===typeof ea.then?aa.push(ea):ba.push(ea))}var ba=[],aa=[],ea;Q(H);return 0<
aa.length?d(aa).then(function(ia){0<ba.length&&(ia=ia.concat(ba));return{appConfig:H,result:ia}}):{appConfig:H,result:ba}};N.isDefined=function(H){return void 0!==H&&null!==H};N.getDefaultPopupInfo=function(H,U,W){var Q=null;H&&H.fields&&(Q={title:U,fieldInfos:[],description:null,showAttachments:!0,mediaInfos:[]},b.forEach(H.fields,function(X){var ba=!1;W?b.some(W,a.hitch(this,function(aa){return aa&&X.name.toLowerCase()===aa.toLowerCase()}))&&(ba=!0):ba=!0;ba&&(ba=this.getDefaultPortalFieldInfo(X),
ba.visible=!0,ba.isEditable=X.editable,Q.fieldInfos.push(ba))},this));return Q};N.getDefaultPortalFieldInfo=function(H){var U=H.name;U={fieldName:U,label:H.alias||U,tooltip:"",visible:!1,format:null,stringFieldOption:"textbox"};switch(H.type){case "esriFieldTypeSmallInteger":case "esriFieldTypeInteger":U.format={places:0,digitSeparator:!0};break;case "esriFieldTypeSingle":case "esriFieldTypeDouble":U.format={places:2,digitSeparator:!0};break;case "esriFieldTypeDate":U.format={dateFormat:"longMonthDayYear"}}return U};
N.getStyleColorInTheme=function(H){var U=new h;if(window&&window.isBuilder){var W="./stemapp3d/themes/";var Q=window.appConfig}else W="./themes/",Q=window.getAppConfig();if(Q&&Q.theme.customStyles&&Q.theme.customStyles.mainBackgroundColor)return U.resolve(Q.theme.customStyles.mainBackgroundColor),U.promise;var X=Q.theme.name,ba=Q.theme.styles[0];H&&(ba=H);G(W+X+"/manifest.json",{responseType:"json"}).then(a.hitch(this,function(aa){if(aa&&aa.data){aa=aa.data.styles;for(var ea=0;ea<aa.length;ea++){var ia=
aa[ea];ia.name===ba&&U.resolve(ia.styleColor)}}}),a.hitch(this,function(aa){console.error(aa);U.reject(null)}));return U.promise};return N})},"dojo/NodeList-traverse":function(){define(["./query","./_base/lang","./_base/array"],function(a,b,c){var n=a.NodeList;b.extend(n,{_buildArrayFromCallback:function(l){for(var u=[],v=0;v<this.length;v++){var m=l.call(this[v],this[v],u);m&&(u=u.concat(m))}return u},_getUniqueAsNodeList:function(l){for(var u=[],v=0,m;m=l[v];v++)1==m.nodeType&&-1==c.indexOf(u,m)&&
u.push(m);return this._wrap(u,null,this._NodeListCtor)},_getUniqueNodeListWithParent:function(l,u){l=this._getUniqueAsNodeList(l);l=u?a._filterResult(l,u):l;return l._stash(this)},_getRelatedUniqueNodes:function(l,u){return this._getUniqueNodeListWithParent(this._buildArrayFromCallback(u),l)},children:function(l){return this._getRelatedUniqueNodes(l,function(u,v){return b._toArray(u.childNodes)})},closest:function(l,u){return this._getRelatedUniqueNodes(null,function(v,m){do if(a._filterResult([v],
l,u).length)return v;while(v!=u&&(v=v.parentNode)&&1==v.nodeType);return null})},parent:function(l){return this._getRelatedUniqueNodes(l,function(u,v){return u.parentNode})},parents:function(l){return this._getRelatedUniqueNodes(l,function(u,v){for(v=[];u.parentNode;)u=u.parentNode,v.push(u);return v})},siblings:function(l){return this._getRelatedUniqueNodes(l,function(u,v){v=[];for(var m=u.parentNode&&u.parentNode.childNodes,h=0;h<m.length;h++)m[h]!=u&&v.push(m[h]);return v})},next:function(l){return this._getRelatedUniqueNodes(l,
function(u,v){for(u=u.nextSibling;u&&1!=u.nodeType;)u=u.nextSibling;return u})},nextAll:function(l){return this._getRelatedUniqueNodes(l,function(u,v){for(v=[];u=u.nextSibling;)1==u.nodeType&&v.push(u);return v})},prev:function(l){return this._getRelatedUniqueNodes(l,function(u,v){for(u=u.previousSibling;u&&1!=u.nodeType;)u=u.previousSibling;return u})},prevAll:function(l){return this._getRelatedUniqueNodes(l,function(u,v){for(v=[];u=u.previousSibling;)1==u.nodeType&&v.push(u);return v})},andSelf:function(){return this.concat(this._parent)},
first:function(){return this._wrap(this[0]&&[this[0]]||[],this)},last:function(){return this._wrap(this.length?[this[this.length-1]]:[],this)},even:function(){return this.filter(function(l,u){return 0!=u%2})},odd:function(){return this.filter(function(l,u){return 0==u%2})}});return n})},"dojo/promise/all":function(){define(["../_base/array","../_base/lang","../Deferred","../when"],function(a,b,c,n){var l=a.some;return function(u){var v,m;b.isArray(u)?m=u:u&&"object"===typeof u&&(v=u);var h=[];if(v){m=
[];for(var d in v)Object.hasOwnProperty.call(v,d)&&(h.push(d),m.push(v[d]));var e={}}else m&&(e=[]);if(!m||!m.length)return(new c).resolve(e);var g=new c;g.promise.always(function(){e=h=null});var p=m.length;l(m,function(t,q){v||h.push(q);n(t,function(k){g.isFulfilled()||(e[h[q]]=k,0===--p&&g.resolve(e))},g.reject);return g.isFulfilled()});return g.promise}})},"dojo/cookie":function(){define(["./_base/kernel","./regexp"],function(a,b){a.cookie=function(c,n,l){var u=document.cookie;if(1==arguments.length)var v=
(v=u.match(new RegExp("(?:^|; )"+b.escapeString(c)+"\x3d([^;]*)")))?decodeURIComponent(v[1]):void 0;else{l=l||{};u=l.expires;if("number"==typeof u){var m=new Date;m.setTime(m.getTime()+864E5*u);u=l.expires=m}u&&u.toUTCString&&(l.expires=u.toUTCString());n=encodeURIComponent(n);u=c+"\x3d"+n;for(var h in l)u+="; "+h,m=l[h],!0!==m&&(u+="\x3d"+m);document.cookie=u}return v};a.cookie.isSupported=function(){"cookieEnabled"in navigator||(this("__djCookieTest__","CookiesAllowed"),navigator.cookieEnabled=
"CookiesAllowed"==this("__djCookieTest__"),navigator.cookieEnabled&&this("__djCookieTest__","",{expires:-1}));return navigator.cookieEnabled};return a.cookie})},"dojo/regexp":function(){define(["./_base/kernel","./_base/lang"],function(a,b){var c={};b.setObject("dojo.regexp",c);c.escapeString=function(n,l){return n.replace(/([\.$?*|{}\(\)\[\]\\\/\+\-^])/g,function(u){return l&&-1!=l.indexOf(u)?u:"\\"+u})};c.buildGroupRE=function(n,l,u){if(!(n instanceof Array))return l(n);for(var v=[],m=0;m<n.length;m++)v.push(l(n[m]));
return c.group(v.join("|"),u)};c.group=function(n,l){return"("+(l?"?:":"")+n+")"};return c})},"dojo/number":function(){define(["./_base/lang","./i18n","./i18n!./cldr/nls/number","./string","./regexp"],function(a,b,c,n,l){var u={};a.setObject("dojo.number",u);u.format=function(m,h){h=a.mixin({},h||{});var d=b.normalizeLocale(h.locale);d=b.getLocalization("dojo.cldr","number",d);h.customs=d;d=h.pattern||d[(h.type||"decimal")+"Format"];return isNaN(m)||Infinity==Math.abs(m)?null:u._applyPattern(m,d,
h)};u._numberPatternRE=/[#0,]*[#0](?:\.0*#*)?/;u._applyPattern=function(m,h,d){d=d||{};var e=d.customs.group,g=d.customs.decimal;h=h.split(";");var p=h[0];h=h[0>m?1:0]||"-"+p;if(-1!=h.indexOf("%"))m*=100;else if(-1!=h.indexOf("\u2030"))m*=1E3;else if(-1!=h.indexOf("\u00a4"))e=d.customs.currencyGroup||e,g=d.customs.currencyDecimal||g,h=h.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/,function(q,k,r,y){return(q=d[["symbol","currency","displayName"][r.length-1]]||d.currency||"")?k+q+y:""});
else if(-1!=h.indexOf("E"))throw Error("exponential notation not supported");var t=u._numberPatternRE;p=p.match(t);if(!p)throw Error("unable to find a number expression in pattern: "+h);!1===d.fractional&&(d.places=0);return h.replace(t,u._formatAbsolute(m,p[0],{decimal:g,group:e,places:d.places,round:d.round}))};u.round=function(m,h,d){d=10/(d||10);return(d*+m).toFixed(h)/d};if(0==(.9).toFixed()){var v=u.round;u.round=function(m,h,d){var e=Math.pow(10,-h||0),g=Math.abs(m);if(!m||g>=e)e=0;else if(g/=
e,.5>g||.95<=g)e=0;return v(m,h,d)+(0<m?e:-e)}}u._formatAbsolute=function(m,h,d){d=d||{};!0===d.places&&(d.places=0);Infinity===d.places&&(d.places=6);h=h.split(".");var e="string"==typeof d.places&&d.places.indexOf(","),g=d.places;e?g=d.places.substring(e+1):0<=g||(g=(h[1]||[]).length);0>d.round||(m=u.round(m,g,d.round));m=String(Math.abs(m)).split(".");var p=m[1]||"";h[1]||d.places?(e&&(d.places=d.places.substring(0,e)),e=void 0!==d.places?d.places:h[1]&&h[1].lastIndexOf("0")+1,e>p.length&&(m[1]=
n.pad(p,e,"0",!0)),g<p.length&&(m[1]=p.substr(0,g))):m[1]&&m.pop();g=h[0].replace(",","");e=g.indexOf("0");-1!=e&&(e=g.length-e,e>m[0].length&&(m[0]=n.pad(m[0],e)),-1==g.indexOf("#")&&(m[0]=m[0].substr(m[0].length-e)));g=h[0].lastIndexOf(",");var t;if(-1!=g){var q=h[0].length-g-1;h=h[0].substr(0,g);g=h.lastIndexOf(",");-1!=g&&(t=h.length-g-1)}h=[];for(g=m[0];g;)e=g.length-q,h.push(0<e?g.substr(e):g),g=0<e?g.slice(0,e):"",t&&(q=t,t=void 0);m[0]=h.reverse().join(d.group||",");return m.join(d.decimal||
".")};u.regexp=function(m){return u._parseInfo(m).regexp};u._parseInfo=function(m){m=m||{};var h=b.normalizeLocale(m.locale);h=b.getLocalization("dojo.cldr","number",h);var d=m.pattern||h[(m.type||"decimal")+"Format"],e=h.group,g=h.decimal,p=1;if(-1!=d.indexOf("%"))p/=100;else if(-1!=d.indexOf("\u2030"))p/=1E3;else{var t=-1!=d.indexOf("\u00a4");t&&(e=h.currencyGroup||e,g=h.currencyDecimal||g)}h=d.split(";");1==h.length&&h.push("-"+h[0]);h=l.buildGroupRE(h,function(q){q="(?:"+l.escapeString(q,".")+
")";return q.replace(u._numberPatternRE,function(k){var r={signed:!1,separator:m.strict?e:[e,""],fractional:m.fractional,decimal:g,exponent:!1};k=k.split(".");var y=m.places;1==k.length&&1!=p&&(k[1]="###");1==k.length||0===y?r.fractional=!1:(void 0===y&&(y=m.pattern?k[1].lastIndexOf("0")+1:Infinity),y&&void 0==m.fractional&&(r.fractional=!0),!m.places&&y<k[1].length&&(y+=","+k[1].length),r.places=y);k=k[0].split(",");1<k.length&&(r.groupSize=k.pop().length,1<k.length&&(r.groupSize2=k.pop().length));
return"("+u._realNumberRegexp(r)+")"})},!0);t&&(h=h.replace(/([\s\xa0\u202f]*)(\u00a4{1,3})([\s\xa0\u202f]*)/g,function(q,k,r,y){q=l.escapeString(m[["symbol","currency","displayName"][r.length-1]]||m.currency||"");if(!q)return"";k=k?"[\\s\\xa0\\u202f]":"";y=y?"[\\s\\xa0\\u202f]":"";return m.strict?k+q+y:(k&&(k+="*"),y&&(y+="*"),"(?:"+k+q+y+")?")}));return{regexp:h.replace(/[\xa0\u202f ]/g,"[\\s\\xa0\\u202f]"),group:e,decimal:g,factor:p}};u.parse=function(m,h){h=u._parseInfo(h);m=(new RegExp("^"+h.regexp+
"$")).exec(m);if(!m)return NaN;var d=m[1];if(!m[1]){if(!m[2])return NaN;d=m[2];h.factor*=-1}d=d.replace(new RegExp("["+h.group+"\\s\\xa0\\u202f]","g"),"").replace(h.decimal,".");return d*h.factor};u._realNumberRegexp=function(m){m=m||{};"places"in m||(m.places=Infinity);"string"!=typeof m.decimal&&(m.decimal=".");"fractional"in m&&!/^0/.test(m.places)||(m.fractional=[!0,!1]);"exponent"in m||(m.exponent=[!0,!1]);"eSigned"in m||(m.eSigned=[!0,!1]);var h=u._integerRegexp(m),d=l.buildGroupRE(m.fractional,
function(g){var p="";g&&0!==m.places&&(p="\\"+m.decimal,p=Infinity==m.places?"(?:"+p+"\\d+)?":p+("\\d{"+m.places+"}"));return p},!0),e=l.buildGroupRE(m.exponent,function(g){return g?"([eE]"+u._integerRegexp({signed:m.eSigned})+")":""});h+=d;d&&(h="(?:(?:"+h+")|(?:"+d+"))");return h+e};u._integerRegexp=function(m){m=m||{};"signed"in m||(m.signed=[!0,!1]);"separator"in m?"groupSize"in m||(m.groupSize=3):m.separator="";var h=l.buildGroupRE(m.signed,function(e){return e?"[-+]":""},!0),d=l.buildGroupRE(m.separator,
function(e){if(!e)return"(?:\\d+)";e=l.escapeString(e);" "==e?e="\\s":"\u00a0"==e?e="\\s\\xa0":"\u202f"==e&&(e="\\s\\u202f");var g=m.groupSize,p=m.groupSize2;return p?(e="(?:0|[1-9]\\d{0,"+(p-1)+"}(?:["+e+"]\\d{"+p+"})*["+e+"]\\d{"+g+"})",0<g-p?"(?:"+e+"|(?:0|[1-9]\\d{0,"+(g-1)+"}))":e):"(?:0|[1-9]\\d{0,"+(g-1)+"}(?:["+e+"]\\d{"+g+"})*)"},!0);return h+d};return u})},"dojo/i18n":function(){define("./_base/kernel require ./has ./_base/array ./_base/config ./_base/lang ./has!host-browser?./_base/xhr ./json module".split(" "),
function(a,b,c,n,l,u,v,m,h){c.add("dojo-preload-i18n-Api",1);v=a.i18n={};var d=/(^.*(^|\/)nls)(\/|$)([^\/]*)\/?([^\/]*)/,e=function(B,C,D,E){var F=[D+E];C=C.split("-");for(var G="",O=0;O<C.length;O++)if(G+=(G?"-":"")+C[O],!B||B[G])F.push(D+G+"/"+E),F.specificity=G;return F},g={},p=function(B,C,D){D=D?D.toLowerCase():a.locale;B=B.replace(/\./g,"/");C=C.replace(/\./g,"/");return/root/i.test(D)?B+"/nls/"+C:B+"/nls/"+D+"/"+C},t=a.getL10nName=function(B,C,D){return B=h.id+"!"+p(B,C,D)},q=function(B,C,
D,E,F,G){B([C],function(O){var K=u.clone(O.root||O.ROOT),L=e(!O._v1x&&O,F,D,E);B(L,function(){for(var R=1;R<L.length;R++)K=u.mixin(u.clone(K),arguments[R]);g[C+"/"+F]=K;K.$locale=L.specificity;G()})})},k=function(B){var C=l.extraLocale||[];C=u.isArray(C)?C:[C];C.push(B);return C},r=function(B,C,D){var E=d.exec(B),F=E[1]+"/",G=E[5]||E[4],O=F+G,K=(E=E[5]&&E[4])||a.locale||"",L=O+"/"+K;E=E?[K]:k(K);var R=E.length,M=function(){--R||D(u.delegate(g[L]))};K=B.split("*");var J="preload"==K[1];if(c("dojo-preload-i18n-Api")){if(J&&
(g[B]||(g[B]=1,z(K[2],m.parse(K[3]),1,C)),D(1)),(K=J)||(f&&w.push([B,C,D]),K=f&&!g[L]),K)return}else if(J){D(1);return}n.forEach(E,function(I){var P=O+"/"+I;c("dojo-preload-i18n-Api")&&A(P);g[P]?M():q(C,O,F,G,I,M)})};c("dojo-preload-i18n-Api");var y=v.normalizeLocale=function(B){B=B?B.toLowerCase():a.locale;return"root"==B?"ROOT":B},f=0,w=[],z=v._preloadLocalizations=function(B,C,D,E){function F(L,R){E([L],R)}function G(L,R){for(L=L.split("-");L.length;){if(R(L.join("-")))return;L.pop()}R("ROOT")}
function O(){for(--f;!f&&w.length;)r.apply(null,w.shift())}function K(L){L=y(L);G(L,function(R){if(0<=n.indexOf(C,R)){var M=B.replace(/\./g,"/")+"_"+R;f++;F(M,function(J){for(var I in J){var P=J[I],N=I.match(/(.+)\/([^\/]+)$/);if(N){var V=N[2];N=N[1]+"/";if(P._localized){var S;if("ROOT"===R){var T=S=P._localized;delete P._localized;T.root=P;g[b.toAbsMid(I)]=T}else S=P._localized,g[b.toAbsMid(N+V+"/"+R)]=P;R!==L&&function(H,U,W,Q){var X=[],ba=[];G(L,function(aa){Q[aa]&&(X.push(b.toAbsMid(H+aa+"/"+
U)),ba.push(b.toAbsMid(H+U+"/"+aa)))});X.length?(f++,E(X,function(){for(var aa=X.length-1;0<=aa;aa--)W=u.mixin(u.clone(W),arguments[aa]),g[ba[aa]]=W;g[b.toAbsMid(H+U+"/"+L)]=u.clone(W);O()})):g[b.toAbsMid(H+U+"/"+L)]=W}(N,V,P,S)}}}O()});return!0}return!1})}E=E||b;K();n.forEach(a.config.extraLocale,K)},A=function(){},x={};A=function(B){for(var C,D=B.split("/"),E=a.global[D[0]],F=1;E&&F<D.length-1;E=E[D[F++]]);E&&((C=E[D[F]])||(C=E[D[F].replace(/-/g,"_")]),C&&(g[B]=C));return C};v.getLocalization=function(B,
C,D){var E,F=p(B,C,D);if(x[F])return x[F];r(F,b,function(G){E=x[F]=G});return E};return u.mixin(v,{dynamic:!0,normalize:function(B,C){return/^\./.test(B)?C(B):B},load:r,cache:g,getL10nName:t})})},"dojo/date/locale":function(){define("../_base/lang ../_base/array ../date ../cldr/supplemental ../i18n ../regexp ../string ../i18n!../cldr/nls/gregorian module".split(" "),function(a,b,c,n,l,u,v,m,h){function d(r,y,f,w){return w.replace(/([a-z])\1*/ig,function(z){var A=z.charAt(0);z=z.length;var x=["abbr",
"wide","narrow"];switch(A){case "G":var B=y[4>z?"eraAbbr":"eraNames"][0>r.getFullYear()?0:1];break;case "y":B=r.getFullYear();switch(z){case 1:break;case 2:if(!f.fullYear){B=String(B);B=B.substr(B.length-2);break}default:var C=!0}break;case "Q":case "q":B=Math.ceil((r.getMonth()+1)/3);C=!0;break;case "M":case "L":B=r.getMonth();3>z?(B+=1,C=!0):(A=["months","L"==A?"standAlone":"format",x[z-3]].join("-"),B=y[A][B]);break;case "w":B=p._getWeekOfYear(r,0);C=!0;break;case "d":B=r.getDate();C=!0;break;
case "D":B=p._getDayOfYear(r);C=!0;break;case "e":case "c":if(B=r.getDay(),2>z){B=(B-n.getFirstDayOfWeek(f.locale)+8)%7;break}case "E":B=r.getDay();3>z?(B+=1,C=!0):(A=["days","c"==A?"standAlone":"format",x[z-3]].join("-"),B=y[A][B]);break;case "a":A=12>r.getHours()?"am":"pm";B=f[A]||y["dayPeriods-format-wide-"+A];break;case "h":case "H":case "K":case "k":C=r.getHours();switch(A){case "h":B=C%12||12;break;case "H":B=C;break;case "K":B=C%12;break;case "k":B=C||24}C=!0;break;case "m":B=r.getMinutes();
C=!0;break;case "s":B=r.getSeconds();C=!0;break;case "S":B=Math.round(r.getMilliseconds()*Math.pow(10,z-3));C=!0;break;case "v":case "z":if(B=p._getZone(r,!0,f))break;z=4;case "Z":A=p._getZone(r,!1,f);A=[0>=A?"+":"-",v.pad(Math.floor(Math.abs(A)/60),2),v.pad(Math.abs(A)%60,2)];4==z&&(A.splice(0,0,"GMT"),A.splice(3,0,":"));B=A.join("");break;default:throw Error("dojo.date.locale.format: invalid pattern char: "+w);}C&&(B=v.pad(B,z));return B})}function e(r,y,f,w){var z=function(B){return B};y=y||z;
f=f||z;w=w||z;var A=r.match(/(''|[^'])+/g),x="'"==r.charAt(0);b.forEach(A,function(B,C){B?(A[C]=(x?f:y)(B.replace(/''/g,"'")),x=!x):A[C]=""});return w(A.join(""))}function g(r,y,f,w){w=u.escapeString(w);f.strict||(w=w.replace(" a"," ?a"));return w.replace(/([a-z])\1*/ig,function(z){var A=z.charAt(0);var x=z.length,B="",C="";f.strict?(1<x&&(B="0{"+(x-1)+"}"),2<x&&(C="0{"+(x-2)+"}")):(B="0?",C="0{0,2}");switch(A){case "y":A="\\d{2,4}";break;case "M":case "L":2<x?(A=y["months-"+("L"==A?"standAlone":
"format")+"-"+t[x-3]].slice(0).join("|"),f.strict||(A=A.replace(/\./g,""),A="(?:"+A+")\\.?")):A="1[0-2]|"+B+"[1-9]";break;case "D":A="[12][0-9][0-9]|3[0-5][0-9]|36[0-6]|"+B+"[1-9][0-9]|"+C+"[1-9]";break;case "d":A="3[01]|[12]\\d|"+B+"[1-9]";break;case "w":A="[1-4][0-9]|5[0-3]|"+B+"[1-9]";break;case "E":case "e":case "c":A=".+?";break;case "h":A="1[0-2]|"+B+"[1-9]";break;case "k":A="1[01]|"+B+"\\d";break;case "H":A="1\\d|2[0-3]|"+B+"\\d";break;case "K":A="1\\d|2[0-4]|"+B+"[1-9]";break;case "m":case "s":A=
"[0-5]\\d";break;case "S":A="\\d{"+x+"}";break;case "a":x=f.am||y["dayPeriods-format-wide-am"];B=f.pm||y["dayPeriods-format-wide-pm"];A=x+"|"+B;f.strict||(x!=x.toLowerCase()&&(A+="|"+x.toLowerCase()),B!=B.toLowerCase()&&(A+="|"+B.toLowerCase()),-1!=A.indexOf(".")&&(A+="|"+A.replace(/\./g,"")));A=A.replace(/\./g,"\\.");break;default:A=".*"}r&&r.push(z);return"("+A+")"}).replace(/[\xa0 ]/g,"[\\s\\xa0]")}var p={};a.setObject(h.id.replace(/\//g,"."),p);p._getZone=function(r,y,f){return y?c.getTimezoneName(r):
r.getTimezoneOffset()};p.format=function(r,y){y=y||{};var f=l.normalizeLocale(y.locale),w=y.formatLength||"short";f=p._getGregorianBundle(f);var z=[];r=a.hitch(this,d,r,f,y);if("year"==y.selector)return e(f["dateFormatItem-yyyy"]||"yyyy",r);var A;"date"!=y.selector&&(A=y.timePattern||f["timeFormat-"+w])&&z.push(e(A,r));"time"!=y.selector&&(A=y.datePattern||f["dateFormat-"+w])&&z.push(e(A,r));return 1==z.length?z[0]:f["dateTimeFormat-"+w].replace(/'/g,"").replace(/\{(\d+)\}/g,function(x,B){return z[B]})};
p.regexp=function(r){return p._parseInfo(r).regexp};p._parseInfo=function(r){r=r||{};var y=l.normalizeLocale(r.locale);y=p._getGregorianBundle(y);var f=r.formatLength||"short",w=r.datePattern||y["dateFormat-"+f],z=r.timePattern||y["timeFormat-"+f];f="date"==r.selector?w:"time"==r.selector?z:y["dateTimeFormat-"+f].replace(/\{(\d+)\}/g,function(x,B){return[z,w][B]});var A=[];return{regexp:e(f,a.hitch(this,g,A,y,r)),tokens:A,bundle:y}};p.parse=function(r,y){var f=/[\u200E\u200F\u202A\u202E]/g,w=p._parseInfo(y),
z=w.tokens,A=w.bundle;r=(new RegExp("^"+w.regexp.replace(f,"")+"$",w.strict?"":"i")).exec(r&&r.replace(f,""));if(!r)return null;var x=["abbr","wide","narrow"],B=[1970,0,1,0,0,0,0],C="";r=b.every(r,function(E,F){if(!F)return!0;var G=z[F-1];F=G.length;G=G.charAt(0);switch(G){case "y":if(2!=F&&y.strict)B[0]=E;else if(100>E)E=Number(E),G=""+(new Date).getFullYear(),F=100*G.substring(0,2),G=Math.min(Number(G.substring(2,4))+20,99),B[0]=E<G?F+E:F-100+E;else{if(y.strict)return!1;B[0]=E}break;case "M":case "L":if(2<
F){if(F=A["months-"+("L"==G?"standAlone":"format")+"-"+x[F-3]].concat(),y.strict||(E=E.replace(".","").toLowerCase(),F=b.map(F,function(K){return K.replace(".","").toLowerCase()})),E=b.indexOf(F,E),-1==E)return!1}else E--;B[1]=E;break;case "E":case "e":case "c":F=A["days-"+("c"==G?"standAlone":"format")+"-"+x[F-3]].concat();y.strict||(E=E.toLowerCase(),F=b.map(F,function(K){return K.toLowerCase()}));E=b.indexOf(F,E);if(-1==E)return!1;break;case "D":B[1]=0;case "d":B[2]=E;break;case "a":F=y.am||A["dayPeriods-format-wide-am"];
G=y.pm||A["dayPeriods-format-wide-pm"];if(!y.strict){var O=/\./g;E=E.replace(O,"").toLowerCase();F=F.replace(O,"").toLowerCase();G=G.replace(O,"").toLowerCase()}if(y.strict&&E!=F&&E!=G)return!1;C=E==G?"p":E==F?"a":"";break;case "K":24==E&&(E=0);case "h":case "H":case "k":if(23<E)return!1;B[3]=E;break;case "m":B[4]=E;break;case "s":B[5]=E;break;case "S":B[6]=E}return!0});f=+B[3];"p"===C&&12>f?B[3]=f+12:"a"===C&&12==f&&(B[3]=0);f=new Date(B[0],B[1],B[2],B[3],B[4],B[5],B[6]);y.strict&&f.setFullYear(B[0]);
var D=z.join("");w=-1!=D.indexOf("d");D=-1!=D.indexOf("M");if(!r||D&&f.getMonth()>B[1]||w&&f.getDate()>B[2])return null;if(D&&f.getMonth()<B[1]||w&&f.getDate()<B[2])f=c.add(f,"hour",1);return f};var t=["abbr","wide","narrow"],q=[],k={};p.addCustomFormats=function(r,y){q.push({pkg:r,name:y});k={}};p._getGregorianBundle=function(r){if(k[r])return k[r];var y={};b.forEach(q,function(f){f=l.getLocalization(f.pkg,f.name,r);y=a.mixin(y,f)},this);return k[r]=y};p.addCustomFormats(h.id.replace(/\/date\/locale$/,
".cldr"),"gregorian");p.getNames=function(r,y,f,w){w=p._getGregorianBundle(w);r=[r,f,y];if("standAlone"==f){f=r.join("-");var z=w[f];1==z[0]&&(z=void 0)}r[1]="format";return(z||w[r.join("-")]).concat()};p.isWeekend=function(r,y){y=n.getWeekend(y);r=(r||new Date).getDay();y.end<y.start&&(y.end+=7,r<y.start&&(r+=7));return r>=y.start&&r<=y.end};p._getDayOfYear=function(r){return c.difference(new Date(r.getFullYear(),0,1,r.getHours()),r)+1};p._getWeekOfYear=function(r,y){1==arguments.length&&(y=0);var f=
(new Date(r.getFullYear(),0,1)).getDay(),w=(f-y+7)%7;w=Math.floor((p._getDayOfYear(r)+w-1)/7);f==y&&w++;return w};return p})},"dojo/date":function(){define(["./has","./_base/lang"],function(a,b){var c={getDaysInMonth:function(n){var l=n.getMonth();return 1==l&&c.isLeapYear(n)?29:[31,28,31,30,31,30,31,31,30,31,30,31][l]},isLeapYear:function(n){n=n.getFullYear();return!(n%400)||!(n%4)&&!!(n%100)},getTimezoneName:function(n){var l=n.toString(),u="",v=l.indexOf("(");if(-1<v)u=l.substring(++v,l.indexOf(")"));
else if(v=/([A-Z\/]+) \d{4}$/,l=l.match(v))u=l[1];else if(l=n.toLocaleString(),v=/ ([A-Z\/]+)$/,l=l.match(v))u=l[1];return"AM"==u||"PM"==u?"":u},compare:function(n,l,u){n=new Date(+n);l=new Date(+(l||new Date));"date"==u?(n.setHours(0,0,0,0),l.setHours(0,0,0,0)):"time"==u&&(n.setFullYear(0,0,0),l.setFullYear(0,0,0));return n>l?1:n<l?-1:0},add:function(n,l,u){var v=new Date(+n),m=!1,h="Date";switch(l){case "day":break;case "weekday":if(l=u%5)var d=parseInt(u/5);else l=0<u?5:-5,d=0<u?(u-5)/5:(u+5)/
5;var e=n.getDay(),g=0;6==e&&0<u?g=1:0==e&&0>u&&(g=-1);e+=l;if(0==e||6==e)g=0<u?2:-2;u=7*d+l+g;break;case "year":h="FullYear";m=!0;break;case "week":u*=7;break;case "quarter":u*=3;case "month":m=!0;h="Month";break;default:h="UTC"+l.charAt(0).toUpperCase()+l.substring(1)+"s"}if(h)v["set"+h](v["get"+h]()+u);m&&v.getDate()<n.getDate()&&v.setDate(0);return v},difference:function(n,l,u){l=l||new Date;u=u||"day";var v=l.getFullYear()-n.getFullYear(),m=1;switch(u){case "quarter":n=n.getMonth();l=l.getMonth();
m=Math.floor(l/3)+1+4*v-(Math.floor(n/3)+1);break;case "weekday":v=Math.round(c.difference(n,l,"day"));u=parseInt(c.difference(n,l,"week"));if(0==v%7)v=5*u;else{m=0;var h=n.getDay(),d=l.getDay();u=parseInt(v/7);l=v%7;n=new Date(n);n.setDate(n.getDate()+7*u);n=n.getDay();if(0<v)switch(!0){case 6==h:m=-1;break;case 0==h:m=0;break;case 6==d:m=-1;break;case 0==d:m=-2;break;case 5<n+l:m=-2}else if(0>v)switch(!0){case 6==h:m=0;break;case 0==h:m=1;break;case 6==d:m=2;break;case 0==d:m=1;break;case 0>n+l:m=
2}v=v+m-2*u}m=v;break;case "year":m=v;break;case "month":m=l.getMonth()-n.getMonth()+12*v;break;case "week":m=parseInt(c.difference(n,l,"day")/7);break;case "day":m/=24;case "hour":m/=60;case "minute":m/=60;case "second":m/=1E3;case "millisecond":m*=l.getTime()-n.getTime()}return Math.round(m)}};b.mixin(b.getObject("dojo.date",!0),c);return c})},"dojo/cldr/supplemental":function(){define(["../_base/lang","../i18n"],function(a,b){var c={};a.setObject("dojo.cldr.supplemental",c);c.getFirstDayOfWeek=
function(n){n={bd:5,mv:5,ae:6,af:6,bh:6,dj:6,dz:6,eg:6,iq:6,ir:6,jo:6,kw:6,ly:6,ma:6,om:6,qa:6,sa:6,sd:6,sy:6,ye:6,ag:0,ar:0,as:0,au:0,br:0,bs:0,bt:0,bw:0,by:0,bz:0,ca:0,cn:0,co:0,dm:0,"do":0,et:0,gt:0,gu:0,hk:0,hn:0,id:0,ie:0,il:0,"in":0,jm:0,jp:0,ke:0,kh:0,kr:0,la:0,mh:0,mm:0,mo:0,mt:0,mx:0,mz:0,ni:0,np:0,nz:0,pa:0,pe:0,ph:0,pk:0,pr:0,py:0,sg:0,sv:0,th:0,tn:0,tt:0,tw:0,um:0,us:0,ve:0,vi:0,ws:0,za:0,zw:0}[c._region(n)];return void 0===n?1:n};c._region=function(n){n=b.normalizeLocale(n);n=n.split("-");
var l=n[1];l?4==l.length&&(l=n[2]):l={aa:"et",ab:"ge",af:"za",ak:"gh",am:"et",ar:"eg",as:"in",av:"ru",ay:"bo",az:"az",ba:"ru",be:"by",bg:"bg",bi:"vu",bm:"ml",bn:"bd",bo:"cn",br:"fr",bs:"ba",ca:"es",ce:"ru",ch:"gu",co:"fr",cr:"ca",cs:"cz",cv:"ru",cy:"gb",da:"dk",de:"de",dv:"mv",dz:"bt",ee:"gh",el:"gr",en:"us",es:"es",et:"ee",eu:"es",fa:"ir",ff:"sn",fi:"fi",fj:"fj",fo:"fo",fr:"fr",fy:"nl",ga:"ie",gd:"gb",gl:"es",gn:"py",gu:"in",gv:"gb",ha:"ng",he:"il",hi:"in",ho:"pg",hr:"hr",ht:"ht",hu:"hu",hy:"am",
ia:"fr",id:"id",ig:"ng",ii:"cn",ik:"us","in":"id",is:"is",it:"it",iu:"ca",iw:"il",ja:"jp",ji:"ua",jv:"id",jw:"id",ka:"ge",kg:"cd",ki:"ke",kj:"na",kk:"kz",kl:"gl",km:"kh",kn:"in",ko:"kr",ks:"in",ku:"tr",kv:"ru",kw:"gb",ky:"kg",la:"va",lb:"lu",lg:"ug",li:"nl",ln:"cd",lo:"la",lt:"lt",lu:"cd",lv:"lv",mg:"mg",mh:"mh",mi:"nz",mk:"mk",ml:"in",mn:"mn",mo:"ro",mr:"in",ms:"my",mt:"mt",my:"mm",na:"nr",nb:"no",nd:"zw",ne:"np",ng:"na",nl:"nl",nn:"no",no:"no",nr:"za",nv:"us",ny:"mw",oc:"fr",om:"et",or:"in",os:"ge",
pa:"in",pl:"pl",ps:"af",pt:"br",qu:"pe",rm:"ch",rn:"bi",ro:"ro",ru:"ru",rw:"rw",sa:"in",sd:"in",se:"no",sg:"cf",si:"lk",sk:"sk",sl:"si",sm:"ws",sn:"zw",so:"so",sq:"al",sr:"rs",ss:"za",st:"za",su:"id",sv:"se",sw:"tz",ta:"in",te:"in",tg:"tj",th:"th",ti:"et",tk:"tm",tl:"ph",tn:"za",to:"to",tr:"tr",ts:"za",tt:"ru",ty:"pf",ug:"cn",uk:"ua",ur:"pk",uz:"uz",ve:"za",vi:"vn",wa:"be",wo:"sn",xh:"za",yi:"il",yo:"ng",za:"cn",zh:"cn",zu:"za",ace:"id",ady:"ru",agq:"cm",alt:"ru",amo:"ng",asa:"tz",ast:"es",awa:"in",
bal:"pk",ban:"id",bas:"cm",bax:"cm",bbc:"id",bem:"zm",bez:"tz",bfq:"in",bft:"pk",bfy:"in",bhb:"in",bho:"in",bik:"ph",bin:"ng",bjj:"in",bku:"ph",bqv:"ci",bra:"in",brx:"in",bss:"cm",btv:"pk",bua:"ru",buc:"yt",bug:"id",bya:"id",byn:"er",cch:"ng",ccp:"in",ceb:"ph",cgg:"ug",chk:"fm",chm:"ru",chp:"ca",chr:"us",cja:"kh",cjm:"vn",ckb:"iq",crk:"ca",csb:"pl",dar:"ru",dav:"ke",den:"ca",dgr:"ca",dje:"ne",doi:"in",dsb:"de",dua:"cm",dyo:"sn",dyu:"bf",ebu:"ke",efi:"ng",ewo:"cm",fan:"gq",fil:"ph",fon:"bj",fur:"it",
gaa:"gh",gag:"md",gbm:"in",gcr:"gf",gez:"et",gil:"ki",gon:"in",gor:"id",grt:"in",gsw:"ch",guz:"ke",gwi:"ca",haw:"us",hil:"ph",hne:"in",hnn:"ph",hoc:"in",hoj:"in",ibb:"ng",ilo:"ph",inh:"ru",jgo:"cm",jmc:"tz",kaa:"uz",kab:"dz",kaj:"ng",kam:"ke",kbd:"ru",kcg:"ng",kde:"tz",kdt:"th",kea:"cv",ken:"cm",kfo:"ci",kfr:"in",kha:"in",khb:"cn",khq:"ml",kht:"in",kkj:"cm",kln:"ke",kmb:"ao",koi:"ru",kok:"in",kos:"fm",kpe:"lr",krc:"ru",kri:"sl",krl:"ru",kru:"in",ksb:"tz",ksf:"cm",ksh:"de",kum:"ru",lag:"tz",lah:"pk",
lbe:"ru",lcp:"cn",lep:"in",lez:"ru",lif:"np",lis:"cn",lki:"ir",lmn:"in",lol:"cd",lua:"cd",luo:"ke",luy:"ke",lwl:"th",mad:"id",mag:"in",mai:"in",mak:"id",man:"gn",mas:"ke",mdf:"ru",mdh:"ph",mdr:"id",men:"sl",mer:"ke",mfe:"mu",mgh:"mz",mgo:"cm",min:"id",mni:"in",mnk:"gm",mnw:"mm",mos:"bf",mua:"cm",mwr:"in",myv:"ru",nap:"it",naq:"na",nds:"de","new":"np",niu:"nu",nmg:"cm",nnh:"cm",nod:"th",nso:"za",nus:"sd",nym:"tz",nyn:"ug",pag:"ph",pam:"ph",pap:"bq",pau:"pw",pon:"fm",prd:"ir",raj:"in",rcf:"re",rej:"id",
rjs:"np",rkt:"in",rof:"tz",rwk:"tz",saf:"gh",sah:"ru",saq:"ke",sas:"id",sat:"in",saz:"in",sbp:"tz",scn:"it",sco:"gb",sdh:"ir",seh:"mz",ses:"ml",shi:"ma",shn:"mm",sid:"et",sma:"se",smj:"se",smn:"fi",sms:"fi",snk:"ml",srn:"sr",srr:"sn",ssy:"er",suk:"tz",sus:"gn",swb:"yt",swc:"cd",syl:"bd",syr:"sy",tbw:"ph",tcy:"in",tdd:"cn",tem:"sl",teo:"ug",tet:"tl",tig:"er",tiv:"ng",tkl:"tk",tmh:"ne",tpi:"pg",trv:"tw",tsg:"ph",tts:"th",tum:"mw",tvl:"tv",twq:"ne",tyv:"ru",tzm:"ma",udm:"ru",uli:"fm",umb:"ao",unr:"in",
unx:"in",vai:"lr",vun:"tz",wae:"ch",wal:"et",war:"ph",xog:"ug",xsr:"np",yao:"mz",yap:"fm",yav:"cm",zza:"tr"}[n[0]];return l};c.getWeekend=function(n){var l=c._region(n);n={"in":0,af:4,dz:4,ir:4,om:4,sa:4,ye:4,ae:5,bh:5,eg:5,il:5,iq:5,jo:5,kw:5,ly:5,ma:5,qa:5,sd:5,sy:5,tn:5}[l];l={af:5,dz:5,ir:5,om:5,sa:5,ye:5,ae:6,bh:5,eg:6,il:6,iq:6,jo:6,kw:6,ly:6,ma:6,qa:6,sd:6,sy:6,tn:6}[l];void 0===n&&(n=6);void 0===l&&(l=0);return{start:n,end:l}};return c})},"dojox/encoding/base64":function(){define(["dojo/_base/lang"],
function(a){a=a.getObject("dojox.encoding.base64",!0);a.encode=function(b){var c=[],n=b.length,l=n%3;n-=l;for(var u=0;u<n;){var v=b[u++]<<16|b[u++]<<8|b[u++];c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>18&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>12&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>6&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v&
63))}switch(l){case 2:v=b[u++]<<16|b[u++]<<8;c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>18&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>12&63));c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>6&63));c.push("\x3d");break;case 1:v=b[u++]<<16,c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>18&63)),c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".charAt(v>>>
12&63)),c.push("\x3d"),c.push("\x3d")}return c.join("")};a.decode=function(b){b=b.split("");for(var c=[],n=b.length;"\x3d"==b[--n];);for(var l=0;l<n;){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[l++])<<18;l<=n&&(u|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[l++])<<12);l<=n&&(u|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[l++])<<6);l<=n&&(u|="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(b[l++]));
c.push(u>>>16&255);c.push(u>>>8&255);c.push(u&255)}for(;0==c[c.length-1];)c.pop();return c};return a})},"esri/rest/geometryService":function(){define("exports ./geometryService/areasAndLengths ./geometryService/autoComplete ./geometryService/buffer ./geometryService/convexHull ./geometryService/cut ./geometryService/densify ./geometryService/difference ./geometryService/distance ./geometryService/fromGeoCoordinateString ./geometryService/generalize ./geometryService/intersect ./geometryService/labelPoints ./geometryService/lengths ./geometryService/offset ./geometryService/project ./geometryService/relation ./geometryService/reshape ./geometryService/simplify ./geometryService/toGeoCoordinateString ./geometryService/trimExtend ./geometryService/union ./geometryService/units".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){a.areasAndLengths=b.areasAndLengths;a.autoComplete=c.autoComplete;a.buffer=n.buffer;a.convexHull=l.convexHull;a.cut=u.cut;a.densify=v.densify;a.difference=m.difference;a.distance=h.distance;a.fromGeoCoordinateString=d.fromGeoCoordinateString;a.generalize=e.generalize;a.intersect=g.intersect;a.labelPoints=p.labelPoints;a.lengths=t.lengths;a.offset=q.offset;a.project=k.project;a.relation=r.relation;a.reshape=y.reshape;a.simplify=f.simplify;a.toGeoCoordinateString=
w.toGeoCoordinateString;a.trimExtend=z.trimExtend;a.union=A.union;a.conversionTypeKebabDict=x.conversionTypeKebabDict;a.units=x.units;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/areasAndLengths":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../utils"],function(a,b,c,n){function l(){l=b._asyncToGenerator(function*(u,v,m){u=n.parseUrl(u);v={...u.query,f:"json",...v.toJSON()};m=n.asValidOptions(v,
m);return c(u.path+"/areasAndLengths",m).then(h=>h.data)});return l.apply(this,arguments)}a.areasAndLengths=function(u,v,m){return l.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/autoComplete":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../utils ./utils ../../geometry/Polygon".split(" "),function(a,b,c,n,l,u,v){function m(){m=b._asyncToGenerator(function*(h,
d,e,g){const p=d[0].spatialReference;h=l.parseUrl(h);d={...h.query,f:"json",sr:JSON.stringify(p.toJSON()),polygons:JSON.stringify(u.encodeGeometries(d).geometries),polylines:JSON.stringify(u.encodeGeometries(e).geometries)};g=l.asValidOptions(d,g);return n(h.path+"/autoComplete",g).then(({data:t})=>(t.geometries||[]).map(({rings:q})=>new v({spatialReference:p,rings:q})))});return m.apply(this,arguments)}a.autoComplete=function(h,d,e,g){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/utils":function(){define(["exports","../../geometry/support/jsonUtils"],function(a,b){a.decodeGeometries=function(c,n,l){const u=b.getGeometryType(n);return c.map(v=>{v=u.fromJSON(v);v.spatialReference=l;return v})};a.encodeGeometries=function(c){return{geometryType:b.getJsonType(c[0]),geometries:c.map(n=>n.toJSON())}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/buffer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../utils ../../geometry/Polygon".split(" "),
function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d){m=l.parseUrl(m);const e={...m.query,f:"json",...h.toJSON()},g=h.outSpatialReference||h.geometries[0].spatialReference;h=l.asValidOptions(e,d);return n(m.path+"/buffer",h).then(p=>(p.data.geometries||[]).map(({rings:t})=>new u({spatialReference:g,rings:t})))});return v.apply(this,arguments)}a.buffer=function(m,h,d){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/rest/geometryService/convexHull":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d){const e=h[0].spatialReference;m=l.parseUrl(m);h={...m.query,f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(u.encodeGeometries(h))};d=l.asValidOptions(h,d);return c(m.path+"/convexHull",d).then(({data:g})=>n.fromJSON(g.geometry).set({spatialReference:e}))});
return v.apply(this,arguments)}a.convexHull=function(m,h,d){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/cut":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../../geometry/support/jsonUtils ../utils".split(" "),function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d,e){m=u.parseUrl(m);const g=h[0].spatialReference;h={...e,query:{...m.query,
f:"json",sr:JSON.stringify(g),target:JSON.stringify({geometryType:l.getJsonType(h[0]),geometries:h}),cutter:JSON.stringify(d)}};h=yield n(m.path+"/cut",h);const {cutIndexes:p,geometries:t=[]}=h.data;return{cutIndexes:p,geometries:t.map(q=>{q=l.fromJSON(q);q.spatialReference=g;return q})}});return v.apply(this,arguments)}a.cut=function(m,h,d,e){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/densify":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../request","../../geometry/support/jsonUtils","../utils"],function(a,b,c,n,l){function u(){u=b._asyncToGenerator(function*(v,m,h){const d=m.geometries[0].spatialReference;v=l.parseUrl(v);m={...v.query,f:"json",...m.toJSON()};h=l.asValidOptions(m,h);return c(v.path+"/densify",h).then(({data:e})=>(e.geometries||[]).map(g=>n.fromJSON(g).set({spatialReference:d})))});return u.apply(this,arguments)}a.densify=function(v,m,h){return u.apply(this,arguments)};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/difference":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d,e){const g=h[0].spatialReference;m=l.parseUrl(m);h={query:{...m.query,f:"json",sr:JSON.stringify(g.toJSON()),geometries:JSON.stringify(u.encodeGeometries(h)),
geometry:JSON.stringify({geometryType:n.getJsonType(d),geometry:d.toJSON()})}};e&&(h={...e,...h});return c(m.path+"/difference",h).then(({data:p})=>(p.geometries||[]).map(t=>n.fromJSON(t).set({spatialReference:g})))});return v.apply(this,arguments)}a.difference=function(m,h,d,e){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/distance":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers",
"../../request","../utils"],function(a,b,c,n){function l(){l=b._asyncToGenerator(function*(u,v,m){u=n.parseUrl(u);v={...u.query,f:"json",...v.toJSON()};m=n.asValidOptions(v,m);return c(u.path+"/distance",m).then(({data:h})=>h&&h.distance)});return l.apply(this,arguments)}a.distance=function(u,v,m){return l.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/fromGeoCoordinateString":function(){define(["exports",
"../../chunks/_rollupPluginBabelHelpers","../../request","../utils","./units"],function(a,b,c,n,l){function u(){u=b._asyncToGenerator(function*(v,m,h){const d={};d.sr=null!=m.sr&&"object"===typeof m.sr?m.sr.wkid||JSON.stringify(m.sr):m.sr;d.strings=JSON.stringify(m.strings);d.conversionType=l.conversionTypeKebabDict.toJSON(m.conversionType||"mgrs");d.conversionMode=m.conversionMode;v=n.parseUrl(v);h=n.asValidOptions({...v.query,f:"json",...d},h);return c(v.path+"/fromGeoCoordinateString",h).then(({data:e})=>
e.coordinates)});return u.apply(this,arguments)}a.fromGeoCoordinateString=function(v,m,h){return u.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/units":function(){define(["exports","../../core/jsonMap"],function(a,b){b=new b.JSONMap({MGRS:"mgrs",USNG:"usng",UTM:"utm",GeoRef:"geo-ref",GARS:"gars",DMS:"dms",DDM:"ddm",DD:"dd"});a.conversionTypeKebabDict=b;a.units={UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,
UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,
UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,
UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",
UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/generalize":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ../operations/generalize ../support/GeneralizeParameters".split(" "),
function(a,b,c,n,l,u,v){function m(){m=b._asyncToGenerator(function*(h,d,e){d=v.from(d);const g=d.toJSON();d=u.generalizeToRESTParameters(d);h=l.parseUrl(h);const p=g.geometries[0].spatialReference;e=l.asValidOptions({...h.query,f:"json",...d},e);return c(h.path+"/generalize",e).then(({data:t})=>(t.geometries||[]).map(q=>n.fromJSON(q).set({spatialReference:p})))});return m.apply(this,arguments)}a.generalize=function(h,d,e){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/operations/generalize":function(){define(["exports","../../core/jsonMap","../../geometry/support/jsonUtils"],function(a,b,c){const n=new b.JSONMap({109006:"centimeters",9102:"decimal-degrees",109005:"decimeters",9002:"feet",109009:"inches",9036:"kilometers",9001:"meters",9035:"miles",109007:"millimeters",109012:"nautical-miles",9096:"yards"});a.generalizeToRESTParameters=function(l){const {geometries:u,deviationUnit:v,maxDeviation:m}=l.toJSON();
l={maxDeviation:m};u&&u.length&&(l.geometries=JSON.stringify({geometryType:c.getJsonType(u[0]),geometries:u}),l.sr=JSON.stringify(u[0].spatialReference));n.write(v,l,"deviationUnit");return l};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/GeneralizeParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,n,l,u,v,m,h){c=function(d){function e(g){g=d.call(this,g)||this;g.deviationUnit=null;g.geometries=null;g.maxDeviation=null;return g}a._inheritsLoose(e,d);return e}(c.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"deviationUnit",void 0);b.__decorate([n.property({json:{read:{reader:d=>d?d.map(e=>h.fromJSON(e)):null},write:{writer:(d,e)=>{e.geometries=d.map(g=>g.toJSON())}}}})],c.prototype,"geometries",void 0);b.__decorate([n.property({type:Number,json:{write:!0}})],
c.prototype,"maxDeviation",void 0);c=b.__decorate([m.subclass("esri.rest.support.GeneralizeParameters")],c);c.from=v.ensureType(c);return c})},"esri/rest/geometryService/intersect":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d,e){const g=h[0].spatialReference;m=l.parseUrl(m);h={...m.query,f:"json",sr:JSON.stringify(g.toJSON()),geometries:JSON.stringify(u.encodeGeometries(h)),
geometry:JSON.stringify({geometryType:n.getJsonType(d),geometry:d.toJSON()})};e=l.asValidOptions(h,e);return c(m.path+"/intersect",e).then(({data:p})=>(p.geometries||[]).map(t=>n.fromJSON(t).set({spatialReference:g})))});return v.apply(this,arguments)}a.intersect=function(m,h,d,e){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/labelPoints":function(){define(["exports","../../request","../../geometry/support/jsonUtils",
"../utils"],function(a,b,c,n){a.labelPoints=function(l,u,v){var m=u.map(d=>d.toJSON());const h=u[0].spatialReference;l=n.parseUrl(l);m={...l.query,f:"json",sr:h.wkid?h.wkid:JSON.stringify(h.toJSON()),polygons:JSON.stringify(m)};v=n.asValidOptions(m,v);return b(l.path+"/labelPoints",v).then(({data:d})=>(d.labelPoints||[]).map(e=>c.fromJSON(e).set({spatialReference:h})))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/lengths":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../utils ../operations/lengths ../support/LengthsParameters".split(" "),
function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d){h=u.from(h);h=l.lengthsToRESTParameters(h);m=n.parseUrl(m);d=n.asValidOptions({...m.query,f:"json",...h},d);return c(m.path+"/lengths",d).then(({data:e})=>e)});return v.apply(this,arguments)}a.lengths=function(m,h,d){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/operations/lengths":function(){define(["exports","../../core/jsonMap"],function(a,
b){const c=new b.JSONMap({preserveShape:"preserve-shape"});a.lengthsToRESTParameters=function(n){const {polylines:l,lengthUnit:u,geodesic:v,calculationType:m}=n.toJSON(),h={};h.polylines=JSON.stringify(l);n=n.polylines[0].spatialReference;h.sr=n.wkid?n.wkid:JSON.stringify(n.toJSON());u&&(h.lengthUnit=u);v&&(h.geodesic=v);m&&(h.calculationType=c.toJSON(m));return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/LengthsParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Polyline".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){c=function(g){function p(t){t=g.call(this,t)||this;t.calculationType=null;t.geodesic=null;t.lengthUnit=null;t.polylines=null;return t}a._inheritsLoose(p,g);return p}(n.JSONSupport);b.__decorate([l.property({type:String,json:{write:!0}})],c.prototype,"calculationType",void 0);b.__decorate([l.property({type:Boolean,json:{write:!0}})],c.prototype,"geodesic",void 0);b.__decorate([l.property({json:{write:!0}})],c.prototype,"lengthUnit",void 0);b.__decorate([l.property({type:[e],
json:{read:{reader:g=>g?g.map(p=>d.fromJSON(p)):null},write:{writer:(g,p)=>{p.polylines=g.map(t=>t.toJSON())}}}})],c.prototype,"polylines",void 0);c=b.__decorate([h.subclass("esri.rest.support.LengthsParameters")],c);c.from=m.ensureType(c);return c})},"esri/rest/geometryService/offset":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ../operations/offset ../support/OffsetParameters".split(" "),function(a,b,c,n,l,u,v){function m(){m=
b._asyncToGenerator(function*(h,d,e){d=v.from(d);const g=u.offsetToRESTParameters(d);h=l.parseUrl(h);const p=d.geometries[0].spatialReference;d=l.asValidOptions({...h.query,f:"json",...g},e);return c(h.path+"/offset",d).then(({data:t})=>(t.geometries||[]).map(q=>n.fromJSON(q).set({spatialReference:p})))});return m.apply(this,arguments)}a.offset=function(h,d,e){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/operations/offset":function(){define(["exports",
"../../core/jsonMap","../../geometry/support/jsonUtils"],function(a,b,c){const n=new b.JSONMap({esriGeometryOffsetBevelled:"bevelled",esriGeometryOffsetMitered:"mitered",esriGeometryOffsetRounded:"rounded"}),l=new b.JSONMap({9001:"meters",9002:"feet",9036:"kilometers",9093:"miles",109012:"nautical-miles",109001:"yards"});a.offsetToRESTParameters=function(u){const {geometries:v,bevelRatio:m,offsetDistance:h,offsetHow:d,offsetUnit:e}=u.toJSON();u={bevelRatio:m,offsetDistance:h};v&&v.length&&(u.geometries=
JSON.stringify({geometryType:c.getJsonType(v[0]),geometries:v}),u.sr=JSON.stringify(v[0].spatialReference));d&&(u.offsetHow=n.toJSON(d));e&&(u.offsetUnit=l.toJSON(e));return u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/OffsetParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),
function(a,b,c,n,l,u,v,m,h){c=function(d){function e(g){g=d.call(this,g)||this;g.bevelRatio=null;g.geometries=null;g.offsetDistance=null;g.offsetHow=null;g.offsetUnit=null;return g}a._inheritsLoose(e,d);return e}(c.JSONSupport);b.__decorate([n.property({type:Number,json:{write:!0}})],c.prototype,"bevelRatio",void 0);b.__decorate([n.property({json:{read:{reader:d=>d?d.map(e=>h.fromJSON(e)):null},write:{writer:(d,e)=>{e.geometries=d.map(g=>g.toJSON())}}}})],c.prototype,"geometries",void 0);b.__decorate([n.property({type:Number,
json:{write:!0}})],c.prototype,"offsetDistance",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"offsetHow",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"offsetUnit",void 0);c=b.__decorate([m.subclass("esri.rest.support.OffsetParameters")],c);c.from=v.ensureType(c);return c})},"esri/rest/geometryService/project":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/accessorSupport/ensureType ../../geometry/support/jsonUtils ../utils ./utils ../support/ProjectParameters".split(" "),
function(a,b,c,n,l,u,v,m){function h(){h=b._asyncToGenerator(function*(e,g,p){g=d(g);e=u.parseUrl(e);const t={...e.query,f:"json",...g.toJSON()},q=g.outSpatialReference,k=l.getJsonType(g.geometries[0]);g=u.asValidOptions(t,p);return c(e.path+"/project",g).then(({data:{geometries:r}})=>v.decodeGeometries(r,k,q))});return h.apply(this,arguments)}const d=n.ensureType(m);a.project=function(e,g,p){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/rest/support/ProjectParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),function(a,b,c,n,l,u,v,m,h){c=function(d){function e(g){g=d.call(this,g)||this;g.geometries=null;g.outSpatialReference=null;g.transformation=null;
g.transformForward=null;return g}a._inheritsLoose(e,d);e.prototype.toJSON=function(){const g=this.geometries.map(q=>q.toJSON()),p=this.geometries[0],t={};t.outSR=this.outSpatialReference.wkid||JSON.stringify(this.outSpatialReference.toJSON());t.inSR=p.spatialReference.wkid||JSON.stringify(p.spatialReference.toJSON());t.geometries=JSON.stringify({geometryType:h.getJsonType(p),geometries:g});this.transformation&&(t.transformation=this.transformation.wkid||JSON.stringify(this.transformation));null!=
this.transformForward&&(t.transformForward=this.transformForward);return t};return e}(c.JSONSupport);b.__decorate([n.property()],c.prototype,"geometries",void 0);b.__decorate([n.property({json:{read:{source:"outSR"}}})],c.prototype,"outSpatialReference",void 0);b.__decorate([n.property()],c.prototype,"transformation",void 0);b.__decorate([n.property()],c.prototype,"transformForward",void 0);return c=b.__decorate([m.subclass("esri.rest.support.ProjectParameters")],c)})},"esri/rest/geometryService/relation":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../utils ../operations/relation ../support/RelationParameters".split(" "),
function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d){h=u.from(h);h=l.relationToRESTParameters(h);m=n.parseUrl(m);d=n.asValidOptions({...m.query,f:"json",...h},d);return c(m.path+"/relation",d).then(({data:e})=>e.relations)});return v.apply(this,arguments)}a.relation=function(m,h,d){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/operations/relation":function(){define(["exports","../../core/jsonMap",
"../../geometry/support/jsonUtils"],function(a,b,c){const n=new b.JSONMap({esriGeometryRelationCross:"cross",esriGeometryRelationDisjoint:"disjoint",esriGeometryRelationIn:"in",esriGeometryRelationInteriorIntersection:"interior-intersection",esriGeometryRelationIntersection:"intersection",esriGeometryRelationLineCoincidence:"line-coincidence",esriGeometryRelationLineTouch:"line-touch",esriGeometryRelationOverlap:"overlap",esriGeometryRelationPointTouch:"point-touch",esriGeometryRelationTouch:"touch",
esriGeometryRelationWithin:"within",esriGeometryRelationRelation:"relation"});a.relationToRESTParameters=function(l){const {geometries1:u,geometries2:v,relation:m,relationParameter:h}=l.toJSON();l={};if(u&&u.length){l.geometries1=JSON.stringify({geometryType:c.getJsonType(u[0]),geometries:u});const d=u[0].spatialReference;l.sr=d.wkid?d.wkid:JSON.stringify(d)}v&&0<v.length&&(l.geometries2=JSON.stringify({geometryType:c.getJsonType(v[0]),geometries:v}));m&&(l.relation=n.toJSON(m));h&&(l.relationParam=
h);return l};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/RelationParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils".split(" "),function(a,b,c,n,l,u,v,m,h){c=function(d){function e(g){g=
d.call(this,g)||this;g.geometries1=null;g.geometries2=null;g.relation=null;g.relationParameter=null;return g}a._inheritsLoose(e,d);return e}(c.JSONSupport);b.__decorate([n.property({json:{read:{reader:d=>d?d.map(e=>h.fromJSON(e)):null},write:{writer:(d,e)=>{e.geometries1=d.map(g=>g.toJSON())}}}})],c.prototype,"geometries1",void 0);b.__decorate([n.property({json:{read:{reader:d=>d?d.map(e=>h.fromJSON(e)):null},write:{writer:(d,e)=>{e.geometries2=d.map(g=>g.toJSON())}}}})],c.prototype,"geometries2",
void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"relation",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"relationParameter",void 0);c=b.__decorate([m.subclass("esri.rest.support.RelationParameters")],c);c.from=v.ensureType(c);return c})},"esri/rest/geometryService/reshape":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../../geometry/support/jsonUtils","../utils"],function(a,b,c,n,l){function u(){u=
b._asyncToGenerator(function*(v,m,h,d){const e=m.spatialReference;v=l.parseUrl(v);m={...v.query,f:"json",sr:JSON.stringify(e.toJSON()),target:JSON.stringify({geometryType:n.getJsonType(m),geometry:m.toJSON()}),reshaper:JSON.stringify(h.toJSON())};d=l.asValidOptions(m,d);return c(v.path+"/reshape",d).then(({data:g})=>n.fromJSON(g.geometry).set({spatialReference:e}))});return u.apply(this,arguments)}a.reshape=function(v,m,h,d){return u.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/simplify":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/urlUtils ../../geometry/support/jsonUtils ./utils".split(" "),function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d){const e="string"===typeof m?n.urlToObject(m):m;m=h[0].spatialReference;const g=l.getJsonType(h[0]);h={...d,query:{...e.query,f:"json",sr:m.wkid?m.wkid:JSON.stringify(m),geometries:JSON.stringify(u.encodeGeometries(h))}};
({data:h}=yield c(e.path+"/simplify",h));return u.decodeGeometries(h.geometries,g,m)});return v.apply(this,arguments)}a.simplify=function(m,h,d){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/toGeoCoordinateString":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../request","../utils","./units"],function(a,b,c,n,l){function u(){u=b._asyncToGenerator(function*(v,m,h){const d=
{};d.sr=null!=m.sr&&"object"===typeof m.sr?m.sr.wkid||JSON.stringify(m.sr):m.sr;d.coordinates=JSON.stringify(m.coordinates);d.conversionType=l.conversionTypeKebabDict.toJSON(m.conversionType||"mgrs");d.conversionMode=m.conversionMode;d.numOfDigits=m.numOfDigits;d.rounding=m.rounding;d.addSpaces=m.addSpaces;v=n.parseUrl(v);h=n.asValidOptions({...v.query,f:"json",...d},h);return c(v.path+"/toGeoCoordinateString",h).then(({data:e})=>e.strings)});return u.apply(this,arguments)}a.toGeoCoordinateString=
function(v,m,h){return u.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/geometryService/trimExtend":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../request ../utils ../operations/trimExtend ../support/TrimExtendParameters ../../geometry/Polyline".split(" "),function(a,b,c,n,l,u,v,m){function h(){h=b._asyncToGenerator(function*(d,e,g){e=v.from(e);const p=u.trimExtendToRESTParameters(e);
d=l.parseUrl(d);const t=e.sr;e=l.asValidOptions({...d.query,f:"json",...p},g);return n(d.path+"/trimExtend",e).then(({data:q})=>(q.geometries||[]).map(({paths:k})=>new m({spatialReference:t,paths:k})))});return h.apply(this,arguments)}a.trimExtend=function(d,e,g){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/operations/trimExtend":function(){define(["exports","../../core/jsonMap"],function(a,b){const c=new b.JSONMap({0:"default-curve-extension",
1:"relocate-ends",2:"keep-end-attributes",4:"no-end-attributes",8:"no-extend-at-from",16:"no-extend-at-to"});a.trimExtendToRESTParameters=function(n){const {extendHow:l,polylines:u,trimExtendTo:v}=n.toJSON();n={};n.extendHow=c.toJSON(l);u&&u.length&&(n.polylines=JSON.stringify(u),n.sr=JSON.stringify(u[0].spatialReference));v&&(n.trimExtendTo=JSON.stringify(v));return n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/rest/support/TrimExtendParameters":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/jsonUtils ../../geometry/Polyline".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){c=function(g){function p(t){t=g.call(this,t)||this;t.extendHow="default-curve-extension";t.polylines=null;t.trimExtendTo=null;return t}a._inheritsLoose(p,g);return p}(n.JSONSupport);b.__decorate([l.property({type:String,json:{write:!0}})],c.prototype,"extendHow",void 0);b.__decorate([l.property({type:[e],json:{read:{reader:g=>g?g.map(p=>d.fromJSON(p)):null},write:{writer:(g,p)=>{p.polylines=g.map(t=>t.toJSON())}}}})],c.prototype,"polylines",void 0);b.__decorate([l.property({json:{read:{reader:g=>
g?d.fromJSON(g):null},write:{writer:(g,p)=>{p.trimExtendTo=g.toJSON()}}}})],c.prototype,"trimExtendTo",void 0);c=b.__decorate([h.subclass("esri.rest.support.TrimExtendParameters")],c);c.from=m.ensureType(c);return c})},"esri/rest/geometryService/union":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../geometry/support/jsonUtils ../utils ./utils".split(" "),function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(m,h,d){const e=h[0].spatialReference;m=
l.parseUrl(m);h={...m.query,f:"json",sr:JSON.stringify(e.toJSON()),geometries:JSON.stringify(u.encodeGeometries(h))};d=l.asValidOptions(h,d);return c(m.path+"/union",d).then(({data:g})=>n.fromJSON(g.geometry).set({spatialReference:e}))});return v.apply(this,arguments)}a.union=function(m,h,d){return v.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"jimu/shared/utils":function(){define(["./basePortalUrlUtils"],function(a){function b(l,
u){function v(m,h){var d,e,g="widgetOnScreen"===m;if(l[m]){if(l[m].groups)for(d=0;d<l[m].groups.length;d++){var p=l[m].groups[d];h(p,{index:d,isWidget:!1,groupId:p.id,isThemeWidget:!1,isOnScreen:g});if(l[m].groups[d].widgets)for(e=0;e<l[m].groups[d].widgets.length;e++){var t=l[m].groups[d].widgets[e];h(t,{index:e,isWidget:!0,groupId:p.id,isThemeWidget:t.uri&&-1<t.uri.indexOf("themes/"+l.theme.name),isOnScreen:g})}}if(l[m].widgets)for(d=0;d<l[m].widgets.length;d++)t=l[m].widgets[d],h(l[m].widgets[d],
{index:d,isWidget:!0,groupId:m,isThemeWidget:t.uri&&-1<t.uri.indexOf("themes/"+l.theme.name),isOnScreen:g})}}v("widgetOnScreen",u);v("widgetPool",u)}var c={},n="inPanel hasLocale hasStyle hasConfig hasUIFile hasSettingPage hasSettingUIFile hasSettingLocale hasSettingStyle keepConfigAfterMapSwitched isController hasVersionManager isThemeWidget supportMultiInstance mirrorIconForRTL".split(" ");c.visitElement=b;c.getConfigElementById=function(l,u){var v;if("map"===u)return l.map;b(l,function(m){if(m.id===
u)return v=m,!0});return v};c.getConfigElementByLabel=function(l,u){var v;if("map"===u)return l.map;b(l,function(m){if(m.label||m.name===u)return v=m,!0});return v};c.getConfigElementsByName=function(l,u){var v=[];if("map"===u)return[l.map];b(l,function(m){m.name===u&&v.push(m)});return v};c.getWidgetNameFromUri=function(l){l=l.split("/");l.pop();return l.pop()};c.getAmdFolderFromUri=function(l){l=l.split("/");l.pop();return l.join("/")+"/"};c.widgetProperties=n;c.processWidgetProperties=function(l){"undefined"===
typeof l.properties.isController&&(l.properties.isController=!1);"undefined"===typeof l.properties.isThemeWidget&&(l.properties.isThemeWidget=!1);"undefined"===typeof l.properties.hasVersionManager&&(l.properties.hasVersionManager=!1);"undefined"===typeof l.properties.mirrorIconForRTL&&(l.properties.mirrorIconForRTL=!1);n.forEach(function(u){"undefined"===typeof l.properties[u]&&(l.properties[u]=!0)})};c.getControllerWidgets=function(l){var u=[];l.visitElement(function(v){v.isController&&u.push(v)});
return u};c.isHostedService=function(l){var u=a.getServerByUrl(l);return(new RegExp(u+"/[^/]+/[^/]+/rest/services","gi")).test(l)};return c})},"jimu/shared/basePortalUrlUtils":function(){define(function(){var a={declaredClass:"jimu.shared.basePortalUrlUtils"};"function"!==typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s*/gi,"").replace(/\s*$/gi,"")});"function"!==typeof String.prototype.startWith&&(String.prototype.startWith=function(b){return this.substr(0,
b.length)===b});"function"!==typeof String.prototype.endWith&&(String.prototype.endWith=function(b){return this.substr(this.length-b.length,b.length)===b});a.getServerByUrl=function(b){b=(b||"").trim();b=b.replace(/^(http(s?):?)\/\//gi,"");0===b.indexOf("//")&&(b=b.slice(2));return b.split("/")[0]};a.getServerWithProtocol=function(b){var c="";if(b=(b||"").trim()){var n=a.getServerByUrl(b);if(!n)return c;var l=a.getProtocol(b);l?c=l+"://"+n:0===b.indexOf("//")&&(c="//"+n)}return c};a.isSameServer=
function(b,c){b=a.getServerByUrl(b)||"";c=a.getServerByUrl(c)||"";return b.toLowerCase()===c.toLowerCase()};a.isOnline=function(b){return 0<=a.getServerByUrl(b).toLowerCase().indexOf(".arcgis.com")};a.isArcGIScom=function(b){b=a.getServerByUrl(b).toLowerCase();return"www.arcgis.com"===b||"arcgis.com"===b};a.getStandardPortalUrl=function(b){var c=a.getServerByUrl(b);if(""===c)return"";a.isOnline(c)?(a.isArcGIScom(c)&&(c="www.arcgis.com"),b=a.addProtocol(b),b=a.getProtocol(b)+"://"+c):(b=(b||"").trim().replace(/sharing(.*)/gi,
"").replace(/\/*$/g,""),b=a.addProtocol(b),b.replace(new RegExp("http(s?)://"+c,"g"),"")||(b+="/arcgis"));return b};a.isSamePortalUrl=function(b,c){var n=/^http(s?):\/\//gi,l=/^\/\//gi;b=a.getStandardPortalUrl(b).toLowerCase().replace(n,"").replace(l,"");c=a.getStandardPortalUrl(c).toLowerCase().replace(n,"").replace(l,"");return b===c};a.addProtocol=function(b){if(-1>=b.toLowerCase().indexOf("http://")&&-1>=b.toLowerCase().indexOf("https://")){var c="";"undefined"!==typeof window&&window.location?
(c=window.location.protocol,b=b.startWith("//")?c+b:b.startWith("/")?c+"//"+window.location.host+b:c+"//"+b):(c="http:",b.startWith("//")&&(b=c+b))}return b};a.getProtocol=function(b){var c="";b=b.toLowerCase();0===b.indexOf("https://")?c="https":0===b.indexOf("http://")&&(c="http");return c};a.updateUrlProtocolByOtherUrl=function(b,c){c=c.toLowerCase();0===c.indexOf("https://")?b=a.setHttpsProtocol(b):0===c.indexOf("http://")&&(b=a.setHttpProtocol(b));return b};a.removeProtocol=function(b){return b.replace(/^http(s?):\/\//i,
"//")};a.setHttpProtocol=function(b){b=a.addProtocol(b);return b.replace(/^https:\/\//,"http://")};a.setHttpsProtocol=function(b){b=a.addProtocol(b);return b.replace(/^http:\/\//,"https://")};a.setProtocol=function(b,c){return 0<=c.indexOf("https")?a.setHttpsProtocol(b):0<=c.indexOf("http")?a.setHttpProtocol(b):b};a.getSharingUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing");return c};a.getOAuth2Url=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/oauth2");
return c};a.getAppIdUrl=function(b,c){var n="";(b=a.getStandardPortalUrl(b))&&(n=b+"/sharing/oauth2/apps/"+c);return n};a.getSignInUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/signin.html");return c};a.getBaseSearchUrl=function(b){var c="";b=a.getStandardPortalUrl(b);(b=b.replace(/\/*$/g,""))&&(c=b+"/sharing/rest/search");return c};a.getBaseItemUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/rest/content/items");return c};a.getItemUrl=function(b,c){var n=
"";(b=a.getBaseItemUrl(b))&&c&&(n=b+"/"+c);return n};a.getItemDataUrl=function(b,c){var n="";(b=a.getItemUrl(b,c))&&(n=b+"/data");return n};a.getGenerateTokenUrl=function(b){var c="";b&&(b=a.getStandardPortalUrl(b),c=b+"/sharing/generateToken");return c};a.getItemDetailsPageUrl=function(b,c){var n="";b&&c&&(b=a.getStandardPortalUrl(b),n=b+"/home/item.html?id\x3d"+c);return n};a.getUserProfilePageUrl=function(b,c){var n="";b&&c&&(b=a.getStandardPortalUrl(b),n=b+"/home/user.html?user\x3d"+c);return n};
a.getBaseGroupUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/rest/community/groups");return c};a.getPortalSelfInfoUrl=function(b){var c="";(b=a.getStandardPortalUrl(b||""))&&(c=b+"/sharing/portals/self");return c};a.getCommunitySelfUrl=function(b){var c="";(b=a.getStandardPortalUrl(b||""))&&(c=b+"/sharing/rest/community/self");return c};a.getBaseUserUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/rest/community/users");return c};a.getUserUrl=function(b,
c){var n="",l=a.getBaseUserUrl(b);b&&c&&(n=l+"/"+c);return n};a.getUserTagsUrl=function(b,c){var n="",l=a.getUserUrl(b,c);b&&c&&(n=l+"/tags");return n};a.getUserThumbnailUrl=function(b,c,n){var l="";(b=a.getUserUrl(b,c))&&n&&(l=b+"/info/"+n);return l};a.getContentUrl=function(b){var c="";b&&(b=a.getStandardPortalUrl(b),c=b+"/sharing/rest/content");return c};a.getUserContentUrl=function(b,c,n){var l="";l="";b&&c&&(l=a.getContentUrl(b),l=n?l+"/users/"+c+"/"+n:l+"/users/"+c);return l};a.getUserContentItemUrl=
function(b,c,n){var l="";l="";b&&c&&n&&(l=a.getUserContentUrl(b,c),l=l+"/items/"+n);return l};a.getItemResourceUrl=function(b,c,n){var l="";l="";b&&c&&(l=a.getContentUrl(b),l=n?l+"/items/"+c+"/resources/"+n:l+"/items/"+c+"/resources");return l};a.getAddItemUrl=function(b,c,n){var l="";l="";b&&c&&(l=a.getUserContentUrl(b,c,n),l+="/addItem");return l};a.getDeleteItemUrl=function(b,c,n){var l="";(b=a.getUserItemsUrl(b,c))&&(l=b+"/"+n+"/delete");return l};a.getUserItemsUrl=function(b,c,n){var l="";l=
"";b&&c&&(l=a.getUserContentUrl(b,c,n),l+="/items");return l};a.getUpdateItemUrl=function(b,c,n,l){var u="";u="";b&&c&&(u=a.getUserItemsUrl(b,c,l),u=u+"/"+n+"/update");return u};a.shareItemUrl=function(b,c,n,l){var u="";u="";b&&c&&(u=a.getUserItemsUrl(b,c,l),u=u+"/"+n+"/share");return u};a.getHomeIndexUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/index.html");return c};a.getHomeMapViewerUrl=function(b,c){var n="";if(b=a.getStandardPortalUrl(b))n=b+"/home/webmap/viewer.html",
n=c?n+("?webmap\x3d"+c):n+"?useExisting\x3d1";return n};a.getHomeGalleryUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/gallery.html");return c};a.getHomeGroupsUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/groups.html");return c};a.getHomeMyContentUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/content.html");return c};a.getHomeMyOrganizationUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/organization.html");return c};
a.getHomeUserUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/home/user.html");return c};a.getPortalHelpUrl=function(b,c){var n="";(b=a.getStandardPortalUrl(b))&&(n=b+"/portalhelp/"+(c||"en")+"/portal/");return n};a.getPortalAdminHelpUrl=function(b,c){var n="";(b=a.getStandardPortalUrl(b))&&(n=b+"/portalhelp/"+(c||"en")+"/admin/help/");return n};a.getPortalProxyUrl=function(b){var c="";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/proxy");return c};a.getOAuth2SignOutUrl=function(b){var c=
"";(b=a.getStandardPortalUrl(b))&&(c=b+"/sharing/oauth2/signout");return c};a.getNewPrintUrl=function(b){var c="";if(b=a.getStandardPortalUrl(b))b=a.setHttpProtocol(b),c=b+"/sharing/tools/newPrint";return c};a.getArcgisOnlineUrl=function(b){return b.endsWith("mapsdevext.arcgis.com")||b.endsWith("mapsdevext.arcgis.com/")?"https://devext.arcgis.com":b.endsWith("mapsqa.arcgis.com")||b.endsWith("mapsqa.arcgis.com/")?"https://qaext.arcgis.com":"https://www.arcgis.com"};return a})},"jimu/WidgetManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/Deferred dojo/topic dojo/Evented dojo/on dojo/aspect dojo/json dojo/query dojo/request/xhr dojo/promise/all ./utils jimu/tokenUtils ./dijit/Message ./portalUrlUtils ./portalUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){var f=null,w=a(v,{constructor:function(){this.loaded=[];this.missedActions=[];this.activeWidget=null;this.widgetsUri={};window.isBuilder?(u.subscribe("app/sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),u.subscribe("app/sceneViewChanged",b.hitch(this,this._onSceneViewChanged))):(u.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)),u.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));window.isBuilder?(u.subscribe("app/appConfigLoaded",
b.hitch(this,this._onAppConfigLoaded)),u.subscribe("app/appConfigChanged",b.hitch(this,this._onAppConfigChanged))):(u.subscribe("appConfigLoaded",b.hitch(this,this._onAppConfigLoaded)),u.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));u.subscribe("userSignIn",b.hitch(this,this._onUserSignIn));u.subscribe("userSignOut",b.hitch(this,this._onUserSignOut));u.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered));u.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart))},
loadWidget:function(z){var A=new l,x;z=b.clone(z);z.folderUrl||t.processWidgetSetting(z);(x=this.getWidgetById(z.id))?A.resolve(x):this.getWidgetUri(z).then(b.hitch(this,function(B){z.uri=B;p([this.loadWidgetClass(z),this.loadWidgetManifest(z)]).then(b.hitch(this,function(C){var D=C[0],E=C[1];this.loadWidgetResources(E).then(b.hitch(this,function(F){try{var G=this.createWidget(E,D,F);console.log("widget ["+E.uri+"] created.")}catch(O){console.log("create ["+E.uri+"] error:"+O.stack),new k({message:window.jimuNls.createWidgetError+
": "+E.uri}),A.reject(O)}setTimeout(b.hitch(this,function(){A.resolve(G);this.emit("widget-created",G);u.publish("widgetCreated",G)}),50)}),function(F){A.reject(F)})}),function(C){A.reject(C)})}));return A},loadWidgetClass:function(z){var A=new l;var x=z.isRemote?z.uri+".js":z.uri;require(t.getRequireConfig(),[x],b.hitch(this,function(B){A.resolve(B)}));t.checkError(z.uri,A);return A},loadWidgetResources:function(z){var A=new l,x=[];var B=b.clone(z);z=this.tryLoadWidgetConfig(B);var C=this._tryLoadResource(B,
"i18n");var D=this._tryLoadResource(B,"style");B=this._tryLoadResource(B,"template");x.push(z);x.push(C);x.push(B);x.push(D);p(x).then(b.hitch(this,function(E){var F={};F.config=E[0];F.i18n=E[1];F.template=E[2];F.style=E[3];A.resolve(F)}),function(E){A.reject(E)});return A},getWidgetUri:function(z){if(this.widgetsUri[z.id])return this.widgetsUri[z.id];var A=z.itemId?y.getPortal(window.portalUrl).getItemById(z.itemId).then(function(x){return r.isOnline(window.portalUrl)&&!r.isOnline(x.url)?(new l).reject("Not allow.",
z.itemId):t.widgetJson.getUriFromItem(x)}):t.getUriInfo(z.uri).isRemote?(new l).reject("Not allow.",z.uri):(new l).resolve(z.uri);return this.widgetsUri[z.id]=A},loadWidgetManifest:function(z){var A=new l;return this.getWidgetUri(z).then(b.hitch(this,function(x){z.uri=x;if(z.manifest)return A.resolve(z),A;x=t.getUriInfo(x).folderUrl+"manifest.json";g(x,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,function(B){if(B.error&&B.error.code)return A.reject(B.error);B.amdFolder=z.amdFolder;
B.category="widget";z.label?(this._processManifest(B),t.addManifest2WidgetJson(z,B),A.resolve(z)):t.addI18NLabel(B).then(b.hitch(this,function(){this._processManifest(B);t.addManifest2WidgetJson(z,B);A.resolve(z)}))}),function(B){A.reject(B)});return A}))},getWidgetMarginBox:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return{};if(z._marginBox)return z._marginBox;z.setPosition({left:-9999,top:-9999,relativeTo:z.position.relativeTo});this.openWidget(z);z._marginBox=z.getMarginBox();
this.closeWidget(z);return z._marginBox},_processManifest:function(z){t.addManifestProperies(z);t.processManifestLabel(z,window.dojoConfig.locale)},createWidget:function(z,A,x){if(this.getWidgetById(z.id))return this.getWidgetById(z.id);x.config&&x.i18n&&(x.config=t.replacePlaceHolder(x.config,x.i18n));z.rawConfig=z.config;z.config=x.config||{};this.appConfig._appData&&this._mergeAgolConfig(z);z.nls=x.i18n||{};x.template&&(z.templateString=x.template);z["class"]="jimu-widget";z.label||(z.label=z.name);
z.sceneView=this.sceneView;z.appConfig=this.appConfig;x={};for(var B in z)z.hasOwnProperty(B)&&(x[B]=z[B]);x.widgetManager=this;z=new A(x);z.clazz=A;h.after(z,"startup",b.hitch(this,this._postWidgetStartup,z));h.before(z,"destroy",b.hitch(this,this._onDestroyWidget,z));m(z.domNode,"click",b.hitch(this,this._onClickWidget,z));this.loaded.push(z);return z},getAllWidgets:function(){return this.loaded},destroyAllWidgets:function(){var z=c.map(this.loaded,function(A){return A.id});c.forEach(z,function(A){this.destroyWidget(A)},
this);this.loaded=[]},loadWidgetSettingPage:function(z){var A=new l;z=b.clone(z);z.id+="_setting";p([this.loadWidgetSettingClass(z)]).then(b.hitch(this,function(x){var B=x[0];this.loadWidgetSettingPageResources(z).then(b.hitch(this,function(C){var D={nls:C.i18n,appConfig:this.appConfig,sceneView:this.sceneView,"class":"jimu-widget-setting"};null!==C.template&&(D.templateString=C.template);for(var E in z)z.hasOwnProperty(E)&&(D[E]=z[E]);try{var F=new B(D);h.before(F,"destroy",b.hitch(this,this._onDestroyWidgetSetting,
F));A.resolve(F)}catch(G){new k({message:window.jimuNls.createWidgetSettingError+":"+z.uri}),A.reject(G)}}),function(C){console.log(C)})}),function(x){A.reject(x)});return A},loadWidgetSettingClass:function(z){var A=new l;var x=z.isRemote?z.folderUrl+"setting/Setting.js":z.amdFolder+"setting/Setting";require(t.getRequireConfig(),[x],b.hitch(this,function(B){A.resolve(B)}));t.checkError(z.folderUrl+"setting/Setting.js",A);return A},loadWidgetSettingPageResources:function(z){var A=new l,x=[];z=b.clone(z);
var B=this._tryLoadResource(z,"settingI18n");var C=this._tryLoadResource(z,"settingTemplate");z=this._tryLoadResource(z,"settingStyle");x.push(B);x.push(C);x.push(z);p(x).then(b.hitch(this,function(D){var E={};E.i18n=D[0]||{};E.template=D[1];E.style=D[2];A.resolve(E)}),function(D){console.log(D)});return A},getWidgetById:function(z){var A;c.some(this.loaded,function(x){if(x.id===z)return A=x,!0},this);return A},getWidgetByLabel:function(z){var A;c.some(this.loaded,function(x){if(x.label===z)return A=
x,!0},this);return A},getWidgetsByName:function(z){var A=[];c.some(this.loaded,function(x){x.name===z&&A.push(x)},this);return A},changeWindowStateTo:function(z,A){"normal"===A?this.normalizeWidget(z):"minimized"===A?this.minimizeWidget(z):"maximized"===A?this.maximizeWidget(z):console.log("error state: "+A)},closeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;if("closed"!==z.state){this.activeWidget&&this.activeWidget.id===z.id&&(this.activeWidget.onDeActive(),this.activeWidget=
null);n.setStyle(z.domNode,"display","none");z.setState("closed");try{z.onClose()}catch(A){console.log(console.error("fail to close widget "+z.name+". "+A.stack))}}},openWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;if(!z.started)try{z.started=!0,z.startup()}catch(A){console.error("fail to startup widget "+z.name+". "+A.stack)}if("closed"===z.state){n.setStyle(z.domNode,"display","");z.setState("opened");try{z.onOpen()}catch(A){console.error("fail to open widget "+
z.name+". "+A.stack)}}},activateWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;"opened"===z.state&&this._activeWidget(z)},maximizeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;"closed"===z.state&&this.openWidget(z);z.setWindowState("maximized");try{z.onMaximize()}catch(A){console.log(console.error("fail to maximize widget "+z.name+". "+A.stack))}},minimizeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;
"closed"===z.state&&this.openWidget(z);z.setWindowState("minimized");try{z.onMinimize()}catch(A){console.log(console.error("fail to minimize widget "+z.name+". "+A.stack))}},normalizeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;"closed"===z.state&&this.openWidget(z);z.setWindowState("normal");try{z.onNormalize()}catch(A){console.log(console.error("fail to normalize widget "+z.name+". "+A.stack))}},destroyWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),
!z))return;this._removeWidget(z);try{z.destroy()}catch(A){console.log(console.error("fail to destroy widget "+z.name+". "+A.stack))}},tryLoadWidgetConfig:function(z){return this._tryLoadWidgetConfig(z).then(b.hitch(this,function(A){return this._upgradeWidgetConfig(z,A).then(function(x){return z.config=x})}))},triggerWidgetOpen:function(z){function A(D){var E=h.after(D,"onOpen",function(){E.remove();x.resolve(D)})}var x=new l,B=this.getWidgetById(z);if(B){if("closed"!==B.state)return x.resolve(B),
x;A(B)}else var C=u.subscribe("widgetCreated",b.hitch(this,function(D){D.id===z&&(C.remove(),x.resolve(D))}));u.publish("openWidget",z);return x},_tryLoadWidgetConfig:function(z){var A=new l;if(z.config&&b.isObject(z.config))return A.resolve(z.config),A;if(z.config){if(require.cache["url:"+z.config])return A.resolve(d.parse(require.cache["url:"+z.config])),A;A=t.processUrlInAppConfig(z.config);A=A.split("/");A[A.length-1]=encodeURIComponent(A[A.length-1]);A=A.join("/");return g(A,{handleAs:"json"})}return this._tryLoadResource(z,
"config").then(function(x){z.isDefaultConfig=!0;return x})},_upgradeWidgetConfig:function(z,A){var x=new l,B=z.manifest.version,C=z.version,D;if(B===C)return x.resolve(A),x;if(!1===z.hasVersionManager)return z.version=B,x.resolve(A),x;require(t.getRequireConfig(),[z.amdFolder+"VersionManager"],b.hitch(this,function(E){E=new E;var F=E.getVersionIndex(C),G=E.getVersionIndex(B);if(F>G)x.reject("Bad widget version number, "+z.name+","+C);else try{D=E.upgrade(A,C,B),z.version=B,x.resolve(D)}catch(O){console.log("Read widget ["+
z.name+"] old config error,"+O.stack),x.resolve(A)}}));return x},loadWidgetStyle:function(z){var A="widget/style/"+z.uri,x=new l;A=this._replaceId(A);return n.byId(A)?(x.resolve("load"),x):t.loadStyleLink(A,z.styleFile,"theme_"+this.appConfig.theme.name+"_style_common")},loadWidgetSettingStyle:function(z){var A="widget/style/"+z.uri+"/setting",x=new l;A=this._replaceId(A);return n.byId(A)?(x.resolve("load"),x):t.loadStyleLink(A,z.settingStyleFile)},loadWidgetConfig:function(z){z=require(t.getRequireConfig()).toUrl(z.configFile);
if(require.cache["url:"+z]){var A=new l;A.resolve(d.parse(require.cache["url:"+z]));return A}return g(z,{handleAs:"json"})},loadWidgetI18n:function(z){var A=new l;require(t.getRequireConfig(),["dojo/i18n!"+z.i18nFile],function(x){A.resolve(x)});return A},loadWidgetSettingI18n:function(z){var A=new l;require(t.getRequireConfig(),["dojo/i18n!"+z.settingI18nFile],function(x){A.resolve(x)});return A},loadWidgetTemplate:function(z){var A=new l;require(t.getRequireConfig(),["dojo/text!"+z.templateFile],
function(x){A.resolve(x)});t.checkError(z.templateFile,A);return A},loadWidgetSettingTemplate:function(z){var A=new l;require(t.getRequireConfig(),["dojo/text!"+z.settingTemplateFile],function(x){A.resolve(x)});t.checkError(z.settingTemplateFile,A);return A},removeWidgetStyle:function(z){n.destroy(this._replaceId("widget/style/"+z.uri))},removeWidgetSettingStyle:function(z){n.destroy(this._replaceId("widget/style/"+z.uri+"/setting"))},getControllerWidgets:function(){return c.filter(this.loaded,function(z){return z.isController})},
getOffPanelWidgets:function(){return c.filter(this.loaded,function(z){return!z.inPanel})},getOnScreenOffPanelWidgets:function(){return c.filter(this.loaded,function(z){return z.isOnScreen&&!z.inPanel})},closeOtherWidgetsInTheSameGroup:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),!z))return;for(var A=0;A<this.loaded.length;A++)this.loaded[A].gid===z.gid&&this.loaded[A].id!==z.id&&this.closeWidget(this.loaded[A])},closeAllWidgetsInGroup:function(z){for(var A=0;A<this.loaded.length;A++)this.loaded[A].gid===
z&&this.closeWidget(this.loaded[A])},_mergeAgolConfig:function(z){var A=this.appConfig._appData.values,x="widgets["+z.id+"]",B;for(B in A){var C=B.replace(/\//g,"_").indexOf(x+"_config");0<=C&&t.template.setConfigValue(z,B.replace(/\//g,"_").substr(C,B.length).replace(x,"widget"),A[B])}},_onUserSignIn:function(z){c.forEach(this.loaded,function(A){A.onSignIn(z)},this)},_onUserSignOut:function(){c.forEach(this.loaded,function(z){z.onSignOut()},this)},_activeWidget:function(z){if(this.activeWidget){if(this.activeWidget.id===
z.id){!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&n.setStyle(this.activeWidget.domNode,"zIndex",101);return}"active"===this.activeWidget.state&&(this.activeWidget.setState("opened"),!1===this.activeWidget.inPanel&&n.setStyle(z.domNode,"zIndex","zIndex"in z.position?z.position.zIndex:"auto"),this.activeWidget.onDeActive())}this.activeWidget=z;"opened"===this.activeWidget.state&&(this.activeWidget.setState("active"),!1===this.activeWidget.inPanel&&this.activeWidget.moveTopOnActive&&
n.setStyle(this.activeWidget.domNode,"zIndex",101),this.activeWidget.onActive(),u.publish("widgetActived",z))},_onClickWidget:function(z,A){var x=e(".jimu-widget",z.domNode);if(0<x.length)for(var B=0;B<x.length;B++)if(A.target===x[B]||n.isDescendant(A.target,x[B]))return;this._activeWidget(z)},_onMoveStart:function(z){c.forEach(this.loaded,function(A){A.domNode===z.node&&this._activeWidget(A)},this)},_onAppConfigLoaded:function(z){this.appConfig=z=b.clone(z);q.setPortalUrl(z.portalUrl)},_onSceneViewLoaded:function(z){this.sceneView=
z},_onSceneViewChanged:function(z){this.sceneView=z},_onAppConfigChanged:function(z,A,x,B){var C=b.clone(z);this.appConfig=C;c.forEach(this.loaded,function(D){D&&(D.onAppConfigChanged(C,A,x,B),"widgetChange"===A&&this._onConfigChanged(x.id,x.config,B))},this)},_onConfigChanged:function(z,A){if(z=this.getWidgetById(z))z.onConfigChanged(A),b.mixin(z.config,A)},_onActionTriggered:function(z){if("map"!==z.elementId&&"app"!==z.elementId){var A=this.getWidgetById(z.elementId);if(A)A.onAction(z.action,z.data);
else this.missedActions.push({id:z.elementId,action:{name:z.action,data:z.data}});c.forEach(this.getControllerWidgets(),function(x){if(x.widgetIsControlled(z.elementId))x.onAction(z.action,{widgetId:z.elementId,data:z.data})},this)}},_postWidgetStartup:function(z){z.started=!0;t.setVerticalCenter(z.domNode);h.after(z,"resize",b.hitch(this,t.setVerticalCenter,z.domNode));this.openWidget(z);var A=q.getPortalCredential(this.appConfig.portalUrl);if(A)z.onSignIn(A);else z.onSignOut();this._triggerMissedAction(z)},
_triggerMissedAction:function(z){this.missedActions.forEach(function(A){if(A.id===z.id)z.onAction(A.action.name,A.action.data)})},_remove:function(z){delete this.widgetsUri[z];return c.some(this.loaded,function(A,x){if(A.id===z)return this.loaded.splice(x,1),!0},this)},_tryLoadResource:function(z,A){var x=new l,B=function(){if("config"===A)var D=this.loadWidgetConfig(z);else if("style"===A)D=this.loadWidgetStyle(z);else if("i18n"===A)D=this.loadWidgetI18n(z);else if("template"===A)D=this.loadWidgetTemplate(z);
else if("settingTemplate"===A)D=this.loadWidgetSettingTemplate(z);else if("settingStyle"===A)D=this.loadWidgetSettingStyle(z);else if("settingI18n"===A)D=this.loadWidgetSettingI18n(z);else return x;D.then(function(E){x.resolve(E)},function(E){console.error("Load widget resource error. resource:",A);console.error(E);new k({message:window.jimuNls.loadWidgetResourceError+": "+z.uri});x.reject(E)})};if("config"===A){var C=z.amdFolder+"config.json";z.configFile=C;C="hasConfig"}else if("style"===A)C=z.amdFolder+
"css/style.css",z.styleFile=C,C="hasStyle";else if("i18n"===A)C=z.amdFolder+"nls/strings.js",z.i18nFile=z.isRemote?C:z.amdFolder+"nls/strings",C="hasLocale";else if("template"===A)C=z.amdFolder+"Widget.html",z.templateFile=C,C="hasUIFile";else if("settingTemplate"===A)C=z.amdFolder+"setting/Setting.html",z.settingTemplateFile=C,C="hasSettingUIFile";else if("settingI18n"===A)C=z.amdFolder+"setting/nls/strings.js",z.settingI18nFile=z.isRemote?C:z.amdFolder+"setting/nls/strings",C="hasSettingLocale";
else if("settingStyle"===A)C=z.amdFolder+"setting/css/style.css",z.settingStyleFile=C,C="hasSettingStyle";else return x;z[C]?B.apply(this):x.resolve(null);return x},_replaceId:function(z){return z.replace(/\//g,"_").replace(/\./g,"_")},_onDestroyWidget:function(z){"closed"!==z.state&&this.closeWidget(z);this._removeWidget(z);console.log("destroy widget ["+z.uri+"].")},_onDestroyWidgetSetting:function(z){this.removeWidgetSettingStyle(z)},_removeWidget:function(z){if("string"===typeof z&&(z=this.getWidgetById(z),
!z))return;this.activeWidget&&this.activeWidget.id===z.id&&(this.activeWidget=null);this._remove(z.id);0===this.getWidgetsByName(z.name).length&&this.removeWidgetStyle(z)}});w.getInstance=function(z){null===f&&(f=new w(z),window._widgetManager=f);return f};return w})},"jimu/tokenUtils":function(){define("require dojo/_base/lang dojo/_base/array dojo/aspect dojo/Deferred dojo/cookie dojo/json dojo/topic dojo/request/script esri/kernel esri/request esri/core/urlUtils esri/identity/IdentityManager esri/identity/OAuthInfo jimu/portalUrlUtils jimu/utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){"function"!==typeof u.getAll&&(u.getAll=function(y){var f=[];(y=u(y))&&f.push(y);return f});var r={portalUrl:null,cookiePath:"/",_started:!1,webTierPortalUrls:[],isInBuilderWindow:function(){return!!window.isBuilder},isInConfigOrPreviewWindow:function(){return k.isInConfigOrPreviewWindow()},isStringStartWith:function(y,f){return y.substr(0,f.length)===f},getCookiePath:function(){return this.cookiePath},setPortalUrl:function(y){(y=q.getStandardPortalUrl(y))&&
(y+="/");this.portalUrl=y},getPortalUrl:function(){return this.portalUrl},isWebTierPortal:function(y){var f=new l,w=q.getStandardPortalUrl(y);y=w+"/sharing";var z=q.setHttpsProtocol(w+"/sharing/generateToken?f\x3djson"),A=q.setHttpsProtocol(y);h.get(z,{jsonp:"callback"}).then(b.hitch(this,function(x){x.token?(this.webTierPortalUrls.push(w),this.removeWabAuthInfo(),d.id.getCredential(A).then(b.hitch(this,function(B){function C(F){var G=F.creationTime||(new Date).getTime(),O=F.expires;0<G&&0<O&&O>G&&
setTimeout(function(){h.get(z,{jsonp:"callback"}).then(function(K){K.token&&(F.token=K.token,F.expires=K.expires,F.creationTime=(new Date).getTime(),F.refreshServerTokens(),C(F))},function(K){console.error(K)})},.8*(O-G))}B.token||(B.token=x.token);B.expires||(B.expires=x.expires);var D=k.getEsriConfigRequestObject(),E=g.isTrustedServer(B.server,!0);-1<E&&D.corsEnabledServers.splice(E,1);this._pushCorsEnabledServerInfo({host:q.getServerByUrl(w),withCredentials:!0});f.resolve(!0);C(B)}),b.hitch(this,
function(){f.resolve(!0)}))):f.resolve(!1)}),b.hitch(this,function(x){console.error(x);f.reject(x)}));return f},addAuthorizedCrossOriginDomains:function(y){if(y&&0<y.length)for(var f=0;f<y.length;f++)this.addWithCredentialDomain(y[f])},addWithCredentialDomain:function(y){if(y&&"string"===typeof y){var f=k.getEsriConfigRequestObject().corsEnabledServers,w=q.getServerByUrl(y);(y=q.getServerWithProtocol(y))||(y="http://"+w);y=g.isTrustedServer(y,!0);-1<y&&f.splice(y,1);this._pushCorsEnabledServerInfo({host:w,
withCredentials:!0})}},_pushCorsEnabledServerInfo:function(y){if(y){var f=k.getEsriConfigRequestObject(),w=f.corsEnabledServers,z="charAt charCodeAt concat endsWith indexOf lastIndexOf localeCompare match replace search slice split startsWith substr substring toLocaleLowerCase toLocaleUpperCase toLowerCase toString toUpperCase trim trimLeft trimRight valueOf".split(" ");if("object"===typeof y&&"string"===typeof y.host){for(var A in y.host)y[A]="function"===typeof y.host[A]?function(){return y.host[A].apply(y.host,
arguments)}:y.host[A];y.length=y.host.length;c.forEach(z,function(x){"function"===typeof y.host[x]&&(y[x]=function(){return y.host[x].apply(y.host,arguments)})});y.withCredentials&&f.webTierAuthServers&&0>f.webTierAuthServers.indexOf(y.host)&&f.webTierAuthServers.push(y.host)}w.push(y)}},tryRegisterCredential:function(y){return this.isValidCredential(y)?c.some(d.id.credentials,b.hitch(this,function(f){return y.token===f.token}))?!1:(d.id.credentials.push(y),!0):!1},registerToken:function(y){var f=
q.getSharingUrl(this.portalUrl);d.id.findCredential(f)&&c.some(d.id.credentials,b.hitch(this,function(w,z){if(this.isValidPortalCredentialOfPortalUrl(this.portalUrl,w))return d.id.credentials.splice(z,1),!0}));return this._getTokenInfo(y).then(function(w){d.id.registerToken(w)})},_getTokenInfo:function(y){var f=q.getPortalSelfInfoUrl(this.portalUrl);return h.get(f+("?f\x3djson\x26token\x3d"+y),{jsonp:"callback"}).then(b.hitch(this,function(w){if(w.user)return{server:q.getSharingUrl(this.portalUrl),
ssl:w.allSSL,token:y,userId:w.user.username};throw Error(window.jimuNls.urlParams.invalidToken);}),function(w){console.error(w);throw Error(window.jimuNls.urlParams.validateTokenError);})},_isInvalidPortalUrl:function(y){return y&&"string"===typeof y&&b.trim(y)},signInPortal:function(y){var f=new l;if(this._isInvalidPortalUrl(y)){y=q.getStandardPortalUrl(y);var w=q.getSharingUrl(y),z=this.getPortalCredential(y);z?setTimeout(b.hitch(this,function(){f.resolve(z)}),0):f=d.id.getCredential(w)}else setTimeout(b.hitch(this,
function(){f.reject("Invalid portalurl.")}),0);return f},_loadPortalSelfInfo:function(y){y=q.getPortalSelfInfoUrl(y);var f=new l;e(y,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(w){f.resolve(w.data)}),b.hitch(this,function(w){f.reject(w)}));return f},registerOAuthInfo:function(y,f,w){if(!y||"string"!==typeof y||!f||"string"!==typeof f)return null;w||(w=0);var z=d.id.findOAuthInfo(y);z||(z=window.location.protocol+"//"+window.location.host+a.toUrl("jimu")+
"/oauth-callback.html",z=new t({appId:f,expiration:20160,portalUrl:y,authNamespace:"/",popup:!0,flowType:8.4<=Number(w)?"authorization-code":"auto",popupCallbackUrl:z}),d.id.registerOAuthInfos([z]));z.appId=f;return z},signOutAll:function(y){var f=q.getStandardPortalUrl(this.portalUrl)+"/sharing/rest",w=q.getPortalSignInUrlFromLocation();w=w+"?returnUrl\x3d"+encodeURIComponent(window.location.href);var z=k.getLocationUrlWithoutHashAndQueryParams();z=k.url.addQueryParamToUrl(z,"action","setportalurl");
window.appInfo.isRunInPortal?(this.removeEsriAuthCookieStorage(),window.location.href=f+"/oauth2/signout?client_id\x3darcgisonline\x26redirect_uri\x3d"+w):(this.removeWabAuthInfo(),y&&y.supportsOAuth?(y=f+"/oauth2/signout?client_id\x3d"+y.appId+"\x26redirect_uri\x3d"+z,window.location.href=y):window.location.href=z)},userHaveSignInPortal:function(y){return!!this.getPortalCredential(b.trim(y||""))},isValidCredential:function(y){var f=!1;if(y){f=y.token;var w=y.server,z=y.scope;f=f&&"string"===typeof f&&
b.trim(f);w=w&&"string"===typeof w&&b.trim(w);z="portal"===z||"server"===z;var A=!0;y.expires&&(y=parseInt(y.expires,10),A=(new Date).getTime(),A=y>A);f=f&&w&&z&&A}return f},isValidPortalCredentialOfPortalUrl:function(y,f){var w=!1;this.isValidCredential(f)&&(w="portal"===f.scope,y=q.isSameServer(y,f.server),w=w&&y);return w},getPortalCredential:function(y){var f=null;y=b.trim(y||"");if(!y)return null;y=q.getStandardPortalUrl(y);return f=this._filterPortalCredential(y,d.id.credentials)},saveAndRegisterCookieToCredential:function(y){y=
b.clone(y);y.referer=window.location.host;y.scope="portal";y.isAdmin=!!y.isAdmin;this.saveWabAuthInfo(y);var f=y.server+"/sharing/rest";y.server=f;d.id.registerToken(y);return d.id.findCredential(f,y.userId)},registerAuth2Hash:function(y){y=b.clone(y);var f=1E3*parseInt(y.expires_in,10);f=(new Date).getTime()+f;var w=q.getStandardPortalUrl(y.state.portalUrl);return this.saveAndRegisterCookieToCredential({referer:window.location.host,server:w,token:y.access_token,expires:f,userId:y.username,scope:"portal",
isAdmin:!!y.isAdmin})},readWabAuthInfo:function(){var y=null,f=localStorage.getItem("wab_token");try{var w=u("wab_auth");w&&(y=v.parse(w),y.token=f)}catch(z){console.error(z)}return y},saveWabAuthInfo:function(y){y=b.clone(y);this.removeWabAuthInfo();localStorage.setItem("wab_token",y.token);delete y.token;u("wab_auth",v.stringify(y),{expires:new Date(y.expires),path:"/"})},removeWabAuthInfo:function(){this.removeCookie("wab_auth");localStorage.removeItem("wab_token")},removeEsriAuthCookieStorage:function(){window.localStorage&&
window.localStorage.removeItem("esriJSAPIOAuth");window.sessionStorage&&window.sessionStorage.removeItem("esriJSAPIOAuth")},_filterPortalCredential:function(y,f){var w=null;f&&0<f.length&&(f=c.filter(f,b.hitch(this,function(z){return this.isValidPortalCredentialOfPortalUrl(y,z)})),0<f.length&&(w=f[f.length-1]));return w},_removePortalCredential:function(y){var f=b.trim(y||"");if(f){f=q.getStandardPortalUrl(f);for(y=c.filter(d.id.credentials,b.hitch(this,function(w){return this.isValidPortalCredentialOfPortalUrl(f,
w)}));0<y.length;)y[0].destroy(),y.splice(0,1);d.id.credentials=c.filter(d.id.credentials,b.hitch(this,function(w){return!this.isValidPortalCredentialOfPortalUrl(f,w)}))}},getUserIdByToken:function(y,f){var w=new l;if(y&&"string"===typeof y&&f&&"string"===typeof f){var z=q.getStandardPortalUrl(f);f=c.filter(d.id.credentials,b.hitch(this,function(x){var B=x.token===y&&x.userId;x=q.isSameServer(z,x.server);return B&&x}));if(0<f.length){var A=f[0];setTimeout(b.hitch(this,function(){w.resolve(A.userId)}),
0);return w}f=q.getCommunitySelfUrl(z);e(f,{responseType:"json",query:{f:"json"},callbackParamName:"callback"}).then(b.hitch(this,function(x){x=x&&x.data;w.resolve(x&&x.username||"")}),b.hitch(this,function(x){console.error(x);w.reject("fail to get userId by token")}))}else setTimeout(b.hitch(this,function(){w.reject("invalid parameters")}),0);return w},xtGetCredentialFromCookie:function(y){var f=this.readWabAuthInfo();if(!f||"object"!==typeof f||!q.isSameServer(y,f.server)||window.location.host!==
f.referer)return null;f.expires=parseInt(f.expires,10);var w=(new Date).getTime();if(!(f.expires>w))return this.removeCookie("wab_auth"),null;y+="/sharing/rest";f.server=y;(w=d.id.findCredential(y))||d.id.registerToken(f);return w=d.id.findCredential(y)},removeCookie:function(y){var f=this.getCookiePath();k.removeCookie(y,f)},_getDomainsByServerName:function(y){var f=y.split("."),w=f.length;return c.map(f,b.hitch(this,function(z,A){z=f.slice(A,w);var x="",B=z.length-1;c.forEach(z,b.hitch(this,function(C,
D){x+=C;D!==B&&(x+=".")}));return x}))},_publishCurrentPortalUserSignIn:function(y){if(this.isValidCredential(y))try{m.publish("userSignIn",y)}catch(f){console.error(f)}},_publishAnyUserSignIn:function(y){if(this.isValidCredential(y))try{m.publish("anyUserSignIn",y)}catch(f){console.error(f)}},_publishCurrentPortalUserSignOut:function(y){try{m.publish("userSignOut",y)}catch(f){console.error(f)}},_signInSuccess:function(y){try{this.isValidPortalCredentialOfPortalUrl(this.portalUrl,y)&&this._publishCurrentPortalUserSignIn(y),
this._publishAnyUserSignIn(y)}catch(f){console.error(f)}},_bindEvents:function(){n.after(d.id,"signIn",b.hitch(this,function(y,f){console.log(f[1]);n.after(y,"callback",b.hitch(this,function(w,z){this._signInSuccess(z[0],!1)}));return y}))},isStart:function(){return this._started},startup:function(){if(!this._started){if(this.isInConfigOrPreviewWindow()){var y=window.parent;if(y){var f=y.esri&&y.esri.id;if(f){p.initialize(f.toJson());var w=k.getEsriConfigRequestObject();y=y.esriConfig.defaults.io;
w.trustedServers||(w.trustedServers=[]);c.forEach(y.corsEnabledServers,b.hitch(this,function(z){z&&z.host&&z.withCredentials&&w.trustedServers.push(z.host)}))}}}this._bindEvents();this._started=!0}}};r.startup();return r})},"jimu/portalUrlUtils":function(){define(["dojo/_base/lang","jimu/shared/basePortalUrlUtils"],function(a,b){var c=a.clone(b);c.declaredClass="jimu.portalUrlUtils";c.getPortalUrlFromLocation=function(){return c.getPortalServerFromLocation()+c.getDeployContextFromLocation()};c.getPortalSignInUrlFromLocation=
function(){return c.getPortalUrlFromLocation()+"home/signin.html"};c.getPortalServerFromLocation=function(){return window.location.protocol+"//"+window.location.host};c.getDeployContextFromLocation=function(){var n=window.location.href.split("?")[0],l=n.indexOf("/home/");0>l&&(l=n.indexOf("/apps/"));n=n.substring(n.indexOf(window.location.host)+window.location.host.length+1,l);"/"!==n&&(n="/"+n+"/");return n};c.getRestBaseUrlFromLocation=function(){return window.location.protocol+"//"+window.location.host+
c.getDeployContextFromLocation()+"sharing/rest/"};return c})},"jimu/dijit/Message":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/keys dojo/on jimu/dijit/Popup jimu/utils".split(" "),function(a,b,c,n,l,u,v){return a(u,{baseClass:"jimu-popup jimu-message",declaredClass:"jimu.dijit.Message",type:"message",message:"",autoHeight:!0,maxWidth:350,maxHeight:180,postMixInProperties:function(){this.content=this.message},_createTitleNode:function(){this.titleLabel&&(this.titleNode=
c.create("div",{"class":"title"},this.domNode),this.titleLabeNode=c.create("span",{"class":"title-label jimu-float-leading",innerHTML:v.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode),this.closeBtnNode=c.create("div",{"class":"close-btn jimu-float-trailing"},this.titleNode),this.own(l(this.closeBtnNode,"click",b.hitch(this,this.close))))},_preProcessing:function(){0===this.buttons.length&&this.buttons.push({label:window.jimuNls.common.ok,key:n.ENTER,onClick:b.hitch(this,this.close)})},
_increaseZIndex:function(){c.setStyle(this.domNode,"zIndex",501);c.setStyle(this.overlayNode,"zIndex",500)}})})},"jimu/dijit/Popup":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/on dojo/sniff dojo/touch dojo/query dojo/dnd/move dijit/_WidgetBase jimu/utils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g){var p=0;return a(e,{declaredClass:"jimu.dijit.Popup",baseClass:"jimu-popup",titleLabel:"",content:null,container:null,buttons:[],enabledButtons:[],
disabledButtons:[],onClose:null,_fixedHeight:!1,autoHeight:!1,maxHeight:800,maxWidth:1024,constructor:function(){this.buttons=[];this.enabledButtons=[];this.disabledButtons=[];this.pauseKeyHandles=[];this.container=jimuConfig.layoutId},postCreate:function(){this._preProcessing();this.inherited(arguments);this._initDomNode();this._positioning();n.place(this.domNode,this.container);setTimeout(b.hitch(this,function(){this._moveToMiddle()}),50);this.own(u(window,"resize",b.hitch(this,function(){this._fixedHeight||
this.autoHeight?(this._calculatePosition(),this._moveToMiddle()):this._positioning()})));this.overlayNode=n.create("div",{"class":"jimu-overlay"},this.container);this._increaseZIndex();l.animateProperty({node:this.domNode,properties:{opacity:1},duration:200}).play();this.domNode.focus()},_preProcessing:function(){"number"===typeof this.height&&(this._fixedHeight=!0,this.autoHeight=!1);this.autoHeight&&(this.maxHeight=598)},_createTitleNode:function(){this.titleNode=n.create("div",{"class":"title"},
this.domNode);this.titleLabeNode=n.create("span",{"class":"title-label jimu-float-leading",innerHTML:g.sanitizeHTML(this.titleLabel)||"\x26nbsp"},this.titleNode);this.closeBtnNode=n.create("div",{"class":"close-btn jimu-icon jimu-icon-close jimu-float-trailing"},this.titleNode);var t=null;t="ontouchstart"in document?m.press:"click";this.own(u(this.closeBtnNode,t,b.hitch(this,this.close)))},_initDomNode:function(){this._createTitleNode();this.contentContainerNode=n.create("div",{"class":"content"},
this.domNode);this.content&&("string"===typeof this.content?this.contentContainerNode.innerHTML=this.content:this.content.domNode?(this.content.placeAt(this.contentContainerNode),this.content.popup=this):1===this.content.nodeType&&n.place(this.content,this.contentContainerNode));this.buttonContainer=n.create("div",{"class":"button-container"},this.domNode);0===this.buttons.length&&n.setStyle(this.buttonContainer,"display","none");for(var t=this.buttons.length-1;-1<t;t--)this._createButton(this.buttons[t]),
this.buttons[t].disable&&this.disableButton(t)},_limitButtonsMaxWidth:function(){var t=this.enabledButtons.length;if(0!==t){var q=n.getContentBox(this.buttonContainer),k=n.getMarginExtents(this.enabledButtons[0]),r=n.getPadBorderExtents(this.enabledButtons[0]),y=0;r=8===v("ie")?r.l+r.r:0;y=(q.w-(k.l+k.r+r)*t)/t;0<y&&(c.forEach(this.enabledButtons,b.hitch(this,function(f){n.setStyle(f,"maxWidth",y+"px")})),c.forEach(this.disabledButtons,b.hitch(this,function(f){n.setStyle(f,"maxWidth",y+"px")})))}},
_moveableNode:function(t,q){this.moveable&&(this.moveable.destroy(),this.moveable=null);var k=n.getMarginBox(this.container);k.l=k.l-t+q;k.w+=2*(t-q);this.moveable=new d.boxConstrainedMoveable(this.domNode,{box:k,handle:this.titleNode||this.contentContainerNode,within:!0});this.own(u(this.moveable,"Moving",b.hitch(this,this.onMoving)));this.own(u(this.moveable,"MoveStop",b.hitch(this,this.onMoveStop)))},_getHeaderBox:function(){return 0===h("#header").length?{t:0,l:0,w:0,h:0}:n.getMarginBox("header")},
_getFooterBox:function(){return 0===h(".footer",this.container).length?{t:0,l:0,w:0,h:0}:n.getMarginBox(h(".footer",this.container)[0])},_calculatePosition:function(){var t=n.getContentBox(this.container),q=this._getHeaderBox(),k=this._getFooterBox();k=t.h-q.h-k.h-40;var r=0;r=this._fixedHeight?this.height:this.autoHeight?k-200:this.height=k>this.maxHeight?this.maxHeight:k;k=(k-r)/2+q.h+20;k=k<q.h?q.h:k;this.width=this.width||this.maxWidth;n.setStyle(this.domNode,{left:(t.w-this.width)/2+"px",top:k+
"px",width:this.width+"px"})},_calculateHeight:function(){this.autoHeight?(n.setStyle(this.domNode,"height","auto"),n.addClass(this.contentContainerNode,"content-static"),0===this.buttons.length&&n.setStyle(this.contentContainerNode,{marginBottom:"15px"})):(n.setStyle(this.domNode,"height",this.height+"px"),n.addClass(this.contentContainerNode,"content-absolute"),n.addClass(this.buttonContainer,"button-container-absolute"),0===this.buttons.length&&n.setStyle(this.contentContainerNode,{bottom:"15px"}));
this._moveableNode(this.width,100)},_moveToMiddle:function(){if(this.autoHeight){var t=n.getMarginBox(this.domNode),q=n.getContentBox(this.container),k=this._getHeaderBox(),r=this._getFooterBox();r=q.h-k.h-r.h-40;var y=0;y=t.h||r-200;t=(r-y)/2+k.h+20;t=t<k.h?k.h:t;n.setStyle(this.domNode,{left:(q.w-this.width)/2+"px",top:t+"px",width:this.width+"px"})}},_positioning:function(){this._calculatePosition();this._calculateHeight()},_increaseZIndex:function(){n.setStyle(this.domNode,"zIndex",p+200+1);n.setStyle(this.overlayNode,
"zIndex",p+200);p++},setTitleLabel:function(t){this.titleNode.innerHTML=g.stripHTML(t)},onMoving:function(t){n.setStyle(t.node,"opacity",.9)},onMoveStop:function(t){n.setStyle(t.node,"opacity",1)},close:function(){if(!this.onClose||!1!==this.onClose()){var t=this.domNode.parentNode,q=b.clone(this.domNode);n.setStyle(this.domNode,"display","none");n.destroy(this.overlayNode);this.destroy();this.moveable.destroy();n.place(q,t);l.animateProperty({node:q,properties:{opacity:0},duration:200,onEnd:function(){n.destroy(q)}}).play()}},
addButton:function(t){this._createButton(t)},_createButton:function(t){var q=" ";t.classNames&&0<t.classNames.length&&"function"===typeof t.classNames.join&&(q+=t.classNames.join(" "));var k=n.create("div",{"class":"jimu-btn jimu-float-trailing jimu-trailing-margin1 "+q,innerHTML:t.label,title:t.title},this.buttonContainer);this.enabledButtons.unshift(k);q=n.create("div",{"class":"jimu-btn jimu-state-disabled jimu-float-trailing jimu-trailing-margin1 "+q,title:t.title,innerHTML:t.label,style:{display:"none"}},
this.buttonContainer);this.disabledButtons.unshift(q);this.own(u(k,"click",b.hitch(this,function(r){if(t.onClick)t.onClick(r);else this.close()})))},setButtonProps:function(t,q){"number"===typeof t&&isFinite(t)||(q=t,t=0);if(q&&0!==this.enabledButtons.length)for(var k in q)"title"===k?(n.setAttr(this.enabledButtons[t],"title",q[k]),n.setAttr(this.disabledButtons[t],"title",q[k])):"label"===k&&(n.setProp(this.enabledButtons[t],"innerHTML",q[k]),n.setProp(this.disabledButtons[t],"innerHTML",q[k]))},
enableButton:function(t){"number"===typeof t&&isFinite(t)&&t<this.enabledButtons.length?(n.setStyle(this.enabledButtons[t],"display","inline-block"),n.setStyle(this.disabledButtons[t],"display","none")):(c.forEach(this.enabledButtons[t],b.hitch(this,function(q){n.setStyle(q,"display","inline-block")})),c.forEach(this.disabledButtons[t],b.hitch(this,function(q){n.setStyle(q,"display","none")})))},disableButton:function(t){"number"===typeof t&&isFinite(t)&&t<this.disabledButtons.length?(n.setStyle(this.disabledButtons[t],
"display","inline-block"),n.setStyle(this.enabledButtons[t],"display","none")):(c.forEach(this.disabledButtons,b.hitch(this,function(q){n.setStyle(q,"display","inline-block")})),c.forEach(this.enabledButtons,b.hitch(this,function(q){n.setStyle(q,"display","none")})))},showButton:function(t){this.enableButton(t)},hideButton:function(t){"number"===typeof t&&isFinite(t)&&t<this.disabledButtons.length?(n.setStyle(this.disabledButtons[t],"display","none"),n.setStyle(this.enabledButtons[t],"display","none")):
(c.forEach(this.disabledButtons,b.hitch(this,function(q){n.setStyle(q,"display","none")})),c.forEach(this.enabledButtons,b.hitch(this,function(q){n.setStyle(q,"display","none")})))}})})},"dojo/_base/fx":function(){define("./kernel ./config ./lang ../Evented ./Color ../aspect ../sniff ../dom ../dom-style".split(" "),function(a,b,c,n,l,u,v,m,h){var d=c.mixin,e={},g=e._Line=function(f,w){this.start=f;this.end=w};g.prototype.getValue=function(f){return(this.end-this.start)*f+this.start};var p=e.Animation=
function(f){d(this,f);c.isArray(this.curve)&&(this.curve=new g(this.curve[0],this.curve[1]))};p.prototype=new n;c.extend(p,{duration:350,repeat:0,rate:20,_percent:0,_startRepeatCount:0,_getStep:function(){var f=this._percent,w=this.easing;return w?w(f):f},_fire:function(f,w){w=w||[];if(this[f])if(b.debugAtAllCosts)this[f].apply(this,w);else try{this[f].apply(this,w)}catch(z){console.error("exception in animation handler for:",f),console.error(z)}return this},play:function(f,w){this._delayTimer&&this._clearTimer();
if(w)this._stopTimer(),this._active=this._paused=!1,this._percent=0;else if(this._active&&!this._paused)return this;this._fire("beforeBegin",[this.node]);f=f||this.delay;w=c.hitch(this,"_play",w);if(0<f)return this._delayTimer=setTimeout(w,f),this;w();return this},_play:function(f){this._delayTimer&&this._clearTimer();this._startTime=(new Date).valueOf();this._paused&&(this._startTime-=this.duration*this._percent);this._active=!0;this._paused=!1;f=this.curve.getValue(this._getStep());this._percent||
(this._startRepeatCount||(this._startRepeatCount=this.repeat),this._fire("onBegin",[f]));this._fire("onPlay",[f]);this._cycle();return this},pause:function(){this._delayTimer&&this._clearTimer();this._stopTimer();if(!this._active)return this;this._paused=!0;this._fire("onPause",[this.curve.getValue(this._getStep())]);return this},gotoPercent:function(f,w){this._stopTimer();this._active=this._paused=!0;this._percent=f;w&&this.play();return this},stop:function(f){this._delayTimer&&this._clearTimer();
if(!this._timer)return this;this._stopTimer();f&&(this._percent=1);this._fire("onStop",[this.curve.getValue(this._getStep())]);this._active=this._paused=!1;return this},destroy:function(){this.stop()},status:function(){return this._active?this._paused?"paused":"playing":"stopped"},_cycle:function(){if(this._active){var f=(new Date).valueOf();f=0===this.duration?1:(f-this._startTime)/this.duration;1<=f&&(f=1);this._percent=f;this.easing&&(f=this.easing(f));this._fire("onAnimate",[this.curve.getValue(f)]);
1>this._percent?this._startTimer():(this._active=!1,0<this.repeat?(this.repeat--,this.play(null,!0)):-1==this.repeat?this.play(null,!0):this._startRepeatCount&&(this.repeat=this._startRepeatCount,this._startRepeatCount=0),this._percent=0,this._fire("onEnd",[this.node]),!this.repeat&&this._stopTimer())}return this},_clearTimer:function(){clearTimeout(this._delayTimer);delete this._delayTimer}});var t=0,q=null,k={run:function(){}};c.extend(p,{_startTimer:function(){this._timer||(this._timer=u.after(k,
"run",c.hitch(this,"_cycle"),!0),t++);q||(q=setInterval(c.hitch(k,"run"),this.rate))},_stopTimer:function(){this._timer&&(this._timer.remove(),this._timer=null,t--);0>=t&&(clearInterval(q),q=null,t=0)}});var r=v("ie")?function(f){var w=f.style;w.width.length||"auto"!=h.get(f,"width")||(w.width="auto")}:function(){};e._fade=function(f){f.node=m.byId(f.node);var w=d({properties:{}},f);f=w.properties.opacity={};f.start="start"in w?w.start:function(){return+h.get(w.node,"opacity")||0};f.end=w.end;f=e.animateProperty(w);
u.after(f,"beforeBegin",c.partial(r,w.node),!0);return f};e.fadeIn=function(f){return e._fade(d({end:1},f))};e.fadeOut=function(f){return e._fade(d({end:0},f))};e._defaultEasing=function(f){return.5+Math.sin((f+1.5)*Math.PI)/2};var y=function(f){this._properties=f;for(var w in f){var z=f[w];z.start instanceof l&&(z.tempColor=new l)}};y.prototype.getValue=function(f){var w={},z;for(z in this._properties){var A=this._properties[z],x=A.start;x instanceof l?w[z]=l.blendColors(x,A.end,f,A.tempColor).toCss():
c.isArray(x)||(w[z]=(A.end-x)*f+x+("opacity"!=z?A.units||"px":0))}return w};e.animateProperty=function(f){var w=f.node=m.byId(f.node);f.easing||(f.easing=a._defaultEasing);f=new p(f);u.after(f,"beforeBegin",c.hitch(f,function(){var z={},A;for(A in this.properties){if("width"==A||"height"==A)this.node.display="block";var x=this.properties[A];c.isFunction(x)&&(x=x(w));x=z[A]=d({},c.isObject(x)?x:{end:x});c.isFunction(x.start)&&(x.start=x.start(w));c.isFunction(x.end)&&(x.end=x.end(w));var B=0<=A.toLowerCase().indexOf("color"),
C=function(D,E){var F={height:D.offsetHeight,width:D.offsetWidth}[E];if(void 0!==F)return F;F=h.get(D,E);return"opacity"==E?+F:B?F:parseFloat(F)};"end"in x?"start"in x||(x.start=C(w,A)):x.end=C(w,A);B?(x.start=new l(x.start),x.end=new l(x.end)):x.start="opacity"==A?+x.start:parseFloat(x.start)}this.curve=new y(z)}),!0);u.after(f,"onAnimate",c.hitch(h,"set",f.node),!0);return f};e.anim=function(f,w,z,A,x,B){return e.animateProperty({node:f,duration:z||p.prototype.duration,properties:w,easing:A,onEnd:x}).play(B||
0)};d(a,e);a._Animation=p;return e})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(a,b,c,n,l,u,v,m,h,d){function e(D,E,F){return F?function(G,O){return u(G,F,O)}:q?function(G,O){var K=u(G,E,function(R){O.call(this,R);C=(new Date).getTime()}),L=u(G,D,function(R){(!C||(new Date).getTime()>C+1E3)&&O.call(this,R)});return{remove:function(){K.remove();L.remove()}}}:function(G,O){return u(G,D,O)}}
function g(D){do if(void 0!==D.dojoClick)return D;while(D=D.parentNode)}function p(D,E,F){if(!m.isRight(D)){var G=g(D.target);if(r=!D.target.disabled&&G&&G.dojoClick)if(f=(y="useTarget"==r)?G:D.target,y&&D.preventDefault(),w=D.changedTouches?D.changedTouches[0].pageX-d.global.pageXOffset:D.clientX,z=D.changedTouches?D.changedTouches[0].pageY-d.global.pageYOffset:D.clientY,A=("object"==typeof r?r.x:"number"==typeof r?r:0)||4,x=("object"==typeof r?r.y:"number"==typeof r?r:0)||4,!k){k=!0;var O=function(K){r=
y?c.isDescendant(d.doc.elementFromPoint(K.changedTouches?K.changedTouches[0].pageX-d.global.pageXOffset:K.clientX,K.changedTouches?K.changedTouches[0].pageY-d.global.pageYOffset:K.clientY),f):r&&(K.changedTouches?K.changedTouches[0].target:K.target)==f&&Math.abs((K.changedTouches?K.changedTouches[0].pageX-d.global.pageXOffset:K.clientX)-w)<=A&&Math.abs((K.changedTouches?K.changedTouches[0].pageY-d.global.pageYOffset:K.clientY)-z)<=x};d.doc.addEventListener(E,function(K){m.isRight(K)||(O(K),y&&K.preventDefault())},
!0);d.doc.addEventListener(F,function(K){if(!m.isRight(K)&&(O(K),r)){B=(new Date).getTime();var L=y?f:K.target;"LABEL"===L.tagName&&(L=c.byId(L.getAttribute("for"))||L);var R=K.changedTouches?K.changedTouches[0]:K,M=function(N){var V=document.createEvent("MouseEvents");V._dojo_click=!0;V.initMouseEvent(N,!0,!0,K.view,K.detail,R.screenX,R.screenY,R.clientX,R.clientY,K.ctrlKey,K.altKey,K.shiftKey,K.metaKey,0,null);return V},J=M("mousedown"),I=M("mouseup"),P=M("click");setTimeout(function(){u.emit(L,
"mousedown",J);u.emit(L,"mouseup",I);u.emit(L,"click",P);B=(new Date).getTime()},0)}},!0);D=function(K){d.doc.addEventListener(K,function(L){var R=L.target;r&&!L._dojo_click&&(new Date).getTime()<=B+1E3&&("INPUT"!=R.tagName||!n.contains(R,"dijitOffScreen"))&&(L.stopPropagation(),L.stopImmediatePropagation&&L.stopImmediatePropagation(),"click"==K&&("INPUT"!=R.tagName||"radio"==R.type&&(n.contains(R,"dijitCheckBoxInput")||n.contains(R,"mblRadioButton"))||"checkbox"==R.type&&(n.contains(R,"dijitCheckBoxInput")||
n.contains(R,"mblCheckBox")))&&"TEXTAREA"!=R.tagName&&"AUDIO"!=R.tagName&&"VIDEO"!=R.tagName&&L.preventDefault())},!0)};D("click");D("mousedown");D("mouseup")}}}v("ios");var t=function(){var D={},E;for(E in{down:1,move:1,up:1,cancel:1,over:1,out:1})D[E]="pointer"+E;return D}(),q=v("touch-events"),k,r,y=!1,f,w,z,A,x,B,C;v("touch")&&h(function(){d.doc.addEventListener(t.down,function(D){p(D,t.move,t.up)},!0)});b={press:e("mousedown","touchstart",t.down),move:e("mousemove","dojotouchmove",t.move),release:e("mouseup",
"dojotouchend",t.up),cancel:e(m.leave,"touchcancel",t.cancel),over:e("mouseover","dojotouchover",t.over),out:e("mouseout","dojotouchout",t.out),enter:m._eventHandler(e("mouseover","dojotouchover",t.over)),leave:m._eventHandler(e("mouseout","dojotouchout",t.out))};return a.touch=b})},"dojo/dnd/move":function(){define("../_base/declare ../dom-geometry ../dom-style ./common ./Mover ./Moveable".split(" "),function(a,b,c,n,l,u){n=a("dojo.dnd.move.constrainedMoveable",u,{constraints:function(){},within:!1,
constructor:function(v,m){m||(m={});this.constraints=m.constraints;this.within=m.within},onFirstMove:function(v){var m=this.constraintBox=this.constraints.call(this,v);m.r=m.l+m.w;m.b=m.t+m.h;this.within&&(v=b.getMarginSize(v.node),m.r-=v.w,m.b-=v.h)},onMove:function(v,m){var h=this.constraintBox,d=v.node.style;this.onMoving(v,m);m.l=m.l<h.l?h.l:h.r<m.l?h.r:m.l;m.t=m.t<h.t?h.t:h.b<m.t?h.b:m.t;d.left=m.l+"px";d.top=m.t+"px";this.onMoved(v,m)}});l=a("dojo.dnd.move.boxConstrainedMoveable",n,{box:{},
constructor:function(v,m){var h=m&&m.box;this.constraints=function(){return h}}});a=a("dojo.dnd.move.parentConstrainedMoveable",n,{area:"content",constructor:function(v,m){var h=m&&m.area;this.constraints=function(){var d=this.node.parentNode,e=c.getComputedStyle(d),g=b.getMarginBox(d,e);if("margin"==h)return g;var p=b.getMarginExtents(d,e);g.l+=p.l;g.t+=p.t;g.w-=p.w;g.h-=p.h;if("border"==h)return g;p=b.getBorderExtents(d,e);g.l+=p.l;g.t+=p.t;g.w-=p.w;g.h-=p.h;if("padding"==h)return g;p=b.getPadExtents(d,
e);g.l+=p.l;g.t+=p.t;g.w-=p.w;g.h-=p.h;return g}}});return{constrainedMoveable:n,boxConstrainedMoveable:l,parentConstrainedMoveable:a}})},"dojo/dnd/common":function(){define(["../sniff","../_base/kernel","../_base/lang","../dom"],function(a,b,c,n){var l=c.getObject("dojo.dnd",!0);l.getCopyKeyState=function(u){return u.metaKey};l._uniqueId=0;l.getUniqueId=function(){do var u=b._scopeName+"Unique"+ ++l._uniqueId;while(n.byId(u));return u};l._empty={};l.isFormElement=function(u){u=u.target;3==u.nodeType&&
(u=u.parentNode);return 0<=" a button textarea input select option ".indexOf(" "+u.tagName.toLowerCase()+" ")};return l})},"dojo/dnd/Mover":function(){define("../_base/array ../_base/declare ../_base/lang ../sniff ../_base/window ../dom ../dom-geometry ../dom-style ../Evented ../on ../touch ./common ./autoscroll".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p){return b("dojo.dnd.Mover",[h],{constructor:function(t,q,k){function r(y){y.preventDefault();y.stopPropagation()}this.node=u.byId(t);this.marginBox=
{l:q.pageX,t:q.pageY};this.mouseButton=q.button;q=this.host=k;t=t.ownerDocument;this.events=[d(t,e.move,c.hitch(this,"onFirstMove")),d(t,e.move,c.hitch(this,"onMouseMove")),d(t,e.release,c.hitch(this,"onMouseUp")),d(t,"dragstart",r),d(t.body,"selectstart",r)];p.autoScrollStart(t);if(q&&q.onMoveStart)q.onMoveStart(this)},onMouseMove:function(t){p.autoScroll(t);var q=this.marginBox;this.host.onMove(this,{l:q.l+t.pageX,t:q.t+t.pageY},t);t.preventDefault();t.stopPropagation()},onMouseUp:function(t){(n("webkit")&&
2==this.mouseButton?0==t.button:this.mouseButton==t.button)&&this.destroy();t.preventDefault();t.stopPropagation()},onFirstMove:function(t){var q=this.node.style,k=this.host;switch(q.position){case "relative":case "absolute":var r=Math.round(parseFloat(q.left))||0;q=Math.round(parseFloat(q.top))||0;break;default:q.position="absolute";q=v.getMarginBox(this.node);r=l.doc.body;var y=m.getComputedStyle(r),f=v.getMarginBox(r,y);y=v.getContentBox(r,y);r=q.l-(y.l-f.l);q=q.t-(y.t-f.t)}this.marginBox.l=r-
this.marginBox.l;this.marginBox.t=q-this.marginBox.t;if(k&&k.onFirstMove)k.onFirstMove(this,t);this.events.shift().remove()},destroy:function(){a.forEach(this.events,function(q){q.remove()});var t=this.host;if(t&&t.onMoveStop)t.onMoveStop(this);this.events=this.node=this.host=null}})})},"dojo/dnd/autoscroll":function(){define("../_base/lang ../sniff ../_base/window ../dom-geometry ../dom-style ../window".split(" "),function(a,b,c,n,l,u){var v={};a.setObject("dojo.dnd.autoscroll",v);v.getViewport=
u.getBox;v.V_TRIGGER_AUTOSCROLL=32;v.H_TRIGGER_AUTOSCROLL=32;v.V_AUTOSCROLL_VALUE=16;v.H_AUTOSCROLL_VALUE=16;var m,h=c.doc,d=Infinity,e=Infinity;v.autoScrollStart=function(g){h=g;m=u.getBox(h);g=c.body(h).parentNode;d=Math.max(g.scrollHeight-m.h,0);e=Math.max(g.scrollWidth-m.w,0)};v.autoScroll=function(g){var p=m||u.getBox(h),t=c.body(h).parentNode,q=0,k=0;g.clientX<v.H_TRIGGER_AUTOSCROLL?q=-v.H_AUTOSCROLL_VALUE:g.clientX>p.w-v.H_TRIGGER_AUTOSCROLL&&(q=Math.min(v.H_AUTOSCROLL_VALUE,e-t.scrollLeft));
g.clientY<v.V_TRIGGER_AUTOSCROLL?k=-v.V_AUTOSCROLL_VALUE:g.clientY>p.h-v.V_TRIGGER_AUTOSCROLL&&(k=Math.min(v.V_AUTOSCROLL_VALUE,d-t.scrollTop));window.scrollBy(q,k)};v._validNodes={div:1,p:1,td:1};v._validOverflow={auto:1,scroll:1};v.autoScrollNodes=function(g){for(var p,t,q,k,r,y=0,f=0,w=g.target;w;){if(1==w.nodeType&&w.tagName.toLowerCase()in v._validNodes){q=l.getComputedStyle(w);r=q.overflowX.toLowerCase()in v._validOverflow;k=q.overflowY.toLowerCase()in v._validOverflow;if(r||k)p=n.getContentBox(w,
q),t=n.position(w,!0);if(r){q=Math.min(v.H_TRIGGER_AUTOSCROLL,p.w/2);r=g.pageX-t.x;if(b("webkit")||b("opera"))r+=c.body().scrollLeft;y=0;0<r&&r<p.w&&(r<q?y=-q:r>p.w-q&&(y=q),w.scrollLeft+=y)}if(k){k=Math.min(v.V_TRIGGER_AUTOSCROLL,p.h/2);q=g.pageY-t.y;if(b("webkit")||b("opera"))q+=c.body().scrollTop;f=0;0<q&&q<p.h&&(q<k?f=-k:q>p.h-k&&(f=k),w.scrollTop+=f)}if(y||f)return}try{w=w.parentNode}catch(z){w=null}}v.autoScroll(g)};return v})},"dojo/window":function(){define("./_base/lang ./sniff ./_base/window ./dom ./dom-geometry ./dom-style ./dom-construct".split(" "),
function(a,b,c,n,l,u,v){b.add("rtl-adjust-position-for-verticalScrollBar",function(h,d){h=c.body(d);d=v.create("div",{style:{overflow:"scroll",overflowX:"visible",direction:"rtl",visibility:"hidden",position:"absolute",left:"0",top:"0",width:"64px",height:"64px"}},h,"last");var e=v.create("div",{style:{overflow:"hidden",direction:"ltr"}},d,"last"),g=0!=l.position(e).x;d.removeChild(e);h.removeChild(d);return g});b.add("position-fixed-support",function(h,d){h=c.body(d);d=v.create("span",{style:{visibility:"hidden",
position:"fixed",left:"1px",top:"1px"}},h,"last");var e=v.create("span",{style:{position:"fixed",left:"0",top:"0"}},d,"last"),g=l.position(e).x!=l.position(d).x;d.removeChild(e);h.removeChild(d);return g});var m={getBox:function(h){h=h||c.doc;var d="BackCompat"==h.compatMode?c.body(h):h.documentElement,e=l.docScroll(h);if(b("touch")){var g=m.get(h);h=g.innerWidth||d.clientWidth;d=g.innerHeight||d.clientHeight}else h=d.clientWidth,d=d.clientHeight;return{l:e.x,t:e.y,w:h,h:d}},get:function(h){if(b("ie")&&
m!==document.parentWindow){h.parentWindow.execScript("document._parentWindow \x3d window;","Javascript");var d=h._parentWindow;h._parentWindow=null;return d}return h.parentWindow||h.defaultView},scrollIntoView:function(h,d){try{h=n.byId(h);var e=h.ownerDocument||c.doc,g=c.body(e),p=e.documentElement||g.parentNode,t=b("ie")||0,q=b("webkit");if(h!=g&&h!=p){var k="BackCompat"==e.compatMode,r=Math.min(g.clientWidth||p.clientWidth,p.clientWidth||g.clientWidth),y=Math.min(g.clientHeight||p.clientHeight,
p.clientHeight||g.clientHeight);e=q||k?g:p;var f=d||l.position(h),w=h.parentNode;d=function(M){return 6>=t||7==t&&k?!1:b("position-fixed-support")&&"fixed"==u.get(M,"position").toLowerCase()};var z=this;q=function(M,J,I){"BODY"==M.tagName||"HTML"==M.tagName?z.get(M.ownerDocument).scrollBy(J,I):(J&&(M.scrollLeft+=J),I&&(M.scrollTop+=I))};if(!d(h))for(;w;){w==g&&(w=e);var A=l.position(w),x=d(w),B="rtl"==u.getComputedStyle(w).direction.toLowerCase();if(w==e)A.w=r,A.h=y,e==p&&t&&B&&(A.x+=e.offsetWidth-
A.w),A.x=0,A.y=0;else{var C=l.getPadBorderExtents(w);A.w-=C.w;A.h-=C.h;A.x+=C.l;A.y+=C.t;var D=w.clientWidth,E=A.w-D;0<D&&0<E&&(B&&b("rtl-adjust-position-for-verticalScrollBar")&&(A.x+=E),A.w=D);D=w.clientHeight;E=A.h-D;0<D&&0<E&&(A.h=D)}x&&(0>A.y&&(A.h+=A.y,A.y=0),0>A.x&&(A.w+=A.x,A.x=0),A.y+A.h>y&&(A.h=y-A.y),A.x+A.w>r&&(A.w=r-A.x));var F=f.x-A.x,G=f.y-A.y,O=F+f.w-A.w,K=G+f.h-A.h;if(0<O*F&&(w.scrollLeft||w==e||w.scrollWidth>w.offsetHeight)){var L=Math[0>F?"max":"min"](F,O);B&&8==t&&!k&&(L=-L);var R=
w.scrollLeft;q(w,L,0);L=w.scrollLeft-R;f.x-=L}0<K*G&&(w.scrollTop||w==e||w.scrollHeight>w.offsetHeight)&&(L=Math.ceil(Math[0>G?"max":"min"](G,K)),R=w.scrollTop,q(w,0,L),L=w.scrollTop-R,f.y-=L);w=w!=e&&!x&&w.parentNode}}}catch(M){console.error("scrollIntoView: "+M),h.scrollIntoView(!1)}}};a.setObject("dojo.window",m);return m})},"dojo/dnd/Moveable":function(){define("../_base/array ../_base/declare ../_base/lang ../dom ../dom-class ../Evented ../has ../on ../topic ../touch ./common ./Mover ../_base/window".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){var t,q=function(){};q=function(k,r){"touchAction"in document.body.style?t="touchAction":"msTouchAction"in document.body.style&&(t="msTouchAction");q=function(y,f){y.style[t]=f};q(k,r)};return b("dojo.dnd.Moveable",[u],{handle:"",delay:0,skip:!1,constructor:function(k,r){this.node=n.byId(k);q(this.node,"none");r||(r={});this.handle=r.handle?n.byId(r.handle):null;this.handle||(this.handle=this.node);this.delay=0<r.delay?r.delay:0;this.skip=r.skip;this.mover=r.mover?
r.mover:g;this.events=[m(this.handle,d.press,c.hitch(this,"onMouseDown")),m(this.handle,"dragstart",c.hitch(this,"onSelectStart")),m(this.handle,"selectstart",c.hitch(this,"onSelectStart"))]},markupFactory:function(k,r,y){return new y(r,k)},destroy:function(){a.forEach(this.events,function(k){k.remove()});q(this.node,"");this.events=this.node=this.handle=null},onMouseDown:function(k){if(!this.skip||!e.isFormElement(k)){if(this.delay)this.events.push(m(this.handle,d.move,c.hitch(this,"onMouseMove")),
m(this.handle.ownerDocument,d.release,c.hitch(this,"onMouseUp"))),this._lastX=k.pageX,this._lastY=k.pageY;else this.onDragDetected(k);k.stopPropagation();k.preventDefault()}},onMouseMove:function(k){if(Math.abs(k.pageX-this._lastX)>this.delay||Math.abs(k.pageY-this._lastY)>this.delay)this.onMouseUp(k),this.onDragDetected(k);k.stopPropagation();k.preventDefault()},onMouseUp:function(k){for(var r=0;2>r;++r)this.events.pop().remove();k.stopPropagation();k.preventDefault()},onSelectStart:function(k){this.skip&&
e.isFormElement(k)||(k.stopPropagation(),k.preventDefault())},onDragDetected:function(k){new this.mover(this.node,k,this)},onMoveStart:function(k){h.publish("/dnd/move/start",k);l.add(p.body(),"dojoMove");l.add(this.node,"dojoMoveItem")},onMoveStop:function(k){h.publish("/dnd/move/stop",k);l.remove(p.body(),"dojoMove");l.remove(this.node,"dojoMoveItem")},onFirstMove:function(){},onMove:function(k,r){this.onMoving(k,r);var y=k.node.style;y.left=r.l+"px";y.top=r.t+"px";this.onMoved(k,r)},onMoving:function(){},
onMoved:function(){}})})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){function B(D){return function(E){m[E?
"set":"remove"](this.domNode,D,E);this._set(D,E)}}p.add("dijit-legacy-requires",!t.isAsync);p.add("dojo-bidi",!1);p("dijit-legacy-requires")&&r(0,function(){a(["dijit/_base/manager"])});var C={};n=u("dijit._WidgetBase",[y,z],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:B("lang"),dir:"",_setDirAttr:B("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(D){this._set("ownerDocument",
D)},attributeMap:{},_blankGif:n.blankGif||a.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var D=this.constructor;if(!D._setterAttrs){var E=D.prototype,F=D._setterAttrs=[];D=D._onMap={};for(var G in E.attributeMap)F.push(G);for(G in E)/^on/.test(G)&&(D[G.substring(2).toLowerCase()]=G),/^_set[A-Z](.*)Attr$/.test(G)&&(G=G.charAt(4).toLowerCase()+G.substr(5,G.length-9),E.attributeMap&&G in E.attributeMap||F.push(G))}},postscript:function(D,E){this.create(D,E)},create:function(D,
E){this._introspect();this.srcNodeRef=v.byId(E);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);D&&(this.params=D,q.mixin(this,D));this.postMixInProperties();this.id||(this.id=x.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=w.body(this.ownerDocument);
x.add(this);this.buildRendering();if(this.domNode){this._applyAttributes();if((D=this.srcNodeRef)&&D.parentNode&&this.domNode!==D){D.parentNode.replaceChild(this.domNode,D);var F=!0}this.domNode.setAttribute("widgetId",this.id)}this.postCreate();F&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var D={},E;for(E in this.params||{})D[E]=this._get(E);b.forEach(this.constructor._setterAttrs,function(F){if(!(F in D)){var G=this._get(F);G&&this.set(F,G)}},this);for(E in D)this.set(E,
D[E])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var D=this.baseClass.split(" ");this.isLeftToRight()||(D=D.concat(b.map(D,function(E){return E+"Rtl"})));h.add(this.domNode,D)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,b.forEach(this.getChildren(),function(D){D._started||D._destroyed||!q.isFunction(D.startup)||(D.startup(),D._started=!0)}))},
destroyRecursive:function(D){this._beingDestroyed=!0;this.destroyDescendants(D);this.destroy(D)},destroy:function(D){function E(F){F.destroyRecursive?F.destroyRecursive(D):F.destroy&&F.destroy(D)}this._beingDestroyed=!0;this.uninitialize();b.forEach(this._connects,q.hitch(this,"disconnect"));b.forEach(this._supportingWidgets,E);this.domNode&&b.forEach(x.findWidgets(this.domNode,this.containerNode),E);this.destroyRendering(D);x.remove(this.id);this._destroyed=!0},destroyRendering:function(D){this.bgIframe&&
(this.bgIframe.destroy(D),delete this.bgIframe);this.domNode&&(D?m.remove(this.domNode,"widgetId"):d.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(D||d.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(D){b.forEach(this.getChildren(),function(E){E.destroyRecursive&&E.destroyRecursive(D)})},uninitialize:function(){return!1},_setStyleAttr:function(D){var E=this.domNode;q.isObject(D)?g.set(E,D):E.style.cssText=E.style.cssText?E.style.cssText+("; "+D):D;this._set("style",
D)},_attrToDom:function(D,E,F){F=3<=arguments.length?F:this.attributeMap[D];b.forEach(q.isArray(F)?F:[F],function(G){var O=this[G.node||G||"domNode"];switch(G.type||"attribute"){case "attribute":q.isFunction(E)&&(E=q.hitch(this,E));G=G.attribute?G.attribute:/^on[A-Z][a-zA-Z]*$/.test(D)?D.toLowerCase():D;O.tagName?m.set(O,G,E):O.set(G,E);break;case "innerText":O.innerHTML="";O.appendChild(this.ownerDocument.createTextNode(E));break;case "textContent":O.textContent=E;break;case "innerHTML":O.innerHTML=
E;break;case "class":h.replace(O,E,this[D]);break;case "toggleClass":h.toggle(O,G.className||D,E)}},this)},get:function(D){var E=this._getAttrNames(D);return this[E.g]?this[E.g]():this._get(D)},set:function(D,E){if("object"===typeof D){for(var F in D)this.set(F,D[F]);return this}F=this._getAttrNames(D);var G=this[F.s];if(q.isFunction(G))var O=G.apply(this,Array.prototype.slice.call(arguments,1));else{G=this.focusNode&&!q.isFunction(this.focusNode)?"focusNode":"domNode";var K=this[G]&&this[G].tagName,
L;if((L=K)&&!(L=C[K])){L=this[G];var R={};for(M in L)R[M.toLowerCase()]=!0;L=C[K]=R}var M=L;F=D in this.attributeMap?this.attributeMap[D]:F.s in this?this[F.s]:M&&F.l in M&&"function"!=typeof E||/^aria-|^data-|^role$/.test(D)?G:null;null!=F&&this._attrToDom(D,E,F);this._set(D,E)}return O||this},_attrPairNames:{},_getAttrNames:function(D){var E=this._attrPairNames;if(E[D])return E[D];var F=D.replace(/^[a-z]|-[a-zA-Z]/g,function(G){return G.charAt(G.length-1).toUpperCase()});return E[D]={n:D+"Node",
s:"_set"+F+"Attr",g:"_get"+F+"Attr",l:F.toLowerCase()}},_set:function(D,E){var F=this[D];this[D]=E;!this._created||F===E||F!==F&&E!==E||(this._watchCallbacks&&this._watchCallbacks(D,F,E),this.emit("attrmodified-"+D,{detail:{prevValue:F,newValue:E}}))},_get:function(D){return this[D]},emit:function(D,E,F){E=E||{};void 0===E.bubbles&&(E.bubbles=!0);void 0===E.cancelable&&(E.cancelable=!0);E.detail||(E.detail={});E.detail.widget=this;var G,O=this["on"+D];O&&(G=O.apply(this,F?F:[E]));this._started&&!this._beingDestroyed&&
k.emit(this.domNode,D.toLowerCase(),E);return G},on:function(D,E){var F=this._onMap(D);return F?c.after(this,F,E,!0):this.own(k(this.domNode,D,E))[0]},_onMap:function(D){var E=this.constructor,F=E._onMap;if(!F){F=E._onMap={};for(var G in E.prototype)/^on/.test(G)&&(F[G.replace(/^on/,"").toLowerCase()]=G)}return F["string"==typeof D&&D.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?x.findWidgets(this.containerNode):
[]},getParent:function(){return x.getEnclosingWidget(this.domNode.parentNode)},connect:function(D,E,F){return this.own(l.connect(D,E,this,F))[0]},disconnect:function(D){D.remove()},subscribe:function(D,E){return this.own(f.subscribe(D,q.hitch(this,E)))[0]},unsubscribe:function(D){D.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():e.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=g.get(this.domNode,"display")},placeAt:function(D,E){var F=
!D.tagName&&x.byId(D);!F||!F.addChild||E&&"number"!==typeof E?(D=F&&"domNode"in F?F.containerNode&&!/after|before|replace/.test(E||"")?F.containerNode:F.domNode:v.byId(D,this.ownerDocument),d.place(this.domNode,D,E),!this._started&&(this.getParent()||{})._started&&this.startup()):F.addChild(this,E);return this},defer:function(D,E){var F=setTimeout(q.hitch(this,function(){F&&(F=null,this._destroyed||q.hitch(this,D)())}),E||0);return{remove:function(){F&&(clearTimeout(F),F=null);return null}}}});p("dojo-bidi")&&
n.extend(A);return n})},"dojo/Stateful":function(){define(["./_base/declare","./_base/lang","./_base/array","./when"],function(a,b,c,n){return a("dojo.Stateful",null,{_attrPairNames:{},_getAttrNames:function(l){var u=this._attrPairNames;return u[l]?u[l]:u[l]={s:"_"+l+"Setter",g:"_"+l+"Getter"}},postscript:function(l){l&&this.set(l)},_get:function(l,u){return"function"===typeof this[u.g]?this[u.g]():this[l]},get:function(l){return this._get(l,this._getAttrNames(l))},set:function(l,u){if("object"===
typeof l){for(var v in l)l.hasOwnProperty(v)&&"_watchCallbacks"!=v&&this.set(v,l[v]);return this}v=this._getAttrNames(l);var m=this._get(l,v);v=this[v.s];var h;"function"===typeof v?h=v.apply(this,Array.prototype.slice.call(arguments,1)):this[l]=u;if(this._watchCallbacks){var d=this;n(h,function(){d._watchCallbacks(l,m,u)})}return this},_changeAttrValue:function(l,u){var v=this.get(l);this[l]=u;this._watchCallbacks&&this._watchCallbacks(l,v,u);return this},watch:function(l,u){var v=this._watchCallbacks;
if(!v){var m=this;v=this._watchCallbacks=function(d,e,g,p){var t=function(q){if(q){q=q.slice();for(var k=0,r=q.length;k<r;k++)q[k].call(m,d,e,g)}};t(v["_"+d]);p||t(v["*"])}}u||"function"!==typeof l?l="_"+l:(u=l,l="*");var h=v[l];"object"!==typeof h&&(h=v[l]=[]);h.push(u);l={};l.unwatch=l.remove=function(){var d=c.indexOf(h,u);-1<d&&h.splice(d,1)};return l}})})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(a,b,c){return c("dijit.Destroyable",
null,{destroy:function(n){this._destroyed=!0},own:function(){var n=["destroyRecursive","destroy","remove"];a.forEach(arguments,function(l){function u(){v.remove();a.forEach(m,function(d){d.remove()})}var v=b.before(this,"destroy",function(d){l[h](d)}),m=[];if(l.then){var h="cancel";l.then(u,u)}else a.forEach(n,function(d){"function"===typeof l[d]&&(h||(h=d),m.push(b.after(l,d,u,!0)))})},this);return arguments}})})},"dijit/registry":function(){define(["dojo/_base/array","dojo/_base/window","./main"],
function(a,b,c){var n={},l={},u={length:0,add:function(v){if(l[v.id])throw Error("Tried to register widget with id\x3d\x3d"+v.id+" but that id is already registered");l[v.id]=v;this.length++},remove:function(v){l[v]&&(delete l[v],this.length--)},byId:function(v){return"string"==typeof v?l[v]:v},byNode:function(v){return l[v.getAttribute("widgetId")]},toArray:function(){var v=[],m;for(m in l)v.push(l[m]);return v},getUniqueId:function(v){do var m=v+"_"+(v in n?++n[v]:n[v]=0);while(l[m]);return"dijit"==
c._scopeName?m:c._scopeName+"_"+m},findWidgets:function(v,m){function h(e){for(e=e.firstChild;e;e=e.nextSibling)if(1==e.nodeType){var g=e.getAttribute("widgetId");g?(g=l[g])&&d.push(g):e!==m&&h(e)}}var d=[];h(v);return d},_destroyAll:function(){c._curFocus=null;c._prevFocus=null;c._activeStack=[];a.forEach(u.findWidgets(b.body()),function(v){v._destroyed||(v.destroyRecursive?v.destroyRecursive():v.destroy&&v.destroy())})},getEnclosingWidget:function(v){for(;v;){var m=1==v.nodeType&&v.getAttribute("widgetId");
if(m)return l[m];v=v.parentNode}return null},_hash:l};return c.registry=u})},"jimu/portalUtils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/config dojo/Deferred dojo/topic dojo/json esri/request ./utils ./portalUrlUtils ./tokenUtils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){var g=a([],{declaredClass:"jimu.Portal",selfUrl:null,user:null,selfInfo:null,portalUrl:null,credential:null,constructor:function(r){this.portalUrl=d.getStandardPortalUrl(r);this.selfUrl=
d.getPortalSelfInfoUrl(r)},loadSelfInfo:function(){var r=new l,y={query:{f:"json"},responseType:"json",callbackParamName:"callback",cacheBust:!0};this.isValidCredential()&&(y.query.token=this.credential.token);m(this.selfUrl,y).then(b.hitch(this,function(f){f=f.data;var w=f.user;delete f.user;b.mixin(this,f);f.user=w;r.resolve(f)}),b.hitch(this,function(f){console.error(f);r.reject(f)}));return r},_checkCredential:function(){var r=e.isValidCredential(this.credential);r||this.clearCredentialAndUser();
return r},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.credential=e.getPortalCredential(this.portalUrl))},signIn:function(){var r=new l;this.updateCredential();this.isValidCredential()?setTimeout(b.hitch(this,function(){r.resolve(this.credential)}),0):r=e.signInPortal(this.portalUrl);return r},haveSignIn:function(){return e.userHaveSignInPortal(this.portalUrl)},clearCredentialAndUser:function(){this.user=
this.credential=null},getSigninSettingsOfSelfInfo:function(){this.updateCredential();var r=new l,y=this.selfUrl+"/signinSettings";this.isValidCredential()?m(y,{handleAs:"json",query:{f:"json",token:this.credential.token},callbackParamName:"callback"}).then(b.hitch(this,function(f){r.resolve(f.data)}),b.hitch(this,function(f){r.reject(f)})):r.resolve({});return r},getUser:function(){this.updateCredential();var r=new l;this.user&&"jimu.PortalUser"===this.user.declaredClass?setTimeout(b.hitch(this,function(){this.user.updateCredential();
r.resolve(this.user)}),0):this.isValidCredential()?this.credential.userId?this._getUser(this.credential.userId).then(b.hitch(this,function(y){this.user=y;r.resolve(this.user)}),b.hitch(this,function(y){console.error(y);r.reject(y)})):e.getUserIdByToken(this.credential.token,this.portalUrl).then(b.hitch(this,function(y){this.credential.userId=y;this._getUser(this.credential.userId).then(b.hitch(this,function(f){this.user=f;r.resolve(this.user)}),b.hitch(this,function(f){console.error(f);r.reject(f)}))}),
b.hitch(this,function(y){console.error(y);r.reject(y)})):setTimeout(b.hitch(this,function(){r.reject("credential is null.")}),0);return r},queryItems:function(r){this.updateCredential();var y=new l,f=d.getBaseSearchUrl(this.portalUrl),w={f:"json"};r&&(w=b.mixin(w,r));this.isValidCredential()&&(w.token=this.credential.token);w.sortField||w.sortOrder||(w.sortField="title",w.sortOrder="asc");m(f,{responseType:"json",query:w,callbackParamName:"callback"}).then(b.hitch(this,function(z){z=z.data;z.results=
c.map(z.results,b.hitch(this,function(A){A.portalUrl=this.portalUrl;A.credential=this.credential;A.portal=this;return new q(A)}));y.resolve(z)}),b.hitch(this,function(z){console.error(z);y.reject(z)}));return y},getItemData:function(r){this.updateCredential();r=d.getItemDataUrl(this.portalUrl,r);var y={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(y.query.token=this.credential.token);var f=new l;m(r,y).then(b.hitch(this,function(w){f.resolve(w.data)}),
b.hitch(this,function(w){f.reject(w)}));return f},getItemById:function(r){var y=new l;this.updateCredential();r=d.getItemUrl(this.portalUrl,r);var f={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(f.query.token=this.credential.token);m(r,f).then(b.hitch(this,function(w){w=w.data;w.portalUrl=this.portalUrl;w.credential=this.credential;w.portal=this;w=new q(w);y.resolve(w)}),b.hitch(this,function(w){console.error(w);y.reject(w)}));return y},getAppById:function(r){var y=
new l;this.updateCredential();this.isValidCredential()?(r=d.getAppIdUrl(this.portalUrl,r),m(r,{responseType:"json",query:{f:"json",token:this.credential.token}}).then(b.hitch(this,function(f){y.resolve(f.data)}),b.hitch(this,function(f){y.reject(f)}))):setTimeout(b.hitch(this,function(){y.reject("token is null.")}),0);return y},queryGroups:function(r){this.updateCredential();var y=new l,f=d.getBaseGroupUrl(this.portalUrl),w={f:"json"};r&&(w=b.mixin(w,r));this.isValidCredential()&&(w.token=this.credential.token);
m(f,{responseType:"json",query:w,callbackParamName:"callback"}).then(b.hitch(this,function(z){z=z.data;z.results=c.map(z.results,b.hitch(this,function(A){A.portalUrl=this.portalUrl;A.credential=this.credential;A.portal=this;return new t(A)}));y.resolve(z)}),b.hitch(this,function(z){console.error(z);y.reject(z)}));return y},registerApp:function(r,y,f){var w=new l;this.updateCredential();if(this.isValidCredential()){var z=this.credential&&this.credential.token,A=d.getOAuth2Url(this.portalUrl);m(A+"/registerApp",
{query:{itemId:r,appType:y,redirect_uris:v.stringify(f),token:z,f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,function(x){w.resolve(x.data)}),b.hitch(this,function(x){w.reject(x)}))}else setTimeout(b.hitch(this,function(){w.reject("token is null.")}),0);return w},createAndRegisterApp:function(r){var y=new l;this.updateCredential();this.isValidCredential()?this.getUser().then(b.hitch(this,function(f){f.addItem({title:"ArcGIS Web AppBuilder",type:"Web Mapping Application",text:"",
snippet:"",tags:"Registered App for OAuth"},"").then(b.hitch(this,function(w){w.success?this.registerApp(w.id,"browser",r).then(b.hitch(this,function(z){y.resolve(z)}),b.hitch(this,function(z){console.error(z);y.reject(z)})):y.reject("create app failed")}),b.hitch(this,function(w){console.error(w);y.reject(w)}))}),b.hitch(this,function(f){console.error(f);y.reject(f)})):setTimeout(b.hitch(this,function(){y.reject("token is null.")}),0);return y},_getUser:function(r){this.updateCredential();var y=
new l;r=d.getUserUrl(this.portalUrl,r);var f={query:{f:"json"},responseType:"json",callbackParamName:"callback"};this.isValidCredential()&&(f.query.token=this.credential&&this.credential.token);m(r,f).then(b.hitch(this,function(w){w=w.data;w.portalUrl=this.portalUrl;w.credential=this.credential;w.portal=this;this.user=new p(w);y.resolve(this.user)}),b.hitch(this,function(w){console.error(w);y.reject(w)}));return y},getItemResources:function(r,y,f){f||(f=100);r=d.getStandardPortalUrl(r);r=d.getItemResourceUrl(r,
y);return m({url:r,content:{f:"json",num:f}}).then(function(w){if(w&&w.resources)return w.resources})},addResource:function(r,y,f,w,z){r=d.getStandardPortalUrl(r);var A=this.getPortal(r),x=new FormData;x.append("file",f,w);x.append("fileName",w);x.append("f","json");var B="";z?(x.append("resourcesPrefix",z),B=z+"/"+w):B=w;return A.getItemById(y,!0).then(function(C){C=d.getUserContentItemUrl(r,C.owner,y);return m({url:C+"/addResources",form:x}).then(function(D){var E="";D&&D.success&&(E=d.getItemResourceUrl(r,
"${itemId}",B));return E},function(D){console.error(D.message||D);return D})})},removeResources:function(r,y,f,w){var z={resource:w?w+"/"+f:f,f:"json"};r=d.getStandardPortalUrl(r);return this.getPortal(r).getItemById(y,!0).then(function(A){A=d.getUserContentItemUrl(r,A.owner,y);return m({url:A+"/removeResources",content:z},{usePost:!0}).then(function(x){return x},function(x){console.error(x.message||x);return x})})}}),p=a([],{declaredClass:"jimu.PortalUser",portalUrl:null,credential:null,portal:null,
constructor:function(r){r&&b.mixin(this,r)},_checkCredential:function(){var r=e.isValidCredential(this.credential);r||(this.credential=null);return r},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},getGroups:function(){var r=[];this.groups&&(r=c.map(this.groups,b.hitch(this,function(y){y.portalUrl=this.portalUrl;y.credential=this.credential;
y.portal=this.portal;return new t(y)})));return r},getItemsByKeywords:function(r,y){return this.portal.queryItems({start:y||1,num:100,q:"owner:"+this.username+' AND typekeywords:"'+r+'"'})},getContent:function(){this.updateCredential();var r=d.getUserContentUrl(this.portalUrl,this.username),y={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential&&(y.query.token=this.credential.token);var f=new l;m(r,y).then(b.hitch(this,function(w){f.resolve(w.data)}),b.hitch(this,
function(w){f.reject(w)}));return f},getTags:function(){this.updateCredential();var r=d.getUserTagsUrl(this.portalUrl,this.username),y={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(y.query.token=this.credential.token);var f=new l;m(r,y).then(b.hitch(this,function(w){f.resolve(w.data)}),b.hitch(this,function(w){f.reject(w)}));return f},addItem:function(r,y){this.updateCredential();var f=new l;if(this.isValidCredential()){var w={f:"json",token:this.credential.token};
r&&(w=b.mixin(w,r));r=d.getAddItemUrl(this.portalUrl,this.username,y);m(r,{responseType:"json",callbackParamName:"callback",query:w,method:"post"}).then(b.hitch(this,function(z){f.resolve(z.data)}),b.hitch(this,function(z){console.error(z);f.reject(z)}))}else setTimeout(b.hitch(this,function(){f.reject("token is null.")}),0);return f},deleteItem:function(r){this.updateCredential();var y=new l;this.isValidCredential()?(r=d.getDeleteItemUrl(this.portalUrl,this.username,r),m(r,{query:{token:this.credential.token,
f:"json"},responseType:"json",method:"post"}).then(b.hitch(this,function(f){y.resolve(f.data)}),b.hitch(this,function(f){y.reject(f)}))):setTimeout(b.hitch(this,function(){y.reject("token is null.")}),0);return y},getItemById:function(r,y){this.updateCredential();var f=new l;y=d.getUserItemsUrl(this.portalUrl,this.username,y);var w={responseType:"json",query:{f:"json"},callbackParamName:"callback"};this.isValidCredential()&&(w.query.token=this.credential.token);m(y+"/"+r,w).then(b.hitch(this,function(z){z=
z.data;z.portalUrl=this.portalUrl;z.credential=this.credential;z.portal=this;z=new q(z);f.resolve(z)}),b.hitch(this,function(z){console.error(z);f.reject(z)}));return f},shareItem:function(r,y,f){this.updateCredential();var w=new l;this.isValidCredential()?(y=d.shareItemUrl(this.portalUrl,this.username,y,f),f={responseType:"json",callbackParamName:"callback",query:{f:"json",token:this.credential.token},method:"post"},r&&(r.content&&!r.query&&(r.query=r.content),f.query=b.mixin(f.query,r)),m(y,f).then(b.hitch(this,
function(z){w.resolve(z.data)}),b.hitch(this,function(z){console.error(z);w.reject(z)}))):setTimeout(b.hitch(this,function(){w.reject("token is null.")}),0);return w},updateItem:function(r,y){this.updateCredential();var f=new l;this.isValidCredential()?this.portal.getItemById(r).then(b.hitch(this,function(w){var z={f:"json",token:this.credential.token};y&&(z=b.mixin(z,y));w=d.getUpdateItemUrl(this.portalUrl,this.username,r,w.ownerFolder);m(w,{responseType:"json",callbackParamName:"callback",timeout:1E5,
query:z,method:"post"}).then(b.hitch(this,function(A){f.resolve(A.data)}),b.hitch(this,function(A){console.error(A);f.reject(A)}))}),b.hitch(this,function(w){console.error(w);f.reject(w)})):setTimeout(b.hitch(this,function(){f.reject("token is null.")}),0);return f},isAdminRole:function(){return"org_admin"===this.role||"account_admin"===this.role},isPublisherRole:function(){return"org_publisher"===this.role||"account_publisher"===this.role},isUserRole:function(){return"org_user"===this.role||"account_user"===
this.role}}),t=a([],{declaredClass:"jimu.PortalGroup",portalUrl:null,credential:null,portal:null,constructor:function(r){r&&b.mixin(this,r)},_checkCredential:function(){var r=e.isValidCredential(this.credential);r||(this.credential=null);return r},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},queryItems:function(r){r.q="group:"+this.id+
" AND "+r.q;return this.portal.queryItems(r)}}),q=a([],{declaredClass:"jimu.PortalItem",itemUrl:null,detailsPageUrl:null,ownerPageUrl:null,portalUrl:null,credential:null,portal:null,token:null,constructor:function(r){r&&b.mixin(this,r);this.itemUrl=d.getItemUrl(this.portalUrl,this.id);!this.thumbnailUrl&&this.thumbnail&&this.itemUrl&&(this.thumbnailUrl=this.itemUrl+"/info/"+this.thumbnail);this.token=this.credential&&this.credential.token;this.thumbnailUrl&&this.token&&(this.thumbnailUrl+="?token\x3d"+
this.token);this.portalUrl&&this.id&&(this.detailsPageUrl=d.getItemDetailsPageUrl(this.portalUrl,this.id));this.portalUrl&&this.owner&&(this.ownerPageUrl=d.getUserProfilePageUrl(this.portalUrl,this.owner))},_checkCredential:function(){var r=e.isValidCredential(this.credential);r||(this.credential=null);return r},isValidCredential:function(){this.updateCredential();return this._checkCredential()},updateCredential:function(){this._checkCredential()||(this.portal.updateCredential(),this.credential=this.portal.credential)},
getItemData:function(){return this.portal.getItemData(this.id)}}),k={portals:[],webMapQueryStr:" "+h.getItemQueryStringByTypes(["Web Map"])+" ",webSceneQueryStr:" "+h.getItemQueryStringByTypes(["Web Scene"])+" ",_findPortal:function(r){for(var y=0;y<this.portals.length;y++){var f=this.portals[y];if(d.isSamePortalUrl(r,f.portalUrl))return f.updateCredential(),f}return null},getPortal:function(r){if(!r||"string"!==typeof r||!b.trim(r))return null;r=d.getStandardPortalUrl(r);var y=this._findPortal(r);
y||(y=new g(r),y.credential=e.getPortalCredential(y.portalUrl),y.updateCredential(),this.portals.push(y));return y},getPortalSelfInfo:function(r){return this.getPortal(r).loadSelfInfo()},getBasemapGalleryGroup:function(r){return this._getPortalSelfGroup(r,"basemapGalleryGroupQuery")},getTemplatesGroup:function(r){return this._getPortalSelfGroup(r,"templatesGroupQuery")},getUnits:function(r){var y="english",f="",w=new l;this.getPortal(r).getUser().then(b.hitch(this,function(z){z&&z.units?y=z.units:
(f=n.locale,y=f.startWith("en")?"english":"metric");w.resolve(y)}),b.hitch(this,function(z){console.warn(z);this.getPortalSelfInfo(r).then(b.hitch(this,function(A){var x=null;A&&A.units?x=A.units:(f=A&&A.culture||n.locale,x=f.startWith("en")?"english":"metric");w.resolve(x)}),b.hitch(this,function(A){console.warn(A);f=n.locale;y=f.startWith("en")?"english":"metric";w.resolve(y)}))}));return w.promise},_getPortalSelfGroup:function(r,y){var f=new l,w=this.getPortal(r);w||setTimeout(b.hitch(this,function(){f.reject()}),
0);this.getPortalSelfInfo(r).then(b.hitch(this,function(z){w.queryGroups({f:"json",q:z[y]}).then(b.hitch(this,function(A){0<A.results.length?(A=A.results[0],A.portalUrl=w.portalUrl,A.credential=w.credential,A.portal=w,A=new t(A),f.resolve(A)):f.reject("Can't find portal self group.")}),b.hitch(this,function(A){console.error(A);f.reject(A)}))}),b.hitch(this,function(z){console.error(z);f.reject(z)}));return f},getWebMapsFromBasemapGalleryGroup:function(r){var y=new l;this.getBasemapGalleryGroup(r).then(b.hitch(this,
function(f){f?f.queryItems({start:1,num:100,f:"json",q:this.webMapQueryStr}).then(b.hitch(this,function(w){y.resolve(w)}),b.hitch(this,function(w){console.error(w);y.reject(w)})):y.reject()}),b.hitch(this,function(f){console.error(f);y.reject(f)}));return y},getDefaultWebScene:function(r){var y=new l,f=this.getPortal(r);f.getUser().then(b.hitch(this,function(w){f.queryItems({start:1,num:1,f:"json",q:this.webSceneQueryStr+' AND owner:"'+w.username+'" ',sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,
function(z){z=z.results;z=c.filter(z,b.hitch(this,function(A){return A.type&&"web scene"===A.type.toLowerCase()}));0<z.length?y.resolve(z[0].id):y.resolve(null)}),b.hitch(this,function(z){y.reject(z)}))}),b.hitch(this,function(){y.reject("not sign in")}));return y},getDefaultWebMap:function(r){var y=new l;this.getPortalSelfInfo(r).then(b.hitch(this,function(f){var w=f.defaultBasemap&&f.defaultBasemap.id;w?y.resolve(w):this._getDefaultWebMapByBasemapGallery(r,f).then(b.hitch(this,function(z){z?y.resolve(z):
this._getMostNumViewsWebMap(r).then(b.hitch(this,function(A){A?y.resolve(A):y.reject()}),b.hitch(this,function(A){console.error(A);y.reject(A)}))}),b.hitch(this,function(z){console.error(z);y.reject(z)}))}),b.hitch(this,function(f){console.error(f);y.reject(f)}));return y},_getDefaultWebMapByBasemapGallery:function(r,y){var f=new l,w=this.getPortal(r),z=y.defaultBasemap&&y.defaultBasemap.title;w.queryGroups({f:"json",q:y.basemapGalleryGroupQuery}).then(b.hitch(this,function(A){A=A.results;0<A.length?
w.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND group:"+A[0].id+" AND title:"+z}).then(b.hitch(this,function(x){x=x.results;x=c.filter(x,b.hitch(this,function(B){return B.type&&"web map"===B.type.toLowerCase()}));0<x.length?f.resolve(x[0].id):(console.log("Can't find web map under basemapGalleryGroupQuery."),w.queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND title:"+z}).then(b.hitch(this,function(B){B=B.results;B=c.filter(B,b.hitch(this,function(D){return D.type&&"web map"===
D.type.toLowerCase()}));if(0<B.length){var C=B[0];w.getItemData(C.id).then(b.hitch(this,function(D){D&&(D.operationalLayers||D.baseMap||D.version)?f.resolve(C.id):f.resolve(null)}),b.hitch(this,function(){f.resolve(null)}))}else console.log("Can't find web map by defaultBasemap.title."),f.resolve(null)}),b.hitch(this,function(B){console.error(B);f.reject(B)})))}),b.hitch(this,function(x){console.error(x);f.reject(x)})):(console.log("Can't find group by basemapGalleryGroupQuery."),f.resolve(null))}),
b.hitch(this,function(A){console.error(A);f.reject(A)}));return f},_getMostNumViewsWebMap:function(r){var y=new l;this.getPortal(r).queryItems({start:1,num:1,f:"json",q:this.webMapQueryStr+" AND access:public AND owner:esri_en",sortField:"numViews",sortOrder:"desc"}).then(b.hitch(this,function(f){f=f.results;f=c.filter(f,b.hitch(this,function(w){return w.type&&"web map"===w.type.toLowerCase()}));0<f.length?y.resolve(f[0].id):y.reject("Can't find most-num-views web map.")}),b.hitch(this,function(f){console.error(f);
y.reject(f)}));return y}};u.subscribe("userSignOut",function(r){(r=k._findPortal(r))&&r.clearCredentialAndUser()});return k})},"jimu/shared/AppVersionManager":function(){define(["./BaseVersionManager"],function(a){function b(){this.versions=[{version:"2.0beta",description:"The version for Developer Edition beta 2.0.",upgrader:function(c){return c},compatible:!0},{version:"2.0",description:"The version for Online 4.1.",upgrader:function(c){return c},compatible:!0},{version:"2.0.1",description:"The version for Developer Edition 2.0.",
upgrader:function(c){var n=null,l=0,u=c.widgetOnScreen.widgets;if(u&&0<u.length)for(l=0;l<u.length;l++)n=u[l],"widgets/Viz/Widget"===n.uri&&(n.uri="widgets/3DFx/Widget",n.name="3DFx");if((u=c.widgetPool.widgets)&&0<u.length)for(l=0;l<u.length;l++)n=u[l],"widgets/Viz/Widget"===n.uri&&(n.uri="widgets/3DFx/Widget",n.name="3DFx");return c},compatible:!0},{version:"2.1",description:"The version for Online 4.2.",upgrader:function(c){return c},compatible:!0},{version:"2.2",description:"The version for Online 4.3.",
upgrader:function(c){return c},compatible:!0},{version:"2.3",description:"The version for Online 4.4.",upgrader:function(c){return c},compatible:!0},{version:"2.4",description:"The version for Online 5.1.",upgrader:function(c){return c},compatible:!0},{version:"2.5",description:"The version for Online 5.2.",upgrader:function(c){return c},compatible:!0},{version:"2.6",description:"The version for Online 5.3.",upgrader:function(c){return c},compatible:!0},{version:"2.7",description:"The version for Online 5.4.",
upgrader:function(c){(function(){function n(l){var u=0,v=0;if(c[l].widgets)for(u=0;u<c[l].widgets.length;u++)if("widgets/Environment/Widget"===c[l].widgets[u].uri){c[l].widgets[u].uri="widgets/Daylight/Widget";break}if(c[l].groups)for(u=0;u<c[l].groups.length;u++){var m=c[l].groups[u];for(v=0;v<m.widgets.length;v++)if("widgets/Environment/Widget"===m.widgets[v].uri){m.widgets[v].uri="widgets/Daylight/Widget";break}}}n("widgetOnScreen");n("widgetPool")})();return c},compatible:!0},{version:"2.8",description:"The version for Online 6.1.",
upgrader:function(c){return c},compatible:!0},{version:"2.9",description:"The version for Online 6.2.",upgrader:function(c){return c},compatible:!0},{version:"2.10",description:"The version for Online 6.3.",upgrader:function(c){return c},compatible:!0},{version:"2.11",description:"The version for Online 6.4.",upgrader:function(c){return c},compatible:!0},{version:"2.12",description:"The version for Online 7.1",upgrader:function(c){return c},compatible:!0},{version:"2.13",description:"The version for Online 7.2",
upgrader:function(c){return c},compatible:!0},{version:"2.14",description:"The version for Online 7.3",upgrader:function(c){return c},compatible:!0},{version:"2.15",description:"The version for Online 7.4",upgrader:function(c){return c},compatible:!0},{version:"2.16",description:"The version for Online 8.1",upgrader:function(c){return c},compatible:!0},{version:"2.17",description:"The version for Online 8.2",upgrader:function(c){return c},compatible:!0},{version:"2.18",description:"The version for Online 8.3",
upgrader:function(c){return c},compatible:!0},{version:"2.19",description:"The version for Online 8.4",upgrader:function(c){return c},compatible:!0},{version:"2.20",description:"The version for Online 9.1",upgrader:function(c){return c},compatible:!0},{version:"2.21",description:"The version for Online 9.2",upgrader:function(c){return c},compatible:!0},{version:"2.22",description:"The version for Online 9.3",upgrader:function(c){return c},compatible:!0},{version:"2.23",description:"The version for Online 9.4",
upgrader:function(c){return c},compatible:!0},{version:"2.24",description:"The version for Online 10.1",upgrader:function(c){return c},compatible:!0},{version:"2.25",description:"The version for Online 10.2",upgrader:function(c){return c},compatible:!0}];this.isCompatible=function(c,n){c=this.getVersionIndex(c);n=this.getVersionIndex(n);for(c+=1;c<=n;c++)if(!1===this.versions[c].compatible)return!1;return!0}}b.prototype=new a;return b.prototype.constructor=b})},"jimu/shared/BaseVersionManager":function(){define(function(){return function(){this.versions=
[];this.upgrade=function(a,b,c){b=this.getVersionIndex(b);c=this.getVersionIndex(c);if(b>=c)throw Error("New version should be higher than the old version.");for(b+=1;b<=c;b++)this.versions[b].upgrader&&(a=this.versions[b].upgrader(a));return a};this.getVersionIndex=function(a){a=this.fixVersion(a);var b,c;for(c=0;c<this.versions.length;c++)this.versions[c].version===a&&(b=c);null===a&&(b=-1);void 0===b&&(b=this.versions.length-1);return b};this.fixVersion=function(a){return a?a:null}}})},"jimu/ConfigLoader":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/config dojo/cookie dojo/Deferred dojo/promise/all dojo/request/xhr ./utils ./privilegeUtils ./WidgetManager ./shared/utils ./tokenUtils ./portalUtils ./appConfigResourceUtils ./portalUrlUtils ./AppStateManager esri/identity/IdentityManager esri/core/urlUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){var z=null;var A=a(null,{urlParams:null,appConfig:null,rawAppConfig:null,configFile:null,_configLoaded:!1,portalSelf:null,constructor:function(x,B){this._removeHash(x);this.urlParams=x||{};this.widgetManager=g.getInstance();b.mixin(this,B)},loadConfig:function(){console.time("Load Config");return this._tryLoadConfig().then(b.hitch(this,function(x){var B=this.checkConfig(x);if(B)throw B;this.rawAppConfig=b.clone(x);y.getInstance().setRawAppConfig(this.rawAppConfig);
x=this._upgradeAppConfig(x);this._processAfterTryLoad(x);this.appConfig=x;if(this.urlParams.id)return this.loadWidgetsManifest(x).then(b.hitch(this,function(){return this._upgradeAllWidgetsConfig(x)})).then(b.hitch(this,function(C){return this.insertAppIdtoResourceUrlofAppConfig(C,this.urlParams.id)})).then(b.hitch(this,function(){this._configLoaded=!0;x.title&&(document.title=window.isBuilder?d.stripHTML(x.title)+" - ArcGIS Web AppBuilder":d.stripHTML(x.title));this._readAndSetSharedTheme(x);return this.getAppConfig()}));
t.setPortalUrl(x.portalUrl);return this._proesssWebTierAndSignin(x).then(b.hitch(this,function(){if(this.urlParams.appid){if(window.appInfo.isRunInPortal){var C=r.getStandardPortalUrl(x.portalUrl),D=q.getPortal(C);return e.checkIsSelfOrigin(this.urlParams.appid,D,t.isInBuilderWindow()).then(b.hitch(this,function(E){if(!E)throw E=Error(window.jimuNls.orgUrlMessage),E.isSelfOrigin=!1,E;})).then(b.hitch(this,function(){return e.checkEssentialAppsLicense(this.urlParams.appid,D,t.isInBuilderWindow()).then(b.hitch(this,
function(){return this._getAppConfigFromTemplateAppId(x.portalUrl,this.urlParams.appid).then(b.hitch(this,function(E){this._tryUpdateAppConfigByLocationUrl(E);return this._processInPortalAppProtocol(E)}))}),b.hitch(this,function(E){console.error(E);if(E&&E.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))}))}return this._processNotInPortalAppProtocol(x).then(b.hitch(this,function(E){return this._getAppDataAddTemplateDataFromTemplateAppId(E.portalUrl,
this.urlParams.appid).then(b.hitch(this,function(F){F.appData.appConfig&&(E=F.appData.appConfig);E._appData=F.appData;E.templateConfig=F.templateData;E.isTemplateApp=!0;return E}))}))}return this._processNotInPortalAppProtocol(x)})).then(b.hitch(this,function(C){this._processAfterTryLoad(C);this.appConfig=C;return C.map.itemId?C:q.getDefaultWebScene(C.portalUrl).then(function(D){C.map.itemId=D;return C})})).then(b.hitch(this,function(C){return this.loadWidgetsManifest(C)})).then(b.hitch(this,function(C){return C._appData?
C._appData.values&&C._appData.values.webmap?q.getPortal(C.portalUrl).getItemById(C._appData.values.webmap).then(b.hitch(this,function(D){return d.template.mergeTemplateAppConfigToAppConfig(C,C._appData,D)})):d.template.mergeTemplateAppConfigToAppConfig(C,C._appData):C})).then(b.hitch(this,function(C){return this._upgradeAllWidgetsConfig(C)})).then(b.hitch(this,function(C){return C._wabAppId?this.processResourceInAppConfigForConfigLoader(C,this.urlParams):C.appItemId&&-1<window.JSON.stringify(C).indexOf("${itemId}")?
this.insertAppIdtoResourceUrlofAppConfig(C,C.appItemId):C})).then(b.hitch(this,function(C){this.appConfig=C;this._configLoaded=!0;C.title&&(document.title=d.stripHTML(C.title));this._readAndSetSharedTheme(C);return this.getAppConfig()}))}),b.hitch(this,function(x){var B=new v;B.reject(x);return B}))},processResourceInAppConfigForConfigLoader:function(x,B){var C=x.portalUrl,D=x.appItemId,E=B.appid,F=new v,G=b.clone(x);this.insertAppIdtoResourceUrlofAppConfig(G,E).then(function(){if("config"===B.mode){var O=
this.getResourceUrlsOfAppConfig(x).result;0!==O.length?q.getItemResources(C,E).then(function(K){if(0===K.length)return O=O.map(function(L){return{resUrl:L}}),k.AddResourcesToItemForAppSave(C,O,D,E).then(function(){F.resolve(G)},function(L){console.warn("Add resource to template based app error:"+L.message||L);F.resolve(G)});F.resolve(G)},function(K){console.warn("Get resource of template based item error:"+K.message||K);F.resolve(G)}):F.resolve(G)}else F.resolve(G)}.bind(this),function(O){console.warn("Insert appId to resource url of appConfig error:"+
O.message||O);F.resolve(G)});return F},getResourceUrlsOfAppConfig:function(x){var B={test:function(C){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(C)},func:b.hitch(this,function(C){return C.value})};return d.processItemResourceOfAppConfig(x,B)},insertAppIdtoResourceUrlofAppConfig:function(x,B){function C(G){return/^https?:\/\/(.)+\/sharing\/rest\/content\/items/.test(G)}function D(G,O){var K=O.obj,L=O.key,R={obj:K,key:L};"number"===typeof O.i?(R.i=O.i,R.value=K[L][O.i]):R.value=K[L];
O=R;G=F.processItemIdAndTokenOfResources(O.value,G);K=O.obj;L=O.key;"number"===typeof O.i?K[L][O.i]=G:K[L]=G;return!0}var E=x.portalUrl,F=this;return q.getPortal(E).getItemById(B).then(b.hitch(this,function(G){G={test:C,func:b.hitch(this,D,{appId:B,isPublic:"public"===G.access,portalUrl:E})};return d.processItemResourceOfAppConfig(x,G).appConfig}))},processItemIdAndTokenOfResources:function(x,B){0<x.indexOf("${itemId}")&&(x=x.replace("${itemId}",B.appId));/(\?|&)token=.+/.test(x)&&(x=x.replace(/(\?|&)token=.+/,
""));B.isPublic||(B=t.getPortalCredential(B.portalUrl))&&(x+="?token\x3d"+B.token);return x},getAppConfig:function(){var x=b.clone(this.appConfig);x.getConfigElementById=function(B){return d.getConfigElementById(this,B)};x.getConfigElementsByName=function(B){return d.getConfigElementsByName(this,B)};x.visitElement=function(B){d.visitElement(this,B)};this._addAuthorizedCrossOriginDomains(this.portalSelf,x);return x},_addAuthorizedCrossOriginDomains:function(x,B){x&&x.authorizedCrossOriginDomains&&
t.addAuthorizedCrossOriginDomains(x.authorizedCrossOriginDomains);B&&B.authorizedCrossOriginDomains&&t.addAuthorizedCrossOriginDomains(B.authorizedCrossOriginDomains)},checkConfig:function(x){return(x=this._getRepeatedId(x))?"repeated id:"+x:null},processProxy:function(x){var B=d.getEsriConfigRequestObject();B.alwaysUseProxy=x.httpProxy&&x.httpProxy.useProxy&&x.httpProxy.alwaysUseProxy;B.proxyUrl="";B.proxyRules=[];x.httpProxy&&x.httpProxy.useProxy&&x.httpProxy.url&&(B.proxyUrl=x.httpProxy.url);x.httpProxy&&
x.httpProxy.useProxy&&x.httpProxy.rules&&c.forEach(x.httpProxy.rules,function(C){w.addProxyRule(C)})},addNeedValues:function(x){this._processNoUriWidgets(x);this._processEmptyGroups(x);this._addElementId(x);this._processWidgetJsons(x)},showError:function(x){n.create("div",{"class":"app-error",innerHTML:d.sanitizeHTML(x.message)},document.body)},_tryLoadConfig:function(){if(this.urlParams.config)return this.configFile=this.urlParams.config,h(this.configFile,{handleAs:"json",headers:{"X-Requested-With":null}}).then(b.hitch(this,
function(D){t.setPortalUrl(D.portalUrl);D.portalUrl&&(window.portalUrl=D.portalUrl);return this.urlParams.token?t.registerToken(this.urlParams.token).then(function(){return D}):D}));if(this.urlParams.id){window.appInfo.isRunInPortal=!0;var x=r.getPortalUrlFromLocation(),B=new v;t.setPortalUrl(x);window.portalUrl=x;if(this.urlParams.token)var C=t.registerToken(this.urlParams.token);else C=new v,C.resolve();C.then(b.hitch(this,function(){var D=q.getPortal(x);D.loadSelfInfo().then(b.hitch(this,function(E){this.portalSelf=
E;E.allSSL&&"http:"===window.location.protocol?(window.location.href=r.setHttpsProtocol(window.location.href),B.reject()):this._processSignIn(x).then(b.hitch(this,function(){this._getAppConfigFromAppId(x,this.urlParams.id).then(b.hitch(this,function(F){return e.checkIsSelfOrigin(this.urlParams.id,D,t.isInBuilderWindow()).then(b.hitch(this,function(G){if(G)return F;G=Error(window.jimuNls.orgUrlMessage);G.isSelfOrigin=!1;throw G;}))})).then(b.hitch(this,function(F){return e.checkEssentialAppsLicense(this.urlParams.id,
D,t.isInBuilderWindow()).then(b.hitch(this,function(){this._tryUpdateAppConfigByLocationUrl(F);return this._processInPortalAppProtocol(F)}),b.hitch(this,function(G){console.error(G);if(G&&G.isBlockedByOrg)throw Error(window.jimuNls.blockedByAdminErrorForApp);throw Error(window.jimuNls.essentialAppsLicenseErrorForApp);}))})).then(function(F){B.resolve(F)},function(F){B.reject(F)})}))}))}),b.hitch(this,function(D){this.showError(D)}));return B}this.configFile="config.json";return h(this.configFile,
{handleAs:"json"}).then(b.hitch(this,function(D){t.setPortalUrl(D.portalUrl);D.portalUrl&&(window.portalUrl=D.portalUrl);return this.urlParams.token?t.registerToken(this.urlParams.token).then(function(){return D}):D}))},_upgradeAppConfig:function(x){var B=window.wabVersion,C=x.wabVersion;if(B===C)return x;var D=this.versionManager.getVersionIndex(C),E=this.versionManager.getVersionIndex(B);if(D>E)throw Error("Bad version number, "+C);x=this.versionManager.upgrade(x,C,B);x.wabVersion=B;x.isUpgraded=
!0;return x},_upgradeAllWidgetsConfig:function(x){var B=new v,C=[];if(!x.isUpgraded)return B.resolve(x),B;delete x.isUpgraded;p.visitElement(x,b.hitch(this,function(D){D.uri&&(D.config?(D=this.widgetManager.tryLoadWidgetConfig(D),C.push(D)):D.version=D.manifest.version)}));m(C).then(b.hitch(this,function(){B.resolve(x)}),function(D){B.reject(D)});return B},_processAfterTryLoad:function(x){this._setPortalUrl(x);this._tryUpdateAppConfigByLocationUrl(x);this._processUrlParams(x);this.addNeedValues(x);
this.processProxy(x);f.tokenValidity=10080;return x},_readAndSetSharedTheme:function(x){x.theme.sharedTheme||(x.theme.sharedTheme={useHeader:!1,useLogo:!1},x.theme.sharedTheme.isPortalSupport=this.portalSelf.portalProperties&&this.portalSelf.portalProperties.sharedTheme?!0:!1);x.theme.sharedTheme.useHeader&&(x.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(x.theme.customStyles={mainBackgroundColor:this.portalSelf.portalProperties.sharedTheme.header.background},x.titleColor=this.portalSelf.portalProperties.sharedTheme.header.text):
console.error("Portal does not support sharedTheme."));x.theme.sharedTheme.useLogo&&(x.theme.sharedTheme.isPortalSupport&&this.portalSelf.portalProperties?(x.logo=this.portalSelf.portalProperties.sharedTheme.logo.small?this.portalSelf.portalProperties.sharedTheme.logo.small:"images/app-logo.png",!x.logoLink&&this.portalSelf.portalProperties.sharedTheme.logo.link&&(x.logoLink=this.portalSelf.portalProperties.sharedTheme.logo.link)):(console.error("Portal does not support sharedTheme, use default logo."),
x.logo="images/app-logo.png"))},_tryUpdateAppConfigByLocationUrl:function(x){if(!(this.urlParams.config&&-1<this.urlParams.config.indexOf("arcgis.com/sharing/rest/content/items/"))){var B=r.getPortalUrlFromLocation();B=r.getStandardPortalUrl(B);r.isOnline(B)&&(B=r.updateUrlProtocolByOtherUrl(B,x.portalUrl),x.map.portalUrl&&r.isSamePortalUrl(x.portalUrl,x.map.portalUrl)&&(x.map.portalUrl=B),x.portalUrl=B,x.httpProxy&&x.httpProxy.url&&(x.httpProxy.url=r.getPortalProxyUrl(B)))}},_processWidgetJsons:function(x){p.visitElement(x,
function(B,C){C.isWidget&&B.uri&&d.processWidgetSetting(B)})},_processNoUriWidgets:function(x){var B=0;p.visitElement(x,function(C,D){D.isWidget&&!C.uri&&(B++,C.placeholderIndex=B)})},_processEmptyGroups:function(x){var B=0;x.widgetOnScreen.groups&&c.forEach(x.widgetOnScreen.groups,function(C){if(!C.widgets||C.widgets&&0===C.widgets.length)B++,C.placeholderIndex=B})},_addElementId:function(x){var B=0,C;p.visitElement(x,function(D){if(D.id){D.id=D.id.replace(/\//g,"_");var E=D.id.lastIndexOf("_");
-1<E&&(C=D.id.substr(E+1),B=Math.max(B,C))}});p.visitElement(x,function(D){D.id||(B++,D.id=D.uri?D.uri.replace(/\//g,"_")+"_"+B:"_"+B)})},_setPortalUrl:function(x){if(x.portalUrl){var B=r.getPortalUrlFromLocation(),C=r.isOnline(B);r.isSamePortalUrl(x.portalUrl,B)||C||(window.appInfo.isRunInPortal=!1)}else window.isXT&&u("wab_portalurl")?x.portalUrl=u("wab_portalurl"):(window.appInfo.isRunInPortal=!0,x.portalUrl=r.getPortalUrlFromLocation())},_changePortalUrlProtocol:function(x,B){x.portalUrl=r.setProtocol(x.portalUrl,
B);x.map.portalUrl&&(x.map.portalUrl=r.setProtocol(x.map.portalUrl,B));x.httpProxy&&(x.httpProxy.url=r.setProtocol(x.httpProxy.url,B),x.httpProxy&&x.httpProxy.rules&&c.forEach(x.httpProxy.rules,b.hitch(this,function(C){C.proxyUrl=r.setProtocol(C.proxyUrl,B)})))},_processInPortalAppProtocol:function(x){var B=new v,C=q.getPortal(x.portalUrl),D=b.hitch(this,function(E){if("https:"===window.location.protocol)this._changePortalUrlProtocol(x,"https");else{if(E){window.location.href=r.setHttpsProtocol(window.location.href);
B.reject();return}this._changePortalUrlProtocol(x,"http")}this._checkLocale();B.resolve(x)});C.loadSelfInfo().then(b.hitch(this,function(E){this.portalSelf=E;"private"===E.access?(E=0===x.portalUrl.toLowerCase().indexOf("https://"),D(E)):D(E.allSSL)}),b.hitch(this,function(E){B.reject(E)}));return B},_processNotInPortalAppProtocol:function(x){var B=new v;x.portalUrl?q.getPortal(x.portalUrl).loadSelfInfo().then(b.hitch(this,function(C){this.portalSelf=C;var D="https:"===window.location.protocol;(C.allSSL||
D)&&this._changePortalUrlProtocol(x,"https");0!==x.portalUrl.toLowerCase().indexOf("https://")||D||t.isInConfigOrPreviewWindow()?B.resolve(x):(window.location.href=r.setHttpsProtocol(window.location.href),B.reject())}),b.hitch(this,function(C){B.reject(C)})):B.resolve(x);return B},_proesssWebTierAndSignin:function(x){var B=new v,C=!1,D=x.portalUrl;this._processWebTier(x).then(b.hitch(this,function(E){C=E;return q.getPortal(D).loadSelfInfo()})).then(b.hitch(this,function(E){this.portalSelf=E;return this._processSignIn(D,
C)})).then(b.hitch(this,function(){B.resolve()}),function(E){B.reject(E)});return B},_processWebTier:function(x){var B=new v,C=x.portalUrl;x.isWebTier?(t.addAuthorizedCrossOriginDomains([C]),t.isWebTierPortal(C).then(b.hitch(this,function(){var D=t.getPortalCredential(C);D&&D.ssl&&"http:"===window.location.protocol&&!t.isInConfigOrPreviewWindow()?window.location.href=r.setHttpsProtocol(window.location.href):B.resolve(x.isWebTier)}),b.hitch(this,function(D){B.reject(D)}))):B.resolve(!1);return B},
_processSignIn:function(x,B){var C=new v,D=q.getPortal(x),E=r.getSharingUrl(x);window.appInfo.isRunInPortal?(B=f.checkSignInStatus(E),B.catch(function(){}).then(b.hitch(this,function(){C.resolve()}))):(t.isInBuilderWindow()||t.isInConfigOrPreviewWindow()||!this.portalSelf.supportsOAuth||!this.rawAppConfig.appId||B||t.registerOAuthInfo(x,this.rawAppConfig.appId,this.portalSelf.currentVersion),B=f.checkSignInStatus(E),B.catch(function(){}).then(b.hitch(this,function(){t.xtGetCredentialFromCookie(x);
D.loadSelfInfo().then(b.hitch(this,function(F){this.portalSelf=F;this._checkLocale();C.resolve()}))})));return C},_checkLocale:function(){if(!t.isInConfigOrPreviewWindow()){var x=this.portalSelf.user&&this.portalSelf.user.culture||l.locale;x="hi"===x?"en":x.toLowerCase();!this.urlParams.locale&&d.isLocaleChanged(l.locale,x)&&(u("wab_app_locale",x),window.location.reload())}},_getAppConfigFromTemplateAppId:function(x,B){var C=q.getPortal(x);return this._getWabAppIdAndDataFromTemplateAppId(x,B).then(b.hitch(this,
function(D){var E=D.appId,F=D.appData;return m([this._getAppConfigFromAppId(x,E),C.getItemData(F.source)]).then(b.hitch(this,function(G){if(F.appConfig){var O=F.appConfig;delete F.appConfig}else O=G[0];O=this._upgradeAppConfig(O);G=G[1];O._appData=F;O._wabAppId=E;O.templateConfig=G;O.isTemplateApp=!0;return O}))}))},_getAppDataAddTemplateDataFromTemplateAppId:function(x,B){var C=q.getPortal(x);return C.getItemData(B).then(function(D){return C.getItemData(D.source).then(function(E){return{appData:D,
templateData:E}})})},_getWabAppIdAndDataFromTemplateAppId:function(x,B){var C=new v,D=q.getPortal(x);D.getItemData(B).then(b.hitch(this,function(E){D.getItemById(E.source).then(b.hitch(this,function(F){F=w.urlToObject(F.url);C.resolve({appId:F.query.id,appData:E})}))}),function(E){C.reject(E)});return C},_getAppConfigFromAppId:function(x,B){return q.getPortal(x).getItemData(B)},_removeHash:function(x){for(var B in x)x[B]&&(x[B]=x[B].replace("#",""))},loadWidgetsManifest:function(x){function B(F,G,
O){function K(L){return F.loadWidgetManifest(L).then(function(R){return R},function(R){console.log("Widget failed to load, it is removed.",L.name);R.stack?console.error(R.stack):console.log(R);C(x,L)})}return G.itemId?q.getPortal(O).getItemById(G.itemId).then(function(L){var R=d.isEsriDomain(L.url)?!0:t.getPortalCredential(x.portalUrl)?!0:!1;if(R)return G.uri=d.widgetJson.getUriFromItem(L),K(G);console.log("Widget is not useable, it is removed.",G.name);C(x,G)}):K(G)}function C(F,G){function O(K){F[K]&&
F[K].widgets&&(F[K].widgets=F[K].widgets.filter(function(L){if(G)return L.id!==G.id;L.uri&&!L.manifest&&console.error("Widget is removed because it is not loaded successfully.",L.uri);return L.manifest}));F[K]&&F[K].groups&&F[K].groups.forEach(function(L){L.widgets&&(L.widgets=L.widgets.filter(function(R){if(G)return R.id!==G.id;R.uri&&!R.manifest&&console.error("Widget is removed because it is not loaded successfully.",R.uri);return R.manifest}))})}O("widgetOnScreen");O("widgetPool")}var D=[],E=
new v;x._buildInfo&&x._buildInfo.widgetManifestsMerged?this._loadMergedWidgetManifests().then(b.hitch(this,function(F){p.visitElement(x,b.hitch(this,function(G){G.widgets||!G.uri&&!G.itemId||(G.uri&&F[G.uri]?(this._addNeedValuesForManifest(F[G.uri],G.uri),d.widgetJson.addManifest2WidgetJson(G,F[G.uri])):D.push(B(this.widgetManager,G,x.portalUrl)))}));m(D).then(function(){E.resolve(x)})})):(p.visitElement(x,b.hitch(this,function(F){F.widgets||!F.uri&&!F.itemId||D.push(B(this.widgetManager,F,x.portalUrl))})),
m(D).then(function(){E.resolve(x)}));setTimeout(function(){E.isResolved()||(C(x),E.resolve(x))},6E4);return E},_addNeedValuesForManifest:function(x,B){b.mixin(x,d.getUriInfo(B));d.addManifestProperies(x);d.processManifestLabel(x,l.locale)},_loadMergedWidgetManifests:function(){return h(window.appInfo.appPath+"widgets/widgets-manifest.json",{handleAs:"json"})},_getRepeatedId:function(x){var B=[],C;p.visitElement(x,function(D){if(0<B.indexOf(D.id))return C=D.id,!0;B.push(D.id)});return C},_processUrlParams:function(x){var B=
this.urlParams.itemid||this.urlParams.webmap;B&&x.map.itemId!==B&&(x.map.mapOptions&&d.deleteMapOptions(x.map.mapOptions),x.map.itemId=B);this.urlParams.mode&&(x.mode=this.urlParams.mode);x.map.mapOptions||(x.map.mapOptions={});this.urlParams.scale&&(x.map.mapOptions.scale=this.urlParams.scale);if(this.urlParams.level||this.urlParams.zoom)x.map.mapOptions.zoom=this.urlParams.level||this.urlParams.zoom}});A.getInstance=function(x,B){null===z?z=new A(x,B):(z.urlParams=x,z.options=B);return z};return A})},
"jimu/privilegeUtils":function(){define(["dojo/Deferred","esri/identity/IdentityManager","esri/request","jimu/tokenUtils","jimu/portalUrlUtils"],function(a,b,c,n,l){return{checkEssentialAppsLicense:function(u,v,m){var h=l.getStandardPortalUrl(v.portalUrl),d=l.getSharingUrl(h),e=new a;(m?b.checkAppAccess(d,"arcgisWebApps"):v.getItemById(u).then(function(g){return"public"===g.access?{isPublicApp:!0}:b.checkAppAccess(d,"arcgisWebApps",{force:!0})})).then(function(g){v.getSigninSettingsOfSelfInfo().then(function(p){p&&
p.blockedApps&&p.blockedApps.indexOf&&-1<p.blockedApps.indexOf("webappbuilder")?e.reject({message:"wab is blocked by org admin",isBlockedByOrg:!0}):e.resolve(g)},function(p){e.reject({message:p&&p.message,isBlockedByOrg:!1})})},function(g){e.reject({message:g&&g.message,isBlockedByOrg:!1})});return e},checkIsSelfOrigin:function(u,v,m){var h=!0,d=l.getPortalUrlFromLocation();d=l.getStandardPortalUrl(d);u=l.getItemUrl(d,u);var e=window.location.host;d=n.userHaveSignInPortal(d);e=0<=["www.arcgis.com",
"devext.arcgis.com","qaext.arcgis.com"].indexOf(e);var g=window.location!==window.parent.location;if(v.isPortal||m||e||d||g)v=new a,v.resolve(h);else return c(u,{handleAs:"json",query:{f:"json"},callbackParamName:"callback"}).then(function(p){p=p.data;p.contentOrigin&&"self"!==p.contentOrigin&&(h=!1);return h});return v}}})},"jimu/appConfigResourceUtils":function(){define(["dojo/Deferred","dojo/promise/all","jimu/portalUtils","jimu/utils"],function(a,b,c,n){return{AddResourcesToItemForAppSave:function(l,
u,v,m){u=u||[];if(0===u.length){var h=new a;h.resolve(u);return h}u=u.map(function(d){var e=d.resUrl.split("resources/")[1],g=new a;d.b64?(d=n.b64toBlob(d.b64),g.resolve({blob:d,fileName:e.split("/")[1],prefixName:e.split("/")[0]})):(d=d.resUrl,0<d.indexOf("${itemId}")&&(d=d.replace("${itemId}",v)),n.resourcesUrlToBlob(d).then(function(p){g.resolve({blob:p,fileName:e.split("/")[1],prefixName:e.split("/")[0]},function(t){console.error(t.message||t);g.reject(t)})}));return g});return b(u).then(function(d){if(d instanceof
Array&&0<d.length)return d=d.map(function(e){var g=v;m&&(g=m);return c.addResource(l,g,e.blob,e.fileName,e.prefixName)}.bind(this)),b(d).then(function(e){return e})}.bind(this))}}})},"jimu/AppStateManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/json esri/geometry/Extent esri/geometry/SpatialReference libs/storejs/store libs/md5/md5 jimu/tokenUtils".split(" "),function(a,b,c,n,l,u,v,m,h){var d=null,e=a(null,{rawAppConfig:null,mapMd5:null,appStateKey:null,setRawAppConfig:function(g){this.rawAppConfig=
g},_getAppStateMd5:function(){if("string"!==typeof this.mapMd5){var g=n.stringify(this.rawAppConfig.map);this.mapMd5=m(g)}return this.mapMd5},_getAppStateKey:function(){return this.appStateKey?this.appStateKey:this.appStateKey="wab_appstate_"+this.urlParams.id||this.urlParams.appid||window.path},getWabAppState:function(){var g=new c,p={};if(h.isInConfigOrPreviewWindow()||!this.rawAppConfig||!this.rawAppConfig.map)return g.resolve(p),g;var t=this._getAppStateKey(),q=v.get(t);q&&q.appStateMd5===this._getAppStateMd5()?
(t=q.map&&q.map.extent,q=q.map&&q.map.layers,t&&(p.extent=new l(t.xmin,t.ymin,t.xmax,t.ymax,new u(t.spatialReference))),q&&(p.layers=q)):v.remove(t);g.resolve(p);return g},saveWabAppState:function(g,p){if(g&&!h.isInConfigOrPreviewWindow()){var t=this._getAppStateKey(),q={extent:{xmin:g.extent.xmin,xmax:g.extent.xmax,ymin:g.extent.ymin,ymax:g.extent.ymax,spatialReference:{wkid:g.extent.spatialReference.wkid,wkt:g.extent.spatialReference.wkt}},layers:{}};p&&p.traversalLayerInfosOfWebmap&&p.traversalLayerInfosOfWebmap(b.hitch(this,
function(k){q.layers[k.id]={visible:k.isShowInMap()}}));v.set(t,{map:q,appStateMd5:this._getAppStateMd5()})}}});e.getInstance=function(g){null===d&&(d=new e);d.urlParams=g;return d};return e})},"jimu/LayoutManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dijit/_WidgetBase dojo/topic dojo/on dojo/query dojo/Deferred dojo/promise/all dojo/debounce require ./MapManager ./utils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p){var t=null;var q=a([n],{constructor:function(k,
r){this.own(l.subscribe("appConfigLoaded",b.hitch(this,this._onAppConfigLoaded)));this.own(l.subscribe("appConfigChanged",b.hitch(this,this._onAppConfigChanged)));this.own(l.subscribe("sceneViewLoaded",b.hitch(this,this._onSceneViewLoaded)));this.own(l.subscribe("sceneViewChanged",b.hitch(this,this._onSceneViewChanged)));this.own(l.subscribe("beforeSceneViewDestory",b.hitch(this,this._onBeforeSceneViewDestroy)));this.own(l.subscribe("builder/actionTriggered",b.hitch(this,this._onActionTriggered)));
this.own(l.subscribe("openWidget",b.hitch(this,this._onOpenWidgetRequest)));this.own(u(window,"resize",d(b.hitch(this,this.resize),200)));this.id=r},postCreate:function(){this.containerNode=this.domNode},sceneView:null,mapId:"map",mapDiv:null,layoutManager:null,animTime:500,resize:function(){this.layoutManager&&this.layoutManager.resize()},_onAppConfigLoaded:function(k){this.appConfig=b.clone(k);this._loadLayoutManager(this.appConfig).then(b.hitch(this,function(r){this.layoutManager=r;this.layoutManager.onEnter(this.appConfig,
this.mapId).then(b.hitch(this,function(){this.mapDiv=this.layoutManager.getMapDiv();this._loadMap(this.mapId);this.appConfig.theme&&this._loadTheme(this.appConfig.theme)}))}))},_loadLayoutManager:function(k){k=k.layoutDefinition?k.layoutDefinition.manager:"jimu/layoutManagers/AbsolutePositionLayoutManager";var r=new m;e([k],b.hitch(this,function(y){y=y.getInstance();this.sceneView&&y.setSceneView(this.sceneView);r.resolve(y)}));return r},_loadMap:function(){this.mapManager=g.getInstance({appConfig:this.appConfig,
urlParams:this.urlParams},this.mapId);this.mapManager.showMap()},_onSceneViewLoaded:function(k){this.sceneView=k;this.layoutManager.setSceneView(k);this.layoutManager.loadAndLayout(this.appConfig)},_loadTheme:function(k){var r=new m;e(["themes/"+k.name+"/main"],b.hitch(this,function(){h([this._loadThemeCommonStyle(k),this._loadThemeCurrentStyle(k)]).then(b.hitch(this,function(){this._addCustomStyle(k);this.layoutManager.onThemeLoad();r.resolve()}))}));return r},_loadThemeCommonStyle:function(k){c.addClass(this.domNode,
k.name);return p.loadStyleLink(this._getThemeCommonStyleId(k),"themes/"+k.name+"/common.css")},_loadThemeCurrentStyle:function(k){c.addClass(this.domNode,k.styles[0]);return p.loadStyleLink(this._getThemeCurrentStyleId(k),"themes/"+k.name+"/styles/"+k.styles[0]+"/style.css")},_addCustomStyle:function(k){var r=b.getObject("customStyles",!1,k);if(r){var y=".jimu-main-background{background-color: ${mainBackgroundColor} !important;}";(k=this._getFixedThemeStyles(k))&&(y+=k);y=b.replace(y,r,/\$\{([^\}]+)\}/g);
r=c.create("style",{type:"text/css"});try{r.appendChild(document.createTextNode(y))}catch(f){r.styleSheet.cssText=y}r.setAttribute("source","custom");document.head.appendChild(r)}},_getFixedThemeStyles:function(k){var r=".esriPopup .titlePane {background-color: ${mainBackgroundColor} !important;}";"PlateauTheme"===k.name?r+=".jimu-widget-header-controller .jimu-title, .jimu-widget-header-controller .jimu-subtitle{color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller .links .jimu-link{color: ${mainBackgroundColor} !important;}.jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate.vertical .operation{background-color: ${mainBackgroundColor} !important;}.jimu-preload-widget-icon-panel \x3e .jimu-panel-title, .jimu-foldable-panel \x3e .jimu-panel-title, .jimu-title-panel \x3e .title{color: ${mainBackgroundColor} !important;}.jimu-panel{border-color: ${mainBackgroundColor} !important;}.jimu-widget-header-controller{border-bottom-color: ${mainBackgroundColor} !important;}.jimu-tab\x3e.control\x3e.tab{color: ${mainBackgroundColor} !important; border-color: ${mainBackgroundColor} !important}":
"BillboardTheme"===k.name?r+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate .operation, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-compass, .jimu-widget-fullScreen, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}.jimu-widget-onscreen-icon{background-color: ${mainBackgroundColor} !important;}":
"BoxTheme"===k.name?r+=".jimu-widget-homebutton .HomeButton .home, .jimu-widget-mylocation, .jimu-widget-mylocation .place-holder, .jimu-widget-zoomslider.vertical .zoom-in, .jimu-widget-zoomslider.vertical .zoom-out, .jimu-widget-extent-navigate, .jimu-widget-navigate, .jimu-widget-home, .jimu-widget-compass, .jimu-widget-fullScreen, .jimu-widget-zoom .esri-zoom .esri-widget, .jimu-widget-placeholder{background-color: ${mainBackgroundColor} !important;}":"TabTheme"===k.name?r+=".tab-widget-frame .title-label{color: ${mainBackgroundColor} !important;}":
"DartTheme"===k.name&&(r+=".jimu-widget-fullScreen .fullScreen{background-color: ${mainBackgroundColor} !important;}");return r},_onAppConfigChanged:function(k,r,y){k=b.clone(k);switch(r){case "themeChange":this._onThemeChange(k);break;case "styleChange":this._onStyleChange(k);break;case "layoutChange":this._onLayoutChange(k);break;case "widgetChange":this._onWidgetChange(k,y);break;case "groupChange":this._onGroupChange(k,y);break;case "widgetPoolChange":this._onWidgetPoolChange(k,y);break;case "resetConfig":this._onResetConfig(k);
break;case "loadingPageChange":this._onLoadingPageChange(k,y);break;case "layoutDefinitionChange":this._onLayoutDefinitionChange(k,y);break;case "onScreenGroupsChange":this._onOnScreenGroupsChange(k,y);break;case "onScreenOrderChange":this._onOnScreenOrderChange(k,y)}this.appConfig=k},_onSceneViewChanged:function(k){this.sceneView=k;this.layoutManager.setSceneView(k);this.layoutManager.loadAndLayout(this.appConfig)},_onBeforeSceneViewDestroy:function(){this.layoutManager.destroyOnScreenWidgetsAndGroups()},
_onActionTriggered:function(k){this.layoutManager.onActionTriggered(k)},_onWidgetChange:function(k,r){this.layoutManager.onWidgetChange(k,r)},_onGroupChange:function(k,r){this.layoutManager.onGroupChange(k,r)},_onWidgetPoolChange:function(k,r){this.layoutManager.onWidgetPoolChange(k,r)},_onLayoutDefinitionChange:function(k,r){this.layoutManager.onLayoutDefinitionChange(k,r)},_onOnScreenGroupsChange:function(k,r){this.layoutManager.onOnScreenGroupsChange(k,r)},_onOnScreenOrderChange:function(k,r){this.layoutManager.onOnScreenOrderChange(k,
r)},_onThemeChange:function(k){this.layoutManager.destroyOnScreenWidgetsAndGroups();this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();h([this._loadLayoutManager(k),this._loadTheme(k.theme)]).then(b.hitch(this,function(r){var y=r[0];this.layoutManager.name!==y.name?(this.layoutManager.onLeave(),y.onEnter(k,this.mapId).then(b.hitch(this,function(){this.layoutManager=y;this.layoutManager.loadAndLayout(k)}))):this.layoutManager.loadAndLayout(k)}))},
_onResetConfig:function(k){var r=this.appConfig;l.publish("appConfigChanged",k,"mapChange",k);this.appConfig=r;this._loadLayoutManager(k).then(b.hitch(this,function(y){this.layoutManager=y;this._removeThemeCommonStyle(this.appConfig.theme);this._removeThemeCurrentStyle(this.appConfig.theme);this._removeCustomStyle();this._loadTheme(this.appConfig.theme)}))},_onLoadingPageChange:function(k,r){"backgroundColor"in r?c.setStyle(jimuConfig.loadingId,"background-color",k.loadingPage.backgroundColor):"backgroundImage"in
r?(k=k.loadingPage.backgroundImage,k.visible&&k.uri?(c.setStyle(jimuConfig.loadingImageId,"background-image","url('"+k.uri+"')"),c.setStyle(jimuConfig.loadingImageId,"width",k.width+"px"),c.setStyle(jimuConfig.loadingImageId,"height",k.height+"px")):(c.setStyle(jimuConfig.loadingImageId,"background-image","url('')"),c.setStyle(jimuConfig.loadingImageId,"width","0px"),c.setStyle(jimuConfig.loadingImageId,"height","0px"))):"loadingGif"in r&&(k=k.loadingPage.loadingGif,k.visible&&k.uri?(c.setStyle(jimuConfig.loadingGifId,
"background-image","url('"+k.uri+"')"),c.setStyle(jimuConfig.loadingGifId,"width",k.width+"px"),c.setStyle(jimuConfig.loadingGifId,"height",k.height+"px")):(c.setStyle(jimuConfig.loadingGifId,"background-image","url('')"),c.setStyle(jimuConfig.loadingGifId,"width","0px"),c.setStyle(jimuConfig.loadingGifId,"height","0px")))},_onStyleChange:function(k){this._removeThemeCurrentStyle(this.appConfig.theme);this._loadThemeCurrentStyle(k.theme);this._removeCustomStyle();this._addCustomStyle(k.theme)},_onLayoutChange:function(k){this.layoutManager.onLayoutChange(k)},
_removeThemeCommonStyle:function(k){c.removeClass(this.domNode,k.name);c.destroy(this._getThemeCommonStyleId(k))},_removeThemeCurrentStyle:function(k){c.removeClass(this.domNode,k.styles[0]);c.destroy(this._getThemeCurrentStyleId(k))},_removeCustomStyle:function(){v('style[source\x3d"custom"]',document.head).forEach(function(k){c.destroy(k)})},_getThemeCommonStyleId:function(k){return"theme_"+k.name+"_style_common"},_getThemeCurrentStyleId:function(k){return"theme_"+k.name+"_style_"+k.styles[0]},
_doPostLoad:function(){e(["dynamic-modules/postload"])},_onOpenWidgetRequest:function(k){this.layoutManager.openWidget(k)}});q.getInstance=function(k,r){null===t&&(t=new q(k,r),window._layoutManager=t);return t};return q})},"dojo/debounce":function(){define([],function(){return function(a,b){var c;return function(){c&&clearTimeout(c);var n=this,l=arguments;c=setTimeout(function(){a.apply(n,l)},b)}}})},"jimu/MapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dojo/on dojo/keys esri/geometry/Extent esri/geometry/Point ./utils ./dijit/LoadingShelter ./AppStateManager ./WebSceneLoader esri/Viewpoint".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){var q=null,k=a(null,{appConfig:null,mapDivId:"",map:null,previousInfoWindow:null,mobileInfoWindow:null,isMobileInfoWindow:!1,layerInfosObj:null,constructor:function(r,y){this.appConfig=r.appConfig;this.urlParams=r.urlParams;this.id=this.mapDivId=y;this.appStateManager=g.getInstance(this.urlParams);l.subscribe("appConfigChanged",b.hitch(this,this.onAppConfigChanged));l.subscribe("changeMapPosition",b.hitch(this,this.onChangeMapPosition));l.subscribe("syncViewpoint",
b.hitch(this,this.onSyncViewpoint));u(window,"resize",b.hitch(this,this.onWindowResize));u(window,"beforeunload",b.hitch(this,this.onBeforeUnload))},showMap:function(){this._showMap(this.appConfig)},_showMap:function(r){console.time("Load Map");this.loading=new e;this.loading.placeAt(this.mapDivId);this.loading.startup();r.map["3D"]?r.map.itemId?this._show3DWebScene(r):console.log("No webscene found. Please set map.itemId in config.json."):r.map.itemId?this._show2DWebMap(r):console.log("No webmap found. Please set map.itemId in config.json.")},
onBeforeUnload:function(){this.appStateManager.saveWabAppState(this.map,this.layerInfosObj)},onWindowResize:function(){this.map&&this.map.resize&&(this.map.resize(),this.resetInfoWindow(!1))},getMapInfoWindow:function(){return{mobile:this._mapMobileInfoWindow,bigScreen:this._mapInfoWindow}},resetInfoWindow:function(r){r&&(this._mapInfoWindow=this.map.infoWindow,this._mapMobileInfoWindow&&this._mapMobileInfoWindow.destroy(),this.isMobileInfoWindow=!1);window.appInfo.isRunInMobile&&!this.isMobileInfoWindow?
this.isMobileInfoWindow=!0:!window.appInfo.isRunInMobile&&this.isMobileInfoWindow&&(this.isMobileInfoWindow=!1)},onChangeMapPosition:function(r){var y=b.clone(this.mapPosition);b.mixin(y,r);this.setMapPosition(y)},setMapPosition:function(r){this.mapPosition=r;r=d.getPositionStyle(r);n.setStyle(this.mapDivId,r);this.map&&this.map.resize&&this.map.resize()},getMapPosition:function(){return this.mapPosition},onSyncViewpoint:function(r){this.sceneView&&(this.sceneView.viewpoint=r.clone())},_visitConfigMapLayers:function(r,
y){c.forEach(r.map.basemaps,function(f,w){f.isOperationalLayer=!1;y(f,w)},this);c.forEach(r.map.operationallayers,function(f,w){f.isOperationalLayer=!0;y(f,w)},this)},_destroySceneView:function(){if(this.sceneView)try{this.sceneView.destroy()}catch(r){console.error(r)}this.sceneView=null;window._sceneView=null},_show3DWebScene:function(r){var y=r.map.portalUrl,f=r.map.itemId;this._destroySceneView();p.createMap(this.mapDivId,y,f).then(b.hitch(this,function(w){this._publishSceneViewEvent(w);if(r.map.mapOptions)if((w=
r.map.mapOptions.initialState)&&w.viewpoint)try{var z=t.fromJSON(w.viewpoint);z&&(this.sceneView.map.initialViewProperties.viewpoint=z,this.sceneView.viewpoint=z.clone())}catch(A){console.error(A)}else this.sceneView.map.initialViewProperties.viewpoint=this.sceneView.viewpoint}),b.hitch(this,function(){this.loading&&this.loading.destroy();l.publish("mapCreatedFailed")}))},_publishSceneViewEvent:function(r){window._sceneView=r;console.timeEnd("Load Map");this.loading&&this.loading.destroy();this.sceneView?
(this.sceneView=r,console.log("sceneView changed"),l.publish("sceneViewChanged",this.sceneView)):(this.sceneView=r,console.log("sceneView loaded"),l.publish("sceneViewLoaded",this.sceneView))},_show2DWebMap:function(r){r.map.mapOptions||(r.map.mapOptions={});var y=this._processMapOptions(r.map.mapOptions)||{};y.isZoomSlider=!1;d.createWebMap(r.map.portalUrl,r.map.itemId,this.mapDivId,{mapOptions:y,bingMapsKey:r.bingMapsKey,usePopupManager:!0}).then(b.hitch(this,function(f){var w=f.map;w.hideZoomSlider();
w.infoWindow.resize(270,316);w.itemId=r.map.itemId;w.itemInfo=f.itemInfo;w.webMapResponse=f;w.enableSnapping({snapKey:v.copyKey});n.setStyle(w.root,"zIndex",0);w._initialExtent=w.extent;c.forEach("extent center marker find query scale level".split(" "),function(z){},this);this._publishMapEvent(w)}),b.hitch(this,function(){this.loading&&this.loading.destroy();l.publish("mapCreatedFailed")}))},_processMapOptions:function(r){if(r)return r.lods||delete r.lods,r.lods&&0===r.lods.length&&delete r.lods,
r=b.clone(r),r.extent&&(r.extent=new m(r.extent)),r.center&&!b.isArrayLike(r.center)&&(r.center=new h(r.center)),r},onAppConfigChanged:function(r,y,f){this.appConfig=r;"mapChange"===y?this._recreateMap(r):"mapOptionsChange"===y&&f.initialState&&(r=f.initialState.viewpoint)&&(this.sceneView.map.initialViewProperties.viewpoint=t.fromJSON(r),this.sceneView.animateTo(t.fromJSON(r)))},_recreateMap:function(r){this.sceneView&&(l.publish("beforeSceneViewDestory",this.sceneView),this._destroySceneView());
this._showMap(r)},disableWebMapPopup:function(){},enableWebMapPopup:function(){}});k.getInstance=function(r,y){null===q&&(q=new k(r,y));return q};return k})},"jimu/dijit/LoadingShelter":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dijit/_TemplatedMixin","dojo/text!./templates/LoadingShelter.html","dojo/_base/html"],function(a,b,c,n,l){return a([b,c],{baseClass:"jimu-loading-shelter",declaredClass:"jimu.dijit.LoadingShelter",templateString:n,loadingText:null,hidden:!1,showLoading:!0,
postMixInProperties:function(){this.nls=window.jimuNls.loadingShelter},postCreate:function(){this.inherited(arguments);this.hidden&&l.setStyle(this.domNode,"display","none");l.setStyle(this.domNode,{width:"100%",height:"100%"});this.showLoading||l.setStyle(this.imgDiv,"display","none");"string"===typeof this.loadingText&&(this.textNode.innerHTML=this.loadingText)},show:function(u){this.domNode&&this.hidden&&("string"===typeof u&&(this.textNode.innerHTML=u),l.setStyle(this.domNode,"display","block"),
this.hidden=!1)},hide:function(){this.domNode&&!this.hidden&&(l.setStyle(this.domNode,"display","none"),this.hidden=!0)}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(a,b,c,n,l,u,v,m){var h=b("dijit._TemplatedMixin",m,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(d){var e=this.declaredClass,g=this;return v.substitute(d,
this,function(p,t){"!"==t.charAt(0)&&(p=n.getObject(t.substr(1),!1,g));if("undefined"==typeof p)throw Error(e+" template:"+t);return null==p?"":"!"==t.charAt(0)?p:this._escapeValue(""+p)},this)},_escapeValue:function(d){return d.replace(/["'<>&]/g,function(e){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[e]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=a(this.templatePath,{sanitize:!0}));var d=h.getCachedTemplate(this.templateString,
this._skipNodeCache,this.ownerDocument);if(n.isString(d)){var e=c.toDom(this._stringRepl(d),this.ownerDocument);if(1!=e.nodeType)throw Error("Invalid template: "+d);}else e=d.cloneNode(!0);this.domNode=e}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(d){var e=this.containerNode;if(d&&e)for(;d.hasChildNodes();)e.appendChild(d.firstChild)}});h._templateCache={};h.getCachedTemplate=function(d,e,g){var p=h._templateCache,t=d,q=p[t];
if(q){try{if(!q.ownerDocument||q.ownerDocument==(g||document))return q}catch(k){}c.destroy(q)}d=v.trim(d);if(e||d.match(/\$\{([^\}]+)\}/g))return p[t]=d;e=c.toDom(d,g);if(1!=e.nodeType)throw Error("Invalid template: "+d);return p[t]=e};u("ie")&&l(window,"unload",function(){var d=h._templateCache,e;for(e in d){var g=d[e];"object"==typeof g&&c.destroy(g);delete d[e]}});return h})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(a){return a.cache})},"dojo/text":function(){define(["./_base/kernel",
"require","./has","./has!host-browser?./request"],function(a,b,c,n){var l;c("host-browser")?l=function(d,e,g){n(d,{sync:!!e,headers:{"X-Requested-With":null}}).then(g)}:b.getText?l=b.getText:console.error("dojo/text plugin failed to load because loader does not support getText");var u={},v=function(d){if(d){d=d.replace(/^\s*<\?xml(\s)+version=['"](\d)*.(\d)*['"](\s)*\?>/im,"");var e=d.match(/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im);e&&(d=e[1])}else d="";return d},m={},h={};a.cache=function(d,e,g){if("string"==
typeof d)if(/\//.test(d)){var p=d;g=e}else p=b.toUrl(d.replace(/\./g,"/")+(e?"/"+e:""));else p=d+"",g=e;d=void 0!=g&&"string"!=typeof g?g.value:g;g=g&&g.sanitize;if("string"==typeof d)return u[p]=d,g?v(d):d;if(null===d)return delete u[p],null;p in u||l(p,!0,function(t){u[p]=t});return g?v(u[p]):u[p]};return{dynamic:!0,normalize:function(d,e){d=d.split("!");var g=d[0];return(/^\./.test(g)?e(g):g)+(d[1]?"!"+d[1]:"")},load:function(d,e,g){d=d.split("!");var p=1<d.length,t=d[0],q=e.toUrl(d[0]);d="url:"+
q;var k=m,r=function(f){g(p?v(f):f)};t in u?k=u[t]:e.cache&&d in e.cache?k=e.cache[d]:q in u&&(k=u[q]);if(k===m)if(h[q])h[q].push(r);else{var y=h[q]=[r];l(q,!e.async,function(f){u[t]=u[q]=f;for(var w=0;w<y.length;)y[w++](f);delete h[q]})}else r(k)}}})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(a,b,c,n,l,u,v,m,h){var d=l.delegate(m,{mouseenter:u.enter,mouseleave:u.leave,
keypress:c._keypress}),e;c=n("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(g){for(var p=g;;)if(1==p.nodeType&&(this._processTemplateNode(p,function(t,q){return t.getAttribute(q)},this._attach)||this.searchContainerNode)&&p.firstChild)p=p.firstChild;else{if(p==g)break;for(;!p.nextSibling;)if(p=
p.parentNode,p==g)return;p=p.nextSibling}},_processTemplateNode:function(g,p,t){var q=!0,k=this.attachScope||this,r=p(g,"dojoAttachPoint")||p(g,"data-dojo-attach-point");if(r)for(var y=r.split(/\s*,\s*/);r=y.shift();)l.isArray(k[r])?k[r].push(g):k[r]=g,q="containerNode"!=r,this._attachPoints.push(r);if(p=p(g,"dojoAttachEvent")||p(g,"data-dojo-attach-event"))for(r=p.split(/\s*,\s*/),y=l.trim;p=r.shift();)if(p){var f=null;-1!=p.indexOf(":")?(f=p.split(":"),p=y(f[0]),f=y(f[1])):p=y(p);f||(f=p);this._attachEvents.push(t(g,
p,l.hitch(k,f)))}return q},_attach:function(g,p,t){p=p.replace(/^on/,"").toLowerCase();p="dijitclick"==p?e||(e=a("./a11yclick")):d[p]||p;return v(g,p,t)},_detachTemplateNodes:function(){var g=this.attachScope||this;b.forEach(this._attachPoints,function(p){delete g[p]});this._attachPoints=[];b.forEach(this._attachEvents,function(p){p.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});l.extend(h,{dojoAttachEvent:"",dojoAttachPoint:""});
return c})},"jimu/WebSceneLoader":function(){define("dojo/Deferred dojo/_base/lang dojo/_base/array dojo/_base/html dojo/promise/all esri/kernel esri/WebScene esri/views/SceneView esri/portal/Portal esri/portal/PortalItem esri/core/has ./utils ./portalUtils ./portalUrlUtils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){return{createMap:function(q,k,r){var y=new a;this._isWebGLAvailable()?y=this._createMap(q,k,r):(y.reject("The browser doesn't support webgl."),(q=b.getObject("webSceneLoader.webglSupportTip",
!1,window.jimuNls))||(q="3D web apps aren't supported in your browser."),n.create("div",{"class":"app-error",innerHTML:q},document.body));return y},_createMap:function(q,k,r){g.getEsriConfig().portalUrl=t.getStandardPortalUrl(k);var y=new a,f=[];h._default=null;var w=new v({portalItem:new d({id:r})}),z=new m({map:w,container:q,constraints:{collision:{enabled:!1},tilt:{max:179.99}}});f.push(z.when());k=p.getPortal(k);f.push(k.getItemById(r));f.push(k.getItemData(r));l(f).then(b.hitch(this,function(A){z.popup&&
(z.popup.closeOnViewChangeEnabled=!0);w.id=q;w.itemId=r;w.itemInfo={item:A[1],itemData:A[2]};this._handleLocalScene(z);y.resolve(z)}),b.hitch(this,function(A){console.error(A);y.reject(A)}));return y},_handleLocalScene:function(q){try{q.viewingMode&&"local"===q.viewingMode.toLowerCase()&&(b.setObject("constraints.collision.enabled",!1,q),b.setObject("constraints.tilt.max",179.99,q))}catch(k){console.error(k)}},_handleAttribution:function(q){try{if("4.0"!==u.version){var k=q.ui&&q.ui._components;k&&
0<k.length&&c.some(k,function(r){return(r=r&&r._widget)&&"esri.widgets.Attribution"===r.declaredClass?(r.domNode.parentNode.style.width="100%",n.create("span",{innerHTML:"Powered by Esri","class":"esri-attribution-powered-by"},r.domNode),!0):!1})}}catch(r){console.error(r)}},_isWebGLAvailable:function(){try{var q=document.createElement("canvas");return!(!window.WebGLRenderingContext||!q.getContext("webgl")&&!q.getContext("experimental-webgl"))}catch(k){return!1}},_isWebGL2Available:function(){try{var q=
document.createElement("canvas");return!(!window.WebGL2RenderingContext||!q.getContext("webgl2"))}catch(k){return!1}}}})},"esri/WebScene":function(){define("require ./chunks/_rollupPluginBabelHelpers ./chunks/tslib.es6 ./kernel ./Map ./Viewpoint ./core/Collection ./core/Error ./core/Handles ./core/has ./core/lang ./core/Loadable ./core/loadAll ./core/Logger ./core/maybe ./core/MultiOriginJSONSupport ./core/Promise ./core/promiseUtils ./core/urlUtils ./core/accessorSupport/decorators/property ./core/accessorSupport/ensureType ./core/accessorSupport/decorators/reader ./core/accessorSupport/decorators/subclass ./core/accessorSupport/decorators/writer ./core/accessorSupport/originUtils ./core/accessorSupport/read ./geometry/Extent ./geometry/HeightModelInfo ./geometry/projection ./geometry/SpatialReference ./geometry/support/heightModelInfoUtils ./geometry/support/jsonUtils ./geometry/support/spatialReferenceUtils ./portal/Portal ./portal/PortalItem ./support/MapFloorInfo ./support/webSceneUtils ./views/ViewingMode ./views/support/spatialReferenceSupport ./webdoc/support/saveUtils ./webdoc/support/thumbnailUtils ./webscene/ApplicationProperties ./webscene/Environment ./webscene/InitialViewProperties ./webscene/Presentation ./webscene/TransportationNetwork ./webscene/Version".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H,U,W,Q,X,ba){const aa=t.getLogger("esri.WebScene"),ea=new ba.Version(1,28);l=function(ka){function la(ca){var Y=ka.call(this,ca)||this;Y._handles=new h;Y.applicationProperties=null;Y.clippingArea=null;Y.clippingEnabled=!1;Y.floorInfo=null;Y.heightModelInfo=null;Y.sourceVersion=null;Y.transportationNetworks=null;Y.presentation=new Q;Y.initialViewProperties=new W;Y.portalItem=null;Y.resourceInfo=null;Y._debouncedSaveOperations=
y.debounce(function(){var da=b._asyncToGenerator(function*(ha,ja,ma){switch(ha){case ia.SAVE:return Y._saveImpl(ja);case ia.SAVE_AS:return Y._saveAsImpl(ma,ja)}});return function(ha,ja,ma){return da.apply(this,arguments)}}());Y.resourceReferences={portalItem:null,paths:[]};Y.authoringApp=null;Y.authoringAppVersion=null;Y._isAuthoringAppSetByUser=!1;Y._isAuthoringAppVersionSetByUser=!1;return Y}b._inheritsLoose(la,ka);var Z=la.prototype;Z.initialize=function(){this.when().catch(ca=>{aa.error("#load()",
"Failed to load web scene",ca)});if(this.resourceInfo){let ca;try{ca=this._validateJSON(this.resourceInfo)}catch(Y){this.addResolvingPromise(Promise.reject(Y));return}this.read(ca);this.addResolvingPromise(this._validateSpatialReference());this.addResolvingPromise(this._validateHeightModelInfo())}this._handles.add(this.allLayers.on("change",()=>this._scheduleLayersIdGC()))};Z.destroy=function(){this._unscheduleLayersIdGC();this._handles.destroy();this.presentation&&this.presentation.destroy();const ca=
this.portalItem;this.portalItem=null;null==ca?void 0:ca.destroy()};Z.writeClippingArea=function(ca,Y){Y.clippingArea||(Y.clippingArea={});Y.clippingArea.geometry=ca.toJSON()};Z.readClippingEnabled=function(ca,Y){return Y.clippingArea?!!Y.clippingArea.clip:!1};Z.writeClippingEnabled=function(ca,Y){this.clippingArea&&(Y.clippingArea||(Y.clippingArea={}),Y.clippingArea.clip=ca)};Z.writeLayers=function(ca,Y,da,ha){const ja={...ha,layerContainerType:"operational-layers"};ca=ca.map(ma=>this.verifyWriteLayer(ma,
ha)?ma.write({},ja):null).filter(ma=>!!ma);Y[da]=ca.toArray()};Z.verifyWriteLayer=function(ca,Y){return"write"in ca?!0:(Y&&Y.messages&&Y.messages.push(new m("layer:unsupported",`Layers (${ca.title}, ${ca.id}) of type '${ca.declaredClass}' cannot be persisted in web scenes`,{layer:ca})),!1)};Z.readSourceVersion=function(ca,Y){const [da,ha]=Y.version.split(".");return new ba.Version(parseInt(da,10),parseInt(ha,10))};Z.writeSourceVersion=function(ca,Y,da){Y[da]=`${ea.major}.${ea.minor}`};Z.writeAuthoringApp=
function(ca,Y){Y.authoringApp=ca&&this._isAuthoringAppSetByUser?ca:"ArcGIS API for JavaScript"};Z.writeAuthoringAppVersion=function(ca,Y){Y.authoringAppVersion=ca&&this._isAuthoringAppVersionSetByUser?ca:n.version};Z.writeGround=function(ca,Y,da,ha){Y[da]=ca?ca.write({},ha):{transparency:0,layers:[]}};Z.readInitialViewProperties=function(ca,Y){ca={};Y.initialState&&Y.initialState.environment&&(ca.environment=U.fromJSON(Y.initialState.environment));ca.spatialReference=Y.spatialReference?O.fromJSON(Y.spatialReference):
O.WebMercator;ca.viewingMode=Y.viewingMode||"global";Y.initialState&&Y.initialState.viewpoint&&(ca.viewpoint=u.fromJSON(Y.initialState.viewpoint));return new W(ca)};Z.load=function(ca){this.addResolvingPromise(this._loadFromSource());return Promise.resolve(this)};Z.loadAll=function(){return p.loadAll(this,ca=>{const Y=this.presentation&&this.presentation.slides;ca(this.ground,this.basemap,this.layers,Y&&Y.map(da=>da.basemap))})};Z.read=function(ca,Y){Y={...Y,origin:"web-scene"};const da=this._isAuthoringAppVersionSetByUser,
ha=this._isAuthoringAppSetByUser;D.readLoadable(this,ca,ja=>ka.prototype.read.call(this,ca,ja),Y);ha||(this._isAuthoringAppSetByUser=!1);da||(this._isAuthoringAppVersionSetByUser=!1);if(ca.baseMap&&Array.isArray(ca.baseMap.elevationLayers)&&this.sourceVersion.supportsVisibleElevationLayersInSlides){Y=ca.baseMap.elevationLayers.map(na=>({id:na.id}));const ja=this.presentation.slides,ma=(na,wa)=>na.visibleLayers.some(xa=>xa.id===wa),pa=Y.filter(na=>!ja.some(wa=>ma(wa,na.id)));ja.forEach(na=>{na.visibleLayers.addMany(pa)})}};
Z._writeBasemapElevationLayers=function(ca){const Y=ca.ground&&ca.ground.layers;!ca.baseMap&&Y&&Y.length&&(ca.baseMap={title:"Basemap",baseMapLayers:[]});ca.baseMap&&(ca.baseMap.elevationLayers=e.clone(Y))};Z.write=function(ca,Y){var da;if("loaded"!==this.loadStatus)throw Y=new m("webscene:not-loaded","Web scene must be loaded before it can be serialized"),aa.error("#toJSON()","Web scene must be loaded before it can be serialized",this.loadError||this.loadStatus),Y;this._runLayersIdGC();var ha=!(null!=
(da=Y)&&da.messages);Y={messages:[],...Y,origin:"web-scene"};ca=ka.prototype.write.call(this,ca,Y);if(ha&&(Y=Y.messages.filter(ja=>"web-document-write:property-required"===ja.name),Y.length))throw ha=new m("web-document:property-required","One or more properties that are required in the webscene JSON are missing, see details for the specific errors",{errors:Y}),aa.error("#toJSON()","One or more properties that are required in the webscene JSON are missing",Y),ha;this._writeBasemapElevationLayers(ca);
return ca};Z.save=function(){var ca=b._asyncToGenerator(function*(Y){return this._debouncedSaveOperations(ia.SAVE,Y)});return function(Y){return ca.apply(this,arguments)}}();Z._saveImpl=function(){var ca=b._asyncToGenerator(function*(Y){this.portalItem||(aa.error("save(): requires the .portalItem property to be set"),yield Promise.reject(new m("webscene:portal-item-not-set","Portal item to save to has not been set on the WebScene")));"Web Scene"!==this.portalItem.type&&(yield Promise.reject(new m("webscene:portal-item-wrong-type",
'Portal item needs to have type "Web Scene"')));const da=this._updateFromPromise;yield this._ensureLoadBeforeSave();const ha=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:this.portalItem.itemUrl&&f.urlToObject(this.portalItem.itemUrl),messages:[],portal:this.portalItem.portal||M.getDefault(),portalItem:this.portalItem,writtenProperties:[],blockedRelativeUrls:[],resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),ja=this.write({},ha);yield Promise.all(ha.resources.pendingOperations);
yield this._verifySave(ja,ha,Y);this._updateTypeKeywords(this.portalItem);yield this.portalItem.update({data:ja});yield S.saveResources(this.resourceReferences,ha,null);C.updateOrigins(ha);da&&(yield da);yield this._saveThumbnail();return this.portalItem});return function(Y){return ca.apply(this,arguments)}}();Z.saveAs=function(){var ca=b._asyncToGenerator(function*(Y,da){return this._debouncedSaveOperations(ia.SAVE_AS,da,Y)});return function(Y,da){return ca.apply(this,arguments)}}();Z._saveAsImpl=
function(){var ca=b._asyncToGenerator(function*(Y,da){Y=J.from(Y);Y||(aa.error("saveAs(portalItem): requires a portal item parameter"),yield Promise.reject(new m("webscene:portal-item-required","saveAs requires a portal item to save to")));Y.id&&(Y=Y.clone(),Y.id=null);const ha=Y.portal||M.getDefault();yield this._ensureLoadBeforeSave();Y.type="Web Scene";Y.portal=ha;const ja=this._enableVerifyItemRelativeUrls({origin:"web-scene",url:null,messages:[],portal:ha,portalItem:Y,writtenProperties:[],blockedRelativeUrls:[],
resources:{toAdd:[],toUpdate:[],toKeep:[],pendingOperations:[]}}),ma=this.write({},ja);yield Promise.all(ja.resources.pendingOperations);yield this._verifySaveAs(ma,ja,da);const pa=this.thumbnailUrl,na=!this._isOverridden("thumbnailUrl");this._updateTypeKeywords(Y);yield ha._signIn();yield ha.user.addItem({item:Y,folder:da&&da.folder,data:ma});yield S.saveResources(this.resourceReferences,ja,null);this.portalItem=Y;k.MultiOriginJSONSupport.prototype.read.call(this,{version:ma.version,authoringApp:ma.authoringApp,
authoringAppVersion:ma.authoringAppVersion},{name:"web-scene",ignoreDefaults:!0,url:Y.itemUrl&&f.urlToObject(Y.itemUrl)});C.updateOrigins(ja);pa&&(this.thumbnailUrl=na?f.addQueryParameter(pa,"w","8192"):pa);ja.portalItem=Y;yield this._saveThumbnail();return Y});return function(Y,da){return ca.apply(this,arguments)}}();Z._saveThumbnail=function(){var ca=b._asyncToGenerator(function*(){this._isOverridden("thumbnailUrl")&&(yield this.portalItem.updateThumbnail({thumbnail:this.thumbnailUrl}),this._clearOverride("thumbnailUrl"),
this.clear("thumbnailUrl","user"))});return function(){return ca.apply(this,arguments)}}();Z._verifySave=function(ca,Y,da,ha=!1){if(!R.isEarth(this.spatialReference))return Promise.reject(new m("webscene:unsupported-spatial-reference","Webscenes using spatial reference systems from Mars or Moon can not be saved currently."));let ja=Y.messages.filter(pa=>"error"===pa.type).map(pa=>new m(pa.name,pa.message,pa.details));Y.blockedRelativeUrls&&(ja=ja.concat(Y.blockedRelativeUrls.map(pa=>new m("url:unsupported",
`Relative url '${pa}' is not supported in Web Scene`))));da&&da.ignoreUnsupported&&(ja=ja.filter(pa=>"layer:unsupported"!==pa.name&&"symbol:unsupported"!==pa.name&&"symbol-layer:unsupported"!==pa.name&&"property:unsupported"!==pa.name&&"url:unsupported"!==pa.name&&"scenemodification:unsupported"!==pa.name));null!=da&&da.requiredPropertyChecksDisabled&&(ja=ja.filter(pa=>"web-document-write:property-required"!==pa.name));const ma=da&&da.strictSchemaValidationEnabled;return(ma?(new Promise((pa,na)=>
a(["./webscene/support/schemaValidator"],pa,na))).then(pa=>{pa=pa.validate(ca);if(0<pa.length){const na=`webscene did not validate:\n${pa.join("\n")}`;aa.error(`${ha?"saveAs":"save"}(): ${na}`)}return pa.map(na=>new m("webscene:schema-validation",na))}).then(pa=>{if(ma&&0<pa.length)throw P.createSchemaValidationError(pa.concat(ja));return ja}):Promise.resolve(ja)).then(pa=>{if(0<pa.length)throw new m("webscene:save","Failed to save webscene due to unsupported or invalid content. See 'details.errors' for more detailed information",
{errors:pa});})};Z._verifySaveAs=function(ca,Y,da){return this.canNotSaveAs(Y)?Promise.reject(P.createCopyError()):this._verifySave(ca,Y,da,!0)};Z.verifySaveAs=function(ca){const Y=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),da=this.write({},Y);return this._verifySaveAs(da,Y,ca)};Z.canNotSaveAs=function(ca){ca||(ca=this._enableVerifyItemRelativeUrls({origin:"web-scene",messages:[]}),this.write({},ca));return ca.verifyItemRelativeUrls&&0<ca.verifyItemRelativeUrls.writtenUrls.length};
Z.updateFrom=function(){var ca=b._asyncToGenerator(function*(Y,da={}){this._updateFromPromise=Y=this._updateFrom(Y,da);yield Y;this._updateFromPromise===Y&&(this._updateFromPromise=null)});return function(Y){return ca.apply(this,arguments)}}();Z._updateFrom=function(){var ca=b._asyncToGenerator(function*(Y,da={}){yield Y.whenReady();!da.environmentExcluded&&Y.environment&&(this.initialViewProperties.environment=U.prototype.clone.apply(Y.environment));!da.viewpointExcluded&&Y.viewpoint&&(this.initialViewProperties.viewpoint=
Y.viewpoint.clone());this.initialViewProperties.spatialReference=Y.spatialReference.clone();this.initialViewProperties.viewingMode=Y.viewingMode;q.isSome(Y.clippingArea)?Y.clippingArea!==this.clippingArea&&(this.clippingArea=Y.clippingArea.clone(),this.clippingEnabled=!0):this.clippingEnabled=!1;Y.heightModelInfo&&(this.heightModelInfo=Y.heightModelInfo.clone());if(Y.map===this)for(const ha of Y.allLayerViews)"visible"in ha&&"visible"in ha.layer&&ha._isOverridden("visible")&&(ha.layer.visible=ha.visible);
if(!1===da.thumbnailExcluded||null==da.thumbnailExcluded&&!da.viewpointExcluded)yield this._updateFromThumbnail(Y,da.thumbnailSize||void 0)});return function(Y){return ca.apply(this,arguments)}}();Z._updateFromThumbnail=function(){var ca=b._asyncToGenerator(function*(Y,da){da=T.getOptimalThumbnailSize(Y,da);this.thumbnailUrl=(yield Y.takeScreenshot({format:"jpg",width:da.width,height:da.height,disableDecorations:!0})).dataUrl});return function(Y,da){return ca.apply(this,arguments)}}();Z._loadFromSource=
function(){return this.resourceInfo?this._loadFromJSON(this.resourceInfo,{origin:"web-scene"}):this.portalItem&&this.portalItem.id?this._loadFromItem(this.portalItem):this._loadObjectsWithLayers()};Z._readAndLoadFromJSON=function(ca,Y){ca=this._validateJSON(ca);this.read(ca,Y);return this._loadFromJSON(ca,Y)};Z._extractOperationalLayers=function(ca){const Y=[];if(!this.sourceVersion.supportsGround&&ca.baseMap&&Array.isArray(ca.baseMap.elevationLayers))for(const ja of ca.baseMap.elevationLayers)Y.push(ja);
const da=[],ha=ja=>{ja.layers&&(ja.layers=ja.layers.filter(ha));return"ArcGISTiledElevationServiceLayer"===ja.layerType?(this.sourceVersion.supportsGround||da.push(ja),!1):!0};return{operationalLayers:ca.operationalLayers?ca.operationalLayers.filter(ha):[],operationalElevationLayers:da,basemapElevationLayers:Y}};Z._loadFromJSON=function(ca,Y){const da=new v;return this._validateSpatialReference().then(()=>this._validateHeightModelInfo()).then(()=>new Promise((ha,ja)=>a(["./layers/support/layersCreator"],
ha,ja))).then(({populateOperationalLayers:ha})=>{const {operationalLayers:ja,operationalElevationLayers:ma,basemapElevationLayers:pa}=this._extractOperationalLayers(ca),na=[],wa={context:{...Y,layerContainerType:"operational-layers"}};this.portalItem&&(wa.context.portal=this.portalItem.portal||M.getDefault());0<pa.length&&na.push(ha(this.ground.layers,pa,{...wa,context:{...wa.context,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));0<ma.length&&na.push(ha(da,ma,
{...wa,context:{...wa.context,layerContainerType:"ground"},defaultLayerType:"ArcGISTiledElevationServiceLayer"}));ja&&0<ja.length&&na.push(ha(this.layers,ja,wa));return y.eachAlways(na).then(()=>{})}).then(()=>this._loadObjectsWithLayers()).then(()=>{this.ground.layers.addMany(da)})};Z._ensureLoadBeforeSave=function(){var ca=b._asyncToGenerator(function*(){yield this.load();yield this._loadObjectsWithLayers();const Y=[];for(const da of this.allLayers.items)if("beforeSave"in da&&"function"===typeof da.beforeSave){const ha=
da.beforeSave();ha&&Y.push(ha)}yield y.eachAlways(Y)});return function(){return ca.apply(this,arguments)}}();Z._loadObjectsWithLayers=function(){var ca=b._asyncToGenerator(function*(){const Y=[];this.ground&&Y.push(this.ground.load());this.basemap&&Y.push(this.basemap.load());this.presentation.slides.forEach(da=>{da.basemap&&Y.push(da.basemap.load())});yield y.eachAlways(Y)});return function(){return ca.apply(this,arguments)}}();Z._loadFromItem=function(){var ca=b._asyncToGenerator(function*(Y){yield Y.load().catch(ja=>
{throw new m("webscene:load-portal-item","Failed to load portal item",{error:ja});});if("Web Scene"!==Y.type)throw new m("webscene:invalid-portal-item","Invalid portal item type '${type}', expected 'Web Scene'",{type:Y.type});const da=yield Y.fetchData();this.resourceInfo=da;const ha={origin:"web-scene",url:f.urlToObject(Y.itemUrl),portal:Y.portal||M.getDefault(),portalItem:Y,readResourcePaths:[]};yield this._readAndLoadFromJSON(da,ha);this.resourceReferences={portalItem:Y,paths:ha.readResourcePaths}});
return function(Y){return ca.apply(this,arguments)}}();Z._validateSpatialReference=function(){const ca=this.initialViewProperties,Y=this._sceneSpatialReference;let da;if("local"!==ca.viewingMode){if(!V.isSpatialReferenceSupported(Y,N.ViewingMode.Global))return Promise.reject(new m("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in global mode, only Web Mercator, WGS84 GCS or CGCS2000 are supported",{spatialReference:Y,viewingMode:ca.viewingMode}));
da=ma=>!ma||G.canProjectWithoutEngine(ma,Y)}else{if(!V.isSpatialReferenceSupported(Y,N.ViewingMode.Local))return Promise.reject(new m("webscene:unsupported-spatial-reference","Unsupported spatial reference (${spatialReference.wkid}) in local mode, only projected coordinate systems are supported",{spatialReference:Y,viewingMode:ca.viewingMode}));da=ma=>!ma||ma.equals(Y)}const ha=ma=>ma&&(q.isSome(ma.camera)&&ma.camera.position&&ma.camera.position.spatialReference||q.isSome(ma.targetGeometry)&&ma.targetGeometry.spatialReference);
var ja=ha(ca.viewpoint);return ja&&!da(ja)?Promise.reject(new m("webscene:incompatible-camera-spatial-reference","Camera spatial reference (${cameraSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",{cameraSpatialReference:ja,sceneSpatialReference:Y,viewingMode:ca.viewingMode})):(ja=this.presentation.slides.find(ma=>!da(ha(ma.viewpoint))))?(ja=ha(ja.viewpoint),Promise.reject(new m("webscene:incompatible-slide-spatial-reference","Slide spatial reference (${slideSpatialReference.wkid}) is incompatible with the scene spatial reference (${sceneSpatialReference.wkid})",
{slideSpatialReference:ja,sceneSpatialReference:Y,viewingMode:ca.viewingMode}))):Promise.resolve()};Z._validateHeightModelInfo=function(){const ca=K.validateWebSceneError(this.heightModelInfo,this._sceneSpatialReference);return ca?Promise.reject(ca):Promise.resolve()};Z._validateJSON=function(ca){const Y=ba.Version.parse(ca.version||"","webscene");ea.validate(Y);ca.version=`${Y.major}.${Y.minor}`;1===Y.major&&2>=Y.minor&&(ca.spatialReference=O.WebMercator.toJSON());return ca};Z._updateTypeKeywords=
function(ca){"local"===this.initialViewProperties.viewingMode?ca.typeKeywords?ca.typeKeywords.includes("ViewingMode-Local")||ca.typeKeywords.push("ViewingMode-Local"):ca.typeKeywords=["ViewingMode-Local"]:"global"===this.initialViewProperties.viewingMode&&ca.typeKeywords&&(ca.typeKeywords=ca.typeKeywords.filter(Y=>"ViewingMode-Local"!==Y));ca.typeKeywords&&(ca.typeKeywords=ca.typeKeywords.filter((Y,da,ha)=>ha.indexOf(Y)===da))};Z._enableVerifyItemRelativeUrls=function(ca){const Y=this._verifyItemRelativeRootPath;
Y&&(ca.verifyItemRelativeUrls={rootPath:Y,writtenUrls:[]});return ca};Z._unscheduleLayersIdGC=function(){this._layersIdGCTimeoutId&&(clearTimeout(this._layersIdGCTimeoutId),this._layersIdGCTimeoutId=0)};Z._scheduleLayersIdGC=function(){this._unscheduleLayersIdGC();this._layersIdGCTimeoutId=setTimeout(()=>{this._layersIdGCTimeoutId=0;this._runLayersIdGC()},3E3)};Z._runLayersIdGC=function(){this._unscheduleLayersIdGC();var ca=this.applicationProperties&&this.applicationProperties.viewing&&this.applicationProperties.viewing.search;
const Y=da=>this.allLayers.some(ha=>ha.id===da);ca&&ca.layers&&(ca.layers=ca.layers.filter(da=>Y(da.id)));(ca=this.presentation&&this.presentation.slides)&&ca.forEach(da=>{da.visibleLayers&&(da.visibleLayers=da.visibleLayers.filter(ha=>Y(ha.id)))})};la.fromJSON=function(ca){if(!ca)throw new m("webscene:empty-resource","Expected a JSON resource but got nothing");return new this({resourceInfo:ca})};b._createClass(la,[{key:"thumbnailUrl",get:function(){return this.portalItem&&this.portalItem.thumbnailUrl||
null},set:function(ca){ca?this._override("thumbnailUrl",ca):(this._clearOverride("thumbnailUrl"),this.clear("thumbnailUrl","user"))}},{key:"authoringApp",set:function(ca){this._isAuthoringAppSetByUser=!0;this._set("authoringApp",ca)}},{key:"authoringAppVersion",set:function(ca){this._isAuthoringAppVersionSetByUser=!0;this._set("authoringAppVersion",ca)}},{key:"spatialReference",get:function(){var ca,Y;return null!=(ca=null==(Y=this.initialViewProperties)?void 0:Y.spatialReference)?ca:O.WebMercator}},
{key:"viewingMode",get:function(){var ca,Y;return null!=(ca=null==(Y=this.initialViewProperties)?void 0:Y.viewingMode)?ca:"global"}},{key:"_sceneSpatialReference",get:function(){return this.initialViewProperties.spatialReference||O.WebMercator}},{key:"_verifyItemRelativeRootPath",get:function(){return this.portalItem&&this.portalItem.itemUrl?f.urlToObject(this.portalItem.itemUrl).path:null}}]);return la}(g.LoadableMixin(r.EsriPromiseMixin(k.MultiOriginJSONMixin(l))));l.VERSION=ea;c.__decorate([w.property({type:H,
json:{write:!0}})],l.prototype,"applicationProperties",void 0);c.__decorate([w.property({json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],l.prototype,"basemap",void 0);c.__decorate([w.property({type:E,json:{read:{source:"clippingArea.geometry",reader:L.fromJSON},write:{target:"clippingArea.geometry"}}})],l.prototype,"clippingArea",void 0);c.__decorate([B.writer("clippingArea")],l.prototype,"writeClippingArea",null);c.__decorate([w.property({type:Boolean,json:{write:{target:"clippingArea.clip"}}})],
l.prototype,"clippingEnabled",void 0);c.__decorate([A.reader("clippingEnabled",["clippingArea"])],l.prototype,"readClippingEnabled",null);c.__decorate([B.writer("clippingEnabled")],l.prototype,"writeClippingEnabled",null);c.__decorate([w.property({type:I,json:{read:{source:"mapFloorInfo"},write:{target:"mapFloorInfo"}}})],l.prototype,"floorInfo",void 0);c.__decorate([w.property({type:F,json:{write:!0}})],l.prototype,"heightModelInfo",void 0);c.__decorate([w.property({json:{write:{target:"operationalLayers",
ignoreOrigin:!0}}})],l.prototype,"layers",void 0);c.__decorate([B.writer("layers")],l.prototype,"writeLayers",null);c.__decorate([w.property({readOnly:!0,type:ba.Version,json:{type:(()=>{const ka=[],la=ea.major;for(let Z=8;Z<=ea.minor;Z++)ka.push(`${la}.${Z}`);return ka})(),write:{ignoreOrigin:!0,target:"version",isRequired:!0,overridePolicy:()=>({enabled:!0,allowNull:!0,ignoreOrigin:!0})}}})],l.prototype,"sourceVersion",void 0);c.__decorate([A.reader("sourceVersion",["version"])],l.prototype,"readSourceVersion",
null);c.__decorate([B.writer("sourceVersion")],l.prototype,"writeSourceVersion",null);c.__decorate([w.property({json:{read:!1,write:!1}})],l.prototype,"tables",void 0);c.__decorate([w.property()],l.prototype,"thumbnailUrl",null);c.__decorate([w.property({type:String,json:{write:{writerEnsuresNonNull:!0,ignoreOrigin:!0}}})],l.prototype,"authoringApp",null);c.__decorate([B.writer("authoringApp")],l.prototype,"writeAuthoringApp",null);c.__decorate([w.property({type:String,json:{write:{writerEnsuresNonNull:!0,
ignoreOrigin:!0}}})],l.prototype,"authoringAppVersion",null);c.__decorate([B.writer("authoringAppVersion")],l.prototype,"writeAuthoringAppVersion",null);c.__decorate([w.property({json:{write:{isRequired:!0,allowNull:!0,ignoreOrigin:!0,enabled:!0}}})],l.prototype,"ground",void 0);c.__decorate([B.writer("ground")],l.prototype,"writeGround",null);c.__decorate([w.property({type:v.ofType(X),json:{write:!0}})],l.prototype,"transportationNetworks",void 0);c.__decorate([w.property({type:Q,nonNullable:!0,
json:{write:{ignoreOrigin:!0,writer:(ka,la,Z,ca)=>{ka.slides&&0<ka.slides.length&&(la.presentation=ka.write({},{...ca,isPresentation:!0}))}}}})],l.prototype,"presentation",void 0);c.__decorate([w.property({type:W,nonNullable:!0,json:{write:{target:"initialState",isRequired:!0,ignoreOrigin:!0},default:()=>new W({viewingMode:"global",spatialReference:O.WebMercator})}})],l.prototype,"initialViewProperties",void 0);c.__decorate([A.reader("initialViewProperties",["initialState.environment","spatialReference",
"viewingMode","initialState.viewpoint"])],l.prototype,"readInitialViewProperties",null);c.__decorate([w.property({type:O,json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],l.prototype,"spatialReference",null);c.__decorate([w.property({type:["local","global"],json:{read:!1,write:{isRequired:!0,ignoreOrigin:!0}}})],l.prototype,"viewingMode",null);c.__decorate([w.property({type:J})],l.prototype,"portalItem",void 0);c.__decorate([w.property()],l.prototype,"resourceInfo",void 0);l=c.__decorate([x.subclass("esri.WebScene")],
l);var ia;(function(ka){ka[ka.SAVE=0]="SAVE";ka[ka.SAVE_AS=1]="SAVE_AS"})(ia||(ia={}));return l})},"esri/core/accessorSupport/originUtils":function(){define(["exports","../multiOriginJSONSupportUtils"],function(a,b){a.updateOrigins=function(c){c&&c.writtenProperties&&c.writtenProperties.forEach(({target:n,propName:l,newOrigin:u})=>{b.isMultiOriginJSONMixin(n)&&u&&n.originOf(l)!==u&&n.updateOrigin(l,u)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/multiOriginJSONSupportUtils":function(){define(["exports"],
function(a){a.isMultiOriginJSONMixin=function(b){return b&&"getAtOrigin"in b&&"originOf"in b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/support/MapFloorInfo":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../layers/support/FacilityLayerInfo ../layers/support/LevelLayerInfo ../layers/support/SiteLayerInfo".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){c=function(g){function p(t){t=g.call(this,t)||this;t.levelLayer=null;t.facilityLayer=null;t.siteLayer=null;return t}a._inheritsLoose(p,g);return p}(c.JSONSupport);b.__decorate([n.property({type:d,json:{write:!0}})],c.prototype,"levelLayer",void 0);b.__decorate([n.property({type:h,json:{write:!0}})],c.prototype,"facilityLayer",void 0);b.__decorate([n.property({type:e,json:{write:!0}})],c.prototype,"siteLayer",void 0);return c=b.__decorate([m.subclass("esri.support.MapFloorInfo")],
c)})},"esri/layers/support/FacilityLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,v,m){c=function(h){function d(e){e=h.call(this,e)||this;e.facilityIdField=null;e.layerId=null;e.nameField=null;e.siteIdField=null;e.sublayerId=null;return e}
a._inheritsLoose(d,h);return d}(c.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"facilityIdField",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"layerId",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"nameField",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"siteIdField",void 0);b.__decorate([n.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},
origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"sublayerId",void 0);return c=b.__decorate([m.subclass("esri.layers.support.FacilityLayerInfo")],c)})},"esri/layers/support/LevelLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,
u,v,m){c=function(h){function d(e){e=h.call(this,e)||this;e.facilityIdField=null;e.layerId=null;e.levelIdField=null;e.levelNumberField=null;e.longNameField=null;e.shortNameField=null;e.sublayerId=null;e.verticalOrderField=null;return e}a._inheritsLoose(d,h);return d}(c.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"facilityIdField",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"layerId",void 0);b.__decorate([n.property({type:String,
json:{write:!0}})],c.prototype,"levelIdField",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"levelNumberField",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"longNameField",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"shortNameField",void 0);b.__decorate([n.property({type:Number,json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"sublayerId",
void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"verticalOrderField",void 0);return c=b.__decorate([m.subclass("esri.layers.support.LevelLayerInfo")],c)})},"esri/layers/support/SiteLayerInfo":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){c=function(h){function d(e){e=h.call(this,e)||this;e.layerId=null;e.nameField=null;e.siteIdField=null;e.sublayerId=null;return e}a._inheritsLoose(d,h);return d}(c.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"layerId",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"nameField",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"siteIdField",void 0);b.__decorate([n.property({type:Number,
json:{read:{source:"subLayerId"},write:{target:"subLayerId"},origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"sublayerId",void 0);return c=b.__decorate([m.subclass("esri.layers.support.SiteLayerInfo")],c)})},"esri/support/webSceneUtils":function(){define(["exports","../core/Error"],function(a,b){a.createCopyError=function(){return new b("webscene:failed-to-copy-embedded-resources","Copying of embedded resources is currently not supported")};a.createSchemaValidationError=function(c){return new b("webscene:schema-validation",
"Failed to save webscene due to schema validation errors. See 'details.errors' for more detailed information",{errors:c})};a.isCopyError=function(c){return c&&"webscene:failed-to-copy-embedded-resources"===c.name};a.isSchemaValidationError=function(c){return c&&"webscene:schema-validation"===c.name};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/spatialReferenceSupport":function(){define(["exports","../../geometry/support/SupportedGCSWkids",
"../ViewingMode"],function(a,b,c){a.isSpatialReferenceSupported=function(n,l){return null==n?!1:null==l?!0:l===c.ViewingMode.Local?n.isGeographic?n.isWGS84||n.wkid===b.SupportedGCSWkids.CGCS2000:!0:n.isWebMercator||n.isWGS84||n.wkid===b.SupportedGCSWkids.CGCS2000||n.wkid===b.SupportedGCSWkids.GCSMARS2000||n.wkid===b.SupportedGCSWkids.GCSMARS2000_SPHERE||n.wkid===b.SupportedGCSWkids.GCSMOON2000};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webdoc/support/saveUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/asyncUtils ../../core/Error ../../core/promiseUtils ../../core/uuid ../../portal/support/resourceUtils".split(" "),
function(a,b,c,n,l,u,v){function m(){m=b._asyncToGenerator(function*(p,t,q){if(t&&t.resources){var k=t.portalItem===p.portalItem?new Set(p.paths):new Set;p.paths.length=0;p.portalItem=t.portalItem;var r=new Set(t.resources.toKeep.map(w=>w.resource.path)),y=new Set,f=[];r.forEach(w=>{k.delete(w);p.paths.push(w)});for(const w of t.resources.toUpdate)if(k.delete(w.resource.path),r.has(w.resource.path)||y.has(w.resource.path)){const {resource:z,content:A,finish:x,error:B}=w,C=v.getSiblingOfSameTypeI(z,
u.generateUUID());p.paths.push(C.path);f.push(h({resource:C,content:A,finish:x,error:B},q))}else p.paths.push(w.resource.path),f.push(e(w,q)),y.add(w.resource.path);for(const w of t.resources.toAdd)f.push(h(w,q)),p.paths.push(w.resource.path);k.forEach(w=>{w=t.portalItem.resourceFromPath(w);f.push(w.portalItem.removeResource(w).catch(()=>{}))});if(0!==f.length&&(r=yield l.eachAlways(f),l.throwIfAborted(q),q=r.filter(w=>"error"in w).map(w=>w.error),0<q.length))throw new n("save:resources","Failed to save one or more resources",
{errors:q});}});return m.apply(this,arguments)}function h(p,t){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(p,t){t=yield c.result(p.resource.portalItem.addResource(p.resource,p.content,t));if(!0===t.ok)p.finish&&p.finish(p.resource);else throw p.error&&p.error(t.error),t.error;});return d.apply(this,arguments)}function e(p,t){return g.apply(this,arguments)}function g(){g=b._asyncToGenerator(function*(p,t){t=yield c.result(p.resource.update(p.content,t));if(!0===t.ok)p.finish(p.resource);
else throw p.error(t.error),t.error;});return g.apply(this,arguments)}a.saveResources=function(p,t,q){return m.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/resourceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../request ../../core/Error ../../core/maybe ../../core/urlUtils".split(" "),function(a,b,c,n,l,u){function v(){v=b._asyncToGenerator(function*(q,k={},r){yield q.load(r);
var y=u.join(q.itemUrl,"resources");const {start:f=1,num:w=10,sortOrder:z="asc",sortField:A="created"}=k;k={query:{start:f,num:w,sortOrder:z,sortField:A,token:q.apiKey},signal:l.get(r,"signal")};y=yield q.portal._request(y,k);return{total:y.total,nextStart:y.nextStart,resources:y.resources.map(({created:x,size:B,resource:C})=>({created:new Date(x),size:B,resource:q.resourceFromPath(C)}))}});return v.apply(this,arguments)}function m(){m=b._asyncToGenerator(function*(q,k,r,y){if(!q.hasPath())throw new n(`portal-item-resource-${k}:invalid-path`,
"Resource does not have a valid path");const f=q.portalItem;yield f.load(y);k=u.join(f.userItemUrl,"add"===k?"addResources":"updateResources");const [w,z]=e(q.path);r=yield p(r);const A=new FormData;w&&"."!==w&&A.append("resourcesPrefix",w);A.append("fileName",z);A.append("file",r,z);A.append("f","json");l.isSome(y)&&y.access&&A.append("access",y.access);yield f.portal._request(k,{method:"post",body:A,signal:l.get(y,"signal")});return q});return m.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(q,
k,r){if(!k.hasPath())throw new n("portal-item-resources-remove:invalid-path","Resource does not have a valid path");yield q.load(r);const y=u.join(q.userItemUrl,"removeResources");yield q.portal._request(y,{method:"post",query:{resource:k.path},signal:l.get(r,"signal")});k.portalItem=null});return h.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(q,k){yield q.load(k);const r=u.join(q.userItemUrl,"removeResources");return q.portal._request(r,{method:"post",query:{deleteAll:!0},signal:l.get(k,
"signal")})});return d.apply(this,arguments)}function e(q){const k=q.lastIndexOf("/");return-1===k?[".",q]:[q.slice(0,k),q.slice(k+1)]}function g(q){{const w=u.getPathExtension(q);q=l.isNone(w)?[q,""]:[q.slice(0,q.length-w.length-1),`.${w}`]}const [k,r]=q,[y,f]=e(k);return[y,f,r]}function p(q){return t.apply(this,arguments)}function t(){t=b._asyncToGenerator(function*(q){return q instanceof Blob?q:(yield c(q.url,{responseType:"blob"})).data});return t.apply(this,arguments)}a.addOrUpdateResource=function(q,
k,r,y){return m.apply(this,arguments)};a.contentToBlob=p;a.fetchResources=function(q){return v.apply(this,arguments)};a.getSiblingOfSameType=function(q,k){if(!q.hasPath())return null;const [r,,y]=g(q.path);return q.portalItem.resourceFromPath(u.join(r,k+y))};a.getSiblingOfSameTypeI=function(q,k){if(!q.hasPath())return null;const [r,,y]=g(q.path);return q.portalItem.resourceFromPath(u.join(r,k+y))};a.removeAllResources=function(q,k){return d.apply(this,arguments)};a.removeResource=function(q,k,r){return h.apply(this,
arguments)};a.splitPrefixFileNameAndExtension=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webdoc/support/thumbnailUtils":function(){define(["exports"],function(a){const b={width:600,height:400};a.getOptimalThumbnailSize=function(c,n){n=n||b;let {width:l,height:u}=n;n=l/u;1.5>n?u=l/1.5:1.5<n&&(l=1.5*u);l>c.width&&(u*=c.width/l,l=c.width);u>c.height&&(l*=c.height/u,u=c.height);return{width:Math.round(l),height:Math.round(u)}};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/ApplicationProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../webdoc/applicationProperties/Viewing".split(" "),function(a,b,c,n,l,u,v,m,h){var d;c=d=function(e){function g(p){p=e.call(this,p)||this;p.viewing=
null;return p}a._inheritsLoose(g,e);g.prototype.clone=function(){return new d({viewing:this.viewing?this.viewing.clone():null})};return g}(c.JSONSupport);b.__decorate([n.property({type:h,json:{write:!0}})],c.prototype,"viewing",void 0);return c=d=b.__decorate([m.subclass("esri.webscene.ApplicationProperties")],c)})},"esri/webdoc/applicationProperties/Viewing":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Search".split(" "),
function(a,b,c,n,l,u,v,m){var h;c=h=function(d){function e(g){g=d.call(this,g)||this;g.search=null;return g}a._inheritsLoose(e,d);e.prototype.clone=function(){return new h(n.clone({search:this.search}))};return e}(c.JSONSupport);b.__decorate([l.property({type:m,json:{write:!0}})],c.prototype,"search",void 0);return c=h=b.__decorate([v.subclass("esri.webdoc.applicationProperties.Viewing")],c)})},"esri/webdoc/applicationProperties/Search":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Collection ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../core/accessorSupport/extensions/serializableProperty/writePolicyUtils ./SearchLayer ./SearchTable".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){var t;const q=c.ofType(g),k=c.ofType(p);c=t=function(r){function y(w){w=r.call(this,w)||this;w.addressSearchEnabled=!0;w.enabled=!0;w.hintText=null;w.layers=new q;w.tables=new k;return w}a._inheritsLoose(y,r);var f=y.prototype;f.readAddressSearchEnabled=function(w){return!w};f.writeAddressSearchEnabled=function(w,z,A){z[A]=!w};f.clone=function(){return new t(l.clone({addressSearchEnabled:this.addressSearchEnabled,enabled:this.enabled,hintText:this.hintText,layers:this.layers,
tables:this.tables}))};return y}(n.JSONSupport);b.__decorate([u.property({type:Boolean,nonNullable:!0,json:{read:{source:"disablePlaceFinder"},write:{target:"disablePlaceFinder",isRequired:!0},origins:{"web-scene":{read:!1,write:!1}}}})],c.prototype,"addressSearchEnabled",void 0);b.__decorate([m.reader("addressSearchEnabled")],c.prototype,"readAddressSearchEnabled",null);b.__decorate([d.writer("addressSearchEnabled")],c.prototype,"writeAddressSearchEnabled",null);b.__decorate([u.property({type:Boolean,
nonNullable:!0,json:{write:!0,origins:{"web-map":{write:{isRequired:!0}},"web-scene":{default:!0,write:!0}}}})],c.prototype,"enabled",void 0);b.__decorate([u.property({type:String,json:{write:!0}})],c.prototype,"hintText",void 0);b.__decorate([u.property({type:q,json:{write:{overridePolicy:e.writeNonEmptyCollectionPolicy},origins:{"web-scene":{write:{isRequired:!0}}}}})],c.prototype,"layers",void 0);b.__decorate([u.property({type:k,json:{read:!0,write:{overridePolicy:e.writeNonEmptyCollectionPolicy}}})],
c.prototype,"tables",void 0);return c=t=b.__decorate([h.subclass("esri.webdoc.applicationProperties.Search")],c)})},"esri/core/accessorSupport/extensions/serializableProperty/writePolicyUtils":function(){define(["exports"],function(a){a.writeNonEmptyCollectionPolicy=function(b){return{enabled:!(null==b||!b.length)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webdoc/applicationProperties/SearchLayer":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchLayerField".split(" "),
function(a,b,c,n,l,u,v,m){var h;c=h=function(d){function e(g){g=d.call(this,g)||this;g.field=null;g.id=null;g.subLayer=null;return g}a._inheritsLoose(e,d);e.prototype.clone=function(){return new h(n.clone({field:this.field,id:this.id,subLayer:this.subLayer}))};return e}(c.JSONSupport);b.__decorate([l.property({type:m,json:{write:{isRequired:!0}}})],c.prototype,"field",void 0);b.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);b.__decorate([l.property({type:u.Integer,
json:{write:!0}})],c.prototype,"subLayer",void 0);return c=h=b.__decorate([v.subclass("esri.webdoc.applicationProperties.SearchLayer")],c)})},"esri/webdoc/applicationProperties/SearchLayerField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),
function(a,b,c,n,l,u,v,m,h,d){var e;c=e=function(g){function p(t){t=g.call(this,t)||this;t.exactMatch=!1;t.name=null;t.type=null;return t}a._inheritsLoose(p,g);p.prototype.clone=function(){return new e({exactMatch:this.exactMatch,type:this.type,name:this.name})};return p}(c.JSONSupport);b.__decorate([n.property({type:Boolean,json:{write:!0}})],c.prototype,"exactMatch",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"name",void 0);b.__decorate([m.enumeration(d.kebabDict)],
c.prototype,"type",void 0);return c=e=b.__decorate([h.subclass("esri.webdoc.applicationProperties.SearchLayerField")],c)})},"esri/webdoc/applicationProperties/SearchTable":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./SearchTableField".split(" "),function(a,b,c,n,l,u,v,m){var h;c=h=function(d){function e(g){g=
d.call(this,g)||this;g.field=null;g.id=null;return g}a._inheritsLoose(e,d);e.prototype.clone=function(){return new h(n.clone({field:this.field,id:this.id}))};return e}(c.JSONSupport);b.__decorate([l.property({type:m,json:{write:{isRequired:!0}}})],c.prototype,"field",void 0);b.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"id",void 0);return c=h=b.__decorate([v.subclass("esri.webdoc.applicationProperties.SearchTable")],c)})},"esri/webdoc/applicationProperties/SearchTableField":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../layers/support/fieldType".split(" "),
function(a,b,c,n,l,u,v,m,h,d){var e;c=e=function(g){function p(t){t=g.call(this,t)||this;t.exactMatch=!1;t.name=null;t.type=null;return t}a._inheritsLoose(p,g);p.prototype.clone=function(){return new e({exactMatch:this.exactMatch,type:this.type,name:this.name})};return p}(c.JSONSupport);b.__decorate([n.property({type:Boolean,json:{write:!0}})],c.prototype,"exactMatch",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"name",void 0);b.__decorate([m.enumeration(d.kebabDict)],
c.prototype,"type",void 0);return c=e=b.__decorate([h.subclass("esri.webdoc.applicationProperties.SearchTableField")],c)})},"esri/webscene/Environment":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/lang ../core/Logger ../core/accessorSupport/decorators/property ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../views/3d/environment/SunnyWeather ../views/3d/environment/weather ./lightingTypes ./SunLighting ./VirtualLighting ./background/utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){var q;const k=l.getLogger("esri.webscene.Environment");l=(r,y,f)=>({enabled:!f||!f.isPresentation});c=q=function(r){function y(w){w=r.call(this,w)||this;w.lighting=new g;w.background=null;w.atmosphereEnabled=!0;w.starsEnabled=!0;return w}a._inheritsLoose(y,r);var f=y.prototype;f.clone=function(){return new q(this.cloneConstructProperties())};f.cloneConstructProperties=function(){return{lighting:this.lighting&&"virtual"===this.lighting.type?p.prototype.clone.call(this.lighting):
g.prototype.clone.call(this.lighting),background:n.clone(this.background),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,weather:this.weather.clone()}};a._createClass(y,[{key:"weather",set:function(w){d.validateWeatherType(null==w?void 0:w.type,k)&&this._set("weather",w)}}]);return y}(c.JSONSupport);b.__decorate([u.property({types:e.lightingTypes,nonNullable:!0,json:{write:!0}})],c.prototype,"lighting",void 0);b.__decorate([u.property(t.backgroundProperty)],c.prototype,"background",
void 0);b.__decorate([u.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],c.prototype,"atmosphereEnabled",void 0);b.__decorate([u.property({type:Boolean,nonNullable:!0,json:{write:{overridePolicy:l}}})],c.prototype,"starsEnabled",void 0);b.__decorate([u.property({types:d.weatherTypes,nonNullable:!0,json:{write:!0},value:new h})],c.prototype,"weather",null);return c=q=b.__decorate([m.subclass("esri.webscene.Environment")],c)})},"esri/views/3d/environment/SunnyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;c=d=function(e){function g(p){p=e.call(this,p)||this;p.type="sunny";p.cloudCover=.5;return p}a._inheritsLoose(g,e);g.prototype.clone=function(){return new d({cloudCover:this.cloudCover})};return g}(c.JSONSupport);b.__decorate([m.enumeration({sunny:"sunny"})],c.prototype,"type",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=d=b.__decorate([h.subclass("esri.views.3d.environment.SunnyWeather")],
c)})},"esri/views/3d/environment/weather":function(){define("exports ./CloudyWeather ./FoggyWeather ./RainyWeather ./SnowyWeather ./SunnyWeather".split(" "),function(a,b,c,n,l,u){b={key:"type",base:u,typeMap:{sunny:u,cloudy:b,rainy:n,snowy:l,foggy:c}};const v=Object.keys(b.typeMap);a.validateWeatherType=function(m,h){return v.includes(m)?!0:(h.error(`"${m}" is not a valid weather type`),!1)};a.weatherEquals=function(m,h){if(m.type!==h.type)return!1;switch(m.type){case "sunny":return m.cloudCover===
h.cloudCover;case "rainy":return m.cloudCover===h.cloudCover&&m.precipitation===h.precipitation;case "snowy":return m.cloudCover===h.cloudCover&&m.precipitation===h.precipitation&&m.snowCover===h.snowCover;case "cloudy":return m.cloudCover===h.cloudCover;case "foggy":return m.fogStrength===h.fogStrength}};a.weatherHeightLimit=1E4;a.weatherTypes=b;a.weatherTypesArray=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;c=d=function(e){function g(p){p=e.call(this,p)||this;p.type="cloudy";p.cloudCover=.5;return p}a._inheritsLoose(g,e);g.prototype.clone=function(){return new d({cloudCover:this.cloudCover})};return g}(c.JSONSupport);b.__decorate([m.enumeration({cloudy:"cloudy"})],c.prototype,"type",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);return c=d=b.__decorate([h.subclass("esri.views.3d.environment.CloudyWeather")],
c)})},"esri/views/3d/environment/FoggyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,v,m,h){var d;c=d=function(e){function g(p){p=e.call(this,p)||this;p.type=
"foggy";p.fogStrength=.5;return p}a._inheritsLoose(g,e);g.prototype.clone=function(){return new d({fogStrength:this.fogStrength})};return g}(c.JSONSupport);b.__decorate([m.enumeration({foggy:"foggy"})],c.prototype,"type",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"fogStrength",void 0);return c=d=b.__decorate([h.subclass("esri.views.3d.environment.FoggyWeather")],c)})},"esri/views/3d/environment/RainyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;c=d=function(e){function g(p){p=e.call(this,p)||this;p.type="rainy";p.cloudCover=.5;p.precipitation=.5;return p}a._inheritsLoose(g,e);g.prototype.clone=function(){return new d({cloudCover:this.cloudCover,precipitation:this.precipitation})};return g}(c.JSONSupport);b.__decorate([m.enumeration({rainy:"rainy"})],c.prototype,"type",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"cloudCover",void 0);b.__decorate([n.property({type:Number,
nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0);return c=d=b.__decorate([h.subclass("esri.views.3d.environment.RainyWeather")],c)})},"esri/views/3d/environment/SnowyWeather":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/JSONSupport ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/enumeration ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;c=d=function(e){function g(p){p=e.call(this,p)||this;p.type="snowy";p.cloudCover=.5;p.precipitation=.5;p.snowCover="disabled";return p}a._inheritsLoose(g,e);g.prototype.clone=function(){return new d({cloudCover:this.cloudCover,precipitation:this.precipitation,snowCover:this.snowCover})};return g}(c.JSONSupport);b.__decorate([m.enumeration({snowy:"snowy"})],c.prototype,"type",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],
c.prototype,"cloudCover",void 0);b.__decorate([n.property({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],c.prototype,"precipitation",void 0);b.__decorate([n.property({type:["enabled","disabled"],nonNullable:!0,json:{write:!0}})],c.prototype,"snowCover",void 0);return c=d=b.__decorate([h.subclass("esri.views.3d.environment.SnowyWeather")],c)})},"esri/webscene/lightingTypes":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",
defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/SunLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/reader ../core/accessorSupport/decorators/subclass ../core/accessorSupport/decorators/writer".split(" "),
function(a,b,c,n,l,u,v,m,h,d){var e;c=e=function(g){function p(q){q=g.call(this,q)||this;q.type="sun";q.date=null;q.directShadowsEnabled=!1;q.displayUTCOffset=null;return q}a._inheritsLoose(p,g);var t=p.prototype;t.readDate=function(q,k){return null!=k.datetime&&new Date(k.datetime)||null};t.writeDate=function(q,k,r){k[r]=q.getTime()};t.readDirectShadowsEnabled=function(q,k){return!!k.directShadows};t.writedirectShadowsEnabled=function(q,k,r){q&&(k[r]=q)};t.writeDisplayUTCOffset=function(q,k){null!=
q&&(k.displayUTCOffset=q)};t.clone=function(){return new e(this.cloneConstructProperties())};t.cloneConstructProperties=function(){const q={directShadowsEnabled:this.directShadowsEnabled,displayUTCOffset:null!=this.displayUTCOffset?this.displayUTCOffset:null};null!=this.date&&(q.date=new Date(this.date.getTime()));return q};return p}(c.JSONSupport);b.__decorate([n.property({readOnly:!0,type:["sun"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([n.property({type:Date,json:{type:Number,
write:{target:"datetime"}}})],c.prototype,"date",void 0);b.__decorate([m.reader("date",["datetime"])],c.prototype,"readDate",null);b.__decorate([d.writer("date")],c.prototype,"writeDate",null);b.__decorate([n.property({type:Boolean,json:{default:!1,write:{target:"directShadows"}}})],c.prototype,"directShadowsEnabled",void 0);b.__decorate([m.reader("directShadowsEnabled",["directShadows"])],c.prototype,"readDirectShadowsEnabled",null);b.__decorate([d.writer("directShadowsEnabled")],c.prototype,"writedirectShadowsEnabled",
null);b.__decorate([n.property({type:Number,json:{write:!0}})],c.prototype,"displayUTCOffset",void 0);b.__decorate([d.writer("displayUTCOffset")],c.prototype,"writeDisplayUTCOffset",null);return c=e=b.__decorate([h.subclass("esri.webscene.SunLighting")],c)})},"esri/webscene/VirtualLighting":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){var h;c=h=function(d){function e(p){p=d.call(this,p)||this;p.type="virtual";p.directShadowsEnabled=!1;return p}a._inheritsLoose(e,d);var g=e.prototype;g.clone=function(){return new h(this.cloneConstructProperties())};g.cloneConstructProperties=function(){return{directShadowsEnabled:this.directShadowsEnabled}};return e}(c.JSONSupport);b.__decorate([n.property({readOnly:!0,type:["virtual"],json:{write:!0}})],c.prototype,"type",void 0);b.__decorate([n.property({type:Boolean,
json:{default:!1,name:"directShadows",write:!0}})],c.prototype,"directShadowsEnabled",void 0);return c=h=b.__decorate([m.subclass("esri.webscene.VirtualLighting")],c)})},"esri/webscene/background/utils":function(){define(["exports","./Background","./ColorBackground"],function(a,b,c){b={base:b,key:"type",typeMap:{color:c}};b={types:b,json:{read:function(n){return(l,u,v)=>{if(!l)return l;for(const m in n.typeMap)if(l.type===m)return u=new n.typeMap[m],u.read(l,v),u}}(b),write:{overridePolicy:(n,l,u)=>
({enabled:!u||!u.isPresentation})}}};a.backgroundProperty=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/background/Background":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,v,m){c=
function(h){function d(e){return h.call(this,e)||this}a._inheritsLoose(d,h);d.prototype.clone=function(){};return d}(c.JSONSupport);b.__decorate([n.property({readOnly:!0,json:{read:!1}})],c.prototype,"type",void 0);return c=b.__decorate([m.subclass("esri.webscene.background.Background")],c)})},"esri/webscene/background/ColorBackground":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/enumeration ../../core/accessorSupport/decorators/subclass ../../symbols/support/materialUtils ./Background".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){var g;l={...d.colorAndTransparencyProperty,nonNullable:!0};e=g=function(p){function t(k){k=p.call(this,k)||this;k.type="color";k.color=new c([0,0,0,1]);return k}a._inheritsLoose(t,p);var q=t.prototype;q.clone=function(){return new g(this.cloneProperties())};q.cloneProperties=function(){return{color:this.color.clone()}};return t}(e);b.__decorate([m.enumeration({color:"color"},{readOnly:!0})],e.prototype,"type",void 0);b.__decorate([n.property(l)],e.prototype,"color",
void 0);return e=g=b.__decorate([h.subclass("esri.webscene.background.ColorBackground")],e)})},"esri/webscene/InitialViewProperties":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Viewpoint ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ../geometry/SpatialReference ./Environment".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){var g;n=g=function(p){function t(q){q=
p.call(this,q)||this;q.environment=new e;q.spatialReference=null;q.viewpoint=null;return q}a._inheritsLoose(t,p);t.prototype.clone=function(){return new g({environment:this.environment.clone(),spatialReference:this.spatialReference?this.spatialReference.clone():null,viewingMode:this.viewingMode,viewpoint:this.viewpoint?this.viewpoint.clone():null})};a._createClass(t,[{key:"viewingMode",set:function(q){this._set("viewingMode",q)}}]);return t}(n.JSONSupport);b.__decorate([l.property({type:e,json:{write:{isRequired:!0}}})],
n.prototype,"environment",void 0);b.__decorate([l.property({type:d})],n.prototype,"spatialReference",void 0);b.__decorate([l.property({type:["local","global"]})],n.prototype,"viewingMode",null);b.__decorate([l.property({type:c,json:{write:{isRequired:!0}}})],n.prototype,"viewpoint",void 0);return n=g=b.__decorate([h.subclass("esri.webscene.InitialViewProperties")],n)})},"esri/webscene/Presentation":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ./Slide".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){const g=c.ofType(e);c=function(p){function t(k){k=p.call(this,k)||this;k.slides=new g;return k}a._inheritsLoose(t,p);var q=t.prototype;q.destroy=function(){this.slides.forEach(k=>k.destroy());this.slides.removeAll()};q.clone=function(){return new this.constructor({slides:this.slides.clone()})};a._createClass(t,[{key:"slides",set:function(k){k&&(k=k.filter(r=>!!r.viewpoint));this._set("slides",n.referenceSetter(k,this._get("slides"),g))}}]);return t}(l.JSONSupport);
b.__decorate([u.property({type:g,nonNullable:!0,json:{write:!0}}),h.cast(n.castForReferenceSetter)],c.prototype,"slides",null);return c=b.__decorate([d.subclass("esri.webscene.Presentation")],c)})},"esri/webscene/Slide":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Basemap ../Viewpoint ../core/asyncUtils ../core/Collection ../core/collectionUtils ../core/JSONSupport ../core/Logger ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3 ../chunks/vec3f64 ../layers/Layer ../layers/mixins/OperationalLayer ../support/basemapUtils ../views/3d/support/mathUtils ../views/3d/support/viewpointUtils ../views/support/Scheduler ../webdoc/support/SlideThumbnail ./SunLighting ./VirtualLighting ./support/Description ./support/SlideEnvironment ./support/SlideGround ./support/SlideVisibleLayer ./support/Title".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M){function J(T){if("building-scene"===T.type||"map-image"===T.type)return T.allSublayers.toArray()}function I(T){if(T=J(T))return T.filter(H=>H.visible).map(H=>H.id)}function P(T,H){T=H-T;43200<T&&(T-=86400);-43200>T&&(T+=86400);return T}let N=0;const V=u.ofType(R.SlideVisibleLayer),S=h.getLogger("esri.webscene.Slide");m=function(T){function H(W){W=T.call(this,W)||this;W.id=Date.now().toString(16)+"-slide-"+N++;W.title=new M;
W.description=new O;W.thumbnail=new E.SlideThumbnail;W.viewpoint=null;W.basemap=null;W.ground=null;W.environment=new K.SlideEnvironment;W.visibleLayers=new V;return W}a._inheritsLoose(H,T);var U=H.prototype;U.destroy=function(){this.visibleLayers.removeAll();this.basemap=null;this.thumbnail&&this.thumbnail.destroy();this.thumbnail=this.title=this.description=null};U.castTitle=function(W){return"string"===typeof W?new M({text:W}):y.ensureType(M,W)};U.castDescription=function(W){return"string"===typeof W?
new O({text:W}):y.ensureType(O,W)};U.castThumbnail=function(W){return"string"===typeof W?new E.SlideThumbnail({url:W}):y.ensureType(E.SlideThumbnail,W)};U.castBasemap=function(W){return x.ensureType(W)};U.castVisibleLayers=function(W){return W&&"function"===typeof W.map?W.map(Q=>{if("string"===typeof Q)return{id:Q};if(Q instanceof z){const X=I(Q);return{id:Q.id,sublayerIds:X}}if(Q.id)return{id:Q.id,sublayerIds:Q.sublayerIds};S.warn('Invalid visible layer, expected { id }, Layer or "id"');return Q}):
null};U.clone=function(){return new this.constructor({id:this.id,title:this.title.clone(),thumbnail:this.thumbnail.clone(),description:this.description&&this.description.clone()||null,viewpoint:this.viewpoint&&this.viewpoint.clone()||null,basemap:this.basemap&&this.basemap.clone()||null,ground:this.ground&&this.ground.clone()||null,visibleLayers:this.visibleLayers.clone(),environment:this.environment&&this.environment.clone()||null})};U._updateVisibleLayersFrom=function(W){const Q=[];return e.eachAlways(this._getLayers(W.map).map(X=>
W.whenLayerView(X).then(ba=>{if(ba.visible){const aa=I(X);Q.push(new R.SlideVisibleLayer({id:ba.layer.id,sublayerIds:aa}))}})).toArray()).then(()=>{this.visibleLayers.removeAll();this.visibleLayers.addMany(Q)})};U.updateFrom=function(W,Q){Q={screenshot:{format:"png",quality:80,width:120,height:75,disableDecorations:!0,...Q&&Q.screenshot}};return W.when(()=>{this.viewpoint=W.viewpoint.clone();this.environment.lighting="virtual"===W.environment.lighting.type?G.prototype.clone.apply(W.environment.lighting):
F.prototype.clone.apply(W.environment.lighting);this.environment.weather=W.environment.weather.clone();this.basemap=W.map.basemap&&W.map.basemap.clone()||null;this.ground=W.map.ground?L.fromGround(W.map.ground):null;return this._updateVisibleLayersFrom(W)}).then(()=>W.takeScreenshot(Q.screenshot)).then(X=>{this.thumbnail=new E.SlideThumbnail({url:X.dataUrl});return this})};U.applyTo=function(){var W=a._asyncToGenerator(function*(Q,X){var ba=this;d.isSome(this._applyToController)&&this._applyToController.abort();
let aa=new AbortController;this._applyToController=aa;const ea=e.onAbortOrThrow(X,()=>aa.abort()),ia=Q.resourceController.scheduler.registerTask(D.TaskPriority.SLIDE);let ka=!1;X={animate:!0,...X,signal:this._applyToController.signal};var la=function(){var Z=a._asyncToGenerator(function*(){yield Promise.all([ia.schedule(()=>ka=ba._setViewpointOfInterest(Q,X)),ia.schedule(()=>ba._applyBasemap(Q,X),X.signal)]);yield Promise.all([ia.schedule(()=>ba._applyLayerVisibility(Q),X.signal),ia.schedule(()=>
ba._applyGround(Q),X.signal),ia.schedule(()=>ba._applyViewpoint(Q,X),X.signal)]);yield ia.schedule(()=>Q.environment.weather=ba.environment.weather.clone())});return function(){return Z.apply(this,arguments)}}();la=yield l.result(Q.addUpdatingPromise(la()));ka&&(Q.contentCamera=null);ia.remove();this._applyToController===aa&&(this._applyToController=null);aa=null;null==ea?void 0:ea.remove();if(!1===la.ok)throw la.error;return this});return function(Q,X){return W.apply(this,arguments)}}();U._applyBasemap=
function(){var W=a._asyncToGenerator(function*(Q,X){if(this.basemap){try{yield this.basemap.load(X)}catch(ba){if(e.isAbortError(ba))throw ba;}Q.map.basemap=x.clonePreservingTiledLayers(this.basemap,Q.map.basemap)}});return function(Q,X){return W.apply(this,arguments)}}();U._applyGround=function(W){this.ground&&(W.map.ground=this.ground.cloneAndApplyTo(W.map.ground))};U._getLayers=function(W){const Q=new u;this._collectLayers(W,Q);this._collectLayers(W.ground,Q);return Q};U._collectLayers=function(W,
Q){W.layers.forEach(X=>{A.isOperationalLayer(X)&&(Q.add(X),"layers"in X&&this._collectLayers(X,Q))})};U._applyLayerVisibility=function(W){this.visibleLayers&&this._getLayers(W.map).forEach(Q=>{var X=this.visibleLayers.find(aa=>aa.id===Q.id);Q.visible=null!=X;const ba=X&&X.sublayerIds;X=J(Q);ba&&X&&X.forEach(aa=>aa.visible=ba.includes(aa.id))})};U._setViewpointOfInterest=function(W,Q){if(W.state.fixedContentCamera||!this.viewpoint||Q.ignoreViewpoint||!Q.useDestinationCamera)return!1;Q=C.toCamera(W,
this.viewpoint);W.contentCamera=Q;return d.isSome(Q)};U._applyViewpoint=function(){var W=a._asyncToGenerator(function*(Q,X){if(this.viewpoint&&!X.ignoreViewpoint){d.isSome(this.viewpoint.camera)&&(this.viewpoint.camera.fov=Q.camera.fov);if(X.animate&&this.get("environment.lighting.date")){yield this._animateToLighting(Q,X);return}X.animate&&(Q.environment.applyLighting(this.environment.lighting.clone()),yield Q.goTo(this.viewpoint,X));Q.viewpoint=this.viewpoint}Q.environment.applyLighting(this.environment.lighting.clone())});
return function(Q,X){return W.apply(this,arguments)}}();U._animateToLighting=function(){var W=a._asyncToGenerator(function*(Q,X){let ba=null;"sun"===Q.environment.lighting.type&&"sun"===this.environment.lighting.type&&("global"===Q.viewingMode&&(ba=this._animateLightingWithCamera(Q,Q.environment.lighting,this.environment.lighting)),Q.environment.lighting.cameraTrackingEnabled=!1);Q.environment.lighting.directShadowsEnabled=this.environment.lighting.directShadowsEnabled;"virtual"===this.environment.lighting.type||
"virtual"===Q.environment.lighting.type?(Q.environment.applyLighting(this.environment.lighting.clone()),"sun"===Q.environment.lighting.type&&(Q.environment.lighting.cameraTrackingEnabled=!1)):null!=this.environment.lighting.displayUTCOffset&&(Q.environment.lighting.displayUTCOffset=this.environment.lighting.displayUTCOffset);return Q.goTo(this.viewpoint,X).then(()=>Q.environment.applyLighting(this.environment.lighting.clone())).finally(()=>{d.removeMaybe(ba);"sun"===Q.environment.lighting.type&&(Q.environment.lighting.cameraTrackingEnabled=
!0)})});return function(Q,X){return W.apply(this,arguments)}}();U._getTime=function(W){const Q=W.getTime();W=3600*W.getUTCHours()+60*W.getUTCMinutes()+W.getUTCSeconds();return[Q,W]};U._setTime=function(W,Q,X){W.setTime(Q);W.setUTCHours(X/3600);W.setUTCMinutes(X%3600/60);W.setUTCSeconds(X%3600%60);return W};U._animateLightingWithCamera=function(W,Q,X){const [ba,aa]=this._getTime(new Date(Q.date.toString())),[ea,ia]=this._getTime(X.date),ka=P(aa,ia),la=W.renderCoordsHelper,Z=w.create();la.toRenderCoords(W.camera.position,
Z);const ca=w.create(),Y=w.create();d.isSome(this.viewpoint.camera)&&la.toRenderCoords(this.viewpoint.camera.position,ca);const da=new Date;return g.watch(()=>W.camera,ha=>{la.toRenderCoords(ha.position,Y);var ja=f.squaredDistance(Z,Y);const ma=f.squaredDistance(ca,Y);ha=0;0!==ja+ma&&(ha=ja/(ja+ma));ja=ba+(ea-ba)*ha;ha=B.moduloPositive(aa+ka*ha,86400);Q.date=this._setTime(da,ja,ha)})};H.createFrom=function(W,Q){return(new this).updateFrom(W,Q)};a._createClass(H,[{key:"visibleLayers",set:function(W){this._set("visibleLayers",
v.referenceSetter(W,this._get("visibleLayers"),V))}}]);return H}(m.JSONSupport);b.__decorate([p.property({type:String,json:{write:{isRequired:!0}}})],m.prototype,"id",void 0);b.__decorate([p.property({type:M,json:{default:()=>new M({text:""}),write:{isRequired:!0}}})],m.prototype,"title",void 0);b.__decorate([k.cast("title")],m.prototype,"castTitle",null);b.__decorate([p.property({type:O,json:{write:{overridePolicy(T){return{enabled:!(!T||!T.text)}}}}})],m.prototype,"description",void 0);b.__decorate([k.cast("description")],
m.prototype,"castDescription",null);b.__decorate([p.property({type:E.SlideThumbnail,json:{default:()=>new E.SlideThumbnail({url:""}),write:{isRequired:!0}}})],m.prototype,"thumbnail",void 0);b.__decorate([k.cast("thumbnail")],m.prototype,"castThumbnail",null);b.__decorate([p.property({type:n,nonNullable:!0,json:{write:{isRequired:!0}}})],m.prototype,"viewpoint",void 0);b.__decorate([p.property({type:c,json:{read:{source:"baseMap"},write:{target:"baseMap"}}})],m.prototype,"basemap",void 0);b.__decorate([k.cast("basemap")],
m.prototype,"castBasemap",null);b.__decorate([p.property({type:L,json:{write:!0}})],m.prototype,"ground",void 0);b.__decorate([p.property({type:V,json:{write:{isRequired:!0}}})],m.prototype,"visibleLayers",null);b.__decorate([k.cast("visibleLayers")],m.prototype,"castVisibleLayers",null);b.__decorate([p.property({type:K.SlideEnvironment,json:{write:!0}})],m.prototype,"environment",void 0);return m=b.__decorate([r.subclass("esri.webscene.Slide")],m)})},"esri/views/3d/support/mathUtils":function(){define(["exports",
"../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,n){const l=n.create(),u=n.create(),v=n.create(),m=n.create(),h=n.create();a.angle=function(d,e,g){d=c.normalize(m,d);e=c.normalize(h,e);const p=b.acosClamped(c.dot(d,e));return g&&(d=c.cross(v,d,e),0>c.dot(d,g))?-p:p};a.bilerp=function(d,e,g,p,t,q){d+=(e-d)*t;return d+(g+(p-g)*t-d)*q};a.cosCapped=function(d,e){return d>e?Math.cos(e):Math.cos(d)};a.fovx2fovy=function(d,e,g){return 2*Math.atan(g*Math.tan(.5*d)/
e)};a.fovy2fovx=function(d,e,g){return 2*Math.atan(e*Math.tan(.5*d)/g)};a.makeOrthonormal=function(d,e,g){g=g||d;const p=c.dot(d,e);c.set(g,d[0]-p*e[0],d[1]-p*e[1],d[2]-p*e[2]);c.normalize(g,g)};a.makePiecewiseLinearFunction=function(d){const e=d.length;return g=>{if(g<=d[0][0])return d[0][1];if(g>=d[e-1][0])return d[e-1][1];let p=1;for(;g>d[p][0];)p++;const t=d[p][0];g=(t-g)/(t-d[p-1][0]);return g*d[p-1][1]+(1-g)*d[p][1]}};a.maxScale=function(d){return Math.sqrt(Math.max(d[0]*d[0]+d[4]*d[4]+d[8]*
d[8],d[1]*d[1]+d[5]*d[5]+d[9]*d[9],d[2]*d[2]+d[6]*d[6]+d[10]*d[10]))};a.moduloPositive=function(d,e){return(d%e+e)%e};a.planeFromPoints=function(d,e,g,p){c.subtract(l,e,d);c.subtract(u,g,d);c.cross(p,l,u);c.normalize(p,p);p[3]=-c.dot(d,p)};a.scaleFromMatrix=function(d,e){c.set(d,Math.sqrt(e[0]*e[0]+e[4]*e[4]+e[8]*e[8]),Math.sqrt(e[1]*e[1]+e[5]*e[5]+e[9]*e[9]),Math.sqrt(e[2]*e[2]+e[6]*e[6]+e[10]*e[10]));return d};a.slerp=function(d,e,g,p=n.create()){const t=c.length(d);var q=c.length(e),k=c.dot(d,
e)/(t*q);if(.9999999999999999>k){k=Math.acos(k);const r=((1-g)*t+g*q)/Math.sin(k);q=r/q*Math.sin(g*k);c.scale(m,d,r/t*Math.sin((1-g)*k));c.scale(h,e,q);return c.add(p,m,h)}return c.lerp(p,d,e,g)};a.slerpTangent=function(d,e,g,p=n.create(),t=n.create()){const q=c.length(d),k=c.length(e);var r=c.dot(d,e)/(q*k);if(.9999999999999999>r){r=Math.acos(r);const y=Math.sin(r),f=Math.sin(g*r),w=Math.sin((1-g)*r),z=(1-g)*q+g*k;{const A=z/y,x=A/k*f;c.scale(m,d,A/q*w);c.scale(h,e,x);c.add(p,m,h)}c.scale(m,d,1/
q*(-Math.cos((1-g)*r)*r*z+w*(-q+k)));c.scale(h,e,1/k*(Math.cos(g*r)*r*z+f*(-q+k)));c.add(t,m,h);c.scale(t,t,1/y);return t}c.lerp(p,d,e,g);c.subtract(t,e,d);c.normalize(t,t);return t};a.tangentFrame=function(d,e,g){Math.abs(d[0])>Math.abs(d[1])?c.set(e,0,1,0):c.set(e,1,0,0);c.cross(g,d,e);c.normalize(e,e);c.cross(e,g,d);c.normalize(g,g)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/viewpointUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../geometry ../../../Graphic ../../../Viewpoint ../../../core/asyncUtils ../../../core/has ../../../core/Cyclical ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/webMercatorUtils ../camera/intersectionUtils ./cameraUtils ./ElevationProvider ../../../geometry/Point ../../../geometry/SpatialReference ../../../geometry/Extent ../../../geometry/Geometry".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G){function O(ra){return 360-h.cyclicalDegrees.normalize(ra)}function K(ra){return h.cyclicalDegrees.normalize(360-ra)}function L(ra){e.isSome(ra)&&ra.resolver&&ra.resolver.reject();return null}function R(ra,ua,Ba,Ea=null){if(!ua)return L(Ea);var Ja=ra.spatialReference||E.WGS84;if(e.isSome(ua.camera)){ra=A.project(ua.camera.position,Ja);if(e.isNone(ra))return L(Ea);ua=ua.camera.clone();ua.position=ra;ra=ua;e.isSome(Ea)&&Ea.resolver&&
Ea.resolver.resolve(ra);return ra}if(e.isNone(ua.targetGeometry))return L(Ea);var va=ua.get("targetGeometry.spatialReference");if(va&&!A.canProject(va,Ja))return L(Ea);Ja=B.internalToExternal(ra,ra.state.camera);va=B.OrientationMode.ADJUST;null!=ua.rotation&&(Ja.heading=O(ua.rotation),va=B.OrientationMode.LOCKED);null!=Ba&&(Ja.tilt=Ba);if("point"===ua.targetGeometry.type){const Ca=ua.targetGeometry;Ba=ua.targetGeometry.clone();ua=null!=ua.scale?B.scaleToDistance(ra,ua.scale,Ca.latitude):ra.state.camera.distance;
return B.fromCenterDistance(ra,Ba,ua,Ja,va,Ea)}return B.fromExtent(ra,ua.targetGeometry.extent,Ja.heading,Ja.tilt,va,Ea)}function M(){M=b._asyncToGenerator(function*(ra,ua,Ba){if(ua&&ra.spatialReference){var Ea={target:null};if("declaredClass"in ua||Array.isArray(ua))Ea.target=ua;else{for(var Ja in ua)Ea[Ja]=ua[Ja];ua.center&&!Ea.target&&(Ea.target=ua.center)}ua=Ea}else ua=null;if(!ua)throw new d("viewpointutils-create:no-target","Missing target for creating viewpoint");Ea=new c({fov:ra.camera.fov});
Ja=new u({camera:Ea});if(ua.target instanceof u)return ra=yield U(ra,ua.target,ua,Ba,Ja),ca(ra);if(ua.target instanceof c)return ca(Q(ra,ua.target,Ja));var va=null!=ua.scale||null!=ua.zoom;if(ua.target instanceof F){var Ca=ua.target.xmin===ua.target.xmax||ua.target.ymin===ua.target.ymax;return va||Ca?ca(yield X(ra,ua,ua.target.center,Ea,Ba,Ja)):ca(yield ia(ra,ua,ua.target,Ea,Ba,Ja))}Ca={boundingBox:f.empty(),hasZ:!1,screenSpaceObjects:[]};var Ka=va?B.scaleToResolution(ra,J(ra,ua)):void 0;yield T(ra,
ua.target,Ka,Ca);if(isFinite(Ca.boundingBox[0])){f.center(Ca.boundingBox,Y);sa.x=Y[0];sa.y=Y[1];sa.z=Y[2];sa.spatialReference=ra.spatialReference;isFinite(sa.z)&&Ca.hasZ?Ka=f.isPoint(Ca.boundingBox):(sa.z=void 0,Ka=w.isPoint(f.toRect(Ca.boundingBox,ma)));if(va||Ka)return ca(yield X(ra,ua,sa,Ea,Ba,Ja));va=Ca.screenSpaceObjects;if(va.length){Ka=Number.NEGATIVE_INFINITY;for(let Oa=0;Oa<va.length;Oa++){const Ra=va[Oa].screenSpaceBoundingRect;Ka=Math.max(Ka,Math.abs(Ra[0]),Math.abs(Ra[1]),Math.abs(Ra[2]),
Math.abs(Ra[3]))}va=.66-Ka/Math.min(ra.width,ra.height)*2}else va=.66;return ca(yield la(ra,ua,sa,Ca.boundingBox,va,Ea,Ba,Ja))}return ua.position?(Ba=x.cameraOnContentAlongViewDirection(ra),k.copy(pa,Ba.viewForward),B.directionToHeadingTilt(ra,Ba.eye,pa,Ba.up,xa),Ea.position=new D(ua.position),Ea.heading=null!=ua.heading?ua.heading:xa.heading,Ea.tilt=null!=ua.tilt?ua.tilt:xa.tilt,ra=P(ra,null,Ea,Ja),ca(ra)):ca(yield aa(ra,ua,Ea,Ba,Ja))});return M.apply(this,arguments)}function J(ra,ua){return null==
ua.scale&&null!=ua.zoom?B.zoomToScale(ra,ua.zoom):ua.scale}function I(ra,ua){let Ba=!1;null!=ua.heading?(ra.heading=ua.heading,Ba=!0):null!=ua.rotation&&(ra.heading=O(ua.rotation),Ba=!0);null!=ua.tilt&&(ra.tilt=ua.tilt,Ba=!0);null!=ua.fov&&(ra.fov=ua.fov);return Ba}function P(ra,ua,Ba,Ea){const Ja=ra.spatialReference||E.WGS84;ua=e.isSome(ua)?ua:B.externalToInternal(ra,Ba);if(e.isNone(ua))return Ea;Ea.targetGeometry=y.projectVectorToPoint(ua.center,ra.renderSpatialReference,Ja);Ea.scale=B.computeScale(ra,
ua);Ea.rotation=K(Ba.heading);Ea.camera=Ba;return Ea}function N(ra,ua,Ba){if(ua){if(!A.canProject(ua.spatialReference,ra.spatialReference))throw new d("viewpointutils:incompatible-spatialreference",`Spatial reference (${ua.spatialReference?ua.spatialReference.wkid:"unknown"}) is incompatible with the view (${ra.spatialReference.wkid})`,{geometry:ua});var Ea=[];if(!ua.hasZ&&ra.basemapTerrain){switch(ua.type){case "point":var Ja=ua;break;case "multipoint":case "polyline":Ja=ua.extent.center;break;case "mesh":Ja=
ua.origin;break;case "extent":Ja=ua.center;break;case "polygon":Ja=ua.centroid}Ja&&A.canProject(Ja,ra.basemapTerrain.spatialReference)?Y[2]=e.unwrapOr(C.getElevationAtPoint(ra.elevationProvider,Ja),0):Y[2]=0}(0,ya[ua.type])(ua,Ca=>{Ea.push(Ca[0],Ca[1],Ca[2])},Y);var va=Ea.length/3;if(0!==va&&(Ja=Array(Ea.length),y.projectBuffer(Ea,ua.spatialReference,0,Ja,ra.spatialReference,0,va)))for(ua.hasZ&&(Ba.hasZ=!0),ra=0;ra<Ja.length;ra+=3)ua.hasZ?(Y[0]=Ja[ra+0],Y[1]=Ja[ra+1],Y[2]=Ja[ra+2]):(Y[0]=Ja[ra+0],
Y[1]=Ja[ra+1]),f.expandWithVec3(Ba.boundingBox,Y)}}function V(ra,ua,Ba,Ea){return S.apply(this,arguments)}function S(){S=b._asyncToGenerator(function*(ra,ua,Ba,Ea){const Ja=yield v.result(ra.whenViewForGraphic(ua));if(!1!==Ja.ok&&!e.isNone(Ja.value)&&"whenGraphicBounds"in Ja.value)if(Ba=yield v.result(Ja.value.whenGraphicBounds(ua,{minDemResolution:Ba})),!1===Ba.ok)N(ra,ua.geometry,Ea);else{var {screenSpaceObjects:va,boundingBox:Ca}=Ba.value;f.expandWithAABB(Ea.boundingBox,Ca);va&&va.forEach(Ka=>
{Ea.screenSpaceObjects.push(Ka)});isFinite(Ca[2])&&(Ea.hasZ=!0)}else N(ra,ua.geometry,Ea)});return S.apply(this,arguments)}function T(ra,ua,Ba,Ea){return H.apply(this,arguments)}function H(){H=b._asyncToGenerator(function*(ra,ua,Ba,Ea){if(Array.isArray(ua)&&2===ua.length){const Ja=ua[0],va=ua[1];if("number"===typeof Ja&&"number"===typeof va){sa.x=Ja;sa.y=va;sa.z=void 0;sa.spatialReference=ra.spatialReference.isGeographic?ra.spatialReference:E.WGS84;N(ra,sa,Ea);return}}ua&&"function"===typeof ua.map?
yield g.eachAlways(ua.map(Ja=>T(ra,Ja,Ba,Ea))):ua instanceof G?N(ra,ua,Ea):ua instanceof l&&(yield V(ra,ua,Ba,Ea))});return H.apply(this,arguments)}function U(ra,ua,Ba,Ea,Ja){return W.apply(this,arguments)}function W(){W=b._asyncToGenerator(function*(ra,ua,Ba,Ea,Ja){if(e.isSome(ua.camera))return Q(ra,ua.camera,Ja);Ja.scale=ua.scale;Ja.rotation=ua.rotation;Ja.targetGeometry=e.isSome(ua.targetGeometry)?ua.targetGeometry.clone():null;Ja.camera=null;null!=Ba.heading?Ja.rotation=K(Ba.heading):null!=Ba.rotation&&
(Ja.rotation=Ba.rotation);ua=J(ra,Ba);null!=ua&&(Ja.scale=ua);Ea=new B.AsyncContext(Ea);R(ra,Ja,Ba.tilt,Ea);Ja.camera=yield Ea.resolver.promise;return Ja});return W.apply(this,arguments)}function Q(ra,ua,Ba){const Ea=A.project(ua.position,ra.spatialReference);if(e.isNone(Ea))return null;ua=ua.clone();ua.fov=ra.camera.fov;ua.position=Ea;return P(ra,null,ua,Ba)}function X(ra,ua,Ba,Ea,Ja,va){return ba.apply(this,arguments)}function ba(){ba=b._asyncToGenerator(function*(ra,ua,Ba,Ea,Ja,va){if(e.isNone(Ba))throw new d("createfromcenter",
"invalid point");va.targetGeometry=Ba.clone();const Ca=x.cameraOnContentAlongViewDirection(ra);if(ua.position)return Ba=va.targetGeometry,Ja=ra.renderSpatialReference,y.projectPointToVector(ua.position,na,Ja),y.projectPointToVector(Ba,wa,Ja),va.targetGeometry=new D(Ba),Ea.position=new D(ua.position),k.subtract(pa,wa,na),B.directionToHeadingTilt(ra,na,pa,Ca.up,Ea),va.scale=B.distanceToScale(ra,k.distance(na,wa),va.targetGeometry.latitude),va.rotation=K(Ea.heading),va.camera=Ea,va;if(ua.zoomFactor){var Ka=
Ca.distance/ua.zoomFactor;const Oa=k.scale(Y,Ca.viewForward,-Ka);Ca.eye=k.add(Y,Ca.center,Oa);va.scale=B.distanceToScale(ra,Ka,Ba.latitude)}B.internalToExternal(ra,Ca,Ea);Ka=I(Ea,ua)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;ua.zoomFactor||(va.scale=J(ra,ua),null==va.scale&&(y.projectPointToVector(Ba,Y,ra.renderSpatialReference),z.intersectsPoint(Ca.frustum,Y)?va.scale=B.distanceToScale(ra,k.distance(Ca.eye,Y),Ba.latitude):va.scale=B.computeScale(ra,Ca)),ua=new B.AsyncContext(Ja),B.fromCenterScale(ra,
va.targetGeometry,va.scale,Ea,Ka,ua),va.camera=yield ua.resolver.promise);return va});return ba.apply(this,arguments)}function aa(ra,ua,Ba,Ea,Ja){return ea.apply(this,arguments)}function ea(){ea=b._asyncToGenerator(function*(ra,ua,Ba,Ea,Ja){var va=x.cameraOnContentAlongViewDirection(ra);va=y.projectVectorToPoint(va.center,ra.renderSpatialReference,ra.spatialReference);return X(ra,ua,va,Ba,Ea,Ja)});return ea.apply(this,arguments)}function ia(ra,ua,Ba,Ea,Ja,va){return ka.apply(this,arguments)}function ka(){ka=
b._asyncToGenerator(function*(ra,ua,Ba,Ea,Ja,va){va.targetGeometry=Ba.clone();const Ca=x.cameraOnContentAlongViewDirection(ra);B.internalToExternal(ra,Ca,Ea);ua=I(Ea,ua)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;Ja=new B.AsyncContext(Ja);B.fromExtent(ra,Ba,Ea.heading,Ea.tilt,ua,Ja);va.camera=yield Ja.resolver.promise;return va});return ka.apply(this,arguments)}function la(ra,ua,Ba,Ea,Ja,va,Ca,Ka){return Z.apply(this,arguments)}function Z(){Z=b._asyncToGenerator(function*(ra,ua,Ba,Ea,Ja,va,
Ca,Ka){Ka.targetGeometry=Ba.clone();const Oa=x.cameraOnContentAlongViewDirection(ra);var Ra=0;Ba.hasZ?Ra=Ba.z:ra.basemapTerrain&&(Ra=e.unwrap(C.getElevationAtPoint(ra.elevationProvider,Ba)));k.set(Y,Ba.x,Ba.y,Ra);y.computeTranslationToOriginAndRotation(ra.spatialReference,Y,da,ra.renderSpatialReference);p.fromMat4(ha,da);p.transpose(ha,ha);f.empty(ja);Ba=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];for(var Pa=0;Pa<Ba.length;Pa++){const qa=Ba[Pa];let za=Ea[qa[2]];isFinite(za)||
(za=Ra);k.set(Y,Ea[qa[0]],Ea[qa[1]],za);y.projectVectorToVector(Y,ra.spatialReference,Y,ra.renderSpatialReference);f.expandWithVec3(ja,k.transformMat3(Y,Y,ha))}Ea=f.width(ja);Ra=f.height(ja);Ba=f.depth(ja);Pa=1/Math.tan(Oa.fovY/2);Ja=Math.max(.5*Math.sqrt(Ea*Ea+Ba*Ba)*Math.max(Pa,1/Math.tan(Oa.fovX/2))+.5*Ra,.5*Ra*Pa+.5*Math.max(Ea,Ba))/Ja;B.internalToExternal(ra,Oa,va);ua=I(va,ua)?B.OrientationMode.LOCKED:B.OrientationMode.ADJUST;Ka.scale=B.distanceToScale(ra,Ja,Ka.targetGeometry.latitude);Ca=new B.AsyncContext(Ca);
B.fromCenterScale(ra,Ka.targetGeometry,Ka.scale,va,ua,Ca);Ka.camera=yield Ca.resolver.promise;return Ka});return Z.apply(this,arguments)}function ca(ra){ra&&e.isSome(ra.camera)&&(ra.rotation=K(ra.camera.heading));return ra}const Y=r.create(),da=q.create(),ha=t.create(),ja=f.create(),ma=w.create(),pa=r.create(),na=r.create(),wa=r.create(),xa={heading:0,tilt:0},sa=new D,ya={point(ra,ua,Ba){Ba[0]=ra.x;Ba[1]=ra.y;ra.hasZ&&(Ba[2]=ra.z);ua(Ba)},polygon(ra,ua,Ba){const Ea=ra.hasZ;for(let Ja=0;Ja<ra.rings.length;Ja++){const va=
ra.rings[Ja];for(let Ca=0;Ca<va.length;Ca++)Ba[0]=va[Ca][0],Ba[1]=va[Ca][1],Ea&&(Ba[2]=va[Ca][2]),ua(Ba)}},polyline(ra,ua,Ba){const Ea=ra.hasZ;for(let Ja=0;Ja<ra.paths.length;Ja++){const va=ra.paths[Ja];for(let Ca=0;Ca<va.length;Ca++)Ba[0]=va[Ca][0],Ba[1]=va[Ca][1],Ea&&(Ba[2]=va[Ca][2]),ua(Ba)}},multipoint(ra,ua,Ba){const Ea=ra.points;ra=ra.hasZ;for(let Ja=0;Ja<Ea.length;Ja++)Ba[0]=Ea[Ja][0],Ba[1]=Ea[Ja][1],ra&&(Ba[2]=Ea[Ja][2]),ua(Ba)},extent(ra,ua,Ba){ra.hasZ?(ua(k.set(Ba,ra.xmin,ra.ymin,ra.zmin)),
ua(k.set(Ba,ra.xmax,ra.ymin,ra.zmin)),ua(k.set(Ba,ra.xmin,ra.ymax,ra.zmin)),ua(k.set(Ba,ra.xmax,ra.ymax,ra.zmin)),ua(k.set(Ba,ra.xmin,ra.ymin,ra.zmax)),ua(k.set(Ba,ra.xmax,ra.ymin,ra.zmax)),ua(k.set(Ba,ra.xmin,ra.ymax,ra.zmax)),ua(k.set(Ba,ra.xmax,ra.ymax,ra.zmax))):(ua(k.set(Ba,ra.xmin,ra.ymin,Ba[2])),ua(k.set(Ba,ra.xmax,ra.ymin,Ba[2])),ua(k.set(Ba,ra.xmin,ra.ymax,Ba[2])),ua(k.set(Ba,ra.xmax,ra.ymax,Ba[2])))},mesh(ra,ua,Ba){if(ra=ra.vertexAttributes&&ra.vertexAttributes.position)for(let Ea=0;Ea<
ra.length;Ea+=3)ua(k.set(Ba,ra[Ea+0],ra[Ea+1],ra[Ea+2]))}};a.create=function(ra,ua,Ba){return M.apply(this,arguments)};a.fromCamera=function(ra,ua,Ba=null){e.isNone(Ba)&&(Ba=new u);return P(ra,null,ua.clone(),Ba)};a.headingToRotation=K;a.rotationToHeading=O;a.toCamera=R;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat3":function(){define(["exports","./common"],function(a,b){function c(M,J){M[0]=J[0];M[1]=J[1];M[2]=J[2];M[3]=J[4];M[4]=J[5];
M[5]=J[6];M[6]=J[8];M[7]=J[9];M[8]=J[10];return M}function n(M,J){M[0]=J[0];M[1]=J[1];M[2]=J[2];M[3]=J[3];M[4]=J[4];M[5]=J[5];M[6]=J[6];M[7]=J[7];M[8]=J[8];return M}function l(M,J,I,P,N,V,S,T,H,U){M[0]=J;M[1]=I;M[2]=P;M[3]=N;M[4]=V;M[5]=S;M[6]=T;M[7]=H;M[8]=U;return M}function u(M){M[0]=1;M[1]=0;M[2]=0;M[3]=0;M[4]=1;M[5]=0;M[6]=0;M[7]=0;M[8]=1;return M}function v(M,J){if(M===J){const I=J[1],P=J[2],N=J[5];M[1]=J[3];M[2]=J[6];M[3]=I;M[5]=J[7];M[6]=P;M[7]=N}else M[0]=J[0],M[1]=J[3],M[2]=J[6],M[3]=J[1],
M[4]=J[4],M[5]=J[7],M[6]=J[2],M[7]=J[5],M[8]=J[8];return M}function m(M,J){const I=J[0],P=J[1],N=J[2],V=J[3],S=J[4],T=J[5],H=J[6],U=J[7];J=J[8];const W=J*S-T*U,Q=-J*V+T*H,X=U*V-S*H;let ba=I*W+P*Q+N*X;if(!ba)return null;ba=1/ba;M[0]=W*ba;M[1]=(-J*P+N*U)*ba;M[2]=(T*P-N*S)*ba;M[3]=Q*ba;M[4]=(J*I-N*H)*ba;M[5]=(-T*I+N*V)*ba;M[6]=X*ba;M[7]=(-U*I+P*H)*ba;M[8]=(S*I-P*V)*ba;return M}function h(M,J){const I=J[0],P=J[1],N=J[2],V=J[3],S=J[4],T=J[5],H=J[6],U=J[7];J=J[8];M[0]=S*J-T*U;M[1]=N*U-P*J;M[2]=P*T-N*S;
M[3]=T*H-V*J;M[4]=I*J-N*H;M[5]=N*V-I*T;M[6]=V*U-S*H;M[7]=P*H-I*U;M[8]=I*S-P*V;return M}function d(M){const J=M[3],I=M[4],P=M[5],N=M[6],V=M[7],S=M[8];return M[0]*(S*I-P*V)+M[1]*(-S*J+P*N)+M[2]*(V*J-I*N)}function e(M,J,I){const P=J[0],N=J[1],V=J[2],S=J[3],T=J[4],H=J[5],U=J[6],W=J[7];J=J[8];const Q=I[0],X=I[1],ba=I[2],aa=I[3],ea=I[4],ia=I[5],ka=I[6],la=I[7];I=I[8];M[0]=Q*P+X*S+ba*U;M[1]=Q*N+X*T+ba*W;M[2]=Q*V+X*H+ba*J;M[3]=aa*P+ea*S+ia*U;M[4]=aa*N+ea*T+ia*W;M[5]=aa*V+ea*H+ia*J;M[6]=ka*P+la*S+I*U;M[7]=
ka*N+la*T+I*W;M[8]=ka*V+la*H+I*J;return M}function g(M,J,I){const P=J[0],N=J[1],V=J[2],S=J[3],T=J[4],H=J[5],U=J[6],W=J[7];J=J[8];const Q=I[0];I=I[1];M[0]=P;M[1]=N;M[2]=V;M[3]=S;M[4]=T;M[5]=H;M[6]=Q*P+I*S+U;M[7]=Q*N+I*T+W;M[8]=Q*V+I*H+J;return M}function p(M,J,I){const P=J[0],N=J[1],V=J[2],S=J[3],T=J[4],H=J[5],U=J[6],W=J[7];J=J[8];const Q=Math.sin(I);I=Math.cos(I);M[0]=I*P+Q*S;M[1]=I*N+Q*T;M[2]=I*V+Q*H;M[3]=I*S-Q*P;M[4]=I*T-Q*N;M[5]=I*H-Q*V;M[6]=U;M[7]=W;M[8]=J;return M}function t(M,J,I){const P=I[0],
N=I[1];I=I[2];M[0]=P*J[0];M[1]=P*J[1];M[2]=P*J[2];M[3]=N*J[3];M[4]=N*J[4];M[5]=N*J[5];M[6]=I*J[6];M[7]=I*J[7];M[8]=I*J[8];return M}function q(M,J,I){const P=I[0];I=I[1];M[0]=P*J[0];M[1]=P*J[1];M[2]=P*J[2];M[3]=I*J[3];M[4]=I*J[4];M[5]=I*J[5];return M}function k(M,J){M[0]=1;M[1]=0;M[2]=0;M[3]=0;M[4]=1;M[5]=0;M[6]=J[0];M[7]=J[1];M[8]=1;return M}function r(M,J){const I=Math.sin(J);J=Math.cos(J);M[0]=J;M[1]=I;M[2]=0;M[3]=-I;M[4]=J;M[5]=0;M[6]=0;M[7]=0;M[8]=1;return M}function y(M,J){M[0]=J[0];M[1]=0;M[2]=
0;M[3]=0;M[4]=J[1];M[5]=0;M[6]=0;M[7]=0;M[8]=1;return M}function f(M,J){M[0]=J[0];M[1]=J[1];M[2]=0;M[3]=J[2];M[4]=J[3];M[5]=0;M[6]=J[4];M[7]=J[5];M[8]=1;return M}function w(M,J){var I=J[0],P=J[1],N=J[2];J=J[3];var V=I+I,S=P+P;const T=N+N;I*=V;const H=P*V;P*=S;const U=N*V,W=N*S;N*=T;V*=J;S*=J;J*=T;M[0]=1-P-N;M[3]=H-J;M[6]=U+S;M[1]=H+J;M[4]=1-I-N;M[7]=W-V;M[2]=U-S;M[5]=W+V;M[8]=1-I-P;return M}function z(M,J){const I=J[0],P=J[1],N=J[2],V=J[4],S=J[5],T=J[6],H=J[8],U=J[9];J=J[10];const W=J*S-T*U,Q=-J*
V+T*H,X=U*V-S*H;var ba=I*W+P*Q+N*X;if(!ba)return null;ba=1/ba;M[0]=W*ba;M[1]=(-J*P+N*U)*ba;M[2]=(T*P-N*S)*ba;M[3]=Q*ba;M[4]=(J*I-N*H)*ba;M[5]=(-T*I+N*V)*ba;M[6]=X*ba;M[7]=(-U*I+P*H)*ba;M[8]=(S*I-P*V)*ba;return M}function A(M,J){const I=J[0],P=J[1],N=J[2],V=J[3],S=J[4],T=J[5],H=J[6],U=J[7];var W=J[8],Q=J[9],X=J[10],ba=J[11];const aa=J[12],ea=J[13],ia=J[14];J=J[15];const ka=I*T-P*S,la=I*H-N*S,Z=I*U-V*S,ca=P*H-N*T,Y=P*U-V*T,da=N*U-V*H,ha=W*ea-Q*aa,ja=W*ia-X*aa;W=W*J-ba*aa;const ma=Q*ia-X*ea;Q=Q*J-ba*
ea;X=X*J-ba*ia;ba=ka*X-la*Q+Z*ma+ca*W-Y*ja+da*ha;if(!ba)return null;ba=1/ba;M[0]=(T*X-H*Q+U*ma)*ba;M[1]=(H*W-S*X-U*ja)*ba;M[2]=(S*Q-T*W+U*ha)*ba;M[3]=(N*Q-P*X-V*ma)*ba;M[4]=(I*X-N*W+V*ja)*ba;M[5]=(P*W-I*Q-V*ha)*ba;M[6]=(ea*da-ia*Y+J*ca)*ba;M[7]=(ia*Z-aa*da-J*la)*ba;M[8]=(aa*Y-ea*Z+J*ka)*ba;return M}function x(M,J,I){M[0]=2/J;M[1]=0;M[2]=0;M[3]=0;M[4]=-2/I;M[5]=0;M[6]=-1;M[7]=1;M[8]=1;return M}function B(M){return"mat3("+M[0]+", "+M[1]+", "+M[2]+", "+M[3]+", "+M[4]+", "+M[5]+", "+M[6]+", "+M[7]+", "+
M[8]+")"}function C(M){return Math.sqrt(M[0]**2+M[1]**2+M[2]**2+M[3]**2+M[4]**2+M[5]**2+M[6]**2+M[7]**2+M[8]**2)}function D(M,J,I){M[0]=J[0]+I[0];M[1]=J[1]+I[1];M[2]=J[2]+I[2];M[3]=J[3]+I[3];M[4]=J[4]+I[4];M[5]=J[5]+I[5];M[6]=J[6]+I[6];M[7]=J[7]+I[7];M[8]=J[8]+I[8];return M}function E(M,J,I){M[0]=J[0]-I[0];M[1]=J[1]-I[1];M[2]=J[2]-I[2];M[3]=J[3]-I[3];M[4]=J[4]-I[4];M[5]=J[5]-I[5];M[6]=J[6]-I[6];M[7]=J[7]-I[7];M[8]=J[8]-I[8];return M}function F(M,J,I){M[0]=J[0]*I;M[1]=J[1]*I;M[2]=J[2]*I;M[3]=J[3]*
I;M[4]=J[4]*I;M[5]=J[5]*I;M[6]=J[6]*I;M[7]=J[7]*I;M[8]=J[8]*I;return M}function G(M,J,I,P){M[0]=J[0]+I[0]*P;M[1]=J[1]+I[1]*P;M[2]=J[2]+I[2]*P;M[3]=J[3]+I[3]*P;M[4]=J[4]+I[4]*P;M[5]=J[5]+I[5]*P;M[6]=J[6]+I[6]*P;M[7]=J[7]+I[7]*P;M[8]=J[8]+I[8]*P;return M}function O(M,J){return M[0]===J[0]&&M[1]===J[1]&&M[2]===J[2]&&M[3]===J[3]&&M[4]===J[4]&&M[5]===J[5]&&M[6]===J[6]&&M[7]===J[7]&&M[8]===J[8]}function K(M,J){const I=M[0],P=M[1],N=M[2],V=M[3],S=M[4],T=M[5],H=M[6],U=M[7];M=M[8];const W=J[0],Q=J[1],X=J[2],
ba=J[3],aa=J[4],ea=J[5],ia=J[6],ka=J[7];J=J[8];return Math.abs(I-W)<=b.EPSILON*Math.max(1,Math.abs(I),Math.abs(W))&&Math.abs(P-Q)<=b.EPSILON*Math.max(1,Math.abs(P),Math.abs(Q))&&Math.abs(N-X)<=b.EPSILON*Math.max(1,Math.abs(N),Math.abs(X))&&Math.abs(V-ba)<=b.EPSILON*Math.max(1,Math.abs(V),Math.abs(ba))&&Math.abs(S-aa)<=b.EPSILON*Math.max(1,Math.abs(S),Math.abs(aa))&&Math.abs(T-ea)<=b.EPSILON*Math.max(1,Math.abs(T),Math.abs(ea))&&Math.abs(H-ia)<=b.EPSILON*Math.max(1,Math.abs(H),Math.abs(ia))&&Math.abs(U-
ka)<=b.EPSILON*Math.max(1,Math.abs(U),Math.abs(ka))&&Math.abs(M-J)<=b.EPSILON*Math.max(1,Math.abs(M),Math.abs(J))}function L(M){const J=b.EPSILON,I=M[0],P=M[1],N=M[2],V=M[3],S=M[4],T=M[5],H=M[6],U=M[7];M=M[8];return Math.abs(1-(I*I+V*V+H*H))<=J&&Math.abs(1-(P*P+S*S+U*U))<=J&&Math.abs(1-(N*N+T*T+M*M))<=J}const R=Object.freeze(Object.defineProperty({__proto__:null,fromMat4:c,copy:n,set:l,identity:u,transpose:v,invert:m,adjoint:h,determinant:d,multiply:e,translate:g,rotate:p,scale:t,scaleByVec2:q,fromTranslation:k,
fromRotation:r,fromScaling:y,fromMat2d:f,fromQuat:w,normalFromMat4Legacy:z,normalFromMat4:A,projection:x,str:B,frob:C,add:D,subtract:E,multiplyScalar:F,multiplyScalarAndAdd:G,exactEquals:O,equals:K,isOrthoNormal:L,mul:e,sub:E},Symbol.toStringTag,{value:"Module"}));a.add=D;a.adjoint=h;a.copy=n;a.determinant=d;a.equals=K;a.exactEquals=O;a.frob=C;a.fromMat2d=f;a.fromMat4=c;a.fromQuat=w;a.fromRotation=r;a.fromScaling=y;a.fromTranslation=k;a.identity=u;a.invert=m;a.isOrthoNormal=L;a.mat3=R;a.mul=e;a.multiply=
e;a.multiplyScalar=F;a.multiplyScalarAndAdd=G;a.normalFromMat4=A;a.normalFromMat4Legacy=z;a.projection=x;a.rotate=p;a.scale=t;a.scaleByVec2=q;a.set=l;a.str=B;a.sub=E;a.subtract=E;a.translate=g;a.transpose=v})},"esri/chunks/mat3f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,1,0,0,0,1]}function c(v){return[v[0],v[1],v[2],v[3],v[4],v[5],v[6],v[7],v[8]]}function n(v,m,h,d,e,g,p,t,q){return[v,m,h,d,e,g,p,t,q]}function l(v,m){return new Float64Array(v,m,9)}const u=Object.freeze(Object.defineProperty({__proto__:null,
create:b,clone:c,fromValues:n,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.mat3f64=u})},"esri/chunks/mat4f64":function(){define(["exports"],function(a){function b(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function c(m){return[m[0],m[1],m[2],m[3],m[4],m[5],m[6],m[7],m[8],m[9],m[10],m[11],m[12],m[13],m[14],m[15]]}function n(m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){return[m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x]}function l(m,h){return new Float64Array(m,h,
16)}const u=b(),v=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l,IDENTITY:u},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=u;a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.mat4f64=v})},"esri/geometry/support/frustum":function(){define("exports ../../core/ObjectStack ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/vec4 ../../chunks/vec4f64 ./clipRay ./plane ./vectorStacks".split(" "),function(a,b,c,n,l,u,v,m,h,d){function e(){return[l.create(),
l.create(),l.create(),l.create(),l.create(),l.create(),l.create(),l.create()]}function g(y,f){h.fromPoints(f[a.PointIndex.FAR_BOTTOM_LEFT],f[a.PointIndex.NEAR_BOTTOM_LEFT],f[a.PointIndex.NEAR_TOP_LEFT],y[a.PlaneIndex.LEFT]);h.fromPoints(f[a.PointIndex.NEAR_BOTTOM_RIGHT],f[a.PointIndex.FAR_BOTTOM_RIGHT],f[a.PointIndex.FAR_TOP_RIGHT],y[a.PlaneIndex.RIGHT]);h.fromPoints(f[a.PointIndex.FAR_BOTTOM_LEFT],f[a.PointIndex.FAR_BOTTOM_RIGHT],f[a.PointIndex.NEAR_BOTTOM_RIGHT],y[a.PlaneIndex.BOTTOM]);h.fromPoints(f[a.PointIndex.NEAR_TOP_LEFT],
f[a.PointIndex.NEAR_TOP_RIGHT],f[a.PointIndex.FAR_TOP_RIGHT],y[a.PlaneIndex.TOP]);h.fromPoints(f[a.PointIndex.NEAR_BOTTOM_LEFT],f[a.PointIndex.NEAR_BOTTOM_RIGHT],f[a.PointIndex.NEAR_TOP_RIGHT],y[a.PlaneIndex.NEAR]);h.fromPoints(f[a.PointIndex.FAR_BOTTOM_RIGHT],f[a.PointIndex.FAR_BOTTOM_LEFT],f[a.PointIndex.FAR_TOP_LEFT],y[a.PlaneIndex.FAR])}function p(y,f){for(let w=0;w<a.NumPlanes.NUM;w++)if(!h.clip(y[w],f))return!1;return!0}a.PlaneIndex=void 0;(function(y){y[y.LEFT=0]="LEFT";y[y.RIGHT=1]="RIGHT";
y[y.BOTTOM=2]="BOTTOM";y[y.TOP=3]="TOP";y[y.NEAR=4]="NEAR";y[y.FAR=5]="FAR"})(a.PlaneIndex||(a.PlaneIndex={}));a.PointIndex=void 0;(function(y){y[y.NEAR_BOTTOM_LEFT=0]="NEAR_BOTTOM_LEFT";y[y.NEAR_BOTTOM_RIGHT=1]="NEAR_BOTTOM_RIGHT";y[y.NEAR_TOP_RIGHT=2]="NEAR_TOP_RIGHT";y[y.NEAR_TOP_LEFT=3]="NEAR_TOP_LEFT";y[y.FAR_BOTTOM_LEFT=4]="FAR_BOTTOM_LEFT";y[y.FAR_BOTTOM_RIGHT=5]="FAR_BOTTOM_RIGHT";y[y.FAR_TOP_RIGHT=6]="FAR_TOP_RIGHT";y[y.FAR_TOP_LEFT=7]="FAR_TOP_LEFT"})(a.PointIndex||(a.PointIndex={}));const t=
{bottom:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.FAR_BOTTOM_LEFT],near:[a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_LEFT],far:[a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_LEFT,a.PointIndex.FAR_TOP_LEFT,a.PointIndex.FAR_TOP_RIGHT],right:[a.PointIndex.NEAR_BOTTOM_RIGHT,a.PointIndex.FAR_BOTTOM_RIGHT,a.PointIndex.FAR_TOP_RIGHT,a.PointIndex.NEAR_TOP_RIGHT],left:[a.PointIndex.FAR_BOTTOM_LEFT,
a.PointIndex.NEAR_BOTTOM_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.FAR_TOP_LEFT],top:[a.PointIndex.FAR_TOP_LEFT,a.PointIndex.NEAR_TOP_LEFT,a.PointIndex.NEAR_TOP_RIGHT,a.PointIndex.FAR_TOP_RIGHT]};a.NumPlanes=void 0;(function(y){y[y.NUM=6]="NUM"})(a.NumPlanes||(a.NumPlanes={}));a.NumPoints=void 0;(function(y){y[y.NUM=8]="NUM"})(a.NumPoints||(a.NumPoints={}));const q=[v.fromValues(-1,-1,-1,1),v.fromValues(1,-1,-1,1),v.fromValues(1,1,-1,1),v.fromValues(-1,1,-1,1),v.fromValues(-1,-1,1,1),v.fromValues(1,
-1,1,1),v.fromValues(1,1,1,1),v.fromValues(-1,1,1,1)],k=new b.ObjectStack(m.create),r=e();a.computePlanes=g;a.copy=function(y,f){for(let w=0;w<a.NumPlanes.NUM;w++)h.copy(y[w],f[w])};a.create=function(y){return y?[h.create(y[0]),h.create(y[1]),h.create(y[2]),h.create(y[3]),h.create(y[4]),h.create(y[5])]:[h.create(),h.create(),h.create(),h.create(),h.create(),h.create()]};a.createPoints=e;a.fromMatrix=function(y,f,w,z=r){y=c.multiply(d.sm4d.get(),f,y);c.invert(y,y);for(f=0;f<a.NumPoints.NUM;++f){const A=
u.transformMat4(d.sv4d.get(),q[f],y);n.set(z[f],A[0]/A[3],A[1]/A[3],A[2]/A[3])}g(w,z)};a.intersectClipRay=function(y,f){for(let w=0;w<a.NumPlanes.NUM;w++)if(!h.clipInfinite(y[w],f))return!1;return!0};a.intersectsAABB=function(y,f){for(let w=0;w<a.NumPlanes.NUM;w++)if(h.isAABBFullyInside(y[w],f))return!1;return!0};a.intersectsLineSegment=function(y,f,w){return p(y,m.fromLineSegmentAndDirection(f,w,k.get()))};a.intersectsPoint=function(y,f){for(let w=0;w<a.NumPlanes.NUM;w++)if(0<h.signedDistance(y[w],
f))return!1;return!0};a.intersectsRay=function(y,f){return p(y,m.fromRay(f,k.get()))};a.intersectsSphere=function(y,f){for(let w=0;w<a.NumPlanes.NUM;w++){const z=y[w];if(z[0]*f[0]+z[1]*f[1]+z[2]*f[2]+z[3]>=f[3])return!1}return!0};a.planePointIndices=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/ObjectStack":function(){define(["exports","./nextTick"],function(a,b){let c=function(){function n(u){this.allocator=u;this._items=[];this._itemsPtr=
0;this._grow()}var l=n.prototype;l.get=function(){0===this._itemsPtr&&b.nextTick(()=>this._reset());this._itemsPtr===this._items.length&&this._grow();return this._items[this._itemsPtr++]};l._reset=function(){this._items.length=Math.min(Math.min(3*Math.max(8,this._itemsPtr),this._itemsPtr+3072),this._items.length);this._itemsPtr=0};l._grow=function(){for(let u=0;u<Math.max(8,Math.min(this._items.length,1024));u++)this._items.push(this.allocator())};return n}();a.ObjectStack=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/clipRay":function(){define(["exports","../../core/ObjectStack","../../chunks/vec3","./ray","./vectorStacks"],function(a,b,c,n,l){function u(e){return e?{ray:n.create(e.ray),c0:e.c0,c1:e.c1}:{ray:n.create(),c0:0,c1:Number.MAX_VALUE}}function v(e,g,p,t=u()){n.copy(e,t.ray);t.c0=g;t.c1=p;return t}function m(e,g,p=u()){const t=c.length(e.vector);n.fromValues(e.origin,g,p.ray);p.c0=0;p.c1=t;return p}function h(e,g,
p){return c.add(p,e.ray.origin,c.scale(p,e.ray.direction,g))}const d=new b.ObjectStack(()=>({c0:0,c1:0,ray:null}));a.copy=function(e,g=u()){return v(e.ray,e.c0,e.c1,g)};a.create=u;a.fromLineSegment=function(e,g=u()){const p=c.normalize(l.sv3d.get(),e.vector);return m(e,p,g)};a.fromLineSegmentAndDirection=m;a.fromRay=function(e,g=u()){n.copy(e,g.ray);g.c0=0;g.c1=Number.MAX_VALUE;return g};a.fromValues=v;a.getAt=h;a.getEnd=function(e,g){return h(e,e.c1,g)};a.getStart=function(e,g){return h(e,e.c0,g)};
a.wrap=function(e,g,p){const t=d.get();t.ray=e;t.c0=g;t.c1=p;return t};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/ray":function(){define("exports ../../core/arrayUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,c,n,l,u){function v(e){return e?{origin:l.clone(e.origin),direction:l.clone(e.direction)}:{origin:l.create(),direction:l.create()}}function m(e,g,p=v()){n.copy(p.origin,
e);n.copy(p.direction,g);return p}function h(e,g){e=n.cross(u.sv3d.get(),n.normalize(u.sv3d.get(),e.direction),n.subtract(u.sv3d.get(),g,e.origin));return n.dot(e,e)}const d=new c.ObjectStack(function(){return{origin:null,direction:null}});a.closestPoint=function(e,g,p){g=n.dot(e.direction,n.subtract(p,g,e.origin));n.add(p,e.origin,n.scale(p,e.direction,g));return p};a.copy=function(e,g=v()){return m(e.origin,e.direction,g)};a.create=v;a.distance=function(e,g){return Math.sqrt(h(e,g))};a.distance2=
h;a.equals=function(e,g){return b.equals(e.origin,g.origin)&&b.equals(e.direction,g.direction)};a.fromPoints=function(e,g,p=v()){n.copy(p.origin,e);n.subtract(p.direction,g,e);return p};a.fromValues=m;a.wrap=function(e,g){const p=d.get();p.origin=e;p.direction=g;return p};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/vectorStacks":function(){define(["exports","../../core/VectorStack"],function(a,b){const c=b.VectorStack.createVec2f64(),
n=b.VectorStack.createVec3f64(),l=b.VectorStack.createVec4f64(),u=b.VectorStack.createMat3f64(),v=b.VectorStack.createMat4f64();b=b.VectorStack.createQuatf64();a.sm3d=u;a.sm4d=v;a.sq4d=b;a.sv2d=c;a.sv3d=n;a.sv4d=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/VectorStack":function(){define("exports ../chunks/_rollupPluginBabelHelpers ./byteSizeEstimations ./nextTick ../chunks/mat3f64 ../chunks/mat4f64 ../chunks/quatf64 ../chunks/vec2f64 ../chunks/vec3f64 ../chunks/vec4f64".split(" "),
function(a,b,c,n,l,u,v,m,h,d){let e=function(){function p(q,k,r){this.itemByteSize=q;this.itemCreate=k;this._buffers=[];this._items=[];this._itemsPtr=0;this._itemsPerBuffer=Math.ceil(r/this.itemByteSize)}var t=p.prototype;t.get=function(){0===this._itemsPtr&&n.nextTick(()=>this._reset());const q=Math.floor(this._itemsPtr/this._itemsPerBuffer);for(;this._buffers.length<=q;){const k=new ArrayBuffer(this._itemsPerBuffer*this.itemByteSize);for(let r=0;r<this._itemsPerBuffer;++r)this._items.push(this.itemCreate(k,
r*this.itemByteSize));this._buffers.push(k)}return this._items[this._itemsPtr++]};t._reset=function(){const q=2*(Math.floor(this._itemsPtr/this._itemsPerBuffer)+1);for(;this._buffers.length>q;)this._buffers.pop(),this._items.length=this._buffers.length*this._itemsPerBuffer;this._itemsPtr=0};p.createVec2f64=function(q=g){return new p(16,m.createView,q)};p.createVec3f64=function(q=g){return new p(24,h.createView,q)};p.createVec4f64=function(q=g){return new p(32,d.createView,q)};p.createMat3f64=function(q=
g){return new p(72,l.createView,q)};p.createMat4f64=function(q=g){return new p(128,u.createView,q)};p.createQuatf64=function(q=g){return new p(32,v.createView,q)};b._createClass(p,[{key:"test",get:function(){return{size:this._buffers.length*this._itemsPerBuffer*this.itemByteSize}}}]);return p}();const g=4*c.ByteSizeUnit.KILOBYTES;a.VectorStack=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quatf64":function(){define(["exports"],function(a){function b(){return[0,
0,0,1]}function c(m){return[m[0],m[1],m[2],m[3]]}function n(m,h,d,e){return[m,h,d,e]}function l(m,h){return new Float64Array(m,h,4)}const u=b(),v=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l,IDENTITY:u},Symbol.toStringTag,{value:"Module"}));a.IDENTITY=u;a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.quatf64=v})},"esri/chunks/vec2f64":function(){define(["exports"],function(a){function b(){return[0,0]}function c(k){return[k[0],k[1]]}function n(k,
r){return[k,r]}function l(k){const r=[0,0],y=Math.min(2,k.length);for(let f=0;f<y;++f)r[f]=k[f];return r}function u(k,r){return new Float64Array(k,r,2)}function v(){return[0,0]}function m(){return[1,1]}function h(){return[1,0]}function d(){return[0,1]}const e=[0,0],g=[1,1],p=[1,0],t=[0,1],q=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,fromArray:l,createView:u,zeros:v,ones:m,unitX:h,unitY:d,ZEROS:e,ONES:g,UNIT_X:p,UNIT_Y:t},Symbol.toStringTag,{value:"Module"}));
a.ONES=g;a.UNIT_X=p;a.UNIT_Y=t;a.ZEROS=e;a.clone=c;a.create=b;a.createView=u;a.fromArray=l;a.fromValues=n;a.ones=m;a.unitX=h;a.unitY=d;a.vec2f64=q;a.zeros=v})},"esri/geometry/support/plane":function(){define("exports ../../core/mathUtils ../../core/maybe ../../chunks/vec3 ../../chunks/vec3f64 ../../chunks/sphere ./vector ./vectorStacks ../../views/3d/support/mathUtils".split(" "),function(a,b,c,n,l,u,v,m,h){function d(F=B){return[F[0],F[1],F[2],F[3]]}function e(F,G){return g(G[0],G[1],G[2],G[3],F)}
function g(F,G,O,K,L=d()){L[0]=F;L[1]=G;L[2]=O;L[3]=K;return L}function p(F,G,O){var K=G[0]*G[0]+G[1]*G[1]+G[2]*G[2];K=1E-5<Math.abs(K-1)&&1E-12<K?1/Math.sqrt(K):1;O[0]=G[0]*K;O[1]=G[1]*K;O[2]=G[2]*K;O[3]=-(O[0]*F[0]+O[1]*F[1]+O[2]*F[2]);return O}function t(F,G,O,K=d()){var L=O[0]-G[0],R=O[1]-G[1],M=O[2]-G[2];O=F[0]-G[0];const J=F[1]-G[1],I=F[2]-G[2];G=R*I-M*J;M=M*O-L*I;L=L*J-R*O;R=G*G+M*M+L*L;R=1E-5<Math.abs(R-1)&&1E-12<R?1/Math.sqrt(R):1;K[0]=G*R;K[1]=M*R;K[2]=L*R;K[3]=-(K[0]*F[0]+K[1]*F[1]+K[2]*
F[2]);return K}function q(F,G,O,K,L){if(3>F.count)return!1;F.getVec(O,f);let R=K,M=!1;for(;R<F.count-1&&!M;)F.getVec(R,w),R++,M=!n.exactEquals(f,w);if(!M)return!1;R=Math.max(R,L);for(M=!1;R<F.count&&!M;)F.getVec(R,z),R++,n.subtract(A,f,w),n.normalize(A,A),n.subtract(x,w,z),n.normalize(x,x),M=!n.exactEquals(f,z)&&!n.exactEquals(w,z)&&.99619469809>Math.abs(n.dot(A,x));if(!M)return 0===O&&1===K&&2===L?!1:q(F,G,0,1,2);t(f,w,z,G);return!0}function k(F,G,O){F=n.scale(m.sv3d.get(),F,n.dot(F,G));n.subtract(O,
G,F);return O}function r(F,G){return n.dot(F,G)+F[3]}function y(F,G,O,K,L){const R=n.dot(F,O);if(0===R)return!1;F=-(n.dot(F,G)+F[3])/R;K&C.CLAMP&&(F=b.clamp(F,0,1));if(!(K&C.INFINITE_MIN)&&0>F||!(K&C.INFINITE_MAX)&&1<F)return!1;n.add(L,G,n.scale(L,O,F));return!0}const f=l.create(),w=l.create(),z=l.create(),A=l.create(),x=l.create(),B=[0,0,1,0];var C;(function(F){F[F.NONE=0]="NONE";F[F.CLAMP=1]="CLAMP";F[F.INFINITE_MIN=4]="INFINITE_MIN";F[F.INFINITE_MAX=8]="INFINITE_MAX"})(C||(C={}));const D=C.INFINITE_MIN|
C.INFINITE_MAX,E=C.INFINITE_MAX;a.UP=B;a.clip=function(F,G){const O=n.dot(F,G.ray.direction);F=-r(F,G.ray.origin);if(0>F&&0<=O)return!1;if(-1E-6<O&&1E-6>O)return 0<F;if((0>F||0>O)&&!(0>F&&0>O))return!0;F/=O;0<O?F<G.c1&&(G.c1=F):F>G.c0&&(G.c0=F);return G.c0<=G.c1};a.clipInfinite=function(F,G){const O=n.dot(F,G.ray.direction);F=-r(F,G.ray.origin);if(-1E-6<O&&1E-6>O)return 0<F;F/=O;0<O?F<G.c1&&(G.c1=F):F>G.c0&&(G.c0=F);return G.c0<=G.c1};a.copy=e;a.create=d;a.distance=function(F,G){return Math.abs(r(F,
G))};a.fromManyPoints=function(F,G){return q(F,G,0,1,2)};a.fromManyPointsSampleAt=q;a.fromNormalAndOffset=function(F,G,O){n.copy(O,F);O[3]=G;return O};a.fromPoints=t;a.fromPositionAndNormal=p;a.fromValues=g;a.fromVectorsAndPoint=function(F,G,O,K){n.cross(z,G,F);return p(O,z,K)};a.intersectLine=function(F,G,O,K){O=n.subtract(m.sv3d.get(),O,G);return y(F,G,O,D,K)};a.intersectLineSegment=function(F,G,O){return y(F,G.origin,G.vector,C.NONE,O)};a.intersectLineSegmentClamp=function(F,G,O){return y(F,G.origin,
G.vector,C.CLAMP,O)};a.intersectRay=function(F,G,O){return c.isSome(G)?y(F,G.origin,G.direction,E,O):!1};a.isAABBFullyInside=function(F,G){const O=G[0],K=G[1],L=G[2],R=G[3],M=G[4];G=G[5];return 0<=F[0]*(0<F[0]?O:R)+F[1]*(0<F[1]?K:M)+F[2]*(0<F[2]?L:G)+F[3]};a.isPointInside=function(F,G){return 0<=r(F,G)};a.isPointOutside=function(F,G){return 0>r(F,G)};a.isSphereFullyInside=function(F,G){return 0<=r(F,u.getCenter(G))-G[3]};a.isSphereFullyOutside=function(F,G){return 0>r(F,u.getCenter(G))+G[3]};a.negate=
function(F,G){G[0]=-F[0];G[1]=-F[1];G[2]=-F[2];G[3]=-F[3];return G};a.normal=function(F){return F};a.projectPoint=function(F,G,O){const K=n.scale(m.sv3d.get(),F,-F[3]);G=n.subtract(m.sv3d.get(),G,K);F=k(F,G,m.sv3d.get());n.add(O,F,K);return O};a.projectPointLocal=function(F,G,O,K){var L=m.sv3d.get(),R=m.sv3d.get();h.tangentFrame(F,L,R);G=n.subtract(m.sv3d.get(),O,G);L=v.projectPointSignedLength(L,G);R=v.projectPointSignedLength(R,G);F=v.projectPointSignedLength(F,G);return n.set(K,L,R,F)};a.projectVector=
k;a.setOffsetFromPoint=function(F,G,O){G!==F&&e(F,G);F[3]=-n.dot(F,O);return F};a.signedDistance=r;a.wrap=function(F=B[0],G=B[1],O=B[2],K=B[3]){return g(F,G,O,K,m.sv4d.get())};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/sphere":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/maybe ./mat4 ./vec3 ./vec3f64 ./vec4 ./vec4f64 ../geometry/support/Axis ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(){return d.create()}function k(H,U=q()){return h.copy(U,H)}function r(H,U){return d.fromValues(H[0],H[1],H[2],U)}function y(H){return H}function f(H){H[0]=H[1]=H[2]=H[3]=0}function w(H,U){H[0]=H[1]=H[2]=0;H[3]=U;return H}function z(H){return H[3]}function A(H){return H}function x(H,U,W,Q){return d.fromValues(H,U,W,Q)}function B(H,U,W){H!==W&&v.copy(W,H);W[3]=H[3]+U;return W}function C(H,U,W){N.error("sphere.setExtent is not yet supported");return H===
W?W:k(H,W)}function D(H,U,W){if(l.isNone(U))return!1;const {origin:Q,direction:X}=U;var ba=V;ba[0]=Q[0]-H[0];ba[1]=Q[1]-H[1];ba[2]=Q[2]-H[2];U=X[0]*X[0]+X[1]*X[1]+X[2]*X[2];const aa=2*(X[0]*ba[0]+X[1]*ba[1]+X[2]*ba[2]);H=aa*aa-4*U*(ba[0]*ba[0]+ba[1]*ba[1]+ba[2]*ba[2]-H[3]*H[3]);if(0>H)return!1;ba=Math.sqrt(H);H=(-aa-ba)/(2*U);U=(-aa+ba)/(2*U);if(0>H||U<H&&0<U)H=U;if(0>H)return!1;W&&(W[0]=Q[0]+X[0]*H,W[1]=Q[1]+X[1]*H,W[2]=Q[2]+X[2]*H);return!0}function E(H,U){return D(H,U,null)}function F(H,U,W){if(D(H,
U,W))return W;H=G(H,U,t.sv3d.get());v.add(W,U.origin,v.scale(t.sv3d.get(),U.direction,v.distance(U.origin,H)/v.length(U.direction)));return W}function G(H,U,W){const Q=t.sv3d.get(),X=t.sm4d.get();v.cross(Q,U.origin,U.direction);const ba=H[3];v.cross(W,Q,U.origin);v.scale(W,W,1/v.length(W)*ba);H=R(H,U.origin);U=p.angle(U.origin,W);u.fromRotation(X,U+H,Q);v.transformMat4(W,W,X);return W}function O(H,U,W){if(D(H,U,W))return W;g.closestPoint(U,H,W);return K(H,W,W)}function K(H,U,W){U=v.subtract(t.sv3d.get(),
U,H);U=v.scale(t.sv3d.get(),U,H[3]/v.length(U));return v.add(W,U,H)}function L(H,U){U=v.subtract(t.sv3d.get(),U,H);U=v.squaredLength(U);return Math.sqrt(Math.abs(U-H[3]*H[3]))}function R(H,U){U=v.subtract(t.sv3d.get(),U,H);U=v.length(U);H=H[3];return n.acosClamped(H/(H+Math.abs(H-U)))}function M(H,U,W,Q){H=v.subtract(S,U,H);switch(W){case e.Axis.X:return W=n.cartesianToSpherical(H,S)[2],v.set(Q,-Math.sin(W),Math.cos(W),0);case e.Axis.Y:return H=n.cartesianToSpherical(H,S),W=H[1],H=H[2],U=Math.sin(W),
v.set(Q,-U*Math.cos(H),-U*Math.sin(H),Math.cos(W));case e.Axis.Z:return v.normalize(Q,H)}}function J(H,U){U=v.subtract(T,U,H);return v.length(U)-H[3]}function I(H,U,W,Q){const X=J(H,U);H=M(H,U,e.Axis.Z,T);W=v.scale(T,H,W-X);return v.add(Q,U,W)}function P(H,U){U=v.squaredDistance(H,U);H=H[3];return U<=H*H}const N=c.getLogger("esri.geometry.support.sphere"),V=m.create(),S=m.create(),T=m.create();b=q();c=Object.freeze(Object.defineProperty({__proto__:null,create:q,copy:k,fromCenterAndRadius:r,wrap:y,
clear:f,fromRadius:w,getRadius:z,getCenter:A,fromValues:x,elevate:B,setExtent:C,intersectRay:D,intersectsRay:E,intersectRayClosestSilhouette:F,closestPointOnSilhouette:G,closestPoint:O,projectPoint:K,distanceToSilhouette:L,angleToSilhouette:R,axisAt:M,altitudeAt:J,setAltitudeAt:I,containsPoint:P,tmpSphere:b},Symbol.toStringTag,{value:"Module"}));a.altitudeAt=J;a.angleToSilhouette=R;a.axisAt=M;a.clear=f;a.closestPoint=O;a.closestPointOnSilhouette=G;a.containsPoint=P;a.copy=k;a.create=q;a.distanceToSilhouette=
L;a.elevate=B;a.fromCenterAndRadius=r;a.fromRadius=w;a.fromValues=x;a.getCenter=A;a.getRadius=z;a.intersectRay=D;a.intersectRayClosestSilhouette=F;a.intersectsRay=E;a.projectPoint=K;a.setAltitudeAt=I;a.setExtent=C;a.sphere=c;a.tmpSphere=b;a.wrap=y})},"esri/geometry/support/Axis":function(){define(["exports"],function(a){a.Axis=void 0;var b=a.Axis||(a.Axis={});b[b.X=0]="X";b[b.Y=1]="Y";b[b.Z=2]="Z";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/vector":function(){define(["exports",
"../../core/mathUtils","../../chunks/vec3","../../chunks/vec3f64"],function(a,b,c,n){const l=n.create(),u=n.create();a.angle=function(v,m){v=c.dot(v,m)/(c.length(v)*c.length(m));return-b.acosClamped(v)};a.angleAroundAxis=function(v,m,h){c.normalize(l,v);c.normalize(u,m);v=c.dot(l,u);v=b.acosClamped(v);m=c.cross(l,l,u);return 0>c.dot(m,h)?2*Math.PI-v:v};a.projectPoint=function(v,m,h){m=c.dot(v,m)/c.dot(v,v);return c.scale(h,v,m)};a.projectPointSignedLength=function(v,m){return c.dot(v,m)/c.length(v)};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/intersectionUtils":function(){define("exports ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../webgl-engine/lib/Intersector".split(" "),function(a,b,c,n,l,u,v){function m(q,k){return q.elevationProvider?b.unwrapOr(q.elevationProvider.getElevation(k[0],k[1],k[2],q.renderCoordsHelper.spatialReference,
"ground"),0):0}function h(q,k,r){if(!q.state.isGlobal)return!1;const y=m(q,k);({far:q}=q.stateManager.constraintsManager.nearFarHeuristic.compute(k,r,q.renderDataExtent,y,t));q*=q;return c.squaredDistance(k,r)>q}const d={},e=n.create(),g=n.create(),p=n.create(),t={near:0,far:0};a.cameraOnContentAlongViewDirection=function(q,k,r,y){const f=q.state.camera.clone();k&&(f.eye=k,f.center=r,f.up=y);k=f.ray;r=d[q.viewingMode];r||(r=v.newIntersector(q.state.viewingMode),r.options.backfacesTerrain=!q.state.isGlobal,
r.options.invisibleTerrain=!0,d[q.viewingMode]=r);({isGlobal:y}=q.state);q.sceneIntersectionHelper.intersectRay(k,r,g)&&!h(q,k.origin,g)?k=!0:!q.renderCoordsHelper.intersectManifold(k,0,g)||h(q,k.origin,g)?y?(r=l.getReferenceEllipsoid(q.spatialReference).radius,r=c.dot(k.origin,k.origin)-r*r,c.scale(g,k.direction,(0<r?Math.sqrt(r)/3:1)/c.length(k.direction)),c.add(g,g,k.origin),k=!0):k=!1:k=!0;k||c.copy(g,f.center);r=q.state.constraints;y=r.minimumPoiDistance;c.squaredDistance(f.eye,g)<y&&(k=r.collision.enabled,
c.copy(p,f.viewForward),c.scale(p,p,y),k?f.eye=c.subtract(e,g,p):c.add(g,f.eye,p),q=q.renderCoordsHelper,y=q.getAltitude(f.eye),r=r.collision.elevationMargin,k&&y<r&&(c.subtract(p,g,f.eye),f.eye=q.setAltitude(e,r,f.eye),c.add(g,f.eye,p)));f.center=g;return f};a.eyeWithinExtent=function(q,k,r,y){return b.isSome(q.renderCoordsHelper.fromRenderCoords(k.eye,e,y))&&u.containsPoint(r,e)};a.surfaceElevationBelowRenderLocation=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/Intersector":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/ray ../../../ViewingMode ./IntersectorInterfaces ./intersectorUtils ./verticalOffsetUtils ../materials/renderers/utils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){let k=function(){function A(B){this.options=
new g.IntersectorOptions;this._results=new r;this.transform=new t.IntersectorTransform;this.tolerance=1E-5;this.verticalOffset=null;this._ray=d.create();this._rayEnd=v.create();this._rayBeginTransformed=v.create();this._rayEndTransformed=v.create();this.viewingMode=null==B?e.ViewingMode.Global:B}var x=A.prototype;x.reset=function(B,C,D){this.resetWithRay(d.fromPoints(B,C,this._ray),D)};x.resetWithRay=function(B,C){this.camera=C;B!==this._ray&&d.copy(B,this._ray);0!==this.options.verticalOffset?this.viewingMode===
e.ViewingMode.Local?this._ray.origin[2]-=this.options.verticalOffset:this.verticalOffset=this.options.verticalOffset:this.verticalOffset=null;u.add(this._rayEnd,this._ray.origin,this._ray.direction);this._results.init(this._ray)};x.intersect=function(B=null,C,D,E,F){this.point=C;this.filterPredicate=E;this.tolerance=null==D?1E-5:D;C=t.getVerticalOffsetObject3D(this.verticalOffset);if(c.isSome(B)&&0<B.length){const G=F?O=>{F(O)&&this.intersectObject(O)}:O=>{this.intersectObject(O)};for(const O of B)B=
O.getSpatialQueryAccelerator&&O.getSpatialQueryAccelerator(),c.isSome(B)?(c.isSome(C)?B.forEachAlongRayWithVerticalOffset(this._ray.origin,this._ray.direction,G,C):B.forEachAlongRay(this._ray.origin,this._ray.direction,G),this.options.selectionMode&&this.options.hud&&B.forEachDegenerateObject(G)):O.objects.forAll(K=>G(K))}this.sortResults()};x.intersectObject=function(B){const C=B.geometryRecords;if(C){var D=B.transformation,E=t.getVerticalOffsetObject3D(this.verticalOffset);for(const F of C){const {geometry:G,
material:O,instanceParameters:K}=F;if(q.isInstanceHidden(K))continue;const L=G.id;this.transform.setAndInvalidateLazyTransforms(D,F.getShaderTransformation());u.transformMat4(this._rayBeginTransformed,this.rayBegin,this.transform.inverse);u.transformMat4(this._rayEndTransformed,this.rayEnd,this.transform.inverse);const R=this.transform.transform;c.isSome(E)&&(E.objectTransform=this.transform);O.intersect(G,K,this.transform.transform,this,this._rayBeginTransformed,this._rayEndTransformed,(M,J,I,P,
N,V)=>{if(0<=M&&(!c.isSome(this.filterPredicate)||this.filterPredicate(this._ray.origin,this._rayEnd,M))){var S=P?this._results.hud:this._results,T=P?H=>{const U={object:B,geometryId:L,triangleNr:I,center:c.isSome(V)?[V[0],V[1],V[2]]:null};H.set(g.IntersectorType.HUD,U,M,J,l.IDENTITY,N)}:H=>H.set(g.IntersectorType.OBJECT,{object:B,geometryId:L,triangleNr:I},M,J,R,N);(null==S.min.drapedLayerOrder||N>=S.min.drapedLayerOrder)&&(null==S.min.dist||M<S.min.dist)&&T(S.min);this.options.store!==g.StoreResults.MIN&&
(null==S.max.drapedLayerOrder||N<S.max.drapedLayerOrder)&&(null==S.max.dist||M>S.max.dist)&&T(S.max);this.options.store===g.StoreResults.ALL&&(P?(P=new f(this._ray),T(P),this._results.hud.all.push(P)):(P=new y(this._ray),T(P),this._results.all.push(P)))}},F.shaderTransformation)}}};x.sortResults=function(B=this._results.all){B.sort((C,D)=>C.dist!==D.dist?c.unwrapOr(C.dist,0)-c.unwrapOr(D.dist,0):C.drapedLayerOrder!==D.drapedLayerOrder?c.unwrapOr(C.drapedLayerOrder,Number.MAX_VALUE)-c.unwrapOr(D.drapedLayerOrder,
Number.MAX_VALUE):c.unwrapOr(D.drapedLayerGraphicOrder,Number.MIN_VALUE)-c.unwrapOr(C.drapedLayerGraphicOrder,Number.MIN_VALUE))};b._createClass(A,[{key:"results",get:function(){return this._results}},{key:"ray",get:function(){return this._ray}},{key:"rayBegin",get:function(){return this._ray.origin}},{key:"rayEnd",get:function(){return this._rayEnd}}]);return A}(),r=function(){function A(){this.min=new y(d.create());this.max=new y(d.create());this.hud={min:new f(d.create()),max:new f(d.create()),
all:[]};this.ground=new y(d.create());this.all=[]}A.prototype.init=function(x){this.min.init(x);this.max.init(x);this.ground.init(x);this.all.length=0;this.hud.min.init(x);this.hud.max.init(x);this.hud.all.length=0};return A}(),y=function(){function A(B){this.intersector=g.IntersectorType.OBJECT;this.normal=v.create();this.transformation=l.create();this._ray=d.create();this.init(B)}var x=A.prototype;x.getIntersectionPoint=function(B){if(!p.isValidIntersectorResult(this))return!1;u.scale(w,this.ray.direction,
this.dist);u.add(B,this.ray.origin,w);return!0};x.getTransformedNormal=function(B){u.copy(z,this.normal);z[3]=0;m.transformMat4(z,z,this.transformation);u.copy(B,z);return u.normalize(B,B)};x.init=function(B){this.drapedLayerGraphicOrder=this.drapedLayerOrder=this.target=this.dist=null;this.intersector=g.IntersectorType.OBJECT;d.copy(B,this._ray)};x.set=function(B,C,D,E,F,G,O){this.intersector=B;this.dist=D;u.copy(this.normal,c.unwrapOr(E,v.UNIT_Z));n.copy(this.transformation,c.unwrapOr(F,l.IDENTITY));
this.target=C;this.drapedLayerOrder=G;this.drapedLayerGraphicOrder=O};x.copy=function(B){d.copy(B.ray,this._ray);this.intersector=B.intersector;this.dist=B.dist;this.target=B.target;this.drapedLayerOrder=B.drapedLayerOrder;this.drapedLayerGraphicOrder=B.drapedLayerGraphicOrder;u.copy(this.normal,B.normal);n.copy(this.transformation,B.transformation)};b._createClass(A,[{key:"ray",get:function(){return this._ray}},{key:"distanceInRenderSpace",get:function(){return c.isSome(this.dist)?(u.scale(w,this.ray.direction,
this.dist),u.length(w)):null}}]);return A}(),f=function(A){function x(){var B=A.apply(this,arguments)||this;B.intersector=g.IntersectorType.HUD;return B}b._inheritsLoose(x,A);return x}(y);const w=v.create(),z=h.create();a.DEFAULT_TOLERANCE=1E-5;a.newIntersector=function(A){return new k(A)};a.newIntersectorResult=function(A){return new y(A)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/IntersectorInterfaces":function(){define(["exports"],
function(a){a.IntersectorType=void 0;(function(b){b[b.OBJECT=0]="OBJECT";b[b.HUD=1]="HUD";b[b.TERRAIN=2]="TERRAIN";b[b.OVERLAY=3]="OVERLAY";b[b.I3S=4]="I3S";b[b.PCL=5]="PCL";b[b.LOD=6]="LOD";b[b.VOXEL=7]="VOXEL"})(a.IntersectorType||(a.IntersectorType={}));a.StoreResults=void 0;(function(b){b[b.MIN=0]="MIN";b[b.MINMAX=1]="MINMAX";b[b.ALL=2]="ALL"})(a.StoreResults||(a.StoreResults={}));a.IntersectorOptions=function(){this.verticalOffset=0;this.selectionMode=!1;this.selectOpaqueTerrainOnly=this.hud=
!0;this.invisibleTerrain=!1;this.backfacesTerrain=!0;this.isFiltered=!1;this.store=a.StoreResults.ALL};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/intersectorUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/boundedPlane ./IntersectorInterfaces".split(" "),function(a,b,c,n,l,u){function v(h){return b.isSome(h)&&b.isSome(h.dist)}const m=n.create();
a.isHudIntersectorResult=function(h){return v(h)&&h.intersector===u.IntersectorType.HUD&&!!h.target&&b.isSome(h.target.center)};a.isObjectIntersectorResult=function(h){return v(h)&&h.intersector===u.IntersectorType.OBJECT&&!!h.target};a.isValidIntersectorResult=v;a.sliceFilterPredicate=function(h){return(d,e,g)=>{c.lerp(m,d,e,g);return!l.extrusionContainsPoint(h,m)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/boundedPlane":function(){define("exports ../core/has ../core/Logger ../core/mathUtils ../core/ObjectStack ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/support/Axis ../geometry/support/lineSegment ../geometry/support/plane ../geometry/support/ray ../geometry/support/vector ../geometry/support/vectorStacks".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){function k(Y=ba){return{plane:g.create(Y.plane),origin:h.clone(Y.origin),basis1:h.clone(Y.basis1),basis2:h.clone(Y.basis2)}}function r(Y,da,ha){const ja=ka.get();ja.origin=Y;ja.basis1=da;ja.basis2=ha;ja.plane=g.wrap(0,0,0,0);z(ja);return ja}function y(Y,da=k()){return w(Y.origin,Y.basis1,Y.basis2,da)}function f(Y,da){m.copy(da.origin,Y.origin);m.copy(da.basis1,Y.basis1);m.copy(da.basis2,Y.basis2);g.copy(da.plane,Y.plane)}function w(Y,da,ha,ja=k()){m.copy(ja.origin,
Y);m.copy(ja.basis1,da);m.copy(ja.basis2,ha);z(ja);1E-6<Math.abs(m.dot(ja.basis1,ja.basis2)/(m.length(ja.basis1)*m.length(ja.basis2)))&&X.warn("fromValues()","Provided basis vectors are not perpendicular");1E-6<Math.abs(m.dot(ja.basis1,T(ja)))&&X.warn("fromValues()","Basis vectors and plane normal are not perpendicular");1E-6<Math.abs(-m.dot(T(ja),ja.origin)-ja.plane[3])&&X.warn("fromValues()","Plane offset is not consistent with plane origin");return ja}function z(Y){g.fromVectorsAndPoint(Y.basis2,
Y.basis1,Y.origin,Y.plane)}function A(Y,da,ha){Y!==ha&&y(Y,ha);Y=m.scale(q.sv3d.get(),T(Y),da);m.add(ha.origin,ha.origin,Y);ha.plane[3]-=da;return ha}function x(Y,da,ha){B(da,ha);A(ha,I(Y,Y.origin),ha);return ha}function B(Y,da=k()){const ha=(Y[2]-Y[0])/2,ja=(Y[3]-Y[1])/2;m.set(da.origin,Y[0]+ha,Y[1]+ja,0);m.set(da.basis1,ha,0,0);m.set(da.basis2,0,ja,0);g.fromValues(0,0,1,0,da.plane);return da}function C(Y,da,ha){return g.intersectRay(Y.plane,da,ha)?H(Y,ha):!1}function D(Y,da,ha){if(C(Y,da,ha))return ha;
Y=E(Y,da,q.sv3d.get());m.add(ha,da.origin,m.scale(q.sv3d.get(),da.direction,m.distance(da.origin,Y)/m.length(da.direction)));return ha}function E(Y,da,ha){const ja=aa.get();var ma=aa.get();Q(Y,da,ja,ma);ma=Number.POSITIVE_INFINITY;for(const na of la){var pa=W(Y,na,ea.get());const wa=q.sv3d.get();g.intersectLineSegment(ja,pa,wa)&&(pa=m.direction(q.sv3d.get(),da.origin,wa),pa=Math.abs(n.acosClamped(m.dot(da.direction,pa))),pa<ma&&(ma=pa,m.copy(ha,wa)))}return ma===Number.POSITIVE_INFINITY?F(Y,da,ha):
ha}function F(Y,da,ha){if(C(Y,da,ha))return ha;const ja=aa.get(),ma=aa.get();Q(Y,da,ja,ma);let pa=Number.POSITIVE_INFINITY;for(const wa of la){var na=W(Y,wa,ea.get());const xa=q.sv3d.get();g.intersectLineSegmentClamp(ja,na,xa)&&(na=p.distance2(da,xa),g.isPointInside(ma,xa)&&na<pa&&(pa=na,m.copy(ha,xa)))}K(Y,da.origin)<pa&&G(Y,da.origin,ha);return ha}function G(Y,da,ha){var ja=g.projectPoint(Y.plane,da,q.sv3d.get());da=e.projectPointClamp(U(Y,Y.basis1),ja,-1,1,q.sv3d.get());ja=e.projectPointClamp(U(Y,
Y.basis2),ja,-1,1,q.sv3d.get());m.subtract(ha,m.add(q.sv3d.get(),da,ja),Y.origin);return ha}function O(Y,da,ha){const {origin:ja,basis1:ma,basis2:pa}=Y,na=m.subtract(q.sv3d.get(),da,ja);da=t.projectPointSignedLength(ma,na);const wa=t.projectPointSignedLength(pa,na);Y=t.projectPointSignedLength(T(Y),na);return m.set(ha,da,wa,Y)}function K(Y,da){da=O(Y,da,q.sv3d.get());const {basis1:ha,basis2:ja}=Y;Y=m.length(ha);var ma=m.length(ja);Y=Math.max(Math.abs(da[0])-Y,0);ma=Math.max(Math.abs(da[1])-ma,0);
da=da[2];return Y*Y+ma*ma+da*da}function L(Y,da){return Math.sqrt(K(Y,da))}function R(Y,da){let ha=Number.NEGATIVE_INFINITY;for(const ma of la){var ja=W(Y,ma,ea.get());ja=e.distance2(ja,da);ja>ha&&(ha=ja)}return Math.sqrt(ha)}function M(Y,da){return g.isPointInside(Y.plane,da)&&H(Y,da)}function J(Y,da,ha,ja){switch(ha){case d.Axis.X:m.copy(ja,Y.basis1);m.normalize(ja,ja);break;case d.Axis.Y:m.copy(ja,Y.basis2);m.normalize(ja,ja);break;case d.Axis.Z:m.copy(ja,T(Y))}return ja}function I(Y,da){const ha=
-Y.plane[3];return t.projectPointSignedLength(T(Y),da)-ha}function P(Y,da,ha,ja){const ma=I(Y,da);Y=m.scale(ia,T(Y),ha-ma);m.add(ja,da,Y);return ja}function N(Y,da){return m.exactEquals(Y.basis1,da.basis1)&&m.exactEquals(Y.basis2,da.basis2)&&m.exactEquals(Y.origin,da.origin)}function V(Y,da,ha){Y!==ha&&y(Y,ha);u.invert(Z,da);u.transpose(Z,Z);m.transformMat4(ha.basis1,Y.basis1,Z);m.transformMat4(ha.basis2,Y.basis2,Z);m.transformMat4(g.normal(ha.plane),g.normal(Y.plane),Z);m.transformMat4(ha.origin,
Y.origin,da);g.setOffsetFromPoint(ha.plane,ha.plane,ha.origin);return ha}function S(Y,da,ha,ja){Y!==ja&&y(Y,ja);u.fromRotation(ca,da,ha);m.transformMat4(ja.basis1,Y.basis1,ca);m.transformMat4(ja.basis2,Y.basis2,ca);z(ja);return ja}function T(Y){return g.normal(Y.plane)}function H(Y,da){const ha=m.subtract(q.sv3d.get(),da,Y.origin);da=m.squaredLength(Y.basis1);const ja=m.squaredLength(Y.basis2),ma=m.dot(Y.basis1,ha);Y=m.dot(Y.basis2,ha);return 0>-ma-da&&0>ma-da&&0>-Y-ja&&0>Y-ja}function U(Y,da){const ha=
ea.get();m.copy(ha.origin,Y.origin);m.copy(ha.vector,da);return ha}function W(Y,da,ha){const {basis1:ja,basis2:ma,origin:pa}=Y;Y=m.scale(q.sv3d.get(),ja,da.origin[0]);const na=m.scale(q.sv3d.get(),ma,da.origin[1]);m.add(ha.origin,Y,na);m.add(ha.origin,ha.origin,pa);Y=m.scale(q.sv3d.get(),ja,da.direction[0]);da=m.scale(q.sv3d.get(),ma,da.direction[1]);m.scale(ha.vector,m.add(Y,Y,da),2);return ha}function Q(Y,da,ha,ja){Y=T(Y);g.fromVectorsAndPoint(Y,da.direction,da.origin,ha);g.fromVectorsAndPoint(g.normal(ha),
Y,da.origin,ja)}const X=c.getLogger("esri.views.3d.support.geometryUtils.boundedPlane");b=function(){this.plane=g.create();this.origin=h.create();this.basis1=h.create();this.basis2=h.create()};const ba={plane:g.create(),origin:h.fromValues(0,0,0),basis1:h.fromValues(1,0,0),basis2:h.fromValues(0,1,0)},aa=new l.ObjectStack(g.create),ea=new l.ObjectStack(e.create),ia=h.create(),ka=new l.ObjectStack(()=>({origin:null,basis1:null,basis2:null,plane:null})),la=[{origin:[-1,-1],direction:[1,0]},{origin:[1,
-1],direction:[0,1]},{origin:[1,1],direction:[-1,0]},{origin:[-1,1],direction:[0,-1]}],Z=v.create(),ca=v.create();l=Object.freeze(Object.defineProperty({__proto__:null,BoundedPlaneClass:b,create:k,wrap:r,copy:y,copyWithoutVerify:f,fromValues:w,updateUnboundedPlane:z,elevate:A,setExtent:x,fromAABoundingRect:B,intersectRay:C,intersectRayClosestSilhouette:D,closestPointOnSilhouette:E,closestPoint:F,projectPoint:G,projectPointLocal:O,distance2:K,distance:L,distanceToSilhouette:R,extrusionContainsPoint:M,
axisAt:J,altitudeAt:I,setAltitudeAt:P,equals:N,transform:V,rotate:S,normal:T,UP:ba},Symbol.toStringTag,{value:"Module"}));a.BoundedPlaneClass=b;a.UP=ba;a.altitudeAt=I;a.axisAt=J;a.boundedPlane=l;a.closestPoint=F;a.closestPointOnSilhouette=E;a.copy=y;a.copyWithoutVerify=f;a.create=k;a.distance=L;a.distance2=K;a.distanceToSilhouette=R;a.elevate=A;a.equals=N;a.extrusionContainsPoint=M;a.fromAABoundingRect=B;a.fromValues=w;a.intersectRay=C;a.intersectRayClosestSilhouette=D;a.normal=T;a.projectPoint=G;
a.projectPointLocal=O;a.rotate=S;a.setAltitudeAt=P;a.setExtent=x;a.transform=V;a.updateUnboundedPlane=z;a.wrap=r})},"esri/geometry/support/lineSegment":function(){define("exports ../../core/mathUtils ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./vectorStacks".split(" "),function(a,b,c,n,l,u){function v(q){return q?{origin:l.clone(q.origin),vector:l.clone(q.vector)}:{origin:l.create(),vector:l.create()}}function m(q,k){const r=t.get();r.origin=q;r.vector=k;return r}function h(q,k,
r=v()){n.copy(r.origin,q);n.copy(r.vector,k);return r}function d(q,k){k=n.subtract(u.sv3d.get(),k,q.origin);var r=n.dot(q.vector,k);const y=n.dot(q.vector,q.vector);r=b.clamp(r/y,0,1);q=n.subtract(u.sv3d.get(),n.scale(u.sv3d.get(),q.vector,r),k);return n.dot(q,q)}function e(q,k,r,y,f){const {vector:w,origin:z}=q;k=n.subtract(u.sv3d.get(),k,z);k=n.dot(w,k)/n.squaredLength(w);n.scale(f,w,b.clamp(k,r,y));return n.add(f,f,q.origin)}function g(q,k,r,y){const f=q.origin;var w=n.add(u.sv3d.get(),f,q.vector);
q=k.origin;var z=n.add(u.sv3d.get(),q,k.vector),A=u.sv3d.get();k=u.sv3d.get();A[0]=f[0]-q[0];A[1]=f[1]-q[1];A[2]=f[2]-q[2];k[0]=z[0]-q[0];k[1]=z[1]-q[1];k[2]=z[2]-q[2];if(1E-6>Math.abs(k[0])&&1E-6>Math.abs(k[1])&&1E-6>Math.abs(k[2]))return!1;z=u.sv3d.get();z[0]=w[0]-f[0];z[1]=w[1]-f[1];z[2]=w[2]-f[2];if(1E-6>Math.abs(z[0])&&1E-6>Math.abs(z[1])&&1E-6>Math.abs(z[2]))return!1;w=A[0]*k[0]+A[1]*k[1]+A[2]*k[2];var x=k[0]*z[0]+k[1]*z[1]+k[2]*z[2];const B=k[0]*k[0]+k[1]*k[1]+k[2]*k[2],C=(z[0]*z[0]+z[1]*z[1]+
z[2]*z[2])*B-x*x;if(1E-6>Math.abs(C))return!1;A=(w*x-(A[0]*z[0]+A[1]*z[1]+A[2]*z[2])*B)/C;w=(w+x*A)/B;r&&(A=b.clamp(A,0,1),w=b.clamp(w,0,1));r=u.sv3d.get();x=u.sv3d.get();r[0]=f[0]+A*z[0];r[1]=f[1]+A*z[1];r[2]=f[2]+A*z[2];x[0]=q[0]+w*k[0];x[1]=q[1]+w*k[1];x[2]=q[2]+w*k[2];y.tA=A;y.tB=w;y.pA=r;y.pB=x;y.distance2=n.squaredDistance(r,x);return!0}const p={tA:0,tB:0,pA:l.create(),pB:l.create(),distance2:0},t=new c.ObjectStack(()=>({origin:null,vector:null}));a.closestLineSegmentDistance2=function(q,k){return g(q,
k,!0,p)?p.distance2:null};a.closestLineSegmentPoint=function(q,k,r){return g(q,k,!0,p)?(n.copy(r,p.pA),!0):!1};a.closestRayDistance2=function(q,k){if(g(q,m(k.origin,k.direction),!1,p)){const {tA:r,pB:y,distance2:f}=p;if(0<=r&&1>=r)return f;if(0>r)return n.squaredDistance(q.origin,y);if(1<r)return n.squaredDistance(n.add(u.sv3d.get(),q.origin,q.vector),y)}return null};a.copy=function(q,k=v()){return h(q.origin,q.vector,k)};a.create=v;a.distance=function(q,k){return Math.sqrt(d(q,k))};a.distance2=d;
a.fromPoints=function(q,k,r=v()){n.copy(r.origin,q);n.subtract(r.vector,k,q);return r};a.fromValues=h;a.pointAt=function(q,k,r){return n.add(r,q.origin,n.scale(r,q.vector,k))};a.projectPoint=function(q,k,r){return e(q,k,0,1,r)};a.projectPointClamp=e;a.wrap=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/verticalOffsetUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../chunks/sphere".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){let t=function(){function D(){this._transform=v.create();this._transformInverse=new q({value:this._transform},u.invert,v.create);this._transformInverseTranspose=new q(this._transformInverse,u.transpose,v.create);this._transformTranspose=new q({value:this._transform},u.transpose,v.create);this._transformInverseRotation=new q({value:this._transform},n.normalFromMat4Legacy,l.create)}var E=D.prototype;E._invalidateLazyTransforms=function(){this._transformInverse.invalidate();
this._transformInverseTranspose.invalidate();this._transformTranspose.invalidate();this._transformInverseRotation.invalidate()};E.setTransformMatrix=function(F){u.copy(this._transform,F)};E.multiplyTransform=function(F){u.multiply(this._transform,this._transform,F)};E.set=function(F){u.copy(this._transform,F);this._invalidateLazyTransforms()};E.setAndInvalidateLazyTransforms=function(F,G){this.setTransformMatrix(F);this.multiplyTransform(G);this._invalidateLazyTransforms()};b._createClass(D,[{key:"transform",
get:function(){return this._transform}},{key:"inverse",get:function(){return this._transformInverse.value}},{key:"inverseTranspose",get:function(){return this._transformInverseTranspose.value}},{key:"inverseRotation",get:function(){return this._transformInverseRotation.value}},{key:"transpose",get:function(){return this._transformTranspose.value}}]);return D}(),q=function(){function D(E,F,G){this.original=E;this.update=F;this.dirty=!0;this.transform=G()}D.prototype.invalidate=function(){this.dirty=
!0};b._createClass(D,[{key:"value",get:function(){this.dirty&&(this.update(this.transform,this.original.value),this.dirty=!1);return this.transform}}]);return D}(),k=function(){function D(F=0){this.offset=F;this.tmpVertex=g.create()}var E=D.prototype;E.applyToVertex=function(F,G,O){const K=F+this.localOrigin[0],L=G+this.localOrigin[1],R=O+this.localOrigin[2],M=this.offset/Math.sqrt(K*K+L*L+R*R);this.tmpVertex[0]=F+K*M;this.tmpVertex[1]=G+L*M;this.tmpVertex[2]=O+R*M;return this.tmpVertex};E.applyToAabb=
function(F){for(var G=0;3>G;++G)r[G]=F[0+G]+this.localOrigin[G],y[G]=F[3+G]+this.localOrigin[G],f[G]=r[G];G=this.applyToVertex(r[0],r[1],r[2]);for(var O=0;3>O;++O)F[O]=G[O],F[O+3]=G[O];G=L=>{L=this.applyToVertex(L[0],L[1],L[2]);for(let R=0;3>R;++R)F[R+0]=Math.min(F[R+0],L[R]),F[R+3]=Math.max(F[R+3],L[R])};for(O=1;8>O;++O){for(var K=0;3>K;++K)f[K]=0===(O&1<<K)?r[K]:y[K];G(f)}O=0;for(K=0;3>K;++K)0>r[K]*y[K]&&(O|=1<<K);if(0!==O&&7!==O)for(K=0;8>K;++K)if(0===(O&K)){for(let L=0;3>L;++L)f[L]=O[L]?0:0!==
(K&1<<L)?r[L]:y[L];G(f)}for(G=0;3>G;++G)F[G+0]-=this.localOrigin[G],F[G+3]-=this.localOrigin[G];return F};return D}();const r=g.create(),y=g.create(),f=g.create();let w=function(){function D(F=0){this.componentLocalOriginLength=0;this._tmpVertex=g.create();this._mbs=p.create();this._obb={center:g.create(),halfSize:e.create(),quaternion:null};this._offset=this._totalOffset=0;this._resetOffset(F)}var E=D.prototype;E._resetOffset=function(F){this._totalOffset=this._offset=F};E.applyToVertex=function(F,
G,O){const K=O+this.componentLocalOriginLength,L=this._totalOffset/Math.sqrt(F*F+G*G+K*K);this._tmpVertex[0]=F+F*L;this._tmpVertex[1]=G+G*L;this._tmpVertex[2]=O+K*L;return this._tmpVertex};E.applyToAabb=function(F){const G=F[0],O=F[1],K=F[2]+this.componentLocalOriginLength,L=F[3],R=F[4],M=F[5]+this.componentLocalOriginLength;var J=0>G*L?0:Math.min(Math.abs(G),Math.abs(L)),I=0>O*R?0:Math.min(Math.abs(O),Math.abs(R)),P=0>K*M?0:Math.min(Math.abs(K),Math.abs(M));J=Math.sqrt(J*J+I*I+P*P);if(J<this._totalOffset)return F[0]-=
0>G?this._totalOffset:0,F[1]-=0>O?this._totalOffset:0,F[2]-=0>K?this._totalOffset:0,F[3]+=0<L?this._totalOffset:0,F[4]+=0<R?this._totalOffset:0,F[5]+=0<M?this._totalOffset:0,F;I=Math.max(Math.abs(G),Math.abs(L));P=Math.max(Math.abs(O),Math.abs(R));const N=Math.max(Math.abs(K),Math.abs(M));I=this._totalOffset/Math.sqrt(I*I+P*P+N*N);J=this._totalOffset/J;F[0]+=G*(0<G?I:J);F[1]+=O*(0<O?I:J);F[2]+=K*(0<K?I:J);F[3]+=L*(0>L?I:J);F[4]+=R*(0>R?I:J);F[5]+=M*(0>M?I:J);return F};E.applyToMbs=function(F){const G=
Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]),O=this._totalOffset/G;this._mbs[0]=F[0]+F[0]*O;this._mbs[1]=F[1]+F[1]*O;this._mbs[2]=F[2]+F[2]*O;this._mbs[3]=F[3]+F[3]*this._totalOffset/G;return this._mbs};E.applyToObb=function(F){var G=F.center;const O=this._totalOffset/Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);this._obb.center[0]=G[0]+G[0]*O;this._obb.center[1]=G[1]+G[1]*O;this._obb.center[2]=G[2]+G[2]*O;d.transformQuat(this._obb.halfSize,F.halfSize,F.quaternion);d.add(this._obb.halfSize,this._obb.halfSize,
F.center);G=this._totalOffset/Math.sqrt(this._obb.halfSize[0]*this._obb.halfSize[0]+this._obb.halfSize[1]*this._obb.halfSize[1]+this._obb.halfSize[2]*this._obb.halfSize[2]);this._obb.halfSize[0]+=this._obb.halfSize[0]*G;this._obb.halfSize[1]+=this._obb.halfSize[1]*G;this._obb.halfSize[2]+=this._obb.halfSize[2]*G;d.subtract(this._obb.halfSize,this._obb.halfSize,F.center);m.conjugate(C,F.quaternion);d.transformQuat(this._obb.halfSize,this._obb.halfSize,C);this._obb.halfSize[0]*=0>this._obb.halfSize[0]?
-1:1;this._obb.halfSize[1]*=0>this._obb.halfSize[1]?-1:1;this._obb.halfSize[2]*=0>this._obb.halfSize[2]?-1:1;this._obb.quaternion=F.quaternion;return this._obb};b._createClass(D,[{key:"offset",get:function(){return this._offset},set:function(F){this._resetOffset(F)}},{key:"componentOffset",set:function(F){this._totalOffset=this._offset+F}},{key:"localOrigin",set:function(F){this.componentLocalOriginLength=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2])}}]);return D}(),z=function(){function D(F=0){this.offset=
F;this.sphere=p.create();this.tmpVertex=g.create()}var E=D.prototype;E.applyToVertex=function(F,G,O){const K=this.objectTransform.transform;let L=K[0]*F+K[4]*G+K[8]*O+K[12],R=K[1]*F+K[5]*G+K[9]*O+K[13];F=K[2]*F+K[6]*G+K[10]*O+K[14];G=this.offset/Math.sqrt(L*L+R*R+F*F);L+=L*G;R+=R*G;F+=F*G;G=this.objectTransform.inverse;this.tmpVertex[0]=G[0]*L+G[4]*R+G[8]*F+G[12];this.tmpVertex[1]=G[1]*L+G[5]*R+G[9]*F+G[13];this.tmpVertex[2]=G[2]*L+G[6]*R+G[10]*F+G[14];return this.tmpVertex};E.applyToMinMax=function(F,
G){const O=this.offset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);F[0]+=F[0]*O;F[1]+=F[1]*O;F[2]+=F[2]*O;F=this.offset/Math.sqrt(G[0]*G[0]+G[1]*G[1]+G[2]*G[2]);G[0]+=G[0]*F;G[1]+=G[1]*F;G[2]+=G[2]*F};E.applyToAabb=function(F){var G=this.offset/Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*F[2]);F[0]+=F[0]*G;F[1]+=F[1]*G;F[2]+=F[2]*G;G=this.offset/Math.sqrt(F[3]*F[3]+F[4]*F[4]+F[5]*F[5]);F[3]+=F[3]*G;F[4]+=F[4]*G;F[5]+=F[5]*G;return F};E.applyToBoundingSphere=function(F){const G=Math.sqrt(F[0]*F[0]+F[1]*F[1]+F[2]*
F[2]),O=this.offset/G;this.sphere[0]=F[0]+F[0]*O;this.sphere[1]=F[1]+F[1]*O;this.sphere[2]=F[2]+F[2]*O;this.sphere[3]=F[3]+F[3]*this.offset/G;return this.sphere};return D}();const A=new z,x=new w,B=new k,C=h.create();a.I3SVerticalOffsetGlobalViewingMode=w;a.IntersectorTransform=t;a.Object3DVerticalOffsetGlobalViewingMode=z;a.TERRAIN_ID="terrain";a.TerrainVerticalOffsetGlobalViewingMode=k;a.getVerticalOffsetI3S=function(D){return c.isSome(D)?(x.offset=D,x):null};a.getVerticalOffsetObject3D=function(D){return c.isSome(D)?
(A.offset=D,A):null};a.getVerticalOffsetTerrain=function(D){return c.isSome(D)?(B.offset=D,B):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quat":function(){define("exports ./mat3f64 ./quatf64 ./vec3f64 ./common ./vec3 ./vec4".split(" "),function(a,b,c,n,l,u,v){function m(H){H[0]=0;H[1]=0;H[2]=0;H[3]=1;return H}function h(H,U,W){W*=.5;const Q=Math.sin(W);H[0]=Q*U[0];H[1]=Q*U[1];H[2]=Q*U[2];H[3]=Math.cos(W);return H}function d(H,U){const W=
2*Math.acos(U[3]),Q=Math.sin(W/2);Q>l.EPSILON?(H[0]=U[0]/Q,H[1]=U[1]/Q,H[2]=U[2]/Q):(H[0]=1,H[1]=0,H[2]=0);return W}function e(H,U,W){const Q=U[0],X=U[1],ba=U[2];U=U[3];const aa=W[0],ea=W[1],ia=W[2];W=W[3];H[0]=Q*W+U*aa+X*ia-ba*ea;H[1]=X*W+U*ea+ba*aa-Q*ia;H[2]=ba*W+U*ia+Q*ea-X*aa;H[3]=U*W-Q*aa-X*ea-ba*ia;return H}function g(H,U,W){W*=.5;const Q=U[0],X=U[1],ba=U[2];U=U[3];const aa=Math.sin(W);W=Math.cos(W);H[0]=Q*W+U*aa;H[1]=X*W+ba*aa;H[2]=ba*W-X*aa;H[3]=U*W-Q*aa;return H}function p(H,U,W){W*=.5;const Q=
U[0],X=U[1],ba=U[2];U=U[3];const aa=Math.sin(W);W=Math.cos(W);H[0]=Q*W-ba*aa;H[1]=X*W+U*aa;H[2]=ba*W+Q*aa;H[3]=U*W-X*aa;return H}function t(H,U,W){W*=.5;const Q=U[0],X=U[1],ba=U[2];U=U[3];const aa=Math.sin(W);W=Math.cos(W);H[0]=Q*W+X*aa;H[1]=X*W-Q*aa;H[2]=ba*W+U*aa;H[3]=U*W-ba*aa;return H}function q(H,U){const W=U[0],Q=U[1];U=U[2];H[0]=W;H[1]=Q;H[2]=U;H[3]=Math.sqrt(Math.abs(1-W*W-Q*Q-U*U));return H}function k(H,U,W,Q){const X=U[0],ba=U[1],aa=U[2];U=U[3];let ea=W[0],ia=W[1],ka=W[2];W=W[3];let la;
let Z;var ca=X*ea+ba*ia+aa*ka+U*W;0>ca&&(ca=-ca,ea=-ea,ia=-ia,ka=-ka,W=-W);1-ca>l.EPSILON?(la=Math.acos(ca),Z=Math.sin(la),ca=Math.sin((1-Q)*la)/Z,Q=Math.sin(Q*la)/Z):ca=1-Q;H[0]=ca*X+Q*ea;H[1]=ca*ba+Q*ia;H[2]=ca*aa+Q*ka;H[3]=ca*U+Q*W;return H}function r(H){var U=l.RANDOM();const W=l.RANDOM(),Q=l.RANDOM(),X=Math.sqrt(1-U);U=Math.sqrt(U);H[0]=X*Math.sin(2*Math.PI*W);H[1]=X*Math.cos(2*Math.PI*W);H[2]=U*Math.sin(2*Math.PI*Q);H[3]=U*Math.cos(2*Math.PI*Q);return H}function y(H,U){const W=U[0],Q=U[1],X=
U[2];U=U[3];var ba=W*W+Q*Q+X*X+U*U;ba=ba?1/ba:0;H[0]=-W*ba;H[1]=-Q*ba;H[2]=-X*ba;H[3]=U*ba;return H}function f(H,U){H[0]=-U[0];H[1]=-U[1];H[2]=-U[2];H[3]=U[3];return H}function w(H,U){var W=U[0]+U[4]+U[8];if(0<W)W=Math.sqrt(W+1),H[3]=.5*W,W=.5/W,H[0]=(U[5]-U[7])*W,H[1]=(U[6]-U[2])*W,H[2]=(U[1]-U[3])*W;else{let Q=0;U[4]>U[0]&&(Q=1);U[8]>U[3*Q+Q]&&(Q=2);const X=(Q+1)%3,ba=(Q+2)%3;W=Math.sqrt(U[3*Q+Q]-U[3*X+X]-U[3*ba+ba]+1);H[Q]=.5*W;W=.5/W;H[3]=(U[3*X+ba]-U[3*ba+X])*W;H[X]=(U[3*X+Q]+U[3*Q+X])*W;H[ba]=
(U[3*ba+Q]+U[3*Q+ba])*W}return H}function z(H,U,W,Q){var X=.5*Math.PI/180;U*=X;W*=X;Q*=X;X=Math.sin(U);U=Math.cos(U);const ba=Math.sin(W);W=Math.cos(W);const aa=Math.sin(Q);Q=Math.cos(Q);H[0]=X*W*Q-U*ba*aa;H[1]=U*ba*Q+X*W*aa;H[2]=U*W*aa-X*ba*Q;H[3]=U*W*Q+X*ba*aa;return H}function A(H){return"quat("+H[0]+", "+H[1]+", "+H[2]+", "+H[3]+")"}function x(H,U,W){const Q=u.dot(U,W);if(-.999999>Q)return u.cross(I,P,U),1E-6>u.len(I)&&u.cross(I,N,U),u.normalize(I,I),h(H,I,Math.PI),H;if(.999999<Q)return H[0]=
0,H[1]=0,H[2]=0,H[3]=1,H;u.cross(I,U,W);H[0]=I[0];H[1]=I[1];H[2]=I[2];H[3]=1+Q;return M(H,H)}function B(H,U,W,Q,X,ba){k(V,U,X,ba);k(S,W,Q,ba);k(H,V,S,2*ba*(1-ba));return H}function C(H,U,W,Q){const X=T;X[0]=W[0];X[3]=W[1];X[6]=W[2];X[1]=Q[0];X[4]=Q[1];X[7]=Q[2];X[2]=-U[0];X[5]=-U[1];X[8]=-U[2];return M(H,w(H,X))}const D=v.copy,E=v.set,F=v.add,G=v.scale,O=v.dot,K=v.lerp,L=v.length,R=v.squaredLength,M=v.normalize,J=v.exactEquals;v=v.equals;const I=n.create(),P=n.fromValues(1,0,0),N=n.fromValues(0,1,
0),V=c.create(),S=c.create(),T=b.create();b=Object.freeze(Object.defineProperty({__proto__:null,identity:m,setAxisAngle:h,getAxisAngle:d,multiply:e,rotateX:g,rotateY:p,rotateZ:t,calculateW:q,slerp:k,random:r,invert:y,conjugate:f,fromMat3:w,fromEuler:z,str:A,copy:D,set:E,add:F,mul:e,scale:G,dot:O,lerp:K,length:L,len:L,squaredLength:R,sqrLen:R,normalize:M,exactEquals:J,equals:v,rotationTo:x,sqlerp:B,setAxes:C},Symbol.toStringTag,{value:"Module"}));a.add=F;a.calculateW=q;a.conjugate=f;a.copy=D;a.dot=
O;a.equals=v;a.exactEquals=J;a.fromEuler=z;a.fromMat3=w;a.getAxisAngle=d;a.identity=m;a.invert=y;a.len=L;a.length=L;a.lerp=K;a.mul=e;a.multiply=e;a.normalize=M;a.quat=b;a.random=r;a.rotateX=g;a.rotateY=p;a.rotateZ=t;a.rotationTo=x;a.scale=G;a.set=E;a.setAxes=C;a.setAxisAngle=h;a.slerp=k;a.sqlerp=B;a.sqrLen=R;a.squaredLength=R;a.str=A})},"esri/chunks/vec3f32":function(){define(["exports"],function(a){function b(){return new Float32Array(3)}function c(r){const y=new Float32Array(3);y[0]=r[0];y[1]=r[1];
y[2]=r[2];return y}function n(r,y,f){const w=new Float32Array(3);w[0]=r;w[1]=y;w[2]=f;return w}function l(r,y){return new Float32Array(r,y,3)}function u(){return b()}function v(){return n(1,1,1)}function m(){return n(1,0,0)}function h(){return n(0,1,0)}function d(){return n(0,0,1)}const e=b(),g=v(),p=m(),t=h(),q=d(),k=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l,zeros:u,ones:v,unitX:m,unitY:h,unitZ:d,ZEROS:e,ONES:g,UNIT_X:p,UNIT_Y:t,UNIT_Z:q},Symbol.toStringTag,
{value:"Module"}));a.ONES=g;a.UNIT_X=p;a.UNIT_Y=t;a.UNIT_Z=q;a.ZEROS=e;a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.ones=v;a.unitX=m;a.unitY=h;a.unitZ=d;a.vec3f32=k;a.zeros=u})},"esri/views/3d/webgl-engine/materials/renderers/utils":function(){define("exports ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../lib/Util ../../../../webgl/doublePrecisionUtils".split(" "),function(a,b,c,n,l,u){const v=new Float64Array(3),m=new Float32Array(6),h=n.create();
a.addObject3DStateID=function(d,e){b.isNone(d)&&(d=[]);d.push(e);return d};a.calculateTransformRelativeToOrigin=function(d,e,g){const p=d.origin.vec3;l.setMatrixTranslation3(h,-p[0],-p[1],-p[2]);b.isSome(d.transformation)?c.multiply(e,h,d.transformation):c.copy(e,h);g&&(c.invert(g,e),c.transpose(g,g))};a.encodeDoubleVec3=function(d,e,g,p,t){v[0]=d.get(e,0);v[1]=d.get(e,1);v[2]=d.get(e,2);u.encodeDoubleArray(v,m,3);g.set(t,0,m[0]);p.set(t,0,m[1]);g.set(t,1,m[2]);p.set(t,1,m[3]);g.set(t,2,m[4]);p.set(t,
2,m[5])};a.isInstanceHidden=function(d){return b.isSome(d)?!d.visible:!1};a.removeObject3DStateID=function(d,e){if(b.isNone(d))return null;d=d.filter(g=>g!==e);return 0===d.length?null:d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Util":function(){define(["exports","../../../../chunks/vec2f64","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,n){function l(m,h){if(!m)throw h=h||"assert",console.log(Error(h).stack),
new v(h);}const u=n.create();let v=function(){function m(h){this.message=h}m.prototype.toString=function(){return`AssertException: ${this.message}`};return m}();a.assert=l;a.fovd2fovx=function(m,h,d){return 2*Math.atan(h*Math.tan(.5*m)/Math.sqrt(h*h+d*d))};a.fovd2fovy=function(m,h,d){return 2*Math.atan(d*Math.tan(.5*m)/Math.sqrt(h*h+d*d))};a.fovx2fovd=function(m,h,d){return 2*Math.atan(Math.sqrt(h*h+d*d)*Math.tan(.5*m)/h)};a.fovy2fovd=function(m,h,d){return 2*Math.atan(Math.sqrt(h*h+d*d)*Math.tan(.5*
m)/d)};a.isTranslationMatrix=function(m){return 1===m[0]&&0===m[1]&&0===m[2]&&0===m[3]&&0===m[4]&&1===m[5]&&0===m[6]&&0===m[7]&&0===m[8]&&0===m[9]&&1===m[10]&&0===m[11]&&1===m[15]};a.logWithBase=function(m,h){return Math.log(m)/Math.log(h)};a.project=function(m,h,d,e,g){g||(g=m);u[0]=m[0];u[1]=m[1];u[2]=m[2];u[3]=1;c.transformMat4(u,u,h);2<g.length&&(g[2]=-u[2]);c.transformMat4(u,u,d);l(0!==u[3]);g[0]=u[0]/u[3];g[1]=u[1]/u[3];g[2]=u[2]/u[3];g[0]=(.5*g[0]+.5)*e[2]+e[0];g[1]=(.5*g[1]+.5)*e[3]+e[1]};
a.rayBoxTest=function(m,h,d,e){let g,p=(d[0]-m[0])/h[0],t=(e[0]-m[0])/h[0];p>t&&(g=p,p=t,t=g);let q=(d[1]-m[1])/h[1],k=(e[1]-m[1])/h[1];q>k&&(g=q,q=k,k=g);if(p>k||q>t)return!1;q>p&&(p=q);k<t&&(t=k);d=(d[2]-m[2])/h[2];m=(e[2]-m[2])/h[2];d>m&&(g=d,d=m,m=g);if(p>m||d>t)return!1;m<t&&(t=m);return 0>t?!1:!0};a.rayRay2D=function(m,h,d,e,g,p=b.create()){const t=(e[g]-d[g])*(h[0]-m[0])-(e[0]-d[0])*(h[g]-m[g]);if(0===t)return!1;d=((e[0]-d[0])*(m[g]-d[g])-(e[g]-d[g])*(m[0]-d[0]))/t;p[0]=m[0]+d*(h[0]-m[0]);
p[1]=m[g]+d*(h[g]-m[g]);return!0};a.setMatrixTranslation3=function(m,h,d,e){m[12]=h;m[13]=d;m[14]=e};a.verify=function(m,h){m||console.warn("Verify failed: "+(h||"")+"\n"+Error("verify").stack)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/doublePrecisionUtils":function(){define(["exports"],function(a){const b=new Float32Array(2);a.decodeDoubleArray=function(c,n,l){for(let u=0;u<l;++u)n[u]=c[2*u]+c[2*u+1]};a.encodeDoubleArray=function(c,
n,l){for(let u=0;u<l;++u)n[2*u]=c[u],n[2*u+1]=c[u]-n[2*u]};a.encodeDoubleHi=function(c,n){const l=c.length;for(let u=0;u<l;++u)b[0]=c[u],n[u]=b[0];return n};a.encodeDoubleLo=function(c,n){const l=c.length;for(let u=0;u<l;++u)b[0]=c[u],b[1]=c[u]-b[0],n[u]=b[1];return n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/cameraUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../core/Cyclical ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Point ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/SpatialReference ../../../geometry/support/scaleUtils ../../ViewingMode ../camera/intersectionUtils ../../../chunks/cameraUtilsPlanar ../../../chunks/cameraUtilsSpherical ./earthUtils ./ElevationProvider ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A){function x(aa){return"global"===aa.viewingMode?f.cameraUtilsSpherical:y.cameraUtilsPlanar}function B(aa,ea,ia){const ka=aa.state.camera,la=ka.width/2/ka.pixelRatio;aa.renderCoordsHelper.viewingMode===k.ViewingMode.Global&&null!=ia&&(ea*=Math.cos(u.deg2rad(ia)));ea/=aa.renderCoordsHelper.unitInMeters;return la/(96*39.37/ea)/Math.tan(ka.fovX/2)}function C(aa,ea,ia){const ka=aa.state.camera;ea=96*39.37/(ka.width/2/ka.pixelRatio/(ea*Math.tan(ka.fovX/
2)));aa.renderCoordsHelper.viewingMode===k.ViewingMode.Global&&(ea/=Math.cos(u.deg2rad(ia)));return ea*=aa.renderCoordsHelper.unitInMeters}function D(aa,ea,ia,ka,la,Z){if(N(Z)){const ca=new ba(Z.signal);M(aa,ka.heading,ka.tilt,ea,ia,la,ca);ca.resolver.promise.then(Y=>{Y=P(aa,Y,ka.fov);if(v.isNone(Y))Z.resolver.reject();else return Z.resolver.resolve(Y)},Y=>Z.resolver.reject(Y))}else return ea=M(aa,ka.heading,ka.tilt,ea,ia,la),P(aa,ea,ka.fov,Z)}function E(aa,ea,ia,ka,la){return x(aa).directionToHeadingTilt(ea,
ia,ka,la)}function F(aa,ea){return!!(aa.basemapTerrain&&aa.renderCoordsHelper.fromRenderCoords(ea,U,aa.spatialReference)&&v.unwrapOr(z.getElevationAtPoint(aa.elevationProvider,U),0)>U.z-1)}function G(aa,ea,ia){return O.apply(this,arguments)}function O(){O=b._asyncToGenerator(function*(aa,ea,ia){if(!aa.renderCoordsHelper.fromRenderCoords(ea,U,aa.spatialReference))return!1;aa=yield aa.elevationProvider.queryElevation(U.x,U.y,U.z,U.spatialReference,"ground",ia);return v.unwrapOr(aa,0)>U.z-1});return O.apply(this,
arguments)}function K(aa,ea,ia){return L.apply(this,arguments)}function L(){L=b._asyncToGenerator(function*(aa,ea,ia){const ka=d.create();ea?ea instanceof e?(g.projectPointToVector(ea,ka,aa.renderSpatialReference),null==ea.z&&null!=aa.basemapTerrain&&(ea=yield aa.elevationProvider.queryElevation(ea.x,ea.y,ea.z,ea.spatialReference,"ground",ia),v.isSome(ea)&&aa.renderCoordsHelper.setAltitude(ka,ea))):h.copy(ka,ea):h.copy(ka,aa.state.camera.center);return ka});return L.apply(this,arguments)}function R(aa,
ea){const ia=d.create();ea&&ea instanceof e?(g.projectPointToVector(ea,ia,aa.renderSpatialReference),null==ea.z&&null!=aa.basemapTerrain&&(ea=z.getElevationAtPoint(aa.elevationProvider,ea),v.isSome(ea)&&aa.renderCoordsHelper.setAltitude(ia,ea))):ea?h.copy(ia,ea):h.copy(ia,aa.state.camera.center);return ia}function M(aa,ea,ia,ka,la,Z,ca){const Y=ka&&ka instanceof e?ka:null;if(N(ca))return K(aa,ka,ca.signal).then(da=>{J(aa,ea,ia,Y,da,la,Z,ca)},da=>ca.resolver.reject(da)),null;ka=R(aa,ka);return J(aa,
ea,ia,Y,ka,la,Z,ca)}function J(aa,ea,ia,ka,la,Z,ca,Y){if(v.isNone(ka)&&(ka=g.projectVectorToPoint(la,aa.renderSpatialReference,aa.spatialReference||t.WGS84),v.isNone(ka)))return null;Z=Math.max(Z,aa.state.constraints.minimumPoiDistance);var da=I(aa,ea,ia,la,Z,ca);const ha=x(aa).eyeForCenterWithHeadingTilt,ja=ha(la,Z,da.heading,da.tilt);if(ca===a.OrientationMode.ADJUST&&"global"===aa.viewingMode&&0<ia){const ma=()=>{var pa=Z,na=Z;var wa=aa.state.constraints.tilt(na);na=x(aa).eyeTiltToLookAtTilt(ia,
la,na);na=Math.min(na,.5*Math.PI);wa=wa.min*(1-.7)+.7*na;pa=x(aa).lookAtTiltToEyeTilt(wa,la,pa);ca=1>ia-pa?a.OrientationMode.LOCKED:a.OrientationMode.ADJUST;return J(aa,ea,pa,ka,la,Z,ca,Y)};da=aa.map.ground.navigationConstraint;if(!da||"stay-above"===da.type){if(F(aa,ja.eye))return ma();if(N(Y))return G(aa,ja.eye,Y.signal).then(pa=>{if(pa)return ma();Y.resolver.resolve({eye:ja.eye,up:ja.up,center:d.clone(la),heading:ja.heading,tilt:ja.tilt});return null}),null}}da=!Y||N(Y)?{center:d.create(),eye:d.create(),
up:d.create(),tilt:0,heading:0}:Y;da.eye=ja.eye;da.up=ja.up;da.center=d.clone(la);da.heading=ja.heading;da.tilt=ja.tilt;N(Y)&&Y.resolver.resolve(da);return da}function I(aa,ea,ia,ka,la,Z){var ca=0;if(Z=Z===a.OrientationMode.ADJUST)if(ca=aa.pointsOfInterest.centerOnSurfaceFrequent.distance,8<Math.log(la/ca)/Math.LN2)Z=!0;else{var Y=aa.renderSpatialReference,da=aa.spatialReference||t.WGS84;Z=g.projectVectorToPoint(ka,Y,da);Y=g.projectVectorToPoint(aa.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,
Y,da);v.isNone(Z)||v.isNone(Y)?Z=!1:(ca*=Math.tan(.5*aa.state.camera.fov),Z=5<Y.distance(Z)/ca)}Z?(ea=0,Z=aa.state.constraints.tilt(la),Z.max=Math.min(Z.max,.5*Math.PI),Z=Z.min*(1-.7)+.7*Z.max,ia=x(aa).eyeTiltToLookAtTilt(ia,ka,la),ca=Math.min(ia,Z)):ca=x(aa).eyeTiltToLookAtTilt(ia,ka,la);ia=ca=aa.state.constraints.clampTilt(la,ca);ia=x(aa).lookAtTiltToEyeTilt(ia,ka,la);return{heading:ea,tilt:ia}}function P(aa,ea,ia,ka){if(v.isNone(ea))return null;aa=g.projectVectorToPoint(ea.eye,aa.renderSpatialReference,
aa.spatialReference||t.WGS84);return v.isNone(aa)?null:v.isSome(ka)?(ka.position=aa,ka.heading=ea.heading,ka.tilt=ea.tilt,ka.fov=ia,ka):new c(aa,ea.heading,ea.tilt,ia)}function N(aa){return aa&&"resolver"in aa}const V=l.getLogger("esri.views.3d.support.cameraUtils"),S=d.create(),T=d.create(),H={heading:0,tilt:0},U=new e,W=new n.Cyclical(-2.0037508342788905E7,2.0037508342788905E7),Q=new n.Cyclical(-180,180);a.OrientationMode=void 0;(function(aa){aa[aa.LOCKED=0]="LOCKED";aa[aa.ADJUST=1]="ADJUST"})(a.OrientationMode||
(a.OrientationMode={}));const X=d.create();let ba=function(aa){this.signal=aa;this.resolver=m.createResolver()};a.AsyncContext=ba;a.computeScale=function(aa,ea,ia){const ka=aa.renderSpatialReference;ea||(ea=aa.state.camera);var la=t.WGS84;ea instanceof c?(la=ea.position.latitude,g.projectPointToVector(ea.position,S,ka),g.projectPointToVector(ia,T,ka),ea=h.distance(S,T)):(g.projectVectorToVector(ea.center,ka,T,la),la=T[1],ea=ea.distance);return C(aa,ea,la)};a.directionToHeadingTilt=E;a.distanceToScale=
C;a.externalToInternal=function(aa,ea){if(v.isNone(ea))return null;var ia=aa.renderSpatialReference;const ka=x(aa).headingTiltToDirectionUp,la=d.create();if(!g.projectPointToVector(ea.position,la,ia))return null;ia=ka(la,ea.heading,ea.tilt);h.scale(ia.direction,ia.direction,aa.state.camera.distance);h.add(ia.direction,ia.direction,la);aa=r.cameraOnContentAlongViewDirection(aa,la,ia.direction,ia.up);aa.fov=u.deg2rad(ea.fov);return aa};a.fromCenterDistance=D;a.fromCenterScale=function(aa,ea,ia,ka,la,
Z){ia=B(aa,ia,ea.latitude);return D(aa,ea,ia,ka,la,Z)};a.fromExtent=function(aa,ea,ia,ka,la,Z=null){var ca=null!=ea.zmax&&null!=ea.zmin;let Y;if(aa.state.isGlobal){if(!A.isSpatialReferenceSupported(ea.spatialReference,k.ViewingMode.Global))return N(Z)&&Z.resolver.reject(),null;var da=new e(ea.xmin,ea.ymin,ea.spatialReference);const ma=new e(ea.xmax,ea.ymax,ea.spatialReference),pa=ea.spatialReference.isGeographic?Q:W;var ha=new e({x:pa.center(da.x,ma.x),y:(ma.y+da.y)/2,z:ca?(ea.zmax+ea.zmin)/2:null,
spatialReference:ea.spatialReference});const na=p.getReferenceEllipsoid(ea.spatialReference);var ja=w.getGreatCircleSpanAt(ha,da,ma);Y=ja.lon;ja=ja.lat;pa.diff(da.x,ma.x)>pa.range/2&&(Y+=na.halfCircumference);Y=Math.min(Y,na.halfCircumference);ja=Math.min(ja,na.halfCircumference)}else ha=v.unwrapOr(aa.renderSpatialReference,ea.spatialReference),ha.equals(ea.spatialReference)||(ea=g.project(ea,ha)),Y=ea.xmax-ea.xmin,ja=ea.ymax-ea.ymin,ha=new e({x:ea.xmin+.5*Y,y:ea.ymin+.5*ja,z:ca?(ea.zmax+ea.zmin)/
2:null,spatialReference:ha});da=aa.state.camera;ea=Math.max(1/Math.tan(da.fovX/2)*Y*.5,1/Math.tan(da.fovY/2)*ja*.5,1/Math.tan(da.fov/2)*(ca?ea.zmax-ea.zmin:0)*.5)/1;if(N(Z))ca=new ba(Z.signal),M(aa,ia,ka,ha,ea,la,ca),ca.resolver.promise.then(ma=>{ma=P(aa,ma,aa.camera.fov);if(v.isNone(ma))Z.resolver.reject();else return Z.resolver.resolve(ma)},ma=>Z.resolver.reject(ma));else return ia=M(aa,ia,ka,ha,ea,la),P(aa,ia,aa.camera.fov,Z)};a.getObserverForPointAtDistance=M;a.headingTiltToDirectionUp=function(aa,
ea,ia,ka,la){return x(aa).headingTiltToDirectionUp(ea,ia,ka,la)};a.internalToExternal=function(aa,ea,ia){const ka=aa.renderSpatialReference,la=E(aa,ea.eye,ea.viewForward,ea.up,H);aa=aa.spatialReference||t.WGS84;g.projectVectorToVector(ea.eye,ka,X,aa)||(aa=t.WGS84,g.projectVectorToVector(ea.eye,ka,X,aa));if(v.isNone(ia))return new c(new e(X,aa),la.heading,la.tilt,u.rad2deg(ea.fov));ia.position.x=X[0];ia.position.y=X[1];ia.position.z=X[2];ia.position.spatialReference=aa;ia.heading=la.heading;ia.tilt=
la.tilt;ia.fov=u.rad2deg(ea.fov);return ia};a.observerToCamera=P;a.scaleToDistance=B;a.scaleToResolution=function(aa,ea){return aa.spatialReference?q.getResolutionForScale(ea,aa.spatialReference):void 0};a.scaleToZoom=function(aa,ea){var ia;if(aa=null==(ia=aa.basemapTerrain)?void 0:ia.tilingScheme)return aa.levelAtScale(ea);V.error("#scaleToZoom()","Cannot compute zoom from scale without a tiling scheme")};a.toExtent=function(aa,ea,ia){const ka=g.projectVectorToPoint(ia,aa.renderSpatialReference,
aa.spatialReference||t.WGS84);if(v.isNone(ka))return null;var la=Math.tan(ea.fovX/2),Z=Math.tan(ea.fovY/2);ea=h.dist(ea.eye,ia);la*=2*ea;Z*=2*ea;return"global"===aa.viewingMode?f.toExtent(aa,ka,la,Z):y.toExtent(aa,ka,la,Z)};a.zoomToScale=function(aa,ea){var ia;if(aa=null==(ia=aa.basemapTerrain)?void 0:ia.tilingScheme)return aa.scaleAtLevel(ea);V.error("#zoomToScale()","Cannot compute scale from zoom without a tiling scheme")};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/scaleUtils":function(){define(["exports","../../core/unitUtils"],function(a,b){function c(n,l){l=b.getMetersPerUnitForSR(l);return n/(l*b.inchesPerMeter*96)}a.getExtentForScale=function(n,l){const u=n.extent;n=n.width;l=c(l,u.spatialReference);return u.clone().expand(l*n/u.width)};a.getResolutionForScale=c;a.getScale=function(n,l){l=l||n.extent;n=n.width;const u=b.getMetersPerUnitForSR(l&&l.spatialReference);return l&&n?l.width/n*u*b.inchesPerMeter*96:0};a.getScaleForResolution=
function(n,l){l=b.getMetersPerUnitForSR(l);return n*l*b.inchesPerMeter*96};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/cameraUtilsPlanar":function(){define("exports ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projection ../views/3d/support/cameraUtilsInternal".split(" "),function(a,b,c,n,l,u,v,m,h){function d(z,A,x,B=h.createDirectionUp()){const {direction:C,up:D}=B;c.fromZRotation(y,-b.deg2rad(A));
c.rotateX(y,y,b.deg2rad(x));l.transformMat4(C,r,y);l.scale(C,C,-1);l.transformMat4(D,k,y);return B}function e(z,A,x,B){return h.directionToHeadingTilt(A,x,B,r,k)}function g(z,A,x,B){const C=d(z,x,B),D=u.create();l.scale(D,C.direction,-A);l.add(D,D,z);return{up:C.up,eye:D,heading:x,tilt:B}}function p(z){return b.rad2deg(z)}function t(z){return b.deg2rad(z)}function q(z,A,x,B,C){const D=z.renderSpatialReference;z=z.map&&z.spatialReference||A.spatialReference;m.projectPointToVector(A,f,D);m.projectPointToVector(A,
w,D);f[0]-=x/2;w[0]+=x/2;f[1]-=B/2;w[1]+=B/2;m.projectVectorToVector(f,D,f,z);m.projectVectorToVector(w,D,w,z);C?(C.xmin=f[0],C.ymin=f[1],C.xmax=w[0],C.ymax=w[1],C.spatialReference=z):C=new v(f[0],f[1],w[0],w[1],z);return C}const k=u.fromValues(0,1,0),r=u.fromValues(0,0,1),y=n.create(),f=u.create(),w=u.create();n=Object.freeze(Object.defineProperty({__proto__:null,headingTiltToDirectionUp:d,directionToHeadingTilt:e,eyeForCenterWithHeadingTilt:g,lookAtTiltToEyeTilt:p,eyeTiltToLookAtTilt:t,toExtent:q},
Symbol.toStringTag,{value:"Module"}));a.cameraUtilsPlanar=n;a.directionToHeadingTilt=e;a.eyeForCenterWithHeadingTilt=g;a.eyeTiltToLookAtTilt=t;a.headingTiltToDirectionUp=d;a.lookAtTiltToEyeTilt=p;a.toExtent=q})},"esri/views/3d/support/cameraUtilsInternal":function(){define(["exports","../../../core/mathUtils","../../../chunks/vec3","../../../chunks/vec3f64"],function(a,b,c,n){const l=n.create(),u=n.create();a.createDirectionUp=function(){return{direction:n.create(),up:n.create()}};a.directionToHeadingTilt=
function(v,m,h,d,e){let g=c.normalize(l,v),p=c.dot(g,d);const t=0<p;p=Math.abs(p);.99<p&&(p=Math.abs(c.dot(m,d)),.99>p?(c.copy(g,m),t&&c.scale(g,g,-1)):g=null);m=0;g&&(c.scale(u,d,c.dot(d,g)),c.subtract(g,g,u),m=c.dot(g,e)/(c.length(g)*c.length(e)),c.cross(u,g,e),m=(0<c.dot(u,d)?1:-1)*b.rad2deg(b.acosClamped(m)));v=b.rad2deg(b.acosClamped(-c.dot(d,v)/c.length(v)));if(!h)return{heading:m,tilt:v};h.heading=m;h.tilt=v;return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/cameraUtilsSpherical":function(){define("exports ../core/Cyclical ../core/mathUtils ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../geometry/Extent ../geometry/projectionEllipsoid ../geometry/SpatialReference ../geometry/support/webMercatorUtils ../views/3d/support/cameraUtilsInternal ../views/3d/support/earthUtils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p){function t(F,G,O,K=g.createDirectionUp()){u.cross(D,F,A);0===u.dot(D,D)&&u.cross(D,F,x);n.fromRotation(C,-c.deg2rad(G),F);n.rotate(C,C,
-c.deg2rad(O),D);const {up:L,direction:R}=K;u.cross(L,D,F);u.normalize(L,L);u.transformMat4(L,L,C);u.normalize(R,F);u.negate(R,R);u.transformMat4(R,R,C);return K}function q(F,G,O,K){const L=D,R=E;u.normalize(L,F);u.cross(E,L,A);0===u.dot(E,E)&&u.cross(E,L,x);u.cross(R,E,L);return g.directionToHeadingTilt(G,O,K,L,R)}function k(F,G,O,K){const L={eye:v.create(),up:null,tilt:K,heading:O},R=D;R[0]=F[0];R[1]=F[2];R[2]=-F[1];O=c.deg2rad(O);var M=c.deg2rad(K);K=Math.sin(O);O=Math.cos(O);var J=Math.sin(M),
I=Math.cos(M);const P=u.length(R);if(1E-8>Math.abs(M))M=G+P;else{var N=P/J,V=c.asinClamped(G/N);M=N*Math.sin(Math.PI-M-V)}I*=G;N=G*G*J*J;V=O*O*N;const S=M-I,T=S*S;var H=V*(V+T-R[1]*R[1]);if(0>H)return u.scale(L.eye,R,M/P),L.tilt=0,L;var U=Math.sqrt(H);const W=R[1]*S;H=V+T;U=0<O?-U+W:U+W;if(1E-8>Math.abs(H))return 1E-8>P?(L.eye[0]=0,L.eye[1]=0,L.eye[2]=G):u.scale(L.eye,R,M/P),L.tilt=0,r(L.eye),y(L,F);L.eye[1]=U/H;G*=J;U=L.eye[1]*L.eye[1];J=1-U;H=Math.sqrt(J);N=V*U+K*K*N-2*O*G*L.eye[1]*H*S+J*T;if(1E-8>
Math.abs(N))return u.scale(L.eye,R,M/P),L.tilt=0,r(L.eye),y(L,F);L.eye[0]=(J*(M*R[0]-I*R[0])-G*H*(R[0]*L.eye[1]*O+R[2]*K))/N;L.eye[2]=(J*(M*R[2]-I*R[2])-G*H*(R[2]*L.eye[1]*O-R[0]*K))/N;u.scale(L.eye,L.eye,M);r(L.eye);return y(L,F)}function r(F){const G=F[1];F[1]=-F[2];F[2]=G}function y(F,G){G=t(G,F.heading,F.tilt);F.up=G.up;return F}function f(F,G,O){G=u.length(G);O=c.asinClamped(O/(Math.sqrt(O*O+G*G-2*O*G*Math.cos(Math.PI-F))/Math.sin(F)));return c.rad2deg(F-O)}function w(F,G,O){F=c.deg2rad(F);G=
u.length(G);return c.asinClamped(O/(G/Math.sin(F)))+F}function z(F,G,O,K,L){function R(P){const N=Math.PI/2;P=b.cyclical2PI.normalize(P,-N);P>N&&(P=Math.PI-P);return P}var M=G.latitude;var J=h.getReferenceEllipsoid(F.spatialReference).radius;G=G.longitude;var I=p.getLonDeltaForDistance(M,O,J)/2;O=G-I;G+=I;M=c.deg2rad(M);M=(1+Math.sin(M))/(1-Math.sin(M));I=(M+1)*Math.tan(K/J/2);M=1.5*Math.PI-2*Math.atan(.5*(I+Math.sqrt(4*M+I*I)));K=M+K/J;M=R(M);K=R(K);K<M&&(J=K,K=M,M=J);M=Math.max(c.rad2deg(M),-90);
K=Math.min(c.rad2deg(K),90);G=B.monotonic(O,G);180<G-O&&(J=(G-O-180)/2,O+=J,G-=J);J=F.spatialReference&&F.spatialReference.isGeographic?F.spatialReference:d.WGS84;L?(L.xmin=O,L.ymin=M,L.xmax=G,L.ymax=K,L.spatialReference=J):L=new m(O,M,G,K,J);F.spatialReference&&F.spatialReference.isWebMercator&&e.geographicToWebMercator(L,!1,L);return L}const A=v.fromValues(0,0,1),x=u.normalize(v.create(),v.fromValues(1,1,1)),B=new b.Cyclical(-180,180),C=l.create(),D=v.create(),E=v.create();l=Object.freeze(Object.defineProperty({__proto__:null,
headingTiltToDirectionUp:t,directionToHeadingTilt:q,eyeForCenterWithHeadingTilt:k,lookAtTiltToEyeTilt:f,eyeTiltToLookAtTilt:w,toExtent:z},Symbol.toStringTag,{value:"Module"}));a.cameraUtilsSpherical=l;a.directionToHeadingTilt=q;a.eyeForCenterWithHeadingTilt=k;a.eyeTiltToLookAtTilt=w;a.headingTiltToDirectionUp=t;a.lookAtTiltToEyeTilt=f;a.toExtent=z})},"esri/views/3d/support/earthUtils":function(){define(["exports","../../../core/mathUtils","../../../geometry/Point","../../../geometry/projectionEllipsoid"],
function(a,b,c,n){function l(m,h,d){return u(m,h.longitude,h.latitude,d.longitude,d.latitude)}function u(m,h,d,e,g){d=b.deg2rad(d);g=b.deg2rad(g);h=b.deg2rad(h);const p=b.deg2rad(e);e=Math.sin((d-g)/2);h=Math.sin((h-p)/2);d=2*b.asinClamped(Math.sqrt(e*e+Math.cos(d)*Math.cos(g)*h*h));return Math.round(d*m*1E4)/1E4}function v(m,h){m/=15;h||(m=Math.round(m));return m}a.getGreatCircleDistance=u;a.getGreatCircleDistanceFromPoints=l;a.getGreatCircleSpanAt=function(m,h,d){const e=h.spatialReference,g=n.getReferenceEllipsoid(e),
p=new c(h.x,m.y,e),t=new c(d.x,m.y,e);h=new c(m.x,h.y,e);m=new c(m.x,d.y,e);return{lon:l(g.radius,p,t),lat:l(g.radius,h,m)}};a.getLatDeltaForDistance=function(m,h){return b.rad2deg(m/h)};a.getLonDeltaForDistance=function(m,h,d){h/=d;m=b.deg2rad(m);h=Math.sin(h/2);m=Math.cos(m);m=2*b.asinClamped(Math.sqrt(h*h/(m*m)));return b.rad2deg(m)};a.getMaxCameraAltitude=function(m,h){m=b.deg2rad(m/2);return(1-Math.sin(m))*h/Math.sin(m)};a.longitudeToTimezone=v;a.pointToTimezone=function(m,h){return v(m.longitude,
h)};a.positionToTimezoneInfo=function(m,h){h||(h={hours:0,minutes:0,seconds:0});h.hours=v(m[0],!0);m=h.hours%1;h.hours-=m;h.minutes=60*m;m=h.minutes%1;h.minutes-=m;h.seconds=Math.round(60*m);return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/ElevationProvider":function(){define(["exports","../../../core/maybe","../../../layers/graphics/dehydratedFeatureUtils"],function(a,b,c){function n(l){return"array"in l}a.SamplePosition=
function(l,u=null,v=0){this.array=l;this.spatialReference=u;this.offset=v};a.getElevationAtPoint=function(l,u,v="ground"){if(c.isDehydratedPoint(u))return l.getElevation(u.x,u.y,u.z||0,u.spatialReference,v);if(n(u)){let m=u.offset;return l.getElevation(u.array[m++],u.array[m++],u.array[m]||0,b.unwrapOr(u.spatialReference,l.spatialReference),v)}return l.getElevation(u[0],u[1],u[2]||0,l.spatialReference,v)};a.isSamplePosition=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/layers/graphics/dehydratedFeatureUtils":function(){define(["exports"],function(a){a.isDehydratedPoint=function(b){return"point"===b.type};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webdoc/support/SlideThumbnail":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;a.SlideThumbnail=d=function(e){function g(){var t=e.apply(this,arguments)||this;t.url="";return t}b._inheritsLoose(g,e);var p=g.prototype;p.destroy=function(){this.url=""};p.clone=function(){return new d({url:this.url})};return g}(n.JSONSupport);c.__decorate([l.property({type:String,json:{write:{isRequired:!0}}})],a.SlideThumbnail.prototype,"url",void 0);a.SlideThumbnail=d=c.__decorate([h.subclass("esri.webdoc.support.SlideThumbnail")],a.SlideThumbnail);Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/support/Description":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,v,m){var h;c=h=function(d){function e(){var g=d.apply(this,arguments)||this;g.text="";return g}
a._inheritsLoose(e,d);e.prototype.clone=function(){return new h({text:this.text})};return e}(c.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"text",void 0);return c=h=b.__decorate([m.subclass("esri.webscene.support.Description")],c)})},"esri/webscene/support/SlideEnvironment":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../views/3d/environment/SunnyWeather ../../views/3d/environment/weather ../lightingTypes ../SunLighting".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){var p;a.SlideEnvironment=p=function(t){function q(){var k=t.apply(this,arguments)||this;k.lighting=new g;k.weather=new h;return k}b._inheritsLoose(q,t);q.prototype.clone=function(){return new p({lighting:l.clone(this.lighting),weather:l.clone(this.weather)})};return q}(n.JSONSupport);c.__decorate([u.property({types:e.lightingTypes,json:{write:!0}})],a.SlideEnvironment.prototype,"lighting",void 0);c.__decorate([u.property({types:d.weatherTypes,json:{write:!0}})],a.SlideEnvironment.prototype,
"weather",void 0);a.SlideEnvironment=p=c.__decorate([m.subclass("esri.webscene.Environment")],a.SlideEnvironment);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/support/SlideGround":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Ground ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../webdoc/support/opacityUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d){var e;n=e=function(g){function p(){var q=g.apply(this,arguments)||this;q.opacity=null;return q}a._inheritsLoose(p,g);var t=p.prototype;t.clone=function(){return new e({opacity:this.opacity})};t.cloneAndApplyTo=function(q){if(null==this.opacity)return q;q=null!=q?q.clone():new c;q.opacity=this.opacity;return q};p.fromGround=function(q){return new e({opacity:q.opacity})};return p}(n.JSONSupport);b.__decorate([l.property({type:Number,json:{type:m.Integer,read:{reader:d.transparencyToOpacity,
source:"transparency"},write:{writer:(g,p)=>{p.transparency=d.opacityToTransparency(g)},target:"transparency"}}})],n.prototype,"opacity",void 0);return n=e=b.__decorate([h.subclass("esri.webscene.support.SlideGround")],n)})},"esri/webscene/support/SlideVisibleLayer":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/accessorSupport/decorators/property ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){var h;a.SlideVisibleLayer=h=function(d){function e(g){g=d.call(this,g)||this;g.id="";g.sublayerIds=null;return g}b._inheritsLoose(e,d);e.prototype.clone=function(){return new h({id:this.id,sublayerIds:l.clone(this.sublayerIds)})};return e}(n.JSONSupport);c.__decorate([u.property({type:String,json:{write:!0}})],a.SlideVisibleLayer.prototype,"id",void 0);c.__decorate([u.property({type:[v.Integer],json:{read:{source:"subLayerIds"},write:{target:"subLayerIds"}}})],a.SlideVisibleLayer.prototype,
"sublayerIds",void 0);a.SlideVisibleLayer=h=c.__decorate([m.subclass("esri.webscene.support.SlideVisibleLayer")],a.SlideVisibleLayer);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/webscene/support/Title":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){var h;c=h=function(d){function e(){var g=d.apply(this,arguments)||this;g.text="";return g}a._inheritsLoose(e,d);e.prototype.clone=function(){return new h({text:this.text})};return e}(c.JSONSupport);b.__decorate([n.property({type:String,json:{write:{isRequired:!0}}})],c.prototype,"text",void 0);return c=h=b.__decorate([m.subclass("esri.webscene.support.Title")],c)})},"esri/webscene/TransportationNetwork":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/JSONSupport ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){var h;c=h=function(d){function e(g){return d.call(this,g)||this}a._inheritsLoose(e,d);e.prototype.clone=function(){return new h({name:this.name,path:this.path,title:this.title})};return e}(c.JSONSupport);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"name",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"path",void 0);b.__decorate([n.property({type:String,json:{write:!0}})],c.prototype,"title",void 0);return c=h=b.__decorate([m.subclass("esri.webscene.TransportationNetwork")],
c)})},"esri/webscene/Version":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../core/Version"],function(a,b,c){c=function(n){function l(u,v){return n.call(this,u,v,"webscene")||this}b._inheritsLoose(l,n);b._createClass(l,[{key:"supportsGround",get:function(){return this.since(1,8)}},{key:"supportsVisibleElevationLayersInSlides",get:function(){return this.lessThan(1,8)}}]);return l}(c.Version);a.Version=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/SceneView":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../Camera ../geometry ../Graphic ../Viewpoint ../core/Collection ../core/domUtils ../core/Error ../core/events ../core/handleUtils ../core/has ../core/iteratorUtils ../core/Logger ../core/maybe ../core/ObservableChangesType ../core/promiseUtils ../core/reactiveUtils ../core/scheduling ../core/screenUtils ../core/workers/workers ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/subclass ../core/accessorSupport/ensureType ../chunks/vec3f64 ../core/support/OwningCollection ../geometry/HeightModelInfo ../geometry/projection ../geometry/support/aaBoundingRect ../chunks/boundedPlane ../geometry/support/coordinateSystem ../geometry/support/scaleUtils ../layers/support/layerUtils ../support/AnalysesCollection ./BreakpointsOwner ./DOMContainer ./GroundView ./PopupView ./View ./ViewAnimation ./ViewingMode ./3d/layerViewModuleImportUtils ./3d/analysis/AnalysisViewManager3D ./3d/constraints/Constraints ./3d/environment/SceneViewEnvironment ./3d/environment/SceneViewEnvironmentManager ./3d/input/SceneInputManager ./3d/layers/graphics/GraphicsDeconflictor ./3d/layers/graphics/Labeler ./3d/layers/graphics/ObjectResourceCache ./3d/layers/support/FeatureTileTree3D ./3d/state/ViewState ./3d/state/ViewStateManager ./3d/state/helpers/SceneIntersectionHelper ./3d/support/CombinedElevationProvider ./3d/support/debugFlags ./3d/support/DisplayQualityProfile ./3d/support/ElevationProvider ./3d/support/HighlightOptions ./3d/support/MapCoordsHelper ./3d/support/PropertiesPool ./3d/support/QualitySettings ./3d/support/RenderCoordsHelper ./3d/support/ResourceController ./3d/support/SceneViewPerformanceInfo ./3d/support/SharedSymbolResources ./3d/support/pointsOfInterest/PointsOfInterest ./3d/terrain/TerrainSurface ./3d/terrain/terrainUtils ./3d/webgl-engine/Stage ./3d/webgl-engine/lib/Intersector ./3d/webgl-engine/lib/IntersectorInterfaces ./3d/webgl-engine/lib/intersectorUtils ./3d/webgl-engine/lib/intersectorUtilsConversions ./3d/webgl-engine/lib/verticalOffsetUtils ./support/hitTestSelectUtils ./support/layerViewUtils ./support/screenshotUtils ./support/screenUtils ./support/spatialReferenceSupport ./support/WebGLRequirements ./ui/3d/DefaultUI3D ../webscene/Environment ../geometry/SpatialReference ../geometry/Point ../geometry/Extent".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H,U,W,Q,X,ba,aa,ea,ia,ka,la,Z,ca,Y,da,ha,ja,ma,pa,na,wa,xa,sa,ya,ra,ua,Ba,Ea,Ja,va,Ca,Ka,Oa,Ra,Pa,qa,za,Da,La,Na,Ua,Ta,Za,ab,hb,ta,Fa,Sa){function Xa(ob,rb){ob.layerUids||(ob.layerUids=new Set);ob.layerUids.add(rb)}function Ya(ob,rb){return k.isSome(ob)&&K.canProjectWithoutEngine(ob.spatialReference,rb)?K.project(ob,rb):null}const eb=ob=>Object.freeze(Object.defineProperty({__proto__:null,default:ob},Symbol.toStringTag,
{value:"Module"})),fb=q.getLogger("esri.views.SceneView");l=function(ob){function rb(Ia){var Ha=ob.call(this,Ia)||this;Ha._userClippingArea=null;Ha._clippingArea=null;Ha._initialDefaultSpatialReference=null;Ha._defaults={};Ha._externallySet={environment:!1};Ha._createGraphicsViewController=null;Ha._resolveWhenReady=[];Ha.propertiesPool=new sa.PropertiesPool({slicePlane:R.BoundedPlaneClass},b._assertThisInitialized(Ha));Ha._resourceController=ua.newResourceController(b._assertThisInitialized(Ha));
Ha._defaultToMapOptions={include:new Set};Ha._defaultHitTestOptions={exclude:new Set};Ha.deconflictor=new ka.GraphicsDeconflictor({view:b._assertThisInitialized(Ha)});Ha.labeler=new la.Labeler({view:b._assertThisInitialized(Ha),deconflictor:Ha.deconflictor.labels});Ha.sharedSymbolResources=null;Ha.analyses=new P.AnalysesCollection;Ha.basemapTerrain=null;Ha.elevationProvider=null;Ha.camera=null;Ha.canvas=null;Ha.center=null;Ha.constraints=new ba.Constraints;Ha.environmentManager=new ea.SceneViewEnvironmentManager;
Ha.extent=null;Ha.floors=new m;Ha.fullOpacity=1;Ha.graphicsView=null;Ha.analysisViewManager=new X({view:b._assertThisInitialized(Ha)});Ha.groundView=null;Ha.navigating=!1;Ha.map=null;Ha.screenSizePerspectiveEnabled=!0;Ha.state=new Y;Ha.scale=null;Ha.spatialReference=null;Ha.alphaCompositingEnabled=!1;Ha.preserveDrawingBufferEnabled=!1;Ha.supersampleScreenshotsEnabled=!0;Ha.type="3d";Ha.ui=new ab;Ha._numUpdating=0;Ha._lastUpdateTime=0;Ha.updatingProgress=.5;Ha.viewpoint=null;Ha.zoom=null;Ha.highlightOptions=
new wa;Ha.voxelWasm=null;Ha.voxelWasmPromise=null;A.initialize();Ia&&Ia.environment||(Ha._defaults.environment=new aa,Ha.environment=Ha._defaults.environment);const Va=($a=null)=>{k.isSome($a)&&$a.type===r.ObservableChangesType.MOVE||(Ha._updatingChanged(),Ha.map&&Ha.map.allLayers.forEach(function(){var db=b._asyncToGenerator(function*(gb){try{yield gb.when()}catch{}Ha._updatingChanged()});return function(gb){return db.apply(this,arguments)}}()))};Ha.handles.add([f.on(()=>{var $a;return null==($a=
Ha.map)?void 0:$a.allLayers},"after-changes",$a=>Va($a),{onListenerAdd:()=>Va(),onListenerRemove:()=>Va(),sync:!0}),Ha.allLayerViews.on("after-changes",$a=>Ha._updateUpdatingMonitors($a)),f.watch(()=>Ha.map,$a=>{$a&&"load"in $a&&$a.load&&$a.load().catch(()=>{})})]);Ha.inputManager=new ia({view:b._assertThisInitialized(Ha)});Ha.stateManager=new da({view:b._assertThisInitialized(Ha)});return Ha}b._inheritsLoose(rb,ob);var cb=rb.prototype;cb.initialize=function(){this.groundView=new S({view:this});this._updateUpdatingMonitors();
const Ia=()=>this._updateDefaultToMapOptions();this.handles.add(f.on(()=>{var Ha;return null==(Ha=this.map)?void 0:Ha.allLayers},"after-changes",Ia,{onListenerAdd:Ia,onListenerRemove:Ia}));this.updatingHandles.add(()=>this.qualitySettings.memoryLimit,Ha=>{this.resourceController&&(this.resourceController.memoryController.maxMemory=Ha)},f.initial);this.updatingHandles.add(()=>this.qualitySettings.additionalCacheMemory,Ha=>{this.resourceController&&(this.resourceController.memoryController.additionalCacheMemory=
Ha)},f.initial);this.updatingHandles.add(()=>this.qualitySettings.frameRate,Ha=>w.setFrameDuration(0<Ha?1E3/Math.ceil(Ha):0),f.initial);this.updatingHandles.add(()=>{var Ha;return null==(Ha=this.map)?void 0:Ha.ground},Ia,f.syncAndInitial);this.updatingHandles.add(()=>{var Ha,Va;return null==(Ha=this.map)?void 0:null==(Va=Ha.ground)?void 0:Va.opacity},()=>this._updateDefaultHitTestOptions(),f.syncAndInitial);this.handles.add(f.watch(()=>this.spatialReference,()=>this.notifyChange("clippingArea"),f.sync))};
cb.destroy=function(){this.destroyed||(this.invalidate(),this.activeTool=null,this.layerViewManager.clear(),this._exitSurface(),this._disposeGraphicsView(),this.sharedSymbolResources=k.destroyMaybe(this.sharedSymbolResources),this.labeler.destroy(),this._set("labeler",null),this.deconflictor.destroy(),this._set("deconflictor",null),this._resourceController=k.destroyMaybe(this._resourceController),this.stateManager.destroy(),this._set("stateManager",null),this.inputManager.destroy(),this._set("inputManager",
null),this.propertiesPool.destroy(),this.handles.remove("updatingMonitors"),this.environmentManager.destroy(),this._set("environmentManager",null),this.groundView=k.destroyMaybe(this.groundView))};cb.installContentCameraReset=function(Ia={sticky:!1}){return this.stateManager.installContentCameraReset(Ia)};cb.castEnvironment=function(Ia){return Ia?Ia instanceof aa?Ia:Ia instanceof hb?null!=this.environment?this.environment.cloneWithWebsceneEnvironment(Ia):aa.fromWebsceneEnvironment(Ia):E.ensureType(aa,
Ia):new aa};cb.forceAnimationTime=function(Ia){this._stage.renderView.forcedAnimationTime=this.basemapTerrain.overlayManager.forcedAnimationTime=Ia};cb.on=function(Ia,Ha,Va,$a){return(Va=this.viewEvents.on(Ia,Ha,Va,$a))?Va:ob.prototype.on.call(this,Ia,Ha)};cb.hasEventListener=function(Ia){return ob.prototype.hasEventListener.call(this,Ia)||this.viewEvents.hasHandler(Ia)};cb.toMap=function(Ia,Ha){if(!this.ready)return fb.error("#toMap()","Scene view cannot be used before it is ready"),null;Ha=Ha?this.externalToInternalIntersectOptions(Ha):
this._defaultToMapOptions;var Va=k.isSome(Ha.graphics)&&(k.isSome(Ha.graphics.include)||k.isSome(Ha.graphics.exclude));Ia=Ua.isSupportedScreenPointEvent(Ia)?Ua.createScreenPointFromSupportedEvent(this,Ia):Ia;Ia=z.screenPointObjectToArray(Ia);Ha.enableDraped=Ha.include&&!Ha.include.has(za.TERRAIN_ID)||Ha.exclude&&Ha.exclude.has(za.TERRAIN_ID);const $a=this.sceneIntersectionHelper,db=Oa.newIntersector(this.state.viewingMode);db.options.selectionMode=!0;db.options.store=Va?Ra.StoreResults.ALL:Ra.StoreResults.MIN;
$a.intersectIntersectorScreen(Ia,db,Ha);if(Va){for(const gb of db.results.all)if(Va=qa.toHit(gb,this),k.isNone(Va)||"graphic"!==Va.type||this._testGraphicUidFilter(Ha.graphics,Va.graphic))return this._intersectResultToMapPoint(gb);return null}return this._intersectResultToMapPoint(db.results.min)};cb.toScreen=function(Ia){if(!this.ready)return fb.error("#toScreen()","Scene view cannot be used before it is ready"),null;const Ha=k.unwrapOr(null==Ia.z&&na.getElevationAtPoint(this.elevationProvider,Ia),
0);K.projectPointToVector(Ia,jb,this.renderSpatialReference,Ha);this.state.camera.projectToScreen(jb,kb);return z.createScreenPoint(kb[0],kb[1])};cb.pixelSizeAt=function(Ia){if(!this.ready)return fb.error("#pixelSizeAt()","Scene view cannot be used before it is ready"),null;if(!Ia)return 0;K.projectPointToVector(Ia,jb,this.renderSpatialReference);return this.state.camera.computeScreenPixelSizeAt(jb)};cb.overlayPixelSizeInMapUnits=function(Ia){const Ha=this.basemapTerrain.overlayManager;return Ha?
Ha.overlayPixelSizeInMapUnits(Ia):1};cb.hitTest=function(Ia,Ha){if(!this.ready)return fb.error("#hitTest()","Scene view cannot be used before it is ready"),null;Ia=Ua.isSupportedScreenPointEvent(Ia)?Ua.createScreenPointFromSupportedEvent(this,Ia):Ia;var Va=z.createScreenPointArray(Ia.x,Ia.y),$a=Ha?this.externalToInternalIntersectOptions(Ha):this._defaultHitTestOptions;$a.requiresGroundFeedback=!0;$a.enableDraped=!0;Ha=Oa.newIntersector(this.state.viewingMode);Ha.options.selectionMode=!0;Ha.options.store=
Ra.StoreResults.ALL;this.sceneIntersectionHelper.intersectIntersectorScreen(Va,Ha,$a);Va=this._intersectResultsToHits(Ha.results.all,$a.graphics);$a=Ha.results.ground;var db=qa.toOwner($a,this);db=k.isSome(db)&&"type"in db&&"integrated-mesh"===db.type?db:null;Ia={screenPoint:Ia,results:Va,ground:{mapPoint:this._intersectResultToMapPoint($a),distance:Pa.isValidIntersectorResult($a)?$a.distanceInRenderSpace:0,layer:db}};ma.SCENEVIEW_HITTEST_RETURN_INTERSECTOR&&(Ia.intersector=Ha);return Promise.resolve(Ia)};
cb.popupHitTest=function(){var Ia=b._asyncToGenerator(function*(Ha){const {results:Va,ground:$a}=yield Da.hitTestSelectSimilarDistance(this,Ha);let db=null;!(0===Va.length||1E-5>Math.abs(k.unwrapOr(Va[0].distance,0)-$a.distance))||$a.layer&&"integrated-mesh"===$a.layer.type||(db=$a.mapPoint);return{results:Va,screenPoint:Ha,mapPoint:db}});return function(Ha){return Ia.apply(this,arguments)}}();cb.goTo=function(Ia,Ha){return this.updatingHandles.addPromise(this.stateManager.goTo(Ia,Ha))};cb.whenAnalysisView=
function(){var Ia=b._asyncToGenerator(function*(Ha){if(k.isNone(Ha.parent))throw new d("view:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:Ha});switch(Ha.parent.type){case "line-of-sight":return(yield this.whenLayerView(Ha.parent)).whenAnalysisView();default:return this.analysisViewManager.whenAnalysisView(Ha)}});return function(Ha){return Ia.apply(this,arguments)}}();cb.whenLayerView=function(Ia){return ob.prototype.whenLayerView.call(this,Ia)};cb.takeScreenshot=
function(){var Ia=b._asyncToGenerator(function*(Ha){Ha=this._completeSettings(Ha);yield this.whenReady();const Va=yield this._stage.renderView.takeScreenshot(Ha);return Na.encode(Va,Ha,this._pixelFormat())});return function(Ha){return Ia.apply(this,arguments)}}();cb._takeScreenshot=function(){var Ia=b._asyncToGenerator(function*(Ha){Ha=this._completeSettings(Ha);yield this.whenReady();Ha=yield this._stage.renderView.takeScreenshot(Ha);return Na.encodeData(Ha,this._pixelFormat())});return function(Ha){return Ia.apply(this,
arguments)}}();cb._completeSettings=function(Ia){Ia=Na.toRenderSettings(Ia,this);Ia.pixelRatio/=this.state.pixelRatio;return Na.screenshotSuperSampleSettings(Ia,this.supersampleScreenshotsEnabled,this.padding)};cb._pixelFormat=function(){return{flipY:!0,premultipliedAlpha:this._stage.renderView.getAlpha()}};cb.addUpdatingPromise=function(Ia){return this.updatingHandles.addPromise(Ia)};cb.importLayerView=function(Ia){return Q.layerView3DImporter.importLayerView(Ia)};cb.hasLayerViewModule=function(Ia){return Q.layerView3DImporter.hasLayerViewModule(Ia)};
cb.forceDOMReadyCycle=function(){this.forceReadyCycle()};cb.getDefaultSpatialReference=function(){var Ia,Ha,Va,$a;return this.map&&"initialViewProperties"in this.map&&(null==(Ia=this.map)?void 0:null==(Ha=Ia.initialViewProperties)?void 0:Ha.spatialReference)||(null==(Va=this.defaultsFromMap)?void 0:Va.spatialReference)||(null==($a=this.defaultsFromMap)?void 0:$a.ready)&&this._initialDefaultSpatialReference||null};cb.validate=function(){var Ia=b._asyncToGenerator(function*(){let Ha=Za.check(this.type);
p("safari")&&9>p("safari")&&(Ha=new d("sceneview:browser-not-supported","This browser is not supported by SceneView (Safari \x3c 9)",{type:"safari",requiredVersion:9,detectedVersion:p("safari")}));if(k.isSome(Ha))throw fb.warn("#validate()",Ha.message),Ha;});return function(){return Ia.apply(this,arguments)}}();cb.getSpatialReferenceSupport=function({spatialReference:Ia,layer:Ha}){var Va=this._predeterminedViewingMode;if(k.isSome(Va))return this._validateSpatialReferenceForViewingMode(Ia,Ha,Va)?{constraints:this._makeSpatialReferenceConstraints(Ia,
Ha,Va)}:null;Va=this._validateSpatialReferenceForViewingMode(Ia,Ha,W.ViewingMode.Local);const $a=this._validateSpatialReferenceForViewingMode(Ia,Ha,W.ViewingMode.Global);return Va||$a?Va&&$a?{constraints:this._makeSpatialReferenceConstraints(Ia,Ha,null)}:Va?{constraints:this._makeSpatialReferenceConstraints(Ia,Ha,W.ViewingMode.Local)}:{constraints:this._makeSpatialReferenceConstraints(Ia,Ha,W.ViewingMode.Global)}:null};cb._validateSpatialReferenceForViewingMode=function(Ia,Ha,Va){return Ta.isSpatialReferenceSupported(Ia,
Va)?k.isNone(Ha)||I.isImageryTileLayer(Ha)?!0:I.isTiledLayer(Ha)&&k.isNone(Ca.getTiledLayerInfo(Ha,Ia,Va))||I.isVoxelLayer(Ha)&&Va===W.ViewingMode.Global?!1:!0:!1};cb._makeSpatialReferenceConstraints=function(Ia,Ha,Va){if(k.isNone(Ha))return[{spatialReference:Ia,viewingMode:Va}];const $a=Ia.isWebMercator,db=Ia.isWGS84;return I.isImageryTileLayer(Ha)&&($a||db)?(db&&Va!==W.ViewingMode.Local?null===Ca.checkIfTileInfoSupportedForView(Ha.tileInfo,Ha.fullExtent,Ia,W.ViewingMode.Global):1)?[{spatialReference:Ia,
viewingMode:Va},{spatialReference:ta.WebMercator,viewingMode:Va}]:[{spatialReference:$a?ta.WGS84:ta.WebMercator,viewingMode:Va}]:I.isTiledLayer(Ha)||I.isVoxelLayer(Ha)||!$a&&!db?I.isTiledLayer(Ha)&&$a&&Va!==W.ViewingMode.Global?[{spatialReference:Ia,viewingMode:Va},{spatialReference:ta.WGS84,viewingMode:W.ViewingMode.Local}]:[{spatialReference:Ia,viewingMode:Va}]:[{spatialReference:Ia,viewingMode:Va},{spatialReference:$a?ta.WGS84:ta.WebMercator,viewingMode:Va}]};cb._validateSpatialReference=function(Ia){const Ha=
k.isSome(this.getSpatialReferenceSupport({spatialReference:Ia})),Va=this._predeterminedViewingMode;Ha||(k.isSome(Va)?fb.warnOnce(`Spatial reference defined on view not supported in ${W.stringFromViewingMode(Va)} viewing mode.`):Ia.isGeographic&&fb.warnOnce("Spatial reference is geographic but not supported."));return Ha};cb.whenReady=function(){return new Promise(Ia=>{this.ready?Ia(this):this._resolveWhenReady.push(Ia)})};cb.computeMapPointFromVec3d=function(Ia,Ha){let Va=this.spatialReference||ta.WGS84;
K.projectVectorToVector(Ia,this.renderSpatialReference,Ia,Va)||(Va=ta.WGS84,K.projectVectorToVector(Ia,this.renderSpatialReference,Ia,Va));Ha?(Ha.x=Ia[0],Ha.y=Ia[1],Ha.z=Ia[2],Ha.spatialReference=Va):Ha=new Fa(Ia,Va);return Ha};cb.trackGraphicState=function(Ia){if(!Ia.graphic)return fb.error("trackGraphicState","GraphicState.graphic must not be null or undefined to start tracking"),null;const Ha=this.getViewForGraphic(Ia.graphic);let Va=null,$a=!1;const db=gb=>{var lb;!$a&&k.isSome(gb)&&"processor"in
gb&&"graphics-3d"===(null==(lb=gb.processor)?void 0:lb.type)&&gb.processor.graphicsCore&&(Va=gb.processor.graphicsCore.trackGraphicState(Ia))};k.isSome(Ha)?db(Ha):this.whenViewForGraphic(Ia.graphic,{waitForLayer:!0}).then(gb=>db(gb),()=>{}).catch(()=>{});return{remove:()=>{$a=!0;k.isSome(Va)&&(Va.remove(),Va=null)}}};cb.highlight=function(Ia){if(Array.isArray(Ia))return g.handlesGroup(Ia.map(Va=>this.highlight(Va)));if(m.isCollection(Ia))return g.handlesGroup(Ia.toArray().map(Va=>this.highlight(Va)));
const Ha=this.getViewForGraphic(Ia);return Ha&&"highlight"in Ha?Ha.highlight(Ia):g.makeHandle()};cb.maskOccludee=function(Ia){if(!Ia)return fb.error("maskOccludee","GraphicState.graphic must not be null or undefined to mask an occludee"),null;const Ha=this.getViewForGraphic(Ia);let Va=null,$a=!1;const db=gb=>{!$a&&k.isSome(gb)&&La.occludeesSupported(gb)&&(Va=gb.maskOccludee(Ia))};k.isSome(Ha)?db(Ha):this.whenViewForGraphic(Ia,{waitForLayer:!0}).then(gb=>db(gb),()=>{}).catch(()=>{});return{remove:()=>
{$a=!0;k.isSome(Va)&&(Va.remove(),Va=null)}}};cb.getViewForGraphic=function(Ia){return Ia.layer===this.graphics?this.graphicsView:Ia.layer?this.allLayerViews.find(Ha=>Ha.layer===Ia.layer):null};cb.graphicChanged=function(Ia){k.isSome(this.graphicsView)&&this.graphicsView.graphicChanged(Ia)};cb.whenViewForGraphic=function(){var Ia=b._asyncToGenerator(function*(Ha,Va){if(Ha.layer===this)return yield f.whenOnce(()=>this.graphicsView),this.graphicsView;if(!Ha.layer||!this.map)throw new d("no-view-for-graphic");
return Va&&Va.waitForLayer&&!this.map.allLayers.includes(Ha.layer)?new Promise(($a,db)=>{const gb=this.map.allLayers.on("change",lb=>{lb.added.includes(Ha.layer)&&(gb.remove(),this.whenLayerView(Ha.layer).then($a,db))})}):this.whenLayerView(Ha.layer)});return function(Ha,Va){return Ia.apply(this,arguments)}}();cb.externalToInternalIntersectOptions=function(Ia){const Ha=this._externalToInternalRenderItems(Ia.include,mb.INCLUDE);Ia=this._externalToInternalRenderItems(Ia.exclude,mb.EXCLUDE);return{include:Ha.layerUids,
exclude:Ia.layerUids,graphics:{include:Ha.graphicUids,exclude:Ia.graphicUids}}};cb._intersectResultToMapPoint=function(Ia,Ha){return Ia.getIntersectionPoint(jb)?(Ha=this.computeMapPointFromVec3d(jb,Ha),Ia.intersector===Ra.IntersectorType.TERRAIN&&this.basemapTerrain&&(Ha.z=k.unwrapOr(na.getElevationAtPoint(this.basemapTerrain,Ha),0)),Ha):null};cb._intersectResultsToHits=function(Ia,Ha){const Va=[];let $a=null;for(let lb=0;lb<Ia.length;lb++){const yb=Ia[lb];var db=qa.toOwner(yb,this);if(k.isSome(db)&&
(db===this.map.ground||"type"in db&&"integrated-mesh"===db.type))break;db=qa.toHit(yb,this);if(!k.isNone(db)){if("graphic"===db.type){k.isNone($a)&&lb!==Ia.length-1&&($a=new Set);if(k.isSome($a)){var gb=this._getGraphicFilterUid(db.graphic);if($a.has(gb))continue;$a.add(gb)}if(!this._testGraphicUidFilter(Ha,db.graphic))continue}gb=this._intersectResultToMapPoint(yb);Va.push({...db,mapPoint:gb,distance:yb.distanceInRenderSpace})}}return Va};cb._getGraphicFilterUid=function(Ia){if(Ia.layer&&"objectIdField"in
Ia.layer){const Ha=Ia.attributes[Ia.layer.objectIdField];if(Ha)return`o-${Ia.layer.id}-${Ha}`}return`u-${Ia.uid}`};cb._testGraphicUidFilter=function(Ia,Ha){Ha=this._getGraphicFilterUid(Ha);return k.isNone(Ia)||(k.isNone(Ia.include)||Ia.include.has(Ha))&&(k.isNone(Ia.exclude)||!Ia.exclude.has(Ha))};cb._externalToInternalRenderItems=function(Ia,Ha,Va={layerUids:null,graphicUids:null}){if(!Ia)return Va;if(Ia instanceof u){var $a=this._getGraphicFilterUid(Ia);Va.graphicUids||(Va.graphicUids=new Set);
Va.graphicUids.add($a);Ha===mb.INCLUDE&&(k.isSome(this.graphicsView)&&Ia.layer===this?Xa(Va,this.graphicsView.processor.layer.id):Ia.layer&&Xa(Va,Ia.layer.uid))}else if(t.isIterable(Ia))for($a of Ia)$a===this.graphics&&k.isSome(this.graphicsView)?Xa(Va,this.graphicsView.processor.layer.id):$a===this.map.ground?Xa(Va,za.TERRAIN_ID):this._externalToInternalRenderItems($a,Ha,Va);else"uid"in Ia&&Xa(Va,Ia.uid);return Va};cb._initBasemapTerrain=function(){this._set("basemapTerrain",new va({view:this}));
this._set("elevationProvider",new ja.CombinedElevationProvider({view:this}));this.elevationProvider.register("ground",this.basemapTerrain)};cb._exitBasemapTerrain=function(){this.basemapTerrain&&(this.elevationProvider.unregister(this.basemapTerrain),this.elevationProvider.destroy(),this._set("elevationProvider",null),this.basemapTerrain.destroy(),this._set("basemapTerrain",null))};cb._initGlobe=function(){this._initCoordinateSystem();this.state.createInitialCamera();this._initBasemapTerrain();this._set("pointsOfInterest",
new Ja.PointsOfInterest({view:this}));this._set("featureTiles",new ca.FeatureTileTree3D({renderCoordsHelper:this.renderCoordsHelper,cameraOnSurface:this.pointsOfInterest.contentCameraOnSurface,focus:this.pointsOfInterest.focus,tilingSchemeOwner:this.basemapTerrain,viewState:this.state,scheduler:this._resourceController.scheduler,terrain:this.basemapTerrain}));const Ia=()=>{var Ha;const Va=null==(Ha=this.basemapTerrain)?void 0:Ha.extent;this.clippingArea||Va?Va&&this.basemapTerrain.spatialReference?
(Ha=k.isSome(this.basemapTerrain.extent)?K.project(L.toExtent(this.basemapTerrain.extent,this.basemapTerrain.spatialReference),this.spatialReference):null,k.isSome(this.clippingArea)?this.featureTiles.filterExtent=this.clippingArea.intersection(Ha):this.featureTiles.filterExtent=Ha):this.featureTiles.filterExtent=this.clippingArea:this.featureTiles.filterExtent=null};this.handles.add([this.updatingHandles.add(()=>ma.FEATURE_TILE_TREE_SHOW_TILES,Ha=>{Ha&&this.featureTiles&&!this.featureTreeDebugger?
this.updatingHandles.addPromise(new Promise((Va,$a)=>a(["./3d/layers/support/FeatureTileTree3DDebugger"],Va,$a))).then(({FeatureTileTree3DDebugger:Va})=>{!this.featureTreeDebugger&&ma.FEATURE_TILE_TREE_SHOW_TILES&&(this.featureTreeDebugger=new Va({view:this}))}):Ha||!this.featureTreeDebugger||ma.FEATURE_TILE_TREE_SHOW_TILES||(this.featureTreeDebugger.destroy(),this.featureTreeDebugger=null)},f.syncAndInitial),this.updatingHandles.add(()=>this.clippingArea,Ia,f.syncAndInitial),this.updatingHandles.add(()=>
this.basemapTerrain.extent,Ia,f.syncAndInitial)],"feature-tiles");this.stateManager.init()};cb._exitGlobe=function(){this.state&&(this.stateManager.deinit(),this.handles.remove("render-coords-helper"),this.handles.remove("feature-tiles"),this.featureTiles.destroy(),this._set("featureTiles",null),this.pointsOfInterest.destroy(),this._set("pointsOfInterest",null),this._exitBasemapTerrain(),this.state.exit(),this._exitCoordinateSystem())};cb._initCoordinateSystem=function(){if(this.spatialReference){var Ia=
this.spatialReference;this.mapCoordsHelper&&this.mapCoordsHelper.spatialReference.equals(Ia)||this._set("mapCoordsHelper",new xa.MapCoordsHelper(this.map,Ia));const Ha=this.state.isGlobal;Ia=M.renderSRFromViewSR(Ha,Ia);Ia!==this.renderSpatialReference&&(this._set("renderCoordsHelper",ra.RenderCoordsHelper.create(this.state.viewingMode,Ia)),Ha||this.handles.add(f.watch(()=>{var Va;return null==(Va=this.basemapTerrain)?void 0:Va.extent},Va=>{const $a=this.renderCoordsHelper.spatialReference;Va&&(0!==
Va[0]||0!==Va[1]||0!==Va[2]||0!==Va[3])&&K.projectBoundingRect(Va,this.basemapTerrain.spatialReference,ub,$a)&&(this.renderCoordsHelper.extent=ub)},f.sync),"render-coords-helper"),this.sceneIntersectionHelper&&this.sceneIntersectionHelper.setTolerance(Oa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters))}else this._set("mapCoordsHelper",null),this._set("renderCoordsHelper",null)};cb._exitCoordinateSystem=function(){this.mapCoordsHelper&&(this.handles.remove("render-coords-helper"),this._set("renderCoordsHelper",
null),this._set("mapCoordsHelper",null))};cb._updatingChanged=function(){this.notifyChange("updating")};cb._updateUpdatingMonitors=function(Ia=null){k.isSome(Ia)&&Ia.type===r.ObservableChangesType.MOVE||(this.handles.remove("updatingMonitors"),this.allLayerViews.forEach(Ha=>{Ha.destroyed||(this.handles.add(f.watch(()=>[Ha.updating,Ha.updatingProgress],()=>this._updatingChanged(),f.sync),"updatingMonitors"),Ha.when(()=>this._updatingChanged(),()=>this._updatingChanged()))}),this._updatingChanged())};
cb._renderScreenshotOverlay=function(Ia,Ha){if(!this.overlay||!this.overlay.hasVisibleItems)return Ha;const Va=Ia.getContext("2d");Va.putImageData(Ha,0,0);this.overlay.renderCanvas(Ia);return Va.getImageData(0,0,Ha.width,Ha.height)};cb._initStage=function(){var Ia={deactivatedWebGLExtensions:this.deactivatedWebGLExtensions,debugWebGLExtensions:this.debugWebGLExtensions,alpha:this.alphaCompositingEnabled,preserveDrawingBuffer:this.preserveDrawingBufferEnabled,canvas:this.renderCanvas,screenshot:{renderOverlay:(lb,
yb)=>this._renderScreenshotOverlay(lb,yb)}};const Ha=new ha.SceneIntersectionHelper(this.state.viewingMode,lb=>this._stage.layers.forAll(lb),this);this._set("sceneIntersectionHelper",Ha);const Va=h.byId(this.surface),{resourceController:$a,state:db,renderSpatialReference:gb}=this;this._stage=new Ka.Stage({options:Ia,container:Va,resourceController:$a,state:db,sceneIntersectionHelper:Ha,renderSR:gb});this._stage.renderView.setRenderParameters({slicePlane:this.slicePlane});this._lostWebGLContextHandle=
e.on(this._stage.renderView.canvas,"webglcontextlost",()=>this.fatalError=new d("webgl-context-lost"));this.handles.add([this.updatingHandles.add(()=>this.qualitySettings.antialiasingEnabled,()=>this._stage.renderView.setRenderParameters({antialiasingEnabled:this.qualitySettings.antialiasingEnabled}),f.initial),this.updatingHandles.add(()=>this.qualitySettings.highQualityTransparency,()=>this._stage.renderView.setRenderParameters({highQualityTransparency:this.qualitySettings.highQualityTransparency}),
f.initial),f.watch(()=>this.magnifier,lb=>this._stage.renderView.magnifier=lb,f.syncAndInitial)],"stage");Ia=()=>{this._stage.renderView.setRenderParameters({defaultHighlightOptions:wa.toEngineOptions(this.highlightOptions)})};this.handles.add(this.updatingHandles.add(()=>[this.highlightOptions.color,this.highlightOptions.haloColor,this.highlightOptions.haloOpacity,this.highlightOptions.fillOpacity,this.highlightOptions.shadowOpacity,this.highlightOptions.shadowColor,this.highlightOptions.shadowDifference],
Ia),"stage");Ia();this.renderCoordsHelper&&this.sceneIntersectionHelper.setTolerance(Oa.DEFAULT_TOLERANCE/this.renderCoordsHelper.unitInMeters);this._set("canvas",this._stage.renderView.canvas)};cb._exitStage=function(){this._set("sceneIntersectionHelper",null);this._stage.destroy();this._stage=null;this._lostWebGLContextHandle.remove();this._lostWebGLContextHandle=null;this.handles.remove("stage");this._set("canvas",null)};cb._initSurface=function(Ia){this._exitSurface();this.state.init(Ia,this.spatialReference);
this._initStage();this._initGlobe();this.sharedSymbolResources=new Ea.SharedSymbolResources({view:this,viewingMode:Ia,resourceController:this._resourceController,pointsOfInterest:this.pointsOfInterest,viewState:this.state,objectResourceCache:new Z.ObjectResourceCache})};cb._exitSurface=function(){this.sharedSymbolResources&&(this.sharedSymbolResources.objectResourceCache.destroy(),this.sharedSymbolResources.destroy(),this.sharedSymbolResources=null,this._exitGlobe(),this._exitStage())};cb._createGraphicsViewIfNeeded=
function(){if(!this.graphicsView&&!this._createGraphicsViewController&&0!==this.graphics.length){this.handles.remove("graphics-view");this._createGraphicsViewController=new AbortController;var Ia=()=>{this._createGraphicsViewController=null;this._updatingChanged()};this._createGraphicsViewAsync(this._createGraphicsViewController.signal).then(Ia,Ia);this._updatingChanged()}};cb._createGraphicsViewAsync=function(){var Ia=b._asyncToGenerator(function*(Ha){const Va=(yield new Promise(($a,db)=>a(["./3d/layers/GraphicsView3D"],
gb=>$a(eb(gb)),db))).default;y.throwIfAborted(Ha);yield f.whenOnce(()=>{var $a;return null==($a=this.basemapTerrain)?void 0:$a.ready},Ha);this._set("graphicsView",new Va({view:this}))});return function(Ha){return Ia.apply(this,arguments)}}();cb._disposeGraphicsView=function(){this._createGraphicsViewController&&(this._createGraphicsViewController.abort(),this._createGraphicsViewController=null);this.handles.remove("graphics-view");k.isSome(this.graphicsView)&&(this.handles.remove(this.graphicsView.processor.layer.id),
this.graphicsView.destroy(),this._set("graphicsView",null))};cb._startup=function(){var Ia=W.viewingModeFromString(this.viewingMode);Ia===W.ViewingMode.Global&&(this._clippingArea=null);this._initSurface(Ia);this._set("ready",!0);this.handles.add(f.on(()=>this.graphics,"after-changes",()=>this._createGraphicsViewIfNeeded()),"graphics-view");this._createGraphicsViewIfNeeded();!this._externallySet.environment&&(Ia=this.get("map.initialViewProperties.environment"))&&(this.environment=Ia);this.labeler.setup();
this.environmentManager.connectView(this);this.inputManager.connect();Ia=this._resolveWhenReady;this._resolveWhenReady=[];Ia.forEach(Ha=>Ha(this))};cb._teardown=function(){this._initialDefaultSpatialReference=null;this.inputManager.disconnect();this.environmentManager.disconnectView();this.labeler.dispose();this._disposeGraphicsView();this.handles.remove("graphics-view");this._exitSurface();this._set("ready",!1)};cb._updateDefaultToMapOptions=function(){this._defaultToMapOptions.include.clear();if(this.map){this.map.ground&&
this._defaultToMapOptions.include.add(za.TERRAIN_ID);for(const Ia of this.map.allLayers.items)"integrated-mesh"===Ia.type&&this._defaultToMapOptions.include.add(Ia.uid)}};cb._updateDefaultHitTestOptions=function(){this._defaultHitTestOptions.exclude.clear();if(this.map){this.map.ground&&1>this.map.ground.opacity&&this._defaultHitTestOptions.exclude.add(za.TERRAIN_ID);for(const Ia of this.map.allLayers.items)"integrated-mesh"===Ia.type&&1>Ia.opacity&&this._defaultToMapOptions.exclude.add(Ia.uid)}};
cb.addVoxelLayerViewToWasm=function(Ia){return k.isNone(this.voxelWasm)?(k.isNone(this.voxelWasmPromise)&&(this.voxelWasmPromise=(new Promise((Ha,Va)=>a(["../layers/VoxelWasmPerSceneView"],$a=>Ha(eb($a)),Va))).then(Ha=>this.voxelWasm=new Ha.default(this))),this.voxelWasmPromise.then(Ha=>Ha.addVoxelLayer(Ia))):this.voxelWasm.addVoxelLayer(Ia)};cb.removeVoxelLayerViewFromWasm=function(Ia){k.isSome(this.voxelWasm)&&1>this.voxelWasm.removeVoxelLayer(Ia)&&(this.voxelWasmPromise=this.voxelWasm=null)};b._createClass(rb,
[{key:"renderSpatialReference",get:function(){return this.renderCoordsHelper&&this.renderCoordsHelper.spatialReference}},{key:"basemapSpatialReference",get:function(){var Ia;return null==(Ia=this.basemapTerrain)?void 0:Ia.spatialReference}},{key:"clippingArea",get:function(){if("global"===this.viewingMode)return null;let Ia=this._userClippingArea||this.get("map.clippingArea");if(!this._userClippingArea&&!this.get("map.clippingEnabled")||k.isNone(Ia))return this._clippingArea=null;if(!(Ia instanceof
Sa))return fb.error("#clippingArea","only clippingArea geometries of type Extent are supported"),this._clippingArea;if(this.spatialReference&&(Ia=Ya(Ia,this.spatialReference),k.isNone(Ia)))return fb.error("#clippingArea","setting clippingArea with incompatible SpatialReference"),this._clippingArea;Ia=Ia.clone();k.isNone(Ia.intersection(this.groundAndLayersExtent))&&(Ia.xmin=Ia.xmax,Ia.ymin=Ia.ymax);Ia.zmin=void 0;Ia.zmax=void 0;Ia.equals(this._clippingArea)||(this._clippingArea=Ia);return this._clippingArea},
set:function(Ia){this.ready&&"global"===this.viewingMode&&k.isSome(Ia)?fb.error("#clippingArea\x3d","Clipping area is only supported in local viewingMode"):this._userClippingArea=Ia}},{key:"renderDataExtent",get:function(){if(this.state.viewingMode===W.ViewingMode.Global)return null;const Ia=this.renderSpatialReference,Ha=this.dataExtent;return k.isNone(Ha)||k.isNone(Ia)||Ha.spatialReference.equals(Ia)?Ha:Ya(Ha,Ia)}},{key:"dataExtent",get:function(){let Ia=this.groundAndLayersExtent;var Ha=Ya(this.clippingArea,
this.spatialReference||ta.WGS84);k.isSome(Ha)&&(Ia=k.isSome(Ia)?Ia.intersection(Ha):Ha);Ha=this._get("dataExtent");return k.isSome(Ia)&&Ia.equals(Ha)?Ha:Ia}},{key:"groundAndLayersExtent",get:function(){const Ia=this.spatialReference||ta.WGS84;let Ha;const Va=db=>{db=Ya(db,Ia);k.isNone(db)||(k.isSome(Ha)?Ha.union(db):Ha=db.clone())};var $a=this.basemapTerrain;if(null!=$a&&$a.spatialReference){const db=$a.groundExtent;Va(new Sa({xmin:db[0],ymin:db[1],zmin:0,xmax:db[2],ymax:db[3],zmax:0,spatialReference:$a.spatialReference}))}this.map&&
this.map.allLayers.forEach(db=>{!k.isSome(db.fullExtent)||"graphics"===db.type&&db.internal||Va(db.fullExtent)});if(k.isNone(Ha))return null;Ha.hasZ?(Ha.zmin=Math.min(0,Ha.zmin),Ha.zmax=Math.max(0,Ha.zmax)):(Ha.zmin=0,Ha.zmax=0);$a=this._get("groundAndLayersExtent");return Ha.equals($a)?$a:Ha}},{key:"environment",set:function(Ia){Ia!==this._defaults.environment&&(this._externallySet.environment=!0);this._set("environment",Ia)}},{key:"initialExtentRequired",get:function(){return this.stateManager&&
!this.stateManager.hasInitialView}},{key:"_defaultsFromMapSettings",get:function(){return{required:{tileInfo:!1,heightModelInfo:!0,extent:!1}}}},{key:"interacting",get:function(){return this.navigating||k.isSome(this.activeTool)}},{key:"stationary",get:function(){return!this.animation&&!this.resizing&&(k.isNone(this.state)||this.state.stationary)}},{key:"qualityProfile",get:function(){return this._get("qualityProfile")||pa.getDefaultProfile()},set:function(Ia){pa.isValidProfile(Ia)&&(pa.apply(Ia,
this.qualitySettings),this._set("qualityProfile",Ia))}},{key:"slicePlane",set:function(Ia){k.isSome(this._stage)&&this._stage.renderView.setRenderParameters({slicePlane:Ia});if(k.isNone(Ia))this._set("slicePlane",null);else{var Ha=this.propertiesPool.get("slicePlane");R.copy(Ia,Ha);this._set("slicePlane",Ha)}}},{key:"typeSpecificPreconditionsReady",get:function(){return!!this.viewingMode}},{key:"resolution",get:function(){return null!=this.spatialReference?J.getResolutionForScale(this.scale,this.spatialReference):
0}},{key:"heightModelInfo",get:function(){const Ia=this.getDefaultHeightModelInfo();return null!=Ia?O.deriveUnitFromSR(Ia,this.spatialReference):null}},{key:"updating",get:function(){var Ia,Ha,Va;if(this.destroyed)return!1;let $a=0,db=this.layerViewManager.updating,gb=db?this.layerViewManager.updatingRemaining:0;this.allLayerViews.forEach(lb=>{lb.isFulfilled()?lb.updating&&(db=!0,lb.suspended||Ca.isSurfaceLayerView(lb)||(++gb,$a+=lb.updatingProgress)):++gb});for(const lb of[this.graphicsView,this.basemapView,
this._resourceController,this._stage,this.featureTiles,this.pointsOfInterest,this.environmentManager,this.overlay,this.featureTreeDebugger,this.toolViewManager,this.analysisViewManager])k.isSome(lb)&&lb.updating&&(gb+=.1,$a+=.05);for(const lb of[this.deconflictor,this.labeler,this.basemapTerrain])k.isSome(lb)&&lb.updating&&(++gb,$a+=lb.updatingProgress);(db=!!(db||0<gb||this.updatingHandles.updating||!this.ready||!this.stationary||this._createGraphicsViewController||null!=(Ia=this.inputManager)&&
Ia.hasPendingInputs||null!=(Ha=this.map)&&null!=(Va=Ha.allLayers)&&Va.some(lb=>!lb.isFulfilled())))?(this._numUpdating=Math.max(gb,this._numUpdating),$a+=this._numUpdating-gb):this._numUpdating=0;$a=0<this._numUpdating?$a/this._numUpdating:db?0:1;this._get("updatingProgress")!==$a&&(Ia=performance.now(),1>$a&&(Ha=Math.min((Ia-this._lastUpdateTime)/2E3,1),$a=this.updatingProgress*(1-Ha)+$a*Ha),this._set("updatingProgress",$a),this._lastUpdateTime=db&&1>$a?Ia:0);return db}},{key:"viewingMode",get:function(){var Ia,
Ha=this._predeterminedViewingMode;return k.isSome(Ha)?W.stringFromViewingMode(Ha):(Ha=this.spatialReference)?k.isSome(null==(Ia=this.defaultsFromMap)?void 0:Ia.viewingMode)&&Ha.equals(this.defaultsFromMap.spatialReference)?W.stringFromViewingMode(this.defaultsFromMap.viewingMode):Ta.isSpatialReferenceSupported(Ha,W.ViewingMode.Global)?"global":"local":"global"},set:function(Ia){this.ready?fb.error("#viewingMode","viewingMode cannot be set once view is ready"):Ia?this._override("viewingMode",Ia):void 0===
Ia&&this._clearOverride("viewingMode")}},{key:"resourceController",get:function(){return this._resourceController}},{key:"performanceInfo",get:function(){return new Ba(this)}},{key:"test",get:function(){return{takeScreenshot:Ia=>this._takeScreenshot(Ia)}}},{key:"_predeterminedViewingMode",get:function(){var Ia,Ha;const Va=this._isOverridden("viewingMode")?this._get("viewingMode"):null!=(Ia=this.map&&"initialViewProperties"in this.map?null==(Ha=this.map.initialViewProperties)?void 0:Ha.viewingMode:
null)?Ia:null;return k.isSome(Va)?W.viewingModeFromString(Va):null}}]);return rb}(N.BreakpointsOwner(V.DOMContainer(T.PopupView(H))));l.type="3d";c.__decorate([x.property()],l.prototype,"_userClippingArea",void 0);c.__decorate([x.property()],l.prototype,"_resourceController",void 0);c.__decorate([x.property()],l.prototype,"_stage",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"deconflictor",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"labeler",void 0);c.__decorate([x.property(G.owningCollectionProperty(P.AnalysesCollection,
"analyses"))],l.prototype,"analyses",void 0);c.__decorate([x.property({type:U,readOnly:!0,aliasOf:"state.animation"})],l.prototype,"animation",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"basemapTerrain",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"elevationProvider",void 0);c.__decorate([x.property({type:n,aliasOf:"stateManager.camera"})],l.prototype,"camera",void 0);c.__decorate([x.property({type:n,aliasOf:"stateManager.contentCamera"})],l.prototype,"contentCamera",
void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"canvas",void 0);c.__decorate([x.property({type:Fa,aliasOf:"stateManager.center"})],l.prototype,"center",void 0);c.__decorate([x.property({type:Sa})],l.prototype,"clippingArea",null);c.__decorate([x.property({type:ba.Constraints})],l.prototype,"constraints",void 0);c.__decorate([x.property({type:Sa,readOnly:!0})],l.prototype,"renderDataExtent",null);c.__decorate([x.property({type:Sa,readOnly:!0})],l.prototype,"dataExtent",null);c.__decorate([x.property({type:Sa,
readOnly:!0})],l.prototype,"groundAndLayersExtent",null);c.__decorate([x.property({value:null,type:aa})],l.prototype,"environment",null);c.__decorate([C.cast("environment")],l.prototype,"castEnvironment",null);c.__decorate([x.property({readOnly:!0})],l.prototype,"environmentManager",void 0);c.__decorate([x.property({type:Sa,aliasOf:"stateManager.extent"})],l.prototype,"extent",void 0);c.__decorate([x.property()],l.prototype,"floors",void 0);c.__decorate([x.property({readOnly:!0,aliasOf:"stateManager.screenCenter"})],
l.prototype,"screenCenter",void 0);c.__decorate([x.property({aliasOf:"stateManager.frustum"})],l.prototype,"frustum",void 0);c.__decorate([x.property({type:Number,readOnly:!0})],l.prototype,"fullOpacity",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"graphicsView",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"analysisViewManager",void 0);c.__decorate([x.property()],l.prototype,"groundView",void 0);c.__decorate([x.property({type:Boolean})],l.prototype,"initialExtentRequired",
null);c.__decorate([x.property()],l.prototype,"_defaultsFromMapSettings",null);c.__decorate([x.property({type:Boolean,readOnly:!0})],l.prototype,"interacting",null);c.__decorate([x.property()],l.prototype,"stationary",null);c.__decorate([x.property({aliasOf:"state.navigating"})],l.prototype,"navigating",void 0);c.__decorate([x.property()],l.prototype,"map",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"mapCoordsHelper",void 0);c.__decorate([x.property({aliasOf:"stateManager.padding"})],
l.prototype,"padding",void 0);c.__decorate([x.property({type:Ja.PointsOfInterest,readOnly:!0})],l.prototype,"pointsOfInterest",void 0);c.__decorate([x.property({type:ca.FeatureTileTree3D,readOnly:!0})],l.prototype,"featureTiles",void 0);c.__decorate([x.property()],l.prototype,"featureTreeDebugger",void 0);c.__decorate([x.property({type:Boolean})],l.prototype,"screenSizePerspectiveEnabled",void 0);c.__decorate([x.property({constructOnly:!0})],l.prototype,"deactivatedWebGLExtensions",void 0);c.__decorate([x.property({constructOnly:!0})],
l.prototype,"debugWebGLExtensions",void 0);c.__decorate([x.property({constructOnly:!0})],l.prototype,"renderCanvas",void 0);c.__decorate([x.property({constructOnly:!0})],l.prototype,"state",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"inputManager",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"stateManager",void 0);c.__decorate([x.property({type:["low","medium","high"]})],l.prototype,"qualityProfile",null);c.__decorate([x.property({type:ya,get(){let ob=this._get("qualitySettings");
ob||(ob=new ya,pa.apply(this.qualityProfile,ob));return ob}})],l.prototype,"qualitySettings",void 0);c.__decorate([x.property()],l.prototype,"slicePlane",null);c.__decorate([x.property({readOnly:!0})],l.prototype,"typeSpecificPreconditionsReady",null);c.__decorate([x.property({readOnly:!0})],l.prototype,"renderCoordsHelper",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"sceneIntersectionHelper",void 0);c.__decorate([x.property({type:Number,dependsOn:["scale","spatialReference"],readOnly:!0})],
l.prototype,"resolution",null);c.__decorate([x.property({type:Number,aliasOf:"stateManager.scale"})],l.prototype,"scale",void 0);c.__decorate([x.property()],l.prototype,"heightModelInfo",null);c.__decorate([x.property()],l.prototype,"spatialReference",void 0);c.__decorate([x.property({type:Boolean,constructOnly:!0})],l.prototype,"alphaCompositingEnabled",void 0);c.__decorate([x.property({constructOnly:!0})],l.prototype,"preserveDrawingBufferEnabled",void 0);c.__decorate([x.property({type:Boolean})],
l.prototype,"supersampleScreenshotsEnabled",void 0);c.__decorate([x.property({readOnly:!0})],l.prototype,"type",void 0);c.__decorate([x.property({type:ab})],l.prototype,"ui",void 0);c.__decorate([x.property({type:Boolean,readOnly:!0,dependsOn:"graphicsView.updating basemapView.updating basemapTerrain.updating layerViewManager.updating layerViewManager.updatingRemaining _resourceController.updating _stage.updating featureTiles.updating pointsOfInterest.updating environmentManager.updating overlay.updating updatingHandles.updating featureTreeDebugger.updating labeler.updating deconflictor.updating ready stationary inputManager.hasPendingInputs toolViewManager.updating analysisViewManager.updating".split(" ")})],
l.prototype,"updating",null);c.__decorate([x.property({type:Number,readOnly:!0,dependsOn:["updating"]})],l.prototype,"updatingProgress",void 0);c.__decorate([x.property({type:["global","local"]})],l.prototype,"viewingMode",null);c.__decorate([x.property({type:v,aliasOf:"stateManager.viewpoint"})],l.prototype,"viewpoint",void 0);c.__decorate([x.property({type:Number,aliasOf:"stateManager.zoom"})],l.prototype,"zoom",void 0);c.__decorate([x.property({type:wa})],l.prototype,"highlightOptions",void 0);
l=c.__decorate([D.subclass("esri.views.SceneView")],l);var mb;(function(ob){ob[ob.INCLUDE=0]="INCLUDE";ob[ob.EXCLUDE=1]="EXCLUDE"})(mb||(mb={}));const jb=F.create(),kb=z.createScreenPointArray(),ub=L.create();return l})},"esri/geometry/support/coordinateSystem":function(){define("exports ../../chunks/mat4 ../../chunks/vec3 ../../chunks/vec3f64 ../projectionEllipsoid ../SpatialReference ./Axis ../../chunks/boundedPlane ../../chunks/sphere".split(" "),function(a,b,c,n,l,u,v,m,h){function d(r){return{operations:r,
value:r.create()}}function e(r,y,f=d(r)){f.operations=r;r.copy(y,f.value);return f}function g(r,y,f,w){return r.operations.setAltitudeAt(r.value,y,f,w)}const p=2**50,t=n.create(),q={operations:null,value:null},k=n.create();a.altitudeAt=function(r,y){return r.operations.altitudeAt(r.value,y)};a.axisAt=function(r,y,f,w){return r.operations.axisAt(r.value,y,f,w)};a.closestPoint=function(r,y,f){return r.operations.closestPoint(r.value,y,f)};a.closestPointOnSilhouette=function(r,y,f){return r.operations.closestPointOnSilhouette(r.value,
y,f)};a.coordinateSystemFromOneAxisAndNormalVector=function(r,y,f,w,z){c.copy(f,r);c.copy(k,y);c.normalize(k,k);c.cross(w,k,f);c.cross(z,w,f)};a.create=function(r){const {value:y,operations:f}=r;return{operations:f,value:f.create(y)}};a.createFromOperations=d;a.createGlobal=function(r){return e(h.sphere,h.fromValues(0,0,0,l.getReferenceEllipsoid(r).radius))};a.createLocal=function(){return e(m.boundedPlane,m.fromValues([0,0,0],[p,0,0],[0,p,0]))};a.distanceToSilhouette=function(r,y){return r.operations.distanceToSilhouette(r.value,
y)};a.elevate=function(r,y,f){return r.operations.elevate(r.value,y,f.value)};a.fromValues=e;a.intersectRay=function(r,y,f){return r.operations.intersectRay(r.value,y,f)};a.intersectRayClosestSilhouette=function(r,y,f){return r.operations.intersectRayClosestSilhouette(r.value,y,f)};a.intersectsRay=function(r,y){return r.operations.intersectRay(r.value,y,null)};a.normalAt=function(r,y,f){return r.operations.axisAt(r.value,y,v.Axis.Z,f)};a.renderSRFromViewSR=function(r,y){return r?l.getSphericalPCPF(y):
y.isGeographic?u.PlateCarree:y};a.setAltitudeAt=g;a.setAltitudeOfTransformation=function(r,y,f,w){y!==w&&b.copy(w,y);c.set(t,w[12],w[13],w[14]);g(r,t,f,t);w[12]=t[0];w[13]=t[1];w[14]=t[2];return w};a.setExtent=function(r,y,f){r.operations.setExtent(r.value,y,f.value);return f};a.vectorCoordinates=function(r,y,f,w,z){z[0]=c.dot(r,y);z[1]=c.dot(r,f);z[2]=c.dot(r,w);return z};a.wrap=function(r,y){q.operations=r;q.value=y;return q};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/BreakpointsOwner":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/ArrayPool ../core/Handles ../core/maybe ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g){function p(k,r){return r?t[k].valueToClassName[r].split(" "):[]}const t={widthBreakpoint:{getValue(k){const r=k.viewSize[0];
k=k.breakpoints;const y=this.values;return r<=k.xsmall?y.xsmall:r<=k.small?y.small:r<=k.medium?y.medium:r<=k.large?y.large:y.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-width-xsmall esri-view-width-less-than-small esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",small:"esri-view-width-small esri-view-width-greater-than-xsmall esri-view-width-less-than-medium esri-view-width-less-than-large esri-view-width-less-than-xlarge",
medium:"esri-view-width-medium esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-less-than-large esri-view-width-less-than-xlarge",large:"esri-view-width-large esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-less-than-xlarge",xlarge:"esri-view-width-xlarge esri-view-width-greater-than-xsmall esri-view-width-greater-than-small esri-view-width-greater-than-medium esri-view-width-greater-than-large"}},
heightBreakpoint:{getValue(k){const r=k.viewSize[1];k=k.breakpoints;const y=this.values;return r<=k.xsmall?y.xsmall:r<=k.small?y.small:r<=k.medium?y.medium:r<=k.large?y.large:y.xlarge},values:{xsmall:"xsmall",small:"small",medium:"medium",large:"large",xlarge:"xlarge"},valueToClassName:{xsmall:"esri-view-height-xsmall esri-view-height-less-than-small esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",small:"esri-view-height-small esri-view-height-greater-than-xsmall esri-view-height-less-than-medium esri-view-height-less-than-large esri-view-height-less-than-xlarge",
medium:"esri-view-height-medium esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-less-than-large esri-view-height-less-than-xlarge",large:"esri-view-height-large esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-less-than-xlarge",xlarge:"esri-view-height-xlarge esri-view-height-greater-than-xsmall esri-view-height-greater-than-small esri-view-height-greater-than-medium esri-view-height-greater-than-large"}},
orientation:{getValue(k){k=k.viewSize;const r=this.values;return k[1]>=k[0]?r.portrait:r.landscape},values:{portrait:"portrait",landscape:"landscape"},valueToClassName:{portrait:"esri-view-orientation-portrait",landscape:"esri-view-orientation-landscape"}}},q={xsmall:544,small:768,medium:992,large:1200};a.BreakpointsOwner=k=>{k=function(r){function y(...w){w=r.call(this,...w)||this;w._breakpointsHandles=new l;w.orientation=null;w.widthBreakpoint=null;w.heightBreakpoint=null;w.breakpoints=q;return w}
b._inheritsLoose(y,r);var f=y.prototype;f.initialize=function(){this._breakpointsHandles.add(v.watch(()=>[this.breakpoints,this.size],()=>this._updateClassNames(),v.initial))};f.destroy=function(){this.destroyed||(this._removeActiveClassNames(),this._breakpointsHandles=u.destroyMaybe(this._breakpointsHandles))};f._updateClassNames=function(){if(this.container){var w=n.acquire(),z=n.acquire(),A=!1,x;for(x in t){const B=this[x],C=t[x].getValue({viewSize:this.size,breakpoints:this.breakpoints});B!==
C&&(A=!0,this[x]=C,p(x,B).forEach(D=>z.push(D)),p(x,C).forEach(D=>w.push(D)))}A&&(this._applyClassNameChanges(w,z),n.release(w),n.release(z))}};f._applyClassNameChanges=function(w,z){const A=this.container;A&&(z.forEach(x=>A.classList.remove(x)),w.forEach(x=>A.classList.add(x)))};f._removeActiveClassNames=function(){const w=this.container;if(w)for(var z in t)p(z,this[z]).forEach(A=>w.classList.remove(A))};b._createClass(y,[{key:"breakpoints",set:function(w){var z=this._get("breakpoints");if(w!==z){z=
(z=w)&&z.xsmall<z.small&&z.small<z.medium&&z.medium<z.large;if(!z){const A=JSON.stringify(q,null,2);console.warn("provided breakpoints are not valid, using defaults:"+A)}w=z?w:q;this._set("breakpoints",{...w})}}}]);return y}(k);c.__decorate([m.property()],k.prototype,"breakpoints",null);c.__decorate([m.property()],k.prototype,"orientation",void 0);c.__decorate([m.property()],k.prototype,"widthBreakpoint",void 0);c.__decorate([m.property()],k.prototype,"heightBreakpoint",void 0);return k=c.__decorate([g.subclass("esri.views.BreakpointsOwner")],
k)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/DOMContainer":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/domUtils ../core/reactiveUtils ../core/scheduling ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./overlay/ViewOverlay ../widgets/Popup".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,
p){function t(k){k&&(n.empty(k),k.parentNode&&k.parentNode.removeChild(k))}const q=[0,0];a.DOMContainer=k=>{k=function(r){function y(...w){var z=r.call(this,...w)||this;z._freqInfo={freq:16,time:750};z._overlayRenderTaskHandle=null;z.height=0;z.position=null;z.resizing=!1;z.root=null;z.surface=null;z.suspended=!0;z.ui=null;z.userContent=null;z.width=0;z.widthBreakpoint=null;z.handles.add([l.watch(()=>z.cursor,A=>{const {surface:x}=b._assertThisInitialized(z);x&&x.setAttribute("data-cursor",A)}),l.watch(()=>
z.interacting,A=>{const {surface:x}=b._assertThisInitialized(z);x&&x.setAttribute("data-interacting",A.toString())})]);return z}b._inheritsLoose(y,r);var f=y.prototype;f.initialize=function(){this.handles.add(l.watch(()=>this.ui,(w,z)=>this._handleUIChange(w,z)));this._wireUI(this.ui);this.handles.add([this.on("focus",()=>this.notifyChange("focused")),this.on("blur",()=>this.notifyChange("focused"))])};f.destroy=function(){this.destroyed||(this.ui&&(this.ui.destroy(),this.ui=null),this.popup&&!this.popup.destroyed&&
this.popup.destroy(),this.container=null)};f.blur=function(){this.surface&&this.surface.blur()};f.focus=function(){this.surface&&this.surface.focus()};f.pageToContainer=function(w,z,A){const x=this.position;w-=x[0];z-=x[1];A?(A[0]=w,A[1]=z):A=[w,z];return A};f.containerToPage=function(w,z,A){const x=this.position;w+=x[0];z+=x[1];A?(A[0]=w,A[1]=z):A=[w,z];return A};f._handleUIChange=function(w,z){z&&(this.handles.remove("ui"),z.destroy());w&&this._wireUI(w);this._set("ui",w)};f._wireUI=function(w){this.handles.remove("ui");
w&&(w.view=this,this.handles.add([l.watch(()=>this.root,z=>{if(z){{const A=document.createElement("div");z.appendChild(A);z=A}}else z=null;w.container=z},l.initial),l.watch(()=>this.popup,(z,A)=>{A&&w.remove(A,"popup");z&&(z.view=w.view,w.add(z,{key:"popup",position:"manual"}))},l.initial)],"ui"))};f._stopMeasuring=function(){this.handles.remove("measuring");this._get("resizing")&&this._set("resizing",!1)};f._startMeasuring=function(){const w=this._freqInfo;w.freq=16;w.time=750;this.handles.add([(()=>
{const z=()=>{w.freq=16;w.time=750};window.addEventListener("resize",z);return{remove(){window.removeEventListener("resize",z)}}})(),u.addFrameTask({prepare:z=>{const A=this._measure(),x=this._freqInfo;x.time+=z.deltaTime;A&&(x.freq=16,this._get("resizing")||this._set("resizing",!0));x.time<x.freq||(x.time=0,this._position()||A?x.freq=16:x.freq=Math.min(750,2*x.freq),!A&&512<=x.freq&&this._get("resizing")&&this._set("resizing",!1))}})],"measuring");this._measure();this._position()};f._measure=function(){var w=
this.container;const z=w?w.clientWidth:0;w=w?w.clientHeight:0;if(0===z||0===w)return this.suspended||this._set("suspended",!0),!1;const A=this.width,x=this.height;if(z===A&&w===x)return this.suspended&&this._set("suspended",!1),!1;this._set("width",z);this._set("height",w);this.suspended&&this._set("suspended",!1);this.emit("resize",{oldWidth:A,oldHeight:x,width:z,height:w});return!0};f._position=function(){var w=this.container;const z=this.position;{const A=(w.ownerDocument||window.document).defaultView;
w=w.getBoundingClientRect();q[0]=w.left+A.pageXOffset;q[1]=w.top+A.pageYOffset}return z&&q[0]===z[0]&&q[1]===z[1]?!1:(this._set("position",[q[0],q[1]]),!0)};f.forceDOMReadyCycle=function(){};b._createClass(y,[{key:"container",set:function(w){var z=this._get("container");if(z!==w)if(this.handles.remove("dom-size"),this._stopMeasuring(),z&&(z.classList.remove("esri-view"),this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null),this.overlay.destroy(),
this._set("overlay",null),t(this.root),this._set("root",null),n.reparent(this.userContent,z),t(this.userContent),this._set("userContent",null)),w){w.classList.add("esri-view");z=document.createElement("div");z.className="esri-view-user-storage";n.reparent(w,z);w.appendChild(z);this._set("userContent",z);z=document.createElement("div");z.className="esri-view-root";w.insertBefore(z,w.firstChild);this._set("root",z);const A=document.createElement("div");A.className="esri-view-surface";A.setAttribute("role",
"application");A.tabIndex=0;z.appendChild(A);this._set("surface",A);const x=new g;z.appendChild(x.surface);this._set("overlay",x);l.watch(()=>x.needsRender,B=>{B&&!this._overlayRenderTaskHandle?this._overlayRenderTaskHandle=u.addFrameTask({render:()=>{this.overlay.render()}}):this._overlayRenderTaskHandle&&(this._overlayRenderTaskHandle.remove(),this._overlayRenderTaskHandle=null)});this.forceDOMReadyCycle();this.handles.add(l.watch(()=>this.size,B=>{const [C,D]=B;C>=document.body.clientWidth||D>=
document.body.clientHeight?A.classList.add("esri-view-surface--inset-outline"):A.classList.remove("esri-view-surface--inset-outline")},l.initial),"dom-size");this._set("container",w);this._startMeasuring()}else this._set("width",0),this._set("height",0),this._set("position",null),this._set("suspended",!0),this._set("surface",null),this._set("container",null)}},{key:"focused",get:function(){const w=document.activeElement===this.surface;return document.hasFocus()&&w}},{key:"popup",get:function(){return this._get("popup")||
new p({view:this})},set:function(w){const z=this._get("popup");z&&z!==w&&z.destroy();this._set("popup",w)}},{key:"size",get:function(){return[this.width,this.height]}}]);return y}(k);c.__decorate([v.property({value:null,cast:r=>n.byId(r)})],k.prototype,"container",null);c.__decorate([v.property({readOnly:!0})],k.prototype,"focused",null);c.__decorate([v.property({readOnly:!0})],k.prototype,"height",void 0);c.__decorate([v.property({type:p})],k.prototype,"popup",null);c.__decorate([v.property({type:g})],
k.prototype,"overlay",void 0);c.__decorate([v.property({readOnly:!0})],k.prototype,"position",void 0);c.__decorate([v.property({readOnly:!0})],k.prototype,"resizing",void 0);c.__decorate([v.property({readOnly:!0})],k.prototype,"root",void 0);c.__decorate([v.property({value:null,readOnly:!0})],k.prototype,"size",null);c.__decorate([v.property({readOnly:!0})],k.prototype,"surface",void 0);c.__decorate([v.property({readOnly:!0})],k.prototype,"suspended",void 0);c.__decorate([v.property()],k.prototype,
"ui",void 0);c.__decorate([v.property({readOnly:!0})],k.prototype,"userContent",void 0);c.__decorate([v.property({readOnly:!0})],k.prototype,"width",void 0);c.__decorate([v.property()],k.prototype,"widthBreakpoint",void 0);return k=c.__decorate([e.subclass("esri.views.DOMContainer")],k)};a.isDOMContainer=function(k){return k&&"focus"in k};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/overlay/ViewOverlay":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Collection ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../core/support/WatchUpdatingTracking ../../libs/maquette/projection ../../libs/maquette/projector".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){c=function(p){function t(){var k=p.apply(this,arguments)||this;k.items=new n;k._watchUpdatingTracking=new d.WatchUpdatingTracking;k._callbacks=new Map;k._projector=g.createProjector();k._hiddenProjector=g.createProjector();return k}a._inheritsLoose(t,p);var q=t.prototype;q.initialize=function(){const k=document.createElement("div");k.className="esri-overlay-surface";this._set("surface",k);this._hiddenSurface=document.createElement("div");this._hiddenSurface.setAttribute("style",
"visibility: hidden;");k.appendChild(this._hiddenSurface);this._watchUpdatingTracking.addOnCollectionChange(()=>this.items,r=>{for(const y of r.added){const f=()=>y.render();this._callbacks.set(y,f);this._projector.append(this.surface,f)}for(const y of r.removed)r=this._projector.detach(this._callbacks.get(y)),this.surface.removeChild(r.domNode),this._callbacks.delete(y)})};q.addItem=function(k){this.items.add(k)};q.removeItem=function(k){this.items.remove(k)};q.destroy=function(){this.items.removeAll();
this._callbacks.forEach(k=>this._projector.detach(k));this._projector=this._callbacks=null;this._watchUpdatingTracking.destroy()};q.render=function(){this._projector.renderNow()};q.computeBoundingRect=function(k){const r=this._hiddenSurface,y=this._hiddenProjector;let f=null;const w=()=>f=k.render();y.append(r,w);y.renderNow();const z={left:0,top:0,right:0,bottom:0};if(f&&f.domNode){const A=f.domNode.getBoundingClientRect();z.left=A.left;z.top=A.top;z.right=A.right;z.bottom=A.bottom}for(y.detach(w);r.firstChild;)r.removeChild(r.firstChild);
return z};q.overlaps=function(k,r){k=this.computeBoundingRect(k);r=this.computeBoundingRect(r);return Math.max(k.left,r.left)<=Math.min(k.right,r.right)&&Math.max(k.top,r.top)<=Math.min(k.bottom,r.bottom)};q.renderCanvas=function(k){if(this.items.some(y=>y.visible)){var r=k.getContext("2d");r.save();r.font=`10px ${getComputedStyle(this.surface).fontFamily}`;this.items.forEach(y=>{r.save();y.renderCanvas(r);r.restore()});r.restore()}};a._createClass(t,[{key:"needsRender",get:function(){return 0<this.items.length}},
{key:"hasVisibleItems",get:function(){return this.items.some(k=>k.visible)}}]);return t}(c);b.__decorate([l.property({readOnly:!0})],c.prototype,"surface",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"items",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"needsRender",null);b.__decorate([l.property({readOnly:!0})],c.prototype,"_watchUpdatingTracking",void 0);b.__decorate([l.property({readOnly:!0,aliasOf:"_watchUpdatingTracking.updating"})],c.prototype,"updating",void 0);
return c=b.__decorate([h.subclass("esri.views.overlay.ViewOverlay")],c)})},"esri/widgets/Popup":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/Collection ../core/events ../core/Handles ../core/Logger ../core/maybe ../core/reactiveUtils ../core/throttle ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Feature ./Spinner ./Widget ./Feature/support/FeatureContentMixin ./Popup/PopupViewModel ./support/Heading ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/decorators/vmEvent ./support/jsxFactory ./support/widgetUtils ../intl/substitute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F){function G(R,M){return void 0===M?`${"esri-popup"}__${R}`:`${"esri-popup"}__${R}-${M}`}const O={buttonEnabled:!0,position:"auto",breakpoint:{width:544}},K=v.getLogger("esri.widgets.Popup"),L={closeButton:!0,featureNavigation:!0};c=function(R){function M(I,P){var N=R.call(this,I,P)||this;N._blurClose=!1;N._blurContainer=!1;N._containerNode=null;N._mainContainerNode=null;N._featureMenuNode=null;N._actionsMenuNode=null;N._focusClose=!1;
N._focusContainer=!1;N._focusDockButton=!1;N._focusFeatureMenuButton=!1;N._focusActionsMenuButton=!1;N._focusFirstFeature=!1;N._focusFirstAction=!1;N._handles=new u;N._pointerOffsetInPx=16;N._spinner=null;N._feature=null;N._featureMenuIntersectionObserverCallback=([V])=>{null!=V&&V.isIntersecting&&N.viewModel.featurePage++};N._featureMenuIntersectionObserver=new IntersectionObserver(N._featureMenuIntersectionObserverCallback,{root:window.document});N._displaySpinnerThrottled=d.throttle(()=>N._displaySpinner(),
0);N.actions=null;N.alignment="auto";N.autoCloseEnabled=null;N.autoOpenEnabled=null;N.defaultPopupTemplateEnabled=null;N.content=null;N.collapsed=!1;N.collapseEnabled=!0;N.dockEnabled=!1;N.featureCount=null;N.featureMenuOpen=!1;N.features=null;N.goToOverride=null;N.headingLevel=2;N.highlightEnabled=null;N.location=null;N.label=void 0;N.maxInlineActions=3;N.messages=null;N.messagesCommon=null;N.promises=null;N.selectedFeature=null;N.selectedFeatureIndex=null;N.spinnerEnabled=!0;N.title=null;N.updateLocationEnabled=
null;N.view=null;N.viewModel=new z;N.visible=null;N.visibleElements={...L};N._addSelectedFeatureIndexHandle();N.own([h.watch(()=>{var V;return null==(V=N.viewModel)?void 0:V.screenLocation},()=>N._positionContainer()),h.watch(()=>{var V;return[null==(V=N.viewModel)?void 0:V.active,N.dockEnabled]},()=>N._toggleScreenLocationEnabled()),h.watch(()=>{var V;return null==(V=N.viewModel)?void 0:V.screenLocation},(V,S)=>{!!V!==!!S&&N.reposition()}),h.watch(()=>{var V,S,T,H,U,W;return[null==(V=N.viewModel)?
void 0:null==(S=V.view)?void 0:S.padding,null==(T=N.viewModel)?void 0:null==(H=T.view)?void 0:H.size,null==(U=N.viewModel)?void 0:U.active,null==(W=N.viewModel)?void 0:W.location,N.alignment]},()=>N.reposition()),h.watch(()=>N.spinnerEnabled,V=>N._spinnerEnabledChange(V)),h.watch(()=>{var V,S;return null==(V=N.viewModel)?void 0:null==(S=V.view)?void 0:S.size},(V,S)=>N._updateDockEnabledForViewSize(V,S)),h.watch(()=>{var V;return null==(V=N.viewModel)?void 0:V.view},(V,S)=>N._viewChange(V,S)),h.watch(()=>
{var V,S;return null==(V=N.viewModel)?void 0:null==(S=V.view)?void 0:S.ready},(V,S)=>N._viewReadyChange(V,S)),h.watch(()=>{var V,S;return[null==(V=N.viewModel)?void 0:V.waitingForResult,null==(S=N.viewModel)?void 0:S.location]},()=>{N._hideSpinner();N._displaySpinnerThrottled()}),h.watch(()=>{var V,S,T,H;return[null==(V=N.selectedFeatureWidget)?void 0:null==(S=V.viewModel)?void 0:S.title,null==(T=N.selectedFeatureWidget)?void 0:null==(H=T.viewModel)?void 0:H.state]},()=>N._setTitleFromFeatureWidget()),
h.watch(()=>{var V,S,T,H;return[null==(V=N.selectedFeatureWidget)?void 0:null==(S=V.viewModel)?void 0:S.content,null==(T=N.selectedFeatureWidget)?void 0:null==(H=T.viewModel)?void 0:H.state]},()=>N._setContentFromFeatureWidget()),h.when(()=>!N.collapsed,()=>{var V,S;"xsmall"===(null==(V=N.viewModel)?void 0:null==(S=V.view)?void 0:S.widthBreakpoint)&&N.viewModel.active&&N.collapseEnabled&&N.viewModel.centerAtLocation()}),h.on(()=>{var V;return null==(V=N.viewModel)?void 0:V.allActions},"change",()=>
N._watchActions()),h.watch(()=>{var V;return null==(V=N.viewModel)?void 0:V.allActions},()=>N._watchActions(),h.initial),h.watch(()=>{var V;return null==(V=N.viewModel)?void 0:V.featureViewModels},()=>N._featureMenuViewportScrollTop())]);return N}a._inheritsLoose(M,R);var J=M.prototype;J.destroy=function(){var I,P;this._destroySelectedFeatureWidget();this._destroySpinner();null==(I=this._handles)?void 0:I.destroy();this._unobserveFeatureMenuObserver();null==(P=this._featureMenuIntersectionObserver)?
void 0:P.disconnect();this._handles=null};J.castVisibleElements=function(I){return{...L,...I}};J.blur=function(){const {active:I}=this.viewModel;I||K.warn("Popup can only be blurred when currently active.");this.visibleElements.closeButton?this._blurClose=!0:this._blurContainer=!0;this.scheduleRender()};J.clear=function(){this.viewModel.clear()};J.close=function(){this.visible=!1};J.fetchFeatures=function(I,P){return this.viewModel.fetchFeatures(I,P)};J.focus=function(){const {active:I}=this.viewModel;
I||K.warn("Popup can only be focused when currently active.");this.visibleElements.closeButton?this._focusClose=!0:this._focusContainer=!0;this.scheduleRender()};J.next=function(){return this.viewModel.next()};J.open=function(I){var P,N;this._handles.remove("selected-index");const V={collapsed:I?!!I.collapsed:!1,actionsMenuOpen:I?!!I.actionsMenuOpen:!1,featureMenuOpen:I?!!I.featureMenuOpen:!1};"xsmall"===(null==(P=this.viewModel)?void 0:null==(N=P.view)?void 0:N.widthBreakpoint)&&(V.collapsed=!0);
this.set(V);this.viewModel.open(I);this._shouldFocus(I);this._addSelectedFeatureIndexHandle()};J.previous=function(){return this.viewModel.previous()};J.reposition=function(){this.renderNow();this._positionContainer();this._setCurrentAlignment()};J.triggerAction=function(I){this.viewModel.triggerAction(I)};J.render=function(){var I,P,N,V;const {actionsMenuOpen:S,dockEnabled:T,featureMenuVisible:H,dividedActions:U,currentAlignment:W,currentDockPosition:Q}=this,{active:X}=this.viewModel;var {menuActions:ba}=
U;ba=X&&1<ba.length&&S;const aa=null==(I=this.selectedFeature)?void 0:null==(P=I.layer)?void 0:P.title;I=null==(N=this.selectedFeature)?void 0:null==(V=N.layer)?void 0:V.id;return D.tsx("div",{class:this.classes("esri-popup",{["esri-popup--aligned-top-center"]:"top-center"===W,["esri-popup--aligned-bottom-center"]:"bottom-center"===W,["esri-popup--aligned-top-left"]:"top-left"===W,["esri-popup--aligned-bottom-left"]:"bottom-left"===W,["esri-popup--aligned-top-right"]:"top-right"===W,["esri-popup--aligned-bottom-right"]:"bottom-right"===
W,["esri-popup--is-docked"]:X&&T,["esri-popup--shadow"]:X&&!T,["esri-popup--is-docked-top-left"]:"top-left"===Q,["esri-popup--is-docked-top-center"]:"top-center"===Q,["esri-popup--is-docked-top-right"]:"top-right"===Q,["esri-popup--is-docked-bottom-left"]:"bottom-left"===Q,["esri-popup--is-docked-bottom-center"]:"bottom-center"===Q,["esri-popup--is-docked-bottom-right"]:"bottom-right"===Q,["esri-popup--feature-menu-open"]:H,["esri-popup--actions-menu-open"]:ba}),role:"presentation","data-layer-title":aa,
"data-layer-id":I,bind:this,afterCreate:this._positionContainer,afterUpdate:this._positionContainer},X?[this.renderMainContainer(),this.renderPointer()]:null)};J.renderLoadingIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-loading-indicator","esri-rotating")})};J.renderNavigationLoading=function(){const {messagesCommon:I}=this;return this.viewModel.pendingPromisesCount?D.tsx("div",{key:G("loading-container"),role:"presentation",class:"esri-popup__loading-container",
"aria-label":I.loading,title:I.loading},this.renderLoadingIcon()):null};J.renderPreviousIcon=function(){const I=E.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-right-triangle-arrow"]:I,["esri-popup__pagination-previous-icon--rtl"]:I,["esri-icon-left-triangle-arrow"]:!I,["esri-popup__pagination-previous-icon"]:!I})})};J.renderPreviousButton=function(){const {messages:I}=this;return D.tsx("div",{role:"button",tabIndex:0,bind:this,
onclick:this._previous,onkeydown:this._previous,class:this.classes("esri-popup__button","esri-popup__pagination-previous"),"aria-label":I.previous,title:I.previous},this.renderPreviousIcon())};J.renderNextIcon=function(){const I=E.isRTL(this.container);return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon",{["esri-icon-left-triangle-arrow"]:I,["esri-popup__pagination-next-icon--rtl"]:I,["esri-icon-right-triangle-arrow"]:!I,["esri-popup__pagination-next-icon"]:!I})})};J.renderNextButton=
function(){const {messages:I}=this;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._next,onkeydown:this._next,class:this.classes("esri-popup__button","esri-popup__pagination-next"),"aria-label":I.next,title:I.next},this.renderNextIcon())};J.renderFeatureMenuButton=function(){const {featureMenuOpen:I,featureMenuId:P,messagesCommon:N}=this,{featureCount:V,selectedFeatureIndex:S}=this.viewModel;return D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._toggleFeatureMenu,
onkeydown:this._toggleFeatureMenu,afterCreate:this._focusFeatureMenuButtonNode,afterUpdate:this._focusFeatureMenuButtonNode,class:this.classes("esri-popup__button","esri-popup__feature-menu-button"),"aria-haspopup":"true","aria-controls":P,"aria-expanded":I.toString(),"aria-label":N.menu,title:N.menu},this._getPageText(V,S))};J.renderNavigationButtons=function(){return this.featureNavigationVisible?[this.renderPreviousButton(),this.renderNavigationLoading()||this.renderFeatureMenuButton(),this.renderNextButton()]:
null};J.renderDockIcon=function(){const {dockEnabled:I}=this,P=this._wouldDockTo();return D.tsx("span",{"aria-hidden":"true",class:this.classes({["esri-icon-minimize"]:I,["esri-popup__icon--dock-icon"]:!I,["esri-icon-dock-right"]:!I&&("top-right"===P||"bottom-right"===P),["esri-icon-dock-left"]:!I&&("top-left"===P||"bottom-left"===P),["esri-icon-maximize"]:!I&&"top-center"===P,["esri-icon-dock-bottom"]:!I&&"bottom-center"===P},"esri-popup__icon")})};J.renderDockButton=function(){var I,P,N;const {dockEnabled:V,
messages:S}=this,T=null==(I=this.viewModel)?void 0:null==(P=I.view)?void 0:P.widthBreakpoint;I=V?S.undock:S.dock;return"xsmall"!==T&&null!=(N=this.dockOptions)&&N.buttonEnabled?D.tsx("div",{role:"button","aria-label":I,title:I,tabIndex:0,bind:this,onclick:this._toggleDockEnabled,onkeydown:this._toggleDockEnabled,afterCreate:this._focusDockButtonNode,afterUpdate:this._focusDockButtonNode,class:this.classes("esri-popup__button","esri-popup__button--dock")},this.renderDockIcon()):null};J.renderTitle=
function(){const {title:I}=this.viewModel,{titleId:P,collapsible:N,contentCollapsed:V,messagesCommon:S}=this;var T={["esri-popup__header-container--button"]:N};const H=D.tsx(A.Heading,{level:this.headingLevel,class:"esri-popup__header-title",innerHTML:I});T=N?D.tsx("button",{key:`${I}--collapsible`,id:P,title:V?S.expand:S.collapse,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",T),"aria-expanded":V?"false":"true",onclick:this._toggleCollapsed,
type:"button"},H):D.tsx("div",{key:I,id:P,bind:this,enterAnimation:this._createFeatureUpdatedAnimation(),class:this.classes("esri-popup__header-container",T)},H);return I?T:null};J.renderCloseIcon=function(){return D.tsx("span",{"aria-hidden":"true",class:this.classes("esri-popup__icon","esri-icon-close")})};J.renderCloseButton=function(){const {visibleElements:I,messagesCommon:P}=this;return I.closeButton?D.tsx("div",{role:"button",tabIndex:0,bind:this,onclick:this._close,onkeydown:this._close,class:"esri-popup__button",
"aria-label":P.close,title:P.close,afterCreate:this._closeButtonNodeUpdated,afterUpdate:this._closeButtonNodeUpdated},this.renderCloseIcon()):null};J.renderHeader=function(){return D.tsx("header",{class:"esri-popup__header"},this.renderTitle(),D.tsx("div",{class:"esri-popup__header-buttons"},this.renderDockButton(),this.renderCloseButton()))};J.renderContentContainer=function(){const {contentId:I,hasContent:P,contentCollapsed:N}=this,{content:V}=this.viewModel;return P&&!N?D.tsx("article",{key:V,
enterAnimation:this._createFeatureUpdatedAnimation(),id:I,class:"esri-popup__content"},this.renderContent()):null};J.renderActionsMenuButton=function(){const {actionsMenuId:I,actionsMenuButtonId:P,actionsMenuOpen:N,dividedActions:V,messagesCommon:S}=this,T=N?S.close:S.open,{menuActions:H}=V;return H.length?D.tsx("div",{key:G("actions-menu-button"),class:this.classes("esri-popup__button","esri-popup__actions-menu-button"),role:"button",id:P,"aria-haspopup":"true","aria-controls":N?I:null,tabIndex:0,
bind:this,onclick:this._toggleActionsMenu,onkeydown:this._toggleActionsMenu,afterCreate:this._focusActionsMenuButtonNode,afterUpdate:this._focusActionsMenuButtonNode,"aria-label":T,title:T},D.tsx("span",{"aria-hidden":"true",class:"esri-icon-handle-horizontal"})):null};J.renderMenuActions=function(){const {actionsMenuId:I,actionsMenuButtonId:P,actionsMenuOpen:N,dividedActions:V}=this,{menuActions:S}=V;return S.length&&N?D.tsx("ul",{id:I,role:"menu","aria-labelledby":P,key:G("actions"),class:"esri-popup__actions",
bind:this,onkeyup:this._handleActionMenuKeyup,afterCreate:this._actionsMenuNodeUpdated,afterUpdate:this._actionsMenuNodeUpdated},S.toArray().map(T=>this.renderAction({action:T,type:"menu-item"}))):null};J.renderInlineActions=function(){const {inlineActions:I}=this.dividedActions;return!!I.length&&I.toArray().map(P=>this.renderAction({action:P,type:"inline"}))};J.renderInlineActionsContainer=function(){const {inlineActions:I,menuActions:P}=this.dividedActions,N=!!I.length,V=!!P.length;return N||V?
D.tsx("div",{key:"inline-actions-container","data-inline-actions":N.toString(),"data-menu-actions":V.toString(),class:"esri-popup__inline-actions-container"},this.renderInlineActions(),this.renderActionsMenuButton(),this.renderMenuActions()):null};J.renderNavigation=function(){return this.featureNavigationVisible?D.tsx("section",{key:G("navigation"),class:this.classes("esri-popup__navigation")},this.renderNavigationButtons()):null};J.renderFooter=function(){const {featureNavigationVisible:I,dividedActions:P}=
this,{inlineActions:N,menuActions:V}=P,S=!!N.length,T={["esri-popup__footer--has-pagination"]:I,["esri-popup__footer--has-actions"]:S,["esri-popup__footer--has-actions-menu"]:!!V.length};return I||S?D.tsx("div",{key:G("feature-buttons"),class:this.classes("esri-popup__footer",T)},this.renderInlineActionsContainer(),this.renderNavigation()):null};J.renderFeatureMenuContainer=function(){var {messages:I}=this;const {featureViewModels:P,isLoadingFeature:N}=this.viewModel;I=F.substitute(I.selectedFeatures,
{total:P.length});return D.tsx("section",{key:G("menu"),class:"esri-popup__feature-menu"},D.tsx("strong",{class:"esri-popup__feature-menu-header"},I),D.tsx("nav",{bind:this,class:"esri-popup__feature-menu-viewport","data-node-ref":"_featureMenuViewportNode",afterCreate:E.storeNode},this.renderFeatureMenu(),D.tsx("div",{class:"esri-popup__feature-menu-observer",bind:this,afterCreate:this._featureMenuIntersectionObserverCreated}),N?D.tsx("div",{class:"esri-popup__feature-menu-loader"},this.renderLoadingIcon()):
null))};J.renderPointer=function(){return this.dockEnabled?null:D.tsx("div",{key:G("pointer"),class:"esri-popup__pointer",role:"presentation"},D.tsx("div",{class:this.classes("esri-popup__pointer-direction","esri-popup--shadow")}))};J.renderMainContainer=function(){const {dockEnabled:I,currentAlignment:P,currentDockPosition:N,titleId:V,contentId:S,collapsible:T,hasContent:H,contentCollapsed:U,visibleElements:W}=this,{title:Q}=this.viewModel,X="bottom-left"===P||"bottom-center"===P||"bottom-right"===
P||"top-left"===N||"top-center"===N||"top-right"===N,ba="top-left"===P||"top-center"===P||"top-right"===P||"bottom-left"===N||"bottom-center"===N||"bottom-right"===N;return D.tsx("div",{class:this.classes("esri-popup__main-container","esri-widget",{["esri-popup--shadow"]:I,["esri-popup--is-collapsible"]:T,["esri-popup--is-collapsed"]:U}),tabIndex:W.closeButton?null:-1,role:"dialog","aria-labelledby":Q?V:"","aria-describedby":H&&!U?S:"",bind:this,onkeyup:this._handleMainKeyup,afterCreate:this._mainContainerNodeUpdated,
afterUpdate:this._mainContainerNodeUpdated},X?this.renderFooter():null,X?this.renderFeatureMenuContainer():null,this.renderHeader(),this.renderContentContainer(),ba?this.renderFooter():null,ba?this.renderFeatureMenuContainer():null)};J.renderContent=function(){var I;const P=null==(I=this.viewModel)?void 0:I.content;return P?"string"===typeof P?D.tsx("div",{key:P,innerHTML:P}):this.renderNodeContent(P):null};J.renderActionText=function(I){return D.tsx("span",{key:"text",class:"esri-popup__action-text"},
I)};J.renderActionIcon=function(I){const P=this._getActionClass(I),N=this._getActionImage(I),V={["esri-icon-loading-indicator"]:I.active,["esri-rotating"]:I.active,["esri-popup__icon"]:!!P,["esri-popup__action-image"]:!I.active&&!!N};P&&(V[P]=!I.active);return D.tsx("span",{key:"icon","aria-hidden":"true",class:this.classes("esri-popup__icon",V),styles:this._getIconStyles(N)})};J.renderAction=function(I){const {action:P,type:N}=I;I=this._getActionTitle(P);const V={["esri-popup__action"]:"toggle"!==
P.type,["esri-popup__action-toggle"]:"toggle"===P.type,["esri-popup__action-toggle--on"]:"toggle"===P.type&&P.value,["esri-popup__button--disabled"]:P.disabled},S=[this.renderActionIcon(P),this.renderActionText(I)];I="menu-item"===N?D.tsx("li",{key:P.uid,role:"menuitem",tabIndex:0,title:I,"aria-label":I,class:this.classes("esri-popup__button",V),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":P.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},S):D.tsx("div",{key:P.uid,
role:"button",tabIndex:0,title:I,"aria-label":I,class:this.classes("esri-popup__button",V),onkeyup:this._handleActionMenuItemKeyup,bind:this,"data-action-uid":P.uid,onclick:this._triggerAction,onkeydown:this._triggerAction},S);return P.visible?I:null};J.renderFeatureMenuItem=function(I,P){const {messages:N,messagesCommon:V}=this,{selectedFeatureIndex:S,selectedFeatureViewModel:T}=this.viewModel;var H=I===T;const U={["esri-popup__feature-menu-item--selected"]:H};H=H?D.tsx("span",{key:G(`feature-menu-selected-feature-${S}`),
title:N.selectedFeature,"aria-label":N.selectedFeature,class:"esri-icon-check-mark"}):null;I=D.tsx("span",{innerHTML:I.title||V.untitled});return D.tsx("li",{role:"menuitem",tabIndex:-1,key:G(`feature-menu-feature-${S}`),class:this.classes(U,"esri-popup__feature-menu-item"),bind:this,"data-feature-index":P,onblur:this._removeActiveFeature,onfocus:this._setActiveFeature,onkeyup:this._handleFeatureMenuItemKeyup,onclick:this._selectFeature,onkeydown:this._selectFeature,onmouseover:this._setActiveFeature,
onmouseleave:this._removeActiveFeature},D.tsx("span",{class:"esri-popup__feature-menu-title"},I,H))};J.renderFeatureMenu=function(){const {featureMenuId:I}=this,{featureViewModels:P}=this.viewModel;return 1<P.length?D.tsx("ol",{class:"esri-popup__feature-menu-list",id:I,bind:this,afterCreate:this._featureMenuNodeUpdated,afterUpdate:this._featureMenuNodeUpdated,onkeyup:this._handleFeatureMenuKeyup,role:"menu"},P.filter(N=>!!N.graphic).map((N,V)=>this.renderFeatureMenuItem(N,V))):null};J._getActionTitle=
function(I){const {messages:P,selectedFeature:N,messagesCommon:V}=this,{id:S}=I,T=null==N?void 0:N.attributes;return(I="zoom-to-feature"===S?F.substitute(I.title,{messages:P}):"remove-selected-feature"===S?F.substitute(I.title,{messages:V}):"zoom-to-clustered-features"===S?F.substitute(I.title,{messages:P}):"browse-clustered-features"===S?F.substitute(I.title,{messages:P}):I.title)&&T?F.substitute(I,T):I};J._getActionClass=function(I){var {selectedFeature:P}=this;P=null==P?void 0:P.attributes;const {className:N,
image:V}=I;return(I=V||N?N:"esri-icon-default-action")&&P?F.substitute(I,P):I};J._getActionImage=function(I){var {selectedFeature:P}=this;P=null==P?void 0:P.attributes;({image:I}=I);return I&&P?F.substitute(I,P):I};J._createFeatureUpdatedAnimation=function(){return E.cssTransition("enter","esri-popup--feature-updated")};J._getInlineActionCount=function(){const {maxInlineActions:I,featureNavigationVisible:P}=this;if("number"!==typeof I)return null;const N=Math.round(I);return Math.max(P?N-1:N,0)};
J._watchActions=function(){const {allActions:I}=this.viewModel;this.notifyChange("dividedActions");this._handles.remove("actions");I&&I.forEach(P=>{this._handles.add(h.watch(()=>[P.uid,P.active,P.className,P.disabled,P.id,P.title,P.image,P.visible],()=>this.scheduleRender()),"actions")})};J._divideActions=function(){var {allActions:I}=this.viewModel;I=I.filter(S=>S.visible);const P=this._getInlineActionCount(),N=null===P,V=0===P;return{inlineActions:N?I.slice(0):V?new n:I.slice(0,P),menuActions:N?
new n:V?I.slice(0):I.slice(P)}};J._featureMenuOpenChanged=function(I){I?this._focusFirstFeature=!0:this._focusFeatureMenuButton=!0};J._actionsMenuOpenChanged=function(I){I?this._focusFirstAction=!0:this._focusActionsMenuButton=!0};J._setTitleFromFeatureWidget=function(){const {selectedFeatureWidget:I,messagesCommon:P}=this;if(I){var N,V;this.viewModel.title="error"===(null==(N=I.viewModel)?void 0:N.state)?P.errorMessage:(null==(V=I.viewModel)?void 0:V.title)||""}};J._setContentFromFeatureWidget=function(){const {selectedFeatureWidget:I}=
this;I&&(this.viewModel.content=I)};J._unobserveFeatureMenuObserver=function(){this._featureMenuIntersectionObserverNode&&this._featureMenuIntersectionObserver.unobserve(this._featureMenuIntersectionObserverNode)};J._featureMenuIntersectionObserverCreated=function(I){this._unobserveFeatureMenuObserver();this._featureMenuIntersectionObserver.observe(I);this._featureMenuIntersectionObserverNode=I};J._handleFeatureMenuKeyup=function(I){"Escape"===l.eventKey(I)&&(I.stopPropagation(),this._focusFeatureMenuButton=
!0,this.featureMenuOpen=!1,this.scheduleRender())};J._handleActionMenuKeyup=function(I){"Escape"===l.eventKey(I)&&(I.stopPropagation(),this._focusActionsMenuButton=!0,this.actionsMenuOpen=!1,this.scheduleRender())};J._setActiveFeature=function(I){const {viewModel:P}=this;P.activeFeature=P.features[I.currentTarget["data-feature-index"]]||null};J._removeActiveFeature=function(){this.viewModel.activeFeature=null};J._handleFeatureMenuItemKeyup=function(I){const P=l.eventKey(I);var {_featureMenuNode:N}=
this;const V=I.currentTarget["data-feature-index"];if(N){N=N.querySelectorAll("li");var S=N.length;"ArrowUp"===P?(I.stopPropagation(),N[(V-1+S)%S].focus()):"ArrowDown"===P?(I.stopPropagation(),N[(V+1+S)%S].focus()):"Home"===P?(I.stopPropagation(),N[0].focus()):"End"===P&&(I.stopPropagation(),N[N.length-1].focus())}};J._handleActionMenuItemKeyup=function(I){const P=l.eventKey(I);var {_actionsMenuNode:N}=this;const V=I.currentTarget.dataset.actionUid;var {menuActions:S}=this.dividedActions;S=S.findIndex(H=>
H.uid===V);if(N){N=N.querySelectorAll("li");var T=N.length;"ArrowUp"===P?(I.stopPropagation(),N[(S-1+T)%T].focus()):"ArrowDown"===P?(I.stopPropagation(),N[(S+1+T)%T].focus()):"Home"===P?(I.stopPropagation(),N[0].focus()):"End"===P&&(I.stopPropagation(),N[N.length-1].focus())}};J._handleMainKeyup=function(I){const P=l.eventKey(I);"ArrowLeft"===P&&(I.stopPropagation(),this.previous());"ArrowRight"===P&&(I.stopPropagation(),this.next())};J._spinnerEnabledChange=function(I){this._destroySpinner();I&&
(I=this.get("viewModel.view"),this._createSpinner(I))};J._hideSpinner=function(){const {_spinner:I}=this;I&&(I.location=null,I.hide())};J._displaySpinner=function(){const {_spinner:I}=this;if(I){var {location:P,waitingForResult:N}=this.viewModel;N?I.show({location:P}):I.hide()}};J._getIconStyles=function(I){return{"background-image":I?`url(${I})`:""}};J._shouldFocus=function(){var I=a._asyncToGenerator(function*(P){P.shouldFocus&&(yield h.whenOnce(()=>{var N;return!0===(null==(N=this.viewModel)?void 0:
N.active)}),this.focus())});return function(P){return I.apply(this,arguments)}}();J._addSelectedFeatureIndexHandle=function(){const I=h.watch(()=>{var P;return null==(P=this.viewModel)?void 0:P.selectedFeatureIndex},(P,N)=>this._selectedFeatureIndexUpdated(P,N));this._handles.add(I,"selected-index")};J._selectedFeatureIndexUpdated=function(I,P){const {featureCount:N}=this;N&&I!==P&&-1!==I&&(this.featureMenuOpen=this.actionsMenuOpen=!1)};J._destroySelectedFeatureWidget=function(){const {_feature:I}=
this;I&&(I.viewModel=null,I&&!I.destroyed&&I.destroy());this._feature=null};J._isScreenLocationWithinView=function(I,P){return-1<I.x&&-1<I.y&&I.x<=P.width&&I.y<=P.height};J._isOutsideView=function(I){const {popupHeight:P,popupWidth:N,screenLocation:V,side:S,view:T}=I;if(isNaN(N)||isNaN(P)||!T||!V)return!1;I=T.padding;return"right"===S&&V.x+N/2>T.width-I.right||"left"===S&&V.x-N/2<I.left||"top"===S&&V.y-P<I.top||"bottom"===S&&V.y+P>T.height-I.bottom?!0:!1};J._calculateAutoAlignment=function(I){if("auto"!==
I)return I;const {_pointerOffsetInPx:P,_containerNode:N,_mainContainerNode:V,viewModel:S}=this,{screenLocation:T,view:H}=S;if(m.isNone(T)||!H||!N)return"top-center";if(!this._isScreenLocationWithinView(T,H))return this._get("currentAlignment")||"top-center";var U=(I=V?window.getComputedStyle(V,null):null)?parseInt(I.getPropertyValue("max-height").replace(/[^-\d\.]/g,""),10):0,W=I?parseInt(I.getPropertyValue("height").replace(/[^-\d\.]/g,""),10):0;const {height:Q,width:X}=N.getBoundingClientRect();
I=X+P;const ba=Math.max(Q,U,W)+P;U=this._isOutsideView({popupHeight:ba,popupWidth:I,screenLocation:T,side:"right",view:H});W=this._isOutsideView({popupHeight:ba,popupWidth:I,screenLocation:T,side:"left",view:H});const aa=this._isOutsideView({popupHeight:ba,popupWidth:I,screenLocation:T,side:"top",view:H});I=this._isOutsideView({popupHeight:ba,popupWidth:I,screenLocation:T,side:"bottom",view:H});return W?aa?"bottom-right":"top-right":U?aa?"bottom-left":"top-left":aa?I?"top-center":"bottom-center":
"top-center"};J._callCurrentAlignment=function(I){return"function"===typeof I?I.call(this):I};J._getCurrentAlignment=function(){const {alignment:I,dockEnabled:P}=this;return P||!this.viewModel.active?null:this._calculatePositionResult(this._calculateAutoAlignment(this._callCurrentAlignment(I)))};J._setCurrentAlignment=function(){this._set("currentAlignment",this._getCurrentAlignment())};J._setCurrentDockPosition=function(){this._set("currentDockPosition",this._getCurrentDockPosition())};J._calculatePositionResult=
function(I){const P=["left","right"];E.isRTL(this.container)&&P.reverse();return I.replace(/leading/gi,P[0]).replace(/trailing/gi,P[1])};J._callDockPosition=function(I){return"function"===typeof I?I.call(this):I};J._getDockPosition=function(){var I;return this._calculatePositionResult(this._calculateAutoDockPosition(this._callDockPosition(null==(I=this.dockOptions)?void 0:I.position)))};J._getCurrentDockPosition=function(){return this.dockEnabled&&this.viewModel.active?this._getDockPosition():null};
J._wouldDockTo=function(){return this.dockEnabled?null:this._getDockPosition()};J._calculateAutoDockPosition=function(I){var P;if("auto"!==I)return I;I=null==(P=this.viewModel)?void 0:P.view;P=E.isRTL(this.container)?"top-left":"top-right";if(!I)return P;var N=I.padding||{left:0,right:0,top:0,bottom:0};N=I.width-N.left-N.right;({breakpoints:I}=I);return I&&N<=I.xsmall?"bottom-center":P};J._positionContainer=function(I=this._containerNode){I&&(this._containerNode=I);if(I){var {screenLocation:P}=this.viewModel,
{width:N}=I.getBoundingClientRect();if(P=this._calculatePositionStyle(P,N))I.style.top=P.top,I.style.left=P.left,I.style.bottom=P.bottom,I.style.right=P.right}};J._calculateFullWidth=function(I){const {currentAlignment:P,_pointerOffsetInPx:N}=this;return"top-left"===P||"bottom-left"===P||"top-right"===P||"bottom-right"===P?I+N:I};J._calculateAlignmentPosition=function(I,P,N,V){const {currentAlignment:S,_pointerOffsetInPx:T}=this;V/=2;const H=N.height-P;N=N.width-I;const {padding:U}=this.view;if("bottom-center"===
S)return{top:P+T-U.top,left:I-V-U.left};if("top-left"===S)return{bottom:H+T-U.bottom,right:N+T-U.right};if("bottom-left"===S)return{top:P+T-U.top,right:N+T-U.right};if("top-right"===S)return{bottom:H+T-U.bottom,left:I+T-U.left};if("bottom-right"===S)return{top:P+T-U.top,left:I+T-U.left};if("top-center"===S)return{bottom:H+T-U.bottom,left:I-V-U.left}};J._calculatePositionStyle=function(I,P){const {dockEnabled:N,view:V}=this;if(V){if(N)return{left:"",top:"",right:"",bottom:""};if(!m.isNone(I)&&P&&(P=
this._calculateFullWidth(P),I=this._calculateAlignmentPosition(I.x,I.y,V,P)))return{top:void 0!==I.top?`${I.top}px`:"auto",left:void 0!==I.left?`${I.left}px`:"auto",bottom:void 0!==I.bottom?`${I.bottom}px`:"auto",right:void 0!==I.right?`${I.right}px`:"auto"}}};J._viewChange=function(I,P){I&&P&&(this.close(),this.clear())};J._viewReadyChange=function(I,P){I?(I=this.get("viewModel.view"),this._wireUpView(I)):P&&(this.close(),this.clear())};J._wireUpView=function(I){this._destroySpinner();if(I){var {spinnerEnabled:P}=
this;P&&this._createSpinner(I);this._setDockEnabledForViewSize(this.dockOptions)}};J._dockingThresholdCrossed=function(I,P,N){const [V,S]=I,[T,H]=P,{width:U,height:W}=N;return V<=U&&T>U||V>U&&T<=U||S<=W&&H>W||S>W&&H<=W};J._updateDockEnabledForViewSize=function(I,P){if(I&&P){var N=this.get("viewModel.view.padding")||{left:0,right:0,top:0,bottom:0},V=N.left+N.right,S=N.top+N.bottom;N=[];var T=[];N[0]=I[0]-V;N[1]=I[1]-S;T[0]=P[0]-V;T[1]=P[1]-S;({dockOptions:I}=this);this._dockingThresholdCrossed(N,T,
I.breakpoint)&&this._setDockEnabledForViewSize(I);this._setCurrentDockPosition()}};J._focusDockButtonNode=function(I){this._focusDockButton&&(this._focusDockButton=!1,I.focus())};J._closeButtonNodeUpdated=function(I){this._focusClose?(this._focusClose=!1,I.focus()):this._blurClose&&(this._blurClose=!1,I.blur())};J._mainContainerNodeUpdated=function(I){this._mainContainerNode=I;this._focusContainer?(this._focusContainer=!1,I.focus()):this._blurContainer&&(this._blurContainer=!1,I.blur())};J._featureMenuNodeUpdated=
function(I){(this._featureMenuNode=I)&&this._focusFirstFeature&&(this._focusFirstFeature=!1,I=I.querySelectorAll("li"),I.length&&I[0].focus())};J._actionsMenuNodeUpdated=function(I){(this._actionsMenuNode=I)&&this._focusFirstAction&&(this._focusFirstAction=!1,I=I.querySelectorAll("li"),I.length&&I[0].focus())};J._focusFeatureMenuButtonNode=function(I){this._focusFeatureMenuButton&&(this._focusFeatureMenuButton=!1,I.focus())};J._focusActionsMenuButtonNode=function(I){this._focusActionsMenuButton&&
(this._focusActionsMenuButton=!1,I.focus())};J._featureMenuViewportScrollTop=function(){this._featureMenuViewportNode&&(this._featureMenuViewportNode.scrollTop=0)};J._toggleScreenLocationEnabled=function(){const {dockEnabled:I,viewModel:P}=this;P&&(P.screenLocationEnabled=P.active&&!I)};J._shouldDockAtCurrentViewSize=function(I){var P,N;I=I.breakpoint;const V=null==(P=this.viewModel)?void 0:null==(N=P.view)?void 0:N.ui;if(!V)return!1;const {width:S,height:T}=V;if(isNaN(S)||isNaN(T))return!1;P=I.hasOwnProperty("width")&&
S<=I.width;N=I.hasOwnProperty("height")&&T<=I.height;return P||N};J._setDockEnabledForViewSize=function(I){I.breakpoint&&(this.dockEnabled=this._shouldDockAtCurrentViewSize(I))};J._getPageText=function(I,P){return this.featureNavigationVisible?F.substitute(this.messages.pageText,{index:P+1,total:I}):null};J._destroySpinner=function(){const {_spinner:I,view:P}=this;I&&(P&&P.ui&&P.ui.remove(this._spinner,"popup-spinner"),I.destroy(),this._spinner=null)};J._createSpinner=function(I){I&&(this._spinner=
new y({view:I}),I.ui.add(this._spinner,{key:"popup-spinner",position:"manual"}))};J._toggleCollapsed=function(){this.collapsed=!this.collapsed};J._close=function(){this.close();this.view&&this.view.focus()};J._toggleDockEnabled=function(){this.dockEnabled=!this.dockEnabled;this._focusDockButton=!0;this.scheduleRender()};J._toggleFeatureMenu=function(){const I=!this.featureMenuOpen;this._featureMenuOpenChanged(I);this.actionsMenuOpen=!1;this.featureMenuOpen=I};J._toggleActionsMenu=function(){const I=
!this.actionsMenuOpen;this._actionsMenuOpenChanged(I);this.featureMenuOpen=!1;this.actionsMenuOpen=I};J._triggerAction=function(I){const P=I.currentTarget.dataset.actionUid;var {allActions:N}=this.viewModel;I=N.findIndex(V=>V.uid===P);(N=N.getItemAt(I))&&"toggle"===N.type&&(N.value=!N.value);this.actionsMenuOpen=!1;this.viewModel.triggerAction(I)};J._selectFeature=function(I){I=I.currentTarget["data-feature-index"];isNaN(I)||(this.viewModel.selectedFeatureIndex=I);this.featureMenuOpen=!1;this._focusFeatureMenuButton=
!0;this.scheduleRender()};J._next=function(){this.next()};J._previous=function(){this.previous()};a._createClass(M,[{key:"actionsMenuId",get:function(){return`${this.id}-actions-menu`}},{key:"actionsMenuButtonId",get:function(){return`${this.id}-actions-menu-button`}},{key:"featureMenuId",get:function(){return`${this.id}-feature-menu`}},{key:"titleId",get:function(){return`${this.id}-popup-title`}},{key:"contentId",get:function(){return`${this.id}-popup-content`}},{key:"hasContent",get:function(){var I,
P,N,V,S,T,H;return!!(this.selectedFeatureWidget?(null==(I=this.selectedFeatureWidget)?0:null==(P=I.viewModel)?0:P.waitingForContent)||"error"===(null==(N=this.selectedFeatureWidget)?void 0:null==(V=N.viewModel)?void 0:V.state)||(null==(S=this.selectedFeatureWidget)?0:null==(T=S.viewModel)?0:T.content):null==(H=this.viewModel)?0:H.content)}},{key:"featureNavigationVisible",get:function(){return this.viewModel.active&&1<this.viewModel.featureCount&&this.visibleElements.featureNavigation}},{key:"collapsible",
get:function(){return!!(this.collapseEnabled&&this.viewModel.title&&this.hasContent)}},{key:"featureMenuVisible",get:function(){return this.featureNavigationVisible&&this.featureMenuOpen}},{key:"contentCollapsed",get:function(){return this.collapsible&&!this.featureMenuVisible&&this.collapsed}},{key:"dividedActions",get:function(){return this._divideActions()}},{key:"actionsMenuOpen",get:function(){return this.viewModel.active?this._get("actionsMenuOpen"):!1},set:function(I){this._set("actionsMenuOpen",
!!I)}},{key:"currentAlignment",get:function(){return this._getCurrentAlignment()}},{key:"currentDockPosition",get:function(){return this._getCurrentDockPosition()}},{key:"dockOptions",get:function(){return this._get("dockOptions")||O},set:function(I){var P={...O};const N=this.get("viewModel.view.breakpoints");var V={};N&&(V.width=N.xsmall,V.height=N.xsmall);I={...P,...I};P={...P.breakpoint,...V};({breakpoint:V}=I);!0===V?I.breakpoint=P:"object"===typeof V&&(I.breakpoint={...P,...V});this._set("dockOptions",
I);this._setCurrentDockPosition();this.reposition()}},{key:"selectedFeatureWidget",get:function(){const {_feature:I,visibleElements:P,headingLevel:N}=this,{selectedFeatureViewModel:V}=this.viewModel,S={...P,title:!1};if(!V)return null;I?(I.viewModel=V,I.visibleElements=S):this._feature=new r({headingLevel:N+1,viewModel:V,visibleElements:S});return this._feature}}]);return M}(w.FeatureContentMixin(f));b.__decorate([q.property({readOnly:!0})],c.prototype,"actionsMenuId",null);b.__decorate([q.property({readOnly:!0})],
c.prototype,"actionsMenuButtonId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"featureMenuId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"titleId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"contentId",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"hasContent",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"featureNavigationVisible",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"collapsible",null);b.__decorate([q.property({readOnly:!0})],
c.prototype,"featureMenuVisible",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"contentCollapsed",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"dividedActions",null);b.__decorate([e.aliasOf("viewModel.actions")],c.prototype,"actions",void 0);b.__decorate([q.property()],c.prototype,"actionsMenuOpen",null);b.__decorate([q.property()],c.prototype,"alignment",void 0);b.__decorate([e.aliasOf("viewModel.autoCloseEnabled")],c.prototype,"autoCloseEnabled",void 0);b.__decorate([e.aliasOf("viewModel.autoOpenEnabled")],
c.prototype,"autoOpenEnabled",void 0);b.__decorate([e.aliasOf("viewModel.defaultPopupTemplateEnabled")],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([e.aliasOf("viewModel.content")],c.prototype,"content",void 0);b.__decorate([q.property()],c.prototype,"collapsed",void 0);b.__decorate([q.property()],c.prototype,"collapseEnabled",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"currentAlignment",null);b.__decorate([q.property({readOnly:!0})],c.prototype,"currentDockPosition",
null);b.__decorate([q.property()],c.prototype,"dockOptions",null);b.__decorate([q.property()],c.prototype,"dockEnabled",void 0);b.__decorate([e.aliasOf("viewModel.featureCount")],c.prototype,"featureCount",void 0);b.__decorate([q.property()],c.prototype,"featureMenuOpen",void 0);b.__decorate([e.aliasOf("viewModel.features")],c.prototype,"features",void 0);b.__decorate([e.aliasOf("viewModel.goToOverride")],c.prototype,"goToOverride",void 0);b.__decorate([q.property()],c.prototype,"headingLevel",void 0);
b.__decorate([e.aliasOf("viewModel.highlightEnabled")],c.prototype,"highlightEnabled",void 0);b.__decorate([e.aliasOf("viewModel.location")],c.prototype,"location",void 0);b.__decorate([q.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],c.prototype,"label",void 0);b.__decorate([q.property()],c.prototype,"maxInlineActions",void 0);b.__decorate([q.property(),B.messageBundle("esri/widgets/Popup/t9n/Popup")],c.prototype,"messages",void 0);b.__decorate([q.property(),B.messageBundle("esri/t9n/common")],
c.prototype,"messagesCommon",void 0);b.__decorate([e.aliasOf("viewModel.promises")],c.prototype,"promises",void 0);b.__decorate([e.aliasOf("viewModel.selectedFeature")],c.prototype,"selectedFeature",void 0);b.__decorate([e.aliasOf("viewModel.selectedFeatureIndex")],c.prototype,"selectedFeatureIndex",void 0);b.__decorate([q.property({readOnly:!0})],c.prototype,"selectedFeatureWidget",null);b.__decorate([q.property()],c.prototype,"spinnerEnabled",void 0);b.__decorate([e.aliasOf("viewModel.title")],
c.prototype,"title",void 0);b.__decorate([e.aliasOf("viewModel.updateLocationEnabled")],c.prototype,"updateLocationEnabled",void 0);b.__decorate([e.aliasOf("viewModel.view")],c.prototype,"view",void 0);b.__decorate([q.property({type:z}),C.vmEvent(["triggerAction","trigger-action"])],c.prototype,"viewModel",void 0);b.__decorate([e.aliasOf("viewModel.visible")],c.prototype,"visible",void 0);b.__decorate([q.property()],c.prototype,"visibleElements",void 0);b.__decorate([t.cast("visibleElements")],c.prototype,
"castVisibleElements",null);b.__decorate([x.accessibleHandler()],c.prototype,"_close",null);b.__decorate([x.accessibleHandler()],c.prototype,"_toggleDockEnabled",null);b.__decorate([x.accessibleHandler()],c.prototype,"_toggleFeatureMenu",null);b.__decorate([x.accessibleHandler()],c.prototype,"_toggleActionsMenu",null);b.__decorate([x.accessibleHandler()],c.prototype,"_triggerAction",null);b.__decorate([x.accessibleHandler()],c.prototype,"_selectFeature",null);b.__decorate([x.accessibleHandler()],
c.prototype,"_next",null);b.__decorate([x.accessibleHandler()],c.prototype,"_previous",null);return c=b.__decorate([k.subclass("esri.widgets.Popup")],c)})},"esri/core/throttle":function(){define(["exports"],function(a){a.throttle=function(b,c,n,l){let u=null,v=1E3;"number"===typeof c?(v=c,l=n):(u=null!=c?c:null,v=n);let m=0,h;const d=()=>{m=0;b.apply(l,h)};c=(...e)=>{u&&u.apply(l,e);h=e;v?m||(m=setTimeout(d,v)):d()};c.remove=()=>{m&&(clearTimeout(m),m=0)};c.forceUpdate=()=>{m&&(clearTimeout(m),d())};
c.hasPendingUpdates=()=>!!m;return c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature":function(){define("require ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../intl ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Feature/FeatureAttachments ./Feature/FeatureContent ./Feature/FeatureExpression ./Feature/FeatureFields ./Feature/FeatureMedia ./Feature/FeatureViewModel ./Feature/support/FeatureContentMixin ./support/Heading ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ../intl/substitute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B){const C={title:!0,content:!0,lastEditedInfo:!0};n=function(D){function E(G,O){G=D.call(this,G,O)||this;G._contentWidgets=[];G.graphic=null;G.defaultPopupTemplateEnabled=!1;G.headingLevel=2;G.label=void 0;G.messages=null;G.messagesCommon=null;G.messagesURIUtils=null;G.spatialReference=null;G.title=null;G.visibleElements={...C};G.map=null;G.view=null;G.viewModel=new y;return G}b._inheritsLoose(E,D);var F=E.prototype;F.initialize=function(){this.own(l.watch(()=>
{var G;return null==(G=this.viewModel)?void 0:G.contentViewModels},()=>this._setupContentWidgets(),l.initial))};F.loadDependencies=function(){return new Promise((G,O)=>a(["../chunks/calcite-notice"],G,O))};F.destroy=function(){this._destroyContentWidgets()};F.castVisibleElements=function(G){return{...C,...G}};F.render=function(){var {state:G}=this.viewModel;G=x.tsx("div",{class:"esri-feature__size-container",key:"container"},this.renderTitle(),"error"===G?this.renderError():"loading"===G?this.renderLoading():
this.renderContentContainer());return x.tsx("div",{class:this.classes("esri-feature","esri-widget")},G)};F.setActiveMedia=function(G,O){this.viewModel.setActiveMedia(G,O)};F.nextMedia=function(G){this.viewModel.nextMedia(G)};F.previousMedia=function(G){this.viewModel.previousMedia(G)};F.renderError=function(){const {messagesCommon:G,messages:O,visibleElements:K}=this;return x.tsx("calcite-notice",{active:!0,color:"red",icon:"exclamation-mark-circle",scale:"s"},K.title?x.tsx("div",{key:"error-title",
slot:"title"},G.errorMessage):null,x.tsx("div",{key:"error-message",slot:"message"},O.loadingError))};F.renderLoading=function(){return x.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},x.tsx("span",{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};F.renderContentContainer=function(){const {visibleElements:G}=this;return G.content?x.tsx("div",{class:"esri-feature__main-container"},[this.renderContent(),this.renderLastEditInfo()]):
null};F.renderTitle=function(){const {visibleElements:G,title:O}=this;return G.title?x.tsx(w.Heading,{level:this.headingLevel,class:"esri-feature__title",innerHTML:O}):null};F.renderContent=function(){var G=this.viewModel.content;return G?Array.isArray(G)?G.length?x.tsx("div",{key:"content-content-elements"},G.map(this.renderContentElement,this)):null:"string"===typeof G?(G=this._contentWidgets[0],!G||G.destroyed?null:x.tsx("div",{key:"content-content"},G.render())):this.renderNodeContent(G):null};
F.renderContentElement=function(G,O){const {visibleElements:K}=this;if("boolean"!==typeof K.content&&!K.content[G.type])return null;switch(G.type){case "attachments":return this.renderAttachments(O);case "custom":return this.renderCustom(G,O);case "fields":return this.renderFields(O);case "media":return this.renderMedia(O);case "text":return this.renderText(G,O);case "expression":return this.renderExpression(O);default:return null}};F.renderAttachments=function(G){const O=this._contentWidgets[G];
if(!O||O.destroyed)return null;const {state:K,attachmentInfos:L}=O.viewModel;return"loading"===K||0<L.length?x.tsx("div",{key:this._buildKey("attachments-element",G),class:this.classes("esri-feature__content-element")},O.render()):null};F.renderExpression=function(G){const O=this._contentWidgets[G];return!O||O.destroyed?null:x.tsx("div",{key:this._buildKey("expression-element",G),class:"esri-feature__content-element"},O.render())};F.renderCustom=function(G,O){({creator:G}=G);const K=this._contentWidgets[O];
return!K||K.destroyed?null:G?x.tsx("div",{key:this._buildKey("custom-element",O),class:"esri-feature__content-element"},K.render()):null};F.renderFields=function(G){const O=this._contentWidgets[G];return!O||O.destroyed?null:x.tsx("div",{key:this._buildKey("fields-element",G),class:"esri-feature__content-element"},O.render())};F.renderMedia=function(G){const O=this._contentWidgets[G];return!O||O.destroyed?null:x.tsx("div",{key:this._buildKey("media-element",G),class:"esri-feature__content-element"},
O.render())};F.renderLastEditInfo=function(){const {visibleElements:G,messages:O}=this;var {lastEditInfo:K}=this.viewModel;if(!K||!G.lastEditedInfo)return null;const {date:L,user:R}=K;K=B.substitute("edit"===K.type?R?O.lastEditedByUser:O.lastEdited:R?O.lastCreatedByUser:O.lastCreated,{date:L,user:R});return x.tsx("div",{key:"edit-info-element",class:this.classes("esri-feature__last-edited-info","esri-feature__content-element")},K)};F.renderText=function(G,O){const K=this._contentWidgets[O];return!K||
K.destroyed?null:G.text?x.tsx("div",{key:this._buildKey("text-element",O),class:this.classes("esri-feature__content-element","esri-feature__text")},K.render()):null};F._buildKey=function(G,...O){const K=this.get("viewModel.graphic.uid")||"0";O=O.join("-");return`${G}__${K}-${O}`};F._destroyContentWidget=function(G){G&&(G.viewModel=null,!G.destroyed&&G.destroy())};F._destroyContentWidgets=function(){this._contentWidgets.forEach(G=>this._destroyContentWidget(G));this._contentWidgets=[]};F._setupContentWidgets=
function(){this._destroyContentWidgets();const {headingLevel:G,visibleElements:O}=this;var K=this.get("viewModel.content");const {contentViewModels:L}=this.viewModel;Array.isArray(K)?K.forEach((R,M)=>{"attachments"===R.type&&(this._contentWidgets[M]=new p({displayType:R.displayType,headingLevel:O.title?G+1:G,viewModel:L[M]}));"fields"===R.type&&(this._contentWidgets[M]=new k({viewModel:L[M]}));"media"===R.type&&(this._contentWidgets[M]=new r({viewModel:L[M]}));"text"===R.type&&(this._contentWidgets[M]=
new t({viewModel:L[M]}));"custom"===R.type&&(this._contentWidgets[M]=new t({viewModel:L[M]}));"expression"===R.type&&(this._contentWidgets[M]=new q({viewModel:L[M]}))},this):(K=L[0])&&!K.destroyed&&(this._contentWidgets[0]=new t({viewModel:K}));this.scheduleRender()};return E}(f.FeatureContentMixin(g));c.__decorate([u.aliasOf("viewModel.graphic")],n.prototype,"graphic",void 0);c.__decorate([u.aliasOf("viewModel.defaultPopupTemplateEnabled")],n.prototype,"defaultPopupTemplateEnabled",void 0);c.__decorate([d.property()],
n.prototype,"headingLevel",void 0);c.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],n.prototype,"label",void 0);c.__decorate([d.property(),A.messageBundle("esri/widgets/Feature/t9n/Feature")],n.prototype,"messages",void 0);c.__decorate([d.property(),A.messageBundle("esri/t9n/common")],n.prototype,"messagesCommon",void 0);c.__decorate([d.property(),A.messageBundle("esri/widgets/support/t9n/uriUtils")],n.prototype,"messagesURIUtils",void 0);c.__decorate([u.aliasOf("viewModel.spatialReference")],
n.prototype,"spatialReference",void 0);c.__decorate([u.aliasOf("viewModel.title")],n.prototype,"title",void 0);c.__decorate([d.property()],n.prototype,"visibleElements",void 0);c.__decorate([h.cast("visibleElements")],n.prototype,"castVisibleElements",null);c.__decorate([u.aliasOf("viewModel.map")],n.prototype,"map",void 0);c.__decorate([u.aliasOf("viewModel.view")],n.prototype,"view",void 0);c.__decorate([d.property({type:y})],n.prototype,"viewModel",void 0);return n=c.__decorate([e.subclass("esri.widgets.Feature")],
n)})},"esri/widgets/Feature/FeatureAttachments":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Attachments ../Widget ./FeatureAttachments/FeatureAttachmentsViewModel ./support/FeatureElementInfo ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){l=function(k){function r(f,w){f=k.call(this,f,w)||this;f._featureElementInfo=null;f.attachmentsWidget=new d;f.description=null;f.displayType=null;f.graphic=null;f.headingLevel=2;f.title=null;f.viewModel=new g;return f}a._inheritsLoose(r,k);var y=r.prototype;y.initialize=function(){this._featureElementInfo=new p;this.own([c.watch(()=>{var f,w;return[null==(f=this.viewModel)?void 0:f.description,null==(w=this.viewModel)?void 0:w.title,this.headingLevel]},()=>
this._setupFeatureElementInfo(),c.initial),c.watch(()=>{var f;return null==(f=this.viewModel)?void 0:f.graphic},f=>this.attachmentsWidget.graphic=f,c.initial)])};y.destroy=function(){this.attachmentsWidget.destroy();this._featureElementInfo.destroy()};y.render=function(){var f;const {attachmentsWidget:w}=this;return q.tsx("div",{class:"esri-feature-attachments"},null==(f=this._featureElementInfo)?void 0:f.render(),null==w?void 0:w.render())};y._setupFeatureElementInfo=function(){const {description:f,
title:w,headingLevel:z}=this;this._featureElementInfo.set({description:f,title:w,headingLevel:z})};return r}(e);b.__decorate([m.property({readOnly:!0})],l.prototype,"attachmentsWidget",void 0);b.__decorate([n.aliasOf("viewModel.description")],l.prototype,"description",void 0);b.__decorate([n.aliasOf("attachmentsWidget.displayType")],l.prototype,"displayType",void 0);b.__decorate([n.aliasOf("viewModel.graphic")],l.prototype,"graphic",void 0);b.__decorate([m.property()],l.prototype,"headingLevel",void 0);
b.__decorate([n.aliasOf("viewModel.title")],l.prototype,"title",void 0);b.__decorate([m.property({type:g})],l.prototype,"viewModel",void 0);return l=b.__decorate([h.subclass("esri.widgets.Feature.FeatureAttachments")],l)})},"esri/widgets/Attachments":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Error ../core/reactiveUtils ../core/unitFormatUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/decorators/cast ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attachments/AttachmentsViewModel ./Attachments/support/attachmentUtils ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){const y={addButton:!0,addSubmitButton:!0,cancelAddButton:!0,cancelUpdateButton:!0,deleteButton:!0,errorMessage:!0,progressBar:!0,updateButton:!0},f=window.CSS;v=function(w){function z(x,B){x=w.call(this,x,B)||this;x.abilities=null;x.displayType="auto";x.graphic=null;x.label=void 0;x.messages=null;x.messagesUnits=null;x.selectedFile=null;x.submitting=!1;x.viewModel=new p;x.visibleElements={...y};x._supportsImageOrientation=f&&f.supports&&f.supports("image-orientation",
"from-image");x._addAttachmentForm=null;x._updateAttachmentForm=null;return x}a._inheritsLoose(z,w);var A=z.prototype;A.initialize=function(){this.own([n.on(()=>{var x;return null==(x=this.viewModel)?void 0:x.attachmentInfos},"change",()=>this.scheduleRender()),n.watch(()=>{var x;return null==(x=this.viewModel)?void 0:x.mode},()=>this._modeChanged(),n.initial)])};A.castVisibleElements=function(x){return{...y,...x}};A.addAttachment=function(){const {_addAttachmentForm:x,viewModel:B}=this;this._set("submitting",
!0);this._set("error",null);return B.addAttachment(x).then(C=>{this._set("submitting",!1);this._set("error",null);B.mode="view";return C}).catch(C=>{this._set("submitting",!1);this._set("error",new c("attachments:add-attachment",this.messages.addErrorMessage,C));throw C;})};A.deleteAttachment=function(x){const {viewModel:B}=this;this._set("submitting",!0);this._set("error",null);return B.deleteAttachment(x).then(C=>{this._set("submitting",!1);this._set("error",null);B.mode="view";return C}).catch(C=>
{this._set("submitting",!1);this._set("error",new c("attachments:delete-attachment",this.messages.deleteErrorMessage,C));throw C;})};A.updateAttachment=function(){const {viewModel:x}=this,{_updateAttachmentForm:B}=this;this._set("submitting",!0);this._set("error",null);return x.updateAttachment(B).then(C=>{this._set("submitting",!1);this._set("error",null);x.mode="view";return C}).catch(C=>{this._set("submitting",!1);this._set("error",new c("attachments:update-attachment",this.messages.updateErrorMessage,
C));throw C;})};A.render=function(){const {submitting:x,viewModel:B}=this,{state:C}=B;return r.tsx("div",{class:this.classes("esri-attachments","esri-widget")},x?this.renderProgressBar():null,"loading"===C?this.renderLoading():this.renderAttachments(),this.renderErrorMessage())};A.renderErrorMessage=function(){const {error:x,visibleElements:B}=this;return x&&B.errorMessage?r.tsx("div",{key:"error-message",class:"esri-attachments__error-message"},x.message):null};A.renderAttachments=function(){const {mode:x,
activeAttachmentInfo:B}=this.viewModel;return"add"===x?this.renderAddForm():"edit"===x?this.renderDetailsForm(B):this.renderAttachmentContainer()};A.renderLoading=function(){return r.tsx("div",{class:"esri-attachments__loader-container",key:"loader"},r.tsx("div",{class:"esri-attachments__loader"}))};A.renderProgressBar=function(){return this.visibleElements.progressBar?r.tsx("div",{class:"esri-attachments__progress-bar",key:"progress-bar"}):null};A.renderAddForm=function(){const {submitting:x,selectedFile:B}=
this;var C=x||!B,D=this.visibleElements.cancelAddButton?r.tsx("button",{type:"button",bind:this,disabled:x,onclick:this._cancelForm,class:this.classes("esri-button","esri-button--tertiary","esri-button--small","esri-button--half",x&&"esri-button--disabled")},this.messages.cancel):null;C=this.visibleElements.addSubmitButton?r.tsx("button",{type:"submit",disabled:C,class:this.classes("esri-button","esri-button--secondary","esri-button--small","esri-button--half",{["esri-button--disabled"]:C})},this.messages.add):
null;const E=B?r.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},B.name):null;D=r.tsx("form",{bind:this,afterCreate:q.storeNode,afterRemoved:q.discardNode,"data-node-ref":"_addAttachmentForm",onsubmit:this._submitAddAttachment},r.tsx("fieldset",{class:"esri-attachments__file-fieldset"},E,r.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},B?this.messages.changeFile:this.messages.selectFile,r.tsx("input",{class:"esri-attachments__file-input",
type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))),C,D);return r.tsx("div",{key:"add-form-container",class:"esri-attachments__form-node"},D)};A.renderDetailsForm=function(x){const {visibleElements:B,viewModel:C,selectedFile:D,submitting:E}=this,{contentType:F,size:G,url:O}=x;var {abilities:K}=C,L=E||!D,R=K.editing&&K.operations.delete&&B.deleteButton?r.tsx("button",{key:"delete-button",type:"button",disabled:E,bind:this,onclick:P=>this._submitDeleteAttachment(P,x),class:this.classes("esri-button",
"esri-button--small","esri-button--tertiary","esri-attachments__delete-button",{["esri-button--disabled"]:E})},this.messages.delete):null;L=K.editing&&K.operations.update&&B.updateButton?r.tsx("button",{disabled:L,key:"update-button",type:"submit",class:this.classes("esri-button","esri-button--small","esri-button--third",{["esri-button--disabled"]:L})},this.messages.update):null;const M=this.visibleElements.cancelUpdateButton?r.tsx("button",{disabled:E,key:"cancel-button",type:"button",bind:this,
onclick:this._cancelForm,class:this.classes("esri-button","esri-button--small","esri-button--tertiary","esri-button--third",{["esri-button--disabled"]:E})},this.messages.cancel):null;var J=D?r.tsx("span",{key:"file-name",class:"esri-attachments__file-name"},D.name):null;K=K.editing&&K.operations.update?r.tsx("fieldset",{key:"file",class:"esri-attachments__file-fieldset"},J,r.tsx("label",{class:this.classes("esri-attachments__file-label","esri-button","esri-button--secondary")},this.messages.changeFile,
r.tsx("input",{class:"esri-attachments__file-input",type:"file",name:"attachment",bind:this,onchange:this._handleFileInputChange}))):null;J=r.tsx("fieldset",{key:"size",class:"esri-attachments__metadata-fieldset"},r.tsx("label",null,l.formatFileSize(this.messagesUnits,G)));const I=r.tsx("fieldset",{key:"content-type",class:"esri-attachments__metadata-fieldset"},r.tsx("label",null,F));R=r.tsx("form",{bind:this,afterCreate:q.storeNode,afterRemoved:q.discardNode,"data-node-ref":"_updateAttachmentForm",
onsubmit:this._submitUpdateAttachment},r.tsx("div",{class:"esri-attachments__metadata"},J,I),K,r.tsx("div",{class:"esri-attachments__actions"},R,M,L));return r.tsx("div",{key:"edit-form-container",class:"esri-attachments__form-node"},r.tsx("a",{class:"esri-attachments__item-link",href:O,rel:"noreferrer",target:"_blank"},this.renderImageMask({attachmentInfo:x,size:400}),r.tsx("div",{class:"esri-attachments__item-link-overlay"},r.tsx("span",{class:"esri-attachments__item-link-overlay-icon"},r.tsx("svg",
{xmlns:"http://www.w3.org/2000/svg",width:"32",height:"32",viewBox:"0 0 32 32"},r.tsx("path",{d:"M28 13h1v16H3V3h16v1H4v24h24zm-5-9h4.293L15.646 15.638l.707.707L28 4.707V9h1V3h-6z"}),r.tsx("path",{fill:"none",d:"M0 0h32v32H0z"}))))),R)};A.renderImageMask=function({attachmentInfo:x,size:B}){var {supportsResizeAttachments:C}=this.viewModel;const {contentType:D,name:E,url:F}=x,G=C&&t.isSupportedImage(D);x=(x=this._getCSSTransform(x,G))?{transform:x,"image-orientation":"none"}:{};const O=F.includes("?")?
"\x26":"?";B=G?`${F}${O}w=${B}`:t.getIconPath(D);C={["esri-attachments__image--resizable"]:C};return r.tsx("div",{class:this.classes({["esri-attachments__item-mask--icon"]:!G},"esri-attachments__item-mask")},r.tsx("img",{styles:x,alt:E,src:B,class:this.classes(C,"esri-attachments__image")}))};A.renderAttachmentInfo=function({attachmentInfo:x,displayType:B}){var {viewModel:C}=this;({abilities:C}=C);const {name:D,url:E}=x;B=this.renderImageMask({attachmentInfo:x,size:"list"===B?48:400});var F=C.editing?
r.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-chevron-icon",q.isRTL(this.container)?"esri-icon-left":"esri-icon-right")}):null;F=r.tsx("label",{class:"esri-attachments__label"},r.tsx("span",{class:"esri-attachments__filename"},D||this.messages.noTitle),F);B=[B,F];C=C.editing?r.tsx("button",{key:"details-button",bind:this,class:"esri-attachments__item-button",title:this.messages.attachmentDetails,"aria-label":this.messages.attachmentDetails,"data-attachment-info-id":x.id,
onclick:()=>this._startEditAttachment(x),type:"button"},B):r.tsx("a",{key:"details-link",class:"esri-attachments__item-button",href:E,target:"_blank"},B);return r.tsx("li",{class:"esri-attachments__item",key:x},C)};A.renderAttachmentContainer=function(){const {effectiveDisplayType:x,viewModel:B,visibleElements:C}=this,{attachmentInfos:D,abilities:E}=B;var F=D&&D.length;const G={["esri-attachments__container--list"]:"preview"!==x,["esri-attachments__container--preview"]:"preview"===x},O=E.editing&&
E.operations.add&&C.addButton?r.tsx("button",{bind:this,onclick:()=>this._startAddAttachment(),class:this.classes("esri-button","esri-button--tertiary","esri-attachments__add-attachment-button"),type:"button"},r.tsx("span",{"aria-hidden":"true",class:this.classes("esri-attachments__item-add-icon","esri-icon-plus")}),this.messages.add):null;F=F?r.tsx("ul",{class:"esri-attachments__items"},D.toArray().map(K=>this.renderAttachmentInfo({attachmentInfo:K,displayType:x}))):r.tsx("div",{class:"esri-widget__content--empty"},
this.messages.noAttachments);return r.tsx("div",{key:"attachments-container",class:this.classes("esri-attachments__container",G)},F,O)};A._modeChanged=function(){this._set("error",null);this._set("selectedFile",null)};A._handleFileInputChange=function(x){x=(x=x.target)&&x.files&&x.files.item(0);this._set("selectedFile",x)};A._submitDeleteAttachment=function(x,B){x.preventDefault();this.deleteAttachment(B)};A._submitAddAttachment=function(x){x.preventDefault();this.addAttachment()};A._submitUpdateAttachment=
function(x){x.preventDefault();this.updateAttachment()};A._startEditAttachment=function(x){const {viewModel:B}=this;B.activeAttachmentInfo=x;B.mode="edit"};A._startAddAttachment=function(){this.viewModel.mode="add"};A._cancelForm=function(x){x.preventDefault();this.viewModel.mode="view"};A._getCSSTransform=function(x,B){({orientationInfo:x}=x);return!this._supportsImageOrientation&&B&&x?[x.rotation?`rotate(${x.rotation}deg)`:"",x.mirrored?"scaleX(-1)":""].join(" "):""};a._createClass(z,[{key:"effectiveDisplayType",
get:function(){const {displayType:x}=this;return x&&"auto"!==x?x:this.viewModel.supportsResizeAttachments?"preview":"list"}}]);return z}(g);b.__decorate([u.aliasOf("viewModel.abilities")],v.prototype,"abilities",void 0);b.__decorate([d.property()],v.prototype,"displayType",void 0);b.__decorate([d.property({readOnly:!0})],v.prototype,"effectiveDisplayType",null);b.__decorate([u.aliasOf("viewModel.graphic")],v.prototype,"graphic",void 0);b.__decorate([d.property({aliasOf:{source:"messages.widgetLabel",
overridable:!0}})],v.prototype,"label",void 0);b.__decorate([d.property(),k.messageBundle("esri/widgets/Attachments/t9n/Attachments")],v.prototype,"messages",void 0);b.__decorate([d.property(),k.messageBundle("esri/core/t9n/Units")],v.prototype,"messagesUnits",void 0);b.__decorate([d.property({readOnly:!0})],v.prototype,"selectedFile",void 0);b.__decorate([d.property({readOnly:!0})],v.prototype,"submitting",void 0);b.__decorate([d.property({readOnly:!0})],v.prototype,"error",void 0);b.__decorate([d.property({type:p})],
v.prototype,"viewModel",void 0);b.__decorate([d.property()],v.prototype,"visibleElements",void 0);b.__decorate([h.cast("visibleElements")],v.prototype,"castVisibleElements",null);return v=b.__decorate([e.subclass("esri.widgets.Attachments")],v)})},"esri/core/unitFormatUtils":function(){define("exports ./byteSizeEstimations ./Cyclical ./mathUtils ./maybe ./string ./unitUtils ../intl/number".split(" "),function(a,b,c,n,l,u,v,m){function h(t,q,k){return t.units[q][k]}function d(t,q,k,r=2,y="abbr"){return`${m.formatNumber(q,
{minimumFractionDigits:r,maximumFractionDigits:r})} ${h(t,k,y)}`}function e(t,q,k,r=2,y="abbr"){return`${m.formatNumber(q,{minimumFractionDigits:r,maximumFractionDigits:r,signDisplay:"exceptZero"})} ${h(t,k,y)}`}function g(t,q,k){if(q===k)return t;switch(k){case "arithmetic":return-t+90;case "geographic":return-t-90}}const p=["B","kB","MB","GB","TB"];a.formatAngleDegrees=function(t,q,k,r,y){t=c.cyclicalDegrees.normalize(g(v.convertUnit(t,q,"degrees"),k,r),0,!0);y=l.unwrapOr(y,2);return m.formatNumber(t,
{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:y,minimumFractionDigits:y})};a.formatDMS=function(t,q,k=2){t=v.convertUnit(t,q,"degrees");q=t-Math.floor(t);t-=q;q*=60;let r=q-Math.floor(q);q-=r;r*=60;return`${t.toFixed()}\u00b0 ${q.toFixed()}' ${r.toFixed(k)}"`};a.formatDecimal=d;a.formatFileSize=function(t,q){let k=0===q?0:Math.floor(Math.log(q)/Math.log(b.ByteSizeUnit.KILOBYTES));k=n.clamp(k,0,p.length-1);q=m.formatNumber(q/b.ByteSizeUnit.KILOBYTES**k,{maximumFractionDigits:2});
return u.replace(t.units.bytes[p[k]],{fileSize:q})};a.formatImperialArea=function(t,q,k,r=2,y="abbr"){const f=v.preferredImperialAreaUnit(q,k);return d(t,v.convertUnit(q,k,f),f,r,y)};a.formatImperialLength=function(t,q,k,r=2,y="abbr"){const f=v.preferredImperialLengthUnit(q,k);return d(t,v.convertUnit(q,k,f),f,r,y)};a.formatImperialRelativeLength=function(t,q,k,r=2,y="abbr"){const f=v.preferredImperialLengthUnit(q,k);return e(t,v.convertUnit(q,k,f),f,r,y)};a.formatImperialRelativeVerticalLength=function(t,
q,k,r=2,y="abbr"){const f=v.preferredImperialVerticalLengthUnit(q,k);return e(t,v.convertUnit(q,k,f),f,r,y)};a.formatImperialVerticalLength=function(t,q,k,r=2,y="abbr"){const f=v.preferredImperialVerticalLengthUnit(q,k);return d(t,v.convertUnit(q,k,f),f,r,y)};a.formatMetricArea=function(t,q,k,r=2,y="abbr"){const f=v.preferredMetricAreaUnit(q,k);return d(t,v.convertUnit(q,k,f),f,r,y)};a.formatMetricLength=function(t,q,k,r=2,y="abbr"){const f=v.preferredMetricLengthUnit(q,k);return d(t,v.convertUnit(q,
k,f),f,r,y)};a.formatMetricRelativeLength=function(t,q,k,r=2,y="abbr"){const f=v.preferredMetricLengthUnit(q,k);return e(t,v.convertUnit(q,k,f),f,r,y)};a.formatMetricRelativeVerticalLength=function(t,q,k,r=2,y="abbr"){const f=v.preferredMetricVerticalLengthUnit(q,k);return e(t,v.convertUnit(q,k,f),f,r,y)};a.formatMetricVerticalLength=function(t,q,k,r=2,y="abbr"){const f=v.preferredMetricVerticalLengthUnit(q,k);return d(t,v.convertUnit(q,k,f),f,r,y)};a.formatRelativeAngleDegrees=function(t,q,k,r,y){k!==
r&&(t=-t);t=v.convertUnit(t,q,"degrees")%360;y=l.unwrapOr(y,2);return m.formatNumber(t,{style:"unit",unitDisplay:"narrow",unit:"degree",maximumFractionDigits:y,minimumFractionDigits:y,signDisplay:"exceptZero"})};a.formatRelativeDecimal=e;a.unitName=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Attachments/AttachmentsViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../core/Accessor ../../core/Collection ../../core/Error ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../rest/query/support/AttachmentInfo ../../rest/support/AttachmentQuery ../Feature/support/featureUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){const r={editing:!1,operations:{add:!0,update:!0,delete:!0}},y=l.ofType(t);n=function(f){function w(A){var x=f.call(this,A)||this;x._getAttachmentsPromise=null;x._attachmentLayer=null;x.abilities={...r};x.activeAttachmentInfo=null;x.attachmentInfos=new y;x.graphic=null;x.mode="view";x.own(m.watch(()=>x.graphic,()=>x._graphicChanged(),m.initial));return x}a._inheritsLoose(w,f);var z=w.prototype;z.destroy=function(){this.graphic=this._attachmentLayer=null};
z.castAbilities=function(A){return{...r,...A}};z.getAttachments=function(){var A=a._asyncToGenerator(function*(){const {_attachmentLayer:x,attachmentInfos:B}=this;if(!x||"function"!==typeof x.queryAttachments)throw new u("invalid-layer","getAttachments(): A valid layer is required.");const C=this._getFeatureId();var D=new q({objectIds:[C],returnMetadata:!0});const E=[];this._getAttachmentsPromise=D=x.queryAttachments(D).then(F=>F[C]||E).catch(()=>E);this.notifyChange("state");D=yield D;B.removeAll();
D.length&&B.addMany(D);this._getAttachmentsPromise=null;this.notifyChange("state");return D});return function(){return A.apply(this,arguments)}}();z.addAttachment=function(){var A=a._asyncToGenerator(function*(x){const {_attachmentLayer:B,attachmentInfos:C,graphic:D,abilities:E}=this;if(!x)throw new u("invalid-attachment","addAttachment(): An attachment is required.",{attachment:x});if(!E.operations.add)throw new u("invalid-abilities","addAttachment(): add abilities are required.");if(!B||"function"!==
typeof B.addAttachment)throw new u("invalid-layer","addAttachment(): A valid layer is required.");x=yield B.addAttachment(D,x).then(F=>this._queryAttachment(F.objectId));C.add(x);return x});return function(x){return A.apply(this,arguments)}}();z.deleteAttachment=function(){var A=a._asyncToGenerator(function*(x){const {_attachmentLayer:B,attachmentInfos:C,graphic:D,abilities:E}=this;if(!x)throw new u("invalid-attachment-info","deleteAttachment(): An attachmentInfo is required.",{attachmentInfo:x});
if(!E.operations.delete)throw new u("invalid-abilities","deleteAttachment(): delete abilities are required.");if(!B||"function"!==typeof B.deleteAttachments)throw new u("invalid-layer","deleteAttachment(): A valid layer is required.");const F=yield B.deleteAttachments(D,[x.id]).then(()=>x);C.remove(F);return F});return function(x){return A.apply(this,arguments)}}();z.updateAttachment=function(){var A=a._asyncToGenerator(function*(x,B=this.activeAttachmentInfo){const {_attachmentLayer:C,attachmentInfos:D,
graphic:E,abilities:F}=this;if(!x)throw new u("invalid-attachment","updateAttachment(): An attachment is required.",{attachment:x});if(!B)throw new u("invalid-attachment-info","updateAttachment(): An attachmentInfo is required.",{attachmentInfo:B});if(!F.operations.update)throw new u("invalid-abilities","updateAttachment(): Update abilities are required.");const G=D.findIndex(O=>O===B);if(!C||"function"!==typeof C.updateAttachment)throw new u("invalid-layer","updateAttachment(): A valid layer is required.");
x=yield C.updateAttachment(E,B.id,x).then(O=>this._queryAttachment(O.objectId));D.splice(G,1,x);return x});return function(x){return A.apply(this,arguments)}}();z._queryAttachment=function(){var A=a._asyncToGenerator(function*(x){if(!x)throw new u("invalid-attachment-id","Could not query attachment.");const {_attachmentLayer:B}=this,C=this._getFeatureId();x=new q({objectIds:[C],attachmentsWhere:`AttachmentId=${x}`,returnMetadata:!0});return B.queryAttachments(x).then(D=>D[C][0])});return function(x){return A.apply(this,
arguments)}}();z._getFeatureId=function(){const {_attachmentLayer:A,graphic:x}=this;if(!A||!x)return null;const {objectIdField:B}=A,{attributes:C}=x;return C&&C[B]};z._graphicChanged=function(){this.graphic&&(this._setAttachmentLayer(),this.getAttachments().catch(()=>{}))};z._setAttachmentLayer=function(){var {graphic:A}=this;this._attachmentLayer=(A=k.getSourceLayer(A))?"scene"===A.type&&v.isSome(A.associatedLayer)?A.associatedLayer:A:null};a._createClass(w,[{key:"state",get:function(){return this._getAttachmentsPromise?
"loading":this.graphic?"ready":"disabled"}},{key:"supportsResizeAttachments",get:function(){return this.get("graphic.layer.capabilities.operations.supportsResizeAttachments")||!1}}]);return w}(n);b.__decorate([h.property()],n.prototype,"abilities",void 0);b.__decorate([g.cast("abilities")],n.prototype,"castAbilities",null);b.__decorate([h.property()],n.prototype,"activeAttachmentInfo",void 0);b.__decorate([h.property({readOnly:!0,type:y})],n.prototype,"attachmentInfos",void 0);b.__decorate([h.property({type:c})],
n.prototype,"graphic",void 0);b.__decorate([h.property()],n.prototype,"mode",void 0);b.__decorate([h.property({readOnly:!0})],n.prototype,"state",null);b.__decorate([h.property({readOnly:!0})],n.prototype,"supportsResizeAttachments",null);return n=b.__decorate([p.subclass("esri.widgets.Attachments.AttachmentsViewModel")],n)})},"esri/widgets/Feature/support/featureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../intl ../../../core/Logger ../../../core/maybe ../../../core/string ../../../intl/date ../../../intl/number ../../../layers/support/fieldUtils ../../../popup/support/FieldInfoFormat ../../../support/arcadeOnDemand".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(){g=b._asyncToGenerator(function*(aa,ea){return"function"===typeof aa?aa.call(null,ea):aa});return g.apply(this,arguments)}function p(aa){return aa?S.test(aa):!1}function t(aa,ea){if(!p(ea)||!aa)return null;const ia=ea.replace(S,"").toLowerCase();let ka;aa.some(la=>la.name.toLowerCase()===ia?(ka=la,!0):!1);return ka}function q(aa,ea){return(ea=k(ea,aa))?ea.name:aa}function k(aa,ea){return aa&&"function"===typeof aa.getField?aa.getField(ea):null}function r({formattedAttributes:aa,
template:ea,fieldInfoMap:ia}){return`${u.replace(u.replace(ea,ka=>{{const la=ia.get(ka.toLowerCase());ka=`{${la&&la.fieldName||ka}}`}return ka}),aa).replace(P,"")}`.trim()}function y(aa,ea,ia=!1){const ka=ea[aa];"string"===typeof ka&&(ia=(ia?encodeURIComponent(ka):ka).replace(V,"%27"),ea[aa]=ia)}function f(aa,ea=!1){const ia={...aa};Object.keys(ia).forEach(ka=>y(ka,ia,ea));return ia}function w(aa,ea){return aa.replace(N,(ia,ka,la)=>(ia=k(ea,la))?`{${ia.name}}`:ka)}function z(aa,ea,ia){return(aa=w(aa,
ia))?aa.replace(U,(ka,la,Z)=>{la=`${la||Z}`.trim();return u.replace(ka,f(ea,la&&"{"!==la[0]))}):aa}function A(aa,ea){var ia=ea.fieldName,ka=x(ea.fieldInfos,ia),la=null==ka?void 0:ka.clone();ka=ea.preventPlacesFormatting;ea=ea.layer;var Z=k(ea,ia);if(la&&"date"===(null==Z?void 0:Z.type)){Z=la.format||new d;Z.dateFormat=Z.dateFormat||"short-date-short-time";var ca;if(!(ca=!(null!=ea&&ea.layer)&&"feature"===(null==ea?void 0:ea.type)&&ea.datesInUnknownTimezone)){if(ca=!(null==ea||!ea.layer))ca=ea.layer,
ca="map-image"===(null==ca?void 0:ca.type);ca=ca&&ea.layer.datesInUnknownTimezone}Z.dateTimeFormatOptions=ca?{timeZone:"UTC"}:null;la.format=Z}la=la&&la.format;if("string"===typeof aa&&h.isRasterPixelValueField(ia)&&la)return la.formatRasterPixelValue(aa);"string"!==typeof aa||!la||null!=la.dateFormat||null==la.places&&null==la.digitSeparator||(ia=Number(aa),isNaN(ia)||(aa=ia));return"string"===typeof aa||null==aa||null==la?D(aa):ka?m.formatNumber(aa,{...m.convertNumberFormatToIntlOptions(la),minimumFractionDigits:0,
maximumFractionDigits:20}):la.format(aa)}function x(aa,ea){if(aa&&aa.length&&ea){var ia=ea.toLowerCase(),ka=void 0;aa.some(la=>la.fieldName&&la.fieldName.toLowerCase()===ia?(ka=la,!0):!1);return ka}}function B({fieldName:aa,graphic:ea,layer:ia}){if(R(aa)||!ia||"function"!==typeof ia.getFeatureType)return null;const {typeIdField:ka}=ia;return ka&&aa===ka?(aa=ia.getFeatureType(ea))?aa.name:null:null}function C({fieldName:aa,value:ea,graphic:ia,layer:ka}){return R(aa)||!ka||"function"!==typeof ka.getFieldDomain?
null:(aa=ka.getFieldDomain(aa,{feature:ia}))&&"coded-value"===aa.type?aa.getName(ea):null}function D(aa){return"string"===typeof aa?aa.replace(T,'\x3cbr class\x3d"esri-text-new-line" /\x3e'):aa}function E(aa){const {value:ea,fieldName:ia,fieldInfos:ka,fieldInfoMap:la,layer:Z,graphic:ca}=aa;return null==ea?"":(aa=C({fieldName:ia,value:ea,graphic:ca,layer:Z}))||(aa=B({fieldName:ia,graphic:ca,layer:Z}))?aa:la.get(ia.toLowerCase())?A(ea,{fieldInfos:ka||Array.from(la.values()),fieldName:ia,layer:Z}):(aa=
Z&&Z.fieldsIndex)&&aa.isDateField(ia)?v.formatDate(ea,Q):D(ea)}function F(aa,ea){return G.apply(this,arguments)}function G(){G=b._asyncToGenerator(function*(aa,ea){var ia,ka;const {layer:la,graphic:Z,outFields:ca,objectIds:Y,returnGeometry:da,spatialReference:ha}=aa;aa=Y[0];if("number"!==typeof aa&&"string"!==typeof aa)return I.warn("Could not query required fields for the specified feature. The feature's ID is invalid.",{layer:la,graphic:Z,objectId:aa,requiredFields:ca}),null;if(null==(ia=la.capabilities)||
null==(ka=ia.operations)||!ka.supportsQuery)return I.warn("The specified layer cannot be queried. The following fields will not be available.",{layer:la,graphic:Z,requiredFields:ca,returnGeometry:da}),null;ia=la.createQuery();ia.objectIds=Y;ia.outFields=null!=ca&&ca.length?ca:[la.objectIdField];ia.returnGeometry=!!da;ia.returnZ=!!da;ia.returnM=!!da;ia.outSpatialReference=ha;return(yield la.queryFeatures(ia,ea)).features[0]});return G.apply(this,arguments)}function O(aa){return K.apply(this,arguments)}
function K(){K=b._asyncToGenerator(function*(aa){var ea;if(null==(ea=aa.expressionInfos)||!ea.length)return!1;ea=yield e.loadArcade();({arcadeUtils:{hasGeometryFunctions:ea}}=ea);return ea(aa)});return K.apply(this,arguments)}function L(){L=b._asyncToGenerator(function*({graphic:aa,popupTemplate:ea,layer:ia,spatialReference:ka},la){if(ia&&ea&&("function"===typeof ia.load&&(yield ia.load(la)),aa.attributes)){var Z=aa.attributes[ia.objectIdField];if(null!=Z){Z=[Z];var ca=yield ea.getRequiredFields(ia.fieldsIndex),
Y=h.featureHasFields(ca,aa);ca=Y?[]:ca;ea=ea.returnGeometry||(yield O(ea));if(!Y||ea)if(ia=yield F({layer:ia,graphic:aa,outFields:ca,objectIds:Z,returnGeometry:ea,spatialReference:ka},la))ia.geometry&&(aa.geometry=ia.geometry),ia.attributes&&(aa.attributes={...aa.attributes,...ia.attributes})}}});return L.apply(this,arguments)}function R(aa=""){return aa?aa.includes("relationships/"):!1}function M({attributes:aa,graphic:ea,relatedInfo:ia,fieldInfos:ka,fieldInfoMap:la,layer:Z}){aa&&ea&&ia&&Object.keys(ea.attributes).forEach(ca=>
{var Y=(Y={layerId:ia.relation.id.toString(),fieldName:ca},`${"relationships/"}${Y.layerId}/${Y.fieldName}`);aa[Y]=E({fieldName:Y,fieldInfos:ka,fieldInfoMap:la,layer:Z,value:ea.attributes[ca],graphic:ea})})}function J({attributes:aa,relatedInfo:ea,fieldInfoMap:ia,fieldInfos:ka,layer:la}){aa&&ea&&(ea.relatedFeatures&&ea.relatedFeatures&&ea.relatedFeatures.forEach(Z=>M({attributes:aa,graphic:Z,relatedInfo:ea,fieldInfoMap:ia,fieldInfos:ka,layer:la})),ea.relatedStatsFeatures&&ea.relatedStatsFeatures&&
ea.relatedStatsFeatures.forEach(Z=>M({attributes:aa,graphic:Z,relatedInfo:ea,fieldInfoMap:ia,fieldInfos:ka,layer:la})))}const I=n.getLogger("esri.widgets.Feature.support.featureUtils"),P=/href=(""|'')/gi,N=/(\{([^\{\r\n]+)\})/g,V=/'/g,S=/^\s*expression\//i,T=/(\n)/gi,H=/[\u00A0-\u9999<>&]/gim,U=/href\s*=\s*(?:"([^"]+)"|'([^']+)')/gi,W=/^(?:mailto:|tel:)/,Q=v.convertDateFormatToIntlOptions("short-date-short-time"),X=aa=>{if(!aa)return!1;aa=aa.toUpperCase();return aa.includes("CURRENT_TIMESTAMP")||
aa.includes("CURRENT_DATE")||aa.includes("CURRENT_TIME")},ba=({layer:aa,method:ea,query:ia,definitionExpression:ka})=>{var la,Z;null!=(la=aa.capabilities)&&null!=(Z=la.query)&&Z.supportsCacheHint&&"attachments"!==ea&&(aa=l.isSome(ia.where)&&ia.where,ea=l.isSome(ia.geometry)&&ia.geometry,X(ka)||X(aa)||"extent"===(null==ea?void 0:ea.type)||"tile"===ia.resultType||(ia.cacheHint=!0))};a.applyTextFormattingHTML=D;a.createfieldInfoMap=function(aa,ea){const ia=new Map;aa&&aa.forEach(ka=>{const la=q(ka.fieldName,
ea);ka.fieldName=la;ia.set(la.toLowerCase(),ka)});return ia};a.fixTokens=w;a.formatAttributes=function({fieldInfos:aa,attributes:ea,layer:ia,graphic:ka,fieldInfoMap:la,relatedInfos:Z}){const ca={};null==Z?void 0:Z.forEach(Y=>J({attributes:ca,relatedInfo:Y,fieldInfoMap:la,fieldInfos:aa,layer:ia}));Object.keys(ea).forEach(Y=>{ca[Y]=E({fieldName:Y,fieldInfos:aa,fieldInfoMap:la,layer:ia,value:ea[Y],graphic:ka})});return ca};a.formatEditInfo=function(aa,ea){const {creatorField:ia,creationDateField:ka,
editorField:la,editDateField:Z}=aa;if(ea){aa=ea[Z];if("number"===typeof aa)return ea=ea[la],{type:"edit",date:v.formatDate(aa,Q),user:ea};aa=ea[ka];return"number"===typeof aa?(ea=ea[ia],{type:"create",date:v.formatDate(aa,Q),user:ea}):null}};a.formatValueToFieldInfo=A;a.getAllFieldInfos=function(aa){const ea=[];if(!aa)return ea;const {fieldInfos:ia,content:ka}=aa;ia&&ea.push(...ia);if(!ka||!Array.isArray(ka))return ea;ka.forEach(la=>{"fields"===la.type&&(la=la&&la.fieldInfos)&&ea.push(...la)});return ea};
a.getFieldInfo=x;a.getFieldInfoLabel=function(aa,ea){return(ea=t(ea,null==aa?void 0:aa.fieldName))?ea.title||null:aa?aa.label||aa.fieldName:null};a.getFixedFieldName=q;a.getFixedFieldNames=function(aa,ea){return aa&&aa.map(ia=>q(ia,ea))};a.getSourceLayer=function(aa){if(!l.isNone(aa))return aa.get("sourceLayer")||aa.get("layer")};a.graphicCallback=function(aa,ea){return g.apply(this,arguments)};a.htmlEntities=function(aa){return aa.replace(H,ea=>`&#${ea.charCodeAt(0)};`)};a.isExpressionField=p;a.isRelatedField=
R;a.preLayerQueryCallback=({query:aa,layer:ea,method:ia})=>{ba({layer:ea,method:ia,query:aa,definitionExpression:`${ea.definitionExpression} ${ea.serviceDefinitionExpression}`})};a.preRequestCallback=({queryPayload:aa,layer:ea,method:ia})=>{ba({layer:ea,method:ia,query:aa,definitionExpression:`${ea.definitionExpression} ${ea.serviceDefinitionExpression}`})};a.queryUpdatedFeature=function(aa,ea){return L.apply(this,arguments)};a.shouldOpenInNewTab=function(aa=""){if(aa)return!W.test(aa.trim().toLowerCase())};
a.substituteAttributes=r;a.substituteFieldsInLinksAndAttributes=function({attributes:aa,globalAttributes:ea,layer:ia,text:ka,expressionAttributes:la,fieldInfoMap:Z}){return ka?r({formattedAttributes:ea,template:z(ka,{...ea,...la,...aa},ia),fieldInfoMap:Z}):""};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Attachments/support/attachmentUtils":function(){define(["exports","../../../assets"],function(a,b){a.getIconPath=function(c){const n=b.getAssetUrl("esri/themes/base/images/files/");
return c?"text/plain"===c?`${n}text-32.svg`:"application/pdf"===c?`${n}pdf-32.svg`:"text/csv"===c?`${n}csv-32.svg`:"application/gpx+xml"===c?`${n}gpx-32.svg`:"application/x-dwf"===c?`${n}cad-32.svg`:"application/postscript"===c||"application/json"===c||"text/xml"===c||"model/vrml"===c?`${n}code-32.svg`:"application/x-zip-compressed"===c||"application/x-7z-compressed"===c||"application/x-gzip"===c||"application/x-tar"===c||"application/x-gtar"===c||"application/x-bzip2"===c||"application/gzip"===c||
"application/x-compress"===c||"application/x-apple-diskimage"===c||"application/x-rar-compressed"===c||"application/zip"===c?`${n}zip-32.svg`:c.includes("image/")?`${n}image-32.svg`:c.includes("audio/")?`${n}sound-32.svg`:c.includes("video/")?`${n}video-32.svg`:c.includes("msexcel")||c.includes("ms-excel")||c.includes("spreadsheetml")?`${n}excel-32.svg`:c.includes("msword")||c.includes("ms-word")||c.includes("wordprocessingml")?`${n}word-32.svg`:c.includes("powerpoint")||c.includes("presentationml")?
`${n}report-32.svg`:`${n}generic-32.svg`:`${n}generic-32.svg`};a.isSupportedImage=function(c){c=c.toLowerCase();return"image/bmp"===c||"image/emf"===c||"image/exif"===c||"image/gif"===c||"image/x-icon"===c||"image/jpeg"===c||"image/png"===c||"image/tiff"===c||"image/x-wmf"===c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureAttachments/FeatureAttachmentsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Attachments/AttachmentsViewModel".split(" "),
function(a,b,c,n,l,u,v,m){n=function(h){function d(e){e=h.call(this,e)||this;e.description=null;e.title=null;return e}a._inheritsLoose(d,h);return d}(m);b.__decorate([c.property()],n.prototype,"description",void 0);b.__decorate([c.property()],n.prototype,"title",void 0);return n=b.__decorate([v.subclass("esri.widgets.Feature.FeatureAttachments.FeatureAttachmentsViewModel")],n)})},"esri/widgets/Feature/support/FeatureElementInfo":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../Widget ../../support/Heading ../../support/widgetUtils ../../support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){n=function(g){function p(q,k){q=g.call(this,q,k)||this;q.description=null;q.headingLevel=2;q.title=null;return q}a._inheritsLoose(p,g);var t=p.prototype;t.render=function(){return e.tsx("div",{class:"esri-feature-element-info"},this.renderTitle(),this.renderDescription())};t.renderTitle=function(){const {title:q}=this;return q?e.tsx(h.Heading,{level:this.headingLevel,class:"esri-feature-element-info__title"},q):null};t.renderDescription=function(){const {description:q}=
this;return q?e.tsx("div",{key:"description",class:"esri-feature-element-info__description"},q):null};return p}(m);b.__decorate([c.property()],n.prototype,"description",void 0);b.__decorate([c.property()],n.prototype,"headingLevel",void 0);b.__decorate([c.property()],n.prototype,"title",void 0);return n=b.__decorate([v.subclass("esri.widgets.Feature.support.FeatureElementInfo")],n)})},"esri/widgets/support/Heading":function(){define(["exports","../../core/mathUtils","./widgetUtils","./jsxFactory"],
function(a,b,c,n){const l={heading:"esri-widget__heading"};a.CSS=l;a.Heading=function(u,v){const m=b.clamp(Math.ceil(u.level),1,6),h=`h${m}`;delete u.level;return n.tsx(h,{...u,class:c.classes(l.heading,u.class),role:"heading","aria-level":String(m)},v)};a.incrementHeadingLevel=function(u,v=1){return b.clamp(Math.ceil(u+v),1,6)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureContent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent/FeatureContentViewModel ./support/featureUtils ../support/widget ../support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){n=function(t){function q(r,y){r=t.call(this,r,y)||this;r.creator=null;r.graphic=null;r.viewModel=null;r._addTargetToAnchors=f=>{Array.from(f.querySelectorAll("a")).forEach(w=>{e.shouldOpenInNewTab(w.href)&&!w.hasAttribute("target")&&w.setAttribute("target","_blank")})};return r}a._inheritsLoose(q,t);var k=q.prototype;k.renderLoading=function(){return p.tsx("div",{class:"esri-feature-content__loader-container",key:"loader"},p.tsx("div",{class:"esri-feature-content__loader"}))};
k.renderCreated=function(){var r;const y=null==(r=this.viewModel)?void 0:r.created;return y?y instanceof HTMLElement?p.tsx("div",{key:y,bind:y,afterCreate:this._attachToNode}):g.isWidget(y)?p.tsx("div",{key:y},!y.destroyed&&y.render()):p.tsx("div",{key:y,innerHTML:y,afterCreate:this._addTargetToAnchors}):null};k.render=function(){var r;const y=null==(r=this.viewModel)?void 0:r.state;return p.tsx("div",{class:"esri-feature-content"},"loading"===y?this.renderLoading():this.renderCreated())};k._attachToNode=
function(r){r.appendChild(this)};return q}(h);b.__decorate([c.aliasOf("viewModel.creator")],n.prototype,"creator",void 0);b.__decorate([c.aliasOf("viewModel.graphic")],n.prototype,"graphic",void 0);b.__decorate([v.property({type:d})],n.prototype,"viewModel",void 0);return n=b.__decorate([m.subclass("esri.widgets.Feature.FeatureContent")],n)})},"esri/widgets/Feature/FeatureContent/FeatureContentViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../support/featureUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){n=function(p){function t(k){var r=p.call(this,k)||this;r._loadingPromise=null;r.created=null;r.creator=null;r.destroyer=null;r.graphic=null;r.handles.add(u.watch(()=>r.creator,y=>{r._destroyContent();r._createContent(y)},u.initial));return r}a._inheritsLoose(t,p);var q=t.prototype;q.destroy=function(){this._destroyContent()};q._destroyContent=function(){const {created:k,graphic:r,destroyer:y}=this;k&&(g.graphicCallback(y,{graphic:r}).catch(()=>null),this._set("created",
null))};q._createContent=function(){var k=a._asyncToGenerator(function*(r){var {graphic:y}=this;this._loadingPromise=r=g.graphicCallback(r,{graphic:y}).catch(()=>null);this.notifyChange("state");y=yield r;r===this._loadingPromise&&(this._loadingPromise=null,this.notifyChange("state"),this._set("created",y))});return function(r){return k.apply(this,arguments)}}();a._createClass(t,[{key:"state",get:function(){return this._loadingPromise?"loading":"ready"}}]);return t}(l.HandleOwnerMixin(n));b.__decorate([v.property({readOnly:!0})],
n.prototype,"created",void 0);b.__decorate([v.property()],n.prototype,"creator",void 0);b.__decorate([v.property()],n.prototype,"destroyer",void 0);b.__decorate([v.property({type:c})],n.prototype,"graphic",void 0);b.__decorate([v.property({readOnly:!0})],n.prototype,"state",null);return n=b.__decorate([e.subclass("esri.widgets.Feature.FeatureContent.FeatureContentViewModel")],n)})},"esri/widgets/Feature/FeatureExpression":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureContent ./FeatureFields ./FeatureMedia ./FeatureExpression/FeatureExpressionViewModel ../support/widgetUtils ../support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){l=function(k){function r(f,w){f=k.call(this,f,w)||this;f.viewModel=new p;return f}a._inheritsLoose(r,k);var y=r.prototype;y.initialize=function(){this.own(c.watch(()=>{var f;return null==(f=this.viewModel)?void 0:f.contentElementViewModel},()=>this._setupExpressionWidget(),c.initial))};y.destroy=function(){this._destroyContentWidget()};y.renderLoading=function(){return q.tsx("div",{key:"loading-container",class:"esri-feature__loading-container"},q.tsx("span",
{class:this.classes("esri-icon-loading-indicator esri-rotating","esri-feature__loading-spinner")}))};y.render=function(){var f;const {state:w}=this.viewModel;return q.tsx("div",{class:"esri-feature-expression"},"loading"===w?this.renderLoading():"disabled"===w?null:null==(f=this._contentWidget)?void 0:f.render())};y._destroyContentWidget=function(){const {_contentWidget:f}=this;f&&(f.viewModel=null,f.destroy());this._contentWidget=null};y._setupExpressionWidget=function(){const {contentElementViewModel:f,
contentElement:w}=this.viewModel,z=null==w?void 0:w.type;this._destroyContentWidget();this._contentWidget=f?"fields"===z?new e({viewModel:f}):"media"===z?new g({viewModel:f}):"text"===z?new d({viewModel:f}):null:null;this.scheduleRender()};return r}(h);b.__decorate([n.property({type:p})],l.prototype,"viewModel",void 0);return l=b.__decorate([m.subclass("esri.widgets.Feature.FeatureExpression")],l)})},"esri/widgets/Feature/FeatureFields":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../Widget ./FeatureFields/FeatureFieldsViewModel ./support/FeatureElementInfo ../support/uriUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){l=function(r){function y(w,z){w=r.call(this,w,z)||this;w._featureElementInfo=null;w.attributes=null;w.description=null;w.expressionInfos=null;w.fieldInfos=null;w.title=null;w.viewModel=new e;w.messages=null;w.messagesURIUtils=null;return w}a._inheritsLoose(y,r);var f=y.prototype;f.initialize=function(){this._featureElementInfo=new g;this.own(c.watch(()=>{var w,z;return[null==(w=this.viewModel)?void 0:w.description,null==(z=this.viewModel)?void 0:z.title]},
()=>this._setupFeatureElementInfo(),c.initial))};f.destroy=function(){this._featureElementInfo.destroy()};f.renderFieldInfo=function(w,z){var {attributes:A}=this.viewModel;const x=w.fieldName,B=w.label||x;A=A?null==A[x]?"":A[x]:"";w=!(!w.format||!w.format.dateFormat);A="number"!==typeof A||w?p.autoLink(this.messagesURIUtils,A):this._forceLTR(A);w={["esri-feature-fields__field-data--date"]:w};return k.tsx("tr",{key:`fields-element-info-row-${x}-${z}`},k.tsx("th",{key:`fields-element-info-row-header-${x}-${z}`,
class:"esri-feature-fields__field-header",innerHTML:B}),k.tsx("td",{key:`fields-element-info-row-data-${x}-${z}`,class:this.classes("esri-feature-fields__field-data",w),innerHTML:A}))};f.renderFields=function(){const {formattedFieldInfos:w}=this.viewModel;return null!=w&&w.length?k.tsx("table",{class:"esri-widget__table",summary:this.messages.fieldsSummary},k.tsx("tbody",null,w.map((z,A)=>this.renderFieldInfo(z,A)))):null};f.render=function(){var w;return k.tsx("div",{class:"esri-feature-fields"},
null==(w=this._featureElementInfo)?void 0:w.render(),this.renderFields())};f._setupFeatureElementInfo=function(){const {description:w,title:z}=this;this._featureElementInfo.set({description:w,title:z})};f._forceLTR=function(w){return`&lrm;${w}`};return y}(d);b.__decorate([n.aliasOf("viewModel.attributes")],l.prototype,"attributes",void 0);b.__decorate([n.aliasOf("viewModel.description")],l.prototype,"description",void 0);b.__decorate([n.aliasOf("viewModel.expressionInfos")],l.prototype,"expressionInfos",
void 0);b.__decorate([n.aliasOf("viewModel.fieldInfos")],l.prototype,"fieldInfos",void 0);b.__decorate([n.aliasOf("viewModel.title")],l.prototype,"title",void 0);b.__decorate([m.property({type:e})],l.prototype,"viewModel",void 0);b.__decorate([m.property(),q.messageBundle("esri/widgets/Feature/t9n/Feature")],l.prototype,"messages",void 0);b.__decorate([m.property(),q.messageBundle("esri/widgets/support/t9n/uriUtils")],l.prototype,"messagesURIUtils",void 0);return l=b.__decorate([h.subclass("esri.widgets.Feature.FeatureFields")],
l)})},"esri/widgets/Feature/FeatureFields/FeatureFieldsViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/ExpressionInfo ../../../popup/FieldInfo ../support/featureUtils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){c=function(g){function p(t){t=
g.call(this,t)||this;t.attributes=null;t.expressionInfos=null;t.description=null;t.fieldInfos=null;t.title=null;return t}a._inheritsLoose(p,g);a._createClass(p,[{key:"formattedFieldInfos",get:function(){const {expressionInfos:t,fieldInfos:q}=this,k=[];null==q?void 0:q.forEach(r=>{if(!r.hasOwnProperty("visible")||r.visible)r=r.clone(),r.label=e.getFieldInfoLabel(r,t),k.push(r)});return k}}]);return p}(c);b.__decorate([n.property()],c.prototype,"attributes",void 0);b.__decorate([n.property({type:[h]})],
c.prototype,"expressionInfos",void 0);b.__decorate([n.property()],c.prototype,"description",void 0);b.__decorate([n.property({type:[d]})],c.prototype,"fieldInfos",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"formattedFieldInfos",null);b.__decorate([n.property()],c.prototype,"title",void 0);return c=b.__decorate([m.subclass("esri.widgets.Feature.FeatureFields.FeatureFieldsViewModel")],c)})},"esri/widgets/support/uriUtils":function(){define(["exports","../../core/string"],function(a,
b){function c(l){let u=null;n.some(v=>{v.pattern.test(l)&&(u=v);return!!u});return u}const n=[{pattern:/^\s*(https?:\/\/([^\s]+))\s*$/i,target:"_blank",label:"{messages.view}"},{pattern:/^\s*(tel:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(mailto:([^\s]+))\s*$/i,label:"{hierPart}"},{pattern:/^\s*(arcgis-appstudio-player:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"App Studio Player"},{pattern:/^\s*(arcgis-collector:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Collector"},
{pattern:/^\s*(arcgis-explorer:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Explorer"},{pattern:/^\s*(arcgis-navigator:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Navigator"},{pattern:/^\s*(arcgis-survey123:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Survey123"},{pattern:/^\s*(arcgis-trek2there:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Trek2There"},{pattern:/^\s*(arcgis-workforce:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Workforce"},
{pattern:/^\s*(iform:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"iForm"},{pattern:/^\s*(flow:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"FlowFinity"},{pattern:/^\s*(lfmobile:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Laserfische"},{pattern:/^\s*(mspbi:\/\/([^\s]+))\s*$/i,label:"{messages.openInApp}",appName:"Microsoft Power Bi"}];a.autoLink=function(l,u){if("string"!==typeof u||!u)return u;const v=c(u);if(!v)return u;const m=u.match(v.pattern);l=b.replace(b.replace(v.label,
{messages:l,hierPart:m&&m[2]}),{appName:v.appName});return u.replace(v.pattern,`<a${v.target?` target="${v.target}"`:""} href="$1"${"_blank"===v.target?' rel\x3d"noreferrer"':""}>${l}</a>`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureMedia":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/events ../../core/reactiveUtils ../../core/accessorSupport/decorators/aliasOf ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/subclass ../../renderers/support/utils ../Widget ./FeatureMedia/FeatureMediaViewModel ./support/FeatureElementInfo ./support/featureUtils ../support/chartUtils ../support/widgetUtils ../support/decorators/messageBundle ../support/jsxFactory ../../support/themeUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){u=function(z){function A(B,C){var D=z.call(this,B,C)||this;D._refreshTimer=null;D._refreshIntervalInfo=null;D._featureElementInfo=null;D.attributes=null;D.activeMediaInfoIndex=null;D.description=null;D.fieldInfoMap=null;D.layer=null;D.mediaInfos=null;D.popupTemplate=null;D.relatedInfos=null;D.title=null;D.viewModel=new p;D.messages=null;D._getChartDependencies=function(){var E=a._asyncToGenerator(function*(F){const G=yield k.loadChartsModule(),{destroyed:O,
viewModel:K}=a._assertThisInitialized(D);if(!O&&K&&F){var {activeMediaInfo:L}=K,R=yield D._getRendererColors(G);D._renderChart({chartDiv:F,mediaInfo:L,chartsModule:G,colorMap:R})}});return function(F){return E.apply(this,arguments)}}();return D}a._inheritsLoose(A,z);var x=A.prototype;x.initialize=function(){this._featureElementInfo=new t;this.own([n.watch(()=>{var B,C;return[null==(B=this.viewModel)?void 0:B.activeMediaInfo,null==(C=this.viewModel)?void 0:C.activeMediaInfoIndex]},()=>this._setupMediaRefreshTimer(),
n.initial),n.watch(()=>{var B,C;return[null==(B=this.viewModel)?void 0:B.description,null==(C=this.viewModel)?void 0:C.title]},()=>this._setupFeatureElementInfo(),n.initial)])};x.destroy=function(){this._clearMediaRefreshTimer();this._featureElementInfo.destroy()};x.render=function(){var B;return f.tsx("div",{bind:this,class:"esri-feature-media",onkeyup:this._handleMediaKeyup},null==(B=this._featureElementInfo)?void 0:B.render(),this.renderMedia())};x.renderMedia=function(){const {formattedMediaInfoCount:B}=
this.viewModel;return B?f.tsx("div",{key:"media-element-container",class:"esri-feature-media__container"},this.renderMediaPageButton("previous"),this.renderMediaInfo(),this.renderMediaPageButton("next")):null};x.renderImageMediaInfo=function(B){var {_refreshIntervalInfo:C}=this;const {activeMediaInfoIndex:D,formattedMediaInfoCount:E}=this.viewModel,{value:F,refreshInterval:G,altText:O,title:K,type:L}=B,{sourceURL:R,linkURL:M}=F;B=q.shouldOpenInNewTab(M)?"_blank":"_self";const J="_blank"===B?"noreferrer":
"";C=G?C:null;C=f.tsx("img",{alt:O||K,key:`media-${L}-${D}-${E}-${C?C.timestamp:0}`,src:C?C.sourceURL:R});return(B=M?f.tsx("a",{title:K,href:M,rel:J,target:B},C):null)?B:C};x.renderChartMediaInfo=function(B){const {activeMediaInfoIndex:C,formattedMediaInfoCount:D}=this.viewModel;return f.tsx("div",{key:`media-${B.type}-${C}-${D}`,bind:this,class:"esri-feature-media__chart",afterCreate:this._getChartDependencies})};x.renderMediaInfoType=function(){const {activeMediaInfo:B}=this.viewModel;return B?
"image"===B.type?this.renderImageMediaInfo(B):B.type.includes("chart")?this.renderChartMediaInfo(B):null:null};x.renderMediaInfo=function(){var {activeMediaInfo:B}=this.viewModel;if(!B)return null;const C=B.title?f.tsx("div",{key:"media-title",class:"esri-feature-media__item-title",innerHTML:B.title}):null;B=B.caption?f.tsx("div",{key:"media-caption",class:"esri-feature-media__item-caption",innerHTML:B.caption}):null;return f.tsx("div",{key:"media-container",class:"esri-feature-media__item-container"},
f.tsx("div",{key:"media-item-container",class:"esri-feature-media__item"},this.renderMediaInfoType()),C,B)};x.renderMediaPageButton=function(B){if(2>this.viewModel.formattedMediaInfoCount)return null;const C=(B="previous"===B)?this.messages.previous:this.messages.next,D=B?this.classes("esri-feature-media__button","esri-feature-media__previous"):this.classes("esri-feature-media__button","esri-feature-media__next"),E=B?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon","esri-icon-left-triangle-arrow"):
this.classes("esri-feature-media__icon","esri-feature-media__next-icon","esri-icon-right-triangle-arrow"),F=B?this.classes("esri-feature-media__icon","esri-feature-media__previous-icon--rtl","esri-icon-right-triangle-arrow"):this.classes("esri-feature-media__icon","esri-feature-media__next-icon--rtl","esri-icon-left-triangle-arrow");return f.tsx("button",{type:"button",key:B?"media-previous":"media-next",title:C,"aria-label":C,tabIndex:0,class:D,bind:this,onclick:B?this._previous:this._next},f.tsx("span",
{"aria-hidden":"true",class:E}),f.tsx("span",{"aria-hidden":"true",class:F}))};x._setupFeatureElementInfo=function(){const {description:B,title:C}=this;this._featureElementInfo.set({description:B,title:C})};x._next=function(){this.viewModel.next()};x._previous=function(){this.viewModel.previous()};x._getRendererColors=function(){var B=a._asyncToGenerator(function*(C){var D;const {am4core:E}=C;C=null==(D=this.viewModel)?void 0:D.layer;const F=new Map;if(!C)return F;const G=yield e.getColorsFromRenderer(C.renderer);
G.delete(null);if(!Array.from(G.values()).every(O=>1===(null==O?void 0:O.length)))return F;F.set("default-line-value",E.color({r:50,g:50,b:50,a:1}));Array.from(G.keys()).forEach(O=>{O&&F.set(O,E.color(G.get(O)[0].toCss(!0)))});return F});return function(C){return B.apply(this,arguments)}}();x._handleMediaKeyup=function(B){const C=c.eventKey(B);"ArrowLeft"===C&&(B.stopPropagation(),this.viewModel.previous());"ArrowRight"===C&&(B.stopPropagation(),this.viewModel.next())};x._renderChart=function(B){const {abilities:C}=
this.viewModel,{chartsModule:D,chartDiv:E,mediaInfo:F,colorMap:G}=B,{value:O,type:K}=F,{am4core:L}=D,R=k.getColorSet(L);w.isDarkTheme()&&L.useTheme(D.am4themes_dark);const M=window.matchMedia("(prefers-reduced-motion: reduce)");C.chartAnimation&&!M.matches?L.useTheme(D.am4themes_animated):L.unuseTheme(D.am4themes_animated);L.useTheme(function(J){J instanceof L.ColorSet&&R&&(J.list=R)});B="pie-chart"===K?this._createPieChart(B):this._createXYChart(B);E.setAttribute("aria-label",F.altText||F.title);
B.data=O.series.map(J=>({["tooltip"]:J.tooltip,["value"]:J.value,["color"]:G.get(J.fieldName)})).filter(J=>"pie-chart"===K?0<J.value:!0)};x._customizeChartTooltip=function(B,C){B.label.wrap=!0;B.label.maxWidth=200;B.autoTextColor=!1;B.getFillFromObject=!1;B.label.fill=C.color("#ffffff");B.background.fill=C.color({r:0,g:0,b:0,a:.7})};x._createPieChart=function(B){const {chartDiv:C,chartsModule:D}=B,{am4core:E,am4charts:F}=D;B=E.create(C,F.PieChart);B.rtl=r.isRTL(this.container);const G=B.series.push(new F.PieSeries);
G.labels.template.disabled=!0;G.ticks.template.disabled=!0;G.dataFields.value="value";G.dataFields.category="tooltip";this._customizeChartTooltip(G.tooltip,E);G.slices.template.tooltipText=B.rtl?"{category}: %{value.percent.formatNumber('#.0')}":"{category}: {value.percent.formatNumber('#.0')}%";G.slices.template.propertyFields.fill="color";G.slices.template.propertyFields.stroke="color";return B};x._getMinSeriesValue=function(B){let C=0;B.forEach(D=>C=Math.min(D.value,C));return C};x._createColumnChart=
function(B,C){const {chartsModule:D,mediaInfo:E}=C;({value:C}=E);const {am4core:F,am4charts:G}=D,O=B.xAxes.push(new G.CategoryAxis);O.dataFields.category="tooltip";O.renderer.labels.template.disabled=!0;this._customizeChartTooltip(O.tooltip,F);O.tooltip.events.on("sizechanged",()=>{O.tooltip.dy=-O.tooltip.contentHeight});var K=B.yAxes.push(new G.ValueAxis);const L=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(C.series);this._customizeChartTooltip(K.tooltip,
F);L.wrap=!0;K=B.series.push(new G.ColumnSeries);K.dataFields.valueY="value";K.dataFields.categoryX="tooltip";K.columns.template.propertyFields.fill="color";K.columns.template.propertyFields.stroke="color";B.cursor=new G.XYCursor;15<C.series.length&&(B.scrollbarX=new F.Scrollbar)};x._createBarChart=function(B,C){const {chartsModule:D,mediaInfo:E}=C;({value:C}=E);const {am4core:F,am4charts:G}=D,O=B.yAxes.push(new G.CategoryAxis);O.dataFields.category="tooltip";O.renderer.inversed=!0;O.renderer.labels.template.disabled=
!0;this._customizeChartTooltip(O.tooltip,F);O.tooltip.events.on("sizechanged",()=>{O.tooltip.dx=O.tooltip.contentWidth});var K=B.xAxes.push(new G.ValueAxis);const L=K.renderer.labels.template;K.renderer.minLabelPosition=.05;K.renderer.maxLabelPosition=.95;K.min=this._getMinSeriesValue(C.series);this._customizeChartTooltip(K.tooltip,F);L.wrap=!0;K=B.series.push(new G.ColumnSeries);K.dataFields.valueX="value";K.dataFields.categoryY="tooltip";K.columns.template.propertyFields.fill="color";K.columns.template.propertyFields.stroke=
"color";B.cursor=new G.XYCursor;15<C.series.length&&(B.scrollbarY=new F.Scrollbar)};x._createLineChart=function(B,C){const {chartsModule:D,mediaInfo:E,colorMap:F}=C;({value:C}=E);const {am4core:G,am4charts:O}=D,K=B.xAxes.push(new O.CategoryAxis);K.dataFields.category="tooltip";K.renderer.labels.template.disabled=!0;this._customizeChartTooltip(K.tooltip,G);K.tooltip.events.on("sizechanged",()=>{K.tooltip.dy=-K.tooltip.contentHeight});var L=B.yAxes.push(new O.ValueAxis),R=L.renderer.labels.template;
L.renderer.minLabelPosition=.05;L.renderer.maxLabelPosition=.95;L.min=this._getMinSeriesValue(C.series);this._customizeChartTooltip(L.tooltip,G);R.wrap=!0;L=B.series.push(new O.LineSeries);L.dataFields.categoryX="tooltip";L.dataFields.valueY="value";L.strokeWidth=1;if(R=F.get("default-line-value"))L.stroke=R;L=L.bullets.push(new O.CircleBullet);L.propertyFields.fill="color";L.propertyFields.stroke="color";B.cursor=new O.XYCursor;15<C.series.length&&(B.scrollbarX=new G.Scrollbar)};x._createXYChart=
function(B){const {chartDiv:C,chartsModule:D,mediaInfo:E}=B,{type:F}=E,{am4core:G,am4charts:O}=D,K=G.create(C,O.XYChart);K.rtl=r.isRTL(this.container);"column-chart"===F&&this._createColumnChart(K,B);"bar-chart"===F&&this._createBarChart(K,B);"line-chart"===F&&this._createLineChart(K,B);return K};x._clearMediaRefreshTimer=function(){const {_refreshTimer:B}=this;B&&(clearTimeout(B),this._refreshTimer=null)};x._updateMediaInfoTimestamp=function(B){const C=Date.now();this._refreshIntervalInfo={timestamp:C,
sourceURL:this._getImageSource(B,C)};this.scheduleRender()};x._setupMediaRefreshTimer=function(){this._clearMediaRefreshTimer();const {activeMediaInfo:B}=this.viewModel;B&&"image"===B.type&&B.refreshInterval&&this._setRefreshTimeout(B)};x._setRefreshTimeout=function(B){const {refreshInterval:C,value:D}=B;C&&(B=6E4*C,this._updateMediaInfoTimestamp(D.sourceURL),this._refreshTimer=setInterval(()=>{this._updateMediaInfoTimestamp(D.sourceURL)},B))};x._getImageSource=function(B,C){const D=B.includes("?")?
"\x26":"?",[E,F=""]=B.split("#");return`${E}${D}timestamp=${C}${F?"#":""}${F}`};return A}(g);b.__decorate([l.aliasOf("viewModel.attributes")],u.prototype,"attributes",void 0);b.__decorate([l.aliasOf("viewModel.activeMediaInfoIndex")],u.prototype,"activeMediaInfoIndex",void 0);b.__decorate([l.aliasOf("viewModel.description")],u.prototype,"description",void 0);b.__decorate([l.aliasOf("viewModel.fieldInfoMap")],u.prototype,"fieldInfoMap",void 0);b.__decorate([l.aliasOf("viewModel.layer")],u.prototype,
"layer",void 0);b.__decorate([l.aliasOf("viewModel.mediaInfos")],u.prototype,"mediaInfos",void 0);b.__decorate([l.aliasOf("viewModel.popupTemplate")],u.prototype,"popupTemplate",void 0);b.__decorate([l.aliasOf("viewModel.relatedInfos")],u.prototype,"relatedInfos",void 0);b.__decorate([l.aliasOf("viewModel.title")],u.prototype,"title",void 0);b.__decorate([h.property({type:p})],u.prototype,"viewModel",void 0);b.__decorate([h.property(),y.messageBundle("esri/widgets/Feature/t9n/Feature")],u.prototype,
"messages",void 0);return u=b.__decorate([d.subclass("esri.widgets.Feature.FeatureMedia")],u)})},"esri/renderers/support/utils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/MapUtils ../../intl/date ./numberUtils ../visualVariables/support/ColorStop ../../symbols/support/utils ../../widgets/Legend/support/colorRampUtils ../../widgets/Legend/support/heatmapRampUtils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){function g(z,A,x){l.getOrCreateMapValue(z,
A,()=>[]).push(...x)}function p(){p=b._asyncToGenerator(function*(z){const A=new Map;if("visualVariables"in z&&z.visualVariables){var x=z.visualVariables.filter(D=>"color"===D.type);for(const D of x){x=D.field||D.valueExpression;const E=(yield d.getRampStops(D)).map(F=>F.color);g(A,x,E)}}if("heatmap"===z.type){var B=e.getHeatmapRampStops(z).map(D=>D.color);g(A,z.field,B)}else if("pie-chart"===z.type){for(const D of z.attributes)g(A,D.field,[D.color]);g(A,null,[null==z?void 0:null==(B=z.othersCategory)?
void 0:B.color,h.getColorFromSymbol(z.backgroundFillSymbol,null)])}else if("dot-density"===z.type){for(const D of z.attributes)g(A,D.field,[D.color]);g(A,null,[z.backgroundColor])}else if("unique-value"===z.type){var C;if("predominance"===(null==(C=z.authoringInfo)?void 0:C.type))for(const D of z.uniqueValueInfos)g(A,D.value.toString(),[h.getColorFromSymbol(D.symbol,null)]);else{B=z.uniqueValueInfos.map(O=>h.getColorFromSymbol(O.symbol,null));const {field:D,field2:E,field3:F,valueExpression:G}=z;
(D||G)&&g(A,D||G,B);E&&g(A,E,B);F&&g(A,F,B)}}else"class-breaks"===z.type?(B=z.classBreakInfos.map(D=>h.getColorFromSymbol(D.symbol,null)),g(A,z.field||z.valueExpression,B)):"simple"===z.type&&g(A,null,[h.getColorFromSymbol(z.symbol,null)]);"defaultSymbol"in z&&z.defaultSymbol&&g(A,null,[h.getColorFromSymbol(z.defaultSymbol,null)]);A.forEach((D,E)=>{D=c.unique(D.filter(Boolean),(F,G)=>JSON.stringify(F)===JSON.stringify(G));A.set(E,D)});return A});return p.apply(this,arguments)}function t(z,A,x){let B=
"";0===A?B=y.lt+" ":A===x&&(B=y.gt+" ");return B+z}function q(z){let A=z.minValue,x=z.maxValue;const B=z.isFirstBreak?"":y.gt+" ";z="percent-of-total"===z.normalizationType?y.pct:"";A=null==A?"":v.format(A);x=null==x?"":v.format(x);return B+A+z+" "+y.ld+" "+x+z}function k(z,A){return"normalizationField"in z&&z.normalizationField?{type:"normalized-field",field:z.field,normalizationField:z.normalizationField}:"field"in z&&z.field?{type:"field",field:z.field}:"valueExpression"in z&&z.valueExpression?
{type:"expression",expression:z.valueExpression,title:z.valueExpressionTitle,returnType:A}:null}const r=n.getLogger("esri.renderers.support.utils"),y={lte:"\x3c\x3d",gte:"\x3e\x3d",lt:"\x3c",gt:"\x3e",pct:"%",ld:"\u2013"},f={millisecond:0,second:1,minute:2,hour:3,day:4,month:5,year:6},w={millisecond:"long-month-day-year-long-time",second:"long-month-day-year-long-time",minute:"long-month-day-year-short-time",hour:"long-month-day-year-short-time",day:"long-month-day-year",month:"long-month-day-year",
year:"year"};n=u.convertDateFormatToIntlOptions("short-date");a.calculateDateFormatInterval=function(z){z=z.map(D=>new Date(D));const A=z.length;let x=Infinity,B=null;for(let D=0;D<A-1;D++){const E=z[D];let F=Infinity,G=null;for(let O=D+1;O<A;O++){var C=z[O];C=E.getFullYear()!==C.getFullYear()&&"year"||E.getMonth()!==C.getMonth()&&"month"||E.getDate()!==C.getDate()&&"day"||E.getHours()!==C.getHours()&&"hour"||E.getMinutes()!==C.getMinutes()&&"minute"||E.getSeconds()!==C.getSeconds()&&"second"||"millisecond";
const K=f[C];K<F&&(F=K,G=C)}F<x&&(x=F,B=G)}return B};a.createClassBreakLabel=q;a.createColorStops=function(z){const {values:A,colors:x,labelIndexes:B,isDate:C,dateFormatOptions:D}=z;return A.map((E,F)=>{let G=null;if(!B||B.includes(F)){let O;(O=C?u.formatDate(E,D):v.format(E))&&(G=t(O,F,A.length-1))}return new m({value:E,color:x[F],label:G})})};a.createUniqueValueLabel=function(z){const {value:A,domain:x,fieldInfo:B,dateFormatInterval:C}=z;z=String(A);const D=x&&"codedValues"in x&&x.codedValues?x.getName(A):
null;D?z=D:"number"===typeof A&&(z=B&&"date"===B.type?u.formatDate(A,C&&u.convertDateFormatToIntlOptions(w[C])):v.format(A));return z};a.getAttribute=k;a.getAttributes=function(z,A){const x=[];if("class-breaks"===z.type||"heatmap"===z.type)x.push(k(z,"number"));else if("unique-value"===z.type){var B=z.authoringInfo;if(B&&"relationship"===B.type){if(B.field1&&B.field2){var C=B.field2.field;const D=B.field2.normalizationField;x.push(k({field:B.field1.field,normalizationField:B.field1.normalizationField}));
x.push(k({field:C,normalizationField:D}))}}else C=z.uniqueValueInfos[0],B=null,C&&C.value&&(C=typeof z.uniqueValueInfos[0].value,"string"===C||"number"===C)&&(B=C),x.push(k(z,B)),[z.field2,z.field3].forEach(D=>D&&x.push({type:"field",field:D}))}else"attributes"in z&&z.attributes.forEach(D=>x.push(k(D,"number")));(z=A?A(z):"visualVariables"in z?z.visualVariables:null)&&z.forEach(D=>x.push(k(D,"number")));return c.unique(x.filter(Boolean),(D,E)=>"field"===D.type&&"field"===E.type?D.field===E.field:
"normalized-field"===D.type&&"normalized-field"===E.type?D.field===E.field&&D.normalizationField===E.normalizationField:"expression"===D.type&&"expression"===E.type?D.expression===E.expression:!1)};a.getColorsFromRenderer=function(z){return p.apply(this,arguments)};a.setLabelsForClassBreaks=function(z){const A=z.classBreakInfos,x=z.normalizationType;let B=[];if(A&&A.length)if("standard-deviation"===z.classificationMethod)r.warn("setLabelsForClassBreaks","cannot set labels for class breaks generated using 'standard-deviation' method.");
else if(z.round){B.push(A[0].minValue);for(const C of A)B.push(C.maxValue);B=v.round(B);A.forEach((C,D)=>{C.label=q({minValue:0===D?B[0]:B[D],maxValue:B[D+1],isFirstBreak:0===D,normalizationType:x})})}else A.forEach((C,D)=>{C.label=q({minValue:C.minValue,maxValue:C.maxValue,isFirstBreak:0===D,normalizationType:x})})};a.timelineDateFormatOptions=n;a.updateClassBreak=function(z){if("standard-deviation"===z.classificationMethod)r.warn("updateClassBreak","cannot update labels for class breaks generated using 'standard-deviation' method.");
else{var A=z.classBreaks,x=z.change,B=x.index;x=x.value;var C=A.length,D=-1,E=-1;0===B?D=B:B===C?E=B-1:(E=B-1,D=B);z=z.normalizationType;B=null;-1<D&&D<C&&(B=A[D],B.minValue=x,B.label=q({minValue:B.minValue,maxValue:B.maxValue,isFirstBreak:0===D,normalizationType:z}));-1<E&&E<C&&(B=A[E],B.maxValue=x,B.label=q({minValue:B.minValue,maxValue:B.maxValue,isFirstBreak:0===E,normalizationType:z}))}};a.updateColorStops=function(z){const {stops:A,changes:x,isDate:B,dateFormatOptions:C}=z,D=A.map(F=>F.value);
z=[];for(const F of x)z.push(F.index),D[F.index]=F.value;const E=v.round(D,{indexes:z});A.forEach((F,G)=>{F.value=D[G];if(null!=F.label){let O,K=null;(O=B?u.formatDate(E[G],C):v.format(E[G]))&&(K=t(O,G,A.length-1));F.label=K}})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/numberUtils":function(){define(["exports","../../intl","../../intl/number"],function(a,b,c){function n(e,g){return e-g}function l(e,g){let p;p=Number(e.toFixed(g));
p<e?e=p+1/10**g:(e=p,p-=1/10**g);p=Number(p.toFixed(g));e=Number(e.toFixed(g));return[p,e]}function u(e,g,p,t,q){e=m(e,g,p,t);g=null==e.next||e.next<=q;return(null==e.previous||e.previous<=q)&&g||e.previous+e.next<=2*q}function v(e){e=String(e);var g=e.match(h);if(g&&g[1])return{integer:g[1].split("").length,fractional:g[3]?g[3].split("").length:0};if(e.toLowerCase().includes("e")&&(g=e.split("e"),e=g[0],g=g[1],e&&g)){e=Number(e);g=Number(g);const p=0<g;p||(g=Math.abs(g));e=v(e);p?(e.integer+=g,e.fractional=
g>e.fractional?0:e.fractional-g):(e.fractional+=g,e.integer=g>e.integer?1:e.integer-g);return e}return{integer:0,fractional:0}}function m(e,g,p,t){const q={previous:null,next:null};if(null!=p){const k=e-p;q.previous=Math.floor(Math.abs(100*(g-p-k)/k))}null!=t&&(e=t-e,q.next=Math.floor(Math.abs(100*(t-g-e)/e)));return q}const h=/^-?(\d+)(\.(\d+))?$/i,d={maximumFractionDigits:20};a.format=function(e){return c.formatNumber(e,d)};a.numDigits=v;a.percentChange=m;a.round=function(e,g={}){e=e.slice(0);const {tolerance:p=
2,strictBounds:t=!1,indexes:q=e.map((r,y)=>y)}=g;q.sort(n);for(g=0;g<q.length;g++){const r=q[g],y=e[r],f=0===r?null:e[r-1],w=r===e.length-1?null:e[r+1],z=v(y).fractional;if(z){let A=0,x=!1;for(var k=void 0;A<=z&&!x;)k=l(y,A),k=t&&0===g?k[1]:k[0],x=u(y,k,f,w,p),A++;x&&(e[r]=k)}}return e};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/utils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../Color ../../symbols ../../core/asyncUtils ../../core/has ../../core/maybe ../../core/screenUtils ../../chunks/vec3f64 ../../layers/effects/jsonUtils ./gfxUtils ./Symbol3DMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){function t(K){K=K.symbolLayers;if(!K)return null;let L=null;K.forEach(R=>{if("object"!==R.type||null==R.resource.href)L="water"===R.type?m.unwrap(R.color):m.isSome(R.material)?m.unwrap(R.material.color):null});return L?new n(L):null}function q(K,L){if(null==L)return K;K=K.toRgba();K[3]*=L;return new n(K)}function k(K,L,R){if(K=K.symbolLayers){var M=J=>{J=m.isSome(J)?J:null;L=L||J||null!=R&&O;return q(L,R)};K.forEach(J=>{if("object"!==J.type||null==J.resource.href||
L)if("water"===J.type)J.color=M(J.color);else{var I=m.isSome(J.material)?J.material.color:null;I=M(I);m.isNone(J.material)?J.material=new p.Symbol3DMaterial({color:I}):J.material.color=I;null!=R&&"outline"in J&&m.isSome(J.outline)&&m.isSome(J.outline.color)&&(J.outline.color=q(J.outline.color,R))}})}}function r(K,L){return y.apply(this,arguments)}function y(){y=c._asyncToGenerator(function*(K,L){(K=K.symbolLayers)&&(yield u.forEach(K,function(){var R=c._asyncToGenerator(function*(M){return f(M,L)});
return function(M){return R.apply(this,arguments)}}()))});return y.apply(this,arguments)}function f(K,L){return w.apply(this,arguments)}function w(){w=c._asyncToGenerator(function*(K,L){switch(K.type){case "extrude":K.size="number"===typeof L[2]?L[2]:0;break;case "icon":case "line":case "text":L=z(L);m.isSome(L)&&(K.size=L);break;case "path":{const R=B(L,d.ONES,[K.width,void 0,K.height]);K.width=E(L[0],K.width,1,R);K.height=E(L[2],K.height,1,R)}break;case "object":yield A(K,L)}});return w.apply(this,
arguments)}function z(K){for(const L of K)if("number"===typeof L)return L;return null}function A(K,L){return x.apply(this,arguments)}function x(){x=c._asyncToGenerator(function*(K,L){const {resourceSize:R,symbolSize:M}=yield C(K),J=B(L,R,M);K.width=E(L[0],M[0],R[0],J);K.depth=E(L[1],M[1],R[1],J);K.height=E(L[2],M[2],R[2],J)});return x.apply(this,arguments)}function B(K,L,R){for(let M=0;3>M;M++){const J=K[M];switch(J){case "symbol-value":return null!=R[M]?R[M]/L[M]:1;case "proportional":break;default:if(J&&
L[M])return J/L[M]}}return 1}function C(K){return D.apply(this,arguments)}function D(){D=c._asyncToGenerator(function*(K){const L=yield(yield new Promise((N,V)=>a(["./symbolLayerUtils"],N,V))).computeObjectLayerResourceSize(K,10),{width:R,height:M,depth:J}=K;K=[R,J,M];let I=1;for(var P=0;3>P;P++)if(null!=K[P]){I=K[P]/L[P];break}for(P=0;3>P;P++)null==K[P]&&(K[P]=L[P]*I);return{resourceSize:L,symbolSize:K}});return D.apply(this,arguments)}function E(K,L,R,M){switch(K){case "proportional":return R*M;
case "symbol-value":return null!=L?L:R;default:return K}}function F(){F=c._asyncToGenerator(function*(K,L){if(K&&L){if(l.isSymbol3D(K))return r(K,L);if(l.isSymbol2D(K)&&(L=z(L),!m.isNone(L)))switch(K.type){case "simple-marker":K.size=L;break;case "picture-marker":{const R=K.width/K.height;1<R?(K.width=L,K.height=L*R):(K.width=L*R,K.height=L);break}case "simple-line":K.width=L;break;case "text":K.font.size=L}}});return F.apply(this,arguments)}const G=/\/resource\/(.*?)\.svg$/,O=new n("white");b.applyColorToSymbol=
function(K,L,R){if(K&&(L||null!=R))if(L&&(L=new n(L)),l.isSymbol3D(K))k(K,L,R);else if(l.isSymbol2D(K)){if(L=L||K.color)K.color=q(L,R);null!=R&&"outline"in K&&K.outline&&K.outline.color&&(K.outline.color=q(K.outline.color,R))}};b.applyOpacityToColor=q;b.applyRotationToSymbol=function(K,L,R){K&&null!=L&&(l.isSymbol3D(K)?(K=K.symbolLayers)&&K.forEach(M=>{if(M&&"object"===M.type)switch(R){case "tilt":M.tilt=L;break;case "roll":M.roll=L;break;default:M.heading=L}}):!l.isSymbol2D(K)||"simple-marker"!==
K.type&&"picture-marker"!==K.type&&"text"!==K.type||(K.angle=L))};b.applySizesToSymbol=function(K,L){return F.apply(this,arguments)};b.getCSSFilterFromEffectList=function(K){if(!K)return null;K=K.effects.filter(L=>"bloom"!==L.type).map(L=>L.toJSON());return e.effectFunctionsFromJSON(K)};b.getColorFromSymbol=function(K,L){if(!K)return null;let R=null;l.isSymbol3D(K)?R=t(K):l.isSymbol2D(K)&&(R=K.color?new n(K.color):null);return R?q(R,L):null};b.getIconHref=function(K,L){L=L.resource.href;return!v("esri-canvas-svg-support")&&
K.styleOrigin&&G.test(L)?L.replace(G,"/resource/png/$1.png"):L};b.getSymbolOutlineSize=function(K){if(!K)return 0;if(l.isSymbol3D(K)){{const L=K.symbolLayers&&K.symbolLayers.length;L?(K=K.symbolLayers.getItemAt(L-1),K="outline"in K?m.get(K,"outline","size"):void 0):K=void 0}return m.isSome(K)?K:0}return(K=g.getStroke(K))&&h.px2pt(K.width)||0};b.isVolumetricSymbol=function(K){if(m.isNone(K)||!("symbolLayers"in K)||m.isNone(K.symbolLayers))return!1;switch(K.type){case "point-3d":return K.symbolLayers.some(L=>
"object"===L.type);case "line-3d":return K.symbolLayers.some(L=>"path"===L.type);case "polygon-3d":return K.symbolLayers.some(L=>"object"===L.type||"extrude"===L.type);default:return!1}};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/gfxUtils":function(){define("exports ../../assets ../../Color ../../request ../../core/ItemCache ../../core/screenUtils ./cimSymbolUtils".split(" "),function(a,b,c,n,l,u,v){function m(p){if(!p)return null;
let t;switch(p.type){case "simple-fill":case "picture-fill":case "simple-marker":t=m(p.outline);break;case "simple-line":{const q=u.pt2px(p.width);"none"!==p.style&&0!==q&&(t={color:p.color,style:g(p.style),width:q,cap:p.cap,join:"miter"===p.join?u.pt2px(p.miterLimit):p.join});break}default:t=null}return t}const h={left:"start",center:"middle",right:"end",justify:"start"},d={top:"text-before-edge",middle:"central",baseline:"alphabetic",bottom:"text-after-edge"},e=new l(1E3),g=(()=>{const p={};return t=>
{if(p[t])return p[t];const q=t.replace(/-/g,"");return p[t]=q}})();c=new c([128,128,128]);a.defaultThematicColor=c;a.dekebabifyLineStyle=g;a.getFill=function(p){const t=p.style;let q=null;if(p)switch(p.type){case "simple-marker":"cross"!==t&&"x"!==t&&(q=p.color);break;case "simple-fill":"solid"===t?q=p.color:"none"!==t&&(q={type:"pattern",x:0,y:0,src:b.getAssetUrl(`esri/symbols/patterns/${t}.png`),width:5,height:5});break;case "picture-fill":q={type:"pattern",src:p.url,width:u.pt2px(p.width)*p.xscale,
height:u.pt2px(p.height)*p.yscale,x:u.pt2px(p.xoffset),y:u.pt2px(p.yoffset)};break;case "text":q=p.color;break;case "cim":q=v.getCIMSymbolColor(p)}return q};a.getPatternUrlWithColor=function(p,t){const q=p+"-"+t;return void 0!==e.get(q)?Promise.resolve(e.get(q)):n(p,{responseType:"image"}).then(k=>{k=k.data;const r=k.naturalWidth,y=k.naturalHeight,f=document.createElement("canvas");f.width=r;f.height=y;const w=f.getContext("2d");w.fillStyle=t;w.fillRect(0,0,r,y);w.globalCompositeOperation="destination-in";
w.drawImage(k,0,0);k=f.toDataURL();e.put(q,k);return k})};a.getSVGAlign=function(p){return p=(p=p.horizontalAlignment)&&h[p.toLowerCase()]||"middle"};a.getSVGBaseline=function(p){return(p=p.verticalAlignment)&&d[p.toLowerCase()]||"alphabetic"};a.getSVGBaselineShift=function(p){return"bottom"===p.verticalAlignment?"super":null};a.getStroke=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/ItemCache":function(){define(["./MemCache"],function(a){return function(){function b(n,
l){this._storage=new a.MemCacheStorage;this._storage.maxSize=n;l&&this._storage.registerRemoveFunc("",l)}var c=b.prototype;c.put=function(n,l){this._storage.put(n,l,1,1)};c.pop=function(n){return this._storage.pop(n)};c.get=function(n){return this._storage.get(n)};c.clear=function(){this._storage.clearAll()};c.destroy=function(){this._storage.destroy()};return b}()})},"esri/symbols/support/cimSymbolUtils":function(){define(["exports","../../Color","../cim/utils"],function(a,b,c){function n(g){g=c.toCIMSymbolJSON(g);
if("CIMTextSymbol"===g.type)return g.height;let p=0;if(g.symbolLayers)for(const t of g.symbolLayers)c.isCIMMarker(t)&&t.size>p?p=t.size:c.isCIMStroke(t)&&t.width>p?p=t.width:c.isCIMFill(t);return p}function l(g,p,t,q){if("CIMTextSymbol"===g.type)g.height*=p;else{if(t&&g.effects)for(const k of g.effects)m(k,p);if(g.symbolLayers)for(const k of g.symbolLayers)switch(k.type){case "CIMPictureMarker":case "CIMVectorMarker":u(k,p,q);break;case "CIMPictureStroke":case "CIMSolidStroke":null!=q&&q.preserveOutlineWidth||
!k.width||(k.width*=p);break;case "CIMPictureFill":k.height&&(k.height*=p);k.offsetX&&(k.offsetX*=p);k.offsetY&&(k.offsetY*=p);break;case "CIMHatchFill":l(k.lineSymbol,p,!0,{...q,preserveOutlineWidth:!1}),k.offsetX&&(k.offsetX*=p),k.offsetY&&(k.offsetY*=p),k.separation&&(k.separation*=p)}}}function u(g,p,t){g.markerPlacement&&v(g.markerPlacement,p);g.offsetX&&(g.offsetX*=p);g.offsetY&&(g.offsetY*=p);g.anchorPoint&&"Absolute"===g.anchorPointUnits&&(g.anchorPoint={x:g.anchorPoint.x*p,y:g.anchorPoint.y*
p});g.size*=p;if("CIMVectorMarker"===g.type&&g.markerGraphics)for(const q of g.markerGraphics)g.scaleSymbolsProportionally||l(q.symbol,p,!0,t)}function v(g,p){c.isCIMMarkerStrokePlacement(g)&&g.offset&&(g.offset*=p);switch(g.type){case "CIMMarkerPlacementAlongLineRandomSize":case "CIMMarkerPlacementAlongLineSameSize":g.customEndingOffset&&(g.customEndingOffset*=p);g.offsetAlongLine&&(g.offsetAlongLine*=p);if(g.placementTemplate&&g.placementTemplate.length){var t=g.placementTemplate.map(q=>q*p);g.placementTemplate=
t}break;case "CIMMarkerPlacementAlongLineVariableSize":g.maxRandomOffset&&(g.maxRandomOffset*=p);g.placementTemplate&&g.placementTemplate.length&&(t=g.placementTemplate.map(q=>q*p),g.placementTemplate=t);break;case "CIMMarkerPlacementOnLine":g.startPointOffset&&(g.startPointOffset*=p);break;case "CIMMarkerPlacementAtExtremities":g.offsetAlongLine&&(g.offsetAlongLine*=p);break;case "CIMMarkerPlacementAtRatioPositions":g.beginPosition&&(g.beginPosition*=p);g.endPosition&&(g.endPosition*=p);break;case "CIMMarkerPlacementPolygonCenter":g.offsetX&&
(g.offsetX*=p);g.offsetY&&(g.offsetY*=p);break;case "CIMMarkerPlacementInsidePolygon":g.offsetX&&(g.offsetX*=p),g.offsetY&&(g.offsetY*=p),g.stepX&&(g.stepX*=p),g.stepY&&(g.stepY*=p)}}function m(g,p){switch(g.type){case "CIMGeometricEffectArrow":case "CIMGeometricEffectDonut":g.width&&(g.width*=p);break;case "CIMGeometricEffectBuffer":g.size&&(g.size*=p);break;case "CIMGeometricEffectCut":g.beginCut&&(g.beginCut*=p);g.endCut&&(g.endCut*=p);g.middleCut&&(g.middleCut*=p);break;case "CIMGeometricEffectDashes":g.customEndingOffset&&
(g.customEndingOffset*=p);g.offsetAlongLine&&(g.offsetAlongLine*=p);if(g.dashTemplate&&g.dashTemplate.length){const t=g.dashTemplate.map(q=>q*p);g.dashTemplate=t}break;case "CIMGeometricEffectExtension":case "CIMGeometricEffectJog":case "CIMGeometricEffectRadial":g.length&&(g.length*=p);break;case "CIMGeometricEffectMove":g.offsetX&&(g.offsetX*=p);g.offsetY&&(g.offsetY*=p);break;case "CIMGeometricEffectOffset":case "CIMGeometricEffectOffsetTangent":g.offset&&(g.offset*=p);break;case "CIMGeometricEffectRegularPolygon":g.radius&&
(g.radius*=p);break;case "CIMGeometricEffectTaperedPolygon":g.fromWidth&&(g.fromWidth*=p);g.length&&(g.length*=p);g.toWidth&&(g.toWidth*=p);break;case "CIMGeometricEffectWave":g.amplitude&&(g.amplitude*=p),g.period&&(g.period*=p)}}function h(g,p){let t;t="CIMTextSymbol"===g.type?g.symbol:g;g="CIMPolygonSymbol"===g.type;if(t.symbolLayers)for(const q of t.symbolLayers)if(!(q.colorLocked||g&&(c.isCIMStroke(q)||c.isCIMMarker(q)&&q.markerPlacement&&c.isCIMMarkerStrokePlacement(q.markerPlacement))))switch(q.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":q.tintColor&&
d(p,q.tintColor);break;case "CIMVectorMarker":q.markerGraphics.forEach(k=>{h(k.symbol,p)});break;case "CIMSolidStroke":case "CIMSolidFill":d(p,q.color);break;case "CIMHatchFill":h(q.lineSymbol,p)}}function d(g,p){for(const t of g)if(t.join(".")===p.join("."))return;g.push(p)}function e(g,p,t){var q="CIMTextSymbol"===g.type?g.symbol:g;g="CIMPolygonSymbol"===q.type?!0:!1;if(q.symbolLayers)for(const k of q.symbolLayers)if(!k.colorLocked){if(g)if(t){if({layersToColor:q}=t,(c.isCIMStroke(k)||c.isCIMMarker(k)&&
k.markerPlacement&&c.isCIMMarkerStrokePlacement(k.markerPlacement))&&"fill"===q||c.isCIMFill(k)&&"outline"===q)continue}else if(c.isCIMStroke(k)||c.isCIMMarker(k)&&k.markerPlacement&&c.isCIMMarkerStrokePlacement(k.markerPlacement))continue;q=p.toArray();switch(k.type){case "CIMPictureMarker":case "CIMPictureStroke":case "CIMPictureFill":k.tintColor=q;break;case "CIMVectorMarker":k.markerGraphics.forEach(r=>{e(r.symbol,p,t)});break;case "CIMSolidStroke":case "CIMSolidFill":k.color=q;break;case "CIMHatchFill":e(k.lineSymbol,
p,t)}}}a.applyCIMSymbolColor=function(g,p,t){p instanceof b||(p=new b(p));(g=c.toCIMSymbolJSON(g))&&e(g,p,t)};a.applyCIMSymbolRotation=function(g,p,t=!1){g=c.toCIMSymbolJSON(g);t&&0!==p&&(p=360-p);if("CIMTextSymbol"===g.type)g.angle=p;else if("CIMPointSymbol"===g.type&&g.symbolLayers){t=p-(g.angle||0);for(const q of g.symbolLayers)if(c.isCIMMarker(q)){let k=q.rotation||0;k=q.rotateClockwise?k-t:k+t;q.rotation=k}g.angle=p}};a.getCIMSymbolColor=function(g){g=c.toCIMSymbolJSON(g);const p=[];h(g,p);return p.length?
new b(c.fromCIMColor(p[0])):null};a.getCIMSymbolRotation=function(g,p=!1){g=c.toCIMSymbolJSON(g);return"CIMTextSymbol"===g.type||"CIMPointSymbol"===g.type?p&&0!==g.angle?360-g.angle:g.angle||0:0};a.getCIMSymbolSize=n;a.scaleCIMMarker=u;a.scaleCIMSymbolTo=function(g,p,t){const q=c.toCIMSymbolJSON(g);g=n(g);if(0===g)if("CIMTextSymbol"===q.type)q.height=p;else{if(q.symbolLayers)for(const k of q.symbolLayers)switch(k.type){case "CIMPictureMarker":case "CIMVectorMarker":k.size=p;break;case "CIMPictureStroke":case "CIMSolidStroke":k.width=
p}}else l(q,p/g,!1,t)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/cim/utils":function(){define(["require","exports"],function(a,b){function c(n,l){"string"!==typeof n&&(n=String(n));switch(l){case "LowerCase":return n.toLowerCase();case "Allcaps":return n.toUpperCase();default:return n}}b._adjustTextCase=c;b.colorToArray=function(n){return[n.r,n.g,n.b,n.a]};b.createLabelOverrideFunction=function(n,l,u){const v=e=>{let g=e.length;for(;g--;)if(!" /-,\n".includes(e.charAt(g)))return!1;
return!0},m=[];var h=0;let d=-1;do d=l.indexOf("[",h),d>=h&&(d>h&&(h=l.substr(h,d-h),m.push([h,null,v(h)])),h=d+1,d=l.indexOf("]",h),d>=h&&(d>h&&(h=l.substr(h,d-h),(h=n[h])&&m.push([null,h,!1])),h=d+1));while(-1!==d);h<l.length-1&&(n=l.substr(h),m.push([n,null,v(n)]));return e=>{let g="",p=null;for(const t of m){const [q,k,r]=t;if(q)r?p=q:(p&&(g+=p,p=null),g+=q);else{const y=e.attributes[k];y&&(p&&(g+=p,p=null),g+=y)}}return c(g,u)}};b.evaluateValueOrFunction=function(n,l,u,v){return"function"===
typeof n?n(l,u,v):n};b.fromCIMColor=function(n){return n?{r:n[0],g:n[1],b:n[2],a:n[3]/255}:{r:0,g:0,b:0,a:0}};b.getValue=n=>isNaN(n)||!n?0:n;b.importGeometryEngine=function(){return new Promise((n,l)=>a(["../../geometry/geometryEngineJSON"],n,l))};b.isCIMFill=function(n){return"CIMGradientFill"===n.type||"CIMHatchFill"===n.type||"CIMPictureFill"===n.type||"CIMSolidFill"===n.type||"CIMWaterFill"===n.type};b.isCIMMarker=function(n){return"CIMVectorMarker"===n.type||"CIMPictureMarker"===n.type||"CIMBarChartMarker"===
n.type||"CIMCharacterMarker"===n.type||"CIMPieChartMarker"===n.type||"CIMStackedBarChartMarker"===n.type};b.isCIMMarkerStrokePlacement=function(n){return"CIMMarkerPlacementAlongLineRandomSize"===n.type||"CIMMarkerPlacementAlongLineSameSize"===n.type||"CIMMarkerPlacementAlongLineVariableSize"===n.type||"CIMMarkerPlacementAtExtremities"===n.type||"CIMMarkerPlacementAtMeasuredUnits"===n.type||"CIMMarkerPlacementAtRatioPositions"===n.type||"CIMMarkerPlacementOnLine"===n.type||"CIMMarkerPlacementOnVertices"===
n.type};b.isCIMStroke=function(n){return"CIMGradientStroke"===n.type||"CIMPictureStroke"===n.type||"CIMSolidStroke"===n.type};b.isGeometryEngineRequired=n=>{if(!n)return!1;for(const l of n)switch(l.type){case "CIMGeometricEffectBuffer":case "CIMGeometricEffectOffset":return!0}return!1};b.resampleHermite=function(n,l,u,v,m,h,d=!0){const e=l/m;u/=h;const g=Math.ceil(e/2),p=Math.ceil(u/2);for(let k=0;k<h;k++)for(let r=0;r<m;r++){const y=4*(r+(d?h-k-1:k)*m);var t=0;let f=0,w=0,z=0,A=0,x=0,B=0;const C=
(k+.5)*u;for(let D=Math.floor(k*u);D<(k+1)*u;D++){var q=Math.abs(C-(D+.5))/p;const E=(r+.5)*e;q*=q;for(let F=Math.floor(r*e);F<(r+1)*e;F++){let G=Math.abs(E-(F+.5))/g;t=Math.sqrt(q+G*G);-1<=t&&1>=t&&(t=2*t*t*t-3*t*t+1,0<t&&(G=4*(F+D*l),B+=t*n[G+3],w+=t,255>n[G+3]&&(t=t*n[G+3]/250),z+=t*n[G],A+=t*n[G+1],x+=t*n[G+2],f+=t))}}v[y]=z/f;v[y+1]=A/f;v[y+2]=x/f;v[y+3]=B/w}};b.toCIMSymbolJSON=function(n){var l;return null==(l=n.data)?void 0:l.symbol};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/widgets/Legend/support/colorRampUtils":function(){define(["require","exports","../../../chunks/_rollupPluginBabelHelpers","../../../Color","./utils"],function(a,b,c,n,l){function u(p,t){const q=[],k=p.length-1;5===p.length?q.push(0,2,4):q.push(0,k);return p.map((r,y)=>q.includes(y)?l.createStopLabel(r,y,k,t):null)}function v(){v=c._asyncToGenerator(function*(p,t,q){let k=!1,r=[],y=[];if(p.stops){var f=p.stops;r=f.map(z=>z.value);(k=f.some(z=>!!z.label))&&(y=f.map(z=>z.label))}f=r[r.length-1];
if(null==r[0]&&null==f)return null;const w=k?null:u(r,q);return(yield Promise.all(r.map(function(){var z=c._asyncToGenerator(function*(A,x){const B="opacity"===p.type?yield m(A,p,t):(yield new Promise((C,D)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],C,D))).getColor(p,A);return{value:A,color:B,label:k?y[x]:w[x]}});return function(A,x){return z.apply(this,arguments)}}()))).reverse()});return v.apply(this,arguments)}function m(p,t){return h.apply(this,arguments)}function h(){h=
c._asyncToGenerator(function*(p,t,q=g){q=new n(q);p=(yield new Promise((k,r)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],k,r))).getOpacity(t,p);null!=p&&(q.a=p);return q});return h.apply(this,arguments)}function d(p,t){const {startIndex:q,endIndex:k,weight:r}=e(p,t);if(q===k)return t[q].color;p=n.blendColors(t[q].color,t[k].color,r);return new n(p)}function e(p,t){let q=0,k=t.length-1;t.some((r,y)=>{if(p<r.value)return k=y,!0;q=y;return!1});return{startIndex:q,endIndex:k,
weight:(p-t[q].value)/(t[k].value-t[q].value)}}const g=new n([64,64,64]);b.getColorFromPointCloudStops=d;b.getRampStops=function(p,t,q){return v.apply(this,arguments)};b.getRampStopsForPointCloud=function(p){let t=!1,q=[],k=[];q=p.map(f=>f.value);(t=p.some(f=>!!f.label))&&(k=p.map(f=>f.label));const r=q[q.length-1];if(null==q[0]&&null==r)return null;const y=t?null:u(q,!1);return q.map((f,w)=>{const z=d(f,p);return{value:f,color:z,label:t?k[w]:y[w]}}).reverse()};b.getStrectchRampStops=function(p,t){let q=
[];if(p&&"multipart"===p.type)p.colorRamps.reverse().forEach((k,r)=>{0===r?q.push({value:t.max,color:new n(k.toColor),label:"high"}):q.push({value:null,color:new n(k.toColor),label:""});r===p.colorRamps.length-1?q.push({value:t.min,color:new n(k.fromColor),label:"low"}):q.push({value:null,color:new n(k.fromColor),label:""})});else{let k,r;p&&"algorithmic"===p.type?(k=p.fromColor,r=p.toColor):(k=[0,0,0,1],r=[255,255,255,1]);q=[{value:t.max,color:new n(r),label:"high"},{value:t.min,color:new n(k),label:"low"}]}return q};
Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Legend/support/utils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../symbols ../../../intl/date ../../../renderers/support/numberUtils ../../../symbols/SimpleLineSymbol".split(" "),function(a,b,c,n,l,u,v){function m(g){return h.apply(this,arguments)}function h(){h=c._asyncToGenerator(function*(g){if(!("visualVariables"in g&&g.visualVariables))return null;
g=g.visualVariables.find(q=>"color"===q.type);if(!g)return null;var p=null,t=null;if(g.stops){if(1===g.stops.length)return g.stops[0].color;p=g.stops[0].value;t=g.stops[g.stops.length-1].value}p+=(t-p)/2;({getColor:t}=yield new Promise((q,k)=>a(["../../../renderers/visualVariables/support/visualVariableUtils"],q,k)));return t(g,p)});return h.apply(this,arguments)}function d(){d=c._asyncToGenerator(function*(g,p){const t=g.trailCap,q=g.trailWidth||1;g=p||(yield m(g))||g.color;return new v({cap:t,color:g,
width:q})});return d.apply(this,arguments)}const e=l.convertDateFormatToIntlOptions("short-date");b.RGB_IMG_SOURCE=["data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwcdIkqhiWn5fHwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6JrzFUAAAAASUVORK5CYII\x3d","data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwaeIkqhiWl5/HwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu6sKxboAAAAASUVORK5CYII\x3d",
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAAAAAAAAAHqZRakAAAANUlEQVQ4jWPMy8v7z0BFwMLAwMAwadJEqhiWl5fPwEQVk5DAqIGjBo4aOGrgqIEQwEjtKgAATl0Hu75+IUcAAAAASUVORK5CYII\x3d"];b.SPECIAL_CHARS_GREATER_THAN="\x3e";b.SPECIAL_CHARS_LESS_THAN="\x3c";b.createStopLabel=function(g,p,t,q){let k="";0===p?k="\x3c ":p===t&&(k="\x3e ");p=null;p=q?l.formatDate(g,e):u.format(g);return k+p};b.getMedianColor=m;b.getSymbolForFlowRenderer=function(g,p){return d.apply(this,arguments)};Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Legend/support/heatmapRampUtils":function(){define(["exports","../../../renderers/support/HeatmapColorStop"],function(a,b){a.getHeatmapRampStops=function(c){if(!c.colorStops)return[];const n=[...c.colorStops].filter(u=>{var v;return 0<(null==(v=u.color)?void 0:v.a)});let l=n.length-1;if(n&&n[0]){const u=n[l];u&&1!==u.ratio&&(n.push(new b({ratio:1,color:u.color})),l++)}return n.map((u,v)=>{let m="";if(0===v){var h;m=(null==
(h=c.legendOptions)?void 0:h.minLabel)||"low"}else if(v===l){var d;m=(null==(d=c.legendOptions)?void 0:d.maxLabel)||"high"}return{color:u.color,label:m,ratio:u.ratio}}).reverse()};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureMedia/FeatureMediaViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../popup/FieldInfo ../../../popup/content/support/ChartMediaInfoValueSeries ../support/featureUtils ../support/relatedFeatureUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){const p={chartAnimation:!0};c=function(t){function q(r){r=t.call(this,r)||this;r.abilities={...p};r.activeMediaInfoIndex=0;r.attributes=null;r.description=null;r.fieldInfoMap=null;r.formattedAttributes=null;r.expressionAttributes=null;r.layer=null;r.mediaInfos=null;r.popupTemplate=null;r.relatedInfos=null;r.title=null;return r}a._inheritsLoose(q,t);var k=q.prototype;k.castAbilities=function(r){return{...p,...r}};k.setActiveMedia=function(r){this._setContentElementMedia(r)};
k.next=function(){this._pageContentElementMedia(1)};k.previous=function(){this._pageContentElementMedia(-1)};k._setContentElementMedia=function(r){const {formattedMediaInfoCount:y}=this;this.activeMediaInfoIndex=(r+y)%y};k._pageContentElementMedia=function(r){const {activeMediaInfoIndex:y}=this;this._setContentElementMedia(y+r)};k._formatMediaInfos=function(){const {attributes:r,mediaInfos:y,formattedAttributes:f,expressionAttributes:w,fieldInfoMap:z,layer:A}=this;return null==y?void 0:y.map(x=>{x=
null==x?void 0:x.clone();if(!x)return null;x.title=e.substituteFieldsInLinksAndAttributes({attributes:r,fieldInfoMap:z,globalAttributes:f,expressionAttributes:w,layer:A,text:x.title});x.caption=e.substituteFieldsInLinksAndAttributes({attributes:r,fieldInfoMap:z,globalAttributes:f,expressionAttributes:w,layer:A,text:x.caption});x.altText=e.substituteFieldsInLinksAndAttributes({attributes:r,fieldInfoMap:z,globalAttributes:f,expressionAttributes:w,layer:A,text:x.altText});if("image"===x.type){var {value:B}=
x;this._setImageValue({value:B,formattedAttributes:f,layer:A});return x.value.sourceURL?x:void 0}return"pie-chart"===x.type||"line-chart"===x.type||"column-chart"===x.type||"bar-chart"===x.type?({value:B}=x,this._setChartValue({value:B,chartType:x.type,attributes:r,formattedAttributes:f,layer:A}),x):null}).filter(Boolean)};k._setImageValue=function(r){const {fieldInfoMap:y}=this,{value:f,formattedAttributes:w,layer:z}=r,{linkURL:A,sourceURL:x}=f;x&&(r=e.fixTokens(x,z),f.sourceURL=e.substituteAttributes({formattedAttributes:w,
template:r,fieldInfoMap:y}));A&&(r=e.fixTokens(A,z),f.linkURL=e.substituteAttributes({formattedAttributes:w,template:r,fieldInfoMap:y}))};k._setChartValue=function(r){const {value:y,attributes:f,formattedAttributes:w,chartType:z,layer:A}=r,{popupTemplate:x,relatedInfos:B}=this,{fields:C,normalizeField:D}=y;y.fields=e.getFixedFieldNames(C,A);D&&(y.normalizeField=e.getFixedFieldName(D,A));if(C.some(F=>!!(null!=w[F]||e.isRelatedField(F)&&B.size))){var E=null==x?void 0:x.fieldInfos;C.forEach(F=>{e.isRelatedField(F)?
y.series=[...y.series,...this._getRelatedChartInfos({fieldInfos:E,fieldName:F,formattedAttributes:w,chartType:z,value:y})]:(F=this._getChartOption({value:y,attributes:f,chartType:z,formattedAttributes:w,fieldName:F,fieldInfos:E}),y.series.push(F))})}};k._getRelatedChartInfos=function(r){var y;const {fieldInfos:f,fieldName:w,formattedAttributes:z,chartType:A,value:x}=r,B=[];r=g.getRelatedFieldInfo(w);const {layerId:C,fieldName:D}=r;r=null==(y=this.relatedInfos)?void 0:y.get(C.toString());if(!r)return B;
const {relatedFeatures:E,relation:F}=r;if(!F||!E)return B;({cardinality:y}=F);E.forEach(G=>{const {attributes:O}=G;O&&Object.keys(O).forEach(K=>{K===D&&B.push(this._getChartOption({value:x,attributes:O,formattedAttributes:z,fieldName:w,chartType:A,relatedFieldName:K,fieldInfos:f}))})});return"one-to-many"===y||"many-to-many"===y?B:[B[0]]};k._getTooltip=function({label:r,value:y,chartType:f}){return"pie-chart"===f?`${r}`:`${r}: ${y}`};k._getChartOption=function(r){const {value:y,attributes:f,formattedAttributes:w,
fieldName:z,relatedFieldName:A,fieldInfos:x,chartType:B}=r,{layer:C,fieldInfoMap:D}=this,{normalizeField:E,tooltipField:F}=y;r=E?e.isRelatedField(E)?f[g.getRelatedFieldInfo(E).fieldName]:f[E]:null;var G=A&&void 0!==f[A]?f[A]:void 0!==f[z]?f[z]:w[z];r=new d({fieldName:z,value:void 0===G?null:G&&r?G/r:G});if(e.isRelatedField(z)){var O,K,L,R,M;G=D.get(z.toLowerCase());const I=D.get(F.toLowerCase());var J=null!=(O=null==G?void 0:G.fieldName)?O:z;O=null!=(K=null==I?void 0:I.fieldName)?K:F;K=null!=(L=null!=
(R=null!=(M=w[O])?M:null==G?void 0:G.label)?R:null==G?void 0:G.fieldName)?L:A;r.tooltip=this._getTooltip({label:K,value:w[J],chartType:B});return r}R=e.getFieldInfo(x,z);L=e.getFixedFieldName(z,C);R=F&&void 0!==w[F]?w[F]:e.getFieldInfoLabel(R||new h({fieldName:L}),null==(J=this.popupTemplate)?void 0:J.expressionInfos);r.tooltip=this._getTooltip({label:R,value:w[L],chartType:B});return r};a._createClass(q,[{key:"activeMediaInfo",get:function(){return this.formattedMediaInfos[this.activeMediaInfoIndex]||
null}},{key:"formattedMediaInfos",get:function(){return this._formatMediaInfos()||[]}},{key:"formattedMediaInfoCount",get:function(){return this.formattedMediaInfos.length}}]);return q}(c);b.__decorate([n.property()],c.prototype,"abilities",void 0);b.__decorate([v.cast("abilities")],c.prototype,"castAbilities",null);b.__decorate([n.property()],c.prototype,"activeMediaInfoIndex",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"activeMediaInfo",null);b.__decorate([n.property()],c.prototype,
"attributes",void 0);b.__decorate([n.property()],c.prototype,"description",void 0);b.__decorate([n.property()],c.prototype,"fieldInfoMap",void 0);b.__decorate([n.property()],c.prototype,"formattedAttributes",void 0);b.__decorate([n.property()],c.prototype,"expressionAttributes",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"formattedMediaInfos",null);b.__decorate([n.property()],c.prototype,"layer",void 0);b.__decorate([n.property({readOnly:!0})],c.prototype,"formattedMediaInfoCount",
null);b.__decorate([n.property()],c.prototype,"mediaInfos",void 0);b.__decorate([n.property()],c.prototype,"popupTemplate",void 0);b.__decorate([n.property()],c.prototype,"relatedInfos",void 0);b.__decorate([n.property()],c.prototype,"title",void 0);return c=b.__decorate([m.subclass("esri.widgets.Feature.FeatureMedia.FeatureMediaViewModel")],c)})},"esri/widgets/Feature/support/relatedFeatureUtils":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/Error ../../../core/Logger ../../../core/promiseUtils ../../../layers/support/fieldUtils ../../../core/has ../../../layers/support/source/DataLayerSource ../../../rest/query/executeQueryJSON ../../../core/arrayUtils ../../../core/urlUtils ../../../core/unitUtils ../../../geometry/support/spatialReferenceUtils ../../../layers/graphics/featureConversionUtils ../../../geometry/Extent ../../../geometry/Geometry ../../../geometry/Multipoint ../../../geometry/Point ../../../geometry/Polygon ../../../geometry/Polyline ../../../geometry/support/normalizeUtils ../../../core/pbf ../../../rest/support/FeatureSet ../../../rest/support/Query ../../../kernel ../../../rest/query/support/AttachmentInfo ../../../rest/support/AttachmentQuery ../../../geometry ../../../rest/support/RelationshipQuery ../../../rest/support/TopFeaturesQuery ../../../rest/support/StatisticDefinition ./featureUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R){function M(W,Q){if(!Q.relationships)return null;let X=null;({relationships:Q}=Q);Q.some(ba=>ba.id===parseInt(W,10)?(X=ba,!0):!1);return X}function J({originRelationship:W,relationships:Q,layerId:X}){let ba;Q&&Q.some(aa=>{`${aa.relatedTableId}`===X&&aa.id===W.id&&(ba=aa);return!!ba});return ba}function I(W,Q){Q=Q.toLowerCase();for(const X in W)if(X.toLowerCase()===Q)return W[X];return null}function P(W,Q,X,ba){const aa=new O;
aa.outFields=["*"];aa.relationshipId="number"===typeof Q.id?Q.id:parseInt(Q.id,10);aa.objectIds=[W.attributes[X.objectIdField]];return X.queryRelatedFeatures(aa,ba)}function N(W,Q,X){let ba=0;const aa=[];for(;ba<Q.length;)aa.push(`${W} IN (${Q.slice(ba,X+ba)})`),ba+=X;return aa.join(" OR ")}function V(W,Q,X,ba){return S.apply(this,arguments)}function S(){S=b._asyncToGenerator(function*(W,Q,X,ba){var aa=X.layerId.toString();const {layerInfo:ea,relation:ia,relatedFields:ka,outStatistics:la,url:Z,sourceSpatialReference:ca}=
Q;aa=J({originRelationship:ia,relationships:ea.relationships,layerId:aa});if(aa.relationshipTableId&&aa.keyFieldInRelationshipTable){X=(yield P(W,aa,X,ba))[W.attributes[X.objectIdField]];if(!X)return null;const Y=X.features.map(da=>da.attributes[ea.objectIdField]);if(0<(null==la?void 0:la.length)&&ea.supportsStatistics)return Q=new C,Q.where=N(ea.objectIdField,Y,1E3),Q.outFields=ka,Q.outStatistics=la,Q.sourceSpatialReference=ca,Q={features:Promise.resolve(X),statsFeatures:d.executeQueryJSON(Z,Q)},
u.eachAlways(Q)}return(aa=null==aa?void 0:aa.keyField)?(X=v.isNumericField(T(ea.fields,aa)),W=I(W.attributes,ia.keyField),aa=X?`${aa}=${W}`:`${aa}='${W}'`,W=d.executeQueryJSON(Z,new C({where:aa,outFields:Q.relatedFields,sourceSpatialReference:ca}),ba),Q=Q.outStatistics&&0<Q.outStatistics.length&&ea.supportsStatistics?d.executeQueryJSON(Z,new C({where:aa,outFields:Q.relatedFields,outStatistics:Q.outStatistics,sourceSpatialReference:ca}),ba):null,ba={features:W},Q&&(ba.statsFeatures=Q),u.eachAlways(ba)):
null});return S.apply(this,arguments)}function T(W,Q){if(null!=W){Q=Q.toLowerCase();for(const X of W)if(X&&X.name.toLowerCase()===Q)return X}return null}const H=l.getLogger("esri.widgets.Feature.support.relatedFeatureUtils"),U=new Map;a.createRelatedInfo=function(W,Q){if(W=M(W,Q))return{url:`${Q.url}/${W.relatedTableId}`,sourceSpatialReference:Q.spatialReference,relation:W,relatedFields:[],outStatistics:[]}};a.getDestinationRelation=J;a.getRelatedFieldInfo=function(W){if(!R.isRelatedField(W))return null;
const [Q,X]=W.split("/").slice(1);return{layerId:Q,fieldName:X}};a.queryLayerInfos=function({relatedInfos:W,layer:Q},X){const ba={};W.forEach((aa,ea)=>{({relation:aa}=aa);if(!aa)throw ea=new n("relation-required","A relation is required on a layer to retrieve related records."),H.error(ea),ea;({relatedTableId:aa}=aa);if("number"!==typeof aa)throw ea=new n("A related table ID is required on a layer to retrieve related records."),H.error(ea),ea;aa=`${Q.url}/${aa}`;const ia=U.get(aa),ka=ia?ia:c(aa,{query:{f:"json"},
signal:X&&X.signal});ia||U.set(aa,ka);ba[ea]=ka});return u.eachAlways(ba)};a.queryRelatedFeatures=function({graphic:W,relatedInfos:Q,layer:X},ba){const aa={};Q.forEach((ea,ia)=>{ea.layerInfo&&(aa[ia]=V(W,ea,X,ba))});return u.eachAlways(aa)};a.setRelatedFeatures=function(W,Q){if(Q&&W){var {features:X,statsFeatures:ba}=W;W=X&&X.value;Q.relatedFeatures=W?W.features:[];W=ba&&ba.value;Q.relatedStatsFeatures=W?W.features:[]}};a.updateRelatedInfo=function({relatedInfo:W,fieldName:Q,fieldInfo:X}){W.relatedFields.push(Q);
X.statisticType&&(Q=new L({statisticType:X.statisticType,onStatisticField:Q,outStatisticFieldName:Q}),W.outStatistics.push(Q))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/support/chartUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../intl ../../core/has ../../intl/locale".split(" "),function(a,b,c,n,l,u){function v(p){if(!p)return"en-us";if(d.has(p.toLowerCase()))return p.toLowerCase();{p=p.split("-")[0].toLowerCase();
let q=null;for(t of d.keys())if(t.startsWith(p)){q=t;break}var t=q}return t||"en-us"}function m(){m=c._asyncToGenerator(function*(p=u.getLocale()){p=v(p);if(e&&p===g)return e;e=(new Promise((t,q)=>a(["../../chunks/index"],t,q))).then(t=>t.index);g=p;try{const [t,q]=yield Promise.all([e,d.get(g)()]);g===p&&(t.am4core.options.defaultLocale=q.default);t.am4core.options.suppressWarnings=!0;t.am4core.options.autoDispose=!0}catch{return g=e=null}return e});return m.apply(this,arguments)}n="#ffffff #858585 #ffbebe #ffebbe #ffebaf #ffffbe #e9ffbe #d3ffbe #beffe8 #bee8ff #bed2ff #e8beff #ffbee8 #ebebeb #707070 #ff7f7f #ffa77f #ffd37f #ffff73 #d1ff73 #a3ff73 #73ffdf #73dfff #73b2ff #df73ff #ff73df #d6d6d6 #5c5c5c #ff0000 #ff5500 #ffaa00 #ffff00 #aaff00 #55ff00 #00ffc5 #00c5ff #0070ff #c500ff #ff00c5 #c2c2c2 #474747 #e60000 #e64c00 #e69800 #e6e600 #98e600 #4ce600 #00e6a9 #00a9e6 #005ce6 #a900e6 #e600a9 #adadad #242424 #a80000 #a83800 #a87000 #a8a800 #70a800 #38a800 #00a884 #0084a8 #004da8 #8400a8 #a80084 #999999 #1a1a1a #730000 #732600 #734c00 #737300 #4c7300 #267300 #00734c #004c73 #002673 #4c0073 #73004".split(" ");
var h=[{name:"default",colors:[].concat(n.slice(30,39),n.slice(28,30).reverse())},{name:"cat-dark",colors:"#ed5151 #149ece #a7c636 #9e559c #fc921f #ffde3e #f789d8 #b7814a #3caf99 #6b6bd6 #b54779 #7f7f7f".split(" ")},{name:"tropical-bliss",colors:"#fce138 #ff9399 #fcd27e #f1983c #a553b7 #b1a9d0 #6ecffc #4c81cd #fc6f84 #fc3e5a #6af689 #48885c".split(" ")},{name:"desert-blooms",colors:"#102432 #144d59 #ffc730 #ed9310 #a64f1b #661510 #d9351a #b31515 #4a0932 #8c213f #18382e #2c6954".split(" ")},{name:"under-the-sea",
colors:"#bf9727 #607100 #00734c #704489 #01acca #024e76 #f09100 #ea311f #c6004b #7570b3 #666666 #333333".split(" ")},{name:"vibrant-rainbow",colors:"#fffb00 #f5cb11 #9fd40c #46e39c #32b8a6 #7ff2fa #ac08cc #dd33ff #eb7200 #e8a784 #bf2e2e #6c7000".split(" ")},{name:"ocean-bay",colors:"#191921 #11495c #78b1c2 #454f4b #8f8f82 #9be0c0 #87b051 #f7ec88 #ebdcc1 #dbb658 #c43541 #75351e".split(" ")},{name:"prairie-summer",colors:"#332424 #751555 #d47013 #d68989 #211173 #82aad6 #7bfaeb #6ec9a8 #6b6408 #eada40 #ccc54a #1fc235".split(" ")},
{name:"pastel-chalk",colors:"#fffd99 #f5e6a4 #c1d48c #b8e3d0 #a0b8b5 #cbf7fa #d791f2 #dfc1eb #f2b983 #e8c4b2 #bf8e8e #94995c".split(" ")},{name:"seq-yellow-orange-red-bright",colors:"#910000 #b1260b #c0370f #e05919 #ef6a1d #ff7b22 #ffa143 #ffb454 #ffda74 #ffed85".split(" ")},{name:"seq-reds-bright",colors:"#57453b #7b4238 #9f4036 #c23d33 #d7483c #ec5244 #f3696c #f9816c #ffc4ae #fff0dc".split(" ")},{name:"seq-purples-bright",colors:"#4e465c #5a4a78 #695291 #775baa #8663c3 #946bdc #aa89e8 #c1a6f3 #d7c4ff #e6e1ff".split(" ")},
{name:"seq-blues-bright",colors:"#404d54 #435c6c #48799d #4b88b6 #4d96ce #50a5e7 #74bbed #98d0f3 #bce6f9 #e6faff".split(" ")},{name:"seq-greens-bright",colors:"#39544c #386757 #368165 #359b73 #33b581 #4bc392 #64d2a2 #7ce0b3 #cbf6d9 #f4ffea".split(" ")},{name:"seq-browns-bright",colors:"#524834 #715b38 #8f6e3c #ae8140 #cc9444 #eba748 #eeb664 #f0c47f #f9e0b7 #fff8eb".split(" ")}];const d=new Map([["ar",()=>(new Promise((p,t)=>a(["../../chunks/ar"],p,t))).then(p=>p.ar)],["bg-bg",()=>(new Promise((p,
t)=>a(["../../chunks/bg_BG"],p,t))).then(p=>p.bg_BG)],["bs-ba",()=>(new Promise((p,t)=>a(["../../chunks/bs_BA"],p,t))).then(p=>p.bs_BA)],["ca-es",()=>(new Promise((p,t)=>a(["../../chunks/ca_ES"],p,t))).then(p=>p.ca_ES)],["cs-cz",()=>(new Promise((p,t)=>a(["../../chunks/cs_CZ"],p,t))).then(p=>p.cs_CZ)],["da-dk",()=>(new Promise((p,t)=>a(["../../chunks/da_DK"],p,t))).then(p=>p.da_DK)],["de-de",()=>(new Promise((p,t)=>a(["../../chunks/de_DE"],p,t))).then(p=>p.de_DE)],["de-ch",()=>(new Promise((p,t)=>
a(["../../chunks/de_CH"],p,t))).then(p=>p.de_CH)],["el-gr",()=>(new Promise((p,t)=>a(["../../chunks/el_GR"],p,t))).then(p=>p.el_GR)],["en-us",()=>(new Promise((p,t)=>a(["../../chunks/en_US"],p,t))).then(p=>p.en_US)],["en-ca",()=>(new Promise((p,t)=>a(["../../chunks/en_CA"],p,t))).then(p=>p.en_CA)],["es-es",()=>(new Promise((p,t)=>a(["../../chunks/es_ES"],p,t))).then(p=>p.es_ES)],["et-ee",()=>(new Promise((p,t)=>a(["../../chunks/et_EE"],p,t))).then(p=>p.et_EE)],["fi-fi",()=>(new Promise((p,t)=>a(["../../chunks/fi_FI"],
p,t))).then(p=>p.fi_FI)],["fr-fr",()=>(new Promise((p,t)=>a(["../../chunks/fr_FR"],p,t))).then(p=>p.fr_FR)],["he-il",()=>(new Promise((p,t)=>a(["../../chunks/he_IL"],p,t))).then(p=>p.he_IL)],["hr-hr",()=>(new Promise((p,t)=>a(["../../chunks/hr_HR"],p,t))).then(p=>p.hr_HR)],["hu-hu",()=>(new Promise((p,t)=>a(["../../chunks/hu_HU"],p,t))).then(p=>p.hu_HU)],["id-id",()=>(new Promise((p,t)=>a(["../../chunks/id_ID"],p,t))).then(p=>p.id_ID)],["it-it",()=>(new Promise((p,t)=>a(["../../chunks/it_IT"],p,t))).then(p=>
p.it_IT)],["ja-jp",()=>(new Promise((p,t)=>a(["../../chunks/ja_JP"],p,t))).then(p=>p.ja_JP)],["ko-kr",()=>(new Promise((p,t)=>a(["../../chunks/ko_KR"],p,t))).then(p=>p.ko_KR)],["lt-lt",()=>(new Promise((p,t)=>a(["../../chunks/lt_LT"],p,t))).then(p=>p.lt_LT)],["lv-lv",()=>(new Promise((p,t)=>a(["../../chunks/lv_LV"],p,t))).then(p=>p.lv_LV)],["nb-no",()=>(new Promise((p,t)=>a(["../../chunks/nb_NO"],p,t))).then(p=>p.nb_NO)],["nl-nl",()=>(new Promise((p,t)=>a(["../../chunks/nl_NL"],p,t))).then(p=>p.nl_NL)],
["pl-pl",()=>(new Promise((p,t)=>a(["../../chunks/pl_PL"],p,t))).then(p=>p.pl_PL)],["pt-br",()=>(new Promise((p,t)=>a(["../../chunks/pt_BR"],p,t))).then(p=>p.pt_BR)],["pt-pt",()=>(new Promise((p,t)=>a(["../../chunks/pt_PT"],p,t))).then(p=>p.pt_PT)],["ro-ro",()=>(new Promise((p,t)=>a(["../../chunks/ro_RO"],p,t))).then(p=>p.ro_RO)],["ru-ru",()=>(new Promise((p,t)=>a(["../../chunks/ru_RU"],p,t))).then(p=>p.ru_RU)],["sk-sk",()=>(new Promise((p,t)=>a(["../../chunks/sk_SK"],p,t))).then(p=>p.sk_SK)],["sl-sl",
()=>(new Promise((p,t)=>a(["../../chunks/sl_SL"],p,t))).then(p=>p.sl_SL)],["sr-rs",()=>(new Promise((p,t)=>a(["../../chunks/sr_RS"],p,t))).then(p=>p.sr_RS)],["sv-se",()=>(new Promise((p,t)=>a(["../../chunks/sv_SE"],p,t))).then(p=>p.sv_SE)],["th-th",()=>(new Promise((p,t)=>a(["../../chunks/th_TH"],p,t))).then(p=>p.th_TH)],["tr-tr",()=>(new Promise((p,t)=>a(["../../chunks/tr_TR"],p,t))).then(p=>p.tr_TR)],["uk-ua",()=>(new Promise((p,t)=>a(["../../chunks/uk_UA"],p,t))).then(p=>p.uk_UA)],["vi-vn",()=>
(new Promise((p,t)=>a(["../../chunks/vi_VN"],p,t))).then(p=>p.vi_VN)],["zh-cn",()=>(new Promise((p,t)=>a(["../../chunks/zh_Hans"],p,t))).then(p=>p.zh_Hans)],["zh-hk",()=>(new Promise((p,t)=>a(["../../chunks/zh_Hant"],p,t))).then(p=>p.zh_Hant)],["zh-tw",()=>(new Promise((p,t)=>a(["../../chunks/zh_Hant"],p,t))).then(p=>p.zh_Hant)]]);let e,g;b.getChartLocale=v;b.getColorSet=function(p,t="default"){const q=h.find(k=>k.name===t);return q?q.colors.map(k=>p.color(k)):null};b.loadChartsModule=function(){return m.apply(this,
arguments)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureExpression/FeatureExpressionViewModel":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Graphic ../../../chunks/languageUtils ../../../core/Accessor ../../../core/HandleOwner ../../../core/reactiveUtils ../../../core/throttle ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../popup/content/AttachmentsContent ../../../popup/content/Content ../../../popup/content/CustomContent ../../../popup/content/ExpressionContent ../../../popup/content/FieldsContent ../../../popup/content/MediaContent ../../../popup/content/TextContent ../../../popup/ElementExpressionInfo ../FeatureContent/FeatureContentViewModel ../FeatureFields/FeatureFieldsViewModel ../FeatureMedia/FeatureMediaViewModel ../support/arcadeFeatureUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C){l=function(D){function E(F){var G=D.call(this,F)||this;G._abortController=null;G.expressionInfo=null;G.graphic=null;G.contentElement=null;G.contentElementViewModel=null;G.interceptor=null;G.view=null;G._cancelQuery=()=>{const {_abortController:O}=a._assertThisInitialized(G);O&&O.abort();G._abortController=null};G._createVM=()=>{var O,K;const L=null==(O=G.contentElement)?void 0:O.type;null==(K=G.contentElementViewModel)?void 0:K.destroy();
O="fields"===L?new x:"media"===L?new B:"text"===L?new A:null;G._set("contentElementViewModel",O)};G._compile=a._asyncToGenerator(function*(){G._cancelQuery();const O=new AbortController;G._abortController=O;yield G._compileExpression();G._abortController===O&&(G._abortController=null)});G._compileThrottled=m.throttle(G._compile,1,a._assertThisInitialized(G));G._compileExpression=a._asyncToGenerator(function*(){const {expressionInfo:O,graphic:K,interceptor:L,spatialReference:R,map:M,view:J,_abortController:I}=
a._assertThisInitialized(G);if(O&&K&&R&&M){var P=yield C.loadArcadeUtils();if(I===G._abortController)if((P=yield C.createCompiledExpression({arcadeUtils:P,expressionInfo:O,graphic:K,interceptor:L,map:M,spatialReference:R,view:J}))&&"esri.arcade.Dictionary"===P.declaredClass){P=yield n.castAsJsonAsync(P,I.signal);var N=null==P?void 0:P.type;P="media"===N?f.fromJSON(P):"text"===N?w.fromJSON(P):"fields"===N?y.fromJSON(P):null;G._set("contentElement",P)}else G._set("contentElement",null)}else G._set("contentElement",
null)});G.handles.add([v.watch(()=>[G.expressionInfo,G.graphic,G.map,G.spatialReference,G.view],()=>G._compileThrottled(),v.initial),v.watch(()=>[G.contentElement],()=>G._createVM(),v.initial)]);return G}a._inheritsLoose(E,D);E.prototype.destroy=function(){var F;this._cancelQuery();null==(F=this.contentElementViewModel)?void 0:F.destroy();this._set("contentElementViewModel",null);this._set("contentElement",null)};a._createClass(E,[{key:"spatialReference",get:function(){var F;return(null==(F=this.view)?
void 0:F.spatialReference)||null},set:function(F){void 0===F?this._clearOverride("spatialReference"):this._override("spatialReference",F)}},{key:"state",get:function(){const {_abortController:F,contentElement:G,contentElementViewModel:O}=this;return F?"loading":G||O?"ready":"disabled"}},{key:"map",get:function(){var F;return(null==(F=this.view)?void 0:F.map)||null},set:function(F){void 0===F?this._clearOverride("map"):this._override("map",F)}}]);return E}(u.HandleOwnerMixin(l));b.__decorate([h.property()],
l.prototype,"_abortController",void 0);b.__decorate([h.property({type:z})],l.prototype,"expressionInfo",void 0);b.__decorate([h.property({type:c})],l.prototype,"graphic",void 0);b.__decorate([h.property({readOnly:!0})],l.prototype,"contentElement",void 0);b.__decorate([h.property({readOnly:!0})],l.prototype,"contentElementViewModel",void 0);b.__decorate([h.property()],l.prototype,"interceptor",void 0);b.__decorate([h.property()],l.prototype,"spatialReference",null);b.__decorate([h.property({readOnly:!0})],
l.prototype,"state",null);b.__decorate([h.property()],l.prototype,"map",null);b.__decorate([h.property()],l.prototype,"view",void 0);return l=b.__decorate([p.subclass("esri.widgets.Feature.FeatureExpression.FeatureExpressionViewModel")],l)})},"esri/chunks/languageUtils":function(){define("exports ./_rollupPluginBabelHelpers ../arcade/FunctionWrapper ../arcade/ImmutableArray ../arcade/ImmutablePathArray ../arcade/ImmutablePointArray ../geometry/Extent ../geometry/Geometry ../geometry/Multipoint ../geometry/Point ../geometry/Polygon ../geometry/Polyline ./datetime ../core/maybe ../core/number ../geometry/support/coordsUtils ../intl/locale ../arcade/featureset/support/shared".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){function f(ta,Fa,Sa){return""===Fa||null===Fa||void 0===Fa||Fa===Sa||Fa===Sa?ta:ta=ta.split(Fa).join(Sa)}function w(ta){return ta instanceof za||ta instanceof c||ta instanceof Da}function z(ta){return x(ta)||C(ta)||L(ta)||B(ta)||null===ta||ta===Ua||"number"===typeof ta?!0:!1}function A(ta,Fa){return void 0===ta?Fa:ta}function x(ta){return"string"===typeof ta||ta instanceof String}function B(ta){return"boolean"===typeof ta}function C(ta){return"number"===
typeof ta}function D(ta){return"number"===typeof ta&&isFinite(ta)&&Math.floor(ta)===ta}function E(ta){return ta instanceof Array}function F(ta){return"esri.arcade.Feature"===(null==ta?void 0:ta.arcadeDeclaredClass)?!0:!1}function G(ta){return!0===(ta&&ta.declaredRootClass&&"esri.arcade.featureset.support.FeatureSet"===ta.declaredRootClass)}function O(ta){return!0===(ta&&ta.declaredRootClass&&"esri.arcade.featureSetCollection"===ta.declaredRootClass)}function K(ta){return ta instanceof n}function L(ta){return ta instanceof
Date}function R(ta,Fa,Sa){if(ta.length<Fa||ta.length>Sa)throw Error("Function called with wrong number of Parameters");}function M(ta){return 0>ta?-Math.round(-ta):Math.round(ta)}function J(){let ta=Date.now();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(Fa){const Sa=(ta+16*Math.random())%16|0;ta=Math.floor(ta/16);return("x"===Fa?Sa:Sa&3|8).toString(16)})}function I(ta,Fa){if(!1===isNaN(ta)){if(void 0===Fa||null===Fa||""===Fa)return ta.toString();Fa=f(Fa,"\u2030","");Fa=f(Fa,
"\u00a4","");return q.format(ta,{pattern:Fa})}return ta.toString()}function P(ta,Fa){ta=p.DateTime.fromJSDate(ta);return void 0===Fa||null===Fa||""===Fa?ta.toISO({suppressMilliseconds:!0}):ta.toFormat(N(Fa),{locale:r.getLocale(),numberingSystem:"latn"})}function N(ta){ta=ta.replace(/LTS|LT|LL?L?L?|l{1,4}/g,"[$\x26]");let Fa="";const Sa=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|N{1,5}|YYYYYY|YYYYY|YYYY|YY|y{2,4}|yo?|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;
for(const Xa of ta.match(Sa))switch(Xa){case "D":Fa+="d";break;case "DD":Fa+="dd";break;case "DDD":Fa+="o";break;case "d":Fa+="c";break;case "ddd":Fa+="ccc";break;case "dddd":Fa+="cccc";break;case "M":Fa+="L";break;case "MM":Fa+="LL";break;case "MMM":Fa+="LLL";break;case "MMMM":Fa+="LLLL";break;case "YY":Fa+="yy";break;case "Y":case "YYYY":Fa+="yyyy";break;case "Q":Fa+="q";break;case "Z":Fa+="ZZ";break;case "ZZ":Fa+="ZZZ";break;case "S":Fa+="'S'";break;case "SS":Fa+="'SS'";break;case "SSS":Fa+="u";
break;case "A":case "a":Fa+="a";break;case "m":case "mm":case "h":case "hh":case "H":case "HH":case "s":case "ss":case "X":case "x":Fa+=Xa;break;default:Fa=2<=Xa.length&&"["===Xa.slice(0,1)&&"]"===Xa.slice(-1)?Fa+`'${Xa.slice(1,-1)}'`:Fa+`'${Xa}'`}return Fa}function V(ta,Fa,Sa){switch(Sa){case "\x3e":return ta>Fa;case "\x3c":return ta<Fa;case "\x3e\x3d":return ta>=Fa;case "\x3c\x3d":return ta<=Fa}return!1}function S(ta,Fa,Sa){if(null===ta){if(null===Fa||Fa===Ua)return V(null,null,Sa);if(C(Fa))return V(0,
Fa,Sa);if(x(Fa)||B(Fa))return V(0,X(Fa),Sa);if(L(Fa))return V(0,Fa.getTime(),Sa)}if(ta===Ua){if(null===Fa||Fa===Ua)return V(null,null,Sa);if(C(Fa))return V(0,Fa,Sa);if(x(Fa)||B(Fa))return V(0,X(Fa),Sa);if(L(Fa))return V(0,Fa.getTime(),Sa)}else if(C(ta)){if(C(Fa))return V(ta,Fa,Sa);if(B(Fa))return V(ta,X(Fa),Sa);if(null===Fa||Fa===Ua)return V(ta,0,Sa);if(x(Fa))return V(ta,X(Fa),Sa);if(L(Fa))return V(ta,Fa.getTime(),Sa)}else if(x(ta)){if(x(Fa))return V(H(ta),H(Fa),Sa);if(L(Fa))return V(X(ta),Fa.getTime(),
Sa);if(C(Fa))return V(X(ta),Fa,Sa);if(null===Fa||Fa===Ua)return V(X(ta),0,Sa);if(B(Fa))return V(X(ta),X(Fa),Sa)}else if(L(ta)){if(L(Fa))return V(ta,Fa,Sa);if(null===Fa||Fa===Ua)return V(ta.getTime(),0,Sa);if(C(Fa))return V(ta.getTime(),Fa,Sa);if(B(Fa)||x(Fa))return V(ta.getTime(),X(Fa),Sa)}else if(B(ta)){if(B(Fa))return V(ta,Fa,Sa);if(C(Fa))return V(X(ta),X(Fa),Sa);if(L(Fa))return V(X(ta),Fa.getTime(),Sa);if(null===Fa||Fa===Ua)return V(X(ta),0,Sa);if(x(Fa))return V(X(ta),X(Fa),Sa)}return!T(ta,Fa)||
"\x3c\x3d"!==Sa&&"\x3e\x3d"!==Sa?!1:!0}function T(ta,Fa){if(ta===Fa||null===ta&&Fa===Ua||null===Fa&&ta===Ua)return!0;if(L(ta)&&L(Fa))return ta.getTime()===Fa.getTime();if(ta instanceof l||ta instanceof u)return ta.equalityTest(Fa);if(ta instanceof d&&Fa instanceof d){const Sa=ta.cache._arcadeCacheId,Xa=Fa.cache._arcadeCacheId;if(void 0!==Sa&&null!==Sa)return Sa===Xa}return void 0!==ta&&void 0!==Fa&&null!==ta&&null!==Fa&&"object"===typeof ta&&"object"===typeof Fa&&(ta._arcadeCacheId===Fa._arcadeCacheId&&
void 0!==ta._arcadeCacheId&&null!==ta._arcadeCacheId||ta._underlyingGraphic===Fa._underlyingGraphic&&void 0!==ta._underlyingGraphic&&null!==ta._underlyingGraphic)?!0:!1}function H(ta,Fa){if(x(ta))return ta;if(null===ta)return"";if(C(ta))return I(ta,Fa);if(B(ta))return ta.toString();if(L(ta))return P(ta,Fa);if(ta instanceof m)return JSON.stringify(ta.toJSON());if(E(ta)){Fa=[];for(var Sa=0;Sa<ta.length;Sa++)Fa[Sa]=Q(ta[Sa]);return"["+Fa.join(",")+"]"}if(ta instanceof n){Fa=[];for(Sa=0;Sa<ta.length();Sa++)Fa[Sa]=
Q(ta.get(Sa));return"["+Fa.join(",")+"]"}return null!==ta&&"object"===typeof ta&&void 0!==ta.castToText?ta.castToText():w(ta)?"object, Function":""}function U(ta){const Fa=[];if(!1===E(ta))return null;if(ta instanceof n){for(var Sa=0;Sa<ta.length();Sa++)Fa[Sa]=X(ta.get(Sa));return Fa}for(Sa=0;Sa<ta.length;Sa++)Fa[Sa]=X(ta[Sa]);return Fa}function W(ta,Fa){if(x(ta))return ta;if(null===ta)return"";if(C(ta))return I(ta,Fa);if(B(ta))return ta.toString();if(L(ta))return P(ta,Fa);if(ta instanceof m)return ta instanceof
v?'{"xmin":'+ta.xmin.toString()+',"ymin":'+ta.ymin.toString()+","+(ta.hasZ?'"zmin":'+ta.zmin.toString()+",":"")+(ta.hasM?'"mmin":'+ta.mmin.toString()+",":"")+'"xmax":'+ta.xmax.toString()+',"ymax":'+ta.ymax.toString()+","+(ta.hasZ?'"zmax":'+ta.zmax.toString()+",":"")+(ta.hasM?'"mmax":'+ta.mmax.toString()+",":"")+'"spatialReference":'+ha(ta.spatialReference)+"}":ha(ta.toJSON(),(Xa,Ya)=>Xa.key===Ya.key?0:"spatialReference"===Xa.key?1:"spatialReference"===Ya.key||Xa.key<Ya.key?-1:Xa.key>Ya.key?1:0);if(E(ta)){Fa=
[];for(var Sa=0;Sa<ta.length;Sa++)Fa[Sa]=Q(ta[Sa]);return"["+Fa.join(",")+"]"}if(ta instanceof n){Fa=[];for(Sa=0;Sa<ta.length();Sa++)Fa[Sa]=Q(ta.get(Sa));return"["+Fa.join(",")+"]"}return null!==ta&&"object"===typeof ta&&void 0!==ta.castToText?ta.castToText():w(ta)?"object, Function":""}function Q(ta){return null===ta?"null":B(ta)||C(ta)||x(ta)?JSON.stringify(ta):ta instanceof m||ta instanceof n||ta instanceof Array?W(ta):ta instanceof Date?JSON.stringify(P(ta,"")):null!==ta&&"object"===typeof ta&&
void 0!==ta.castToText?ta.castToText():"null"}function X(ta,Fa){return C(ta)?ta:null===ta||""===ta?0:L(ta)?NaN:B(ta)?ta?1:0:E(ta)||""===ta||void 0===ta?NaN:void 0!==Fa&&x(ta)?(Fa=f(Fa,"\u2030",""),Fa=f(Fa,"\u00a4",""),q.parse(ta,{pattern:Fa})):ta===Ua?0:Number(ta)}function ba(ta){return L(ta)?ta:x(ta)&&(ta=ea(ta))?ta.toJSDate():null}function aa(ta){return L(ta)?p.DateTime.fromJSDate(ta):x(ta)?ea(ta):null}function ea(ta){const Fa=/ (\d\d)/;let Sa=p.DateTime.fromISO(ta);return Sa.isValid||Fa.test(ta)&&
(ta=ta.replace(Fa,"T$1"),Sa=p.DateTime.fromISO(ta),Sa.isValid)?Sa:null}function ia(ta){return B(ta)?ta:x(ta)?(ta=ta.toLowerCase(),"true"===ta?!0:!1):C(ta)?0===ta||isNaN(ta)?!1:!0:!1}function ka(ta,Fa){if(t.isNone(ta))return null;if(null===ta.spatialReference||void 0===ta.spatialReference)ta.spatialReference=Fa;return ta}function la(ta){if(null===ta)return null;if(ta instanceof d)return"NaN"===ta.x||null===ta.x||isNaN(ta.x)?null:ta;if(ta instanceof e){if(0===ta.rings.length)return null;for(const Fa of ta.rings)if(0<
Fa.length)return ta;return null}if(ta instanceof g){if(0===ta.paths.length)return null;for(const Fa of ta.paths)if(0<Fa.length)return ta;return null}return ta instanceof h?0===ta.points.length?null:ta:ta instanceof v?"NaN"===ta.xmin||null===ta.xmin||isNaN(ta.xmin)?null:ta:null}function Z(ta,Fa){if(!ta||!ta.domain)return Fa;let Sa=null;if("string"===ta.field.type||"esriFieldTypeString"===ta.field.type)Fa=H(Fa);else{if(null===Fa||void 0===Fa)return null;if(""===Fa)return Fa;Fa=X(Fa)}for(let Xa=0;Xa<
ta.domain.codedValues.length;Xa++){const Ya=ta.domain.codedValues[Xa];Ya.code===Fa&&(Sa=Ya)}return null===Sa?Fa:Sa.name}function ca(ta,Fa){if(!ta||!ta.domain)return Fa;let Sa=null;Fa=H(Fa);for(let Xa=0;Xa<ta.domain.codedValues.length;Xa++){const Ya=ta.domain.codedValues[Xa];Ya.name===Fa&&(Sa=Ya)}return null===Sa?Fa:Sa.code}function Y(ta,Fa,Sa=null,Xa=null){if(!Fa||!Fa.fields)return null;let Ya=null;for(let mb=0;mb<Fa.fields.length;mb++){const jb=Fa.fields[mb];jb.name.toLowerCase()===ta.toString().toLowerCase()&&
(Ya=jb)}if(null===Ya)throw Error("Field not found");let eb,fb;null===Xa&&Sa&&Fa.typeIdField&&(Xa=Sa.hasField(Fa.typeIdField)?Sa.field(Fa.typeIdField):null);null!==Xa&&void 0!==Xa&&Fa.types.some(function(mb){return mb.id===Xa?((eb=mb.domains&&mb.domains[Ya.name])&&"inherited"===eb.type&&(eb=da(Ya.name,Fa),fb=!0),!0):!1});fb||eb||(eb=da(ta,Fa));return{field:Ya,domain:eb}}function da(ta,Fa){let Sa;Fa.fields.some(function(Xa){Xa.name.toLowerCase()===ta.toLowerCase()&&(Sa=Xa.domain);return!!Sa});return Sa}
function ha(ta,Fa){Fa||(Fa={});"function"===typeof Fa&&(Fa={cmp:Fa});const Sa="boolean"===typeof Fa.cycles?Fa.cycles:!1,Xa=Fa.cmp&&function(eb){return function(fb){return function(mb,jb){return eb({key:mb,value:fb[mb]},{key:jb,value:fb[jb]})}}}(Fa.cmp),Ya=[];return function mb(fb){fb&&fb.toJSON&&"function"===typeof fb.toJSON&&(fb=fb.toJSON());if(void 0!==fb){if("number"===typeof fb)return isFinite(fb)?""+fb:"null";if("object"!==typeof fb)return JSON.stringify(fb);var jb;if(Array.isArray(fb)){var kb=
"[";for(jb=0;jb<fb.length;jb++)jb&&(kb+=","),kb+=mb(fb[jb])||"null";return kb+"]"}if(null===fb)return"null";if(Ya.includes(fb)){if(Sa)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var ub=Ya.push(fb)-1,ob=Object.keys(fb).sort(Xa&&Xa(fb));kb="";for(jb=0;jb<ob.length;jb++){const rb=ob[jb],cb=mb(fb[rb]);cb&&(kb&&(kb+=","),kb+=JSON.stringify(rb)+":"+cb)}Ya.splice(ub,1);return"{"+kb+"}"}}(ta)}function ja(ta){if(null===ta)return null;const Fa=[];for(const Sa of ta)Sa&&
Sa.arcadeDeclaredClass&&"esri.arcade.Feature"===Sa.arcadeDeclaredClass?Fa.push(Sa.geometry()):Fa.push(Sa);return Fa}function ma(ta,Fa){if(Fa instanceof d)ta.push(Fa.hasZ?Fa.hasM?[Fa.x,Fa.y,Fa.z,Fa.m]:[Fa.x,Fa.y,Fa.z]:[Fa.x,Fa.y]);else throw Error("Invalid Argument");}function pa(ta,Fa){if(E(ta)||K(ta)){let Sa=!1,Xa=!1,Ya=[];if(E(ta)){for(const eb of ta)ma(Ya,eb);0<Ya.length&&(Fa=ta[0].spatialReference,Sa=ta[0].hasZ,Xa=ta[0].hasM)}else if(ta instanceof u)Ya=ta._elements,0<Ya.length&&(Sa=ta._hasZ,Xa=
ta._hasM,Fa=ta.get(0).spatialReference);else if(K(ta)){for(const eb of ta.toArray())ma(Ya,eb);0<Ya.length&&(Fa=ta.get(0).spatialReference,Sa=!0===ta.get(0).hasZ,Xa=!0===ta.get(0).hasM)}else throw Error("Invalid Argument");if(0===Ya.length)return null;!1===k.isClockwise(Ya,Xa,Sa)&&(Ya=Ya.slice(0).reverse());return new e({rings:[Ya],spatialReference:Fa,hasZ:Sa,hasM:Xa})}return ta}function na(ta,Fa){if(E(ta)||K(ta)){let Sa=!1,Xa=!1,Ya=[];if(E(ta)){for(const eb of ta)ma(Ya,eb);0<Ya.length&&(Fa=ta[0].spatialReference,
Sa=!0===ta[0].hasZ,Xa=!0===ta[0].hasM)}else if(ta instanceof u)Ya=ta._elements,0<Ya.length&&(Sa=ta._hasZ,Xa=ta._hasM,Fa=ta.get(0).spatialReference);else if(K(ta)){for(const eb of ta.toArray())ma(Ya,eb);0<Ya.length&&(Fa=ta.get(0).spatialReference,Sa=!0===ta.get(0).hasZ,Xa=!0===ta.get(0).hasM)}return 0===Ya.length?null:new g({paths:[Ya],spatialReference:Fa,hasZ:Sa,hasM:Xa})}return ta}function wa(ta,Fa){if(E(ta)||K(ta)){let Sa=!1,Xa=!1,Ya=[];if(E(ta)){for(const eb of ta)ma(Ya,eb);0<Ya.length&&(Fa=ta[0].spatialReference,
Sa=!0===ta[0].hasZ,Xa=!0===ta[0].hasM)}else if(ta instanceof u)Ya=ta._elements,0<Ya.length&&(Sa=ta._hasZ,Xa=ta._hasM,Fa=ta.get(0).spatialReference);else if(K(ta)){for(const eb of ta.toArray())ma(Ya,eb);0<Ya.length&&(Fa=ta.get(0).spatialReference,Sa=!0===ta.get(0).hasZ,Xa=!0===ta.get(0).hasM)}return 0===Ya.length?null:new h({points:Ya,spatialReference:Fa,hasZ:Sa,hasM:Xa})}return ta}function xa(ta,Fa=!1){const Sa=[];if(null===ta)return Sa;if(!0===E(ta)){for(var Xa=0;Xa<ta.length;Xa++){var Ya=H(ta[Xa]);
""===Ya&&!0!==Fa||Sa.push(Ya)}return Sa}if(ta instanceof n){for(Xa=0;Xa<ta.length();Xa++)Ya=H(ta.get(Xa)),""===Ya&&!0!==Fa||Sa.push(Ya);return Sa}return z(ta)?(ta=H(ta),""===ta&&!0!==Fa||Sa.push(ta),Sa):[]}function sa(ta){ab++;return 0===ab%100?(ab=0,new Promise(Fa=>{setTimeout(()=>{Fa(ta)},0)})):ta}function ya(ta,Fa,Sa){switch(Sa){case "\x26":return ta&Fa;case "|":return ta|Fa;case "^":return ta^Fa;case "\x3c\x3c":return ta<<Fa;case "\x3e\x3e":return ta>>Fa;case "\x3e\x3e\x3e":return ta>>>Fa}}function ra(ta,
Fa=null){if(null!=ta){if(B(ta)||C(ta)||x(ta))return ta;if(ta instanceof m)return!0===(null==Fa?void 0:Fa.keepGeometryType)?ta:ta.toJSON();if(ta instanceof n)return ta.toArray().map(Sa=>ra(Sa,Fa));if(ta instanceof Array)return ta.map(Sa=>ra(Sa,Fa));if(ta instanceof Date)return ta;if(null!==ta&&"object"===typeof ta&&void 0!==ta.castAsJson)return ta.castAsJson(Fa)}return null}function ua(ta,Fa,Sa,Xa,Ya){return Ba.apply(this,arguments)}function Ba(){Ba=b._asyncToGenerator(function*(ta,Fa,Sa,Xa,Ya){ta=
yield Ea(ta,Fa,Sa);Ya[Xa]=ta});return Ba.apply(this,arguments)}function Ea(ta){return Ja.apply(this,arguments)}function Ja(){Ja=b._asyncToGenerator(function*(ta,Fa=null,Sa=null){ta instanceof n&&(ta=ta.toArray());if(null!=ta){if(z(ta)||ta instanceof m||ta instanceof Date)return ra(ta,Sa);if(ta instanceof Array){const Xa=[],Ya=[];for(const eb of ta)null===eb||z(eb)||eb instanceof m||eb instanceof Date?Ya.push(ra(eb,Sa)):(Ya.push(null),Xa.push(ua(eb,Fa,Sa,Ya.length-1,Ya)));0<Xa.length&&(yield Promise.all(Xa));
return Ya}if(null!==ta&&"object"===typeof ta&&void 0!==ta.castAsJsonAsync)return ta.castAsJsonAsync(Fa,Sa)}return null});return Ja.apply(this,arguments)}function va(ta,Fa,Sa){const Xa=ta.fullSchema();return null!==Xa&&Xa.fields?Y(Fa,Xa,ta,Sa):null}function Ca(ta){ta=ta.fullSchema();return null!==ta&&ta.fields?ta.typeIdField?{subtypeField:ta.typeIdField,subtypes:ta.types?ta.types.map(Fa=>({name:Fa.name,code:Fa.id})):[]}:null:null}function Ka(ta,Fa,Sa,Xa){const Ya=ta.fullSchema();if(null===Ya||!Ya.fields)return null;
Xa=Y(Fa,Ya,ta,Xa);if(void 0===Sa)try{Sa=ta.field(Fa)}catch(eb){return null}return Z(Xa,Sa)}function Oa(ta,Fa,Sa,Xa){const Ya=ta.fullSchema();if(null===Ya||!Ya.fields)return null;if(void 0===Sa){try{Sa=ta.field(Fa)}catch(eb){return null}return Sa}ta=Y(Fa,Ya,ta,Xa);return ca(ta,Sa)}function Ra(ta){ta=ta.fullSchema();if(null===ta||!ta.fields)return null;const Fa=[];for(const Sa of ta.fields)Fa.push(y.esriFieldToJson(Sa));return{objectIdField:ta.objectIdField,globalIdField:ta.globalIdField,geometryType:void 0===
y.layerGeometryEsriRestConstants[ta.geometryType]?"":y.layerGeometryEsriRestConstants[ta.geometryType],fields:Fa}}let Pa=function(ta){this.value=ta},qa=function(ta){this.value=ta},za=function(ta){this.fn=ta},Da=function(ta,Fa){this.paramCount=Fa;this.fn=ta};const La=za,Na=Da,Ua={type:"VOID"},Ta={type:"BREAK"},Za={type:"CONTINUE"};let ab=0;const hb=Object.freeze(Object.defineProperty({__proto__:null,ReturnResultE:Pa,ImplicitResultE:qa,NativeFunctionE:za,SizzleFunctionE:Da,NativeFunction:La,ImplicitResult:qa,
ReturnResult:Pa,SizzleFunction:Na,voidOperation:Ua,breakResult:Ta,continueResult:Za,multiReplace:f,isFunctionParameter:w,isSimpleType:z,defaultUndefined:A,isString:x,isBoolean:B,isNumber:C,isInteger:D,isArray:E,isFeature:F,isFeatureSet:G,isFeatureSetCollection:O,isImmutableArray:K,isDate:L,pcCheck:R,absRound:M,generateUUID:J,formatNumber:I,formatDate:P,standardiseDateFormat:N,greaterThanLessThan:S,equalityTest:T,toString:H,toNumberArray:U,toStringExplicit:W,toNumber:X,toDate:ba,toDateTime:aa,toBoolean:ia,
fixSpatialReference:ka,fixNullGeometry:la,getDomainValue:Z,getDomainCode:ca,getDomain:Y,stableStringify:ha,autoCastFeatureToGeometry:ja,autoCastArrayOfPointsToPolygon:pa,autoCastArrayOfPointsToPolyline:na,autoCastArrayOfPointsToMultiPoint:wa,toStringArray:xa,tick:sa,binaryOperator:ya,castAsJson:ra,castAsJsonAsync:Ea,featureFullDomain:va,featureSubtypes:Ca,featureDomainValueLookup:Ka,featureDomainCodeLookup:Oa,featureSchema:Ra},Symbol.toStringTag,{value:"Module"}));a.ImplicitResult=qa;a.ImplicitResultE=
qa;a.NativeFunction=La;a.NativeFunctionE=za;a.ReturnResult=Pa;a.ReturnResultE=Pa;a.SizzleFunction=Na;a.SizzleFunctionE=Da;a.absRound=M;a.autoCastArrayOfPointsToMultiPoint=wa;a.autoCastArrayOfPointsToPolygon=pa;a.autoCastArrayOfPointsToPolyline=na;a.autoCastFeatureToGeometry=ja;a.binaryOperator=ya;a.breakResult=Ta;a.castAsJson=ra;a.castAsJsonAsync=Ea;a.continueResult=Za;a.defaultUndefined=A;a.equalityTest=T;a.featureDomainCodeLookup=Oa;a.featureDomainValueLookup=Ka;a.featureFullDomain=va;a.featureSchema=
Ra;a.featureSubtypes=Ca;a.fixNullGeometry=la;a.fixSpatialReference=ka;a.formatDate=P;a.formatNumber=I;a.generateUUID=J;a.getDomain=Y;a.getDomainCode=ca;a.getDomainValue=Z;a.greaterThanLessThan=S;a.isArray=E;a.isBoolean=B;a.isDate=L;a.isFeature=F;a.isFeatureSet=G;a.isFeatureSetCollection=O;a.isFunctionParameter=w;a.isImmutableArray=K;a.isInteger=D;a.isNumber=C;a.isSimpleType=z;a.isString=x;a.lc=hb;a.multiReplace=f;a.pcCheck=R;a.stableStringify=ha;a.standardiseDateFormat=N;a.tick=sa;a.toBoolean=ia;
a.toDate=ba;a.toDateTime=aa;a.toNumber=X;a.toNumberArray=U;a.toString=H;a.toStringArray=xa;a.toStringExplicit=W;a.voidOperation=Ua})},"esri/arcade/FunctionWrapper":function(){define(function(){return function(a,b){this.context=this.definition=null;this.definition=a;this.context=b}})},"esri/arcade/ImmutableArray":function(){define(function(){return function(){function a(c=[]){this._elements=c}var b=a.prototype;b.length=function(){return this._elements.length};b.get=function(c){return this._elements[c]};
b.toArray=function(){const c=[];for(let n=0;n<this.length();n++)c.push(this.get(n));return c};return a}()})},"esri/arcade/ImmutablePathArray":function(){define(["../chunks/_rollupPluginBabelHelpers","./ImmutableArray","./ImmutablePointArray"],function(a,b,c){return function(n){function l(v,m,h,d,e){v=n.call(this,v)||this;v._lazyPath=[];v._hasZ=!1;v._hasM=!1;v._hasZ=h;v._hasM=d;v._spRef=m;v._cacheId=e;return v}a._inheritsLoose(l,n);var u=l.prototype;u.get=function(v){if(void 0===this._lazyPath[v]){const m=
this._elements[v];if(void 0===m)return;this._lazyPath[v]=new c(m,this._spRef,this._hasZ,this._hasM,this._cacheId,v)}return this._lazyPath[v]};u.equalityTest=function(v){return v===this?!0:null===v||!1===v instanceof l?!1:v.getUniqueHash()===this.getUniqueHash()};u.getUniqueHash=function(){return this._cacheId.toString()};return l}(b)})},"esri/arcade/ImmutablePointArray":function(){define(["../chunks/_rollupPluginBabelHelpers","./ImmutableArray","../geometry/Point"],function(a,b,c){return function(n){function l(v,
m,h,d,e,g){v=n.call(this,v)||this;v._lazyPt=[];v._hasZ=!1;v._hasM=!1;v._spRef=m;v._hasZ=h;v._hasM=d;v._cacheId=e;v._partId=g;return v}a._inheritsLoose(l,n);var u=l.prototype;u.get=function(v){if(void 0===this._lazyPt[v]){const m=this._elements[v];if(void 0===m)return;const h=this._hasZ,d=this._hasM;let e=null;e=h&&!d?new c(m[0],m[1],m[2],void 0,this._spRef):d&&!h?new c(m[0],m[1],void 0,m[2],this._spRef):h&&d?new c(m[0],m[1],m[2],m[3],this._spRef):new c(m[0],m[1],this._spRef);e.cache._arcadeCacheId=
this._cacheId.toString()+"-"+this._partId.toString()+"-"+v.toString();this._lazyPt[v]=e}return this._lazyPt[v]};u.equalityTest=function(v){return v===this?!0:null===v||!1===v instanceof l?!1:v.getUniqueHash()===this.getUniqueHash()};u.getUniqueHash=function(){return this._cacheId.toString()+"-"+this._partId.toString()};return l}(b)})},"esri/chunks/datetime":function(){define(["exports"],function(a){function b(fa){return"undefined"===typeof fa}function c(fa){return"number"===typeof fa}function n(fa){return"number"===
typeof fa&&0===fa%1}function l(){try{return"undefined"!==typeof Intl&&!!Intl.RelativeTimeFormat}catch(fa){return!1}}function u(fa,oa,Aa){if(0!==fa.length)return fa.reduce((Ga,Ma)=>{Ma=[oa(Ma),Ma];return Ga?Aa(Ga[0],Ma[0])===Ga[0]?Ga:Ma:Ma},null)[1]}function v(fa,oa){return oa.reduce((Aa,Ga)=>{Aa[Ga]=fa[Ga];return Aa},{})}function m(fa,oa){return Object.prototype.hasOwnProperty.call(fa,oa)}function h(fa,oa,Aa){return n(fa)&&fa>=oa&&fa<=Aa}function d(fa,oa=2){return 0>fa?"-"+(""+-fa).padStart(oa,"0"):
(""+fa).padStart(oa,"0")}function e(fa){if(!b(fa)&&null!==fa&&""!==fa)return parseInt(fa,10)}function g(fa){if(!b(fa)&&null!==fa&&""!==fa)return parseFloat(fa)}function p(fa){if(!b(fa)&&null!==fa&&""!==fa)return fa=1E3*parseFloat("0."+fa),Math.floor(fa)}function t(fa,oa,Aa=!1){oa=10**oa;return(Aa?Math.trunc:Math.round)(fa*oa)/oa}function q(fa){return 0===fa%4&&(0!==fa%100||0===fa%400)}function k(fa,oa){var Aa=oa-1;Aa=Aa-12*Math.floor(Aa/12)+1;return 2===Aa?q(fa+(oa-Aa)/12)?29:28:[31,null,31,30,31,
30,31,31,30,31,30,31][Aa-1]}function r(fa){let oa=Date.UTC(fa.year,fa.month-1,fa.day,fa.hour,fa.minute,fa.second,fa.millisecond);100>fa.year&&0<=fa.year&&(oa=new Date(oa),oa.setUTCFullYear(oa.getUTCFullYear()-1900));return+oa}function y(fa){var oa=fa-1;oa=(oa+Math.floor(oa/4)-Math.floor(oa/100)+Math.floor(oa/400))%7;return 4===(fa+Math.floor(fa/4)-Math.floor(fa/100)+Math.floor(fa/400))%7||3===oa?53:52}function f(fa){return 99<fa?fa:60<fa?1900+fa:2E3+fa}function w(fa,oa,Aa,Ga=null){fa=new Date(fa);
const Ma={hourCycle:"h23",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"};Ga&&(Ma.timeZone=Ga);return(oa=(new Intl.DateTimeFormat(Aa,{timeZoneName:oa,...Ma})).formatToParts(fa).find(Qa=>"timezonename"===Qa.type.toLowerCase()))?oa.value:null}function z(fa,oa){fa=parseInt(fa,10);Number.isNaN(fa)&&(fa=0);oa=parseInt(oa,10)||0;oa=0>fa||Object.is(fa,-0)?-oa:oa;return 60*fa+oa}function A(fa){const oa=Number(fa);if("boolean"===typeof fa||""===fa||Number.isNaN(oa))throw new Va(`Invalid unit value ${fa}`);
return oa}function x(fa,oa){const Aa={};for(const Ga in fa)if(m(fa,Ga)){const Ma=fa[Ga];void 0!==Ma&&null!==Ma&&(Aa[oa(Ga)]=A(Ma))}return Aa}function B(fa,oa){const Aa=Math.trunc(Math.abs(fa/60)),Ga=Math.trunc(Math.abs(fa%60));fa=0<=fa?"+":"-";switch(oa){case "short":return`${fa}${d(Aa,2)}:${d(Ga,2)}`;case "narrow":return`${fa}${Aa}${0<Ga?`:${Ga}`:""}`;case "techie":return`${fa}${d(Aa,2)}${d(Ga,2)}`;default:throw new RangeError(`Value format ${oa} is out of range for property format`);}}function C(fa){return v(fa,
["hour","minute","second","millisecond"])}function D(fa){switch(fa){case "narrow":return[...Mc];case "short":return[...fc];case "long":return[...Nc];case "numeric":return"1 2 3 4 5 6 7 8 9 10 11 12".split(" ");case "2-digit":return"01 02 03 04 05 06 07 08 09 10 11 12".split(" ");default:return null}}function E(fa){switch(fa){case "narrow":return[...Oc];case "short":return[...gc];case "long":return[...hc];case "numeric":return"1234567".split("");default:return null}}function F(fa){switch(fa){case "narrow":return[...Pc];
case "short":return[...Qc];case "long":return[...Rc];default:return null}}function G(fa,oa,Aa="always",Ga=!1){const Ma={years:["year","yr."],quarters:["quarter","qtr."],months:["month","mo."],weeks:["week","wk."],days:["day","day","days"],hours:["hour","hr."],minutes:["minute","min."],seconds:["second","sec."]};var Qa=-1===["hours","minutes","seconds"].indexOf(fa);if("auto"===Aa&&Qa)switch(Aa="days"===fa,oa){case 1:return Aa?"tomorrow":`next ${Ma[fa][0]}`;case -1:return Aa?"yesterday":`last ${Ma[fa][0]}`;
case 0:return Aa?"today":`this ${Ma[fa][0]}`}Aa=Object.is(oa,-0)||0>oa;oa=Math.abs(oa);Qa=1===oa;const Wa=Ma[fa];fa=Ga?Qa?Wa[1]:Wa[2]||Wa[1]:Qa?Ma[fa][0]:fa;return Aa?`${oa} ${fa} ago`:`in ${oa} ${fa}`}function O(fa,oa){let Aa="";for(const Ga of fa)Aa=Ga.literal?Aa+Ga.val:Aa+oa(Ga.val);return Aa}function K(fa,oa){if(b(fa)||null===fa)return oa;if(fa instanceof Nb)return fa;if("string"===typeof fa){const Aa=fa.toLowerCase();return"local"===Aa||"system"===Aa?oa:"utc"===Aa||"gmt"===Aa?Ab.utcInstance:
Ab.parseSpecifier(Aa)||Gb.create(fa)}return c(fa)?Ab.instance(fa):"object"===typeof fa&&fa.offset&&"number"===typeof fa.offset?fa:new Sc(fa)}function L(fa,oa={}){const Aa=JSON.stringify([fa,oa]);let Ga=ic[Aa];Ga||(Ga=new Intl.ListFormat(fa,oa),ic[Aa]=Ga);return Ga}function R(fa,oa={}){const Aa=JSON.stringify([fa,oa]);let Ga=Tb[Aa];Ga||(Ga=new Intl.DateTimeFormat(fa,oa),Tb[Aa]=Ga);return Ga}function M(fa,oa={}){const Aa=JSON.stringify([fa,oa]);let Ga=Ub[Aa];Ga||(Ga=new Intl.NumberFormat(fa,oa),Ub[Aa]=
Ga);return Ga}function J(fa,oa={}){const {base:Aa,...Ga}=oa,Ma=JSON.stringify([fa,Ga]);let Qa=Vb[Ma];Qa||(Qa=new Intl.RelativeTimeFormat(fa,oa),Vb[Ma]=Qa);return Qa}function I(fa){const oa=[];for(let Aa=1;12>=Aa;Aa++){const Ga=pb.utc(2016,Aa,1);oa.push(fa(Ga))}return oa}function P(fa){const oa=[];for(let Aa=1;7>=Aa;Aa++){const Ga=pb.utc(2016,11,13+Aa);oa.push(fa(Ga))}return oa}function N(fa,oa,Aa,Ga,Ma){fa=fa.listingMode(Aa);return"error"===fa?null:"en"===fa?Ga(oa):Ma(oa)}function V(...fa){fa=fa.reduce((oa,
Aa)=>oa+Aa.source,"");return RegExp(`^${fa}$`)}function S(...fa){return oa=>fa.reduce(([Aa,Ga,Ma],Qa)=>{const [Wa,bb,ib]=Qa(oa,Ma);return[{...Aa,...Wa},bb||Ga,ib]},[{},null,1]).slice(0,2)}function T(fa,...oa){if(null==fa)return[null,null];for(const [Aa,Ga]of oa)if(oa=Aa.exec(fa))return Ga(oa);return[null,null]}function H(...fa){return(oa,Aa)=>{const Ga={};let Ma;for(Ma=0;Ma<fa.length;Ma++)Ga[fa[Ma]]=e(oa[Aa+Ma]);return[Ga,null,Aa+Ma]}}function U(fa,oa,Aa){fa=fa[oa];return b(fa)?Aa:e(fa)}function W(fa,
oa){return[{hours:U(fa,oa,0),minutes:U(fa,oa+1,0),seconds:U(fa,oa+2,0),milliseconds:p(fa[oa+3])},null,oa+4]}function Q(fa,oa){const Aa=!fa[oa]&&!fa[oa+1];fa=z(fa[oa+1],fa[oa+2]);return[{},Aa?null:Ab.instance(fa),oa+3]}function X(fa,oa){return[{},fa[oa]?Gb.create(fa[oa]):null,oa+1]}function ba(fa){const [oa,Aa,Ga,Ma,Qa,Wa,bb,ib,vb]=fa,nb="-"===oa[0];fa=ib&&"-"===ib[0];const qb=(tb,Bb=!1)=>void 0!==tb&&(Bb||tb&&nb)?-tb:tb;return[{years:qb(g(Aa)),months:qb(g(Ga)),weeks:qb(g(Ma)),days:qb(g(Qa)),hours:qb(g(Wa)),
minutes:qb(g(bb)),seconds:qb(g(ib),"-0"===ib),milliseconds:qb(p(vb),fa)}]}function aa(fa,oa,Aa,Ga,Ma,Qa,Wa){oa={year:2===oa.length?f(e(oa)):e(oa),month:fc.indexOf(Aa)+1,day:e(Ga),hour:e(Ma),minute:e(Qa)};Wa&&(oa.second=e(Wa));fa&&(oa.weekday=3<fa.length?hc.indexOf(fa)+1:gc.indexOf(fa)+1);return oa}function ea(fa){const [,oa,Aa,Ga,Ma,Qa,Wa,bb,ib,vb,nb,qb]=fa;fa=aa(oa,Ma,Ga,Aa,Qa,Wa,bb);let tb;tb=ib?Tc[ib]:vb?0:z(nb,qb);return[fa,new Ab(tb)]}function ia(fa){const [,oa,Aa,Ga,Ma,Qa,Wa,bb]=fa;return[aa(oa,
Ma,Ga,Aa,Qa,Wa,bb),Ab.utcInstance]}function ka(fa){const [,oa,Aa,Ga,Ma,Qa,Wa,bb]=fa;return[aa(oa,bb,Aa,Ga,Ma,Qa,Wa),Ab.utcInstance]}function la(fa,oa,Aa=!1){fa={values:Aa?oa.values:{...fa.values,...oa.values||{}},loc:fa.loc.clone(oa.loc),conversionAccuracy:oa.conversionAccuracy||fa.conversionAccuracy};return new sb(fa)}function Z(fa,oa,Aa,Ga,Ma){fa=fa[Ma][Aa];var Qa=oa[Aa]/fa;Qa=Math.sign(Qa)!==Math.sign(Ga[Ma])&&0!==Ga[Ma]&&1>=Math.abs(Qa)?0>Qa?Math.floor(Qa):Math.ceil(Qa):Math.trunc(Qa);Ga[Ma]+=
Qa;oa[Aa]-=Qa*fa}function ca(fa,oa){Uc.reduce((Aa,Ga)=>{if(b(oa[Ga]))return Aa;Aa&&Z(fa,oa,Aa,oa,Ga);return Ga},null)}function Y(fa,oa){fa=oa.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf()-fa.toUTC(0,{keepLocalTime:!0}).startOf("day").valueOf();return Math.floor(sb.fromMillis(fa).as("days"))}function da(fa,oa,Aa){var Ga=[["years",(bb,ib)=>ib.year-bb.year],["quarters",(bb,ib)=>ib.quarter-bb.quarter],["months",(bb,ib)=>ib.month-bb.month+12*(ib.year-bb.year)],["weeks",(bb,ib)=>{bb=Y(bb,ib);return(bb-
bb%7)/7}],["days",Y]];const Ma={};let Qa,Wa;for(const [bb,ib]of Ga)0<=Aa.indexOf(bb)&&(Qa=bb,Ga=ib(fa,oa),Wa=fa.plus({[bb]:Ga}),Wa>oa?(fa=fa.plus({[bb]:Ga-1}),--Ga):fa=Wa,Ma[bb]=Ga);return[fa,Ma,Wa,Qa]}function ha(fa,oa,Aa,Ga){let [Ma,Qa,Wa,bb]=da(fa,oa,Aa);fa=oa-Ma;Aa=Aa.filter(ib=>0<=["hours","minutes","seconds","milliseconds"].indexOf(ib));0===Aa.length&&(Wa<oa&&(Wa=Ma.plus({[bb]:1})),Wa!==Ma&&(Qa[bb]=(Qa[bb]||0)+fa/(Wa-Ma)));oa=sb.fromObject(Qa,Ga);return 0<Aa.length?sb.fromMillis(fa,Ga).shiftTo(...Aa).plus(oa):
oa}function ja({numberingSystem:fa},oa=""){return new RegExp(`${Wb[fa||"latn"]}${oa}`)}function ma(fa,oa=Aa=>Aa){return{regex:fa,deser:([Aa])=>{{let Ga=parseInt(Aa,10);if(isNaN(Ga)){Ga="";for(let Ma=0;Ma<Aa.length;Ma++){const Qa=Aa.charCodeAt(Ma);if(-1!==Aa[Ma].search(Wb.hanidec))Ga+=Vc.indexOf(Aa[Ma]);else for(const Wa in jc){const [bb,ib]=jc[Wa];Qa>=bb&&Qa<=ib&&(Ga+=Qa-bb)}}Aa=parseInt(Ga,10)}else Aa=Ga}return oa(Aa)}}}function pa(fa){return fa.replace(/\./g,"\\.?").replace(Xb,kc)}function na(fa,
oa){return null===fa?null:{regex:RegExp(fa.map(pa).join("|")),deser:([Aa])=>fa.findIndex(Ga=>Aa.replace(/\./g,"").replace(Xb," ").toLowerCase()===Ga.replace(/\./g,"").replace(Xb," ").toLowerCase())+oa}}function wa(fa,oa){return{regex:fa,deser:([,Aa,Ga])=>z(Aa,Ga),groups:oa}}function xa(fa){return{regex:fa,deser:([oa])=>oa}}function sa(fa,oa){const Aa=ja(oa),Ga=ja(oa,"{2}"),Ma=ja(oa,"{3}"),Qa=ja(oa,"{4}"),Wa=ja(oa,"{6}"),bb=ja(oa,"{1,2}"),ib=ja(oa,"{1,3}"),vb=ja(oa,"{1,6}"),nb=ja(oa,"{1,9}"),qb=ja(oa,
"{2,4}"),tb=ja(oa,"{4,6}"),Bb=Hb=>({regex:RegExp(Hb.val.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$\x26")),deser:([Yb])=>Yb,literal:!0}),Mb=(Hb=>{if(fa.literal)return Bb(Hb);switch(Hb.val){case "G":return na(oa.eras("short",!1),0);case "GG":return na(oa.eras("long",!1),0);case "y":return ma(vb);case "yy":return ma(qb,f);case "yyyy":return ma(Qa);case "yyyyy":return ma(tb);case "yyyyyy":return ma(Wa);case "M":return ma(bb);case "MM":return ma(Ga);case "MMM":return na(oa.months("short",!0,!1),1);case "MMMM":return na(oa.months("long",
!0,!1),1);case "L":return ma(bb);case "LL":return ma(Ga);case "LLL":return na(oa.months("short",!1,!1),1);case "LLLL":return na(oa.months("long",!1,!1),1);case "d":return ma(bb);case "dd":return ma(Ga);case "o":return ma(ib);case "ooo":return ma(Ma);case "HH":return ma(Ga);case "H":return ma(bb);case "hh":return ma(Ga);case "h":return ma(bb);case "mm":return ma(Ga);case "m":return ma(bb);case "q":return ma(bb);case "qq":return ma(Ga);case "s":return ma(bb);case "ss":return ma(Ga);case "S":return ma(ib);
case "SSS":return ma(Ma);case "u":return xa(nb);case "uu":return xa(bb);case "uuu":return ma(Aa);case "a":return na(oa.meridiems(),0);case "kkkk":return ma(Qa);case "kk":return ma(qb,f);case "W":return ma(bb);case "WW":return ma(Ga);case "E":case "c":return ma(Aa);case "EEE":return na(oa.weekdays("short",!1,!1),1);case "EEEE":return na(oa.weekdays("long",!1,!1),1);case "ccc":return na(oa.weekdays("short",!0,!1),1);case "cccc":return na(oa.weekdays("long",!0,!1),1);case "Z":case "ZZ":return wa(new RegExp(`([+-]${bb.source})(?::(${Ga.source}))?`),
2);case "ZZZ":return wa(new RegExp(`([+-]${bb.source})(${Ga.source})?`),2);case "z":return xa(/[a-z_+-/]{1,256}?/i);default:return Bb(Hb)}})(fa)||{invalidReason:"missing Intl.DateTimeFormat.formatToParts support"};Mb.token=fa;return Mb}function ya(fa){return[`^${fa.map(oa=>oa.regex).reduce((oa,Aa)=>`${oa}(${Aa.source})`,"")}$`,fa]}function ra(fa,oa,Aa){if(fa=fa.match(oa)){oa={};let Ga=1;for(const Ma in Aa)if(m(Aa,Ma)){const Qa=Aa[Ma],Wa=Qa.groups?Qa.groups+1:1;!Qa.literal&&Qa.token&&(oa[Qa.token.val[0]]=
Qa.deser(fa.slice(Ga,Ga+Wa)));Ga+=Wa}return[fa,oa]}return[fa,{}]}function ua(fa){const oa=Ma=>{switch(Ma){case "S":return"millisecond";case "s":return"second";case "m":return"minute";case "h":case "H":return"hour";case "d":return"day";case "o":return"ordinal";case "L":case "M":return"month";case "y":return"year";case "E":case "c":return"weekday";case "W":return"weekNumber";case "k":return"weekYear";case "q":return"quarter";default:return null}};let Aa=null,Ga;b(fa.z)||(Aa=Gb.create(fa.z));b(fa.Z)||
(Aa||(Aa=new Ab(fa.Z)),Ga=fa.Z);b(fa.q)||(fa.M=3*(fa.q-1)+1);b(fa.h)||(12>fa.h&&1===fa.a?fa.h+=12:12===fa.h&&0===fa.a&&(fa.h=0));0===fa.G&&fa.y&&(fa.y=-fa.y);b(fa.u)||(fa.S=p(fa.u));return[Object.keys(fa).reduce((Ma,Qa)=>{const Wa=oa(Qa);Wa&&(Ma[Wa]=fa[Qa]);return Ma},{}),Aa,Ga]}function Ba(){Zb||(Zb=pb.fromMillis(1555555555555));return Zb}function Ea(fa,oa){if(fa.literal)return fa;const Aa=Cb.macroTokenToFormatOpts(fa.val);if(!Aa)return fa;oa=Cb.create(oa,Aa).formatDateTimeParts(Ba()).map(Ga=>{{const {type:Qa,
value:Wa}=Ga;if("literal"===Qa)Ga={literal:!0,val:Wa};else{Ga=Aa[Qa];var Ma=Wc[Qa];"object"===typeof Ma&&(Ma=Ma[Ga]);Ga=Ma?{literal:!1,val:Ma}:void 0}}return Ga});return oa.includes(void 0)?fa:oa}function Ja(fa,oa){return Array.prototype.concat(...fa.map(Aa=>Ea(Aa,oa)))}function va(fa,oa,Aa){Aa=Ja(Cb.parseFormat(Aa),fa);var Ga=Aa.map(Qa=>sa(Qa,fa));const Ma=Ga.find(Qa=>Qa.invalidReason);if(Ma)return{input:oa,tokens:Aa,invalidReason:Ma.invalidReason};{const [Qa,Wa]=ya(Ga);Ga=RegExp(Qa,"i");const [bb,
ib]=ra(oa,Ga,Wa),[vb,nb,qb]=ib?ua(ib):[null,null,void 0];if(m(ib,"a")&&m(ib,"H"))throw new Ia("Can't include meridiem when specifying 24-hour format");return{input:oa,tokens:Aa,regex:Ga,rawMatches:bb,matches:ib,result:vb,zone:nb,specificOffset:qb}}}function Ca(fa,oa){return new Eb("unit out of range",`you specified ${oa} (of type ${typeof oa}) as a ${fa}, which is invalid`)}function Ka(fa,oa,Aa){oa=new Date(Date.UTC(fa,oa-1,Aa));100>fa&&0<=fa&&oa.setUTCFullYear(oa.getUTCFullYear()-1900);fa=oa.getUTCDay();
return 0===fa?7:fa}function Oa(fa,oa){fa=q(fa)?$b:ac;const Aa=fa.findIndex(Ga=>Ga<oa);return{month:Aa+1,day:oa-fa[Aa]}}function Ra(fa){const {year:oa,month:Aa,day:Ga}=fa;var Ma=Ga+(q(oa)?$b:ac)[Aa-1];const Qa=Ka(oa,Aa,Ga);Ma=Math.floor((Ma-Qa+10)/7);let Wa;1>Ma?(Wa=oa-1,Ma=y(Wa)):Ma>y(oa)?(Wa=oa+1,Ma=1):Wa=oa;return{weekYear:Wa,weekNumber:Ma,weekday:Qa,...C(fa)}}function Pa(fa){const {weekYear:oa,weekNumber:Aa,weekday:Ga}=fa;var Ma=Ka(oa,1,4),Qa=q(oa)?366:365;Ma=7*Aa+Ga-Ma-3;1>Ma?(Qa=oa-1,Ma+=q(Qa)?
366:365):Ma>Qa?(Qa=oa+1,Ma-=q(oa)?366:365):Qa=oa;const {month:Wa,day:bb}=Oa(Qa,Ma);return{year:Qa,month:Wa,day:bb,...C(fa)}}function qa(fa){const {year:oa,month:Aa,day:Ga}=fa;var Ma=Ga+(q(oa)?$b:ac)[Aa-1];return{year:oa,ordinal:Ma,...C(fa)}}function za(fa){const {year:oa,ordinal:Aa}=fa,{month:Ga,day:Ma}=Oa(oa,Aa);return{year:oa,month:Ga,day:Ma,...C(fa)}}function Da(fa){const oa=n(fa.year),Aa=h(fa.month,1,12),Ga=h(fa.day,1,k(fa.year,fa.month));return oa?Aa?Ga?!1:Ca("day",fa.day):Ca("month",fa.month):
Ca("year",fa.year)}function La(fa){const {hour:oa,minute:Aa,second:Ga,millisecond:Ma}=fa;fa=h(oa,0,23)||24===oa&&0===Aa&&0===Ga&&0===Ma;const Qa=h(Aa,0,59),Wa=h(Ga,0,59),bb=h(Ma,0,999);return fa?Qa?Wa?bb?!1:Ca("millisecond",Ma):Ca("second",Ga):Ca("minute",Aa):Ca("hour",oa)}function Na(fa){return new Eb("unsupported zone",`the zone "${fa.name}" is not supported`)}function Ua(fa){null===fa.weekData&&(fa.weekData=Ra(fa.c));return fa.weekData}function Ta(fa,oa){fa={ts:fa.ts,zone:fa.zone,c:fa.c,o:fa.o,
loc:fa.loc,invalid:fa.invalid};return new pb({...fa,...oa,old:fa})}function Za(fa,oa,Aa){let Ga=fa-6E4*oa;const Ma=Aa.offset(Ga);if(oa===Ma)return[Ga,oa];Ga-=6E4*(Ma-oa);oa=Aa.offset(Ga);return Ma===oa?[Ga,Ma]:[fa-6E4*Math.min(Ma,oa),Math.max(Ma,oa)]}function ab(fa,oa){fa=new Date(fa+6E4*oa);return{year:fa.getUTCFullYear(),month:fa.getUTCMonth()+1,day:fa.getUTCDate(),hour:fa.getUTCHours(),minute:fa.getUTCMinutes(),second:fa.getUTCSeconds(),millisecond:fa.getUTCMilliseconds()}}function hb(fa,oa,Aa){return Za(r(fa),
oa,Aa)}function ta(fa,oa){const Aa=fa.o;var Ga=fa.c.year+Math.trunc(oa.years);const Ma=fa.c.month+Math.trunc(oa.months)+3*Math.trunc(oa.quarters);Ga={...fa.c,year:Ga,month:Ma,day:Math.min(fa.c.day,k(Ga,Ma))+Math.trunc(oa.days)+7*Math.trunc(oa.weeks)};oa=sb.fromObject({years:oa.years-Math.trunc(oa.years),quarters:oa.quarters-Math.trunc(oa.quarters),months:oa.months-Math.trunc(oa.months),weeks:oa.weeks-Math.trunc(oa.weeks),days:oa.days-Math.trunc(oa.days),hours:oa.hours,minutes:oa.minutes,seconds:oa.seconds,
milliseconds:oa.milliseconds}).as("milliseconds");Ga=r(Ga);let [Qa,Wa]=Za(Ga,Aa,fa.zone);0!==oa&&(Qa+=oa,Wa=fa.zone.offset(Qa));return{ts:Qa,o:Wa}}function Fa(fa,oa,Aa,Ga,Ma,Qa){const {setZone:Wa,zone:bb}=Aa;return fa&&0!==Object.keys(fa).length?(fa=pb.fromObject(fa,{...Aa,zone:oa||bb,specificOffset:Qa}),Wa?fa:fa.setZone(bb)):pb.invalid(new Eb("unparsable",`the input "${Ma}" can't be parsed as ${Ga}`))}function Sa(fa,oa,Aa=!0){return fa.isValid?Cb.create(wb.create("en-US"),{allowZ:Aa,forceSimple:!0}).formatDateTimeFromString(fa,
oa):null}function Xa(fa,oa){const Aa=9999<fa.c.year||0>fa.c.year;let Ga="";Aa&&0<=fa.c.year&&(Ga+="+");Ga+=d(fa.c.year,Aa?6:4);oa?(Ga=Ga+"-"+d(fa.c.month),Ga=Ga+"-"+d(fa.c.day)):(Ga+=d(fa.c.month),Ga+=d(fa.c.day));return Ga}function Ya(fa,oa,Aa,Ga,Ma,Qa){let Wa=d(fa.c.hour);oa?(Wa=Wa+":"+d(fa.c.minute),0===fa.c.second&&Aa||(Wa+=":")):Wa+=d(fa.c.minute);0===fa.c.second&&Aa||(Wa+=d(fa.c.second),0===fa.c.millisecond&&Ga||(Wa=Wa+"."+d(fa.c.millisecond,3)));Ma&&(fa.isOffsetFixed&&0===fa.offset&&!Qa?Wa+=
"Z":0>fa.o?(Wa=Wa+"-"+d(Math.trunc(-fa.o/60)),Wa=Wa+":"+d(Math.trunc(-fa.o%60))):(Wa=Wa+"+"+d(Math.trunc(fa.o/60)),Wa=Wa+":"+d(Math.trunc(fa.o%60))));Qa&&(Wa+="["+fa.zone.ianaName+"]");return Wa}function eb(fa){const oa={year:"year",years:"year",month:"month",months:"month",day:"day",days:"day",hour:"hour",hours:"hour",minute:"minute",minutes:"minute",quarter:"quarter",quarters:"quarter",second:"second",seconds:"second",millisecond:"millisecond",milliseconds:"millisecond",weekday:"weekday",weekdays:"weekday",
weeknumber:"weekNumber",weeksnumber:"weekNumber",weeknumbers:"weekNumber",weekyear:"weekYear",weekyears:"weekYear",ordinal:"ordinal"}[fa.toLowerCase()];if(!oa)throw new Ha(fa);return oa}function fb(fa,oa){const Aa=K(oa.zone,zb.defaultZone);oa=wb.fromObject(oa);const Ga=zb.now();var Ma;if(b(fa.year))fa=Ga;else{for(const Qa of lc)b(fa[Qa])&&(fa[Qa]=mc[Qa]);if(Ma=Da(fa)||La(fa))return pb.invalid(Ma);Ma=Aa.offset(Ga);[fa,Ma]=hb(fa,Ma,Aa)}return new pb({ts:fa,zone:Aa,loc:oa,o:Ma})}function mb(fa,oa,Aa){const Ga=
b(Aa.round)?!0:Aa.round,Ma=(Wa,bb)=>{Wa=t(Wa,Ga||Aa.calendary?0:2,!0);return oa.loc.clone(Aa).relFormatter(Aa).format(Wa,bb)},Qa=Wa=>Aa.calendary?oa.hasSame(fa,Wa)?0:oa.startOf(Wa).diff(fa.startOf(Wa),Wa).get(Wa):oa.diff(fa,Wa).get(Wa);if(Aa.unit)return Ma(Qa(Aa.unit),Aa.unit);for(const Wa of Aa.units){const bb=Qa(Wa);if(1<=Math.abs(bb))return Ma(bb,Wa)}return Ma(fa>oa?-0:0,Aa.units[Aa.units.length-1])}function jb(fa){let oa={};0<fa.length&&"object"===typeof fa[fa.length-1]?(oa=fa[fa.length-1],fa=
Array.from(fa).slice(0,fa.length-1)):fa=Array.from(fa);return[oa,fa]}function kb(fa){if(pb.isDateTime(fa))return fa;if(fa&&fa.valueOf&&c(fa.valueOf()))return pb.fromJSDate(fa);if(fa&&"object"===typeof fa)return pb.fromObject(fa);throw new Va(`Unknown datetime argument: ${fa}, of type ${typeof fa}`);}class ub extends Error{}class ob extends ub{constructor(fa){super(`Invalid DateTime: ${fa.toMessage()}`)}}class rb extends ub{constructor(fa){super(`Invalid Interval: ${fa.toMessage()}`)}}class cb extends ub{constructor(fa){super(`Invalid Duration: ${fa.toMessage()}`)}}
class Ia extends ub{}class Ha extends ub{constructor(fa){super(`Invalid unit ${fa}`)}}class Va extends ub{}class $a extends ub{constructor(){super("Zone is an abstract class")}}const db={year:"numeric",month:"numeric",day:"numeric"},gb={year:"numeric",month:"short",day:"numeric"},lb={year:"numeric",month:"short",day:"numeric",weekday:"short"},yb={year:"numeric",month:"long",day:"numeric"},Ib={year:"numeric",month:"long",day:"numeric",weekday:"long"},Db={hour:"numeric",minute:"numeric"},Fb={hour:"numeric",
minute:"numeric",second:"numeric"},Jb={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},Kb={hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"long"},Ob={hour:"numeric",minute:"numeric",hourCycle:"h23"},nc={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23"},oc={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23",timeZoneName:"short"},pc={hour:"numeric",minute:"numeric",second:"numeric",hourCycle:"h23",timeZoneName:"long"},qc={year:"numeric",
month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"},rc={year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},sc={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"},tc={year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"},Xc={year:"numeric",month:"short",day:"numeric",weekday:"short",hour:"numeric",minute:"numeric"},uc={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",
timeZoneName:"short"},vc={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},wc={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",timeZoneName:"long"},xc={year:"numeric",month:"long",day:"numeric",weekday:"long",hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"long"},yc=/[A-Za-z_+-]{1,256}(?::?\/[A-Za-z0-9_+-]{1,256}(?:\/[A-Za-z0-9_+-]{1,256})?)?/,Nc="January February March April May June July August September October November December".split(" "),
fc="Jan Feb Mar Apr May Jun Jul Aug Sep Oct Nov Dec".split(" "),Mc="JFMAMJJASOND".split(""),hc="Monday Tuesday Wednesday Thursday Friday Saturday Sunday".split(" "),gc="Mon Tue Wed Thu Fri Sat Sun".split(" "),Oc="MTWTFSS".split(""),zc=["AM","PM"],Rc=["Before Christ","Anno Domini"],Qc=["BC","AD"],Pc=["B","A"],Yc={D:db,DD:gb,DDD:yb,DDDD:Ib,t:Db,tt:Fb,ttt:Jb,tttt:Kb,T:Ob,TT:nc,TTT:oc,TTTT:pc,f:qc,ff:sc,fff:uc,ffff:wc,F:rc,FF:tc,FFF:vc,FFFF:xc};class Cb{static create(fa,oa={}){return new Cb(fa,oa)}static parseFormat(fa){let oa=
null,Aa="",Ga=!1;const Ma=[];for(let Qa=0;Qa<fa.length;Qa++){const Wa=fa.charAt(Qa);"'"===Wa?(0<Aa.length&&Ma.push({literal:Ga,val:Aa}),oa=null,Aa="",Ga=!Ga):Ga?Aa+=Wa:Wa===oa?Aa+=Wa:(0<Aa.length&&Ma.push({literal:!1,val:Aa}),oa=Aa=Wa)}0<Aa.length&&Ma.push({literal:Ga,val:Aa});return Ma}static macroTokenToFormatOpts(fa){return Yc[fa]}constructor(fa,oa){this.opts=oa;this.loc=fa;this.systemLoc=null}formatWithSystemDefault(fa,oa){null===this.systemLoc&&(this.systemLoc=this.loc.redefaultToSystem());return this.systemLoc.dtFormatter(fa,
{...this.opts,...oa}).format()}formatDateTime(fa,oa={}){return this.loc.dtFormatter(fa,{...this.opts,...oa}).format()}formatDateTimeParts(fa,oa={}){return this.loc.dtFormatter(fa,{...this.opts,...oa}).formatToParts()}resolvedOptions(fa,oa={}){return this.loc.dtFormatter(fa,{...this.opts,...oa}).resolvedOptions()}num(fa,oa=0){if(this.opts.forceSimple)return d(fa,oa);const Aa={...this.opts};0<oa&&(Aa.padTo=oa);return this.loc.numberFormatter(Aa).format(fa)}formatDateTimeFromString(fa,oa){const Aa="en"===
this.loc.listingMode(),Ga=this.loc.outputCalendar&&"gregory"!==this.loc.outputCalendar,Ma=(nb,qb)=>this.loc.extract(fa,nb,qb),Qa=nb=>fa.isOffsetFixed&&0===fa.offset&&nb.allowZ?"Z":fa.isValid?fa.zone.formatOffset(fa.ts,nb.format):"",Wa=(nb,qb)=>Aa?D(nb)[fa.month-1]:Ma(qb?{month:nb}:{month:nb,day:"numeric"},"month"),bb=(nb,qb)=>Aa?E(nb)[fa.weekday-1]:Ma(qb?{weekday:nb}:{weekday:nb,month:"long",day:"numeric"},"weekday"),ib=nb=>{const qb=Cb.macroTokenToFormatOpts(nb);return qb?this.formatWithSystemDefault(fa,
qb):nb},vb=nb=>Aa?F(nb)[0>fa.year?0:1]:Ma({era:nb},"era");return O(Cb.parseFormat(oa),nb=>{switch(nb){case "S":return this.num(fa.millisecond);case "u":case "SSS":return this.num(fa.millisecond,3);case "s":return this.num(fa.second);case "ss":return this.num(fa.second,2);case "uu":return this.num(Math.floor(fa.millisecond/10),2);case "uuu":return this.num(Math.floor(fa.millisecond/100));case "m":return this.num(fa.minute);case "mm":return this.num(fa.minute,2);case "h":return this.num(0===fa.hour%
12?12:fa.hour%12);case "hh":return this.num(0===fa.hour%12?12:fa.hour%12,2);case "H":return this.num(fa.hour);case "HH":return this.num(fa.hour,2);case "Z":return Qa({format:"narrow",allowZ:this.opts.allowZ});case "ZZ":return Qa({format:"short",allowZ:this.opts.allowZ});case "ZZZ":return Qa({format:"techie",allowZ:this.opts.allowZ});case "ZZZZ":return fa.zone.offsetName(fa.ts,{format:"short",locale:this.loc.locale});case "ZZZZZ":return fa.zone.offsetName(fa.ts,{format:"long",locale:this.loc.locale});
case "z":return fa.zoneName;case "a":return Aa?zc[12>fa.hour?0:1]:Ma({hour:"numeric",hourCycle:"h12"},"dayperiod");case "d":return Ga?Ma({day:"numeric"},"day"):this.num(fa.day);case "dd":return Ga?Ma({day:"2-digit"},"day"):this.num(fa.day,2);case "c":return this.num(fa.weekday);case "ccc":return bb("short",!0);case "cccc":return bb("long",!0);case "ccccc":return bb("narrow",!0);case "E":return this.num(fa.weekday);case "EEE":return bb("short",!1);case "EEEE":return bb("long",!1);case "EEEEE":return bb("narrow",
!1);case "L":return Ga?Ma({month:"numeric",day:"numeric"},"month"):this.num(fa.month);case "LL":return Ga?Ma({month:"2-digit",day:"numeric"},"month"):this.num(fa.month,2);case "LLL":return Wa("short",!0);case "LLLL":return Wa("long",!0);case "LLLLL":return Wa("narrow",!0);case "M":return Ga?Ma({month:"numeric"},"month"):this.num(fa.month);case "MM":return Ga?Ma({month:"2-digit"},"month"):this.num(fa.month,2);case "MMM":return Wa("short",!1);case "MMMM":return Wa("long",!1);case "MMMMM":return Wa("narrow",
!1);case "y":return Ga?Ma({year:"numeric"},"year"):this.num(fa.year);case "yy":return Ga?Ma({year:"2-digit"},"year"):this.num(fa.year.toString().slice(-2),2);case "yyyy":return Ga?Ma({year:"numeric"},"year"):this.num(fa.year,4);case "yyyyyy":return Ga?Ma({year:"numeric"},"year"):this.num(fa.year,6);case "G":return vb("short");case "GG":return vb("long");case "GGGGG":return vb("narrow");case "kk":return this.num(fa.weekYear.toString().slice(-2),2);case "kkkk":return this.num(fa.weekYear,4);case "W":return this.num(fa.weekNumber);
case "WW":return this.num(fa.weekNumber,2);case "o":return this.num(fa.ordinal);case "ooo":return this.num(fa.ordinal,3);case "q":return this.num(fa.quarter);case "qq":return this.num(fa.quarter,2);case "X":return this.num(Math.floor(fa.ts/1E3));case "x":return this.num(fa.ts);default:return ib(nb)}})}formatDurationFromString(fa,oa){const Aa=Ma=>{switch(Ma[0]){case "S":return"millisecond";case "s":return"second";case "m":return"minute";case "h":return"hour";case "d":return"day";case "w":return"week";
case "M":return"month";case "y":return"year";default:return null}};oa=Cb.parseFormat(oa);const Ga=oa.reduce((Ma,{literal:Qa,val:Wa})=>Qa?Ma:Ma.concat(Wa),[]);fa=fa.shiftTo(...Ga.map(Aa).filter(Ma=>Ma));return O(oa,(Ma=>Qa=>{const Wa=Aa(Qa);return Wa?this.num(Ma.get(Wa),Qa.length):Qa})(fa))}}class Eb{constructor(fa,oa){this.reason=fa;this.explanation=oa}toMessage(){return this.explanation?`${this.reason}: ${this.explanation}`:this.reason}}class Nb{get type(){throw new $a;}get name(){throw new $a;}get ianaName(){return this.name}get isUniversal(){throw new $a;
}offsetName(fa,oa){throw new $a;}formatOffset(fa,oa){throw new $a;}offset(fa){throw new $a;}equals(fa){throw new $a;}get isValid(){throw new $a;}}let bc=null;class Ac extends Nb{static get instance(){null===bc&&(bc=new Ac);return bc}get type(){return"system"}get name(){return(new Intl.DateTimeFormat).resolvedOptions().timeZone}get isUniversal(){return!1}offsetName(fa,{format:oa,locale:Aa}){return w(fa,oa,Aa)}formatOffset(fa,oa){return B(this.offset(fa),oa)}offset(fa){return-(new Date(fa)).getTimezoneOffset()}equals(fa){return"system"===
fa.type}get isValid(){return!0}}let Qb={};const Zc={year:0,month:1,day:2,era:3,hour:4,minute:5,second:6};let Rb={};class Gb extends Nb{static create(fa){Rb[fa]||(Rb[fa]=new Gb(fa));return Rb[fa]}static resetCache(){Rb={};Qb={}}static isValidSpecifier(fa){return this.isValidZone(fa)}static isValidZone(fa){if(!fa)return!1;try{return(new Intl.DateTimeFormat("en-US",{timeZone:fa})).format(),!0}catch(oa){return!1}}constructor(fa){super();this.zoneName=fa;this.valid=Gb.isValidZone(fa)}get type(){return"iana"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(fa,
{format:oa,locale:Aa}){return w(fa,oa,Aa,this.name)}formatOffset(fa,oa){return B(this.offset(fa),oa)}offset(fa){fa=new Date(fa);if(isNaN(fa))return NaN;var oa=this.name;Qb[oa]||(Qb[oa]=new Intl.DateTimeFormat("en-US",{hour12:!1,timeZone:oa,year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",era:"short"}));oa=Qb[oa];if(oa.formatToParts){oa=oa.formatToParts(fa);var Aa=[];for(let nb=0;nb<oa.length;nb++){const {type:qb,value:tb}=oa[nb],Bb=Zc[qb];"era"===qb?Aa[Bb]=
tb:b(Bb)||(Aa[Bb]=parseInt(tb,10))}oa=Aa}else{{oa=oa.format(fa).replace(/\u200E/g,"");oa=/(\d+)\/(\d+)\/(\d+) (AD|BC),? (\d+):(\d+):(\d+)/.exec(oa);const [,nb,qb,tb,Bb,Mb,Hb,Yb]=oa;oa=[tb,nb,qb,Bb,Mb,Hb,Yb]}}let [Ga,Ma,Qa,Wa,bb,ib,vb]=oa;"BC"===Wa&&(Ga=-Math.abs(Ga)+1);oa=r({year:Ga,month:Ma,day:Qa,hour:24===bb?0:bb,minute:ib,second:vb,millisecond:0});fa=+fa;Aa=fa%1E3;return(oa-(fa-(0<=Aa?Aa:1E3+Aa)))/6E4}equals(fa){return"iana"===fa.type&&fa.name===this.name}get isValid(){return this.valid}}let cc=
null;class Ab extends Nb{static get utcInstance(){null===cc&&(cc=new Ab(0));return cc}static instance(fa){return 0===fa?Ab.utcInstance:new Ab(fa)}static parseSpecifier(fa){return fa&&(fa=fa.match(/^utc(?:([+-]\d{1,2})(?::(\d{2}))?)?$/i))?new Ab(z(fa[1],fa[2])):null}constructor(fa){super();this.fixed=fa}get type(){return"fixed"}get name(){return 0===this.fixed?"UTC":`UTC${B(this.fixed,"narrow")}`}get ianaName(){return 0===this.fixed?"Etc/UTC":`Etc/GMT${B(-this.fixed,"narrow")}`}offsetName(){return this.name}formatOffset(fa,
oa){return B(this.fixed,oa)}get isUniversal(){return!0}offset(){return this.fixed}equals(fa){return"fixed"===fa.type&&fa.fixed===this.fixed}get isValid(){return!0}}class Sc extends Nb{constructor(fa){super();this.zoneName=fa}get type(){return"invalid"}get name(){return this.zoneName}get isUniversal(){return!1}offsetName(){return null}formatOffset(){return""}offset(){return NaN}equals(){return!1}get isValid(){return!1}}let Bc=()=>Date.now(),Cc="system",Dc=null,Ec=null,Fc=null,Gc;class zb{static get now(){return Bc}static set now(fa){Bc=
fa}static set defaultZone(fa){Cc=fa}static get defaultZone(){return K(Cc,Ac.instance)}static get defaultLocale(){return Dc}static set defaultLocale(fa){Dc=fa}static get defaultNumberingSystem(){return Ec}static set defaultNumberingSystem(fa){Ec=fa}static get defaultOutputCalendar(){return Fc}static set defaultOutputCalendar(fa){Fc=fa}static get throwOnInvalid(){return Gc}static set throwOnInvalid(fa){Gc=fa}static resetCaches(){wb.resetCache();Gb.resetCache()}}let ic={},Tb={},Ub={},Vb={},Sb=null;class $c{constructor(fa,
oa,Aa){this.padTo=Aa.padTo||0;this.floor=Aa.floor||!1;const {padTo:Ga,floor:Ma,...Qa}=Aa;if(!oa||0<Object.keys(Qa).length)oa={useGrouping:!1,...Aa},0<Aa.padTo&&(oa.minimumIntegerDigits=Aa.padTo),this.inf=M(fa,oa)}format(fa){if(this.inf)return this.inf.format(this.floor?Math.floor(fa):fa);fa=this.floor?Math.floor(fa):t(fa,3);return d(fa,this.padTo)}}class ad{constructor(fa,oa,Aa){this.opts=Aa;if(fa.zone.isUniversal){var Ga=fa.offset/60*-1;Ga=0<=Ga?`Etc/GMT+${Ga}`:`Etc/GMT${Ga}`;0!==fa.offset&&Gb.create(Ga).valid?
this.dt=fa:(Ga="UTC",this.dt=Aa.timeZoneName?fa:0===fa.offset?fa:pb.fromMillis(fa.ts+6E4*fa.offset))}else"system"===fa.zone.type?this.dt=fa:(this.dt=fa,Ga=fa.zone.name);fa={...this.opts};Ga&&(fa.timeZone=Ga);this.dtf=R(oa,fa)}format(){return this.dtf.format(this.dt.toJSDate())}formatToParts(){return this.dtf.formatToParts(this.dt.toJSDate())}resolvedOptions(){return this.dtf.resolvedOptions()}}class bd{constructor(fa,oa,Aa){this.opts={style:"long",...Aa};!oa&&l()&&(this.rtf=J(fa,Aa))}format(fa,oa){return this.rtf?
this.rtf.format(fa,oa):G(oa,fa,this.opts.numeric,"long"!==this.opts.style)}formatToParts(fa,oa){return this.rtf?this.rtf.formatToParts(fa,oa):[]}}class wb{static fromOpts(fa){return wb.create(fa.locale,fa.numberingSystem,fa.outputCalendar,fa.defaultToEN)}static create(fa,oa,Aa,Ga=!1){fa=fa||zb.defaultLocale;var Ma;(Ma=fa)||(Ga?Ga="en-US":(Sb||(Sb=(new Intl.DateTimeFormat).resolvedOptions().locale),Ga=Sb),Ma=Ga);return new wb(Ma,oa||zb.defaultNumberingSystem,Aa||zb.defaultOutputCalendar,fa)}static resetCache(){Sb=
null;Tb={};Ub={};Vb={}}static fromObject({locale:fa,numberingSystem:oa,outputCalendar:Aa}={}){return wb.create(fa,oa,Aa)}constructor(fa,oa,Aa,Ga){var Ma=fa.indexOf("-u-");if(-1===Ma)fa=[fa];else{let ib;Ma=fa.substring(0,Ma);try{ib=R(fa).resolvedOptions()}catch(qb){ib=R(Ma).resolvedOptions()}const {numberingSystem:vb,calendar:nb}=ib;fa=[Ma,vb,nb]}const [Qa,Wa,bb]=fa;this.locale=Qa;this.numberingSystem=oa||Wa||null;this.outputCalendar=Aa||bb||null;oa=this.locale;Aa=this.numberingSystem;if((fa=this.outputCalendar)||
Aa)oa+="-u",fa&&(oa+=`-ca-${fa}`),Aa&&(oa+=`-nu-${Aa}`);this.intl=oa;this.weekdaysCache={format:{},standalone:{}};this.monthsCache={format:{},standalone:{}};this.meridiemCache=null;this.eraCache={};this.specifiedLocale=Ga;this.fastNumbersCached=null}get fastNumbers(){if(null==this.fastNumbersCached){var fa=this.numberingSystem&&"latn"!==this.numberingSystem?!1:"latn"===this.numberingSystem||!this.locale||this.locale.startsWith("en")||"latn"===(new Intl.DateTimeFormat(this.intl)).resolvedOptions().numberingSystem;
this.fastNumbersCached=fa}return this.fastNumbersCached}listingMode(){const fa=this.isEnglish(),oa=(null===this.numberingSystem||"latn"===this.numberingSystem)&&(null===this.outputCalendar||"gregory"===this.outputCalendar);return fa&&oa?"en":"intl"}clone(fa){return fa&&0!==Object.getOwnPropertyNames(fa).length?wb.create(fa.locale||this.specifiedLocale,fa.numberingSystem||this.numberingSystem,fa.outputCalendar||this.outputCalendar,fa.defaultToEN||!1):this}redefaultToEN(fa={}){return this.clone({...fa,
defaultToEN:!0})}redefaultToSystem(fa={}){return this.clone({...fa,defaultToEN:!1})}months(fa,oa=!1,Aa=!0){return N(this,fa,Aa,D,()=>{const Ga=oa?{month:fa,day:"numeric"}:{month:fa},Ma=oa?"format":"standalone";this.monthsCache[Ma][fa]||(this.monthsCache[Ma][fa]=I(Qa=>this.extract(Qa,Ga,"month")));return this.monthsCache[Ma][fa]})}weekdays(fa,oa=!1,Aa=!0){return N(this,fa,Aa,E,()=>{const Ga=oa?{weekday:fa,year:"numeric",month:"long",day:"numeric"}:{weekday:fa},Ma=oa?"format":"standalone";this.weekdaysCache[Ma][fa]||
(this.weekdaysCache[Ma][fa]=P(Qa=>this.extract(Qa,Ga,"weekday")));return this.weekdaysCache[Ma][fa]})}meridiems(fa=!0){return N(this,void 0,fa,()=>zc,()=>{if(!this.meridiemCache){const oa={hour:"numeric",hourCycle:"h12"};this.meridiemCache=[pb.utc(2016,11,13,9),pb.utc(2016,11,13,19)].map(Aa=>this.extract(Aa,oa,"dayperiod"))}return this.meridiemCache})}eras(fa,oa=!0){return N(this,fa,oa,F,()=>{const Aa={era:fa};this.eraCache[fa]||(this.eraCache[fa]=[pb.utc(-40,1,1),pb.utc(2017,1,1)].map(Ga=>this.extract(Ga,
Aa,"era")));return this.eraCache[fa]})}extract(fa,oa,Aa){return(fa=this.dtFormatter(fa,oa).formatToParts().find(Ga=>Ga.type.toLowerCase()===Aa))?fa.value:null}numberFormatter(fa={}){return new $c(this.intl,fa.forceSimple||this.fastNumbers,fa)}dtFormatter(fa,oa={}){return new ad(fa,this.intl,oa)}relFormatter(fa={}){return new bd(this.intl,this.isEnglish(),fa)}listFormatter(fa={}){return L(this.intl,fa)}isEnglish(){return"en"===this.locale||"en-us"===this.locale.toLowerCase()||(new Intl.DateTimeFormat(this.intl)).resolvedOptions().locale.startsWith("en-us")}equals(fa){return this.locale===
fa.locale&&this.numberingSystem===fa.numberingSystem&&this.outputCalendar===fa.outputCalendar}}const Hc=/(?:(Z)|([+-]\d\d)(?::?(\d\d))?)/,dc=/(\d\d)(?::?(\d\d)(?::?(\d\d)(?:[.,](\d{1,30}))?)?)?/,Ic=RegExp(`${dc.source}${`(?:${Hc.source}?(?:\\[(${yc.source})\\])?)?`}`),ec=RegExp(`(?:T${Ic.source})?`),cd=H("weekYear","weekNumber","weekDay"),dd=H("year","ordinal"),Jc=RegExp(`${dc.source} ?(?:${Hc.source}|(${yc.source}))?`),ed=RegExp(`(?: ${Jc.source})?`),fd=RegExp(`^T?${dc.source}$`),gd=/^-?P(?:(?:(-?\d{1,9}(?:\.\d{1,9})?)Y)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,9}(?:\.\d{1,9})?)W)?(?:(-?\d{1,9}(?:\.\d{1,9})?)D)?(?:T(?:(-?\d{1,9}(?:\.\d{1,9})?)H)?(?:(-?\d{1,9}(?:\.\d{1,9})?)M)?(?:(-?\d{1,20})(?:[.,](-?\d{1,9}))?S)?)?)$/,
Tc={GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480},hd=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|(?:([+-]\d\d)(\d\d)))$/,id=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun), (\d\d) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) (\d{4}) (\d\d):(\d\d):(\d\d) GMT$/,jd=/^(Monday|Tuesday|Wedsday|Thursday|Friday|Saturday|Sunday), (\d\d)-(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)-(\d\d) (\d\d):(\d\d):(\d\d) GMT$/,
kd=/^(Mon|Tue|Wed|Thu|Fri|Sat|Sun) (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec) ( \d|\d\d) (\d\d):(\d\d):(\d\d) (\d{4})$/,ld=V(/([+-]\d{6}|\d{4})(?:-?(\d\d)(?:-?(\d\d))?)?/,ec),md=V(/(\d{4})-?W(\d\d)(?:-?(\d))?/,ec),nd=V(/(\d{4})-?(\d{3})/,ec),od=V(Ic),Kc=S(function(fa,oa){return[{year:U(fa,oa),month:U(fa,oa+1,1),day:U(fa,oa+2,1)},null,oa+3]},W,Q,X),pd=S(cd,W,Q,X),qd=S(dd,W,Q,X),rd=S(W,Q,X),sd=S(W),td=V(/(\d{4})-(\d\d)-(\d\d)/,ed),ud=V(Jc),vd=S(W,Q,X),Lc={weeks:{days:7,hours:168,minutes:10080,
seconds:604800,milliseconds:6048E5},days:{hours:24,minutes:1440,seconds:86400,milliseconds:864E5},hours:{minutes:60,seconds:3600,milliseconds:36E5},minutes:{seconds:60,milliseconds:6E4},seconds:{milliseconds:1E3}},wd={years:{quarters:4,months:12,weeks:52,days:365,hours:8760,minutes:525600,seconds:31536E3,milliseconds:31536E6},quarters:{months:3,weeks:13,days:91,hours:2184,minutes:131040,seconds:7862400,milliseconds:78624E5},months:{weeks:4,days:30,hours:720,minutes:43200,seconds:2592E3,milliseconds:2592E6},
...Lc},xd={years:{quarters:4,months:12,weeks:52.1775,days:365.2425,hours:8765.82,minutes:525949.2,seconds:31556952,milliseconds:31556952E3},quarters:{months:3,weeks:13.044375,days:91.310625,hours:2191.455,minutes:131487.3,seconds:7889238,milliseconds:7889238E3},months:{weeks:30.436875/7,days:30.436875,hours:730.485,minutes:43829.1,seconds:2629746,milliseconds:2629746E3},...Lc},Lb="years quarters months weeks days hours minutes seconds milliseconds".split(" "),Uc=Lb.slice(0).reverse();class sb{constructor(fa){const oa=
"longterm"===fa.conversionAccuracy||!1;this.values=fa.values;this.loc=fa.loc||wb.create();this.conversionAccuracy=oa?"longterm":"casual";this.invalid=fa.invalid||null;this.matrix=oa?xd:wd;this.isLuxonDuration=!0}static fromMillis(fa,oa){return sb.fromObject({milliseconds:fa},oa)}static fromObject(fa,oa={}){if(null==fa||"object"!==typeof fa)throw new Va(`Duration.fromObject: argument expected to be an object, got ${null===fa?"null":typeof fa}`);return new sb({values:x(fa,sb.normalizeUnit),loc:wb.fromObject(oa),
conversionAccuracy:oa.conversionAccuracy})}static fromDurationLike(fa){if(c(fa))return sb.fromMillis(fa);if(sb.isDuration(fa))return fa;if("object"===typeof fa)return sb.fromObject(fa);throw new Va(`Unknown duration argument ${fa} of type ${typeof fa}`);}static fromISO(fa,oa){const [Aa]=T(fa,[gd,ba]);return Aa?sb.fromObject(Aa,oa):sb.invalid("unparsable",`the input "${fa}" can't be parsed as ISO 8601`)}static fromISOTime(fa,oa){const [Aa]=T(fa,[fd,sd]);return Aa?sb.fromObject(Aa,oa):sb.invalid("unparsable",
`the input "${fa}" can't be parsed as ISO 8601`)}static invalid(fa,oa=null){if(!fa)throw new Va("need to specify a reason the Duration is invalid");fa=fa instanceof Eb?fa:new Eb(fa,oa);if(zb.throwOnInvalid)throw new cb(fa);return new sb({invalid:fa})}static normalizeUnit(fa){const oa={year:"years",years:"years",quarter:"quarters",quarters:"quarters",month:"months",months:"months",week:"weeks",weeks:"weeks",day:"days",days:"days",hour:"hours",hours:"hours",minute:"minutes",minutes:"minutes",second:"seconds",
seconds:"seconds",millisecond:"milliseconds",milliseconds:"milliseconds"}[fa?fa.toLowerCase():fa];if(!oa)throw new Ha(fa);return oa}static isDuration(fa){return fa&&fa.isLuxonDuration||!1}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}toFormat(fa,oa={}){oa={...oa,floor:!1!==oa.round&&!1!==oa.floor};return this.isValid?Cb.create(this.loc,oa).formatDurationFromString(this,fa):"Invalid Duration"}toHuman(fa={}){const oa=Lb.map(Aa=>
{const Ga=this.values[Aa];return b(Ga)?null:this.loc.numberFormatter({style:"unit",unitDisplay:"long",...fa,unit:Aa.slice(0,-1)}).format(Ga)}).filter(Aa=>Aa);return this.loc.listFormatter({type:"conjunction",style:fa.listStyle||"narrow",...fa}).format(oa)}toObject(){return this.isValid?{...this.values}:{}}toISO(){if(!this.isValid)return null;let fa="P";0!==this.years&&(fa+=this.years+"Y");if(0!==this.months||0!==this.quarters)fa+=this.months+3*this.quarters+"M";0!==this.weeks&&(fa+=this.weeks+"W");
0!==this.days&&(fa+=this.days+"D");if(0!==this.hours||0!==this.minutes||0!==this.seconds||0!==this.milliseconds)fa+="T";0!==this.hours&&(fa+=this.hours+"H");0!==this.minutes&&(fa+=this.minutes+"M");if(0!==this.seconds||0!==this.milliseconds)fa+=t(this.seconds+this.milliseconds/1E3,3)+"S";"P"===fa&&(fa+="T0S");return fa}toISOTime(fa={}){if(!this.isValid)return null;var oa=this.toMillis();if(0>oa||864E5<=oa)return null;fa={suppressMilliseconds:!1,suppressSeconds:!1,includePrefix:!1,format:"extended",
...fa};oa=this.shiftTo("hours","minutes","seconds","milliseconds");let Aa="basic"===fa.format?"hhmm":"hh:mm";fa.suppressSeconds&&0===oa.seconds&&0===oa.milliseconds||(Aa+="basic"===fa.format?"ss":":ss",fa.suppressMilliseconds&&0===oa.milliseconds||(Aa+=".SSS"));oa=oa.toFormat(Aa);fa.includePrefix&&(oa="T"+oa);return oa}toJSON(){return this.toISO()}toString(){return this.toISO()}toMillis(){return this.as("milliseconds")}valueOf(){return this.toMillis()}plus(fa){if(!this.isValid)return this;fa=sb.fromDurationLike(fa);
const oa={};for(const Aa of Lb)if(m(fa.values,Aa)||m(this.values,Aa))oa[Aa]=fa.get(Aa)+this.get(Aa);return la(this,{values:oa},!0)}minus(fa){if(!this.isValid)return this;fa=sb.fromDurationLike(fa);return this.plus(fa.negate())}mapUnits(fa){if(!this.isValid)return this;const oa={};for(const Aa of Object.keys(this.values))oa[Aa]=A(fa(this.values[Aa],Aa));return la(this,{values:oa},!0)}get(fa){return this[sb.normalizeUnit(fa)]}set(fa){if(!this.isValid)return this;fa={...this.values,...x(fa,sb.normalizeUnit)};
return la(this,{values:fa})}reconfigure({locale:fa,numberingSystem:oa,conversionAccuracy:Aa}={}){fa={loc:this.loc.clone({locale:fa,numberingSystem:oa})};Aa&&(fa.conversionAccuracy=Aa);return la(this,fa)}as(fa){return this.isValid?this.shiftTo(fa).get(fa):NaN}normalize(){if(!this.isValid)return this;const fa=this.toObject();ca(this.matrix,fa);return la(this,{values:fa},!0)}shiftTo(...fa){if(!this.isValid||0===fa.length)return this;fa=fa.map(Qa=>sb.normalizeUnit(Qa));const oa={},Aa={},Ga=this.toObject();
let Ma;for(const Qa of Lb)if(0<=fa.indexOf(Qa)){Ma=Qa;let Wa=0;for(const ib in Aa)Wa+=this.matrix[ib][Qa]*Aa[ib],Aa[ib]=0;c(Ga[Qa])&&(Wa+=Ga[Qa]);const bb=Math.trunc(Wa);oa[Qa]=bb;Aa[Qa]=(1E3*Wa-1E3*bb)/1E3;for(const ib in Ga)Lb.indexOf(ib)>Lb.indexOf(Qa)&&Z(this.matrix,Ga,ib,oa,Qa)}else c(Ga[Qa])&&(Aa[Qa]=Ga[Qa]);for(const Qa in Aa)0!==Aa[Qa]&&(oa[Ma]+=Qa===Ma?Aa[Qa]:Aa[Qa]/this.matrix[Ma][Qa]);return la(this,{values:oa},!0).normalize()}negate(){if(!this.isValid)return this;const fa={};for(const oa of Object.keys(this.values))fa[oa]=
0===this.values[oa]?0:-this.values[oa];return la(this,{values:fa},!0)}get years(){return this.isValid?this.values.years||0:NaN}get quarters(){return this.isValid?this.values.quarters||0:NaN}get months(){return this.isValid?this.values.months||0:NaN}get weeks(){return this.isValid?this.values.weeks||0:NaN}get days(){return this.isValid?this.values.days||0:NaN}get hours(){return this.isValid?this.values.hours||0:NaN}get minutes(){return this.isValid?this.values.minutes||0:NaN}get seconds(){return this.isValid?
this.values.seconds||0:NaN}get milliseconds(){return this.isValid?this.values.milliseconds||0:NaN}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}equals(fa){if(!this.isValid||!fa.isValid||!this.loc.equals(fa.loc))return!1;for(const Ga of Lb){var oa=this.values[Ga];var Aa=fa.values[Ga];oa=void 0===oa||0===oa?void 0===Aa||0===Aa:oa===Aa;if(!oa)return!1}return!0}}class xb{constructor(fa){this.s=
fa.start;this.e=fa.end;this.invalid=fa.invalid||null;this.isLuxonInterval=!0}static invalid(fa,oa=null){if(!fa)throw new Va("need to specify a reason the Interval is invalid");fa=fa instanceof Eb?fa:new Eb(fa,oa);if(zb.throwOnInvalid)throw new rb(fa);return new xb({invalid:fa})}static fromDateTimes(fa,oa){fa=kb(fa);oa=kb(oa);var Aa=fa&&fa.isValid?oa&&oa.isValid?oa<fa?xb.invalid("end before start",`The end of an interval must be after its start, but you had start=${fa.toISO()} and end=${oa.toISO()}`):
null:xb.invalid("missing or invalid end"):xb.invalid("missing or invalid start");return null==Aa?new xb({start:fa,end:oa}):Aa}static after(fa,oa){oa=sb.fromDurationLike(oa);fa=kb(fa);return xb.fromDateTimes(fa,fa.plus(oa))}static before(fa,oa){oa=sb.fromDurationLike(oa);fa=kb(fa);return xb.fromDateTimes(fa.minus(oa),fa)}static fromISO(fa,oa){const [Aa,Ga]=(fa||"").split("/",2);if(Aa&&Ga){let Wa;try{var Ma=pb.fromISO(Aa,oa);Wa=Ma.isValid}catch(ib){Wa=!1}let bb;try{var Qa=pb.fromISO(Ga,oa);bb=Qa.isValid}catch(ib){bb=
!1}if(Wa&&bb)return xb.fromDateTimes(Ma,Qa);if(Wa){if(Qa=sb.fromISO(Ga,oa),Qa.isValid)return xb.after(Ma,Qa)}else if(bb&&(Ma=sb.fromISO(Aa,oa),Ma.isValid))return xb.before(Qa,Ma)}return xb.invalid("unparsable",`the input "${fa}" can't be parsed as ISO 8601`)}static isInterval(fa){return fa&&fa.isLuxonInterval||!1}get start(){return this.isValid?this.s:null}get end(){return this.isValid?this.e:null}get isValid(){return null===this.invalidReason}get invalidReason(){return this.invalid?this.invalid.reason:
null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}length(fa="milliseconds"){return this.isValid?this.toDuration(...[fa]).get(fa):NaN}count(fa="milliseconds"){if(!this.isValid)return NaN;const oa=this.start.startOf(fa),Aa=this.end.startOf(fa);return Math.floor(Aa.diff(oa,fa).get(fa))+1}hasSame(fa){return this.isValid?this.isEmpty()||this.e.minus(1).hasSame(this.s,fa):!1}isEmpty(){return this.s.valueOf()===this.e.valueOf()}isAfter(fa){return this.isValid?this.s>fa:!1}isBefore(fa){return this.isValid?
this.e<=fa:!1}contains(fa){return this.isValid?this.s<=fa&&this.e>fa:!1}set({start:fa,end:oa}={}){return this.isValid?xb.fromDateTimes(fa||this.s,oa||this.e):this}splitAt(...fa){if(!this.isValid)return[];fa=fa.map(kb).filter(Qa=>this.contains(Qa)).sort();const oa=[];let {s:Aa}=this,Ga=0;for(;Aa<this.e;){var Ma=fa[Ga]||this.e;Ma=+Ma>+this.e?this.e:Ma;oa.push(xb.fromDateTimes(Aa,Ma));Aa=Ma;Ga+=1}return oa}splitBy(fa){fa=sb.fromDurationLike(fa);if(!this.isValid||!fa.isValid||0===fa.as("milliseconds"))return[];
let {s:oa}=this,Aa=1;const Ga=[];for(;oa<this.e;){var Ma=this.start.plus(fa.mapUnits(Qa=>Qa*Aa));Ma=+Ma>+this.e?this.e:Ma;Ga.push(xb.fromDateTimes(oa,Ma));oa=Ma;Aa+=1}return Ga}divideEqually(fa){return this.isValid?this.splitBy(this.length()/fa).slice(0,fa):[]}overlaps(fa){return this.e>fa.s&&this.s<fa.e}abutsStart(fa){return this.isValid?+this.e===+fa.s:!1}abutsEnd(fa){return this.isValid?+fa.e===+this.s:!1}engulfs(fa){return this.isValid?this.s<=fa.s&&this.e>=fa.e:!1}equals(fa){return this.isValid&&
fa.isValid?this.s.equals(fa.s)&&this.e.equals(fa.e):!1}intersection(fa){if(!this.isValid)return this;const oa=this.s>fa.s?this.s:fa.s;fa=this.e<fa.e?this.e:fa.e;return oa>=fa?null:xb.fromDateTimes(oa,fa)}union(fa){return this.isValid?xb.fromDateTimes(this.s<fa.s?this.s:fa.s,this.e>fa.e?this.e:fa.e):this}static merge(fa){const [oa,Aa]=fa.sort((Ga,Ma)=>Ga.s-Ma.s).reduce(([Ga,Ma],Qa)=>Ma?Ma.overlaps(Qa)||Ma.abutsStart(Qa)?[Ga,Ma.union(Qa)]:[Ga.concat([Ma]),Qa]:[Ga,Qa],[[],null]);Aa&&oa.push(Aa);return oa}static xor(fa){let oa=
null,Aa=0;const Ga=[];fa=fa.map(Ma=>[{time:Ma.s,type:"s"},{time:Ma.e,type:"e"}]);fa=Array.prototype.concat(...fa).sort((Ma,Qa)=>Ma.time-Qa.time);for(const Ma of fa)Aa+="s"===Ma.type?1:-1,1===Aa?oa=Ma.time:(oa&&+oa!==+Ma.time&&Ga.push(xb.fromDateTimes(oa,Ma.time)),oa=null);return xb.merge(Ga)}difference(...fa){return xb.xor([this].concat(fa)).map(oa=>this.intersection(oa)).filter(oa=>oa&&!oa.isEmpty())}toString(){return this.isValid?`[${this.s.toISO()} \u2013 ${this.e.toISO()})`:"Invalid Interval"}toISO(fa){return this.isValid?
`${this.s.toISO(fa)}/${this.e.toISO(fa)}`:"Invalid Interval"}toISODate(){return this.isValid?`${this.s.toISODate()}/${this.e.toISODate()}`:"Invalid Interval"}toISOTime(fa){return this.isValid?`${this.s.toISOTime(fa)}/${this.e.toISOTime(fa)}`:"Invalid Interval"}toFormat(fa,{separator:oa=" \u2013 "}={}){return this.isValid?`${this.s.toFormat(fa)}${oa}${this.e.toFormat(fa)}`:"Invalid Interval"}toDuration(fa,oa){return this.isValid?this.e.diff(this.s,fa,oa):sb.invalid(this.invalidReason)}mapEndpoints(fa){return xb.fromDateTimes(fa(this.s),
fa(this.e))}}class Pb{static hasDST(fa=zb.defaultZone){const oa=pb.now().setZone(fa).set({month:12});return!fa.isUniversal&&oa.offset!==oa.set({month:6}).offset}static isValidIANAZone(fa){return Gb.isValidZone(fa)}static normalizeZone(fa){return K(fa,zb.defaultZone)}static months(fa="long",{locale:oa=null,numberingSystem:Aa=null,locObj:Ga=null,outputCalendar:Ma="gregory"}={}){return(Ga||wb.create(oa,Aa,Ma)).months(fa)}static monthsFormat(fa="long",{locale:oa=null,numberingSystem:Aa=null,locObj:Ga=
null,outputCalendar:Ma="gregory"}={}){return(Ga||wb.create(oa,Aa,Ma)).months(fa,!0)}static weekdays(fa="long",{locale:oa=null,numberingSystem:Aa=null,locObj:Ga=null}={}){return(Ga||wb.create(oa,Aa,null)).weekdays(fa)}static weekdaysFormat(fa="long",{locale:oa=null,numberingSystem:Aa=null,locObj:Ga=null}={}){return(Ga||wb.create(oa,Aa,null)).weekdays(fa,!0)}static meridiems({locale:fa=null}={}){return wb.create(fa).meridiems()}static eras(fa="short",{locale:oa=null}={}){return wb.create(oa,null,"gregory").eras(fa)}static features(){return{relative:l()}}}
const Wb={arab:"[\u0660-\u0669]",arabext:"[\u06f0-\u06f9]",bali:"[\u1b50-\u1b59]",beng:"[\u09e6-\u09ef]",deva:"[\u0966-\u096f]",fullwide:"[\uff10-\uff19]",gujr:"[\u0ae6-\u0aef]",hanidec:"[\u3007|\u4e00|\u4e8c|\u4e09|\u56db|\u4e94|\u516d|\u4e03|\u516b|\u4e5d]",khmr:"[\u17e0-\u17e9]",knda:"[\u0ce6-\u0cef]",laoo:"[\u0ed0-\u0ed9]",limb:"[\u1946-\u194f]",mlym:"[\u0d66-\u0d6f]",mong:"[\u1810-\u1819]",mymr:"[\u1040-\u1049]",orya:"[\u0b66-\u0b6f]",tamldec:"[\u0be6-\u0bef]",telu:"[\u0c66-\u0c6f]",thai:"[\u0e50-\u0e59]",
tibt:"[\u0f20-\u0f29]",latn:"\\d"},jc={arab:[1632,1641],arabext:[1776,1785],bali:[6992,7001],beng:[2534,2543],deva:[2406,2415],fullwide:[65296,65303],gujr:[2790,2799],khmr:[6112,6121],knda:[3302,3311],laoo:[3792,3801],limb:[6470,6479],mlym:[3430,3439],mong:[6160,6169],mymr:[4160,4169],orya:[2918,2927],tamldec:[3046,3055],telu:[3174,3183],thai:[3664,3673],tibt:[3872,3881]},Vc=Wb.hanidec.replace(/[\[|\]]/g,"").split(""),kc=`[ ${String.fromCharCode(160)}]`,Xb=new RegExp(kc,"g"),Wc={year:{"2-digit":"yy",
numeric:"yyyyy"},month:{numeric:"M","2-digit":"MM",short:"MMM",long:"MMMM"},day:{numeric:"d","2-digit":"dd"},weekday:{short:"EEE",long:"EEEE"},dayperiod:"a",dayPeriod:"a",hour:{numeric:"h","2-digit":"hh"},minute:{numeric:"m","2-digit":"mm"},second:{numeric:"s","2-digit":"ss"}};let Zb=null;const ac=[0,31,59,90,120,151,181,212,243,273,304,334],$b=[0,31,60,91,121,152,182,213,244,274,305,335],mc={month:1,day:1,hour:0,minute:0,second:0,millisecond:0},yd={weekNumber:1,weekday:1,hour:0,minute:0,second:0,
millisecond:0},zd={ordinal:1,hour:0,minute:0,second:0,millisecond:0},lc="year month day hour minute second millisecond".split(" "),Ad="weekYear weekNumber weekday hour minute second millisecond".split(" "),Bd="year ordinal hour minute second millisecond".split(" ");class pb{constructor(fa){const oa=fa.zone||zb.defaultZone;let Aa=fa.invalid||(Number.isNaN(fa.ts)?new Eb("invalid input"):null)||(oa.isValid?null:Na(oa));this.ts=b(fa.ts)?zb.now():fa.ts;let Ga=null;var Ma=null;Aa||(fa.old&&fa.old.ts===
this.ts&&fa.old.zone.equals(oa)?[Ga,Ma]=[fa.old.c,fa.old.o]:(Ma=oa.offset(this.ts),Ga=ab(this.ts,Ma),Ga=(Aa=Number.isNaN(Ga.year)?new Eb("invalid input"):null)?null:Ga,Ma=Aa?null:Ma));this._zone=oa;this.loc=fa.loc||wb.create();this.invalid=Aa;this.weekData=null;this.c=Ga;this.o=Ma;this.isLuxonDateTime=!0}static now(){return new pb({})}static local(){const [fa,oa]=jb(arguments),[Aa,Ga,Ma,Qa,Wa,bb,ib]=oa;return fb({year:Aa,month:Ga,day:Ma,hour:Qa,minute:Wa,second:bb,millisecond:ib},fa)}static utc(){const [fa,
oa]=jb(arguments),[Aa,Ga,Ma,Qa,Wa,bb,ib]=oa;fa.zone=Ab.utcInstance;return fb({year:Aa,month:Ga,day:Ma,hour:Qa,minute:Wa,second:bb,millisecond:ib},fa)}static fromJSDate(fa,oa={}){fa="[object Date]"===Object.prototype.toString.call(fa)?fa.valueOf():NaN;if(Number.isNaN(fa))return pb.invalid("invalid input");const Aa=K(oa.zone,zb.defaultZone);return Aa.isValid?new pb({ts:fa,zone:Aa,loc:wb.fromObject(oa)}):pb.invalid(Na(Aa))}static fromMillis(fa,oa={}){if(c(fa))return-864E13>fa||864E13<fa?pb.invalid("Timestamp out of range"):
new pb({ts:fa,zone:K(oa.zone,zb.defaultZone),loc:wb.fromObject(oa)});throw new Va(`fromMillis requires a numerical input, but received a ${typeof fa} with value ${fa}`);}static fromSeconds(fa,oa={}){if(c(fa))return new pb({ts:1E3*fa,zone:K(oa.zone,zb.defaultZone),loc:wb.fromObject(oa)});throw new Va("fromSeconds requires a numerical input");}static fromObject(fa,oa={}){fa=fa||{};var Aa=K(oa.zone,zb.defaultZone);if(!Aa.isValid)return pb.invalid(Na(Aa));var Ga=zb.now();const Ma=b(oa.specificOffset)?
Aa.offset(Ga):oa.specificOffset,Qa=x(fa,eb);var Wa=!b(Qa.ordinal),bb=!b(Qa.year),ib=!b(Qa.month)||!b(Qa.day);bb=bb||ib;var vb=Qa.weekYear||Qa.weekNumber;oa=wb.fromObject(oa);if((bb||Wa)&&vb)throw new Ia("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(ib&&Wa)throw new Ia("Can't mix ordinal dates with month/day");ib=vb||Qa.weekday&&!bb;let nb=ab(Ga,Ma);ib?(Ga=Ad,vb=yd,nb=Ra(nb)):Wa?(Ga=Bd,vb=zd,nb=qa(nb)):(Ga=lc,vb=mc);let qb=!1;for(var tb of Ga)b(Qa[tb])?Qa[tb]=qb?vb[tb]:
nb[tb]:qb=!0;ib?(tb=n(Qa.weekYear),Ga=h(Qa.weekNumber,1,y(Qa.weekYear)),vb=h(Qa.weekday,1,7),tb=tb?Ga?vb?!1:Ca("weekday",Qa.weekday):Ca("week",Qa.week):Ca("weekYear",Qa.weekYear)):Wa?(tb=n(Qa.year),Ga=h(Qa.ordinal,1,q(Qa.year)?366:365),tb=tb?Ga?!1:Ca("ordinal",Qa.ordinal):Ca("year",Qa.year)):tb=Da(Qa);if(tb=tb||La(Qa))return pb.invalid(tb);Wa=ib?Pa(Qa):Wa?za(Qa):Qa;const [Bb,Mb]=hb(Wa,Ma,Aa);Aa=new pb({ts:Bb,zone:Aa,o:Mb,loc:oa});return Qa.weekday&&bb&&fa.weekday!==Aa.weekday?pb.invalid("mismatched weekday",
`you can't specify both a weekday of ${Qa.weekday} and a date of ${Aa.toISO()}`):Aa}static fromISO(fa,oa={}){const [Aa,Ga]=T(fa,[ld,Kc],[md,pd],[nd,qd],[od,rd]);return Fa(Aa,Ga,oa,"ISO 8601",fa)}static fromRFC2822(fa,oa={}){const [Aa,Ga]=T(fa.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim(),[hd,ea]);return Fa(Aa,Ga,oa,"RFC 2822",fa)}static fromHTTP(fa,oa={}){const [Aa,Ga]=T(fa,[id,ia],[jd,ia],[kd,ka]);return Fa(Aa,Ga,oa,"HTTP",oa)}static fromFormat(fa,oa,Aa={}){if(b(fa)||b(oa))throw new Va("fromFormat requires an input string and a format");
const {locale:Ga=null,numberingSystem:Ma=null}=Aa;var Qa=wb.fromOpts({locale:Ga,numberingSystem:Ma,defaultToEN:!0});{const {result:nb,zone:qb,specificOffset:tb,invalidReason:Bb}=va(Qa,fa,oa);Qa=[nb,qb,tb,Bb]}const [Wa,bb,ib,vb]=Qa;return vb?pb.invalid(vb):Fa(Wa,bb,Aa,`format ${oa}`,fa,ib)}static fromString(fa,oa,Aa={}){return pb.fromFormat(fa,oa,Aa)}static fromSQL(fa,oa={}){const [Aa,Ga]=T(fa,[td,Kc],[ud,vd]);return Fa(Aa,Ga,oa,"SQL",fa)}static invalid(fa,oa=null){if(!fa)throw new Va("need to specify a reason the DateTime is invalid");
fa=fa instanceof Eb?fa:new Eb(fa,oa);if(zb.throwOnInvalid)throw new ob(fa);return new pb({invalid:fa})}static isDateTime(fa){return fa&&fa.isLuxonDateTime||!1}get(fa){return this[fa]}get isValid(){return null===this.invalid}get invalidReason(){return this.invalid?this.invalid.reason:null}get invalidExplanation(){return this.invalid?this.invalid.explanation:null}get locale(){return this.isValid?this.loc.locale:null}get numberingSystem(){return this.isValid?this.loc.numberingSystem:null}get outputCalendar(){return this.isValid?
this.loc.outputCalendar:null}get zone(){return this._zone}get zoneName(){return this.isValid?this.zone.name:null}get year(){return this.isValid?this.c.year:NaN}get quarter(){return this.isValid?Math.ceil(this.c.month/3):NaN}get month(){return this.isValid?this.c.month:NaN}get day(){return this.isValid?this.c.day:NaN}get hour(){return this.isValid?this.c.hour:NaN}get minute(){return this.isValid?this.c.minute:NaN}get second(){return this.isValid?this.c.second:NaN}get millisecond(){return this.isValid?
this.c.millisecond:NaN}get weekYear(){return this.isValid?Ua(this).weekYear:NaN}get weekNumber(){return this.isValid?Ua(this).weekNumber:NaN}get weekday(){return this.isValid?Ua(this).weekday:NaN}get ordinal(){return this.isValid?qa(this.c).ordinal:NaN}get monthShort(){return this.isValid?Pb.months("short",{locObj:this.loc})[this.month-1]:null}get monthLong(){return this.isValid?Pb.months("long",{locObj:this.loc})[this.month-1]:null}get weekdayShort(){return this.isValid?Pb.weekdays("short",{locObj:this.loc})[this.weekday-
1]:null}get weekdayLong(){return this.isValid?Pb.weekdays("long",{locObj:this.loc})[this.weekday-1]:null}get offset(){return this.isValid?+this.o:NaN}get offsetNameShort(){return this.isValid?this.zone.offsetName(this.ts,{format:"short",locale:this.locale}):null}get offsetNameLong(){return this.isValid?this.zone.offsetName(this.ts,{format:"long",locale:this.locale}):null}get isOffsetFixed(){return this.isValid?this.zone.isUniversal:null}get isInDST(){return this.isOffsetFixed?!1:this.offset>this.set({month:1,
day:1}).offset||this.offset>this.set({month:5}).offset}get isInLeapYear(){return q(this.year)}get daysInMonth(){return k(this.year,this.month)}get daysInYear(){return this.isValid?q(this.year)?366:365:NaN}get weeksInWeekYear(){return this.isValid?y(this.weekYear):NaN}resolvedLocaleOptions(fa={}){const {locale:oa,numberingSystem:Aa,calendar:Ga}=Cb.create(this.loc.clone(fa),fa).resolvedOptions(this);return{locale:oa,numberingSystem:Aa,outputCalendar:Ga}}toUTC(fa=0,oa={}){return this.setZone(Ab.instance(fa),
oa)}toLocal(){return this.setZone(zb.defaultZone)}setZone(fa,{keepLocalTime:oa=!1,keepCalendarTime:Aa=!1}={}){fa=K(fa,zb.defaultZone);if(fa.equals(this.zone))return this;if(fa.isValid){let Ga=this.ts;if(oa||Aa)oa=fa.offset(this.ts),Aa=this.toObject(),[Ga]=hb(Aa,oa,fa);return Ta(this,{ts:Ga,zone:fa})}return pb.invalid(Na(fa))}reconfigure({locale:fa,numberingSystem:oa,outputCalendar:Aa}={}){fa=this.loc.clone({locale:fa,numberingSystem:oa,outputCalendar:Aa});return Ta(this,{loc:fa})}setLocale(fa){return this.reconfigure({locale:fa})}set(fa){if(!this.isValid)return this;
fa=x(fa,eb);var oa=!b(fa.weekYear)||!b(fa.weekNumber)||!b(fa.weekday);const Aa=!b(fa.ordinal),Ga=!b(fa.year),Ma=!b(fa.month)||!b(fa.day),Qa=fa.weekYear||fa.weekNumber;if((Ga||Ma||Aa)&&Qa)throw new Ia("Can't mix weekYear/weekNumber units with year/month/day or ordinals");if(Ma&&Aa)throw new Ia("Can't mix ordinal dates with month/day");oa?oa=Pa({...Ra(this.c),...fa}):b(fa.ordinal)?(oa={...this.toObject(),...fa},b(fa.day)&&(oa.day=Math.min(k(oa.year,oa.month),oa.day))):oa=za({...qa(this.c),...fa});const [Wa,
bb]=hb(oa,this.o,this.zone);return Ta(this,{ts:Wa,o:bb})}plus(fa){if(!this.isValid)return this;fa=sb.fromDurationLike(fa);return Ta(this,ta(this,fa))}minus(fa){if(!this.isValid)return this;fa=sb.fromDurationLike(fa).negate();return Ta(this,ta(this,fa))}startOf(fa){if(!this.isValid)return this;const oa={};fa=sb.normalizeUnit(fa);switch(fa){case "years":oa.month=1;case "quarters":case "months":oa.day=1;case "weeks":case "days":oa.hour=0;case "hours":oa.minute=0;case "minutes":oa.second=0;case "seconds":oa.millisecond=
0}"weeks"===fa&&(oa.weekday=1);"quarters"===fa&&(oa.month=3*(Math.ceil(this.month/3)-1)+1);return this.set(oa)}endOf(fa){return this.isValid?this.plus({[fa]:1}).startOf(fa).minus(1):this}toFormat(fa,oa={}){return this.isValid?Cb.create(this.loc.redefaultToEN(oa)).formatDateTimeFromString(this,fa):"Invalid DateTime"}toLocaleString(fa=db,oa={}){return this.isValid?Cb.create(this.loc.clone(oa),fa).formatDateTime(this):"Invalid DateTime"}toLocaleParts(fa={}){return this.isValid?Cb.create(this.loc.clone(fa),
fa).formatDateTimeParts(this):[]}toISO({format:fa="extended",suppressSeconds:oa=!1,suppressMilliseconds:Aa=!1,includeOffset:Ga=!0,extendedZone:Ma=!1}={}){if(!this.isValid)return null;fa="extended"===fa;let Qa=Xa(this,fa);return Qa=Qa+"T"+Ya(this,fa,oa,Aa,Ga,Ma)}toISODate({format:fa="extended"}={}){return this.isValid?Xa(this,"extended"===fa):null}toISOWeekDate(){return Sa(this,"kkkk-'W'WW-c")}toISOTime({suppressMilliseconds:fa=!1,suppressSeconds:oa=!1,includeOffset:Aa=!0,includePrefix:Ga=!1,extendedZone:Ma=
!1,format:Qa="extended"}={}){return this.isValid?(Ga?"T":"")+Ya(this,"extended"===Qa,oa,fa,Aa,Ma):null}toRFC2822(){return Sa(this,"EEE, dd LLL yyyy HH:mm:ss ZZZ",!1)}toHTTP(){return Sa(this.toUTC(),"EEE, dd LLL yyyy HH:mm:ss 'GMT'")}toSQLDate(){return this.isValid?Xa(this,!0):null}toSQLTime({includeOffset:fa=!0,includeZone:oa=!1,includeOffsetSpace:Aa=!0}={}){let Ga="HH:mm:ss.SSS";if(oa||fa)Aa&&(Ga+=" "),oa?Ga+="z":fa&&(Ga+="ZZ");return Sa(this,Ga,!0)}toSQL(fa={}){return this.isValid?`${this.toSQLDate()} ${this.toSQLTime(fa)}`:
null}toString(){return this.isValid?this.toISO():"Invalid DateTime"}valueOf(){return this.toMillis()}toMillis(){return this.isValid?this.ts:NaN}toSeconds(){return this.isValid?this.ts/1E3:NaN}toUnixInteger(){return this.isValid?Math.floor(this.ts/1E3):NaN}toJSON(){return this.toISO()}toBSON(){return this.toJSDate()}toObject(fa={}){if(!this.isValid)return{};const oa={...this.c};fa.includeConfig&&(oa.outputCalendar=this.outputCalendar,oa.numberingSystem=this.loc.numberingSystem,oa.locale=this.loc.locale);
return oa}toJSDate(){return new Date(this.isValid?this.ts:NaN)}diff(fa,oa="milliseconds",Aa={}){if(!this.isValid||!fa.isValid)return sb.invalid("created by diffing an invalid DateTime");Aa={locale:this.locale,numberingSystem:this.numberingSystem,...Aa};const Ga=(Array.isArray(oa)?oa:[oa]).map(sb.normalizeUnit);oa=fa.valueOf()>this.valueOf();fa=ha(oa?this:fa,oa?fa:this,Ga,Aa);return oa?fa.negate():fa}diffNow(fa="milliseconds",oa={}){return this.diff(pb.now(),fa,oa)}until(fa){return this.isValid?xb.fromDateTimes(this,
fa):this}hasSame(fa,oa){if(!this.isValid)return!1;const Aa=fa.valueOf();fa=this.setZone(fa.zone,{keepLocalTime:!0});return fa.startOf(oa)<=Aa&&Aa<=fa.endOf(oa)}equals(fa){return this.isValid&&fa.isValid&&this.valueOf()===fa.valueOf()&&this.zone.equals(fa.zone)&&this.loc.equals(fa.loc)}toRelative(fa={}){if(!this.isValid)return null;const oa=fa.base||pb.fromObject({},{zone:this.zone}),Aa=fa.padding?this<oa?-fa.padding:fa.padding:0;let Ga="years months days hours minutes seconds".split(" "),Ma=fa.unit;
Array.isArray(fa.unit)&&(Ga=fa.unit,Ma=void 0);return mb(oa,this.plus(Aa),{...fa,numeric:"always",units:Ga,unit:Ma})}toRelativeCalendar(fa={}){return this.isValid?mb(fa.base||pb.fromObject({},{zone:this.zone}),this,{...fa,numeric:"auto",units:["years","months","days"],calendary:!0}):null}static min(...fa){if(!fa.every(pb.isDateTime))throw new Va("min requires all arguments be DateTimes");return u(fa,oa=>oa.valueOf(),Math.min)}static max(...fa){if(!fa.every(pb.isDateTime))throw new Va("max requires all arguments be DateTimes");
return u(fa,oa=>oa.valueOf(),Math.max)}static fromFormatExplain(fa,oa,Aa={}){const {locale:Ga=null,numberingSystem:Ma=null}=Aa;Aa=wb.fromOpts({locale:Ga,numberingSystem:Ma,defaultToEN:!0});return va(Aa,fa,oa)}static fromStringExplain(fa,oa,Aa={}){return pb.fromFormatExplain(fa,oa,Aa)}static get DATE_SHORT(){return db}static get DATE_MED(){return gb}static get DATE_MED_WITH_WEEKDAY(){return lb}static get DATE_FULL(){return yb}static get DATE_HUGE(){return Ib}static get TIME_SIMPLE(){return Db}static get TIME_WITH_SECONDS(){return Fb}static get TIME_WITH_SHORT_OFFSET(){return Jb}static get TIME_WITH_LONG_OFFSET(){return Kb}static get TIME_24_SIMPLE(){return Ob}static get TIME_24_WITH_SECONDS(){return nc}static get TIME_24_WITH_SHORT_OFFSET(){return oc}static get TIME_24_WITH_LONG_OFFSET(){return pc}static get DATETIME_SHORT(){return qc}static get DATETIME_SHORT_WITH_SECONDS(){return rc}static get DATETIME_MED(){return sc}static get DATETIME_MED_WITH_SECONDS(){return tc}static get DATETIME_MED_WITH_WEEKDAY(){return Xc}static get DATETIME_FULL(){return uc}static get DATETIME_FULL_WITH_SECONDS(){return vc}static get DATETIME_HUGE(){return wc}static get DATETIME_HUGE_WITH_SECONDS(){return xc}}
a.DateTime=pb;a.Info=Pb;a.Interval=xb})},"esri/core/number":function(){define(["exports","./string","../intl/locale"],function(a,b,c){function n(g){g||(g=c.getLocale());let p=g in h;if(!p){const r=g.split("-");1<r.length&&r[0]in h&&(g=r[0],p=!0);p||(g="en")}const [t,q,k="#,##0.###"]=h[g];return{decimal:t,group:q,pattern:k}}function l(g,p,t){t=t||{};!0===t.places&&(t.places=0);Infinity===t.places&&(t.places=6);p=p.split(".");var q="string"===typeof t.places&&t.places.indexOf(","),k=t.places;q?k=t.places.substring(q+
1):0<=k||(k=(p[1]||[]).length);0>t.round||(g=Number(g.toFixed(Number(k))));g=String(Math.abs(g)).split(".");const r=g[1]||"";p[1]||t.places?(q&&(t.places=t.places.substring(0,q)),q=void 0!==t.places?t.places:p[1]&&p[1].lastIndexOf("0")+1,q>r.length&&(g[1]=r.padEnd(Number(q),"0")),k<r.length&&(g[1]=r.substr(0,Number(k)))):g[1]&&g.pop();k=p[0].replace(",","");q=k.indexOf("0");-1!==q&&(q=k.length-q,q>g[0].length&&(g[0]=g[0].padStart(q,"0")),k.includes("#")||(g[0]=g[0].substr(g[0].length-q)));k=p[0].lastIndexOf(",");
let y,f;-1!==k&&(y=p[0].length-k-1,p=p[0].substr(0,k),k=p.lastIndexOf(","),-1!==k&&(f=p.length-k-1));p=[];for(k=g[0];k;)q=k.length-y,p.push(0<q?k.substr(q):k),k=0<q?k.slice(0,q):"",f&&(y=f,f=void 0);g[0]=p.reverse().join(t.group||",");return g.join(t.decimal||".")}function u(g){g=g||{};var p=n(g.locale);const t=g.pattern||p.pattern,q=p.group,k=p.decimal;let r=1;if(t.includes("%"))r/=100;else if(t.includes("\u2030"))r/=1E3;else if(t.includes("\u00a4"))throw Error("currency notation not supported");
p=t.split(";");1===p.length&&p.push("-"+p[0]);return{regexp:e(p,y=>{y="(?:"+b.escapeRegExpString(y,".")+")";return y.replace(d,f=>{const w={signed:!1,separator:g.strict?q:[q,""],fractional:g.fractional,decimal:k,exponent:!1};f=f.split(".");let z=g.places;1===f.length&&1!==r&&(f[1]="###");1===f.length||0===z?w.fractional=!1:(void 0===z&&(z=g.pattern?f[1].lastIndexOf("0")+1:Infinity),z&&null==g.fractional&&(w.fractional=!0),!g.places&&z<f[1].length&&(z+=","+f[1].length),w.places=z);f=f[0].split(",");
1<f.length&&(w.groupSize=f.pop().length,1<f.length&&(w.groupSize2=f.pop().length));return"("+v(w)+")"})},!0).replace(/[\xa0 ]/g,"[\\s\\xa0]"),group:q,decimal:k,factor:r}}function v(g){g=g||{};"places"in g||(g.places=Infinity);"string"!==typeof g.decimal&&(g.decimal=".");"fractional"in g&&!/^0/.test(String(g.places))||(g.fractional=[!0,!1]);"exponent"in g||(g.exponent=[!0,!1]);"eSigned"in g||(g.eSigned=[!0,!1]);var p=m(g);const t=e(g.fractional,k=>{let r="";k&&0!==g.places&&(r="\\"+g.decimal,r=Infinity===
g.places?"(?:"+r+"\\d+)?":r+("\\d{"+g.places+"}"));return r},!0),q=e(g.exponent,k=>k?"([eE]"+m({signed:g.eSigned})+")":"");p+=t;t&&(p="(?:(?:"+p+")|(?:"+t+"))");return p+q}function m(g){g=g||{};"signed"in g||(g.signed=[!0,!1]);"separator"in g?"groupSize"in g||(g.groupSize=3):g.separator="";const p=e(g.signed,q=>q?"[-+]":"",!0),t=e(g.separator,q=>{if(!q)return"(?:\\d+)";q=b.escapeRegExpString(q);" "===q?q="\\s":"\u00a0"===q&&(q="\\s\\xa0");const k=g.groupSize,r=g.groupSize2;return r?(q="(?:0|[1-9]\\d{0,"+
(r-1)+"}(?:["+q+"]\\d{"+r+"})*["+q+"]\\d{"+k+"})",0<k-r?"(?:"+q+"|(?:0|[1-9]\\d{0,"+(k-1)+"}))":q):"(?:0|[1-9]\\d{0,"+(k-1)+"}(?:["+q+"]\\d{"+k+"})*)"},!0);return p+t}const h={ar:[".",","],bg:[",","\u00a0"],bs:[",","."],ca:[",","."],cs:[",","\u00a0"],da:[",","."],de:[",","."],"de-ch":[".","\u2019"],el:[",","."],en:[".",","],"en-au":[".",","],es:[",","."],"es-mx":[".",","],et:[",","\u00a0"],fi:[",","\u00a0"],fr:[",","\u202f"],"fr-ch":[",","\u202f"],he:[".",","],hi:[".",",","#,##,##0.###"],hr:[",",
"."],hu:[",","\u00a0"],id:[",","."],it:[",","."],"it-ch":[".","\u2019"],ja:[".",","],ko:[".",","],lt:[",","\u00a0"],lv:[",","\u00a0"],mk:[",","."],nb:[",","\u00a0"],nl:[",","."],pl:[",","\u00a0"],pt:[",","."],"pt-pt":[",","\u00a0"],ro:[",","."],ru:[",","\u00a0"],sk:[",","\u00a0"],sl:[",","."],sr:[",","."],sv:[",","\u00a0"],th:[".",","],tr:[",","."],uk:[",","\u00a0"],vi:[",","."],zh:[".",","]},d=/[#0,]*[#0](?:\.0*#*)?/,e=(g,p,t)=>{if(!(g instanceof Array))return p(g);const q=[];for(let k=0;k<g.length;k++)q.push(p(g[k]));
g=q.join("|");return"("+(t?"?:":"")+g+")"};a._parseInfo=u;a.format=function(g,p){p={...p};var t=n(p.locale);p.customs=t;var q=p.pattern||t.pattern;if(isNaN(g)||Infinity===Math.abs(g))return null;{p=p||{};t=p.customs.group;const r=p.customs.decimal;q=q.split(";");var k=q[0];q=q[0>g?1:0]||"-"+k;if(q.includes("%"))g*=100;else if(q.includes("\u2030"))g*=1E3;else{if(q.includes("\u00a4"))throw Error("currency notation not supported");if(q.includes("E"))throw Error("exponential notation not supported");
}const y=d;k=k.match(y);if(!k)throw Error("unable to find a number expression in pattern: "+q);!1===p.fractional&&(p.places=0);g=q.replace(y,l(g,k[0],{decimal:r,group:t,places:p.places,round:p.round}))}return g};a.getCustoms=n;a.parse=function(g,p){p=u(p);g=(new RegExp("^"+p.regexp+"$")).exec(g);if(!g)return NaN;let t=g[1];if(!g[1]){if(!g[2])return NaN;t=g[2];p.factor*=-1}t=t.replace(new RegExp("["+p.group+"\\s\\xa0]","g"),"").replace(p.decimal,".");return Number(t)*p.factor};a.regexp=function(g){return u(g).regexp};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/arcade/featureset/support/shared":function(){define(["exports","../../../geometry/Extent","../../../layers/support/Field"],function(a,b,c){function n(l){return l instanceof Date}a.FeatureServiceDatabaseType=void 0;(function(l){l[l.Standardised=0]="Standardised";l[l.StandardisedNoInterval=1]="StandardisedNoInterval";l[l.SqlServer=2]="SqlServer";l[l.Oracle=3]="Oracle";l[l.Postgres=4]="Postgres";l[l.PGDB=
5]="PGDB";l[l.FILEGDB=6]="FILEGDB";l[l.NotEvaluated=7]="NotEvaluated"})(a.FeatureServiceDatabaseType||(a.FeatureServiceDatabaseType={}));a.IdState=void 0;(function(l){l[l.InFeatureSet=0]="InFeatureSet";l[l.NotInFeatureSet=1]="NotInFeatureSet";l[l.Unknown=2]="Unknown"})(a.IdState||(a.IdState={}));a.callback=function(l,u){return function(){try{l.apply(null,arguments)}catch(v){u.reject(v)}}};a.cloneAttributes=function(l){const u={};for(const v in l)u[v]=l[v];return u};a.cloneField=function(l){return c.fromJSON(l.toJSON())};
a.convertLinearUnitsToCode=function(l){if(void 0===l)return null;if("number"===typeof l||"number"===typeof l)return l;switch(l.toLowerCase()){case "meters":case "meter":return 9001;case "miles":case "mile":return 9035;case "kilometers":case "kilometer":case "km":return 9036}return null};a.convertSquareUnitsToCode=function(l){if(void 0===l)return null;if("number"===typeof l)return l;switch(l.toLowerCase()){case "meters":case "meter":return 109404;case "miles":case "mile":return 109413;case "kilometers":case "kilometer":case "km":return 109414}return null};
a.defaultMaxRecords=1E3;a.equalityTest=function(l,u){return l===u?!0:n(l)&&n(u)?l.getTime()===u.getTime():!1};a.errback=function(l){return function(u){l.reject(u)}};a.esriFieldToJson=function(l){return l.toJSON?l.toJSON():l};a.extractServiceUrl=function(l){if(void 0===l)return"";l=l.replace(/\/featureserver\/[0-9]*/i,"/FeatureServer");l=l.replace(/\/mapserver\/[0-9]*/i,"/MapServer");return l=l.split("?")[0]};a.isArray=function(l){return l instanceof Array};a.isBoolean=function(l){return"boolean"===
typeof l};a.isDate=n;a.isNumber=function(l){return"number"===typeof l};a.isString=function(l){return"string"===typeof l||l instanceof String};a.layerFieldEsriConstants={"small-integer":"esriFieldTypeSmallInteger",integer:"esriFieldTypeInteger",long:"esriFieldTypeLong",single:"esriFieldTypeSingle",double:"esriFieldTypeDouble",string:"esriFieldTypeString",date:"esriFieldTypeDate",oid:"esriFieldTypeOID",geometry:"esriFieldTypeGeometry",blob:"esriFieldTypeBlob",raster:"esriFieldTypeRaster",guid:"esriFieldTypeGUID",
"global-id":"esriFieldTypeGlobalID",xml:"eesriFieldTypeXML",esriFieldTypeSmallInteger:"esriFieldTypeSmallInteger",esriFieldTypeInteger:"esriFieldTypeInteger",esriFieldTypeLong:"esriFieldTypeLong",esriFieldTypeSingle:"esriFieldTypeSingle",esriFieldTypeDouble:"esriFieldTypeDouble",esriFieldTypeString:"esriFieldTypeString",esriFieldTypeDate:"esriFieldTypeDate",esriFieldTypeOID:"esriFieldTypeOID",esriFieldTypeGeometry:"esriFieldTypeGeometry",esriFieldTypeBlob:"esriFieldTypeBlob",esriFieldTypeRaster:"esriFieldTypeRaster",
esriFieldTypeGUID:"esriFieldTypeGUID",esriFieldTypeGlobalID:"esriFieldTypeGlobalID",esriFieldTypeXML:"eesriFieldTypeXML"};a.layerGeometryEsriConstants={point:"point",polygon:"polygon",polyline:"polyline",multipoint:"multipoint",extent:"extent",esriGeometryPoint:"point",esriGeometryPolygon:"polygon",esriGeometryPolyline:"polyline",esriGeometryMultipoint:"multipoint",esriGeometryEnvelope:"extent",envelope:"extent"};a.layerGeometryEsriRestConstants={point:"esriGeometryPoint",polygon:"esriGeometryPolygon",
polyline:"esriGeometryPolyline",multipoint:"esriGeometryMultipoint",extent:"esriGeometryEnvelope",esriGeometryPoint:"esriGeometryPoint",esriGeometryPolygon:"esriGeometryPolygon",esriGeometryPolyline:"esriGeometryPolyline",esriGeometryMultipoint:"esriGeometryMultipoint",esriGeometryEnvelope:"esriGeometryEnvelope",envelope:"esriGeometryEnvelope"};a.sameGeomType=function(l,u){return l===u||"point"===l&&"esriGeometryPoint"===u||"polyline"===l&&"esriGeometryPolyline"===u||"polygon"===l&&"esriGeometryPolygon"===
u||"extent"===l&&"esriGeometryEnvelope"===u||"multipoint"===l&&"esriGeometryMultipoint"===u||"point"===u&&"esriGeometryPoint"===l||"polyline"===u&&"esriGeometryPolyline"===l||"polygon"===u&&"esriGeometryPolygon"===l||"extent"===u&&"esriGeometryEnvelope"===l||"multipoint"===u&&"esriGeometryMultipoint"===l?!0:!1};a.shapeExtent=function(l){if(null===l)return null;switch(l.type){case "polygon":case "multipoint":case "polyline":return l.extent;case "point":return new b({xmin:l.x,ymin:l.y,xmax:l.x,ymax:l.y,
spatialReference:l.spatialReference});case "extent":return l}return null};a.stableStringify=function(l,u){u||(u={});"function"===typeof u&&(u={cmp:u});const v="boolean"===typeof u.cycles?u.cycles:!1,m=u.cmp&&function(d){return function(e){return function(g,p){return d({key:g,value:e[g]},{key:p,value:e[p]})}}}(u.cmp),h=[];return function g(e){e&&e.toJSON&&"function"===typeof e.toJSON&&(e=e.toJSON());if(void 0!==e){if("number"===typeof e)return isFinite(e)?""+e:"null";if("object"!==typeof e)return JSON.stringify(e);
var p;if(Array.isArray(e)){var t="[";for(p=0;p<e.length;p++)p&&(t+=","),t+=g(e[p])||"null";return t+"]"}if(null===e)return"null";if(h.includes(e)){if(v)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON");}var q=h.push(e)-1,k=Object.keys(e).sort(m&&m(e));t="";for(p=0;p<k.length;p++){const r=k[p],y=g(e[r]);y&&(t&&(t+=","),t+=JSON.stringify(r)+":"+y)}h.splice(q,1);return"{"+t+"}"}}(l)};a.toEsriGeometryType=function(l){switch(l){case "point":return"esriGeometryPoint";
case "polygon":return"esriGeometryPolygon";case "multipoint":return"esriGeometryMultipoint";case "polyline":return"esriGeometryPolyline";default:return"esriGeometryPoint"}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/support/arcadeFeatureUtils":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/promiseUtils ../../../layers/FeatureLayer ./featureUtils".split(" "),function(a,
b,c,n,l,u,v){function m(f){return`<ul class="esri-widget__list">${f.map(w=>`<li>${"string"===typeof w?v.applyTextFormattingHTML(v.htmlEntities(w)):w}</li>`).join("")}</ul>`}function h(f){return`<table class="esri-widget__table">${f.keys().map(w=>{var z=f.field(w);z="string"===typeof z?v.applyTextFormattingHTML(v.htmlEntities(z)):z;return`<tr><th>${w}</th><td>${z}</td></tr>`}).join("")}</table>`}function d({aggregatedFeatures:f,arcadeUtils:w,featureSetVars:z,context:A,viewInfo:x,map:B,graphic:C,interceptor:D}){z.forEach(E=>
{E=E.toLowerCase();var F={map:B,spatialReference:x.sr,interceptor:D};"$map"===E&&(A.vars[E]=w.convertMapToFeatureSetCollection(F));"$layer"===E&&(A.vars[E]=w.convertFeatureLayerToFeatureSet({layer:C.sourceLayer,spatialReference:x.sr,interceptor:D}));"$datastore"===E&&(A.vars[E]=w.convertServiceUrlToWorkspace({url:C.sourceLayer.url,spatialReference:x.sr,interceptor:D}));if("$aggregatedfeatures"===E){F=C.layer;const {fields:G,objectIdField:O,geometryType:K,spatialReference:L,displayField:R}=F;F=new u({fields:G,
objectIdField:O,geometryType:K,spatialReference:L,displayField:R,..."feature"===F.type?{templates:F.templates,typeIdField:F.typeIdField,types:F.types}:null,source:f});A.vars[E]=w.convertFeatureLayerToFeatureSet({layer:F,spatialReference:x.sr,interceptor:D})}})}function e(){return new Promise((f,w)=>a(["../../../support/arcadeUtils"],f,w))}function g(f){return p.apply(this,arguments)}function p(){p=c._asyncToGenerator(function*({graphic:f,view:w}){const {isAggregate:z,layer:A}=f;if(!z||!A||"2d"!==
(null==w?void 0:w.type))return[];w=yield w.whenLayerView(A);if(!w.createQuery||!w.queryFeatures)return[];const x=w.createQuery();x.aggregateIds=[f.getObjectId()];({features:f}=yield w.queryFeatures(x));return f});return p.apply(this,arguments)}function t(f){return q.apply(this,arguments)}function q(){q=c._asyncToGenerator(function*({expressionInfo:f,arcadeUtils:w,interceptor:z,spatialReference:A,map:x,graphic:B,view:C}){if(!f||!f.expression)return null;const D=w.createSyntaxTree(f.expression),E=r.filter(G=>
w.hasVariable(D,G));[C]=yield Promise.all([g({graphic:B,view:C}),w.loadScriptDependencies(D,!0,E)]);const F=w.getViewInfo({spatialReference:A});A=w.createExecContext(B,F);A.interceptor=z;A.useAsync=!0;d({aggregatedFeatures:C,arcadeUtils:w,featureSetVars:E,context:A,viewInfo:F,map:x,graphic:B,interceptor:z});z=w.createFunction(D,A);return w.executeAsyncFunction(z,A).catch(G=>y.error("arcade-execution-error",{error:G,graphic:B,expressionInfo:f}))});return q.apply(this,arguments)}function k(){k=c._asyncToGenerator(function*({expressionInfos:f,
spatialReference:w,graphic:z,interceptor:A,map:x,view:B}){if(!f||!f.length)return{};const C=yield e(),D={};for(const E of f)D[`expression/${E.name}`]=t({expressionInfo:E,arcadeUtils:C,interceptor:A,spatialReference:w,map:x,graphic:z,view:B});f=yield l.eachAlways(D);w={};for(const E in f)z=f[E].value,z="string"===typeof z?v.applyTextFormattingHTML(v.htmlEntities(z)):Array.isArray(z)?m(z):"esri.arcade.Dictionary"===(null==z?void 0:z.declaredClass)?h(z):z,w[E]=z;return w});return k.apply(this,arguments)}
const r=["$datastore","$map","$layer","$aggregatedfeatures"],y=n.getLogger("esri.widgets.Feature.support.arcadeFeatureUtils");b.createCompiledExpression=t;b.createCompiledExpressions=function(f){return k.apply(this,arguments)};b.loadArcadeUtils=e;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/FeatureViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Graphic ../../arcade/featureset/support/FeatureSetQueryInterceptor ../../core/Accessor ../../core/Handles ../../core/Logger ../../core/maybe ../../core/promiseUtils ../../core/reactiveUtils ../../core/throttle ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../popup/content/TextContent ./FeatureAttachments/FeatureAttachmentsViewModel ./FeatureContent/FeatureContentViewModel ./FeatureExpression/FeatureExpressionViewModel ./FeatureFields/FeatureFieldsViewModel ./FeatureMedia/FeatureMediaViewModel ./support/arcadeFeatureUtils ./support/featureUtils ./support/relatedFeatureUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C){var D;const E=v.getLogger("esri.widgets.FeatureViewModel"),F={attachmentsContent:!0,chartAnimation:!0,customContent:!0,expressionContent:!0,fieldsContent:!0,mediaContent:!0,textContent:!0};l=D=function(G){function O(L){var R=G.call(this,L)||this;R._handles=new u;R._error=null;R._featureAbortController=null;R.graphicChangedThrottled=e.throttle(R._graphicChanged,1,a._assertThisInitialized(R));R._expressionAttributes=null;R._graphicExpressionAttributes=
null;R.abilities={...F};R.content=null;R.contentViewModels=[];R.defaultPopupTemplateEnabled=!1;R.formattedAttributes=null;R.lastEditInfo=null;R.relatedInfos=new Map;R.title="";R.view=null;R._isAllowedContentType=M=>{const {abilities:J}=a._assertThisInitialized(R);return"attachments"===M.type&&J.attachmentsContent||"custom"===M.type&&J.customContent||"fields"===M.type&&J.fieldsContent||"media"===M.type&&J.mediaContent||"text"===M.type&&J.textContent||"expression"===M.type&&J.expressionContent};R._handles.add(d.watch(()=>
[R.graphic,R._effectivePopupTemplate,R.abilities],()=>R.graphicChangedThrottled(),d.initial));return R}a._inheritsLoose(O,G);var K=O.prototype;K.destroy=function(){this._clear();this._cancelFeatureQuery();this._error=null;this._handles.destroy();this.graphic=this._handles=null;this._destroyContentViewModels();this.relatedInfos.clear()};K.castAbilities=function(L){return{...F,...L}};K.setActiveMedia=function(L,R){L=this.contentViewModels[L];L instanceof A&&L.setActiveMedia(R)};K.nextMedia=function(L){L=
this.contentViewModels[L];L instanceof A&&L.next()};K.previousMedia=function(L){L=this.contentViewModels[L];L instanceof A&&L.previous()};K._clear=function(){this._set("title","");this._set("content",null);this._set("formattedAttributes",null)};K._graphicChanged=function(){var L=a._asyncToGenerator(function*(){this._cancelFeatureQuery();this._error=null;this._clear();const {graphic:R}=this;if(R){var M=new AbortController;this._featureAbortController=M;try{yield this._queryFeature({signal:M.signal})}catch(J){h.isAbortError(J)||
(this._error=J,E.error("error","The popupTemplate could not be displayed for this feature.",{error:J,graphic:R,popupTemplate:this._effectivePopupTemplate}))}this._featureAbortController===M&&(this._featureAbortController=null)}});return function(){return L.apply(this,arguments)}}();K._cancelFeatureQuery=function(){const {_featureAbortController:L}=this;L&&L.abort();this._featureAbortController=null};K._compileContentElement=function(L,R){if("attachments"===L.type)return this._compileAttachments(L,
R);if("custom"===L.type)return this._compileCustom(L,R);if("fields"===L.type)return this._compileFields(L,R);if("media"===L.type)return this._compileMedia(L,R);if("text"===L.type)return this._compileText(L,R);if("expression"===L.type)return this._compileExpression(L,R)};K._compileContent=function(L){this._destroyContentViewModels();if(this.graphic)return Array.isArray(L)?L.filter(this._isAllowedContentType).map((R,M)=>this._compileContentElement(R,M)):"string"===typeof L?this._compileText(new r({text:L}),
0).text:L};K._destroyContentViewModels=function(){var L;null==(L=this._handles)?void 0:L.remove("content-view-models");this.contentViewModels.forEach(R=>R&&!R.destroyed&&R.destroy());this._set("contentViewModels",[])};K._setExpressionContentVM=function(L,R){const {formattedAttributes:M}=this,{contentElement:J,contentElementViewModel:I}=L;L=null==J?void 0:J.type;I&&L&&("fields"===L&&(this._createFieldsFormattedAttributes({contentElement:J,contentElementIndex:R,formattedAttributes:M}),I.set(this._createFieldsVMParams(J,
R))),"media"===L&&(this._createMediaFormattedAttributes({contentElement:J,contentElementIndex:R,formattedAttributes:M}),I.set(this._createMediaVMParams(J,R))),"text"===L&&I.set(this._createTextVMParams(J)))};K._compileExpression=function(L,R){const {expressionInfo:M}=L,{graphic:J,map:I,spatialReference:P,view:N}=this,V=new w({expressionInfo:M,graphic:J,interceptor:D.interceptor,map:I,spatialReference:P,view:N});this.contentViewModels[R]=V;this._handles.add(d.watch(()=>V.contentElementViewModel,()=>
this._setExpressionContentVM(V,R),d.initial),"content-view-models");return L};K._compileAttachments=function(L,R){const {graphic:M}=this,{description:J,title:I}=L;this.contentViewModels[R]=new y({graphic:M,...this._compileTitleAndDesc({title:I,description:J})});return L};K._compileCustom=function(L,R){const {graphic:M}=this,{creator:J,destroyer:I}=L;this.contentViewModels[R]=new f({graphic:M,creator:J,destroyer:I});return L};K._compileTitleAndDesc=function({title:L,description:R}){const {_fieldInfoMap:M,
_sourceLayer:J,graphic:I,formattedAttributes:P,_expressionAttributes:N}=this,{attributes:V}=I,S=P.global;return{title:B.substituteFieldsInLinksAndAttributes({attributes:V,fieldInfoMap:M,globalAttributes:S,expressionAttributes:N,layer:J,text:L}),description:B.substituteFieldsInLinksAndAttributes({attributes:V,fieldInfoMap:M,globalAttributes:S,expressionAttributes:N,layer:J,text:R})}};K._createFieldsVMParams=function(L,R){const {_effectivePopupTemplate:M,formattedAttributes:J}=this,I={...J.global,...J.content[R]};
R=(null==L?void 0:L.fieldInfos)||(null==M?void 0:M.fieldInfos);R=null==R?void 0:R.filter(({fieldName:S})=>B.isExpressionField(S)||B.isRelatedField(S)||I.hasOwnProperty(S));const P=null==M?void 0:M.expressionInfos,{description:N,title:V}=L;return{attributes:I,expressionInfos:P,fieldInfos:R,...this._compileTitleAndDesc({title:V,description:N})}};K._compileFields=function(L,R){const M=L.clone();L=new z(this._createFieldsVMParams(L,R));this.contentViewModels[R]=L;M.fieldInfos=L.formattedFieldInfos.slice(0);
return M};K._createMediaVMParams=function(L,R){const {abilities:M,graphic:J,_fieldInfoMap:I,formattedAttributes:P,_effectivePopupTemplate:N,relatedInfos:V,_sourceLayer:S,_expressionAttributes:T}=this,{attributes:H}=J,{description:U,mediaInfos:W,title:Q}=L;return{abilities:{chartAnimation:M.chartAnimation},activeMediaInfoIndex:L.activeMediaInfoIndex||0,attributes:H,layer:S,fieldInfoMap:I,formattedAttributes:{...P.global,...P.content[R]},expressionAttributes:T,mediaInfos:W,popupTemplate:N,relatedInfos:V,
...this._compileTitleAndDesc({title:Q,description:U})}};K._compileMedia=function(L,R){const M=L.clone();L=new A(this._createMediaVMParams(L,R));M.mediaInfos=L.formattedMediaInfos.slice(0);this.contentViewModels[R]=L;return M};K._createTextVMParams=function(L){const {graphic:R,_fieldInfoMap:M,_sourceLayer:J,_expressionAttributes:I}=this;if(L&&L.text){const {attributes:P}=R;L.text=B.substituteFieldsInLinksAndAttributes({attributes:P,fieldInfoMap:M,globalAttributes:this.formattedAttributes.global,expressionAttributes:I,
layer:J,text:L.text})}return{graphic:R,creator:L.text}};K._compileText=function(L,R){L=L.clone();this.contentViewModels[R]=new f(this._createTextVMParams(L));return L};K._compileLastEditInfo=function(){const {_effectivePopupTemplate:L,_sourceLayer:R,graphic:M}=this;if(L){var {lastEditInfoEnabled:J}=L,I=null==R?void 0:R.editFieldsInfo;if(J&&I)return B.formatEditInfo(I,M.attributes)}};K._compileTitle=function(L){const {_fieldInfoMap:R,_sourceLayer:M,graphic:J,_expressionAttributes:I}=this,{attributes:P}=
J;return B.substituteFieldsInLinksAndAttributes({attributes:P,fieldInfoMap:R,globalAttributes:this.formattedAttributes.global,expressionAttributes:I,layer:M,text:L})};K._getTitle=function(){var L=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:R,graphic:M}=this;return B.graphicCallback(null==R?void 0:R.title,{graphic:M})});return function(){return L.apply(this,arguments)}}();K._getContent=function(){var L=a._asyncToGenerator(function*(){const {_effectivePopupTemplate:R,graphic:M}=this;
return B.graphicCallback(null==R?void 0:R.content,{graphic:M})});return function(){return L.apply(this,arguments)}}();K._queryFeature=function(){var L=a._asyncToGenerator(function*(R){const {_featureAbortController:M,_sourceLayer:J,graphic:I,_effectivePopupTemplate:P,spatialReference:N,map:V,view:S}=this,{content:{value:T},title:{value:H}}=yield h.eachAlways({content:this._getContent(),title:this._getTitle()});M===this._featureAbortController&&I&&(yield B.queryUpdatedFeature({graphic:I,popupTemplate:P,
layer:J,spatialReference:N},R),{expressionAttributes:{value:R}}=yield h.eachAlways({checkForRelatedFeatures:this._checkForRelatedFeatures(R),expressionAttributes:x.createCompiledExpressions({expressionInfos:null==P?void 0:P.expressionInfos,spatialReference:N,graphic:I,map:V,interceptor:D.interceptor,view:S})}),M===this._featureAbortController&&I&&(this._expressionAttributes=R,this._graphicExpressionAttributes={...I.attributes,...R},this._set("formattedAttributes",this._createFormattedAttributes(T)),
this._set("title",this._compileTitle(H)),this._set("lastEditInfo",this._compileLastEditInfo()||null),this._set("content",this._compileContent(T)||null)))});return function(R){return L.apply(this,arguments)}}();K._createMediaFormattedAttributes=function({contentElement:L,contentElementIndex:R,formattedAttributes:M}){const {_effectivePopupTemplate:J,graphic:I,relatedInfos:P,_sourceLayer:N,_fieldInfoMap:V,_graphicExpressionAttributes:S}=this;M.content[R]=B.formatAttributes({fieldInfos:null==J?void 0:
J.fieldInfos,graphic:I,attributes:{...S,...L.attributes},layer:N,fieldInfoMap:V,relatedInfos:P})};K._createFieldsFormattedAttributes=function({contentElement:L,contentElementIndex:R,formattedAttributes:M}){if(L.fieldInfos){const {graphic:J,relatedInfos:I,_sourceLayer:P,_fieldInfoMap:N,_graphicExpressionAttributes:V}=this;M.content[R]=B.formatAttributes({fieldInfos:L.fieldInfos,graphic:J,attributes:{...V,...L.attributes},layer:P,fieldInfoMap:N,relatedInfos:I})}};K._createFormattedAttributes=function(L){const {_effectivePopupTemplate:R,
graphic:M,relatedInfos:J,_sourceLayer:I,_fieldInfoMap:P,_graphicExpressionAttributes:N}=this,V={global:B.formatAttributes({fieldInfos:null==R?void 0:R.fieldInfos,graphic:M,attributes:N,layer:I,fieldInfoMap:P,relatedInfos:J}),content:[]};Array.isArray(L)&&L.forEach((S,T)=>{"fields"===S.type&&this._createFieldsFormattedAttributes({contentElement:S,contentElementIndex:T,formattedAttributes:V});"media"===S.type&&this._createMediaFormattedAttributes({contentElement:S,contentElementIndex:T,formattedAttributes:V})});
return V};K._checkForRelatedFeatures=function(L){const {graphic:R,_effectivePopupTemplate:M}=this;return this._queryRelatedInfos(R,B.getAllFieldInfos(M),L)};K._queryRelatedInfos=function(){var L=a._asyncToGenerator(function*(R,M,J){const {relatedInfos:I,_sourceLayer:P}=this;I.clear();const N=m.isSome(P.associatedLayer)?yield P.associatedLayer.load(J):P;if(N){var V=M.filter(H=>H&&B.isRelatedField(H.fieldName));if(V&&V.length){M.forEach(H=>this._configureRelatedInfo(H,N));var S=yield C.queryLayerInfos({relatedInfos:I,
layer:N},J);Object.keys(S).forEach(H=>{var U;const W=I.get(H.toString());H=null==(U=S[H])?void 0:U.value;W&&H&&(W.layerInfo=H.data)});var T=yield C.queryRelatedFeatures({graphic:R,relatedInfos:I,layer:N},J);Object.keys(T).forEach(H=>{var U;C.setRelatedFeatures(null==(U=T[H])?void 0:U.value,I.get(H.toString()))})}}});return function(R,M,J){return L.apply(this,arguments)}}();K._configureRelatedInfo=function(L,R){const {relatedInfos:M}=this,J=C.getRelatedFieldInfo(L.fieldName);if(J){var {layerId:I,fieldName:P}=
J;I&&(R=M.get(I.toString())||C.createRelatedInfo(I,R))&&(C.updateRelatedInfo({relatedInfo:R,fieldName:P,fieldInfo:L}),this.relatedInfos.set(I,R))}};a._createClass(O,[{key:"_effectivePopupTemplate",get:function(){return m.isSome(this.graphic)?this.graphic.getEffectivePopupTemplate(this.defaultPopupTemplateEnabled):null}},{key:"_fieldInfoMap",get:function(){return B.createfieldInfoMap(B.getAllFieldInfos(this._effectivePopupTemplate),this._sourceLayer)}},{key:"_sourceLayer",get:function(){return B.getSourceLayer(this.graphic)}},
{key:"state",get:function(){return this.graphic?this._error?"error":this.waitingForContent?"loading":"ready":"disabled"}},{key:"graphic",set:function(L){this._set("graphic",L?L.clone():null)}},{key:"spatialReference",get:function(){return this.get("view.spatialReference")||null},set:function(L){void 0===L?this._clearOverride("spatialReference"):this._override("spatialReference",L)}},{key:"map",get:function(){return this.get("view.map")||null},set:function(L){void 0===L?this._clearOverride("map"):
this._override("map",L)}},{key:"waitingForContent",get:function(){return!!this._featureAbortController}}]);return O}(l);l.interceptor=new n.FeatureSetQueryInterceptor(B.preLayerQueryCallback,B.preRequestCallback);b.__decorate([g.property()],l.prototype,"_error",void 0);b.__decorate([g.property()],l.prototype,"_featureAbortController",void 0);b.__decorate([g.property({readOnly:!0})],l.prototype,"_effectivePopupTemplate",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"_fieldInfoMap",null);
b.__decorate([g.property({readOnly:!0})],l.prototype,"_sourceLayer",null);b.__decorate([g.property()],l.prototype,"abilities",void 0);b.__decorate([q.cast("abilities")],l.prototype,"castAbilities",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"content",void 0);b.__decorate([g.property({readOnly:!0})],l.prototype,"contentViewModels",void 0);b.__decorate([g.property({type:Boolean})],l.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([g.property({readOnly:!0})],l.prototype,"state",
null);b.__decorate([g.property({readOnly:!0})],l.prototype,"formattedAttributes",void 0);b.__decorate([g.property({type:c,value:null})],l.prototype,"graphic",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"lastEditInfo",void 0);b.__decorate([g.property({readOnly:!0})],l.prototype,"relatedInfos",void 0);b.__decorate([g.property()],l.prototype,"spatialReference",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"title",void 0);b.__decorate([g.property()],l.prototype,"map",null);
b.__decorate([g.property({readOnly:!0})],l.prototype,"waitingForContent",null);b.__decorate([g.property()],l.prototype,"view",void 0);return l=D=b.__decorate([k.subclass("esri.widgets.FeatureViewModel")],l)})},"esri/arcade/featureset/support/FeatureSetQueryInterceptor":function(){define(["exports"],function(a){a.FeatureSetQueryInterceptor=function(b,c){this.preLayerQueryCallback=b;this.preRequestCallback=c;this.preLayerQueryCallback||(this.preLayerQueryCallback=n=>{});this.preRequestCallback||(this.preLayerQueryCallback=
n=>{})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Feature/support/FeatureContentMixin":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Logger ../../../core/accessorSupport/ensureType ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/set ../../../core/accessorSupport/decorators/subclass ../../support/widget ../../support/jsxFactory".split(" "),function(a,
b,c,n,l,u,v,m,h,d,e){a.FeatureContentMixin=g=>{g=function(p){function t(){var q=p.apply(this,arguments)||this;q.renderNodeContent=k=>d.isWidget(k)&&!k.destroyed?e.tsx("div",{key:k},k.render()):k instanceof HTMLElement?e.tsx("div",{key:k,bind:k,afterCreate:q._attachToNode}):d.hasDomNode(k)?e.tsx("div",{key:k,bind:k.domNode,afterCreate:q._attachToNode}):null;return q}b._inheritsLoose(t,p);t.prototype._attachToNode=function(q){q.appendChild(this)};return t}(g);return g=c.__decorate([h.subclass("esri.widgets.Feature.ContentMixin")],
g)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Spinner":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Spinner/SpinnerViewModel ./support/widgetUtils ./support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){v=function(k){function r(f,w){f=k.call(this,f,w)||this;f._animationDelay=500;f._animationPromise=null;f.location=null;f.view=null;f.viewModel=new p;f.visible=!1;return f}a._inheritsLoose(r,k);var y=r.prototype;y.initialize=function(){this.own([l.watch(()=>this.visible,f=>this._visibleChange(f))])};y.destroy=function(){this._animationPromise=null};y.show=function(f){const {location:w,promise:z}=f;w&&(this.viewModel.location=w);this.visible=!0;f=()=>this.hide();
z&&z.catch(()=>{}).then(f)};y.hide=function(){this.visible=!1};y.render=function(){var {visible:f}=this,{screenLocation:w}=this.viewModel;w=!!w;f={["esri-spinner--start"]:f&&w,["esri-spinner--finish"]:!f&&w};w=this._getPositionStyles();return q.tsx("div",{class:this.classes("esri-spinner",f),styles:w})};y._visibleChange=function(f){if(f)this.viewModel.screenLocationEnabled=!0;else{var w=n.after(this._animationDelay);this._animationPromise=w;w.catch(()=>{}).then(()=>{this._animationPromise===w&&(this.viewModel.screenLocationEnabled=
!1,this._animationPromise=null)})}};y._getPositionStyles=function(){const {screenLocation:f,view:w}=this.viewModel;if(c.isNone(w)||c.isNone(f))return{};const {padding:z}=w;return{left:`${f.x-z.left}px`,top:`${f.y-z.top}px`}};return r}(g);b.__decorate([u.aliasOf("viewModel.location")],v.prototype,"location",void 0);b.__decorate([u.aliasOf("viewModel.view")],v.prototype,"view",void 0);b.__decorate([d.property({type:p})],v.prototype,"viewModel",void 0);b.__decorate([u.aliasOf("viewModel.visible")],v.prototype,
"visible",void 0);return v=b.__decorate([e.subclass("esri.widgets.Spinner")],v)})},"esri/widgets/Spinner/SpinnerViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/AnchorElementViewModel".split(" "),function(a,b,c,n,l,u,v,m){n=function(h){function d(e){e=h.call(this,e)||this;e.visible=
!1;return e}a._inheritsLoose(d,h);return d}(m);b.__decorate([c.property()],n.prototype,"visible",void 0);return n=b.__decorate([v.subclass("esri.widgets.CompassViewModel")],n)})},"esri/widgets/support/AnchorElementViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){const g=Symbol("anchorHandles");c=function(t){function q(k){var r=t.call(this,k)||this;r[p]=new n;r.location=null;r.screenLocationEnabled=!1;r.view=null;r[g].add([u.when(()=>l.applySome(r.screenLocationEnabled?r.view:null,y=>[y.size,"3d"===y.type?y.camera:y.viewpoint]),()=>r.notifyChange("screenLocation")),u.watch(()=>r.screenLocation,(y,f)=>{l.isSome(y)&&l.isSome(f)&&r.emit("view-change")})]);return r}a._inheritsLoose(q,t);q.prototype.destroy=function(){this.view=
null;this[g]=l.destroyMaybe(this[g])};a._createClass(q,[{key:"screenLocation",get:function(){const {location:k,view:r,screenLocationEnabled:y}=this;return y&&l.isSome(k)&&l.isSome(r)&&r.ready?r.toScreen(k):null}}]);return q}(c.EventedAccessor);var p=g;b.__decorate([v.property()],c.prototype,"location",void 0);b.__decorate([v.property()],c.prototype,"screenLocation",null);b.__decorate([v.property()],c.prototype,"screenLocationEnabled",void 0);b.__decorate([v.property()],c.prototype,"view",void 0);
return c=b.__decorate([e.subclass("esri.widgets.support.AnchorElementViewModel")],c)})},"esri/widgets/Popup/PopupViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Graphic ../../symbols ../../core/Collection ../../core/Error ../../core/Handles ../../core/Logger ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/webMercatorUtils ../../layers/Layer ../../support/actions/ActionBase ../../support/actions/ActionButton ../../support/actions/ActionToggle ../../symbols/support/symbolUtils ../../views/input/InputManager ../../views/support/layerViewUtils ../Feature/FeatureViewModel ./actions ./actionUtils ../support/AnchorElementViewModel ../support/GoTo ../../geometry/Point ../../symbols/SimpleFillSymbol".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K){const L=u.ofType({key:"type",defaultKeyValue:"button",base:f,typeMap:{button:w,toggle:z}}),R=h.getLogger("esri.widgets.Popup.PopupViewModel");c=function(M){function J(P){P=M.call(this,P)||this;P._handles=new m;P._pendingPromises=new Set;P._fetchFeaturesController=null;P._selectedClusterFeature=null;P.featurePage=null;P.actions=new L;P.activeFeature=null;P.defaultPopupTemplateEnabled=!1;P.autoCloseEnabled=!1;P.autoOpenEnabled=
!0;P.browseClusterEnabled=!1;P.content=null;P.featuresPerPage=20;P.featureViewModelAbilities=null;P.featureViewModels=[];P.highlightEnabled=!0;P.includeDefaultActions=!0;P.selectedClusterBoundaryFeature=new n({symbol:new K({outline:{width:1.5,color:"cyan"},style:"none"})});P.title=null;P.updateLocationEnabled=!1;P.view=null;P.visible=!1;P.zoomFactor=4;P.zoomToLocation=null;return P}a._inheritsLoose(J,M);var I=J.prototype;I.initialize=function(){this._handles.add([e.watch(()=>[this.autoOpenEnabled,
this.view],()=>this._autoOpenEnabledChange()),this.on("view-change",()=>this._autoClose()),e.watch(()=>[this.highlightEnabled,this.selectedFeature,this.visible,this.view],()=>this._highlightSelectedFeature()),e.watch(()=>[this.highlightEnabled,this.activeFeature,this.visible,this.view],()=>this._highlightActiveFeature()),e.watch(()=>{var P,N;return null==(P=this.view)?void 0:null==(N=P.animation)?void 0:N.state},P=>this._animationStateChange(P)),e.watch(()=>this.location,P=>this._locationChange(P)),
e.watch(()=>this.selectedFeature,P=>this._selectedFeatureChange(P)),e.watch(()=>[this.selectedFeatureIndex,this.featureCount,this.featuresPerPage],()=>this._selectedFeatureIndexChange()),e.watch(()=>[this.featurePage,this.selectedFeatureIndex,this.featureCount,this.featuresPerPage,this.featureViewModels],()=>this._setGraphicOnFeatureViewModels()),e.watch(()=>this.featureViewModels,()=>this._featureViewModelsChange()),this.on("trigger-action",P=>E.triggerAction({event:P,view:this.view})),e.when(()=>
!this.waitingForResult,()=>this._waitingForResultChange(),e.sync),e.watch(()=>{var P,N;return[this.features,null==(P=this.view)?void 0:P.map,null==(N=this.view)?void 0:N.spatialReference]},()=>this._updateFeatureVMs()),e.watch(()=>{var P;return null==(P=this.view)?void 0:P.scale},()=>this._viewScaleChange()),e.when(()=>!this.visible,()=>this.browseClusterEnabled=!1),e.watch(()=>this.browseClusterEnabled,P=>P?this.enableClusterBrowsing():this.disableClusterBrowsing())])};I.destroy=function(){this._cancelFetchingFeatures();
this._handles.destroy();this._handles=null;this._pendingPromises.clear();this.browseClusterEnabled=!1;this.view=null};I.centerAtLocation=function(){var {view:P}=this;const N=E.getSelectedTarget(this);return N?this.callGoTo({target:{target:N,scale:P.scale}}):(P=new v("center-at-location:invalid-target-or-view","Cannot center at a location without a target and view.",{target:N,view:P}),R.error(P),Promise.reject(P))};I.clear=function(){this.set({promises:[],features:[],content:null,title:null,location:null,
activeFeature:null})};I.fetchFeatures=function(P,N){const {view:V}=this;return V&&P?V.fetchPopupFeatures(P,{event:N&&N.event,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,signal:N&&N.signal}):(P=new v("fetch-features:invalid-screenpoint-or-view","Cannot fetch features without a screenPoint and view.",{screenPoint:P,view:V}),R.error(P),Promise.reject(P))};I.open=function(P){P={updateLocationEnabled:!1,promises:[],fetchFeatures:!1,...P,visible:!0};var {fetchFeatures:N}=P;delete P.fetchFeatures;
N&&this._setFetchFeaturesPromises(P.location);N=["actionsMenuOpen","collapsed","featureMenuOpen"];for(const V of N)delete P[V];this.set(P)};I.triggerAction=function(P){(P=this.allActions.getItemAt(P))&&!P.disabled&&this.emit("trigger-action",{action:P})};I.next=function(){this.selectedFeatureIndex+=1;return this};I.previous=function(){--this.selectedFeatureIndex;return this};I.disableClusterBrowsing=function(){E.removeClusteredFeaturesForBrowsing(this);this._clearBrowsedClusterGraphics()};I.enableClusterBrowsing=
function(){var P=a._asyncToGenerator(function*(){const {view:N,selectedFeature:V}=this;"2d"!==(null==N?void 0:N.type)?R.warn("enableClusterBrowsing:invalid-view: View must be 2d MapView.",V):E.isClusterFeature(V)?(yield E.displayClusterExtent(this),yield E.browseAggregateFeatures(this)):R.warn("enableClusterBrowsing:invalid-selectedFeature: Selected feature must represent an aggregate/cluster graphic.",V)});return function(){return P.apply(this,arguments)}}();I._animationStateChange=function(P){this.zoomToLocation||
(D.zoomToFeature.disabled="waiting-for-target"===P)};I._clearBrowsedClusterGraphics=function(){var P;const N=null==(P=this.view)?void 0:P.graphics;N&&(N.remove(this.selectedClusterBoundaryFeature),N.remove(this._selectedClusterFeature));this._selectedClusterFeature=null;this.selectedClusterBoundaryFeature.geometry=null};I._viewScaleChange=function(){E.isClusterFeature(this.selectedFeature)?(this.visible=this.browseClusterEnabled=!1,this.clear()):this.browseClusterEnabled&&(this.features=[this.selectedFeature])};
I._locationChange=function(P){const {selectedFeature:N,updateLocationEnabled:V}=this;V&&P&&(!N||N.geometry)&&this.centerAtLocation()};I._selectedFeatureIndexChange=function(){this.featurePage=1<this.featureCount?Math.floor(this.selectedFeatureIndex/this.featuresPerPage)+1:null};I._featureViewModelsChange=function(){this.featurePage=1<this.featureCount?1:null};I._setGraphicOnFeatureViewModels=function(){const {features:P,featureCount:N,featurePage:V,featuresPerPage:S,featureViewModels:T}=this;if(null!==
V){var H=((V-1)*S+N)%N;T.slice(H,H+S).forEach((U,W)=>{U&&!U.graphic&&(U.graphic=P[H+W])})}};I._selectedFeatureChange=function(){var P=a._asyncToGenerator(function*(N){if(N){var {location:V,updateLocationEnabled:S,view:T}=this;this.browseClusterEnabled?(this._selectedClusterFeature&&(T.graphics.remove(this._selectedClusterFeature),this._selectedClusterFeature=null),E.isClusterFeature(N)||(N.symbol=yield A.getDisplayedSymbol(N),this._selectedClusterFeature=N,T.graphics.add(this._selectedClusterFeature))):
!S&&V||!N.geometry?S&&!N.geometry&&this.centerAtLocation().then(()=>{this.location=T.center.clone()}):this.location=d.unwrap(this._getPointFromGeometry(N.geometry))}});return function(N){return P.apply(this,arguments)}}();I._waitingForResultChange=function(){!this.featureCount&&this.promises&&(this.visible=!1)};I._setFetchFeaturesPromises=function(P){return this._fetchFeaturesWithController(this._getScreenPoint(P||this.location)).then(N=>{const {clientOnlyGraphics:V,promisesPerLayerView:S}=N;N=Promise.resolve(V);
const T=S.map(H=>H.promise);this.promises=[N,...T]})};I._destroyFeatureVMs=function(){this.featureViewModels.forEach(P=>P&&!P.destroyed&&P.destroy());this._set("featureViewModels",[])};I._updateFeatureVMs=function(){const {selectedFeature:P,features:N,featureViewModels:V}=this;E.isClusterFeature(P)||(this.browseClusterEnabled=!1);this._destroyFeatureVMs();if(N&&N.length){var S=V.slice(0),T=[];N.forEach((H,U)=>{if(H){var W=null;S.some((ba,aa)=>{ba&&ba.graphic===H&&(W=ba,S.splice(aa,1));return!!W});
if(W)T[U]=W;else{var Q,X;const ba=new C({abilities:this.featureViewModelAbilities,defaultPopupTemplateEnabled:this.defaultPopupTemplateEnabled,spatialReference:null==(Q=this.view)?void 0:Q.spatialReference,graphic:H===P?H:null,map:null==(X=this.view)?void 0:X.map,view:this.view});T[U]=ba}}});S.forEach(H=>H&&!H.destroyed&&H.destroy());this._set("featureViewModels",T)}};I._getScreenPoint=function(P){const {view:N}=this;return N&&P&&"function"===typeof N.toScreen?N.toScreen(P):null};I._autoOpenEnabledChange=
function(){const {_handles:P,autoOpenEnabled:N}=this;P.remove("auto-fetch-features");if(N&&this.view){const V=this.view.on("click",S=>{"mouse"===S.pointerType&&0!==S.button||this._fetchFeaturesAndOpen(S)},x.ViewEventPriorities.WIDGET);P.add(V,"auto-fetch-features")}};I._cancelFetchingFeatures=function(){const P=this._fetchFeaturesController;P&&P.abort();this._fetchFeaturesController=null;this.notifyChange("waitingForResult")};I._fetchFeaturesWithController=function(P,N){this._cancelFetchingFeatures();
const V=new AbortController,{signal:S}=V;this._fetchFeaturesController=V;this.notifyChange("waitingForResult");P=this.fetchFeatures(P,{signal:S,event:N});P.catch(()=>{}).then(()=>{this._fetchFeaturesController=null;this.notifyChange("waitingForResult")});return P};I._fetchFeaturesAndOpen=function(P){const {screenPoint:N,mapPoint:V}=P,{view:S}=this;this._fetchFeaturesWithController(N,P).then(T=>{const {clientOnlyGraphics:H,promisesPerLayerView:U,location:W}=T,Q=[Promise.resolve(H),...U.map(X=>X.promise)];
S.popup.open({location:W||V,promises:Q});return T})};I._updatePendingPromises=function(P){P&&this._pendingPromises.has(P)&&(this._pendingPromises.delete(P),this.notifyChange("pendingPromisesCount"))};I._autoClose=function(){this.autoCloseEnabled&&(this.visible=!1)};I._getPointFromGeometry=function(P){return d.isNone(P)?null:"point"===P.type?P:"extent"===P.type?P.center:"polygon"===P.type?P.centroid:"multipoint"===P.type||"polyline"===P.type?P.extent.center:null};I._getLayerView=function(){var P=a._asyncToGenerator(function*(N,
V){yield N.when();return N.whenLayerView(V)});return function(N,V){return P.apply(this,arguments)}}();I._getHighlightLayer=function(P){const {layer:N,sourceLayer:V}=P;return"map-notes"===(null==V?void 0:V.type)||"subtype-group"===(null==V?void 0:V.type)?V:N};I._getHighlightTarget=function(P,N){N="imagery"===N.type?void 0:"objectIdField"in N&&N.objectIdField;const V=P.attributes;return V&&N&&V[N]||P};I._highlightActiveFeature=function(){var P=a._asyncToGenerator(function*(){this._handles.remove("highlight-active-feature");
const {highlightEnabled:N,view:V,activeFeature:S,visible:T}=this;if(S&&V&&N&&T){var H=this._getHighlightLayer(S);if(H&&H instanceof y){var U=this._getLayerView(V,H);this._highlightActiveFeaturePromise=U;var W=yield U;W&&B.highlightsSupported(W)&&this._highlightActiveFeaturePromise===U&&this.activeFeature&&this.highlightEnabled&&(H=W.highlight(this._getHighlightTarget(S,H)),this._handles.add(H,"highlight-active-feature"))}}});return function(){return P.apply(this,arguments)}}();I._highlightSelectedFeature=
function(){var P=a._asyncToGenerator(function*(){this._handles.remove("highlight-selected-feature");const {selectedFeature:N,highlightEnabled:V,view:S,visible:T}=this;if(N&&S&&V&&T){var H=this._getHighlightLayer(N);if(H&&H instanceof y){var U=this._getLayerView(S,H);this._highlightSelectedFeaturePromise=U;var W=yield U;W&&B.highlightsSupported(W)&&this._highlightSelectedFeaturePromise===U&&this.selectedFeature&&this.highlightEnabled&&this.visible&&(H=W.highlight(this._getHighlightTarget(N,H)),this._handles.add(H,
"highlight-selected-feature"))}}});return function(){return P.apply(this,arguments)}}();I._updateFeatures=function(P){const {features:N}=this;P&&P.length&&(N.length?(P=P.filter(V=>!N.includes(V)),this.features=N.concat(P)):this.features=P)};a._createClass(J,[{key:"isLoadingFeature",get:function(){return this.featureViewModels.some(P=>P.waitingForContent)}},{key:"active",get:function(){return!(!this.visible||this.waitingForResult)}},{key:"allActions",get:function(){const P=this._get("allActions")||
new L;P.removeAll();const {actions:N,defaultActions:V,defaultPopupTemplateEnabled:S,includeDefaultActions:T,selectedFeature:H}=this;var U=T?V.concat(N):N;const W=H&&("function"===typeof H.getEffectivePopupTemplate&&H.getEffectivePopupTemplate(S)||H.popupTemplate),Q=W&&W.actions;(U=W&&W.overwriteActions?Q:Q?Q.concat(U):U)&&U.filter(Boolean).forEach(X=>P.add(X));return P}},{key:"defaultActions",get:function(){const P=this._get("defaultActions")||new L;P.removeAll();P.addMany(E.isClusterFeature(this.selectedFeature)?
[D.zoomToClusteredFeatures.clone(),D.browseClusteredFeatures.clone()]:[D.zoomToFeature.clone()]);return P}},{key:"featureCount",get:function(){return this.features.length}},{key:"features",get:function(){return this._get("features")||[]},set:function(P){P=P||[];this._set("features",P);const {pendingPromisesCount:N,promiseCount:V,selectedFeatureIndex:S}=this,T=V&&P.length;T&&N&&-1===S?this.selectedFeatureIndex=0:T&&-1!==S||(this.selectedFeatureIndex=P.length?0:-1)}},{key:"location",get:function(){return this._get("location")||
null},set:function(P){const N=this.get("view.spatialReference.isWebMercator");P&&P.get("spatialReference.isWGS84")&&N&&(P=r.geographicToWebMercator(P));this._set("location",P)}},{key:"pendingPromisesCount",get:function(){return this._pendingPromises.size}},{key:"waitingForResult",get:function(){return!(!(this._fetchFeaturesController||0<this.pendingPromisesCount)||0!==this.featureCount)}},{key:"promiseCount",get:function(){return this.promises.length}},{key:"promises",get:function(){return this._get("promises")||
[]},set:function(P){this._pendingPromises.clear();this.features=[];Array.isArray(P)&&P.length?(this._set("promises",P),P=P.slice(0),P.forEach(N=>{this._pendingPromises.add(N);N.then(V=>{this._pendingPromises.has(N)&&this._updateFeatures(V);this._updatePendingPromises(N)},()=>this._updatePendingPromises(N))})):this._set("promises",[]);this.notifyChange("pendingPromisesCount")}},{key:"selectedFeature",get:function(){const {features:P,selectedFeatureIndex:N}=this;return-1===N?null:P[N]||null}},{key:"selectedFeatureIndex",
get:function(){const P=this._get("selectedFeatureIndex");return"number"===typeof P?P:-1},set:function(P){const {featureCount:N}=this;P=isNaN(P)||-1>P||!N?-1:(P+N)%N;this.activeFeature=null;this._set("selectedFeatureIndex",P)}},{key:"selectedFeatureViewModel",get:function(){return this.featureViewModels[this.selectedFeatureIndex]||null}},{key:"state",get:function(){return this.get("view.ready")?"ready":"disabled"}}]);return J}(G.GoToMixin(F));b.__decorate([g.property()],c.prototype,"featurePage",void 0);
b.__decorate([g.property()],c.prototype,"isLoadingFeature",null);b.__decorate([g.property({type:L})],c.prototype,"actions",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"active",null);b.__decorate([g.property()],c.prototype,"activeFeature",void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"allActions",null);b.__decorate([g.property({type:Boolean})],c.prototype,"defaultPopupTemplateEnabled",void 0);b.__decorate([g.property()],c.prototype,"autoCloseEnabled",void 0);b.__decorate([g.property()],
c.prototype,"autoOpenEnabled",void 0);b.__decorate([g.property()],c.prototype,"browseClusterEnabled",void 0);b.__decorate([g.property()],c.prototype,"content",void 0);b.__decorate([g.property({type:L,readOnly:!0})],c.prototype,"defaultActions",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"featureCount",null);b.__decorate([g.property()],c.prototype,"features",null);b.__decorate([g.property()],c.prototype,"featuresPerPage",void 0);b.__decorate([g.property()],c.prototype,"featureViewModelAbilities",
void 0);b.__decorate([g.property({readOnly:!0})],c.prototype,"featureViewModels",void 0);b.__decorate([g.property()],c.prototype,"highlightEnabled",void 0);b.__decorate([g.property()],c.prototype,"includeDefaultActions",void 0);b.__decorate([g.property({type:O})],c.prototype,"location",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"pendingPromisesCount",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"selectedClusterBoundaryFeature",void 0);b.__decorate([g.property({readOnly:!0})],
c.prototype,"waitingForResult",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"promiseCount",null);b.__decorate([g.property()],c.prototype,"promises",null);b.__decorate([g.property({value:null,readOnly:!0})],c.prototype,"selectedFeature",null);b.__decorate([g.property({value:-1})],c.prototype,"selectedFeatureIndex",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"selectedFeatureViewModel",null);b.__decorate([g.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([g.property()],
c.prototype,"title",void 0);b.__decorate([g.property()],c.prototype,"updateLocationEnabled",void 0);b.__decorate([g.property()],c.prototype,"view",void 0);b.__decorate([g.property()],c.prototype,"visible",void 0);b.__decorate([g.property()],c.prototype,"zoomFactor",void 0);b.__decorate([g.property()],c.prototype,"zoomToLocation",void 0);b.__decorate([g.property()],c.prototype,"centerAtLocation",null);return c=b.__decorate([k.subclass("esri.widgets.Popup.PopupViewModel")],c)})},"esri/symbols/support/symbolUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/maybe ../../support/arcadeOnDemand ./gfxUtils ./previewUtils ./renderUtils ./utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(f,w){if(w&&(f.style.filter=d.getCSSFilterFromEffectList(w),w=w.effects))for(const z of w)if("drop-shadow"===(null==z?void 0:z.type)){0>z.offsetX?f.style.marginLeft=`${Math.abs(z.offsetX)}px`:f.style.marginRight=`${z.offsetX}px`;break}}function g(f,w){return p.apply(this,arguments)}function p(){p=c._asyncToGenerator(function*(f,w){switch(f.type){case "web-style":var {previewWebStyleSymbol:z}=yield new Promise((A,x)=>a(["./previewWebStyleSymbol"],A,x));return z(f,
g,w);case "label-3d":case "line-3d":case "mesh-3d":case "point-3d":case "polygon-3d":return{previewSymbol3D:z}=yield new Promise((A,x)=>a(["./previewSymbol3D"],A,x)),z(f,w);case "simple-marker":case "simple-line":case "simple-fill":case "picture-marker":case "picture-fill":case "text":return{previewSymbol2D:z}=yield new Promise((A,x)=>a(["./previewSymbol2D"],A,x)),z(f,w);case "cim":return{previewCIMSymbol:z}=yield new Promise((A,x)=>a(["./previewCIMSymbol"],A,x)),z(f,w)}});return p.apply(this,arguments)}
function t(f){return f&&"opacity"in f?f.opacity*t(f.parent):1}function q(){q=c._asyncToGenerator(function*(f,w){var z,A;if(f){var x=f.sourceLayer;x=null!=(z=l.isSome(w)&&null!=(A=w.useSourceLayer)&&A?x:f.layer)?z:x;z=t(x);if(l.isSome(f.symbol)&&(!l.isSome(w)||!0!==w.ignoreGraphicSymbol))return f="web-style"===f.symbol.type?yield f.symbol.fetchSymbol({...w,cache:l.isSome(w)?w.webStyleCache:null}):f.symbol.clone(),d.applyColorToSymbol(f,null,z),f;var B=l.isSome(w)&&w.renderer||x&&"renderer"in x&&x.renderer;
if(A=B&&"getSymbolAsync"in B?yield B.getSymbolAsync(f,w):null){A="web-style"===A.type?yield A.fetchSymbol({...w,cache:l.isSome(w)?w.webStyleCache:null}):A.clone();if(!("visualVariables"in B&&B.visualVariables&&B.visualVariables.length))return d.applyColorToSymbol(A,null,z),A;"arcadeRequiredForVisualVariables"in B&&B.arcadeRequiredForVisualVariables&&(l.isNone(w)||l.isNone(w.arcade))&&(w={...l.unwrap(w)},w.arcade=yield u.loadArcade());x=yield new Promise((O,K)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],
O,K));var C=[],D=[],E=[],F=[];for(var G of B.visualVariables)switch(G.type){case "color":C.push(G);break;case "opacity":D.push(G);break;case "rotation":F.push(G);break;case "size":G.target||E.push(G)}G=(G=!!C.length&&C[C.length-1])?x.getColor(G,f,w):null;D=(D=!!D.length&&D[D.length-1])?x.getOpacity(D,f,w):null;null!=z&&(D=null!=D?D*z:z);d.applyColorToSymbol(A,G,D);E.length&&(z=x.getAllSizes(E,f,w),yield d.applySizesToSymbol(A,z));for(const O of F)d.applyRotationToSymbol(A,x.getRotationAngle(O,f,w),
O.axis);return A}}});return q.apply(this,arguments)}function k(){k=c._asyncToGenerator(function*(f,w){var z;if(f){var A=t(f.layer||f.sourceLayer);if(l.isSome(f.symbol)&&(!l.isSome(w)||!0!==w.ignoreGraphicSymbol))return f="web-style"===f.symbol.type?yield f.symbol.fetchSymbol(w):f.symbol.clone(),d.getColorFromSymbol(f,A);var x=l.isSome(w)&&w.renderer||f.get("layer.renderer")||f.get("sourceLayer.renderer"),B=yield x.getSymbolAsync(f,w);if(B){B="web-style"===B.type?yield B.fetchSymbol(w):B.clone();B=
d.getColorFromSymbol(B,A);if(!("visualVariables"in x)||"visualVariables"in x&&!x.visualVariables||"visualVariables"in x&&(null==(z=x.visualVariables)||!z.length))return B;x.arcadeRequiredForVisualVariables&&(l.isNone(w)||l.isNone(w.arcade))&&(w={...l.unwrap(w)},w.arcade=yield u.loadArcade());z=yield new Promise((E,F)=>a(["../../renderers/visualVariables/support/visualVariableUtils"],E,F));var C=[],D=[];for(const E of x.visualVariables)switch(E.type){case "color":C.push(E);break;case "opacity":D.push(E)}x=
(x=0<C.length?C[C.length-1]:null)?z.getColor(x,f,w):B;f=(B=0<D.length?D[D.length-1]:null)?z.getOpacity(B,f,w):null;null!=A&&(f=null!=f?f*A:A);return x?d.applyOpacityToColor(x,f):null}}});return k.apply(this,arguments)}let r=null;const y=[255,255,255];b.getDisplayedColor=function(f,w){return k.apply(this,arguments)};b.getDisplayedSymbol=function(f,w){return q.apply(this,arguments)};b.renderColorRampPreviewHTML=function(f,w={}){var z="horizontal"===w.align;const {width:A=z?75:24,height:x=z?24:75,gradient:B=
!0}=w;var C=window.devicePixelRatio,D=A*C,E=x*C;C=document.createElement("canvas");C.width=D;C.height=E;C.style.width=`${A}px`;C.style.height=`${x}px`;const F=C.getContext("2d");var G=z?D:0,O=z?0:E;if(B){const K=F.createLinearGradient(0,0,G,O);z=f.length;const L=1===z?0:1/(z-1);f.forEach((R,M)=>K.addColorStop(M*L,R.toString()));F.fillStyle=K;F.fillRect(0,0,D,E)}else{D=z?D/f.length:D;E=z?E:E/f.length;O=G=0;for(const K of f)F.fillStyle=K.toString(),F.fillRect(G,O,D,E),G=z?G+D:0,O=z?0:O+E}f=document.createElement("div");
f.style.width=`${A}px`;f.style.height=`${x}px`;e(f,null==w?void 0:w.effectList);f.appendChild(C);return f};b.renderDotDensityPreviewHTML=function(f,w,z){const {backgroundColor:A,outline:x,dotSize:B}=f;z=z&&z.swatchSize||m.SymbolSizeDefaults.size;const C=Math.round(z*z/B**2*.8),D=window.devicePixelRatio;f=document.createElement("canvas");const E=z*D;f.width=E;f.height=E;f.style.width=`${f.width/D}px`;f.style.height=`${f.height/D}px`;const F=f.getContext("2d");A&&(F.fillStyle=A.toCss(!0),F.fillRect(0,
0,E,E),F.fill());F.fillStyle=w.toCss(!0);if(r&&r.length/2===C)for(w=0;w<2*C;w+=2)F.fillRect(r[w],r[w+1],B*D,B*D),F.fill();else for(r=[],w=0;w<2*C;w+=2){const G=Math.floor(Math.random()*(E-0+1)),O=Math.floor(Math.random()*(E-0+1));r.push(G,O);F.fillRect(G,O,B*D,B*D);F.fill()}x&&(x.color&&(F.strokeStyle=x.color.toCss(!0)),F.lineWidth=x.width,F.strokeRect(0,0,E,E));z=new Image(z,z);z.src=f.toDataURL();return z};b.renderPieChartPreviewHTML=function(f,w={}){const z=w.radius||40;var A=2*Math.PI*z,x=f.length;
const B=A/x,C=[],D=v.getStroke(w.outline);D&&(D.width*=2);(D||w.backgroundColor)&&C.push({shape:{type:"circle",cx:z,cy:z,r:z},fill:w.backgroundColor,stroke:D,offset:[0,0]});const E=w.values,F=E&&E.length===x&&100===E.reduce((O,K)=>O+K,0),G=[0];for(let O=0;O<x;O++){const K=F?E[O]*A/100:null;F&&G.push(K+G[O]);C.push({shape:{type:"circle",cx:z,cy:z,r:z/2},fill:[0,0,0,0],stroke:{width:z,dashArray:`${K||B} ${A}`,dashoffset:`-${F?G[O]/2:B/2*O}`,color:f[O]},offset:[0,0]})}x=null;f=2*z+((null==D?void 0:D.width)||
0);if(A=w.holePercentage)D&&C.push({shape:{type:"circle",cx:z,cy:z,r:z*A},fill:null,stroke:D,offset:[0,0]}),x=f/2,x=[[{shape:{type:"circle",cx:x,cy:x,r:x},fill:y,stroke:D?{...D,color:y}:null,offset:[0,0]},{shape:{type:"circle",cx:x,cy:x,r:z*A},fill:[0,0,0],stroke:null,offset:[0,0]}]];return h.renderSymbol([C],[f,f],{effectView:w.effectList,ignoreStrokeWidth:!0,masking:x,rotation:-90})};b.renderPreviewHTML=g;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/symbols/support/previewUtils":function(){define(["exports","../../Color"],function(a,b){function c(n,l){return Math.round(Math.min(Math.max(n+191.25*l,0),255))}a.SymbolSizeDefaults=void 0;(function(n){n[n.size=22]="size";n[n.lineWidth=50]="lineWidth";n[n.maxSize=120]="maxSize";n[n.maxOutlineSize=80]="maxOutlineSize";n[n.tallSymbolWidth=20]="tallSymbolWidth"})(a.SymbolSizeDefaults||(a.SymbolSizeDefaults={}));a.adjustColorBrightness=function(n,l){if("type"in n&&("linear"===n.type||"pattern"===
n.type))return n;n=new b(n);return new b([c(n.r,l),c(n.g,l),c(n.b,l),n.a])};a.adjustColorComponentBrightness=c;a.getConeShapes=function(n,l){let u=l?a.SymbolSizeDefaults.tallSymbolWidth:n;l=l?4:6;u=u<=a.SymbolSizeDefaults.size?u-.5*l:u-l;l=.15*u;const v=u;n-=l;return[{type:"ellipse",cx:.5*u,cy:n,rx:.5*u,ry:l},{type:"path",path:[{command:"M",values:[.5*v,0]},{command:"L",values:[v,n]},{command:"L",values:[0,n]},{command:"Z",values:[]}]}]};a.getCubeShapes=function(n,l){let u=l?a.SymbolSizeDefaults.tallSymbolWidth:
n;var v=l?4:6;v=u=u<=a.SymbolSizeDefaults.size?u-.5*v:u-v;l=l?.35*u:.5*u;return[{type:"path",path:[{command:"M",values:[.5*v,0]},{command:"L",values:[v,.5*l]},{command:"L",values:[.5*v,l]},{command:"L",values:[0,.5*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*l]},{command:"L",values:[.5*v,l]},{command:"L",values:[.5*v,n]},{command:"L",values:[0,n-.5*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.5*v,l]},{command:"L",values:[.5*v,n]},{command:"L",
values:[v,n-.5*l]},{command:"L",values:[v,.5*l]},{command:"Z",values:[]}]}]};a.getCylinderShapes=function(n,l){var u=l?a.SymbolSizeDefaults.tallSymbolWidth:n;l=l?4:6;u=u<=a.SymbolSizeDefaults.size?u-.5*l:u-l;l=.5*u;const v=.15*u;n-=v;return[{type:"ellipse",cx:.5*u,cy:n,rx:l,ry:v},{type:"path",path:[{command:"M",values:[0,v]},{command:"L",values:[0,n]},{command:"L",values:[u,n]},{command:"L",values:[u,v]},{command:"Z",values:[]}]},{type:"ellipse",cx:.5*u,cy:v,rx:l,ry:v}]};a.getDiamondShapes=function(n){var l=
n;l=l<a.SymbolSizeDefaults.size?l-2:l-4;const u=Math.floor(n/10)-1||1;return[{type:"path",path:[{command:"M",values:[.45*l,0]},{command:"L",values:[l,.5*n-u]},{command:"L",values:[.45*l-u,.5*n+u]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.45*l,0]},{command:"L",values:[.45*l-u,.5*n+u]},{command:"L",values:[0,.5*n-u]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,.5*n-u]},{command:"L",values:[.45*l-u,.5*n+u]},{command:"L",values:[.45*l,n]},{command:"Z",
values:[]}]},{type:"path",path:[{command:"M",values:[.45*l,n]},{command:"L",values:[l,.5*n-u]},{command:"L",values:[.45*l-u,.5*n+u]},{command:"Z",values:[]}]}]};a.getExtrudeSymbolShapes=function(n){const l=a.SymbolSizeDefaults.size;n*=.5;return[{type:"path",path:[{command:"M",values:[0,.35*l]},{command:"L",values:[.3*l,.7*l]},{command:"L",values:[.3*l,.7*l+n]},{command:"L",values:[0,.7*l+n-.35*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*l,.7*l]},{command:"L",values:[.3*
l,.7*l+n]},{command:"L",values:[l,n]},{command:"L",values:[l,0]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[.3*l,0]},{command:"L",values:[l,0]},{command:"L",values:[.3*l,.7*l]},{command:"L",values:[0,.35*l]},{command:"Z",values:[]}]}]};a.getInvertedConeShapes=function(n){let l=n;l=l<a.SymbolSizeDefaults.size?l-3:l-6;const u=.15*l,v=l;return[{type:"path",path:[{command:"M",values:[0,0]},{command:"L",values:[v,0]},{command:"L",values:[.5*v,n-u]},{command:"Z",values:[]}]},{type:"ellipse",
cx:.5*l,cy:0,rx:.5*l,ry:u}]};a.getPathSymbolShapes=function(n,l,u){var v=a.SymbolSizeDefaults.size;let m=v,h=v;1>n?m*=.75:1<n&&(h*=1.25);n=v;l&&u&&(m=h=n=v=0);return[{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[u?n:.875*n,0]},{command:"L",values:[u?m-.5*n:0,h-.5*v]},{command:"L",values:[m-.5*n,h-.5*v]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[n,0]},{command:"L",values:[n,l?0:.125*v]},{command:"L",values:[m-.5*n,l?h-.5*v:v]},{command:"L",values:[m-.5*
n,h-.5*v]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[m-.5*n,h-.5*v]},{command:"L",values:[u?m-.5*n:0,h-.5*v]},{command:"L",values:[u?m-.5*n:0,l?h-.5*v:v]},{command:"L",values:[m-.5*n,l?h-.5*v:v]},{command:"Z",values:[]}]}]};a.getTetrahedronShapes=function(n){var l=n;l=l<a.SymbolSizeDefaults.size?l-1:l-2;return[{type:"path",path:[{command:"M",values:[.45*n,0]},{command:"L",values:[n,l]},{command:"L",values:[.45*n,.6*l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",
values:[.45*n,0]},{command:"L",values:[.45*n,.6*l]},{command:"L",values:[0,l]},{command:"Z",values:[]}]},{type:"path",path:[{command:"M",values:[0,l]},{command:"L",values:[.45*n,.6*l]},{command:"L",values:[n,l]},{command:"Z",values:[]}]}]};a.getWaterSymbolShapes=function(){return[{type:"path",path:"M80,80.2v-27c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4C8.3,59.3,5.7,58,3.9,56c-1.1-1.2-2.4-2.1-3.9-2.8v27"},
{type:"path",path:"M11,59.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8v-24c-1.5,0.7-2.8,1.6-3.9,2.8c-1.8,2.1-4.4,3.3-7.1,3.5c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-2.2-2.3-4.7-3.6-7.4-3.6s-5.1,1.3-7.4,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.7-0.1-5.3-1.4-7.1-3.4c-1.1-1.2-2.4-2.1-3.9-2.8v24c1.5,0.7,2.8,1.6,3.9,2.8C5.7,58,8.3,59.3,11,59.4z"},
{type:"path",path:"M11,35.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.4-3.6s5.1,1.3,7.4,3.6c1.8,2,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c2.2-2.3,4.7-3.6,7.3-3.6s5.1,1.3,7.4,3.6c1.8,2.1,4.4,3.3,7.2,3.4c2.7-0.1,5.3-1.4,7.1-3.4c1.1-1.2,2.4-2.1,3.9-2.8V3.6c-1.5,0.7-2.8,1.6-3.9,2.8c-2.2,2.1-4.6,3.4-7.1,3.4s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6S42.5,9.9,40,9.9s-5-1.3-7.1-3.4s-4.7-3.6-7.4-3.6s-5.1,1.3-7.3,3.6c-1.8,2.1-4.4,3.3-7.2,3.4c-2.5,0-5-1.3-7.1-3.4C2.8,5.3,1.4,4.3,0,3.6v25.6c1.5,0.7,2.8,1.6,3.9,2.8C5.7,34.1,8.3,35.3,11,35.4z"}]};
a.shapes={fill:[{type:"path",path:"M -10,-10 L 10,0 L 10,10 L -10,10 L -10,-10 Z"}],squareFill:[{type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 Z"}],pathSymbol3DLayer:[{type:"path",path:"M 3,12 L 12,0 L 11,-2 L -4,5 L -1,5 L 1,7 L 3,10 L 3,12 Z"},{type:"circle",cx:-2,cy:10,r:5}],extrudeSymbol3DLayer:[{type:"path",path:"M -7,-5 L -2,0 L -2,7 L -7,3 L -7,-5 Z"},{type:"path",path:"M -2,0 L -2,7 L 10,-3 L 10,-10 L -2,0 Z"},{type:"path",path:"M -7,-5 L -2,0 L 10,-10 L -2,-10 L -7,-5 Z"}],
cone:[{type:"path",path:"M 0,-10 L -8,5 L -4,6.5 L 0,7 L 4,6.5 L 8,5 Z"}],tallCone:[{type:"path",path:"M 0,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 0,-9 Z"}],invertedCone:[{type:"path",path:"M 0,7 L -8,-8 L 8,-8 Z"},{type:"path",path:"M -8,-8 L -4,-9.5 L 0,-10 L 4,-9.5 L 8,-8 L 4,-6.5 L 0,-6 L -4,-6.5 Z"}],cube:[{type:"path",path:"M -10,-7 L 0,-12 L 10,-7 L 0,-2 L -10,-7 Z"},{type:"path",path:"M -10,-7 L 0,-2 L 0,12 L -10,7 L -10,-7 Z"},{type:"path",path:"M 0,-2 L 10,-7 L 10,7 L 0,12 L 0,-2 Z"}],
tallCube:[{type:"path",path:"M -3.5,-8.5 L 0,-9.5 L 3.5,-8.5 L 0,-7.5 L -3.5,-8.5 Z"},{type:"path",path:"M -3.5,-8.5 L 0,-7.5 L 0,9 L -3.5,8 L -3.5,-8.5 Z"},{type:"path",path:"M 0,-7.5 L 3.5,-8.5 L 3.5,8 L 0,9 L 0,-7.5 Z"}],cylinder:[{type:"path",path:"M -8,-9 L -8,7 L -4,8.5 L 0,9 L 4,8.5 L 8,7 L 8,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:8,ry:2}],tallCylinder:[{type:"path",path:"M -3.5,-9 L -3.5,7 L -1.5,7.8 L 0,8 L 1.5,7.8 L 3.5,7 L 3.5,-9 Z"},{type:"ellipse",cx:0,cy:-9,rx:3.5,ry:1}],diamond:[{type:"path",
path:"M 0,-10 L 10,-1 L -1,1 L 0,-10 Z"},{type:"path",path:"M 0,-10 L -1,1 L -8,-1 L 0,-10 Z"},{type:"path",path:"M -1,1 L 0,10 L -8,-1 L -1,1 Z"},{type:"path",path:"M -1,0 L 0,10 L 10,-1 L -1,1 Z"}],tetrahedron:[{type:"path",path:"M 0,-10 L 10,7 L 0,0 L 0,-10 Z"},{type:"path",path:"M 0,-10 L 0,0 L -8,7 L 0,-10 Z"},{type:"path",path:"M 10,7 L 0,0 L -8,7 L 10,7 Z"}]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/renderUtils":function(){define("exports ../../kernel ../../request ../../core/colorUtils ../../core/Error ../../core/has ../../libs/maquette/projection ../../libs/maquette/projector ./svgUtils ./utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(p,t,q){return p?c(p,{responseType:"image"}).then(k=>{k=k.data;const r=k.width,y=k.height,f=r/y;let w=t;q&&(w=Math.min(w,Math.max(r,y)));return{image:k,width:1>=f?Math.ceil(w*f):w,height:1>=f?w:Math.ceil(w/f)}}):Promise.reject(new l("renderUtils: imageDataSize","href not provided."))}const g=m.createProjector();a.renderSymbol=function(p,t,q){const k=Math.ceil(t[0]);t=Math.ceil(t[1]);if(!p.some(y=>!!y.length))return null;const r=q&&q.node||document.createElement("div");
null!=q.opacity&&(r.style.opacity=q.opacity.toString());null!=q.effectView&&(r.style.filter=d.getCSSFilterFromEffectList(q.effectView));g.append(r,h.renderSVG.bind(null,p,k,t,q));return r};a.tintImageWithColor=function(p,t,q,k,r){return e(p,t,r).then(y=>{const f=y.width?y.width:t,w=y.height?y.height:t;var z;if(z=y.image)z=q&&"ignore"!==k?"multiply"===k&&255===q.r&&255===q.g&&255===q.b&&1===q.a?!1:!0:!1;if(z){var A=y.image.width,x=y.image.height;u("edge")&&/\.svg$/i.test(p)&&(--A,--x);z=Math.ceil(f);
var B=Math.ceil(w);var C=document.createElement("canvas");C.width=z;C.height=B;C.style.width=z+"px";C.style.height=B+"px";C=C.getContext("2d");C.clearRect(0,0,z,B);z=C;z.drawImage(y.image,0,0,A,x,0,0,f,w);B=z.getImageData(0,0,f,w);C=[q.r/255,q.g/255,q.b/255,q.a];const E=n.toHSV(q);for(let F=0;F<B.data.length;F+=4){y=B.data;A=F;x=C;var D=E;switch(k){case "multiply":y[A+0]*=x[0];y[A+1]*=x[1];y[A+2]*=x[2];y[A+3]*=x[3];break;default:{const G=n.toHSV({r:y[A+0],g:y[A+1],b:y[A+2]});G.h=D.h;G.s=D.s;G.v=G.v/
100*D.v;D=n.toRGB(G);y[A+0]=D.r;y[A+1]=D.g;y[A+2]=D.b;y[A+3]*=x[3]}}}z.putImageData(B,0,0);p=z.canvas.toDataURL("image/png")}else(z=b.id&&b.id.findCredential(p))&&z.token&&(y=p.includes("?")?"\x26":"?",p=`${p}${y}token=${z.token}`);return{url:p,width:f,height:w}}).catch(()=>({url:p,width:t,height:t}))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/colorUtils":function(){define(["exports"],function(a){function b(d,e){const g=[];let p,t;if(d[0].length!==
e.length)throw"dimensions do not match";const q=d.length,k=d[0].length;let r=0;for(p=0;p<q;p++){for(t=r=0;t<k;t++)r+=d[p][t]*e[t];g.push(r)}return g}function c(d){d=[d.r/255,d.g/255,d.b/255].map(e=>.04045>=e?e/12.92:((e+.055)/1.055)**2.4);d=b(m,d);return{x:100*d[0],y:100*d[1],z:100*d[2]}}function n(d){d=b(h,[d.x/100,d.y/100,d.z/100]).map(e=>Math.min(1,Math.max(.0031308>=e?12.92*e:1.055*e**(1/2.4)-.055,0)));return{r:Math.round(255*d[0]),g:Math.round(255*d[1]),b:Math.round(255*d[2])}}function l(d){d=
[d.x/95.047,d.y/100,d.z/108.883].map(e=>e>(6/29)**3?e**(1/3):1/3*(29/6)**2*e+4/29);return{l:116*d[1]-16,a:500*(d[0]-d[1]),b:200*(d[1]-d[2])}}function u(d){const e=d.l;d=[(e+16)/116+d.a/500,(e+16)/116,(e+16)/116-d.b/200].map(g=>g>6/29?g**3:3*(6/29)**2*(g-4/29));return{x:95.047*d[0],y:100*d[1],z:108.883*d[2]}}function v(d){if("r"in d&&"g"in d&&"b"in d)return d;if("l"in d&&"c"in d&&"h"in d){var e=d.c;var g=d.h;e={l:d.l,a:e*Math.cos(g),b:e*Math.sin(g)};return n(u(e))}if("l"in d&&"a"in d&&"b"in d)return n(u(d));
if("x"in d&&"y"in d&&"z"in d)return n(d);if("h"in d&&"s"in d&&"v"in d){{g=(d.h+360)%360/60;e=d.v/100*255;d=d.s/100*e;const p=d*(1-Math.abs(g%2-1));switch(Math.floor(g)){case 0:g={r:d,g:p,b:0};break;case 1:g={r:p,g:d,b:0};break;case 2:g={r:0,g:d,b:p};break;case 3:g={r:0,g:p,b:d};break;case 4:g={r:p,g:0,b:d};break;case 5:case 6:g={r:d,g:0,b:p};break;default:g={r:0,g:0,b:0}}g.r=Math.round(g.r+e-d);g.g=Math.round(g.g+e-d);g.b=Math.round(g.b+e-d);e=g}return e}return d}const m=[[.4124,.3576,.1805],[.2126,
.7152,.0722],[.0193,.1192,.9505]],h=[[3.2406,-1.5372,-.4986],[-.9689,1.8758,.0415],[.0557,-.204,1.057]];a.darken=function(d,e){d=l(c(d));d.l*=1-e;return n(u(d))};a.toHSV=function(d){if("h"in d&&"s"in d&&"v"in d)return d;var e=v(d);{d=e.r;const g=e.g,p=e.b;e=Math.max(d,g,p);const t=e-Math.min(d,g,p);d=0===t?0:e===d?(g-p)/t%6:e===g?(p-d)/t+2:(d-g)/t+4;0>d&&(d+=6);d={h:60*d,s:100*(0===t?0:t/e),v:100/255*e}}return d};a.toLAB=function(d){return"l"in d&&"a"in d&&"b"in d?d:l(c(v(d)))};a.toLCH=function(d){if(!("l"in
d&&"c"in d&&"h"in d)){{var e=l(c(v(d)));d=e.l;var g=e.a;const p=e.b;e=Math.sqrt(g*g+p*p);g=Math.atan2(p,g);g=0<g?g:g+2*Math.PI;d={l:d,c:e,h:g}}}return d};a.toRGB=v;a.toXYZ=function(d){return"x"in d&&"y"in d&&"z"in d?d:c(v(d))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/symbols/support/svgUtils":function(){define("exports ../../Color ../../core/has ../../chunks/mat2df32 ../../chunks/mat2d ../../widgets/support/widgetUtils ../../widgets/support/jsxFactory".split(" "),
function(a,b,c,n,l,u,v){function m(I,P){I*=M/180;return Math.abs(P*Math.sin(I))+Math.abs(P*Math.cos(I))}function h(I){return I.map(P=>`${P.command} ${P.values.join(" ")}`).join(" ").trim()}function d(I,P,N,V){if(I){if("circle"===I.type)return v.tsx("circle",{fill:P,"fill-rule":"evenodd",stroke:N.color,"stroke-width":N.width,"stroke-linecap":N.cap,"stroke-linejoin":N.join,"stroke-dasharray":N.dashArray,"stroke-dashoffset":N.dashOffset,"stroke-miterlimit":"4",cx:I.cx,cy:I.cy,r:I.r});if("ellipse"===
I.type)return v.tsx("ellipse",{fill:P,"fill-rule":"evenodd",stroke:N.color,"stroke-width":N.width,"stroke-linecap":N.cap,"stroke-linejoin":N.join,"stroke-dasharray":N.dashArray,"stroke-miterlimit":"4",cx:I.cx,cy:I.cy,rx:I.rx,ry:I.ry});if("rect"===I.type)return v.tsx("rect",{fill:P,"fill-rule":"evenodd",stroke:N.color,"stroke-width":N.width,"stroke-linecap":N.cap,"stroke-linejoin":N.join,"stroke-dasharray":N.dashArray,"stroke-miterlimit":"4",x:I.x,y:I.y,width:I.width,height:I.height});if("image"===
I.type)return v.tsx("image",{href:I.src,x:I.x,y:I.y,width:I.width,height:I.height,preserveAspectRatio:"none"});if("path"===I.type)return I="string"!==typeof I.path?h(I.path):I.path,v.tsx("path",{fill:P,"fill-rule":"evenodd",stroke:N.color,"stroke-width":N.width,"stroke-linecap":N.cap,"stroke-linejoin":N.join,"stroke-dasharray":N.dashArray,"stroke-miterlimit":"4",d:I});if("text"===I.type)return v.tsx("text",{"alignment-baseline":V.alignBaseline,fill:P,"fill-rule":"evenodd",stroke:N.color,"stroke-width":N.width,
"stroke-linecap":N.cap,"stroke-linejoin":N.join,"stroke-dasharray":N.dashArray,"stroke-miterlimit":"4","text-anchor":V.align,"text-decoration":V.decoration,kerning:V.kerning,rotate:V.rotate,"text-rendering":F,"font-style":V.font.style,"font-variant":V.font.variant,"font-weight":V.font.weight,"font-size":V.font.size,"font-family":V.font.family,x:I.x,y:I.y},I.text)}return null}function e(I){const P={fill:"none",pattern:null,linearGradient:null};if(I)if("type"in I&&"pattern"===I.type){var N=`patternId-${++D}`;
P.fill=`url(#${N})`;P.pattern={id:N,x:I.x,y:I.y,width:I.width,height:I.height,image:{x:0,y:0,width:I.width,height:I.height,href:I.src}}}else"type"in I&&"linear"===I.type?(N=`linearGradientId-${++E}`,P.fill=`url(#${N})`,P.linearGradient={id:N,x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,stops:I.colors.map(V=>({offset:V.offset,color:V.color&&(new b(V.color)).toString()}))}):I&&(I=new b(I),P.fill=I.toString());return P}function g(I){const P={color:"none",width:1,cap:"butt",join:"4",dashArray:"none",dashOffset:"0"};
if(I&&(null!=I.width&&(P.width=I.width),I.cap&&(P.cap=I.cap),I.join&&(P.join=I.join.toString()),I.color&&(P.color=(new b(I.color)).toString()),I.dashArray&&(P.dashArray=I.dashArray),I.dashArray&&(P.dashOffset=I.dashoffset),I.style)){let V=null;I.style in R&&(V=R[I.style]);if(Array.isArray(V)){V=V.slice(0);for(var N=0;N<V.length;++N)V[N]*=I.width;if("butt"!==I.cap){for(N=0;N<V.length;N+=2)V[N]-=I.width,1>V[N]&&(V[N]=1);for(N=1;N<V.length;N+=2)V[N]+=I.width}V=V.join(",")}P.dashArray=V}return P}function p(I,
P){const N={align:null,decoration:null,kerning:null,rotate:null,font:{style:null,variant:null,weight:null,size:null,family:null}};I&&(N.align=I.align,N.alignBaseline=I.alignBaseline,N.decoration=I.decoration,N.kerning=I.kerning?"auto":"0",N.rotate=I.rotated?"90":"0",N.font.style=P.style||"normal",N.font.variant=P.variant||"normal",N.font.weight=P.weight||"normal",N.font.size=P.size&&P.size.toString()||"10pt",N.font.family=P.family||"serif");return N}function t(I){const {pattern:P,linearGradient:N}=
I;return P?v.tsx("pattern",{id:P.id,patternUnits:"userSpaceOnUse",x:P.x,y:P.y,width:P.width,height:P.height},v.tsx("image",{x:P.image.x,y:P.image.y,width:P.image.width,height:P.image.height,href:P.image.href})):N?(I=N.stops.map((V,S)=>v.tsx("stop",{key:`${S}-stop`,offset:V.offset,"stop-color":V.color})),v.tsx("linearGradient",{id:N.id,gradientUnits:"userSpaceOnUse",x1:N.x1,y1:N.y1,x2:N.x2,y2:N.y2},I)):null}function q(I,P){if(!I)return null;const N=[];for(const V of I){const {shape:S,fill:T,stroke:H,
font:U}=V;I=e(T);const W=g(H),Q="text"===S.type?p(S,U):null;N.push(d(S,I.fill,W,Q))}return v.tsx("mask",{id:P,maskUnits:"userSpaceOnUse"},v.tsx("g",null,N))}function k(I,P,N){return l.translate(I,l.identity(I),[P,N])}function r(I,P,N,V,S){l.scale(I,l.identity(I),[P,N]);I[4]=I[4]*P-V*P+V;I[5]=I[5]*N-S*N+S;return I}function y(I,P,N,V){var S=P%360*Math.PI/180;l.rotate(I,l.identity(I),S);P=Math.cos(S);S=Math.sin(S);const T=I[4],H=I[5];I[4]=T*P-H*S+V*S-N*P+N;I[5]=H*P+T*S-N*S-V*P+V;return I}function f(I,
P){K&&"left"in K?(K.left>I&&(K.left=I),K.right<I&&(K.right=I),K.top>P&&(K.top=P),K.bottom<P&&(K.bottom=P)):K={left:I,bottom:P,right:I,top:P}}function w(I){const P=I.args,N=P.length;switch(I.action){case "M":case "L":case "C":case "S":case "Q":case "T":for(I=0;I<N;I+=2)f(P[I],P[I+1]);L.x=P[N-2];L.y=P[N-1];break;case "H":for(I=0;I<N;++I)f(P[I],L.y);L.x=P[N-1];break;case "V":for(I=0;I<N;++I)f(L.x,P[I]);L.y=P[N-1];break;case "m":I=0;"x"in L||(f(L.x=P[0],L.y=P[1]),I=2);for(;I<N;I+=2)f(L.x+=P[I],L.y+=P[I+
1]);break;case "l":case "t":for(I=0;I<N;I+=2)f(L.x+=P[I],L.y+=P[I+1]);break;case "h":for(I=0;I<N;++I)f(L.x+=P[I],L.y);break;case "v":for(I=0;I<N;++I)f(L.x,L.y+=P[I]);break;case "c":for(I=0;I<N;I+=6)f(L.x+P[I],L.y+P[I+1]),f(L.x+P[I+2],L.y+P[I+3]),f(L.x+=P[I+4],L.y+=P[I+5]);break;case "s":case "q":for(I=0;I<N;I+=4)f(L.x+P[I],L.y+P[I+1]),f(L.x+=P[I+2],L.y+=P[I+3]);break;case "A":for(I=0;I<N;I+=7)f(P[I+5],P[I+6]);L.x=P[N-2];L.y=P[N-1];break;case "a":for(I=0;I<N;I+=7)f(L.x+=P[I+5],L.y+=P[I+6])}}function z(I,
P,N){const V=G[I.toLowerCase()];"number"===typeof V&&(V?P.length>=V&&(I={action:I,args:P.slice(0,P.length-P.length%V)},N.push(I),w(I)):(I={action:I,args:[]},N.push(I),w(I)))}function A(I){const P={x:0,y:0,width:0,height:0};if("circle"===I.type)P.x=I.cx-I.r,P.y=I.cy-I.r,P.width=2*I.r,P.height=2*I.r;else if("ellipse"===I.type)P.x=I.cx-I.rx,P.y=I.cy-I.ry,P.width=2*I.rx,P.height=2*I.ry;else if("image"===I.type||"rect"===I.type)P.x=I.x,P.y=I.y,P.width=I.width,P.height=I.height;else if("path"===I.type){{const S=
("string"!==typeof I.path?h(I.path):I.path).match(O),T=[];K={};L={};if(S){I="";var N=[],V=S.length;for(let H=0;H<V;++H){const U=S[H],W=parseFloat(U);isNaN(W)?(I&&z(I,N,T),N=[],I=U):N.push(W)}z(I,N,T);I={x:0,y:0,width:0,height:0};K&&"left"in K&&(I.x=K.left,I.y=K.top,I.width=K.right-K.left,I.height=K.bottom-K.top)}else I=null}P.x=I.x;P.y=I.y;P.width=I.width;P.height=I.height}return P}function x(I){const P={x:0,y:0,width:0,height:0};let N=null,V=Number.NEGATIVE_INFINITY,S=Number.NEGATIVE_INFINITY;for(const T of I)N?
(N.x=Math.min(N.x,T.x),N.y=Math.min(N.y,T.y),V=Math.max(V,T.x+T.width),S=Math.max(S,T.y+T.height)):(N=P,N.x=T.x,N.y=T.y,V=T.x+T.width,S=T.y+T.height);N&&(N.width=V-N.x,N.height=S-N.y);return N}function B(I,P,N,V,S,T,H,U,W){var Q=(H&&T?m(T,P):P)/2,X=(H&&T?m(T,N):N)/2;W&&(Q=W[0],X=W[1],Q=(H&&T?m(T,Q):Q)/2,X=(H&&T?m(T,X):X)/2);const ba=I.width+V,aa=I.height+V;H=n.create();W=n.create();var ea=!1;if(S&&0!==ba&&0!==aa){S=P!==N?P/N:ba/aa;ea=P>N?P:N;let ia=1,ka=1;isNaN(ea)||(1<S?(ia=ea/ba,ka=ea/S/aa):(ka=
ea/aa,ia=ea*S/ba));l.multiply(W,W,r(H,ia,ka,Q,X));ea=!0}S=I.x+(ba-V)/2;I=I.y+(aa-V)/2;l.multiply(W,W,k(H,Q-S,X-I));!ea&&(ba>P||aa>N)&&(V=ba/P>aa/N,P=(V?P:N)/(V?ba:aa),l.multiply(W,W,r(H,P,P,S,I)));T&&l.multiply(W,W,y(H,T,S,I));U&&l.multiply(W,W,k(H,U[0],U[1]));return`matrix(${W[0]},${W[1]},${W[2]},${W[3]},${W[4]},${W[5]})`}function C(I,P,N){I=null==I?void 0:I.effects.find(U=>"bloom"===U.type);if(!I)return null;const {strength:V,radius:S}=I;I=0<V?S:0;const T=(V+I)*P,H=4*V+1;return v.tsx("filter",{id:`bloom${N}`,
x:"-100%",y:"-100%",width:"300%",height:"300%",filterUnits:"userSpaceOnUse"},v.tsx("feMorphology",{operator:"dilate",radius:(V+.5*I)*5**(P/100)*(.4+P/100),in:"SourceGraphic",result:"dilate"}),v.tsx("feGaussianBlur",{in:"dilate",stdDeviation:T/25,result:"blur"}),v.tsx("feGaussianBlur",{in:"blur",stdDeviation:T/50,result:"intensityBlur"}),v.tsx("feComponentTransfer",{in:"SourceGraphic",result:"intensityBrightness"},v.tsx("feFuncR",{type:"linear",slope:H}),v.tsx("feFuncG",{type:"linear",slope:H}),v.tsx("feFuncB",
{type:"linear",slope:H})),v.tsx("feMerge",null,v.tsx("feMergeNode",{in:"intensityBlur"}),v.tsx("feMergeNode",{in:"intensityBrightness"}),v.tsx("feGaussianBlur",{stdDeviation:V/10})))}let D=0,E=0;u=c("android");const F=c("chrome")||u&&4<=u?"auto":"optimizeLegibility",G={m:2,l:2,h:1,v:1,c:6,s:4,q:4,t:2,a:7,z:0},O=/([A-DF-Za-df-z])|([-+]?\d*[.]?\d+(?:[eE][-+]?\d+)?)/g;let K={},L={};const R={solid:"none",shortdash:[4,1],shortdot:[1,1],shortdashdot:[4,1,1,1],shortdashdotdot:[4,1,1,1,1,1],dot:[1,3],dash:[4,
3],longdash:[8,3],dashdot:[4,3,1,3],longdashdot:[8,3,1,3],longdashdotdot:[8,3,1,3,1,3]},M=Math.PI;let J=1;a.computeBBox=x;a.generateFillAttributes=e;a.generateStrokeAttributes=g;a.generateTextAttributes=p;a.getBoundingBox=A;a.getTransformMatrix=B;a.renderDef=t;a.renderSVG=function(I,P,N,V={}){const S=[],T=[],H=++J,U=C(V.effectView,P,H);var W=null;if(U){var Q;W=null==(Q=V.effectView)?void 0:Q.effects.find(ea=>"bloom"===ea.type);W=(W.strength?W.strength+W.radius/2:0)/3;W=[Math.max(P+P*W,10),Math.max(N+
N*W,10)]}for(Q=0;Q<I.length;Q++){var X=I[Q];const ea=[];var ba=[],aa=0;let ia=0,ka=0;for(const la of X){const {shape:Z,fill:ca,stroke:Y,font:da,offset:ha}=la;V.ignoreStrokeWidth||(aa+=Y&&Y.width||0);X=e(ca);const ja=g(Y),ma="text"===Z.type?p(Z,da):null;S.push(t(X));ea.push(d(Z,X.fill,ja,ma));ba.push(A(Z));ha&&(ia+=ha[0],ka+=ha[1])}ba=B(x(ba),P,N,aa,V.scale,V.rotation,V.useRotationSize,[ia,ka],W);aa=null;V.masking&&(aa=`mask-${Q}`,S.push(q(V.masking[Q],aa)),aa=`url(#${aa})`);T.push(aa?v.tsx("g",{mask:aa},
v.tsx("g",{transform:ba},ea)):v.tsx("g",{transform:ba},ea))}V.useRotationSize&&V.rotation&&(P=m(V.rotation,P),N=m(V.rotation,N));U&&(P=W[0],N=W[1]);return v.tsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:P,height:N,style:"display: block;"},U,v.tsx("defs",null,S),U?v.tsx("g",{filter:`url(#bloom${H})`},T):T)};a.renderShape=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2df32":function(){define(["exports"],function(a){function b(){const h=
new Float32Array(6);h[0]=1;h[3]=1;return h}function c(h){const d=new Float32Array(6);d[0]=h[0];d[1]=h[1];d[2]=h[2];d[3]=h[3];d[4]=h[4];d[5]=h[5];return d}function n(h,d,e,g,p,t){const q=new Float32Array(6);q[0]=h;q[1]=d;q[2]=e;q[3]=g;q[4]=p;q[5]=t;return q}function l(h,d){return new Float32Array(h,d,6)}function u(h,d,e,g){const p=d[g];d=d[g+1];h[g]=e[0]*p+e[2]*d+e[4];h[g+1]=e[1]*p+e[3]*d+e[5]}function v(h,d,e,g=0,p=0,t=2){for(p=p||d.length/t;g<p;g++)u(h,d,e,g*t)}const m=Object.freeze(Object.defineProperty({__proto__:null,
create:b,clone:c,fromValues:n,createView:l,transform:u,transformMany:v},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.mat2df32=m;a.transform=u;a.transformMany=v})},"esri/chunks/mat2d":function(){define(["exports","./common"],function(a,b){function c(B,C){B[0]=C[0];B[1]=C[1];B[2]=C[2];B[3]=C[3];B[4]=C[4];B[5]=C[5];return B}function n(B){B[0]=1;B[1]=0;B[2]=0;B[3]=1;B[4]=0;B[5]=0;return B}function l(B,C,D,E,F,G,O){B[0]=C;B[1]=D;B[2]=E;B[3]=F;B[4]=G;B[5]=O;
return B}function u(B,C){const D=C[0],E=C[1],F=C[2],G=C[3],O=C[4];C=C[5];let K=D*G-E*F;if(!K)return null;K=1/K;B[0]=G*K;B[1]=-E*K;B[2]=-F*K;B[3]=D*K;B[4]=(F*C-G*O)*K;B[5]=(E*O-D*C)*K;return B}function v(B){return B[0]*B[3]-B[1]*B[2]}function m(B,C,D){const E=C[0],F=C[1],G=C[2],O=C[3],K=C[4];C=C[5];const L=D[0],R=D[1],M=D[2],J=D[3],I=D[4];D=D[5];B[0]=E*L+G*R;B[1]=F*L+O*R;B[2]=E*M+G*J;B[3]=F*M+O*J;B[4]=E*I+G*D+K;B[5]=F*I+O*D+C;return B}function h(B,C,D){const E=C[0],F=C[1],G=C[2],O=C[3],K=C[4];C=C[5];
const L=Math.sin(D);D=Math.cos(D);B[0]=E*D+G*L;B[1]=F*D+O*L;B[2]=E*-L+G*D;B[3]=F*-L+O*D;B[4]=K;B[5]=C;return B}function d(B,C,D){const E=C[1],F=C[2],G=C[3],O=C[4],K=C[5],L=D[0];D=D[1];B[0]=C[0]*L;B[1]=E*L;B[2]=F*D;B[3]=G*D;B[4]=O;B[5]=K;return B}function e(B,C,D){const E=C[0],F=C[1],G=C[2],O=C[3],K=C[4];C=C[5];const L=D[0];D=D[1];B[0]=E;B[1]=F;B[2]=G;B[3]=O;B[4]=E*L+G*D+K;B[5]=F*L+O*D+C;return B}function g(B,C){const D=Math.sin(C);C=Math.cos(C);B[0]=C;B[1]=D;B[2]=-D;B[3]=C;B[4]=0;B[5]=0;return B}
function p(B,C){B[0]=C[0];B[1]=0;B[2]=0;B[3]=C[1];B[4]=0;B[5]=0;return B}function t(B,C){B[0]=1;B[1]=0;B[2]=0;B[3]=1;B[4]=C[0];B[5]=C[1];return B}function q(B){return"mat2d("+B[0]+", "+B[1]+", "+B[2]+", "+B[3]+", "+B[4]+", "+B[5]+")"}function k(B){return Math.sqrt(B[0]**2+B[1]**2+B[2]**2+B[3]**2+B[4]**2+B[5]**2+1)}function r(B,C,D){B[0]=C[0]+D[0];B[1]=C[1]+D[1];B[2]=C[2]+D[2];B[3]=C[3]+D[3];B[4]=C[4]+D[4];B[5]=C[5]+D[5];return B}function y(B,C,D){B[0]=C[0]-D[0];B[1]=C[1]-D[1];B[2]=C[2]-D[2];B[3]=
C[3]-D[3];B[4]=C[4]-D[4];B[5]=C[5]-D[5];return B}function f(B,C,D){B[0]=C[0]*D;B[1]=C[1]*D;B[2]=C[2]*D;B[3]=C[3]*D;B[4]=C[4]*D;B[5]=C[5]*D;return B}function w(B,C,D,E){B[0]=C[0]+D[0]*E;B[1]=C[1]+D[1]*E;B[2]=C[2]+D[2]*E;B[3]=C[3]+D[3]*E;B[4]=C[4]+D[4]*E;B[5]=C[5]+D[5]*E;return B}function z(B,C){return B[0]===C[0]&&B[1]===C[1]&&B[2]===C[2]&&B[3]===C[3]&&B[4]===C[4]&&B[5]===C[5]}function A(B,C){const D=B[0],E=B[1],F=B[2],G=B[3],O=B[4];B=B[5];const K=C[0],L=C[1],R=C[2],M=C[3],J=C[4];C=C[5];return Math.abs(D-
K)<=b.EPSILON*Math.max(1,Math.abs(D),Math.abs(K))&&Math.abs(E-L)<=b.EPSILON*Math.max(1,Math.abs(E),Math.abs(L))&&Math.abs(F-R)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(R))&&Math.abs(G-M)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(M))&&Math.abs(O-J)<=b.EPSILON*Math.max(1,Math.abs(O),Math.abs(J))&&Math.abs(B-C)<=b.EPSILON*Math.max(1,Math.abs(B),Math.abs(C))}const x=Object.freeze(Object.defineProperty({__proto__:null,copy:c,identity:n,set:l,invert:u,determinant:v,multiply:m,rotate:h,scale:d,translate:e,
fromRotation:g,fromScaling:p,fromTranslation:t,str:q,frob:k,add:r,subtract:y,multiplyScalar:f,multiplyScalarAndAdd:w,exactEquals:z,equals:A,mul:m,sub:y},Symbol.toStringTag,{value:"Module"}));a.add=r;a.copy=c;a.determinant=v;a.equals=A;a.exactEquals=z;a.frob=k;a.fromRotation=g;a.fromScaling=p;a.fromTranslation=t;a.identity=n;a.invert=u;a.mat2d=x;a.mul=m;a.multiply=m;a.multiplyScalar=f;a.multiplyScalarAndAdd=w;a.rotate=h;a.scale=d;a.set=l;a.str=q;a.sub=y;a.subtract=y;a.translate=e})},"esri/views/support/layerViewUtils":function(){define(["exports",
"../../core/maybe"],function(a,b){a.extractSafeScaleBounds=function(c){var n,l;const u=c.effectiveScaleRange;c=null!=(n=null==u?void 0:u.minScale)?n:0;n=null!=(l=null==u?void 0:u.maxScale)?l:0;return{minScale:c,maxScale:n}};a.highlightsSupported=function(c){return c&&"function"===typeof c.highlight};a.isScaleRangeActive=function(c,n){return 0<c||0<n};a.occludeesSupported=function(c){return c&&"function"===typeof c.maskOccludee};a.scaleBoundsPredicate=function(c,n,l){return b.isNone(c)||c>l&&(0===
n||c<n)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Popup/actions":function(){define(["exports","../../support/actions/ActionButton"],function(a,b){const c=new b({id:"zoom-to-feature",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"}),n=new b({id:"remove-selected-feature",title:"{messages.remove}",className:"esri-icon-trash"}),l=new b({id:"zoom-to-clustered-features",title:"{messages.zoom}",className:"esri-icon-zoom-in-magnifying-glass"});
b=new b({id:"browse-clustered-features",title:"{messages.browseClusteredFeatures}",className:"esri-icon-table"});a.all=[c,n,b,l];a.browseClusteredFeatures=b;a.removeSelectedFeature=n;a.zoomToClusteredFeatures=l;a.zoomToFeature=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/Popup/actionUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../core/promiseUtils ./actions".split(" "),
function(a,b,c,n,l,u){function v(r){const {selectedFeature:y,location:f,view:w}=r;return w?"3d"===w.type?y||f:r.get("selectedFeature.geometry")||f:null}function m(r){var y,f;return(null==r?void 0:r.isAggregate)&&"cluster"===(null==r?void 0:null==(y=r.sourceLayer)?void 0:null==(f=y.featureReduction)?void 0:f.type)}function h(r,y){if("3d"!==(null==y?void 0:y.type)||!r||"esri.Graphic"!==r.declaredClass)return!0;if((y=y.getViewForGraphic(r))&&"whenGraphicBounds"in y){let f=!1;y.whenGraphicBounds(r,{useViewElevation:!0}).then(w=>
{f=!w||!w.boundingBox||w.boundingBox[0]===w.boundingBox[3]&&w.boundingBox[1]===w.boundingBox[4]&&w.boundingBox[2]===w.boundingBox[5]}).catch(()=>{const w=new c("zoom-to:invalid-graphic","Could not zoom to the location of the graphic.",{graphic:r});k.error(w)});return f}return!0}function d(r){return e.apply(this,arguments)}function e(){e=b._asyncToGenerator(function*(r){const {location:y,selectedFeature:f,view:w,zoomFactor:z}=r,A=v(r);if(!A)throw r=new c("zoom-to:invalid-target-or-view","Cannot zoom to location without a target and view.",
{target:A,view:w}),k.error(r),r;const x=w.scale/z,B=r.get("selectedFeature.geometry")||y,C=B&&"point"===B.type&&h(f,w);u.zoomToFeature.active=!0;u.zoomToFeature.disabled=!0;try{yield r.view.goTo({target:A,scale:C?x:void 0})}finally{u.zoomToFeature.active=!1,u.zoomToFeature.disabled=!1,r.zoomToLocation=null,C&&(r.location=B)}});return e.apply(this,arguments)}function g(r){return p.apply(this,arguments)}function p(){p=b._asyncToGenerator(function*(r){const {selectedFeature:y,view:f}=r;if("2d"!==(null==
f?void 0:f.type))throw r=new c("zoomToCluster:invalid-view","View must be 2d MapView.",{view:f}),k.error(r),r;if(!m(y))throw r=new c("zoomToCluster:invalid-selectedFeature","Selected feature must represent an aggregate/cluster graphic.",{selectedFeature:y}),k.error(r),r;r=yield f.whenLayerView(y.sourceLayer);const w=r.createQuery();w.aggregateIds=[y.getObjectId()];u.zoomToClusteredFeatures.active=!0;u.zoomToClusteredFeatures.disabled=!0;({extent:r}=yield r.queryExtent(w));yield f.goTo({target:r});
u.zoomToClusteredFeatures.active=!1;u.zoomToClusteredFeatures.disabled=!1});return p.apply(this,arguments)}function t(){t=b._asyncToGenerator(function*(r){const {selectedFeature:y,view:f}=r;var w=yield f.whenLayerView(y.sourceLayer);const z=w.createQuery();z.aggregateIds=[y.getObjectId()];({extent:w}=yield w.queryExtent(z));r.selectedClusterBoundaryFeature.geometry=w;f.graphics.add(r.selectedClusterBoundaryFeature)});return t.apply(this,arguments)}function q(){q=b._asyncToGenerator(function*(r){const {selectedFeature:y,
view:f}=r;r=yield f.whenLayerView(y.sourceLayer);const w=r.createQuery();w.aggregateIds=[y.getObjectId()];u.browseClusteredFeatures.active=!0;u.browseClusteredFeatures.disabled=!0;({features:r}=yield r.queryFeatures(w));u.browseClusteredFeatures.active=!1;u.browseClusteredFeatures.disabled=!1;f.popup.open({features:[y].concat(r),featureMenuOpen:!0})});return q.apply(this,arguments)}const k=n.getLogger("esri.widgets.Popup.PopupViewModel");a.browseAggregateFeatures=function(r){return q.apply(this,arguments)};
a.displayClusterExtent=function(r){return t.apply(this,arguments)};a.getSelectedTarget=v;a.isClusterFeature=m;a.isZoomScreenSize=h;a.removeClusteredFeaturesForBrowsing=function(r){const y=r.features.filter(f=>m(f));y.length&&(r.features=y)};a.triggerAction=r=>{const {event:y,view:f}=r;({action:r}=y);var w=f&&f.popup;if(!r)return Promise.reject(new c("trigger-action:missing-arguments","Event has no action"));if(!w)return Promise.reject(new c("trigger-action:missing-arguments","view.popup is missing"));
const {disabled:z,id:A}=r;if(!A)return Promise.reject(new c("trigger-action:invalid-action","action.id is missing"));if(z)return Promise.reject(new c("trigger-action:invalid-action","Action is disabled"));if(A===u.zoomToFeature.id)return d(w.viewModel).catch(l.throwIfNotAbortError);if(A===u.zoomToClusteredFeatures.id)return g(w.viewModel);if(A===u.browseClusteredFeatures.id)return w.featureMenuOpen=!w.featureMenuOpen,w.viewModel.browseClusterEnabled=!w.viewModel.browseClusterEnabled,Promise.resolve();
w.viewModel.browseClusterEnabled=!1;if(A===u.removeSelectedFeature.id){w.close();({selectedFeature:r}=w);if(!r)return Promise.reject(new c(`trigger-action:${u.removeSelectedFeature.id}`,"selectedFeature is required",{selectedFeature:r}));({sourceLayer:w}=r);w?w.remove(r):f.graphics.remove(r)}return Promise.resolve()};a.zoomToClusterExtent=g;a.zoomToLocation=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/widgets/support/GoTo":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){a.GoToMixin=h=>{h=function(d){function e(...g){g=d.call(this,...g)||this;g.goToOverride=null;g.view=null;return g}b._inheritsLoose(e,d);e.prototype.callGoTo=function(g){const {view:p}=this;return this.goToOverride?this.goToOverride(p,g):p.goTo(g.target,g.options)};return e}(h);c.__decorate([n.property()],h.prototype,"goToOverride",void 0);c.__decorate([n.property()],h.prototype,"view",void 0);return h=c.__decorate([m.subclass("esri.widgets.support.GoTo")],h)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/GroundView":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/Accessor ../core/Collection ../core/Handles ../core/reactiveUtils ../core/accessorSupport/decorators/property ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/subclass ./support/GroundViewElevationSampler".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g){c=function(p){function t(k){k=
p.call(this,k)||this;k.handles=new l;k.view=null;k.layerViews=new n;return k}a._inheritsLoose(t,p);var q=t.prototype;q.initialize=function(){this.handles.add(u.when(()=>{var k,r;return null==(k=this.view)?void 0:null==(r=k.map)?void 0:r.ground},k=>k.load()));this.handles.add(this.layerViews.on("after-changes",()=>this._layerViewsAfterChangesHandler()))};q.destroy=function(){this._set("view",null);this.handles&&(this.handles.destroy(),this.handles=null)};q._layerViewsAfterChangesHandler=function(){this.handles.remove("updating");
this.handles.add(this.layerViews.map(k=>u.watch(()=>k.updating,()=>this._updateUpdating(),u.sync)).toArray(),"updating");this._updateUpdating()};q._updateUpdating=function(){this.notifyChange("updating")};a._createClass(t,[{key:"elevationSampler",get:function(){return this.view&&"2d"!==this.view.type&&this.view.ready&&this.view.basemapTerrain&&this.view.basemapTerrain.ready?new g({view:this.view}):null}},{key:"updating",get:function(){return this.suspended?!1:this.layerViews.some(k=>k.updating)}},
{key:"suspended",get:function(){return!this.view||this.view.suspended}}]);return t}(c);b.__decorate([v.property({readOnly:!0})],c.prototype,"elevationSampler",null);b.__decorate([v.property({type:Boolean,readOnly:!0})],c.prototype,"updating",null);b.__decorate([v.property({constructOnly:!0})],c.prototype,"view",void 0);b.__decorate([v.property({type:n,readOnly:!0})],c.prototype,"layerViews",void 0);b.__decorate([v.property({readOnly:!0})],c.prototype,"suspended",null);return c=b.__decorate([e.subclass("esri.views.GroundView")],
c)})},"esri/views/support/GroundViewElevationSampler":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Evented ../../core/Logger ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/aaBoundingRect ../../geometry/support/contains ../../layers/support/ElevationSampler ../3d/terrain/TerrainConst".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){const q=n.getLogger("esri.views.support.GroundViewElevationSampler");c=function(k){function r(f){f=k.call(this,f)||this;f.demResolution={min:-1,max:-1};f.noDataValue=t.ELEVATION_NODATA_VALUE;return f}a._inheritsLoose(r,k);var y=r.prototype;y.initialize=function(){this.view.basemapTerrain.on("elevation-change",()=>this.emit("changed",{}))};y.elevationAt=function(f,w){if(l.isNone(this.extent)||!g.extentContainsXYZ(this.extent,f,w)){const z=l.isSome(this.extent)?
`${this.extent.xmin}, ${this.extent.ymin}, ${this.extent.xmax}, ${this.extent.ymax}`:null;q.warn("#elevationAt()",`Point used to sample elevation (${f}, ${w}) is outside of the sampler extent (${z})`);return this.noDataValue}return l.unwrapOr(this.view.elevationProvider.getElevation(f,w,0,this.spatialReference,"ground"),this.noDataValue)};y.queryElevation=function(f){return p.updateGeometryElevation(f.clone(),this)};a._createClass(r,[{key:"extent",get:function(){const f=this.view.basemapTerrain;if(l.isNone(f.extent)||
!f.spatialReference)return null;const w=e.toExtent(f.extent,f.spatialReference);w.zmin=f.elevationBounds.min;w.zmax=f.elevationBounds.max;return w}}]);return r}(c.EventedAccessor);b.__decorate([u.property({readOnly:!0})],c.prototype,"demResolution",void 0);b.__decorate([u.property({readOnly:!0})],c.prototype,"extent",null);b.__decorate([u.property({readOnly:!0})],c.prototype,"noDataValue",void 0);b.__decorate([u.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],c.prototype,"spatialReference",
void 0);b.__decorate([u.property({constructOnly:!0})],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.views.support.GroundViewElevationSampler")],c)})},"esri/layers/support/ElevationSampler":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../geometry ../../core/has ../../core/Logger ../../core/maybe ../../core/unitUtils ../../geometry/support/aaBoundingRect ../../geometry/support/webMercatorUtils ../../geometry/Point".split(" "),function(a,b,c,n,l,u,v,m,h,d){function e(r,
y){const f=g(r,y.spatialReference);if(!f)return null;switch(r.type){case "point":r.z=y.elevationAt(f.x,f.y);break;case "polyline":q.spatialReference=f.spatialReference;var w=r.hasM&&!r.hasZ;for(var z=0;z<r.paths.length;z++){var A=r.paths[z],x=f.paths[z];for(let B=0;B<A.length;B++){const C=A[B],D=x[B];q.x=D[0];q.y=D[1];w&&(C[3]=C[2]);C[2]=y.elevationAt(q.x,q.y)}}r.hasZ=!0;break;case "multipoint":q.spatialReference=f.spatialReference;w=r.hasM&&!r.hasZ;for(z=0;z<r.points.length;z++)A=r.points[z],x=f.points[z],
q.x=x[0],q.y=x[1],w&&(A[3]=A[2]),A[2]=y.elevationAt(q.x,q.y);r.hasZ=!0}return r}function g(r,y){if(u.isNone(r))return null;const f=r.spatialReference;if(f.equals(y))return r;(r=h.project(r,y))||p.error(`Cannot project geometry spatial reference (wkid:${f.wkid}) to elevation sampler spatial reference (wkid:${y.wkid})`);return r}const p=l.getLogger("esri.layers.support.ElevationSampler");c=function(){function r(){}var y=r.prototype;y.queryElevation=function(f){return e(f.clone(),this)};y.on=function(){return k};
y.projectIfRequired=function(f,w){return g(f,w)};return r}();let t=function(r){function y(w,z,A){var x=r.call(this)||this;x.tile=w;x.noDataValue=A;x.extent=m.toExtent(w.tile.extent,z.spatialReference);x.extent.zmin=w.zmin;x.extent.zmax=w.zmax;x.aaExtent=w.tile.extent;A=v.getMetersPerUnitForSR(z.spatialReference);w=z.lodAt(w.tile.level).resolution*A;x.demResolution={min:w,max:w};return x}b._inheritsLoose(y,r);var f=y.prototype;f.contains=function(w){w=this.projectIfRequired(w,this.spatialReference);
return u.isNone(w)?!1:this.containsAt(w.x,w.y)};f.containsAt=function(w,z){return m.containsXY(this.aaExtent,w,z)};f.elevationAt=function(w,z){if(!this.containsAt(w,z)){const A=this.extent;p.warn("#elevationAt()",`Point used to sample elevation (${w}, ${z}) is outside of the sampler extent (${`${A.xmin}, ${A.ymin}, ${A.xmax}, ${A.ymax}`})`);return this.noDataValue}return u.unwrapOr(this.tile.sample(w,z),this.noDataValue)};b._createClass(y,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);
return y}(c);n=function(r){function y(f,w,z){var A=r.call(this)||this;let x;"number"===typeof w?(A.noDataValue=w,x=null):(x=w,A.noDataValue=z);A.samplers=x?f.map(B=>new t(B,x,A.noDataValue)):f;if(f=A.samplers[0]){A.extent=f.extent.clone();const {min:B,max:C}=f.demResolution;A.demResolution={min:B,max:C};for(f=1;f<A.samplers.length;f++)w=A.samplers[f],A.extent.union(w.extent),A.demResolution.min=Math.min(A.demResolution.min,w.demResolution.min),A.demResolution.max=Math.max(A.demResolution.max,w.demResolution.max)}else A.extent=
m.toExtent(m.create(),x.spatialReference),A.demResolution={min:0,max:0};return A}b._inheritsLoose(y,r);y.prototype.elevationAt=function(f,w){for(const z of this.samplers)if(z.containsAt(f,w))return z.elevationAt(f,w);p.warn("#elevationAt()",`Point used to sample elevation (${f}, ${w}) is outside of the sampler`);return this.noDataValue};b._createClass(y,[{key:"spatialReference",get:function(){return this.extent.spatialReference}}]);return y}(c);const q=new d,k={remove(){}};a.ElevationSamplerBase=
c;a.MultiTileElevationSampler=n;a.TileElevationSampler=t;a.updateGeometryElevation=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainConst":function(){define(["exports","../../../core/mathUtils","../../../geometry/support/aaBoundingRect","./TilingScheme"],function(a,b,c,n){b=b.clampFloat32(b.NUMBER_MAX_FLOAT32/10);const l=c.create();n.TilingScheme.WebMercatorAuxiliarySphere.getExtent(0,0,0,l);c=c.create([-180,-90,180,90]);a.DEFAULT_TILE_BACKGROUND=
"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEACAIAAADTED8xAAAACXBIWXMAAAsTAAALEwEAmpwYAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAA2JJREFUeNrs3d1O20AQgFFvRJInQLQBhHj/h0JVW34El1yQ2F73DVq3jTys55zrqUBbPrErZUSZ+vcOsto4AjK76Lqu1vr8+G3mPzjc3D/+eJj/Bcz/cd75R80fbu79BsAVCAQAAgABgABAACAAEAAIAAQAAgABQPOKfQAy83Ho+HnnHzXv49B4A4AAQAAgABAACAAEAAIAAYAAQAAgABAANM4+AKnZB4ifd/5R8/YB8AYAAYAAQAAgABAACAAEAAIAAYAAQAAgAGicfQBSsw8QP+/8o+btA+ANAAIAAYAAQAAgABAACAAEAAIAAYAAQADQOPsApGYfIH7e+UfN2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAXA201QdggAggH0AUrMPED8/jsPL03fns/y8fQC8AUAAIAAQAAgABAACAAGAAEAAIAAQAAgAGmcfgNTsA8TP2weImrcPgDcACAAEAAIAAYAAQAAgABAACAAEAAIAAUDj7AOQmn2A+Hn7AFHz9gHwBgABgABAACAAEAAIAAQAAgABgABgNS4cAf9pu9u3O1+m/n2aplKK/0j+TX86/tVP5+eZ3+729gFIfwWyDxA7bx8gat4+ANkJAAGAAEAAIAAQAAgABAACAAGAAEAAIABonn0AUrMPED9vHyBq3j4A3gAgABAACAAEAAIAAYAAQAAgABAA51VrdQgCAAHAsuwDkJp9gPj5vj+9vvx0PsvP2wfAGwAEAAIAAYAAQAAgABAACAAEAAIAAYAAoHH2AUjNPkD8vH2AqHn7AHgDgABAACAAEAAIAAQAAgABgABAACAAEAA0zj4AqdkHiJ+3DxA1bx8AbwAQACQ0DL0AyKuOowBwBYKUSikCIHUBAsAVCAQAAgABgABAALBy9gFIzT5A/Lx9gKj5y6trVyC8AUAAIAAQAAgAVq90Pg5N5gA2AsAVCAQAAgABgABAALB29gFIzT5A/Lx9gKj5q6+3rkB4A4AAQAAgABAACADWzB/IIHsCAsAVCARAlKlWhyAAEAAIABZjH4DU7APEz5+OH2+vT85n+fkvhztXILwBQAAgABAACAAEAGtWigBIHcBGALgCgQBAACAAyPMO9nHosxuHodZx5vB2t691HIdh/nx/Os7/Zsz/fvgXAAAA//8DAF1P1hM2ICMfAAAAAElFTkSuQmCC";
a.ELEVATION_DESIRED_MAX_UPSCALING_DISTANCE=4;a.ELEVATION_NODATA_VALUE=b;a.GEOGRAPHIC_WORLD_EXTENT=c;a.GEOMETRY_VERTEX_STRIDE=8;a.MAX_MEMORY_LOD_BIAS=2.5;a.MAX_PATCH_TESSELATION=512;a.MAX_ROOT_TILES=64;a.PROGRESSIVE_LOADING_MODULO=4;a.TILE_LOADING_DEBUGLOG=!1;a.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR="Cannot extend surface to encompass all layers because it would result in too many root tiles.";a.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR="Surface extent is too large for tile resolution at level 0.";a.WEBMERCATOR_WORLD_EXTENT=
l;a.getElevationDesiredResolutionLevel=u=>4>u?3:4;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TilingScheme":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Error ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../geometry/Extent ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../geometry/support/webMercatorUtils ../../../layers/support/TileInfo".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){function t(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")}let q=function(){function r(f){var w=r.checkUnsupported(f);if(l.isSome(w))throw w;f=l.unwrap(f);this.spatialReference=f.spatialReference;this._isWebMercator=this.spatialReference.isWebMercator;this._isGCS=m.canProjectToWGS84ComparableLonLat(this.spatialReference)||e.isMars(this.spatialReference)||e.isMoon(this.spatialReference);this.origin=[f.origin.x,f.origin.y];
this.pixelSize=f.size[0];this.dpi=f.dpi;var z=f.lods.reduce((B,C,D)=>{C.level<B.min&&(B.min=C.level,B.minIndex=D);B.max=Math.max(B.max,C.level);return B},{min:Infinity,minIndex:0,max:-Infinity}),A=f.lods[z.minIndex];const x=2**A.level;w=A.resolution*x;A=A.scale*x;this.levels=Array(z.max+1);for(z=0;z<this.levels.length;z++)this.levels[z]={resolution:w,scale:A,tileSize:[w*f.size[0],w*f.size[1]]},w/=2,A/=2}var y=r.prototype;y.clone=function(){return new r(this.toTileInfo())};y.toTileInfo=function(){return new p({dpi:this.dpi,
origin:{x:this.origin[0],y:this.origin[1],spatialReference:this.spatialReference},size:[this.pixelSize,this.pixelSize],spatialReference:this.spatialReference,lods:this.levels.map((f,w)=>({level:w,scale:f.scale,resolution:f.resolution}))})};y.getExtent=function(f,w,z,A){var x=this.levels[f];f=x.tileSize[0];x=x.tileSize[1];A[0]=this.origin[0]+z*f;A[2]=this.origin[0]+(z+1)*f;A[3]=this.origin[1]-w*x;A[1]=this.origin[1]-(w+1)*x};y.convertExtentToRadians=function(f,w){this._isWebMercator?(w[0]=g.x2lon(f[0]),
w[1]=g.y2lat(f[1]),w[2]=g.x2lon(f[2]),w[3]=g.y2lat(f[3])):this._isGCS&&(w[0]=n.deg2rad(f[0]),w[1]=n.deg2rad(f[1]),w[2]=n.deg2rad(f[2]),w[3]=n.deg2rad(f[3]))};y.getExtentGeometry=function(f,w,z,A=new v){this.getExtent(f,w,z,k);A.spatialReference=this.spatialReference;A.xmin=k[0];A.ymin=k[1];A.xmax=k[2];A.ymax=k[3];A.zmin=void 0;A.zmax=void 0;return A};y.ensureMaxLod=function(f){if(null==f)return!1;for(var w=!1;this.levels.length<=f;){w=this.levels[this.levels.length-1];const z=w.resolution/2;this.levels.push({resolution:z,
scale:w.scale/2,tileSize:[z*this.pixelSize,z*this.pixelSize]});w=!0}return w};y.capMaxLod=function(f){this.levels.length>f+1&&(this.levels.length=f+1)};y.getMaxLod=function(){return this.levels.length-1};y.scaleAtLevel=function(f){return this.levels[0].scale/2**f};y.levelAtScale=function(f){const w=this.levels[0].scale;return f>=w?0:Math.log(w/f)*Math.LOG2E};y.resolutionAtLevel=function(f){return this.levels[0].resolution/2**f};y.compatibleWith=function(f){if(!(f instanceof r)){if(r.checkUnsupported(f))return!1;
f=new r(f)}if(!f.spatialReference.equals(this.spatialReference)||f.pixelSize!==this.pixelSize)return!1;const w=Math.min(this.levels.length,f.levels.length)-1,z=this.levels[w].resolution;let A=.5*z;if(!n.floatEqualAbsolute(f.origin[0],this.origin[0],A)||!n.floatEqualAbsolute(f.origin[1],this.origin[1],A))return!1;A=.5*z/2**w/this.pixelSize*12;return n.floatEqualAbsolute(z,f.levels[w].resolution,A)};y.rootTilesInExtent=function(f,w=null,z=Infinity){const A=[],x=this.levels[0].tileSize;if(l.isNone(f)||
0===x[0]||0===x[1])return A;r.computeRowColExtent(f,x,this.origin,k);f=k[1];let B=k[3],C=k[0],D=k[2];var E=D-C;const F=B-f;E*F>z&&(z=Math.floor(Math.sqrt(z)),F>z&&(f=f+Math.floor(.5*F)-Math.floor(.5*z),B=f+z),E>z&&(C=C+Math.floor(.5*E)-Math.floor(.5*z),D=C+z));for(z=f;z<B;z++)for(E=C;E<D;E++)A.push([0,z,E]);l.isSome(w)&&(w[0]=this.origin[0]+C*x[0],w[1]=this.origin[1]-B*x[1],w[2]=this.origin[0]+D*x[0],w[3]=this.origin[1]-f*x[1]);return A};r.computeRowColExtent=function(f,w,z,A){const x=.001*(f[2]-
f[0]+(f[3]-f[1]));A[0]=Math.max(0,Math.floor((f[0]+x-z[0])/w[0]));A[2]=Math.max(0,Math.ceil((f[2]-x-z[0])/w[0]));A[1]=Math.max(0,Math.floor((z[1]-f[3]+x)/w[1]));A[3]=Math.max(0,Math.ceil((z[1]-f[1]-x)/w[1]))};r.isPowerOfTwo=function(f){f=f.lods;const w=f[0].resolution*2**f[0].level;return!f.some(z=>!n.floatEqualRelative(z.resolution,w/2**z.level))};r.hasGapInLevels=function(f){f=f.lods.map(w=>w.level);f.sort((w,z)=>w-z);for(let w=1;w<f.length;w++)if(f[w]!==f[0]+w)return!0;return!1};r.tileSizeSupported=
function(f){const w=f.size[1];return w===f.size[0]&&0===(w&w-1)&&128<=w&&512>=w};r.hasOriginPerLODs=function(f){const w=f.origin;return f.lods.some(z=>null!=z.origin&&(z.origin[0]!==w.x||z.origin[1]!==w.y))};r.getMissingTileInfoError=function(){return new c("tilingscheme:tile-info-missing","Tiling scheme must have tiling information")};r.checkUnsupported=function(f){return l.isNone(f)?t():1>f.lods.length?new c("tilingscheme:generic","Tiling scheme must have at least one level"):r.isPowerOfTwo(f)?
r.hasGapInLevels(f)?new c("tilingscheme:gaps","Tiling scheme levels must not have gaps between min and max level"):r.tileSizeSupported(f)?r.hasOriginPerLODs(f)?new c("tilingscheme:multiple-origin","Tiling scheme levels must not have their own origin"):null:new c("tilingscheme:tile-size","Tiles must be square and size must be one of [128, 256, 512]"):new c("tilingscheme:power-of-two","Tiling scheme must be power of two")};r.fromExtent=function(f,w){const z=f[2]-f[0],A=f[3]-f[1],x=u.getMetersPerUnitForSR(w),
B=1.2*Math.max(z,A);f=new r(new p({size:[256,256],origin:{x:f[0]-.5*(B-z),y:f[3]+.5*(B-A)},lods:[{level:0,resolution:B/256,scale:1/(256/96*.0254/(B*x))}],spatialReference:w}));f.ensureMaxLod(20);return f};r.makeWebMercatorAuxiliarySphere=function(f){const w=new r(r.WebMercatorAuxiliarySphereTileInfo);w.ensureMaxLod(f);return w};r.makeGCSWithTileSize=function(f,w=256,z=16){const A=256/w;f=new r(new p({size:[w,w],origin:{x:-180,y:90,spatialReference:f},spatialReference:f,lods:[{level:0,resolution:.703125*
A,scale:2.95497598570834E8*A}]}));f.ensureMaxLod(z);return f};b._createClass(r,[{key:"test",get:function(){return{isWebMercator:this._isWebMercator,isGCS:this._isGCS}}}]);return r}();q.WebMercatorAuxiliarySphereTileInfo=new p({size:[256,256],origin:{x:-2.0037508342787E7,y:2.0037508342787E7,spatialReference:h.WebMercator},spatialReference:h.WebMercator,lods:[{level:0,resolution:156543.03392800014,scale:5.91657527591555E8}]});q.WebMercatorAuxiliarySphere=q.makeWebMercatorAuxiliarySphere(19);const k=
d.create();a.TilingScheme=q;a.getMissingTileInfoError=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/PopupView":function(){define("exports ../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/maybe ../core/promiseUtils ../core/Logger ../core/accessorSupport/ensureType ../core/arrayUtils ../core/has ../core/accessorSupport/set ../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){a.PopupView=g=>
{g=function(p){function t(){return p.apply(this,arguments)||this}b._inheritsLoose(t,p);var q=t.prototype;q.fetchPopupFeatures=function(){var k=b._asyncToGenerator(function*(r,y){yield this.when();const {location:f,queryArea:w,layerViewsAndGraphics:z,clientOnlyGraphics:A}=yield this._prepareFetchPopupFeatures(r,y);r=Promise.resolve(A);y=this._queryLayerPopupFeatures(w,z,y);const x=y.map(B=>B.promise);r=l.eachAlwaysValues([r,...x]).then(B=>Array.from(new Set(B.flat())));return{location:f,clientOnlyGraphics:A,
allGraphicsPromise:r,promisesPerLayerView:y}});return function(r,y){return k.apply(this,arguments)}}();q._queryLayerPopupFeatures=function(k,r,y){return r.map(({layerView:f,graphics:w})=>{w={clientGraphics:w,event:n.isSome(y)?y.event:null,signal:n.isSome(y)?y.signal:null,defaultPopupTemplateEnabled:n.isSome(y)?!!y.defaultPopupTemplateEnabled:!1};w=f.fetchPopupFeatures(k,w);return{layerView:f,promise:w}})};q._isValidPopupGraphic=function(k,r){return k&&!!k.getEffectivePopupTemplate(n.isSome(r)&&r.defaultPopupTemplateEnabled)};
q._prepareFetchPopupFeatures=function(){var k=b._asyncToGenerator(function*(r,y){const {clientGraphics:f,queryArea:w,location:z}=yield this._popupHitTestGraphics(r,y);r=this._getFetchPopupLayerViews();const {layerViewsAndGraphics:A,clientOnlyGraphics:x}=this._graphicsPerFetchPopupLayerView(f,r);return{clientOnlyGraphics:x,layerViewsAndGraphics:A,queryArea:w,location:z}});return function(r,y){return k.apply(this,arguments)}}();q._popupHitTestGraphics=function(){var k=b._asyncToGenerator(function*(r,
y){const {results:f,mapPoint:w}=yield this.popupHitTest(r);r=f.filter(A=>"graphic"===A.type&&this._isValidPopupGraphic(A.graphic,y));const z=r.length?r[0].mapPoint:null;return{clientGraphics:r.map(A=>A.graphic),queryArea:w,location:w||z}});return function(r,y){return k.apply(this,arguments)}}();q._getFetchPopupLayerViews=function(){const k=[];this.allLayerViews.forEach(r=>{this._isValidPopupLayerView(r)&&k.push(r)});n.isSome(this.graphicsView)&&this._isValidPopupLayerView(this.graphicsView)&&k.push(this.graphicsView);
return k.reverse()};q._isValidPopupLayerView=function(k){return n.isSome(k)&&(!("layer"in k)||!k.suspended)&&"fetchPopupFeatures"in k};q._graphicsPerFetchPopupLayerView=function(k,r){const y=[],f=new Map;r=r.map(w=>{const z=[];"layer"in w?f.set(w.layer,z):f.set(w.graphics,z);return{layerView:w,graphics:z}});for(const w of k)(k=f.get(w.layer)||f.get(w.sourceLayer)||null)?k.push(w):y.push(w);return{layerViewsAndGraphics:r,clientOnlyGraphics:y}};return t}(g);return g=c.__decorate([e.subclass("esri.views.PopupView")],
g)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layerViewModuleImportUtils":function(){define(["require","exports","../../core/Error","../../core/maybe"],function(a,b,c,n){const l=h=>Object.freeze(Object.defineProperty({__proto__:null,default:h},Symbol.toStringTag,{value:"Module"})),u=()=>new Promise((h,d)=>a(["./layers/TileLayerView3D"],e=>h(l(e)),d)),v=()=>new Promise((h,d)=>a(["./layers/ElevationLayerView3D"],e=>h(l(e)),d)),m={"base-dynamic":()=>
new Promise((h,d)=>a(["./layers/BaseDynamicLayerView3D"],e=>h(l(e)),d)),"base-elevation":v,"base-tile":u,"bing-maps":u,"building-scene":()=>new Promise((h,d)=>a(["./layers/BuildingSceneLayerView3D"],e=>h(l(e)),d)),csv:()=>new Promise((h,d)=>a(["./layers/CSVLayerView3D"],e=>h(l(e)),d)),elevation:v,feature:()=>new Promise((h,d)=>a(["./layers/FeatureLayerView3D"],e=>h(l(e)),d)),geojson:()=>new Promise((h,d)=>a(["./layers/GeoJSONLayerView3D"],e=>h(l(e)),d)),graphics:()=>new Promise((h,d)=>a(["./layers/GraphicsLayerView3D"],
e=>h(l(e)),d)),group:()=>new Promise((h,d)=>a(["../layers/GroupLayerView"],e=>h(l(e)),d)),imagery:()=>new Promise((h,d)=>a(["./layers/ImageryLayerView3D"],e=>h(l(e)),d)),"integrated-mesh":()=>new Promise((h,d)=>a(["./layers/IntegratedMeshLayerView3D"],e=>h(l(e)),d)),"line-of-sight":()=>new Promise((h,d)=>a(["./layers/LineOfSightLayerView3D"],e=>h(l(e)),d)),"map-image":()=>new Promise((h,d)=>a(["./layers/MapImageLayerView3D"],e=>h(l(e)),d)),media:()=>new Promise((h,d)=>a(["./layers/MediaLayerView3D"],
e=>h(l(e)),d)),"ogc-feature":()=>new Promise((h,d)=>a(["./layers/OGCFeatureLayerView3D"],e=>h(l(e)),d)),"open-street-map":u,"point-cloud":()=>new Promise((h,d)=>a(["./layers/PointCloudLayerView3D"],e=>h(l(e)),d)),voxel:()=>new Promise((h,d)=>a(["./layers/VoxelLayerView3D"],e=>h(l(e)),d)),route:()=>new Promise((h,d)=>a(["./layers/RouteLayerView3D"],e=>h(l(e)),d)),scene:h=>null==h.profile||"mesh-pyramids"===h.profile?new Promise((d,e)=>a(["./layers/SceneLayerView3D"],g=>d(l(g)),e)):new Promise((d,e)=>
a(["./layers/SceneLayerGraphicsView3D"],g=>d(l(g)),e)),stream:()=>new Promise((h,d)=>a(["./layers/StreamLayerView3D"],e=>h(l(e)),d)),tile:u,"imagery-tile":()=>new Promise((h,d)=>a(["./layers/ImageryTileLayerView3D"],e=>h(l(e)),d)),"vector-tile":()=>new Promise((h,d)=>a(["./layers/VectorTileLayerView3D"],e=>h(l(e)),d)),wcs:()=>new Promise((h,d)=>a(["./layers/ImageryTileLayerView3D"],e=>h(l(e)),d)),"web-tile":u,wfs:()=>new Promise((h,d)=>a(["./layers/WFSLayerView3D"],e=>h(l(e)),d)),wms:()=>new Promise((h,
d)=>a(["./layers/WMSLayerView3D"],e=>h(l(e)),d)),wmts:()=>new Promise((h,d)=>a(["./layers/WMTSLayerView3D"],e=>h(l(e)),d)),"geo-rss":null,kml:null,"map-notes":null,"subtype-group":null,unknown:null,unsupported:null};b.layerView3DImporter={hasLayerViewModule:h=>n.isSome(m[h.type]),importLayerView:h=>{var d=m[h.type];if(n.isNone(d))throw h=h.declaredClass?h.declaredClass.slice(h.declaredClass.lastIndexOf(".")+1):"Unknown",d=h.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase(),h=new c(`${d}:view-not-supported`,
`${h} is not supported in 3D`),h;return d(h)}};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/analysis/AnalysisViewManager3D":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Collection ../../../core/Error ../../../core/HandleOwner ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/scheduling ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){const p=r=>Object.freeze(Object.defineProperty({__proto__:null,default:r},Symbol.toStringTag,{value:"Module"})),t=v.getLogger("esri.views.3d.analysis.AnalysisViewManager3D");var q;(function(r){r[r.PENDING=0]="PENDING";r[r.CREATED=1]="CREATED"})(q||(q={}));var k;(function(r){r[r.ADDED=0]="ADDED";r[r.REMOVED=1]="REMOVED"})(k||(k={}));u=function(r){function y(w){w=r.call(this,w)||this;w._allAnalysisViews=new n;w._creatingViewCount=0;w._items=new Map;w._scheduledUpdateHandle=
null;w._attachedToViewResolver=h.createResolver();w._analysisModules={"area-measurement":{module:null},dimensioning:{module:null},"direct-line-measurement":{module:null},"line-of-sight":{module:null},slice:{module:null}};return w}b._inheritsLoose(y,r);var f=y.prototype;f.destroy=function(){this._disconnectOwners();this._attachedToViewResolver.reject(h.createAbortError("AnalysisViewManager was destroyed"))};f.attach=function(){this._connectOwners();this._attachedToViewResolver.resolve()};f.detach=
function(){this._disconnectOwners();this._attachedToViewResolver.reject(h.createAbortError());this._attachedToViewResolver=h.createResolver();this._attachedToViewResolver.promise.catch(()=>{})};f.whenAnalysisView=function(){var w=b._asyncToGenerator(function*(z){yield this._attachedToViewResolver.promise;const A=this._items.get(z);if(m.isNone(A)||A.state.list===k.REMOVED)throw new l("AnalysisViewManager:no-analysisview-for-analysis","The analysis has not been added to view.analyses",{analysis:z});
return A.createAnalysisViewTask.promise});return function(z){return w.apply(this,arguments)}}();f._connectOwners=function(){this.handles.add(this._connectAnalysesCollection(this.view.analyses),"analyses-owner-handles")};f._disconnectOwners=function(){this.handles.remove("analyses-owner-handles");this._update();this._creatingViewCount=0};f._connectAnalysesCollection=function(w){for(const x of w)this._addAnalysis(x);const z=w.on("after-add",x=>this._addAnalysis(x.item)),A=w.on("after-remove",x=>this._removeAnalysis(x.item));
return{remove:()=>{z.remove();A.remove();for(const x of w)this._removeAnalysis(x)}}};f._addAnalysis=function(w){const z=this._items.get(w);if(null==z){const A={state:{view:q.PENDING,list:k.ADDED},analysis:w,view:null,createAnalysisViewTask:null};this._items.set(w,A);A.createAnalysisViewTask=h.createTask(x=>this._createAnalysisViewPromise(A,x))}else z.state.list=k.ADDED};f._removeAnalysis=function(w){w=this._items.get(w);null==w?t.error("Trying to remove analysis which was not added"):(w.state.list=
k.REMOVED,this._scheduleUpdate())};f._scheduleUpdate=function(){m.isSome(this._scheduledUpdateHandle)||(this._scheduledUpdateHandle=d.schedule(()=>this._update()))};f._update=function(){this._scheduledUpdateHandle=m.removeMaybe(this._scheduledUpdateHandle);this._items.forEach(w=>{if(w.state.list===k.REMOVED)switch(this._items.delete(w.analysis),w.state.view){case q.PENDING:w.createAnalysisViewTask=m.abortMaybe(w.createAnalysisViewTask);break;case q.CREATED:m.isSome(w.view)&&(this._allAnalysisViews.remove(w.view),
w.view=m.destroyMaybe(w.view),w.createAnalysisViewTask=null)}})};f._createAnalysisViewPromise=function(){var w=b._asyncToGenerator(function*(z,A){var x=z.analysis;const B=x.type,C=this._analysisModules[B];this._creatingViewCount+=1;if(m.isNone(C.module))try{C.module=yield this._loadAnalysisModule(B)}catch(D){throw--this._creatingViewCount,D;}if(h.isAborted(A))throw--this._creatingViewCount,h.createAbortError("AnalysisView creation aborted");x=new C.module.default({analysis:x,view:this.view});try{yield x.when()}catch(D){throw--this._creatingViewCount,
D;}if(h.isAborted(A))throw--this._creatingViewCount,x.destroy(),h.createAbortError("AnalysisView creation aborted");z.view=x;z.state.view=q.CREATED;this._allAnalysisViews.add(x);--this._creatingViewCount;return x});return function(z,A){return w.apply(this,arguments)}}();f._loadAnalysisModule=function(w){switch(w){case "area-measurement":return new Promise((z,A)=>a(["./AreaMeasurementAnalysisView3D"],x=>z(p(x)),A));case "dimensioning":return new Promise((z,A)=>a(["./DimensioningAnalysisView3D"],x=>
z(p(x)),A));case "direct-line-measurement":return new Promise((z,A)=>a(["./DirectLineMeasurementAnalysisView3D"],x=>z(p(x)),A));case "line-of-sight":return new Promise((z,A)=>a(["./LineOfSightAnalysisView3D"],x=>z(p(x)),A));case "slice":return new Promise((z,A)=>a(["./SliceAnalysisView3D"],x=>z(p(x)),A))}};b._createClass(y,[{key:"updating",get:function(){return!this.view.ready||0!==this._creatingViewCount||this._allAnalysisViews.some(w=>w.updating)}},{key:"testInfo",get:function(){return{allAnalysisViews:this._allAnalysisViews}}}]);
return y}(u.HandleOwner);c.__decorate([e.property()],u.prototype,"updating",null);c.__decorate([e.property({constructOnly:!0})],u.prototype,"view",void 0);c.__decorate([e.property()],u.prototype,"_allAnalysisViews",void 0);c.__decorate([e.property()],u.prototype,"_creatingViewCount",void 0);return u=c.__decorate([g.subclass("esri.views.3d.analysis.AnalysisViewManager3D")],u)})},"esri/views/3d/constraints/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AltitudeConstraint ./ClipDistanceConstraint ./TiltConstraint".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){a.Constraints=function(p){function t(){var q=p.apply(this,arguments)||this;q.tilt=new g.TiltConstraint;q.altitude=new d.AltitudeConstraint;q.clipDistance=new e.ClipDistanceConstraint;return q}b._inheritsLoose(t,p);return t}(n);c.__decorate([l.property({type:g.TiltConstraint})],a.Constraints.prototype,"tilt",void 0);c.__decorate([l.property({type:d.AltitudeConstraint})],a.Constraints.prototype,"altitude",void 0);c.__decorate([l.property({type:e.ClipDistanceConstraint})],
a.Constraints.prototype,"clipDistance",void 0);a.Constraints=c.__decorate([h.subclass("esri.views.3d.constraints.Constraints")],a.Constraints);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/AltitudeConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,n,l,u,v,m,h,d){a.AltitudeConstraint=function(e){function g(){var p=e.apply(this,arguments)||this;p.min=d.earthAltitudeConstraint.min;p.max=d.earthAltitudeConstraint.max;return p}b._inheritsLoose(g,e);return g}(n);c.__decorate([l.property({type:Number})],a.AltitudeConstraint.prototype,"min",void 0);c.__decorate([l.property({type:Number})],a.AltitudeConstraint.prototype,"max",void 0);a.AltitudeConstraint=c.__decorate([h.subclass("esri.views.3d.constraints.AltitudeConstraint")],a.AltitudeConstraint);
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/Constraints":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/support/Ellipsoid ../../ViewingMode ../support/mathUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){const q=l.getLogger("esri.views.3d.state.Constraints");a.Constraints=function(f){function w(A){A=f.call(this,A)||this;A.collision=new y;A.distance=Infinity;A.minimumPoiDistance=4;return A}b._inheritsLoose(w,f);var z=w.prototype;z.clampAltitude=function(A){return this.altitude?u.clamp(A,this.altitude.min,this.altitude.max):A};z.clampTilt=function(A,x){if(!this.tilt)return x;A=this.tilt(A);return u.clamp(x,A.min,A.max)};z.clampDistance=function(A){return Math.min(A,
this.distance)};z.createDefaultTilt=function(){return this.mode===p.ViewingMode.Local?this._createDefaultTiltLocal():this._createDefaultTiltGlobal()};z.createConstantMaxTilt=function(A){return(x,B=r)=>{B.min=k.min;B.max=A;return B}};z._createDefaultTiltLocal=function(){const A=this.collision.enabled?t.makePiecewiseLinearFunction([[4E3,k.max],[1E4,u.deg2rad(88)],[6E6,u.deg2rad(88)]]):()=>k.max;return(x,B=r)=>{B.min=k.min;B.max=A(x);return B}};z._createDefaultTiltGlobal=function(){const A=this.collision.enabled?
t.makePiecewiseLinearFunction([[4E3,k.max],[5E4,u.deg2rad(88)],[6E6,u.deg2rad(88)],[2E7,k.min]]):t.makePiecewiseLinearFunction([[3E5,k.max],[3E6,u.deg2rad(88)],[6E6,u.deg2rad(88)],[2E7,k.min]]);return(x,B=r)=>{B.min=k.min;B.max=A(x);return B}};b._createClass(w,[{key:"altitude",get:function(){return this.mode===p.ViewingMode.Local?null:this._get("altitude")||null},set:function(A){this.mode===p.ViewingMode.Local?q.warn("Altitude constraint is ignored in local scenes"):this._set("altitude",A)}}]);return w}(n);
c.__decorate([v.property()],a.Constraints.prototype,"altitude",null);c.__decorate([v.property({readOnly:!0})],a.Constraints.prototype,"collision",void 0);c.__decorate([v.property()],a.Constraints.prototype,"distance",void 0);c.__decorate([v.property({readOnly:!0})],a.Constraints.prototype,"minimumPoiDistance",void 0);c.__decorate([v.property()],a.Constraints.prototype,"tilt",void 0);c.__decorate([v.property({constructOnly:!0})],a.Constraints.prototype,"mode",void 0);a.Constraints=c.__decorate([e.subclass("esri.views.3d.state.Constraints")],
a.Constraints);l={min:-2E5,max:4*g.earth.radius};const k={min:u.deg2rad(.5),max:u.deg2rad(179.5)},r={min:0,max:0};let y=function(f){function w(){var z=f.apply(this,arguments)||this;z.enabled=!0;z.elevationMargin=5;return z}b._inheritsLoose(w,f);return w}(n);c.__decorate([v.property({type:Boolean})],y.prototype,"enabled",void 0);c.__decorate([v.property({type:Number})],y.prototype,"elevationMargin",void 0);y=c.__decorate([e.subclass("esri.views.3d.state.Constraints.CollisionConstraint")],y);a.TiltDefault=
k;a.earthAltitudeConstraint=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/ClipDistanceConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass".split(" "),function(a,
b,c,n,l,u,v,m,h){a.ClipDistanceConstraint=function(d){function e(){var p=d.apply(this,arguments)||this;p.mode="auto";return p}b._inheritsLoose(e,d);var g=e.prototype;g.castNear=function(p){return Math.max(1E-8,p)};g.castFar=function(p){return Math.max(1E-8,p)};g.autoUpdate=function(p,t){"auto"===this.mode&&(this._get("near")!==p&&this._set("near",p),this._get("far")!==t&&this._set("far",t))};b._createClass(e,[{key:"near",get:function(){return this._get("near")},set:function(p){this._set("near",p);
p>=this._get("far")&&(this.far=p+1E-9);this.mode="manual"}},{key:"far",get:function(){return this._get("far")},set:function(p){this._set("far",p);p<=this._get("near")&&(this.near=p-1E-9);this.mode="manual"}}]);return e}(n);c.__decorate([l.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"near",null);c.__decorate([m.cast("near")],a.ClipDistanceConstraint.prototype,"castNear",null);c.__decorate([l.property({type:Number,value:1E-8})],a.ClipDistanceConstraint.prototype,"far",null);
c.__decorate([m.cast("far")],a.ClipDistanceConstraint.prototype,"castFar",null);c.__decorate([l.property({type:["auto","manual"]})],a.ClipDistanceConstraint.prototype,"mode",void 0);a.ClipDistanceConstraint=c.__decorate([h.subclass("esri.views.3d.constraints.ClipDistanceConstraint")],a.ClipDistanceConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/constraints/TiltConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../state/Constraints".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){var g=l.rad2deg(e.TiltDefault.min),p=l.rad2deg(e.TiltDefault.max);a.TiltConstraint=function(t){function q(){var r=t.apply(this,arguments)||this;r.mode="auto";return r}b._inheritsLoose(q,t);var k=q.prototype;k.castMax=function(r){return l.clamp(r,g,p)};k.autoUpdate=function(r){"auto"===this.mode&&this._get("max")!==r&&this._set("max",r)};b._createClass(q,[{key:"max",get:function(){return this._get("max")},set:function(r){this._set("max",r);this.mode="manual"}}]);return q}(n);
c.__decorate([u.property({type:["auto","manual"]})],a.TiltConstraint.prototype,"mode",void 0);c.__decorate([u.property({type:Number,value:p})],a.TiltConstraint.prototype,"max",null);c.__decorate([h.cast("max")],a.TiltConstraint.prototype,"castMax",null);a.TiltConstraint=c.__decorate([d.subclass("esri.views.3d.constraints.TiltConstraint")],a.TiltConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SceneViewEnvironment":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/lang ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/cast ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/ensureType ./lightingUtils ./SceneViewAtmosphere ./SunLighting ./VirtualLighting ../../../webscene/Environment ../../../webscene/SunLighting ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){var q;g=q=function(k){function r(f){f=k.call(this,f)||this;f.atmosphere=new h.SceneViewAtmosphere;f.lighting=new d;return f}a._inheritsLoose(r,k);r.fromWebsceneEnvironment=function(f){f=f.cloneConstructProperties();return new q({...f,lighting:"virtual"===f.lighting.type?e.fromWebsceneLighting(f.lighting):d.fromWebsceneLighting(f.lighting)})};var y=r.prototype;y.castLighting=function(f){return this._convertLighting(f)};y.applyLighting=function(f){this.lighting=
this._convertLighting(f)};y._convertLighting=function(f){return f?f instanceof d||f instanceof e?f:f instanceof p?this.lighting&&"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(f):new d(f.cloneConstructProperties()):f instanceof t?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(f):new e(f.cloneConstructProperties()):v.ensureOneOfType(m.lightingTypes,f):new d};y.clone=function(){return new q({lighting:this.lighting.clone(),atmosphere:this.atmosphere.clone(),
weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:c.clone(this.background)})};y.cloneWithWebsceneEnvironment=function(f){return new q({atmosphere:this.atmosphere.clone(),weather:this.weather.clone(),atmosphereEnabled:this.atmosphereEnabled,starsEnabled:this.starsEnabled,background:c.clone(this.background),...f.cloneConstructProperties(),lighting:this._getLighting(f)})};y._getLighting=function(f){return"sun"===f.lighting.type?this.lighting&&
"sun"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(f.lighting):d.fromWebsceneLighting(f.lighting):"virtual"===f.lighting.type?this.lighting&&"virtual"===this.lighting.type?this.lighting.cloneWithWebsceneLighting(f.lighting):e.fromWebsceneLighting(f.lighting):d.fromWebsceneLighting(f.lighting)};return r}(g);b.__decorate([n.property({type:h.SceneViewAtmosphere,json:{read:!1},nonNullable:!0})],g.prototype,"atmosphere",void 0);b.__decorate([n.property({nonNullable:!0})],g.prototype,"lighting",
void 0);b.__decorate([l.cast("lighting")],g.prototype,"castLighting",null);return g=q=b.__decorate([u.subclass("esri.views.3d.environment.SceneViewEnvironment")],g)})},"esri/views/3d/environment/lightingUtils":function(){define(["exports","./SunLighting","./VirtualLighting"],function(a,b,c){a.lightingTypes={key:"type",defaultKeyValue:"sun",base:null,typeMap:{sun:b,virtual:c}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SunLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/SunLighting".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;c=d=function(g){function p(q){q=g.call(this,q)||this;q.cameraTrackingEnabled=!0;q.ambientOcclusionEnabled=!1;q.waterReflectionEnabled=!1;q.positionTimezoneInfo={hours:0,minutes:0,seconds:0,autoUpdated:!0};var k=(new Date).getFullYear();k=new Date("March 15, "+k+" 12:00:00 UTC");q._set("defaultDate",k);q._set("date",k);return q}a._inheritsLoose(p,g);p.fromWebsceneLighting=function(q){return new d(q.cloneConstructProperties())};var t=p.prototype;t.autoUpdate=function(q,
k){const r=d.calculateTimezoneOffset(this.positionTimezoneInfo);this.positionTimezoneInfo.hours=k.hours;this.positionTimezoneInfo.minutes=k.minutes;this.positionTimezoneInfo.seconds=k.seconds;k=null;null!=q&&(this.positionTimezoneInfo.autoUpdated=!0,k=this.date&&this.date.getTime(),this._set("date",new Date(q.getTime())));const y=d.calculateTimezoneOffset(this.positionTimezoneInfo);r!==y&&(e.target=this,e.timezoneOffset=y,this.emit("timezone-will-change",e));if(null!=q)return k!==q.getTime()};t.clone=
function(){const q=this._get("date")===this._get("defaultDate"),k=new d({...this.cloneConstructProperties(),defaultDate:this.defaultDate,cameraTrackingEnabled:this.cameraTrackingEnabled,ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled});q&&k._set("date",k._get("defaultDate"));k.positionTimezoneInfo.autoUpdated=this.positionTimezoneInfo.autoUpdated;k.positionTimezoneInfo.hours=this.positionTimezoneInfo.hours;k.positionTimezoneInfo.minutes=this.positionTimezoneInfo.minutes;
k.positionTimezoneInfo.seconds=this.positionTimezoneInfo.seconds;return k};t.cloneWithWebsceneLighting=function(q){const k=this.clone();null!=q.date&&(k.date=q.date);k.directShadowsEnabled=q.directShadowsEnabled;k.displayUTCOffset=q.displayUTCOffset;return k};a._createClass(p,[{key:"defaultDate",get:function(){return new Date(this._get("defaultDate").getTime())},set:function(q){const k=this._get("date")===this._get("defaultDate");q=new Date(q.getTime());this._set("defaultDate",q);k&&this._set("date",
q)}},{key:"date",set:function(q){null!=q&&(this.positionTimezoneInfo.autoUpdated=!1,this._set("date",new Date(q.getTime())))}}]);return p}(c.EventedMixin(h));b.__decorate([n.property({type:Boolean})],c.prototype,"cameraTrackingEnabled",void 0);b.__decorate([n.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([n.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);b.__decorate([n.property({type:Date})],c.prototype,"defaultDate",null);b.__decorate([n.property({type:Date})],
c.prototype,"date",null);c=d=b.__decorate([m.subclass("esri.views.3d.environment.SunLighting")],c);(function(g){g.calculateTimezoneOffset=function({hours:p,minutes:t,seconds:q}){return Math.round(p+t/60+q/3600)}})(c||(c={}));const e={target:null,timezoneOffset:0};return c})},"esri/views/3d/environment/VirtualLighting":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Evented ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../webscene/VirtualLighting".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;c=d=function(e){function g(t){t=e.call(this,t)||this;t.ambientOcclusionEnabled=!1;t.waterReflectionEnabled=!1;return t}a._inheritsLoose(g,e);var p=g.prototype;p.clone=function(){return new d({...this.cloneConstructProperties(),ambientOcclusionEnabled:this.ambientOcclusionEnabled,waterReflectionEnabled:this.waterReflectionEnabled})};g.fromWebsceneLighting=function(t){return new d(t.cloneConstructProperties())};p.cloneWithWebsceneLighting=function(t){const q=this.clone();
q.directShadowsEnabled=t.directShadowsEnabled;return q};return g}(c.EventedMixin(h));b.__decorate([n.property({type:Boolean})],c.prototype,"ambientOcclusionEnabled",void 0);b.__decorate([n.property({type:Boolean})],c.prototype,"waterReflectionEnabled",void 0);return c=d=b.__decorate([m.subclass("esri.views.3d.environment.VirtualLighting")],c)})},"esri/views/3d/environment/SceneViewAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h){var d;a.SceneViewAtmosphere=d=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,e);g.prototype.clone=function(){return new d({quality:this.quality})};b._createClass(g,[{key:"quality",set:function(p){["low","high"].includes(p)&&this._set("quality",p)}}]);return g}(n);c.__decorate([l.property({type:["low","high"],value:"low"})],a.SceneViewAtmosphere.prototype,"quality",null);a.SceneViewAtmosphere=d=c.__decorate([h.subclass("esri.views.3d.environment.SceneViewAtmosphere")],
a.SceneViewAtmosphere);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SceneViewEnvironmentManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Evented ../../../core/Handles ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/support/spatialReferenceUtils ../../ViewingMode ./EnvironmentRenderer ../support/earthUtils ../support/sunUtils ../webgl-engine/lighting/Lightsources ../../../webscene/background/ColorBackground".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C){a.SceneViewEnvironmentManager=function(L){function R(){var J=L.call(this)||this;J._referencePointUpdateDelay=200;J._referencePointUpdateInterval=3E3;J._referencePointUpdateDistThreshold=1E6;J._referencePosUpdateQuery=null;J._referencePosMapCoordsRequested=null;J._viewHandles=new u;J._preserveAbsoluteDateTime=!1;J._trackingEnabled=!1;J._referencePosResetPreserveAbsoluteTime=!1;J._referencePosUpdateTimer=null;J._referencePosMapCoords=null;
J._mainLight=new B.MainLight;J._ambientLight=new B.AmbientLight;J._moonLight=new B.FillLight;J.disableQueries=!1;J._disableWeather=!1;J._renderer=null;J._referencePosWGS84Comparable=null;J._resetReferencePosition();return J}b._inheritsLoose(R,L);var M=R.prototype;M.destroy=function(){this.disconnectView();this._viewHandles.destroy()};M.connectView=function(J){if(!this._renderer){this._renderer=new z.EnvironmentRenderer({view:J});var I=()=>this._updateRenderParameters(),P=()=>this._cameraHandler(),
N=()=>this._updateLighting();this._viewHandles.add([h.watch(()=>J.environment.lighting,V=>this._updateLightingHandler(V),h.sync),h.watch(()=>"sun"===J.environment.lighting.type?J.environment.lighting.date:null,V=>this._lightingDateHandler(V),h.sync),h.watch(()=>J.stationary,()=>this._interactingStationaryHandler()),h.watch(()=>J.environment.lighting.directShadowsEnabled,I,h.sync),h.watch(()=>J.environment.lighting.ambientOcclusionEnabled,I,h.sync),h.watch(()=>J.environment.lighting.waterReflectionEnabled,
I,h.sync),h.watch(()=>{var V;return null==(V=J.environment.background)?void 0:V.color},I,h.sync),h.watch(()=>J.spatialReference,()=>this._resetReferencePosition(!0),h.sync),h.watch(()=>J.environment.weather.type,N,h.sync),h.watch(()=>this.weatherEnabled,N,h.sync),h.watch(()=>J.viewingMode,()=>this._resetReferencePosition(!0),h.syncAndInitial),h.watch(()=>"sun"===J.environment.lighting.type?J.environment.lighting.cameraTrackingEnabled:!1,V=>this._updateCameraTracking(V),h.syncAndInitial),h.watch(()=>
J.state.camera,P,h.syncAndInitial),h.watch(()=>this.disableQueries,P)]);this._updateRenderParameters();this._updateLighting();this._cameraHandler();this.notifyChange("updating")}};M.disconnectView=function(){this._viewHandles.removeAll();this._resetReferencePosition();this._renderer=v.destroyMaybe(this._renderer)};M._updateLightingHandler=function(J){this._updateCameraTracking("sun"===J.type?J.cameraTrackingEnabled:!1);this._lightingDateHandler("sun"===J.type?J.date:null);this._updateRenderParameters()};
M._updateCameraTracking=function(J){(this._trackingEnabled=J)?this._cameraHandler():(J=this._view.environment.lighting,"sun"===(null==J?void 0:J.type)&&(J.positionTimezoneInfo.autoUpdated=!1))};M._lightingDateHandler=function(J){const I=this._view.environment.lighting;if("virtual"===(null==I?void 0:I.type))this._updateLighting();else if(J){if(!I.positionTimezoneInfo.autoUpdated){this._preserveAbsoluteDateTime=!0;if(!y.canProjectToWGS84ComparableLonLat(this._view.spatialReference)){var P=this._view.camera.position;
if(!this._referencePosMapCoords||!this._referencePosMapCoords.equals(P)){this._requestReferencePositionUpdate(P);return}}this._preupdateTracking(J);v.isSome(this._referencePosWGS84Comparable)&&(P=A.positionToTimezoneInfo(this._referencePosWGS84Comparable,G),v.isSome(P)&&(I.autoUpdate(null,P),this._trackingEnabled&&(I.positionTimezoneInfo.autoUpdated=!0)))}this._updateLighting(J)}};M._preupdateTracking=function(J){!this._trackingEnabled&&"sun"===this._view.environment.lighting.type&&this._view.environment.lighting.cameraTrackingEnabled&&
this._cameraHandler(J)};M._cameraHandler=function(J=null){var I=this._view;I.ready&&(I=I.stateManager.camera)&&(this._cameraHandlerClientSide(I,J)||this._cameraHandlerServerSide(I))};M._cameraHandlerClientSide=function(J,I){const P=f.isEarth(this._view.spatialReference);if(P&&!y.canProjectToWGS84ComparableLonLat(this._view.spatialReference))return!1;J=J.position;v.isNone(this._referencePosWGS84Comparable)&&(this._referencePosWGS84Comparable=k.create());P?y.projectPointToWGS84ComparableLonLat(J,this._referencePosWGS84Comparable):
q.set(this._referencePosWGS84Comparable,J.longitude,J.latitude,J.z);this.notifyChange("referencePositionWGS84Comparable");this._autoUpdateTimezone(this._referencePosWGS84Comparable,I)||this._updateLighting(I);return!0};M._cameraHandlerServerSide=function(J){J=J.position;(!this._referencePosMapCoords||this._referencePosMapCoordsRequested||this._exceedsReferencePosDistThreshold(J))&&this._requestReferencePositionUpdate(J,!0);this._view.mapCoordsHelper&&this._referencePosWGS84Comparable&&(this._referencePosWGS84Comparable[2]=
J.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosChanged())};M._interactingStationaryHandler=function(){this._view.stationary&&this._executePendingReferencePositionUpdate()};M._updateLighting=function(J){const I=this._view;var P=J||("sun"===I.environment.lighting.type?I.environment.lighting.date:null),N=this._referencePosWGS84Comparable;J=v.isSome(N)?D:E;v.isSome(N)&&x.computeColorAndIntensity(P,N,I.state.viewingMode,this.weatherVisible?I.environment.weather.type:"disabled",I.state.camera,
I.environment.lighting.type,J);P=this._mainLight;N=J.direct;q.scale(P.intensity,N.color,N.intensity*Math.PI);q.copy(P.direction,N.directionToLightSource);P.specularStrength=J.specularStrength;P.environmentStrength=J.environmentStrength;const V=this._ambientLight;q.scale(V.intensity,J.ambient.color,J.ambient.intensity);const S=this._moonLight;q.lerp(S.intensity,O,K,J.globalFactor);q.scale(S.intensity,S.intensity,(1-.5*J.globalFactor)*(1-.4*J.noonFactor*(1-J.globalFactor)));q.copy(S.direction,N.directionToLightSource);
I._stage.renderView.updateLightSources([P,V,S],1-J.noonFactor,J.globalFactor);this._updateRenderParameters()};M._autoUpdateTimezone=function(J,I=null){if("virtual"===this._view.environment.lighting.type||!this._view.environment.lighting.cameraTrackingEnabled||v.isNone(J))return!1;const P=F;P.setTime((I||this._view.environment.lighting.date).getTime());J=A.positionToTimezoneInfo(J,G);if(v.isNone(J))return!1;var N=this._view.environment.lighting.positionTimezoneInfo;if(!N.autoUpdated)N=J;else if(N.hours===
J.hours&&N.minutes===J.minutes&&N.seconds===J.seconds)return!1;const V=P.getUTCHours()-(J.hours-N.hours),S=P.getUTCMinutes()-(J.minutes-N.minutes);N=P.getUTCSeconds()-(J.seconds-N.seconds);P.setUTCHours(V);P.setUTCMinutes(S);P.setUTCSeconds(N);return I?!1:this._view.environment.lighting.autoUpdate(P,J)};M._updateRenderParameters=function(){const J=this._view._stage;if(J){var I=v.mapOr(this._referencePosWGS84Comparable,!0,N=>x.computeShadowsEnabled(N[2],this._view.state.viewingMode)),P=this._view.environment.background;
P=P instanceof C?{type:"color",color:r.fromArray(n.toUnitRGBA(P.color))}:{type:"color",color:r.fromValues(0,0,0,1)};J.renderView.setRenderParameters({shadowMap:this._view.environment.lighting.directShadowsEnabled&&I,background:P,environment:this._view.environment,weatherVisible:this._view.environmentManager.weatherVisible})}};M._resetReferencePosition=function(J=!1){this._cancelReferencePosUpdates();this._referencePosWGS84Comparable=this._referencePosResetPreserveAbsoluteTime=this._referencePosMapCoordsRequested=
this._referencePosMapCoords=null;this.notifyChange("updating");J&&this._cameraHandler()};M._requestReferencePositionUpdate=function(J,I=!1){if(!this.disableQueries&&(this._referencePosMapCoordsRequested?this._referencePosMapCoordsRequested.copy(J):this._referencePosMapCoordsRequested=J.clone(),this._referencePosResetPreserveAbsoluteTime=!!I,!this._referencePosUpdateQuery&&!this._referencePosUpdateTimer&&this._view.stationary)){const P=this._referencePosUpdateQuery=m.after(this._referencePointUpdateDelay).then(()=>
{if(this._referencePosUpdateQuery===P)return this._doReferencePositionUpdateQuery(()=>this._referencePosUpdateQuery!==P)}).catch(V=>{"mapcoordshelper:missing-geometry-service"===V.name&&(this.disableQueries=!0)}).then(()=>{this._referencePosUpdateQuery===P&&(this._referencePosUpdateQuery=null,this._referencePosUpdateTimer||this._executePendingReferencePositionUpdate(),this.notifyChange("updating"))}),N=this._referencePosUpdateTimer=m.after(this._referencePointUpdateInterval).then(()=>{this._referencePosUpdateTimer===
N&&(this._referencePosUpdateTimer=null,this._referencePosUpdateQuery||this._executePendingReferencePositionUpdate())});this.notifyChange("updating")}};M._doReferencePositionUpdateQuery=function(){var J=b._asyncToGenerator(function*(I){this._referencePosResetPreserveAbsoluteTime&&(this._preserveAbsoluteDateTime=!1);this._referencePosMapCoords?this._referencePosMapCoords.copy(this._referencePosMapCoordsRequested):this._referencePosMapCoords=this._referencePosMapCoordsRequested.clone();this._referencePosMapCoordsRequested=
this._referencePosResetPreserveAbsoluteTime=null;const P=yield this._view.mapCoordsHelper.toGeographic(this._referencePosMapCoords);I()||isNaN(P[0])||isNaN(P[1])||(I=this._referencePosMapCoords.z*this._view.mapCoordsHelper.unitInMeters,this._referencePosWGS84Comparable?(this._referencePosWGS84Comparable[0]=P[0],this._referencePosWGS84Comparable[1]=P[1],this._referencePosWGS84Comparable[2]=I):this._referencePosWGS84Comparable=[P[0],P[1],I],this._referencePosChanged())});return function(I){return J.apply(this,
arguments)}}();M._executePendingReferencePositionUpdate=function(){const J=this._referencePosMapCoordsRequested;J&&this._requestReferencePositionUpdate(J,this._referencePosResetPreserveAbsoluteTime)};M._referencePosChanged=function(){this._preserveAbsoluteDateTime?this._updateLighting():this._autoUpdateTimezone(this._referencePosWGS84Comparable)||this._updateLighting();this.notifyChange("referencePositionWGS84Comparable")};M._exceedsReferencePosDistThreshold=function(J){return this._referencePosMapCoords?
(J=this._referencePosMapCoords.distance(J),this._view.mapCoordsHelper&&(J*=this._view.mapCoordsHelper.unitInMeters),J>this._referencePointUpdateDistThreshold):!0};M._cancelReferencePosUpdates=function(){const J=!!this._referencePosUpdateQuery;this._referencePosUpdateTimer=this._referencePosUpdateQuery=null;return J};b._createClass(R,[{key:"_view",get:function(){var J;return null==(J=this._renderer)?void 0:J.view}},{key:"updating",get:function(){var J;return!!(!this.disableQueries&&(this._referencePosUpdateQuery||
this._referencePosMapCoordsRequested)||null!=(J=this._renderer)&&J.updating)}},{key:"weatherEnabled",get:function(){var J,I,P;return(null==(J=this._view)?void 0:J.environment.atmosphereEnabled)&&!this._disableWeather&&(null==(I=this._view)?void 0:null==(P=I.state)?void 0:P.viewingMode)===w.ViewingMode.Global&&f.isEarth(this._view.spatialReference)}},{key:"weatherVisible",get:function(){var J;return this.weatherEnabled&&(null==(J=this._renderer)?void 0:J.weatherVisible)}},{key:"referencePositionWGS84Comparable",
get:function(){return this._referencePosWGS84Comparable}},{key:"test",get:function(){const J=this;return{get renderer(){return J._renderer},set referencePointUpdateInterval(I){J._referencePointUpdateInterval=I},set referencePointUpdateDistThreshold(I){J._referencePointUpdateDistThreshold=I},set referencePosUpdateTimer(I){J._referencePosUpdateTimer=I},set referencePointUpdateDelay(I){J._referencePointUpdateDelay=I},set disableWeather(I){J._disableWeather=I}}}}]);return R}(l.EventedAccessor);c.__decorate([d.property({type:Boolean,
readOnly:!0})],a.SceneViewEnvironmentManager.prototype,"updating",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"disableQueries",void 0);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_disableWeather",void 0);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"weatherEnabled",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"weatherVisible",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,
"referencePositionWGS84Comparable",null);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_renderer",void 0);c.__decorate([d.property()],a.SceneViewEnvironmentManager.prototype,"_referencePosWGS84Comparable",void 0);a.SceneViewEnvironmentManager=c.__decorate([t.subclass("esri.views.3d.environment.SceneViewEnvironmentManager")],a.SceneViewEnvironmentManager);const D=new x.ColorAndIntensity,E=new x.ColorAndIntensity,F=new Date,G={hours:0,minutes:0,seconds:0},O=k.fromValues(.22,.22,
.33),K=k.fromValues(.22,.22,.22);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/EnvironmentRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/has ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ./ChapmanAtmosphere ./CloudsComposition ./CloudsData ./CloudsGenerator ./CloudsPresets ./Fog ./PanoramicAtmosphere ./Precipitation ./SimpleAtmosphere ./Stars ./weather ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G){var O;const K=[G.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE,G.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT];a.EnvironmentRenderer=O=function(R){function M(I){I=R.call(this,I)||this;I._handles=new u;I._context=null;I._pendingAtmosphere=null;I._atmosphere=null;return I}b._inheritsLoose(M,R);var J=M.prototype;J.initialize=function(){this.view._stage.addRenderPlugin(K,this)};J.destroy=function(){var I;this._pendingAtmosphere=m.destroyMaybe(this._pendingAtmosphere);
null!=(null==(I=this.view)?void 0:I._stage)&&this.view._stage.removeRenderPlugin(this);this._handles=m.destroyMaybe(this._handles);this._set("view",null)};J.updateAnimation=function(I){return m.isSome(this._precipitation)?this._precipitation.update(I):!1};J.initializeRenderContext=function(I=null){this._context=I;this._handles.add([h.when(()=>{var P;return null==(P=this.view)?void 0:P.basemapTerrain},()=>this._updateBasemapTerrain(),h.syncAndInitial),h.watch(()=>({viewingMode:this.view.viewingMode,
atmosphereEnabled:this.view.environment.atmosphereEnabled,atmosphereQuality:this.view.environment.atmosphere.quality}),()=>this._updateAtmosphere(),h.syncAndInitial),h.watch(()=>this._stars,()=>this._setNeedsRender()),h.watch(()=>this._clouds,()=>this._updateWeather(this._weatherUpdateParameters),h.initial),h.watch(()=>this._precipitation,()=>this._setNeedsRender()),h.watch(()=>this._fog,()=>this._updateFog(this._weatherUpdateParameters),h.initial),h.watch(()=>this._weatherUpdateParameters,P=>{this._updateWeather(P);
this._updateFog(P)},h.syncAndInitial)])};J.uninitializeRenderContext=function(){this._context=null;this._atmosphere=m.destroyMaybe(this._atmosphere);this._set("_stars",m.destroyMaybe(this._stars));this._set("_precipitation",m.destroyMaybe(this._precipitation));this._set("_clouds",m.destroyMaybe(this._clouds));this._set("_cloudsComposition",m.destroyMaybe(this._cloudsComposition));this._set("_fog",m.destroyMaybe(this._fog))};J.prepareRender=function(I){I.bindParameters.clouds.data=f.isReadyCloudsData(this._clouds)?
this._clouds:null};J.render=function(I){if(I.pass===F.RenderPass.MATERIAL)switch(I.bindParameters.slot){case G.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE:m.isSome(this._stars)&&this._stars.render(I);m.isSome(this._atmosphere)&&this._atmosphere.canRender&&(this._atmosphere.render(I),m.isSome(this._cloudsComposition)&&m.isSome(I.bindParameters.clouds.data)&&(this.weatherVisible&&m.isSome(this._clouds)&&this._clouds.ensureWeatherTile(),this._cloudsComposition.render(I,m.isSome(this.view.animation))));
break;case G.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT:if(m.isSome(this._atmosphere)&&this._atmosphere.canRender){var P=this.weatherEnabled?this.view.environment.weather.type:"disabled";this._atmosphere.renderHaze(I,"rainy"===P);if(m.isSome(this._fog)){const N="foggy"===P||"rainy"===P||"snowy"===P;(N||"realistic"!==this._selectAtmosphereType())&&this._fog.render(I,N,"rainy"===P)}m.isSome(this._precipitation)&&(P=this.view.environment.weather,"rainy"!==P.type&&"snowy"!==P.type||this._precipitation.render(I,
P.precipitation,P.type))}}};J._updateWeather=function(I){m.isNone(I)||m.isNone(this._clouds)||(this._clouds.applyPreset(z.cloudPresets[I.type],I.weatherAdjustment),this._setNeedsRender())};J._setNeedsRender=function(){m.isSome(this._context)&&this._context.requestRender()};J._updateFog=function(I){if(!m.isNone(this._fog)&&!m.isNone(I))switch(I.type){case "foggy":this._fog.strength=v.lerp(3E-5,.005,I.weatherAdjustment**3);this._setNeedsRender();break;case "rainy":case "snowy":this._fog.strength=v.lerp(4E-6,
2E-4,I.effect**3);this._setNeedsRender();break;default:this._fog.strength=4E-6,this._setNeedsRender()}};J._updateAtmosphere=function(){var I=this._selectAtmosphereType();if(this.atmosphereType!==I)if(m.isSome(this._pendingAtmosphere)&&(this._pendingAtmosphere!==this._atmosphere&&this._pendingAtmosphere.destroy(),this._pendingAtmosphere=null),I=this._getAtmosphereClass()){var P=new I(this.view);m.isSome(this._context)&&P.initializeRenderContext(this._context);m.isNone(this._atmosphere)&&(this._atmosphere=
P,this._setNeedsRender());this._pendingAtmosphere=P;P.when().then(()=>{m.isSome(this._atmosphere)&&this._pendingAtmosphere&&this._pendingAtmosphere!==this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=this._pendingAtmosphere);this._pendingAtmosphere=null;this._setNeedsRender();this._updateBasemapTerrain()}).catch(()=>{this._pendingAtmosphere===P&&(this._pendingAtmosphere=null)})}else m.isSome(this._atmosphere)&&(this._atmosphere.destroy(),this._atmosphere=null,this._setNeedsRender()),
this._updateBasemapTerrain()};J._getAtmosphereClass=function(){switch(this._selectAtmosphereType()){case "none":return null;case "realistic":return r.ChapmanAtmosphere;case "panoramic":return x.PanoramicAtmosphere;case "simple":return C}};J._selectAtmosphereType=function(){const I=this.view.get("environment.atmosphereEnabled"),P=this.view.get("environment.atmosphere.quality"),N=this.view.viewingMode;return!I||null==P||k.isMoon(this.view.spatialReference)?"none":"local"===N?"panoramic":"high"===P&&
m.isSome(this._context)&&r.ChapmanAtmosphere.isSupported(this._context)&&k.isEarth(this.view.spatialReference)?"realistic":"simple"};J._updateBasemapTerrain=function(){this.view.basemapTerrain&&(this.view.basemapTerrain.velvetOverground=m.isSome(this._atmosphere)&&"simple"===this.atmosphereType)};b._createClass(M,[{key:"atmosphereType",get:function(){return m.isSome(this._pendingAtmosphere)?this._pendingAtmosphere.type:m.isSome(this._atmosphere)?this._atmosphere.type:"none"}},{key:"canRender",get:function(){var I;
return!(null==(I=this.view.basemapTerrain)||!I.renderer.canRender)||"global"!==this.view.viewingMode}},{key:"needsLinearDepth",get:function(){return"realistic"===this._selectAtmosphereType()}},{key:"updating",get:function(){return m.isSome(this._pendingAtmosphere)||m.isSome(this._stars)&&this._stars.updating||m.isSome(this._clouds)&&this._clouds.running}},{key:"weatherVisible",get:function(){return t.length(this.view.state.camera.eye)-q.getReferenceEllipsoid(this.view.spatialReference).radius<=E.weatherHeightLimit}},
{key:"_stars",get:function(){var I,P;const N=this.view,V=null!=(I=null==(P=N.environment)?void 0:P.starsEnabled)?I:!1;I=this._get("_stars");return!V||m.isNone(this._context)?(m.destroyMaybe(I),null):m.isSome(I)?I:new D.Stars({view:N,requestRender:()=>this._setNeedsRender()})}},{key:"_precipitation",get:function(){const I=this._get("_precipitation");if(!this._precipitationEnabled||m.isNone(this._context))return m.destroyMaybe(I),null;const P=this.view,N=this._context;if(m.isSome(I)&&I.context===N)return I;
m.destroyMaybe(I);return new B.Precipitation({context:N,view:P})}},{key:"_clouds",get:function(){const I=this._get("_clouds");if(!this.weatherEnabled||m.isNone(this._context))return m.destroyMaybe(I),null;if(m.isSome(I))return I;const P=this.view,N=this._context;m.destroyMaybe(I);return new w.CloudsGenerator({context:N,view:P,requestRender:()=>this._setNeedsRender()})}},{key:"_cloudsComposition",get:function(){const I=this._get("_cloudsComposition");if(!this.weatherEnabled||m.isNone(this._context))return m.destroyMaybe(I),
null;const P=this.view.state.viewingMode,N=this._context.renderContext.rctx,V=q.getReferenceEllipsoid(this.view.spatialReference).radius;if(m.isSome(I)&&I.viewingMode===P&&I.planetRadius===V)return I;m.destroyMaybe(I);return new y.CloudsComposition({rctx:N,viewingMode:P,planetRadius:V,requestRender:()=>this._setNeedsRender()})}},{key:"_fog",get:function(){const I=this._get("_fog");if(!this.weatherEnabled||m.isNone(this._context))return m.destroyMaybe(I),null;if(m.isSome(I))return I;const P=this.view,
N=this._context;m.destroyMaybe(I);return new A.Fog({context:N,view:P})}},{key:"weatherEnabled",get:function(){var I,P;return!(null==(I=this.view)||null==(P=I.environmentManager)||!P.weatherEnabled)}},{key:"_precipitationEnabled",get:function(){return this.weatherEnabled&&("rainy"===this.view.environment.weather.type||"snowy"===this.view.environment.weather.type)}},{key:"_weatherUpdateParameters",get:function(){const I=this.weatherEnabled?this.view.environment.weather:null;return m.isNone(I)?null:
"rainy"===I.type||"snowy"===I.type?{type:I.type,weatherAdjustment:I.cloudCover,effect:I.precipitation}:{type:I.type,weatherAdjustment:"foggy"===I.type?I.fogStrength:I.cloudCover}}},{key:"test",get:function(){return{atmosphere:this._atmosphere,clouds:this._clouds,selectAtmosphereType:()=>this._selectAtmosphereType(),stubGetAtmosphereClass:I=>{L=O.prototype._getAtmosphereClass;O.prototype._getAtmosphereClass=I},restoreGetAtmosphereClass:()=>{O.prototype._getAtmosphereClass=L}}}}]);return M}(n);c.__decorate([d.property({constructOnly:!0})],
a.EnvironmentRenderer.prototype,"view",void 0);c.__decorate([d.property({type:Boolean,readOnly:!0})],a.EnvironmentRenderer.prototype,"updating",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherVisible",null);c.__decorate([d.property()],a.EnvironmentRenderer.prototype,"_context",void 0);c.__decorate([d.property()],a.EnvironmentRenderer.prototype,"_pendingAtmosphere",void 0);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_stars",null);
c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_precipitation",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_clouds",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_cloudsComposition",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_fog",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"weatherEnabled",null);c.__decorate([d.property({readOnly:!0})],
a.EnvironmentRenderer.prototype,"_precipitationEnabled",null);c.__decorate([d.property({readOnly:!0})],a.EnvironmentRenderer.prototype,"_weatherUpdateParameters",null);a.EnvironmentRenderer=O=c.__decorate([p.subclass("esri.views.3d.environment.EnvironmentRenderer")],a.EnvironmentRenderer);let L;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphere":function(){define("exports ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/Ellipsoid ./atmosphereUtils ./ChapmanAtmosphereTechnique ./ChapmanAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){let f=function(){function z(x){this._view=x;this.type="realistic";this.canRender=!0;this._cameraPosition=h.create();this._heightParameters=d.create();this._betasRayleigh=h.create();this._betasCombined=h.create();this._scaleHeight=0;this._radii=v.create();this._lowerElevationBoundRadius=this._altitudeFade=this._innerFadeDistance=this._cAtmosphere=this._cameraHeightSq=this._cameraHeight=0;this._lowerBoundEarthRadius=e.earth.radius;this._hazeStrength=1;this._darkenHaze=
!1;this._updateRadius(e.earth.radius)}var A=z.prototype;A.destroy=function(){this._atmosphereTechnique=n.releaseMaybe(this._atmosphereTechnique);this._atmosphereHazeTechnique=n.releaseMaybe(this._atmosphereHazeTechnique);this._vao=n.disposeMaybe(this._vao);this._handles=n.destroyMaybe(this._handles)};A.when=function(){return Promise.resolve()};A.initializeRenderContext=function(x){const B=x.renderContext.rctx;var C=this._handles=new b;const D=this._view.basemapTerrain;n.isSome(D.rootTiles)&&this._updateElevation({spatialReference:D.spatialReference,
tile:D.rootTiles[0],extent:D.rootTiles[0].extent,context:"ground"});C.add(l.on(()=>this._view.basemapTerrain,"elevation-change",E=>this._updateElevation(E),{onListenerAdd:()=>this._updateElevation()}));C.add(l.on(()=>this._view.basemapTerrain,"elevation-bounds-change",()=>this._updateVisibleElevationBounds()));C=new t.ChapmanAtmosphereTechniqueConfiguration;C.haze=!1;this._atmosphereTechnique=x.shaderTechniqueRepository.acquire(p.ChapmanAtmosphereTechnique,C);C.haze=!0;this._atmosphereHazeTechnique=
x.shaderTechniqueRepository.acquire(p.ChapmanAtmosphereTechnique,C);this._vao=r.createQuadVAO(B,k.Pos2Tex);this._scaleHeight=g.rayLeighScaleHeight*g.atmosphereHeight;m.set(this._betasRayleigh,g.betaRayleigh[0],g.betaRayleigh[1],g.betaRayleigh[2]);m.set(this._betasCombined,g.betaRayleigh[0]+g.betaOzone[0],g.betaRayleigh[1]+g.betaOzone[1],g.betaRayleigh[2]+g.betaOzone[2])};A.render=function(x){this._render(x,this._atmosphereTechnique,x.offscreenRenderingHelper.depthTexture)};A.renderHaze=function(x,
B){this._darkenHaze=B;this._render(x,this._atmosphereHazeTechnique,x.offscreenRenderingHelper.linearDepthTexture)};A._render=function(x,B,C){this._update(x.bindParameters.camera);const D=x.rctx.bindTechnique(B,w,x.bindParameters);x.offscreenRenderingHelper.renderDepthDetached(()=>{D.bindTexture("depthTex",C);this._renderCommon(B.program,x)})};A._renderCommon=function(x,B){n.isNone(this._vao)||(B=B.rctx,x.setUniform4fv("heightParameters",this._heightParameters),x.setUniform3fv("cameraPosition",this._cameraPosition),
x.setUniform2fv("radii",this._radii),x.setUniform1f("scaleHeight",this._scaleHeight),x.setUniform1f("betaMie",g.betaMie),x.setUniform3fv("betaRayleigh",this._betasRayleigh),x.setUniform3fv("betaCombined",this._betasCombined),x.setUniform1f("innerFadeDistance",this._innerFadeDistance),x.setUniform1f("altitudeFade",this._altitudeFade),x.setUniform1f("hazeStrength",this._hazeStrength),B.bindVAO(this._vao),x.assertCompatibleVertexAttributeLocations(this._vao),B.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,
0,4))};A._adjustRadiusForTesselation=function(x){return x*Math.cos(Math.PI/16/16)};A._updateElevation=function(x){x=x?x.tile:n.unwrapOr(this._view.basemapTerrain.rootTiles,[null])[0];n.isNone(x)||0!==x.level||(x=this._adjustRadiusForTesselation(e.earth.radius+x.elevationBounds[0]),x!==this._lowerElevationBoundRadius&&(this._lowerElevationBoundRadius=x,this._lowerBoundEarthRadius=-1,this._updateVisibleElevationBounds()))};A._updateVisibleElevationBounds=function(){const x=this._adjustRadiusForTesselation(e.earth.radius+
this._view.basemapTerrain.elevationBounds.min);(0>this._lowerBoundEarthRadius||x<this._lowerBoundEarthRadius)&&this._updateRadius(x)};A._updateRadius=function(x){this._lowerBoundEarthRadius=x;u.set(this._radii,x,x+g.atmosphereHeight);this._innerFadeDistance=2*Math.sqrt((2*x-g.innerAtmosphereDepth)*g.innerAtmosphereDepth)};A._update=function(x){n.isNone(x)||(this._cameraHeight=m.length(x.eye),this._cameraHeightSq=this._cameraHeight*this._cameraHeight,this._cAtmosphere=this._cameraHeightSq-this._radii[1]*
this._radii[1],this._heightParameters=d.fromValues(this._cameraHeight,this._cameraHeightSq,this._cAtmosphere,Math.min(1,Math.max(0,(this._cameraHeight-this._radii[0])/g.atmosphereHeight))),m.copy(this._cameraPosition,x.eye),this._altitudeFade=g.computeInnerAltitudeFade(this._cameraHeight-this._lowerBoundEarthRadius),this._hazeStrength=this._darkenHaze?c.lerp(.6,1,c.smoothstep(9500,10500,this._cameraHeight-e.earth.radius)):1)};z.isSupported=function(x){return x.renderContext.rctx.capabilities.depthTexture};
return z}();const w=new q.NoParameters;a.ChapmanAtmosphere=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec2":function(){define(["exports","./common"],function(a,b){function c(N,V){N[0]=V[0];N[1]=V[1];return N}function n(N,V,S){N[0]=V;N[1]=S;return N}function l(N,V,S){N[0]=V[0]+S[0];N[1]=V[1]+S[1];return N}function u(N,V,S){N[0]=V[0]-S[0];N[1]=V[1]-S[1];return N}function v(N,V,S){N[0]=V[0]*S[0];N[1]=V[1]*S[1];return N}function m(N,V,S){N[0]=
V[0]/S[0];N[1]=V[1]/S[1];return N}function h(N,V){N[0]=Math.ceil(V[0]);N[1]=Math.ceil(V[1]);return N}function d(N,V){N[0]=Math.floor(V[0]);N[1]=Math.floor(V[1]);return N}function e(N,V,S){N[0]=Math.min(V[0],S[0]);N[1]=Math.min(V[1],S[1]);return N}function g(N,V,S){N[0]=Math.max(V[0],S[0]);N[1]=Math.max(V[1],S[1]);return N}function p(N,V){N[0]=Math.round(V[0]);N[1]=Math.round(V[1]);return N}function t(N,V,S){N[0]=V[0]*S;N[1]=V[1]*S;return N}function q(N,V,S,T){N[0]=V[0]+S[0]*T;N[1]=V[1]+S[1]*T;return N}
function k(N,V){const S=V[0]-N[0];N=V[1]-N[1];return Math.sqrt(S*S+N*N)}function r(N,V){const S=V[0]-N[0];N=V[1]-N[1];return S*S+N*N}function y(N){const V=N[0];N=N[1];return Math.sqrt(V*V+N*N)}function f(N){const V=N[0];N=N[1];return V*V+N*N}function w(N,V){N[0]=-V[0];N[1]=-V[1];return N}function z(N,V){N[0]=1/V[0];N[1]=1/V[1];return N}function A(N,V){var S=V[0];const T=V[1];S=S*S+T*T;0<S&&(S=1/Math.sqrt(S),N[0]=V[0]*S,N[1]=V[1]*S);return N}function x(N,V){return N[0]*V[0]+N[1]*V[1]}function B(N,
V,S){V=V[0]*S[1]-V[1]*S[0];N[0]=N[1]=0;N[2]=V;return N}function C(N,V,S,T){const H=V[0];V=V[1];N[0]=H+T*(S[0]-H);N[1]=V+T*(S[1]-V);return N}function D(N,V){V=V||1;const S=2*b.RANDOM()*Math.PI;N[0]=Math.cos(S)*V;N[1]=Math.sin(S)*V;return N}function E(N,V,S){const T=V[0];V=V[1];N[0]=S[0]*T+S[2]*V;N[1]=S[1]*T+S[3]*V;return N}function F(N,V,S){const T=V[0];V=V[1];N[0]=S[0]*T+S[2]*V+S[4];N[1]=S[1]*T+S[3]*V+S[5];return N}function G(N,V,S){const T=V[0];V=V[1];N[0]=S[0]*T+S[3]*V+S[6];N[1]=S[1]*T+S[4]*V+S[7];
return N}function O(N,V,S){const T=V[0];V=V[1];N[0]=S[0]*T+S[4]*V+S[12];N[1]=S[1]*T+S[5]*V+S[13];return N}function K(N,V,S,T){const H=V[0]-S[0];V=V[1]-S[1];const U=Math.sin(T);T=Math.cos(T);N[0]=H*T-V*U+S[0];N[1]=H*U+V*T+S[1];return N}function L(N,V){var S=N[0];N=N[1];const T=V[0];V=V[1];let H=S*S+N*N;0<H&&(H=1/Math.sqrt(H));let U=T*T+V*V;0<U&&(U=1/Math.sqrt(U));S=(S*T+N*V)*H*U;return 1<S?0:-1>S?Math.PI:Math.acos(S)}function R(N){return"vec2("+N[0]+", "+N[1]+")"}function M(N,V){return N[0]===V[0]&&
N[1]===V[1]}function J(N,V){const S=N[0];N=N[1];const T=V[0];V=V[1];return Math.abs(S-T)<=b.EPSILON*Math.max(1,Math.abs(S),Math.abs(T))&&Math.abs(N-V)<=b.EPSILON*Math.max(1,Math.abs(N),Math.abs(V))}function I(N,V,S,T,H){let U=V[0]-S[0];S=V[1]-S[1];H=(T[0]*U+T[1]*S)*(H-1);U=T[0]*H;S=T[1]*H;N[0]=V[0]+U;N[1]=V[1]+S;return N}const P=Object.freeze(Object.defineProperty({__proto__:null,copy:c,set:n,add:l,subtract:u,multiply:v,divide:m,ceil:h,floor:d,min:e,max:g,round:p,scale:t,scaleAndAdd:q,distance:k,
squaredDistance:r,length:y,squaredLength:f,negate:w,inverse:z,normalize:A,dot:x,cross:B,lerp:C,random:D,transformMat2:E,transformMat2d:F,transformMat3:G,transformMat4:O,rotate:K,angle:L,str:R,exactEquals:M,equals:J,projectAndScale:I,len:y,sub:u,mul:v,div:m,dist:k,sqrDist:r,sqrLen:f},Symbol.toStringTag,{value:"Module"}));a.add=l;a.angle=L;a.ceil=h;a.copy=c;a.cross=B;a.dist=k;a.distance=k;a.div=m;a.divide=m;a.dot=x;a.equals=J;a.exactEquals=M;a.floor=d;a.inverse=z;a.len=y;a.length=y;a.lerp=C;a.max=g;
a.min=e;a.mul=v;a.multiply=v;a.negate=w;a.normalize=A;a.projectAndScale=I;a.random=D;a.rotate=K;a.round=p;a.scale=t;a.scaleAndAdd=q;a.set=n;a.sqrDist=r;a.sqrLen=f;a.squaredDistance=r;a.squaredLength=f;a.str=R;a.sub=u;a.subtract=u;a.transformMat2=E;a.transformMat2d=F;a.transformMat3=G;a.transformMat4=O;a.vec2=P})},"esri/views/3d/environment/atmosphereUtils":function(){define(["exports","../../../chunks/vec3f64"],function(a,b){const c=b.fromValues(5.802E-6,1.3558E-5,3.31E-5);b=b.fromValues(1.95E-6,
5.643E-6,2.55E-7);a.atmosphereHeight=1E5;a.betaMie=3.996E-6;a.betaOzone=b;a.betaRayleigh=c;a.computeInnerAltitudeFade=function(n){return Math.min(1,Math.max(0,(n-1E5)/9E5))};a.innerAtmosphereDepth=1E4;a.rayLeighScaleHeight=.085;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/ChapmanAtmosphere.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d){u=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);var p=g.prototype;p.initializeProgram=function(t){const q=g.shader.get().build(this.configuration);return new m.Program(t.rctx,q,v.Default3D)};p.initializePipeline=function(){return this.configuration.haze?d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ONE_MINUS_SRC_COLOR,h.BlendFactor.ONE),colorWrite:d.defaultColorWriteParams}):
d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return g}(u.ShaderTechnique);u.shader=new l.ReloadableShaderModule(n.ChapmanAtmosphereShader,()=>new Promise((e,g)=>a(["./ChapmanAtmosphere.glsl"],e,g)));b.ChapmanAtmosphereTechnique=u;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/ChapmanAtmosphere.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){function y(w){const z=new q.ShaderBuilder;z.attributes.add(r.VertexAttribute.POSITION,"vec2");z.include(n.TextureCoordinateAttribute,{textureCoordinateType:n.TextureCoordinateAttributeType.Default});z.varyings.add("worldRay","vec3");z.varyings.add("eyeDir","vec3");const {vertex:A,fragment:x}=z;A.uniforms.add([new t.Matrix4PassUniform("inverseProjectionMatrix",(B,C)=>C.camera.inverseProjectionMatrix),new t.Matrix4PassUniform("inverseViewMatrix",(B,C)=>b.invert(f,
C.camera.viewMatrix))]);A.code.add(p.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);x.uniforms.add([new h.Float3PassUniform("lightingMainDirection",(B,C)=>C.lighting.lightingMainDirection),new m.Float2Uniform("radii"),new g.FloatUniform("scaleHeight"),new d.Float3Uniform("cameraPosition"),new e.Float4Uniform("heightParameters"),new g.FloatUniform("innerFadeDistance"),new g.FloatUniform("altitudeFade"),new k.Texture2DUniform("depthTex"),new d.Float3Uniform("betaRayleigh"),new d.Float3Uniform("betaCombined"),new g.FloatUniform("betaMie"),new g.FloatUniform("hazeStrength")]);z.include(u.Gamma);
w.haze&&(x.include(l.ReadLinearDepth),x.uniforms.add(new v.Float2PassUniform("nearFar",(B,C)=>C.camera.nearFar)));x.code.add(p.glsl`vec2 sphereIntersect(vec3 start, vec3 dir, float radius, bool planet) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = planet ? heightParameters[1] - radius * radius : heightParameters[2];
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);x.code.add(p.glsl`float chapmanApproximation(float X, float h, float cosZenith) {
float c = sqrt(X + h);
float cExpH = c * exp(-h);
if (cosZenith >= 0.0) {
return cExpH / (c * cosZenith + 1.0);
} else {
float x0 = sqrt(1.0 - cosZenith * cosZenith) * (X + h);
float c0 = sqrt(x0);
return 2.0 * c0 * exp(X - x0) - cExpH / (1.0 - c * cosZenith);
}
}`);x.code.add(p.glsl`float getOpticalDepth(vec3 position, vec3 dir, float h) {
return scaleHeight * chapmanApproximation(radii[0] / scaleHeight, h, dot(normalize(position), dir));
}`);x.code.add(p.glsl`
    const int STEPS = 6;

    float getGlow(float dist, float radius, float intensity) {
      return pow(radius / max(dist, 1e-6), intensity);
    }

    vec3 getAtmosphereColour(vec3 cameraPos, vec3 rayDir, vec3 lightDir, float terrainDepth) {
      float reducedPlanetRadius = radii[0] - 20000.0;
      vec2 rayPlanetIntersect = sphereIntersect(cameraPos, rayDir, reducedPlanetRadius, true);
      vec2 rayAtmosphereIntersect = sphereIntersect(cameraPos, rayDir, radii[1], false);
      bool hitsAtmosphere = (rayAtmosphereIntersect.x <= rayAtmosphereIntersect.y) && rayAtmosphereIntersect.x > 0.0;
      bool insideAtmosphere = heightParameters[0] < radii[1];

      if (!(hitsAtmosphere || insideAtmosphere)) {
        return vec3(0);
      }

      bool hitsPlanet = (rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.x > 0.0;

      float start = insideAtmosphere ? 0.0 : rayAtmosphereIntersect.x;

      if (heightParameters[0] < reducedPlanetRadius) {
        // Long light rays from the night side of the planet lead to numerical instability
        // Do not render the atmosphere in such cases
        if (dot(rayDir, normalize(cameraPos)) < -0.025) {
          return vec3(0);
        }
        start = rayPlanetIntersect.y;
      }

      float end = hitsPlanet ? rayPlanetIntersect.x : rayAtmosphereIntersect.y;
      float maxEnd = end;

      ${w.haze?p.glsl`if (terrainDepth != -1.0) { end = terrainDepth; }`:""}

      vec3 samplePoint = cameraPos + rayDir * end;
      float multiplier = hitsPlanet ? -1.0 : 1.0;

      vec3 scattering = vec3(0);
      float scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
      float lastOpticalDepth = getOpticalDepth(samplePoint, rayDir, scaleFract);
      float stepSize = (end - start) / float(STEPS);
      for (int i = 0; i < STEPS; i++) {
        samplePoint -= stepSize * rayDir;
        scaleFract = (length(samplePoint) - radii[0]) / scaleHeight;
        float opticalDepth = multiplier * getOpticalDepth(samplePoint, rayDir * multiplier, scaleFract);

        if (i > 0) {
          scattering *= ${w.haze?p.glsl``:" mix(2.5, 1.0, clamp((length(cameraPos) - radii[0]) / 50e3, 0.0, 1.0)) * "} exp(-(mix(betaCombined, betaRayleigh, 0.5) + betaMie) * max(0.0, (opticalDepth - lastOpticalDepth)));
        }

        if (dot(normalize(samplePoint), lightDir) > -0.3) {

          float scale = exp(-scaleFract);
          float lightDepth = getOpticalDepth(samplePoint, lightDir, scaleFract);

          scattering += scale * exp(-(betaCombined + betaMie) * lightDepth);
          ${w.haze?"":p.glsl`scattering += scale * exp(-(0.25 * betaCombined ) * lightDepth);`}
        }

        lastOpticalDepth = opticalDepth;

      }

      float mu = dot(rayDir, lightDir);
      float mumu = 1.0 + mu * mu;

      float phaseRayleigh = 0.05968310365 * mumu;

      ${w.haze?p.glsl`return 3.0 * scattering * stepSize * phaseRayleigh * betaRayleigh;`:p.glsl`
            const float g = 0.8;
            const float gg = g * g;
            float phaseMie = end == maxEnd ? 0.11936620731 * ((1.0 - gg) * mumu) / (pow(1.0 + gg - 2.0 * mu * g, 1.5) * (2.0 + gg)) : 0.0;
            phaseMie += getGlow(1.0 - mu, 5e-5, 3.0) * smoothstep(0.01, 0.1, length(scattering));
            phaseMie = clamp(phaseMie, 0.0, 128.0);
            return 3.0 * scattering * stepSize * (phaseRayleigh * betaRayleigh + 0.025 * phaseMie * betaMie);`}
    }

    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    vec4 applyUndergroundAtmosphere(vec3 rayDir, vec3 lightDirection, vec4 fragColor) {
      vec2 rayPlanetIntersect = sphereIntersect(cameraPosition, rayDir, radii[0], true);
      if (!((rayPlanetIntersect.x <= rayPlanetIntersect.y) && rayPlanetIntersect.y > 0.0)) {
        return fragColor;
      }

      float lightAngle = dot(lightDirection, normalize(cameraPosition + rayDir * max(0.0, rayPlanetIntersect.x)));
      vec4 surfaceColor = vec4(vec3(max(0.0, (smoothstep(-1.0, 0.8, 2.0 * lightAngle)))), 1.0 - altitudeFade);
      float relDist = (rayPlanetIntersect.y - max(0.0, rayPlanetIntersect.x)) / innerFadeDistance;
      if (relDist > 1.0) {
        return surfaceColor;
      }

      return mix(gl_FragColor, surfaceColor, smoothstep(0.0, 1.0, relDist * relDist));
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;
      ${w.haze?p.glsl`
          vec4 depthSample = texture2D(depthTex, vuv0).rgba;
          if (depthSample != vec4(0)) {
            vec3 cameraSpaceRay = normalize(eyeDir);
            cameraSpaceRay /= cameraSpaceRay.z;
            cameraSpaceRay *= -linearDepthFromTexture(depthTex, vuv0, nearFar);
            terrainDepth = max(0.0, length(cameraSpaceRay));
          }`:p.glsl`
          float depthSample = texture2D(depthTex, vuv0).r;
          if (depthSample != 1.0) {
            gl_FragColor = vec4(0);
            return;
          }`}

      ${w.haze?p.glsl`
            vec3 col = vec3(0);
            float fadeOut = smoothstep(-10000.0, -15000.0, heightParameters[0] - radii[0]);
            if(depthSample != vec4(0)){
              col = (1.0 - fadeOut) * hazeStrength * getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);
            }
            float alpha = 1.0 - fadeOut;`:p.glsl`
            vec3 col = getAtmosphereColour(cameraPosition, rayDir, lightingMainDirection, terrainDepth);;
            float alpha = smoothstep(0.0, mix(0.15, 0.01, heightParameters[3]), length(col));`}
      col = tonemapACES(col);
      gl_FragColor = delinearizeGamma(vec4(col, alpha));
      ${w.haze?"":p.glsl`
          if (depthSample == 1.0) {
            gl_FragColor = applyUndergroundAtmosphere(rayDir, lightingMainDirection, gl_FragColor);
          }`}
    }
  `);return z}const f=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ChapmanAtmosphereShader=c;a.build=y})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,n){a.TextureCoordinateAttributeType=void 0;(function(l){l[l.None=0]="None";l[l.Default=
1]="Default";l[l.Atlas=2]="Atlas";l[l.COUNT=3]="COUNT"})(a.TextureCoordinateAttributeType||(a.TextureCoordinateAttributeType={}));a.TextureCoordinateAttribute=function(l,u){switch(u.textureCoordinateType){case a.TextureCoordinateAttributeType.Default:l.attributes.add(n.VertexAttribute.UV0,"vec2");l.varyings.add("vuv0","vec2");l.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
}`);break;case a.TextureCoordinateAttributeType.Atlas:l.attributes.add(n.VertexAttribute.UV0,"vec2");l.varyings.add("vuv0","vec2");l.attributes.add(n.VertexAttribute.UVREGION,"vec4");l.varyings.add("vuvRegion","vec4");l.vertex.code.add(c.glsl`void forwardTextureCoordinates() {
vuv0 = uv0;
vuvRegion = uvRegion;
}`);break;case a.TextureCoordinateAttributeType.None:l.vertex.code.add(c.glsl`void forwardTextureCoordinates() {}`);break;default:b.neverReached(u.textureCoordinateType);case a.TextureCoordinateAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/interfaces":function(){define(["exports"],function(a){function b(c,...n){let l="";for(let u=0;u<n.length;u++)l+=c[u]+n[u];return l+=c[c.length-1]}
(function(c){c.int=function(n){return Math.round(n).toString()};c.float=function(n){return n.toPrecision(8)}})(b||(b={}));a.NoParameters=function(){};a.glsl=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/VertexAttribute":function(){define(["exports"],function(a){a.VertexAttribute=void 0;var b=a.VertexAttribute||(a.VertexAttribute={});b.POSITION="position";b.NORMAL="normal";b.UV0="uv0";b.AUXPOS1="auxpos1";b.AUXPOS2="auxpos2";
b.MAPPOS="mapPos";b.COLOR="color";b.SYMBOLCOLOR="symbolColor";b.SIZE="size";b.TANGENT="tangent";b.OFFSET="offset";b.SUBDIVISIONFACTOR="subdivisionFactor";b.COLORFEATUREATTRIBUTE="colorFeatureAttribute";b.SIZEFEATUREATTRIBUTE="sizeFeatureAttribute";b.OPACITYFEATUREATTRIBUTE="opacityFeatureAttribute";b.DISTANCETOSTART="distanceToStart";b.UVMAPSPACE="uvMapSpace";b.BOUNDINGRECT="boundingRect";b.UVREGION="uvRegion";b.NORMALCOMPRESSED="normalCompressed";b.PROFILERIGHT="profileRight";b.PROFILEUP="profileUp";
b.PROFILEVERTEXANDNORMAL="profileVertexAndNormal";b.FEATUREVALUE="featureValue";b.MODELORIGINHI="modelOriginHi";b.MODELORIGINLO="modelOriginLo";b.MODEL="model";b.MODELNORMAL="modelNormal";b.INSTANCECOLOR="instanceColor";b.INSTANCEFEATUREATTRIBUTE="instanceFeatureAttribute";b.LOCALTRANSFORM="localTransform";b.GLOBALTRANSFORM="globalTransform";b.BOUNDINGSPHERE="boundingSphere";b.MODELORIGIN="modelOrigin";b.MODELSCALEFACTORS="modelScaleFactors";b.FEATUREATTRIBUTE="featureAttribute";b.STATE="state";b.LODLEVEL=
"lodLevel";b.POSITION0="position0";b.POSITION1="position1";b.NORMALA="normalA";b.NORMALB="normalB";b.COMPONENTINDEX="componentIndex";b.VARIANTOFFSET="variantOffset";b.VARIANTSTROKE="variantStroke";b.VARIANTEXTENSION="variantExtension";b.U8PADDING="u8padding";b.U16PADDING="u16padding";b.SIDENESS="sideness";b.START="start";b.END="end";b.UP="up";b.EXTRUDE="extrude";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl":function(){define(["exports",
"../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c){a.ReadLinearDepth=function(n){n.include(b.RgbaFloatEncoding);n.code.add(c.glsl`float linearDepthFromFloat(float depth, vec2 nearFar) {
return -(depth * (nearFar[1] - nearFar[0]) + nearFar[0]);
}
float linearDepthFromTexture(sampler2D depthTex, vec2 uv, vec2 nearFar) {
return linearDepthFromFloat(rgba2float(texture2D(depthTex, uv)), nearFar);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.RgbaFloatEncoding=function(c){c.code.add(b.glsl`const float MAX_RGBA_FLOAT =
255.0 / 256.0 +
255.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 +
255.0 / 256.0 / 256.0 / 256.0 / 256.0;
const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);
vec4 float2rgba(const float value) {
float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);
vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);
const float toU8AsFloat = 1.0 / 255.0;
return fixedPointU8 * toU8AsFloat;
}
const vec4 RGBA_2_FLOAT_FACTORS = vec4(
255.0 / (256.0),
255.0 / (256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0),
255.0 / (256.0 * 256.0 * 256.0 * 256.0)
);
float rgba2float(vec4 rgba) {
return dot(rgba, RGBA_2_FLOAT_FACTORS);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.Gamma=function(c){c.fragment.code.add(b.glsl`const float GAMMA = 2.2;
const float INV_GAMMA = 0.4545454545;
vec4 delinearizeGamma(vec4 color) {
return vec4(pow(color.rgb, vec3(INV_GAMMA)), color.w);
}
vec3 linearizeGamma(vec3 color) {
return pow(color, vec3(GAMMA));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"vec2",n.BindType.Pass,(h,d,e)=>h.setUniform2fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Float2PassUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Uniform":function(){define(["exports","../../../../../core/maybe","../shaderTechnique/BindType"],function(a,b,c){let n=function(){function l(u,v,m,h,d=null){this.name=u;this.type=v;this.arraySize=d;this.bind={[c.BindType.Pass]:null,[c.BindType.Draw]:null};b.isSome(m)&&b.isSome(h)&&(this.bind[m]=h)}l.prototype.equals=function(u){return this.type===u.type&&this.name===u.name&&this.arraySize===
u.arraySize};return l}();a.Uniform=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/BindType":function(){define(["exports"],function(a){a.BindType=void 0;var b=a.BindType||(a.BindType={});b[b.Pass=0]="Pass";b[b.Draw=1]="Draw";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2Uniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(n){function l(u){return n.call(this,u,"vec2")||this}b._inheritsLoose(l,n);return l}(c.Uniform);a.Float2Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=
function(l){function u(v,m){return l.call(this,v,"vec3",n.BindType.Pass,(h,d,e)=>h.setUniform3fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Float3PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(n){function l(u){return n.call(this,u,"vec3")||this}
b._inheritsLoose(l,n);return l}(c.Uniform);a.Float3Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(n){function l(u){return n.call(this,u,"vec4")||this}b._inheritsLoose(l,n);return l}(c.Uniform);a.Float4Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderModules/FloatUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(n){function l(u){return n.call(this,u,"float")||this}b._inheritsLoose(l,n);return l}(c.Uniform);a.FloatUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"mat4",n.BindType.Pass,(h,d,e)=>h.setUniformMatrix4fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Matrix4PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/ShaderBuilder":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/Error",
"../../../../../core/Logger","../../../../../core/maybe"],function(a,b,c,n,l){const u=n.getLogger("esri.views.3d.webgl-engine.core.shaderModules.shaderBuilder");n=function(){function q(){this.includedModules=new Map}q.prototype.include=function(k,r){if(this.includedModules.has(k)){const y=this.includedModules.get(k);if(y!==r){u.error("Trying to include shader module multiple times with different sets of options.");r=new Set;for(const f of Object.keys(y))y[f]!==k[f]&&r.add(f);for(const f of Object.keys(k))y[f]!==
k[f]&&r.add(f);r.forEach(f=>console.error(`  ${f}: current ${y[f]} new ${k[f]}`))}}else this.includedModules.set(k,r),k(this.builder,r)};return q}();let v=function(q){function k(){var y=q.apply(this,arguments)||this;y.vertex=new d;y.fragment=new d;y.attributes=new e;y.varyings=new g;y.extensions=new p;y.constants=new t;return y}b._inheritsLoose(k,q);var r=k.prototype;r.generate=function(y){const f=this.extensions.generateSource(y),w=this.attributes.generateSource(y),z=this.varyings.generateSource();
var A="vertex"===y?this.vertex:this.fragment;const x=A.uniforms.generateSource(),B=A.code.generateSource();y="vertex"===y?"precision highp float;\nprecision highp sampler2D;":"#ifdef GL_FRAGMENT_PRECISION_HIGH\n  precision highp float;\n  precision highp sampler2D;\n#else\n  precision mediump float;\n  precision mediump sampler2D;\n#endif";A=this.constants.generateSource().concat(A.constants.generateSource());return`\n${f.join("\n")}\n\n${y}\n\n${A.join("\n")}\n\n${x.join("\n")}\n\n${w.join("\n")}\n\n${z.join("\n")}\n\n${B.join("\n")}`};
r.generateBind=function(y,f){const w=new Map;this.vertex.uniforms.entries.forEach(x=>{const B=x.bind[y];l.isSome(B)&&w.set(x.name,B)});this.fragment.uniforms.entries.forEach(x=>{const B=x.bind[y];l.isSome(B)&&w.set(x.name,B)});const z=Array.from(w.values()),A=z.length;return(x,B)=>{for(let C=0;C<A;++C)z[C](f,x,B)}};b._createClass(k,[{key:"fragmentUniforms",get:function(){return this.fragment.uniforms.entries}},{key:"builder",get:function(){return this}}]);return k}(n),m=function(){function q(){this._entries=
new Map}var k=q.prototype;k.add=function(r){if(!Array.isArray(r))return this._add(r);for(const y of r)this._add(y)};k._add=function(r){if(this._entries.has(r.name)&&!this._entries.get(r.name).equals(r))throw new c(`Duplicate uniform name ${r.name} for different uniform type`);this._entries.set(r.name,r)};k.generateSource=function(){return Array.from(this._entries.values()).map(r=>l.isSome(r.arraySize)?`uniform ${r.type} ${r.name}[${r.arraySize}];`:`uniform ${r.type} ${r.name};`)};b._createClass(q,
[{key:"entries",get:function(){return Array.from(this._entries.values())}}]);return q}(),h=function(){function q(){this._entries=[]}var k=q.prototype;k.add=function(r){this._entries.push(r)};k.generateSource=function(){return this._entries};return q}(),d=function(q){function k(){var r=q.apply(this,arguments)||this;r.uniforms=new m;r.code=new h;r.constants=new t;return r}b._inheritsLoose(k,q);b._createClass(k,[{key:"builder",get:function(){return this}}]);return k}(n),e=function(){function q(){this._entries=
[]}var k=q.prototype;k.add=function(r,y){this._entries.push([r,y])};k.generateSource=function(r){return"fragment"===r?[]:this._entries.map(y=>`attribute ${y[1]} ${y[0]};`)};return q}(),g=function(){function q(){this._entries=[]}var k=q.prototype;k.add=function(r,y){this._entries.push([r,y])};k.generateSource=function(){return this._entries.map(r=>`varying ${r[1]} ${r[0]};`)};return q}(),p=function(){function q(){this._entries=new Set}var k=q.prototype;k.add=function(r){this._entries.add(r)};k.generateSource=
function(r){const y="vertex"===r?q.ALLOWLIST_VERTEX:q.ALLOWLIST_FRAGMENT;return Array.from(this._entries).filter(f=>y.includes(f)).map(f=>`#extension ${f} : enable`)};return q}();p.ALLOWLIST_FRAGMENT=["GL_EXT_shader_texture_lod","GL_OES_standard_derivatives"];p.ALLOWLIST_VERTEX=[];let t=function(){function q(){this._entries=new Set}var k=q.prototype;k.add=function(r,y,f){let w="ERROR_CONSTRUCTOR_STRING";switch(y){case "float":w=q._numberToFloatStr(f);break;case "int":w=q._numberToIntStr(f);break;
case "bool":w=f.toString();break;case "vec2":w=`vec2(${q._numberToFloatStr(f[0])},                            ${q._numberToFloatStr(f[1])})`;break;case "vec3":w=`vec3(${q._numberToFloatStr(f[0])},                            ${q._numberToFloatStr(f[1])},                            ${q._numberToFloatStr(f[2])})`;break;case "vec4":w=`vec4(${q._numberToFloatStr(f[0])},                            ${q._numberToFloatStr(f[1])},                            ${q._numberToFloatStr(f[2])},                            ${q._numberToFloatStr(f[3])})`;
break;case "ivec2":w=`ivec2(${q._numberToIntStr(f[0])},                             ${q._numberToIntStr(f[1])})`;break;case "ivec3":w=`ivec3(${q._numberToIntStr(f[0])},                             ${q._numberToIntStr(f[1])},                             ${q._numberToIntStr(f[2])})`;break;case "ivec4":w=`ivec4(${q._numberToIntStr(f[0])},                             ${q._numberToIntStr(f[1])},                             ${q._numberToIntStr(f[2])},                             ${q._numberToIntStr(f[3])})`;
break;case "mat2":case "mat3":case "mat4":w=`${y}(${Array.prototype.map.call(f,z=>q._numberToFloatStr(z)).join(", ")})`}this._entries.add(`const ${y} ${r} = ${w};`);return this};q._numberToIntStr=function(r){return r.toFixed(0)};q._numberToFloatStr=function(r){return Number.isInteger(r)?r.toFixed(1):r.toString()};k.generateSource=function(){return Array.from(this._entries)};return q}();a.Code=h;a.Includes=n;a.ShaderBuilder=v;a.Stage=d;a.Uniforms=m;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(n){function l(u){return n.call(this,u,"sampler2D")||this}b._inheritsLoose(l,n);return l}(c.Uniform);a.Texture2DUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ReloadableShaderModule":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(u,v){this._module=u;this._loadModule=v}var l=n.prototype;l.get=function(){return this._module};l.reload=function(){var u=b._asyncToGenerator(function*(){return this._module=yield this._loadModule()});return function(){return u.apply(this,arguments)}}();return n}();a.ReloadableShaderModule=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechnique":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../webgl/enums"],function(a,b,c,n){let l=function(){function u(m,h,d){this.release=d;h&&(this.initializeConfiguration(m,h),this._configuration=h.snapshot());this._program=this.initializeProgram(m);this._pipeline=this.initializePipeline(m.rctx.capabilities)}var v=u.prototype;v.destroy=function(){this._program=c.disposeMaybe(this._program);this._pipeline=this._configuration=null};v.reload=function(m){c.disposeMaybe(this._program);
this._program=this.initializeProgram(m);this._pipeline=this.initializePipeline(m.rctx.capabilities)};v.bindPass=function(m,h){this.program.bindPass(m,h)};v.bindDraw=function(m,h){this.program.bindDraw(m,h);this.program.rebindTextures()};v.bindPipelineState=function(m,h=null,d){m.setPipelineState(this.getPipelineState(h,d))};v.ensureAttributeLocations=function(m){this.program.assertCompatibleVertexAttributeLocations(m)};v.getPipelineState=function(m,h){return this._pipeline};v.initializeConfiguration=
function(m,h){};b._createClass(u,[{key:"program",get:function(){return this._program}},{key:"compiled",get:function(){return this.program.isCompiled}},{key:"key",get:function(){return this._configuration.key}},{key:"configuration",get:function(){return this._configuration}},{key:"primitiveType",get:function(){return n.PrimitiveType.TRIANGLES}}]);return u}();a.ShaderTechnique=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/enums":function(){define(["exports"],
function(a){a.ClearBufferBit=void 0;(function(b){b[b.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT";b[b.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT";b[b.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT"})(a.ClearBufferBit||(a.ClearBufferBit={}));a.PrimitiveType=void 0;(function(b){b[b.POINTS=0]="POINTS";b[b.LINES=1]="LINES";b[b.LINE_LOOP=2]="LINE_LOOP";b[b.LINE_STRIP=3]="LINE_STRIP";b[b.TRIANGLES=4]="TRIANGLES";b[b.TRIANGLE_STRIP=5]="TRIANGLE_STRIP";b[b.TRIANGLE_FAN=6]="TRIANGLE_FAN"})(a.PrimitiveType||(a.PrimitiveType=
{}));a.BlendFactor=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.ONE=1]="ONE";b[b.SRC_COLOR=768]="SRC_COLOR";b[b.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR";b[b.SRC_ALPHA=770]="SRC_ALPHA";b[b.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA";b[b.DST_ALPHA=772]="DST_ALPHA";b[b.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA";b[b.DST_COLOR=774]="DST_COLOR";b[b.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR";b[b.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE";b[b.CONSTANT_COLOR=32769]="CONSTANT_COLOR";b[b.ONE_MINUS_CONSTANT_COLOR=
32770]="ONE_MINUS_CONSTANT_COLOR";b[b.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA";b[b.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA"})(a.BlendFactor||(a.BlendFactor={}));a.BlendOperation=void 0;(function(b){b[b.ADD=32774]="ADD";b[b.SUBTRACT=32778]="SUBTRACT";b[b.REVERSE_SUBTRACT=32779]="REVERSE_SUBTRACT"})(a.BlendOperation||(a.BlendOperation={}));a.BufferType=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER";b[b.UNIFORM_BUFFER=
35345]="UNIFORM_BUFFER";b[b.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER";b[b.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER";b[b.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER";b[b.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER"})(a.BufferType||(a.BufferType={}));a.Face=void 0;(function(b){b[b.FRONT=1028]="FRONT";b[b.BACK=1029]="BACK";b[b.FRONT_AND_BACK=1032]="FRONT_AND_BACK"})(a.Face||(a.Face={}));a.CullMode=void 0;(function(b){b[b.CW=2304]="CW";b[b.CCW=2305]="CCW"})(a.CullMode||(a.CullMode={}));a.DataType=
void 0;(function(b){b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.INT=5124]="INT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.FLOAT=5126]="FLOAT"})(a.DataType||(a.DataType={}));a.CompareFunction=void 0;(function(b){b[b.NEVER=512]="NEVER";b[b.LESS=513]="LESS";b[b.EQUAL=514]="EQUAL";b[b.LEQUAL=515]="LEQUAL";b[b.GREATER=516]="GREATER";b[b.NOTEQUAL=517]="NOTEQUAL";b[b.GEQUAL=518]="GEQUAL";b[b.ALWAYS=519]="ALWAYS"})(a.CompareFunction||
(a.CompareFunction={}));a.StencilOperation=void 0;(function(b){b[b.ZERO=0]="ZERO";b[b.KEEP=7680]="KEEP";b[b.REPLACE=7681]="REPLACE";b[b.INCR=7682]="INCR";b[b.DECR=7683]="DECR";b[b.INVERT=5386]="INVERT";b[b.INCR_WRAP=34055]="INCR_WRAP";b[b.DECR_WRAP=34056]="DECR_WRAP"})(a.StencilOperation||(a.StencilOperation={}));a.TextureSamplingMode=void 0;(function(b){b[b.NEAREST=9728]="NEAREST";b[b.LINEAR=9729]="LINEAR";b[b.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST";b[b.LINEAR_MIPMAP_NEAREST=9985]=
"LINEAR_MIPMAP_NEAREST";b[b.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR";b[b.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR"})(a.TextureSamplingMode||(a.TextureSamplingMode={}));a.TextureWrapMode=void 0;(function(b){b[b.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE";b[b.REPEAT=10497]="REPEAT";b[b.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT"})(a.TextureWrapMode||(a.TextureWrapMode={}));a.TextureType=void 0;(function(b){b[b.TEXTURE_2D=3553]="TEXTURE_2D";b[b.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP";b[b.TEXTURE_3D=
32879]="TEXTURE_3D";b[b.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X";b[b.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X";b[b.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y";b[b.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z";b[b.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z";b[b.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY"})(a.TextureType||(a.TextureType=
{}));a.PixelFormat=void 0;(function(b){b[b.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.ALPHA=6406]="ALPHA";b[b.RGB=6407]="RGB";b[b.RGBA=6408]="RGBA";b[b.LUMINANCE=6409]="LUMINANCE";b[b.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA";b[b.RED=6403]="RED";b[b.RG=33319]="RG";b[b.RED_INTEGER=36244]="RED_INTEGER";b[b.RG_INTEGER=33320]="RG_INTEGER";b[b.RGB_INTEGER=36248]="RGB_INTEGER";b[b.RGBA_INTEGER=36249]="RGBA_INTEGER"})(a.PixelFormat||(a.PixelFormat={}));a.SizedPixelFormat=
void 0;(function(b){b[b.RGBA4=32854]="RGBA4";b[b.R16F=33325]="R16F";b[b.RG16F=33327]="RG16F";b[b.RGB32F=34837]="RGB32F";b[b.RGBA16F=34842]="RGBA16F";b[b.R32F=33326]="R32F";b[b.RG32F=33328]="RG32F";b[b.RGBA32F=34836]="RGBA32F";b[b.R11F_G11F_B10F=35898]="R11F_G11F_B10F";b[b.RGB8=32849]="RGB8";b[b.RGBA8=32856]="RGBA8";b[b.RGB5_A1=32855]="RGB5_A1";b[b.R8=33321]="R8";b[b.RG8=33323]="RG8";b[b.R8I=33329]="R8I";b[b.R8UI=33330]="R8UI";b[b.R16I=33331]="R16I";b[b.R16UI=33332]="R16UI";b[b.R32I=33333]="R32I";
b[b.R32UI=33334]="R32UI";b[b.RG8I=33335]="RG8I";b[b.RG8UI=33336]="RG8UI";b[b.RG16I=33337]="RG16I";b[b.RG16UI=33338]="RG16UI";b[b.RG32I=33339]="RG32I";b[b.RG32UI=33340]="RG32UI";b[b.RGB16F=34843]="RGB16F";b[b.RGB9_E5=35901]="RGB9_E5";b[b.SRGB8=35905]="SRGB8";b[b.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8";b[b.RGB565=36194]="RGB565";b[b.RGBA32UI=36208]="RGBA32UI";b[b.RGB32UI=36209]="RGB32UI";b[b.RGBA16UI=36214]="RGBA16UI";b[b.RGB16UI=36215]="RGB16UI";b[b.RGBA8UI=36220]="RGBA8UI";b[b.RGB8UI=36221]="RGB8UI";b[b.RGBA32I=
36226]="RGBA32I";b[b.RGB32I=36227]="RGB32I";b[b.RGBA16I=36232]="RGBA16I";b[b.RGB16I=36233]="RGB16I";b[b.RGBA8I=36238]="RGBA8I";b[b.RGB8I=36239]="RGB8I";b[b.R8_SNORM=36756]="R8_SNORM";b[b.RG8_SNORM=36757]="RG8_SNORM";b[b.RGB8_SNORM=36758]="RGB8_SNORM";b[b.RGBA8_SNORM=36759]="RGBA8_SNORM";b[b.RGB10_A2=32857]="RGB10_A2";b[b.RGB10_A2UI=36975]="RGB10_A2UI"})(a.SizedPixelFormat||(a.SizedPixelFormat={}));a.PixelType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE";b[b.UNSIGNED_INT_24_8=
34042]="UNSIGNED_INT_24_8";b[b.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4";b[b.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1";b[b.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5";b[b.BYTE=5120]="BYTE";b[b.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT";b[b.SHORT=5122]="SHORT";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.INT=5124]="INT";b[b.HALF_FLOAT=5131]="HALF_FLOAT";b[b.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV";b[b.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV";
b[b.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV";b[b.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV"})(a.PixelType||(a.PixelType={}));a.RenderbufferFormat=void 0;(function(b){b[b.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16";b[b.STENCIL_INDEX8=36168]="STENCIL_INDEX8";b[b.DEPTH_STENCIL=34041]="DEPTH_STENCIL";b[b.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24";b[b.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F";b[b.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8";b[b.DEPTH32F_STENCIL8=
36013]="DEPTH32F_STENCIL8"})(a.RenderbufferFormat||(a.RenderbufferFormat={}));a.Usage=void 0;(function(b){b[b.STATIC_DRAW=35044]="STATIC_DRAW";b[b.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW";b[b.STREAM_DRAW=35040]="STREAM_DRAW";b[b.STATIC_READ=35045]="STATIC_READ";b[b.DYNAMIC_READ=35049]="DYNAMIC_READ";b[b.STREAM_READ=35041]="STREAM_READ";b[b.STATIC_COPY=35046]="STATIC_COPY";b[b.DYNAMIC_COPY=35050]="DYNAMIC_COPY";b[b.STREAM_COPY=35042]="STREAM_COPY"})(a.Usage||(a.Usage={}));a.ShaderType=void 0;(function(b){b[b.FRAGMENT_SHADER=
35632]="FRAGMENT_SHADER";b[b.VERTEX_SHADER=35633]="VERTEX_SHADER"})(a.ShaderType||(a.ShaderType={}));a.FramebufferTarget=void 0;(function(b){b[b.FRAMEBUFFER=36160]="FRAMEBUFFER";b[b.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER";b[b.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER"})(a.FramebufferTarget||(a.FramebufferTarget={}));a.TargetType=void 0;(function(b){b[b.TEXTURE=0]="TEXTURE";b[b.RENDER_BUFFER=1]="RENDER_BUFFER";b[b.CUBEMAP=2]="CUBEMAP"})(a.TargetType||(a.TargetType={}));a.DepthStencilTargetType=
void 0;(function(b){b[b.NONE=0]="NONE";b[b.DEPTH_RENDER_BUFFER=1]="DEPTH_RENDER_BUFFER";b[b.STENCIL_RENDER_BUFFER=2]="STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_RENDER_BUFFER=3]="DEPTH_STENCIL_RENDER_BUFFER";b[b.DEPTH_STENCIL_TEXTURE=4]="DEPTH_STENCIL_TEXTURE"})(a.DepthStencilTargetType||(a.DepthStencilTargetType={}));a.ResourceType=void 0;(function(b){b[b.Texture=0]="Texture";b[b.BufferObject=1]="BufferObject";b[b.VertexArrayObject=2]="VertexArrayObject";b[b.Shader=3]="Shader";b[b.Program=4]="Program";
b[b.FramebufferObject=5]="FramebufferObject";b[b.Renderbuffer=6]="Renderbuffer";b[b.Sync=7]="Sync";b[b.COUNT=8]="COUNT"})(a.ResourceType||(a.ResourceType={}));a.ColorAttachment=void 0;(function(b){b[b.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0";b[b.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1";b[b.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2";b[b.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3";b[b.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4";b[b.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5";b[b.COLOR_ATTACHMENT6=
36070]="COLOR_ATTACHMENT6";b[b.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7";b[b.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8";b[b.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9";b[b.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10";b[b.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11";b[b.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12";b[b.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13";b[b.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14";b[b.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15"})(a.ColorAttachment||
(a.ColorAttachment={}));a.CompressedTextureFormat=void 0;(function(b){b[b.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT";b[b.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT";b[b.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC";b[b.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC";b[b.COMPRESSED_RG11_EAC=37490]=
"COMPRESSED_RG11_EAC";b[b.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC";b[b.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2";b[b.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2";b[b.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2";b[b.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC";b[b.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]=
"COMPRESSED_SRGB8_ALPHA8_ETC2_EAC"})(a.CompressedTextureFormat||(a.CompressedTextureFormat={}));a.UniformType=void 0;(function(b){b[b.FLOAT=5126]="FLOAT";b[b.FLOAT_VEC2=35664]="FLOAT_VEC2";b[b.FLOAT_VEC3=35665]="FLOAT_VEC3";b[b.FLOAT_VEC4=35666]="FLOAT_VEC4";b[b.INT=5124]="INT";b[b.INT_VEC2=35667]="INT_VEC2";b[b.INT_VEC3=35668]="INT_VEC3";b[b.INT_VEC4=35669]="INT_VEC4";b[b.BOOL=35670]="BOOL";b[b.BOOL_VEC2=35671]="BOOL_VEC2";b[b.BOOL_VEC3=35672]="BOOL_VEC3";b[b.BOOL_VEC4=35673]="BOOL_VEC4";b[b.FLOAT_MAT2=
35674]="FLOAT_MAT2";b[b.FLOAT_MAT3=35675]="FLOAT_MAT3";b[b.FLOAT_MAT4=35676]="FLOAT_MAT4";b[b.SAMPLER_2D=35678]="SAMPLER_2D";b[b.SAMPLER_CUBE=35680]="SAMPLER_CUBE";b[b.UNSIGNED_INT=5125]="UNSIGNED_INT";b[b.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2";b[b.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3";b[b.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4";b[b.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3";b[b.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4";b[b.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2";b[b.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4";
b[b.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2";b[b.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3";b[b.SAMPLER_3D=35679]="SAMPLER_3D";b[b.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW";b[b.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY";b[b.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW";b[b.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW";b[b.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D";b[b.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D";b[b.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE";b[b.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY";
b[b.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D";b[b.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D";b[b.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE";b[b.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY"})(a.UniformType||(a.UniformType={}));a.SyncParameter=void 0;(function(b){b[b.OBJECT_TYPE=37138]="OBJECT_TYPE";b[b.SYNC_CONDITION=37139]="SYNC_CONDITION";b[b.SYNC_STATUS=37140]="SYNC_STATUS";b[b.SYNC_FLAGS=37141]="SYNC_FLAGS"})(a.SyncParameter||
(a.SyncParameter={}));a.SyncStatus=void 0;(function(b){b[b.UNSIGNALED=37144]="UNSIGNALED";b[b.SIGNALED=37145]="SIGNALED"})(a.SyncStatus||(a.SyncStatus={}));a.ClientWaitSyncStatus=void 0;(function(b){b[b.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED";b[b.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED";b[b.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED";b[b.WAIT_FAILED=37149]="WAIT_FAILED"})(a.ClientWaitSyncStatus||(a.ClientWaitSyncStatus={}));a.SyncCondition=void 0;(function(b){b[b.SYNC_GPU_COMMANDS_COMPLETE=
37143]="SYNC_GPU_COMMANDS_COMPLETE"})(a.SyncCondition||(a.SyncCondition={}));a.SyncFlag=void 0;(function(b){b[b.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT"})(a.SyncFlag||(a.SyncFlag={}));a.BASE_TEXTURE_UNIT=33984;a.DepthStencilAttachment=33306;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DefaultVertexAttributeLocations":function(){define(["exports","./VertexAttribute"],function(a,b){b=new Map([[b.VertexAttribute.POSITION,
0],[b.VertexAttribute.NORMAL,1],[b.VertexAttribute.UV0,2],[b.VertexAttribute.COLOR,3],[b.VertexAttribute.SIZE,4],[b.VertexAttribute.TANGENT,4],[b.VertexAttribute.AUXPOS1,5],[b.VertexAttribute.SYMBOLCOLOR,5],[b.VertexAttribute.AUXPOS2,6],[b.VertexAttribute.FEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCEFEATUREATTRIBUTE,6],[b.VertexAttribute.INSTANCECOLOR,7],[b.VertexAttribute.MODEL,8],[b.VertexAttribute.MODELNORMAL,12],[b.VertexAttribute.MODELORIGINHI,11],[b.VertexAttribute.MODELORIGINLO,15]]);a.Default3D=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Program":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PooledArray ../core/shaderTechnique/BindType ../../../webgl/checkWebGLError".split(" "),function(a,b,c,n,l,u){let v=function(){function m(d,e,g){this._context=d;this._locations=g;this._textures=new Map;this._freeTextureUnits=new n({deallocator:null});this._glProgram=
d.programCache.acquire(e.generate("vertex"),e.generate("fragment"),g);this._glProgram.stop=()=>{throw Error("Wrapped _glProgram used directly");};this.bindPass=e.generateBind(l.BindType.Pass,this);this.bindDraw=e.generateBind(l.BindType.Draw,this);this._fragmentUniforms=u.webglDebugEnabled()?e.fragmentUniforms:null}var h=m.prototype;h.dispose=function(){this._glProgram.dispose()};h.setUniform1b=function(d,e){this._glProgram.setUniform1i(d,e?1:0)};h.setUniform1i=function(d,e){this._glProgram.setUniform1i(d,
e)};h.setUniform1f=function(d,e){this._glProgram.setUniform1f(d,e)};h.setUniform2f=function(d,e,g){this._glProgram.setUniform2f(d,e,g)};h.setUniform2fv=function(d,e){this._glProgram.setUniform2fv(d,e)};h.setUniform3f=function(d,e,g,p){this._glProgram.setUniform3f(d,e,g,p)};h.setUniform3fv=function(d,e){this._glProgram.setUniform3fv(d,e)};h.setUniform4f=function(d,e,g,p,t){this._glProgram.setUniform4f(d,e,g,p,t)};h.setUniform4fv=function(d,e){this._glProgram.setUniform4fv(d,e)};h.setUniformMatrix3fv=
function(d,e){this._glProgram.setUniformMatrix3fv(d,e)};h.setUniformMatrix4fv=function(d,e){this._glProgram.setUniformMatrix4fv(d,e)};h.setUniform1fv=function(d,e){this._glProgram.setUniform1fv(d,e)};h.setUniform1iv=function(d,e){this._glProgram.setUniform1iv(d,e)};h.setUniform2iv=function(d,e){this._glProgram.setUniform3iv(d,e)};h.setUniform3iv=function(d,e){this._glProgram.setUniform3iv(d,e)};h.setUniform4iv=function(d,e){this._glProgram.setUniform4iv(d,e)};h.assertCompatibleVertexAttributeLocations=
function(d){d.locations!==this._locations&&console.error("VertexAttributeLocations are incompatible")};h.stop=function(){this._textures.clear();this._freeTextureUnits.clear()};h.bindTexture=function(d,e){if(c.isNone(e)||null==e.glName){if(e=this._textures.get(d))this._context.bindTexture(null,e.unit),this._freeTextureUnit(e),this._textures.delete(d);return null}let g=this._textures.get(d);null==g?(g=this._allocTextureUnit(e),this._textures.set(d,g)):g.texture=e;this._context.useProgram(this);this.setUniform1i(d,
g.unit);this._context.bindTexture(e,g.unit);return g.unit};h.rebindTextures=function(){this._context.useProgram(this);this._textures.forEach((d,e)=>{this._context.bindTexture(d.texture,d.unit);this.setUniform1i(e,d.unit)});c.isSome(this._fragmentUniforms)&&this._fragmentUniforms.forEach(d=>{"sampler2D"!==d.type&&"samplerCube"!==d.type||this._textures.has(d.name)||console.error(`Texture sampler ${d.name} has no bound texture`)})};h._allocTextureUnit=function(d){return{texture:d,unit:0===this._freeTextureUnits.length?
this._textures.size:this._freeTextureUnits.pop()}};h._freeTextureUnit=function(d){this._freeTextureUnits.push(d.unit)};b._createClass(m,[{key:"glName",get:function(){return this._glProgram.glName}},{key:"isCompiled",get:function(){return this._glProgram.isCompiled}}]);return m}();a.Program=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/checkWebGLError":function(){define(["exports","../../core/Error","../../core/has","../../core/Logger"],
function(a,b,c,n){function l(m,h){switch(h){case m.INVALID_ENUM:return"Invalid Enum. An unacceptable value has been specified for an enumerated argument.";case m.INVALID_VALUE:return"Invalid Value. A numeric argument is out of range.";case m.INVALID_OPERATION:return"Invalid Operation. The specified command is not allowed for the current state.";case m.INVALID_FRAMEBUFFER_OPERATION:return"Invalid Framebuffer operation. The currently bound framebuffer is not framebuffer complete when trying to render to or to read from it.";
case m.OUT_OF_MEMORY:return"Out of memory. Not enough memory is left to execute the command.";case m.CONTEXT_LOST_WEBGL:return"WebGL context has been lost";default:return"Unknown error"}}const u=n.getLogger("esri/views/webgl"),v=!!c("enable-feature:webgl-debug");a.checkWebGLError=function(m){if(v){const h=m.getError();h&&(m=l(m,h),u.error(new b("webgl-error","WebGL error occured",{message:m,stack:Error().stack})))}};a.hasFeatureFlagWebGLDebug=v;a.webglDebugEnabled=function(){return v};a.webglValidateShadersEnabled=
function(){return v};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/renderState":function(){define(["exports","../3d/webgl-engine/lib/basicInterfaces","./enums"],function(a,b,c){function n(R){return B.intern(R)}function l(R){return C.intern(R)}function u(R){return D.intern(R)}function v(R){return E.intern(R)}function m(R){return F.intern(R)}function h(R){return G.intern(R)}function d(R){return O.intern(R)}function e(R){return K.intern(R)}
function g(R){return"["+R.join(",")+"]"}function p(R){return R?g([R.srcRgb,R.srcAlpha,R.dstRgb,R.dstAlpha,R.opRgb,R.opAlpha,R.color.r,R.color.g,R.color.b,R.color.a]):null}function t(R){return R?g([R.face,R.mode]):null}function q(R){return R?g([R.factor,R.units]):null}function k(R){return R?g([R.func]):null}function r(R){return R?g([R.function.func,R.function.ref,R.function.mask,R.operation.fail,R.operation.zFail,R.operation.zPass]):null}function y(R){return R?g([R.zNear,R.zFar]):null}function f(R){return R?
g([R.r,R.g,R.b,R.a]):null}function w(R){return R?g([R.mask]):null}const z={face:c.Face.BACK,mode:c.CullMode.CCW},A={face:c.Face.FRONT,mode:c.CullMode.CCW};var x=function(){function R(M,J){this.makeKey=M;this.makeRef=J;this.interns=new Map}R.prototype.intern=function(M){if(!M)return null;const J=this.makeKey(M),I=this.interns;I.has(J)||I.set(J,this.makeRef(M));return I.get(J)};return R}();const B=new x(p,R=>({__tag:"Blending",...R})),C=new x(t,R=>({__tag:"Culling",...R})),D=new x(q,R=>({__tag:"PolygonOffset",
...R})),E=new x(k,R=>({__tag:"DepthTest",...R})),F=new x(r,R=>({__tag:"StencilTest",...R})),G=new x(y,R=>({__tag:"DepthWrite",...R})),O=new x(f,R=>({__tag:"ColorWrite",...R})),K=new x(w,R=>({__tag:"StencilWrite",...R})),L=new x(function(R){return R?g([p(R.blending),t(R.culling),q(R.polygonOffset),k(R.depthTest),r(R.stencilTest),y(R.depthWrite),f(R.colorWrite),w(R.stencilWrite)]):null},R=>({blending:n(R.blending),culling:l(R.culling),polygonOffset:u(R.polygonOffset),depthTest:v(R.depthTest),stencilTest:m(R.stencilTest),
depthWrite:h(R.depthWrite),colorWrite:d(R.colorWrite),stencilWrite:e(R.stencilWrite)}));x=function(){function R(J){this._stencilWriteInvalid=this._colorWriteInvalid=this._depthWriteInvalid=this._stencilTestInvalid=this._depthTestInvalid=this._polygonOffsetInvalid=this._cullingInvalid=this._blendingInvalid=this._pipelineInvalid=!0;this._stateSetters=J}var M=R.prototype;M.setPipeline=function(J){if(this._pipelineInvalid||J!==this._pipeline)this._setBlending(J.blending),this._setCulling(J.culling),this._setPolygonOffset(J.polygonOffset),
this._setDepthTest(J.depthTest),this._setStencilTest(J.stencilTest),this._setDepthWrite(J.depthWrite),this._setColorWrite(J.colorWrite),this._setStencilWrite(J.stencilWrite),this._pipeline=J;this._pipelineInvalid=!1};M.invalidateBlending=function(){this._pipelineInvalid=this._blendingInvalid=!0};M.invalidateCulling=function(){this._pipelineInvalid=this._cullingInvalid=!0};M.invalidatePolygonOffset=function(){this._pipelineInvalid=this._polygonOffsetInvalid=!0};M.invalidateDepthTest=function(){this._pipelineInvalid=
this._depthTestInvalid=!0};M.invalidateStencilTest=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};M.invalidateDepthWrite=function(){this._pipelineInvalid=this._depthWriteInvalid=!0};M.invalidateColorWrite=function(){this._pipelineInvalid=this._colorWriteInvalid=!0};M.invalidateStencilWrite=function(){this._pipelineInvalid=this._stencilTestInvalid=!0};M._setBlending=function(J){this._blending=this._setSubState(J,this._blending,this._blendingInvalid,this._stateSetters.setBlending);this._blendingInvalid=
!1};M._setCulling=function(J){this._culling=this._setSubState(J,this._culling,this._cullingInvalid,this._stateSetters.setCulling);this._cullingInvalid=!1};M._setPolygonOffset=function(J){this._polygonOffset=this._setSubState(J,this._polygonOffset,this._polygonOffsetInvalid,this._stateSetters.setPolygonOffset);this._polygonOffsetInvalid=!1};M._setDepthTest=function(J){this._depthTest=this._setSubState(J,this._depthTest,this._depthTestInvalid,this._stateSetters.setDepthTest);this._depthTestInvalid=
!1};M._setStencilTest=function(J){this._stencilTest=this._setSubState(J,this._stencilTest,this._stencilTestInvalid,this._stateSetters.setStencilTest);this._stencilTestInvalid=!1};M._setDepthWrite=function(J){this._depthWrite=this._setSubState(J,this._depthWrite,this._depthWriteInvalid,this._stateSetters.setDepthWrite);this._depthWriteInvalid=!1};M._setColorWrite=function(J){this._colorWrite=this._setSubState(J,this._colorWrite,this._colorWriteInvalid,this._stateSetters.setColorWrite);this._colorWriteInvalid=
!1};M._setStencilWrite=function(J){this._stencilWrite=this._setSubState(J,this._stencilWrite,this._stencilWriteInvalid,this._stateSetters.setStencilWrite);this._stencilTestInvalid=!1};M._setSubState=function(J,I,P,N){if(P||J!==I)N(J),this._pipelineInvalid=!0;return J};return R}();a.StateTracker=x;a.backFaceCullingParams=z;a.cullingParams=R=>R===b.CullFaceOptions.Back?z:R===b.CullFaceOptions.Front?A:null;a.defaultColorWriteParams={r:!0,g:!0,b:!0,a:!0};a.defaultDepthWriteParams={zNear:0,zFar:1};a.frontFaceCullingParams=
A;a.makeBlending=n;a.makeColorWrite=d;a.makeCulling=l;a.makeDepthTest=v;a.makeDepthWrite=h;a.makePipelineState=function(R){return L.intern(R)};a.makePolygonOffset=u;a.makeStencilTest=m;a.makeStencilWrite=e;a.separateBlendingParams=function(R,M,J,I,P=c.BlendOperation.ADD,N=c.BlendOperation.ADD,V=[0,0,0,0]){return{srcRgb:R,srcAlpha:M,dstRgb:J,dstAlpha:I,opRgb:P,opAlpha:N,color:{r:V[0],g:V[1],b:V[2],a:V[3]}}};a.simpleBlendingParams=function(R,M,J=c.BlendOperation.ADD,I=[0,0,0,0]){return{srcRgb:R,srcAlpha:R,
dstRgb:M,dstAlpha:M,opRgb:J,opAlpha:J,color:{r:I[0],g:I[1],b:I[2],a:I[3]}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/basicInterfaces":function(){define(["exports"],function(a){a.CullFaceOptions=void 0;(function(b){b[b.None=0]="None";b[b.Front=1]="Front";b[b.Back=2]="Back";b[b.COUNT=3]="COUNT"})(a.CullFaceOptions||(a.CullFaceOptions={}));a.DepthTestFunction=void 0;(function(b){b[b.Less=0]="Less";b[b.Lequal=1]="Lequal";
b[b.COUNT=2]="COUNT"})(a.DepthTestFunction||(a.DepthTestFunction={}));a.AntiAliasingMode=void 0;(function(b){b[b.NONE=0]="NONE";b[b.SMAA=1]="SMAA"})(a.AntiAliasingMode||(a.AntiAliasingMode={}));a.TransparencyPassType=void 0;(function(b){b[b.Color=0]="Color";b[b.Alpha=1]="Alpha";b[b.FrontFace=2]="FrontFace";b[b.NONE=3]="NONE";b[b.COUNT=4]="COUNT"})(a.TransparencyPassType||(a.TransparencyPassType={}));a.RenderRequestType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.UPDATE=1]="UPDATE"})(a.RenderRequestType||
(a.RenderRequestType={}));a.ResourceState=void 0;(function(b){b[b.NOT_LOADED=0]="NOT_LOADED";b[b.LOADING=1]="LOADING";b[b.LOADED=2]="LOADED"})(a.ResourceState||(a.ResourceState={}));a.StencilBits=void 0;(function(b){b[b.IntegratedMeshMaskExcluded=1]="IntegratedMeshMaskExcluded";b[b.OutlineVisualElementMask=2]="OutlineVisualElementMask"})(a.StencilBits||(a.StencilBits={}));a.UpdatePolicy=void 0;(function(b){b[b.ASYNC=0]="ASYNC";b[b.SYNC=1]="SYNC"})(a.UpdatePolicy||(a.UpdatePolicy={}));a.Object3DState=
void 0;(function(b){b[b.Highlight=0]="Highlight";b[b.MaskOccludee=1]="MaskOccludee";b[b.COUNT=2]="COUNT"})(a.Object3DState||(a.Object3DState={}));a.PrimitiveType=void 0;(function(b){b[b.Triangle=0]="Triangle";b[b.Point=1]="Point";b[b.Line=2]="Line"})(a.PrimitiveType||(a.PrimitiveType={}));a.PowerOfTwoResizeMode=void 0;(function(b){b[b.STRETCH=1]="STRETCH";b[b.PAD=2]="PAD"})(a.PowerOfTwoResizeMode||(a.PowerOfTwoResizeMode={}));a.ValidationState=void 0;(function(b){b[b.CHANGED=0]="CHANGED";b[b.UNCHANGED=
1]="UNCHANGED"})(a.ValidationState||(a.ValidationState={}));a.AlphaDiscardMode=void 0;(function(b){b[b.Blend=0]="Blend";b[b.Opaque=1]="Opaque";b[b.Mask=2]="Mask";b[b.MaskBlend=3]="MaskBlend";b[b.COUNT=4]="COUNT"})(a.AlphaDiscardMode||(a.AlphaDiscardMode={}));a.Decorations=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.Decorations||(a.Decorations={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/ChapmanAtmosphereTechniqueConfiguration":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.haze=!1;return m}b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter()],l.prototype,"haze",void 0);a.ChapmanAtmosphereTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(){this._key="";this._keyDirty=!1;this._parameterBits=this._parameterBits?this._parameterBits.map(()=>0):[];this._parameterNames||(this._parameterNames=[])}n.prototype.snapshot=function(){const l=this._parameterNames,u={key:this.key};for(const v of l)u[v]=this[v];return u};b._createClass(n,[{key:"key",
get:function(){this._keyDirty&&(this._keyDirty=!1,this._key=String.fromCharCode.apply(String,this._parameterBits));return this._key}}]);return n}();a.ShaderTechniqueConfiguration=c;a.parameter=function(n={}){return(l,u)=>{var v;l._parameterNames=null!=(v=l._parameterNames)?v:[];l._parameterNames.push(u);if(null!=n.constValue)Object.defineProperty(l,u,{get(){return n.constValue}});else{var m;const h=l._parameterNames.length-1;v=Math.ceil(Math.log2(n.count||2));const d=null!=(m=l._parameterBits)?m:
[0];let e=0;for(;16<d[e]+v;)e++,e>=d.length&&d.push(0);l._parameterBits=d;const g=d[e],p=(1<<v)-1<<g;d[e]+=v;Object.defineProperty(l,u,{get(){return this[h]},set(t){if(this[h]!==t&&(this[h]=t,this._keyDirty=!0,this._parameterBits[e]=this._parameterBits[e]&~p|+t<<g&p,"number"!==typeof t&&"boolean"!==typeof t))throw"Configuration value for "+u+" must be boolean or number, got "+typeof t;}})}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DefaultVertexBufferLayouts":function(){define(["exports",
"./VertexAttribute","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c,n){const l=[new n.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,12)],u=[new n.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,20),new n.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,12,20)],v=[new n.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,32),new n.VertexElementDescriptor(b.VertexAttribute.NORMAL,3,
c.DataType.FLOAT,12,32),new n.VertexElementDescriptor(b.VertexAttribute.UV0,2,c.DataType.FLOAT,24,32)],m=[new n.VertexElementDescriptor(b.VertexAttribute.POSITION,3,c.DataType.FLOAT,0,16),new n.VertexElementDescriptor(b.VertexAttribute.COLOR,4,c.DataType.UNSIGNED_BYTE,12,16)],h=[new n.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,8)];b=[new n.VertexElementDescriptor(b.VertexAttribute.POSITION,2,c.DataType.FLOAT,0,16),new n.VertexElementDescriptor(b.VertexAttribute.UV0,2,
c.DataType.FLOAT,8,16)];a.Pos2=h;a.Pos2Tex=b;a.Pos3=l;a.Pos3Col=m;a.Pos3NormalTex=v;a.Pos3Tex=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/VertexElementDescriptor":function(){define(["exports"],function(a){a.VertexElementDescriptor=function(b,c,n,l,u,v=!1,m=0){this.name=b;this.count=c;this.type=n;this.offset=l;this.stride=u;this.normalized=v;this.divisor=m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/glUtil3D":function(){define("exports ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/Texture ../../../webgl/VertexArrayObject".split(" "),function(a,b,c,n,l,u,v){a.createColorTexture=function(m,h,d=4){const e=new Uint8Array(d*d*4);for(let g=0;g<e.length;g+=4)e[g+0]=255*h[0],e[g+1]=255*h[1],e[g+2]=255*h[2],e[g+3]=255*h[3];return new u.Texture(m,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,
dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,width:d,height:d},e)};a.createEmptyDepthTexture=function(m){return new u.Texture(m,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([255,255,255,255]))};a.createEmptyTexture=function(m,h=4){return new u.Texture(m,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,
samplingMode:l.TextureSamplingMode.NEAREST,width:h,height:h})};a.createQuadVAO=function(m,h=c.Pos2,d=b.Default3D,e=-1,g=1){let p=null;switch(h){case c.Pos2Tex:p=new Float32Array([e,e,0,0,g,e,1,0,e,g,0,1,g,g,1,1]);break;default:p=new Float32Array([e,e,g,e,e,g,g,g])}return new v.VertexArrayObject(m,d,{geometry:h},{geometry:n.BufferObject.createVertex(m,l.Usage.STATIC_DRAW,p)})};a.createScreenSizeTriangleVAO=function(m,h=c.Pos2,d=b.Default3D){const e=new Float32Array([-1,-1,3,-1,-1,3]);return new v.VertexArrayObject(m,
d,{geometry:h},{geometry:n.BufferObject.createVertex(m,l.Usage.STATIC_DRAW,e)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/BufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/Logger ../../core/maybe ../../core/typedArrayUtil ./checkWebGLError ./context-util ./enums".split(" "),function(a,b,c,n,l,u,v,m,h){const d=n.getLogger("esri.views.webgl.BufferObject");n=function(){function e(p,
t,q,k){this._context=p;this.bufferType=t;this.usage=q;this._glName=null;this._size=-1;this._indexType=void 0;p.instanceCounter.increment(h.ResourceType.BufferObject,this);this._glName=this._context.gl.createBuffer();v.checkWebGLError(this._context.gl);k&&this.setData(k)}e.createIndex=function(p,t,q){return new e(p,h.BufferType.ELEMENT_ARRAY_BUFFER,t,q)};e.createVertex=function(p,t,q){return new e(p,h.BufferType.ARRAY_BUFFER,t,q)};e.createUniform=function(p,t,q){if(p.type!==m.ContextType.WEBGL2)throw Error("Uniform buffers are supported in WebGL2 only!");
return new e(p,h.BufferType.UNIFORM_BUFFER,t,q)};e.createPixelPack=function(p,t=h.Usage.STREAM_READ,q){if(p.type!==m.ContextType.WEBGL2)throw Error("Pixel pack buffers are supported in WebGL2 only!");p=new e(p,h.BufferType.PIXEL_PACK_BUFFER,t);q&&p.setSize(q);return p};e.createPixelUnpack=function(p,t=h.Usage.STREAM_DRAW,q){if(p.type!==m.ContextType.WEBGL2)throw Error("Pixel unpack buffers are supported in WebGL2 only!");return new e(p,h.BufferType.PIXEL_UNPACK_BUFFER,t,q)};var g=e.prototype;g.dispose=
function(){var p;null!=(p=this._context)&&p.gl?(this._glName&&(this._context.gl.deleteBuffer(this._glName),this._glName=null),this._context.instanceCounter.decrement(h.ResourceType.BufferObject,this),this._context=null):this._glName&&d.warn("Leaked WebGL buffer object")};g.setSize=function(p,t=null){0>=p&&d.error("Buffer size needs to be positive!");if(this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER&&l.isSome(t))switch(this._indexType=t,t){case h.DataType.UNSIGNED_SHORT:p*=2;break;case h.DataType.UNSIGNED_INT:p*=
4}this._setBufferData(p)};g.setData=function(p){if(p){var t=p.byteLength;this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER&&(u.isUint16Array(p)&&(t/=2,this._indexType=h.DataType.UNSIGNED_SHORT),u.isUint32Array(p)&&(t/=4,this._indexType=h.DataType.UNSIGNED_INT));this._setBufferData(t,p)}};g._setBufferData=function(p,t=null){this._size=p;const q=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);const k=this._context.gl;l.isSome(t)?k.bufferData(this.bufferType,
t,this.usage):k.bufferData(this.bufferType,p,this.usage);v.checkWebGLError(k);this._isVAOAware&&this._context.bindVAO(q)};g.setSubData=function(p,t=0,q=0,k=p.byteLength){if(p){(0>t||t>=this._size)&&d.error("offset is out of range!");var r=t,y=q,f=k,w=p.byteLength;this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER&&(u.isUint16Array(p)?(w/=2,r*=2,y*=2,f*=2):u.isUint32Array(p)&&(w/=4,r*=4,y*=4,f*=4));void 0===k&&(k=w-1);q>=k&&d.error("end must be bigger than start!");t+q-k>this._size&&d.error("An attempt to write beyond the end of the buffer!");
t=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);q=this._context.gl;k=ArrayBuffer.isView(p)?p.buffer:p;p=0===y&&f===p.byteLength?k:k.slice(y,f);q.bufferSubData(this.bufferType,r,p);v.checkWebGLError(q);this._isVAOAware&&this._context.bindVAO(t)}};g.setSubDataFromView=function(p,t,q,k){if(p){(0>t||t>=this._size)&&d.error("offset is out of range!");q>=k&&d.error("end must be bigger than start!");t+q-k>this._size&&d.error("An attempt to write beyond the end of the buffer!");
var r=this._context.getBoundVAO();this._isVAOAware&&this._context.bindVAO(null);this._context.bindBuffer(this);var y=this._context.gl;this._context.type===m.ContextType.WEBGL2?y.bufferSubData(this.bufferType,t*p.BYTES_PER_ELEMENT,p,q,k-q):(q=0===q&&k===p.length?p:p.subarray(q,k),y.bufferSubData(this.bufferType,t*p.BYTES_PER_ELEMENT,q));v.checkWebGLError(y);this._isVAOAware&&this._context.bindVAO(r)}};g.getSubData=function(p,t=0,q,k){if(this._context.type!==m.ContextType.WEBGL2)d.error("Get buffer subdata is supported in WebGL2 only!");
else if(0>q||0>k)d.error("Problem getting subdata: offset and length were less than zero!");else{var r=c.isArrayLike(p)?p.BYTES_PER_ELEMENT:1;r*((null!=q?q:0)+(null!=k?k:0))>p.byteLength?d.error("Problem getting subdata: offset and length exceeded destination size!"):(t+r*(null!=k?k:0)>this.byteSize&&d.warn("Potential problem getting subdata: requested data exceeds buffer size!"),r=this._context.gl,this._context.bindBuffer(this,h.BufferType.COPY_READ_BUFFER),r.getBufferSubData(h.BufferType.COPY_READ_BUFFER,
t,p,q,k),this._context.unbindBuffer(h.BufferType.COPY_READ_BUFFER))}};g.getSubDataAsync=function(){var p=b._asyncToGenerator(function*(t,q=0,k,r){this._context.type!==m.ContextType.WEBGL2?d.error("Get buffer subdata is supported in WebGL2 only!"):(yield this._context.clientWaitAsync(),this.getSubData(t,q,k,r))});return function(t){return p.apply(this,arguments)}}();b._createClass(e,[{key:"glName",get:function(){return this._glName}},{key:"size",get:function(){return this._size}},{key:"indexType",
get:function(){return this._indexType}},{key:"byteSize",get:function(){return this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER?this._indexType===h.DataType.UNSIGNED_INT?4*this._size:2*this._size:this._size}},{key:"_isVAOAware",get:function(){return this.bufferType===h.BufferType.ELEMENT_ARRAY_BUFFER||this.bufferType===h.BufferType.ARRAY_BUFFER}}]);return e}();a.BufferObject=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/context-util":function(){define(["exports",
"../../core/has","../../core/maybe"],function(a,b,c){function n(m){const h=b("esri-force-webgl");if(h===a.ContextType.WEBGL1||h===a.ContextType.WEBGL2)return[h];switch(m){case "2d":return b("mac")&&b("chrome")?[a.ContextType.WEBGL1,a.ContextType.WEBGL2]:[a.ContextType.WEBGL2,a.ContextType.WEBGL1];case "3d":return[a.ContextType.WEBGL2,a.ContextType.WEBGL1]}}function l(m,h,d={}){if(!window.WebGLRenderingContext)return v(m,'This page requires a browser that supports WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org"\x3eClick here to upgrade your browser.\x3c/a\x3e'),
null;h=u(m,h,d);c.isNone(h)&&v(m,'It doesn\'t appear your computer can support WebGL.\x3cbr/\x3e\x3ca href\x3d"http://get.webgl.org/troubleshooting/"\x3eClick here for more information.\x3c/a\x3e');return h}function u(m,h,d={}){h=h===a.ContextType.WEBGL1?["webgl","experimental-webgl","webkit-3d","moz-webgl"]:["webgl2"];let e=null;for(const g of h){try{e=m.getContext(g,d)}catch(p){}if(e)break}return e}function v(m,h){(m=m.parentNode)&&(m.innerHTML='\x3ctable style\x3d"background-color: #8CE; width: 100%; height: 100%;"\x3e\x3ctr\x3e\x3ctd align\x3d"center"\x3e\x3cdiv style\x3d"display: table-cell; vertical-align: middle;"\x3e\x3cdiv style\x3d""\x3e'+
h+"\x3c/div\x3e\x3c/div\x3e\x3c/td\x3e\x3c/tr\x3e\x3c/table\x3e")}a.ContextType=void 0;(function(m){m[m.WEBGL1=1]="WEBGL1";m[m.WEBGL2=2]="WEBGL2"})(a.ContextType||(a.ContextType={}));a.createContext=u;a.createContextOrErrorHTML=function(m,h,d={}){for(m=n(m);1<m.length;){const e=u(h,m.shift(),d);if(c.isSome(e))return e}return l(h,m.shift(),d)};a.getContextTypes=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Texture":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ../../core/mathUtils ../../core/maybe ./checkWebGLError ./context-util ./enums ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,n,l,u,v,m,h){function d(t){return l.isSome(t)&&"type"in t&&"compressed"===t.type}function e(t){var q;if(q=l.isSome(t)&&!d(t))q=!(l.isSome(t)&&"byteLength"in t);return q}function g(t){return t===m.TextureType.TEXTURE_3D||t===m.TextureType.TEXTURE_2D_ARRAY}function p(t,q,k,r=1){q=Math.max(q,k);t===m.TextureType.TEXTURE_3D&&(q=Math.max(q,r));return Math.round(Math.log(q)/Math.LN2)+1}c=function(){function t(k,r,y=null){this._context=k;this.type="texture";this._glName=null;this._descriptor=
void 0;this._wasImmutablyAllocated=this._wrapModeDirty=this._samplingModeDirty=!1;k.instanceCounter.increment(m.ResourceType.Texture,this);this._descriptor={target:m.TextureType.TEXTURE_2D,samplingMode:m.TextureSamplingMode.LINEAR,wrapMode:m.TextureWrapMode.REPEAT,flipped:!1,hasMipmap:!1,isOpaque:!1,unpackAlignment:4,preMultiplyAlpha:!1,isImmutable:!1,...r};if(k.type!==v.ContextType.WEBGL2&&(this._descriptor.isImmutable&&(this._descriptor.isImmutable=!1),g(this._descriptor.target)))throw Error("3D and array textures are not supported in WebGL1");
this._descriptor.target===m.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(y):this.setData(y)}var q=t.prototype;q.dispose=function(){this._context.gl&&this._glName&&(this._context.unbindTexture(this),this._context.gl.deleteTexture(this._glName),this._glName=null,this._context.instanceCounter.decrement(m.ResourceType.Texture,this))};q.release=function(){this.dispose()};q.resize=function(k,r){const y=this._descriptor;if(y.width!==k||y.height!==r){if(this._wasImmutablyAllocated)throw Error("Immutable textures can't be resized!");
y.width=k;y.height=r;this._descriptor.target===m.TextureType.TEXTURE_CUBE_MAP?this._setDataCubeMap(null):this.setData(null)}};q._setDataCubeMap=function(k=null){for(let r=m.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X;r<=m.TextureType.TEXTURE_CUBE_MAP_NEGATIVE_Z;r++)this._setData(k,r)};q.setData=function(k){this._setData(k)};q._setData=function(k,r){var y;if(this._context&&this._context.gl){var f=this._context.gl;this._glName||(this._glName=f.createTexture());void 0===k&&(k=null);var w=this._descriptor;
null!=(y=r)?y:r=w.target;y=g(r);if(null===k&&(w.width=w.width||4,w.height=w.height||4,y)){var z;w.depth=null!=(z=w.depth)?z:1}z=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);t._validateTexture(this._context,w);this._configurePixelStorage();var A=w.pixelFormat,x=w.internalFormat?w.internalFormat:this._deriveInternalFormat(A,w.dataType);if(e(k)){A=k.width;let B=k.height;k instanceof HTMLVideoElement&&(A=k.videoWidth,B=k.videoHeight);
w.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(r,x,w.hasMipmap,A,B,1);this._texImage(r,0,x,A,B,1,k);u.checkWebGLError(f);w.hasMipmap&&this.generateMipmap();void 0===w.width&&(w.width=A);void 0===w.height&&(w.height=B);y&&void 0===w.depth&&(w.depth=1)}else{const {width:B,height:C,depth:D}=w;null!=B&&null!=C||console.error("Width and height must be specified!");y&&null==D&&console.error("Depth must be specified!");w.isImmutable&&!this._wasImmutablyAllocated&&this._texStorage(r,x,w.hasMipmap,
B,C,D);f.DEPTH24_STENCIL8&&x===f.DEPTH_STENCIL&&(x=f.DEPTH24_STENCIL8);if(d(k)){const E=k.levels;k=p(r,B,C,D);y=Math.min(k-1,E.length-1);h(f)?f.texParameteri(w.target,f.TEXTURE_MAX_LEVEL,y):w.hasMipmap=w.hasMipmap&&k===E.length;const F=x;if(!(F in m.CompressedTextureFormat))throw Error("Attempting to use compressed data with an umcompressed format!");this._forEachMipmapLevel((G,O,K,L)=>{this._compressedTexImage(r,G,F,O,K,L,E[Math.min(G,E.length-1)])},y)}else l.isSome(k)?(this._texImage(r,0,x,B,C,
D,k),u.checkWebGLError(f),w.hasMipmap&&this.generateMipmap()):this._forEachMipmapLevel((E,F,G,O)=>{this._texImage(r,E,x,F,G,O,null);u.checkWebGLError(f)})}t._applySamplingMode(f,this._descriptor);t._applyWrapMode(f,this._descriptor);t._applyAnisotropicFilteringParameters(this._context,this._descriptor);u.checkWebGLError(f);this._context.bindTexture(z,t.TEXTURE_UNIT_FOR_UPDATES)}};q.updateData=function(k,r,y,f,w,z){z||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");
const A=this._context.gl,x=this._descriptor,{pixelFormat:B,internalFormat:C,dataType:D,isImmutable:E,target:F}=x;if(E&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");const G=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);(0>r||0>y||f>x.width||w>x.height||r+f>x.width||y+w>x.height)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();e(z)?A.texSubImage2D(F,k,r,y,B,D,z):d(z)?A.compressedTexSubImage2D(F,
k,r,y,f,w,C,z.levels[k]):A.texSubImage2D(F,k,r,y,f,w,B,D,z);this._context.bindTexture(G,t.TEXTURE_UNIT_FOR_UPDATES)};q.updateData3D=function(k,r,y,f,w,z,A,x){x||console.error("An attempt to use uninitialized data!");this._glName||console.error("An attempt to update uninitialized texture!");const B=this._context.gl;if(!h(B))throw Error("3D textures are not supported in WebGL1");const C=this._descriptor,{pixelFormat:D,dataType:E,isImmutable:F,target:G,internalFormat:O}=C;if(F&&!this._wasImmutablyAllocated)throw Error("Cannot update immutable texture before allocation!");
g(G)||console.warn("Attempting to set 3D texture data on a non-3D texture");const K=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);(0>r||0>y||0>f||w>C.width||z>C.height||A>C.depth||r+w>C.width||y+z>C.height||f+A>C.depth)&&console.error("An attempt to update out of bounds of the texture!");this._configurePixelStorage();d(x)?(x=x.levels[k],B.compressedTexSubImage3D(G,k,r,y,f,w,z,A,O,x)):B.texSubImage3D(G,k,r,y,f,w,z,A,D,E,x);this._context.bindTexture(K,
t.TEXTURE_UNIT_FOR_UPDATES)};q.generateMipmap=function(){const k=this._descriptor;if(!k.hasMipmap){if(this._wasImmutablyAllocated)throw Error("Cannot add mipmaps to immutable texture after allocation");this._samplingModeDirty=k.hasMipmap=!0;t._validateTexture(this._context,k)}k.samplingMode===m.TextureSamplingMode.LINEAR?(this._samplingModeDirty=!0,k.samplingMode=m.TextureSamplingMode.LINEAR_MIPMAP_NEAREST):k.samplingMode===m.TextureSamplingMode.NEAREST&&(this._samplingModeDirty=!0,k.samplingMode=
m.TextureSamplingMode.NEAREST_MIPMAP_NEAREST);const r=this._context.bindTexture(this,t.TEXTURE_UNIT_FOR_UPDATES);this._context.setActiveTexture(t.TEXTURE_UNIT_FOR_UPDATES);this._context.gl.generateMipmap(k.target);this._context.bindTexture(r,t.TEXTURE_UNIT_FOR_UPDATES)};q.setSamplingMode=function(k){k!==this._descriptor.samplingMode&&(this._descriptor.samplingMode=k,this._samplingModeDirty=!0)};q.setWrapMode=function(k){k!==this._descriptor.wrapMode&&(this._descriptor.wrapMode=k,t._validateTexture(this._context,
this._descriptor),this._wrapModeDirty=!0)};q.applyChanges=function(){const k=this._context.gl,r=this._descriptor;this._samplingModeDirty&&(t._applySamplingMode(k,r),this._samplingModeDirty=!1);this._wrapModeDirty&&(t._applyWrapMode(k,r),this._wrapModeDirty=!1)};q._deriveInternalFormat=function(k,r){if(this._context.type===v.ContextType.WEBGL1)return k;switch(r){case m.PixelType.FLOAT:switch(k){case m.PixelFormat.RGBA:return m.SizedPixelFormat.RGBA32F;case m.PixelFormat.RGB:return m.SizedPixelFormat.RGB32F;
default:throw Error("Unable to derive format");}case m.PixelType.UNSIGNED_BYTE:switch(k){case m.PixelFormat.RGBA:return m.SizedPixelFormat.RGBA8;case m.PixelFormat.RGB:return m.SizedPixelFormat.RGB8}default:return k}};q._configurePixelStorage=function(){const k=this._context.gl,{unpackAlignment:r,flipped:y,preMultiplyAlpha:f}=this._descriptor;k.pixelStorei(k.UNPACK_ALIGNMENT,r);k.pixelStorei(k.UNPACK_FLIP_Y_WEBGL,y?1:0);k.pixelStorei(k.UNPACK_PREMULTIPLY_ALPHA_WEBGL,f?1:0)};q._texStorage=function(k,
r,y,f,w,z){const A=this._context.gl;if(!h(A))throw Error("Immutable textures are not supported in WebGL1");if(!(r in m.SizedPixelFormat))throw Error("Immutable textures must have a sized internal format");this._descriptor.isImmutable&&(y=y?p(k,f,w,z):1,g(k)?A.texStorage3D(k,y,r,f,w,z):A.texStorage2D(k,y,r,f,w),this._wasImmutablyAllocated=!0)};q._texImage=function(k,r,y,f,w,z,A){const x=this._context.gl;let B=null;const C=this._context.type===v.ContextType.WEBGL2,D=g(k),{isImmutable:E,pixelFormat:F,
dataType:G}=this._descriptor;C&&(B=x);!C&&e(A)?x.texImage2D(k,0,y,F,G,A):E?l.isSome(A)&&(D?B.texSubImage3D(k,r,0,0,0,f,w,z,F,G,A):x.texSubImage2D(k,r,0,0,f,w,F,G,A)):(A=l.unwrap(A),D?B.texImage3D(k,r,y,f,w,z,0,F,G,A):x.texImage2D(k,r,y,f,w,0,F,G,A))};q._compressedTexImage=function(k,r,y,f,w,z,A){const x=this._context.gl;let B=null;const C=g(k),D=this._descriptor.isImmutable;if(C){if(this._context.type!==v.ContextType.WEBGL2)throw Error("3D textures are not supported in WebGL1");B=x}D?l.isSome(A)&&
(C?B.compressedTexSubImage3D(k,r,0,0,0,f,w,z,y,A):x.compressedTexSubImage2D(k,r,0,0,f,w,y,A)):C?B.compressedTexImage3D(k,r,y,f,w,z,0,A):x.compressedTexImage2D(k,r,y,f,w,0,A)};q._forEachMipmapLevel=function(k,r=Infinity){let {width:y,height:f,depth:w,hasMipmap:z,target:A}=this._descriptor;const x=A===m.TextureType.TEXTURE_3D;for(let B=0;;++B){k(B,y,f,w);if(!z||1===y&&1===f&&(!x||1===w)||B>=r)break;y=Math.max(1,y>>1);f=Math.max(1,f>>1);x&&(w=Math.max(1,w>>1))}};t._validateTexture=function(k,r){(0>r.width||
0>r.height||0>r.depth)&&console.error("Negative dimension parameters are not allowed!");k=h(k.gl);const y=n.isPowerOfTwo(r.width)&&n.isPowerOfTwo(r.height);k||!r.isImmutable&&!g(r.target)||console.error("Immutable and 3D-like textures are not supported in WebGL1!");k||y||("number"===typeof r.wrapMode?r.wrapMode!==m.TextureWrapMode.CLAMP_TO_EDGE&&console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"):(r.wrapMode.s!==m.TextureWrapMode.CLAMP_TO_EDGE||r.wrapMode.t!==m.TextureWrapMode.CLAMP_TO_EDGE)&&
console.error("Non-power-of-two textures must have a wrap mode of CLAMP_TO_EDGE!"),r.hasMipmap&&console.error("Mipmapping requires power-of-two textures!"))};t._applySamplingMode=function(k,r){let y=r.samplingMode,f=r.samplingMode;if(y===m.TextureSamplingMode.LINEAR_MIPMAP_NEAREST||y===m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR)y=m.TextureSamplingMode.LINEAR,r.hasMipmap||(f=m.TextureSamplingMode.LINEAR);else if(y===m.TextureSamplingMode.NEAREST_MIPMAP_NEAREST||y===m.TextureSamplingMode.NEAREST_MIPMAP_LINEAR)y=
m.TextureSamplingMode.NEAREST,r.hasMipmap||(f=m.TextureSamplingMode.NEAREST);k.texParameteri(r.target,k.TEXTURE_MAG_FILTER,y);k.texParameteri(r.target,k.TEXTURE_MIN_FILTER,f)};t._applyWrapMode=function(k,r){"number"===typeof r.wrapMode?(k.texParameteri(r.target,k.TEXTURE_WRAP_S,r.wrapMode),k.texParameteri(r.target,k.TEXTURE_WRAP_T,r.wrapMode)):(k.texParameteri(r.target,k.TEXTURE_WRAP_S,r.wrapMode.s),k.texParameteri(r.target,k.TEXTURE_WRAP_T,r.wrapMode.t))};t._applyAnisotropicFilteringParameters=function(k,
r){var y;const f=k.capabilities.textureFilterAnisotropic;f&&k.gl.texParameterf(r.target,f.TEXTURE_MAX_ANISOTROPY,null!=(y=r.maxAnisotropy)?y:1)};b._createClass(t,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",get:function(){return this._descriptor}},{key:"isDirty",get:function(){return this._samplingModeDirty||this._wrapModeDirty}}]);return t}();c.TEXTURE_UNIT_FOR_UPDATES=0;a.Texture=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/capabilities/isWebGL2Context":function(){define(function(){return function(a){return window.WebGL2RenderingContext&&a instanceof window.WebGL2RenderingContext}})},"esri/views/webgl/VertexArrayObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./enums ./Util".split(" "),function(a,b,c,n,l,u){const v=c.getLogger("esri.views.webgl.VertexArrayObject");c=function(){function m(d,e,g,p,t=null){this._context=d;this._locations=e;this._layout=
g;this._buffers=p;this._indexBuffer=t;this._glName=null;this._initialized=!1;d.instanceCounter.increment(l.ResourceType.VertexArrayObject,this)}var h=m.prototype;h.dispose=function(d=!0){if(this._context){if(this._glName){var e,g;const p=null==(e=this._context)?void 0:null==(g=e.capabilities)?void 0:g.vao;p?(p.deleteVertexArray(this._glName),this._glName=null):v.warn("Leaked WebGL VAO")}this._context.getBoundVAO()===this&&this._context.bindVAO(null);if(d){for(const p in this._buffers)this._buffers[p].dispose(),
delete this._buffers[p];this._indexBuffer=n.disposeMaybe(this._indexBuffer)}this._context.instanceCounter.decrement(l.ResourceType.VertexArrayObject,this);this._context=null}else(this._glName||d&&0<Object.getOwnPropertyNames(this._buffers).length)&&v.warn("Leaked WebGL VAO")};h.initialize=function(){if(!this._initialized){var d=this._context.capabilities.vao;if(d){const e=d.createVertexArray();d.bindVertexArray(e);this._bindLayout();d.bindVertexArray(null);this._glName=e}this._initialized=!0}};h.bind=
function(){this.initialize();const d=this._context.capabilities.vao;d?d.bindVertexArray(this.glName):(this._context.bindVAO(null),this._bindLayout())};h._bindLayout=function(){const {_buffers:d,_layout:e,_indexBuffer:g}=this;d||v.error("Vertex buffer dictionary is empty!");const p=this._context.gl;for(const t in d){const q=d[t];q||v.error("Vertex buffer is uninitialized!");const k=e[t];k||v.error("Vertex element descriptor is empty!");u.bindVertexBufferLayout(this._context,this._locations,q,k)}n.isSome(g)&&
(this._context.capabilities.vao?p.bindBuffer(p.ELEMENT_ARRAY_BUFFER,g.glName):this._context.bindBuffer(g))};h.unbind=function(){this.initialize();const d=this._context.capabilities.vao;d?d.bindVertexArray(null):this._unbindLayout()};h._unbindLayout=function(){const {_buffers:d,_layout:e}=this;d||v.error("Vertex buffer dictionary is empty!");for(const g in d){const p=d[g];p||v.error("Vertex buffer is uninitialized!");u.unbindVertexBufferLayout(this._context,this._locations,p,e[g])}n.isSome(this._indexBuffer)&&
this._context.unbindBuffer(this._indexBuffer.bufferType)};b._createClass(m,[{key:"glName",get:function(){return this._glName}},{key:"context",get:function(){return this._context}},{key:"vertexBuffers",get:function(){return this._buffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"size",get:function(){return Object.keys(this._buffers).reduce((d,e)=>d+this._buffers[e].size,n.isSome(this._indexBuffer)?this._indexBuffer.size:0)}},{key:"layout",get:function(){return this._layout}},
{key:"locations",get:function(){return this._locations}}]);return m}();a.VertexArrayObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Util":function(){define(["exports","../../core/has","../../core/maybe","./enums"],function(a,b,c,n){function l(m){return m[0].stride}function u(m){switch(m){case n.PixelFormat.ALPHA:case n.PixelFormat.LUMINANCE:case n.PixelFormat.RED:case n.PixelFormat.RED_INTEGER:case n.SizedPixelFormat.R8:case n.SizedPixelFormat.R8I:case n.SizedPixelFormat.R8UI:case n.SizedPixelFormat.R8_SNORM:case n.RenderbufferFormat.STENCIL_INDEX8:return 1;
case n.PixelFormat.LUMINANCE_ALPHA:case n.PixelFormat.RG:case n.PixelFormat.RG_INTEGER:case n.SizedPixelFormat.RGBA4:case n.SizedPixelFormat.R16F:case n.SizedPixelFormat.R16I:case n.SizedPixelFormat.R16UI:case n.SizedPixelFormat.RG8:case n.SizedPixelFormat.RG8I:case n.SizedPixelFormat.RG8UI:case n.SizedPixelFormat.RG8_SNORM:case n.SizedPixelFormat.RGB565:case n.SizedPixelFormat.RGB5_A1:case n.RenderbufferFormat.DEPTH_COMPONENT16:return 2;case n.PixelFormat.DEPTH_COMPONENT:case n.PixelFormat.RGB:case n.PixelFormat.RGB_INTEGER:case n.SizedPixelFormat.RGB8:case n.SizedPixelFormat.RGB8I:case n.SizedPixelFormat.RGB8UI:case n.SizedPixelFormat.RGB8_SNORM:case n.SizedPixelFormat.SRGB8:case n.RenderbufferFormat.DEPTH_COMPONENT24:return 3;
case n.PixelFormat.DEPTH_STENCIL:case n.PixelFormat.RGBA:case n.PixelFormat.RGBA_INTEGER:case n.SizedPixelFormat.RGBA8:case n.SizedPixelFormat.R32F:case n.SizedPixelFormat.R11F_G11F_B10F:case n.SizedPixelFormat.RG16F:case n.SizedPixelFormat.R32I:case n.SizedPixelFormat.R32UI:case n.SizedPixelFormat.RG16I:case n.SizedPixelFormat.RG16UI:case n.SizedPixelFormat.RGBA8I:case n.SizedPixelFormat.RGBA8UI:case n.SizedPixelFormat.RGBA8_SNORM:case n.SizedPixelFormat.SRGB8_ALPHA8:case n.SizedPixelFormat.RGB9_E5:case n.SizedPixelFormat.RGB10_A2UI:case n.SizedPixelFormat.RGB10_A2:case n.RenderbufferFormat.DEPTH_STENCIL:case n.RenderbufferFormat.DEPTH_COMPONENT32F:case n.RenderbufferFormat.DEPTH24_STENCIL8:return 4;
case n.RenderbufferFormat.DEPTH32F_STENCIL8:return 5;case n.SizedPixelFormat.RGB16F:case n.SizedPixelFormat.RGB16I:case n.SizedPixelFormat.RGB16UI:return 6;case n.SizedPixelFormat.RG32F:case n.SizedPixelFormat.RG32I:case n.SizedPixelFormat.RG32UI:case n.SizedPixelFormat.RGBA16F:case n.SizedPixelFormat.RGBA16I:case n.SizedPixelFormat.RGBA16UI:return 8;case n.SizedPixelFormat.RGB32F:case n.SizedPixelFormat.RGB32I:case n.SizedPixelFormat.RGB32UI:return 12;case n.SizedPixelFormat.RGBA32F:case n.SizedPixelFormat.RGBA32I:case n.SizedPixelFormat.RGBA32UI:return 16;
case n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT:case n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT1_EXT:return.5;case n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT:case n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT:return 1;case n.CompressedTextureFormat.COMPRESSED_R11_EAC:case n.CompressedTextureFormat.COMPRESSED_SIGNED_R11_EAC:case n.CompressedTextureFormat.COMPRESSED_RGB8_ETC2:case n.CompressedTextureFormat.COMPRESSED_SRGB8_ETC2:case n.CompressedTextureFormat.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:case n.CompressedTextureFormat.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:return.5;
case n.CompressedTextureFormat.COMPRESSED_RG11_EAC:case n.CompressedTextureFormat.COMPRESSED_SIGNED_RG11_EAC:case n.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:case n.CompressedTextureFormat.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:return 1}return 0}function v(m){if(c.isNone(m))return 0;if("descriptor"in m)return m.glName?v(m.descriptor):0;const h=m.internalFormat||"pixelFormat"in m&&m.pixelFormat;if(!h)return 0;const d="hasMipmap"in m&&m.hasMipmap?1.3:1;m=m.width*m.height;return u(h)*m*d}a.bindVertexBufferLayout=
function(m,h,d,e,g=0){const p=m.gl,t=m.capabilities.instancing;m.bindBuffer(d);for(const q of e)if(m=h.get(q.name),void 0===m&&console.error(`There is no location for vertex attribute '${q.name}' defined.`),d=g*q.stride,4>=q.count)p.vertexAttribPointer(m,q.count,q.type,q.normalized,q.stride,q.offset+d),p.enableVertexAttribArray(m),0<q.divisor&&t&&t.vertexAttribDivisor(m,q.divisor);else if(9===q.count)for(e=0;3>e;e++)p.vertexAttribPointer(m+e,3,q.type,q.normalized,q.stride,q.offset+12*e+d),p.enableVertexAttribArray(m+
e),0<q.divisor&&t&&t.vertexAttribDivisor(m+e,q.divisor);else if(16===q.count)for(e=0;4>e;e++)p.vertexAttribPointer(m+e,4,q.type,q.normalized,q.stride,q.offset+16*e+d),p.enableVertexAttribArray(m+e),0<q.divisor&&t&&t.vertexAttribDivisor(m+e,q.divisor);else console.error("Unsupported vertex attribute element count: "+q.count)};a.getBytesPerElementFormat=u;a.getErrorString=function(m){m=m.gl;switch(m.getError()){case m.NO_ERROR:return null;case m.INVALID_ENUM:return"An unacceptable value has been specified for an enumerated argument";
case m.INVALID_VALUE:return"A numeric argument is out of range";case m.INVALID_OPERATION:return"The specified command is not allowed for the current state";case m.INVALID_FRAMEBUFFER_OPERATION:return"The currently bound framebuffer is not framebuffer complete";case m.OUT_OF_MEMORY:return"Not enough memory is left to execute the command";case m.CONTEXT_LOST_WEBGL:return"WebGL context is lost"}return"Unknown error"};a.getGpuMemoryUsage=v;a.getStride=l;a.unbindVertexBufferLayout=function(m,h,d,e){const g=
m.gl,p=m.capabilities.instancing;m.bindBuffer(d);for(const t of e)if(d=h.get(t.name),4>=t.count)g.disableVertexAttribArray(d),t.divisor&&0<t.divisor&&p&&p.vertexAttribDivisor(d,0);else if(9===t.count)for(e=0;3>e;e++)g.disableVertexAttribArray(d+e),t.divisor&&0<t.divisor&&p&&p.vertexAttribDivisor(d+e,0);else if(16===t.count)for(e=0;4>e;e++)g.disableVertexAttribArray(d+e),t.divisor&&0<t.divisor&&p&&p.vertexAttribDivisor(d+e,0);else console.error("Unsupported vertex attribute element count: "+t.count);
m.unbindBuffer(n.BufferType.ARRAY_BUFFER)};a.vertexCount=function(m,h){return m.vertexBuffers[h].size/l(m.layout[h])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsComposition":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/support/axisAngle ./CloudsCompositionParameters ./CloudsCompositionTechnique ./CloudsData ./weather ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){a.CloudsComposition=function(G){function O(L){var R=G.call(this,L)||this;R._technique=new y.CloudsCompositionTechnique(L);R._vao=A.createQuadVAO(L.rctx);return R}b._inheritsLoose(O,G);var K=O.prototype;K.destroy=function(){this._technique=u.releaseMaybe(this._technique);this._vao=u.disposeMaybe(this._vao)};K.render=function(L,R){const M=L.bindParameters.clouds;u.isNone(this._vao)||u.isNone(M.data)||(this._technique.compiled?(this._setParallaxParameters(M,
L.bindParameters.camera.eye,R),R=L.rctx.bindTechnique(this._technique,F,L.bindParameters),L.rctx.bindVAO(this._vao),R.assertCompatibleVertexAttributeLocations(this._vao),L.rctx.drawArrays(x.PrimitiveType.TRIANGLE_STRIP,0,4),(M.crossFade.enabled||M.fadeInOut.stage!==r.FadeInOutStages.FINISHED||M.fadeIn.stage!==r.FadeInStages.FINISHED||M.fadeInOutHeight.stage!==r.FadeHeightStages.FINISHED)&&this.requestRender()):this.requestRender())};K._setFadeInStage=function(L,R){const M=performance.now(),J=L.parallax.anchorPointClouds;
L.fadeIn.stage===r.FadeInStages.FINISHED&&(L.fadeIn.factor=1,t.copy(J,D),L.fadeIn.stage=r.FadeInStages.CHANGE_ANCHOR,L.crossFade.enabled=!1,L.fadeInOut.stage=r.FadeInOutStages.FINISHED);R=t.equals(L.cameraPositionLastFrame,R);L.fadeIn.stage===r.FadeInStages.CHANGE_ANCHOR&&R&&f.ensureClouds(L.data)&&(t.copy(J,D),L.fadeIn.stage=r.FadeInStages.FADE_IN,L.startTime=M);0<L.fadeIn.factor&&L.fadeIn.stage===r.FadeInStages.FADE_IN&&(L.fadeIn.factor=1-(M-L.startTime)/500);0>=L.fadeIn.factor&&L.fadeIn.stage===
r.FadeInStages.FADE_IN&&(L.fadeIn.stage=r.FadeInStages.FINISHED,L.fadeIn.factor=0)};K._setCrossFadingStage=function(L){const R=performance.now(),{crossFade:M}=L,J=L.parallax.anchorPointClouds;L.crossFade.enabled||(t.copy(L.parallaxNew.anchorPointClouds,D),L.startTime=R,M.factor=0,L.crossFade.enabled=!0);1>M.factor&&L.crossFade.enabled&&(M.factor=(R-L.startTime)/500);1<=M.factor&&L.crossFade.enabled&&(L.crossFade.enabled=!1,M.factor=1,t.copy(J,L.parallaxNew.anchorPointClouds))};K._setFadeInOutStage=
function(L,R){const M=performance.now(),{fadeInOut:J,crossFade:I}=L;J.stage===r.FadeInOutStages.FINISHED&&(L.startTime=M,J.factor=0,J.stage=r.FadeInOutStages.FADE_OUT);1>J.factor&&J.stage===r.FadeInOutStages.FADE_OUT&&(J.factor=(M-L.startTime)/250);1<=J.factor&&J.stage===r.FadeInOutStages.FADE_OUT&&(J.factor=1,t.copy(L.parallax.anchorPointClouds,D));1<=J.factor&&J.stage===r.FadeInOutStages.FADE_OUT&&t.equals(L.cameraPositionLastFrame,R)&&(J.factor=1,J.stage=r.FadeInOutStages.SWITCH,L.crossFade.enabled=
!1,I.factor=1);f.ensureClouds(L.data)&&J.stage===r.FadeInOutStages.SWITCH&&(L.startTime=M,J.factor=1,J.stage=r.FadeInOutStages.FADE_IN,t.copy(L.parallax.anchorPointClouds,D),L.crossFade.enabled=!1,I.factor=1);0<J.factor&&J.stage===r.FadeInOutStages.FADE_IN&&(J.factor=1-(M-L.startTime)/500);0>=J.factor&&J.stage===r.FadeInOutStages.FADE_IN&&(J.stage=r.FadeInOutStages.FINISHED,J.factor=0)};K._setFadeInOutHeight=function(L,R){const M=performance.now(),J=L.fadeInOutHeight,I=(M-(J.stage===r.FadeHeightStages.FINISHED?
M:L.startTimeHeightFade))/500;J.factor+=R?-I:I;L.startTimeHeightFade=M;J.factor=l.clamp(J.factor,0,1);J.stage=r.FadeHeightStages.HEIGHT_FADE};K._setParallaxParameters=function(L,R,M){var {parallax:J}=L;0>L.fadeInOutHeight.factor&&(L.fadeInOutHeight.factor=t.length(R)-this.planetRadius>w.weatherHeightLimit?1:0);t.normalize(D,R);t.scale(D,D,this.planetRadius);0===J.anchorPointClouds[0]&&0===J.anchorPointClouds[1]&&0===J.anchorPointClouds[2]&&t.copy(J.anchorPointClouds,D);var I=t.length(t.subtract(E,
J.anchorPointClouds,D));let P=!0;I>L.fadeIn.distanceThresholdFactor*J.cloudsHeight||L.fadeIn.stage!==r.FadeInStages.FINISHED?this._setFadeInStage(L,R):I>L.fadeInOut.distanceThresholdFactor*J.cloudsHeight||L.fadeInOut.stage!==r.FadeInOutStages.FINISHED?this._setFadeInOutStage(L,R):I>L.crossFade.distanceThresholdFactor*J.cloudsHeight&&!M||L.crossFade.enabled?this._setCrossFadingStage(L):P=!1;M=t.length(R);I=M-this.planetRadius;(I>1.7*w.weatherHeightLimit||I<-w.weatherHeightLimit)&&1>L.fadeInOutHeight.factor?
L.fadeInOutHeight.factor=1:(I>w.weatherHeightLimit||I<-.35*w.weatherHeightLimit)&&1>L.fadeInOutHeight.factor?this._setFadeInOutHeight(L,!1):I<w.weatherHeightLimit&&I>-.35*w.weatherHeightLimit&&0<L.fadeInOutHeight.factor?this._setFadeInOutHeight(L,!0):L.fadeInOutHeight.stage=r.FadeHeightStages.FINISHED;J.radiusCurvatureCorrectionFactor=.84*Math.sqrt(Math.max(M*M-this.planetRadius*this.planetRadius,0))/M;k.fromPoints(B,J.anchorPointClouds,C);J.transform=p.create();g.rotate(J.transform,J.transform,C[3],
k.axis(C));P&&({parallaxNew:J}=L,k.fromPoints(B,J.anchorPointClouds,C),J.transform=p.create(),g.rotate(J.transform,J.transform,C[3],k.axis(C)));t.copy(L.cameraPositionLastFrame,R)};return O}(n);c.__decorate([v.property({constructOnly:!0})],a.CloudsComposition.prototype,"rctx",void 0);c.__decorate([v.property({constructOnly:!0})],a.CloudsComposition.prototype,"viewingMode",void 0);c.__decorate([v.property({constructOnly:!0})],a.CloudsComposition.prototype,"planetRadius",void 0);c.__decorate([v.property({constructOnly:!0})],
a.CloudsComposition.prototype,"requestRender",void 0);a.CloudsComposition=c.__decorate([e.subclass("esri.views.3d.environment.CloudsComposition")],a.CloudsComposition);const B=q.fromValues(0,0,1),C=k.create(),D=q.create(),E=q.create(),F=new z.NoParameters;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/axisAngle":function(){define("exports ../../chunks/quat ../../chunks/quatf64 ../../chunks/vec3 ./vector ./vectorStacks".split(" "),
function(a,b,c,n,l,u){function v(p=d){return[p[0],p[1],p[2],p[3]]}function m(p,t,q,k,r=v()){r[0]=p;r[1]=t;r[2]=q;r[3]=k;return r}function h(p,t){p[3]=t;return p}const d=[0,0,1,0],e=c.create(),g=c.create();a.UP=d;a.angle=function(p){return p[3]};a.axis=function(p){return p};a.compose=function(p,t,q=v()){b.setAxisAngle(e,p,p[3]);b.setAxisAngle(g,t,t[3]);b.multiply(e,g,e);return h(q,b.getAxisAngle(q,e))};a.copy=function(p,t=v()){return m(p[0],p[1],p[2],p[3],t)};a.create=v;a.fromAxisAndAngle=function(p,
t,q=v()){n.copy(q,p);q[3]=t;return q};a.fromPoints=function(p,t,q=v()){n.cross(q,p,t);n.normalize(q,q);q[3]=l.angle(p,t);return q};a.fromValues=m;a.setAngle=h;a.wrap=function(p,t,q,k){return m(p,t,q,k,u.sv4d.get())};a.wrapAxisAngle=function(p,t){return m(p[0],p[1],p[2],t,u.sv4d.get())};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsCompositionParameters":function(){define(["exports","../../../chunks/mat4f64","../../../chunks/vec3f64"],
function(a,b,c){a.FadeInStages=void 0;(function(n){n[n.FINISHED=0]="FINISHED";n[n.CHANGE_ANCHOR=1]="CHANGE_ANCHOR";n[n.FADE_IN=2]="FADE_IN"})(a.FadeInStages||(a.FadeInStages={}));a.FadeInOutStages=void 0;(function(n){n[n.FINISHED=0]="FINISHED";n[n.FADE_OUT=1]="FADE_OUT";n[n.SWITCH=2]="SWITCH";n[n.FADE_IN=3]="FADE_IN"})(a.FadeInOutStages||(a.FadeInOutStages={}));a.FadeHeightStages=void 0;(function(n){n[n.FINISHED=0]="FINISHED";n[n.HEIGHT_FADE=1]="HEIGHT_FADE"})(a.FadeHeightStages||(a.FadeHeightStages=
{}));a.CloudsCompositionParameters=function(){this.startTimeHeightFade=this.startTime=0;this.cameraPositionLastFrame=c.create();this.parallax={anchorPointClouds:c.create(),cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:b.create()};this.parallaxNew={anchorPointClouds:c.create(),cloudsHeight:1E5,radiusCurvatureCorrectionFactor:0,transform:b.create()};this.crossFade={enabled:!1,factor:0,distanceThresholdFactor:.3};this.fadeInOut={stage:a.FadeInOutStages.FINISHED,factor:0,distanceThresholdFactor:.6};
this.fadeIn={stage:a.FadeInStages.FINISHED,factor:0,distanceThresholdFactor:2};this.fadeInOutHeight={stage:a.FadeHeightStages.FINISHED,factor:-1}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsCompositionTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/CloudsComposition.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d){u=function(e){function g(t){var q;return q=e.call(this,t,null,()=>q.destroy())||this}c._inheritsLoose(g,e);var p=g.prototype;p.initializeProgram=function(t){const q=g.shader.get().build();return new m.Program(t.rctx,q,v.Default3D)};p.initializePipeline=function(){return d.makePipelineState({blending:d.simpleBlendingParams(h.BlendFactor.ONE,h.BlendFactor.SRC_ALPHA),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return g}(u.ShaderTechnique);
u.shader=new l.ReloadableShaderModule(n.CloudsCompositionShader,()=>new Promise((e,g)=>a(["./CloudsComposition.glsl"],e,g)));b.CloudsCompositionTechnique=u;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/CloudsComposition.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){function r(){const f=new q.ShaderBuilder;f.attributes.add(k.VertexAttribute.POSITION,"vec2");f.varyings.add("worldRay","vec3");const {vertex:w,fragment:z}=f;w.uniforms.add([new t.Matrix4PassUniform("inverseProjectionMatrix",(A,x)=>x.camera.inverseProjectionMatrix),new t.Matrix4PassUniform("inverseViewMatrix",(A,x)=>b.invert(y,x.camera.viewMatrix))]);w.code.add(p.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1.0, 1.0)).xyz;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0.0)).xyz;
gl_Position = vec4(position, 1.0, 1.0);
}`);z.include(d.ColorConversion);z.include(e.RgbaFloatEncoding);f.include(n.EvaluateAmbientLighting,{pbrMode:v.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2});f.include(m.PiUtils);f.include(l.Gamma);f.include(u.MainLighting,{isGround:!1});f.include(h.CloudsParallaxShading,{instancedDoublePrecision:!1,isGround:!1});z.uniforms.add([new g.Float3PassUniform("cameraPosition",(A,x)=>x.camera.eye)]);z.code.add(p.glsl`void main() {
vec4 cloudsColor = renderClouds(normalize(worldRay), cameraPosition);
gl_FragColor = vec4((1.0 - totalFadeInOut) * cloudsColor.rgb, cloudsColor.a);
}`);return f}const y=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.CloudsCompositionShader=c;a.build=r})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./PhysicallyBasedRenderingParameters.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,n,l,u,v,m,h){const d=c.create(),e=l.create();a.EvaluateAmbientLighting=function(g,p){g=g.fragment;const t=void 0!==p.lightingSphericalHarmonicsOrder?p.lightingSphericalHarmonicsOrder:2;0===t?(g.uniforms.add(new v.Float3PassUniform("lightingAmbientSH0",(q,k)=>b.set(d,k.lighting.sh.r[0],k.lighting.sh.g[0],k.lighting.sh.b[0]))),g.code.add(h.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
return ambientLight * (1.0 - ambientOcclusion);
}`)):1===t?(g.uniforms.add([new m.Float4PassUniform("lightingAmbientSH_R",(q,k)=>n.set(e,k.lighting.sh.r[0],k.lighting.sh.r[1],k.lighting.sh.r[2],k.lighting.sh.r[3])),new m.Float4PassUniform("lightingAmbientSH_G",(q,k)=>n.set(e,k.lighting.sh.g[0],k.lighting.sh.g[1],k.lighting.sh.g[2],k.lighting.sh.g[3])),new m.Float4PassUniform("lightingAmbientSH_B",(q,k)=>n.set(e,k.lighting.sh.b[0],k.lighting.sh.b[1],k.lighting.sh.b[2],k.lighting.sh.b[3]))]),g.code.add(h.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec4 sh0 = vec4(
0.282095,
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y
);
vec3 ambientLight = vec3(
dot(lightingAmbientSH_R, sh0),
dot(lightingAmbientSH_G, sh0),
dot(lightingAmbientSH_B, sh0)
);
return ambientLight * (1.0 - ambientOcclusion);
}`)):2===t&&(g.uniforms.add([new v.Float3PassUniform("lightingAmbientSH0",(q,k)=>b.set(d,k.lighting.sh.r[0],k.lighting.sh.g[0],k.lighting.sh.b[0])),new m.Float4PassUniform("lightingAmbientSH_R1",(q,k)=>n.set(e,k.lighting.sh.r[1],k.lighting.sh.r[2],k.lighting.sh.r[3],k.lighting.sh.r[4])),new m.Float4PassUniform("lightingAmbientSH_G1",(q,k)=>n.set(e,k.lighting.sh.g[1],k.lighting.sh.g[2],k.lighting.sh.g[3],k.lighting.sh.g[4])),new m.Float4PassUniform("lightingAmbientSH_B1",(q,k)=>n.set(e,k.lighting.sh.b[1],
k.lighting.sh.b[2],k.lighting.sh.b[3],k.lighting.sh.b[4])),new m.Float4PassUniform("lightingAmbientSH_R2",(q,k)=>n.set(e,k.lighting.sh.r[5],k.lighting.sh.r[6],k.lighting.sh.r[7],k.lighting.sh.r[8])),new m.Float4PassUniform("lightingAmbientSH_G2",(q,k)=>n.set(e,k.lighting.sh.g[5],k.lighting.sh.g[6],k.lighting.sh.g[7],k.lighting.sh.g[8])),new m.Float4PassUniform("lightingAmbientSH_B2",(q,k)=>n.set(e,k.lighting.sh.b[5],k.lighting.sh.b[6],k.lighting.sh.b[7],k.lighting.sh.b[8]))]),g.code.add(h.glsl`vec3 calculateAmbientIrradiance(vec3 normal, float ambientOcclusion) {
vec3 ambientLight = 0.282095 * lightingAmbientSH0;
vec4 sh1 = vec4(
0.488603 * normal.x,
0.488603 * normal.z,
0.488603 * normal.y,
1.092548 * normal.x * normal.y
);
vec4 sh2 = vec4(
1.092548 * normal.y * normal.z,
0.315392 * (3.0 * normal.z * normal.z - 1.0),
1.092548 * normal.x * normal.z,
0.546274 * (normal.x * normal.x - normal.y * normal.y)
);
ambientLight += vec3(
dot(lightingAmbientSH_R1, sh1),
dot(lightingAmbientSH_G1, sh1),
dot(lightingAmbientSH_B1, sh1)
);
ambientLight += vec3(
dot(lightingAmbientSH_R2, sh2),
dot(lightingAmbientSH_G2, sh2),
dot(lightingAmbientSH_B2, sh2)
);
return ambientLight * (1.0 - ambientOcclusion);
}`),p.pbrMode!==u.PBRMode.Normal&&p.pbrMode!==u.PBRMode.Schematic||g.code.add(h.glsl`const vec3 skyTransmittance = vec3(0.9, 0.9, 1.0);
vec3 calculateAmbientRadiance(float ambientOcclusion)
{
vec3 ambientLight = 1.2 * (0.282095 * lightingAmbientSH0) - 0.2;
return ambientLight *= (1.0 - ambientOcclusion) * skyTransmittance;
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f32 ../attributes/VertexTextureCoordinates.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/GLTextureMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){c=c.fromValues(0,.6,.2);a.PBRMode=void 0;(function(g){g[g.Disabled=0]="Disabled";g[g.Normal=1]="Normal";g[g.Schematic=2]="Schematic";g[g.Water=3]="Water";g[g.WaterOnIntegratedMesh=4]="WaterOnIntegratedMesh";g[g.COUNT=5]="COUNT"})(a.PBRMode||(a.PBRMode={}));e=function(g){function p(){return g.apply(this,arguments)||this}b._inheritsLoose(p,g);return p}(e.GLTextureMaterialBindParameters);a.PBRBindParameters=e;a.PBRSchematicMRRValues=c;a.PhysicallyBasedRenderingParameters=
function(g,p){const t=g.fragment,q=p.hasMetalnessAndRoughnessTexture||p.hasEmissionTexture||p.hasOcclusionTexture;p.pbrMode===a.PBRMode.Normal&&q&&g.include(n.VertexTextureCoordinates,p);if(p.pbrMode===a.PBRMode.Schematic)t.code.add(v.glsl`vec3 mrr = vec3(0.0, 0.6, 0.2);
vec3 emission = vec3(0.0);
float occlusion = 1.0;
void applyPBRFactors() {}
float getBakedOcclusion() { return 1.0; }`);else if(p.pbrMode===a.PBRMode.Disabled)t.code.add(v.glsl`float getBakedOcclusion() { return 1.0; }`);else if(p.pbrMode===a.PBRMode.Normal){t.code.add(v.glsl`vec3 mrr;
vec3 emission;
float occlusion;`);g=p.supportsTextureAtlas;const k=p.pbrTextureBindType;p.hasMetalnessAndRoughnessTexture&&(t.uniforms.add(k===d.BindType.Pass?h.createTexture2DPassSizeUniforms("texMetallicRoughness",r=>r.textureMetallicRoughness,g):m.createTexture2DDrawSizeUniforms("texMetallicRoughness",r=>r.textureMetallicRoughness,g)),t.code.add(v.glsl`void applyMetallnessAndRoughness(TextureLookupParameter params) {
vec3 metallicRoughness = textureLookup(texMetallicRoughness, params).rgb;
mrr[0] *= metallicRoughness.b;
mrr[1] *= metallicRoughness.g;
}`));p.hasEmissionTexture&&(t.uniforms.add(k===d.BindType.Pass?h.createTexture2DPassSizeUniforms("texEmission",r=>r.textureEmissive,g):m.createTexture2DDrawSizeUniforms("texEmission",r=>r.textureEmissive,g)),t.code.add(v.glsl`void applyEmission(TextureLookupParameter params) {
emission *= textureLookup(texEmission, params).rgb;
}`));p.hasOcclusionTexture?(t.uniforms.add(k===d.BindType.Pass?h.createTexture2DPassSizeUniforms("texOcclusion",r=>r.textureOcclusion,g):m.createTexture2DDrawSizeUniforms("texOcclusion",r=>r.textureOcclusion,g)),t.code.add(v.glsl`void applyOcclusion(TextureLookupParameter params) {
occlusion *= textureLookup(texOcclusion, params).r;
}
float getBakedOcclusion() {
return occlusion;
}`)):t.code.add(v.glsl`float getBakedOcclusion() { return 1.0; }`);t.uniforms.add(k===d.BindType.Pass?[new u.Float3PassUniform("emissionFactor",r=>r.emissiveFactor),new u.Float3PassUniform("mrrFactors",r=>r.mrrFactors)]:[new l.Float3DrawUniform("emissionFactor",r=>r.emissiveFactor),new l.Float3DrawUniform("mrrFactors",r=>r.mrrFactors)]);t.code.add(v.glsl`
    void applyPBRFactors() {
      mrr = mrrFactors;
      emission = emissionFactor;
      occlusion = 1.0;
      ${q?"vtc.uv \x3d vuv0;":""}
      ${p.hasMetalnessAndRoughnessTexture?p.supportsTextureAtlas?"vtc.size \x3d texMetallicRoughnessSize; applyMetallnessAndRoughness(vtc);":"applyMetallnessAndRoughness(vtc);":""}
      ${p.hasEmissionTexture?p.supportsTextureAtlas?"vtc.size \x3d texEmissionSize; applyEmission(vtc);":"applyEmission(vtc);":""}
      ${p.hasOcclusionTexture?p.supportsTextureAtlas?"vtc.size \x3d texOcclusionSize; applyOcclusion(vtc);":"applyOcclusion(vtc);":""}
    }
  `)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTextureCoordinates.glsl":function(){define(["exports","../../../../../../core/compilerUtils","./TextureCoordinateAttribute.glsl","../util/TextureAtlasLookup.glsl","../../shaderModules/interfaces"],function(a,b,c,n,l){a.VertexTextureCoordinates=function(u,v){u.include(c.TextureCoordinateAttribute,v);u.fragment.code.add(l.glsl`
  struct TextureLookupParameter {
    vec2 uv;
    ${v.supportsTextureAtlas?"vec2 size;":""}
  } vtc;
  `);switch(v.textureCoordinateType){case c.TextureCoordinateAttributeType.Default:u.fragment.code.add(l.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return texture2D(texture, params.uv);
}`);break;case c.TextureCoordinateAttributeType.Atlas:u.include(n.TextureAtlasLookup);u.fragment.code.add(l.glsl`vec4 textureLookup(sampler2D texture, TextureLookupParameter params) {
return textureAtlasLookup(texture, params.size, params.uv, vuvRegion);
}`);break;default:b.neverReached(v.textureCoordinateType);case c.TextureCoordinateAttributeType.None:case c.TextureCoordinateAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/TextureAtlasLookup.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.TextureAtlasLookup=function(c){c.extensions.add("GL_EXT_shader_texture_lod");c.extensions.add("GL_OES_standard_derivatives");
c.fragment.code.add(b.glsl`#ifndef GL_EXT_shader_texture_lod
float calcMipMapLevel(const vec2 ddx, const vec2 ddy) {
float deltaMaxSqr = max(dot(ddx, ddx), dot(ddy, ddy));
return max(0.0, 0.5 * log2(deltaMaxSqr));
}
#endif
vec4 textureAtlasLookup(sampler2D texture, vec2 textureSize, vec2 textureCoordinates, vec4 atlasRegion) {
vec2 atlasScale = atlasRegion.zw - atlasRegion.xy;
vec2 uvAtlas = fract(textureCoordinates) * atlasScale + atlasRegion.xy;
float maxdUV = 0.125;
vec2 dUVdx = clamp(dFdx(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
vec2 dUVdy = clamp(dFdy(textureCoordinates), -maxdUV, maxdUV) * atlasScale;
#ifdef GL_EXT_shader_texture_lod
return texture2DGradEXT(texture, uvAtlas, dUVdx, dUVdy);
#else
vec2 dUVdxAuto = dFdx(uvAtlas);
vec2 dUVdyAuto = dFdy(uvAtlas);
float mipMapLevel = calcMipMapLevel(dUVdx * textureSize, dUVdy * textureSize);
float autoMipMapLevel = calcMipMapLevel(dUVdxAuto * textureSize, dUVdyAuto * textureSize);
return texture2D(texture, uvAtlas, mipMapLevel - autoMipMapLevel);
#endif
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"vec3",n.BindType.Draw,(h,d,e)=>h.setUniform3fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Float3DrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ./Float2DrawUniform ./Uniform ../shaderTechnique/BindType".split(" "),function(a,b,c,n,l,u,v,m){let h=function(e){function g(p,t){return e.call(this,p,"sampler2D",m.BindType.Draw,(q,k,r)=>q.bindTexture(p,t(k,
r)))||this}b._inheritsLoose(g,e);return g}(v.Uniform);const d=l.create();a.Texture2DDrawUniform=h;a.createTexture2DDrawSizeUniforms=function(e,g,p){const t=[new h(e,g)];p&&t.push(new u.Float2DrawUniform(e+"Size",(q,k)=>{q=g(q,k);return c.isSome(q)?n.set(d,q.descriptor.width,q.descriptor.height):l.ZEROS}));return t};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float2DrawUniform":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"vec2",n.BindType.Draw,(h,d,e)=>h.setUniform2fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Float2DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ./Float2PassUniform ./Uniform ../shaderTechnique/BindType".split(" "),
function(a,b,c,n,l,u,v,m){let h=function(e){function g(p,t){return e.call(this,p,"sampler2D",m.BindType.Pass,(q,k,r)=>q.bindTexture(p,t(k,r)))||this}b._inheritsLoose(g,e);return g}(v.Uniform);const d=l.create();a.Texture2DPassUniform=h;a.createTexture2DPassSizeUniforms=function(e,g,p){const t=[new h(e,g)];p&&t.push(new u.Float2PassUniform(e+"Size",(q,k)=>{q=g(q,k);return c.isSome(q)?n.set(d,q.descriptor.width,q.descriptor.height):l.ZEROS}));return t};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLTextureMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../core/shaderModules/interfaces ./basicInterfaces ./GLMaterial".split(" "),function(a,b,c,n,l,u,v){v=function(h){function d(g){var p=h.call(this,g)||this;p._numLoading=0;p._disposed=!1;p._textureRepository=g.textureRep;p._textureId=g.textureId;p._acquire(g.textureId,t=>p._texture=
t);p._acquire(g.normalTextureId,t=>p._textureNormal=t);p._acquire(g.emissiveTextureId,t=>p._textureEmissive=t);p._acquire(g.occlusionTextureId,t=>p._textureOcclusion=t);p._acquire(g.metallicRoughnessTextureId,t=>p._textureMetallicRoughness=t);return p}b._inheritsLoose(d,h);var e=d.prototype;e.dispose=function(){this._texture=c.releaseMaybe(this._texture);this._textureNormal=c.releaseMaybe(this._textureNormal);this._textureEmissive=c.releaseMaybe(this._textureEmissive);this._textureOcclusion=c.releaseMaybe(this._textureOcclusion);
this._textureMetallicRoughness=c.releaseMaybe(this._textureMetallicRoughness);this._disposed=!0};e.ensureResources=function(g){return 0===this._numLoading?u.ResourceState.LOADED:u.ResourceState.LOADING};e.updateTexture=function(g){if(c.isNone(this._texture)||g!==this._texture.id)this._texture=c.releaseMaybe(this._texture),this._textureId=g,this._acquire(this._textureId,p=>this._texture=p)};e._acquire=function(g,p){c.isNone(g)?p(null):(g=this._textureRepository.acquire(g),n.isPromiseLike(g)?(++this._numLoading,
g.then(t=>{this._disposed?(c.releaseMaybe(t),p(null)):p(t)}).finally(()=>--this._numLoading)):p(g))};b._createClass(d,[{key:"textureBindParameters",get:function(){return new m(c.isSome(this._texture)?this._texture.glTexture:null,c.isSome(this._textureNormal)?this._textureNormal.glTexture:null,c.isSome(this._textureEmissive)?this._textureEmissive.glTexture:null,c.isSome(this._textureOcclusion)?this._textureOcclusion.glTexture:null,c.isSome(this._textureMetallicRoughness)?this._textureMetallicRoughness.glTexture:
null)}}]);return d}(v);let m=function(h){function d(e=null,g=null,p=null,t=null,q=null){var k=h.call(this)||this;k.texture=e;k.textureNormal=g;k.textureEmissive=p;k.textureOcclusion=t;k.textureMetallicRoughness=q;return k}b._inheritsLoose(d,h);return d}(l.NoParameters);a.GLTextureMaterial=v;a.GLTextureMaterialBindParameters=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterial":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"./basicInterfaces"],function(a,b){return function(){function c(l){this._material=l.material;this._techniqueRepository=l.techniqueRep;this._output=l.output}var n=c.prototype;n.dispose=function(){this._techniqueRepository.release(this._technique)};n.ensureTechnique=function(l,u,v=this._output){return this._technique=this._techniqueRepository.releaseAndAcquire(l,this._material.getConfiguration(v,u),this._technique)};n.ensureResources=function(l){return b.ResourceState.LOADED};a._createClass(c,[{key:"technique",
get:function(){return this._technique}}]);return c}()})},"esri/views/3d/webgl-engine/core/shaderModules/Float4PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"vec4",n.BindType.Pass,(h,d,e)=>h.setUniform4fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Float4PassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl":function(){define(["exports","../../shaderModules/Float3PassUniform","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces"],function(a,b,c,n){a.MainLighting=function(l,u){l=l.fragment;u.isGround?l.uniforms.add(new c.FloatPassUniform("lightingFixedFactor",(v,m)=>(1-m.lighting.groundLightingFactor)*(1-m.lighting.globalFactor))):l.constants.add("lightingFixedFactor","float",0);l.uniforms.add([new b.Float3PassUniform("lightingMainDirection",
(v,m)=>m.lighting.lightingMainDirection),new b.Float3PassUniform("lightingMainIntensity",(v,m)=>m.lighting.mainLight.intensity)]);l.code.add(n.glsl`vec3 evaluateMainLighting(vec3 normal_global, float shadowing) {
float dotVal = clamp(dot(normal_global, lightingMainDirection), 0.0, 1.0);
dotVal = mix(dotVal, 1.0, lightingFixedFactor);
return lightingMainIntensity * ((1.0 - shadowing) * dotVal);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"float",n.BindType.Pass,(h,d,e)=>h.setUniform1f(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.FloatPassUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.PiUtils=function(c){c.vertex.code.add(b.glsl`const float PI = 3.141592653589793;`);c.fragment.code.add(b.glsl`const float PI = 3.141592653589793;
const float LIGHT_NORMALIZATION = 1.0 / PI;
const float INV_PI = 0.3183098861837907;
const float HALF_PI = 1.570796326794897;`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CloudsParallaxShading.glsl":function(){define("exports ../../../../../../core/mathUtils ../../../../../../core/maybe ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../geometry/support/Ellipsoid ../../../../environment/CloudsCompositionParameters ../../shaderModules/BooleanPassUniform ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/TextureCubePassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){const q=l.create();a.CloudsParallaxShading=function(k){k=k.fragment;k.uniforms.add([new p.Matrix4PassUniform("rotationMatrixClouds",(r,y)=>y.clouds.parallax.transform),new p.Matrix4PassUniform("rotationMatrixCloudsCrossFade",(r,y)=>y.clouds.parallaxNew.transform),new d.Float3PassUniform("anchorPosition",(r,y)=>y.clouds.parallax.anchorPointClouds),new d.Float3PassUniform("anchorPositionCrossFade",(r,y)=>y.clouds.parallaxNew.anchorPointClouds),new h.Float2PassUniform("cloudVariables",
(r,y)=>c.isSome(y.clouds.data)?n.set(q,y.clouds.data.coverage,y.clouds.data.absorption):l.ZEROS),new e.FloatPassUniform("cloudsHeight",(r,y)=>y.clouds.parallax.cloudsHeight),new e.FloatPassUniform("radiusCurvatureCorrectionFactor",(r,y)=>y.clouds.parallax.radiusCurvatureCorrectionFactor),new e.FloatPassUniform("totalFadeInOut",(r,y)=>y.clouds.fadeInOut.stage===v.FadeInOutStages.FINISHED?y.clouds.fadeInOutHeight.factor+Math.max(b.clamp(y.clouds.fadeIn.factor,0,1)):y.clouds.fadeInOutHeight.factor+Math.max(b.clamp(y.clouds.fadeInOut.factor,
0,1))),new e.FloatPassUniform("crossFadeAnchorFactor",(r,y)=>b.clamp(y.clouds.crossFade.factor,0,1)),new t.TextureCubePassUniform("cubeMap",(r,y)=>c.isSome(y.clouds.data)?y.clouds.data.cubeMap.colorTexture:null),new m.BooleanPassUniform("crossFade",(r,y)=>y.clouds.crossFade.enabled)]);k.constants.add("planetRadius","float",u.earth.radius);k.code.add(g.glsl`vec3 intersectWithCloudLayer(vec3 dir, vec3 cameraPosition, vec3 spherePos)
{
float radiusClouds = planetRadius + cloudsHeight;
float B = 2.0 * dot(cameraPosition, dir);
float C = dot(cameraPosition, cameraPosition) - radiusClouds * radiusClouds;
float det = B * B - 4.0 * C;
float pointIntDist = max(0.0, 0.5 *(-B + sqrt(det)));
vec3 intersectionPont = cameraPosition + dir * pointIntDist;
intersectionPont =  intersectionPont - spherePos;
return intersectionPont;
}`);k.code.add(g.glsl`vec3 correctForPlanetCurvature(vec3 dir)
{
dir.z = dir.z*(1.-radiusCurvatureCorrectionFactor) + radiusCurvatureCorrectionFactor;
return dir;
}`);k.code.add(g.glsl`vec3 rotateDirectionToAnchorPoint(mat4 rotMat, vec3 inVec)
{
return (rotMat * vec4(inVec, 0.0)).xyz;
}`);k.uniforms.add([new d.Float3PassUniform("lightingMainDirection",(r,y)=>y.lighting.lightingMainDirection),new d.Float3PassUniform("lightingMainIntensity",(r,y)=>y.lighting.mainLight.intensity)]);k.code.add(g.glsl`const float SUNSET_TRANSITION_FACTOR = 0.3;
const vec3 RIM_COLOR = vec3(0.28, 0.175, 0.035);
const float RIM_SCATTERING_FACTOR = 140.0;
const float BACKLIGHT_FACTOR = 0.2;
const float BACKLIGHT_SCATTERING_FACTOR = 10.0;
const float BACKLIGHT_TRANSITION_FACTOR = 0.3;
vec3 calculateCloudColor(vec3 cameraPosition, vec3 worldSpaceRay, vec4 clouds)
{
float upDotLight = dot(normalize(cameraPosition), normalize(lightingMainDirection));
float dirDotLight = max(dot(normalize(-worldSpaceRay), normalize(lightingMainDirection)), 0.0);
float sunsetTransition = clamp(pow(max(upDotLight, 0.0), SUNSET_TRANSITION_FACTOR), 0.0, 1.0);
vec3 ambientLight = calculateAmbientIrradiance(normalize(cameraPosition),  0.0);
vec3 mainLight = evaluateMainLighting(normalize(cameraPosition),  0.0);
vec3 combinedLight = clamp((lightingMainIntensity + ambientLight )/PI, vec3(0.0), vec3(1.0));
vec3 baseCloudColor = pow(combinedLight * pow(clouds.xyz, vec3(GAMMA)), vec3(INV_GAMMA));
float scatteringMod = max(clouds.a < 0.5 ? clouds.a / 0.5 : - clouds.a / 0.5 + 2.0, 0.0);
float rimLightIntensity = 0.5 + 0.5 *pow(max(upDotLight, 0.0), 0.35);
vec3 directSunScattering = RIM_COLOR * rimLightIntensity * pow(dirDotLight, RIM_SCATTERING_FACTOR) * scatteringMod;
float additionalLight = BACKLIGHT_FACTOR * pow(dirDotLight, BACKLIGHT_SCATTERING_FACTOR) * (1. - pow(sunsetTransition, BACKLIGHT_TRANSITION_FACTOR)) ;
return vec3(baseCloudColor * (1. + additionalLight) + directSunScattering);
}`);k.code.add(g.glsl`vec4 getCloudData(vec3 rayDir)
{
vec4 cloudData = textureCube(cubeMap, rayDir);
float mu = dot(rayDir, vec3(0, 0, 1));
return mix(vec4(vec3(clamp(1.0 - cloudVariables.y, 0.6, 1.0)), 0.0), cloudData, smoothstep(-0.01, mix(0.0, 0.075, cloudVariables.x), abs(mu)));
}`);k.code.add(g.glsl`vec4 renderCloudsNoFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
float totalTransmittance = clamp(cloudData.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudData.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), totalTransmittance);
}`);k.code.add(g.glsl`vec4 renderCloudsCrossFade(vec3 worldRay, vec3 cameraPosition)
{
vec3 intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPosition);
vec3 worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixClouds, normalize(intersectionPoint));
vec3 worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
vec4 cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColor = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
intersectionPoint = intersectWithCloudLayer(normalize(worldRay), cameraPosition, anchorPositionCrossFade);
worldRayRotated = rotateDirectionToAnchorPoint(rotationMatrixCloudsCrossFade, normalize(intersectionPoint));
worldRayRotatedCorrected = correctForPlanetCurvature(worldRayRotated);
cloudData = getCloudData(worldRayRotatedCorrected);
vec4 cloudColorCrossFade = vec4(calculateCloudColor(cameraPosition, normalize(-worldRay), cloudData), cloudData.a);
cloudColor = mix(cloudColor, cloudColorCrossFade, crossFadeAnchorFactor);
float totalTransmittance = clamp(cloudColor.a * (1.0 - totalFadeInOut) + totalFadeInOut, 0.0 , 1.0);
if (length(cloudColor.rgb) == 0.0) {
totalTransmittance = 1.0;
}
return vec4(cloudColor.rgb, totalTransmittance);
}`);k.code.add(g.glsl`vec4 renderClouds(vec3 worldRay, vec3 cameraPosition)
{
return crossFade ? renderCloudsCrossFade(worldRay, cameraPosition) : renderCloudsNoFade(worldRay, cameraPosition);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/BooleanPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"bool",n.BindType.Pass,(h,d,e)=>h.setUniform1b(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.BooleanPassUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/TextureCubePassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"samplerCube",n.BindType.Pass,(h,d,e)=>h.bindTexture(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.TextureCubePassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.ColorConversion=function(c){c.code.add(b.glsl`vec4 premultiplyAlpha(vec4 v) {
return vec4(v.rgb * v.a, v.a);
}
vec3 rgb2hsv(vec3 c) {
vec4 K = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);
vec4 p = c.g < c.b ? vec4(c.bg, K.wz) : vec4(c.gb, K.xy);
vec4 q = c.r < p.x ? vec4(p.xyw, c.r) : vec4(c.r, p.yzx);
float d = q.x - min(q.w, q.y);
float e = 1.0e-10;
return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), min(d / (q.x + e), 1.0), q.x);
}
vec3 hsv2rgb(vec3 c) {
vec4 K = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);
vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);
return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);
}
float rgb2v(vec3 c) {
return max(c.x, max(c.y, c.z));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsData":function(){define(["exports","../../../core/maybe"],function(a,b){a.ensureClouds=function(c){return b.isSome(c)&&!c.running};a.isReadyCloudsData=function(c){return b.isSome(c)&&b.isSome(c.cubeMap)&&0<c.coverage};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsGenerator":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat3 ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2f32 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../chunks/Clouds.glsl ./CloudsCompositionParameters ./CloudsPresets ./CloudsTechnique ./CloudsTechniqueConfiguration ./NoiseTextureAtlas ../webgl-engine/lib/BindParameters ../webgl-engine/lib/glUtil3D ../../support/Scheduler ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L){a.CloudsGenerator=function(P){function N(S){S=P.call(this,S)||this;S._frameTask=null;S._handles=new l;S._cubeMapSize=u("esri-mobile")?1024:2048;S._techniques=[];S._techniqueConfiguration=new D.CloudsTechniqueConfiguration;S._bindParameters=new F.BindParameters(null,null,null);S._drawParameters=new A.CloudsDrawParameters;S._weatherTile=r.fromValues(0,0);S._weatherTileCount=128;S.coverage=v.lerp(I.coverage[0],I.coverage[1],.5);
S.density=v.lerp(I.density[0],I.density[1],.5);S.absorption=v.lerp(I.absorption[0],I.absorption[1],.5);S.cloudSize=v.lerp(I.cloudSize[0],I.cloudSize[1],.5);S.detailSize=v.lerp(I.detailSize[0],I.detailSize[1],.5);S.smoothness=v.lerp(I.smoothness[0],I.smoothness[1],.5);S.cloudHeight=v.lerp(I.cloudHeight[0],I.cloudHeight[1],.5);S.raymarchingStepType=I.raymarchingStepType;S._cloudRadius=0;S._viewMatrix=k.create();S._cameraPositionLastFrame=w.create();S.running=!1;return S}b._inheritsLoose(N,P);var V=
N.prototype;V._getTechnique=function(S){const T=this._techniques[S];if(T)return T;this._techniqueConfiguration.steps=S;this._techniques[S]=new C.CloudsTechnique({rctx:this.context.renderContext.rctx,viewingMode:this.view.state.viewingMode},this._techniqueConfiguration);return this._techniques[S]};V._getWeatherTile=function(){let S=r.fromValues((this.view.camera.position.latitude+90)/180,(this.view.camera.position.longitude+180)/360);S=r.fromValues(Math.floor(2*this._weatherTileCount*S[0]),Math.floor(4*
(this._weatherTileCount-Math.floor(this._weatherTileCount*Math.abs(2*S[0]-1)))*S[1]));let T=0;var H=0;m.isSome(this.view.environment)&&"sun"===this.view.environment.lighting.type&&m.isSome(this.view.environment.lighting.date)&&(H=new Date(this.view.environment.lighting.date),H.setUTCHours(this.view.environment.lighting.date.getUTCHours()+this.view.environment.lighting.displayUTCOffset),T=31*H.getUTCMonth()+H.getUTCDate(),H=H.getUTCFullYear());S[0]=(S[0]+T)%(2*this._weatherTileCount);S[1]=(S[1]+H%
100)%(4*this._weatherTileCount);return S};V.initialize=function(){this._vao=G.createQuadVAO(this.context.renderContext.rctx);this._cloudRadius=.5*z.getReferenceEllipsoid(this.view.spatialReference).radius;this.setDirty();this._weatherTile=this._getWeatherTile();this._frameTask=this.view.resourceController.scheduler.registerTask(O.TaskPriority.CLOUDS_GENERATOR,this);this._handles.add(this._frameTask);this._handles.add(h.watch(()=>[this.coverage,this.density,this.absorption,this.cloudSize,this.detailSize,
this.smoothness,this.cloudHeight,this.raymarchingStepType],()=>this.setDirty(),h.initial))};V.destroy=function(){this._handles.destroy();this._techniques.forEach(S=>m.releaseMaybe(S));this._techniques=null;this._frameBufferCube=m.disposeMaybe(this._frameBufferCube);this._vao=m.disposeMaybe(this._vao);this._noiseTexture=m.destroyMaybe(this._noiseTexture)};V._ensureNoiseTexture=function(){m.isNone(this._noiseTexture)&&(this._noiseTexture=new E.NoiseTextureAtlas({context:this.context}),this._noiseTexture.updateWeatherMap(this._weatherTile));
return this._noiseTexture.textureAtlas};V.ensureWeatherTile=function(){const S=this._getWeatherTile();m.isSome(this._noiseTexture)&&m.isSome(this.context)&&this._noiseTexture.updateWeatherMap(S);if(S[0]!==this._weatherTile[0]||S[1]!==this._weatherTile[1])this._weatherTile=S,this.setDirty()};V.isFading=function(S){return S.crossFade.enabled||S.fadeInOut.stage===x.FadeInOutStages.FADE_OUT||S.fadeInOutHeight.stage!==x.FadeHeightStages.FINISHED};V.applyPreset=function(S,T){const H=S.median,U=W=>{const Q=
v.lerp(W[0],W[1],H);return.5>T?v.lerp(W[0],Q,2*T):v.lerp(Q,W[1],2*(T-.5))};this.coverage=U(S.coverage);this.density=U(S.density);this.absorption=U(S.absorption);this.cloudSize=U(S.cloudSize);this.detailSize=U(S.detailSize);this.smoothness=U(S.smoothness);this.cloudHeight=U(S.cloudHeight);this.raymarchingStepType=S.raymarchingStepType};V.setDirty=function(){this.running=!0};V.runTask=function(S){if(0===this.coverage||m.isNone(this._vao))this.running=!1;else{var T=this._getTechnique(this.raymarchingStepType);
if(T.compiled)if(!y.equals(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye)||this.isFading(this.context.renderContext.bindParameters.clouds))y.copy(this._cameraPositionLastFrame,this.context.renderContext.bindParameters.camera.eye);else{this.ensureWeatherTile();var H=this._ensureNoiseTexture();if(!m.isNone(H)){var U=this.context.renderContext.rctx;T=U.bindTechnique(T);var W=1+this.absorption,Q=v.lerp(35,120,this.absorption);T.bindTexture("cloudShapeTexture",H);T.setUniform1f("cloudRadius",
this._cloudRadius);T.setUniform1f("halfCubeMapSize",.5*this._cubeMapSize);T.setUniform1f("power",Q);T.setUniform1f("sigmaE",W);T.setUniform1f("density",v.lerp(0,.3,this.density));T.setUniform1f("cloudSize",v.lerp(0,.02,Math.max(.01,1-this.cloudSize)));T.setUniform1f("detailSize",v.lerp(0,.2,Math.max(.01,1-this.detailSize)));T.setUniform1f("smoothness",v.lerp(0,.5,1-this.smoothness));T.setUniform1f("cloudHeight",v.lerp(0,1500,this.cloudHeight));T.setUniform1f("coverage",this.coverage);U.bindVAO(this._vao);
T.assertCompatibleVertexAttributeLocations(this._vao);H=U.getViewport();U.setViewport(0,0,this._cubeMapSize,this._cubeMapSize);U.bindFramebuffer(this.frameBufferCube);for(W=0;5>W;W++)q.targetTo(this._viewMatrix,J,R[W],M[W]),t.fromMat4(this._drawParameters.viewMatrix,this._viewMatrix),this.frameBufferCube.setColorTextureTarget(K.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X+W),T.bindDraw(this._drawParameters,this._bindParameters),U.gl.drawArrays(U.gl.TRIANGLE_STRIP,0,4),U.gl.flush();this.running=!1;U.setViewport(H.x,
H.y,H.width,H.height);this.requestRender();S.madeProgress()}}}};b._createClass(N,[{key:"frameBufferCube",get:function(){m.isNone(this._frameBufferCube)&&(this._frameBufferCube=new L.FramebufferObject(this.context.renderContext.rctx,{colorTarget:K.TargetType.CUBEMAP,width:this._cubeMapSize,height:this._cubeMapSize},{target:K.TextureType.TEXTURE_CUBE_MAP,pixelFormat:K.PixelFormat.RGBA,dataType:K.PixelType.UNSIGNED_BYTE,wrapMode:K.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:K.TextureSamplingMode.LINEAR,
hasMipmap:!1,width:this._cubeMapSize,height:this._cubeMapSize}));return this._frameBufferCube}},{key:"cubeMap",get:function(){return this._frameBufferCube}}]);return N}(n);c.__decorate([d.property({constructOnly:!0})],a.CloudsGenerator.prototype,"context",void 0);c.__decorate([d.property({constructOnly:!0})],a.CloudsGenerator.prototype,"view",void 0);c.__decorate([d.property({constructOnly:!0})],a.CloudsGenerator.prototype,"requestRender",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,
"_frameTask",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"coverage",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"density",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"absorption",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"cloudSize",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"detailSize",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"smoothness",void 0);c.__decorate([d.property()],
a.CloudsGenerator.prototype,"cloudHeight",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"raymarchingStepType",void 0);c.__decorate([d.property()],a.CloudsGenerator.prototype,"running",void 0);a.CloudsGenerator=c.__decorate([p.subclass("esri.views.3d.environment.CloudsGenerator")],a.CloudsGenerator);const R=[f.fromValues(1,0,0),f.fromValues(-1,0,0),f.fromValues(0,1,0),f.fromValues(0,-1,0),f.fromValues(0,0,1)],M=[f.fromValues(0,1,0),f.fromValues(0,1,0),f.fromValues(0,0,-1),f.fromValues(0,
0,1),f.fromValues(0,1,0)],J=f.zeros(),I=B.cloudPresets.sunny;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec2f32":function(){define(["exports"],function(a){function b(){return new Float32Array(2)}function c(q){const k=new Float32Array(2);k[0]=q[0];k[1]=q[1];return k}function n(q,k){const r=new Float32Array(2);r[0]=q;r[1]=k;return r}function l(q,k){return new Float32Array(q,k,2)}function u(){return b()}function v(){return n(1,1)}function m(){return n(1,
0)}function h(){return n(0,1)}const d=b(),e=v(),g=m(),p=h(),t=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l,zeros:u,ones:v,unitX:m,unitY:h,ZEROS:d,ONES:e,UNIT_X:g,UNIT_Y:p},Symbol.toStringTag,{value:"Module"}));a.ONES=e;a.UNIT_X=g;a.UNIT_Y=p;a.ZEROS=d;a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.ones=v;a.unitX=m;a.unitY=h;a.vec2f32=t;a.zeros=u})},"esri/chunks/Clouds.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat3f64 ../views/3d/environment/CloudsTechniqueConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(q){const k=new d.ShaderBuilder;k.include(u.ScreenSpacePass,!1);k.fragment.uniforms.add(new v.FloatUniform("cloudRadius"));k.fragment.uniforms.add(new v.FloatUniform("halfCubeMapSize"));k.fragment.uniforms.add(new v.FloatUniform("power"));k.fragment.uniforms.add(new v.FloatUniform("sigmaE"));k.fragment.uniforms.add(new v.FloatUniform("density"));k.fragment.uniforms.add(new v.FloatUniform("cloudSize"));k.fragment.uniforms.add(new v.FloatUniform("detailSize"));
k.fragment.uniforms.add(new v.FloatUniform("smoothness"));k.fragment.uniforms.add(new v.FloatUniform("cloudHeight"));k.fragment.uniforms.add(new v.FloatUniform("coverage"));k.fragment.uniforms.add(new h.Matrix3DrawUniform("view",r=>r.viewMatrix));k.fragment.uniforms.add(new e.Texture2DUniform("cloudShapeTexture"));k.fragment.code.add(m.glsl`
    const int STEPS = ${q.steps===n.RayMarchingSteps.SIXTEEN?m.glsl`16`:q.steps===n.RayMarchingSteps.HUNDRED?m.glsl`100`:m.glsl`200`};
    const int STEPS_LIGHT = 6;
    const float stepL = 300.0 / float(STEPS_LIGHT);
    const float cloudStart = 1500.0;

    vec3 rayDirection(vec2 fragCoord) {
      vec2 xy = fragCoord - halfCubeMapSize;
      return normalize(vec3(-xy, -halfCubeMapSize));
    }

    float remap(float x, float low1, float high1, float low2, float high2) {
      return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
    }

    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }`);k.fragment.code.add(m.glsl`
    float getCloudShape(vec3 pos, float pOffset) {
      const float textureWidth = ${m.glsl.float(l.ATLAS_SIZE)};
      const float dataWidth = ${m.glsl.float(l.ATLAS_SIZE)};
      const float tileRows = ${m.glsl.float(l.TILE_ROWS)};
      const vec3 atlasDimensions = vec3(${m.glsl.float(l.TILE_SIZE)}, ${m.glsl.float(l.TILE_SIZE)}, tileRows * tileRows);

      //Change from Y being height to Z being height
      vec3 p = float(${m.glsl.float(l.TEXTURE_SCALE)}) * pos.xzy;

      //Pixel coordinates of point in the 3D data
      vec3 coord = vec3(mod(p - pOffset * atlasDimensions, atlasDimensions));
      float f = fract(coord.z);
      float level = floor(coord.z);
      float tileY = floor(level / tileRows);
      float tileX = level - tileY * tileRows;

      //The data coordinates are offset by the x and y tile, the two boundary cells between each tile pair and the initial boundary cell on the first row/column
      vec2 offset = atlasDimensions.x * vec2(tileX, tileY) + 2.0 * vec2(tileX, tileY) + 1.0;
      vec2 pixel = coord.xy + offset;
      vec2 data = texture2D(cloudShapeTexture, mod(pixel, dataWidth) / textureWidth).xy;

      return 1.0 - mix(data.x, data.y, f);
    }

    float getCloudMap(vec2 p){
      // Non-power-of-two textures can't be tiled using WebGL1
      // Get fractional part of uv to tile
      // Shift the texture center to origin to avoid seam artifacts
      vec2 uv = fract((${m.glsl.float(l.WEATHER_MAP_SCALE)} * p) / ${m.glsl.float(l.ATLAS_SIZE)} + 0.5);

      return texture2D(cloudShapeTexture, uv).a;
    }
    `);k.fragment.code.add(m.glsl`float clouds(vec3 p) {
float cloud = saturate(0.5 * mix(0.0, 1.0, min(2.0 * coverage, 1.0)));
if (cloud <= 0.0) {
return 0.0;
}
float cloudMap = getCloudMap(cloudSize * p.xy);
cloud = mix(cloud, min(2.0 * (coverage), 1.0) * cloudMap, min(2.0 * (1.0 - coverage), 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float shape = getCloudShape(8.0 * cloudSize * p, 0.0);
cloud = saturate(remap(cloud, smoothness * shape, 1.0, 0.0, 1.0));
if (cloud <= 0.0) {
return 0.0;
}
float heightFraction = saturate((length(p) - cloudRadius - cloudStart) / cloudHeight);
cloud *= saturate(remap(heightFraction, 0.0, 0.25, 0.0, 1.0)) * smoothstep(1.0, 0.25, heightFraction);
if (cloud <= 0.0) {
return 0.0;
}
return density * saturate(remap(cloud, 0.35 * smoothness * getCloudShape(detailSize * p, 0.0), 1.0, 0.0, 1.0));
}`);k.fragment.code.add(m.glsl`vec2 sphereIntersections(vec3 start, vec3 dir, float radius) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float c = dot(start, start) - (radius * radius);
float d = (b * b) - 4.0 * a * c;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}
float HenyeyGreenstein(float g, float costh) {
return (1.0 / (4.0 * 3.1415))  * ((1.0 - g * g) / pow(1.0 + g * g - 2.0 * g * costh, 1.5));
}`);k.fragment.code.add("\n    vec3 multipleOctaves(float extinction, float mu, float stepL) {\n      float attenuation \x3d 1.0;\n      float contribution \x3d 1.0;\n      float phaseAttenuation \x3d 1.0;\n      vec3 luminance \x3d vec3(0);\n\n      for (int i \x3d 0; i \x3c 4; i++) {\n        float phase \x3d mix(HenyeyGreenstein(0.0, mu), HenyeyGreenstein(0.3 * phaseAttenuation, mu), 0.7);\n        luminance +\x3d contribution * phase * exp(-stepL * extinction * sigmaE * attenuation);\n        attenuation *\x3d 0.2;\n        contribution *\x3d 0.6;\n        phaseAttenuation *\x3d 0.5;\n      }\n\n      return luminance;\n    }");
k.fragment.code.add(m.glsl`vec3 lightRay(vec3 org, vec3 p, float phaseFunction, float mu, vec3 sunDirection) {
float lightRayDensity = clouds(p);
lightRayDensity += clouds(p + sunDirection * 1.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 2.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 3.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 4.0 * stepL);
lightRayDensity += clouds(p + sunDirection * 5.0 * stepL);
vec3 beersLaw = multipleOctaves(lightRayDensity, mu, stepL);
return mix(beersLaw * 2.0 * (1.0 - (exp(-stepL * lightRayDensity * 2.0 * sigmaE ))), beersLaw, 0.5 + 0.5 * mu);
}`);k.fragment.code.add(m.glsl`vec3 mainRay(vec3 org, vec3 dir, vec3 sunDirection, float distToStart, float totalDistance, out float totalTransmittance) {
if (dir.z < 0.0) {
return vec3(0);
}
totalTransmittance = 1.0;
float stepS = totalDistance / float(STEPS);
float cameraHeight = length(org);
float mu = 0.5 + 0.5 * dot(sunDirection, dir);
float phaseFunction = mix(HenyeyGreenstein(-0.3, mu), HenyeyGreenstein(0.3, mu), 0.7);
vec3 p = org + distToStart  * dir;
float dist = distToStart;
vec3 color = vec3(0.0);
for (int i = 0; i < STEPS; i++) {
float sampleDensity = clouds(p);
float sampleSigmaE = sampleDensity * sigmaE;
if (sampleDensity > 0.0 ) {
float ambient = mix((1.2), (1.6), saturate((length(p) - cloudRadius - cloudStart) / cloudHeight));
vec3 luminance = sampleDensity * (ambient + power * phaseFunction * lightRay(org, p, phaseFunction, mu, sunDirection));
float transmittance = exp(-sampleSigmaE * stepS);
color += totalTransmittance * (luminance - luminance * transmittance) / sampleSigmaE;
totalTransmittance *= transmittance;
if (totalTransmittance <= 0.001) {
totalTransmittance = 0.0;
break;
}
}
dist += stepS;
p = org + dir * dist;
}
return color;
}`);k.fragment.code.add(m.glsl`void main() {
vec3 rayDir = rayDirection(gl_FragCoord.xy);
rayDir = normalize(view * rayDir);
vec3 viewPos = vec3(0, 0, cloudRadius + 1.0);
bool hitsPlanet = rayDir.z < 0.0;
if (hitsPlanet) {
gl_FragColor = vec4(vec3(0), 1);
return;
}
vec2 rayStartIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart);
vec2 rayEndIntersect = sphereIntersections(viewPos, rayDir, cloudRadius + cloudStart + cloudHeight);
float distToStart = rayStartIntersect.y;
float totalDistance = rayEndIntersect.y - distToStart;
float totalTransmittance = 1.0;
vec3 sunDirection = normalize(vec3(0, 0, 1));
vec3 col = 0.5 * mainRay(viewPos, rayDir, sunDirection, distToStart, totalDistance, totalTransmittance).rgb;
gl_FragColor = vec4(col, totalTransmittance);
}`);return k}let p=function(q){function k(){var r=q.apply(this,arguments)||this;r.viewMatrix=c.create();return r}b._inheritsLoose(k,q);return k}(m.NoParameters);const t=Object.freeze(Object.defineProperty({__proto__:null,CloudsDrawParameters:p,build:g},Symbol.toStringTag,{value:"Module"}));a.Clouds=t;a.CloudsDrawParameters=p;a.build=g})},"esri/views/3d/environment/CloudsTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],
function(a,b,c,n){a.RayMarchingSteps=void 0;(function(u){u[u.SIXTEEN=0]="SIXTEEN";u[u.HUNDRED=1]="HUNDRED";u[u.TWOHUNDRED=2]="TWOHUNDRED";u[u.COUNT=3]="COUNT"})(a.RayMarchingSteps||(a.RayMarchingSteps={}));let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.steps=a.RayMarchingSteps.SIXTEEN;return m}b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.RayMarchingSteps.COUNT})],l.prototype,"steps",void 0);a.CloudsTechniqueConfiguration=
l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasDimensions":function(){define(["exports","../../../core/has"],function(a,b){b=b("esri-mobile")?64:128;const c=Math.ceil(Math.sqrt(b)),n=(b+2)*c;a.ATLAS_SIZE=n;a.TEXTURE_SCALE=b/128;a.TILE_ROWS=c;a.TILE_SIZE=b;a.WEATHER_MAP_SCALE=n/1560;a.WEATHER_MAP_SIZE=1E5;a.WEATHER_TILE_SIZE=128;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass":function(){define(["exports","../shaderModules/interfaces","../../lib/VertexAttribute"],function(a,b,c){a.ScreenSpacePass=function(n,l=!0){n.attributes.add(c.VertexAttribute.POSITION,"vec2");l&&n.varyings.add("uv","vec2");n.vertex.code.add(b.glsl`
    void main(void) {
      gl_Position = vec4(position, 0.0, 1.0);
      ${l?b.glsl`uv = position * 0.5 + vec2(0.5);`:""}
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"mat3",n.BindType.Draw,(h,d,e)=>h.setUniformMatrix3fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Matrix3DrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/CloudsPresets":function(){define(["exports","./CloudsTechniqueConfiguration"],function(a,b){let c=function(n,l,u,v,m,h,d,e,g=.5){this.coverage=n;this.density=l;this.absorption=u;this.cloudSize=v;this.detailSize=m;this.smoothness=h;this.cloudHeight=d;this.raymarchingStepType=e;this.median=g};b={sunny:new c([0,.6],[.03,.03],[0,0],[.9,.9],[.8,.8],[.7,.7],[.05,.05],b.RayMarchingSteps.SIXTEEN),cloudy:new c([.3,
.65],[.2,.4],[0,0],[.85,.85],[.75,.75],[.3,.4],[1,1],b.RayMarchingSteps.TWOHUNDRED,.6),rainy:new c([.6,.8],[.5,.8],[.1,.5],[.9,.9],[.75,.75],[.5,.5],[1,1],b.RayMarchingSteps.TWOHUNDRED,.4),snowy:new c([.25,.75],[.3,.3],[0,0],[.95,.95],[.7,.7],[.69,.75],[.3,1],b.RayMarchingSteps.HUNDRED,.65),foggy:new c([.8,.8],[.5,.5],[0,0],[.95,.95],[.9,.9],[.55,.55],[.3,.3],b.RayMarchingSteps.SIXTEEN)};a.CloudPresets=c;a.cloudPresets=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/environment/CloudsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Clouds.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),function(a,b,c,n,l,u,v,m,h,d){u=function(e){function g(t,q){var k;return k=e.call(this,t,q,()=>k.destroy())||
this}c._inheritsLoose(g,e);var p=g.prototype;p.initializeProgram=function(t){const q=g.shader.get().build(this.configuration);return new m.Program(t.rctx,q,v.Default3D)};p.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ZERO),depthTest:{func:h.CompareFunction.LEQUAL},colorWrite:d.defaultColorWriteParams})};return g}(u.ShaderTechnique);u.shader=new l.ReloadableShaderModule(n.Clouds,()=>
new Promise((e,g)=>a(["./Clouds.glsl"],e,g)));b.CloudsTechnique=u;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlas":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../chunks/vec2f32 ./NoiseTextureAtlasConfiguration ./NoiseTextureAtlasDimensions ./NoiseTextureAtlasTechnique ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/FramebufferObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){n=function(t){function q(r){var y=t.call(this,r)||this;y._weatherTile=v.fromValues(0,0);y._needsRender=!0;y._frameBuffer=new p.FramebufferObject(r.context.renderContext.rctx,{colorTarget:g.TargetType.TEXTURE,width:h.ATLAS_SIZE,height:h.ATLAS_SIZE},{target:g.TextureType.TEXTURE_2D,pixelFormat:g.PixelFormat.RGBA,dataType:g.PixelType.UNSIGNED_BYTE,wrapMode:g.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:g.TextureSamplingMode.LINEAR,hasMipmap:!1,width:h.ATLAS_SIZE,height:h.ATLAS_SIZE});
y._vao=e.createQuadVAO(r.context.renderContext.rctx);y._shaderTechniqueRepository=r.context.shaderTechniqueRepository;let f;y._ensureRendered=()=>{l.isSome(f)?l.isSome(y.weatherMapTechnique)&&y.weatherMapTechnique.compiled&&y._needsRender&&(f=y._render(r.context.renderContext.rctx,m.NoiseTextureRenderMode.WeatherMap)):l.isSome(y.fullTechnique)&&y.fullTechnique.compiled&&(f=y._render(r.context.renderContext.rctx,m.NoiseTextureRenderMode.Full));return f};return y}b._inheritsLoose(q,t);var k=q.prototype;
k._setDirty=function(){this._needsRender=!0};k.updateWeatherMap=function(r){if(this._weatherTile[0]!==r[0]||this._weatherTile[1]!==r[1])this._weatherTile=r,this._setDirty()};k.destroy=function(){this._fullTechnique=l.releaseMaybe(this._fullTechnique);this._weatherMapTechnique=l.releaseMaybe(this._weatherMapTechnique);this._frameBuffer=l.disposeMaybe(this._frameBuffer);this._vao=l.disposeMaybe(this._vao)};k._render=function(r,y){if(l.isNone(this._vao)||l.isNone(this._frameBuffer))return null;var f=
y===m.NoiseTextureRenderMode.Full?this.fullTechnique:this.weatherMapTechnique;if(l.isNone(f))return null;y=r.getViewport();r.setViewport(0,0,h.ATLAS_SIZE,h.ATLAS_SIZE);r.bindFramebuffer(this._frameBuffer);f=r.bindTechnique(f);f.setUniform2f("weatherTile",this._weatherTile[0],this._weatherTile[1]);r.bindVAO(this._vao);f.assertCompatibleVertexAttributeLocations(this._vao);r.gl.drawArrays(r.gl.TRIANGLE_STRIP,0,4);r.setViewport(y.x,y.y,y.width,y.height);this._needsRender=!1;return this._frameBuffer.colorTexture};
b._createClass(q,[{key:"textureAtlas",get:function(){return this._ensureRendered()}},{key:"fullTechnique",get:function(){if(l.isNone(this._fullTechnique)){const r=new m.NoiseTextureAtlasTechniqueConfiguration;r.mode=m.NoiseTextureRenderMode.Full;this._fullTechnique=this._shaderTechniqueRepository.acquire(d.NoiseTextureAtlasTechnique,r)}return this._fullTechnique}},{key:"weatherMapTechnique",get:function(){if(l.isNone(this._weatherMapTechnique)){const r=new m.NoiseTextureAtlasTechniqueConfiguration;
r.mode=m.NoiseTextureRenderMode.WeatherMap;this._weatherMapTechnique=this._shaderTechniqueRepository.acquire(d.NoiseTextureAtlasTechnique,r)}return this._weatherMapTechnique}}]);return q}(n);c.__decorate([u.property({constructOnly:!0})],n.prototype,"context",void 0);a.NoiseTextureAtlas=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){a.NoiseTextureRenderMode=void 0;(function(u){u[u.Full=0]="Full";u[u.WeatherMap=1]="WeatherMap";u[u.COUNT=2]="COUNT"})(a.NoiseTextureRenderMode||(a.NoiseTextureRenderMode={}));let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.mode=a.NoiseTextureRenderMode.Full;return m}b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.NoiseTextureRenderMode.COUNT})],
l.prototype,"mode",void 0);a.NoiseTextureAtlasTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/NoiseTextureAtlasTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/NoiseTextureAtlas.glsl ./NoiseTextureAtlasConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){v=function(g){function p(){return g.apply(this,arguments)||this}c._inheritsLoose(p,g);var t=p.prototype;t.initializeProgram=function(q){const k=p.shader.get().build(this.configuration);return new h.Program(q.rctx,k,m.Default3D)};t.initializePipeline=function(){return e.makePipelineState({blending:this.configuration.mode===l.NoiseTextureRenderMode.Full?e.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ZERO):e.separateBlendingParams(d.BlendFactor.ZERO,d.BlendFactor.ONE,
d.BlendFactor.ONE,d.BlendFactor.ZERO),depthTest:{func:d.CompareFunction.ALWAYS},colorWrite:e.defaultColorWriteParams})};return p}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(n.NoiseTextureAtlas,()=>new Promise((g,p)=>a(["./NoiseTextureAtlas.glsl"],g,p)));b.NoiseTextureAtlasTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/NoiseTextureAtlas.glsl":function(){define("exports ../views/3d/environment/NoiseTextureAtlasConfiguration ../views/3d/environment/NoiseTextureAtlasDimensions ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder".split(" "),
function(a,b,c,n,l,u,v){function m(d){const e=new v.ShaderBuilder;e.include(n.ScreenSpacePass,!1);e.fragment.code.add(u.glsl`float remap(float x, float low1, float high1, float low2, float high2) {
return low2 + (x - low1) * (high2 - low2) / (high1 - low1);
}`);e.fragment.uniforms.add(new l.Float2Uniform("weatherTile"));d.mode===b.NoiseTextureRenderMode.Full&&e.fragment.code.add(u.glsl`
    float saturate(float x) {
      return clamp(x, 0.0, 1.0);
    }

    // Safer modulo for positive and negative values
    vec3 modulo(vec3 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec3 hash(vec3 p3, float frequency){
      p3 = modulo(p3, frequency);
      p3 = fract(p3 * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yxz + 33.33);
      return -1.0 + 2.0 * fract((p3.xxy + p3.yxx) * p3.zyx);
    }

    // 5th order polynomial interpolation
    vec3 fade(vec3 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec3 p, float frequency){
      // Cell point is in
      vec3 i = floor(p);

      // Position in the cell in [0, 1]
      vec3 f = fract(p);

      // Interpolation value for gradient mixing
      vec3 u = fade(f);

      // Trilinear interpolation of gradients at cube vertices around point
      return mix( mix( mix( dot( hash( i + vec3(0.0,0.0,0.0), frequency), f - vec3(0.0,0.0,0.0) ),
                            dot( hash( i + vec3(1.0,0.0,0.0), frequency), f - vec3(1.0,0.0,0.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,0.0), frequency), f - vec3(0.0,1.0,0.0) ),
                            dot( hash( i + vec3(1.0,1.0,0.0), frequency), f - vec3(1.0,1.0,0.0) ), u.x), u.y),
                  mix( mix( dot( hash( i + vec3(0.0,0.0,1.0), frequency), f - vec3(0.0,0.0,1.0) ),
                            dot( hash( i + vec3(1.0,0.0,1.0), frequency), f - vec3(1.0,0.0,1.0) ), u.x),
                       mix( dot( hash( i + vec3(0.0,1.0,1.0), frequency), f - vec3(0.0,1.0,1.0) ),
                            dot( hash( i + vec3(1.0,1.0,1.0), frequency), f - vec3(1.0,1.0,1.0) ), u.x), u.y), u.z );
    }

    float getPerlinNoise(vec3 pos, float frequency) {
      float octaveFrequencyFactor = 2.0;
      float sum = 0.0;
      float weightSum = 0.0;
      float weight = 1.0;

      for (int oct = 0; oct < 3; oct++) {
        vec3 p = pos * frequency;
        float val = 0.5 + 0.5 * gradientNoise(p, frequency);
        sum += val * weight;
        weightSum += weight;
        weight *= 0.5;
        frequency *= octaveFrequencyFactor;
      }

      float noise = (sum / weightSum);
      noise = saturate(noise);
      return noise;
    }

    float worley(vec3 pos, float numCells) {
      vec3 p = pos * numCells;
      float d = 1.0e10;

      for (int x = -1; x <= 1; x++) {
        for (int y = -1; y <= 1; y++) {
          for (int z = -1; z <= 1; z++) {
            vec3 tp = floor(p) + vec3(x, y, z);
            tp = p - tp - (hash(tp, numCells) * 0.5 + 0.5);
            d = min(d, dot(tp, tp));
          }
        }
      }

      return 1.0 - clamp(d, 0.0, 1.0);
    }

    vec3 get3Dfrom2D(vec2 uv) {
      vec2 tile = floor(uv);
      float z = floor(${u.glsl.float(c.TILE_ROWS)} * tile.y + tile.x);
      return vec3(fract(uv), z);
    }

    float getTextureForPointPerlinWorley(vec3 p) {
      float perlinNoise = getPerlinNoise(p, ${u.glsl.float(8)});

      float worley0 = worley(p, ${u.glsl.float(2)} * 2.0);
      float worley1 = worley(p, ${u.glsl.float(2)} * 8.0);
      float worley2 = worley(p, ${u.glsl.float(2)} * 14.0);

      float worleyFBM = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      return remap(perlinNoise, 0.0, 1.0, worleyFBM, 1.0);
    }

    float getTextureForPointWorley(vec3 p) {
      float worley0 = worley(p, ${u.glsl.float(2)});
      float worley1 = worley(p, ${u.glsl.float(2)} * 2.0);
      float worley2 = worley(p, ${u.glsl.float(2)} * 4.0);
      float worley3 = worley(p, ${u.glsl.float(2)} * 8.0);

      float FBM0 = worley0 * 0.625 + worley1 * 0.25 + worley2 * 0.125;
      float FBM1 = worley1 * 0.625 + worley2 * 0.25 + worley3 * 0.125;
      float FBM2 = worley2 * 0.75 + worley3 * 0.25;

      return FBM0 * 0.625 + FBM1 * 0.25 + FBM2 * 0.125;
    }
  `);e.fragment.code.add(u.glsl`
    vec2 modulo(vec2 m, float n){
      return mod(mod(m, n) + n, n);
    }

    vec2 hash(vec2 p){
      // Get position of p in weather tile
      p = modulo(p, ${u.glsl.float(c.WEATHER_TILE_SIZE)});

      // Get global coordinates of p
      p += weatherTile * ${u.glsl.float(c.WEATHER_TILE_SIZE)};

      // Limit position to avoid numerical instability
      p = modulo(p, ${u.glsl.float(c.WEATHER_MAP_SIZE)});

      vec3 p3 = fract(vec3(p.xyx) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return 2.0 * fract((p3.xx + p3.yz) * p3.zy) - 1.0;
    }

    vec2 fade(vec2 t){
      return (t * t * t) * (t * (t * 6.0 - 15.0) + 10.0);
    }

    float gradientNoise(vec2 p){
      vec2 i = floor( p );
      vec2 f = fract( p );

      vec2 u = fade(f);

      // Bilinear interpolation of gradients at cell vertices around point
      return  mix(
                mix(dot( hash( i + vec2(0.0,0.0) ), f - vec2(0.0,0.0) ),
                    dot( hash( i + vec2(1.0,0.0) ), f - vec2(1.0,0.0) ), u.x),
                mix(dot( hash( i + vec2(0.0,1.0) ), f - vec2(0.0,1.0) ),
                    dot( hash( i + vec2(1.0,1.0) ), f - vec2(1.0,1.0) ), u.x),
                u.y);
    }

    float worley(vec2 p){
      float d = 1.0e10;
      for (int x = -1; x <= 1; x++){
        for (int y = -1; y <= 1; y++){
                vec2 tp = floor(p) + vec2(x, y);
                tp = p - tp - (0.5 + 0.5 * hash(tp));
                d = min(d, dot(tp, tp));
            }
        }
      return 1.0 - clamp(d, 0.0, 1.0);
    }
  `);e.fragment.code.add(u.glsl`void main() {`);d.mode===b.NoiseTextureRenderMode.Full&&e.fragment.code.add(u.glsl`
        float padWidth = 1.0;
        float paddedSize = ${u.glsl.float(c.TILE_SIZE)} + 2.0 * padWidth;
        float tileCount = ${u.glsl.float(c.TILE_ROWS)} * ${u.glsl.float(c.TILE_ROWS)};
        vec2 tile = floor((gl_FragCoord.xy - 0.5) / paddedSize);

        bool padCell = false;
        if (mod(gl_FragCoord.x, paddedSize) == 0.5 || mod(gl_FragCoord.x, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        if (mod(gl_FragCoord.y, paddedSize) == 0.5 || mod(gl_FragCoord.y, paddedSize) == paddedSize - 0.5) {
          padCell = true;
        }

        bool startPadX = false;
        bool startPadY = false;
        bool endPadX = false;
        bool endPadY = false;

        if (gl_FragCoord.x == tile.x * paddedSize + 0.5) {
          startPadX = true;
        }

        if (gl_FragCoord.y == tile.y * paddedSize + 0.5) {
          startPadY = true;
        }

        if (gl_FragCoord.x == (tile.x + 1.0) * paddedSize - 0.5) {
          endPadX = true;
        }

        if (gl_FragCoord.y == (tile.y + 1.0) * paddedSize - 0.5) {
          endPadY = true;
        }

        vec2 padding = vec2(2.0 * padWidth) * tile;
        vec2 uv;

        if (padCell) {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;

          if (startPadX) {
            pixel.x += ${u.glsl.float(c.TILE_SIZE)};
          }

          if (startPadY) {
            pixel.y += ${u.glsl.float(c.TILE_SIZE)};
          }

          if (endPadX) {
            pixel.x -= ${u.glsl.float(c.TILE_SIZE)};
          }

          if (endPadY) {
            pixel.y -= ${u.glsl.float(c.TILE_SIZE)};
          }

          uv = vec2(pixel.xy / ${u.glsl.float(c.TILE_SIZE)});
        } else {
          vec2 pixel = gl_FragCoord.xy - padWidth - padding;
          uv = vec2(pixel.xy / ${u.glsl.float(c.TILE_SIZE)});
        }

        vec3 p_ = get3Dfrom2D(uv);
        vec3 p = p_;
        p.z /= (${u.glsl.float(c.TILE_ROWS)} * ${u.glsl.float(c.TILE_ROWS)});

        float worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        float worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.r = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));

        p_ = mod(p_ + 1.0, ${u.glsl.float(c.TILE_ROWS)} * ${u.glsl.float(c.TILE_ROWS)});
        p = p_;
        p.z /= (${u.glsl.float(c.TILE_ROWS)} * ${u.glsl.float(c.TILE_ROWS)});

        worleyPerlinNoise = getTextureForPointPerlinWorley(p);
        worleyNoise = getTextureForPointWorley(p);

        gl_FragColor.g = saturate(remap(worleyPerlinNoise, worleyNoise, 1.0, 0.0, 1.0));
      `);e.fragment.code.add(u.glsl`
      vec2 mapUV = ${u.glsl.float(c.WEATHER_TILE_SIZE)} * (gl_FragCoord.xy / ${u.glsl.float(c.ATLAS_SIZE)});
      float map = abs(gradientNoise(mapUV));
      map = remap(map, 0.25 * (1.0 - worley(8.0 * mapUV)), 1.0, 0.0, 1.0);

      ${d.mode===b.NoiseTextureRenderMode.Full?u.glsl`gl_FragColor.ba = vec2(0.0, map);`:u.glsl`gl_FragColor = vec4(map);`};
    }
  `);return e}const h=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.NoiseTextureAtlas=h;a.build=m})},"esri/views/webgl/FramebufferObject":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/Logger ../../core/maybe ./BufferObject ./checkWebGLError ./context-util ./enums ./Renderbuffer ./Texture ./Util".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){function g(y){return"type"in y&&"texture"===y.type}function p(y){return g(y)||
"pixelFormat"in y}function t(y,f){y.target!==m.TextureType.TEXTURE_2D&&y.target!==m.TextureType.TEXTURE_CUBE_MAP&&console.error("Texture type must be TEXTURE_2D or TEXTURE_CUBE_MAP!");void 0!==f.width&&0<=f.width&&void 0!==f.height&&0<=f.height?f.width===y.width&&f.height===y.height||console.error("Color attachment texture must match the framebuffer's!"):(f.width=y.width,f.height=y.height)}function q(y,f){void 0!==f.width&&0<=f.width&&void 0!==f.height&&0<=f.height?f.width===y.width&&f.height===y.height||
console.error("Renderbuffer dimensions must match the framebuffer's!"):(f.width=y.width,f.height=y.height)}function k(y){return y.descriptor.target===m.TextureType.TEXTURE_CUBE_MAP?m.TextureType.TEXTURE_CUBE_MAP_POSITIVE_X:m.TextureType.TEXTURE_2D}const r=c.getLogger("esri.views.webgl.FrameBufferObject");c=function(){function y(w,z,A=null,x=null){this._context=w;this._stencilAttachment=this._depthAttachment=this._glName=null;this._colorAttachments=new Map;this._initialized=!1;this._desc={...z};w.instanceCounter.increment(m.ResourceType.FramebufferObject,
this);if(n.isSome(A))for(Array.isArray(A)||(A=[A]),w=0;w<A.length;++w){z=A[w];const C=m.ColorAttachment.COLOR_ATTACHMENT0+w;let D;p(z)?(g(z)?(D=z.descriptor,this._colorAttachments.set(C,z)):(D=z,this._colorAttachments.set(C,new d.Texture(this._context,D))),t(D,this._desc)):("type"in z&&"renderbuffer"===z.type?(D=z.descriptor,this._colorAttachments.set(C,z)):(D=z,this._colorAttachments.set(C,new h.Renderbuffer(this._context,D))),q(D,this._desc));this._validateColorAttachmentPoint(C)}if(n.isSome(x))if(p(x))this._context.capabilities.depthTexture||
console.error("Setting the depth/stencil texture as an attachment requires WEBGL_depth_texture or WebGL2"),g(x)?(A=x.descriptor,this._depthStencilTexture=x):(A=x,this._depthStencilTexture=new d.Texture(this._context,A)),t(A,this._desc);else{var B;"type"in x&&"renderbuffer"===x.type?A=x.descriptor:(A=x,x=new h.Renderbuffer(this._context,A));w=null!=(B=this._desc.depthStencilTarget)?B:m.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER;w===m.DepthStencilTargetType.STENCIL_RENDER_BUFFER?this._stencilAttachment=
x:w===m.DepthStencilTargetType.DEPTH_RENDER_BUFFER||w===m.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER?this._depthAttachment=x:console.error('If a Renderbuffer is provided, "depthStencilTarget" must be one of STENCIL_RENDER_BUFFER, DEPTH_RENDER_BUFFER or DEPTH_STENCIL_RENDER_BUFFER');q(A,this._desc)}}var f=y.prototype;f.dispose=function(){if(this._desc){var w=this._context.getBoundFramebufferObject();this._disposeColorAttachments();this._disposeDepthStencilAttachments();this._glName&&(this._context.gl.deleteFramebuffer(this._glName),
this._glName=null);this._context.bindFramebuffer(w);this._context.instanceCounter.decrement(m.ResourceType.FramebufferObject,this);this._desc=null}};f.getColorTexture=function(w){return(w=this._colorAttachments.get(w))&&g(w)?w:null};f.attachColorTexture=function(w,z=m.ColorAttachment.COLOR_ATTACHMENT0){w&&(this._validateColorAttachmentPoint(z),t(w.descriptor,this._desc),this._disposeColorAttachments(),this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,z)),
this._colorAttachments.set(z,w))};f.detachColorTexture=function(w=m.ColorAttachment.COLOR_ATTACHMENT0){const z=this._colorAttachments.get(w);if(g(z))return this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,w)),this._colorAttachments.delete(w),z};f.setColorTextureTarget=function(w,z=m.ColorAttachment.COLOR_ATTACHMENT0){const A=this._colorAttachments.get(z);g(A)&&this._framebufferTexture2D(A.glName,z,w)};f.attachDepthStencilTexture=function(w){if(!n.isNone(w)){var z=
w.descriptor;z.pixelFormat!==m.PixelFormat.DEPTH_STENCIL&&console.error("Depth/Stencil texture must have a pixel type of DEPTH_STENCIL!");z.dataType!==m.PixelType.UNSIGNED_INT_24_8&&console.error("Depth/Stencil texture must have data type of UNSIGNED_INT_24_8!");this._context.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture!");t(z,this._desc);this._desc.depthStencilTarget&&this._desc.depthStencilTarget!==
m.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE&&(this._desc.depthStencilTarget=m.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE);this._disposeDepthStencilAttachments();this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(w.glName,m.DepthStencilAttachment));this._depthStencilTexture=w}};f.detachDepthStencilTexture=function(){const w=this._depthStencilTexture;w&&this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,m.DepthStencilAttachment));
this._depthStencilTexture=null;return w};f.attachDepthStencilBuffer=function(w){if(!n.isNone(w)){var z=w.descriptor;z.internalFormat!==m.RenderbufferFormat.DEPTH_STENCIL&&z.internalFormat!==m.RenderbufferFormat.DEPTH_COMPONENT16&&console.error("Depth/Stencil buffer must have correct internalFormat");q(z,this._desc);this._disposeDepthStencilAttachments();this._desc.depthStencilTarget=z.internalFormat===m.RenderbufferFormat.DEPTH_STENCIL?m.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:m.DepthStencilTargetType.DEPTH_RENDER_BUFFER;
this._initialized&&(this._context.bindFramebuffer(this),z=this._context.gl,z.framebufferRenderbuffer(m.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===m.DepthStencilTargetType.DEPTH_RENDER_BUFFER?z.DEPTH_ATTACHMENT:z.DEPTH_STENCIL_ATTACHMENT,z.RENDERBUFFER,w.glName));this._depthAttachment=w}};f.detachDepthStencilBuffer=function(){const w=this._context.gl,z=this._depthAttachment;z&&this._initialized&&(this._context.bindFramebuffer(this),w.framebufferRenderbuffer(m.FramebufferTarget.FRAMEBUFFER,
this._desc.depthStencilTarget===m.DepthStencilTargetType.DEPTH_RENDER_BUFFER?w.DEPTH_ATTACHMENT:w.DEPTH_STENCIL_ATTACHMENT,w.RENDERBUFFER,null));this._depthAttachment=null;return z};f.detachAll=function(){this._colorAttachments.forEach((w,z)=>this._detachColorAttachment(z));this.detachDepthStencilBuffer();this.detachDepthStencilTexture()};f.copyToTexture=function(w,z,A,x,B,C,D){(0>w||0>z||0>B||0>C)&&console.error("Offsets cannot be negative!");(0>=A||0>=x)&&console.error("Copy width and height must be greater than zero!");
var E=this._desc;const F=D.descriptor;D.descriptor.target!==m.TextureType.TEXTURE_2D&&console.error("Texture target must be TEXTURE_2D!");(w+A>E.width||z+x>E.height||B+A>F.width||C+x>F.height)&&console.error("Bad dimensions, the current input values will attempt to read or copy out of bounds!");E=this._context;D=E.bindTexture(D,d.Texture.TEXTURE_UNIT_FOR_UPDATES);E.setActiveTexture(d.Texture.TEXTURE_UNIT_FOR_UPDATES);E.bindFramebuffer(this);E.gl.copyTexSubImage2D(m.TextureType.TEXTURE_2D,0,B,C,w,
z,A,x);E.bindTexture(D,d.Texture.TEXTURE_UNIT_FOR_UPDATES)};f.readPixels=function(w,z,A,x,B,C,D){(0>=A||0>=x)&&console.error("Copy width and height must be greater than zero!");D||console.error("Target memory is not initialized!");this._context.bindFramebuffer(this);this._context.gl.readPixels(w,z,A,x,B,C,D)};f.readPixelsAsync=function(){var w=b._asyncToGenerator(function*(z,A,x,B,C,D,E){if(this._context.type!==v.ContextType.WEBGL2)u.webglDebugEnabled()&&console.warn("Attempting to read pixels using pixel buffer object without WebGL2"),
this.readPixels(z,A,x,B,C,D,E);else{var F=this._context.gl,G=l.BufferObject.createPixelPack(this._context,m.Usage.STREAM_READ,E.byteLength);this._context.bindBuffer(G);this._context.bindFramebuffer(this);F.readPixels(z,A,x,B,C,D,0);this._context.unbindBuffer(m.BufferType.PIXEL_PACK_BUFFER);yield G.getSubDataAsync(E);G.dispose()}});return function(z,A,x,B,C,D,E){return w.apply(this,arguments)}}();f.resize=function(w,z){const A=this._desc;if(A.width!==w||A.height!==z)if(this._initialized){A.width=w;
A.height=z;this._colorAttachments.forEach(x=>{x&&x.resize(w,z)});if(null!=this._depthStencilTexture)this._depthStencilTexture.resize(w,z);else if(this._depthAttachment||this._stencilAttachment)this._depthAttachment&&this._depthAttachment.resize(w,z),this._stencilAttachment&&this._stencilAttachment.resize(w,z);this._context.getBoundFramebufferObject()===this&&this._context.bindFramebuffer(null);this._initialized=!1}else A.width=w,A.height=z,this._colorAttachments.forEach(x=>{x&&x.resize(w,z)}),this._depthStencilTexture&&
this._depthStencilTexture.resize(w,z)};f.initializeAndBind=function(w=m.FramebufferTarget.FRAMEBUFFER){var z,A,x,B;const C=this._context.gl;if(this._initialized)C.bindFramebuffer(w,this.glName);else{this._glName&&C.deleteFramebuffer(this._glName);var D=this._context,E=C.createFramebuffer(),F=this._desc,G=null!=(z=F.colorTarget)?z:m.TargetType.RENDER_BUFFER;z=null!=(A=F.width)?A:1;A=null!=(x=F.height)?x:1;C.bindFramebuffer(w,E);0===this._colorAttachments.size&&(G===m.TargetType.TEXTURE||G===m.TargetType.CUBEMAP?
this._colorAttachments.set(m.ColorAttachment.COLOR_ATTACHMENT0,new d.Texture(D,{target:this.descriptor.colorTarget===m.TargetType.CUBEMAP?m.TextureType.TEXTURE_CUBE_MAP:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_BYTE,samplingMode:m.TextureSamplingMode.NEAREST,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:F.width,height:F.height})):(x=new h.Renderbuffer(D,{internalFormat:m.SizedPixelFormat.RGBA4,width:z,height:A}),this._colorAttachments.set(m.ColorAttachment.COLOR_ATTACHMENT0,
x)));this._colorAttachments.forEach((O,K)=>{O&&(g(O)?this._framebufferTexture2D(O.glName,K,k(O),w):C.framebufferRenderbuffer(w,K,C.RENDERBUFFER,O.glName))});x=null!=(B=F.depthStencilTarget)?B:m.DepthStencilTargetType.NONE;switch(x){case m.DepthStencilTargetType.DEPTH_RENDER_BUFFER:case m.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:this._depthAttachment||(this._depthAttachment=new h.Renderbuffer(D,{internalFormat:F.depthStencilTarget===m.DepthStencilTargetType.DEPTH_RENDER_BUFFER?m.RenderbufferFormat.DEPTH_COMPONENT16:
m.RenderbufferFormat.DEPTH_STENCIL,width:z,height:A}));C.framebufferRenderbuffer(w,x===m.DepthStencilTargetType.DEPTH_RENDER_BUFFER?C.DEPTH_ATTACHMENT:C.DEPTH_STENCIL_ATTACHMENT,C.RENDERBUFFER,this._depthAttachment.glName);break;case m.DepthStencilTargetType.STENCIL_RENDER_BUFFER:this._stencilAttachment||(this._stencilAttachment=new h.Renderbuffer(D,{internalFormat:m.RenderbufferFormat.STENCIL_INDEX8,width:z,height:A}));C.framebufferRenderbuffer(w,C.STENCIL_ATTACHMENT,C.RENDERBUFFER,this._stencilAttachment.glName);
break;case m.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE:this._depthStencilTexture||(D.capabilities.depthTexture||console.error("Extension WEBGL_depth_texture isn't supported therefore it is no possible to set the depth/stencil texture as an attachment!"),this._depthStencilTexture=new d.Texture(D,{target:m.TextureType.TEXTURE_2D,pixelFormat:m.PixelFormat.DEPTH_STENCIL,dataType:m.PixelType.UNSIGNED_INT_24_8,samplingMode:m.TextureSamplingMode.NEAREST,wrapMode:m.TextureWrapMode.CLAMP_TO_EDGE,width:z,
height:A})),this._framebufferTexture2D(this._depthStencilTexture.glName,C.DEPTH_STENCIL_ATTACHMENT,k(this._depthStencilTexture),w)}u.webglValidateShadersEnabled()&&C.checkFramebufferStatus(w)!==C.FRAMEBUFFER_COMPLETE&&console.error("Framebuffer is incomplete!");this._glName=E;this._initialized=!0}};f._framebufferTexture2D=function(w,z=m.ColorAttachment.COLOR_ATTACHMENT0,A=m.TextureType.TEXTURE_2D,x=m.FramebufferTarget.FRAMEBUFFER,B=0){this._context.gl.framebufferTexture2D(x,z,A,w,B)};f._detachColorAttachment=
function(w){u.webglDebugEnabled()&&console.warn("Detaching an FBO attachment can be a slow due to invalidating framebuffer completeness!");const z=this._context.gl,A=this._colorAttachments.get(w);g(A)?this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,w)):this._initialized&&(this._context.bindFramebuffer(this),z.framebufferRenderbuffer(m.FramebufferTarget.FRAMEBUFFER,w,z.RENDERBUFFER,null));this._colorAttachments.delete(w);return A};f._disposeColorAttachments=
function(){this._colorAttachments.forEach((w,z)=>{this._detachColorAttachment(z);w.dispose()});this._colorAttachments.clear()};f._disposeDepthStencilAttachments=function(){const w=this._context.gl;this._depthAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),w.framebufferRenderbuffer(m.FramebufferTarget.FRAMEBUFFER,this._desc.depthStencilTarget===m.DepthStencilTargetType.DEPTH_RENDER_BUFFER?w.DEPTH_ATTACHMENT:w.DEPTH_STENCIL_ATTACHMENT,w.RENDERBUFFER,null)),this._depthAttachment.dispose(),
this._depthAttachment=null);this._stencilAttachment&&(this._initialized&&(this._context.bindFramebuffer(this),w.framebufferRenderbuffer(m.FramebufferTarget.FRAMEBUFFER,w.STENCIL_ATTACHMENT,w.RENDERBUFFER,null)),this._stencilAttachment.dispose(),this._stencilAttachment=null);this._depthStencilTexture&&(this._initialized&&(this._context.bindFramebuffer(this),this._framebufferTexture2D(null,w.DEPTH_STENCIL_ATTACHMENT)),this._depthStencilTexture.dispose(),this._depthStencilTexture=null)};f._validateColorAttachmentPoint=
function(w){if(-1===y._MAX_COLOR_ATTACHMENTS){const z=this._context.capabilities.drawBuffers;y._MAX_COLOR_ATTACHMENTS=z?this._context.gl.getParameter(z.MAX_COLOR_ATTACHMENTS):1}w-=m.ColorAttachment.COLOR_ATTACHMENT0;w+1>y._MAX_COLOR_ATTACHMENTS&&r.error("esri.FrameBufferObject",`illegal attachment point for color attachment: ${w+1}. Implementation supports up to ${y._MAX_COLOR_ATTACHMENTS} color attachments`)};b._createClass(y,[{key:"glName",get:function(){return this._glName}},{key:"descriptor",
get:function(){return this._desc}},{key:"colorTexture",get:function(){const w=this._colorAttachments.get(m.ColorAttachment.COLOR_ATTACHMENT0);return w&&g(w)?w:null}},{key:"colorAttachment",get:function(){return this._colorAttachments.get(m.ColorAttachment.COLOR_ATTACHMENT0)}},{key:"depthStencilAttachment",get:function(){return this._depthStencilTexture||this._depthAttachment||this._stencilAttachment}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"width",get:function(){return this._desc.width}},
{key:"height",get:function(){return this._desc.height}},{key:"gpuMemoryUsage",get:function(){return[...this._colorAttachments].reduce((w,[,z])=>w+e.getGpuMemoryUsage(z),0)+e.getGpuMemoryUsage(this.depthStencilAttachment)}}]);return y}();c._MAX_COLOR_ATTACHMENTS=-1;a.FramebufferObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Renderbuffer":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./context-util","./enums"],
function(a,b,c,n){let l=function(){function u(m,h){this._context=m;this._desc=h;this.type="renderbuffer";this._context.instanceCounter.increment(n.ResourceType.Renderbuffer,this);m=this._context.gl;this.glName=m.createRenderbuffer();this._context.bindRenderbuffer(this);const {width:d,height:e,internalFormat:g,multisampled:p}=h;if(p){if(this._context.type!==c.ContextType.WEBGL2)throw Error("Multisampled renderbuffers are not supported in WebGL1!");m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,
g,d,e)}else m.renderbufferStorage(m.RENDERBUFFER,g,d,e)}var v=u.prototype;v.resize=function(m,h){const d=this._desc;if(d.width!==m||d.height!==h)d.width=m,d.height=h,m=this._context.gl,this._context.bindRenderbuffer(this),d.multisampled?m.renderbufferStorageMultisample(m.RENDERBUFFER,this.samples,d.internalFormat,d.width,d.height):m.renderbufferStorage(m.RENDERBUFFER,d.internalFormat,d.width,d.height)};v.dispose=function(){this._context&&(this._context.gl.deleteRenderbuffer(this.glName),this._context.instanceCounter.decrement(n.ResourceType.Renderbuffer,
this),this._context=null)};b._createClass(u,[{key:"descriptor",get:function(){return this._desc}},{key:"samples",get:function(){const m=this._desc.samples,h=this._context.parameters.maxSamples;return m?Math.min(m,h):h}}]);return u}();a.Renderbuffer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/BindParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec2f64 ../../environment/CloudsCompositionParameters ../core/shaderLibrary/shading/MultipassGeometryTest.glsl ../core/shaderLibrary/shading/MultipassTerrainTest.glsl ../core/shaderLibrary/shading/ScreenSpaceReflections.glsl ./RenderSlot ../lighting/SceneLighting".split(" "),
function(a,b,c,n,l,u,v,m,h){let d=function(){function e(g,p,t){this.shadowMap=g;this.ssaoHelper=p;this.slicePlane=t;this.slot=m.RenderSlot.OPAQUE_MATERIAL;this.hasOccludees=!1;this.enableFillLights=!0;this._inverseViewport=c.create();this.lighting=new h.SceneLighting;this.ssr=new v.SSRUniforms;this.multipassTerrain=new u.MultipassTerrainUniforms;this.multipassGeometry=new l.MultipassGeometryUniforms;this.clouds=new n.CloudsCompositionParameters;this.overlays=[]}b._createClass(e,[{key:"camera",get:function(){return this._camera},
set:function(g){this._camera=this.ssr.camera=g;this._inverseViewport[0]=1/g.fullViewport[2];this._inverseViewport[1]=1/g.fullViewport[3]}},{key:"inverseViewport",get:function(){return this._inverseViewport}}]);return e}();a.BindParameters=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform",
"../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,n,l){a.MultipassGeometryUniforms=function(){this.enabled=!1};a.multipassGeometryTest=function(u){u.include(b.ReadLinearDepth);u.uniforms.add([new l.Texture2DPassUniform("geometryDepthTexture",(v,m)=>m.multipassGeometry.linearDepthTexture),new c.Float2PassUniform("nearFar",(v,m)=>m.camera.nearFar)]);u.code.add(n.glsl`bool geometryDepthTest(vec2 pos, float elementDepth) {
float geometryDepth = linearDepthFromTexture(geometryDepthTexture, pos, nearFar);
return (elementDepth < (geometryDepth - 1.0));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl":function(){define(["exports","../output/ReadLinearDepth.glsl","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,n,l){a.MultipassTerrainUniforms=function(){this.cullAboveGround=this.enabled=!1};a.multipassTerrainTest=function(u,v){v.hasMultipassTerrain&&
(u.fragment.include(b.ReadLinearDepth),u.fragment.uniforms.add(new l.Texture2DPassUniform("terrainDepthTexture",(m,h)=>h.multipassTerrain.linearDepthTexture)),u.fragment.uniforms.add(new c.Float2PassUniform("nearFar",(m,h)=>h.camera.nearFar)),u.fragment.uniforms.add(new c.Float2PassUniform("inverseViewport",(m,h)=>h.inverseViewport)),u.fragment.code.add(n.glsl`
    void terrainDepthTest(vec4 fragCoord, float fragmentDepth){
      float terrainDepth = linearDepthFromTexture(terrainDepthTexture, fragCoord.xy * inverseViewport, nearFar);
      if(fragmentDepth ${v.cullAboveGround?"\x3e":"\x3c\x3d"} terrainDepth){
        discard;
      }
    }
  `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ScreenSpaceReflections.glsl":function(){define("exports ../../../../../../chunks/mat4f64 ../output/ReadLinearDepth.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,n,l,u,v,m){a.SSRUniforms=
function(){this.reprojectionMatrix=b.create()};a.ScreenSpaceReflections=function(h,d){const e=h.fragment.uniforms;e.add(new n.Float2PassUniform("nearFar",(g,p)=>p.camera.nearFar));e.add(new m.Texture2DPassUniform("depthMap",(g,p)=>p.linearDepthTexture));e.add(new v.Matrix4PassUniform("view",(g,p)=>p.ssr.camera.viewMatrix));e.add(new v.Matrix4PassUniform("proj",(g,p)=>p.ssr.camera.projectionMatrix));e.add(new l.FloatPassUniform("invResolutionHeight",(g,p)=>1/p.ssr.camera.height));e.add(new m.Texture2DPassUniform("lastFrameColorMap",
(g,p)=>p.ssr.lastFrameColorTexture));e.add(new v.Matrix4PassUniform("reprojectionMatrix",(g,p)=>p.ssr.reprojectionMatrix));h.fragment.include(c.ReadLinearDepth);h.fragment.code.add(u.glsl`
  vec2 reprojectionCoordinate(vec3 projectionCoordinate)
  {
    vec4 zw = proj * vec4(0.0, 0.0, -projectionCoordinate.z, 1.0);
    vec4 reprojectedCoord = reprojectionMatrix * vec4(zw.w * (projectionCoordinate.xy * 2.0 - 1.0), zw.z, zw.w);
    reprojectedCoord.xy /= reprojectedCoord.w;
    return reprojectedCoord.xy * 0.5 + 0.5;
  }

  const int maxSteps = ${d.highStepCount?"150;":"75;"}

  vec4 applyProjectionMat(mat4 projectionMat, vec3 x)
  {
    vec4 projectedCoord =  projectionMat * vec4(x, 1.0);
    projectedCoord.xy /= projectedCoord.w;
    projectedCoord.xy = projectedCoord.xy*0.5 + 0.5;
    return projectedCoord;
  }

  vec3 screenSpaceIntersection(vec3 dir, vec3 startPosition, vec3 viewDir, vec3 normal)
  {
    vec3 viewPos = startPosition;
    vec3 viewPosEnd = startPosition;

    // Project the start position to the screen
    vec4 projectedCoordStart = applyProjectionMat(proj, viewPos);
    vec3  Q0 = viewPos / projectedCoordStart.w; // homogeneous camera space
    float k0 = 1.0/ projectedCoordStart.w;

    // advance the position in the direction of the reflection
    viewPos += dir;

    vec4 projectedCoordVanishingPoint = applyProjectionMat(proj, dir);

    // Project the advanced position to the screen
    vec4 projectedCoordEnd = applyProjectionMat(proj, viewPos);
    vec3  Q1 = viewPos / projectedCoordEnd.w; // homogeneous camera space
    float k1 = 1.0/ projectedCoordEnd.w;

    // calculate the reflection direction in the screen space
    vec2 projectedCoordDir = (projectedCoordEnd.xy - projectedCoordStart.xy);
    vec2 projectedCoordDistVanishingPoint = (projectedCoordVanishingPoint.xy - projectedCoordStart.xy);

    float yMod = min(abs(projectedCoordDistVanishingPoint.y), 1.0);

    float projectedCoordDirLength = length(projectedCoordDir);
    float maxSt = float(maxSteps);

    // normalize the projection direction depending on maximum steps
    // this determines how blocky the reflection looks
    vec2 dP = yMod * (projectedCoordDir)/(maxSt * projectedCoordDirLength);

    // Normalize the homogeneous camera space coordinates
    vec3  dQ = yMod * (Q1 - Q0)/(maxSt * projectedCoordDirLength);
    float dk = yMod * (k1 - k0)/(maxSt * projectedCoordDirLength);

    // initialize the variables for ray marching
    vec2 P = projectedCoordStart.xy;
    vec3 Q = Q0;
    float k = k0;
    float rayStartZ = -startPosition.z; // estimated ray start depth value
    float rayEndZ = -startPosition.z;   // estimated ray end depth value
    float prevEstimateZ = -startPosition.z;
    float rayDiffZ = 0.0;
    float dDepth;
    float depth;
    float rayDiffZOld = 0.0;

    // early outs
    if (dot(normal, dir) < 0.0 || dot(-viewDir, normal) < 0.0)
      return vec3(P, 0.0);

    for(int i = 0; i < maxSteps-1; i++)
    {
      depth = -linearDepthFromTexture(depthMap, P, nearFar); // get linear depth from the depth buffer

      // estimate depth of the marching ray
      rayStartZ = prevEstimateZ;
      dDepth = -rayStartZ - depth;
      rayEndZ = (dQ.z * 0.5 + Q.z)/ ((dk * 0.5 + k));
      rayDiffZ = rayEndZ- rayStartZ;
      prevEstimateZ = rayEndZ;

      if(-rayEndZ > nearFar[1] || -rayEndZ < nearFar[0] || P.y < 0.0  || P.y > 1.0 )
      {
        return vec3(P, 0.);
      }

      // If we detect a hit - return the intersection point, two conditions:
      //  - dDepth > 0.0 - sampled point depth is in front of estimated depth
      //  - if difference between dDepth and rayDiffZOld is not too large
      //  - if difference between dDepth and 0.025/abs(k) is not too large
      //  - if the sampled depth is not behind far plane or in front of near plane

      if((dDepth) < 0.025/abs(k) + abs(rayDiffZ) && dDepth > 0.0 && depth > nearFar[0] && depth < nearFar[1] && abs(P.y - projectedCoordStart.y) > invResolutionHeight)
      {
        return vec3(P, depth);
      }

      // continue with ray marching
      P += dP;
      Q.z += dQ.z;
      k += dk;
      rayDiffZOld = rayDiffZ;
    }
    return vec3(P, 0.0);
  }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderSlot":function(){define(["exports"],function(a){a.RenderSlot=void 0;var b=a.RenderSlot||(a.RenderSlot={});b[b.INTEGRATED_MESH=0]="INTEGRATED_MESH";b[b.OPAQUE_TERRAIN=1]="OPAQUE_TERRAIN";b[b.OPAQUE_MATERIAL=2]="OPAQUE_MATERIAL";b[b.TRANSPARENT_MATERIAL=3]="TRANSPARENT_MATERIAL";b[b.TRANSPARENT_TERRAIN=4]="TRANSPARENT_TERRAIN";b[b.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL=
5]="TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL";b[b.OCCLUDED_TERRAIN=6]="OCCLUDED_TERRAIN";b[b.OCCLUDER_MATERIAL=7]="OCCLUDER_MATERIAL";b[b.TRANSPARENT_OCCLUDER_MATERIAL=8]="TRANSPARENT_OCCLUDER_MATERIAL";b[b.OCCLUSION_PIXELS=9]="OCCLUSION_PIXELS";b[b.POSTPROCESSING_ENVIRONMENT_OPAQUE=10]="POSTPROCESSING_ENVIRONMENT_OPAQUE";b[b.POSTPROCESSING_ENVIRONMENT_TRANSPARENT=11]="POSTPROCESSING_ENVIRONMENT_TRANSPARENT";b[b.LASERLINES=12]="LASERLINES";b[b.LASERLINES_CONTRAST_CONTROL=13]="LASERLINES_CONTRAST_CONTROL";
b[b.HUD_MATERIAL=14]="HUD_MATERIAL";b[b.LABEL_MATERIAL=15]="LABEL_MATERIAL";b[b.LINE_CALLOUTS=16]="LINE_CALLOUTS";b[b.LINE_CALLOUTS_HUD_DEPTH=17]="LINE_CALLOUTS_HUD_DEPTH";b[b.DRAPED_MATERIAL=18]="DRAPED_MATERIAL";b[b.DRAPED_WATER=19]="DRAPED_WATER";b[b.VOXEL=20]="VOXEL";b[b.MAX_SLOTS=21]="MAX_SLOTS";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/SceneLighting":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Lightsources ./SphericalHarmonics".split(" "),
function(a,b,c,n,l,u){let v=function(){function h(){this._shOrder=2;this._oldSunlight={direction:n.create(),ambient:{color:n.create(),intensity:1},diffuse:{color:n.create(),intensity:1}};this.groundLightingFactor=this.globalFactor=.5;this._sphericalHarmonics=new l.SphericalHarmonicsAmbientLight;this._mainLight={intensity:n.create(),direction:n.fromValues(1,0,0),castShadows:!1,specularStrength:1,environmentStrength:1}}h.prototype.set=function(d){u.combineLights(d,this._shOrder,this._mainLight,this._sphericalHarmonics);
c.copy(this._oldSunlight.direction,this._mainLight.direction);d=1/Math.PI;this._oldSunlight.ambient.color[0]=.282095*this._sphericalHarmonics.r[0]*d;this._oldSunlight.ambient.color[1]=.282095*this._sphericalHarmonics.g[0]*d;this._oldSunlight.ambient.color[2]=.282095*this._sphericalHarmonics.b[0]*d;c.scale(this._oldSunlight.diffuse.color,this._mainLight.intensity,d);c.copy(m,this._oldSunlight.diffuse.color);c.scale(m,m,.4*this.globalFactor);c.add(this._oldSunlight.ambient.color,this._oldSunlight.ambient.color,
m)};b._createClass(h,[{key:"sh",get:function(){return this._sphericalHarmonics}},{key:"mainLight",get:function(){return this._mainLight}},{key:"lightingMainDirection",get:function(){return this._mainLight.direction}},{key:"old",get:function(){return this._oldSunlight}}]);return h}();const m=n.create();a.SceneLighting=v;a.ambientBoost=.4;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/Lightsources":function(){define(["exports",
"../../../../chunks/vec3f64"],function(a,b){a.AmbientLight=function(c=b.create()){this.intensity=c};a.FillLight=function(c=b.create(),n=b.fromValues(.57735,.57735,.57735)){this.intensity=c;this.direction=n};a.MainLight=function(c=b.create(),n=b.fromValues(.57735,.57735,.57735),l=!0,u=1,v=1){this.intensity=c;this.direction=n;this.castShadows=l;this.specularStrength=u;this.environmentStrength=v};a.SphericalHarmonicsAmbientLight=function(){this.r=[0];this.g=[0];this.b=[0]};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lighting/SphericalHarmonics":function(){define("exports ../../../../core/mathUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../lib/LongVectorMath ./Lightsources".split(" "),function(a,b,c,n,l,u){function v(w){return(w+1)*(w+1)}function m(w){return b.clamp(Math.floor(Math.sqrt(w)-1),0,2)}function h(w,z,A){const x=w[0],B=w[1];w=w[2];A=A||[];A.length=v(z);0<=z&&(A[0]=.28209479177);1<=z&&(A[1]=.4886025119*
x,A[2]=.4886025119*w,A[3]=.4886025119*B);2<=z&&(A[4]=1.09254843059*x*B,A[5]=1.09254843059*B*w,A[6]=.31539156525*(3*w*w-1),A[7]=1.09254843059*x*w,A[8]=.54627421529*(x*x-B*B));return A}function d(w,z){w=v(w);z=z||{r:[],g:[],b:[]};z.r.length=z.g.length=z.b.length=w;for(let A=0;A<w;A++)z.r[A]=z.g[A]=z.b[A]=0;return z}function e(w,z){const A=m(z.r.length);for(const x of w)c.negate(y,x.direction),h(y,A,k),l.elementwiseProduct(k,f),l.scalarProduct(k,x.intensity[0],r),l.add(z.r,r),l.scalarProduct(k,x.intensity[1],
r),l.add(z.g,r),l.scalarProduct(k,x.intensity[2],r),l.add(z.b,r);return z}function g(w,z){h(y,0,k);for(const A of w)z.r[0]+=k[0]*f[0]*A.intensity[0]*4*Math.PI,z.g[0]+=k[0]*f[0]*A.intensity[1]*4*Math.PI,z.b[0]+=k[0]*f[0]*A.intensity[2]*4*Math.PI;return z}const p=[],t=[],q=[],k=[0],r=[0],y=n.create(),f=[3.141593,2.094395,2.094395,2.094395,.785398,.785398,.785398,.785398,.785398];a.combineLights=function(w,z,A,x){d(z,x);c.set(A.intensity,0,0,0);z=!1;p.length=0;t.length=0;q.length=0;for(const B of w)B instanceof
u.MainLight&&!z?(c.copy(A.direction,B.direction),c.copy(A.intensity,B.intensity),A.specularStrength=B.specularStrength,A.environmentStrength=B.environmentStrength,A.castShadows=B.castShadows,z=!0):B instanceof u.MainLight||B instanceof u.FillLight?p.push(B):B instanceof u.AmbientLight?t.push(B):B instanceof u.SphericalHarmonicsAmbientLight&&q.push(B);e(p,x);g(t,x);for(const B of q)l.add(x.r,B.r),l.add(x.g,B.g),l.add(x.b,B.b)};a.computeCoefficients=h;a.initSHCoefficients=d;a.numberOfCoefficients=v;
a.orderFromNumberOfCoefficients=m;a.projectAmbientLights=g;a.projectFillLights=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LongVectorMath":function(){define(["exports"],function(a){a.add=function(b,c,n){n=n||b;n.length=b.length;for(let l=0;l<b.length;l++)n[l]=b[l]+c[l];return n};a.dotProduct=function(b,c){let n=0;for(let l=0;l<b.length;l++)n+=b[l]*c[l];return n};a.elementwiseProduct=function(b,c,n){n=n||b;n.length=b.length;
for(let l=0;l<b.length;l++)n[l]=b[l]*c[l];return n};a.scalarProduct=function(b,c,n){n=n||b;n.length=b.length;for(let l=0;l<b.length;l++)n[l]=b[l]*c;return n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/Fog":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../geometry/projectionEllipsoid ./atmosphereUtils ./FogTechnique ./weather ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z){a.Fog=function(x){function B(D){var E=x.call(this,D)||this;E._fogColor=p.create();E._fogColorAtNight=p.create();E._cameraDirection=p.create();E._foggyFadeStart=.95;E._foggyFadeEnd=1;E._hazeFadeStart=.7;E._hazeFadeEnd=1;E._strength=4E-6;E._vao=w.createQuadVAO(D.context.renderContext.rctx,f.Pos2Tex);D=t.getReferenceEllipsoid(D.view.spatialReference);E._planetRadius=D.radius;E._atmosphereRadius=D.radius+q.atmosphereHeight;return E}b._inheritsLoose(B,
x);var C=B.prototype;C.destroy=function(){this._hazeFogTechnique=u.releaseMaybe(this._hazeFogTechnique);this._thickFogTechnique=u.releaseMaybe(this._thickFogTechnique);this._vao=u.disposeMaybe(this._vao)};C.when=function(){return Promise.resolve()};C.render=function(D,E,F){if(0!==this.view.basemapTerrain.baseOpacity||E)if(this._update(D,E,F),!(0>=this._fogAmount)){var G=E?this.thickFogTechnique:this.hazeFogTechnique;if(G.compiled){var O=D.offscreenRenderingHelper,K=D.rctx.bindTechnique(G,A,D.bindParameters);
O.renderDepthDetached(()=>{K.bindTexture("depthTex",O.depthTexture);this._renderFog(G.program,D)})}else this.context.requestRender()}};C._renderFog=function(D,E){if(u.isNone(this._vao))return!1;const F=E.rctx;D.setUniform3fv("cameraPosition",E.bindParameters.camera.eye);D.setUniform1f("atmosphereC",this._atmosphereC);D.setUniform1f("fogStrength",this._strength);D.setUniform1f("fogAmount",this._fogAmount);D.setUniform3fv("fogColor",this._fogColor);F.bindVAO(this._vao);D.assertCompatibleVertexAttributeLocations(this._vao);
F.drawArrays(z.PrimitiveType.TRIANGLE_STRIP,0,4);return!0};C._update=function(D,E,F){var G=D.bindParameters.camera;const O=E?.1:0;F?g.set(this._fogColor,.5,.5,.5):E?g.set(this._fogColor,1.5,1.5,1.5):g.set(this._fogColor,.24,.44,.8);g.scale(this._fogColorAtNight,this._fogColor,O);g.normalize(this._cameraDirection,G.eye);D=Math.max(0,g.dot(this._cameraDirection,D.bindParameters.lighting.lightingMainDirection));g.lerp(this._fogColor,this._fogColorAtNight,this._fogColor,D);G=g.length(G.eye);this._atmosphereC=
G*G-this._atmosphereRadius*this._atmosphereRadius;this._fogAmount=E?1-l.smoothstep(this._foggyFadeStart*r.weatherHeightLimit,this._foggyFadeEnd*r.weatherHeightLimit,Math.abs(G-this._planetRadius)):1-l.smoothstep(this._hazeFadeStart*r.weatherHeightLimit,this._hazeFadeEnd*r.weatherHeightLimit,Math.abs(G-this._planetRadius))};B.isSupported=function(D){return D.capabilities.depthTexture};b._createClass(B,[{key:"_shaderTechniqueRepository",get:function(){return this.context.shaderTechniqueRepository}},
{key:"strength",get:function(){return this._strength},set:function(D){this._strength=D}},{key:"thickFogTechnique",get:function(){if(u.isNone(this._thickFogTechnique)){const D=new k.FogTechniqueConfiguration;D.haze=!1;this._thickFogTechnique=this._shaderTechniqueRepository.acquire(k.FogTechnique,D)}return this._thickFogTechnique}},{key:"hazeFogTechnique",get:function(){if(u.isNone(this._hazeFogTechnique)){const D=new k.FogTechniqueConfiguration;D.haze=!0;this._hazeFogTechnique=this._shaderTechniqueRepository.acquire(k.FogTechnique,
D)}return this._hazeFogTechnique}}]);return B}(n);c.__decorate([v.property({constructOnly:!0})],a.Fog.prototype,"context",void 0);c.__decorate([v.property({constructOnly:!0})],a.Fog.prototype,"view",void 0);a.Fog=c.__decorate([e.subclass("esri.views.3d.environment.Fog")],a.Fog);const A=new y.NoParameters;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/FogTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/Fog.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){v=function(p){function t(){return p.apply(this,arguments)||this}c._inheritsLoose(t,p);var q=t.prototype;q.initializeProgram=function(k){const r=t.shader.get().build(this.configuration);return new d.Program(k.rctx,r,h.Default3D)};q.initializePipeline=function(){return this.configuration.haze?g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.ONE,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_COLOR,e.BlendFactor.ONE),colorWrite:g.defaultColorWriteParams}):
g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ZERO,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE),colorWrite:g.defaultColorWriteParams})};return t}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(l.Fog,()=>new Promise((p,t)=>a(["./Fog.glsl"],p,t)));l=function(p){function t(){var q=p.apply(this,arguments)||this;q.haze=!1;return q}c._inheritsLoose(t,p);return t}(m.ShaderTechniqueConfiguration);n.__decorate([m.parameter()],l.prototype,"haze",
void 0);b.FogTechnique=v;b.FogTechniqueConfiguration=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Fog.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Gamma.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(r){const y=new g.ShaderBuilder;y.attributes.add(t.VertexAttribute.POSITION,"vec2");y.include(n.TextureCoordinateAttribute,{textureCoordinateType:n.TextureCoordinateAttributeType.Default});y.varyings.add("worldRay","vec3");y.varyings.add("eyeDir","vec3");const {vertex:f,fragment:w}=y;f.uniforms.add([new e.Matrix4PassUniform("inverseProjectionMatrix",(z,A)=>A.camera.inverseProjectionMatrix),new e.Matrix4PassUniform("inverseViewMatrix",(z,A)=>b.invert(k,
A.camera.viewMatrix))]);f.code.add(d.glsl`void main(void) {
vec3 posViewNear = (inverseProjectionMatrix * vec4(position, -1, 1)).xyz;
eyeDir = posViewNear;
worldRay = (inverseViewMatrix * vec4(posViewNear, 0)).xyz;
forwardTextureCoordinates();
gl_Position = vec4(position, 1, 1);
}`);w.uniforms.add(new h.FloatUniform("atmosphereC"));w.uniforms.add(new m.Float3Uniform("cameraPosition"));w.uniforms.add(new v.Float2PassUniform("nearFar",(z,A)=>A.camera.nearFar));w.uniforms.add(new p.Texture2DUniform("depthTex"));w.uniforms.add(new h.FloatUniform("fogStrength"));w.uniforms.add(new h.FloatUniform("fogAmount"));w.uniforms.add(new m.Float3Uniform("fogColor"));y.include(u.Gamma);w.include(l.ReadLinearDepth);w.code.add(d.glsl`vec2 sphereIntersect(vec3 start, vec3 dir) {
float a = dot(dir, dir);
float b = 2.0 * dot(dir, start);
float d = (b * b) - 4.0 * a * atmosphereC;
if (d < 0.0) {
return vec2(1e5, -1e5);
}
return vec2((-b - sqrt(d)) / (2.0 * a), (-b + sqrt(d)) / (2.0 * a));
}`);w.code.add(d.glsl`vec4 applyFog(float dist, vec3 rayDir){
if(dist == -1.0){
vec2 rayAtmosphereIntersect = sphereIntersect(cameraPosition, rayDir);
dist = 0.055 * rayAtmosphereIntersect.y;
}
float fogAmount = fogAmount * (1.0 - exp(-dist * fogStrength));
return vec4(fogAmount * fogColor, fogAmount);
}`);w.code.add(d.glsl`
    vec3 tonemapACES(vec3 x) {
      return clamp((x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14), 0.0, 1.0);
    }

    void main() {
      vec3 rayDir = normalize(worldRay);
      float terrainDepth = -1.0;

      float depthSample = texture2D(depthTex, vuv0).r;
      float zNorm = 2.0 * depthSample - 1.0;
      float linDepth = 2.0 * nearFar[0] * nearFar[1] / (nearFar[1] + nearFar[0] - zNorm * (nearFar[1] - nearFar[0]));
      if(depthSample < 1.0 && depthSample > 0.0){
        vec3 cameraSpaceRay = normalize(eyeDir);
        cameraSpaceRay /= cameraSpaceRay.z;
        cameraSpaceRay *= linDepth;
        terrainDepth = max(0.0, length(cameraSpaceRay));
      }

      ${r.haze?d.glsl`
          if(terrainDepth == -1.0){
            gl_FragColor = vec4(0);
            return;
          }`:""}

      vec4 fog = applyFog(terrainDepth, rayDir);

      gl_FragColor = delinearizeGamma(vec4(tonemapACES(fog.rgb), fog.a));
    }
  `);return y}const k=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.Fog=c;a.build=q})},"esri/views/3d/environment/PanoramicAtmosphere":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../support/requestImageUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/SimpleAtmosphereTexture ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/GeometryUtil ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A){const x=c.getLogger("esri.views.3d.environment.PanoramicAtmosphere");c=function(){function D(){this.type="panoramic";this._techniqueConfig=new e.SimpleAtmosphereTechniqueConfiguration;this._passParameters=new h.SimpleAtmospherePassParameters;this._readyResolver=l.createResolver();this._readyController=new AbortController}var E=D.prototype;E.destroy=function(){this._readyResolver.reject();this._passParameters.texture=n.disposeMaybe(this._passParameters.texture);
this._vao=n.disposeMaybe(this._vao);this._readyController=n.abortMaybe(this._readyController)};E.when=function(){return this._readyResolver.promise};E.initializeRenderContext=function(F){this._techniqueConfig.geometry=e.SimpleAtmosphereGeometry.Cylinder;this._technique=F.shaderTechniqueRepository.acquire(d.SimpleAtmosphereTechnique,this._techniqueConfig);const G=F.renderContext.rctx;this._vao=this._createVertexArrayObject(G);this._vaoCount=z.vertexCount(this._vao,"geometry");m.requestImage(g,{signal:this._readyController.signal}).then(O=>
{this._passParameters.texture=new w.Texture(G,{pixelFormat:f.PixelFormat.RGBA,dataType:f.PixelType.UNSIGNED_BYTE,wrapMode:f.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:f.TextureSamplingMode.LINEAR,flipped:!0},O);F.requestRender();this._readyController=null;this._readyResolver.resolve()}).catch(O=>{l.isAbortError(O)||x.error("Unable to initialize atmosphere: image request failed",O);this._readyResolver.reject()})};E.render=function(F){const G=F.rctx,O=G.bindTechnique(this._technique,this._passParameters,
F.bindParameters);var K=B;u.copy(K,F.bindParameters.camera.viewMatrix);K[12]=0;K[13]=0;K[14]=0;K[15]=1;O.setUniformMatrix4fv("view",B);G.bindVAO(this._vao);O.assertCompatibleVertexAttributeLocations(this._vao);G.drawArrays(f.PrimitiveType.TRIANGLES,0,this._vaoCount)};E.renderHaze=function(){return!1};E._createVertexArrayObject=function(F){var G=k.createPolySphereGeometry(1,2,!1);const O=G.indices.get(r.VertexAttribute.POSITION);for(var K=0;K<O.length;K+=3){var L=O[K];O[K]=O[K+2];O[K+2]=L}G=G.vertexAttributes.get(r.VertexAttribute.POSITION).data;
K=C.createBuffer(O.length);L=K.position;for(let R=0;R<O.length;++R){const M=3*O[R];L.set(R,0,G[M]);L.set(R,1,G[M+1]);L.set(R,2,G[M+2])}return new A.VertexArrayObject(F,q.Default3D,{geometry:p.glLayout(C)},{geometry:y.BufferObject.createVertex(F,f.Usage.STATIC_DRAW,K.buffer)})};b._createClass(D,[{key:"canRender",get:function(){return null!=this._passParameters.texture}}]);return D}();const B=v.create(),C=t.newLayout().vec3f(r.VertexAttribute.POSITION);a.PanoramicAtmosphere=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/support/requestImageUtils":function(){define(["exports","../chunks/_rollupPluginBabelHelpers","../request"],function(a,b,c){function n(){n=b._asyncToGenerator(function*(l,u){({data:l}=yield c(l,{responseType:"image",...u}));return l});return n.apply(this,arguments)}a.requestImage=function(l,u){return n.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SimpleAtmosphere.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../views/3d/environment/SimpleAtmosphereTechniqueConfiguration ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(y){const f=new g.ShaderBuilder,{vertex:w,fragment:z}=f;y.geometry===c.SimpleAtmosphereGeometry.Underground?(f.attributes.add(t.VertexAttribute.POSITION,"vec2"),f.varyings.add("color","vec4"),w.uniforms.add([new u.Float3PassUniform("lightingMainDirection",(A,x)=>x.lighting.lightingMainDirection),new v.Float3Uniform("cameraPosition"),new m.FloatUniform("undergroundFadeAlpha")]),w.code.add(h.glsl`void main(void) {
float ndotl = dot(normalize(cameraPosition), lightingMainDirection);
float lighting = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));
color = vec4(vec3(lighting), undergroundFadeAlpha);
gl_Position = vec4(position.xy, 1.0, 1.0);
}`),z.code.add(h.glsl`void main() {
gl_FragColor = color;
}`)):(f.include(n.Transform),f.attributes.add(t.VertexAttribute.POSITION,"vec3"),f.varyings.add("vtc","vec2"),f.varyings.add("falloff","float"),y=y.geometry===c.SimpleAtmosphereGeometry.Cylinder,w.uniforms.add([new d.Matrix4PassUniform("proj",(A,x)=>x.camera.projectionMatrix),new e.Matrix4Uniform("view"),new u.Float3PassUniform("lightingMainDirection",(A,x)=>x.lighting.lightingMainDirection)]),y||(f.varyings.add("innerFactor","float"),w.uniforms.add(new v.Float3Uniform("silCircleCenter")),w.uniforms.add(new v.Float3Uniform("silCircleV1")),
w.uniforms.add(new v.Float3Uniform("silCircleV2")),w.uniforms.add(new l.Float2Uniform("texV")),w.uniforms.add(new m.FloatUniform("innerScale"))),w.code.add(h.glsl`
		void main(void) {
      ${y?h.glsl`
      vec3 pos = position;
      float ndotl = lightingMainDirection.z;
      vtc = vec2(0.0, position.z + 0.05);`:h.glsl`
      innerFactor = clamp(-position.z, 0.0, 1.0);
      float scale = position.y * (1.0 + innerFactor * innerScale);
      float phi = position.x * ${h.glsl.float(.04908738515625)} + 1.0;
      vec3 pos =  (silCircleCenter + sin(phi) * silCircleV1 + cos(phi) * silCircleV2) * scale;
      float ndotl = dot(normalize(position.y > 0.0 ? pos: silCircleCenter), lightingMainDirection);
      vtc.x = position.x  * ${h.glsl.float(.0078125)};
      vtc.y = texV.x * (1.0 - position.z) + texV.y * position.z;
      `}
      falloff = max(0.0, smoothstep(-1.0, 0.8, 2.0 * ndotl));

		  gl_Position = transformPosition(proj, view, pos);
		  gl_Position.z = gl_Position.w; // project atmosphere onto the far plane
    }
	  `),z.uniforms.add(new p.Texture2DPassUniform("tex",A=>A.texture)),y||z.uniforms.add(new m.FloatUniform("altitudeFade")),z.code.add(h.glsl`
		void main() {
			vec4 atmosphereColor = texture2D(tex, vtc) * falloff;
      ${y?h.glsl`gl_FragColor = atmosphereColor;`:h.glsl`
			vec4 innerColor = vec4(atmosphereColor.rgb, 1.0 - altitudeFade);
			gl_FragColor = mix(atmosphereColor, innerColor, smoothstep(0.0, 1.0, innerFactor));
      `}
    }`));return f}let k=function(y){function f(){return y.apply(this,arguments)||this}b._inheritsLoose(f,y);return f}(h.NoParameters);const r=Object.freeze(Object.defineProperty({__proto__:null,SimpleAtmospherePassParameters:k,build:q},Symbol.toStringTag,{value:"Module"}));a.SimpleAtmosphere=r;a.SimpleAtmospherePassParameters=k;a.build=q})},"esri/views/3d/environment/SimpleAtmosphereTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6",
"../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){a.SimpleAtmosphereGeometry=void 0;(function(u){u[u.Cone=0]="Cone";u[u.Cylinder=1]="Cylinder";u[u.Underground=2]="Underground";u[u.COUNT=3]="COUNT"})(a.SimpleAtmosphereGeometry||(a.SimpleAtmosphereGeometry={}));let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.geometry=a.SimpleAtmosphereGeometry.Cone;return m}b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.SimpleAtmosphereGeometry.COUNT})],
l.prototype,"geometry",void 0);a.SimpleAtmosphereTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Transform.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Transform=function(c,n={hasModelTransformation:!1,linearDepth:!1}){n.hasModelTransformation?n.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, mat4 model, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * (model * vec4(pos, 1.0));
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, mat4 model, vec3 pos) {
return proj * (view * (model * vec4(pos, 1.0)));
}`):n.linearDepth?c.vertex.code.add(b.glsl`vec4 transformPositionWithDepth(mat4 proj, mat4 view, vec3 pos, vec2 nearFar, out float depth) {
vec4 eye = view * vec4(pos, 1.0);
depth = (-eye.z - nearFar[0]) / (nearFar[1] - nearFar[0]) ;
return proj * eye;
}`):c.vertex.code.add(b.glsl`vec4 transformPosition(mat4 proj, mat4 view, vec3 pos) {
return proj * (view * vec4(pos, 1.0));
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4Uniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform"],function(a,b,c){c=function(n){function l(u){return n.call(this,u,"mat4")||this}b._inheritsLoose(l,n);return l}(c.Uniform);a.Matrix4Uniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/SimpleAtmosphereTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechniqueConfiguration ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){v=function(g){function p(){return g.apply(this,arguments)||this}c._inheritsLoose(p,g);var t=p.prototype;t.initializeProgram=function(q){const k=p.shader.get().build(this.configuration);return new h.Program(q.rctx,k,m.Default3D)};t.initializePipeline=function(){return this.configuration.geometry===l.SimpleAtmosphereGeometry.Cylinder?e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),
culling:e.backFaceCullingParams,depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})};return p}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(n.SimpleAtmosphere,()=>new Promise((g,p)=>a(["./SimpleAtmosphere.glsl"],g,
p)));b.SimpleAtmosphereTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/resources/SimpleAtmosphereTexture":function(){define(function(){return"data:image/png;base64, iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAABD1gYFAAAACXBIWXMAAC4jAAAuIwF4pT92AAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAXVJREFUeNq0k9GWhDAIQ3PjzP9/cuehFqhW19mz++IhkCZAq1prsqT+kSQS9g8Vnqp6VGVWkYVktR6tj3Gr968nLnfwlHzHYyHapkKS73bPd/39eI38AYWj24OGvqdwWjZ3l8IDgacXyl1Dj9tdLOzZiicj+P1YcGk0H2O2vN/VQpTveEHmPHQxZxYlqsQdhUeuCWREuDEvAjqlCqDIMYwIo2ijR1HdYUS58dQrKpgQ0EGeMocsTNXrxzyOhS9kfzlWjn82YuWLqwAnvfNEWJFjYXkJCT0s7AmS0NG4x7Lt6Cpy2MiVPBZmS668QT5AR1cevp7b6CpzQ/ZSNH0vmhy5CsNtdax0MBpXDBiFsrDiMSLKMc8b6hH93bNbEpRsIyHDUhNcfTyeKF16PC7c/2QdczvUnvOB1ylZHVFSMtd5s8C2IW/7w6hwM5GLavLCd1zkiFjB+BwH1DSgctQ7mPOimBLJrw35beSXkd8BM/cCqbXWPgMA+GQQ5sIgkfAAAAAASUVORK5CYII\x3d"})},
"esri/views/3d/support/buffer/glUtil":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],function(a,b,c){const n={u8:b.DataType.UNSIGNED_BYTE,u16:b.DataType.UNSIGNED_SHORT,u32:b.DataType.UNSIGNED_INT,i8:b.DataType.BYTE,i16:b.DataType.SHORT,i32:b.DataType.INT,f32:b.DataType.FLOAT};a.glLayout=function(l,u=0){const v=l.stride;return l.fieldNames.filter(m=>{m=l.fields.get(m).optional;return!(m&&m.glPadding)}).map(m=>{const h=l.fields.get(m),d=h.constructor.ElementCount;
var e=n[h.constructor.ElementType];if(!e)throw Error("BufferType not supported in WebGL");return new c.VertexElementDescriptor(m,d,e,h.offset,v,!(!h.optional||!h.optional.glNormalized),u)})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/buffer/InterleavedLayout":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../geometry/support/buffer/BufferView","../../../../geometry/support/buffer/types"],
function(a,b,c,n){let l=function(){function v(h,d){this.layout=h;this.buffer="number"===typeof d?new ArrayBuffer(d*h.stride):d;for(const e of h.fieldNames)d=h.fields.get(e),this[e]=new d.constructor(this.buffer,d.offset,this.stride)}var m=v.prototype;m.getField=function(h,d){return(h=this[h])&&h.elementCount===d.ElementCount&&h.elementType===d.ElementType?h:null};m.slice=function(h,d){return new v(this.layout,this.buffer.slice(h*this.stride,d*this.stride))};m.copyFrom=function(h,d,e,g){const p=this.stride;
0===p%4?(h=new Uint32Array(h.buffer,d*p,g*p/4),(new Uint32Array(this.buffer,e*p,g*p/4)).set(h)):(h=new Uint8Array(h.buffer,d*p,g*p),(new Uint8Array(this.buffer,e*p,g*p)).set(h))};b._createClass(v,[{key:"stride",get:function(){return this.layout.stride}},{key:"count",get:function(){return this.buffer.byteLength/this.stride}},{key:"byteLength",get:function(){return this.buffer.byteLength}}]);return v}(),u=function(){function v(){this.stride=0;this.fields=new Map;this.fieldNames=[]}var m=v.prototype;
m.vec2f=function(h,d){this._appendField(h,c.BufferViewVec2f,d);return this};m.vec2f64=function(h,d){this._appendField(h,c.BufferViewVec2f64,d);return this};m.vec3f=function(h,d){this._appendField(h,c.BufferViewVec3f,d);return this};m.vec3f64=function(h,d){this._appendField(h,c.BufferViewVec3f64,d);return this};m.vec4f=function(h,d){this._appendField(h,c.BufferViewVec4f,d);return this};m.vec4f64=function(h,d){this._appendField(h,c.BufferViewVec4f64,d);return this};m.mat3f=function(h,d){this._appendField(h,
c.BufferViewMat3f,d);return this};m.mat3f64=function(h,d){this._appendField(h,c.BufferViewMat3f64,d);return this};m.mat4f=function(h,d){this._appendField(h,c.BufferViewMat4f,d);return this};m.mat4f64=function(h,d){this._appendField(h,c.BufferViewMat4f64,d);return this};m.vec4u8=function(h,d){this._appendField(h,c.BufferViewVec4u8,d);return this};m.f32=function(h,d){this._appendField(h,c.BufferViewFloat,d);return this};m.f64=function(h,d){this._appendField(h,c.BufferViewFloat64,d);return this};m.u8=
function(h,d){this._appendField(h,c.BufferViewUint8,d);return this};m.u16=function(h,d){this._appendField(h,c.BufferViewUint16,d);return this};m.i8=function(h,d){this._appendField(h,c.BufferViewInt8,d);return this};m.vec2i8=function(h,d){this._appendField(h,c.BufferViewVec2i8,d);return this};m.vec2i16=function(h,d){this._appendField(h,c.BufferViewVec2i16,d);return this};m.vec2u8=function(h,d){this._appendField(h,c.BufferViewVec2u8,d);return this};m.vec4u16=function(h,d){this._appendField(h,c.BufferViewVec4u16,
d);return this};m.u32=function(h,d){this._appendField(h,c.BufferViewUint32,d);return this};m._appendField=function(h,d,e){const g=d.ElementCount*n.elementTypeSize(d.ElementType);this.fields.set(h,{size:g,constructor:d,offset:this.stride,optional:e});this.stride+=g;this.fieldNames.push(h)};m.alignTo=function(h){this.stride=Math.floor((this.stride+h-1)/h)*h;return this};m.hasField=function(h){return this.fieldNames.includes(h)};m.createBuffer=function(h){return new l(this,h)};m.createView=function(h){return new l(this,
h)};m.clone=function(){const h=new v;h.stride=this.stride;h.fields=new Map;this.fields.forEach((d,e)=>h.fields.set(e,d));h.fieldNames=this.fieldNames.slice();h.BufferType=this.BufferType;return h};return v}();a.InterleavedBuffer=l;a.InterleavedLayout=u;a.newLayout=function(){return new u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/BufferView":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./internals/Mat3 ./internals/Mat4 ./internals/Scalar ./internals/Vec2 ./internals/Vec3 ./internals/Vec4".split(" "),
function(a,b,c,n,l,u,v,m){let h=function(V){function S(T,H=0,U,W){T=V.call(this,Float32Array,T,H,U,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,V);S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);h.ElementType="f32";let d=function(V){function S(T,H=0,U,W){T=V.call(this,Float32Array,T,H,U,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,
H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);d.ElementType="f32";let e=function(V){function S(T,H=0,U,W){T=V.call(this,Float32Array,T,H,U,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);e.ElementType="f32";let g=
function(V){function S(T,H=0,U,W){T=V.call(this,Float32Array,T,H,U,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);g.ElementType="f32";let p=function(V){function S(T,H=0,U,W){T=V.call(this,Float32Array,T,H,U,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,
H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(c.BufferViewMat3Impl);p.ElementType="f32";c=function(V){function S(T,H=0,U,W){T=V.call(this,Float64Array,T,H,U,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(c.BufferViewMat3Impl);
c.ElementType="f64";let t=function(V){function S(T,H=0,U,W){T=V.call(this,Float32Array,T,H,U,W)||this;T.elementType="f32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(n.BufferViewMat4Impl);t.ElementType="f32";n=function(V){function S(T,H=0,U,W){T=V.call(this,Float64Array,T,H,U,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(n.BufferViewMat4Impl);n.ElementType="f64";let q=function(V){function S(T,H=0,U,W){T=V.call(this,Float64Array,T,H,U,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);
q.ElementType="f64";let k=function(V){function S(T,H=0,U,W){T=V.call(this,Float64Array,T,H,U,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);k.ElementType="f64";let r=function(V){function S(T,H=0,U,W){T=V.call(this,Float64Array,T,H,U,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);r.ElementType="f64";let y=function(V){function S(T,H=0,U,W){T=V.call(this,Float64Array,T,H,U,W)||this;T.elementType="f64";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);
y.ElementType="f64";let f=function(V){function S(T,H=0,U,W){T=V.call(this,Uint8Array,T,H,U,W)||this;T.elementType="u8";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);f.ElementType="u8";let w=function(V){function S(T,H=0,U,W){T=V.call(this,Uint8Array,T,H,U,W)||this;T.elementType="u8";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);w.ElementType="u8";let z=function(V){function S(T,H=0,U,W){T=V.call(this,Uint8Array,T,H,U,W)||this;T.elementType="u8";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);
z.ElementType="u8";let A=function(V){function S(T,H=0,U,W){T=V.call(this,Uint8Array,T,H,U,W)||this;T.elementType="u8";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);A.ElementType="u8";let x=function(V){function S(T,H=0,U,W){T=V.call(this,Uint16Array,T,H,U,W)||this;T.elementType="u16";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);x.ElementType="u16";let B=function(V){function S(T,H=0,U,W){T=V.call(this,Uint16Array,T,H,U,W)||this;T.elementType="u16";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);
B.ElementType="u16";let C=function(V){function S(T,H=0,U,W){T=V.call(this,Uint16Array,T,H,U,W)||this;T.elementType="u16";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);C.ElementType="u16";let D=function(V){function S(T,H=0,U,W){T=V.call(this,Uint16Array,T,H,U,W)||this;T.elementType="u16";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);D.ElementType="u16";let E=function(V){function S(T,H=0,U,W){T=V.call(this,Uint32Array,T,H,U,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);
E.ElementType="u32";let F=function(V){function S(T,H=0,U,W){T=V.call(this,Uint32Array,T,H,U,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);F.ElementType="u32";let G=function(V){function S(T,H=0,U,W){T=V.call(this,Uint32Array,T,H,U,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);G.ElementType="u32";let O=function(V){function S(T,H=0,U,W){T=V.call(this,Uint32Array,T,H,U,W)||this;T.elementType="u32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);
O.ElementType="u32";let K=function(V){function S(T,H=0,U,W){T=V.call(this,Int8Array,T,H,U,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);K.ElementType="i8";let L=function(V){function S(T,H=0,U,W){T=V.call(this,Int8Array,T,H,U,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);L.ElementType="i8";let R=function(V){function S(T,H=0,U,W){T=V.call(this,Int8Array,T,H,U,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);
R.ElementType="i8";let M=function(V){function S(T,H=0,U,W){T=V.call(this,Int8Array,T,H,U,W)||this;T.elementType="i8";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);M.ElementType="i8";let J=function(V){function S(T,H=0,U,W){T=V.call(this,Int16Array,T,H,U,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);J.ElementType="i16";let I=function(V){function S(T,H=0,U,W){T=V.call(this,Int16Array,T,H,U,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);
I.ElementType="i16";let P=function(V){function S(T,H=0,U,W){T=V.call(this,Int16Array,T,H,U,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);P.ElementType="i16";let N=function(V){function S(T,H=0,U,W){T=V.call(this,Int16Array,T,H,U,W)||this;T.elementType="i16";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);N.ElementType="i16";l=function(V){function S(T,H=0,U,W){T=V.call(this,Int32Array,T,H,U,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(l.BufferViewScalarImpl);
l.ElementType="i32";u=function(V){function S(T,H=0,U,W){T=V.call(this,Int32Array,T,H,U,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(u.BufferViewVec2Impl);u.ElementType="i32";v=function(V){function S(T,H=0,U,W){T=V.call(this,Int32Array,T,H,U,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,V);S.prototype.slice=
function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(v.BufferViewVec3Impl);v.ElementType="i32";m=function(V){function S(T,H=0,U,W){T=V.call(this,Int32Array,T,H,U,W)||this;T.elementType="i32";return T}b._inheritsLoose(S,V);S.prototype.slice=function(T,H){return this.sliceBuffer(S,T,H)};S.fromTypedArray=function(T,H){return new S(T.buffer,T.byteOffset,H,T.byteOffset+T.byteLength)};return S}(m.BufferViewVec4Impl);
m.ElementType="i32";a.BufferViewFloat=h;a.BufferViewFloat64=q;a.BufferViewInt16=J;a.BufferViewInt32=l;a.BufferViewInt8=K;a.BufferViewMat3f=p;a.BufferViewMat3f64=c;a.BufferViewMat4f=t;a.BufferViewMat4f64=n;a.BufferViewUint16=x;a.BufferViewUint32=E;a.BufferViewUint8=f;a.BufferViewVec2f=d;a.BufferViewVec2f64=k;a.BufferViewVec2i16=I;a.BufferViewVec2i32=u;a.BufferViewVec2i8=L;a.BufferViewVec2u16=B;a.BufferViewVec2u32=F;a.BufferViewVec2u8=w;a.BufferViewVec3f=e;a.BufferViewVec3f64=r;a.BufferViewVec3i16=
P;a.BufferViewVec3i32=v;a.BufferViewVec3i8=R;a.BufferViewVec3u16=C;a.BufferViewVec3u32=G;a.BufferViewVec3u8=z;a.BufferViewVec4f=g;a.BufferViewVec4f64=y;a.BufferViewVec4i16=N;a.BufferViewVec4i32=m;a.BufferViewVec4i8=M;a.BufferViewVec4u16=D;a.BufferViewVec4u32=O;a.BufferViewVec4u8=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Mat3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,
b){let c=function(){function n(u,v,m=0,h,d){this.TypedArrayConstructor=u;this.elementCount=9;u=this.TypedArrayConstructor;void 0===h&&(h=9*u.BYTES_PER_ELEMENT);const e=0===v.byteLength?0:m;this.typedBuffer=null==d?new u(v,e):new u(v,e,(d-m)/u.BYTES_PER_ELEMENT);this.typedBufferStride=h/u.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var l=n.prototype;l.sliceBuffer=function(u,v,
m=this.count-v){v=this.typedBuffer.byteOffset+v*this.stride;return new u(this.buffer,v,this.stride,v+m*this.stride)};l.getMat=function(u,v){u*=this.typedBufferStride;for(let m=0;9>m;m++)v[m]=this.typedBuffer[u++];return v};l.setMat=function(u,v){u*=this.typedBufferStride;for(let m=0;9>m;m++)this.typedBuffer[u++]=v[m]};l.get=function(u,v){return this.typedBuffer[u*this.typedBufferStride+v]};l.set=function(u,v,m){this.typedBuffer[u*this.typedBufferStride+v]=m};l.copyFrom=function(u,v,m){const h=this.typedBuffer,
d=v.typedBuffer;u*=this.typedBufferStride;v=m*v.typedBufferStride;for(m=0;9>m;++m)h[u++]=d[v++]};b._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return n}();c.ElementCount=9;a.BufferViewMat3Impl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Mat4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(u,v,m=0,h,d){this.TypedArrayConstructor=
u;this.elementCount=16;u=this.TypedArrayConstructor;void 0===h&&(h=16*u.BYTES_PER_ELEMENT);const e=0===v.byteLength?0:m;this.typedBuffer=null==d?new u(v,e):new u(v,e,(d-m)/u.BYTES_PER_ELEMENT);this.typedBufferStride=h/u.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var l=n.prototype;l.sliceBuffer=function(u,v,m=this.count-v){v=this.typedBuffer.byteOffset+v*this.stride;return new u(this.buffer,
v,this.stride,v+m*this.stride)};l.getMat=function(u,v){u*=this.typedBufferStride;for(let m=0;16>m;m++)v[m]=this.typedBuffer[u++];return v};l.setMat=function(u,v){u*=this.typedBufferStride;for(let m=0;16>m;m++)this.typedBuffer[u++]=v[m]};l.get=function(u,v){return this.typedBuffer[u*this.typedBufferStride+v]};l.set=function(u,v,m){this.typedBuffer[u*this.typedBufferStride+v]=m};l.copyFrom=function(u,v,m){const h=this.typedBuffer,d=v.typedBuffer;u*=this.typedBufferStride;v=m*v.typedBufferStride;for(m=
0;16>m;++m)h[u++]=d[v++]};b._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return n}();c.ElementCount=16;a.BufferViewMat4Impl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Scalar":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(u,v,m=0,h,d){this.TypedArrayConstructor=u;this.elementCount=1;u=this.TypedArrayConstructor;
void 0===h&&(h=u.BYTES_PER_ELEMENT);const e=0===v.byteLength?0:m;this.typedBuffer=null==d?new u(v,e):new u(v,e,(d-m)/u.BYTES_PER_ELEMENT);this.typedBufferStride=h/u.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var l=n.prototype;l.sliceBuffer=function(u,v,m=this.count-v){v=this.typedBuffer.byteOffset+v*this.stride;return new u(this.buffer,v,this.stride,v+m*this.stride)};l.get=function(u){return this.typedBuffer[u*
this.typedBufferStride]};l.set=function(u,v){this.typedBuffer[u*this.typedBufferStride]=v};b._createClass(n,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return n}();c.ElementCount=1;a.BufferViewScalarImpl=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec2":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec2"],function(a,b,c){let n=function(){function l(v,
m,h=0,d,e){this.TypedArrayConstructor=v;this.elementCount=2;v=this.TypedArrayConstructor;void 0===d&&(d=2*v.BYTES_PER_ELEMENT);const g=0===m.byteLength?0:h;this.typedBuffer=null==e?new v(m,g):new v(m,g,(e-h)/v.BYTES_PER_ELEMENT);this.typedBufferStride=d/v.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var u=l.prototype;u.sliceBuffer=function(v,m,h=this.count-m){m=this.typedBuffer.byteOffset+
m*this.stride;return new v(this.buffer,m,this.stride,m+h*this.stride)};u.getVec=function(v,m){v*=this.typedBufferStride;return c.set(m,this.typedBuffer[v],this.typedBuffer[v+1])};u.setVec=function(v,m){v*=this.typedBufferStride;this.typedBuffer[v++]=m[0];this.typedBuffer[v]=m[1]};u.get=function(v,m){return this.typedBuffer[v*this.typedBufferStride+m]};u.set=function(v,m,h){this.typedBuffer[v*this.typedBufferStride+m]=h};u.setValues=function(v,m,h){v*=this.typedBufferStride;this.typedBuffer[v++]=m;
this.typedBuffer[v]=h};u.copyFrom=function(v,m,h){const d=this.typedBuffer,e=m.typedBuffer;v*=this.typedBufferStride;m=h*m.typedBufferStride;d[v++]=e[m++];d[v]=e[m]};b._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();n.ElementCount=2;a.BufferViewVec2Impl=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec3":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/vec3"],function(a,b,c){let n=function(){function l(v,m,h=0,d,e){this.TypedArrayConstructor=v;this.elementCount=3;v=this.TypedArrayConstructor;void 0===d&&(d=3*v.BYTES_PER_ELEMENT);const g=0===m.byteLength?0:h;this.typedBuffer=null==e?new v(m,g):new v(m,g,(e-h)/v.BYTES_PER_ELEMENT);this.typedBufferStride=d/v.BYTES_PER_ELEMENT;this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var u=
l.prototype;u.sliceBuffer=function(v,m,h=this.count-m){m=this.typedBuffer.byteOffset+m*this.stride;return new v(this.buffer,m,this.stride,m+h*this.stride)};u.getVec=function(v,m){v*=this.typedBufferStride;return c.set(m,this.typedBuffer[v],this.typedBuffer[v+1],this.typedBuffer[v+2])};u.setVec=function(v,m){v*=this.typedBufferStride;this.typedBuffer[v++]=m[0];this.typedBuffer[v++]=m[1];this.typedBuffer[v]=m[2]};u.get=function(v,m){return this.typedBuffer[v*this.typedBufferStride+m]};u.set=function(v,
m,h){this.typedBuffer[v*this.typedBufferStride+m]=h};u.setValues=function(v,m,h,d){v*=this.typedBufferStride;this.typedBuffer[v++]=m;this.typedBuffer[v++]=h;this.typedBuffer[v]=d};u.copyFrom=function(v,m,h){const d=this.typedBuffer,e=m.typedBuffer;v*=this.typedBufferStride;m=h*m.typedBufferStride;d[v++]=e[m++];d[v++]=e[m++];d[v]=e[m]};b._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();n.ElementCount=3;a.BufferViewVec3Impl=n;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/internals/Vec4":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4"],function(a,b,c){let n=function(){function l(v,m,h=0,d,e){this.TypedArrayConstructor=v;this.elementCount=4;v=this.TypedArrayConstructor;void 0===d&&(d=4*v.BYTES_PER_ELEMENT);const g=0===m.byteLength?0:h;this.typedBuffer=null==e?new v(m,g):new v(m,g,(e-h)/v.BYTES_PER_ELEMENT);this.typedBufferStride=d/v.BYTES_PER_ELEMENT;
this.count=Math.ceil(this.typedBuffer.length/this.typedBufferStride);this.stride=this.typedBufferStride*this.TypedArrayConstructor.BYTES_PER_ELEMENT}var u=l.prototype;u.sliceBuffer=function(v,m,h=this.count-m){m=this.typedBuffer.byteOffset+m*this.stride;return new v(this.buffer,m,this.stride,m+h*this.stride)};u.getVec=function(v,m){v*=this.typedBufferStride;return c.set(m,this.typedBuffer[v++],this.typedBuffer[v++],this.typedBuffer[v++],this.typedBuffer[v])};u.setVec=function(v,m){v*=this.typedBufferStride;
this.typedBuffer[v++]=m[0];this.typedBuffer[v++]=m[1];this.typedBuffer[v++]=m[2];this.typedBuffer[v]=m[3]};u.get=function(v,m){return this.typedBuffer[v*this.typedBufferStride+m]};u.set=function(v,m,h){this.typedBuffer[v*this.typedBufferStride+m]=h};u.setValues=function(v,m,h,d,e){v*=this.typedBufferStride;this.typedBuffer[v++]=m;this.typedBuffer[v++]=h;this.typedBuffer[v++]=d;this.typedBuffer[v]=e};u.copyFrom=function(v,m,h){const d=this.typedBuffer,e=m.typedBuffer;v*=this.typedBufferStride;m=h*
m.typedBufferStride;d[v++]=e[m++];d[v++]=e[m++];d[v++]=e[m++];d[v]=e[m]};b._createClass(l,[{key:"buffer",get:function(){return this.typedBuffer.buffer}}]);return l}();n.ElementCount=4;a.BufferViewVec4Impl=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/types":function(){define(["exports","../../../core/has"],function(a,b){a.elementTypeSize=function(c){switch(c){case "u8":return 1;case "u16":return 2;case "u32":return 4;case "i8":return 1;
case "i16":return 2;case "i32":return 4;case "f32":return 4;case "f64":return 8}};a.isInteger=function(c){switch(c){case "u8":case "u16":case "u32":case "i8":case "i16":case "i32":return!0;case "f32":case "f64":return!1}};a.isSigned=function(c){switch(c){case "u8":case "u16":case "u32":return!1;case "i8":case "i16":case "i32":case "f32":case "f64":return!0}};a.maximumValue=function(c){switch(c){case "u8":return 255;case "u16":return 65535;case "u32":return 4294967295;case "i8":return 127;case "i16":return 32767;
case "i32":return 2147483647;case "f32":return 3.402823E38;case "f64":return 1.79769E308}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GeometryUtil":function(){define("../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./basicInterfaces ./BufferVectorMath ./Geometry ./geometryDataUtils ./Util ./VertexAttribute".split(" "),function(a,
b,c,n,l,u,v,m,h,d,e){const g=v.Vec3Compact;var p;(function(y){const f=[[-.5,-.5,.5],[.5,-.5,.5],[.5,.5,.5],[-.5,.5,.5],[-.5,-.5,-.5],[.5,-.5,-.5],[.5,.5,-.5],[-.5,.5,-.5]],w=[0,0,1,-1,0,0,1,0,0,0,-1,0,0,1,0,0,0,-1],z=[0,0,1,0,1,1,0,1],A=new Uint16Array([0,1,2,2,3,0,4,0,3,3,7,4,1,5,6,6,2,1,1,0,4,4,5,1,3,2,6,6,7,3,5,4,7,7,6,5]),x=new Uint16Array(36);for(var B=0;6>B;B++)for(let D=0;6>D;D++)x[6*B+D]=B;const C=new Uint16Array(36);for(B=0;6>B;B++)C[6*B]=0,C[6*B+1]=1,C[6*B+2]=2,C[6*B+3]=2,C[6*B+4]=3,C[6*
B+5]=0;y.createGeometry=function(D){Array.isArray(D)||(D=[D,D,D]);const E=Array(24);for(let F=0;8>F;F++)E[3*F]=f[F][0]*D[0],E[3*F+1]=f[F][1]*D[1],E[3*F+2]=f[F][2]*D[2];return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:w}],[e.VertexAttribute.UV0,{size:2,data:z}]],[[e.VertexAttribute.POSITION,A],[e.VertexAttribute.NORMAL,x],[e.VertexAttribute.UV0,C]])}})(p||(p={}));var t;(function(y){const f=[[-.5,0,-.5],[.5,0,-.5],[.5,0,.5],[-.5,
0,.5],[0,-.5,0],[0,.5,0]],w=[0,1,-1,1,1,0,0,1,1,-1,1,0,0,-1,-1,1,-1,0,0,-1,1,-1,-1,0],z=new Uint16Array([5,1,0,5,2,1,5,3,2,5,0,3,4,0,1,4,1,2,4,2,3,4,3,0]),A=new Uint16Array([0,0,0,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7]);y.createGeometry=function(x){Array.isArray(x)||(x=[x,x,x]);const B=Array(18);for(let C=0;6>C;C++)B[3*C]=f[C][0]*x[0],B[3*C+1]=f[C][1]*x[1],B[3*C+2]=f[C][2]*x[2];return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:B,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:w}]],
[[e.VertexAttribute.POSITION,z],[e.VertexAttribute.NORMAL,A]])}})(t||(t={}));var q;(function(y){const f=b.fromValues(-.5,0,-.5),w=b.fromValues(.5,0,-.5),z=b.fromValues(0,0,.5),A=b.fromValues(0,.5,0),x=b.create(),B=b.create(),C=b.create(),D=b.create(),E=b.create();a.subtract(x,f,A);a.subtract(B,f,w);a.cross(C,x,B);a.normalize(C,C);a.subtract(x,w,A);a.subtract(B,w,z);a.cross(D,x,B);a.normalize(D,D);a.subtract(x,z,A);a.subtract(B,z,f);a.cross(E,x,B);a.normalize(E,E);const F=[f,w,z,A],G=[0,-1,0,C[0],
C[1],C[2],D[0],D[1],D[2],E[0],E[1],E[2]],O=[0,1,2,3,1,0,3,2,1,3,0,2],K=[0,0,0,1,1,1,2,2,2,3,3,3];y.createGeometry=function(L){Array.isArray(L)||(L=[L,L,L]);const R=Array(12);for(let M=0;4>M;M++)R[3*M]=F[M][0]*L[0],R[3*M+1]=F[M][1]*L[1],R[3*M+2]=F[M][2]*L[2];return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:R,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:G}]],[[e.VertexAttribute.POSITION,new Uint16Array(O)],[e.VertexAttribute.NORMAL,new Uint16Array(K)]])}})(q||(q={}));var k;(function(y){function f(A,
x,B,C,D){if(Math.abs(a.dot(x,A))>D)return!1;a.cross(B,A,x);a.normalize(B,B);a.cross(C,B,A);a.normalize(C,C);return!0}function w(A,x,B,C,D,E,F){return f(A,x,D,E,F)||f(A,B,D,E,F)||f(A,C,D,E,F)}y.createBoxGeometry=p.createGeometry;y.createDiamondGeometry=t.createGeometry;y.createTetrahedronGeometry=q.createGeometry;y.createSphereGeometry=function(A,x,B,C={uv:!0}){var D=-Math.PI,E=2*Math.PI,F=-Math.PI/2,G=Math.PI;x=Math.max(3,Math.floor(x));const O=Math.max(2,Math.floor(B));var K=(x+1)*(O+1);B=new Float32Array(3*
K);const L=new Float32Array(3*K);K=new Float32Array(2*K);const R=[];let M=0;for(var J=0;J<=O;J++){var I=[];const N=J/O,V=F+N*G,S=Math.cos(V);for(let T=0;T<=x;T++){const H=T/x;var P=D+H*E;const U=Math.cos(P)*S,W=Math.sin(V);P=-Math.sin(P)*S;B[3*M]=U*A;B[3*M+1]=W*A;B[3*M+2]=P*A;L[3*M]=U;L[3*M+1]=W;L[3*M+2]=P;K[2*M]=H;K[2*M+1]=N;I.push(M);++M}R.push(I)}A=new Uint32Array(2*x*(O-1)*3);M=0;for(D=0;D<O;D++)for(E=0;E<x;E++)F=R[D][E],G=R[D][E+1],J=R[D+1][E+1],I=R[D+1][E],0===D?(A[M++]=F,A[M++]=J,A[M++]=I):
D===O-1?(A[M++]=F,A[M++]=G,A[M++]=J):(A[M++]=F,A[M++]=G,A[M++]=J,A[M++]=J,A[M++]=I,A[M++]=F);x=[[e.VertexAttribute.POSITION,A],[e.VertexAttribute.NORMAL,A]];B=[[e.VertexAttribute.POSITION,{size:3,data:B,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:L,exclusive:!0}]];C.uv&&(B.push([e.VertexAttribute.UV0,{size:2,data:K,exclusive:!0}]),x.push([e.VertexAttribute.UV0,A]));C.offset&&(x[0][0]=e.VertexAttribute.OFFSET,B[0][0]=e.VertexAttribute.OFFSET,x.push([e.VertexAttribute.POSITION,new Uint32Array(A.length)]),
B.push([e.VertexAttribute.POSITION,{size:3,data:Float64Array.from(C.offset),exclusive:!0}]));return new m.Geometry(B,x)};y.createPolySphereGeometry=function(A,x,B){function C(G,O){G>O&&([G,O]=[O,G]);const K=G.toString()+"."+O.toString();if(F[K])return F[K];let L=D.length;D.length+=3;g.add(D,3*G,D,3*O,D,L);g.scale(D,L,A/g.length(D,L));L/=3;return F[K]=L}let D;B?(D=[0,-1,0,1,0,0,0,0,1,-1,0,0,0,0,-1,0,1,0],B=new Uint32Array([0,1,2,0,2,3,0,3,4,0,4,1,1,5,2,2,5,3,3,5,4,4,5,1])):(B=A*(1+Math.sqrt(5))/2,
D=[-A,B,0,A,B,0,-A,-B,0,A,-B,0,0,-A,B,0,A,B,0,-A,-B,0,A,-B,B,0,-A,B,0,A,-B,0,-A,-B,0,A],B=new Uint32Array([0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1]));for(var E=0;E<D.length;E+=3)g.scale(D,E,A/g.length(D,E));let F={};for(E=0;E<x;E++){const G=B.length,O=new Uint32Array(4*G);for(let K=0;K<G;K+=3){const L=B[K],R=B[K+1],M=B[K+2],J=C(L,R),I=C(R,M),P=C(M,L),N=4*K;O[N]=L;O[N+1]=J;O[N+2]=P;O[N+3]=R;O[N+4]=I;O[N+5]=J;
O[N+6]=M;O[N+7]=P;O[N+8]=I;O[N+9]=J;O[N+10]=I;O[N+11]=P}B=O;F={}}x=new Float32Array(D);for(E=0;E<x.length;E+=3)g.normalize(x,E);B=[[e.VertexAttribute.POSITION,B],[e.VertexAttribute.NORMAL,B]];x=[[e.VertexAttribute.POSITION,{size:3,data:new Float32Array(D),exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:x,exclusive:!0}]];return new m.Geometry(x,B)};y.createPointGeometry=function(A,x,B,C,D,E,F){x=x?[x[0],x[1],x[2]]:[0,0,0];A=A?[A[0],A[1],A[2]]:[0,0,1];E=E||[0,0];B=[[e.VertexAttribute.POSITION,
{size:3,data:x,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:A,exclusive:!0}],[e.VertexAttribute.UV0,{size:E.length,data:E}],[e.VertexAttribute.COLOR,{size:4,data:B?[255*B[0],255*B[1],255*B[2],3<B.length?255*B[3]:255]:[255,255,255,255],exclusive:!0}],[e.VertexAttribute.SIZE,{size:2,data:null!=C&&2===C.length?C:[1,1]}]];null!=D&&(D=new Float32Array([D[0],D[1],D[2],D[3]]),B.push([e.VertexAttribute.AUXPOS1,{size:4,data:D}]));null!=F&&(F=new Float32Array([F[0],F[1],F[2],F[3]]),B.push([e.VertexAttribute.AUXPOS2,
{size:4,data:F}]));return new m.Geometry(B,null,u.PrimitiveType.Point)};y.updatePointGeometry=function(A,x,B,C,D,E,F,G){if(null!=A){const {data:O}=G.getMutableAttribute(e.VertexAttribute.NORMAL);O[0]=A[0];O[1]=A[1];O[2]=A[2]}null!=x&&({data:A}=G.getMutableAttribute(e.VertexAttribute.POSITION),A[0]=x[0],A[1]=x[1],A[2]=x[2]);null!=B&&({data:x}=G.getMutableAttribute(e.VertexAttribute.COLOR),x[0]=B[0],x[1]=B[1],x[2]=B[2],x[3]=B[3]);null!=C&&({data:B}=G.getMutableAttribute(e.VertexAttribute.SIZE),B[0]=
C[0],B[1]=C[1]);null!=D&&({data:C}=G.getMutableAttribute(e.VertexAttribute.AUXPOS1),C[0]=D[0],C[1]=D[1],C[2]=D[2],C[3]=D[3]);null!=E&&({data:D}=G.getMutableAttribute(e.VertexAttribute.UV0),D[0]=E[0],D[1]=E[1]);null!=F&&({data:E}=G.getMutableAttribute(e.VertexAttribute.AUXPOS2),E[0]=F[0],E[1]=F[1],E[2]=F[2],E[3]=F[3])};y.createPointArrayGeometry=function(A,x){const B=new Float32Array(3*A.length),C=new Float32Array(x?3*A.length:3),D=new Uint32Array(A.length),E=new Uint32Array(A.length);for(let F=0;F<
A.length;F++)B[3*F]=A[F][0],B[3*F+1]=A[F][1],B[3*F+2]=A[F][2],x&&(C[3*F]=x[F][0],C[3*F+1]=x[F][1],C[3*F+2]=x[F][2]),D[F]=F,E[F]=0;x||(C[0]=0,C[1]=1,C[2]=0);return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:B,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:C,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,D],[e.VertexAttribute.NORMAL,x?D:E],[e.VertexAttribute.UV0,E]],u.PrimitiveType.Point)};y.createTriangleGeometry=function(){const A=
new Uint16Array([0,1,2]),x=new Uint16Array([0,0,0]),B=new Uint16Array([0,0,0]);return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:[0,0,0,0,0,100,100,0,0],exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:[0,1,0],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0],exclusive:!0}]],[[e.VertexAttribute.POSITION,A],[e.VertexAttribute.NORMAL,x],[e.VertexAttribute.UV0,B]])};const z=[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0]];y.createSquareGeometry=function(A=z){const x=Array(12);for(var B=
0;4>B;B++)for(let C=0;3>C;C++)x[3*B+C]=A[B][C];A=new Uint32Array([0,1,2,2,3,0]);B=new Uint32Array([0,0,0,0,0,0]);return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:x,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:[0,0,1,0,1,1,0,1],exclusive:!0}],[e.VertexAttribute.COLOR,{size:4,data:[255,255,255,255],exclusive:!0}]],[[e.VertexAttribute.POSITION,A],[e.VertexAttribute.NORMAL,B],[e.VertexAttribute.UV0,A],[e.VertexAttribute.COLOR,
B]])};y.createConeGeometry=function(A,x,B,C,D=!0,E=!0){var F=0,G=b.fromValues(0,F,0),O=b.fromValues(0,F+A,0),K=b.fromValues(0,-1,0),L=b.fromValues(0,1,0);C&&(F=A,O=b.fromValues(0,0,0),G=b.fromValues(0,F,0),K=b.fromValues(0,1,0),L=b.fromValues(0,-1,0));G=[O,G];K=[K,L];L=B+2;O=Math.sqrt(A*A+x*x);if(C)for(C=B-1;0<=C;C--){var R=2*Math.PI/B*C,M=b.fromValues(Math.cos(R)*x,F,Math.sin(R)*x);G.push(M);R=b.fromValues(A*Math.cos(R)/O,-x/O,A*Math.sin(R)/O);K.push(R)}else for(C=0;C<B;C++)R=2*Math.PI/B*C,M=b.fromValues(Math.cos(R)*
x,F,Math.sin(R)*x),G.push(M),R=b.fromValues(A*Math.cos(R)/O,x/O,A*Math.sin(R)/O),K.push(R);A=new Uint32Array(6*(B+2));B=new Uint32Array(6*(B+2));F=x=0;if(D){for(D=3;D<G.length;D++)A[x++]=1,A[x++]=D-1,A[x++]=D,B[F++]=0,B[F++]=0,B[F++]=0;A[x++]=G.length-1;A[x++]=2;A[x++]=1;B[F++]=0;B[F++]=0;B[F++]=0}if(E){for(E=3;E<G.length;E++)A[x++]=E,A[x++]=E-1,A[x++]=0,B[F++]=E,B[F++]=E-1,B[F++]=1;A[x++]=0;A[x++]=2;A[x++]=G.length-1;B[F++]=1;B[F++]=2;B[F++]=K.length-1}E=new Float32Array(3*L);for(D=0;D<L;D++)E[3*
D]=G[D][0],E[3*D+1]=G[D][1],E[3*D+2]=G[D][2];G=new Float32Array(3*L);for(D=0;D<L;D++)G[3*D]=K[D][0],G[3*D+1]=K[D][1],G[3*D+2]=K[D][2];return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:G,exclusive:!0}]],[[e.VertexAttribute.POSITION,A],[e.VertexAttribute.NORMAL,B]])};y.createCylinderGeometry=function(A,x,B,C,D,E){C=C?b.clone(C):b.fromValues(1,0,0);D=D?b.clone(D):b.fromValues(0,0,0);E=null==E?!0:E;var F=b.create();a.normalize(F,C);
var G=b.create();a.scale(G,F,Math.abs(A));var O=b.create();a.scale(O,G,-.5);a.add(O,O,D);const K=b.fromValues(0,1,0);.2>Math.abs(1-a.dot(F,K))&&a.set(K,0,0,1);const L=b.create();a.cross(L,F,K);a.normalize(L,L);a.cross(K,L,F);A=2*B+(E?2:0);D=B+(E?2:0);C=new Float32Array(3*A);const R=new Float32Array(3*D),M=new Float32Array(2*A),J=new Uint32Array(3*B*(E?4:2)),I=new Uint32Array(3*B*(E?4:2));E&&(C[3*(A-2)]=O[0],C[3*(A-2)+1]=O[1],C[3*(A-2)+2]=O[2],M[2*(A-2)]=0,M[2*(A-2)+1]=0,C[3*(A-1)]=C[3*(A-2)]+G[0],
C[3*(A-1)+1]=C[3*(A-2)+1]+G[1],C[3*(A-1)+2]=C[3*(A-2)+2]+G[2],M[2*(A-1)]=1,M[2*(A-1)+1]=1,R[3*(D-2)]=-F[0],R[3*(D-2)+1]=-F[1],R[3*(D-2)+2]=-F[2],R[3*(D-1)]=F[0],R[3*(D-1)+1]=F[1],R[3*(D-1)+2]=F[2]);F=0;const P=b.create(),N=b.create();for(let H=0;H<B;H++){var V=2*Math.PI/B*H;a.scale(P,K,Math.sin(V));a.scale(N,L,Math.cos(V));a.add(P,P,N);R[3*H]=P[0];R[3*H+1]=P[1];R[3*H+2]=P[2];a.scale(P,P,x);a.add(P,P,O);C[3*H]=P[0];C[3*H+1]=P[1];C[3*H+2]=P[2];M[2*H]=H/B;M[2*H+1]=0;C[3*(H+B)]=C[3*H]+G[0];C[3*(H+B)+
1]=C[3*H+1]+G[1];C[3*(H+B)+2]=C[3*H+2]+G[2];M[2*(H+B)]=H/B;M[2*H+1]=1;V=(H+1)%B;var S=F++,T=H;J[S]=H;I[S]=T;S=F++;T=H;J[S]=H+B;I[S]=T;S=F++;T=V;J[S]=V;I[S]=T;S=F++;T=V;J[S]=V;I[S]=T;S=F++;T=H;J[S]=H+B;I[S]=T;S=F++;T=V;J[S]=V+B;I[S]=T}if(E){for(x=0;x<B;x++)E=(x+1)%B,G=F++,O=D-2,J[G]=A-2,I[G]=O,G=F++,O=D-2,J[G]=x,I[G]=O,G=F++,O=D-2,J[G]=E,I[G]=O;for(x=0;x<B;x++)E=(x+1)%B,G=F++,O=D-1,J[G]=x+B,I[G]=O,G=F++,O=D-1,J[G]=A-1,I[G]=O,G=F++,O=D-1,J[G]=E+B,I[G]=O}return new m.Geometry([[e.VertexAttribute.POSITION,
{size:3,data:C,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:R,exclusive:!0}],[e.VertexAttribute.UV0,{size:2,data:M,exclusive:!0}]],[[e.VertexAttribute.POSITION,J],[e.VertexAttribute.NORMAL,I],[e.VertexAttribute.UV0,J]])};y.createTubeGeometry=function(A,x,B,C,D){B=B||10;C=null!=C?C:!0;d.assert(1<A.length);const E=[],F=[];for(let G=0;G<B;G++){E.push([0,-G-1,-((G+1)%B)-1]);const O=G/B*2*Math.PI;F.push([Math.cos(O)*x,Math.sin(O)*x])}return y.createPathExtrusionGeometry(F,A,[[0,0,0]],E,C,D)};
y.createPathExtrusionGeometry=function(A,x,B,C,D,E=b.fromValues(0,0,0)){var F=A.length;const G=new Float32Array(x.length*F*3+(6*B.length||0)),O=new Float32Array(x.length*F*3+(B?6:0));var K=(x.length-1)*F*6+6*C.length;const L=new Uint32Array(K);K=new Uint32Array(K);let R=0;var M=0;let J=0,I=0;const P=b.create(),N=b.create(),V=b.create(),S=b.create(),T=b.create(),H=b.create(),U=b.create(),W=c.create(),Q=b.create(),X=b.create(),ba=b.create(),aa=b.create(),ea=b.create(),ia=n.create();a.set(Q,0,1,0);a.subtract(N,
x[1],x[0]);a.normalize(N,N);D?(a.add(W,x[0],E),a.normalize(V,W)):a.set(V,0,0,1);w(N,V,Q,Q,T,V,.99619469809);a.copy(S,V);a.copy(aa,T);for(var ka=0;ka<B.length;ka++)a.scale(H,T,B[ka][0]),a.scale(W,V,B[ka][2]),a.add(H,H,W),a.add(H,H,x[0]),G[R++]=H[0],G[R++]=H[1],G[R++]=H[2];O[M++]=-N[0];O[M++]=-N[1];O[M++]=-N[2];for(ka=0;ka<C.length;ka++)L[J++]=0<C[ka][0]?C[ka][0]:-C[ka][0]-1+B.length,L[J++]=0<C[ka][1]?C[ka][1]:-C[ka][1]-1+B.length,L[J++]=0<C[ka][2]?C[ka][2]:-C[ka][2]-1+B.length,K[I++]=0,K[I++]=0,K[I++]=
0;ka=B.length;const la=B.length-1;for(let ca=0;ca<x.length;ca++){let Y=!1;0<ca&&(a.copy(P,N),ca<x.length-1?(a.subtract(N,x[ca+1],x[ca]),a.normalize(N,N)):Y=!0,a.add(X,P,N),a.normalize(X,X),a.add(ba,x[ca-1],S),n.fromPositionAndNormal(x[ca],X,ia),n.intersectRay(ia,l.wrap(ba,P),W)?(a.subtract(W,W,x[ca]),a.normalize(V,W),a.cross(T,X,V),a.normalize(T,T)):w(X,S,aa,Q,T,V,.99619469809),a.copy(S,V),a.copy(aa,T));D&&(a.add(W,x[ca],E),a.normalize(ea,W));for(let da=0;da<F;da++)if(a.scale(H,T,A[da][0]),a.scale(W,
V,A[da][1]),a.add(H,H,W),a.normalize(U,H),O[M++]=U[0],O[M++]=U[1],O[M++]=U[2],a.add(H,H,x[ca]),G[R++]=H[0],G[R++]=H[1],G[R++]=H[2],!Y){var Z=(da+1)%F;L[J++]=ka+da;L[J++]=ka+F+da;L[J++]=ka+Z;L[J++]=ka+Z;L[J++]=ka+F+da;L[J++]=ka+F+Z;for(Z=0;6>Z;Z++)K[I++]=L[J-6+Z]-la}ka+=F}A=x[x.length-1];for(x=0;x<B.length;x++)a.scale(H,T,B[x][0]),a.scale(W,V,B[x][1]),a.add(H,H,W),a.add(H,H,A),G[R++]=H[0],G[R++]=H[1],G[R++]=H[2];B=M/3;O[M++]=N[0];O[M++]=N[1];O[M++]=N[2];F=ka-F;for(M=0;M<C.length;M++)L[J++]=0<=C[M][0]?
ka+C[M][0]:-C[M][0]-1+F,L[J++]=0<=C[M][2]?ka+C[M][2]:-C[M][2]-1+F,L[J++]=0<=C[M][1]?ka+C[M][1]:-C[M][1]-1+F,K[I++]=B,K[I++]=B,K[I++]=B;return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:G,exclusive:!0}],[e.VertexAttribute.NORMAL,{size:3,data:O,exclusive:!0}]],[[e.VertexAttribute.POSITION,L],[e.VertexAttribute.NORMAL,K]])};y.createPolylineGeometry=function(A,x,B){d.assert(1<A.length,"createPolylineGeometry(): polyline needs at least 2 points");d.assert(3===A[0].length,"createPolylineGeometry(): malformed vertex");
d.assert(null==x||x.length===A.length,"createPolylineGeometry: need same number of points and normals");d.assert(null==x||3===x[0].length,"createPolylineGeometry(): malformed normal");var C=new Float64Array(3*A.length);const D=new Uint32Array(2*(A.length-1));var E=0,F=0;for(var G=0;G<A.length;G++){for(var O=0;3>O;O++)C[E++]=A[G][O];0<G&&(D[F++]=G-1,D[F++]=G)}E=[];F=[];E.push([e.VertexAttribute.POSITION,D]);F.push([e.VertexAttribute.POSITION,{size:3,data:C,exclusive:!0}]);if(x){C=new Float32Array(3*
x.length);G=0;for(O=0;O<A.length;O++)for(let K=0;3>K;K++)C[G++]=x[O][K];E.push([e.VertexAttribute.NORMAL,D]);F.push([e.VertexAttribute.NORMAL,{size:3,data:C,exclusive:!0}])}B&&(F.push([e.VertexAttribute.COLOR,{size:4,data:B}]),E.push([e.VertexAttribute.COLOR,h.generateDefaultIndexArray(B.length/4)]));return new m.Geometry(F,E,u.PrimitiveType.Line)};y.createExtrudedTriangle=function(A,x,B,C,D=0){const E=Array(18);A=[[-x,D,C/2],[B,D,C/2],[0,A+D,C/2],[-x,D,-C/2],[B,D,-C/2],[0,A+D,-C/2]];x=new Uint16Array([0,
1,2,3,0,2,2,5,3,1,4,5,5,2,1,1,0,3,3,4,1,4,3,5]);for(B=0;6>B;B++)E[3*B]=A[B][0],E[3*B+1]=A[B][1],E[3*B+2]=A[B][2];return new m.Geometry([[e.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}]],[[e.VertexAttribute.POSITION,x]])};y.transformInPlace=function(A,x){A=A.getMutableAttribute(e.VertexAttribute.POSITION).data;for(let B=0;B<A.length;B+=3)a.set(r,A[B],A[B+1],A[B+2]),a.transformMat4(r,r,x),A[B]=r[0],A[B+1]=r[1],A[B+2]=r[2]};y.cgToGIS=function(A,x=A){var B=A.vertexAttributes;A=B.get(e.VertexAttribute.POSITION).data;
if(B=B.get(e.VertexAttribute.NORMAL).data){var C=x.getMutableAttribute(e.VertexAttribute.NORMAL).data;for(var D=0;D<B.length;D+=3){const E=B[D+1];C[D+1]=-B[D+2];C[D+2]=E}}if(A)for(B=x.getMutableAttribute(e.VertexAttribute.POSITION).data,C=0;C<A.length;C+=3)D=A[C+1],B[C+1]=-A[C+2],B[C+2]=D;return x};y.makeOrthoBasisDirUp=f;y.makeOrthoBasisDirUpFallback=w})(k||(k={}));const r=b.create();return k})},"esri/views/3d/webgl-engine/lib/BufferVectorMath":function(){define(["exports"],function(a){a.Vec3Compact=
void 0;(function(b){b.length=function(c,n){const l=c[n],u=c[n+1];c=c[n+2];return Math.sqrt(l*l+u*u+c*c)};b.normalize=function(c,n){var l=c[n];const u=c[n+1],v=c[n+2];l=1/Math.sqrt(l*l+u*u+v*v);c[n]*=l;c[n+1]*=l;c[n+2]*=l};b.scale=function(c,n,l){c[n]*=l;c[n+1]*=l;c[n+2]*=l};b.add=function(c,n,l,u,v,m=n){v=v||c;v[m]=c[n]+l[u];v[m+1]=c[n+1]+l[u+1];v[m+2]=c[n+2]+l[u+2]};b.subtract=function(c,n,l,u,v,m=n){v=v||c;v[m]=c[n]-l[u];v[m+1]=c[n+1]-l[u+1];v[m+2]=c[n+2]-l[u+2]}})(a.Vec3Compact||(a.Vec3Compact=
{}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Geometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./BoundingInfo ./ContentObject ./ContentObjectType ./geometryDataUtils ./Util ./VertexAttribute".split(" "),function(a,b,c,n,l,u,v,m,h,d){function e(g){if(g.BYTES_PER_ELEMENT===Uint16Array.BYTES_PER_ELEMENT)return g;for(const p of g)if(65536<=p)return g;
return new Uint16Array(g)}u=function(g){function p(q,k=[],r=n.PrimitiveType.Triangle,y=-1){var f=g.call(this)||this;f._primitiveType=r;f.edgeIndicesLength=y;f.type=v.ContentObjectType.Geometry;f._vertexAttributes=new Map;f._indices=new Map;f._boundingInfo=null;for(const [w,z]of q)z&&f._vertexAttributes.set(w,{...z});if(null==k||0===k.length){q=f._vertexAttributes.values().next().value;q=null==q?0:q.data.length/q.size;k=m.generateDefaultIndexArray(q);f.edgeIndicesLength=0>f.edgeIndicesLength?q:f.edgeIndicesLength;
for(const w of f._vertexAttributes.keys())f._indices.set(w,k)}else for(const [w,z]of k)z&&(f._indices.set(w,e(z)),w===d.VertexAttribute.POSITION&&(f.edgeIndicesLength=0>f.edgeIndicesLength?f._indices.get(w).length:f.edgeIndicesLength));return f}b._inheritsLoose(p,g);var t=p.prototype;t.cloneShallow=function(){const q=new p([],void 0,this._primitiveType,void 0),{_vertexAttributes:k,_indices:r}=q;this._vertexAttributes.forEach((y,f)=>{k.set(f,y)});this._indices.forEach((y,f)=>{r.set(f,y)});q.screenToWorldRatio=
this.screenToWorldRatio;q._boundingInfo=this._boundingInfo;return q};t.getMutableAttribute=function(q){(q=this._vertexAttributes.get(q))&&!q.exclusive&&(q.data=Array.from(q.data),q.exclusive=!0);return q};t.computeAttachmentOrigin=function(q){return this.primitiveType===n.PrimitiveType.Triangle?this._computeAttachmentOriginTriangles(q):this._computeAttachmentOriginPoints(q)};t._computeAttachmentOriginTriangles=function(q){const k=this.indices.get(d.VertexAttribute.POSITION),r=this.vertexAttributes.get(d.VertexAttribute.POSITION);
return m.computeAttachmentOriginTriangles(r,k,q)};t._computeAttachmentOriginPoints=function(q){const k=this.indices.get(d.VertexAttribute.POSITION),r=this.vertexAttributes.get(d.VertexAttribute.POSITION);return m.computeAttachmentOriginPoints(r,k,q)};t.invalidateBoundingInfo=function(){this._boundingInfo=null};t._calculateBoundingInfo=function(){const q=this.indices.get(d.VertexAttribute.POSITION);if(0===q.length)return null;const k=this.primitiveType===n.PrimitiveType.Triangle?3:1;h.assert(0===q.length%
k,"Indexing error: "+q.length+" not divisible by "+k);const r=m.generateDefaultIndexArray(q.length/k),y=this.vertexAttributes.get(d.VertexAttribute.POSITION);return new l.BoundingInfo(r,k,q,y)};b._createClass(p,[{key:"vertexAttributes",get:function(){return this._vertexAttributes}},{key:"indices",get:function(){return this._indices}},{key:"indexCount",get:function(){const q=this._indices.values().next().value;return q?q.length:0}},{key:"primitiveType",get:function(){return this._primitiveType}},{key:"faceCount",
get:function(){return this.indexCount/3}},{key:"boundingInfo",get:function(){c.isNone(this._boundingInfo)&&(this._boundingInfo=this._calculateBoundingInfo());return this._boundingInfo}}]);return p}(u.ContentObject);a.Geometry=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/BoundingInfo":function(){define(["exports","../../../../core/PooledArray","../../../../chunks/vec3","../../../../chunks/vec3f64","./Util"],function(a,
b,c,n,l){let u=function(){function m(d,e,g,p){this.primitiveIndices=d;this._numIndexPerPrimitive=e;this.indices=g;this.position=p;this.center=n.create();l.assert(1<=d.length);l.assert(0===g.length%this._numIndexPerPrimitive);l.assert(g.length>=d.length*this._numIndexPerPrimitive);l.assert(3===p.size||4===p.size);const {data:t,size:q}=p;p=d.length;e=q*g[this._numIndexPerPrimitive*d[0]];v.clear();v.push(e);this.bbMin=n.fromValues(t[e],t[e+1],t[e+2]);this.bbMax=n.clone(this.bbMin);for(var k=0;k<p;++k){var r=
this._numIndexPerPrimitive*d[k];for(var y=0;y<this._numIndexPerPrimitive;++y){e=q*g[r+y];v.push(e);let f=t[e];this.bbMin[0]=Math.min(f,this.bbMin[0]);this.bbMax[0]=Math.max(f,this.bbMax[0]);f=t[e+1];this.bbMin[1]=Math.min(f,this.bbMin[1]);this.bbMax[1]=Math.max(f,this.bbMax[1]);f=t[e+2];this.bbMin[2]=Math.min(f,this.bbMin[2]);this.bbMax[2]=Math.max(f,this.bbMax[2])}}c.lerp(this.center,this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(this.bbMax[0]-this.bbMin[0],this.bbMax[1]-this.bbMin[1]),
this.bbMax[2]-this.bbMin[2]);d=this.radius*this.radius;for(g=0;g<v.length;++g)e=v.getItemAt(g),p=t[e]-this.center[0],k=t[e+1]-this.center[1],e=t[e+2]-this.center[2],r=p*p+k*k+e*e,r<=d||(r=Math.sqrt(r),y=.5*(r-this.radius),this.radius+=y,d=this.radius*this.radius,r=y/r,this.center[0]+=p*r,this.center[1]+=k*r,this.center[2]+=e*r);v.clear()}var h=m.prototype;h.getCenter=function(){return this.center};h.getBSRadius=function(){return this.radius};h.getBBMin=function(){return this.bbMin};h.getBBMax=function(){return this.bbMax};
h.getChildren=function(){if(this._children)return this._children;if(1<c.squaredDistance(this.bbMin,this.bbMax)){var d=c.lerp(n.create(),this.bbMin,this.bbMax,.5),e=this.primitiveIndices.length;const q=new Uint8Array(e),k=Array(8);for(var g=0;8>g;++g)k[g]=0;const {data:r,size:y}=this.position;for(g=0;g<e;++g){var p=0;const f=this._numIndexPerPrimitive*this.primitiveIndices[g];var t=y*this.indices[f];let w=r[t],z=r[t+1],A=r[t+2];for(let x=1;x<this._numIndexPerPrimitive;++x){t=y*this.indices[f+x];const B=
r[t],C=r[t+1];t=r[t+2];B<w&&(w=B);C<z&&(z=C);t<A&&(A=t)}w<d[0]&&(p|=1);z<d[1]&&(p|=2);A<d[2]&&(p|=4);q[g]=p;++k[p]}d=0;for(g=0;8>g;++g)0<k[g]&&++d;if(2>d)return;d=Array(8);for(g=0;8>g;++g)d[g]=0<k[g]?new Uint32Array(k[g]):void 0;for(g=0;8>g;++g)k[g]=0;for(g=0;g<e;++g)p=q[g],d[p][k[p]++]=this.primitiveIndices[g];this._children=Array(8);for(e=0;8>e;++e)void 0!==d[e]&&(this._children[e]=new m(d[e],this._numIndexPerPrimitive,this.indices,this.position))}return this._children};m.prune=function(){v.prune()};
return m}();const v=new b({deallocator:null});a.BoundingInfo=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ContentObject":function(){define(["exports","../../../../core/uid"],function(a,b){let c=function(){function n(){this.id=b.generateUID()}n.prototype.unload=function(){};return n}();a.ContentObject=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ContentObjectType":function(){define(["exports"],
function(a){a.ContentObjectType=void 0;var b=a.ContentObjectType||(a.ContentObjectType={});b[b.Layer=0]="Layer";b[b.Object=1]="Object";b[b.Geometry=2]="Geometry";b[b.Material=3]="Material";b[b.Texture=4]="Texture";b[b.COUNT=5]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/geometryDataUtils":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../../../../geometry/support/triangle"],
function(a,b,c,n){let l=(()=>{const g=new Uint32Array(131072);for(let p=0;p<g.length;++p)g[p]=p;return g})();const u=new Uint16Array([0]),v=(()=>{const g=new Uint16Array(65536);for(let p=0;p<g.length;++p)g[p]=p;return g})(),m=c.create(),h=c.create(),d=c.create(),e=c.create();a.computeAttachmentOriginLines=function(g,p,t,q){if(!g)return!1;const {size:k,data:r}=g;b.set(q,0,0,0);b.set(e,0,0,0);let y=g=0;const f=p?p.length-1:r.length/k-1;t=f+(t?2:0);for(let A=0;A<t;A+=2){var w=A<f?A:f,z=A<f?A+1:0;w=(p?
p[w]:w)*k;z=(p?p[z]:z)*k;m[0]=r[w+0];m[1]=r[w+1];m[2]=r[w+2];h[0]=r[z+0];h[1]=r[z+1];h[2]=r[z+2];b.scale(m,b.add(m,m,h),.5);z=b.dist(m,h);0<z?(b.add(q,q,b.scale(m,m,z)),g+=z):(b.add(e,e,m),y++)}return 0!==g?(b.scale(q,q,1/g),!0):0!==y?(b.scale(q,e,1/y),!0):!1};a.computeAttachmentOriginPoints=function(g,p,t){if(!g||!p)return!1;const {size:q,data:k}=g;b.set(t,0,0,0);g=-1;let r=0;for(let y=0;y<p.length;y++){const f=p[y]*q;g!==f&&(t[0]+=k[f+0],t[1]+=k[f+1],t[2]+=k[f+2],r++);g=f}1<r&&b.scale(t,t,1/r);
return 0<r};a.computeAttachmentOriginTriangles=function(g,p,t){if(!g)return!1;const {size:q,data:k}=g;b.set(t,0,0,0);b.set(e,0,0,0);let r=g=0;for(let f=0;f<p.length-2;f+=3){var y=p[f+0]*q;const w=p[f+1]*q,z=p[f+2]*q;b.set(m,k[y+0],k[y+1],k[y+2]);b.set(h,k[w+0],k[w+1],k[w+2]);b.set(d,k[z+0],k[z+1],k[z+2]);(y=n.areaPoints3d(m,h,d))?(b.add(m,m,h),b.add(m,m,d),b.scale(m,m,1/3*y),b.add(t,t,m),g+=y):(b.add(e,e,m),b.add(e,e,h),b.add(e,e,d),r+=3)}return 0===r&&0===g?!1:0!==g?(b.scale(t,t,1/g),!0):0!==r?(b.scale(t,
e,1/r),!0):!1};a.generateDefaultIndexArray=function(g){if(1===g)return u;if(g<v.length)return new Uint16Array(v.buffer,0,g);if(g>l.length){l=new Uint32Array(Math.max(2*l.length,g));for(let p=0;p<l.length;p++)l[p]=p}return new Uint32Array(l.buffer,0,g)};a.generateIndexArray=function(g){if(1===g)return new Uint16Array(u);if(g<v.length)return new Uint16Array(v.slice(0,g));if(g>l.length){g=new Uint32Array(g);for(let p=0;p<g.length;p++)g[p]=p;return g}return new Uint32Array(l.slice(0,g))};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/triangle":function(){define("exports ../../core/ObjectStack ../../chunks/vec3 ../../chunks/vec3f64 ./lineSegment ./vectorStacks".split(" "),function(a,b,c,n,l,u){function v(t){return t?{p0:n.clone(t.p0),p1:n.clone(t.p1),p2:n.clone(t.p2)}:{p0:n.create(),p1:n.create(),p2:n.create()}}function m(t,q,k,r=v()){c.copy(r.p0,t);c.copy(r.p1,q);c.copy(r.p2,k);return r}function h(t,q,k){return.5*Math.abs((q[0]-t[0])*(k[1]-
t[1])-(q[1]-t[1])*(k[0]-t[0]))}const d=new b.ObjectStack(l.create),e=new b.ObjectStack(()=>({p0:null,p1:null,p2:null})),g=n.create(),p=n.create();a.area2d=function(t){return h(t.p0,t.p1,t.p2)};a.areaPoints2d=h;a.areaPoints3d=function(t,q,k){c.subtract(g,q,t);c.subtract(p,k,t);return c.length(c.cross(g,g,p))/2};a.copy=function(t,q=v()){return m(t.p0,t.p1,t.p2,q)};a.create=v;a.distance2=function(t,q){var k=t.p0,r=t.p1;t=t.p2;const y=c.subtract(u.sv3d.get(),r,k),f=c.subtract(u.sv3d.get(),t,r),w=c.subtract(u.sv3d.get(),
k,t),z=c.subtract(u.sv3d.get(),q,k);var A=c.subtract(u.sv3d.get(),q,r),x=c.subtract(u.sv3d.get(),q,t);const B=c.cross(y,y,w),C=c.dot(c.cross(u.sv3d.get(),y,B),z);A=c.dot(c.cross(u.sv3d.get(),f,B),A);x=c.dot(c.cross(u.sv3d.get(),w,B),x);if(0<C&&0<A&&0<x)return q=c.dot(B,z),q*q/c.dot(B,B);k=l.distance2(l.fromValues(k,y,d.get()),q);r=l.distance2(l.fromValues(r,f,d.get()),q);q=l.distance2(l.fromValues(t,w,d.get()),q);return Math.min(k,r,q)};a.fromValues=m;a.intersectRay=function(t,q,k){const {direction:r,
origin:y}=q,{p0:f,p1:w,p2:z}=t;var A=w[0]-f[0],x=w[1]-f[1],B=w[2]-f[2];t=z[0]-f[0];q=z[1]-f[1];const C=z[2]-f[2];var D=r[1]*C-q*r[2],E=r[2]*t-C*r[0];const F=r[0]*q-t*r[1];var G=A*D+x*E+B*F;if(-1E-5<G&&1E-5>G)return!1;G=1/G;const O=y[0]-f[0],K=y[1]-f[1],L=y[2]-f[2];D=G*(O*D+K*E+L*F);if(0>D||1<D)return!1;E=K*B-x*L;B=L*A-B*O;A=O*x-A*K;x=G*(r[0]*E+r[1]*B+r[2]*A);if(0>x||1<D+x)return!1;k&&(c.scale(k,r,G*(t*E+q*B+C*A)),c.add(k,y,k));return!0};a.wrap=function(t,q,k){const r=e.get();r.p0=t;r.p1=q;r.p2=k;
return r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/Precipitation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/mathUtils ../../../core/maybe ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/projectionEllipsoid ./PrecipitationTechnique ./PrecipitationTechniqueConfiguration ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/AnimationTimer ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E){a.Precipitation=function(O){function K(R){var M=O.call(this,R)||this;M._numParticles=25E4;M._rainSpeed=.1;M._snowSpeed=.01;M._opacity=1;M._width=500;M._offset=q.create();M._tile=q.create();M._particleColor=t.create();M._particleColorAtNight=t.create();M._nightMultiplier=.7;M._cameraDirection=t.create();M._renderParameters=new y.PrecipitationPassParameters;M._animation=new A.AnimationTimer;M._updatingTracking=new k.WatchUpdatingTracking;
M._renderParameters.time=0;M._renderParameters.radius=r.getReferenceEllipsoid(R.view.spatialReference).radius;M._shaderTechniqueRepository=R.context.shaderTechniqueRepository;return M}b._inheritsLoose(K,O);var L=K.prototype;L.destroy=function(){this._updatingTracking.destroy();this._numParticles=0;this._snowTechnique=u.releaseMaybe(this._snowTechnique);this._rainTechnique=u.releaseMaybe(this._rainTechnique);this._vao=u.disposeMaybe(this._vao);this._instanceIdBuffer=u.disposeMaybe(this._instanceIdBuffer)};
L.update=function(R){return this._animation.advance(R)};L.render=function(R,M,J){const I="rainy"===J;var P=I?this.rainTechnique:this.snowTechnique;if(P.compiled){var N=R.rctx;this._ensureResources(N);u.isNone(P)||u.isNone(this._vao)||u.isNone(this._instanceIdBuffer)||(u.isSome(R.bindParameters.clouds.data)&&(this._opacity=1-R.bindParameters.clouds.fadeInOutHeight.factor),0>=this._opacity||(M=.5>M?l.lerp(0,.35,2*M):l.lerp(.35,1,2*(M-.5)),P=N.bindTechnique(P),this._renderParameters.camera=R.bindParameters.camera,
this._renderParameters.time=(I?this._rainSpeed:this._snowSpeed)*v.secondsFromMilliseconds(this._animation.time),this._renderParameters.time%=1E5,this._update(P,J,R),N.bindVAO(this._vao),R=y.PrecipitationTechnique.attributeLocation,P.assertCompatibleVertexAttributeLocations(this._vao),D.bindVertexBufferLayout(N,R,this._instanceIdBuffer,G,0),N.capabilities.instancing.drawArraysInstanced(C.PrimitiveType.TRIANGLES,0,3,this._numParticles*M),D.unbindVertexBufferLayout(N,R,this._instanceIdBuffer,G)))}else this.context.requestRender()};
L._update=function(R,M,J){const I=J.bindParameters.camera,P=I.eye;this._tile[0]=Math.floor((P[0]+.5*this._width)/this._width);this._tile[1]=Math.floor((P[1]+.5*this._width)/this._width);this._tile[2]=Math.floor((P[2]+.5*this._width)/this._width);this._offset[0]=P[0]-this._tile[0]*this._width;this._offset[1]=P[1]-this._tile[1]*this._width;this._offset[2]=P[2]-this._tile[2]*this._width;R.setUniform1f("width",this._width);R.setUniform3fv("offset",this._offset);R.setUniformMatrix4fv("view",I.viewMatrix);
R.setUniform3fv("cameraPosition",P);R.bindPass(null,J.bindParameters);R.setUniform1f("time",this._renderParameters.time);"rainy"===M?p.set(this._particleColor,.85,.85,.85):p.set(this._particleColor,1,1,1);p.scale(this._particleColorAtNight,this._particleColor,this._nightMultiplier);p.normalize(this._cameraDirection,P);M=Math.max(0,p.dot(this._cameraDirection,J.bindParameters.lighting.lightingMainDirection));p.lerp(this._particleColor,this._particleColorAtNight,this._particleColor,M);R.setUniform3fv("particleColor",
this._particleColor);R.setUniform1f("opacity",this._opacity)};L._ensureResources=function(R){u.isNone(this._vao)&&(this._vao=this._createVertexArrayObject(R));u.isNone(this._instanceIdBuffer)&&(this._instanceIdBuffer=this._createInstanceIndices(R))};L._createInstanceIndices=function(R){const M=[];for(let J=0;J<this._numParticles;J++)M.push(J);return B.BufferObject.createVertex(R,C.Usage.STATIC_DRAW,new Float32Array(M))};L._createVertexArrayObject=function(R){const M=new Float32Array([-1,0,1,1,0,-1,
1,0,1]);return new E.VertexArrayObject(R,y.PrecipitationTechnique.attributeLocation,{geometry:w.glLayout(F)},{geometry:B.BufferObject.createVertex(R,C.Usage.STATIC_DRAW,M)})};b._createClass(K,[{key:"updating",get:function(){return this._updatingTracking.updating}},{key:"rainTechnique",get:function(){if(u.isNone(this._rainTechnique)){const R=new f.PrecipitationTechniqueConfiguration;R.type=f.PrecipitationType.Rain;this._rainTechnique=this._shaderTechniqueRepository.acquire(y.PrecipitationTechnique,
R)}return this._rainTechnique}},{key:"snowTechnique",get:function(){if(u.isNone(this._snowTechnique)){const R=new f.PrecipitationTechniqueConfiguration;R.type=f.PrecipitationType.Snow;this._snowTechnique=this._shaderTechniqueRepository.acquire(y.PrecipitationTechnique,R)}return this._snowTechnique}}]);return K}(n);c.__decorate([m.property({constructOnly:!0})],a.Precipitation.prototype,"context",void 0);c.__decorate([m.property({constructOnly:!0})],a.Precipitation.prototype,"view",void 0);c.__decorate([m.property({readOnly:!0})],
a.Precipitation.prototype,"updating",null);c.__decorate([m.property()],a.Precipitation.prototype,"_updatingTracking",void 0);a.Precipitation=c.__decorate([g.subclass("esri.views.3d.environment.Precipitation")],a.Precipitation);const F=z.newLayout().vec3f(x.VertexAttribute.POSITION),G=w.glLayout(z.newLayout().f32(x.VertexAttribute.INSTANCEFEATUREATTRIBUTE),1);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/PrecipitationTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/Precipitation.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/Program ../webgl-engine/lib/VertexAttribute ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){l=function(g){function p(){var t=g.apply(this,arguments)||this;t.time=0;t.radius=1;return t}c._inheritsLoose(p,g);return p}(l.NoParameters);v=function(g){function p(){return g.apply(this,arguments)||this}c._inheritsLoose(p,g);var t=p.prototype;t.initializeProgram=function(q){const k=p.shader.get().build(this.configuration);return new m.Program(q.rctx,k,p.attributeLocation)};t.initializePipeline=function(){return e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.ONE,
d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:d.CompareFunction.LEQUAL},colorWrite:e.defaultColorWriteParams})};return p}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(n.Precipitation,()=>new Promise((g,p)=>a(["./Precipitation.glsl"],g,p)));v.attributeLocation=new Map([[h.VertexAttribute.POSITION,0],[h.VertexAttribute.INSTANCEFEATUREATTRIBUTE,1]]);b.PrecipitationPassParameters=l;b.PrecipitationTechnique=v;Object.defineProperties(b,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Precipitation.glsl":function(){define("exports ../views/3d/environment/PrecipitationTechniqueConfiguration ../views/3d/webgl-engine/core/shaderModules/Float3Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h){function d(g){const p=new m.ShaderBuilder;p.attributes.add(h.VertexAttribute.POSITION,"vec3");p.attributes.add(h.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"float");p.vertex.uniforms.add(new c.Float3Uniform("cameraPosition"));p.vertex.uniforms.add(new c.Float3Uniform("offset"));p.vertex.uniforms.add(new n.FloatUniform("width"));p.vertex.uniforms.add(new u.Matrix4PassUniform("proj",(t,q)=>q.camera.projectionMatrix));p.vertex.uniforms.add(new v.Matrix4Uniform("view"));p.vertex.uniforms.add(new n.FloatUniform("time"));
p.varyings.add("vUv","vec2");p.vertex.code.add(l.glsl`
    vec3 hash31(float p){
      vec3 p3 = fract(vec3(p) * vec3(0.1031, 0.1030, 0.0973));
      p3 += dot(p3, p3.yzx + 33.33);
      return fract((p3.xxy + p3.yzz) * p3.zyx);
    }

    float hash11(float p){
      p = fract(p * 0.1031);
      p *= p + 33.33;
      p *= p + p;
      return fract(p);
    }

    //https://www.geeks3d.com/20141201/how-to-rotate-a-vertex-by-a-quaternion-in-glsl/
    vec3 rotateVectorByQuaternion(vec3 v, vec4 q){
      return 2.0 * cross(q.xyz, v * q.w + cross(q.xyz, v)) + v;
    }

    void main(void) {

      vUv = position.xz;

      vec3 rand = hash31(instanceFeatureAttribute);

      // Set random position for all particles
      // The hash function space is not high resolution so offset particles by an additional random value
      // This creates grids of 1000 particles which are shifted by random hundreths of the tile width
      // overlaying multiple identical but offset grids
      vec3 randomPosition = 2.0 * (rand + (0.01 + 0.01 * rand) * floor(0.001 * instanceFeatureAttribute)) - 1.0;

      // Random orientation of rain drops
      float angle = 3.1415 * hash11(instanceFeatureAttribute);

      vec3 up = vec3(0, 0, 1);

      // Gravity and wind direction
      vec3 direction = normalize(cameraPosition);

      vec3 tangent = normalize(cross(direction, up));

      // Gravity
      vec3 animatedPos = randomPosition + direction * -time;

      // Rain particles fall straight down and are randomly oriented
      // Snow particles have random sinusoid trajectories and are rotated to face the camera
      ${g.type===b.PrecipitationType.Rain?l.glsl`
            // Random rotation for particle
            vec3 rotationAxis = up;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));
            vec3 transformedPos = rotateVectorByQuaternion(vec3(0.2, 0.2, 4.0) * (position - vec3(0.5, 0.0, 0.5)), quat);

            // Rotate particle to planetary position
            rotationAxis = tangent;
            angle = 0.5 * -acos(dot(direction, up));
            quat = vec4(rotationAxis * sin(angle), cos(angle));
            transformedPos = rotateVectorByQuaternion(transformedPos, quat);

            vec4 pos = mat4(mat3(view)) * vec4(transformedPos + (mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * pos;
      `:l.glsl`
            vec3 rotationAxis = direction;
            vec4 quat = vec4(rotationAxis * sin(angle), cos(angle));

            tangent = rotateVectorByQuaternion(tangent, quat);
            // Random sinusoid from friction
            animatedPos += tangent * 0.25 * sin(dot(animatedPos, direction));
            vec4 pos = mat4(mat3(view)) * vec4((mod(width * animatedPos - offset, width) - 0.5 * width), 1.0);
            gl_Position = proj * (0.5 * vec4(position.xzy, 0.0) + pos);
      `}
    }
  `);p.fragment.uniforms.add(new n.FloatUniform("opacity"));p.fragment.uniforms.add(new c.Float3Uniform("particleColor"));p.fragment.code.add(l.glsl`
    void main() {

      // Cut off corners of the triangle
      if(vUv.x < 0.0 || vUv.y < 0.0){
        discard;
      }

      float d = length(vUv - vec2(0.5));

      ${g.type===b.PrecipitationType.Rain?l.glsl`d = 0.35 * smoothstep(0.5, 0.0, d);`:l.glsl`d = smoothstep(0.5, 0.1, d);`}
      gl_FragColor = opacity * vec4(particleColor * d, d);
    }
  `);return p}const e=Object.freeze(Object.defineProperty({__proto__:null,build:d},Symbol.toStringTag,{value:"Module"}));a.Precipitation=e;a.build=d})},"esri/views/3d/environment/PrecipitationTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){a.PrecipitationType=void 0;(function(u){u[u.Rain=0]="Rain";u[u.Snow=1]="Snow";u[u.COUNT=2]="COUNT"})(a.PrecipitationType||
(a.PrecipitationType={}));let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.type=a.PrecipitationType.Rain;return m}b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.PrecipitationType.COUNT})],l.prototype,"type",void 0);a.PrecipitationTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/AnimationTimer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../../../../core/time"],function(a,b,c,n){let l=function(){function u(){this.enabled=!0;this._time=0}u.prototype.advance=function(v){if(c.isSome(v.forcedTime)){if(this._time===v.forcedTime)return!1;this._time=v.forcedTime;return!0}return this.enabled&&0!==v.dt?(this._time+=v.dt,!0):!1};b._createClass(u,[{key:"time",get:function(){return n.Milliseconds(this._time)}}]);return u}();a.AnimationTimer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/environment/SimpleAtmosphere":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../../geometry/support/spatialReferenceUtils ../../../support/requestImageUtils ./atmosphereUtils ../../../chunks/SimpleAtmosphere.glsl ./SimpleAtmosphereTechnique ./SimpleAtmosphereTechniqueConfiguration ./resources/MarsAtmosphereTexture ./resources/SimpleAtmosphereTexture ../support/mathUtils ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Util ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/Texture ../../webgl/Util ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R){function M(H,U,W,Q,X){const ba=e.length(H),aa=Q*Math.sqrt(ba*ba-Q*Q)/ba,ea=X.silCircleV1,ia=X.silCircleV2;e.scale(X.silCircleCenter,H,Math.sqrt(Q*Q-aa*aa)/ba);e.cross(ea,H,U);1>e.squaredLength(ea)&&e.cross(ea,H,W);e.scale(ea,ea,aa/e.length(ea));e.cross(ia,ea,H);e.scale(ia,ia,aa/e.length(ia));return aa}const J=b.getLogger("esri.views.3d.environment.SimpleAtmosphere"),I=-k.innerAtmosphereDepth,P=A.makePiecewiseLinearFunction([[50,
.1015625],[500,.21875],[5E3,.51171875],[5E4,.4140625]]);b=function(){function H(W){this.view=W;this.type="simple";this._renderData={texV:d.create(),silCircleCenter:g.create(),silCircleV1:g.create(),silCircleV2:g.create(),altitudeFade:0,innerScale:0,undergroundFadeAlpha:0};this._passParameters=new r.SimpleAtmospherePassParameters;this._fadeVaoCount=0;this._readyResolver=l.createResolver();this._readyController=new AbortController;this.texV1=1;this.canRender=!0;this.isOnMars=t.isMars(W.spatialReference);
W=p.getReferenceEllipsoid(W.spatialReference);this.planetRadius=W.radius;this.outerRimWidth=W.outerAtmosphereRimWidth;this.innerRimFactor=(this.planetRadius+I)/this.planetRadius;this.middleRimFactor=(this.planetRadius+0)/this.planetRadius;this.outerRimFactor=(this.planetRadius+this.outerRimWidth)/this.planetRadius;this.texV0=0/this.outerRimWidth;this.texVScale=this.texV1-this.texV0}var U=H.prototype;U.destroy=function(){this._readyResolver.reject();this._cameraChangeHandle=n.removeMaybe(this._cameraChangeHandle);
this._passParameters.texture=n.disposeMaybe(this._passParameters.texture);this._fadeVao=n.disposeMaybe(this._fadeVao);this._vao=n.disposeMaybe(this._vao);this._readyController=n.abortMaybe(this._readyController)};U.when=function(){return this._readyResolver.promise};U.initializeRenderContext=function(){var W=a._asyncToGenerator(function*(Q){this._shaderTechniqueRepository=Q.shaderTechniqueRepository;const X=Q.renderContext.rctx;this._cameraChangeHandle=u.watch(()=>{var ea;return null==(ea=this.view.state)?
void 0:ea.camera},()=>Q.requestRender(),u.syncAndInitial);this._vao=this._createRibbon(X);this._vaoCount=L.vertexCount(this._vao,"geometry");this._fadeVao=D.createQuadVAO(X);this._fadeVaoCount=L.vertexCount(this._fadeVao,"geometry");const ba=this.isOnMars?w:z,aa=this._readyController.signal;try{const ea=yield q.requestImage(ba,{signal:aa});l.throwIfAborted(aa);this._passParameters.texture=new K.Texture(X,{pixelFormat:O.PixelFormat.RGBA,dataType:O.PixelType.UNSIGNED_BYTE,wrapMode:O.TextureWrapMode.CLAMP_TO_EDGE,
samplingMode:O.TextureSamplingMode.LINEAR,flipped:!0},ea);Q.requestRender();this._readyController=null;this._readyResolver.resolve()}catch(ea){l.isAbortError(ea)||J.error("Unable to initialize simple atmosphere: image request failed",ea),this._readyResolver.reject(ea)}});return function(Q){return W.apply(this,arguments)}}();U.render=function(W){const Q=W.bindParameters.camera;this._update(Q);const X=W.rctx;if(1>this._renderData.undergroundFadeAlpha){const ba=X.bindTechnique(this.coneTechnique,this._passParameters,
W.bindParameters);ba.setUniformMatrix4fv("proj",Q.projectionMatrix);ba.setUniformMatrix4fv("view",Q.viewMatrix);ba.setUniform3fv("silCircleCenter",this._renderData.silCircleCenter);ba.setUniform3fv("silCircleV1",this._renderData.silCircleV1);ba.setUniform3fv("silCircleV2",this._renderData.silCircleV2);ba.setUniform2fv("texV",this._renderData.texV);ba.setUniform1f("altitudeFade",this._renderData.altitudeFade);ba.setUniform1f("innerScale",this._renderData.innerScale);X.bindVAO(this._vao);X.drawArrays(O.PrimitiveType.TRIANGLES,
0,this._vaoCount)}0<this._renderData.undergroundFadeAlpha&&(W=X.bindTechnique(this.undergroundTechnique,this._passParameters,W.bindParameters),W.setUniform1f("undergroundFadeAlpha",this._renderData.undergroundFadeAlpha),W.setUniform3fv("cameraPosition",Q.eye),X.bindVAO(this._fadeVao),X.drawArrays(O.PrimitiveType.TRIANGLE_STRIP,0,this._fadeVaoCount))};U.renderHaze=function(){return!1};U._update=function(W){var Q=g.create();const X=this.planetRadius;var ba=e.length(W.eye);const aa=ba-X;this._renderData.undergroundFadeAlpha=
0>aa?Math.min(-aa/5E3,1):0;var ea=X+I,ia=X+Math.max(50,aa);this._renderData.innerScale=ia*ia/(Math.sqrt(ia*ia-X*X)*Math.sqrt(ia*ia-ea*ea)+X*ea)-1;this._renderData.altitudeFade=k.computeInnerAltitudeFade(aa);e.scale(Q,W.eye,(X+50)/ba);M(Q,W.center,W.up,X,this._renderData);Q=this._computeScreenRimWidth(W,Q,W.up,this._renderData);ba=P(aa);ea=this.texV0+.001953125*this.texVScale;ia=this.texV0+Q*ba*this.texVScale;50<aa&&(M(W.eye,W.center,W.up,X,this._renderData),W=this._computeScreenRimWidth(W,W.eye,W.up,
this._renderData),W=c.clamp((W-1.5)/(Q-1.5),0,1),ea=this.texV0+.001953125*W*this.texVScale,ia=this.texV0+c.lerp(this.texV1,Q*ba,W)*this.texVScale);h.set(this._renderData.texV,ea,ia)};U._createRibbon=function(W){const Q=new Float32Array(1155),X=new Uint32Array(1920);Q[0]=0;Q[1]=0;Q[2]=-1;for(var ba=0;128>ba;ba++){var aa=9*ba+3;Q[aa+0]=ba;Q[aa+1]=this.innerRimFactor;Q[aa+2]=-1;Q[aa+3]=ba;Q[aa+4]=this.middleRimFactor;Q[aa+5]=0;Q[aa+6]=ba;Q[aa+7]=this.outerRimFactor;Q[aa+8]=1;aa=3*ba+1;var ea=127===ba?
1:aa+3,ia=15*ba;X[ia+0]=aa;X[ia+1]=aa+1;X[ia+2]=ea+1;X[ia+3]=ea+1;X[ia+4]=ea;X[ia+5]=aa;X[ia+6]=aa+1;X[ia+7]=aa+2;X[ia+8]=ea+2;X[ia+9]=ea+2;X[ia+10]=ea+1;X[ia+11]=aa+1;X[ia+12]=aa;X[ia+13]=ea;X[ia+14]=0}ba=T.createBuffer(X.length);aa=ba.position;for(ea=0;ea<X.length;++ea)ia=3*X[ea],aa.set(ea,0,Q[ia]),aa.set(ea,1,Q[ia+1]),aa.set(ea,2,Q[ia+2]);return new R.VertexArrayObject(W,C.Default3D,{geometry:x.glLayout(T)},{geometry:G.BufferObject.createVertex(W,O.Usage.STATIC_DRAW,ba.buffer)})};U._computeScreenRimWidth=
function(W,Q,X,ba){e.add(V,ba.silCircleCenter,ba.silCircleV2);e.scale(S,V,this.outerRimFactor);v.lookAt(N,Q,V,X);E.project(V,N,W.projectionMatrix,W.viewport);E.project(S,N,W.projectionMatrix,W.viewport);return e.distance(V,S)/W.height};a._createClass(H,[{key:"coneTechnique",get:function(){if(n.isNone(this._coneTechnique)){const W=new f.SimpleAtmosphereTechniqueConfiguration;W.geometry=f.SimpleAtmosphereGeometry.Cone;this._coneTechnique=this._shaderTechniqueRepository.acquire(y.SimpleAtmosphereTechnique,
W)}return this._coneTechnique}},{key:"undergroundTechnique",get:function(){if(n.isNone(this._undergroundTechnique)){const W=new f.SimpleAtmosphereTechniqueConfiguration;W.geometry=f.SimpleAtmosphereGeometry.Underground;this._undergroundTechnique=this._shaderTechniqueRepository.acquire(y.SimpleAtmosphereTechnique,W)}return this._undergroundTechnique}}]);return H}();const N=m.create(),V=g.create(),S=g.create(),T=B.newLayout().vec3f(F.VertexAttribute.POSITION);return b})},"esri/views/3d/environment/resources/MarsAtmosphereTexture":function(){define(function(){return"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAIACAYAAAE00TaTAAAACXBIWXMAAA7AAAAOwAFq1okJAAAKT2lDQ1BQaG90b3Nob3AgSUNDIHByb2ZpbGUAAHjanVNnVFPpFj333vRCS4iAlEtvUhUIIFJCi4AUkSYqIQkQSoghodkVUcERRUUEG8igiAOOjoCMFVEsDIoK2AfkIaKOg6OIisr74Xuja9a89+bN/rXXPues852zzwfACAyWSDNRNYAMqUIeEeCDx8TG4eQuQIEKJHAAEAizZCFz/SMBAPh+PDwrIsAHvgABeNMLCADATZvAMByH/w/qQplcAYCEAcB0kThLCIAUAEB6jkKmAEBGAYCdmCZTAKAEAGDLY2LjAFAtAGAnf+bTAICd+Jl7AQBblCEVAaCRACATZYhEAGg7AKzPVopFAFgwABRmS8Q5ANgtADBJV2ZIALC3AMDOEAuyAAgMADBRiIUpAAR7AGDIIyN4AISZABRG8lc88SuuEOcqAAB4mbI8uSQ5RYFbCC1xB1dXLh4ozkkXKxQ2YQJhmkAuwnmZGTKBNA/g88wAAKCRFRHgg/P9eM4Ors7ONo62Dl8t6r8G/yJiYuP+5c+rcEAAAOF0ftH+LC+zGoA7BoBt/qIl7gRoXgugdfeLZrIPQLUAoOnaV/Nw+H48PEWhkLnZ2eXk5NhKxEJbYcpXff5nwl/AV/1s+X48/Pf14L7iJIEyXYFHBPjgwsz0TKUcz5IJhGLc5o9H/LcL//wd0yLESWK5WCoU41EScY5EmozzMqUiiUKSKcUl0v9k4t8s+wM+3zUAsGo+AXuRLahdYwP2SycQWHTA4vcAAPK7b8HUKAgDgGiD4c93/+8//UegJQCAZkmScQAAXkQkLlTKsz/HCAAARKCBKrBBG/TBGCzABhzBBdzBC/xgNoRCJMTCQhBCCmSAHHJgKayCQiiGzbAdKmAv1EAdNMBRaIaTcA4uwlW4Dj1wD/phCJ7BKLyBCQRByAgTYSHaiAFiilgjjggXmYX4IcFIBBKLJCDJiBRRIkuRNUgxUopUIFVIHfI9cgI5h1xGupE7yAAygvyGvEcxlIGyUT3UDLVDuag3GoRGogvQZHQxmo8WoJvQcrQaPYw2oefQq2gP2o8+Q8cwwOgYBzPEbDAuxsNCsTgsCZNjy7EirAyrxhqwVqwDu4n1Y8+xdwQSgUXACTYEd0IgYR5BSFhMWE7YSKggHCQ0EdoJNwkDhFHCJyKTqEu0JroR+cQYYjIxh1hILCPWEo8TLxB7iEPENyQSiUMyJ7mQAkmxpFTSEtJG0m5SI+ksqZs0SBojk8naZGuyBzmULCAryIXkneTD5DPkG+Qh8lsKnWJAcaT4U+IoUspqShnlEOU05QZlmDJBVaOaUt2ooVQRNY9aQq2htlKvUYeoEzR1mjnNgxZJS6WtopXTGmgXaPdpr+h0uhHdlR5Ol9BX0svpR+iX6AP0dwwNhhWDx4hnKBmbGAcYZxl3GK+YTKYZ04sZx1QwNzHrmOeZD5lvVVgqtip8FZHKCpVKlSaVGyovVKmqpqreqgtV81XLVI+pXlN9rkZVM1PjqQnUlqtVqp1Q61MbU2epO6iHqmeob1Q/pH5Z/YkGWcNMw09DpFGgsV/jvMYgC2MZs3gsIWsNq4Z1gTXEJrHN2Xx2KruY/R27iz2qqaE5QzNKM1ezUvOUZj8H45hx+Jx0TgnnKKeX836K3hTvKeIpG6Y0TLkxZVxrqpaXllirSKtRq0frvTau7aedpr1Fu1n7gQ5Bx0onXCdHZ4/OBZ3nU9lT3acKpxZNPTr1ri6qa6UbobtEd79up+6Ynr5egJ5Mb6feeb3n+hx9L/1U/W36p/VHDFgGswwkBtsMzhg8xTVxbzwdL8fb8VFDXcNAQ6VhlWGX4YSRudE8o9VGjUYPjGnGXOMk423GbcajJgYmISZLTepN7ppSTbmmKaY7TDtMx83MzaLN1pk1mz0x1zLnm+eb15vft2BaeFostqi2uGVJsuRaplnutrxuhVo5WaVYVVpds0atna0l1rutu6cRp7lOk06rntZnw7Dxtsm2qbcZsOXYBtuutm22fWFnYhdnt8Wuw+6TvZN9un2N/T0HDYfZDqsdWh1+c7RyFDpWOt6azpzuP33F9JbpL2dYzxDP2DPjthPLKcRpnVOb00dnF2e5c4PziIuJS4LLLpc+Lpsbxt3IveRKdPVxXeF60vWdm7Obwu2o26/uNu5p7ofcn8w0nymeWTNz0MPIQ+BR5dE/C5+VMGvfrH5PQ0+BZ7XnIy9jL5FXrdewt6V3qvdh7xc+9j5yn+M+4zw33jLeWV/MN8C3yLfLT8Nvnl+F30N/I/9k/3r/0QCngCUBZwOJgUGBWwL7+Hp8Ib+OPzrbZfay2e1BjKC5QRVBj4KtguXBrSFoyOyQrSH355jOkc5pDoVQfujW0Adh5mGLw34MJ4WHhVeGP45wiFga0TGXNXfR3ENz30T6RJZE3ptnMU85ry1KNSo+qi5qPNo3ujS6P8YuZlnM1VidWElsSxw5LiquNm5svt/87fOH4p3iC+N7F5gvyF1weaHOwvSFpxapLhIsOpZATIhOOJTwQRAqqBaMJfITdyWOCnnCHcJnIi/RNtGI2ENcKh5O8kgqTXqS7JG8NXkkxTOlLOW5hCepkLxMDUzdmzqeFpp2IG0yPTq9MYOSkZBxQqohTZO2Z+pn5mZ2y6xlhbL+xW6Lty8elQfJa7OQrAVZLQq2QqboVFoo1yoHsmdlV2a/zYnKOZarnivN7cyzytuQN5zvn//tEsIS4ZK2pYZLVy0dWOa9rGo5sjxxedsK4xUFK4ZWBqw8uIq2Km3VT6vtV5eufr0mek1rgV7ByoLBtQFr6wtVCuWFfevc1+1dT1gvWd+1YfqGnRs+FYmKrhTbF5cVf9go3HjlG4dvyr+Z3JS0qavEuWTPZtJm6ebeLZ5bDpaql+aXDm4N2dq0Dd9WtO319kXbL5fNKNu7g7ZDuaO/PLi8ZafJzs07P1SkVPRU+lQ27tLdtWHX+G7R7ht7vPY07NXbW7z3/T7JvttVAVVN1WbVZftJ+7P3P66Jqun4lvttXa1ObXHtxwPSA/0HIw6217nU1R3SPVRSj9Yr60cOxx++/p3vdy0NNg1VjZzG4iNwRHnk6fcJ3/ceDTradox7rOEH0x92HWcdL2pCmvKaRptTmvtbYlu6T8w+0dbq3nr8R9sfD5w0PFl5SvNUyWna6YLTk2fyz4ydlZ19fi753GDborZ752PO32oPb++6EHTh0kX/i+c7vDvOXPK4dPKy2+UTV7hXmq86X23qdOo8/pPTT8e7nLuarrlca7nuer21e2b36RueN87d9L158Rb/1tWeOT3dvfN6b/fF9/XfFt1+cif9zsu72Xcn7q28T7xf9EDtQdlD3YfVP1v+3Njv3H9qwHeg89HcR/cGhYPP/pH1jw9DBY+Zj8uGDYbrnjg+OTniP3L96fynQ89kzyaeF/6i/suuFxYvfvjV69fO0ZjRoZfyl5O/bXyl/erA6xmv28bCxh6+yXgzMV70VvvtwXfcdx3vo98PT+R8IH8o/2j5sfVT0Kf7kxmTk/8EA5jz/GMzLdsAAAAgY0hSTQAAeiUAAICDAAD5/wAAgOkAAHUwAADqYAAAOpgAABdvkl/FRgAAAp1JREFUSMd9lcmSEzEQRCtflnqxYZgIThBDAP//kXDQ0pJtuDhqycxWZ5fKERFCERARIAVEyCjCtSFFEjWVa9q7OdJE0oiidIhKhRBROlhloiGVhaYERQHJWFEwMpYKrjUlibI2cqSJIJEpKNmM2c3GkRTOJDnThTMpnMWu0VFszs3Jfbe5bza3w+a229yOIs6zmP3czfn1K2w/for8+EVU15pNmmyqkeJyclinXNJRu1xrUaJmjmdzJiejVNt7zZVBRAIq1RwrsrrWnez+SR7WmQQP/1itKz2q/pmzuJtYnNy2bth9x9z2NLfDcB7FHOcGx6ebOb9/iPzxG/ztg4iorglFiKjzF9HSNphCoRb1OY3RZQJrYgRdT68bmgXGDdBzrTG8qNS7QP/m19ef7tGlcoH7vESYkK70uoPuOLEetz0IqeGoWQW6MlB/j36EnipYGKPWwDRg/RkNhXCNJIzAhMk6PrDePJNII6JHqM5VWqYApCtNFPe0GFFGtOWopWCrEVBSoiQi06KkRRaD08IlxXa/ifz8Jvz2LvjyLnh7F/r8Rei8a8xfjNkIrpmMOQ1C02COrkTEHxGhh+6DQJfXc/eZprXxcIyVIf1LJVgWvKaHvwI/1aQxtv851SQ/nqGXL6MHFVY3nmhLyqKsWO/+qzWif+yS1TpNKq8NezjGPCV69ciZoQj1PwfN6QRpWyCGVMe1D/AAHt3/gefu1Ign3AVpjOiNXkN90JlpL6TUnzFEUU+Jvks0tkp/dY3Fy1TzI24BWwsYJPyg11Q0FqDwK72xIz2kLojbeuxS1FpgtfNWyMX1gFw0j3W7RNeSHTVEe3VaV7SdCzVywFaEt02w7QH7Eeg4AvZDNdJ+Cu1HENsutO+Byi6ilEBZ9BeCNBJceJIjHgAAAABJRU5ErkJggg\x3d\x3d"})},
"esri/views/3d/environment/Stars":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../assets ../../../core/Accessor ../../../core/Error ../../../core/Logger ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../core/support/WatchUpdatingTracking ./StarsTechnique ../support/buffer/glUtil ../support/buffer/InterleavedLayout ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/VertexAttribute ../../webgl/BufferObject ../../webgl/enums ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D){const E=v.getLogger("esri.views.3d.environment.Stars");a.Stars=function(R){function M(I){I=R.call(this,I)||this;I._loadDataTask=null;I._numPoints=0;I._renderParameter=new f.StarPassParameters;I._updatingTracking=new y.WatchUpdatingTracking;return I}b._inheritsLoose(M,R);var J=M.prototype;J.initialize=function(){this._loadDataTask=this._createLoadDataTask()};J.destroy=function(){this._loadDataTask=m.abortMaybe(this._loadDataTask);this._updatingTracking.destroy();
this._numPoints=0;this._technique=m.releaseMaybe(this._technique);this._vao=m.disposeMaybe(this._vao)};J.render=function(I){const {rctx:P}=I;this._ensureResources(P);m.isNone(this._technique)||m.isNone(this._vao)||(this._technique.compiled?(I=P.bindTechnique(this._technique,this._renderParameter,I.bindParameters),P.bindVAO(this._vao),I.assertCompatibleVertexAttributeLocations(this._vao),P.drawArrays(C.PrimitiveType.POINTS,0,this._numPoints)):this.requestRender())};J._ensureResources=function(I){if(!m.isSome(this._technique)&&
!m.isNone(L)){this._technique=new f.StarsTechnique({rctx:I,viewingMode:this.view.state.viewingMode});this._numPoints=L.byteLength/9;var P=new Float32Array(L,0,2*this._numPoints),N=new Uint8Array(L,8*this._numPoints,this._numPoints);this._vao=this._createVertexArrayObject(I,P,N,this._numPoints);this._updatingTracking.add(()=>"sun"===this.view.environment.lighting.type?this.view.environment.lighting.date:null,V=>this._update(V),d.initial)}};J._computeDayDuration=function(I){const P=new Date(I.getFullYear(),
0,1,11,58,56),N=new Date(I.getFullYear()+1,0,1,11,58,55);return(+I-+P)/(+N-+P)};J._update=function(I){if(I){var P=I.getHours()/12,N=I.getMinutes()/60*(2/24),V=I.getSeconds()/60*(2/1440);P=(P+N+V-.9972222)%2;I=2*this._computeDayDuration(I);N=k.copy(this._renderParameter.modelMatrix,O);k.rotateZ(N,N,-I*Math.PI);k.multiply(N,G,N);k.rotateZ(N,N,-P*Math.PI);this.requestRender()}};J._hexToRGB=function(I){return[parseInt(I.substring(0,2),16),parseInt(I.substring(2,4),16),parseInt(I.substring(4,6),16)]};
J._unpackUint8Attributes=function(I){return 192<=I?[2.9,I-192]:160<=I?[2.5,I-160]:128<=I?[2,I-128]:96<=I?[1.5,I-96]:64<=I?[1,I-64]:32<=I?[.7,I-32]:[.4,I]};J._createVertexArrayObject=function(I,P,N,V){const S=K.createBuffer(V),T=S.position,H=S.color,U=S.size;for(let X=0;X<V;X++){var W=P[2*X],Q=P[2*X+1];T.set(X,0,-Math.cos(W)*Math.sin(Q));T.set(X,1,-Math.sin(W)*Math.sin(Q));T.set(X,2,-Math.cos(Q));W=this._unpackUint8Attributes(N[X]);Q=this._hexToRGB(F[W[1]]);H.set(X,0,255*Q[0]);H.set(X,1,255*Q[1]);
H.set(X,2,255*Q[2]);H.set(X,3,255);U.set(X,W[0])}return new D.VertexArrayObject(I,A.Default3D,{geometry:w.glLayout(K)},{geometry:B.BufferObject.createVertex(I,C.Usage.STATIC_DRAW,S.buffer)})};J._createLoadDataTask=function(){var I=this;if(m.isSome(L))return null;const P=h.createTask(function(){var N=b._asyncToGenerator(function*(V){({data:V}=yield n.fetchAsset("esri/views/3d/environment/resources/stars.wsv",{responseType:"array-buffer",signal:V}));I._verifyStarData(V);L=V});return function(V){return N.apply(this,
arguments)}}());P.promise.catch(N=>{h.isAbortError(N)||E.error(N)}).then(()=>{this.destroyed||(this.requestRender(),this.notifyChange("updating"))});return P};J._verifyStarData=function(I){if(!I)throw new u("stars:no-data-received","Failed to create stars because star catalogue is missing");I=I.byteLength/9;if(0!==I%1||5E4<I||5E3>I)throw new u("stars:invalid-data","Failed to create stars because star catalogue data is invalid");};b._createClass(M,[{key:"updating",get:function(){return this._updatingTracking.updating||
this.loading}},{key:"loading",get:function(){return m.isSome(this._loadDataTask)&&!this._loadDataTask.finished}}]);return M}(l);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"view",void 0);c.__decorate([e.property({constructOnly:!0})],a.Stars.prototype,"requestRender",void 0);c.__decorate([e.property({readOnly:!0})],a.Stars.prototype,"updating",null);c.__decorate([e.property()],a.Stars.prototype,"_loadDataTask",void 0);c.__decorate([e.property()],a.Stars.prototype,"_updatingTracking",
void 0);a.Stars=c.__decorate([q.subclass("esri.views.3d.environment.Stars")],a.Stars);const F="9bb2ff;9eb5ff;aabfff;bbccff;ccd8ff ;dae2ff;e4e9ff;eeefff;f8f6ff;fff9fb;fff5ef;fff1e5;ffeddb;ffe9d2;ffe6ca;ffe3c3;ffe0bb;ffddb4;ffdaad;ffd6a5;ffd29c;ffcc8f;ffc178;ffa94b;ff7b00".split(";"),G=r.fromValues(1,0,0,0,0,.9174771405229186,.39778850739794974,0,0,-.39778850739794974,.9174771405229186,0,0,0,0,1),O=r.fromValues(1,0,0,0,0,.9174771405229186,-.39778850739794974,0,0,.39778850739794974,.9174771405229186,
0,0,0,0,1),K=z.newLayout().vec3f(x.VertexAttribute.POSITION).vec4u8(x.VertexAttribute.COLOR).f32(x.VertexAttribute.SIZE);let L=null;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/environment/StarsTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/mat4f64 ../../../chunks/Stars.glsl ../webgl-engine/core/shaderModules/interfaces ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){u=function(p){function t(){var q=p.apply(this,arguments)||this;q.modelMatrix=n.create();return q}c._inheritsLoose(t,p);return t}(u.NoParameters);m=function(p){function t(k){var r;return r=p.call(this,k,null,()=>r.destroy())||this}c._inheritsLoose(t,p);var q=t.prototype;q.initializeProgram=function(k){const r=t.shader.get().build();return new d.Program(k.rctx,r,h.Default3D)};q.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.SRC_ALPHA,
e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:e.CompareFunction.LEQUAL},colorWrite:g.defaultColorWriteParams})};return t}(m.ShaderTechnique);m.shader=new v.ReloadableShaderModule(l.Stars,()=>new Promise((p,t)=>a(["./Stars.glsl"],p,t)));b.StarPassParameters=u;b.StarsTechnique=m;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Stars.glsl":function(){define("exports ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(){const p=new h.ShaderBuilder;p.attributes.add(d.VertexAttribute.POSITION,"vec3");p.attributes.add(d.VertexAttribute.COLOR,"vec4");p.attributes.add(d.VertexAttribute.SIZE,"float");p.varyings.add("vcolor","vec4");p.varyings.add("vsize","float");p.vertex.uniforms.add([new m.Matrix4PassUniform("transform",(t,q)=>{b.copy(g,q.camera.projectionMatrix);g[10]=2.4E-7-1;g[11]=-1;g[14]=(2.4E-7-2)*q.camera.near;b.multiply(g,g,q.camera.viewMatrix);return b.multiply(g,g,
t.modelMatrix)}),new l.Float4PassUniform("viewport",(t,q)=>q.camera.fullViewport),new u.FloatPassUniform("pixelRatio",(t,q)=>q.camera.pixelRatio)]);p.include(n.AlignPixel);p.vertex.code.add(v.glsl`void main(void) {
vec4 posProj = transform * vec4(position, 0);
gl_Position = alignToPixelCenter(posProj, viewport.zw);
vcolor = color / 1.2;
vsize = size * 5.0 * pixelRatio;
gl_PointSize = vsize;
}`);p.fragment.code.add(v.glsl`void main() {
float cap = 0.7;
float scale = 1.0 / cap;
float helper = clamp(length(abs(gl_PointCoord - vec2(0.5))), 0.0, cap);
float alpha = clamp((cap - helper) * scale, 0.0, 1.0);
float intensity = alpha * alpha * alpha;
if (vsize < 3.0) {
intensity *= 0.5;
}
gl_FragColor = vec4(vcolor.xyz, intensity);
}`);return p}const g=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:e},Symbol.toStringTag,{value:"Module"}));a.Stars=c;a.build=e})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AlignPixel=function(c){const n=b.glsl`vec4 alignToPixelCenter(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.500123) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = (floor(xy * widthHeight) + vec2(0.5)) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`,l=b.glsl`vec4 alignToPixelOrigin(vec4 clipCoord, vec2 widthHeight) {
vec2 xy = vec2(0.5) + 0.5 * clipCoord.xy / clipCoord.w;
vec2 pixelSz = vec2(1.0) / widthHeight;
vec2 ij = floor((xy + 0.5 * pixelSz) * widthHeight) * pixelSz;
vec2 result = (ij * 2.0 - vec2(1.0)) * clipCoord.w;
return vec4(result, clipCoord.zw);
}`;c.vertex.code.add(n);c.vertex.code.add(l);c.fragment.code.add(n);c.fragment.code.add(l)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderPass":function(){define(["exports"],function(a){a.RenderPass=void 0;var b=a.RenderPass||(a.RenderPass={});b[b.MATERIAL=0]="MATERIAL";b[b.MATERIAL_ALPHA=1]="MATERIAL_ALPHA";b[b.MATERIAL_DEPTH=2]="MATERIAL_DEPTH";b[b.MATERIAL_NORMAL=3]="MATERIAL_NORMAL";b[b.MATERIAL_DEPTH_SHADOWMAP_ALL=
4]="MATERIAL_DEPTH_SHADOWMAP_ALL";b[b.MATERIAL_HIGHLIGHT=5]="MATERIAL_HIGHLIGHT";b[b.MATERIAL_DEPTH_SHADOWMAP_DEFAULT=6]="MATERIAL_DEPTH_SHADOWMAP_DEFAULT";b[b.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT=7]="MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/sunUtils":function(){define("exports ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../ViewingMode ../../../chunks/SunCalc ./mathUtils".split(" "),
function(a,b,c,n,l,u,v,m,h){function d(x,B,C,D){const E=r,F=c.identity(k);if(C===v.ViewingMode.Global)m.SunCalc.getPosition(x,0,0,E),l.set(D,0,0,-1),c.rotateX(F,F,-E.azimuth),c.rotateY(F,F,-E.altitude);else{var G=t.planarDirection;C=G.globalAngles;G=(Math.abs(B[2])-G.localAltitude)/(G.globalAltitude-G.localAltitude);G=b.clamp(G,0,1);1>G?(m.SunCalc.getPosition(x,B[1],B[0],E),E.azimuth=(1-G)*E.azimuth+G*C.azimuth,E.altitude=(1-G)*E.altitude+G*C.altitude):(E.azimuth=C.azimuth,E.altitude=C.altitude);
l.set(D,0,-1,0);c.rotateZ(F,F,-E.azimuth);c.rotateX(F,F,-E.altitude)}l.transformMat4(D,D,F)}function e(x){switch(x){case "disabled":case "sunny":return{direct:1,ambient:1};case "cloudy":return{direct:1,ambient:1};case "rainy":return{direct:.4,ambient:1.2};case "snowy":return{direct:.5,ambient:1.3};case "foggy":return{direct:.2,ambient:1.6}}}function g(x,B){const C=(x[0]+x[1]+x[2])/3;for(let D=0;3>D;D++)x[D]+=(C-x[D])*B;return x}function p(x,B,C,D){const E=[];for(let F=0;F<C.length;F++)E[F]=(D[F]-
C[F])*x/B+C[F];return E}const t={local:{altitude:1500,ambientAtNight:.1,ambientAtNoon:.45,ambientAtTwilight:.2,directAtNoon:.65,directAtTwilight:.7},global:{altitude:8E5,ambient:.015,direct:.75},planarDirection:{localAltitude:1E4,globalAltitude:1E6,globalAngles:{azimuth:1.3*Math.PI,altitude:.6*Math.PI}}},q=u.fromValues(.5773502691896258,-.5773502691896258,.5773502691896258),k=n.create(),r={azimuth:0,altitude:0},y=new Date(0),f=n.create(),w=u.create(),z=u.create(),A=u.create();a.ColorAndIntensity=
function(){this.ambient={color:u.fromValues(1,1,1),intensity:.55};this.direct={color:u.fromValues(1,1,1),intensity:.55,directionToLightSource:u.clone(q)};this.noonFactor=.5;this.globalFactor=0;this.environmentStrength=this.specularStrength=1};a.computeColorAndIntensity=function(x,B,C,D,E,F,G){l.set(G.ambient.color,1,1,1);G.ambient.intensity=t.global.ambient;l.set(G.direct.color,1,1,1);G.direct.intensity=t.global.direct;var O=b.clamp((Math.abs(B[2])-t.local.altitude)/(t.global.altitude-t.local.altitude),
0,1);G.globalFactor=O;var K;"sun"===F&&(K=m.SunCalc.getTimes(x,B[1],B[0]));if(1>O){if("sun"===F){{var L=K;var R=x.valueOf();if(L.polarException===m.SunCalc.PolarException.MIDNIGHT_SUN){var M=R-36E5*(x.getHours()+48)-6E4*x.getMinutes();var J=M+432E6}else L.polarException===m.SunCalc.PolarException.POLAR_NIGHT?(M=R-2,J=R-1):(M=L.sunrise.valueOf(),J=L.sunset.valueOf());var I=J-M;L=M+I/2;var P=I/4;var N=L-P;P=L+P;var V=.06*I;I=M-V/2;M+=V/2;const T=J-V/2,H=J+V/2;J=t.local;V=[.01,J.ambientAtNight];const U=
[.8,.8,1],W=[.01,.01,.01],Q=[J.directAtTwilight,J.ambientAtTwilight],X=[1,.6,.5],ba=[.8,.8,1],aa=[.9*J.directAtNoon,J.ambientAtNoon],ea=[1,.98,.98],ia=[.98,.98,1],ka=[J.directAtNoon,J.ambientAtNoon],la=[1,1,1],Z=[1,1,1];J=[0,0];let ca=[0,0,0];var S=[0,0,0];R<I||R>H?(J=V,ca=W,S=U):R<M?(S=M-I,J=p(R-I,S,V,Q),ca=p(R-I,S,W,X),S=p(R-I,S,U,ba)):R<N?(S=N-M,J=p(R-M,S,Q,aa),ca=p(R-M,S,X,ea),S=p(R-M,S,ba,ia)):R<L?(S=L-N,J=p(R-N,S,aa,ka),ca=p(R-N,S,ea,la),S=p(R-N,S,ia,Z)):R<P?(S=P-L,J=p(R-L,S,ka,aa),ca=p(R-L,
S,la,ea),S=p(R-L,S,Z,ia)):R<T?(S=T-P,J=p(R-P,S,aa,Q),ca=p(R-P,S,ea,X),S=p(R-P,S,ia,ba)):R<H&&(S=H-T,J=p(R-T,S,Q,V),ca=p(R-T,S,X,W),S=p(R-T,S,ba,U));R=0;switch(D){case "rainy":case "foggy":R=.9;case "snowy":R=.5}0<R&&(ca=g(ca,R),S=g(S,R));L=u.fromValues(ca[0],ca[1],ca[2]);N=u.fromValues(S[0],S[1],S[2]);P=e(D);R=J[0]*P.direct;J=J[1]*P.ambient}}else N=e(D),R=t.local.directAtNoon*N.direct,L=u.fromValues(1,1,1),J=t.local.ambientAtNoon*N.ambient,N=u.fromValues(1,1,1);l.lerp(G.ambient.color,N,G.ambient.color,
O);G.ambient.intensity=b.lerp(J,G.ambient.intensity,O);l.lerp(G.direct.color,L,G.direct.color,O);G.direct.intensity=b.lerp(R,G.direct.intensity,O);G.specularStrength="rainy"===D||"snowy"===D||"foggy"===D?0:1;G.environmentStrength="rainy"===D?.7:"snowy"===D||"foggy"===D?.75:1}"sun"===F?(D=x.valueOf(),K.polarException===m.SunCalc.PolarException.MIDNIGHT_SUN?(O=D-36E5*(x.getHours()+48)-6E4*x.getMinutes(),K=O+432E6):K.polarException===m.SunCalc.PolarException.POLAR_NIGHT?(O=D-2,K=D-1):(O=K.sunrise.valueOf(),
K=K.sunset.valueOf()),D=1-b.clamp(Math.abs(D-(O+(K-O)/2))/432E5,0,1)):D=1;G.noonFactor=D;"sun"===F?d(x,B,C,G.direct.directionToLightSource):(x=G.direct.directionToLightSource,C===v.ViewingMode.Global?l.normalize(w,E.eye):l.set(w,0,0,1),l.scale(z,E.viewForward,-1),C=h.angle(z,w),B=Math.max(C-.5,0),c.fromRotation(f,-Math.max(.25,C-.25-.85*B/(B+1)),E.viewRight),l.transformMat4(x,z,f),l.add(x,x,l.scale(A,E.viewRight,.2)),l.normalize(x,x))};a.computeDirectionsOverTime=function(x,B,C,D,E){x=x.getTime();
B=B.getTime()-x;B=Math.floor(B/C)+1;const F=Array(B);for(let G=0;G<B;++G)y.setTime(x+C*G),F[G]=u.create(),d(y,D,E,F[G]);return F};a.computeShadowsEnabled=function(x,B){return B===v.ViewingMode.Global?!0:Math.abs(x)<t.planarDirection.localAltitude};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SunCalc":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(n){n=n();void 0!==n&&(c.exports=n)})(function(){function n(C){return new Date(864E5*
(C+.5-2440588))}function l(C,D){return y(t(C)*q(A)-k(D)*t(A),q(C))}function u(C,D){return r(t(D)*q(A)+q(D)*t(A)*t(C))}function v(C,D,E){return y(t(C),q(C)*t(D)-k(E)*q(D))}function m(C,D,E){return r(t(D)*t(E)+q(D)*q(E)*q(C))}function h(C){return w*(1.9148*t(C)+.02*t(2*C)+3E-4*t(3*C))}function d(C,D){C=w*(357.5291+.98560028*C);var E=h(C);C=C+E+102.9372*w+p;D||(D={dec:0,ra:0});D.dec=u(C,0);D.ra=l(C,0);return D}function e(C,D,E){return 2451545+C+.0053*t(D)-.0069*t(2*E)}function g(C){var D=w*(134.963+
13.064993*C),E=w*(93.272+13.22935*C);C=w*(218.316+13.176396*C)+6.289*w*t(D);E=5.128*w*t(E);D=385001-20905*q(D);return{ra:l(C,E),dec:u(C,E),dist:D}}var p=Math.PI,t=Math.sin,q=Math.cos,k=Math.tan,r=Math.asin,y=Math.atan2,f=Math.acos,w=p/180,z={dec:0,ra:0},A=23.4397*w,x={PolarException:{NORMAL:0,MIDNIGHT_SUN:1,POLAR_NIGHT:2},getPosition:function(C,D,E,F){E=w*-E;D*=w;var G=C.valueOf()/864E5-.5+2440588-2451545;C=d(G,z);E=w*(280.16+360.9856235*G)-E-C.ra;F||(F={azimuth:0,altitude:0});F.azimuth=v(E,D,C.dec);
F.altitude=m(E,D,C.dec);return F}},B=[[-.83,"sunrise","sunset"]];x.addTime=function(C,D,E){B.push([C,D,E])};x.getTimes=function(C,D,E){function F(V){var S=O,T=M;V=f((t(V)-t(S)*t(T))/(q(S)*q(T)));return e(9E-4+(V+G)/(2*p)+K,L,R)}var G=w*-E,O=w*D,K=Math.round(C.valueOf()/864E5-.5+2440588-2451545-9E-4-G/(2*p));C=9E-4+(0+G)/(2*p)+K;var L=w*(357.5291+.98560028*C);D=h(L);var R=L+D+102.9372*w+p,M=u(R,0);C=e(C,L,R);D={solarNoon:n(C),nadir:n(C-.5),polarException:x.PolarException.NORMAL};var J;E=0;for(J=B.length;E<
J;E+=1){var I=B[E];var P=F(I[0]*w);var N=C-(P-C);D[I[1]]=n(N);D[I[2]]=n(P)}D.polarException=function(V){V=(t(V)-t(O)*t(M))/(q(O)*q(M));return-1>V?x.PolarException.MIDNIGHT_SUN:1<V?x.PolarException.POLAR_NIGHT:x.PolarException.NORMAL}(B[0][0]*w);return D};x.getMoonPosition=function(C,D,E){E=w*-E;D*=w;var F=C.valueOf()/864E5-.5+2440588-2451545;C=g(F);E=w*(280.16+360.9856235*F)-E-C.ra;F=m(E,D,C.dec);F+=.017*w/k(F+10.26*w/(F+5.1*w));return{azimuth:v(E,D,C.dec),altitude:F,distance:C.dist}};x.getMoonFraction=
function(C){var D=C.valueOf()/864E5-.5+2440588-2451545;C=d(D);D=g(D);C=f(t(C.dec)*t(D.dec)+q(C.dec)*q(D.dec)*q(C.ra-D.ra));C=y(149598E3*t(C),D.dist-149598E3*q(C));return(1+q(C))/2};return x})})(b);a.SunCalc=b.exports})},"esri/views/3d/input/SceneInputManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./handlers/DoubleClickZoom ./handlers/DragRotate ./handlers/DragZoom ./handlers/GamepadNavigation ./handlers/KeyboardNavigation ./handlers/MouseWheelZoom ./handlers/PinchAndPanNavigation ./handlers/PointerDownCancelAnimation ./handlers/SingleKeyResetHeading ./handlers/SingleKeyResetTilt ./handlers/TwoFingerTilt ../../input/BrowserEventSource ../../input/InputManager ../../input/handlers/PreventContextMenu ../../input/recognizers/Drag ../../input/recognizers/ImmediateDoubleClick ../../input/recognizers/PointerClickHoldAndDrag ../../input/recognizers/SingleAndDoubleClick ../../input/recognizers/VerticalTwoFingerDrag ../state/controllers/RotateController".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O){c=function(L){function R(){var J=L.apply(this,arguments)||this;J._handles=new n;return J}a._inheritsLoose(R,L);var M=R.prototype;M.destroy=function(){this._handles&&(this._handles.removeAll(),this._handles=null);this.disconnect()};M.disconnect=function(){this.view.viewEvents.disconnect();this._inputManager&&(this._inputManager.destroy(),this._inputManager=null);this._source&&(this._source.destroy(),this._source=null)};M.connect=
function(){const J=this.view;this._source=new A.BrowserEventSource(this.view.surface,J.input);var I=[new D.ImmediateDoubleClick,new E.PointerClickHoldAndDrag,new F.SingleAndDoubleClick,new C.Drag(this.view.navigation),new G.VerticalTwoFingerDrag];this._inputManager=I=new x.InputManager({eventSource:this._source,recognizers:I});I.installHandlers("prevent-context-menu",[new B.PreventContextMenu],x.ViewEventPriorities.INTERNAL);this._modeDragPan=new r.PinchAndPanNavigation(J,"primary");this._modeDragRotate=
new g.DragRotate(J,"secondary",O.PivotPoint.CENTER);this._modeDragZoom=new p.DragZoom(J,"tertiary");I.installHandlers("navigation",[new y.PointerDownCancelAnimation(J),new e.DoubleClickZoom(J),new t.GamepadNavigation(J),new q.KeyboardNavigation(J,{left:"ArrowLeft",right:"ArrowRight",forward:"ArrowUp",backward:"ArrowDown",up:"u",down:"j",headingLeft:"a",headingRight:"d",tiltUp:"w",tiltDown:"s",zoomIn:"+",zoomOut:"-"}),new k.MouseWheelZoom(J),new w.SingleKeyResetTilt(J,"p"),new f.SingleKeyResetHeading(J,
"n"),new g.DragRotate(J,"primary",O.PivotPoint.EYE,["b"]),new g.DragRotate(J,"secondary",O.PivotPoint.CENTER,["b"]),new r.PinchAndPanNavigation(J,"tertiary",["b"]),this._modeDragRotate,this._modeDragZoom,this._modeDragPan,new z.TwoFingerTilt(J)],x.ViewEventPriorities.INTERNAL);this.view.viewEvents.connect(I);this._updateMode();this._handles.add(l.watch(()=>{var P;return null==(P=this.view.navigation)?void 0:P.browserTouchPanEnabled},P=>{this._source.browserTouchPanningEnabled=!P},l.initial))};M._updateMode=
function(){var J=this.primaryDragAction;J=K.get(this.mode).get(J);this._modeDragPan&&(this._modeDragPan.pointerAction=J.pan);this._modeDragRotate&&(this._modeDragRotate.pointerAction=J.rotate);this._modeDragZoom&&(this._modeDragZoom.pointerAction=J.zoom)};a._createClass(R,[{key:"primaryDragAction",get:function(){return this._get("primaryDragAction")},set:function(J){"pan"!==J&&"rotate"!==J||J===this._get("primaryDragAction")||(this._set("primaryDragAction",J),this._updateMode())}},{key:"mode",get:function(){return this._get("mode")},
set:function(J){"default"!==J&&"pro"!==J||J===this._get("mode")||(this._set("mode",J),this._updateMode())}},{key:"hasPendingInputs",get:function(){var J;return null==(J=this._inputManager)?void 0:J.hasPendingInputs}},{key:"latestPointerType",get:function(){var J;return null==(J=this._inputManager)?void 0:J.latestPointerType}},{key:"latestPointerLocation",get:function(){var J;return null==(J=this._inputManager)?void 0:J.latestPointerLocation}},{key:"test",get:function(){return{inputManager:this._inputManager,
modeDragPan:this._modeDragPan,modeDragRotate:this._modeDragRotate,modeDragZoom:this._modeDragZoom}}}]);return R}(c);b.__decorate([u.property()],c.prototype,"view",void 0);b.__decorate([u.property({value:"pan"})],c.prototype,"primaryDragAction",null);b.__decorate([u.property({value:"default"})],c.prototype,"mode",null);b.__decorate([u.property({readOnly:!0})],c.prototype,"hasPendingInputs",null);b.__decorate([u.property()],c.prototype,"latestPointerType",null);b.__decorate([u.property()],c.prototype,
"latestPointerLocation",null);b.__decorate([u.property()],c.prototype,"_inputManager",void 0);c=b.__decorate([d.subclass("esri.views.3d.input.SceneInputManager")],c);const K=new Map;b=new Map;u=new Map;b.set("pan",{pan:"primary",rotate:"secondary",zoom:"tertiary"});b.set("rotate",{pan:"secondary",rotate:"primary",zoom:"tertiary"});u.set("pan",{pan:"primary",rotate:"tertiary",zoom:"secondary"});u.set("rotate",{pan:"tertiary",rotate:"primary",zoom:"secondary"});K.set("default",b);K.set("pro",u);return c})},
"esri/views/3d/input/handlers/DoubleClickZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,n,l,u,v){u=function(m){function h(d,e){var g=m.call(this,!0)||this;g.view=d;g.registerIncoming("double-click",e,p=>g._handleDoubleClick(p));return g}b._inheritsLoose(h,
m);h.prototype._handleDoubleClick=function(d){const e=d.data;if(v.eventMatchesPointerAction(e,"primary")){const g=this.view.state.isGlobal?new n.ZoomStepController({view:this.view,mode:"animation"}):new l.ZoomStepController({view:this.view,mode:"animation"});this.view.state.switchCameraController(g);g.zoomStep(Math.log(.5)/Math.log(.6),c.createScreenPointArray(e.x,e.y));d.stopPropagation()}};return h}(u.InputHandler);a.DoubleClickZoom=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../support/geometryUtils/sphere ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/verticalOffsetUtils ../../../../animation/easing ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C){a.ZoomStepController=function(G){function O(){var L=G.apply(this,arguments)||this;L.zoomLocation=g.create();L.tmpCamera=new z.Camera;L.tmpViewDir=g.create();L.tmpRayDir={origin:g.create(),direction:g.create()};L.targetOnSphere=g.create();L.tmpCenter=g.create();L.constraintOptions={selection:k.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:k.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new z.Camera,interactionDirection:null,
tiltMode:k.TiltMode.TUMBLE};L.sphere=t.create();return L}b._inheritsLoose(O,G);var K=O.prototype;K.initialize=function(){this.intersector=A.newIntersector(this.view.state.viewingMode)};K.zoomStep=function(L,R){if(this.active){var M=this.view.state,{interactionStartCamera:J}=this.constraintOptions;this.animation.finished?J.copyFrom(M.camera):this.animation.cameraAt(1,J);var I=J=!1;this.intersectionHelper.intersectScreen(R,this.zoomLocation,0===this.view.map.ground.opacity?F:{})&&(J=0<L?!0:!1,I=!0);
this.tmpCamera.copyFrom(M.camera);J?this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter):this.intersectionHelper.intersectRay(this.tmpCamera.ray,this.intersector,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:e.copy(this.zoomLocation,this.tmpCamera.center);this._updateCamera(this.tmpCamera,L,this.zoomLocation,R,I);this.begin(this.tmpCamera)}};K.animationSettings=function(){return{apex:null,duration:n.Milliseconds(600),
easing:B.outExpo}};K._updateCamera=function(L,R,M,J,I){var P=p.getReferenceEllipsoid(this.view.spatialReference);P=y.decideNavigationMode(L,J,I,P);var N;this.view.camera.position.hasZ&&(N=Math.abs(this.view.camera.position.z));e.normalize(E,L.eye);e.scale(E,E,-1);f.fromScreenAtEye(L,J,this.tmpRayDir);e.normalize(this.tmpRayDir.direction,this.tmpRayDir.direction);const V=Math.max(Math.min(12,1/Math.abs(e.dot(E,this.tmpRayDir.direction)))*N,200);if(P===y.NavigationMode.Horizontal){R=.6**R;this.sphere[3]=
e.length(M);e.subtract(this.tmpViewDir,L.center,L.eye);I=Math.min(e.length(this.tmpViewDir),V);P=I*R;1>=R&&4>P&&(P=4,R=P/I);if(1E-6>Math.abs(I-P))return;I=e.length(L.center);this.sphere[3]!==I&&(L.center=e.scale(D,L.center,(this.sphere[3]+R*(I-this.sphere[3]))/I));e.scale(this.tmpViewDir,this.tmpViewDir,-R);L.eye=e.add(D,L.center,this.tmpViewDir);q.applyAll(this.view,L,this.constraintOptions);1E-12<e.squaredDistance(M,L.center)&&w.intersectScreen(this.sphere,L,J,this.targetOnSphere)&&y.panToPosition(this.sphere,
L,M,this.targetOnSphere,this.view.camera.heading,this.view.camera.tilt,!0)}else{P=.6**Math.abs(R);N=0<R?1:-1;e.subtract(this.tmpViewDir,M,L.eye);const S=e.length(this.tmpViewDir);J=(J=this.view._stage.renderView.getMinimalDepthForArea(null,J[0],J[1],this.view.state.camera,60))?Math.min(V,J):V;J=I?Math.min(J,S):J;e.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,J);e.add(M,this.tmpRayDir.origin,this.tmpRayDir.direction);M=J*P;I=Math.max(4,1.01*L.nearFar[0]);0<R&&M<I&&(M=I,P=M/J);if(1E-6>Math.abs(J-
M))return;e.scale(this.tmpRayDir.direction,this.tmpRayDir.direction,N*(1-P));L.eye=e.add(D,L.eye,this.tmpRayDir.direction);L.center=e.add(D,L.center,this.tmpRayDir.direction)}C.applySurfaceCollisionConstraint(this.view,L)};return O}(r.PointToPointAnimationController);a.ZoomStepController=c.__decorate([d.subclass("esri.views.3d.state.controllers.global.ZoomStepController")],a.ZoomStepController);const D=g.create(),E=g.create(),F={exclude:new Set([x.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils":function(){define("exports ../../../chunks/vec2 ./constraintUtils/altitude ./constraintUtils/common ./constraintUtils/distance ./constraintUtils/surfaceCollision ./constraintUtils/tilt ../../animation/easing".split(" "),function(a,b,c,n,l,u,v,m){const h=[{type:n.ConstraintTypes.TILT,error:function(e,g,p){return v.getTiltConstraintError(e,g,p)*g.distance},apply:v.applyTiltConstraint},{type:n.ConstraintTypes.ALTITUDE,
error:c.getAltitudeConstraintError,apply:c.applyAltitudeConstraint},{type:n.ConstraintTypes.DISTANCE,error:l.getDistanceConstraintError,apply:l.applyDistanceConstraint}],d={selection:n.ConstraintTypes.ALL,interactionType:n.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:n.TiltMode.TUMBLE};a.applyAltitudeConstraint=c.applyAltitudeConstraint;a.getAltitudeConstraintError=c.getAltitudeConstraintError;Object.defineProperty(a,"ConstraintTypes",{enumerable:!0,
get:()=>n.ConstraintTypes});Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>n.InteractionType});a.applyDistanceConstraint=l.applyDistanceConstraint;a.getDistanceConstraintError=l.getDistanceConstraintError;Object.defineProperty(a,"ApplyCollisionMode",{enumerable:!0,get:()=>u.Mode});a.applySurfaceCollisionConstraint=u.applySurfaceCollisionConstraint;a.applyTiltConstraint=v.applyTiltConstraint;a.getTiltConstraintError=v.getTiltConstraintError;a.applyAll=function(e,g,p=d,t=g){let q=
!1;t!==g&&t.copyFrom(g);t.computeUp(e.state.viewingMode);for(g=0;5>g;g++){let r=0;for(var k of h)if(n.hasConstraintType(p.selection,k.type)){const y=Math.abs(k.error(e,t,p));k.apply(e,t,p)&&(q=!0,r+=y)}if(0===r)break}k=n.hasConstraintType(p.selection,n.ConstraintTypes.COLLISION);a:switch(p.interactionType){case n.InteractionType.PAN:p=u.Mode.EYE_AND_CENTER;break a;case n.InteractionType.ASCEND:p=e.state.isGlobal?u.Mode.EYE_AND_CENTER_SCALE:u.Mode.EYE_AND_CENTER;break a;default:p=u.Mode.EYE}k&&u.applySurfaceCollisionConstraint(e,
t,p)&&(q=!0);q&&t.computeUp(e.state.viewingMode);return q};a.pixelDistanceToInteractionFactor=function(e,g){e="number"===typeof e?e:b.distance(e,g);return m.inOutCubic(Math.min(1,e/150))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/altitude":function(){define("exports ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ./common ../../support/intersectionUtils".split(" "),
function(a,b,c,n,l,u,v,m){function h(k,r,y=v.defaultApplyOptions){var f=k.state.constraints.altitude;f=k.state.isGlobal&&f?y.interactionType===v.InteractionType.TUMBLE&&v.hasConstraintType(y.selection,v.ConstraintTypes.TILT)?!1:!0:!1;if(!f)return 0;var w=k.state.constraints.altitude;f=e;f.min=w.min;f.max=w.max;w=y.interactionType;if(w!==v.InteractionType.NONE){var {min:z,max:A}=f,{interactionStartCamera:x,interactionFactor:B}=y;y=w===v.InteractionType.TUMBLE||w===v.InteractionType.ZOOM;w=h(k,x);var C=
0===w?0:k.renderCoordsHelper.getAltitude(x.eye);f.min=z;f.max=A;v.adjustRangeForInteraction(w,C,y,B,.05*C,f)}k=k.renderCoordsHelper.getAltitude(r.eye);k=b.clamp(k,f.min,f.max)-k;return 1E-6>=Math.abs(k)?0:k}function d(k,r,y,f){k.renderCoordsHelper.worldUpAtPosition(r.eye,f);n.scale(f,f,y);return f}const e={min:0,max:0},g=l.create(),p=l.create(),t=l.create(),q=l.create();a.applyAltitudeConstraint=function(k,r,y=v.defaultApplyOptions){const f=h(k,r,y);if(0===f)return!1;const w=k.renderCoordsHelper,
z=w.getAltitude(r.eye)+f;y=v.interactionDirectionTowardsConstraintMinimization(r,y.interactionDirection,d(k,r,Math.sign(f),p),g);k=n.copy(t,r.viewForward);y=w.intersectInfiniteManifold(u.wrap(r.eye,y),z,q);r.eye=c.isSome(y)?y:w.setAltitude(q,z,r.eye);r.center=m.closestPointOnRay(q,r.eye,k,r.center);return!0};a.getAltitudeConstraintError=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/common":function(){define(["exports",
"../../../../chunks/vec3"],function(a,b){a.InteractionType=void 0;(function(n){n[n.NONE=0]="NONE";n[n.ZOOM=1]="ZOOM";n[n.TUMBLE=2]="TUMBLE";n[n.LOOK_AROUND=3]="LOOK_AROUND";n[n.PAN=4]="PAN";n[n.ASCEND=5]="ASCEND"})(a.InteractionType||(a.InteractionType={}));a.ConstraintTypes=void 0;(function(n){n[n.NONE=0]="NONE";n[n.TILT=1]="TILT";n[n.ALTITUDE=2]="ALTITUDE";n[n.DISTANCE=4]="DISTANCE";n[n.COLLISION=8]="COLLISION";n[n.ALL=15]="ALL";n[n.ALL_EXCEPT_COLLISION=7]="ALL_EXCEPT_COLLISION"})(a.ConstraintTypes||
(a.ConstraintTypes={}));a.TiltMode=void 0;(function(n){n[n.TUMBLE=0]="TUMBLE";n[n.LOOK_AROUND=1]="LOOK_AROUND"})(a.TiltMode||(a.TiltMode={}));const c={selection:a.ConstraintTypes.NONE,interactionType:a.InteractionType.NONE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:a.TiltMode.TUMBLE};a.adjustRangeForInteraction=function(n,l,u,v,m,h){0!==n&&(u?(h.min=Math.min(h.min,l),h.max=Math.max(h.max,l)):null!=v?(h.min-=Math.max(0,(l-h.min)*(1-v)),h.max+=Math.max(0,(l-h.max)*
(1-v))):m&&(h.min-=Math.max(0,l-h.min-m),h.max+=Math.max(0,l-h.max-m)))};a.defaultApplyOptions=c;a.hasConstraintType=function(n,l){return 0!==(n&l)};a.interactionDirectionTowardsConstraintMinimization=function(n,l,u,v){l=l||n.viewForward;b.copy(v,l);b.scale(v,v,Math.sign(b.dot(l,u)));return v};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/intersectionUtils":function(){define(["exports","../../../chunks/vec2f64","../../../chunks/vec3",
"../../../chunks/vec3f64","../../../geometry/support/plane"],function(a,b,c,n,l){function u(h,d,e,g){const p=m;h?(e&&g&&(p.len=c.distance(d,e)),c.copy(p.dir,h)):g?(p.len=c.distance(d,e),c.subtract(p.dir,e,d),c.scale(p.dir,p.dir,1/p.len)):(c.subtract(p.dir,e,d),c.normalize(p.dir,p.dir));return p}function v(h,d,e,g){g.clip[0]=0;g.clip[1]=e?g.len:Number.MAX_VALUE;for(e=0;e<h.length;e++){{var p=h[e],t=d;var q=g;const k=c.dot(l.normal(p),q.dir);p=-l.signedDistance(p,t);0>p&&0<=k?q=!1:-1E-6<k&&1E-6>k?q=
0<p:!(0>p||0>k)||0>p&&0>k?(p/=k,0<k?p<q.clip[1]&&(q.clip[1]=p):p>q.clip[0]&&(q.clip[0]=p),q=q.clip[0]<=q.clip[1]):q=!0}if(!q)return!1}return!0}const m={dir:n.create(),len:0,clip:b.create()};a.closestPointOnRay=function(h,d,e,g){g=c.dot(e,c.subtract(h,g,d));return c.add(h,d,c.scale(h,e,g))};a.frustumLineSegment=function(h,d,e,g){g=u(g,d,e,!0);return v(h,d,e,g)};a.frustumPoint=function(h,d){for(let e=0;6>e;e++)if(0<l.signedDistance(h[e],d))return!1;return!0};a.frustumRay=function(h,d,e,g){e=u(g,d,e,
!1);return v(h,d,null,e)};a.frustumSphere=function(h,d,e){const g=d[0],p=d[1];d=d[2];return h[0][0]*g+h[0][1]*p+h[0][2]*d+h[0][3]>e||h[1][0]*g+h[1][1]*p+h[1][2]*d+h[1][3]>e||h[2][0]*g+h[2][1]*p+h[2][2]*d+h[2][3]>e||h[3][0]*g+h[3][1]*p+h[3][2]*d+h[3][3]>e||h[4][0]*g+h[4][1]*p+h[4][2]*d+h[4][3]>e||h[5][0]*g+h[5][1]*p+h[5][2]*d+h[5][3]>e?!1:!0};a.planeSphere=function(h,d,e){return h[0]*d[0]+h[1]*d[1]+h[2]*d[2]+h[3]<e};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/camera/constraintUtils/distance":function(){define("exports ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../../../../chunks/sphere ./common".split(" "),function(a,b,c,n,l,u,v){function m(q,k,r=v.defaultApplyOptions){if(!q.state.isLocal)return 0;var y=q.state.constraints.distance;if(!q.pointsOfInterest.surfaceOrigin.renderLocation||Infinity===y)return 0;h.min=0;h.max=y;y=h;var f=r.interactionType;if(f!==v.InteractionType.NONE){var {min:w,
max:z}=y,{interactionStartCamera:A,interactionFactor:x}=r;r=f===v.InteractionType.ZOOM||f===v.InteractionType.PAN;f=m(q,A);var B=0===f?0:c.distance(A.eye,q.pointsOfInterest.surfaceOrigin.renderLocation);y.min=w;y.max=z;v.adjustRangeForInteraction(f,B,r,x,.05*B,y)}q=c.distance(k.eye,q.pointsOfInterest.surfaceOrigin.renderLocation);q=h.max-q;return-1E-6<=q?0:q}const h={min:0,max:0},d=n.create(),e=n.create(),g=n.create(),p=n.create(),t=n.create();a.applyDistanceConstraint=function(q,k,r=v.defaultApplyOptions){var y=
m(q,k,r);if(0===y)return!1;var f=q.pointsOfInterest.surfaceOrigin;y=c.distance(k.eye,q.pointsOfInterest.surfaceOrigin.renderLocation)+y;const w=c.copy(d,k.eye);r=v.interactionDirectionTowardsConstraintMinimization(k,r.interactionDirection,c.direction(p,k.eye,q.pointsOfInterest.surfaceOrigin.renderLocation),g);if(!u.intersectRay(u.fromCenterAndRadius(f.renderLocation,y),l.wrap(k.eye,r),t))return!1;k.eye=t;f=c.subtract(e,k.eye,w);k.center=c.add(t,k.center,f);f=q.renderCoordsHelper.getAltitude(k.center);
q=q.renderCoordsHelper.intersectInfiniteManifold(k.ray,f,t);b.isSome(q)&&(k.center=q);return!0};a.getDistanceConstraintError=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/surfaceCollision":function(){define(["exports","../../../../chunks/vec3","../../../../chunks/vec3f64","../intersectionUtils"],function(a,b,c,n){a.Mode=void 0;(function(v){v[v.EYE=0]="EYE";v[v.EYE_AND_CENTER=1]="EYE_AND_CENTER";v[v.EYE_AND_CENTER_SCALE=
2]="EYE_AND_CENTER_SCALE"})(a.Mode||(a.Mode={}));const l=c.create(),u=c.create();a.applySurfaceCollisionConstraint=function(v,m,h=a.Mode.EYE){var d=v.state.constraints;if(!d.collision.enabled)return!1;var e=n.surfaceElevationBelowRenderLocation(v,m.eye);const g=v.renderCoordsHelper.getAltitude(m.eye);d=e+d.collision.elevationMargin;if(g>=d)return!1;e=b.length(m.eye);b.subtract(l,m.center,m.eye);m.eye=v.renderCoordsHelper.setAltitude(u,d,m.eye);h===a.Mode.EYE_AND_CENTER?m.center=b.add(l,m.eye,l):h===
a.Mode.EYE_AND_CENTER_SCALE&&(m.center=b.scale(l,m.center,(e-g+d)/e));return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/camera/constraintUtils/tilt":function(){define("exports ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../chunks/sphere ./common ../../state/utils/viewUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){function p(B,C,D=e.defaultApplyOptions,E=!0){x.eyeCenterDistance=0;x.requiresTwoSteps=!1;const F=t(B,C,D,void 0,x);if(0===F)return!1;l.fromRotation(y,-F,C.viewRight);switch(D.tiltMode){case e.TiltMode.LOOK_AROUND:v.transformMat4(r,C.viewForward,y);v.scale(r,r,x.eyeCenterDistance);C.center=v.add(f,C.eye,r);break;case e.TiltMode.TUMBLE:v.subtract(r,C.center,C.eye);v.transformMat4(r,r,y);C.eye=v.subtract(f,C.center,r);break;default:b.neverReached(D.tiltMode)}C.up=v.transformMat4(f,
C.up,y);return x.requiresTwoSteps&&E?p(B,C,D,!1):!0}function t(B,C,D=e.defaultApplyOptions,E=e.defaultApplyOptions,F){if(!B.state.constraints.tilt)return 0;var G=B.state.constraints.tilt(C.distance,z);if(D.interactionType!==e.InteractionType.NONE){var {interactionStartCamera:O,interactionFactor:K}=D,{min:L,max:R}=G,M=t(B,O,e.defaultApplyOptions,D),J=0===M?0:g.viewAngle(B.renderCoordsHelper,O.center,O.eye);G.min=L;G.max=R;D.interactionType===e.InteractionType.TUMBLE?(e.hasConstraintType(D.selection,
e.ConstraintTypes.ALTITUDE)&&k(B,O,G),e.adjustRangeForInteraction(M,J,!0,K,w,G)):e.adjustRangeForInteraction(M,J,!1,K,w,G)}E.interactionType===e.InteractionType.TUMBLE&&e.hasConstraintType(E.selection,e.ConstraintTypes.ALTITUDE)&&k(B,E.interactionStartCamera,G);if(D.tiltMode===e.TiltMode.LOOK_AROUND||E.tiltMode===e.TiltMode.LOOK_AROUND){a:switch(F&&(F.requiresTwoSteps=!1),B.viewingMode){case "global":D=A;M=B.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;E=M+h.getReferenceEllipsoid(B.spatialReference).radius;
M=B.renderCoordsHelper.intersectManifold(C.ray,M,f);D.eyeCenterDistance=C.distance;D.centerIsOnSurface=!1;n.isSome(M)?(D.eyeCenterDistance=v.distance(C.eye,M),D.tiltAtCenter=g.viewAngle(B.renderCoordsHelper,M,C.eye),D.centerIsOnSurface=!0):B.state.isLocal?D.tiltAtCenter=g.viewAngle(B.renderCoordsHelper,C.center,C.eye):(d.closestPointOnSilhouette(d.fromRadius(d.tmpSphere,E),C.ray,f),D.eyeCenterDistance=v.distance(C.eye,f),D.tiltAtCenter=c.acosClamped(-v.dot(C.viewForward,v.normalize(f,f))));D.radius=
E;D.eyeRadius=v.length(C.eye);D.constraints=B.state.constraints;C=c.clamp(D.tiltAtCenter,G.min,G.max);if(1E-9<Math.abs(D.tiltAtCenter-C)){if(D.centerIsOnSurface){{const {constraints:I,eyeCenterDistance:P,tiltAtCenter:N}=D;C=N;B=I.clampTilt(P,N);G=q(D,B);if(I.clampTilt(G,N)!==B)for(G=0;10>G&&1E-9<Math.abs(B-C);)E=(C+B)/2,M=q(D,E),M=I.clampTilt(M,E),1E-9<Math.abs(M-E)?C=E:B=E,G++;C=B}G=C;B=c.asinClamped(D.radius/D.eyeRadius*Math.sin(D.tiltAtCenter));G=c.asinClamped(D.radius/D.eyeRadius*Math.sin(G));
B=D.eyeRadius>D.radius?B-G:G-B}else C=D.constraints.clampTilt(D.eyeCenterDistance,D.tiltAtCenter),F&&C<Math.PI/2&&(F.requiresTwoSteps=!0,C=Math.PI/2-1E-5),B=D.tiltAtCenter-Math.PI/2-(C-Math.PI/2);F&&(F.eyeCenterDistance=q(D,C));F=B}else F=0;break a;case "local":E=g.viewAngle(B.renderCoordsHelper,C.center,C.eye);D=c.clamp(E,G.min,G.max);G=E-D;1E-9<Math.abs(G)?(F&&(E=B.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,B=B.renderCoordsHelper.getAltitude(C.eye)-E,D=Math.cos(D),F.eyeCenterDistance=
1E-4<Math.abs(D)?B/D:C.distance),F=G):F=0;break a;default:b.neverReached(B.viewingMode),F=void 0}return F}F=g.viewAngle(B.renderCoordsHelper,C.center,C.eye);D=c.clamp(F,G.min,G.max);F-=D;F=1E-9<Math.abs(F)?F:0;return F}function q(B,C){if(!B.centerIsOnSurface)return B.eyeCenterDistance;C=Math.PI-c.clamp(C,0,Math.PI);const D=c.asinClamped(B.radius/B.eyeRadius*Math.sin(C)),E=Math.sin(Math.PI-C-D)/Math.sin(C);return B.eyeRadius<B.radius&&1<E?Math.sin(Math.PI-C-(Math.PI-D))/Math.sin(C)*B.eyeRadius:E*B.eyeRadius}
function k(B,C,D){if(!B.state.isLocal){var E=B.state.constraints;if(E.altitude){var F=v.squaredLength(C.center),G=Math.sqrt(F);C=C.distance;var O=h.getReferenceEllipsoid(B.spatialReference).radius;B=E.altitude.min+O;E=E.altitude.max+O;B=(B*B-C*C-F)/(-2*G*C);D.min=Math.max(D.min,Math.min(Math.PI-c.acosClamped((E*E-C*C-F)/(-2*G*C)),D.max));D.max=Math.min(D.max,Math.PI-c.acosClamped(B))}}}const r=m.create(),y=u.create(),f=m.create(),w=c.deg2rad(5),z={min:0,max:0},A={constraints:null,radius:0,eyeRadius:0,
centerIsOnSurface:!0,eyeCenterDistance:0,tiltAtCenter:0},x={eyeCenterDistance:0,requiresTwoSteps:!1};a.applyTiltConstraint=p;a.getTiltConstraintError=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/utils/viewUtils":function(){define(["exports","../../../../core/mathUtils","../../../../chunks/vec3","../../../../chunks/vec3f64"],function(a,b,c,n){const l=n.create(),u=n.create();a.viewAngle=function(v,m,h){v.worldUpAtPosition(m,l);c.subtract(u,
h,m);v=c.length(u);return 0===v?0:b.acosClamped(c.dot(u,l)/v)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/easing":function(){define(["exports"],function(a){function b(N){return N}function c(N){const V=2*(N-Math.sqrt((N-1)*N)),S=V/2/N;return T=>T<S?N*T*T:V*T-V+1}function n(N,V){return(S,T)=>S<V?V*N(S/V,T):1-N((1-S)/(1-V),T)*(1-V)}const l=N=>N*N,u=N=>1-l(1-N),v=N=>.5>N?l(2*N)/2:(1-l(1-2*(N-.5))+1)/2,m=N=>N*N*N,h=N=>1-m(1-N),d=N=>
.5>N?m(2*N)/2:(1-m(1-2*(N-.5))+1)/2,e=N=>N*N*N*N,g=N=>1-e(1-N),p=N=>.5>N?e(2*N)/2:(1-e(1-2*(N-.5))+1)/2,t=N=>N*N*N*N*N,q=N=>1-t(1-N),k=N=>.5>N?t(2*N)/2:(1-t(1-2*(N-.5))+1)/2,r=N=>-Math.cos(N*Math.PI/2)+1,y=N=>1-r(1-N),f=N=>.5>N?r(2*N)/2:(1-r(1-2*(N-.5))+1)/2,w=N=>2**(10*(N-1)),z=N=>1-2**(10*(1-N-1)),A=N=>.5>N?2**(10*(2*N-1))/2:(1-2**(10*(1-2*(N-.5)-1))+1)/2,x=N=>-(Math.sqrt(1-N*N)-1),B=N=>1-x(1-N),C=N=>.5>N?x(2*N)/2:(1-x(1-2*(N-.5))+1)/2,D=n(c(1),1),E=n(c(1),0),F=n(c(1),.5),G=n(c(2),1),O=n(c(2),0),
K=n(c(2),.5),L=n(c(3),1),R=n(c(3),0),M=n(c(3),.5),J=n(c(4),1),I=n(c(4),0),P=n(c(4),.5);a.EasingFunctions={linear:b,"in-quad":l,"out-quad":u,"in-out-quad":v,"in-coast-quad":D,"out-coast-quad":E,"in-out-coast-quad":F,"in-cubic":m,"out-cubic":h,"in-out-cubic":d,"in-coast-cubic":G,"out-coast-cubic":O,"in-out-coast-cubic":K,"in-quart":e,"out-quart":g,"in-out-quart":p,"in-coast-quart":L,"out-coast-quart":R,"in-out-coast-quart":M,"in-quint":t,"out-quint":q,"in-out-quint":k,"in-coast-quint":J,"out-coast-quint":I,
"in-out-coast-quint":P,"in-sine":r,"out-sine":y,"in-out-sine":f,"in-expo":w,"out-expo":z,"in-out-expo":A,"in-circ":x,"out-circ":B,"in-out-circ":C};a.inCirc=x;a.inCoastCubic=G;a.inCoastQuad=D;a.inCoastQuart=L;a.inCoastQuint=J;a.inCubic=m;a.inExpo=w;a.inOutCirc=C;a.inOutCoastCubic=K;a.inOutCoastQuad=F;a.inOutCoastQuart=M;a.inOutCoastQuint=P;a.inOutCubic=d;a.inOutExpo=A;a.inOutQuad=v;a.inOutQuart=p;a.inOutQuint=k;a.inOutSine=f;a.inQuad=l;a.inQuart=e;a.inQuint=t;a.inSine=r;a.linear=b;a.outCirc=B;a.outCoastCubic=
O;a.outCoastQuad=E;a.outCoastQuart=R;a.outCoastQuint=I;a.outCubic=h;a.outExpo=z;a.outQuad=u;a.outQuart=g;a.outQuint=q;a.outSine=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/PointToPointAnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../ViewAnimation ../../animation/pointToPoint/Animation ./AnimationController ../../webgl-engine/lib/Camera ../../webgl-engine/lib/Intersector ../../../animation/easing".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){a.PointToPointAnimationController=function(y){function f(z){z=y.call(this,z)||this;z.view=null;z.mode="interaction";z.hasTarget=!1;return z}b._inheritsLoose(f,y);var w=f.prototype;w.initialize=function(){this.animation=new e.Animation(this.view.state.viewingMode);this.viewAnimation="interaction"===this.mode?null:new d};w.begin=function(z,A){this.hasTarget=!0;A=this.animationSettings(A);k.copyFrom(this.view.state.camera);const x=t.newIntersector(this.view.state.viewingMode);
this.intersectionHelper.intersectRay(k.ray,x,r)&&(k.center=r);this.animation.update(k,z,A);this.animation.finished&&this.finish()};w.finish=function(){this.animation.currentTime=this.animation.time;y.prototype.finish.call(this)};w.stepController=function(z,A){this.hasTarget&&this.animation.step(z,A)};w.onControllerEnd=function(z){this.hasTarget&&(this.animation.cameraAt(this.animation.currentTime/this.animation.time,z),this.animation.currentTime=this.animation.time);y.prototype.onControllerEnd.call(this,
z)};w.animationSettings=function(z={}){return{apex:{maximumDistance:this.view.state.constraints.clampAltitude(Infinity)/6,ascensionFactor:void 0,descensionFactor:void 0},...z,easing:"string"===typeof z.easing?q.EasingFunctions[z.easing]:z.easing}};b._createClass(f,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}},{key:"isInteractive",get:function(){return"interaction"===this.mode}},{key:"steppingFinished",get:function(){return this.hasTarget&&this.animation.finished}}]);
return f}(g.AnimationController);c.__decorate([n.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"view",void 0);c.__decorate([n.property({constructOnly:!0})],a.PointToPointAnimationController.prototype,"mode",void 0);a.PointToPointAnimationController=c.__decorate([m.subclass("esri.views.3d.state.controllers.PointToPointAnimationController")],a.PointToPointAnimationController);const k=new p.Camera,r=h.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/animation/pointToPoint/Animation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec3 ../../../../chunks/vec3f64 ./Camera ../../webgl-engine/lib/Camera ../../../animation/pointToPoint/Animation".split(" "),function(a,b,c,n,l,u,v,m){const h=l.create();l=function(){function d(g){this.currentTime=c.Milliseconds(0);this._animation=new m.Animation(()=>new u(g));this._current=new u(g)}var e=d.prototype;e.update=function(g,
p,t){const q=this._animation.definition.source,k=this._animation.definition.target,r=n.subtract(h,p.center,g.center),y=n.length(r);1E-5<=y?(r[0]/=y,r[1]/=y,r[2]/=y):(r[0]=0,r[1]=1,r[0]=0);n.copy(q.lookAtDirection,r);n.copy(k.lookAtDirection,r);q.copyFromRenderCamera(g);k.copyFromRenderCamera(p);this._current.copyFrom(q);this._animation.update(q,k,t);this.currentTime=c.Milliseconds(0);g.almostEquals(p)&&(this.currentTime=this._animation.time)};e.cameraAt=function(g,p){this._animation.cameraAt(g,this._current);
p=p||new v.Camera;this._current.copyToRenderCamera(p);return p};e.step=function(g,p){this.finished||(this.currentTime=c.Milliseconds(this.currentTime+c.millisecondsFromSeconds(g)),this.currentTime>=this.time&&(this.currentTime=this.time));return this.cameraAt(this.currentTime/this.time,p)};b._createClass(d,[{key:"finished",get:function(){return this.currentTime>=this._animation.time}},{key:"time",get:function(){return this._animation.time}}]);return d}();a.Animation=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/animation/pointToPoint/Camera":function(){define("../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/mathUtils".split(" "),function(a,b,c,n,l,u,v){const m=l.create(),h=l.create(),d=l.create(),e=l.create(),g=l.create(),p=l.create();var t=l.fromValues(0,0,1),q=l.fromValues(0,1,0),k=l.fromValues(1,0,0);const r=c.create();return function(){function y(w=
u.ViewingMode.Global){this.viewingMode=w;this.center=l.create();this.distance=this.yaw=this.pitch=0;this.lookAtDirection=l.clone(q)}var f=y.prototype;f.pixelsPerPanAtZoom=function(w){return this.size/2/(this._zoomToPanScale*w)};f.zoomAtPixelsPerPan=function(w){return this.size/2/(this._zoomToPanScale*w)};f.pixelsPerRotateAtZoom=function(){return this.size/2/Math.max(Math.cos(Math.abs(this.pitch)),.5)};f.compareTo=function(w,z){z||(z={pan:0,rotate:0,sourceZoom:0,targetZoom:0});if(this.viewingMode===
u.ViewingMode.Global){var A=n.length(this.center);const x=n.length(w.center);A=(A+x)/2;z.pan=v.angle(this.center,w.center)*A}else z.pan=n.distance(this.center,w.center);A=Math.abs(w.yaw-this.yaw);A>=Math.PI&&(A=2*Math.PI-A);z.rotate=Math.max(A,Math.abs(w.pitch-this.pitch));z.sourceZoom=this.distance;z.targetZoom=w.distance;return z};f.interpolate=function(w,z,A){this.viewingMode===u.ViewingMode.Global?v.slerp(w.center,z.center,A.pan,this.center):n.lerp(this.center,w.center,z.center,A.pan);this.distance=
a.lerp(w.distance,z.distance,A.zoom);this.pitch=a.lerp(w.pitch,z.pitch,A.rotate);w=w.yaw;z=z.yaw;Math.abs(z-w)>=Math.PI&&(w+=2*(w<z?1:-1)*Math.PI);this.yaw=a.lerp(w,z,A.rotate)};f.copyFrom=function(w){n.copy(this.center,w.center);this.pitch=w.pitch;this.yaw=w.yaw;this.distance=w.distance;n.copy(this.lookAtDirection,w.lookAtDirection);this.size=w.size;this.copyFromCommon(w);this.viewingMode=w.viewingMode};f.copyFromRenderCamera=function(w){const z=this._lookAtOrientation(w.center,r);n.copy(this.center,
w.center);n.subtract(e,w.center,w.eye);n.transformMat3(e,e,z);n.transformMat3(g,w.up,z);this.distance=n.length(e);e[0]/=this.distance;e[1]/=this.distance;e[2]/=this.distance;this.pitch=this._eyeUpToPitch(e);this.yaw=this._eyeUpToYaw(e,g);this.size=Math.sqrt(w.width*w.width+w.height*w.height);this.copyFromCommon(w)};f.copyFromCommon=function(w){this.fov=w.fov;this._zoomToPanScale=Math.atan(.5*this.fov)};f.copyToRenderCamera=function(w){const z=this._lookAtOrientation(this.center,r);b.transpose(z,z);
this._axisAngleVec3(k,this.pitch-Math.PI/2,q,e);this._axisAngleVec3(t,this.yaw,e);this._axisAngleVec3(k,this.pitch-Math.PI/2,t,g);this._axisAngleVec3(t,this.yaw,g);n.scale(e,e,this.distance);n.transformMat3(e,e,z);n.transformMat3(g,g,z);w.center=this.center;w.eye=n.subtract(e,this.center,e);w.up=g};f._axisAngleVec3=function(w,z,A,x=A){const B=Math.cos(z);z=Math.sin(z);n.scale(m,A,B);n.cross(h,w,A);n.scale(h,h,z);n.scale(d,w,(1-B)*n.dot(w,A));return n.add(x,n.add(x,m,h),d)};f._lookAtOrientation=function(w,
z=c.create()){this._upAtLookAt(w,d);n.cross(m,this.lookAtDirection,d);n.normalize(m,m);0===m[0]&&0===m[1]&&0===m[2]&&n.copy(m,k);n.cross(h,d,m);n.normalize(h,h);z[0]=m[0];z[1]=h[0];z[2]=d[0];z[3]=m[1];z[4]=h[1];z[5]=d[1];z[6]=m[2];z[7]=h[2];z[8]=d[2];return z};f._upAtLookAt=function(w,z){return this.viewingMode===u.ViewingMode.Local?n.copy(z,t):n.normalize(z,w)};f._eyeUpToPitch=function(w){return Math.PI-v.angle(t,w)};f._eyeUpToYaw=function(w,z){.5>Math.abs(z[2])?(n.copy(p,z),0<w[2]&&n.scale(p,p,
-1)):n.copy(p,w);n.cross(h,p,t);n.normalize(h,h);return v.angle(k,h,t)};return y}()})},"esri/views/3d/webgl-engine/lib/Camera":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../geometry/support/vector ../../../ViewingMode ./Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){const w=c.getLogger("esri.views.3d.webgl-engine.lib.Camera");c=function(){function D(F=null,G=null,O=null){this._viewUp=g.create();this._viewForward=g.create();this._viewRight=g.create();this._ray=k.create();this._viewport=t.fromValues(0,0,1,1);this._padding=t.fromValues(0,0,0,0);this._fov=55/180*Math.PI;this._nearFar=d.fromValues(1,1E3);this._viewDirty=!0;this._viewMatrix=m.create();this._projectionDirty=!0;this._projectionMatrix=m.create();this._viewProjectionDirty=
!0;this._viewProjectionMatrix=m.create();this._viewInverseTransposeMatrixDirty=!0;this._viewInverseTransposeMatrix=m.create();this._inverseProjectionDirty=!0;this._inverseProjectionMatrix=null;this._frustumDirty=!0;this._frustum=q.create();this._fullViewport=t.create();this._pixelRatio=1;this.relativeElevation=0;l.isSome(F)&&e.copy(this._ray.origin,F);this._center=l.isSome(G)?g.clone(G):g.create();this._up=l.isSome(O)?g.clone(O):g.fromValues(0,0,1)}var E=D.prototype;E.depthNDCToWorld=function(F){return 2*
this.near*this.far/(this.far+this.near-(2*F-1)*(this.far-this.near))};E.copyFrom=function(F){e.copy(this._ray.origin,F.eye);e.copy(this._center,F.center);e.copy(this._up,F.up);p.copy(this._viewport,F.viewport);p.copy(this._padding,F.padding);h.copy(this._nearFar,F.nearFar);this._fov=F.fov;this.relativeElevation=F.relativeElevation;this._viewDirty=F._viewDirty;this._viewDirty||(v.copy(this._viewMatrix,F.viewMatrix),e.copy(this._viewRight,F.viewRight),e.copy(this._viewUp,F.viewUp),e.copy(this._viewForward,
F.viewForward));F._projectionDirty?this._projectionDirty=!0:(v.copy(this._projectionMatrix,F.projectionMatrix),this._projectionDirty=!1);this._inverseProjectionDirty=this._viewProjectionDirty=!0;this._frustumDirty=F._frustumDirty;this._frustumDirty||(q.copy(this._frustum,F.frustum),this._frustumDirty=!1);F._viewInverseTransposeMatrixDirty?this._viewInverseTransposeMatrixDirty=!0:(v.copy(this._viewInverseTransposeMatrix,F.viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=!1);p.copy(this._fullViewport,
F.fullViewport);this._pixelRatio=F.pixelRatio;return this};E.copyViewFrom=function(F){this.eye=F.eye;this.center=F.center;this.up=F.up};E.clone=function(){return(new D).copyFrom(this)};E.equals=function(F){return e.exactEquals(this.eye,F.eye)&&e.exactEquals(this._center,F.center)&&e.exactEquals(this._up,F.up)&&p.exactEquals(this._viewport,F.viewport)&&p.exactEquals(this._padding,F.padding)&&h.exactEquals(this._nearFar,F.nearFar)&&this._fov===F.fov&&this._pixelRatio===F.pixelRatio&&this.relativeElevation===
F.relativeElevation};E.almostEquals=function(F){if(this._pixelRatio!==F.pixelRatio||.001<=Math.abs(F.fov-this._fov))return!1;const G=1-1E-10;e.sub(x,F.eye,F.center);e.sub(B,this.eye,this._center);const O=e.dot(x,B),K=e.sqrLen(x),L=e.sqrLen(B);return O*O>=G*K*L&&e.sqrDist(F.eye,this.eye)<2.5E-7*Math.max(K,L)&&.5>p.squaredDistance(F.padding,this._padding)&&.5>p.squaredDistance(F.viewport,this._viewport)};E.computeRenderPixelSizeAt=function(F){return this.computeRenderPixelSizeAtDist(this._viewDirectionDistance(F))};
E.computeRenderPixelSizeAtDist=function(F){return F*this.perRenderPixelRatio};E.computeScreenPixelSizeAt=function(F){return this.computeScreenPixelSizeAtDist(this._viewDirectionDistance(F))};E._viewDirectionDistance=function(F){return Math.abs(r.projectPointSignedLength(this.viewForward,e.subtract(x,F,this.eye)))};E.computeScreenPixelSizeAtDist=function(F){return F*this.perScreenPixelRatio};E.computeDistanceFromRadius=function(F,G){return F/Math.tan(Math.min(this.fovX,this.fovY)/(2*(G||1)))};E.getScreenCenter=
function(F=u.createScreenPointArray()){F[0]=(this.padding[a.PaddingSide.LEFT]+this.width/2)/this._pixelRatio;F[1]=(this.padding[a.PaddingSide.TOP]+this.height/2)/this._pixelRatio;return F};E.getRenderCenter=function(F,G=.5,O=.5){F[0]=this.padding[a.PaddingSide.LEFT]+this.width*G;F[1]=this.padding[a.PaddingSide.BOTTOM]+this.height*O;F[2]=.5;return F};E.setGLViewport=function(F){const G=this.viewport,O=this.padding;F.setViewport(G[0]-O[3],G[1]-O[2],G[2]+O[1]+O[3],G[3]+O[0]+O[2])};E.applyProjection=
function(F,G){F!==z&&e.copy(z,F);z[3]=1;p.transformMat4(z,z,this.projectionMatrix);F=Math.abs(z[3]);e.scale(z,z,1/F);const O=this.fullViewport;G[0]=n.lerp(0,O[0]+O[2],.5+.5*z[0]);G[1]=n.lerp(0,O[1]+O[3],.5+.5*z[1]);G[2]=.5*(z[2]+1);G[3]=F};E.unapplyProjection=function(F,G){const O=this.fullViewport;z[0]=(F[0]/(O[0]+O[2])*2-1)*F[3];z[1]=(F[1]/(O[1]+O[3])*2-1)*F[3];z[2]=(2*F[2]-1)*F[3];z[3]=F[3];p.transformMat4(z,z,this.inverseProjectionMatrix);G[0]=z[0];G[1]=z[1];G[2]=z[2]};E.projectToScreen=function(F,
G){this.projectToRenderScreen(F,C);this.renderToScreen(C,G)};E.projectToRenderScreen=function(F,G){z[0]=F[0];z[1]=F[1];z[2]=F[2];z[3]=1;p.transformMat4(z,z,this.viewProjectionMatrix);if(0===z[3])return null;e.scale(z,z,1/Math.abs(z[3]));F=this.fullViewport;"x"in G?(G.x=n.lerp(0,F[0]+F[2],.5+.5*z[0]),G.y=n.lerp(0,F[1]+F[3],.5+.5*z[1])):(G[0]=n.lerp(0,F[0]+F[2],.5+.5*z[0]),G[1]=n.lerp(0,F[1]+F[3],.5+.5*z[1]),2<G.length&&(G[2]=.5*(z[2]+1)));return G};E.unprojectFromScreen=function(F,G){return this.unprojectFromRenderScreen(this.screenToRender(F,
C),G)};E.unprojectFromRenderScreen=function(F,G){v.multiply(A,this.projectionMatrix,this.viewMatrix);if(!v.invert(A,A))return null;const O=this.fullViewport;z[0]=2*(F[0]-O[0])/O[2]-1;z[1]=2*(F[1]-O[1])/O[3]-1;z[2]=2*F[2]-1;z[3]=1;p.transformMat4(z,z,A);if(0===z[3])return null;G[0]=z[0]/z[3];G[1]=z[1]/z[3];G[2]=z[2]/z[3];return G};E.constrainWindowSize=function(F,G,O,K=O){F*=this._pixelRatio;G*=this._pixelRatio;return[Math.max(F-O/2,0),Math.max(this.fullHeight-G-K/2,0),O- -Math.min(F-O/2,0)- -Math.min(this.fullWidth-
F-O/2,0),K- -Math.min(this.fullHeight-G-K/2,0)- -Math.min(G-K/2,0)]};E.computeUp=function(F){F===y.ViewingMode.Global?this._computeUpGlobal():this._computeUpLocal()};E.screenToRender=function(F,G){const O=this.fullHeight-F[1]*this._pixelRatio;G[0]=F[0]*this._pixelRatio;G[1]=O;return G};E.renderToScreen=function(F,G){const O=(this.fullHeight-F[1])/this._pixelRatio;G[0]=F[0]/this._pixelRatio;G[1]=O};E._computeUpGlobal=function(){e.subtract(x,this.center,this.eye);const F=e.length(this.center);1>F?(e.set(this._up,
0,0,1),this._markViewDirty()):Math.abs(e.dot(x,this.center))>.9999*e.length(x)*F||(e.cross(this._up,x,this.center),e.cross(this._up,this._up,x),e.normalize(this._up,this._up),this._markViewDirty())};E._computeUpLocal=function(){e.direction(x,this.eye,this.center);.9999>=Math.abs(x[2])&&(e.scale(x,x,x[2]),e.set(this._up,-x[0],-x[1],1-x[2]),e.normalize(this._up,this._up),this._markViewDirty())};E._compareAndSetView=function(F,G){"number"===typeof F[0]&&isFinite(F[0])&&"number"===typeof F[1]&&isFinite(F[1])&&
"number"===typeof F[2]&&isFinite(F[2])?e.exactEquals(F,G)||(e.copy(G,F),this._markViewDirty()):w.warn("Camera vector contains invalid number, ignoring value")};E._markViewDirty=function(){this._viewProjectionDirty=this._frustumDirty=this._viewDirty=!0};E._recomputeFrustum=function(){this._frustumDirty&&(q.fromMatrix(this.viewMatrix,this.projectionMatrix,this._frustum),this._frustumDirty=!1)};E._ensureViewClean=function(){this._viewDirty&&(v.lookAt(this._viewMatrix,this.eye,this._center,this._up),
e.set(this._viewForward,-this._viewMatrix[2],-this._viewMatrix[6],-this._viewMatrix[10]),e.set(this._viewUp,this._viewMatrix[1],this._viewMatrix[5],this._viewMatrix[9]),e.set(this._viewRight,this._viewMatrix[0],this._viewMatrix[4],this._viewMatrix[8]),this._viewDirty=!1,this._viewInverseTransposeMatrixDirty=!0)};b._createClass(D,[{key:"pixelRatio",get:function(){return this._pixelRatio},set:function(F){this._pixelRatio=0<F?F:1}},{key:"eye",get:function(){return this._ray.origin},set:function(F){this._compareAndSetView(F,
this._ray.origin)}},{key:"center",get:function(){return this._center},set:function(F){this._compareAndSetView(F,this._center)}},{key:"ray",get:function(){e.subtract(this._ray.direction,this.center,this.eye);return this._ray}},{key:"up",get:function(){return this._up},set:function(F){this._compareAndSetView(F,this._up)}},{key:"viewMatrix",get:function(){this._ensureViewClean();return this._viewMatrix},set:function(F){v.copy(this._viewMatrix,F);this._viewDirty=!1;this._frustumDirty=this._viewProjectionDirty=
this._viewInverseTransposeMatrixDirty=!0}},{key:"viewForward",get:function(){this._ensureViewClean();return this._viewForward}},{key:"viewUp",get:function(){this._ensureViewClean();return this._viewUp}},{key:"viewRight",get:function(){this._ensureViewClean();return this._viewRight}},{key:"nearFar",get:function(){return this._nearFar}},{key:"near",get:function(){return this._nearFar[0]},set:function(F){this._nearFar[0]!==F&&(this._nearFar[0]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=
this._projectionDirty=!0)}},{key:"far",get:function(){return this._nearFar[1]},set:function(F){this._nearFar[1]!==F&&(this._nearFar[1]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"viewport",get:function(){return this._viewport},set:function(F){this.x=F[0];this.y=F[1];this.width=F[2];this.height=F[3]}},{key:"x",get:function(){return this._viewport[0]},set:function(F){F+=this._padding[a.PaddingSide.LEFT];this._viewport[0]!==F&&(this._viewport[0]=
F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"y",get:function(){return this._viewport[1]},set:function(F){F+=this._padding[a.PaddingSide.BOTTOM];this._viewport[1]!==F&&(this._viewport[1]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"width",get:function(){return this._viewport[2]},set:function(F){this._viewport[2]!==F&&(this._viewport[2]=F,this._frustumDirty=this._viewProjectionDirty=
this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"height",get:function(){return this._viewport[3]},set:function(F){this._viewport[3]!==F&&(this._viewport[3]=F,this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0)}},{key:"fullWidth",get:function(){return this._viewport[2]+this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]},set:function(F){this.width=F-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT])}},
{key:"fullHeight",get:function(){return this._viewport[3]+this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]},set:function(F){this.height=F-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM])}},{key:"fullViewport",get:function(){this._fullViewport[0]=this._viewport[0]-this._padding[a.PaddingSide.LEFT];this._fullViewport[1]=this._viewport[1]-this._padding[a.PaddingSide.BOTTOM];this._fullViewport[2]=this.fullWidth;this._fullViewport[3]=this.fullHeight;return this._fullViewport}},
{key:"aspect",get:function(){return this.width/this.height}},{key:"padding",get:function(){return this._padding},set:function(F){if(this._padding[a.PaddingSide.TOP]!==F[a.PaddingSide.TOP]||this._padding[a.PaddingSide.RIGHT]!==F[a.PaddingSide.RIGHT]||this._padding[a.PaddingSide.BOTTOM]!==F[a.PaddingSide.BOTTOM]||this._padding[a.PaddingSide.LEFT]!==F[a.PaddingSide.LEFT])this._viewport[0]+=F[a.PaddingSide.LEFT]-this._padding[a.PaddingSide.LEFT],this._viewport[1]+=F[a.PaddingSide.BOTTOM]-this._padding[a.PaddingSide.BOTTOM],
this._viewport[2]-=F[a.PaddingSide.RIGHT]+F[a.PaddingSide.LEFT]-(this._padding[a.PaddingSide.RIGHT]+this._padding[a.PaddingSide.LEFT]),this._viewport[3]-=F[a.PaddingSide.TOP]+F[a.PaddingSide.BOTTOM]-(this._padding[a.PaddingSide.TOP]+this._padding[a.PaddingSide.BOTTOM]),p.copy(this._padding,F),this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"viewProjectionMatrix",get:function(){this._viewProjectionDirty&&(v.multiply(this._viewProjectionMatrix,
this.projectionMatrix,this.viewMatrix),this._viewProjectionDirty=!1);return this._viewProjectionMatrix}},{key:"projectionMatrix",get:function(){if(this._projectionDirty){const F=this.width,G=this.height,O=this.near*Math.tan(this.fovY/2),K=O*this.aspect;v.frustum(this._projectionMatrix,-K*(1+2*this._padding[a.PaddingSide.LEFT]/F),K*(1+2*this._padding[a.PaddingSide.RIGHT]/F),-O*(1+2*this._padding[a.PaddingSide.BOTTOM]/G),O*(1+2*this._padding[a.PaddingSide.TOP]/G),this.near,this.far);this._projectionDirty=
!1}return this._projectionMatrix},set:function(F){v.copy(this._projectionMatrix,F);this._projectionDirty=!1;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=!0}},{key:"inverseProjectionMatrix",get:function(){l.isNone(this._inverseProjectionMatrix)&&(this._inverseProjectionMatrix=m.create());this._inverseProjectionDirty&&v.invert(this._inverseProjectionMatrix,this.projectionMatrix);return this._inverseProjectionMatrix}},{key:"fov",get:function(){return this._fov},set:function(F){this._fov=
F;this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovX",get:function(){return f.fovd2fovx(this._fov,this.width,this.height)},set:function(F){this._fov=f.fovx2fovd(F,this.width,this.height);this._frustumDirty=this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"fovY",get:function(){return f.fovd2fovy(this._fov,this.width,this.height)},set:function(F){this._fov=f.fovy2fovd(F,this.width,this.height);this._frustumDirty=
this._viewProjectionDirty=this._inverseProjectionDirty=this._projectionDirty=!0}},{key:"distance",get:function(){return e.distance(this._center,this.eye)}},{key:"frustum",get:function(){this._recomputeFrustum();return this._frustum}},{key:"viewInverseTransposeMatrix",get:function(){if(this._viewInverseTransposeMatrixDirty||this._viewDirty)v.invert(this._viewInverseTransposeMatrix,this.viewMatrix),v.transpose(this._viewInverseTransposeMatrix,this._viewInverseTransposeMatrix),this._viewInverseTransposeMatrixDirty=
!1;return this._viewInverseTransposeMatrix}},{key:"perRenderPixelRatio",get:function(){return Math.tan(this.fovX/2)/(this.width/2)}},{key:"perScreenPixelRatio",get:function(){return this.perRenderPixelRatio*this._pixelRatio}},{key:"aboveGround",get:function(){return this.relativeElevation&&0<=this.relativeElevation}}]);return D}();const z=t.create(),A=m.create(),x=g.create(),B=g.create(),C=u.createRenderScreenPointArray3();a.PaddingSide=void 0;(function(D){D[D.TOP=0]="TOP";D[D.RIGHT=1]="RIGHT";D[D.BOTTOM=
2]="BOTTOM";D[D.LEFT=3]="LEFT"})(a.PaddingSide||(a.PaddingSide={}));a.Camera=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Animation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/time ../easing ./Definition ./Settings ./apex/Path".split(" "),function(a,b,c,n,l,u,v){const m={zoom:0,pan:0,rotate:0};let h=function(){function d(g){this.createCamera=g;this._time=c.Milliseconds(0);this.definition=
new l.Definition(g);this.path=new v.Path}var e=d.prototype;e.update=function(g,p,t){this.definition.update(g,p,t);this.path.update(this.definition,t);this._time=this._applyTimeSettings(c.millisecondsFromSeconds(this.path.time),t);this._easing=t.easing?t.easing:1E3<=this._time?n.inOutCoastQuad:n.outExpo};e.cameraAt=function(g,p){p=p||this.createCamera();g=Math.min(Math.max(0,g),1);g=this._normalizedEasing(g);g=this.path.interpolateComponentsAt(g,m);p.interpolate(this.definition.source,this.definition.target,
g);return p};e._normalizedEasing=function(g){const p=this._easing(0,this._time),t=this._easing(1,this._time);return(this._easing(g,this._time)-p)/(t-p)};e._applyTimeSettings=function(g,p){const t=null!=p.speedFactor?p.speedFactor:1;null!=p.duration?g=p.duration:null!=p.speedFactor&&(g=c.Milliseconds(g/t));return c.Milliseconds(Math.min(Math.max(null!=p.minDuration?p.minDuration:u.defaultSettings.minDuration/t,g),null!=p.maxDuration?p.maxDuration:u.defaultSettings.maxDuration/t))};b._createClass(d,
[{key:"time",get:function(){return this._time}}]);return d}();a.Animation=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Definition":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./Settings"],function(a,b,c){let n=function(){function l(v){this.createCamera=v;this.compared={sourceZoom:0,targetZoom:0,pan:0,rotate:0};this.settings={desiredScreenFlow:c.defaultSettings.desiredScreenFlow};this.source=
v();this.target=v()}var u=l.prototype;u.clone=function(){const v=new l(this.createCamera);v.copyFrom(this);return v};u.copyFrom=function(v){this.update(v.source,v.target,v.settings)};u.update=function(v,m,h){this.source!==v&&this.source.copyFrom(v);this.target!==m&&this.target.copyFrom(m);this.compared=this.source.compareTo(this.target,this.compared);this.settings.desiredScreenFlow=null!=h.desiredScreenFlow?h.desiredScreenFlow:c.defaultSettings.desiredScreenFlow;this.desiredPixelFlow=this.settings.desiredScreenFlow*
this.target.size;this.halfWindowSize=this.target.size/2};u.halfWindowPanAtZoom=function(v){v=this.target.pixelsPerPanAtZoom(v);return this.halfWindowSize/v};b._createClass(l,[{key:"hasZoom",get:function(){return 1E-5<Math.abs(this.compared.sourceZoom-this.compared.targetZoom)}},{key:"hasPan",get:function(){return 1E-9<this.compared.pan}},{key:"hasRotate",get:function(){return 1E-9<this.compared.rotate}}]);return l}();a.Definition=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/animation/pointToPoint/Settings":function(){define(["exports","../../../core/time"],function(a,b){b={desiredScreenFlow:2,minDuration:b.Milliseconds(500),maxDuration:b.Milliseconds(8E3)};a.defaultSettings=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/apex/Path":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../easing ../Path ../Segment ./planning".split(" "),function(a,b,c,n,l,
u){n=function(v){function m(d,e){var g=v.call(this)||this;g._preallocSegments=[new l.Segment,new l.Segment,new l.Segment];g.update(d,e);return g}b._inheritsLoose(m,v);var h=m.prototype;h.update=function(d,e){if(d){this.definition?this.definition.copyFrom(d):this.definition=d.clone();var g=null;e&&e.apex&&(g=u.optimalDistance(d,e.apex));this.segments.length=0;this._descensionSegment=this._ascensionSegment=null;null==g?this._updateWithoutApex():this._updateWithApex(g,e.apex)}};h.segmentInterpolateComponentsAt=
function(d,e,g){g=d.interpolateComponentsAt(e,g);d===this._ascensionSegment?g.zoom=c.outQuad(g.zoom):d===this._descensionSegment&&(g.zoom=c.inQuad(g.zoom));return g};h._updateWithApex=function(d,e){const [g,p,t]=this._preallocSegments,q=null!=e.ascensionFactor?e.ascensionFactor:.5;e=Math.min(1-q,null!=e.ascensionFactor?e.descensionFactor:.5);const k=1-q-e;g.definition?g.definition.copyFrom(this.definition):g.definition=this.definition.clone();g.definition.compared.targetZoom=d;g.definition.compared.pan=
this.definition.compared.pan*q;g.definition.compared.rotate=this.definition.compared.rotate*q;g.update();this._ascensionSegment=g;this.segments.push(g);0<k&&(p.definition?p.definition.copyFrom(this.definition):p.definition=this.definition.clone(),p.definition.copyFrom(this.definition),p.definition.compared.sourceZoom=d,p.definition.compared.targetZoom=d,p.definition.compared.pan=this.definition.compared.pan*k,p.definition.compared.rotate=this.definition.compared.rotate*k,p.update(),this.segments.push(p));
t.definition?t.definition.copyFrom(this.definition):t.definition=this.definition.clone();t.definition.compared.sourceZoom=d;t.definition.compared.pan=this.definition.compared.pan*e;t.definition.compared.rotate=this.definition.compared.rotate*e;t.update();this._descensionSegment=t;this.segments.push(t)};h._updateWithoutApex=function(){const [d]=this._preallocSegments;d.update(this.definition);this.segments.push(d)};return m}(n.Path);a.Path=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/animation/pointToPoint/Path":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let n=function(){function l(){this.segments=[]}var u=l.prototype;u.interpolateComponentsAt=function(v,m){v=Math.min(Math.max(v,0),1);v*=this.time;var h=0,d=0;const e=this.definition;for(let g=0;g<this.segments.length;g++){const p=this.segments[g],t=p.definition;if(v<=p.time||g===this.segments.length-1)return m=this.segmentInterpolateComponentsAt(p,
v/p.time,m),m.pan=e.hasPan?(h+t.compared.pan*m.pan)/e.compared.pan:1,m.rotate=e.hasRotate?(d+t.compared.rotate*m.rotate)/e.compared.rotate:1,v=m.zoom*(t.compared.targetZoom-t.compared.sourceZoom)+t.compared.sourceZoom,h=this.segments[0].definition.compared.sourceZoom,d=this.segments[this.segments.length-1].definition.compared.targetZoom,m.zoom=e.hasZoom?(v-h)/(d-h):1,m;v-=p.time;h+=t.compared.pan;d+=t.compared.rotate}};u.segmentInterpolateComponentsAt=function(v,m,h){return v.interpolateComponentsAt(m,
h)};b._createClass(l,[{key:"time",get:function(){return this.segments.reduce((v,m)=>c.Seconds(v+m.time),c.Seconds(0))}}]);return l}();a.Path=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/animation/pointToPoint/Segment":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/time"],function(a,b,c){let n=function(){function l(v){v&&this.update(v)}var u=l.prototype;u.update=function(v){v&&(this.definition?this.definition.copyFrom(v):
this.definition=v.clone());this._updatePrecomputedVariables();this._updatePixelFlow()};u._updatePrecomputedVariables=function(){var v=this.definition;const m=v.compared,h=m.sourceZoom,d=m.targetZoom;this._zoomSign=h>d?1:-1;this._panPixelsAtSource=m.pan*v.source.pixelsPerPanAtZoom(h);v=(v.source.pixelsPerRotateAtZoom(h)+v.target.pixelsPerRotateAtZoom(d))/2;this._rotatePixels=m.rotate*v};u._updatePixelFlow=function(){var v=this.definition.compared.sourceZoom,m=this.definition.compared.targetZoom;const {hasZoom:h,
hasPan:d,hasRotate:e}=this.definition;var g=0,p=0;h&&(d&&(g=(m/v-1)/(-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2*this._panPixelsAtSource)),e&&(p=Math.log(v/m)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/this._rotatePixels));this._rotatePixelFlow=this._panPixelFlow=this._zoomPixelFlow=0;v=this.definition.desiredPixelFlow;h&&d&&e?(m=g+p+g*p,this._zoomPixelFlow=g*p/m*v,this._panPixelFlow=p/m*v,this._rotatePixelFlow=g/m*v):h&&d?(p=1+g,this._zoomPixelFlow=g/p*v,this._panPixelFlow=
1/p*v):h&&e?(g=1+p,this._zoomPixelFlow=p/g*v,this._rotatePixelFlow=1/g*v):d&&e?(g=this._panPixelsAtSource/this._rotatePixels,p=1+g,this._panPixelFlow=g/p*v,this._rotatePixelFlow=1/p*v):d?this._panPixelFlow=v:h?this._zoomPixelFlow=v:e&&(this._rotatePixelFlow=v);this._time=e?this.rotateTime:h?this.zoomTime:d?this.panTime:c.Seconds(0)};u._interpolateComponentsZoom=function(v){if(0===v||1===v)return v;if(this.definition.hasZoom){const m=this.definition.compared.sourceZoom,h=this.definition.compared.targetZoom;
return(m*(m/h)**-v-m)/(h-m)}return v};u._interpolateComponentsPan=function(v){if(0===v||1===v)return v;if(this.definition.hasPan&&this.definition.hasZoom){const m=-1/(this._zoomSign*this.definition.halfWindowSize)*this._zoomPixelFlow;return 1/this._panPixelsAtSource*this._panPixelFlow*(2**(m*v*this._time)-1)/(m*Math.LN2)}return v};u._interpolateComponentsRotate=function(v){return v};u.interpolateComponentsAt=function(v,m){v=Math.min(Math.max(v,0),1);const h=this._interpolateComponentsZoom(v),d=this._interpolateComponentsPan(v);
v=this._interpolateComponentsRotate(v);m?(m.zoom=h,m.pan=d,m.rotate=v):m={zoom:h,pan:d,rotate:v};return m};b._createClass(l,[{key:"time",get:function(){return this._time}},{key:"rotateTime",get:function(){return this.definition.hasRotate?c.Seconds(this._rotatePixels/this._rotatePixelFlow):c.Seconds(0)}},{key:"zoomTime",get:function(){return this.definition.hasZoom?c.Seconds(Math.log(this.definition.compared.sourceZoom/this.definition.compared.targetZoom)/Math.LN2*this._zoomSign*this.definition.halfWindowSize/
this._zoomPixelFlow):c.Seconds(0)}},{key:"panTime",get:function(){if(this.definition.hasPan){if(this.definition.hasZoom){const v=-1/(this._zoomSign*this.definition.halfWindowSize)*Math.LN2;return c.Seconds(Math.log(this._zoomPixelFlow/this._panPixelFlow*this._panPixelsAtSource*v+1)/(v*this._zoomPixelFlow))}return c.Seconds(this._panPixelsAtSource/this._panPixelFlow)}return c.Seconds(0)}}]);return l}();a.Segment=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/animation/pointToPoint/apex/planning":function(){define(["exports","./functions"],function(a,b){function c(n,l){const u=Math.max(n.compared.sourceZoom,n.compared.targetZoom);n=n.source.zoomAtPixelsPerPan(n.desiredPixelFlow/n.compared.pan)/2;return n<u?null!=l.maximumDistance?u+(l.maximumDistance-u)/2:1.5*u:l.maximumDistance?Math.min(l.maximumDistance,n):n}a.optimalDistance=function(n,l){let u=c(n,l);const v={ascensionFactor:null!=l.ascensionFactor?l.ascensionFactor:.5,descensionFactor:null!=
l.descensionFactor?l.descensionFactor:.5};var m=0===v.ascensionFactor,h=0===v.descensionFactor;const d=m?b.tAscensionZoomOnly:b.tAscensionZoomPan,e=m?b.dtAscensionZoomOnly:b.dtAscensionZoomPan,g=m?b.ddtAscensionZoomOnly:b.ddtAscensionZoomPan,p=h?b.tDescensionZoomOnly:b.tDescensionZoomPan,t=h?b.dtDescensionZoomOnly:b.dtDescensionZoomPan,q=h?b.ddtDescensionZoomOnly:b.ddtDescensionZoomPan;m=A=>d(n,A,v)+b.tPanion(n,A,v)+p(n,A,v);h=A=>e(n,A,v)+b.dtPanion(n,A,v)+t(n,A,v);const k=A=>g(n,A,v)+b.ddtPanion(n,
A,v)+q(n,A,v);let r=m(u);const y=b.tBaseLine(n),f=l.maximumIterations||20,w=null!=l.maximumDistance?l.maximumDistance:Infinity;for(l=0;l<f;l++){var z=(h(u)+1E-6)/k(u);if(isNaN(z)||u>=w&&0>z){if(!isFinite(w))return null;u=w;r=m(u);break}u-=z;if(u<n.compared.sourceZoom||u<n.compared.targetZoom)return null;z=m(u);if(.005>=Math.abs(z-r)/r)break;r=z}return r>.7*y||u<n.compared.sourceZoom||u<n.compared.targetZoom?null:u};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/animation/pointToPoint/apex/functions":function(){define(["exports"],function(a){a.ddtAscensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtAscensionZoomPan=function(b,c,n){const l=c-b.compared.sourceZoom,u=1/l,v=1/c,m=Math.log(b.compared.sourceZoom*v);n=(n.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(l))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*u*(-2*u*v*n+2*u*m+2*v-2*m*n/(l*l)-n/(c*c))/(b.desiredPixelFlow*Math.LN2)};
a.ddtDescensionZoomOnly=function(b,c){return-b.halfWindowSize/(c*c*b.desiredPixelFlow*Math.LN2)};a.ddtDescensionZoomPan=function(b,c,n){const l=c-b.compared.targetZoom,u=1/l,v=1/c,m=Math.log(c/b.compared.targetZoom);n=(b.halfWindowPanAtZoom(c)+n.descensionFactor*Math.LN2*b.compared.pan-b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*u*(-2*u*v*n-2*u*m+2*v+2*m*n/(l*l)-n/(c*c))/(b.desiredPixelFlow*Math.LN2)};a.ddtPanion=function(b,c,n){return-2*b.compared.pan*
b.halfWindowSize*(n.ascensionFactor+n.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c*c))};a.dtAscensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtAscensionZoomPan=function(b,c,n){const l=1/c,u=Math.log(b.compared.sourceZoom*l),v=1/b.desiredPixelFlow,m=1/Math.LN2;c-=b.compared.sourceZoom;const h=1/c;n=(n.ascensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(c))/b.halfWindowPanAtZoom(1);return b.halfWindowSize*l*v*m*h*n-b.halfWindowSize*
u*v*m*h+b.halfWindowSize*u*v*m*n/(c*c)};a.dtDescensionZoomOnly=function(b,c){return b.halfWindowSize/(c*b.desiredPixelFlow*Math.LN2)};a.dtDescensionZoomPan=function(b,c,n){const l=Math.log(c/b.compared.targetZoom),u=1/b.desiredPixelFlow,v=1/Math.LN2,m=-c+b.compared.targetZoom,h=1/m;n=(-b.halfWindowPanAtZoom(c)-n.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))/b.halfWindowPanAtZoom(1);return-b.halfWindowSize*l*u*v*h+b.halfWindowSize*l*u*v*n/(m*m)+b.halfWindowSize*
u*v*h*n/c};a.dtPanion=function(b,c,n){return b.compared.pan*b.halfWindowSize*(n.ascensionFactor+n.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c*c))};a.tAscensionZoomOnly=function(b,c){return-b.halfWindowSize*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*Math.LN2)};a.tAscensionZoomPan=function(b,c,n){const l=b.halfWindowPanAtZoom(c-b.compared.sourceZoom);return-b.halfWindowSize*(n.ascensionFactor*Math.LN2*b.compared.pan+l)*Math.log(b.compared.sourceZoom/c)/(b.desiredPixelFlow*
Math.LN2*l)};a.tBaseLine=function(b){const c=Math.LN2*b.compared.pan,n=b.halfWindowPanAtZoom(b.compared.sourceZoom-b.compared.targetZoom),l=b.halfWindowSize*Math.log(b.compared.sourceZoom/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*n);return b.compared.sourceZoom<=b.compared.targetZoom?l*(c-n):l*(c+n)};a.tDescensionZoomOnly=function(b,c){return b.halfWindowSize*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2)};a.tDescensionZoomPan=function(b,c,n){return b.halfWindowSize*(-b.halfWindowPanAtZoom(c)-
n.descensionFactor*Math.LN2*b.compared.pan+b.halfWindowPanAtZoom(b.compared.targetZoom))*Math.log(c/b.compared.targetZoom)/(b.desiredPixelFlow*Math.LN2*b.halfWindowPanAtZoom(-c+b.compared.targetZoom))};a.tPanion=function(b,c,n){return-b.compared.pan*b.halfWindowSize*(n.ascensionFactor+n.descensionFactor-1)/(b.desiredPixelFlow*b.halfWindowPanAtZoom(c))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/AnimationController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../ViewAnimation ./CameraController".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){a.AnimationController=function(t){function q(){return t.apply(this,arguments)||this}b._inheritsLoose(q,t);var k=q.prototype;k.onControllerStart=function(){this.state=p.State.Running;n.isSome(this.viewAnimation)&&this.viewAnimation.when(()=>this.updateStateFromViewAnimation(),()=>this.updateStateFromViewAnimation())};k.updateStateFromViewAnimation=function(){!n.isSome(this.viewAnimation)||this.state!==p.State.Ready&&this.state!==p.State.Running||(this.viewAnimation.state===
g.State.FINISHED?this.finish():this.viewAnimation.state===g.State.STOPPED&&(this.state=p.State.Stopped))};k.onControllerEnd=function(){n.isSome(this.viewAnimation)&&!this.viewAnimation.done&&(this.state===p.State.Finished?this.viewAnimation.finish():this.state===p.State.Stopped&&this.viewAnimation.stop());this._asyncResult&&(this.state===p.State.Finished?this._asyncResult.resolve():this._asyncResult.reject(l.createAbortError()))};k.finish=function(){this.finishController()};b._createClass(q,[{key:"canStop",
get:function(){return!0}},{key:"asyncResult",get:function(){return this._asyncResult},set:function(r){this._asyncResult&&(this._asyncResult.reject(l.createAbortError()),this._asyncResult=null);this.state===p.State.Finished||this.state===p.State.Stopped?this.state===p.State.Finished?r.resolve():r.reject(l.createAbortError()):this._asyncResult=r}}]);return q}(p.CameraController);a.AnimationController=c.__decorate([e.subclass("esri.views.3d.state.controllers.AnimationController")],a.AnimationController);
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/CameraController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,
v,m,h){a.State=void 0;(function(d){d.Ready="ready";d.Rejected="rejected";d.Running="running";d.Stopped="stopped";d.Finished="finished"})(a.State||(a.State={}));a.CameraController=function(d){function e(){var p=d.apply(this,arguments)||this;p.state=a.State.Ready;return p}b._inheritsLoose(e,d);var g=e.prototype;g.stopController=function(){return this.canStop?(this.state=a.State.Stopped,!0):!1};g.finishController=function(){this.state=a.State.Finished};b._createClass(e,[{key:"active",get:function(){return this.state===
a.State.Running}},{key:"isInteractive",get:function(){return!1}},{key:"canStop",get:function(){return!1}},{key:"steppingFinished",get:function(){return!1}}]);return e}(n);c.__decorate([l.property({readOnly:!0})],a.CameraController.prototype,"active",null);c.__decorate([l.property()],a.CameraController.prototype,"state",void 0);a.CameraController=c.__decorate([h.subclass("esri.views.3d.state.controllers.CameraController")],a.CameraController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/utils/navigationUtils":function(){define("exports ../../../../core/Cyclical ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/axisAngle ../../../../geometry/support/coordinateSystem ../../../../geometry/support/plane ../../../../chunks/sphere ../../../../geometry/support/vector ../../../../geometry/support/vectorStacks ../../support/geometryUtils/ray ../../support/geometryUtils/sphere ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){function z(sa,ya,ra){ra=u.fromRotation(r.sm4d.get(),ra[3],g.axis(ra));n.isNone(ra)||(d.subtract(ha,sa.eye,ya),d.transformMat4(ha,ha,ra),sa.eye=d.add(ha,ha,ya),d.subtract(ha,sa.center,ya),d.transformMat4(ha,ha,ra),sa.center=d.add(ha,ha,ya),sa.up=d.transformMat4(ha,sa.up,ra))}function A(sa,ya){d.set(ya,0,0,0);for(const ra of sa)d.add(ya,ya,ra);d.scale(ya,ya,1/sa.length)}function x(sa,ya,ra,ua){return Math.sin(sa/d.length(ya))*(ra+ua.radius)}function B(sa,
ya,ra,ua){ra=y.fromScreenAtEye(ya,ra,wa);if(n.isNone(ra))return!1;q.closestPointOnSilhouette(sa,ra,V);return q.intersectRay(sa,ra,ua)?d.squaredDistance(V,ra.origin)<d.squaredDistance(ua,ra.origin)?(d.copy(ua,V),!1):!0:(d.subtract(S,ya.eye,ya.center),d.normalize(S,S),t.fromNormalAndOffset(S,-d.dot(d.normalize(S,S),V),T),t.intersectRay(T,ra,ua),!1)}function C(sa,ya,ra,ua,Ba,Ea){d.cross(pa,sa,ya);d.subtract(ja,sa,ya);d.length(sa)<=Ba||!ua.aboveGround?(d.cross(ra,ja,ua.eye),sa=d.dot(sa,ya)/(d.length(sa)*
d.length(ya)),Ea=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(Ea)),0,P)),ya=-c.acosClamped(sa)-Math.max(0,d.length(ya)-Ba)/(Ea*Ba)):(d.subtract(H,ua.eye,ua.center),d.cross(ra,ja,H),ya=-d.length(ja)/Ba);d.normalize(ra,ra);d.scale(ra,ra,d.length(pa));return ya}function D(sa,ya,ra,ua){ua=Math.cos(c.clamp(b.cyclicalPI.normalize(c.deg2rad(ua)),0,P));ya=ya>ra?-(ya-ra)/(ua*ra):ya<-ra?Math.PI-(ya+ra)/(ua*ra):c.acosClamped(ya/ra);return((sa>ra?-(sa-ra)/(ua*ra):sa<-ra?Math.PI-(sa+ra)/(ua*ra):c.acosClamped(sa/
ra))-ya)*ra}function E(sa,ya,ra,ua,Ba,Ea,Ja,va,Ca,Ka){Ca=D(sa[2],ya[2],Ja[3],Ca);ya=Ka?D(sa[0],ya[0],Ja[3],180):ya[0]-sa[0];sa=Math.sin(va)*ya-Math.cos(va)*Ca;va=Math.cos(va)*ya+Math.sin(va)*Ca;d.normalize(ha,Ba);Ba=Ka?sa/Math.sqrt(Math.abs(Ja[3]**2-d.dot(ra,ha)**2)):sa/Ja[3];ra=va/Math.sqrt(Math.abs(Ja[3]**2-d.dot(ra,ua)**2));m.set(Ea,Ba,ra)}function F(sa,ya,ra,ua,Ba,Ea,Ja,va,Ca,Ka){d.cross(pa,sa,ya);p.coordinateSystemFromOneAxisAndNormalVector(Ea.up,Ea.eye,X,ba,aa);p.coordinateSystemFromOneAxisAndNormalVector([0,
0,1],Ea.eye,U,W,Q);d.copy(ra,W);d.copy(ua,U);d.normalize(ra,ra);d.scale(ra,ra,d.length(pa));p.vectorCoordinates(sa,d.normalize(ba,ba),d.normalize(aa,aa),d.normalize(X,X),ea);p.vectorCoordinates(ya,ba,aa,X,ia);E(ea,ia,sa,U,W,Ba,Ja,va,Ca,Ka)}function G(sa,ya,ra,ua,Ba,Ea,Ja){u.fromRotation(Z,Ba,ua);u.fromRotation(ca,Ja,Ea);u.multiply(Y,Z,ca);d.subtract(ya,sa,ra);d.transformMat4(ya,ya,Y);d.add(ya,ya,ra)}function O(sa,ya,ra,ua,Ba,Ea){u.fromRotation(Z,ua,ra);u.fromRotation(ca,Ea,Ba);u.multiply(Y,Z,ca);
d.subtract(ha,sa.eye,ya);d.transformMat4(ha,ha,Y);sa.eye=d.add(ha,ha,ya);d.subtract(ha,sa.center,ya);d.transformMat4(ha,ha,Y);sa.center=d.add(ha,ha,ya);d.subtract(ha,sa.up,ya);d.transformMat4(ha,ha,Y);sa.up=d.add(ha,ha,ya)}function K(sa,ya,ra,ua,Ba,Ea,Ja=I.Pole,va=I.Angle){sa=Math.abs(sa[2])<ra*Ja||Math.abs(ya)>ra;return(Math.abs(ua)>Math.PI-va||Math.abs(ua)<va)&&sa&&Ea.aboveGround&&Ba<I.Tilt?!0:!1}function L(sa,ya,ra,ua,Ba,Ea){Ea?(g.fromPoints(ra,ua,la),z(ya,sa,la)):(ra=C(ra,ua,na,ya,sa[3],Ba),z(ya,
sa,g.wrapAxisAngle(na,ra)))}function R(sa,ya,ra,ua,Ba,Ea,Ja){const va=Ja?20:1;d.copy(da,ua);ma.copyFrom(ya);let Ca;for(let Ka=0;Ka<va&&1E-12<d.squaredDistance(ra,da);Ka++)if(ua=d.squaredDistance(ra,da),F(ra,da,W,U,ka,ma,sa,Ba,Ea,Ja),O(ma,sa,U,ka[1],W,ka[0]),G(da,da,sa,U,ka[1],W,ka[0]),Ca=d.squaredDistance(ra,da),Ca<ua||0===Ka)ya.copyFrom(ma);else break}a.SpherePickPointFallback=void 0;(function(sa){sa[sa.Ellipsoid=0]="Ellipsoid";sa[sa.Silhouette=1]="Silhouette"})(a.SpherePickPointFallback||(a.SpherePickPointFallback=
{}));const M=l.createScreenPointArray();a.NavigationMode=void 0;(function(sa){sa[sa.Vertical=0]="Vertical";sa[sa.Horizontal=1]="Horizontal"})(a.NavigationMode||(a.NavigationMode={}));const J={Elevation:3E4,Angle:c.deg2rad(6)},I={Pole:.95,Angle:c.deg2rad(18),Tilt:45},P=c.deg2rad(80),N=e.create(),V=e.create(),S=e.create(),T=t.create(),H=e.create(),U=e.create(),W=e.create(),Q=e.create(),X=e.create(),ba=e.create(),aa=e.create(),ea=e.create(),ia=e.create(),ka=h.create(),la=g.create(),Z=v.create(),ca=v.create(),
Y=v.create(),da=e.create(),ha=e.create(),ja=e.create(),ma=new w.Camera,pa=e.create(),na=e.create(),wa={origin:e.create(),direction:e.create()},xa={origin:e.create(),direction:e.create()};a.DISTANCE_CLAMP_VALUES=[1,3E8];a.PIVOT_DISTANCE_MODIFIER=30;a.PreservingHeadingThreshold=I;a.SCREEN_PIXEL_AREA=70;a.TiltThresholdPanningSpeed=P;a.VerticalPanTresholds=J;a.applyPanPlanar=function(sa,ya,ra){d.subtract(N,ra,ya);sa.eye=d.subtract(ha,sa.eye,N);sa.center=d.subtract(ha,sa.center,N)};a.applyPanSphericalDirectRotation=
L;a.applyPanSphericalPreserveHeading=R;a.applyRotation=z;a.applyRotationWithTwoAxes=O;a.applyZoomOnSphere=function(sa,ya,ra){ya.getScreenCenter(M);f.intersectScreen(sa,ya,M,ha)&&(ya.center=ha);sa=ya.distance;ra*=sa;1E-6>Math.abs(sa-ra)||(ra=d.scale(r.sv3d.get(),ya.viewForward,ra),ya.eye=d.subtract(ha,ya.center,ra))};a.applyZoomToPoint=function(sa,ya,ra,ua){const Ba=r.sv3d.get();ra=1-ra;d.subtract(Ba,ya,sa.eye);const Ea=d.length(Ba);let Ja=Ea*(1-ra);0<=ra&&Ja<ua&&(Ja=ua,ra=-(Ja-Ea)/Ea);1E-6>Math.abs(Ea-
Ja)||(d.scale(Ba,Ba,ra),sa.eye=d.add(ha,sa.eye,Ba),sa.center=d.lerp(ha,sa.center,ya,ra))};a.centroid=A;a.centroidOnSphere=function(sa,ya,ra){A(ya,ra);d.normalize(ra,ra);d.scale(ra,ra,sa)};a.decideNavigationMode=function(sa,ya,ra,ua){if(d.length(sa.eye)-ua.radius>J.Elevation)return a.NavigationMode.Horizontal;if(!ra)return a.NavigationMode.Vertical;y.fromScreenAtEye(sa,ya,xa);return-Math.sign(sa.relativeElevation)*(.5*Math.PI+k.angle(sa.eye,xa.direction))<J.Angle?a.NavigationMode.Vertical:a.NavigationMode.Horizontal};
a.intersectPlaneFromScreenPoint=function(sa,ya,ra,ua){return t.intersectRay(sa,y.fromScreen(ya,ra,wa),ua)};a.intersectPlaneFromScreenPointAtEye=function(sa,ya,ra,ua){return t.intersectRay(sa,y.fromScreenAtEye(ya,ra,wa),ua)};a.lengthFromPoints=D;a.normalizeCoordinate=function(sa,ya,ra){ra[0]=ya[0]/(sa.fullWidth/sa.pixelRatio);ra[1]=ya[1]/(sa.fullHeight/sa.pixelRatio);return ra};a.normalizeRotationDelta=function(sa){for(;sa>Math.PI;)sa-=2*Math.PI;for(;sa<-Math.PI;)sa+=2*Math.PI;return sa};a.offSurfaceTiltToEyeTiltGlobal=
function(sa,ya,ra,ua){return x(Math.PI/2,ya,ra,ua)+(sa-Math.PI/2)};a.onSurfaceTiltToEyeTiltGlobal=x;a.panMotionToRotationMatrix=function(sa,ya,ra,ua,Ba,Ea,Ja,va,Ca){if(K(sa.center,d.dot(sa.up,sa.center),d.length(sa.center),-b.cyclicalPI.normalize(c.deg2rad(Ea)),Ja,ya))switch(sa=-b.cyclicalPI.normalize(c.deg2rad(Ba)),{eye:Ba}=ya,p.coordinateSystemFromOneAxisAndNormalVector([0,0,1],Ba,U,W,Q),Ba=ra.translation[0]*ua.pan,Ea="zoom"===Ca.mode?0:ra.translation[1]*ua.pan,ya=Math.max(Math.sqrt(Math.abs(1-
d.dot(ya.center,U)**2/d.length(ya.center)**2)),.5),Ja=-Math.cos(sa)*Ea+Math.sin(sa)*Ba,u.rotate(va.pan.matrix,va.pan.matrix,(Math.sin(sa)*Ea+Math.cos(sa)*Ba)/ya,U),va.pan.enabled=!0,Ca.mode){case "pan":u.rotate(va.pan.matrix,va.pan.matrix,Ja,W);va.pan.enabled=!0;break;case "zoom":va.zoom=-ra.translation[1]*ua.zoom}else{{const {eye:Ka,viewRight:Oa}=ya;ya=d.cross(r.sv3d.get(),Oa,Ka);sa=ra.translation[0]*ua.pan;0!==sa&&(u.rotate(va.pan.matrix,va.pan.matrix,-sa,ya),va.pan.enabled=!0);switch(Ca.mode){case "pan":ra=
ra.translation[1]*ua.pan;0!==ra&&(u.rotate(va.pan.matrix,va.pan.matrix,ra,Oa),va.pan.enabled=!0);break;case "zoom":va.zoom=-ra.translation[1]*ua.zoom}}}};a.panToPosition=function(sa,ya,ra,ua,Ba,Ea,Ja){K(ra,d.dot(ya.up,ra),sa[3],-b.cyclicalPI.normalize(c.deg2rad(Ba)),Ea,ya,I.Pole,I.Angle)?R(sa,ya,ra,ua,-b.cyclicalPI.normalize(c.deg2rad(Ba)),Ea,Ja):L(sa,ya,ra,ua,Ea,Ja)};a.pickPointAndInitSphere=function(sa,ya,ra,ua,Ba,Ea){const Ja=e.create(),va=q.create();let Ca=!0,Ka=!0;sa.intersectScreen(ra,Ja,Ea)?
va[3]=d.length(Ja):(Ka=!1,va[3]=ya.aboveGround&&Ba!==a.SpherePickPointFallback.Ellipsoid?Math.max(d.length(ya.center),.9*ua.radius):d.length(ya.eye)-ya.relativeElevation,Ba===a.SpherePickPointFallback.Silhouette?B(va,ya,ra,Ja):Ca=f.intersectScreen(va,ya,ra,Ja));return{sphere:va,scenePickPoint:Ca?Ja:null,hasGeometryIntersection:Ka}};a.preserveHeadingThreshold=K;a.rotatePointAroundTwoAxes=G;a.rotationAngleAndAxisDirectRotation=C;a.rotationAnglesAndAxesHeadingPreserving=F;a.rotationAnglesHeadingPreserving=
E;a.rotationFromPointsAroundAxis=function(sa,ya,ra){const ua=r.sv3d.get(),Ba=r.sv3d.get(),Ea=r.sv3d.get();d.copy(Ba,sa);d.copy(Ea,ya);sa=d.dot(Ba,ra);ya=d.dot(Ea,ra);d.scale(ua,ra,sa);d.subtract(Ba,Ba,ua);d.normalize(Ba,Ba);d.scale(ua,ra,ya);d.subtract(Ea,Ea,ua);d.normalize(Ea,Ea);sa=d.dot(Ba,Ea);d.cross(ua,ra,Ba);ra=d.dot(Ea,ua);return Math.atan2(ra,sa)};a.sphereOrPlanePointFromScreenPoint=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/geometryUtils/ray":function(){define("exports ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../geometry/support/vectorStacks".split(" "),
function(a,b,c,n,l,u){function v(h,d,e){const g=c.castRenderScreenPointArray3(n.copy(u.sv3d.get(),d));g[2]=0;if(!h.unprojectFromRenderScreen(g,e.origin))return null;d=c.castRenderScreenPointArray3(n.copy(u.sv3d.get(),d));d[2]=1;h=h.unprojectFromRenderScreen(d,u.sv3d.get());if(b.isNone(h))return null;l.subtract(e.direction,h,e.origin);return e}function m(h,d,e){l.copy(e.origin,h.eye);d=l.set(u.sv3d.get(),d[0],d[1],1);h=h.unprojectFromRenderScreen(d,u.sv3d.get());if(b.isNone(h))return null;l.subtract(e.direction,
h,e.origin);return e}a.fromRender=v;a.fromRenderAtEye=m;a.fromScreen=function(h,d,e){return v(h,h.screenToRender(d,c.castRenderScreenPointArray3(u.sv3d.get())),e)};a.fromScreenAtEye=function(h,d,e){return m(h,h.screenToRender(d,c.castRenderScreenPointArray3(u.sv3d.get())),e)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/geometryUtils/sphere":function(){define(["exports","../../../../geometry/support/ray","../../../../chunks/sphere",
"./ray"],function(a,b,c,n){const l=b.create();a.intersectScreen=function(u,v,m,h){v=n.fromScreenAtEye(v,m,l);return c.intersectRay(u,v,h)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/ZoomStepController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/time ../../../../../core/Logger ../../../../../core/accessorSupport/ensureType ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/set ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../PointToPointAnimationController ../../../webgl-engine/lib/Camera ../../../webgl-engine/lib/Intersector ../../../webgl-engine/lib/verticalOffsetUtils ../../../../animation/easing".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){a.ZoomStepController=function(B){function C(){var E=B.apply(this,arguments)||this;E.zoomLocation=g.create();E.tmpCamera=new k.Camera;E.tmpRayDir=g.create();E.tmpCenter=g.create();E.constraintOptions={selection:t.ConstraintTypes.ALL,interactionType:t.InteractionType.ZOOM,interactionFactor:null,interactionStartCamera:new k.Camera,interactionDirection:null,tiltMode:t.TiltMode.TUMBLE};return E}b._inheritsLoose(C,B);var D=C.prototype;D.zoomStep=function(E,
F){if(this.active){var G=this.view.state,{interactionStartCamera:O}=this.constraintOptions;this.animation.finished?O.copyFrom(G.camera):this.animation.cameraAt(1,O);this.tmpCamera.copyFrom(G.camera);G=r.newIntersector(this.view.state.viewingMode);0<E?(0===this.view.map.ground.opacity?this.intersectionHelper.intersectScreenFreePointFallback(F,this.zoomLocation,x):this.intersectionHelper.intersectScreenFreePointFallback(F,this.zoomLocation),this.intersectionHelper.intersectRay(this.tmpCamera.ray,G,
this.tmpCenter)&&(this.tmpCamera.center=this.tmpCenter)):this.intersectionHelper.intersectRay(this.tmpCamera.ray,G,this.zoomLocation)?this.tmpCamera.center=this.zoomLocation:e.copy(this.zoomLocation,this.tmpCamera.center);E=.6**E;F=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,F[0],F[1],this.view.state.camera,60);e.subtract(A,this.tmpCamera.eye,this.zoomLocation);e.normalize(A,A);G=Math.max(Math.min(14,1/Math.abs(e.dot(z,A)))*Math.abs(this.view.camera.position.z),200);if(F=
F?Math.min(F,G):G)G=g.create(),e.subtract(G,this.zoomLocation,this.tmpCamera.eye),F<e.length(G)&&(e.normalize(G,G),e.add(this.zoomLocation,this.tmpCamera.eye,e.scale(G,G,F)));this._updateCamera(this.tmpCamera,E,this.zoomLocation);this.begin(this.tmpCamera)}};D.animationSettings=function(){return{apex:null,duration:n.Milliseconds(600),easing:f.outExpo}};D._updateCamera=function(E,F,G){e.subtract(this.tmpRayDir,G,E.eye);const O=e.length(this.tmpRayDir);let K=O*F;const L=Math.max(4,1.01*E.nearFar[0]);
1>=F&&K<L&&(K=L,F=K/O);1E-6>Math.abs(O-K)||(e.scale(this.tmpRayDir,this.tmpRayDir,F),E.eye=e.subtract(w,G,this.tmpRayDir),E.center=e.lerp(w,E.center,G,1-F),p.applyAll(this.view,E,this.constraintOptions))};return C}(q.PointToPointAnimationController);a.ZoomStepController=c.__decorate([d.subclass("esri.views.3d.state.controllers.local.ZoomStepController")],a.ZoomStepController);const w=g.create(),z=g.fromValues(0,0,1),A=g.create(),x={exclude:new Set([y.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/handlers/support":function(){define(["exports"],function(a){a.eventMatchesMousePointerAction=function(b,c){if("touch"===b.pointerType)return!1;switch(c){case "primary":return 0===b.button;case "secondary":return 2===b.button;case "tertiary":return 1===b.button}};a.eventMatchesPointerAction=function(b,c){switch(c){case "primary":return"touch"===b.pointerType||0===b.button;case "secondary":return"touch"!==b.pointerType&&2===b.button;case "tertiary":return"touch"!==
b.pointerType&&1===b.button}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/DragRotate":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/RotateController ../../../input/InputHandler ../../../input/handlers/support".split(" "),function(a,b,c,n,l,u){l=function(v){function m(h,d,e,g){var p=v.call(this,!0)||this;p.view=h;p.pointerAction=d;p.pivot=e;p.registerIncoming("drag",
g,t=>p._handleDrag(t));return p}b._inheritsLoose(m,v);m.prototype._handleDrag=function(h){const d=h.data;if(!(1<d.pointers.size)&&u.eventMatchesMousePointerAction(h.data,this.pointerAction)){var e=c.createScreenPointArray(d.center.x,d.center.y);switch(d.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=new n.RotateController({view:this.view,pivot:this.pivot});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(e);
break;case "update":this.cameraController&&this.cameraController.update(e);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}h.stopPropagation()}};return m}(l.InputHandler);Object.defineProperty(a,"PivotPoint",{enumerable:!0,get:()=>n.PivotPoint});a.DragRotate=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/RotateController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A){a.PivotPoint=void 0;(function(B){B[B.CENTER=0]="CENTER";B[B.EYE=1]="EYE"})(a.PivotPoint||(a.PivotPoint={}));a.RotateController=function(B){function C(E){E=B.call(this,E)||this;E.view=null;E.pivot=a.PivotPoint.CENTER;E.lastPoint=t.create();E.tmpWorldUp=k.create();E.tmpViewDir=k.create();E.tmpRotCurPoint=t.create();E.tmpTransf=g.create();E.tmpAxis=k.create();E.tmpPivotPoint=k.create();E.pivotPos=k.create();E.constraintOptions={selection:f.ConstraintTypes.ALL,
interactionType:f.InteractionType.TUMBLE,interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:f.TiltMode.TUMBLE};return E}b._inheritsLoose(C,B);var D=C.prototype;D.initialize=function(){this.rotScale=this.pivot===a.PivotPoint.CENTER?3:1.5};D.begin=function(E){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:q.copy(this.pivotPos,this.startCamera.eye);this.constraintOptions.interactionType=f.InteractionType.LOOK_AROUND;this.constraintOptions.tiltMode=f.TiltMode.LOOK_AROUND;
this.constraintOptions.selection=f.ConstraintTypes.NONE;break;case a.PivotPoint.CENTER:{const F=this.intersectionHelper.intersectRayFreePointFallback(this.startCamera.ray,this.pivotPos);F||q.copy(this.pivotPos,this.startCamera.center);this._constrainPivotPoint(E,F);this.startCamera.center=this.pivotPos;this.constraintOptions.interactionType=f.InteractionType.TUMBLE;this.constraintOptions.tiltMode=f.TiltMode.TUMBLE;this.constraintOptions.selection=f.ConstraintTypes.ALL&~f.ConstraintTypes.DISTANCE}}this.constraintOptions.interactionStartCamera=
this.startCamera;A.normalizeCoordinate(this.startCamera,E,this.lastPoint)}};D._constrainPivotPoint=function(E,F){const G=this.startCamera,O=k.create();q.subtract(O,this.pivotPos,G.eye);const K=q.length(O);let L=Math.min(K,7*Math.abs(this.view.camera.position.z));var R=r.getReferenceEllipsoid(this.view.spatialReference),M=l.createScreenPointArray(G.width/G.pixelRatio*.5,G.height/G.pixelRatio*.5);R=A.decideNavigationMode(this.startCamera,M,!0,R);M=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,
G.fullWidth/G.pixelRatio*.5,G.fullHeight/G.pixelRatio*.5,G,225,90);E=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,E[0],E[1],G,90);if(void 0!==M||void 0!==E)M=void 0===M?E:M,E=void 0===E||R===A.NavigationMode.Horizontal?M:E,L=M>E?E:M,L=F?Math.min(L,K):L;q.normalize(O,O);q.copy(this.pivotPos,q.add(this.tmpPivotPoint,G.eye,q.scale(this.tmpPivotPoint,O,L)))};D.update=function(E){if(this.active){switch(this.pivot){case a.PivotPoint.EYE:this.currentCamera.center=this._applyRotation(this.currentCamera,
E,this.currentCamera.center,this.pivotPos);break;case a.PivotPoint.CENTER:this.currentCamera.center=this.pivotPos,this.currentCamera.eye=this._applyRotation(this.currentCamera,E,this.currentCamera.eye,this.pivotPos)}y.applyAll(this.view,this.currentCamera,this.constraintOptions)}};D.end=function(){this.active&&this.finishController()};D._applyRotation=function(E,F,G,O){this.view.renderCoordsHelper.worldUpAtPosition(O,this.tmpWorldUp);A.normalizeCoordinate(E,F,this.tmpRotCurPoint);F=(this.lastPoint[1]-
this.tmpRotCurPoint[1])*this.rotScale;let K=(this.tmpRotCurPoint[0]-this.lastPoint[0])*this.rotScale;q.subtract(this.tmpViewDir,G,O);G=q.length(this.tmpViewDir);G=n.acosClamped(q.dot(this.tmpViewDir,this.tmpWorldUp)/G);if(this.pivot===a.PivotPoint.EYE){const L=.5*Math.PI-G,R=.495*Math.PI;F=L-Math.max(-R,Math.min(R,L+-.5*F))}F=n.clamp(F+G,w.TiltDefault.min,w.TiltDefault.max)-G;q.cross(this.tmpAxis,E.up,this.tmpViewDir);this.pivot===a.PivotPoint.CENTER&&(K=-K);e.fromRotation(this.tmpTransf,K,this.tmpWorldUp);
e.rotate(this.tmpTransf,this.tmpTransf,F,this.tmpAxis);q.transformMat4(this.tmpViewDir,this.tmpViewDir,this.tmpTransf);E.up=q.transformMat4(x,E.up,this.tmpTransf);q.add(x,O,this.tmpViewDir);p.copy(this.lastPoint,this.tmpRotCurPoint);return x};b._createClass(C,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return C}(z.InteractiveController);c.__decorate([u.property({constructOnly:!0})],a.RotateController.prototype,"view",void 0);c.__decorate([u.property()],a.RotateController.prototype,
"pivot",void 0);a.RotateController=c.__decorate([d.subclass("esri.views.3d.state.controllers.RotateController")],a.RotateController);const x=k.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/InteractiveController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ./CameraController ../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){a.InteractiveController=function(g){function p(){var q=g.apply(this,arguments)||this;q.startCamera=new e.Camera;q.currentCamera=new e.Camera;return q}b._inheritsLoose(p,g);var t=p.prototype;t.stepController=function(q,k){k.copyViewFrom(this.currentCamera);this.currentCamera.copyFrom(k)};t.onControllerStart=function(q){this.state=d.State.Running;this.startCamera.copyFrom(q);this.currentCamera.copyFrom(q)};t.onControllerEnd=function(q){q.copyViewFrom(this.currentCamera)};
b._createClass(p,[{key:"isInteractive",get:function(){return!0}}]);return p}(d.CameraController);a.InteractiveController=c.__decorate([h.subclass("esri.views.3d.state.controllers.InteractiveController")],a.InteractiveController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/DragZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomController ../../state/controllers/local/ZoomController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,n,l,u,v){u=function(m){function h(d,e,g){var p=m.call(this,!0)||this;p.view=d;p.pointerAction=e;p.registerIncoming("drag",g,t=>p._handleDrag(t));return p}b._inheritsLoose(h,m);h.prototype._handleDrag=function(d){const e=d.data;if(!(1<e.pointers.size)&&v.eventMatchesMousePointerAction(d.data,this.pointerAction)){var g=c.createScreenPointArray(e.center.x,e.center.y);switch(e.action){case "start":this.cameraController&&(this.cameraController.end(),this.cameraController=null);this.cameraController=
this.view.state.isGlobal?new n.ZoomController({view:this.view}):new l.ZoomController({view:this.view});this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(g);break;case "update":this.cameraController&&this.cameraController.update(g);break;case "end":this.cameraController&&(this.cameraController.end(),this.cameraController=null)}d.stopPropagation()}};return h}(u.InputHandler);a.DragZoom=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils ../../../support/geometryUtils/ray ../../../webgl-engine/lib/verticalOffsetUtils ../../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B){a.ZoomController=function(E){function F(O){O=E.call(this,O)||this;O.view=null;O.pickPoint=t.create();O.tmpP0=g.create();O.panAxisAngle=k.create();O.tmpRayDir=t.create();O.tmpRayDirPick=t.create();O.targetOnSphere=t.create();O.tmpRay={origin:t.create(),direction:t.create()};O.dragBeginPoint=l.createScreenPointArray();O.normalizedAnchorPoint=g.create();O.constraintOptions={selection:f.ConstraintTypes.ALL_EXCEPT_COLLISION,interactionType:f.InteractionType.ZOOM,
interactionFactor:0,interactionStartCamera:null,interactionDirection:null,tiltMode:f.TiltMode.TUMBLE};O.sphere=r.create();O.hasPickPoint=!1;return O}b._inheritsLoose(F,E);var G=F.prototype;G.begin=function(O){if(this.active){e.copy(this.dragBeginPoint,O);z.normalizeCoordinate(this.startCamera,O,this.normalizedAnchorPoint);var K=q.getReferenceEllipsoid(this.view.spatialReference),L=z.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,O,K,z.SpherePickPointFallback.Ellipsoid,0===this.view.map.ground.opacity?
D:{});this.navMode=z.decideNavigationMode(this.startCamera,O,L.hasGeometryIntersection,K);if(this.navMode===z.NavigationMode.Horizontal)this.hasPickPoint=!!L.scenePickPoint,this.pickPoint=L.scenePickPoint,this.sphere=L.sphere;else{A.fromScreenAtEye(this.startCamera,O,this.tmpRay);p.normalize(this.tmpRay.direction,this.tmpRay.direction);let R,M;L.scenePickPoint&&(p.subtract(this.tmpRayDirPick,this.startCamera.eye,L.scenePickPoint),M=p.length(this.tmpRayDirPick));this.view.camera.position.hasZ&&(R=
Math.abs(this.view.camera.position.z));K=n.clamp(z.PIVOT_DISTANCE_MODIFIER*R,z.DISTANCE_CLAMP_VALUES[0],z.DISTANCE_CLAMP_VALUES[1]);K=(O=this.view._stage.renderView.getMinimalDepthForArea(null,O[0],O[1],this.view.state.camera,z.SCREEN_PIXEL_AREA))?Math.min(K,O):K;K=L.scenePickPoint?Math.min(K,M):K;this.hasPickPoint=!0;p.scale(this.tmpRay.direction,this.tmpRay.direction,K);p.add(this.pickPoint,this.tmpRay.origin,this.tmpRay.direction)}this.constraintOptions.interactionStartCamera=this.startCamera}};
G.update=function(O){if(this.active){this.currentCamera.eye=this.startCamera.eye;this.currentCamera.center=this.startCamera.center;this.currentCamera.up=this.startCamera.up;if(this.navMode===z.NavigationMode.Horizontal){p.subtract(this.tmpRayDir,this.currentCamera.center,this.currentCamera.eye);var K=p.length(this.tmpRayDir);z.normalizeCoordinate(this.currentCamera,O,this.tmpP0);var L=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]),R=K*2**L;const M=this.view.state.constraints.minimumPoiDistance;
0>L&&R<M&&(R=M);if(1E-6>Math.abs(K-R))return;this.hasPickPoint&&R<K&&(L=1-(1-R/K)*(1-this.sphere[3]/p.length(this.currentCamera.center)),this.currentCamera.center=p.scale(C,this.currentCamera.center,L));p.scale(this.tmpRayDir,this.tmpRayDir,-R/K);this.currentCamera.eye=p.add(C,this.currentCamera.center,this.tmpRayDir);this.constraintOptions.interactionFactor=y.pixelDistanceToInteractionFactor(this.dragBeginPoint,O);y.applyAll(this.view,this.currentCamera,this.constraintOptions);this.hasPickPoint&&
(z.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,this.dragBeginPoint,this.targetOnSphere),k.fromPoints(this.pickPoint,this.targetOnSphere,this.panAxisAngle),z.applyRotation(this.currentCamera,this.sphere,this.panAxisAngle))}else{K=p.length(this.tmpRay.direction);z.normalizeCoordinate(this.currentCamera,O,this.tmpP0);O=12*(this.normalizedAnchorPoint[1]-this.tmpP0[1]);R=K*2**O;L=this.view.state.constraints.minimumPoiDistance;0>O&&R<L&&(R=L);if(1E-6>Math.abs(K-R))return;p.scale(this.tmpRayDir,
this.tmpRay.direction,1-R/K);this.currentCamera.eye=p.add(C,this.currentCamera.eye,this.tmpRayDir);this.currentCamera.center=p.add(C,this.currentCamera.center,this.tmpRayDir)}B.applySurfaceCollisionConstraint(this.view,this.currentCamera)}};G.end=function(){this.active&&this.finishController()};b._createClass(F,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return F}(w.InteractiveController);c.__decorate([u.property({constructOnly:!0})],a.ZoomController.prototype,
"view",void 0);a.ZoomController=c.__decorate([d.subclass("esri.views.3d.state.controllers.global.ZoomController")],a.ZoomController);const C=t.create(),D={exclude:new Set([x.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/ZoomController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec2f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../InteractiveController ../../utils/navigationUtils ../../../webgl-engine/lib/verticalOffsetUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){a.ZoomController=function(x){function B(D){D=x.call(this,D)||this;D.view=null;D.tmpP=t.create();D.tmpDir=t.create();D.tmpN=t.create();D.tmpP0=g.create();D.tmpPoi=t.create();D.tmpRayDir=t.create();D.dragBeginPoint=l.createScreenPointArray();D.normalizedAnchorPoint=g.create();D.constraintOptions={selection:r.ConstraintTypes.ALL,interactionType:r.InteractionType.ZOOM,interactionFactor:0,interactionStartCamera:null,interactionDirection:t.create(),tiltMode:r.TiltMode.TUMBLE};
D.plane=q.create();return D}b._inheritsLoose(B,x);var C=B.prototype;C.begin=function(D){if(this.active){e.copy(this.dragBeginPoint,D);f.normalizeCoordinate(this.startCamera,D,this.normalizedAnchorPoint);var E=this.intersectionHelper.intersectScreenFreePointFallback(D,this.tmpP,0===this.view.map.ground.opacity?A:{});p.subtract(this.tmpDir,this.tmpP,this.startCamera.eye);var F=p.length(this.tmpDir);p.normalize(this.tmpDir,this.tmpDir);var G;this.view.camera.position.hasZ&&(G=Math.abs(this.view.camera.position.z));
G=n.clamp(f.PIVOT_DISTANCE_MODIFIER*G,f.DISTANCE_CLAMP_VALUES[0],f.DISTANCE_CLAMP_VALUES[1]);G=(D=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,D[0],D[1],this.view.state.camera,f.SCREEN_PIXEL_AREA))?Math.min(G,D):G;G=E?Math.min(G,F):G;p.scale(this.tmpDir,this.tmpDir,G);p.add(this.tmpP,this.startCamera.eye,this.tmpDir);p.subtract(this.tmpN,this.startCamera.eye,this.startCamera.center);p.normalize(this.tmpN,this.tmpN);0>this.tmpN[1]&&p.negate(this.tmpN,this.tmpN);q.fromPositionAndNormal(this.tmpP,
this.tmpN,this.plane);this.constraintOptions.interactionStartCamera=this.startCamera}};C.update=function(D){if(this.active){f.intersectPlaneFromScreenPoint(this.plane,this.currentCamera,this.dragBeginPoint,this.tmpPoi)||p.copy(this.tmpPoi,this.currentCamera.center);f.normalizeCoordinate(this.currentCamera,D,this.tmpP0);var E=4*(this.tmpP0[1]-this.normalizedAnchorPoint[1]);e.copy(this.normalizedAnchorPoint,this.tmpP0);p.subtract(this.tmpRayDir,this.tmpPoi,this.currentCamera.eye);var F=p.length(this.tmpRayDir),
G=F*(1-E);p.copy(this.constraintOptions.interactionDirection,this.tmpRayDir);p.scale(this.constraintOptions.interactionDirection,this.constraintOptions.interactionDirection,Math.sign(E)/F);var O=this.view.state.constraints.minimumPoiDistance;0<=E&&G<O&&(G=O,E=-(G-F)/F);1E-6>Math.abs(F-G)||(p.scale(this.tmpRayDir,this.tmpRayDir,E),this.currentCamera.eye=p.add(z,this.currentCamera.eye,this.tmpRayDir),p.lerp(z,this.currentCamera.center,this.tmpPoi,E),z[2]=this.tmpPoi[2]>this.startCamera.center[2]?Math.max(this.startCamera.center[2],
z[2]):Math.min(this.startCamera.center[2],z[2]),this.currentCamera.center=z,this.constraintOptions.interactionFactor=k.pixelDistanceToInteractionFactor(this.dragBeginPoint,D),k.applyAll(this.view,this.currentCamera,this.constraintOptions))}};C.end=function(){this.active&&this.finishController()};b._createClass(B,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return B}(y.InteractiveController);c.__decorate([u.property({constructOnly:!0})],a.ZoomController.prototype,
"view",void 0);a.ZoomController=c.__decorate([d.subclass("esri.views.3d.state.controllers.local.ZoomController")],a.ZoomController);const z=t.create(),A={exclude:new Set([w.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/GamepadNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/reactiveUtils ../../state/controllers/GamepadKeyboardController ../../../input/InputHandler".split(" "),
function(a,b,c,n,l,u){u=function(v){function m(d){var e=v.call(this,!0)||this;e.view=d;e.watchHandles=new c;e.handle=e.registerIncoming("gamepad",g=>e._handleEventGamepad(g));e.handle.pause();return e}b._inheritsLoose(m,v);var h=m.prototype;h.onInstall=function(d){v.prototype.onInstall.call(this,d);this.watchHandles.add([n.watch(()=>this.view.navigation.gamepad.enabled,e=>{e?this.handle.resume():(this.handle.pause(),this.cameraControllerGamepad&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=
null))},n.initial),n.watch(()=>this.view.navigation.gamepad.device,e=>{this.cameraControllerGamepad&&e&&this.cameraControllerGamepad.gamepadDevice!==e&&(this.cameraControllerGamepad.finishController(),this.cameraControllerGamepad=null)})])};h.onUninstall=function(){this.watchHandles.removeAll();v.prototype.onUninstall.call(this)};h._handleEventGamepad=function(d){var e=this.view.navigation.gamepad.device;if(!e||d.data.device===e)if((e=this.cameraControllerGamepad&&this.cameraControllerGamepad.active)||
l.GamepadKeyboardController.activatesFor(this.view,d.data))e||(e=new l.GamepadKeyboardController({view:this.view,gamepadDevice:d.data.device}),this.view.state.switchCameraController(e)&&(this.cameraControllerGamepad=e)),this.cameraControllerGamepad&&this.cameraControllerGamepad.active&&this.cameraControllerGamepad.gamepadDevice===d.data.device&&this.cameraControllerGamepad.handleEventGamepad(d.data)};return m}(u.InputHandler);a.GamepadNavigation=u;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/GamepadKeyboardController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/compilerUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/ray ../../../../chunks/sphere ../../../../geometry/support/vectorStacks ../../camera/constraintUtils ../../camera/constraintUtils/common ../Constraints ./InteractiveController ../utils/navigationUtils ../utils/viewUtils ../../support/cameraUtils ../../support/cameraUtilsInternal ../../webgl-engine/lib/Camera ../../../navigation/gamepadAndKeyboardUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G){a.GamepadKeyboardController=function(N){function V(T){T=N.call(this,T)||this;T.transformation={translation:[0,0,0],heading:0,tilt:0,zoom:0};T.keysButtonState=[0,0,0,0,0,0,0,0,0,0,0,0];T.tmpCamera=new F.Camera;T.constraintOptions={selection:z.ConstraintTypes.ALL,interactionType:z.InteractionType.NONE,interactionStartCamera:new F.Camera,interactionFactor:0,interactionDirection:null,tiltMode:z.TiltMode.LOOK_AROUND};return T}b._inheritsLoose(V,
N);var S=V.prototype;S.handleEventGamepad=function(T){const H=G.extractTransformation(T,this.view.navigation.gamepad,this.transformation);("end"===T.action||G.isZeroTransformation(H))&&this.finishController()};S.activateDirection=function(T){this.keysButtonState[T]=1;G.extractTransformationKeyboard(this.keysButtonState,this.transformation)};S.deactivateDirection=function(T){this.keysButtonState[T]=0;T=G.extractTransformationKeyboard(this.keysButtonState,this.transformation);G.isZeroTransformation(T)&&
this.finishController()};S.onControllerStart=function(T){this.filteredSurfaceElevation=this.view.pointsOfInterest.cameraOnSurface.location.z;this.headingStart=this.view.camera.heading;N.prototype.onControllerStart.call(this,T)};S._updateFilteredSurfaceElevation=function(T){this.filteredSurfaceElevation+=(this.view.pointsOfInterest.cameraOnSurface.location.z-this.filteredSurfaceElevation)*T};S.stepController=function(T,H){this._updateStartHeading();this._updateFilteredSurfaceElevation(T);this.currentCamera.copyViewFrom(H);
this._updateCameraCenter();this.constraintOptions.interactionStartCamera.copyFrom(this.currentCamera);this._calculateControlTransformation(T,this.currentCamera,M);this._applyDisabledMovementTypes(M);this._applyPan(M.pan);this._applyRotate(M.rotate);this._applyZoom(M.zoom);this._applyAscend(M.ascend);this.constraintOptions.interactionType=z.InteractionType.NONE;this.constraintOptions.selection=z.ConstraintTypes.COLLISION;w.applyAll(this.view,this.currentCamera,this.constraintOptions);N.prototype.stepController.call(this,
T,H)};S._updateStartHeading=function(){0!==this.transformation.heading&&(this.headingStart=this.view.camera.heading)};S._applyRotate=function(T){if(T.enabled){var H=this.currentCamera;t.subtract(J,H.center,H.eye);t.transformMat4(J,J,T.matrix);H.center=t.add(J,J,H.eye);H.up=t.transformMat4(J,H.up,T.matrix);this.constraintOptions.interactionType=z.InteractionType.LOOK_AROUND;this.constraintOptions.selection=z.ConstraintTypes.ALL_EXCEPT_COLLISION;w.applyAll(this.view,H,this.constraintOptions)}};S._applyPan=
function(T,H=this.currentCamera){T.enabled&&(H.eye=t.transformMat4(J,H.eye,T.matrix),H.center=t.transformMat4(J,H.center,T.matrix),this.view.state.isGlobal&&(H.up=t.transformMat4(J,H.up,T.matrix)),this.constraintOptions.interactionType=z.InteractionType.PAN,this.constraintOptions.selection=z.ConstraintTypes.ALL,w.applyAll(this.view,H,this.constraintOptions))};S._applyZoom=function(T){if(T){var H=this.currentCamera.viewForward;this.currentCamera.eye=t.add(J,this.currentCamera.eye,t.scale(f.sv3d.get(),
H,T));t.copy(I,H);t.negate(I,I);this.constraintOptions.interactionDirection=I;this.constraintOptions.interactionType=z.InteractionType.ZOOM;this.constraintOptions.selection=z.ConstraintTypes.ALL_EXCEPT_COLLISION;w.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};S._applyAscend=function(T){if(T){var H=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,f.sv3d.get());this.constraintOptions.interactionDirection=t.copy(I,
H);this.view.state.isGlobal?(H=t.length(this.currentCamera.eye),T=(H+T)/H,this.currentCamera.eye=t.scale(J,this.currentCamera.eye,T),this.currentCamera.center=t.scale(J,this.currentCamera.center,T)):(T=t.scale(f.sv3d.get(),H,T),this.currentCamera.eye=t.add(J,this.currentCamera.eye,T),this.currentCamera.center=t.add(J,this.currentCamera.center,T));this._updateCameraCenter();this.constraintOptions.interactionType=z.InteractionType.ASCEND;this.constraintOptions.selection=z.ConstraintTypes.COLLISION;
w.applyAll(this.view,this.currentCamera,this.constraintOptions)&&this._updateCameraCenter();this.constraintOptions.selection=z.ConstraintTypes.ALL_EXCEPT_COLLISION;w.applyAll(this.view,this.currentCamera,this.constraintOptions);this.constraintOptions.interactionDirection=null}};S._calculateControlTransformation=function(T,H,U){U.zoom=0;U.ascend=0;U.pan.enabled=!1;g.identity(U.pan.matrix);U.rotate.enabled=!1;g.identity(U.rotate.matrix);T=this._computeVelocities(T);this.view.state.isLocal?this._calculateControlTransformationLocal(T,
H,U):this._calculateControlTransformationGlobal(T,H,U)};S._updateCameraCenter=function(){this.currentCamera.center=this.view.renderCoordsHelper.intersectManifoldClosestSilhouette(this.currentCamera.ray,this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude,J)};S._calculateControlTransformationLocal=function(T,H,U){const {viewRight:W,viewForward:Q}=H,X=this.transformation;var ba=this.view.navigation.gamepad,aa=t.set(f.sv3d.get(),Q[0],Q[1],0);t.normalize(aa,aa);var ea=X.translation[0]*
T.pan;0!==ea&&(ea=t.scale(f.sv3d.get(),W,ea),g.translate(U.pan.matrix,U.pan.matrix,ea),U.pan.enabled=!0);switch(ba.mode){case "pan":ba=-X.translation[1]*T.pan;0!==ba&&(aa=t.scale(f.sv3d.get(),aa,ba),g.translate(U.pan.matrix,U.pan.matrix,aa),U.pan.enabled=!0);U.zoom=X.zoom*T.zoom;break;case "zoom":U.zoom=(-X.translation[1]+X.zoom)*T.zoom;break;default:n.neverReached(ba.mode)}U.ascend=X.translation[2]*T.ascend;aa=-X.heading*T.rotate;0!==aa&&(g.rotate(U.rotate.matrix,U.rotate.matrix,aa,this.view.renderCoordsHelper.worldUpAtPosition(H.eye,
f.sv3d.get())),U.rotate.enabled=!0);T=X.tilt*T.rotate;H=C.viewAngle(this.view.renderCoordsHelper,H.center,H.eye);if(H=l.clamp(H+T,A.TiltDefault.min,A.TiltDefault.max)-H)g.rotate(U.rotate.matrix,U.rotate.matrix,H,W),U.rotate.enabled=!0};S._calculateControlTransformationGlobal=function(T,H,U){const {eye:W,viewRight:Q}=H,X=this.transformation;var ba=this.view.navigation.gamepad,aa=t.cross(f.sv3d.get(),Q,W);t.normalize(aa,aa);t.negate(aa,aa);B.panMotionToRotationMatrix(this.startCamera,H,X,T,this.view.camera.heading,
this.headingStart,this.view.camera.tilt,U,ba);this.tmpCamera.copyFrom(this.currentCamera);this._applyPan(M.pan,this.tmpCamera);ba=this.view.pointsOfInterest.centerOnSurfaceFrequent.estimatedSurfaceAltitude;U.ascend=X.translation[2]*T.ascend;aa=-X.heading*T.rotate;0!==aa&&(g.rotate(U.rotate.matrix,U.rotate.matrix,aa,this.tmpCamera.eye),U.rotate.enabled=!0);H=this._clampTiltDeltaGlobalToValidRange(X.tilt*T.rotate,H.ray,ba);0!==H&&(g.rotate(U.rotate.matrix,U.rotate.matrix,H,this.tmpCamera.viewRight),
U.rotate.enabled=!0);U.zoom+=X.zoom*T.zoom};S._clampTiltDeltaGlobalToValidRange=function(T,H,U){const W=k.getReferenceEllipsoid(this.view.spatialReference),Q=B.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.min,H.origin,U,W);var X=0;let ba=0;X=f.sv3d.get();this.view.renderCoordsHelper.intersectManifold(H,U,X)?(X=C.viewAngle(this.view.renderCoordsHelper,X,H.origin),X=B.onSurfaceTiltToEyeTiltGlobal(X,H.origin,U,W),ba=B.onSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,H.origin,U,W)):(y.closestPointOnSilhouette(y.fromRadius(y.tmpSphere,
U+W.radius),H,X),X=l.acosClamped(-t.dot(H.direction,t.normalize(X,X))),X=B.offSurfaceTiltToEyeTiltGlobal(X,H.origin,U,W),ba=B.offSurfaceTiltToEyeTiltGlobal(A.TiltDefault.max,H.origin,U,W));return l.clamp(X+T,Q,ba)-X};S._getPointAbsoluteSurfaceElevation=function(T,H,U){const {renderCoordsHelper:W}=this.view,Q=W.getAltitude(T);H+=Math.abs(Q-H);W.setAltitude(U,H,T);return H};S._clampedDistanceToSurface=function(T,H){const {renderCoordsHelper:U}=this.view,{camera:W}=this.view.state;var {direction:Q}=
D.headingTiltToDirectionUp(this.view,H,0,80,P);Q=U.intersectManifoldClosestSilhouette(r.wrap(H,Q),T,f.sv3d.get());Q=t.distance(H,Q);T=U.intersectManifoldClosestSilhouette(r.wrap(H,t.direction(f.sv3d.get(),H,W.center)),T,f.sv3d.get());H=t.distance(H,T);return Math.min(Q,H)};S._computeHeadingRotateRadius=function(T){const {renderCoordsHelper:H,state:U}=this.view,{camera:W,isGlobal:Q}=U;var X=H.intersectManifoldClosestSilhouette(W.ray,this.filteredSurfaceElevation,f.sv3d.get());if(Q){const ba=t.subtract(f.sv3d.get(),
T,X);X=t.length(ba);t.scale(ba,ba,1/X);T=t.normalize(f.sv3d.get(),T);T=l.acosClamped(t.dot(T,ba));return X*Math.sin(Math.min(K,T))}T=t.copy(f.sv3d.get(),T);H.setAltitude(T,this.filteredSurfaceElevation);return t.distance(X,T)};S._minimumAscendVelocity=function(){return this.view.state.constraints.collision.enabled?0:5};S._computeVelocities=function(T){var H=this.filteredSurfaceElevation,U=H+k.getReferenceEllipsoid(this.view.spatialReference).radius;const {camera:W,isGlobal:Q}=this.view.state;var X=
f.sv3d.get();const ba=this._getPointAbsoluteSurfaceElevation(W.eye,H,X);var aa=this._clampedDistanceToSurface(H,X);const ea=W.width/2,ia=.75*W.width,ka=.75*W.width;var la=aa*Math.tan(.5*W.fovX)/ea;U=la/U;X=la/this._computeHeadingRotateRadius(X);la=(Q?U:la)*ia*T;H=ba-H;H=Math.max(this._minimumAscendVelocity()*T,2**(ia*T/ea)*H-H);aa=2**(ia*T/ea)*aa-aa;T*=l.clamp(X*ka,L,R);return{pan:la,ascend:H,zoom:aa,rotate:T}};S._applyDisabledMovementTypes=function(T){!u.isSome(this.disableMovements)||void 0!==this.disableMovements.mode&&
this.view.state.viewingMode!==this.disableMovements.mode||(T.zoom=this.disableMovements.zoom?0:T.zoom,T.ascend=this.disableMovements.ascend?0:T.ascend,T.pan.enabled=!this.disableMovements.pan,this.disableMovements.pan&&g.identity(T.pan.matrix),T.rotate.enabled=!this.disableMovements.rotate,this.disableMovements.rotate&&g.identity(T.rotate.matrix))};V.activatesFor=function(T,H){T=G.extractTransformation(H,T.navigation.gamepad,O);return!("end"===H.action||G.isZeroTransformation(T))};return V}(x.InteractiveController);
c.__decorate([v.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"view",void 0);c.__decorate([v.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"gamepadDevice",void 0);c.__decorate([v.property({constructOnly:!0})],a.GamepadKeyboardController.prototype,"disableMovements",void 0);a.GamepadKeyboardController=c.__decorate([e.subclass("esri.views.3d.state.controllers.GamepadKeyboardController")],a.GamepadKeyboardController);const O={translation:[0,0,0],heading:0,
tilt:0,zoom:0},K=l.deg2rad(80),L=l.deg2rad(30),R=l.deg2rad(80),M={zoom:0,ascend:0,pan:{enabled:!1,matrix:p.create()},rotate:{enabled:!1,matrix:p.create()}},J=q.create(),I=q.create(),P=E.createDirectionUp();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/gamepadAndKeyboardUtils":function(){define(["exports","../../chunks/vec3"],function(a,b){function c(n){let l=n*n;0>n&&(l*=-1);return l}a.extractTransformation=function(n,l,u){const v=
n.state;n=n.device;l="forward-down"===l.tiltDirection?1:-1;"standard"===n.deviceType?(u.translation[0]=c(v.axes[0]),u.translation[1]=c(v.axes[1]),u.translation[2]=c(v.buttons[7])-c(v.buttons[6]),u.heading=c(v.axes[2]),u.tilt=c(v.axes[3])):"spacemouse"===n.deviceType&&(u.translation[0]=1.2*c(v.axes[0]),u.translation[1]=1.2*c(v.axes[1]),u.translation[2]=2*-c(v.axes[2]),u.heading=1.2*c(v.axes[5]),u.tilt=1.2*c(v.axes[3]));u.tilt*=l;b.scale(u.translation,u.translation,1);return u};a.extractTransformationKeyboard=
function(n,l){l.translation[0]=n[1]-n[0];l.translation[1]=n[3]-n[2];l.translation[2]=n[4]-n[5];l.heading=n[7]-n[6];l.tilt=n[8]-n[9];l.zoom=n[10]-n[11];return l};a.isZeroTransformation=function(n){return 0===n.translation[0]&&0===n.translation[1]&&0===n.translation[2]&&0===n.heading&&0===n.tilt&&0===n.zoom};a.quadraticAccentuation=c;a.resetTransformation=function(n){n.translation[0]=0;n.translation[1]=0;n.translation[2]=0;n.heading=0;n.tilt=0;return n};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/KeyboardNavigation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../ViewingMode","../../state/controllers/GamepadKeyboardController","../../../input/InputHandler"],function(a,b,c,n,l){var u;(function(v){v[v.LEFT=0]="LEFT";v[v.RIGHT=1]="RIGHT";v[v.FORWARD=2]="FORWARD";v[v.BACKWARD=3]="BACKWARD";v[v.UP=4]="UP";v[v.DOWN=5]="DOWN";v[v.HEADINGLEFT=6]="HEADINGLEFT";v[v.HEADINGRIGHT=7]="HEADINGRIGHT";
v[v.TILTUP=8]="TILTUP";v[v.TILTDOWN=9]="TILTDOWN";v[v.ZOOMIN=10]="ZOOMIN";v[v.ZOOMOUT=11]="ZOOMOUT"})(u||(u={}));l=function(v){function m(d,e){var g=v.call(this,!0)||this;g.view=d;g.disableMovements={pan:!0,zoom:!1,ascend:!0,rotate:!1,mode:c.ViewingMode.Local};g.keyToNumber={[e.left]:u.LEFT,[e.right]:u.RIGHT,[e.forward]:u.FORWARD,[e.backward]:u.BACKWARD,[e.up]:u.UP,[e.down]:u.DOWN,[e.headingLeft]:u.HEADINGLEFT,[e.headingRight]:u.HEADINGRIGHT,[e.tiltUp]:u.TILTUP,[e.tiltDown]:u.TILTDOWN,[e.zoomIn]:u.ZOOMIN,
[e.zoomOut]:u.ZOOMOUT};g.registerIncoming("key-down",null,p=>g._handleKeyDown(p));g.registerIncoming("key-up",null,p=>g._handleKeyUp(p));g.registerIncoming("blur",null,()=>g._handleBlur());return g}b._inheritsLoose(m,v);var h=m.prototype;h._handleKeyDown=function(d){if(!d.data.native.ctrlKey&&!d.data.native.metaKey){var e=this.keyToNumber[d.data.key];null!=e&&(this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active||(this.cameraControllerKeyboard=new n.GamepadKeyboardController({view:this.view,
disableMovements:this.disableMovements}),this.view.state.switchCameraController(this.cameraControllerKeyboard)),this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.activateDirection(e),d.stopPropagation()))}};h._handleBlur=function(){this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.finishController(),this.cameraControllerKeyboard=null)};h._handleKeyUp=function(d){if(!d.data.native.ctrlKey&&!d.data.native.metaKey){var e=this.keyToNumber[d.data.key];
null!=e&&this.cameraControllerKeyboard&&this.cameraControllerKeyboard.active&&(this.cameraControllerKeyboard.deactivateDirection(e),d.stopPropagation())}};return m}(l.InputHandler);a.KeyboardNavigation=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/MouseWheelZoom":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/screenUtils ../../state/controllers/global/ZoomStepController ../../state/controllers/local/ZoomStepController ../../../input/InputHandler".split(" "),
function(a,b,c,n,l,u){u=function(v){function m(h,d){var e=v.call(this,!0)||this;e.view=h;e.registerIncoming("mouse-wheel",d,g=>e._handleMouseWheel(g));return e}b._inheritsLoose(m,v);m.prototype._handleMouseWheel=function(h){if(this.view.navigation.mouseWheelZoomEnabled){var d=h.data;this.cameraController&&this.cameraController.active||(this.cameraController=this.view.state.isGlobal?new n.ZoomStepController({view:this.view,mode:"interaction"}):new l.ZoomStepController({view:this.view,mode:"interaction"}),
this.view.state.switchCameraController(this.cameraController));this.cameraController.zoomStep(-1/60*d.deltaY,c.createScreenPointArray(d.x,d.y));h.preventDefault();h.stopPropagation()}};return m}(u.InputHandler);a.MouseWheelZoom=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/PinchAndPanNavigation":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../state/controllers/global/PinchAndPanController ../../state/controllers/local/PinchAndPanController ../../../input/InputHandler ../../../input/handlers/support".split(" "),
function(a,b,c,n,l,u){l=function(v){function m(d,e,g){var p=v.call(this,!0)||this;p.view=d;p.pointerAction=e;p.lastEndTimestamp=0;p.lastTimestamp=0;p.registerIncoming("drag",g,t=>p._handleDrag(t));return p}b._inheritsLoose(m,v);var h=m.prototype;h._handleDrag=function(d){if("mouse"!==d.data.pointerType||u.eventMatchesMousePointerAction(d.data,this.pointerAction)){var e=d.timestamp-this.lastEndTimestamp;e=this.momentum&&this.momentum.active&&40>e;switch(d.data.action){case "start":case "update":if(e)break;
this.controller&&this.controller.active?2<d.data.timestamp-this.lastTimestamp&&(this.controller.update(d.data),this.lastTimestamp=d.timestamp):this._startController(d);break;case "end":case "removed":this._endController(d,!0);break;case "added":this._endController(d,!1),this._startController(d)}d.stopPropagation()}};h._endController=function(d,e){this.controller&&this.controller.active&&(this.lastEndTimestamp=d.timestamp,d=this.controller.end(d.data),e&&d&&(this.momentum=d,this.view.state.switchCameraController(this.momentum)));
this.controller=null};h._startController=function(d){this.controller=this._createController();this.view.state.switchCameraController(this.controller);this.controller.begin(d.data);this.lastTimestamp=d.timestamp};h._createController=function(){return this.view.state.isGlobal?new c.PinchAndPanController({view:this.view}):new n.PinchAndPanController({view:this.view})};return m}(l.InputHandler);a.PinchAndPanNavigation=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/global/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Cyclical ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec2 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/projectionEllipsoid ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../../../chunks/sphere ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/PanSphericalMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../momentum/ZoomSphericalMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/PanSphericalMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R){a.PinchAndPanController=function(M){function J(P){P=M.call(this,P)||this;P.view=null;P.smoothRotation=new z.ExponentialFalloff(.05);P.rotationAxis=t.create();P.panningPlane=r.create();P.smoothScaling=new z.ExponentialFalloff(.05);P.zoomCenterScreen=u.createScreenPointArray();P.zoomMomentumEstimator=new R.ZoomMomentumEstimator;P.rotationMomentumEstimator=new L.RotationMomentumEstimator;P.panSphericalMomentumEstimator=new K.PanSphericalMomentumEstimator;
P.panPlanarMomentumEstimator=new O.PanPlanarMomentumEstimator;P.adjustedSphere=y.create();P.tmp3d=t.create();P.tmpScreenPointArray=u.createScreenPointArray();P.beginScreenPoint=u.createScreenPointArray();P.beginScenePoint=t.create();P.screenPickPoint=u.createScreenPointArray();P.navMode=F.NavigationMode.Horizontal;P.tmpInteractionDirection=t.create();P.constraintOptions={selection:w.ConstraintTypes.ALL,interactionType:w.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new G.Camera,
interactionDirection:null,tiltMode:w.TiltMode.TUMBLE};return P}b._inheritsLoose(J,M);var I=J.prototype;I.begin=function(P){if(this.active){var N=this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=N;this.rotationMomentumEstimator.enabled=N;this.panPlanarMomentumEstimator.enabled=N;this.panSphericalMomentumEstimator.enabled=N;this.beginHeading=-n.cyclicalPI.normalize(l.deg2rad(this.view.camera.heading));this.beginRadius=P.radius;this.pointerCount=P.pointers.size;this.beginAngle=
P.angle;this.smoothRotation.reset();u.screenPointObjectToArray(P.center,this.screenPickPoint);g.copy(this.beginScreenPoint,this.screenPickPoint);N=q.getReferenceEllipsoid(this.view.spatialReference);var V=F.pickPointAndInitSphere(this.intersectionHelper,this.startCamera,this.screenPickPoint,N,F.SpherePickPointFallback.Silhouette);this.scenePickPoint=V.scenePickPoint;this.sphere=V.sphere;p.copy(this.beginScenePoint,this.scenePickPoint);this.navMode=F.decideNavigationMode(this.startCamera,this.screenPickPoint,
V.hasGeometryIntersection,N);this.navMode===F.NavigationMode.Vertical&&this._preparePlanarPanMode(P);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};I._preparePlanarPanMode=function(P){var N=p.negate(this.tmp3d,this.startCamera.viewForward);r.fromPositionAndNormal(this.scenePickPoint,N,this.panningPlane);var V=u.createScreenPointArray(this.screenPickPoint[0],0);N=t.create();var S=p.length(this.startCamera.eye);this.adjustedSphere[3]=S<this.sphere[3]?S-100:this.sphere[3];
F.sphereOrPlanePointFromScreenPoint(this.adjustedSphere,this.startCamera,V,N);V=u.createRenderScreenPointArray3();this.startCamera.projectToRenderScreen(N,V);this.screenPickPoint[1]=Math.min(this.screenPickPoint[1],.9*V[1]);(N=this.intersectionHelper.intersectScreen(this.screenPickPoint,this.scenePickPoint))&&r.fromPositionAndNormal(this.scenePickPoint,r.normal(this.panningPlane),this.panningPlane);V=t.create();S=t.create();const T=t.create();p.subtract(V,this.scenePickPoint,this.currentCamera.eye);
const H=p.length(V);p.normalize(V,V);var U=5*Math.max(Math.abs(this.view.camera.position.z),50);const W=this.view._stage.renderView.getMinimalDepthForArea(null,this.screenPickPoint[0],this.screenPickPoint[1],this.view.state.camera,80);U=W?Math.min(W,U):U;U=N?Math.min(U,H):U;p.copy(T,p.add(S,this.currentCamera.eye,p.scale(S,V,U)));this.panningPlane[3]=-p.dot(this.panningPlane,T);this.startCamera.center=p.add(S,this.startCamera.eye,p.scale(S,this.startCamera.viewForward,U));P=u.screenPointObjectToArray(P.center,
this.tmpScreenPointArray);F.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.startCamera,P,this.beginScenePoint)};I.update=function(P){if(this.active){this.currentCamera.copyFrom(this.startCamera);var N=1<P.pointers.size;this.navMode===F.NavigationMode.Horizontal?(N&&this._zoomSpherical(P),this._panningSpherical(P),N&&this._rotateSpherical(P)):(N&&this._zoomPlanar(P),this._panningPlanar(P),N&&this._rotatePlanar(P))}};I.end=function(P){P.pointers.size===this.pointerCount&&this.update(P);this.finishController();
if(P=this.zoomMomentumEstimator.evaluateMomentum())return this.navMode===F.NavigationMode.Horizontal?new E.ZoomSphericalMomentumController({view:this.view,momentum:P,screenCenter:this.zoomCenterScreen,sceneCenter:this.beginScenePoint,radius:this.sphere[3]}):new D.ZoomPlanarMomentumController({view:this.view,momentum:P,zoomCenter:this.beginScenePoint});if(P=this.rotationMomentumEstimator.evaluateMomentum())return new C.RotationMomentumController({view:this.view,momentum:P,center:this.sphere,axis:this.rotationAxis});
if(this.navMode===F.NavigationMode.Horizontal){if(P=this.panSphericalMomentumEstimator.evaluateMomentum())return new B.PanSphericalMomentumController({view:this.view,momentum:P})}else if(P=this.panPlanarMomentumEstimator.evaluateMomentum())return new x.PanPlanarMomentumController({view:this.view,momentum:P});return null};I._zoomSpherical=function(P){const N=this.beginRadius/P.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(P.radius,40),120);this.smoothScaling.update(N);F.applyZoomOnSphere(this.sphere,
this.currentCamera,this.smoothScaling.value);u.screenPointObjectToArray(P.center,this.zoomCenterScreen);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*P.timestamp);this.constraintOptions.interactionType=w.InteractionType.ZOOM;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(P.radius-this.beginRadius);f.applyAll(this.view,this.currentCamera,this.constraintOptions)};I._panningSpherical=function(P){const N=u.screenPointObjectToArray(P.center,this.tmpScreenPointArray);
F.sphereOrPlanePointFromScreenPoint(this.sphere,this.currentCamera,N,this.tmp3d);F.preserveHeadingThreshold(this.beginScenePoint,p.dot(this.currentCamera.up,this.beginScenePoint),this.sphere[3],this.beginHeading,this.view.camera.tilt,this.startCamera)?(F.applyPanSphericalPreserveHeading(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.beginHeading,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumPreserveHeading(N,this.tmp3d,.001*P.timestamp,this.startCamera,
this.sphere,this.beginHeading,this.view.camera.tilt)):(F.applyPanSphericalDirectRotation(this.sphere,this.currentCamera,this.beginScenePoint,this.tmp3d,this.view.camera.tilt,!1),this.panSphericalMomentumEstimator.addMomentumDirectRotation(N,this.tmp3d,.001*P.timestamp,this.startCamera,this.sphere[3],this.view.camera.tilt));this.constraintOptions.interactionType=w.InteractionType.PAN;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.screenPickPoint,N);f.applyAll(this.view,
this.currentCamera,this.constraintOptions)};I._rotateSpherical=function(P){p.normalize(this.rotationAxis,this.scenePickPoint);this.currentCamera.aboveGround||p.negate(this.rotationAxis,this.rotationAxis);var N=this.smoothRotation.value,V=F.normalizeRotationDelta(P.angle-N);N+=V;this.smoothRotation.gain=.00125*Math.min(Math.max(P.radius,40),120);this.smoothRotation.update(N);V=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(V,.001*P.timestamp);F.applyRotation(this.currentCamera,
this.sphere,k.wrapAxisAngle(this.rotationAxis,V));this.constraintOptions.interactionType=w.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(P.radius*N);f.applyAll(this.view,this.currentCamera,this.constraintOptions)};I._panningPlanar=function(P){const N=u.screenPointObjectToArray(P.center,this.tmpScreenPointArray);F.intersectPlaneFromScreenPointAtEye(this.panningPlane,this.currentCamera,N,this.tmp3d)&&(F.applyPanPlanar(this.currentCamera,this.beginScenePoint,
this.tmp3d),this.panPlanarMomentumEstimator.add(N,this.tmp3d,.001*P.timestamp),this.constraintOptions.interactionType=w.InteractionType.PAN,this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(this.beginScreenPoint,N),this.constraintOptions.interactionDirection=this.view.renderCoordsHelper.worldUpAtPosition(this.currentCamera.eye,this.tmpInteractionDirection),f.applyAll(this.view,this.currentCamera,this.constraintOptions),this.constraintOptions.interactionDirection=null)};I._zoomPlanar=
function(P){const N=this.beginRadius/P.radius;this.smoothScaling.gain=.001875*Math.min(Math.max(P.radius,40),120);this.smoothScaling.update(N);this.zoomMomentumEstimator.add(this.smoothScaling.value,.001*P.timestamp);F.applyZoomToPoint(this.currentCamera,this.beginScenePoint,this.smoothScaling.value,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionType=w.InteractionType.ZOOM;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(P.radius-this.beginRadius);
f.applyAll(this.view,this.currentCamera,this.constraintOptions)};I._rotatePlanar=function(P){p.copy(this.rotationAxis,this.beginScenePoint);this.currentCamera.aboveGround||p.negate(this.rotationAxis,this.rotationAxis);var N=this.smoothRotation.value;let V=P.angle-N;V=F.normalizeRotationDelta(V);this.smoothRotation.gain=.00125*Math.min(Math.max(P.radius,40),120);this.smoothRotation.update(N+V);N=this.smoothRotation.value-this.beginAngle;this.rotationMomentumEstimator.add(N,.001*P.timestamp);F.applyRotation(this.currentCamera,
this.sphere,k.wrapAxisAngle(this.rotationAxis,N));this.constraintOptions.interactionType=w.InteractionType.TUMBLE;this.constraintOptions.interactionFactor=f.pixelDistanceToInteractionFactor(P.radius*N);f.applyAll(this.view,this.currentCamera,this.constraintOptions)};b._createClass(J,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);return J}(A.InteractiveController);c.__decorate([v.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);
a.PinchAndPanController=c.__decorate([e.subclass("esri.views.3d.state.controllers.global.PinchAndPanController")],a.PinchAndPanController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/util":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(u){this._gain=u}var l=n.prototype;l.reset=function(u){this._value=u};l.update=function(u){this._value=void 0===this._value?u:this._gain*
u+(1-this._gain)*this._value};b._createClass(n,[{key:"gain",set:function(u){this._gain=u}},{key:"value",get:function(){return void 0===this._value?0:this._value}}]);return n}();a.ExponentialFalloff=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/PanPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){a.PanPlanarMomentumController=function(t){function q(k){k=t.call(this,k)||this;k.interactionType=g.InteractionType.PAN;k.tmpPan=d.create();return k}b._inheritsLoose(q,t);q.prototype.momentumStep=function(k,r){k=this.momentum.value(k);h.scale(this.tmpPan,this.momentum.direction,k);r.eye=h.subtract(p,r.eye,this.tmpPan);r.center=h.subtract(p,r.center,this.tmpPan);this.constraintOptions.interactionDirection=this.tmpPan};return q}(e.MomentumController);c.__decorate([n.property({constructOnly:!0})],
a.PanPlanarMomentumController.prototype,"momentum",void 0);a.PanPlanarMomentumController=c.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.PanPlanarMomentumController")],a.PanPlanarMomentumController);const p=d.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/MomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../ViewAnimation ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../AnimationController ../../../webgl-engine/lib/Camera".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){a.MomentumController=function(t){function q(r){r=t.call(this,r)||this;r.view=null;r.beginCamera=new p.Camera;r.elapsedTimeSec=0;r.constraintOptions={selection:e.ConstraintTypes.ALL,interactionType:e.InteractionType.PAN,interactionFactor:0,interactionStartCamera:new p.Camera,interactionDirection:null,tiltMode:e.TiltMode.TUMBLE};return r}b._inheritsLoose(q,t);var k=q.prototype;k.initialize=function(){this.constraintOptions.interactionType=this.interactionType;this.viewAnimation=
new h};k.onControllerStart=function(r){this.beginCamera.copyFrom(r);this.constraintOptions.interactionStartCamera=this.beginCamera;t.prototype.onControllerStart.call(this,r)};k.stepController=function(r,y){y.copyViewFrom(this.beginCamera);this.elapsedTimeSec+=r;this.momentumStep(this.elapsedTimeSec,y);d.applyAll(this.view,y,this.constraintOptions)};b._createClass(q,[{key:"steppingFinished",get:function(){return this.momentum.isFinished(this.elapsedTimeSec)}}]);return q}(g.AnimationController);c.__decorate([n.property({constructOnly:!0})],
a.MomentumController.prototype,"view",void 0);a.MomentumController=c.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.MomentumController);Object.defineProperty(a,"InteractionType",{enumerable:!0,get:()=>e.InteractionType});Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/PanSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){const t=d.create(),q=d.create();a.PanSphericalMomentumController=function(k){function r(y){y=k.call(this,y)||this;y.interactionType=p.InteractionType.PAN;return y}b._inheritsLoose(r,k);r.prototype.momentumStep=function(y,f){const w=this.momentum.value1(y);y=this.momentum.value2(y);h.copy(q,f.eye);h.normalize(q,q);h.cross(this.momentum.axis2,q,this.momentum.axis1);g.applyRotationWithTwoAxes(f,t,this.momentum.axis1,w,this.momentum.axis2,y)};return r}(e.MomentumController);
c.__decorate([n.property({constructOnly:!0})],a.PanSphericalMomentumController.prototype,"momentum",void 0);a.PanSphericalMomentumController=c.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.PanSphericalMomentumController")],a.PanSphericalMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/RotationMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){a.RotationMomentumController=function(t){function q(k){k=t.call(this,k)||this;k.interactionType=p.InteractionType.TUMBLE;return k}b._inheritsLoose(q,t);q.prototype.momentumStep=function(k,r){k=this.momentum.value(k);g.applyRotation(r,this.center,d.wrapAxisAngle(this.axis,k))};b._createClass(q,[{key:"center",set:function(k){this._set("center",h.clone(k))}},{key:"axis",set:function(k){this._set("axis",h.clone(k))}}]);return q}(e.MomentumController);c.__decorate([n.property({constructOnly:!0})],
a.RotationMomentumController.prototype,"momentum",void 0);c.__decorate([n.property({constructOnly:!0})],a.RotationMomentumController.prototype,"center",null);c.__decorate([n.property({constructOnly:!0})],a.RotationMomentumController.prototype,"axis",null);a.RotationMomentumController=c.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.MomentumController")],a.RotationMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/ZoomPlanarMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){a.ZoomPlanarMomentumController=function(t){function q(k){k=t.call(this,k)||this;k.interactionType=p.InteractionType.ZOOM;k.constraintOptions.interactionDirection=d.create();return k}b._inheritsLoose(q,t);q.prototype.momentumStep=function(k,r){h.copy(this.constraintOptions.interactionDirection,r.eye);k=this.momentum.valueDelta(0,k);g.applyZoomToPoint(r,this.zoomCenter,k,this.view.state.constraints.minimumPoiDistance);this.constraintOptions.interactionDirection=h.direction(this.constraintOptions.interactionDirection,
r.eye,this.constraintOptions.interactionDirection)};b._createClass(q,[{key:"zoomCenter",set:function(k){this._set("zoomCenter",d.clone(k))}}]);return q}(e.MomentumController);c.__decorate([n.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"momentum",void 0);c.__decorate([n.property({constructOnly:!0})],a.ZoomPlanarMomentumController.prototype,"zoomCenter",null);a.ZoomPlanarMomentumController=c.__decorate([m.subclass("esri.views.3d.state.controllers.momentum.ZoomPlanarMomentumController")],
a.ZoomPlanarMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/momentum/ZoomSphericalMomentumController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../chunks/sphere ../../../camera/constraintUtils ./MomentumController ../../utils/navigationUtils ../../../camera/constraintUtils/common".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){a.ZoomSphericalMomentumController=function(r){function y(w){w=r.call(this,w)||this;w.interactionType=k.InteractionType.ZOOM;w.radius=0;w.tmpSceneCenter=d.create();w.tmpZoomAxisAngle=e.create();w.sphere=g.create();return w}b._inheritsLoose(y,r);var f=y.prototype;f.initialize=function(){this.sphere[3]=this.radius};f.momentumStep=function(w,z){w=this.momentum.valueDelta(0,w);q.applyZoomOnSphere(this.sphere,z,w);this.constraintOptions.interactionType=k.InteractionType.ZOOM;
p.applyAll(this.view,z,this.constraintOptions);q.sphereOrPlanePointFromScreenPoint(this.sphere,z,this.screenCenter,this.tmpSceneCenter);e.fromPoints(this.sceneCenter,this.tmpSceneCenter,this.tmpZoomAxisAngle);q.applyRotation(z,this.sphere,this.tmpZoomAxisAngle);this.constraintOptions.interactionType=k.InteractionType.PAN};b._createClass(y,[{key:"screenCenter",set:function(w){this._set("screenCenter",n.createScreenPointArray(w[0],w[1]))}},{key:"sceneCenter",set:function(w){this._set("sceneCenter",
d.clone(w))}}]);return y}(t.MomentumController);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"momentum",void 0);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"screenCenter",null);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"sceneCenter",null);c.__decorate([l.property({constructOnly:!0})],a.ZoomSphericalMomentumController.prototype,"radius",void 0);a.ZoomSphericalMomentumController=
c.__decorate([h.subclass("esri.views.3d.state.controllers.momentum.ZoomSphericalMomentumController")],a.ZoomSphericalMomentumController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/PanPlanarMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec3 ../../chunks/vec3f64 ./FilteredFiniteDifference ./Momentum".split(" "),function(a,b,c,n,l,u){let v=function(m){function h(d,e,g,p,t){d=m.call(this,
d,e,g)||this;d.sceneVelocity=p;d.direction=t;return d}b._inheritsLoose(h,m);h.prototype.value=function(d){return m.prototype.valueFromInitialVelocity.call(this,this.sceneVelocity,d)};return h}(u.Momentum);u=function(){function m(d=300,e=12,g=.84){this.minimumInitialVelocity=d;this.stopVelocity=e;this.friction=g;this.enabled=!0;this.time=new l.FilteredFiniteDifference(.6);this.screen=[new l.FilteredFiniteDifference(.4),new l.FilteredFiniteDifference(.4)];this.scene=[new l.FilteredFiniteDifference(.6),
new l.FilteredFiniteDifference(.6),new l.FilteredFiniteDifference(.6)];this.tmpDirection=n.create()}var h=m.prototype;h.add=function(d,e,g){!this.enabled||this.time.hasLastValue&&.015>this.time.computeDelta(g)||(this.screen[0].update(d[0]),this.screen[1].update(d[1]),this.scene[0].update(e[0]),this.scene[1].update(e[1]),this.scene[2].update(e[2]),this.time.update(g))};h.reset=function(){this.screen[0].reset();this.screen[1].reset();this.scene[0].reset();this.scene[1].reset();this.scene[2].reset();
this.time.reset()};h.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var d=this.screen[0].filteredDelta;const e=this.screen[1].filteredDelta;d=Math.sqrt(d*d+e*e)/this.time.filteredDelta;return Math.abs(d)<this.minimumInitialVelocity?null:this.createMomentum(d,this.stopVelocity,this.friction)};h.createMomentum=function(d,e,g){c.set(this.tmpDirection,this.scene[0].filteredDelta,this.scene[1].filteredDelta,this.scene[2].filteredDelta);const p=c.length(this.tmpDirection);
0<p&&c.scale(this.tmpDirection,this.tmpDirection,1/p);return new v(d,e,g,p/this.time.filteredDelta,this.tmpDirection)};return m}();a.PanPlanarMomentum=v;a.PanPlanarMomentumEstimator=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/FilteredFiniteDifference":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(u){this.gain=u}var l=n.prototype;l.update=function(u){if(this.hasLastValue){const v=
this.computeDelta(u);this._updateDelta(v)}this.lastValue=u};l.reset=function(){this.filteredDelta=this.lastValue=void 0};l.computeDelta=function(u){return u-this.lastValue};l._updateDelta=function(u){this.filteredDelta=this.hasFilteredDelta?(1-this.gain)*this.filteredDelta+this.gain*u:u};b._createClass(n,[{key:"hasLastValue",get:function(){return void 0!==this.lastValue}},{key:"hasFilteredDelta",get:function(){return void 0!==this.filteredDelta}}]);return n}();a.FilteredFiniteDifference=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/Momentum":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(u,v,m){this._initialVelocity=u;this._stopVelocity=v;this._friction=m;this._duration=Math.abs(Math.log(Math.abs(this._initialVelocity)/this._stopVelocity)/Math.log(1-this._friction))}var l=n.prototype;l.isFinished=function(u){return u>this.duration};l.value=function(u){return this.valueFromInitialVelocity(this._initialVelocity,
u)};l.valueDelta=function(u,v){const m=this.value(u);return this.value(u+v)-m};l.valueFromInitialVelocity=function(u,v){v=Math.min(v,this.duration);const m=1-this.friction;return u*(m**v-1)/Math.log(m)};b._createClass(n,[{key:"duration",get:function(){return this._duration}},{key:"friction",get:function(){return this._friction}}]);return n}();a.Momentum=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/PanSphericalMomentumEstimator":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/vec2f64 ../../chunks/vec3 ../../chunks/vec3f64 ../3d/state/utils/navigationUtils ./FilteredFiniteDifference ./FilteredValue ./Momentum".split(" "),
function(a,b,c,n,l,u,v,m,h){let d=function(e){function g(t,q,k,r,y,f=0,w){t=e.call(this,t,q,k)||this;t.angularVelocity1=r;t.axis1=y;t.angularVelocity2=f;t.axis2=w;return t}b._inheritsLoose(g,e);var p=g.prototype;p.value1=function(t){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity1,t)};p.value2=function(t){return e.prototype.valueFromInitialVelocity.call(this,this.angularVelocity2,t)};return g}(h.Momentum);h=function(){function e(p=300,t=12,q=.84){this.minimumInitialVelocity=
p;this.stopVelocity=t;this.friction=q;this.enabled=!0;this.tmpAxis1=l.create();this.tmpAxis2=l.create();this.tmpAngles=c.create();this.time=new v.FilteredFiniteDifference(.3);this.screen=[new v.FilteredFiniteDifference(.4),new v.FilteredFiniteDifference(.4)];this.angle1=new m.FilteredValue(.6);this.angle2=new m.FilteredValue(.6);this.axis1=l.create();this.axis2=l.create();this.lastScene=l.create()}var g=e.prototype;g.addMomentumDirectRotation=function(p,t,q,k,r,y){if(this.enabled){if(this.time.hasLastValue){if(.01>
this.time.computeDelta(q))return;k=u.rotationAngleAndAxisDirectRotation(this.lastScene,t,this.tmpAxis2,k,r,y);this.angle2.update(0);1E-5>n.squaredLength(this.tmpAxis2)?k=0:n.normalize(this.axis1,this.tmpAxis2);this.angle1.update(k);n.copy(this.lastScene,t)}this.screen[0].update(p[0]);this.screen[1].update(p[1]);this.time.update(q)}};g.addMomentumPreserveHeading=function(p,t,q,k,r,y,f){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(q))return;u.rotationAnglesAndAxesHeadingPreserving(this.lastScene,
t,this.tmpAxis2,this.tmpAxis1,this.tmpAngles,k,r,y,f,!1);1E-5>n.squaredLength(this.tmpAxis2)?(this.angle1.update(0),this.angle2.update(0)):(this.angle1.update(this.tmpAngles[1]),this.angle2.update(this.tmpAngles[0]),n.normalize(this.axis1,this.tmpAxis1),n.normalize(this.axis2,this.tmpAxis2));n.copy(this.lastScene,t)}this.screen[0].update(p[0]);this.screen[1].update(p[1]);this.time.update(q)}};g.reset=function(){this.screen[0].reset();this.screen[1].reset();this.angle1.reset();this.angle2.reset();
this.time.reset()};g.evaluateMomentum=function(){if(!this.enabled||!this.screen[0].hasFilteredDelta)return null;var p=this.screen[0].filteredDelta;const t=this.screen[1].filteredDelta;p=Math.sqrt(p*p+t*t)/this.time.filteredDelta;return Math.abs(p)<this.minimumInitialVelocity?null:this.createMomentum(p,this.stopVelocity,this.friction)};g.createMomentum=function(p,t,q){return new d(p,t,q,this.angle1.filteredValue/this.time.filteredDelta,this.axis1,this.angle2.filteredValue/this.time.filteredDelta,this.axis2)};
return e}();a.PanSphericalMomentum=d;a.PanSphericalMomentumEstimator=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/FilteredValue":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=function(){function n(u){this.gain=u}var l=n.prototype;l.update=function(u){this.filteredValue=this.hasFilteredValue?(1-this.gain)*this.filteredValue+this.gain*u:u};l.reset=function(){this.filteredValue=void 0};
b._createClass(n,[{key:"hasFilteredValue",get:function(){return void 0!==this.filteredValue}}]);return n}();a.FilteredValue=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/RotationMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./MomentumEstimator"],function(a,b,c){c=function(n){function l(u=3,v=.01,m=.95,h=12){return n.call(this,u,v,m,h)||this}b._inheritsLoose(l,n);l.prototype.add=function(u,
v){if(this.value.hasLastValue){const m=this.value.lastValue;for(u-=m;u>Math.PI;)u-=2*Math.PI;for(;u<-Math.PI;)u+=2*Math.PI;u=m+u}n.prototype.add.call(this,u,v)};return l}(c.MomentumEstimator);a.RotationMomentumEstimator=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/navigation/MomentumEstimator":function(){define(["exports","../../core/mathUtils","./FilteredFiniteDifference","./Momentum"],function(a,b,c,n){let l=function(){function u(m=2.5,
h=.01,d=.95,e=12){this.minimumInitialVelocity=m;this.stopVelocity=h;this.friction=d;this.maxVelocity=e;this.enabled=!0;this.value=new c.FilteredFiniteDifference(.8);this.time=new c.FilteredFiniteDifference(.3)}var v=u.prototype;v.add=function(m,h){if(this.enabled){if(this.time.hasLastValue){if(.01>this.time.computeDelta(h))return;if(this.value.hasFilteredDelta){const d=this.value.computeDelta(m);0>this.value.filteredDelta*d&&this.value.reset()}}this.time.update(h);this.value.update(m)}};v.reset=function(){this.value.reset();
this.time.reset()};v.evaluateMomentum=function(){if(!this.enabled||!this.value.hasFilteredDelta)return null;let m=this.value.filteredDelta/this.time.filteredDelta;m=b.clamp(m,-this.maxVelocity,this.maxVelocity);return Math.abs(m)<this.minimumInitialVelocity?null:this.createMomentum(m,this.stopVelocity,this.friction)};v.createMomentum=function(m,h,d){return new n.Momentum(m,h,d)};return u}();a.MomentumEstimator=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/navigation/ZoomMomentumEstimator":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","./Momentum","./MomentumEstimator"],function(a,b,c,n){let l=function(u){function v(h,d,e){return u.call(this,h,d,e)||this}b._inheritsLoose(v,u);var m=v.prototype;m.value=function(h){h=u.prototype.value.call(this,h);return Math.exp(h)};m.valueDelta=function(h,d){const e=u.prototype.value.call(this,h);h=u.prototype.value.call(this,h+d);return Math.exp(h-e)};return v}(c.Momentum);c=function(u){function v(h=
2.5,d=.01,e=.95,g=12){return u.call(this,h,d,e,g)||this}b._inheritsLoose(v,u);var m=v.prototype;m.add=function(h,d){u.prototype.add.call(this,Math.log(h),d)};m.createMomentum=function(h,d,e){return new l(h,d,e)};return v}(n.MomentumEstimator);a.ZoomMomentum=l;a.ZoomMomentumEstimator=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/controllers/local/PinchAndPanController":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/mathUtils ../../../../../core/screenUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/axisAngle ../../../../../geometry/support/plane ../../../camera/constraintUtils ../../../camera/constraintUtils/common ../../../input/util ../InteractiveController ../momentum/PanPlanarMomentumController ../momentum/RotationMomentumController ../momentum/ZoomPlanarMomentumController ../../utils/navigationUtils ../../../webgl-engine/lib/Camera ../../../../navigation/PanPlanarMomentumEstimator ../../../../navigation/RotationMomentumEstimator ../../../../navigation/ZoomMomentumEstimator".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D){const E=g.fromValues(0,0,1);var F=16/180*Math.PI;a.PinchAndPanController=function(G){function O(L){L=G.call(this,L)||this;L.view=null;L.rotationValueSmooth=new r.ExponentialFalloff(.05);L.scalingValueSmooth=new r.ExponentialFalloff(.05);L.planeHorizontal=t.create();L.planeVertical=t.create();L.rotationMomentumEstimator=new C.RotationMomentumEstimator;L.panMomentumEstimator=new B.PanPlanarMomentumEstimator(300,12,.9);L.zoomMomentumEstimator=
new D.ZoomMomentumEstimator;L.beginCenter=g.create();L.tmpPoints=[];L.beginCenterScreen=l.createScreenPointArray();L.tmpCentroid3d=g.create();L.tmpCentroid2d=l.createScreenPointArray();L.tmp2d=l.createScreenPointArray();L.constraintOptions={selection:k.ConstraintTypes.ALL,interactionType:k.InteractionType.NONE,interactionFactor:0,interactionStartCamera:new x.Camera,interactionDirection:null,tiltMode:k.TiltMode.TUMBLE};return L}b._inheritsLoose(O,G);var K=O.prototype;K.begin=function(L){if(this.active){var R=
this.view.navigation.momentumEnabled;this.zoomMomentumEstimator.enabled=R;this.rotationMomentumEstimator.enabled=R;this.panMomentumEstimator.enabled=R;this.beginRadius=L.radius;this.pointerCount=L.pointers.size;this.beginAngle=L.angle;this.rotationValueSmooth.reset();this.scalingValueSmooth.reset();l.screenPointObjectToArray(L.center,this.beginCenterScreen);t.fromNormalAndOffset(E,0,this.planeHorizontal);var M=g.create();R=this.intersectionHelper.intersectScreenFreePointFallback(this.beginCenterScreen,
M);var J=g.create();e.negate(J,this.startCamera.viewForward);var I=g.create();e.copy(I,E);var P=e.dot(J,I);this.panMode=n.asinClamped(0>P?-P:P)>=F?A.NavigationMode.Horizontal:A.NavigationMode.Vertical;t.setOffsetFromPoint(this.planeHorizontal,this.planeHorizontal,M);this.startCamera.aboveGround||t.negate(this.planeHorizontal,this.planeHorizontal);if(this.panMode===A.NavigationMode.Vertical){e.scale(I,I,P);e.subtract(this.planeVertical,J,I);e.normalize(this.planeVertical,this.planeVertical);t.setOffsetFromPoint(this.planeVertical,
this.planeVertical,M);J=g.create();I=g.create();P=g.create();e.subtract(J,M,this.currentCamera.eye);M=e.length(J);e.normalize(J,J);var N=5*Math.max(Math.abs(this.view.camera.position.z),50);const V=this.view._stage.renderView.getMinimalDepthForArea(this.view.voxelWasm,this.beginCenterScreen[0],this.beginCenterScreen[1],this.view.state.camera,80);N=V?Math.min(V,N):N;N=R?Math.min(N,M):N;e.copy(P,e.add(I,this.currentCamera.eye,e.scale(I,J,N)));this.planeVertical[3]=-e.dot(this.planeVertical,P);this.computePlanePoints(L.pointers,
this.planeVertical,this.startCamera,this.tmpPoints)}else this.computePlanePoints(L.pointers,this.planeHorizontal,this.startCamera,this.tmpPoints);A.centroid(this.tmpPoints,this.beginCenter);this.constraintOptions.interactionStartCamera.copyFrom(this.startCamera)}};K.update=function(L){if(this.active){this.currentCamera.copyFrom(this.startCamera);var R=1<L.pointers.size,M=this.panMode===A.NavigationMode.Horizontal?this.planeHorizontal:this.planeVertical,J=this.beginCenter;if(R){var I=this.beginRadius/
L.radius;this.scalingValueSmooth.gain=.001875*Math.min(Math.max(L.radius,40),120);this.scalingValueSmooth.update(I);A.applyZoomToPoint(this.currentCamera,J,this.scalingValueSmooth.value,this.view.state.constraints.minimumPoiDistance);this.zoomMomentumEstimator.add(this.scalingValueSmooth.value,.001*L.timestamp);this.constraintOptions.interactionType=k.InteractionType.ZOOM;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Math.abs(L.radius-this.beginRadius));q.applyAll(this.view,
this.currentCamera,this.constraintOptions)}this.computePlanePoints(L.pointers,M,this.currentCamera,this.tmpPoints);A.centroid(this.tmpPoints,this.tmpCentroid3d);l.screenPointObjectToArray(L.center,this.tmpCentroid2d);A.applyPanPlanar(this.currentCamera,J,this.tmpCentroid3d);this.panMomentumEstimator.add(this.tmpCentroid2d,this.tmpCentroid3d,.001*L.timestamp);this.constraintOptions.interactionType=k.InteractionType.PAN;this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(this.beginCenterScreen,
this.tmpCentroid2d);q.applyAll(this.view,this.currentCamera,this.constraintOptions);R&&(R=this.planeHorizontal,M=this.rotationValueSmooth.value,I=A.normalizeRotationDelta(L.angle-M),M+=I,this.rotationValueSmooth.gain=.00125*Math.min(Math.max(L.radius,40),120),this.rotationValueSmooth.update(M),M=this.rotationValueSmooth.value-this.beginAngle,this.rotationMomentumEstimator.add(M,.001*L.timestamp),A.applyRotation(this.currentCamera,J,p.wrapAxisAngle(R,M)),this.constraintOptions.interactionType=k.InteractionType.TUMBLE,
this.constraintOptions.interactionFactor=q.pixelDistanceToInteractionFactor(Math.abs(L.radius*M)),q.applyAll(this.view,this.currentCamera,this.constraintOptions))}};K.end=function(L){L.pointers.size===this.pointerCount&&this.update(L);this.finishController();return(L=this.zoomMomentumEstimator.evaluateMomentum())?new z.ZoomPlanarMomentumController({view:this.view,momentum:L,zoomCenter:this.beginCenter}):(L=this.rotationMomentumEstimator.evaluateMomentum())?new w.RotationMomentumController({view:this.view,
momentum:L,center:this.beginCenter,axis:t.normal(this.planeHorizontal)}):(L=this.panMomentumEstimator.evaluateMomentum())?new f.PanPlanarMomentumController({view:this.view,momentum:L}):null};K.computePlanePoints=function(L,R,M,J){J.length=L.size;const I=this.tmp2d;let P=0;L.forEach(N=>{I[0]=N.x;I[1]=N.y;void 0===J[P]&&(J[P]=g.create());A.intersectPlaneFromScreenPointAtEye(R,M,I,J[P]);P+=1});return J};b._createClass(O,[{key:"intersectionHelper",get:function(){return this.view.sceneIntersectionHelper}}]);
return O}(y.InteractiveController);c.__decorate([u.property({constructOnly:!0})],a.PinchAndPanController.prototype,"view",void 0);a.PinchAndPanController=c.__decorate([d.subclass("esri.views.3d.state.controllers.local.PinchAndPanController")],a.PinchAndPanController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/PointerDownCancelAnimation":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],
function(a,b,c){c=function(n){function l(u,v){var m=n.call(this,!0)||this;m.view=u;m.registerIncoming("pointer-down",v,()=>m.view.state.stopActiveCameraController());return m}b._inheritsLoose(l,n);return l}(c.InputHandler);a.PointerDownCancelAnimation=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKeyResetHeading":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,
b,c){c=function(n){function l(u,v,m){v=n.call(this,v,m)||this;v.view=u;return v}b._inheritsLoose(l,n);l.prototype.activate=function(){this.view.goTo({heading:0}).catch(()=>{})};return l}(c.SingleKey);a.SingleKeyResetHeading=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKey":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../input/InputHandler"],function(a,b,c){c=function(n){function l(u,
v){var m=n.call(this,!0)||this;m.key=u;m.registerIncoming("key-down",v,h=>m._handleKeyDown(h));return m}b._inheritsLoose(l,n);l.prototype._handleKeyDown=function(u){u.data.key===this.key&&(this.activate(),u.stopPropagation())};return l}(c.InputHandler);a.SingleKey=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/SingleKeyResetTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","./SingleKey"],function(a,
b,c){c=function(n){function l(u,v,m){v=n.call(this,v,m)||this;v.view=u;return v}b._inheritsLoose(l,n);l.prototype.activate=function(){this.view.goTo({tilt:0}).catch(()=>{})};return l}(c.SingleKey);a.SingleKeyResetTilt=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/input/handlers/TwoFingerTilt":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/screenUtils","../../state/controllers/RotateController",
"../../../input/InputHandler"],function(a,b,c,n,l){l=function(u){function v(m,h=!1){var d=u.call(this,!0)||this;d.view=m;d.invert=h;d.registerIncoming("vertical-two-finger-drag",e=>d._handleTwoFinger(e));return d}b._inheritsLoose(v,u);v.prototype._handleTwoFinger=function(m){var h,d,e;const g=c.createScreenPointArray(0,m.data.delta*(this.invert?-1:1));switch(m.data.action){case "begin":null==(h=this.cameraController)?void 0:h.end();this.cameraController=new n.RotateController({view:this.view,pivot:n.PivotPoint.CENTER});
this.view.state.switchCameraController(this.cameraController);this.cameraController.begin(g);break;case "update":null==(d=this.cameraController)?void 0:d.update(g);break;case "end":null==(e=this.cameraController)?void 0:e.end(),this.cameraController=null}};return v}(l.InputHandler);a.TwoFingerTilt=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/BrowserEventSource":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/has ./keys ./gamepad/GamepadSource ../support/screenUtils".split(" "),
function(a,b,c,n,l,u){const v=c("trident"),m=c("edge"),h=c("chrome"),d=c("ff"),e=c("safari");c=function(){function p(q,k){this.input=k;this._active={};this._activePointerCaptures=new Set;this._keyDownState=new Set;this._eventId=1;this._browserTouchPanningEnabled=!1;this._element=q;q.getAttribute("tabindex")||q.setAttribute("tabindex","0");this._eventHandlers={"key-down":this._handleKey,"key-up":this._handleKey,"pointer-down":this._handlePointer,"pointer-move":this._handlePointerPreventDefault,"pointer-up":this._handlePointerPreventDefault,
"pointer-enter":this._handlePointer,"pointer-leave":this._handlePointer,"pointer-cancel":this._handlePointer,"mouse-wheel":this._handleMouseWheel,"pointer-capture-lost":this._handlePointerCaptureLost};this._updateTouchAction();this._element.addEventListener("keydown",this._preventAltKeyDefault);this._gamepadSource=new l.GamepadSource(q,this.input);this._gamepadSource.onEvent=r=>this._callback("gamepad",r)}var t=p.prototype;t.destroy=function(){this.activeEvents=this._callback=null;this._activePointerCaptures.forEach(q=>
{this._releasePointerCaptureSafe(q)});this._gamepadSource&&(this._gamepadSource.destroy(),this._gamepadSource=null);this._activePointerCaptures=null;this._removeTouchAction();this._element.removeEventListener("keydown",this._preventAltKeyDefault)};t.setPointerCapture=function(q,k){k?(this._element.setPointerCapture(q.pointerId),this._activePointerCaptures.add(q.pointerId)):(this._releasePointerCaptureSafe(q.pointerId),this._activePointerCaptures.delete(q.pointerId))};t._updateTouchAction=function(){this._element.classList.remove(this._browserTouchPanningEnabled?
"esri-view-surface--touch-none":"esri-view-surface--touch-pan");this._element.classList.add(this._browserTouchPanningEnabled?"esri-view-surface--touch-pan":"esri-view-surface--touch-none")};t._updateTouchEventHandling=function(){this._browserTouchPanningEnabled?this._element.addEventListener("touchmove",this._preventMultiTouchPanning):this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};t._removeTouchAction=function(){this._element.classList.remove("esri-view-surface--touch-none");
this._element.classList.remove("esri-view-surface--touch-pan");this._element.removeEventListener("touchmove",this._preventMultiTouchPanning)};t._releasePointerCaptureSafe=function(q){try{this._element.hasPointerCapture&&!this._element.hasPointerCapture(q)||this._element.releasePointerCapture(q)}catch(k){}};t._updateNormalizedPointerLikeEvent=function(q,k){q=u.createScreenPointFromNativeEvent(this._element,q);p.test.disableSubpixelCoordinates&&(q.x=Math.round(q.x),q.y=Math.round(q.y));k.x=q.x;k.y=
q.y;return k};t._handleKey=function(q,k){const r=n.eventKey(k);r&&"key-up"===q&&this._keyDownState.delete(r);k={native:k,key:r,repeat:r&&this._keyDownState.has(r)};r&&"key-down"===q&&this._keyDownState.add(k.key);this._callback(q,k)};t._handlePointer=function(q,k){k=this._updateNormalizedPointerLikeEvent(k,{native:k,x:0,y:0,pointerType:k.pointerType,button:k.button,buttons:k.buttons,eventId:this._eventId++});this._callback(q,k)};t._handlePointerPreventDefault=function(q,k){const r=this._updateNormalizedPointerLikeEvent(k,
{native:k,x:0,y:0,pointerType:k.pointerType,button:k.button,buttons:k.buttons,eventId:this._eventId++});k.preventDefault();this._callback(q,r)};t._handleMouseWheel=function(q,k){let r=k.deltaY;switch(k.deltaMode){case 0:if(v||m)r=r/document.documentElement.clientHeight*600;break;case 1:r*=30;break;case 2:r*=900}v||m?r*=.7:h||e?r*=.6:d&&(r*=1.375);const y=Math.abs(r);100<y&&(r=r/y*200/(1+Math.exp(-.02*(y-100))));k=this._updateNormalizedPointerLikeEvent(k,{native:k,x:0,y:0,deltaY:r});this._callback(q,
k)};t._handlePointerCaptureLost=function(q,k){this._activePointerCaptures.delete(k.pointerId);this._handleDefault(q,k)};t._handleDefault=function(q,k){const r={native:k};k.preventDefault();this._callback(q,r)};t._preventAltKeyDefault=function(q){"Alt"===q.key&&q.preventDefault()};t._preventMultiTouchPanning=function(q){1<q.touches.length&&q.preventDefault()};b._createClass(p,[{key:"browserTouchPanningEnabled",get:function(){return this._browserTouchPanningEnabled},set:function(q){this._browserTouchPanningEnabled=
q;this._updateTouchAction();this._updateTouchEventHandling()}},{key:"onEventReceived",set:function(q){this._callback=q}},{key:"activeEvents",set:function(q){for(const k in this._active)q&&q.has(k)||(this._element.removeEventListener(g[k],this._active[k]),delete this._active[k]);q&&q.forEach(k=>{if(!this._active[k]&&g[k]){const r=(this._eventHandlers[k]||this._handleDefault).bind(this,k);this._element.addEventListener(g[k],r);this._active[k]=r}});this._gamepadSource.hasEventListeners=q&&q.has("gamepad")}}]);
return p}();c.test={disableSubpixelCoordinates:!1};const g={"key-down":"keydown","key-up":"keyup","pointer-down":"pointerdown","pointer-up":"pointerup","pointer-move":"pointermove","mouse-wheel":"wheel","pointer-capture-got":"gotpointercapture","pointer-capture-lost":"lostpointercapture","context-menu":"contextmenu","pointer-enter":"pointerenter","pointer-leave":"pointerleave","pointer-cancel":"pointercancel",focus:"focus",blur:"blur"};a.BrowserEventSource=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/gamepad/GamepadSource":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/scheduling","./GamepadInputDevice","./GamepadState"],function(a,b,c,n,l){let u=function(){function v(h,d){this.element=h;this.input=d;this._hasEventListeners=!1;this._onConnectGamepad=e=>{this._connectGamepad(e.gamepad)};this._onDisconnectGamepad=e=>{e=e.gamepad;const g=e.index,p=this.inputDevices[g];p&&(this._emitGamepadEvent(e,
l.extractState(p),!1),this.inputDevices.splice(g,1),this.latestUpdate.splice(g,1),this.input.gamepad.devices.remove(p),this.ensurePollingState())};this.frameTask=null;this.latestUpdate=[];this.inputDevices=[];this.callback=null;h=window.isSecureContext;if(this.supported="getGamepads"in window.navigator&&h)this._forEachGamepad(e=>this._connectGamepad(e)),window.addEventListener("gamepadconnected",this._onConnectGamepad),window.addEventListener("gamepaddisconnected",this._onDisconnectGamepad),this.ensurePollingState()}
var m=v.prototype;m.destroy=function(){this.hasEventListeners=!1;this.supported&&(window.removeEventListener("gamepadconnected",this._onConnectGamepad),window.removeEventListener("gamepaddisconnected",this._onDisconnectGamepad))};m._connectGamepad=function(h){const d=new n(h);"unknown"!==d.deviceType&&(this.inputDevices[h.index]=d,this.input.gamepad.devices.add(d));this.ensurePollingState()};m.ensurePollingState=function(){this.eventsEnabled?this._startPolling():this._stopPolling()};m._startPolling=
function(){null==this.frameTask&&(this.frameTask=c.addFrameTask({update:()=>this._readGamepadState()}))};m._stopPolling=function(){null!=this.frameTask&&(this.frameTask.remove(),this.frameTask=null,this.latestUpdate=[])};m._readGamepadState=function(){const h=document.hasFocus(),d=this.element.contains(document.activeElement),e="document"===this.input.gamepad.enabledFocusMode&&!h||"view"===this.input.gamepad.enabledFocusMode&&!d;this._forEachGamepad(g=>{var p=this.inputDevices[g.index];if(p){var t=
this.latestUpdate[g.index];p=l.extractState(p);var q=e||l.stateIdle(p);t&&(t.timestamp===g.timestamp||!t.active&&q||l.stateEqual(t.state,p))||this._emitGamepadEvent(g,p,!q)}})};m._forEachGamepad=function(h){const d=window.navigator.getGamepads();for(let e=0;e<d.length;e++){const g=d[e];this._validate(g)&&h(g)}};m._emitGamepadEvent=function(h,d,e){var g=this.latestUpdate[h.index];if((g=g&&g.active)||e)this.latestUpdate[h.index]={timestamp:h.timestamp,state:d,active:e},this.callback&&this.callback({device:this.inputDevices[h.index],
state:d,action:!g&&e?"start":g&&e?"update":"end"})};m._validate=function(h){if(!h||!h.connected)return!1;for(let d=0;d<h.axes.length;d++)if(isNaN(h.axes[d]))return!1;return!0};b._createClass(v,[{key:"hasEventListeners",set:function(h){this._hasEventListeners!==h&&(this._hasEventListeners=h,this.ensurePollingState())}},{key:"eventsEnabled",get:function(){return this.supported&&0<this.inputDevices.length&&this._hasEventListeners}},{key:"onEvent",set:function(h){this.callback=h}}]);return v}();a.GamepadSource=
u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/gamepad/GamepadState":function(){define(["exports"],function(a){a.extractState=function(b){const c=b.native;return c?{buttons:c.buttons.map(n=>n.pressed?n.value?n.value:1:0),axes:c.axes.map(n=>{{var l=b.axisThreshold;const u=Math.abs(n);n=u<l?0:Math.sign(n)*(u-l)/(1-l)}return n})}:{buttons:[],axes:[]}};a.stateEqual=function(b,c){if(b.axes.length!==c.axes.length||b.buttons.length!==c.buttons.length)return!1;
for(var n=0;n<b.axes.length;n++)if(b.axes[n]!==c.axes[n])return!1;for(n=0;n<b.buttons.length;n++)if(b.buttons[n]!==c.buttons[n])return!1;return!0};a.stateIdle=function(b){for(var c=0;c<b.axes.length;c++)if(0!==b.axes[c])return!1;for(c=0;c<b.buttons.length;c++)if(0!==b.buttons[c])return!1;return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/handlers/PreventContextMenu":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../InputHandler"],function(a,b,c){c=function(n){function l(){var u=n.call(this,!0)||this;u.registerIncoming("context-menu",v=>{v.data.native.preventDefault()});return u}b._inheritsLoose(l,n);return l}(c.InputHandler);a.PreventContextMenu=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/Drag":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/screenUtils ../../../core/time ../InputHandler ./support".split(" "),
function(a,b,c,n,l,u){function v(e){const g=[];e.forEach(p=>{g.push(c.createScreenPoint(p.event.x,p.event.y))});return u.fitCircleLSQ(g)}function m(e){const g=v(e);let p=0;e.forEach(t=>{var q=d(t,g);for(q-=t.lastAngle;q>Math.PI;)q-=2*Math.PI;for(;q<-Math.PI;)q+=2*Math.PI;q=t.lastAngle+q;t.lastAngle=q;p+=q-t.initialAngle});p/=e.size||1;return{angle:p,radius:g.radius,center:g.center}}function h(e){const g=new Map;e.forEach((p,t)=>g.set(t,p.event));return g}function d(e,g){e=e.event;return Math.atan2(e.y-
g.center.y,e.x-g.center.x)}l=function(e){function g(t){var q=e.call(this,!1)||this;q.navigationTouch=t;q.startStateModifiers=new Set;q.activePointerMap=new Map;q.isDragging=!1;q.isCurrentDragSuppressed=!1;q.drag=q.registerOutgoing("drag");q.registerIncoming("pointer-drag",q._handlePointerDrag.bind(b._assertThisInitialized(q)));q.registerIncoming("pointer-up",q._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(q)));q.registerIncoming("pointer-capture-lost",q._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(q)));
q.registerIncoming("pointer-cancel",q._handlePointerUpAndPointerLost.bind(b._assertThisInitialized(q)));return q}b._inheritsLoose(g,e);var p=g.prototype;p._createPayload=function(t,q,k,r){return{action:t,pointerType:this.pointerType,button:this.mouseButton,buttons:q.buttons,timestamp:r,pointers:h(this.activePointerMap),pointer:q,angle:k.angle,radius:k.radius,center:k.center}};p._addPointer=function(t){var q=t.native.pointerId;const k=m(this.activePointerMap).angle;t={event:t,initialAngle:0,lastAngle:0};
this.activePointerMap.set(q,t);q=d(t,v(this.activePointerMap));t.initialAngle=q;t.lastAngle=q;this._updatePointerAngles(k)};p._updatePointer=function(t){if(!t||null!=t.x||null!=t.y){var q=this.activePointerMap.get(t.native.pointerId);q?q.event=t:this._addPointer(t)}};p._removePointer=function(t){const q=m(this.activePointerMap).angle;this.activePointerMap.delete(t);this._updatePointerAngles(q)};p._updatePointerAngles=function(t){const q=m(this.activePointerMap);this.activePointerMap.forEach(k=>{k.initialAngle=
d(k,q)-t;k.lastAngle=d(k,q)-t})};p._emitEvent=function(t,q,k){const r=m(this.activePointerMap);this.drag.emit(this._createPayload(t,q,r,k),void 0,this.startStateModifiers)};p._handlePointerUpAndPointerLost=function(t){const q=t.data.native.pointerId,k=n.Milliseconds(t.timestamp);this.activePointerMap.get(q)&&(1===this.activePointerMap.size?(this._updatePointer(t.data),!this.isCurrentDragSuppressed&&this._emitEvent("end",t.data,k),this.isCurrentDragSuppressed=this.isDragging=!1,this._removePointer(q)):
(this._removePointer(q),this._emitEvent("removed",t.data,n.Milliseconds(t.timestamp))))};p._handlePointerDrag=function(t){const q=t.data,k=q.currentEvent,r=n.Milliseconds(t.timestamp);switch(q.action){case "start":case "update":this.isDragging?this.activePointerMap.has(k.native.pointerId)?(this._updatePointer(k),!this.isCurrentDragSuppressed&&this._emitEvent("update",k,r)):(this._addPointer(k),this._emitEvent("added",k,r),this.isCurrentDragSuppressed=this.isSuppressed):(this._updatePointer(k),this.pointerType=
t.data.startEvent.pointerType,this.mouseButton=t.data.startEvent.button,this.startStateModifiers=t.modifiers,this.isDragging=!0,this.isCurrentDragSuppressed=this.isSuppressed,!this.isCurrentDragSuppressed&&this._emitEvent("start",k,r))}};b._createClass(g,[{key:"isSuppressed",get:function(){return this.navigationTouch&&!this.navigationTouch.browserTouchPanEnabled&&"touch"===this.pointerType&&1===this.activePointerMap.size}}]);return g}(l.InputHandler);a.Button=void 0;(function(e){e[e.Left=0]="Left";
e[e.Middle=1]="Middle";e[e.Right=2]="Right";e[e.Back=3]="Back";e[e.Forward=4]="Forward";e[e.Undefined=-1]="Undefined"})(a.Button||(a.Button={}));a.Drag=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/support":function(){define(["exports","../../../core/screenUtils"],function(a,b){a.euclideanDistance=function(c,n){const l=n.x-c.x;c=n.y-c.y;return Math.sqrt(l*l+c*c)};a.fitCircleLSQ=function(c,n){n?(n.radius=0,n.center.x=0,n.center.y=
0):n={radius:0,center:b.createScreenPoint()};if(0===c.length)return n;if(1===c.length)return n.center.x=c[0].x,n.center.y=c[0].y,n;if(2===c.length){const [k,r]=c,[y,f]=[r.x-k.x,r.y-k.y];n.radius=Math.sqrt(y*y+f*f)/2;n.center.x=(k.x+r.x)/2;n.center.y=(k.y+r.y)/2;return n}let l=0,u=0;for(n=0;n<c.length;n++)l+=c[n].x,u+=c[n].y;l/=c.length;u/=c.length;var v=c.map(k=>k.x-l),m=c.map(k=>k.y-u);let h=n=0;var d=0,e=0,g=0,p=0,t=0;for(var q=0;q<v.length;q++){const k=v[q],r=m[q],y=k*k,f=r*r;n+=y;h+=f;d+=k*r;
e+=y*k;g+=f*r;p+=k*f;t+=r*y}v=n;m=d;q=h;e=.5*(e+p);g=.5*(g+t);t=v*q-d*m;p=(e*q-g*m)/t;g=(v*g-d*e)/t;t=b.createScreenPoint(p+l,g+u);return{radius:Math.sqrt(p*p+g*g+(n+h)/c.length),center:t}};a.manhattanDistance=function(c,n){return Math.abs(n.x-c.x)+Math.abs(n.y-c.y)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/ImmediateDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../InputHandler ./SingleAndDoubleClick ./support".split(" "),
function(a,b,c,n,l,u){n=function(v){function m(d=l.DefaultParameters.maximumDoubleClickDelay,e=l.DefaultParameters.maximumDoubleClickDistance,g=l.DefaultParameters.maximumDoubleTouchDelay,p=l.DefaultParameters.maximumDoubleTouchDistance,t=c.clock){var q=v.call(this,!1)||this;q.maximumDoubleClickDelay=d;q.maximumDoubleClickDistance=e;q.maximumDoubleTouchDelay=g;q.maximumDoubleTouchDistance=p;q._clock=t;q._pointerState=new Map;q._immediateDoubleClick=q.registerOutgoing("immediate-double-click");q.registerIncoming("pointer-down",
q._handlePointerDown.bind(b._assertThisInitialized(q)));q.registerIncoming("pointer-up",k=>{q._handlePointerLoss(k,"pointer-up")});q.registerIncoming("pointer-capture-lost",k=>{q._handlePointerLoss(k,"pointer-capture-lost")});q.registerIncoming("pointer-cancel",k=>{q._handlePointerLoss(k,"pointer-cancel")});return q}b._inheritsLoose(m,v);var h=m.prototype;h.onUninstall=function(){this._pointerState.forEach(d=>{d.immediateDoubleClick&&d.immediateDoubleClick.timeoutHandle.remove()});v.prototype.onUninstall.call(this)};
h._handlePointerDown=function(d){d=d.data;const e=this._pointerId(d);this._pointerState.has(e)||(this._pointerState.set(e,{downButton:d.native.button,immediateDoubleClick:null}),this.startCapturingPointer(d.native))};h._handlePointerLoss=function(d,e){const g=d.data;var p=this._pointerId(g);if((p=this._pointerState.get(p))&&"pointer-up"===e&&p.downButton===g.native.button)if(e=p.immediateDoubleClick){e.timeoutHandle.remove();const t="touch"===d.data.native.pointerType?this.maximumDoubleTouchDistance:
this.maximumDoubleClickDistance;u.manhattanDistance(e,d.data)>t?this._startImmediateDoubleClick(d,p):(this._immediateDoubleClick.emit(d.data,void 0,e.modifiers),this._removeState(g))}else this._startImmediateDoubleClick(d,p)};h._startImmediateDoubleClick=function(d,e){e.immediateDoubleClick={x:d.data.x,y:d.data.y,modifiers:d.modifiers,timeoutHandle:this._clock.setTimeout(()=>this._removeState(d.data),"touch"===d.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)}};
h._pointerId=function(d){d=d.native;return"mouse"===d.pointerType?`${d.pointerId}:${d.button}`:`${d.pointerType}`};h._removeState=function(d){const e=this._pointerId(d);this._pointerState.delete(e);this.stopCapturingPointer(d.native);this.refreshHasPendingInputs()};return m}(n.InputHandler);a.ImmediateDoubleClick=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/SingleAndDoubleClick":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/clock ../../../core/MapUtils ../../../core/maybe ../InputHandler ./support".split(" "),
function(a,b,c,n,l,u,v){const m={maximumDoubleClickDelay:250,maximumDoubleClickDistance:10,maximumDoubleTouchDelay:350,maximumDoubleTouchDistance:35};u=function(h){function d(g=m.maximumDoubleClickDelay,p=m.maximumDoubleClickDistance,t=m.maximumDoubleTouchDelay,q=m.maximumDoubleTouchDistance,k=c.clock){var r=h.call(this,!1)||this;r.maximumDoubleClickDelay=g;r.maximumDoubleClickDistance=p;r.maximumDoubleTouchDelay=t;r.maximumDoubleTouchDistance=q;r._clock=k;r._pointerState=new Map;r._click=r.registerOutgoing("click");
r._doubleClick=r.registerOutgoing("double-click");r.registerIncoming("immediate-click",r._handleImmediateClick.bind(b._assertThisInitialized(r)));r.registerIncoming("pointer-drag",r._handlePointerDrag.bind(b._assertThisInitialized(r)));r.registerIncoming("drag",r._handleDrag.bind(b._assertThisInitialized(r)));return r}b._inheritsLoose(d,h);var e=d.prototype;e.onUninstall=function(){this._pointerState.forEach(g=>g.doubleClickTimeout=l.removeMaybe(g.doubleClickTimeout))};e._pointerId=function(g){g=
g.native;return"mouse"===g.pointerType?`${g.pointerId}:${g.button}`:`${g.pointerType}`};e._handleImmediateClick=function(g){const p=g.data,t=this._pointerId(p),q=this._pointerState.get(t);if(q){const k="touch"===p.native.pointerType?this.maximumDoubleTouchDistance:this.maximumDoubleClickDistance;v.manhattanDistance(q.event.data,p)>k?(this._clearDoubleClickTimeout(t,!0),this._startClick(g)):(this._clearDoubleClickTimeout(t,!1),this._doubleClick.emit(q.event.data,void 0,q.event.modifiers))}else this._startClick(g)};
e._startClick=function(g){const p=this._pointerId(g.data);this._pointerState.set(p,{event:g,doubleClickTimeout:this._clock.setTimeout(()=>this._doubleClickTimeoutExceeded(p),"touch"===g.data.native.pointerType?this.maximumDoubleTouchDelay:this.maximumDoubleClickDelay)});this.refreshHasPendingInputs()};e._handlePointerDrag=function(g){g=this._pointerId(g.data.currentEvent);this._clearDoubleClickTimeout(g,!0)};e._handleDrag=function(g){g=this._pointerId(g.data.pointer);this._clearDoubleClickTimeout(g,
!0)};e._clearDoubleClickTimeout=function(g,p){const t=this._pointerState.get(g);t&&(t.doubleClickTimeout.remove(),t.doubleClickTimeout=null,p&&this._doubleClickTimeoutExceeded(g),this._pointerState.delete(g),this.refreshHasPendingInputs())};e._doubleClickTimeoutExceeded=function(g){const p=this._pointerState.get(g);this._click.emit(p.event.data,void 0,p.event.modifiers);p.doubleClickTimeout=null;this._pointerState.delete(g);this.refreshHasPendingInputs()};b._createClass(d,[{key:"hasPendingInputs",
get:function(){return n.someMap(this._pointerState,g=>null!=g.doubleClickTimeout)}}]);return d}(u.InputHandler);a.DefaultParameters=m;a.SingleAndDoubleClick=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/PointerClickHoldAndDrag":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/clock","../InputHandler","./support"],function(a,b,c,n,l){const u={maximumClickDelay:300,movementUntilMouseDrag:1.5,
movementUntilPenDrag:6,movementUntilTouchDrag:6,holdDelay:500};n=function(v){function m(d=u.maximumClickDelay,e=u.movementUntilMouseDrag,g=u.movementUntilPenDrag,p=u.movementUntilTouchDrag,t=u.holdDelay,q=c.clock){var k=v.call(this,!1)||this;k.maximumClickDelay=d;k.movementUntilMouseDrag=e;k.movementUntilPenDrag=g;k.movementUntilTouchDrag=p;k.holdDelay=t;k._clock=q;k._pointerState=new Map;k._pointerDrag=k.registerOutgoing("pointer-drag");k._immediateClick=k.registerOutgoing("immediate-click");k._pointerHold=
k.registerOutgoing("hold");k.registerIncoming("pointer-down",k._handlePointerDown.bind(b._assertThisInitialized(k)));k.registerIncoming("pointer-up",r=>{k._handlePointerLoss(r,"pointer-up")});k.registerIncoming("pointer-capture-lost",r=>{k._handlePointerLoss(r,"pointer-capture-lost")});k.registerIncoming("pointer-cancel",r=>{k._handlePointerLoss(r,"pointer-cancel")});k._moveHandle=k.registerIncoming("pointer-move",k._handlePointerMove.bind(b._assertThisInitialized(k)));k._moveHandle.pause();return k}
b._inheritsLoose(m,v);var h=m.prototype;h.onUninstall=function(){this._pointerState.forEach(d=>{null!=d.holdTimeout&&(d.holdTimeout.remove(),d.holdTimeout=null)});v.prototype.onUninstall.call(this)};h._handlePointerDown=function(d){const e=d.data,g=e.native.pointerId;var p=null;0===this._pointerState.size&&(p=this._clock.setTimeout(()=>{const t=this._pointerState.get(g);t&&(t.isDragging||(this._pointerHold.emit(t.previousEvent,void 0,d.modifiers),t.holdEmitted=!0),t.holdTimeout=null)},this.holdDelay));
p={startEvent:e,previousEvent:e,startTimestamp:d.timestamp,isDragging:!1,downButton:e.native.button,holdTimeout:p,modifiers:new Set};this._pointerState.set(g,p);this.startCapturingPointer(e.native);this._moveHandle.resume();1<this._pointerState.size&&this._startDragging(d)};h._createPointerDragData=function(d,e,g){return{action:d,startEvent:e.startEvent,previousEvent:e.previousEvent,currentEvent:g}};h._handlePointerMove=function(d){const e=d.data,g=this._pointerState.get(e.native.pointerId);if(g){if(g.isDragging)this._pointerDrag.emit(this._createPointerDragData("update",
g,e),void 0,g.modifiers);else{const p=l.euclideanDistance(e,g.startEvent),t=this._getDragThreshold(e.native.pointerType);p>t&&this._startDragging(d)}g.previousEvent=e}};h._getDragThreshold=function(d){switch(d){case "touch":return this.movementUntilTouchDrag;case "pen":return this.movementUntilPenDrag;default:return this.movementUntilMouseDrag}};h._startDragging=function(d){const e=d.data,g=e.native.pointerId;this._pointerState.forEach(p=>{null!=p.holdTimeout&&(p.holdTimeout.remove(),p.holdTimeout=
null);p.isDragging||(p.modifiers=d.modifiers,p.isDragging=!0,g===p.startEvent.native.pointerId?this._pointerDrag.emit(this._createPointerDragData("start",p,e)):this._pointerDrag.emit(this._createPointerDragData("start",p,p.previousEvent),d.timestamp))})};h._handlePointerLoss=function(d,e){const g=d.data,p=g.native.pointerId,t=this._pointerState.get(p);t&&(null!=t.holdTimeout&&(t.holdTimeout.remove(),t.holdTimeout=null),t.isDragging?this._pointerDrag.emit(this._createPointerDragData("end",t,"pointer-up"===
e?g:t.previousEvent),void 0,t.modifiers):"pointer-up"===e&&t.downButton===g.native.button&&d.timestamp-t.startTimestamp<=this.maximumClickDelay&&!t.holdEmitted&&this._immediateClick.emit(g),this._pointerState.delete(p),this.stopCapturingPointer(g.native),0===this._pointerState.size&&this._moveHandle.pause())};return m}(n.InputHandler);a.DefaultParameters=u;a.PointerClickHoldAndDrag=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/recognizers/VerticalTwoFingerDrag":function(){define(["exports",
"../../../chunks/_rollupPluginBabelHelpers","../DragEventSeparator","../InputHandler"],function(a,b,c,n){n=function(l){function u(m=20,h=40){var d=l.call(this,!1)||this;d._threshold=m;d._maxDelta=h;d.state="ready";d.emittedArtificalEnd2=!1;d._vertical=d.registerOutgoing("vertical-two-finger-drag");d._artificalDrag=d.registerOutgoing("drag");d.dragEventSeparator=new c.DragEventSeparator({start:(e,g)=>d._observeStart(e,g),update:(e,g,p)=>d._observeUpdate(e,g,p),end:(e,g)=>d._observeEnd(g)});d.registerIncoming("drag",
e=>d.dragEventSeparator.handle(e));return d}b._inheritsLoose(u,l);var v=u.prototype;v._observeStart=function(m,h){1===m&&this.emittedArtificalEnd2&&(this.emittedArtificalEnd2=!1,this._artificalDrag.emit({action:"start",button:h.data.button,buttons:h.data.buttons,pointerType:h.data.pointerType,timestamp:h.data.timestamp,pointers:h.data.pointers,pointer:h.data.pointer,angle:h.data.angle,radius:h.data.radius,center:h.data.center}),h.stopPropagation());this.state=2===m?"ready":"failed"};v._observeUpdate=
function(m,h,d){"failed"!==this.state&&2===m&&("active"===this.state?(this._vertical.emit({delta:h.data.center.y-this._thresholdReachedCenter.y,action:"update"}),h.stopPropagation()):this._checkMovementWithinLimits(h.data,d.data)?this._checkVerticalThresholdReached(h.data,d.data)&&(this.state="active",this.emittedArtificalEnd2=!0,this._thresholdReachedCenter=h.data.center,this._artificalDrag.emit({action:"end",button:h.data.button,buttons:h.data.buttons,pointerType:h.data.pointerType,timestamp:h.data.timestamp,
pointers:h.data.pointers,pointer:h.data.pointer,angle:h.data.angle,radius:h.data.radius,center:h.data.center}),this._vertical.emit({delta:h.data.center.y-this._thresholdReachedCenter.y,action:"begin"}),h.stopPropagation()):this.state="failed")};v._observeEnd=function(m){"active"===this.state&&(this._vertical.emit({delta:m.data.center.y-this._thresholdReachedCenter.y,action:"end"}),this.state="ready",m.stopPropagation())};v._checkMovementWithinLimits=function(m,h){let d=-Infinity,e=Infinity,g=-Infinity,
p=Infinity;h.pointers.forEach(y=>{d=Math.max(d,y.x);e=Math.min(e,y.x);g=Math.max(g,y.y);p=Math.min(p,y.y)});let t=-Infinity,q=Infinity,k=-Infinity,r=Infinity;m.pointers.forEach(y=>{t=Math.max(t,y.x);q=Math.min(q,y.x);k=Math.max(k,y.y);r=Math.min(r,y.y)});return Math.abs(m.center.x-h.center.x)<this._threshold&&Math.abs(t-q-(d-e))<=this._maxDelta&&Math.abs(k-r-(g-p))<=this._maxDelta};v._checkVerticalThresholdReached=function(m,h){let d=Math.abs(m.center.y-h.center.y);m.pointers.forEach((e,g)=>{g=h.pointers.get(g);
d=Math.min(d,Math.abs(e.y-g.y))});return d>=this._threshold};b._createClass(u,[{key:"failed",get:function(){return"failed"===this.state}}]);return u}(n.InputHandler);a.VerticalTwoFingerDrag=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/input/DragEventSeparator":function(){define(["exports"],function(a){let b=function(){function c(l){this.callbacks=l;this.currentCount=0;this.callbacks.condition||(this.callbacks.condition=()=>!0)}var n=c.prototype;
n.handle=function(l){const u=l.data,v=u.pointers.size;switch(u.action){case "start":this.currentCount=v;this._emitStart(l);break;case "added":this._emitEnd(this.previousEvent);this.currentCount=v;this._emitStart(l);break;case "update":this._emitUpdate(l);break;case "removed":this.startEvent&&this._emitEnd(this.previousEvent);this.currentCount=v;this._emitStart(l);break;case "end":this._emitEnd(l),this.currentCount=0}this.previousEvent=l};n._emitStart=function(l){this.startEvent=l;this.callbacks.condition(this.currentCount,
l)&&this.callbacks.start(this.currentCount,l,this.startEvent)};n._emitUpdate=function(l){this.callbacks.condition(this.currentCount,l)&&this.callbacks.update(this.currentCount,l,this.startEvent)};n._emitEnd=function(l){this.callbacks.condition(this.currentCount,l)&&this.callbacks.end(this.currentCount,l,this.startEvent);this.startEvent=null};return c}();a.DragEventSeparator=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/GraphicsDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/Logger ../../../../core/accessorSupport/ensureType ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/set ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/boundedPlane ./Deconflictor ./enums ./LabelDeconflictor ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){function f(z){z=z.layer;return!(!z||!z.featureReduction||"selection"!==z.featureReduction.type)}function w(z){(z=z.graphics3DGraphics)&&z.forEach(A=>A.clearVisibilityFlag(k.VisibilityFlag.DECONFLICTION))}a.GraphicsDeconflictor=function(z){function A(){var B=z.apply(this,arguments)||this;B._handles=new n;B._contexts=new Map;B._viewState=new q.DeconflictorViewState;B.visibilityGroup=k.VisibilityGroup.GRAPHIC;B._iconMarginFactor=-.1;return B}b._inheritsLoose(A,
z);var x=A.prototype;x.initialize=function(){this._handles.add([v.watch(()=>{var B,C;return null==(B=this.view)?void 0:null==(C=B.state)?void 0:C.camera},()=>{this._updateViewState();this.setDirty()}),v.watch(()=>{var B,C,D;return null==(B=this.view)?void 0:null==(C=B.map)?void 0:null==(D=C.ground)?void 0:D.opacity},(B,C)=>{1!==B&&1!==C||this.setDirty()}),v.watch(()=>{var B;return null==(B=this.view)?void 0:B.slicePlane},()=>{this._updateSlicePlane();this._slicePlaneChanged()},v.initial)]);this._frameTask=
this.view.resourceController.scheduler.registerTask(y.TaskPriority.GRAPHICS_DECONFLICTOR,this);this._labels=new r.LabelDeconflictor({view:this.view,parent:this})};x.destroy=function(){this._labels.destroy();this._labels=null;this._handles.destroy();this._handles=null;this._frameTask&&(this._frameTask.remove(),this._frameTask=null)};x.setDirty=function(){0<this._contexts.size&&(z.prototype.setDirty.call(this),this._labels.setDirty())};x.runTask=function(B){z.prototype.runTask.call(this,B);this.running||
this._labels.setDirty()};x.setInitialIconVisibilityFlag=function(B,C){B=!(this._graphicSupportsDeconfliction(C)&&f(B));C.setVisibilityFlag(k.VisibilityFlag.DECONFLICTION,B,k.VisibilityGroup.GRAPHIC)};x._updateViewState=function(){this.view&&this.view.state&&(this._viewState.camera.copyFrom(this.view.state.camera),this._updateSlicePlane())};x._updateSlicePlane=function(){const B=this.view?this.view.slicePlane:null;u.isSome(B)&&t.transform(B,this._viewState.camera.viewMatrix,this._viewState.slicePlane);
this._viewState.slicePlaneEnabled=u.isSome(B)};x._slicePlaneChanged=function(){l.someMap(this._contexts,(B,C)=>C.symbolCreationContext.slicePlaneEnabled)&&this.setDirty()};x.addGraphicsOwner=function(B){let C=this._contexts.get(B);null==C&&(C=new Map,this._contexts.set(B,C),this.setDirty());return{addGraphic:D=>this._addGraphic(B,C,D),removeGraphic:D=>this._removeGraphic(C,D),labelingInfoChange:()=>this._labels.enabledChanged(B,C),featureReductionChange:()=>this.enabledChanged(B,C),slicePlaneEnabledChange:()=>
this._slicePlaneEnabledChanged(B,C),clear:()=>C.forEach(D=>this._removeGraphic(C,D.graphics3DGraphic))}};x.removeGraphicsOwner=function(B){const C=this._contexts.get(B);C&&(C.forEach(D=>this._removeGraphic(C,D.graphics3DGraphic)),this._contexts.delete(B),this.setDirty())};x._addGraphic=function(B,C,D){const E=D.graphic.uid;D=new q.DeconflictorGraphic(D,B.symbolCreationContext.slicePlaneEnabled);C.set(E,D);f(B)&&this.addToActiveGraphics(D);B.labelsEnabled&&this._labels.addToActiveGraphics(D)};x._removeGraphic=
function(B,C){C=C.graphic.uid;const D=B.get(C);D&&(this.removeFromActiveGraphics(D),this._labels.removeFromActiveGraphics(D),B.delete(C),this.setDirty())};x.enabledChanged=function(B,C){const D=f(B);D||w(B);this.modifyGraphics(C,D)};x._slicePlaneEnabledChanged=function(B,C){const D=B.symbolCreationContext.slicePlaneEnabled;C.forEach(E=>E.slicePlaneEnabled=D);this.setDirty()};x.getGraphicsLayers=function(B){return B.graphics};x._graphicSupportsDeconfliction=function(B){if(B.isDraped)return!1;B=B.graphics;
if(!B||!B.length)return!1;for(const C of B)if(this.layerSupportsDeconfliction(C))return!0;return!1};b._createClass(A,[{key:"labels",get:function(){return this._labels}},{key:"viewState",get:function(){return this._viewState}},{key:"iconMarginFactor",get:function(){return this._iconMarginFactor},set:function(B){this._iconMarginFactor=B;this.setDirty()}}]);return A}(q.Deconflictor);a.GraphicsDeconflictor=c.__decorate([p.subclass("esri.views.3d.layers.graphics.GraphicsDeconflictor")],a.GraphicsDeconflictor);
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Deconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/mathUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../../../../chunks/boundedPlane ../../../../geometry/support/ray ../../../../chunks/sphere ./deconflictorDebug ./enums ../../support/debugFlags ../../webgl-engine/lib/Camera ../../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K){function*L(ia){if(Map.prototype.entries){ia=ia.entries();for(let ka=ia.next();!ka.done;ka=ia.next())yield ka.value[1]}else yield*ia.values()}function*R(ia,ka,la){ka.clear();ia.forEach((ca,Y)=>{const da=ka.pushNew();da.id=Y;da.prio=ca.info?-ca.info[la].distance:Number.MAX_VALUE});yield;const Z=ka.iterableSort((ca,Y)=>Y.prio-ca.prio);for(let ca=Z.next();!ca.done;ca=Z.next())yield;ka.forAll(ca=>{const Y=ia.get(ca.id);Y&&(ia.delete(ca.id),
ia.set(ca.id,Y))});ka.clear()}const M=r.create(),J=f.create(),I=f.create(),P=r.create(),N=t.create(),V=B.create(),S=x.create(),T=r.create(),H=z.create();let U=function(){this.aabr=z.create();this.distance=0;this.visible=this.culled=!1},W=function(){function ia(){this.active=new Map;this.visible=new Map}ia.prototype.clear=function(){this.active.clear();this.visible.clear()};return ia}(),Q=function(){},X=function(){this.sortArray=new v({allocator:ia=>ia||new Q})};a.State=void 0;(function(ia){ia[ia.Idle=
0]="Idle";ia[ia.Process=1]="Process";ia[ia.Sort=2]="Sort";ia[ia.Deconflict=3]="Deconflict";ia[ia.NumStates=4]="NumStates"})(a.State||(a.State={}));let ba=function(){function ia(){this.camera=new F.Camera;this.slicePlane=A.create();this.slicePlaneEnabled=!1}ia.prototype.copyFrom=function(ka){this.camera.copyFrom(ka.camera);A.copy(ka.slicePlane,this.slicePlane);this.slicePlaneEnabled=ka.slicePlaneEnabled};return ia}();a.Deconflictor=function(ia){function ka(){var Z=ia.apply(this,arguments)||this;Z._dirty=
!1;Z._runningViewState=new ba;Z._state=a.State.Idle;Z.graphics=new W;Z.iterators=new X;Z.accBinsNumX=15;Z.accBinsNumY=20;Z.accBinsSizeX=0;Z.accBinsSizeY=0;Z.accBins=null;Z.accNumTests=0;return Z}b._inheritsLoose(ka,ia);var la=ka.prototype;la.destroy=function(){this.graphics.clear();this.iterators=null};la.setDirty=function(){!this._dirty&&0<this.graphics.active.size&&(this._dirty=!0,this.notifyChange("updating"))};la.runTask=function(Z){switch(this._state){case a.State.Idle:this._startUpdate(),Z.madeProgress();
case a.State.Process:if(this._state=a.State.Process,!this._processActiveGraphics(Z))break;case a.State.Sort:if(this._state=a.State.Sort,!this._sortVisibleGraphics(Z))break;case a.State.Deconflict:if(this._state=a.State.Deconflict,!this._deconflictVisibleGraphics(Z))break;default:C.drawAccelerationStruct(this,this.graphics.visible),this._state=a.State.Idle,this.notifyChange("updating")}};la.modifyGraphics=function(Z,ca){ca?Z.forEach(Y=>this.addToActiveGraphics(Y)):Z.forEach(Y=>this.removeFromActiveGraphics(Y));
this.setDirty()};la.layerSupportsDeconfliction=function(Z){if(u.isNone(Z)||"object3d"!==Z.type)return!1;Z=Z.stageObject;return 1===(Z?Z.geometryRecords.length:0)&&Z.geometryRecords[0].material instanceof K.HUDMaterial?!0:!1};la._startUpdate=function(){C.prepare(this.view);this._dirty=!1;this._runningViewState.copyFrom(this.viewState);const {fullWidth:Z,fullHeight:ca}=this._runningViewState.camera;this._initBins(Z,ca);this._resetIterators()};la.addToActiveGraphics=function(Z){Z.info[this.visibilityGroup]=
new U;this.graphics.active.set(Z.graphics3DGraphic.graphic.uid,Z);this.setDirty()};la.removeFromActiveGraphics=function(Z){this._removeFromVisibleGraphics(Z);{const ca=Z.graphics3DGraphic;ca.destroyed||ca.clearVisibilityFlag(D.VisibilityFlag.DECONFLICTION,this.visibilityGroup)}delete Z.info[this.visibilityGroup];this.graphics.active.delete(Z.graphics3DGraphic.graphic.uid);this.setDirty()};la._addToVisibleGraphics=function(Z){this.graphics.visible.set(Z.graphics3DGraphic.graphic.uid,Z)};la._removeFromVisibleGraphics=
function(Z){this.graphics.visible.delete(Z.graphics3DGraphic.graphic.uid)};la._processActiveGraphics=function(Z){const ca=this._ensureActiveGraphicsIterator(),Y=p.invert(N,this._runningViewState.camera.projectionMatrix),da="global"===this.view.viewingMode&&1===this.view.map.ground.opacity&&0<this._runningViewState.camera.relativeElevation?V:null;let ha=0;u.isSome(da)&&(k.transformMat4(da,r.ZEROS,this._runningViewState.camera.viewMatrix),da[3]=w.getReferenceEllipsoid(this.view.spatialReference).radius,
ha=B.distanceToSilhouette(da,r.ZEROS));for(;!Z.done;){Z.madeProgress();var ja=ca.next();if(!0===ja.done)return this._resetActiveGraphicsIterator(),!0;const ma=(ja=ja.value)&&ja.info[this.visibilityGroup];ma&&(this._collectGraphics3DGraphics(ja,Y,da,ha),ma.culled?this._removeFromVisibleGraphics(ja):this._addToVisibleGraphics(ja))}return!1};la._sortVisibleGraphics=function(Z){const ca=this._ensureSortGraphicsIterator();for(;!Z.done;){const Y=ca.next();Z.madeProgress();if(!0===Y.done)return this._resetSortGraphicsIterator(),
!0}return!1};la._deconflictVisibleGraphics=function(Z){const ca=this._ensureVisibleGraphicsIterator(),Y=this.visibilityGroup===D.VisibilityGroup.LABEL;for(;!Z.done;){Z.madeProgress();var da=ca.next();if(!0===da.done)return this._resetVisibleGraphicsIterator(),!0;da=da.value;const ja=da.info[this.visibilityGroup];if(ja&&!ja.culled){var ha=da.graphics3DGraphic;(ha=(!Y||ha.isVisible())&&!this._isConflicted(da))&&this._addToBins(da);ja.visible=ha;this._setGraphicVisibility(da,ha);C.drawPoly(ja,ha)}}return!1};
la._resetIterators=function(){this.iterators.active=null;this.iterators.visible=null;this.iterators.sort=null};la._ensureActiveGraphicsIterator=function(){this.iterators.active||(this.iterators.active=L(this.graphics.active));return this.iterators.active};la._resetActiveGraphicsIterator=function(){this.iterators.active=null};la._ensureVisibleGraphicsIterator=function(){this.iterators.visible||(this.iterators.visible=L(this.graphics.visible));return this.iterators.visible};la._resetVisibleGraphicsIterator=
function(){this.iterators.visible=null};la._ensureSortGraphicsIterator=function(){this.iterators.sort||(this.iterators.sort=R(this.graphics.visible,this.iterators.sortArray,this.visibilityGroup));return this.iterators.sort};la._resetSortGraphicsIterator=function(){this.iterators.sort=null};la._collectGraphics3DGraphics=function(Z,ca,Y,da){var ha=Z.graphics3DGraphic;if(!ha.destroyed){var ja=Z.info[this.visibilityGroup];if(ha.isVisible(D.VisibilityGroup.GRAPHIC,D.VisibilityFlag.DECONFLICTION)){var ma=
this.getGraphicsLayers(ha);z.empty(ja.aabr);ha=null;for(const pa of ma)if(this.layerSupportsDeconfliction(pa)){ma=pa.stageObject.geometryRecords[0].material;if(u.isNone(ha)){ha=this._getProjectionInfo(pa,ca,ea);if(ha.isOutsideScreen||this._isCulledBySlice(Z,M)||u.isSome(Y)&&this._isCulledByHorizon(ha,Y,da)){ja.culled=!0;return}!E.TESTS_DISABLE_OPTIMIZATIONS&&ja.visible&&(ha.distance*=.7)}this._expandBoundingRect(ja,pa,ma,ha)}u.isNone(ha)?ja.culled=!0:(ja.distance=ha.distance,ja.culled=!1)}else ja.culled=
!0}};la._getProjectionInfo=function(Z,ca,Y){const da=this._runningViewState.camera;Z=Z.stageObject;var ha=Z.geometryRecords[0];const ja=ha.material;var ma=B.getCenter(Z.boundingVolumeWorldSpace.bounds);k.transformMat4(M,ma,da.viewMatrix);ma=ha.geometry.vertexAttributes;ha=ma.get(O.VertexAttribute.NORMAL).data;ma=ma.get(O.VertexAttribute.AUXPOS1).data;ja.applyShaderOffsetsView(M,ha,Z.transformation,ma,da,Y.scaleInfo,M);y.set(J,M[0],M[1],M[2],1);y.transformMat4(I,J,da.projectionMatrix);k.scale(Y.positionNDC,
I,1/I[3]);ja.applyShaderOffsetsNDC(Y.positionNDC,ma,da,Y.positionNDC,P);Y.distanceWithoutPolygonOffset=da.depthNDCToWorld(P[2]);Y.distance=P[2]===Y.positionNDC[2]?Y.distanceWithoutPolygonOffset:da.depthNDCToWorld(Y.positionNDC[2]);y.set(I,Y.positionNDC[0],Y.positionNDC[1],Y.positionNDC[2],1);y.transformMat4(J,I,ca);y.scale(J,J,1/J[3]);k.set(Y.positionView,M[0],M[1],M[2]);return Y};la._isCulledByHorizon=function(Z,ca,Y){k.copy(S.direction,Z.positionView);k.set(S.origin,0,0,0);return B.intersectRay(ca,
S,T)?Z.distanceWithoutPolygonOffset>Y:!1};la._isCulledBySlice=function(Z,ca){return Z.slicePlaneEnabled&&this._runningViewState.slicePlaneEnabled&&A.extrusionContainsPoint(this._runningViewState.slicePlane,ca)};la._expandBoundingRect=function(Z,ca,Y,{positionNDC:da,scaleInfo:ha}){const ja=this._runningViewState.camera;ca=ca.getScreenSize(aa);G.applyPrecomputedScaleFactor(ca,ha.factor,ca);ca[0]*=ja.pixelRatio;ca[1]*=ja.pixelRatio;Y=z.offset(Y.calculateRelativeScreenBounds(ca,ha.factorAlignment.scale,
H),l.lerp(0,ja.fullWidth,.5+.5*da[0]),l.lerp(0,ja.fullHeight,.5+.5*da[1]));da=this.iconMarginFactor;0!==da&&(da*=Math.min(z.width(Y),z.height(Y)),Y[0]-=da,Y[1]-=da,Y[2]+=da,Y[3]+=da);z.expand(Z.aabr,Y,Z.aabr)};la._isConflicted=function(Z){const ca=Z.graphics3DGraphic.graphic.uid;Z=Z.info[this.visibilityGroup];for(let Y=Math.floor(Z.aabr[0]/this.accBinsSizeX);Y<=Math.floor(Z.aabr[2]/this.accBinsSizeX);Y++)if(!(0>Y||Y>=this.accBinsNumX))for(let da=Math.floor(Z.aabr[1]/this.accBinsSizeY);da<=Math.floor(Z.aabr[3]/
this.accBinsSizeY);da++){if(0>da||da>=this.accBinsNumY)continue;const ha=this.accBins[Y][da];for(let ja=0;ja<ha.length;ja++){const ma=ha.data[ja],pa=ma.info[this.visibilityGroup];if(pa&&pa.visible&&ma.graphics3DGraphic.graphic.uid!==ca&&(this.accNumTests++,z.intersects(pa.aabr,Z.aabr)))return!0}}return!1};la._initBins=function(Z,ca){if(null==this.accBins){this.accBins=[];for(var Y=0;Y<this.accBinsNumX;Y++){this.accBins.push([]);var da=this.accBins[this.accBins.length-1];for(let ha=0;ha<this.accBinsNumY;ha++)da.push(new v)}}else for(Y=
0;Y<this.accBinsNumX;Y++)for(da=0;da<this.accBinsNumY;da++)this.accBins[Y][da].clear();this.accBinsSizeX=Z/this.accBinsNumX;this.accBinsSizeY=ca/this.accBinsNumY;this.accNumTests=0};la._addToBins=function(Z){var ca=Z.info[this.visibilityGroup],Y=Math.floor(ca.aabr[0]/this.accBinsSizeX);const da=Math.floor(ca.aabr[2]/this.accBinsSizeX),ha=Math.floor(ca.aabr[1]/this.accBinsSizeY);for(ca=Math.floor(ca.aabr[3]/this.accBinsSizeY);Y<=da;Y++)if(!(0>Y||Y>=this.accBinsNumX))for(let ja=ha;ja<=ca;ja++)0>ja||
ja>=this.accBinsNumY||this.accBins[Y][ja].push(Z)};la._setGraphicVisibility=function(Z,ca){Z=Z.graphics3DGraphic;Z.destroyed||(Z.setVisibilityFlag(D.VisibilityFlag.DECONFLICTION,ca,this.visibilityGroup),this.visibilityGroup===D.VisibilityGroup.LABEL&&this.view.labeler.setLabelGraphicVisibility(Z,ca))};b._createClass(ka,[{key:"dirty",get:function(){return this._dirty}},{key:"state",get:function(){return this._state}},{key:"updating",get:function(){return this._state!==a.State.Idle||this._dirty}},{key:"updatingProgress",
get:function(){if(!this.updating)return 1;const Z=this._state/a.State.NumStates;return this._dirty?.5*Z:Z}},{key:"running",get:function(){return this.view.ready&&null!=this.view.state&&this.updating}}]);return ka}(n);c.__decorate([m.property({constructOnly:!0})],a.Deconflictor.prototype,"view",void 0);c.__decorate([m.property({type:Boolean,readOnly:!0})],a.Deconflictor.prototype,"updating",null);a.Deconflictor=c.__decorate([g.subclass("esri.views.3d.layers.graphics.Deconflictor")],a.Deconflictor);
const aa=q.create(),ea=new (function(){function ia(){this.positionView=r.create();this.positionNDC=r.create();this.distanceWithoutPolygonOffset=this.distance=0;this.scaleInfo={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}}}b._createClass(ia,[{key:"isOutsideScreen",get:function(){const ka=this.positionNDC;return-1>ka[0]||-1>ka[1]||-1>ka[2]||1<=ka[0]||1<=ka[1]}}]);return ia}());a.DeconflictorGraphic=function(ia,ka,la={}){this.graphics3DGraphic=
ia;this.slicePlaneEnabled=ka;this.info=la};a.DeconflictorViewState=ba;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/deconflictorDebug":function(){define(["exports","../../support/debugFlags"],function(a,b){function c(e,g,p,t,q){m&&(m(),m=null);const k=h.height,r=d;r.beginPath();r.lineWidth=1;r.strokeStyle=q;r.moveTo(e,k-p);r.lineTo(g,k-p);r.stroke();r.lineTo(g,k-t);r.stroke();r.lineTo(g,k-p);r.stroke();r.lineTo(e,k-p);r.stroke();
r.lineTo(e,k-p);r.stroke();r.closePath()}let n=!1,l=!1,u=!1,v=!1,m=null,h,d;a.drawAccelerationStruct=function(e,g){if(l&&d){m&&(m(),m=null);var p=d,t=0;for(let q=0;q<e.accBinsNumX;q++)for(let k=0;k<e.accBinsNumY;k++){const r=e.accBins[q][e.accBinsNumY-1-k];t+=r.length;const y=q*e.accBinsSizeX,f=(q+1)*e.accBinsSizeX,w=k*e.accBinsSizeY,z=(k+1)*e.accBinsSizeY;p.fillText(r.length.toFixed(),y+5,w+15);c(y,f,w,z,"blue")}p.fillText("total totalShownLabels: "+t,70,40);p.fillText("total visible labels: "+g.size,
70,50);p.fillText("total numTests: "+e.accNumTests,70,30)}};a.drawPoly=function(e,g){n&&(g&&u||!g&&v)&&c(e.aabr[0],e.aabr[2],e.aabr[1],e.aabr[3],g?"green":"red")};a.prepare=function(e){u=b.DECONFLICTOR_SHOW_VISIBLE;v=b.DECONFLICTOR_SHOW_INVISIBLE;n=u||v;l=b.DECONFLICTOR_SHOW_GRID;m=null;n||l?m=()=>{{null==h&&(h=document.createElement("canvas"),h.setAttribute("id","canvas2d"),e.surface.parentElement.style.position="relative",e.surface.parentElement.appendChild(h));var {state:g}=e;const {camera:p,pixelRatio:t}=
g,{width:q,height:k}=p;g=k*t;h.setAttribute("width",`${q*t}px`);h.setAttribute("height",`${g}px`);h.setAttribute("style",`position:absolute;left:0px;top:0px;display:block;pointer-events:none;width:${q}px;height:${k}px`);d=h.getContext("2d");d.clearRect(0,0,q,k);d.font="12px Arial"}}:h&&(h.parentElement.removeChild(h),h=null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/debugFlags":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){c=function(h){function d(){var e=h.apply(this,arguments)||this;e.SCENEVIEW_HITTEST_RETURN_INTERSECTOR=!1;e.DECONFLICTOR_SHOW_VISIBLE=!1;e.DECONFLICTOR_SHOW_INVISIBLE=!1;e.DECONFLICTOR_SHOW_GRID=!1;e.LABELS_SHOW_BORDER=!1;e.TEXT_SHOW_BASELINE=!1;e.TEXT_SHOW_BORDER=!1;e.OVERLAY_DRAW_DEBUG_TEXTURE=!1;e.OVERLAY_SHOW_CENTER=!1;e.SHOW_POI=!1;e.TESTS_DISABLE_OPTIMIZATIONS=!1;e.TESTS_DISABLE_FAST_UPDATES=!1;e.DRAW_MESH_GEOMETRY_NORMALS=!1;e.FEATURE_TILE_FETCH_SHOW_TILES=!1;e.FEATURE_TILE_TREE_SHOW_TILES=
!1;e.TERRAIN_TILE_TREE_SHOW_TILES=!1;e.I3S_TREE_SHOW_TILES=!1;e.I3S_SHOW_MODIFICATIONS=!1;e.LOD_INSTANCE_RENDERER_DISABLE_UPDATES=!1;e.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL=!1;e.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES=!1;e.LINE_WIREFRAMES=!1;return e}a._inheritsLoose(d,h);return d}(c);b.__decorate([n.property()],c.prototype,"SCENEVIEW_HITTEST_RETURN_INTERSECTOR",void 0);b.__decorate([n.property()],c.prototype,"DECONFLICTOR_SHOW_VISIBLE",void 0);b.__decorate([n.property()],c.prototype,"DECONFLICTOR_SHOW_INVISIBLE",
void 0);b.__decorate([n.property()],c.prototype,"DECONFLICTOR_SHOW_GRID",void 0);b.__decorate([n.property()],c.prototype,"LABELS_SHOW_BORDER",void 0);b.__decorate([n.property()],c.prototype,"TEXT_SHOW_BASELINE",void 0);b.__decorate([n.property()],c.prototype,"TEXT_SHOW_BORDER",void 0);b.__decorate([n.property()],c.prototype,"OVERLAY_DRAW_DEBUG_TEXTURE",void 0);b.__decorate([n.property()],c.prototype,"OVERLAY_SHOW_CENTER",void 0);b.__decorate([n.property()],c.prototype,"SHOW_POI",void 0);b.__decorate([n.property()],
c.prototype,"TESTS_DISABLE_OPTIMIZATIONS",void 0);b.__decorate([n.property()],c.prototype,"TESTS_DISABLE_FAST_UPDATES",void 0);b.__decorate([n.property()],c.prototype,"DRAW_MESH_GEOMETRY_NORMALS",void 0);b.__decorate([n.property()],c.prototype,"FEATURE_TILE_FETCH_SHOW_TILES",void 0);b.__decorate([n.property()],c.prototype,"FEATURE_TILE_TREE_SHOW_TILES",void 0);b.__decorate([n.property()],c.prototype,"TERRAIN_TILE_TREE_SHOW_TILES",void 0);b.__decorate([n.property()],c.prototype,"I3S_TREE_SHOW_TILES",
void 0);b.__decorate([n.property()],c.prototype,"I3S_SHOW_MODIFICATIONS",void 0);b.__decorate([n.property()],c.prototype,"LOD_INSTANCE_RENDERER_DISABLE_UPDATES",void 0);b.__decorate([n.property()],c.prototype,"LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL",void 0);b.__decorate([n.property()],c.prototype,"EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES",void 0);b.__decorate([n.property()],c.prototype,"LINE_WIREFRAMES",void 0);c=b.__decorate([m.subclass("esri.views.3d.support.DebugFlags")],c);return new c})},"esri/views/3d/layers/graphics/enums":function(){define(["exports"],
function(a){a.VisibilityGroup=void 0;(function(b){b[b.GRAPHIC=0]="GRAPHIC";b[b.LABEL=1]="LABEL";b[b._COUNT=2]="_COUNT"})(a.VisibilityGroup||(a.VisibilityGroup={}));a.VisibilityFlag=void 0;(function(b){b[b.USER_SETTING=0]="USER_SETTING";b[b.SCALE_RANGE=1]="SCALE_RANGE";b[b.FILTER=2]="FILTER";b[b.DECONFLICTION=3]="DECONFLICTION";b[b._COUNT=4]="_COUNT"})(a.VisibilityFlag||(a.VisibilityFlag={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/screenSizePerspectiveUtils":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../ViewingMode"],function(a,b,c,n){function l(g,p,t){const q=t.parameters;t=t.paddingPixelsOverride;d.scale=Math.min(q.divisor/(p-q.offset),1);d.factor=Math.abs(g*g*g);d.minPixelSize=q.minPixelSize;d.paddingPixels=t;return d}function u(g,p){return 0===g?p.minPixelSize:p.minPixelSize*(1+2*p.paddingPixels/g)}function v(g,p){return Math.max(c.lerp(g*p.scale,g,p.factor),u(g,p))}let m=function(){function g(t,q,k,r={camera:{distance:0,
fovY:0},divisor:0,offset:0,minPixelSize:0,paddingPixels:0},y){this.viewingMode=t;this.description=q;this.ellipsoidRadius=k;this.parameters=r;this._paddingPixelsOverride=y;this.viewingMode===n.ViewingMode.Local?(this.coverageCompensation=this._surfaceCoverageCompensationLocal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersLocal):(this.coverageCompensation=this._surfaceCoverageCompensationGlobal,this.calculateCurvatureDependentParameters=this._calculateCurvatureDependentParametersGlobal)}
var p=g.prototype;p.update=function(t){if(this.parameters&&this.parameters.camera.fovY===t.fovY&&this.parameters.camera.distance===t.distance)return!1;this._calculateParameters(t,this.ellipsoidRadius,this.parameters);return!0};p.overridePadding=function(t){return t!==this.paddingPixelsOverride?new g(this.viewingMode,this.description,this.ellipsoidRadius,this.parameters,t):this};p._calculateParameters=function(t,q,k){const {scaleStart:r,scaleFallOffRange:y,minPixelSize:f}=this.description,{fovY:w,
distance:z}=t;var A=this.calculateCurvatureDependentParameters(t,q);q=this.coverageCompensation(t,q,A);const {tiltAngle:x,scaleFallOffFactor:B}=A,C=Math.sin(x)*z,D=.5*Math.PI-x-w*(.5-r*q);A=C/Math.cos(D);q=(A-C/Math.cos(D+w*y*q)*B)/(1-B);k.camera.fovY=t.fovY;k.camera.distance=t.distance;k.offset=q;k.divisor=A-q;k.minPixelSize=f;return k};p._calculateCurvatureDependentParametersLocal=function(t,q,k=e){k.tiltAngle=this.description.curvatureDependent.min.tiltAngle;k.scaleFallOffFactor=this.description.curvatureDependent.min.scaleFallOffFactor;
return k};p._calculateCurvatureDependentParametersGlobal=function(t,q,k=e){const r=this.description.curvatureDependent;t=1+t.distance/q;t=Math.sqrt(t*t-1);const [y,f]=[r.min.curvature,r.max.curvature];t=c.clamp((t-y)/(f-y),0,1);const [w,z]=[r.min,r.max];k.tiltAngle=c.lerp(w.tiltAngle,z.tiltAngle,t);k.scaleFallOffFactor=c.lerp(w.scaleFallOffFactor,z.scaleFallOffFactor,t);return k};p._surfaceCoverageCompensationLocal=function(t,q,k){return(t.fovY-k.tiltAngle)/t.fovY};p._surfaceCoverageCompensationGlobal=
function(t,q,k){const r=q*q;k=k.tiltAngle+.5*Math.PI;const {fovY:y,distance:f}=t;t=f*f+r-2*Math.cos(k)*f*q;const w=Math.sqrt(t);return(Math.acos(Math.sqrt(t-r)/w)-Math.asin(q/(w/Math.sin(k)))+.5*y)/y};b._createClass(g,[{key:"paddingPixelsOverride",get:function(){return this._paddingPixelsOverride||this.parameters.paddingPixels}}]);return g}();const h={curvatureDependent:{min:{curvature:c.deg2rad(10),tiltAngle:c.deg2rad(12),scaleFallOffFactor:.5},max:{curvature:c.deg2rad(70),tiltAngle:c.deg2rad(40),
scaleFallOffFactor:.8}},scaleStart:.3,scaleFallOffRange:.65,minPixelSize:0},d={scale:0,factor:0,minPixelSize:0,paddingPixels:0},e={tiltAngle:0,scaleFallOffFactor:0};a.applyPrecomputedScaleFactor=function(g,p,t=[0,0]){p=Math.min(Math.max(p.scale,u(g[1],p)/Math.max(1E-5,g[1])),1);t[0]=g[0]*p;t[1]=g[1]*p;return t};a.applyScaleFactor=v;a.getLabelSettings=function(g,p){const {curvatureDependent:t,scaleStart:q,scaleFallOffRange:k}=h;return new m(g,{curvatureDependent:{min:{curvature:t.min.curvature,tiltAngle:t.min.tiltAngle,
scaleFallOffFactor:.7},max:{curvature:t.max.curvature,tiltAngle:t.max.tiltAngle,scaleFallOffFactor:.95}},scaleStart:q,scaleFallOffRange:k,minPixelSize:14},p)};a.getSettings=function(g,p){return new m(g,h,p)};a.precomputeScaleFactor=function(g,p,t,q){g=l(g,p,t);g.minPixelSize=0;g.paddingPixels=0;g=v(1,g);q.scale=g;q.factor=0;q.minPixelSize=t.parameters.minPixelSize;q.paddingPixels=t.paddingPixelsOverride};a.scale=function(g,p,t,q){return v(g,l(p,t,q))};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/HUDMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../core/libs/gl-matrix-2/types/mat4 ../../../../geometry/support/aaBoundingRect ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/geometryDataUtils ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/screenSizePerspectiveUtils ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/MaterialUtil ./renderers/utils ../../../../chunks/HUDMaterial.glsl ../shaders/HUDMaterialTechnique ../shaders/HUDMaterialTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K){function L(Y,da,ha,ja=N){h.copy(ja,Y.anchorPosition);ja[0]*=-da[0];ja[1]*=-da[1];ja[0]+=Y.screenOffset[0]*ha;ja[1]+=Y.screenOffset[1]*ha;return ja}function R(Y,da,ha,ja,ma,pa,na,wa){da=da-ma-(0<wa[0]?ja[0]*wa[0]:0);let xa=da+ja[0]+2*ma;ha=ha-ma-(0<wa[1]?ja[1]*wa[1]:0);ma=ha+ja[1]+2*ma;wa=na.distanceFieldBoundingBox;na.textureIsSignedDistanceField&&n.isSome(wa)&&(da+=ja[0]*wa[0],ha+=ja[1]*wa[1],xa-=ja[0]*(1-wa[2]),ma-=ja[1]*(1-
wa[3]),da-=pa,xa+=pa,ha-=pa,ma+=pa);return Y[0]>da&&Y[0]<xa&&Y[1]>ha&&Y[1]<ma}let M=function(Y){function da(ja){ja=Y.call(this,ja,new la)||this;ja.techniqueConfig=new K.HUDMaterialTechniqueConfiguration;return ja}b._inheritsLoose(da,Y);var ha=da.prototype;ha.getConfiguration=function(ja,ma){this.techniqueConfig.output=ja;this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasVerticalOffset=!!this.parameters.verticalOffset;this.techniqueConfig.hasScreenSizePerspective=
!!this.parameters.screenSizePerspective;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?y.HUDSpace.Screen:y.HUDSpace.World;this.techniqueConfig.hasPolygonOffset=this.parameters.polygonOffset;this.techniqueConfig.isDraped=this.parameters.isDraped;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.pixelSnappingEnabled=this.parameters.pixelSnappingEnabled;this.techniqueConfig.signedDistanceFieldEnabled=this.parameters.textureIsSignedDistanceField;
this.techniqueConfig.vvSize=!!this.parameters.vvSizeEnabled;this.techniqueConfig.vvColor=!!this.parameters.vvColorEnabled;ja===r.ShaderOutput.Color&&(this.techniqueConfig.debugDrawLabelBorder=!!this.parameters.debugDrawLabelBorder);ja===r.ShaderOutput.Highlight&&(this.techniqueConfig.binaryHighlightOcclusionEnabled=this.parameters.binaryHighlightOcclusion);this.techniqueConfig.depthEnabled=this.parameters.depthEnabled;this.techniqueConfig.transparencyPassType=ma.transparencyPassType;this.techniqueConfig.hasMultipassGeometry=
ma.multipassGeometry.enabled;this.techniqueConfig.hasMultipassTerrain=ma.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=ma.multipassTerrain.cullAboveGround;return this.techniqueConfig};ha.intersect=function(ja,ma,pa,na,wa,xa,sa,ya,ra){n.isSome(ra)?this._intersectDrapedHudGeometry(ja,xa,sa,ya,ra):this._intersectHudGeometry(ja,ma,pa,na,sa,ya)};ha._intersectDrapedHudGeometry=function(ja,ma,pa,na,wa){const xa=ja.vertexAttributes.get(C.VertexAttribute.POSITION),sa=ja.vertexAttributes.get(C.VertexAttribute.SIZE),
ya=this.parameters,ra=G.calculateAnchorPosForRendering(ya);let ua=1;var Ba=1;n.isSome(na)&&(Ba=na(ea),ua=Ba[0],Ba=Ba[5]);ua*=ja.screenToWorldRatio;Ba*=ja.screenToWorldRatio;na=2*ja.screenToWorldRatio;for(let Ja=0;Ja<xa.data.length/xa.size;Ja++){var Ea=Ja*xa.size;const va=xa.data[Ea];Ea=xa.data[Ea+1];const Ca=Ja*sa.size;ia[0]=sa.data[Ca]*ua;ia[1]=sa.data[Ca+1]*Ba;let Ka;ya.textureIsSignedDistanceField&&(Ka=ya.outlineSize*ja.screenToWorldRatio/2);R(ma,va,Ea,ia,na,Ka,ya,ra)&&pa(wa.dist,wa.normal,-1,
!1)}};ha._intersectHudGeometry=function(ja,ma,pa,na,wa,xa){if(na.options.selectionMode&&na.options.hud&&!F.isInstanceHidden(ma)){ma=this.parameters;var sa=1,ya=1;l.fromMat4(W,pa);if(n.isSome(xa)){ya=xa(ea);sa=ya[0];ya=ya[5];{xa=W;var ra=xa[0],ua=xa[1],Ba=xa[2],Ea=xa[3],Ja=xa[4],va=xa[5],Ca=xa[6],Ka=xa[7],Oa=xa[8],Ra=1/Math.sqrt(ra*ra+ua*ua+Ba*Ba);const Pa=1/Math.sqrt(Ea*Ea+Ja*Ja+va*va),qa=1/Math.sqrt(Ca*Ca+Ka*Ka+Oa*Oa);xa[0]=ra*Ra;xa[1]=ua*Ra;xa[2]=Ba*Ra;xa[3]=Ea*Pa;xa[4]=Ja*Pa;xa[5]=va*Pa;xa[6]=
Ca*qa;xa[7]=Ka*qa;xa[8]=Oa*qa}}xa=ja.vertexAttributes.get(C.VertexAttribute.POSITION);ra=ja.vertexAttributes.get(C.VertexAttribute.SIZE);ua=ja.vertexAttributes.get(C.VertexAttribute.NORMAL);ja=ja.vertexAttributes.get(C.VertexAttribute.AUXPOS1);B.assert(3<=xa.size);Ba=na.point;Ea=na.camera;Ja=G.calculateAnchorPosForRendering(ma);sa*=Ea.pixelRatio;ya*=Ea.pixelRatio;va="screen"===this.parameters.centerOffsetUnits;for(Ca=0;Ca<xa.data.length/xa.size;Ca++)if(Ka=Ca*xa.size,e.set(V,xa.data[Ka],xa.data[Ka+
1],xa.data[Ka+2]),e.transformMat4(V,V,pa),Ka=Ca*ra.size,ia[0]=ra.data[Ka]*sa,ia[1]=ra.data[Ka+1]*ya,e.transformMat4(V,V,Ea.viewMatrix),Ka=Ca*ja.size,e.set(ba,ja.data[Ka+0],ja.data[Ka+1],ja.data[Ka+2]),va||(V[0]+=ba[0],V[1]+=ba[1],0!==ba[2]&&(Ka=ba[2],e.normalize(ba,V),e.subtract(V,V,e.scale(ba,ba,Ka)))),Ka=Ca*ua.size,e.set(S,ua.data[Ka],ua.data[Ka+1],ua.data[Ka+2]),this._normalAndViewAngle(S,W,Ea,aa),this._applyVerticalOffsetTransformationView(V,aa,Ea,P),Ea.applyProjection(V,T),-1<T[0]){T[0]=Math.floor(T[0]);
T[1]=Math.floor(T[1]);va&&(ba[0]||ba[1])&&(T[0]+=ba[0],0!==ba[1]&&(T[1]+=x.applyScaleFactor(ba[1],P.factorAlignment)),Ea.unapplyProjection(T,V));T[0]+=this.parameters.screenOffset[0];T[1]+=this.parameters.screenOffset[1];x.applyPrecomputedScaleFactor(ia,P.factor,ia);Ka=1*Ea.pixelRatio;let Pa;ma.textureIsSignedDistanceField&&(Pa=ma.outlineSize*Ea.pixelRatio/2);R(Ba,T[0],T[1],ia,Ka,Pa,ma,Ja)&&(Oa=na.ray,e.transformMat4(U,V,v.invert(X,Ea.viewMatrix)),T[0]=Ba[0],T[1]=Ba[1],Ea.unprojectFromRenderScreen(T,
V)&&(Ka=g.create(),e.copy(Ka,Oa.direction),Ra=1/e.length(Ka),e.scale(Ka,Ka,Ra),Oa=e.distance(Oa.origin,V)*Ra,wa(Oa,Ka,-1,!0,1,U)))}}};ha.computeAttachmentOrigin=function(ja,ma){var pa=ja.vertexAttributes;if(!pa)return!1;pa=pa.get(C.VertexAttribute.POSITION);ja=ja.indices.get(C.VertexAttribute.POSITION);return f.computeAttachmentOriginPoints(pa,ja,ma)};ha.createBufferWriter=function(){return new ca(this)};ha._normalAndViewAngle=function(ja,ma,pa,na){t.isMat4(ma)&&(ma=l.fromMat4(Q,ma));e.transformMat3(na.normal,
ja,ma);e.transformMat4(na.normal,na.normal,pa.viewInverseTransposeMatrix);na.cosAngle=e.dot(H,ka);return na};ha._updateScaleInfo=function(ja,ma,pa){const na=this.parameters;n.isSome(na.screenSizePerspective)?x.precomputeScaleFactor(pa,ma,na.screenSizePerspective,ja.factor):(ja.factor.scale=1,ja.factor.factor=0,ja.factor.minPixelSize=0,ja.factor.paddingPixels=0);n.isSome(na.screenSizePerspectiveAlignment)?x.precomputeScaleFactor(pa,ma,na.screenSizePerspectiveAlignment,ja.factorAlignment):(ja.factorAlignment.factor=
ja.factor.factor,ja.factorAlignment.scale=ja.factor.scale,ja.factorAlignment.minPixelSize=ja.factor.minPixelSize,ja.factorAlignment.paddingPixels=ja.factor.paddingPixels)};ha.applyShaderOffsetsView=function(ja,ma,pa,na,wa,xa,sa){ma=this._normalAndViewAngle(ma,pa,wa,aa);this._applyVerticalGroundOffsetView(ja,ma,wa,sa);this._applyVerticalOffsetTransformationView(sa,ma,wa,xa);this._applyPolygonOffsetView(sa,ma,na[3],wa,sa);this._applyCenterOffsetView(sa,na,sa);return sa};ha.applyShaderOffsetsNDC=function(ja,
ma,pa,na,wa){this._applyCenterOffsetNDC(ja,ma,pa,na);n.isSome(wa)&&e.copy(wa,na);this._applyPolygonOffsetNDC(na,ma,pa,na);return na};ha._applyPolygonOffsetView=function(ja,ma,pa,na,wa){var xa=na.aboveGround?1:-1;pa=Math.sign(pa);0===pa&&(pa=xa);xa*=pa;if(0>=this.parameters.shaderPolygonOffset)return e.copy(wa,ja);ma=c.clamp(Math.abs(ma.cosAngle),.01,1);na=1-Math.sqrt(1-ma*ma)/ma/na.viewport[2];0<xa?e.scale(wa,ja,na):e.scale(wa,ja,1/na);return wa};ha._applyVerticalGroundOffsetView=function(ja,ma,pa,
na){const wa=e.length(ja),xa=pa.aboveGround?1:-1;pa=.5*pa.computeRenderPixelSizeAtDist(wa);ma=e.scale(V,ma.normal,xa*pa);e.add(na,ja,ma);return na};ha._applyVerticalOffsetTransformationView=function(ja,ma,pa,na){const wa=this.parameters;if(!wa.verticalOffset||!wa.verticalOffset.screenLength){if(wa.screenSizePerspective||wa.screenSizePerspectiveAlignment){var xa=e.length(ja);this._updateScaleInfo(na,xa,ma.cosAngle)}else na.factor.scale=1,na.factorAlignment.scale=1;return ja}xa=e.length(ja);const sa=
n.unwrapOr(wa.screenSizePerspectiveAlignment,wa.screenSizePerspective);pa=E.verticalOffsetAtDistance(pa,xa,wa.verticalOffset,ma.cosAngle,sa);this._updateScaleInfo(na,xa,ma.cosAngle);e.scale(ma.normal,ma.normal,pa);return e.add(ja,ja,ma.normal)};ha._applyCenterOffsetView=function(ja,ma,pa){const na="screen"!==this.parameters.centerOffsetUnits;pa!==ja&&e.copy(pa,ja);na&&(pa[0]+=ma[0],pa[1]+=ma[1],ma[2]&&(e.normalize(S,pa),e.add(pa,pa,e.scale(S,S,ma[2]))));return pa};ha._applyCenterOffsetNDC=function(ja,
ma,pa,na){const wa="screen"!==this.parameters.centerOffsetUnits;na!==ja&&e.copy(na,ja);wa||(na[0]+=ma[0]/pa.fullWidth*2,na[1]+=ma[1]/pa.fullHeight*2);return na};ha._applyPolygonOffsetNDC=function(ja,ma,pa,na){const wa=this.parameters.shaderPolygonOffset;ja!==na&&e.copy(na,ja);wa&&(ja=pa.aboveGround?1:-1,na[2]-=(ja*Math.sign(ma[3])||ja)*wa);return na};ha.requiresSlot=function(ja){if(ja===A.RenderSlot.DRAPED_MATERIAL)return!0;const {drawInSecondSlot:ma,occlusionTest:pa}=this.parameters;return ja===
(ma?A.RenderSlot.LABEL_MATERIAL:A.RenderSlot.HUD_MATERIAL)||pa&&ja===A.RenderSlot.OCCLUSION_PIXELS};ha.createGLMaterial=function(ja){return ja.output===r.ShaderOutput.Color||ja.output===r.ShaderOutput.Alpha?new I(ja):ja.output===r.ShaderOutput.Highlight?new J(ja):null};ha.calculateRelativeScreenBounds=function(ja,ma,pa=q.create()){L(this.parameters,ja,ma,pa);pa[2]=pa[0]+ja[0];pa[3]=pa[1]+ja[1];return pa};return da}(z.Material),J=function(Y){function da(ja){return Y.call(this,{...ja,...ja.material.parameters})||
this}b._inheritsLoose(da,Y);var ha=da.prototype;ha.selectProgram=function(ja){return this.ensureTechnique(O.HUDMaterialTechnique,ja)};ha.beginSlot=function(ja){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.selectProgram(ja)};return da}(w.GLTextureMaterial),I=function(Y){function da(){return Y.apply(this,arguments)||this}b._inheritsLoose(da,Y);var ha=da.prototype;ha._isOcclusionSlot=function(ja){return ja.slot===A.RenderSlot.OCCLUSION_PIXELS&&
this._material.parameters.occlusionTest&&(this._output===r.ShaderOutput.Color||this._output===r.ShaderOutput.Alpha)};ha.selectProgram=function(ja){return this.ensureTechnique(O.HUDMaterialTechnique,ja,this._isOcclusionSlot(ja)?r.ShaderOutput.Occlusion:this._output)};return da}(J);const P={factor:{scale:0,factor:0,minPixelSize:0,paddingPixels:0},factorAlignment:{scale:0,factor:0,minPixelSize:0,paddingPixels:0}},N=d.create(),V=g.create(),S=g.create(),T=p.create(),H=g.create(),U=g.create(),W=u.create(),
Q=u.create(),X=m.create(),ba=g.create(),aa={normal:H,cosAngle:0},ea=m.create(),ia=[0,0],ka=g.fromValues(0,0,1);let la=function(Y){function da(){var ha=Y.apply(this,arguments)||this;ha.renderOccluded=z.RenderOccludedFlag.Occlude;ha.color=[1,1,1,1];ha.texCoordScale=[1,1];ha.polygonOffset=!1;ha.anchorPosition=d.fromValues(.5,.5);ha.screenOffset=[0,0];ha.shaderPolygonOffset=1E-5;ha.textureIsSignedDistanceField=!1;ha.outlineColor=[1,1,1,1];ha.outlineSize=0;ha.vvSizeEnabled=!1;ha.vvSizeMinSize=[1,1,1];
ha.vvSizeMaxSize=[100,100,100];ha.vvSizeOffset=[0,0,0];ha.vvSizeFactor=[1,1,1];ha.vvColorEnabled=!1;ha.vvColorValues=[0,0,0,0,0,0,0,0];ha.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];ha.hasSlicePlane=!1;ha.pixelSnappingEnabled=!0;ha.occlusionTest=!0;ha.binaryHighlightOcclusion=!0;ha.debugDrawLabelBorder=!1;ha.centerOffsetUnits="world";ha.drawInSecondSlot=!1;ha.depthEnabled=!0;ha.isDraped=!1;return ha}b._inheritsLoose(da,Y);return da}(w.GLTextureMaterialBindParameters);
const Z=k.newLayout().vec3f(C.VertexAttribute.POSITION).vec3f(C.VertexAttribute.NORMAL).vec2f(C.VertexAttribute.UV0).vec4u8(C.VertexAttribute.COLOR).vec2f(C.VertexAttribute.SIZE).vec4f(C.VertexAttribute.AUXPOS1).vec4f(C.VertexAttribute.AUXPOS2);let ca=function(){function Y(ha){this.material=ha;this.vertexBufferLayout=Z}var da=Y.prototype;da.allocate=function(ha){return this.vertexBufferLayout.createBuffer(ha)};da.elementCount=function(ha){return 6*ha.indices.get(C.VertexAttribute.POSITION).length};
da.write=function(ha,ja,ma,pa){D.writePosition(ja.indices.get(C.VertexAttribute.POSITION),ja.vertexAttributes.get(C.VertexAttribute.POSITION).data,ha.transformation,ma.position,pa,6);D.writeNormal(ja.indices.get(C.VertexAttribute.NORMAL),ja.vertexAttributes.get(C.VertexAttribute.NORMAL).data,ha.invTranspTransformation,ma.normal,pa,6);var na=ja.vertexAttributes.get(C.VertexAttribute.UV0).data;if(null==na||4>na.length){na=this.material.parameters;var wa=ha=0;var xa=na.texCoordScale[0];na=na.texCoordScale[1]}else ha=
na[0],wa=na[1],xa=na[2],na=na[3];xa=Math.min(1.99999,xa+1);na=Math.min(1.99999,na+1);var sa=ja.indices.get(C.VertexAttribute.POSITION).length,ya=ma.uv0,ra=pa;for(var ua=0;ua<sa;++ua)ya.set(ra,0,ha),ya.set(ra,1,wa),ra+=1,ya.set(ra,0,xa),ya.set(ra,1,wa),ra+=1,ya.set(ra,0,xa),ya.set(ra,1,na),ra+=1,ya.set(ra,0,xa),ya.set(ra,1,na),ra+=1,ya.set(ra,0,ha),ya.set(ra,1,na),ra+=1,ya.set(ra,0,ha),ya.set(ra,1,wa),ra+=1;D.writeColor(ja.indices.get(C.VertexAttribute.COLOR),ja.vertexAttributes.get(C.VertexAttribute.COLOR).data,
4,ma.color,pa,6);ha=ja.indices.get(C.VertexAttribute.SIZE);wa=ja.vertexAttributes.get(C.VertexAttribute.SIZE).data;xa=ha.length;na=ma.size;sa=pa;for(ya=0;ya<xa;++ya){ra=wa[2*ha[ya]];ua=wa[2*ha[ya]+1];for(let Ba=0;6>Ba;++Ba)na.set(sa,0,ra),na.set(sa,1,ua),sa+=1}ja.indices.get(C.VertexAttribute.AUXPOS1)&&ja.vertexAttributes.get(C.VertexAttribute.AUXPOS1)&&D.writeBufferVec4(ja.indices.get(C.VertexAttribute.AUXPOS1),ja.vertexAttributes.get(C.VertexAttribute.AUXPOS1).data,ma.auxpos1,pa,6);ja.indices.get(C.VertexAttribute.AUXPOS2)&&
ja.vertexAttributes.get(C.VertexAttribute.AUXPOS2)&&D.writeBufferVec4(ja.indices.get(C.VertexAttribute.AUXPOS2),ja.vertexAttributes.get(C.VertexAttribute.AUXPOS2).data,ma.auxpos2,pa,6)};return Y}();a.HUDMaterial=M;a.Parameters=la;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/libs/gl-matrix-2/types/mat4":function(){define(["exports"],function(a){function b(n){return n instanceof Float32Array&&16<=n.length}function c(n){return Array.isArray(n)&&
16<=n.length}a.isMat4=function(n){return b(n)||c(n)};a.isMat4f32=b;a.isMat4f64=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions":function(){define(["exports"],function(a){a.ShaderOutput=void 0;var b=a.ShaderOutput||(a.ShaderOutput={});b[b.Color=0]="Color";b[b.Depth=1]="Depth";b[b.Normal=2]="Normal";b[b.Shadow=3]="Shadow";b[b.Highlight=4]="Highlight";b[b.Draped=5]="Draped";b[b.Occlusion=
6]="Occlusion";b[b.Alpha=7]="Alpha";b[b.COUNT=8]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl":function(){define("exports ../attributes/VerticalOffset.glsl ./HUDUniforms ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../shaderModules/Texture2DPassUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){a.HUDSpace=void 0;(function(g){g[g.World=0]="World";g[g.Screen=1]="Screen";g[g.COUNT=2]="COUNT"})(a.HUDSpace||(a.HUDSpace={}));a.HUD=function(g,p){g.include(n.ScreenSizePerspective);g.attributes.add(e.VertexAttribute.POSITION,"vec3");g.attributes.add(e.VertexAttribute.NORMAL,"vec3");g.attributes.add(e.VertexAttribute.AUXPOS1,"vec4");const t=g.vertex;l.addProjViewLocalOrigin(g,p);l.addCameraPosition(t,p);t.uniforms.add([new u.Float4PassUniform("viewport",(q,k)=>k.camera.fullViewport),
new v.FloatPassUniform("polygonOffset",q=>q.shaderPolygonOffset),new v.FloatPassUniform("cameraGroundRelative",(q,k)=>k.camera.aboveGround?1:-1),new v.FloatPassUniform("renderTransparentlyOccludedHUD",(q,k)=>k.renderTransparentlyOccludedHUD===c.HUDTransparentRenderStyle.Occluded?1:k.renderTransparentlyOccludedHUD===c.HUDTransparentRenderStyle.NotOccluded?0:.75),new d.Texture2DPassUniform("hudVisibilityTexture",(q,k)=>k.hudVisibilityTexture)]);p.hasVerticalOffset&&b.addVerticalOffset(t);t.constants.add("smallOffsetAngle",
"float",.984807753012208);t.code.add(m.glsl`struct ProjectHUDAux {
vec3 posModel;
vec3 posView;
vec3 vnormal;
float distanceToCamera;
float absCosAngle;
};`);t.code.add(m.glsl`float applyHUDViewDependentPolygonOffset(float pointGroundDistance, float absCosAngle, inout vec3 posView) {
float pointGroundSign = sign(pointGroundDistance);
if (pointGroundSign == 0.0) {
pointGroundSign = cameraGroundRelative;
}
float groundRelative = cameraGroundRelative * pointGroundSign;
if (polygonOffset > .0) {
float cosAlpha = clamp(absCosAngle, 0.01, 1.0);
float tanAlpha = sqrt(1.0 - cosAlpha * cosAlpha) / cosAlpha;
float factor = (1.0 - tanAlpha / viewport[2]);
if (groundRelative > 0.0) {
posView *= factor;
}
else {
posView /= factor;
}
}
return groundRelative;
}`);p.isDraped&&!p.hasVerticalOffset||t.uniforms.add(new h.Matrix4PassUniform("viewNormal",(q,k)=>k.camera.viewInverseTransposeMatrix));p.isDraped||(t.uniforms.add(new v.FloatPassUniform("perDistancePixelRatio",(q,k)=>Math.tan(k.camera.fovY/2)/(k.camera.fullViewport[2]/2))),t.code.add(m.glsl`void applyHUDVerticalGroundOffset(vec3 normalModel, inout vec3 posModel, inout vec3 posView) {
float distanceToCamera = length(posView);
float pixelOffset = distanceToCamera * perDistancePixelRatio * 0.5;
vec3 modelOffset = normalModel * cameraGroundRelative * pixelOffset;
vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
posModel += modelOffset;
posView += viewOffset;
}`));p.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen&&t.uniforms.add(new v.FloatPassUniform("pixelRatio",(q,k)=>k.camera.pixelRatio));p.hasScreenSizePerspective&&n.addScreenSizePerspectiveAlignment(t);t.code.add(m.glsl`
    vec4 projectPositionHUD(out ProjectHUDAux aux) {
      // centerOffset is in view space and is used to implement world size offsetting
      // of labels with respect to objects. It also pulls the label towards the viewer
      // so that the label is visible in front of the object.
      vec3 centerOffset = auxpos1.xyz;

      // The pointGroundDistance is the distance of the geometry to the ground and is
      // negative if the point is below the ground, or positive if the point is above
      // ground.
      float pointGroundDistance = auxpos1.w;

      aux.posModel = position;
      aux.posView = (view * vec4(aux.posModel, 1.0)).xyz;
      aux.vnormal = normal;
      ${p.isDraped?"":"applyHUDVerticalGroundOffset(aux.vnormal, aux.posModel, aux.posView);"}

      // Screen sized offset in world space, used for example for line callouts
      // Note: keep this implementation in sync with the CPU implementation, see
      //   - MaterialUtil.verticalOffsetAtDistance
      //   - HUDMaterial.applyVerticalOffsetTransformation

      aux.distanceToCamera = length(aux.posView);

      vec3 viewDirObjSpace = normalize(cameraPosition - aux.posModel);
      float cosAngle = dot(aux.vnormal, viewDirObjSpace);

      aux.absCosAngle = abs(cosAngle);

      ${p.hasScreenSizePerspective?p.hasVerticalOffset||p.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"vec4 perspectiveFactor \x3d screenSizePerspectiveScaleFactor(aux.absCosAngle, aux.distanceToCamera, screenSizePerspectiveAlignment);":"":""}

      ${p.hasVerticalOffset?p.hasScreenSizePerspective?"float verticalOffsetScreenHeight \x3d applyScreenSizePerspectiveScaleFactorFloat(verticalOffset.x, perspectiveFactor);":"float verticalOffsetScreenHeight \x3d verticalOffset.x;":""}

      ${p.hasVerticalOffset?m.glsl`
            float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * aux.distanceToCamera, verticalOffset.z, verticalOffset.w);
            vec3 modelOffset = aux.vnormal * worldOffset;
            aux.posModel += modelOffset;
            vec3 viewOffset = (viewNormal * vec4(modelOffset, 1.0)).xyz;
            aux.posView += viewOffset;
            // Since we elevate the object, we need to take that into account
            // in the distance to ground
            pointGroundDistance += worldOffset;`:""}

      float groundRelative = applyHUDViewDependentPolygonOffset(pointGroundDistance, aux.absCosAngle, aux.posView);

      ${p.screenCenterOffsetUnitsEnabled!==a.HUDSpace.Screen?m.glsl`
            // Apply x/y in view space, but z in screen space (i.e. along posView direction)
            aux.posView += vec3(centerOffset.x, centerOffset.y, 0.0);

            // Same material all have same z != 0.0 condition so should not lead to
            // branch fragmentation and will save a normalization if it's not needed
            if (centerOffset.z != 0.0) {
              aux.posView -= normalize(aux.posView) * centerOffset.z;
            }
          `:""}

      vec4 posProj = proj * vec4(aux.posView, 1.0);

      ${p.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?p.hasScreenSizePerspective?"float centerOffsetY \x3d applyScreenSizePerspectiveScaleFactorFloat(centerOffset.y, perspectiveFactor);":"float centerOffsetY \x3d centerOffset.y;":""}

      ${p.screenCenterOffsetUnitsEnabled===a.HUDSpace.Screen?"posProj.xy +\x3d vec2(centerOffset.x, centerOffsetY) * pixelRatio * 2.0 / viewport.zw * posProj.w;":""}

      // constant part of polygon offset emulation
      posProj.z -= groundRelative * polygonOffset * posProj.w;
      return posProj;
    }
  `);t.code.add(m.glsl`bool testVisibilityHUD(vec4 posProj) {
vec4 posProjCenter = alignToPixelCenter(posProj, viewport.zw);
vec4 occlusionPixel = texture2D(hudVisibilityTexture, .5 + .5 * posProjCenter.xy / posProjCenter.w);
if (renderTransparentlyOccludedHUD > 0.5) {
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g * renderTransparentlyOccludedHUD < 1.0;
}
return occlusionPixel.r * occlusionPixel.g > 0.0 && occlusionPixel.g == 1.0;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../util/ScreenSizePerspective.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),function(a,b,c,n,l,u,v){function m(d){d.uniforms.add(new u.Float4PassUniform("verticalOffset",(e,g)=>
{const {minWorldLength:p,maxWorldLength:t,screenLength:q}=e.verticalOffset;return b.set(h,q*(g.camera.pixelRatio||1),Math.tan(.5*g.camera.fovY)/(.5*g.camera.fullViewport[3]),p,t)}))}const h=c.create();a.VerticalOffset=function(d,e){const g=d.vertex;e.hasVerticalOffset?(m(g),e.hasScreenSizePerspective&&(d.include(n.ScreenSizePerspective),n.addScreenSizePerspectiveAlignment(g),l.addCameraPosition(d.vertex,e)),g.code.add(v.glsl`
      vec3 calculateVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        float viewDistance = length((view * vec4(worldPos, 1.0)).xyz);
        ${e.spherical?v.glsl`vec3 worldNormal = normalize(worldPos + localOrigin);`:v.glsl`vec3 worldNormal = vec3(0.0, 0.0, 1.0);`}
        ${e.hasScreenSizePerspective?v.glsl`
            float cosAngle = dot(worldNormal, normalize(worldPos - cameraPosition));
            float verticalOffsetScreenHeight = screenSizePerspectiveScaleFloat(verticalOffset.x, abs(cosAngle), viewDistance, screenSizePerspectiveAlignment);`:v.glsl`
            float verticalOffsetScreenHeight = verticalOffset.x;`}
        // Screen sized offset in world space, used for example for line callouts
        float worldOffset = clamp(verticalOffsetScreenHeight * verticalOffset.y * viewDistance, verticalOffset.z, verticalOffset.w);
        return worldNormal * worldOffset;
      }

      vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) {
        return worldPos + calculateVerticalOffset(worldPos, localOrigin);
      }
    `)):g.code.add(v.glsl`vec3 addVerticalOffset(vec3 worldPos, vec3 localOrigin) { return worldPos; }`)};a.addVerticalOffset=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl":function(){define(["exports","../../../../../../chunks/vec4","../../../../../../chunks/vec4f64","../../shaderModules/Float4PassUniform","../../shaderModules/interfaces"],function(a,b,c,n,l){function u(m){return b.set(v,
m.parameters.divisor,m.parameters.offset,m.parameters.minPixelSize,m.paddingPixelsOverride)}const v=c.create();a.ScreenSizePerspective=function(m){m.vertex.code.add(l.glsl`float screenSizePerspectiveMinSize(float size, vec4 factor) {
float nonZeroSize = 1.0 - step(size, 0.0);
return (
factor.z * (
1.0 +
nonZeroSize *
2.0 * factor.w / (
size + (1.0 - nonZeroSize)
)
)
);
}`);m.vertex.code.add(l.glsl`float screenSizePerspectiveViewAngleDependentFactor(float absCosAngle) {
return absCosAngle * absCosAngle * absCosAngle;
}`);m.vertex.code.add(l.glsl`vec4 screenSizePerspectiveScaleFactor(float absCosAngle, float distanceToCamera, vec4 params) {
return vec4(
min(params.x / (distanceToCamera - params.y), 1.0),
screenSizePerspectiveViewAngleDependentFactor(absCosAngle),
params.z,
params.w
);
}`);m.vertex.code.add(l.glsl`float applyScreenSizePerspectiveScaleFactorFloat(float size, vec4 factor) {
return max(mix(size * factor.x, size, factor.y), screenSizePerspectiveMinSize(size, factor));
}`);m.vertex.code.add(l.glsl`float screenSizePerspectiveScaleFloat(float size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorFloat(
size,
screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params)
);
}`);m.vertex.code.add(l.glsl`vec2 applyScreenSizePerspectiveScaleFactorVec2(vec2 size, vec4 factor) {
return mix(size * clamp(factor.x, screenSizePerspectiveMinSize(size.y, factor) / max(1e-5, size.y), 1.0), size, factor.y);
}`);m.vertex.code.add(l.glsl`vec2 screenSizePerspectiveScaleVec2(vec2 size, float absCosAngle, float distanceToCamera, vec4 params) {
return applyScreenSizePerspectiveScaleFactorVec2(size, screenSizePerspectiveScaleFactor(absCosAngle, distanceToCamera, params));
}`)};a.addScreenSizePerspective=function(m){m.uniforms.add(new n.Float4PassUniform("screenSizePerspective",h=>u(h.screenSizePerspective)))};a.addScreenSizePerspectiveAlignment=function(m){m.uniforms.add(new n.Float4PassUniform("screenSizePerspectiveAlignment",h=>u(h.screenSizePerspectiveAlignment||h.screenSizePerspective)))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/View.glsl":function(){define("exports ../../../../../../chunks/mat4 ../../../../../../chunks/mat4f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Matrix4DrawUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h){const d=c.create(),e=l.create();a.addCameraPosition=function(g,p){p.instancedDoublePrecision?g.constants.add("cameraPosition","vec3",l.ZEROS):g.uniforms.add(new u.Float3DrawUniform("cameraPosition",(t,q)=>n.set(e,q.camera.viewInverseTransposeMatrix[3]-t.origin[0],q.camera.viewInverseTransposeMatrix[7]-t.origin[1],q.camera.viewInverseTransposeMatrix[11]-t.origin[2])))};a.addProjViewLocalOrigin=function(g,p){g.vertex.uniforms.add(new h.Matrix4PassUniform("proj",(t,q)=>q.camera.projectionMatrix));
if(p.instancedDoublePrecision){const t=(q,k)=>n.set(e,k.camera.viewInverseTransposeMatrix[3],k.camera.viewInverseTransposeMatrix[7],k.camera.viewInverseTransposeMatrix[11]);g.vertex.uniforms.add(new h.Matrix4PassUniform("view",(q,k)=>b.translate(d,k.camera.viewMatrix,t(q,k))));p=new v.Float3PassUniform("localOrigin",t);g.vertex.uniforms.add(p);return p}g.vertex.uniforms.add(new m.Matrix4DrawUniform("view",(t,q)=>b.translate(d,q.camera.viewMatrix,t.origin)));p=new u.Float3DrawUniform("localOrigin",
t=>t.origin);g.vertex.uniforms.add(p);return p};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"mat4",n.BindType.Draw,(h,d,e)=>h.setUniformMatrix4fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);
a.Matrix4DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDUniforms":function(){define(["exports"],function(a){a.HUDTransparentRenderStyle=void 0;var b=a.HUDTransparentRenderStyle||(a.HUDTransparentRenderStyle={});b[b.Occluded=0]="Occluded";b[b.NotOccluded=1]="NotOccluded";b[b.Both=2]="Both";b[b.COUNT=3]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/Material":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderModules/interfaces ./ContentObject ./ContentObjectType ./DefaultVertexAttributeLocations ../materials/internal/MaterialUtil".split(" "),function(a,b,c,n,l,u,v,m){l=function(h){function d(g,p){var t=h.call(this)||this;t.type=u.ContentObjectType.Material;t.supportsEdges=!1;t._visible=!0;t._renderPriority=0;t._insertOrder=0;t._vertexAttributeLocations=
v.Default3D;t._parameters=m.copyParameters(g,p);t.validateParameters(t._parameters);return t}b._inheritsLoose(d,h);var e=d.prototype;e.dispose=function(){};e.update=function(g){return!1};e.setParameters=function(g,p=!0){m.updateParameters(this._parameters,g)&&(this.validateParameters(this._parameters),p&&this.parametersChanged())};e.validateParameters=function(g){};e.shouldRender=function(g){return this.isVisible()&&this.isVisibleInPass(g.pass)&&0!==(this.renderOccluded&g.renderOccludedMask)};e.isVisibleInPass=
function(g){return!0};e.isVisible=function(){return this._visible};e.parametersChanged=function(){c.isSome(this.repository)&&this.repository.materialChanged(this)};b._createClass(d,[{key:"parameters",get:function(){return this._parameters}},{key:"visible",get:function(){return this._visible},set:function(g){g!==this._visible&&(this._visible=g,this.parametersChanged())}},{key:"renderOccluded",get:function(){return this.parameters.renderOccluded}},{key:"renderPriority",get:function(){return this._renderPriority},
set:function(g){g!==this._renderPriority&&(this._renderPriority=g,this.parametersChanged())}},{key:"insertOrder",get:function(){return this._insertOrder},set:function(g){g!==this._insertOrder&&(this._insertOrder=g,this.parametersChanged())}},{key:"vertexAttributeLocations",get:function(){return this._vertexAttributeLocations}}]);return d}(l.ContentObject);a.RenderOccludedFlag=void 0;(function(h){h[h.Occlude=1]="Occlude";h[h.Transparent=2]="Transparent";h[h.OccludeAndTransparent=4]="OccludeAndTransparent";
h[h.OccludeAndTransparentStencil=8]="OccludeAndTransparentStencil";h[h.Opaque=16]="Opaque"})(a.RenderOccludedFlag||(a.RenderOccludedFlag={}));n=function(h){function d(){var e=h.apply(this,arguments)||this;e.renderOccluded=a.RenderOccludedFlag.Occlude;return e}b._inheritsLoose(d,h);return d}(n.NoParameters);a.Material=l;a.MaterialParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/MaterialUtil":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../lib/basicInterfaces ../../lib/screenSizePerspectiveUtils ../../lib/Util ../../lib/VertexAttribute ../renderers/utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){function p(D,E,F,G,O,K){if(!n.isNone(D)){var L=k(E,F,A);v.setMin(z,D.getBBMin());v.setMax(z,D.getBBMax());n.isSome(O)&&O.applyToAabb(z);if(r(z,E,L,G)){const {primitiveIndices:R,indices:M,position:J}=D;L=R?R.length:M.length/3;if(1E3<L&&(D=D.getChildren(),void 0!==D)){for(L=0;8>L;++L)void 0!==D[L]&&p(D[L],E,F,G,O,K);return}t(E,F,0,L,M,J,R,O,K)}}}function t(D,E,F,G,O,K,L,R,M){if(L){var J=K.data;K=K.stride||K.size;var I=D[0],P=D[1];D=D[2];var N=E[0]-I,V=E[1]-P;for(E=
E[2]-D;F<G;++F){var S=L[F],T=3*S,H=K*O[T++],U=J[H++],W=J[H++],Q=J[H];H=K*O[T++];var X=J[H++],ba=J[H++],aa=J[H];H=K*O[T];T=J[H++];var ea=J[H++];H=J[H];n.isSome(R)&&([U,W,Q]=R.applyToVertex(U,W,Q,F),[X,ba,aa]=R.applyToVertex(X,ba,aa,F),[T,ea,H]=R.applyToVertex(T,ea,H,F));X-=U;ba-=W;aa-=Q;T-=U;ea-=W;H-=Q;var ia=V*H-ea*E,ka=E*T-H*N;const Z=N*ea-T*V;var la=X*ia+ba*ka+aa*Z;if(!(Math.abs(la)<=Number.EPSILON)){U=I-U;W=P-W;Q=D-Q;ia=U*ia+W*ka+Q*Z;if(0<la){if(0>ia||ia>la)continue}else if(0<ia||ia<la)continue;
ka=W*aa-ba*Q;Q=Q*X-aa*U;W=U*ba-X*W;U=N*ka+V*Q+E*W;if(0<la){if(0>U||ia+U>la)continue}else if(0<U||ia+U<la)continue;Q=(T*ka+ea*Q+H*W)/la;0<=Q&&(X=q(X,ba,aa,T,ea,H,x),M(Q,X,S,!1))}}}else{L=K.data;J=K.stride||K.size;K=D[0];I=D[1];P=D[2];D=E[0]-K;N=E[1]-I;V=E[2]-P;for(let Z=F,ca=3*F;Z<G;++Z)if(T=J*O[ca++],W=L[T++],Q=L[T++],aa=L[T],T=J*O[ca++],E=L[T++],F=L[T++],S=L[T],T=J*O[ca++],X=L[T++],ba=L[T++],T=L[T],n.isSome(R)&&([W,Q,aa]=R.applyToVertex(W,Q,aa,Z),[E,F,S]=R.applyToVertex(E,F,S,Z),[X,ba,T]=R.applyToVertex(X,
ba,T,Z)),E-=W,F-=Q,S-=aa,X-=W,ba-=Q,T-=aa,H=N*T-ba*V,U=V*X-T*D,la=D*ba-X*N,ea=E*H+F*U+S*la,!(Math.abs(ea)<=Number.EPSILON)){W=K-W;Q=I-Q;aa=P-aa;H=W*H+Q*U+aa*la;if(0<ea){if(0>H||H>ea)continue}else if(0<H||H<ea)continue;U=Q*S-F*aa;aa=aa*E-S*W;Q=W*F-E*Q;W=D*U+N*aa+V*Q;if(0<ea){if(0>W||H+W>ea)continue}else if(0<W||H+W<ea)continue;aa=(X*U+ba*aa+T*Q)/ea;0<=aa&&(E=q(E,F,S,X,ba,T,x),M(aa,E,Z,!1))}}}function q(D,E,F,G,O,K,L){l.set(B,D,E,F);l.set(C,G,O,K);l.cross(L,B,C);l.normalize(L,L);return L}function k(D,
E,F){return l.set(F,1/(E[0]-D[0]),1/(E[1]-D[1]),1/(E[2]-D[2]))}function r(D,E,F,G){return y(D,E,F,G,Infinity)}function y(D,E,F,G,O){var K=(D[0]-G-E[0])*F[0],L=(D[3]+G-E[0])*F[0];let R=Math.min(K,L);K=Math.max(K,L);L=(D[1]-G-E[1])*F[1];const M=(D[4]+G-E[1])*F[1];K=Math.min(K,Math.max(L,M));if(0>K)return!1;R=Math.max(R,Math.min(L,M));if(R>K)return!1;L=(D[2]-G-E[2])*F[2];D=(D[5]+G-E[2])*F[2];K=Math.min(K,Math.max(L,D));if(0>K)return!1;R=Math.max(R,Math.min(L,D));return R>K?!1:R<O}function f(D,E){E=E?
f(E):{};for(const F in D){let G=D[F];G&&G.forEach&&(G=w(G));null==G&&F in E||(E[F]=G)}return E}function w(D){const E=[];D.forEach(F=>E.push(F));return E}const z=v.create(),A=u.create(),x=u.create(),B=u.create(),C=u.create();a.colorMixModes={multiply:1,ignore:2,replace:3,tint:4};a.computeInvDir=k;a.computeNormal=q;a.copyParameters=f;a.intersectAabbInvDir=r;a.intersectAabbInvDirBefore=y;a.intersectDrapedRenderLineGeometry=function(D,E,F,G,O,K){if(E.options.selectionMode){E=D.vertexAttributes.get(e.VertexAttribute.POSITION).data;
var L=D.vertexAttributes.get(e.VertexAttribute.SIZE),R=G[0];G=G[1];D=(((L&&L.data[0])+O)/2+4)*D.screenToWorldRatio;O=Number.MAX_VALUE;L=0;for(let N=0;N<E.length-5;N+=3){var M=E[N],J=E[N+1],I=R-M,P=G-J;M=E[N+3]-M;J=E[N+4]-J;const V=c.clamp((M*I+J*P)/(M*M+J*J),0,1);I=M*V-I;P=J*V-P;P=I*I+P*P;P<O&&(O=P,L=N/3)}O<D*D&&K(F.dist,F.normal,L,!1)}};a.intersectTriangleGeometry=function(D,E,F,G,O,K,L){g.isInstanceHidden(E)||(D.boundingInfo?(d.assert(D.primitiveType===m.PrimitiveType.Triangle),p(D.boundingInfo,
G,O,F.tolerance,K,L)):(E=D.indices.get(e.VertexAttribute.POSITION),D=D.vertexAttributes.get(e.VertexAttribute.POSITION),t(G,O,0,E.length/3,E,D,void 0,K,L)))};a.intersectTriangles=t;a.updateParameters=function(D,E){let F=!1;for(const G in E){const O=E[G];void 0!==O&&(Array.isArray(O)?null===D[G]?(D[G]=O.slice(),F=!0):b.update(D[G],O)&&(F=!0):D[G]!==O&&(F=!0,D[G]=O))}return F};a.verticalOffsetAtDistance=function(D,E,F,G,O){let K=(F.screenLength||0)*D.pixelRatio;n.isSome(O)&&(K=h.scale(K,G,E,O));return c.clamp(K*
Math.tan(.5*D.fovY)/(.5*D.fullHeight)*E,F.minWorldLength||0,null!=F.maxWorldLength?F.maxWorldLength:Infinity)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/bufferWriterUtils":function(){define(["exports","../../../../../chunks/mat4","../../../../../geometry/support/buffer/BufferView","../../lib/Util","../../lib/VertexAttribute"],function(a,b,c,n,l){function u(p,t,q,k){const r=q.typedBuffer;q=q.typedBufferStride;
const y=p.length;k*=q;for(let f=0;f<y;++f){const w=2*p[f];r[k]=t[w];r[k+1]=t[w+1];k+=q}}function v(p,t,q,k,r){const y=q.typedBuffer;q=q.typedBufferStride;const f=p.length;k*=q;if(null==r||1===r)for(r=0;r<f;++r){var w=3*p[r];y[k]=t[w];y[k+1]=t[w+1];y[k+2]=t[w+2];k+=q}else for(w=0;w<f;++w){const z=3*p[w];for(let A=0;A<r;++A)y[k]=t[z],y[k+1]=t[z+1],y[k+2]=t[z+2],k+=q}}function m(p,t,q,k,r=1){const y=q.typedBuffer;q=q.typedBufferStride;const f=p.length;k*=q;if(1===r)for(r=0;r<f;++r){var w=4*p[r];y[k]=
t[w];y[k+1]=t[w+1];y[k+2]=t[w+2];y[k+3]=t[w+3];k+=q}else for(w=0;w<f;++w){const z=4*p[w];for(let A=0;A<r;++A)y[k]=t[z],y[k+1]=t[z+1],y[k+2]=t[z+2],y[k+3]=t[z+3],k+=q}}function h(p,t,q,k,r,y=1){if(q){var f=k.typedBuffer;k=k.typedBufferStride;var w=p.length,z=q[0],A=q[1],x=q[2],B=q[4],C=q[5],D=q[6],E=q[8],F=q[9],G=q[10],O=q[12],K=q[13];q=q[14];r*=k;if(1===y)for(y=0;y<w;++y){var L=3*p[y],R=t[L],M=t[L+1];L=t[L+2];f[r]=z*R+B*M+E*L+O;f[r+1]=A*R+C*M+F*L+K;f[r+2]=x*R+D*M+G*L+q;r+=k}else for(R=0;R<w;++R){M=
3*p[R];var J=t[M],I=t[M+1];const P=t[M+2];M=z*J+B*I+E*P+O;L=A*J+C*I+F*P+K;J=x*J+D*I+G*P+q;for(I=0;I<y;++I)f[r]=M,f[r+1]=L,f[r+2]=J,r+=k}}else v(p,t,k,r,y)}function d(p,t,q,k,r,y=1){if(q){var f=k.typedBuffer;k=k.typedBufferStride;var w=p.length,z=q[0],A=q[1],x=q[2],B=q[4],C=q[5],D=q[6],E=q[8],F=q[9],G=q[10];q=!b.isOrthoNormal(q);r*=k;if(1===y)for(y=0;y<w;++y){var O=3*p[y],K=t[O],L=t[O+1],R=t[O+2];O=z*K+B*L+E*R;var M=A*K+C*L+F*R;K=x*K+D*L+G*R;q&&(L=O*O+M*M+K*K,.999999>L&&1E-6<L&&(L=1/Math.sqrt(L),O*=
L,M*=L,K*=L));f[r+0]=O;f[r+1]=M;f[r+2]=K;r+=k}else for(O=0;O<w;++O){M=3*p[O];L=t[M];R=t[M+1];const J=t[M+2];M=z*L+B*R+E*J;K=A*L+C*R+F*J;L=x*L+D*R+G*J;q&&(R=M*M+K*K+L*L,.999999>R&&1E-6<R&&(R=1/Math.sqrt(R),M*=R,K*=R,L*=R));for(R=0;R<y;++R)f[r+0]=M,f[r+1]=K,f[r+2]=L,r+=k}}else v(p,t,k,r,y)}function e(p,t,q,k,r,y=1){if(q){var f=k.typedBuffer;k=k.typedBufferStride;var w=p.length,z=q[0],A=q[1],x=q[2],B=q[4],C=q[5],D=q[6],E=q[8],F=q[9],G=q[10];q=!b.isOrthoNormal(q);r*=k;if(1===y)for(y=0;y<w;++y){var O=
4*p[y],K=t[O],L=t[O+1],R=t[O+2];O=t[O+3];var M=z*K+B*L+E*R,J=A*K+C*L+F*R;K=x*K+D*L+G*R;q&&(L=M*M+J*J+K*K,.999999>L&&1E-6<L&&(L=1/Math.sqrt(L),M*=L,J*=L,K*=L));f[r+0]=M;f[r+1]=J;f[r+2]=K;f[r+3]=O;r+=k}else for(O=0;O<w;++O){M=4*p[O];L=t[M];R=t[M+1];const I=t[M+2];M=t[M+3];J=z*L+B*R+E*I;K=A*L+C*R+F*I;L=x*L+D*R+G*I;q&&(R=J*J+K*K+L*L,.999999>R&&1E-6<R&&(R=1/Math.sqrt(R),J*=R,K*=R,L*=R));for(R=0;R<y;++R)f[r+0]=J,f[r+1]=K,f[r+2]=L,f[r+3]=M,r+=k}}else m(p,t,k,r,y)}function g(p,t,q,k,r,y=1){const f=k.typedBuffer;
k=k.typedBufferStride;const w=p.length;r*=k;if(1===y)if(4===q)for(y=0;y<w;++y)q=4*p[y],f[r]=t[q],f[r+1]=t[q+1],f[r+2]=t[q+2],f[r+3]=t[q+3],r+=k;else{if(3===q)for(y=0;y<w;++y)q=3*p[y],f[r]=t[q],f[r+1]=t[q+1],f[r+2]=t[q+2],f[r+3]=255,r+=k}else if(4===q)for(q=0;q<w;++q){var z=4*p[q];for(var A=0;A<y;++A)f[r]=t[z],f[r+1]=t[z+1],f[r+2]=t[z+2],f[r+3]=t[z+3],r+=k}else if(3===q)for(q=0;q<w;++q)for(z=3*p[q],A=0;A<y;++A)f[r]=t[z],f[r+1]=t[z+1],f[r+2]=t[z+2],f[r+3]=255,r+=k}a.writeBufferFloat=function(p,t,q,
k,r=1){const y=q.typedBuffer;q=q.typedBufferStride;const f=p.length;k*=q;if(1===r)for(r=0;r<f;++r)y[k]=t[p[r]],k+=q;else for(let w=0;w<f;++w){const z=t[p[w]];for(let A=0;A<r;A++)y[k]=z,k+=q}};a.writeBufferMat3f=function(p,t,q,k){const r=q.typedBuffer;q=q.typedBufferStride;const y=p.length;k*=q;for(let f=0;f<y;++f){const w=9*p[f];for(let z=0;9>z;++z)r[k+z]=t[w+z];k+=q}};a.writeBufferMat4f=function(p,t,q,k){const r=q.typedBuffer;q=q.typedBufferStride;const y=p.length;k*=q;for(let f=0;f<y;++f){const w=
16*p[f];for(let z=0;16>z;++z)r[k+z]=t[w+z];k+=q}};a.writeBufferVec2=u;a.writeBufferVec3=v;a.writeBufferVec4=m;a.writeColor=g;a.writeDefaultAttributes=function(p,t,q,k,r,y){for(const w of t.fieldNames){t=p.vertexAttributes.get(w);const z=p.indices.get(w);if(t&&z)switch(w){case l.VertexAttribute.POSITION:n.assert(3===t.size);var f=r.getField(w,c.BufferViewVec3f);f&&h(z,t.data,q,f,y);break;case l.VertexAttribute.NORMAL:n.assert(3===t.size);(f=r.getField(w,c.BufferViewVec3f))&&d(z,t.data,k,f,y);break;
case l.VertexAttribute.UV0:n.assert(2===t.size);(f=r.getField(w,c.BufferViewVec2f))&&u(z,t.data,f,y);break;case l.VertexAttribute.COLOR:n.assert(3===t.size||4===t.size);(f=r.getField(w,c.BufferViewVec4u8))&&g(z,t.data,t.size,f,y);break;case l.VertexAttribute.SYMBOLCOLOR:n.assert(3===t.size||4===t.size);(f=r.getField(w,c.BufferViewVec4u8))&&g(z,t.data,t.size,f,y);break;case l.VertexAttribute.TANGENT:n.assert(4===t.size),(f=r.getField(w,c.BufferViewVec4f))&&e(z,t.data,k,f,y)}}};a.writeNormal=d;a.writePosition=
h;a.writeTangent=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HUDMaterial.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/layers/graphics/sdfPrimitives ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4sPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/VisualVariablePassParameters".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F){function G(R){const M=new B.ShaderBuilder;var J=R.signedDistanceFieldEnabled;M.include(h.AlignPixel);M.include(d.HUD,R);M.include(m.SliceDraw,R);if(R.output===v.ShaderOutput.Occlusion)return M.include(e.HUDOcclusionPass,R),M;const {vertex:I,fragment:P}=M;M.include(r.ScreenSizePerspective);P.include(k.RgbaFloatEncoding);P.include(q.ColorConversion);M.include(p.VisualVariables,R);M.varyings.add("vcolor","vec4");M.varyings.add("vtc","vec2");
M.varyings.add("vsize","vec2");R.binaryHighlightOcclusionEnabled&&M.varyings.add("voccluded","float");I.uniforms.add([new f.Float4PassUniform("viewport",(S,T)=>T.camera.fullViewport),new y.Float2PassUniform("screenOffset",(S,T)=>c.set(K,2*S.screenOffset[0]*T.camera.pixelRatio,2*S.screenOffset[1]*T.camera.pixelRatio)),new y.Float2PassUniform("anchorPosition",S=>O(S)),new f.Float4PassUniform("materialColor",S=>S.color),new z.FloatPassUniform("pixelRatio",(S,T)=>T.camera.pixelRatio)]);J&&(I.uniforms.add(new f.Float4PassUniform("outlineColor",
S=>S.outlineColor)),P.uniforms.add([new f.Float4PassUniform("outlineColor",S=>0<S.outlineColor[3]&&0<S.outlineSize?S.outlineColor:l.ZEROS),new z.FloatPassUniform("outlineSize",S=>0<S.outlineColor[3]&&0<S.outlineSize?S.outlineSize:0)]));R.hasScreenSizePerspective&&(r.addScreenSizePerspective(I),r.addScreenSizePerspectiveAlignment(I));(R.debugDrawLabelBorder||R.binaryHighlightOcclusionEnabled)&&M.varyings.add("debugBorderCoords","vec4");M.attributes.add(E.VertexAttribute.UV0,"vec2");M.attributes.add(E.VertexAttribute.COLOR,
"vec4");M.attributes.add(E.VertexAttribute.SIZE,"vec2");M.attributes.add(E.VertexAttribute.AUXPOS2,"vec4");I.code.add(x.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);

      if (rejectBySlice(projectAux.posModel)) {
        // Project outside of clip plane
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
        return;
      }
      vec2 inputSize;
      ${R.hasScreenSizePerspective?x.glsl`
      inputSize = screenSizePerspectiveScaleVec2(size, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspective);
      vec2 screenOffsetScaled = screenSizePerspectiveScaleVec2(screenOffset, projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
         `:x.glsl`
      inputSize = size;
      vec2 screenOffsetScaled = screenOffset;`}

      ${R.vvSize?"inputSize *\x3d vvScale(auxpos2).xx;":""}

      vec2 combinedSize = inputSize * pixelRatio;
      vec4 quadOffset = vec4(0.0);

      ${R.occlusionTestEnabled||R.binaryHighlightOcclusionEnabled?"bool visible \x3d testVisibilityHUD(posProj);":""}

      ${R.binaryHighlightOcclusionEnabled?"voccluded \x3d visible ? 0.0 : 1.0;":""}
    `);var N=x.glsl`vec2 uv01 = floor(uv0);
vec2 uv = uv0 - uv01;
quadOffset.xy = ((uv01 - anchorPosition) * 2.0 * combinedSize + screenOffsetScaled) / viewport.zw * posProj.w;`;const V=R.pixelSnappingEnabled?J?x.glsl`posProj = alignToPixelOrigin(posProj, viewport.zw) + quadOffset;`:x.glsl`posProj += quadOffset;
if (inputSize.x == size.x) {
posProj = alignToPixelOrigin(posProj, viewport.zw);
}`:x.glsl`posProj += quadOffset;`;R.vvColor&&I.uniforms.add([new w.Float4sPassUniform("vvColorColors",S=>S.vvColorColors,F.vvColorNumber),new A.FloatsPassUniform("vvColorValues",S=>S.vvColorValues,F.vvColorNumber)]);I.uniforms.add(new y.Float2PassUniform("textureCoordinateScaleFactor",S=>b.isSome(S.texture)&&b.isSome(S.texture.descriptor.textureCoordinateScaleFactor)?S.texture.descriptor.textureCoordinateScaleFactor:n.ONES));I.code.add(x.glsl`
    ${R.occlusionTestEnabled?"if (visible) {":""}
    ${N}
    ${R.vvColor?"vcolor \x3d vvGetColor(auxpos2, vvColorValues, vvColorColors) * materialColor;":"vcolor \x3d color / 255.0 * materialColor;"}

    bool alphaDiscard = vcolor.a < ${x.glsl.float(t.symbolAlphaCutoff)};
    ${J?`alphaDiscard = alphaDiscard && outlineColor.a < ${x.glsl.float(t.symbolAlphaCutoff)};`:""}
    if (alphaDiscard) {
      // "early discard" if both symbol color (= fill) and outline color (if applicable) are transparent
      gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
      return;
    } else {
      ${V}
      gl_Position = posProj;
    }

    vtc = uv * textureCoordinateScaleFactor;

    ${R.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(uv01, 1.5 / combinedSize);":""}
    vsize = inputSize;
    ${R.occlusionTestEnabled?x.glsl`} else { vtc = vec2(0.0);
      ${R.debugDrawLabelBorder?"debugBorderCoords \x3d vec4(0.5, 0.5, 1.5 / combinedSize);}":"}"}`:""}
  }
  `);P.uniforms.add(new C.Texture2DPassUniform("tex",S=>S.texture));N=R.debugDrawLabelBorder?x.glsl`(isBorder > 0.0 ? 0.0 : ${x.glsl.float(t.defaultMaskAlphaCutoff)})`:x.glsl.float(t.defaultMaskAlphaCutoff);J=x.glsl`
    ${R.debugDrawLabelBorder?x.glsl`
      float isBorder = float(any(lessThan(debugBorderCoords.xy, debugBorderCoords.zw)) || any(greaterThan(debugBorderCoords.xy, 1.0 - debugBorderCoords.zw)));`:""}

    ${J?x.glsl`
      vec4 fillPixelColor = vcolor;

      // Attempt to sample texel centers to avoid that thin cross outlines
      // disappear with large symbol sizes.
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/7058#issuecomment-603041
      const float txSize = ${x.glsl.float(u.DEFAULT_TEX_SIZE)};
      const float texelSize = 1.0 / txSize;
      // Calculate how much we have to add/subtract to/from each texel to reach the size of an onscreen pixel
      vec2 scaleFactor = (vsize - txSize) * texelSize;
      vec2 samplePos = vtc + (vec2(1.0, -1.0) * texelSize) * scaleFactor;

      // Get distance and map it into [-0.5, 0.5]
      float d = rgba2float(texture2D(tex, samplePos)) - 0.5;

      // Distance in output units (i.e. pixels)
      float dist = d * vsize.x;

      // Create smooth transition from the icon into its outline
      float fillAlphaFactor = clamp(0.5 - dist, 0.0, 1.0);
      fillPixelColor.a *= fillAlphaFactor;

      if (outlineSize > 0.25) {
        vec4 outlinePixelColor = outlineColor;
        float clampedOutlineSize = min(outlineSize, 0.5*vsize.x);

        // Create smooth transition around outline
        float outlineAlphaFactor = clamp(0.5 - (abs(dist) - 0.5*clampedOutlineSize), 0.0, 1.0);
        outlinePixelColor.a *= outlineAlphaFactor;

        if (
          outlineAlphaFactor + fillAlphaFactor < ${N} ||
          fillPixelColor.a + outlinePixelColor.a < ${x.glsl.float(t.symbolAlphaCutoff)}
        ) {
          discard;
        }

        // perform un-premultiplied over operator (see https://en.wikipedia.org/wiki/Alpha_compositing#Description)
        float compositeAlpha = outlinePixelColor.a + fillPixelColor.a * (1.0 - outlinePixelColor.a);
        vec3 compositeColor = vec3(outlinePixelColor) * outlinePixelColor.a +
          vec3(fillPixelColor) * fillPixelColor.a * (1.0 - outlinePixelColor.a);

        gl_FragColor = vec4(compositeColor, compositeAlpha);
      } else {
        if (fillAlphaFactor < ${N}) {
          discard;
        }

        gl_FragColor = premultiplyAlpha(fillPixelColor);
      }

      // visualize SDF:
      // gl_FragColor = vec4(clamp(-dist/vsize.x*2.0, 0.0, 1.0), clamp(dist/vsize.x*2.0, 0.0, 1.0), 0.0, 1.0);
      `:x.glsl`
          vec4 texColor = texture2D(tex, vtc, -0.5);
          if (texColor.a < ${N}) {
            discard;
          }
          gl_FragColor = texColor * premultiplyAlpha(vcolor);
          `}

    // Draw debug border with transparency, so that original texels along border are still partially visible
    ${R.debugDrawLabelBorder?x.glsl`gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), isBorder * 0.5);`:""}
  `;R.output===v.ShaderOutput.Alpha&&P.code.add(x.glsl`
      void main() {
        ${J}
        gl_FragColor = vec4(gl_FragColor.a);
      }
      `);R.output===v.ShaderOutput.Color&&P.code.add(x.glsl`
    void main() {
      ${J}
      ${R.transparencyPassType===D.TransparencyPassType.FrontFace?"gl_FragColor.rgb /\x3d gl_FragColor.a;":""}
    }
    `);R.output===v.ShaderOutput.Highlight&&(M.include(g.OutputHighlight),P.code.add(x.glsl`
    void main() {
      ${J}
      ${R.binaryHighlightOcclusionEnabled?x.glsl`
          if (voccluded == 1.0) {
            gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);
          } else {
            gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);
          }`:"outputHighlight();"}
    }
    `));return M}function O(R,M=K){if(R.textureIsSignedDistanceField){var J=R.anchorPosition;R=R.distanceFieldBoundingBox;b.isSome(R)?c.set(M,J[0]*(R[2]-R[0])+R[0],J[1]*(R[3]-R[1])+R[1]):c.set(M,0,0)}else c.copy(M,R.anchorPosition);return M}const K=n.create(),L=Object.freeze(Object.defineProperty({__proto__:null,build:G,calculateAnchorPosForRendering:O},Symbol.toStringTag,{value:"Module"}));a.HUDMaterial=L;a.build=G;a.calculateAnchorPosForRendering=O})},"esri/views/3d/layers/graphics/sdfPrimitives":function(){define(["exports",
"../../../../core/has","../../../../core/floatRGBA","../../webgl-engine/lib/Texture","../../../webgl/enums"],function(a,b,c,n,l){function u(f,w=128,z=.5*w,A=0){switch(f){case "circle":return v(w,z);case "square":return m(w,z);case "cross":return d(w,z,A);case "x":return e(w,z,A);case "kite":return h(w,z);case "triangle":return g(w,z);case "arrow":return p(w,z);default:return v(w,z)}}function v(f,w){const z=f/2-.5;return y(f,k(z,z,w/2))}function m(f,w){return t(f,w,!1)}function h(f,w){return t(f,w,
!0)}function d(f,w,z=0){return q(f,w,!1,z)}function e(f,w,z=0){return q(f,w,!0,z)}function g(f,w){return y(f,r(f/2,w,w/2))}function p(f,w){const z=w/2,A=f/2,x=.8*w,B=k(A,(f-w)/2-x,Math.sqrt(x*x+z*z)),C=r(A,w,z);return y(f,(D,E)=>Math.max(C(D,E),-B(D,E)))}function t(f,w,z){z&&(w/=Math.SQRT2);return y(f,(A,x)=>{A=A-.5*f+.25;x=-x+.5*f-.75;if(z){const B=(A+x)/Math.SQRT2;x=(x-A)/Math.SQRT2;A=B}return Math.max(Math.abs(A),Math.abs(x))-.5*w})}function q(f,w,z,A=0){w-=A;z&&(w*=Math.SQRT2);const x=.5*w;return y(f,
(B,C)=>{B-=.5*f;C=-C+.5*f-1;if(z){const D=(B+C)/Math.SQRT2;C=(C-B)/Math.SQRT2;B=D}B=Math.abs(B);C=Math.abs(C);B=B>C?B>x?Math.sqrt((B-x)*(B-x)+C*C):C:C>x?Math.sqrt(B*B+(C-x)*(C-x)):B;return B-=A/2})}function k(f,w,z){return(A,x)=>{A-=f;x-=w;return Math.sqrt(A*A+x*x)-z}}function r(f,w,z){const A=Math.sqrt(w*w+z*z);return(x,B)=>{B=B-f+w/2+.75;return Math.max((w*(Math.abs(x-f)-z)+z*B)/A,-B)}}function y(f,w){const z=new Uint8Array(4*f*f);for(let A=0;A<f;A++)for(let x=0;x<f;x++){const B=x+f*A;let C=w(x,
A);C=C/f+.5;c.packFloatRGBA(C,z,4*B)}return z}a.DEFAULT_SYMBOL_SIZE_RATIO=.5;a.DEFAULT_TEX_SIZE=128;a.createArrow=p;a.createCircle=v;a.createCross=d;a.createKite=h;a.createPrimitive=u;a.createSquare=m;a.createTexture=function(f,w=128,z=.5*w,A=0){f=u(f,w,z,A);return new n.Texture(f,{mipmap:!1,wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE},width:w,height:w,components:4,noUnpackFlip:!0})};a.createTriangle=g;a.createX=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/core/floatRGBA":function(){define(["exports","./mathUtils"],function(a,b){function c(m,h=0){let d=0;for(let e=0;4>e;e++)d+=m[h+e]*u[e];return d}function n(m){return m-Math.floor(m)}const l=[1,256,65536,16777216],u=[1/256,1/65536,1/16777216,1/4294967296],v=c(new Uint8ClampedArray([255,255,255,255]));a.packFloatRGBA=function(m,h,d=0){m=b.clamp(m,0,v);for(let e=0;4>e;e++)h[d+e]=Math.floor(256*n(m*l[e]))};a.unpackFloatRGBA=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/Texture":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/Error ../../../../core/Evented ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../core/urlUtils ../../../../support/requestImageUtils ../../../../support/requestUtils ./basicInterfaces ./BasisUtil ./ContentObject ./ContentObjectType ./DDSUtil ./glUtil3D ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util ../../../webgl/capabilities/isWebGL2Context".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B){q=function(D){function E(G,O){var K=D.call(this)||this;K.data=G;K.type=k.ContentObjectType.Texture;K._glTexture=null;K._powerOfTwoStretchInfo=null;K._loadingPromise=null;K._loadingController=null;K.events=new l;K.params=O||{};K.params.mipmap=!1!==K.params.mipmap;K.params.noUnpackFlip=K.params.noUnpackFlip||!1;K.params.preMultiplyAlpha=K.params.preMultiplyAlpha||!1;K.params.wrap=K.params.wrap||{s:w.TextureWrapMode.REPEAT,t:w.TextureWrapMode.REPEAT};
K.params.powerOfTwoResizeMode=K.params.powerOfTwoResizeMode||p.PowerOfTwoResizeMode.STRETCH;K.estimatedTexMemRequired=E._estimateTexMemRequired(K.data,K.params);K._startPreload();return K}b._inheritsLoose(E,D);var F=E.prototype;F._startPreload=function(){const G=this.data;v.isNone(G)||(G instanceof HTMLVideoElement?this._startPreloadVideoElement(G):G instanceof HTMLImageElement&&this._startPreloadImageElement(G))};F._startPreloadVideoElement=function(G){if(!(d.isBlobProtocol(G.src)||"auto"===G.preload&&
G.crossOrigin)){G.preload="auto";G.crossOrigin="anonymous";const O=!G.paused;G.src=G.src;if(O&&G.autoplay){const K=()=>{G.removeEventListener("canplay",K);G.play()};G.addEventListener("canplay",K)}}};F._startPreloadImageElement=function(G){d.isDataProtocol(G.src)||d.isBlobProtocol(G.src)||G.crossOrigin||(G.crossOrigin="anonymous",G.src=G.src)};E._getDataDimensions=function(G){return G instanceof HTMLVideoElement?{width:G.videoWidth,height:G.videoHeight}:G};E._estimateTexMemRequired=function(G,O){if(v.isNone(G))return 0;
if(h.isArrayBuffer(G)||h.isUint8Array(G))return O.encoding===E.KTX2_ENCODING?t.estimateMemoryKTX2(G,O.mipmap):O.encoding===E.BASIS_ENCODING?t.estimateMemoryBasis(G,O.mipmap):G.byteLength;const {width:K,height:L}=G instanceof Image||G instanceof ImageData||G instanceof HTMLCanvasElement||G instanceof HTMLVideoElement?E._getDataDimensions(G):O;return(O.mipmap?4/3:1)*K*L*(O.components||4)||0};F.dispose=function(){this.data=void 0};F._createDescriptor=function(G){var O;return{target:w.TextureType.TEXTURE_2D,
pixelFormat:w.PixelFormat.RGBA,dataType:w.PixelType.UNSIGNED_BYTE,wrapMode:this.params.wrap,flipped:!this.params.noUnpackFlip,samplingMode:this.params.mipmap?w.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:w.TextureSamplingMode.LINEAR,hasMipmap:this.params.mipmap,preMultiplyAlpha:this.params.preMultiplyAlpha,maxAnisotropy:null!=(O=this.params.maxAnisotropy)?O:this.params.mipmap?G.parameters.maxMaxAnisotropy:1}};F.load=function(G,O){if(v.isSome(this._glTexture))return this._glTexture;if(v.isSome(this._loadingPromise))return this._loadingPromise;
const K=this.data;return v.isNone(K)?this._glTexture=new A.Texture(G,this._createDescriptor(G),null):"string"===typeof K?this._loadFromURL(G,O,K):K instanceof Image?this._loadFromImageElement(G,O,K):K instanceof HTMLVideoElement?this._loadFromVideoElement(G,O,K):K instanceof ImageData||K instanceof HTMLCanvasElement?this._loadFromImage(G,K,O):(h.isArrayBuffer(K)||h.isUint8Array(K))&&this.params.encoding===E.DDS_ENCODING?(this.data=void 0,this._loadFromDDSData(G,K)):(h.isArrayBuffer(K)||h.isUint8Array(K))&&
this.params.encoding===E.KTX2_ENCODING?(this.data=void 0,this._loadFromKTX2(G,K)):(h.isArrayBuffer(K)||h.isUint8Array(K))&&this.params.encoding===E.BASIS_ENCODING?(this.data=void 0,this._loadFromBasis(G,K)):h.isUint8Array(K)?this._loadFromPixelData(G,K):h.isArrayBuffer(K)?this._loadFromPixelData(G,new Uint8Array(K)):null};F.frameUpdate=function(G,O,K){if(!(this.data instanceof HTMLVideoElement)||v.isNone(this._glTexture)||this.data.readyState<C.HAVE_CURRENT_DATA||K===this.data.currentTime)return K;
if(v.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:L,vao:R,sourceTexture:M}=this._powerOfTwoStretchInfo;M.setData(this.data);this._drawStretchedTexture(G,O,L,R,M,this._glTexture)}else{const {videoWidth:L,videoHeight:R}=this.data,{width:M,height:J}=this._glTexture.descriptor;L!==M||R!==J?this._glTexture.updateData(0,0,0,Math.min(L,M),Math.min(R,J),this.data):this._glTexture.setData(this.data)}this._glTexture.descriptor.hasMipmap&&this._glTexture.generateMipmap();this.params.updateCallback&&
this.params.updateCallback();return this.data.currentTime};F._loadFromDDSData=function(G,O){return this._glTexture=r.createDDSTexture(G,this._createDescriptor(G),O)};F._loadFromKTX2=function(G,O){return this._loadAsync(()=>t.createTextureKTX2(G,this._createDescriptor(G),O).then(K=>this._glTexture=K))};F._loadFromBasis=function(G,O){return this._loadAsync(()=>t.createTextureBasis(G,this._createDescriptor(G),O).then(K=>this._glTexture=K))};F._loadFromPixelData=function(G,O){f.assert(0<this.params.width&&
0<this.params.height);const K=this._createDescriptor(G);K.pixelFormat=1===this.params.components?w.PixelFormat.LUMINANCE:3===this.params.components?w.PixelFormat.RGB:w.PixelFormat.RGBA;K.width=this.params.width;K.height=this.params.height;return this._glTexture=new A.Texture(G,K,O)};F._loadFromURL=function(G,O,K){var L=this;return this._loadAsync(function(){var R=b._asyncToGenerator(function*(M){const J=yield e.requestImage(K,{signal:M});m.throwIfAborted(M);return L._loadFromImage(G,J,O)});return function(M){return R.apply(this,
arguments)}}())};F._loadFromImageElement=function(G,O,K){var L=this;return K.complete?this._loadFromImage(G,K,O):this._loadAsync(function(){var R=b._asyncToGenerator(function*(M){const J=yield g.loadImageAsync(K,K.src,!1,M);m.throwIfAborted(M);return L._loadFromImage(G,J,O)});return function(M){return R.apply(this,arguments)}}())};F._loadFromVideoElement=function(G,O,K){return K.readyState>=C.HAVE_CURRENT_DATA?this._loadFromImage(G,K,O):this._loadFromVideoElementAsync(G,O,K)};F._loadFromVideoElementAsync=
function(G,O,K){return this._loadAsync(L=>new Promise((R,M)=>{const J=()=>{K.removeEventListener("loadeddata",I);K.removeEventListener("error",P);v.removeMaybe(N)},I=()=>{K.readyState>=C.HAVE_CURRENT_DATA&&(J(),R(this._loadFromImage(G,K,O)))},P=V=>{J();M(V||new n("Failed to load video"))};K.addEventListener("loadeddata",I);K.addEventListener("error",P);const N=m.onAbort(L,()=>P(m.createAbortError()))}))};F._loadFromImage=function(G,O,K){const L=E._getDataDimensions(O);this.params.width=L.width;this.params.height=
L.height;const R=this._createDescriptor(G);R.pixelFormat=3===this.params.components?w.PixelFormat.RGB:w.PixelFormat.RGBA;if(this._requiresPowerOfTwo(G,R)&&(!u.isPowerOfTwo(L.width)||!u.isPowerOfTwo(L.height)))return this._glTexture=this._makePowerOfTwoTexture(G,O,L,R,K);R.width=L.width;R.height=L.height;return this._glTexture=new A.Texture(G,R,O)};F._loadAsync=function(G){const O=new AbortController;this._loadingController=O;const K=G(O.signal);this._loadingPromise=K;G=()=>{this._loadingController===
O&&(this._loadingController=null);this._loadingPromise===K&&(this._loadingPromise=null)};K.then(G,G);return K};F._requiresPowerOfTwo=function(G,O){var K=w.TextureWrapMode.CLAMP_TO_EDGE;K="number"===typeof O.wrapMode?O.wrapMode===K:O.wrapMode.s===K&&O.wrapMode.t===K;return!B(G.gl)&&(O.hasMipmap||!K)};F._makePowerOfTwoTexture=function(G,O,K,L,R){const {width:M,height:J}=K;K=u.nextHighestPowerOfTwo(M);const I=u.nextHighestPowerOfTwo(J);L.width=K;L.height=I;let P;switch(this.params.powerOfTwoResizeMode){case p.PowerOfTwoResizeMode.PAD:L.textureCoordinateScaleFactor=
[M/K,J/I];P=new A.Texture(G,L);P.updateData(0,0,0,M,J,O);break;case p.PowerOfTwoResizeMode.STRETCH:case null:case void 0:P=this._stretchToPowerOfTwo(G,O,L,R());break;default:c.neverReached(this.params.powerOfTwoResizeMode)}L.hasMipmap&&P.generateMipmap();return P};F._stretchToPowerOfTwo=function(G,O,K,L){const R=new A.Texture(G,K),M=new z.FramebufferObject(G,{colorTarget:w.TargetType.TEXTURE,depthStencilTarget:w.DepthStencilTargetType.NONE},R);O=new A.Texture(G,{target:w.TextureType.TEXTURE_2D,pixelFormat:K.pixelFormat,
dataType:w.PixelType.UNSIGNED_BYTE,wrapMode:w.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:w.TextureSamplingMode.LINEAR,flipped:!!K.flipped,maxAnisotropy:8,preMultiplyAlpha:K.preMultiplyAlpha},O);K=y.createQuadVAO(G);const J=G.getBoundFramebufferObject();this._drawStretchedTexture(G,L,M,K,O,R);this.requiresFrameUpdates?this._powerOfTwoStretchInfo={vao:K,sourceTexture:O,framebuffer:M}:(K.dispose(!0),O.dispose(),M.detachColorTexture(),M.dispose());G.bindFramebuffer(J);return R};F._drawStretchedTexture=
function(G,O,K,L,R,M){G.bindFramebuffer(K);K=G.getViewport();G.setViewport(0,0,M.descriptor.width,M.descriptor.height);O=G.bindTechnique(O);O.setUniform4f("uColor",1,1,1,1);O.bindTexture("tex",R);G.bindVAO(L);G.drawArrays(w.PrimitiveType.TRIANGLE_STRIP,0,x.vertexCount(L,"geometry"));G.bindFramebuffer(null);G.setViewport(K.x,K.y,K.width,K.height)};F.unload=function(){if(v.isSome(this._powerOfTwoStretchInfo)){const {framebuffer:G,vao:O,sourceTexture:K}=this._powerOfTwoStretchInfo;O.dispose(!0);K.dispose();
G.dispose();this._powerOfTwoStretchInfo=this._glTexture=null}v.isSome(this._glTexture)&&(this._glTexture.dispose(),this._glTexture=null);if(v.isSome(this._loadingController)){const G=this._loadingController;this._loadingPromise=this._loadingController=null;G.abort()}this.events.emit("unloaded")};b._createClass(E,[{key:"width",get:function(){return this.params.width}},{key:"height",get:function(){return this.params.height}},{key:"glTexture",get:function(){return this._glTexture}},{key:"requiresFrameUpdates",
get:function(){return this.data instanceof HTMLVideoElement}}]);return E}(q.ContentObject);q.DDS_ENCODING="image/vnd-ms.dds";q.KTX2_ENCODING="image/ktx2";q.BASIS_ENCODING="image/x.basis";var C;(function(D){D[D.HAVE_NOTHING=0]="HAVE_NOTHING";D[D.HAVE_METADATA=1]="HAVE_METADATA";D[D.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA";D[D.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA";D[D.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"})(C||(C={}));a.Texture=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/BasisUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../libs/basisu/BasisU ../../../../libs/basisu/TextureFormat ../../../webgl/enums ../../../webgl/Texture ../../../webgl/Util".split(" "),function(a,b,c,n,l,u,v,m){function h(){return d.apply(this,arguments)}function d(){d=b._asyncToGenerator(function*(){c.isNone(y)&&(y=n.getBasisTranscoder(),r=yield y);return y});return d.apply(this,arguments)}function e(f,
w,z,A,x){w=m.getBytesPerElementFormat(w?u.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC:u.CompressedTextureFormat.COMPRESSED_RGB8_ETC2);return Math.ceil(z*A*w*(x&&1<f?(4**f-1)/(3*4**(f-1)):1))}function g(f){return 1<=f.getNumImages()&&!f.isUASTC()}function p(f){return 1<=f.getFaces()&&f.isETC1S()}function t(){t=b._asyncToGenerator(function*(f,w,z){c.isNone(r)&&(r=yield h());const A=new r.BasisFile(new Uint8Array(z));if(!g(A))return null;A.startTranscoding();f=k(f,w,A.getNumLevels(0),A.getHasAlpha(),
A.getImageWidth(0,0),A.getImageHeight(0,0),(x,B)=>A.getImageTranscodedSizeInBytes(0,x,B),(x,B,C)=>A.transcodeImage(C,0,x,B,0,0));A.close();A.delete();return f});return t.apply(this,arguments)}function q(){q=b._asyncToGenerator(function*(f,w,z){c.isNone(r)&&(r=yield h());const A=new r.KTX2File(new Uint8Array(z));if(!p(A))return null;A.startTranscoding();f=k(f,w,A.getLevels(),A.getHasAlpha(),A.getWidth(),A.getHeight(),(x,B)=>A.getImageTranscodedSizeInBytes(x,0,0,B),(x,B,C)=>A.transcodeImage(C,x,0,0,
B,0,-1,-1));A.close();A.delete();return f});return q.apply(this,arguments)}function k(f,w,z,A,x,B,C,D){const {compressedTextureETC:E,compressedTextureS3TC:F}=f.capabilities,[G,O]=E?A?[l.TextureFormat.ETC2_RGBA,u.CompressedTextureFormat.COMPRESSED_RGBA8_ETC2_EAC]:[l.TextureFormat.ETC1_RGB,u.CompressedTextureFormat.COMPRESSED_RGB8_ETC2]:F?A?[l.TextureFormat.BC3_RGBA,u.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT]:[l.TextureFormat.BC1_RGB,u.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT]:
[l.TextureFormat.RGBA32,u.PixelFormat.RGBA];A=w.hasMipmap?z:Math.min(1,z);z=[];for(let K=0;K<A;K++)z.push(new Uint8Array(C(K,G))),D(K,G,z[K]);C=1<z.length;return new v.Texture(f,{...w,samplingMode:C?u.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:u.TextureSamplingMode.LINEAR,hasMipmap:C,internalFormat:O,width:x,height:B},{type:"compressed",levels:z})}let r=null,y=null;a.createTextureBasis=function(f,w,z){return t.apply(this,arguments)};a.createTextureKTX2=function(f,w,z){return q.apply(this,arguments)};
a.estimateMemoryBasis=function(f,w){if(c.isNone(r))return f.byteLength;f=new r.BasisFile(new Uint8Array(f));w=g(f)?e(f.getNumLevels(0),f.getHasAlpha(),f.getImageWidth(0,0),f.getImageHeight(0,0),w):0;f.close();f.delete();return w};a.estimateMemoryKTX2=function(f,w){if(c.isNone(r))return f.byteLength;f=new r.KTX2File(new Uint8Array(f));w=p(f)?e(f.getLevels(),f.getHasAlpha(),f.getWidth(),f.getHeight(),w):0;f.close();f.delete();return w};a.loadBasis=h;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/basisu/BasisU":function(){define(["require","exports","../../assets","../../core/maybe"],function(a,b,c,n){let l;b.getBasisTranscoder=function(){if(n.isNone(l)){const u=v=>c.getAssetUrl(`esri/libs/basisu/${v}`);l=(new Promise((v,m)=>a(["../../chunks/basis_transcoder"],v,m))).then(v=>v.basis_transcoder).then(({default:v})=>v({locateFile:u}).then(m=>{m.initializeBasis();delete m.then;return m}))}return l};Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/libs/basisu/TextureFormat":function(){define(["exports"],function(a){a.TextureFormat=void 0;var b=a.TextureFormat||(a.TextureFormat={});b[b.ETC1_RGB=0]="ETC1_RGB";b[b.ETC2_RGBA=1]="ETC2_RGBA";b[b.BC1_RGB=2]="BC1_RGB";b[b.BC3_RGBA=3]="BC3_RGBA";b[b.BC4_R=4]="BC4_R";b[b.BC5_RG=5]="BC5_RG";b[b.BC7_M6_RGB=6]="BC7_M6_RGB";b[b.BC7_M5_RGBA=7]="BC7_M5_RGBA";b[b.PVRTC1_4_RGB=8]="PVRTC1_4_RGB";b[b.PVRTC1_4_RGBA=9]="PVRTC1_4_RGBA";b[b.ASTC_4x4_RGBA=10]="ASTC_4x4_RGBA";
b[b.ATC_RGB=11]="ATC_RGB";b[b.ATC_RGBA=12]="ATC_RGBA";b[b.FXT1_RGB=17]="FXT1_RGB";b[b.PVRTC2_4_RGB=18]="PVRTC2_4_RGB";b[b.PVRTC2_4_RGBA=19]="PVRTC2_4_RGBA";b[b.ETC2_EAC_R11=20]="ETC2_EAC_R11";b[b.ETC2_EAC_RG11=21]="ETC2_EAC_RG11";b[b.RGBA32=13]="RGBA32";b[b.RGB565=14]="RGB565";b[b.BGR565=15]="BGR565";b[b.RGBA4444=16]="RGBA4444";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/DDSUtil":function(){define(["exports","../../../../core/Logger",
"../../../../core/mathUtils","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,n,l){function u(g){return g.charCodeAt(0)+(g.charCodeAt(1)<<8)+(g.charCodeAt(2)<<16)+(g.charCodeAt(3)<<24)}function v(g,p){var t=new Int32Array(g,0,31);if(542327876!==t[0])return m.error("Invalid magic number in DDS header"),null;if(!(t[20]&4))return m.error("Unsupported format, must contain a FourCC code"),null;var q=t[21];let k;switch(q){case h:q=8;k=n.CompressedTextureFormat.COMPRESSED_RGB_S3TC_DXT1_EXT;
break;case d:q=16;k=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT3_EXT;break;case e:q=16;k=n.CompressedTextureFormat.COMPRESSED_RGBA_S3TC_DXT5_EXT;break;default:return m.error("Unsupported FourCC code:",String.fromCharCode(q&255,q>>8&255,q>>16&255,q>>24&255)),null}let r=1,y=t[4],f=t[3];if(0!==(y&3)||0!==(f&3))m.warn("Rounding up compressed texture size to nearest multiple of 4."),y=y+3&-4,f=f+3&-4;const w=y,z=f;t[2]&131072&&!1!==p&&(r=Math.max(1,t[7]));1===r||c.isPowerOfTwo(y)&&c.isPowerOfTwo(f)||
(m.warn("Ignoring mipmaps of non power of two sized compressed texture."),r=1);let A=t[1]+4;const x=[];for(let B=0;B<r;++B)t=(y+3>>2)*(f+3>>2)*q,p=new Uint8Array(g,A,t),x.push(p),A+=t,y=Math.max(1,y>>1),f=Math.max(1,f>>1);return{textureData:{type:"compressed",levels:x},internalFormat:k,width:w,height:z}}const m=b.getLogger("esri.views.3d.webgl-engine.lib.DDSUtil"),h=u("DXT1"),d=u("DXT3"),e=u("DXT5");a.createDDSTexture=function(g,p,t){const {textureData:q,internalFormat:k,width:r,height:y}=v(t,p.hasMipmap);
p.samplingMode=1<q.levels.length?n.TextureSamplingMode.LINEAR_MIPMAP_LINEAR:n.TextureSamplingMode.LINEAR;p.hasMipmap=1<q.levels.length;p.internalFormat=k;p.width=r;p.height=y;return new l.Texture(g,p,q)};a.createDDSTextureData=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/Slice.glsl":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../shaderModules/Float3DrawUniform ../shaderModules/Float3PassUniform ../shaderModules/interfaces".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(A,x,B){if(x.hasSlicePlane){A.extensions.add("GL_OES_standard_derivatives");x.hasSliceInVertexProgram&&A.vertex.uniforms.add(B);A.fragment.uniforms.add(B);B=d.glsl`struct SliceFactors {
float front;
float side0;
float side1;
float side2;
float side3;
};
SliceFactors calculateSliceFactors(vec3 pos) {
vec3 rel = pos - slicePlaneOrigin;
vec3 slicePlaneNormal = -cross(slicePlaneBasis1, slicePlaneBasis2);
float slicePlaneW = -dot(slicePlaneNormal, slicePlaneOrigin);
float basis1Len2 = dot(slicePlaneBasis1, slicePlaneBasis1);
float basis2Len2 = dot(slicePlaneBasis2, slicePlaneBasis2);
float basis1Dot = dot(slicePlaneBasis1, rel);
float basis2Dot = dot(slicePlaneBasis2, rel);
return SliceFactors(
dot(slicePlaneNormal, pos) + slicePlaneW,
-basis1Dot - basis1Len2,
basis1Dot - basis1Len2,
-basis2Dot - basis2Len2,
basis2Dot - basis2Len2
);
}
bool sliceByFactors(SliceFactors factors) {
return factors.front < 0.0
&& factors.side0 < 0.0
&& factors.side1 < 0.0
&& factors.side2 < 0.0
&& factors.side3 < 0.0;
}
bool sliceEnabled() {
return dot(slicePlaneBasis1, slicePlaneBasis1) != 0.0;
}
bool sliceByPlane(vec3 pos) {
return sliceEnabled() && sliceByFactors(calculateSliceFactors(pos));
}
#define rejectBySlice(_pos_) sliceByPlane(_pos_)
#define discardBySlice(_pos_) { if (sliceByPlane(_pos_)) discard; }`;var C=d.glsl`vec4 applySliceHighlight(vec4 color, vec3 pos) {
SliceFactors factors = calculateSliceFactors(pos);
const float HIGHLIGHT_WIDTH = 1.0;
const vec4 HIGHLIGHT_COLOR = vec4(0.0, 0.0, 0.0, 0.3);
factors.front /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.front);
factors.side0 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side0);
factors.side1 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side1);
factors.side2 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side2);
factors.side3 /= (2.0 * HIGHLIGHT_WIDTH) * fwidth(factors.side3);
if (sliceByFactors(factors)) {
return color;
}
float highlightFactor = (1.0 - step(0.5, factors.front))
* (1.0 - step(0.5, factors.side0))
* (1.0 - step(0.5, factors.side1))
* (1.0 - step(0.5, factors.side2))
* (1.0 - step(0.5, factors.side3));
return mix(color, vec4(HIGHLIGHT_COLOR.rgb, color.a), highlightFactor * HIGHLIGHT_COLOR.a);
}`;C=x.hasSliceHighlight?d.glsl`
        ${C}
        #define highlightSlice(_color_, _pos_) (sliceEnabled() ? applySliceHighlight(_color_, _pos_) : (_color_))
      `:d.glsl`#define highlightSlice(_color_, _pos_) (_color_)`;x.hasSliceInVertexProgram&&A.vertex.code.add(B);A.fragment.code.add(B);A.fragment.code.add(C)}else B=d.glsl`#define rejectBySlice(_pos_) false
#define discardBySlice(_pos_) {}
#define highlightSlice(_color_, _pos_) (_color_)`,x.hasSliceInVertexProgram&&A.vertex.code.add(B),A.fragment.code.add(B)}function g(A,x,B){return A.instancedDoublePrecision?u.set(y,B.camera.viewInverseTransposeMatrix[3],B.camera.viewInverseTransposeMatrix[7],B.camera.viewInverseTransposeMatrix[11]):x.slicePlaneLocalOrigin}function p(A,x){return c.isSome(A)?u.subtract(f,x.origin,A):x.origin}function t(A,x,B){return A.hasSliceTranslatedView?c.isSome(x)?n.translate(z,B.camera.viewMatrix,x):B.camera.viewMatrix:
null}function q(A,x,B){if(c.isNone(B.slicePlane))return v.ZEROS;const C=g(A,x,B);x=p(C,B.slicePlane);A=t(A,C,B);return c.isSome(A)?u.transformMat4(f,x,A):x}function k(A,x,B,C){if(c.isNone(C)||c.isNone(B.slicePlane))return v.ZEROS;const D=g(A,x,B);x=p(D,B.slicePlane);A=t(A,D,B);return c.isSome(A)?(u.add(w,C,x),u.transformMat4(f,x,A),u.transformMat4(w,w,A),u.subtract(w,w,f)):C}let r=function(A){function x(B){var C=A.call(this)||this;C.slicePlaneLocalOrigin=B;return C}b._inheritsLoose(x,A);return x}(d.NoParameters);
const y=v.create(),f=v.create(),w=v.create(),z=l.create();a.SliceDraw=function(A,x){e(A,x,[new m.Float3DrawUniform("slicePlaneOrigin",(B,C)=>q(x,B,C)),new m.Float3DrawUniform("slicePlaneBasis1",(B,C)=>{var D;return k(x,B,C,null==(D=c.unwrap(C.slicePlane))?void 0:D.basis1)}),new m.Float3DrawUniform("slicePlaneBasis2",(B,C)=>{var D;return k(x,B,C,null==(D=c.unwrap(C.slicePlane))?void 0:D.basis2)})])};a.SlicePass=function(A,x){e(A,x,[new h.Float3PassUniform("slicePlaneOrigin",(B,C)=>q(x,B,C)),new h.Float3PassUniform("slicePlaneBasis1",
(B,C)=>{var D;return k(x,B,C,null==(D=c.unwrap(C.slicePlane))?void 0:D.basis1)}),new h.Float3PassUniform("slicePlaneBasis2",(B,C)=>{var D;return k(x,B,C,null==(D=c.unwrap(C.slicePlane))?void 0:D.basis2)})])};a.SlicePlaneParameters=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/hud/HUDOcclusionPass.glsl":function(){define("exports ../output/ReadLinearDepth.glsl ../shading/MultipassGeometryTest.glsl ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,n,l,u,v){a.HUDOcclusionPass=function(m,h){const {vertex:d,fragment:e}=m;h.hasMultipassGeometry&&d.include(c.multipassGeometryTest);h.hasMultipassTerrain&&m.varyings.add("depth","float");d.code.add(u.glsl`
  void main(void) {
    vec4 posProjCenter;
    if (dot(position, position) > 0.0) {
      // Render single point to center of the pixel to avoid subpixel
      // filtering to affect the marker color
      ProjectHUDAux projectAux;
      vec4 posProj = projectPositionHUD(projectAux);
      posProjCenter = alignToPixelCenter(posProj, viewport.zw);

      ${h.hasMultipassGeometry?u.glsl`
        // Don't draw vertices behind geometry
        if(geometryDepthTest(.5 + .5 * posProjCenter.xy / posProjCenter.w, projectAux.posView.z)){
          posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
        }`:""}

      ${h.hasMultipassTerrain?"depth \x3d projectAux.posView.z;":""}
      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        // Project out of clip space
        posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
      }

    } else {
      // Project out of clip space
      posProjCenter = vec4(1e038, 1e038, 1e038, 1.0);
    }

    gl_Position = posProjCenter;
    gl_PointSize = 1.0;
  }
  `);h.hasMultipassTerrain&&e.include(b.ReadLinearDepth);h.hasMultipassTerrain&&e.uniforms.add([new v.Texture2DPassUniform("terrainDepthTexture",(g,p)=>p.multipassTerrain.linearDepthTexture),new l.Float2PassUniform("nearFar",(g,p)=>p.camera.nearFar),new l.Float2PassUniform("inverseViewport",(g,p)=>p.inverseViewport)]);e.include(n.RgbaFloatEncoding);e.code.add(u.glsl`
  void main() {
    gl_FragColor = vec4(1, 1, 1, 1);
    ${h.hasMultipassTerrain?u.glsl`
          vec2 uv = gl_FragCoord.xy * inverseViewport;

          //Read the rgba data from the texture linear depth
          vec4 terrainDepthData = texture2D(terrainDepthTexture, uv);

          float terrainDepth = linearDepthFromFloat(rgba2float(terrainDepthData), nearFar);

          //If HUD vertex is behind terrain and the terrain depth is not the initialize value (e.g. we are not looking at the sky)
          //Mark the HUD vertex as occluded by transparent terrain
          if(depth < terrainDepth && terrainDepthData != vec4(0,0,0,1)){
            gl_FragColor.g = 0.5;
          }`:""}
  }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,n,l,u,v){const m=n.fromValues(1,1,0,1),h=n.fromValues(1,
0,1,1);n=function(d){function e(){var g=d.apply(this,arguments)||this;g.inverseViewport=c.create();return g}b._inheritsLoose(e,d);return e}(u.NoParameters);a.OutputHighlight=function(d){d.fragment.uniforms.add(new v.Texture2DPassUniform("depthTex",(e,g)=>g.highlightDepthTexture));d.fragment.uniforms.add(new l.Float2PassUniform("highlightViewportPixelSz",(e,g)=>g.inverseViewport));d.fragment.constants.add("occludedHighlightFlag","vec4",m).add("unoccludedHighlightFlag","vec4",h);d.fragment.code.add(u.glsl`void outputHighlight() {
vec4 fragCoord = gl_FragCoord;
float sceneDepth = texture2D(depthTex, fragCoord.xy * highlightViewportPixelSz.xy).r;
if (fragCoord.z > sceneDepth + 5e-7) {
gl_FragColor = occludedHighlightFlag;
}
else {
gl_FragColor = unoccludedHighlightFlag;
}
}`)};a.OutputHighlightUniforms=n;a.occludedHighlightFlag=m;a.unoccludedHighlightFlag=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3PassUniform ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,n,l,u,v,m){a.VisualVariables=function(h,d){d.hasVvInstancing&&(d.vvSize||d.vvColor)&&h.attributes.add(v.VertexAttribute.INSTANCEFEATUREATTRIBUTE,"vec4");h=h.vertex;d.vvSize?(h.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",e=>e.vvSizeMinSize)),h.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",e=>e.vvSizeMaxSize)),h.uniforms.add(new b.Float3PassUniform("vvSizeOffset",e=>e.vvSizeOffset)),h.uniforms.add(new b.Float3PassUniform("vvSizeFactor",e=>e.vvSizeFactor)),h.uniforms.add(new u.Matrix3PassUniform("vvSymbolRotationMatrix",
e=>e.vvSymbolRotationMatrix)),h.uniforms.add(new b.Float3PassUniform("vvSymbolAnchor",e=>e.vvSymbolAnchor)),h.code.add(l.glsl`vec3 vvScale(vec4 _featureAttribute) {
return clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize);
}
vec4 vvTransformPosition(vec3 position, vec4 _featureAttribute) {
return vec4(vvSymbolRotationMatrix * ( vvScale(_featureAttribute) * (position + vvSymbolAnchor)), 1.0);
}`),h.code.add(l.glsl`
      const float eps = 1.192092896e-07;
      vec4 vvTransformNormal(vec3 _normal, vec4 _featureAttribute) {
        vec3 vvScale = clamp(vvSizeOffset + _featureAttribute.x * vvSizeFactor, vvSizeMinSize + eps, vvSizeMaxSize);
        return vec4(vvSymbolRotationMatrix * _normal / vvScale, 1.0);
      }

      ${d.hasVvInstancing?l.glsl`
      vec4 vvLocalNormal(vec3 _normal) {
        return vvTransformNormal(_normal, instanceFeatureAttribute);
      }

      vec4 localPosition() {
        return vvTransformPosition(position, instanceFeatureAttribute);
      }`:""}
    `)):h.code.add(l.glsl`vec4 localPosition() { return vec4(position, 1.0); }
vec4 vvLocalNormal(vec3 _normal) { return vec4(_normal, 1.0); }`);d.vvColor?(h.constants.add("vvColorNumber","int",m.vvColorNumber),d.hasVvInstancing&&h.uniforms.add([new n.FloatsPassUniform("vvColorValues",e=>e.vvColorValues,m.vvColorNumber),new c.Float4sPassUniform("vvColorColors",e=>e.vvColorColors,m.vvColorNumber)]),h.code.add(l.glsl`
      vec4 vvGetColor(vec4 featureAttribute, float values[vvColorNumber], vec4 colors[vvColorNumber]) {
        float value = featureAttribute.y;
        if (value <= values[0]) {
          return colors[0];
        }

        for (int i = 1; i < vvColorNumber; ++i) {
          if (values[i] >= value) {
            float f = (value - values[i-1]) / (values[i] - values[i-1]);
            return mix(colors[i-1], colors[i], f);
          }
        }
        return colors[vvColorNumber - 1];
      }

      ${d.hasVvInstancing?l.glsl`
      vec4 vvColor() {
        return vvGetColor(instanceFeatureAttribute, vvColorValues, vvColorColors);
      }`:""}
    `)):h.code.add(l.glsl`vec4 vvColor() { return vec4(1.0); }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4sPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m,h){return l.call(this,v,"vec4",n.BindType.Pass,(d,e,g)=>d.setUniform4fv(v,m(e,g)),h)||this}b._inheritsLoose(u,
l);return u}(c.Uniform);a.Float4sPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatsPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m,h){return l.call(this,v,"float",n.BindType.Pass,(d,e,g)=>d.setUniform1fv(v,m(e,g)),h)||this}b._inheritsLoose(u,l);return u}(c.Uniform);
a.FloatsPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix3PassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"mat3",n.BindType.Pass,(h,d,e)=>h.setUniformMatrix3fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Matrix3PassUniform=
c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/VisualVariablePassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3f64","../../../../chunks/vec3f64","../lib/Material"],function(a,b,c,n,l){l=function(u){function v(){var m=u.apply(this,arguments)||this;m.vvSizeEnabled=!1;m.vvSizeMinSize=n.fromValues(1,1,1);m.vvSizeMaxSize=n.fromValues(100,100,100);m.vvSizeOffset=
n.fromValues(0,0,0);m.vvSizeFactor=n.fromValues(1,1,1);m.vvSizeValue=n.fromValues(1,1,1);m.vvColorEnabled=!1;m.vvColorValues=[0,0,0,0,0,0,0,0];m.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];m.vvOpacityEnabled=!1;m.vvOpacityValues=[0,0,0,0,0,0,0,0];m.vvOpacityOpacities=[1,1,1,1,1,1,1,1];m.vvSymbolAnchor=[0,0,0];m.vvSymbolRotationMatrix=c.create();return m}b._inheritsLoose(v,u);return v}(l.MaterialParameters);a.VisualVariablePassParameters=l;a.vvColorNumber=8;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff":function(){define(["exports"],function(a){a.defaultMaskAlphaCutoff=.1;a.symbolAlphaCutoff=.001;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/HUDMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){v=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var f=y.prototype;f.initializeConfiguration=function(w,z){z.spherical=w.viewingMode===n.ViewingMode.Global};f.initializeProgram=function(w){const z=y.shader.get().build(this.configuration);return new e.Program(w.rctx,z,h.Default3D)};f._setPipelineState=function(w){const z=this.configuration,A=w===m.TransparencyPassType.NONE;var x=w===m.TransparencyPassType.FrontFace;const B=
this.configuration.hasPolygonOffset&&q;x=(A||x)&&z.output!==l.ShaderOutput.Highlight?(z.depthEnabled||z.output===l.ShaderOutput.Occlusion)&&t.defaultDepthWriteParams:null;return t.makePipelineState({blending:z.output===l.ShaderOutput.Color||z.output===l.ShaderOutput.Alpha||z.output===l.ShaderOutput.Highlight?A?k:d.oitBlending(w):null,depthTest:{func:p.CompareFunction.LEQUAL},depthWrite:x,colorWrite:t.defaultColorWriteParams,polygonOffset:B})};f.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};
c._createClass(y,[{key:"primitiveType",get:function(){return this.configuration.output===l.ShaderOutput.Occlusion?p.PrimitiveType.POINTS:p.PrimitiveType.TRIANGLES}}]);return y}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(g.HUDMaterial,()=>new Promise((r,y)=>a(["./HUDMaterial.glsl"],r,y)));const q={factor:0,units:-4},k=t.simpleBlendingParams(p.BlendFactor.ONE,p.BlendFactor.ONE_MINUS_SRC_ALPHA);b.HUDMaterialTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/OrderIndependentTransparency":function(){define(["exports","./basicInterfaces","../../../webgl/enums","../../../webgl/renderState"],function(a,b,c,n){const l=n.separateBlendingParams(c.BlendFactor.SRC_ALPHA,c.BlendFactor.ONE,c.BlendFactor.ONE_MINUS_SRC_ALPHA,c.BlendFactor.ONE_MINUS_SRC_ALPHA),u=n.simpleBlendingParams(c.BlendFactor.ONE,c.BlendFactor.ONE),v=n.simpleBlendingParams(c.BlendFactor.ZERO,c.BlendFactor.ONE_MINUS_SRC_ALPHA),m={factor:-1,units:-2};a.OITPolygonOffset=
m;a.OITPolygonOffsetLimit=5E5;a.blendingAlpha=v;a.blendingColor=u;a.blendingDefault=l;a.getOITPolygonOffset=function(h){return h?m:null};a.oitBlending=function(h){return h===b.TransparencyPassType.FrontFace?null:h===b.TransparencyPassType.Alpha?v:u};a.oitDepthTest=function(h,d=c.CompareFunction.LESS){return h===b.TransparencyPassType.NONE||h===b.TransparencyPassType.FrontFace?d:c.CompareFunction.LEQUAL};a.oitDepthWrite=function(h){return h===b.TransparencyPassType.FrontFace?n.defaultDepthWriteParams:
null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HUDMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,n,l,u,v,
m){m=function(h){function d(){var e=h.apply(this,arguments)||this;e.output=n.ShaderOutput.Color;e.screenCenterOffsetUnitsEnabled=l.HUDSpace.World;e.transparencyPassType=v.TransparencyPassType.NONE;e.spherical=!1;e.occlusionTestEnabled=!0;e.signedDistanceFieldEnabled=!1;e.vvSize=!1;e.vvColor=!1;e.hasVerticalOffset=!1;e.hasScreenSizePerspective=!1;e.debugDrawLabelBorder=!1;e.binaryHighlightOcclusionEnabled=!0;e.hasSlicePlane=!1;e.hasPolygonOffset=!1;e.depthEnabled=!0;e.pixelSnappingEnabled=!0;e.isDraped=
!1;e.hasMultipassGeometry=!1;e.hasMultipassTerrain=!1;e.cullAboveGround=!1;return e}b._inheritsLoose(d,h);return d}(m.DefaultTechniqueConfiguration);c.__decorate([u.parameter({count:n.ShaderOutput.COUNT})],m.prototype,"output",void 0);c.__decorate([u.parameter({count:l.HUDSpace.COUNT})],m.prototype,"screenCenterOffsetUnitsEnabled",void 0);c.__decorate([u.parameter({count:v.TransparencyPassType.COUNT})],m.prototype,"transparencyPassType",void 0);c.__decorate([u.parameter()],m.prototype,"spherical",
void 0);c.__decorate([u.parameter()],m.prototype,"occlusionTestEnabled",void 0);c.__decorate([u.parameter()],m.prototype,"signedDistanceFieldEnabled",void 0);c.__decorate([u.parameter()],m.prototype,"vvSize",void 0);c.__decorate([u.parameter()],m.prototype,"vvColor",void 0);c.__decorate([u.parameter()],m.prototype,"hasVerticalOffset",void 0);c.__decorate([u.parameter()],m.prototype,"hasScreenSizePerspective",void 0);c.__decorate([u.parameter()],m.prototype,"debugDrawLabelBorder",void 0);c.__decorate([u.parameter()],
m.prototype,"binaryHighlightOcclusionEnabled",void 0);c.__decorate([u.parameter()],m.prototype,"hasSlicePlane",void 0);c.__decorate([u.parameter()],m.prototype,"hasPolygonOffset",void 0);c.__decorate([u.parameter()],m.prototype,"depthEnabled",void 0);c.__decorate([u.parameter()],m.prototype,"pixelSnappingEnabled",void 0);c.__decorate([u.parameter()],m.prototype,"isDraped",void 0);c.__decorate([u.parameter()],m.prototype,"hasMultipassGeometry",void 0);c.__decorate([u.parameter()],m.prototype,"hasMultipassTerrain",
void 0);c.__decorate([u.parameter()],m.prototype,"cullAboveGround",void 0);c.__decorate([u.parameter({constValue:!0})],m.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([u.parameter({constValue:!1})],m.prototype,"hasVvInstancing",void 0);a.HUDMaterialTechniqueConfiguration=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../chunks/tslib.es6","../core/shaderTechnique/BindType","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n,l){let u=function(v){function m(){return v.apply(this,arguments)||this}b._inheritsLoose(m,v);return m}(l.ShaderTechniqueConfiguration);c.__decorate([l.parameter({constValue:!0})],u.prototype,"hasSliceHighlight",void 0);c.__decorate([l.parameter({constValue:!1})],u.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([l.parameter({constValue:!1})],u.prototype,
"instancedDoublePrecision",void 0);c.__decorate([l.parameter({constValue:!1})],u.prototype,"isGround",void 0);c.__decorate([l.parameter({constValue:n.BindType.Pass})],u.prototype,"pbrTextureBindType",void 0);a.DefaultTechniqueConfiguration=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/LabelDeconflictor":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./Deconflictor ./enums ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){a.LabelDeconflictor=function(g){function p(){var q=g.apply(this,arguments)||this;q.visibilityGroup=d.VisibilityGroup.LABEL;q.iconMarginFactor=0;q._lastDeconfliction=0;return q}b._inheritsLoose(p,g);var t=p.prototype;t.runTask=function(q){if(!this.parent.running){var k=performance.now();if(q.state===e.State.IDLE||2E3<k-this._lastDeconfliction)g.prototype.runTask.call(this,q),this.state===h.State.Idle&&(this._lastDeconfliction=k)}};t.enabledChanged=function(q,k){this.modifyGraphics(k,
q.labelsEnabled)};t.getGraphicsLayers=function(q){return q.labelGraphics};b._createClass(p,[{key:"viewState",get:function(){return this.parent.viewState}}]);return p}(h.Deconflictor);c.__decorate([n.property({constructOnly:!0})],a.LabelDeconflictor.prototype,"parent",void 0);a.LabelDeconflictor=c.__decorate([m.subclass("esri.views.3d.layers.graphics.LabelDeconflictor")],a.LabelDeconflictor);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Labeler":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/asyncUtils ../../../../core/Handles ../../../../core/Logger ../../../../core/MapUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../layers/graphics/hydratedFeatures ../../../../layers/support/labelFormatUtils ../../../../layers/support/layerUtils ../../../../symbols/callouts/calloutUtils ./enums ./Graphics3DCalloutSymbolLayerFactory ./Graphics3DGraphicCreationContext ./graphicSymbolUtils ./labelPlacement ./placementUtils ../../support/debugFlags ../../webgl-engine/lib/MaterialCollection ../../webgl-engine/lib/TextRenderer ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureAtlas ../../webgl-engine/lib/WebGLLayer ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R){const M=v.getLogger("esri.views.3d.layers.graphics.Labeler");a.Labeler=function(I){function P(){var V=I.apply(this,arguments)||this;V._dirty=!1;V._labels=new Map;V._labelsToAdd=new Map;V._labelsToRemove=new Map;V._labelingContexts=[];return V}b._inheritsLoose(P,I);var N=P.prototype;N.setup=function(){this.dispose();this._handles=new u;this._handles.add([e.watch(()=>{var V;return null==(V=this.view.state)?void 0:V.camera},
()=>this.setDirty()),e.watch(()=>{var V;return null==(V=this.view.state)?void 0:V.pixelRatio},()=>this._resetAllLabels()),this.view.resourceController.scheduler.registerTask(R.TaskPriority.LABELER,this)]);this._textTextureAtlas=new K.TextTextureAtlas({view:this.view});this._hudMaterialCollection=new F.MaterialCollection(this.view._stage);this._calloutMaterialCollection=new F.MaterialCollection(this.view._stage)};N.dispose=function(){this._handles=h.destroyMaybe(this._handles);this._textTextureAtlas=
h.disposeMaybe(this._textTextureAtlas);this._hudMaterialCollection=h.disposeMaybe(this._hudMaterialCollection);this._calloutMaterialCollection=h.disposeMaybe(this._calloutMaterialCollection);this._labelingContexts.length=0;this._labels.clear();this._labelsToAdd.clear();this._labelsToRemove.clear()};N._activateLabelingContext=function(V){V.labels.forEach((S,T)=>{this._labels.set(T,S);S.graphics3DGraphic.setVisibilityFlag(z.VisibilityFlag.USER_SETTING,!0,z.VisibilityGroup.LABEL)});V.active=!0};N._deactivateLabelingContext=
function(V){V.labels.forEach((S,T)=>{S.graphics3DGraphic.setVisibilityFlag(z.VisibilityFlag.USER_SETTING,!1,z.VisibilityGroup.LABEL);this.setLabelGraphicVisibility(S.graphics3DGraphic,!1);this._labels.delete(T)});V.active=!1};N._addLabelTextureToAtlas=function(V){for(const S of V.graphics3DGraphic.labelGraphics){if(!S._labelClass)continue;const T=V.textTextureResources.textRenderers[S._labelIndex];h.isSome(T)&&this._textTextureAtlas.addTextTexture(T,S.stageObject)}V.rendered=!0};N._removeLabelTextureFromAtlas=
function(V){for(const S of V.graphics3DGraphic.labelGraphics){if(!S._labelClass)continue;const T=V.textTextureResources.textRenderers[S._labelIndex];h.isSome(T)&&this._textTextureAtlas.removeTextTexture(T,S.stageObject)}V.rendered=!1};N.runTask=function(V){this._updateLabels(V);!this._dirty&&this.deconflictor.running&&this.deconflictor.runTask(V)};N._updateLabels=function(V){if(this._dirty){this._dirty=!1;for(const S of this._labelingContexts)if(S.active&&f.areLabelsVisible(S.layer)){if(!S.labelClassContexts||
!S.labelClassContexts.length){if(null===S.labelClassContexts){this._deactivateLabelingContext(S);continue}this._createLabelClassContext(S);if(S.labelClassPromise&&S.labelClassAbortController){this._dirty=!0;continue}if(!S.labelClassContexts||!S.labelClassContexts.length)continue}m.someMap(S.labelsToInitialize,(T,H)=>{this._ensureGraphics3DResources(T)&&(this._labels.set(H,T),this.deconflictor.setDirty(),V.madeProgress());if(T.visible&&T.textTextureResources.initialized||!T.visible&&T.hasGraphics3DResources)S.labelsToInitialize.delete(H),
V.madeProgress();return V.done})&&(this._dirty=!0)}this._labelsToRemove.forEach(S=>this._removeLabelTextureFromAtlas(S));this._labelsToAdd.forEach(S=>this._addLabelTextureToAtlas(S));this._labelsToRemove.clear();this._labelsToAdd.clear();this._dirty||this.notifyChange("updating")}};N._createLabelClassContextAsync=function(){var V=b._asyncToGenerator(function*(S){var T=this;const H=S.labelClassAbortController.signal;yield S.layer.when();d.throwIfAborted(H);S.scaleVisibility&&S.scaleVisibility.updateScaleRangeActive();
const U=S.graphics3DCore;var W=U.layer;if((W=W.labelingInfo&&W.labelingInfo.filter(ba=>!!ba.symbol))&&0!==W.length){var Q=Array(W.length),X=!1;yield l.forEach(W,function(){var ba=b._asyncToGenerator(function*(aa,ea){var ia=aa.symbol;const ka=B.getGraphics3DSymbol(U.getOrCreateGraphics3DSymbol(ia));if(h.isNone(ka))M.error("Failed to create Graphics3DSymbol for label");else{yield ka.load();d.throwIfAborted(H);var la=null;w.hasCalloutSupport(ia)&&ia.hasVisibleCallout()&&(la=A.make(ia,U.symbolCreationContext),
yield la.load(),d.throwIfAborted(H));ia=yield l.result(y.createLabelFunction(aa,S.layer.fieldsIndex,T.view.spatialReference));d.throwIfAborted(H);if(!0===ia.ok){const Z=yield T._createTextRenderParameters(ka.symbol);d.throwIfAborted(H);Q[ea]={labelClass:aa,labelFunction:ia.value,graphics3DSymbol:ka,graphics3DCalloutSymbolLayer:la,calloutSymbolLayerIndex:0,textRenderParameters:Z}}else M.error(`Label expression failed to evaluate: ${ia.error}`),X=!0}});return function(aa,ea){return ba.apply(this,arguments)}}());
d.throwIfAborted(H);X||(S.labelClassContexts=Q)}});return function(S){return V.apply(this,arguments)}}();N._createLabelClassContext=function(){var V=b._asyncToGenerator(function*(S){S.labelClassPromise||(S.labelClassPromise=this._createLabelClassContextAsync(S).catch(T=>{if(d.isAbortError(T))throw T;S.labelClassContexts=null}).then(()=>{S.labelClassAbortController=null;this.notifyChange("updating")}).catch(()=>{}),this.notifyChange("updating"));return S.labelClassPromise});return function(S){return V.apply(this,
arguments)}}();N._createTextRenderParameters=function(){var V=b._asyncToGenerator(function*(S){return(S=S.symbolLayers.getItemAt(0))&&"text"===S.type?O.TextRenderParameters.fromSymbol(S,this.view.state.pixelRatio):null});return function(S){return V.apply(this,arguments)}}();N._destroyLabelClassContext=function(V){for(var S of V.labelClassContexts)--S.graphics3DSymbol.referenced,S.graphics3DSymbol=null;S=V.labelClassAbortController;V.labelClassAbortController=new AbortController;S&&S.abort();V.labelClassContexts=
[];V.labelClassPromise=null;this.notifyChange("updating")};N._createTextSymbolGraphic=function(V,S,T,H,U){V={text:V.text,centerOffset:T.centerOffset,translation:T.translation,elevationOffset:T.elevationOffset,screenOffset:T.screenOffset,centerOffsetUnits:T.centerOffsetUnits,horizontalPlacement:D.horizontalPlacementFromAnchor(T.anchor),verticalPlacement:D.verticalPlacementFromAnchor(T.anchor),verticalOffset:T.verticalOffset,debugDrawLabelBorder:E.LABELS_SHOW_BORDER,displayWidth:V.displayWidth,displayHeight:V.displayHeight};
J.graphic=S;J.renderingInfo=null;J.layer=H;return U.createLabel(J,V,this._hudMaterialCollection,this._textTextureAtlas)};N._createLineCalloutGraphic=function(V,S,T,H,U){S={symbol:S,translation:H.translation,elevationOffset:H.elevationOffset,screenOffset:H.screenOffset,centerOffset:H.centerOffset,centerOffsetUnits:H.centerOffsetUnits,materialCollection:this._calloutMaterialCollection};J.graphic=V;J.renderingInfo=S;J.layer=U;return T.createGraphics3DGraphic(J)};N._ensureGraphics3DResources=function(V){if(V.hasGraphics3DResources)return!1;
const S=V.graphics3DGraphic;if(S.destroyed)return!1;this._ensureTextTextureResources(V);const {textTextureResources:T}=V,H=V.labelingContext,U=H.labelClassContexts;if(!U||0===U.length||!H.emptySymbolLabelSupported&&0===S.graphics.length)return!1;var W=!1,Q=S.graphic;const X=H.layer;var ba=f.areLabelsVisible(H.layer);const aa=this.view._stage;for(let ia=0;ia<U.length;ia++){const ka=T.textRenderers[ia],la=T.labelPlacements[ia];if(h.isNone(ka)||h.isNone(la))continue;const Z=U[ia];var ea=Z.graphics3DSymbol;
const ca=ea.symbol&&"label-3d"===ea.symbol.type?ea.symbol:null;if(ea=ea.symbolLayers[0]){ea.setElevationInfoOverride(H.elevationInfoOverride);W=this._createTextSymbolGraphic(ka,Q,la,X,ea);if(!W)return!1;W._labelClass=Z.labelClass;W._labelIndex=ia;S.addLabelGraphic(W,aa,H.stageLayer);S.setVisibilityFlag(z.VisibilityFlag.USER_SETTING,ba,z.VisibilityGroup.LABEL);S.clearVisibilityFlag(z.VisibilityFlag.SCALE_RANGE,z.VisibilityGroup.LABEL);S.setVisibilityFlag(z.VisibilityFlag.DECONFLICTION,!1,z.VisibilityGroup.LABEL);
W=!0;(ba=Z.graphics3DCalloutSymbolLayer)&&la.hasLabelVerticalOffset&&(ba.setElevationInfoOverride(H.elevationInfoOverride),Q=this._createLineCalloutGraphic(Q,ca,ba,la,X),h.isSome(Q)&&(Z.calloutSymbolLayerIndex=S.labelGraphics.length,S.addLabelGraphic(Q,aa,H.stageLayer)));break}}H.scaleVisibility&&W&&H.scaleVisibility.updateGraphicLabelScaleVisibility(S);return V.hasGraphics3DResources=!0};N._destroyGraphics3DResources=function(V){const S=V.labelingContext.labelClassContexts;for(const T of V.graphics3DGraphic.labelGraphics){if(null==
T._labelClass)continue;const H=S[T._labelIndex].graphics3DSymbol.symbolLayers[0];if(null!=H)H.onRemoveGraphic(T)}V.graphics3DGraphic.clearLabelGraphics();V.hasGraphics3DResources=!1};N._ensureTextTextureResources=function(V){const {textTextureResources:S}=V;if(!S.initialized){var T=V.labelingContext,H=T.labelClassContexts;if(H&&0!==H.length){var U=V.graphics3DGraphic.graphic;for(let X=0;X<H.length;X++){const ba=H[X];S.textRenderers[X]=null;S.labelPlacements[X]=null;if(!ba.textRenderParameters)continue;
var W=ba.labelFunction;let aa;if("arcade"===W.type)try{const ea=W.needsHydrationToEvaluate()?r.hydrateGraphic(U,T.layer):U;aa=W.evaluate(ea)}catch(ea){aa=null}else aa=W.evaluate(U);if(!h.isNone(aa)&&""!==aa&&!/^\s+$/.test(aa)&&(W=ba.graphics3DSymbol,W.symbolLayers[0]&&(W=C.get({graphics3DGraphic:V.graphics3DGraphic,labelSymbol:W.symbol&&"label-3d"===W.symbol.type?W.symbol:null,labelClass:ba.labelClass,disablePlacement:T.disablePlacement}),!h.isNone(W)))){var Q=D.horizontalPlacementFromAnchor(W.anchor);
Q=D.textRenderAlignmentFromHorizontalPlacement(Q);S.textRenderers[X]=new G.TextRenderer(aa,Q,ba.textRenderParameters);S.labelPlacements[X]=W}}S.initialized=!0}}};N._destroyTextTextureResources=function(V){({textTextureResources:V}=V);V.initialized=!1;V.textRenderers=[];V.labelPlacements=[]};N._addGraphic=function(V,S){const T={hasGraphics3DResources:!1,visible:!1,rendered:!1,labelingContext:V,graphics3DGraphic:S,textTextureResources:{initialized:!1,textRenderers:[],labelPlacements:[]}};S=S.graphic.uid;
V.labels.set(S,T);V.labelsToInitialize.set(S,T);this.setDirty();this.deconflictor.setDirty()};N._removeGraphic=function(V,S){S=S.graphic.uid;const T=V.labels.get(S);T&&(this._destroyGraphic(T,S),V.labels.delete(S),V.labelsToInitialize.delete(S),this.setDirty(),this.deconflictor.setDirty())};N._destroyGraphic=function(V,S){this._labels.has(S)&&(this._labels.delete(S),this._labelsToAdd.delete(S),this._labelsToRemove.delete(S));V.textTextureResources.initialized&&(this._removeLabelTextureFromAtlas(V),
this._destroyTextTextureResources(V));V.hasGraphics3DResources&&this._destroyGraphics3DResources(V)};N._labelingInfoChange=function(){var V=b._asyncToGenerator(function*(S,T){if(T)for(const H of T){if(T=S.labels.get(H))this._removeGraphic(S,T.graphics3DGraphic),this._addGraphic(S,T.graphics3DGraphic)}else return this._visibilityInfoChange(S),this._resetLabels(S),this._createLabelClassContext(S)});return function(S,T){return V.apply(this,arguments)}}();N._globalPropertyChanged=function(V,S){for(const T of S.labelClassContexts){const H=
new Map;S.labels.forEach(U=>{U=U.graphics3DGraphic;H.set(U.graphic.uid,U)});h.unwrap(T.graphics3DSymbol.symbolLayers[0]).globalPropertyChanged(V,H,U=>U.labelGraphics[0]);T.graphics3DCalloutSymbolLayer&&T.graphics3DCalloutSymbolLayer.globalPropertyChanged(V,H,U=>U.labelGraphics[T.calloutSymbolLayerIndex])}};N._visibilityInfoChange=function(V){const S=V.layer.labelsVisible;S&&!V.active&&this._activateLabelingContext(V);!S&&V.active&&this._deactivateLabelingContext(V);this.setDirty()};N._resetAllLabels=
function(){for(const V of this._labelingContexts)this._resetLabels(V)};N._resetLabels=function(V){V.labels.forEach((S,T)=>{this._destroyGraphic(S,T);S.visible=!1;S.rendered=!1;V.labelsToInitialize.set(T,S)});this._destroyLabelClassContext(V);this.setDirty();this.deconflictor.setDirty()};N._findLabelingContext=function(V){for(const S of this._labelingContexts)if(S.graphics3DCore===V)return S;return null};N.addGraphicsOwner=function(V,S,T){const H=T&&T.emptySymbolLabelSupported||!1,U=T&&T.elevationInfoOverride||
null;T=T&&T.disablePlacement||null;if(!this._findLabelingContext(V)){var W=V.layer,Q={graphics3DCore:V,layer:W,scaleVisibility:S,emptySymbolLabelSupported:H,elevationInfoOverride:U,disablePlacement:T,active:W.labelsVisible,labelClassPromise:null,labelClassAbortController:new AbortController,labelClassContexts:[],labels:new Map,labelsToInitialize:new Map,stageLayer:new L.WebGLLayer({isPickable:!0},W.uid)};this.view._stage.add(Q.stageLayer);this._labelingContexts.push(Q);this.setDirty();return{addGraphic:X=>
this._addGraphic(Q,X),removeGraphic:X=>this._removeGraphic(Q,X),featureReductionChange:()=>{},layerLabelsEnabled:()=>f.areLabelsVisible(Q.layer),labelingInfoChange:X=>this._labelingInfoChange(Q,X),elevationInfoChange:()=>this._globalPropertyChanged("elevationInfo",Q),slicePlaneEnabledChange:()=>this._globalPropertyChanged("slicePlaneEnabled",Q),visibilityInfoChange:()=>this._visibilityInfoChange(Q),reset:()=>this._resetLabels(Q),clear:()=>{}}}};N.removeGraphicsOwner=function(V){const S=this._findLabelingContext(V);
S&&(V=this._labelingContexts.indexOf(S),this._labelingContexts.splice(V,1),S.labels.forEach(T=>this._removeGraphic(S,T.graphics3DGraphic)),this.view._stage.remove(S.stageLayer),S.stageLayer=null,this.setDirty())};N.setLabelGraphicVisibility=function(V,S){V=V.graphic.uid;const T=this._labels.get(V);T&&T.visible!==S&&(S&&!T.rendered?(this._labelsToAdd.set(V,T),this._labelsToRemove.delete(V),T.textTextureResources.initialized||T.labelingContext.labelsToInitialize.set(V,T)):!S&&T.rendered&&(this._labelsToRemove.set(V,
T),this._labelsToAdd.delete(V)),T.visible=S,this.setDirty())};N.setDirty=function(){!this._dirty&&0<this._labelingContexts.length&&(this._dirty=!0,this.notifyChange("updating"))};b._createClass(P,[{key:"running",get:function(){var V;return this.view.ready&&(this._dirty||(null==(V=this._textTextureAtlas)?void 0:V.updating)||this.deconflictor.running)}},{key:"updating",get:function(){var V;return this._dirty||(null==(V=this._textTextureAtlas)?void 0:V.updating)||this.deconflictor.updating||this._labelingContexts.some(S=>
S.labelClassPromise&&!!S.labelClassAbortController)}},{key:"updatingProgress",get:function(){if(!this.updating||!this._textTextureAtlas)return 1;const V=0<this._labelingContexts.length?this._labelingContexts.reduce((S,T)=>S+(T.labelClassPromise&&T.labelClassAbortController?0:1),0)/this._labelingContexts.length:1;return(this._dirty?0:.3)+(this._textTextureAtlas.updating?0:.1)+.1*V+.5*this.deconflictor.updatingProgress}},{key:"test",get:function(){return{textTextureAtlas:this._textTextureAtlas,resetAllLabels:()=>
this._resetAllLabels()}}}]);return P}(n);c.__decorate([g.property({constructOnly:!0})],a.Labeler.prototype,"view",void 0);c.__decorate([g.property({constructOnly:!0})],a.Labeler.prototype,"deconflictor",void 0);c.__decorate([g.property()],a.Labeler.prototype,"_textTextureAtlas",void 0);c.__decorate([g.property({type:Boolean,readOnly:!0})],a.Labeler.prototype,"updating",null);a.Labeler=c.__decorate([k.subclass("esri.views.3d.layers.graphics.Labeler")],a.Labeler);const J=new x(null,null,null);Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/hydratedFeatures":function(){define("exports ../../Graphic ../../core/has ../../core/lang ../../core/maybe ../../core/typedArrayUtil ../../geometry/support/jsonUtils ./dehydratedFeatures".split(" "),function(a,b,c,n,l,u,v,m){function h(y){return"declaredClass"in y}function d(y){return"declaredClass"in y}function e(y){return"declaredClass"in y}function g(y){return l.isNone(y)?null:h(y)?y:v.fromJSON(p(y))}function p(y){const f=
y.spatialReference.toJSON();switch(y.type){case "point":{const {x:w,y:z,z:A,m:x}=y;return{x:w,y:z,z:A,m:x,spatialReference:f}}case "polygon":{const {rings:w,hasZ:z,hasM:A}=y;return{rings:t(w),hasZ:z,hasM:A,spatialReference:f}}case "polyline":{const {paths:w,hasZ:z,hasM:A}=y;return{paths:t(w),hasZ:z,hasM:A,spatialReference:f}}case "extent":{const {xmin:w,xmax:z,ymin:A,ymax:x,zmin:B,zmax:C,mmin:D,mmax:E,hasZ:F,hasM:G}=y;return{xmin:w,xmax:z,ymin:A,ymax:x,zmin:B,zmax:C,mmin:D,mmax:E,hasZ:F,hasM:G,spatialReference:f}}case "multipoint":{const {points:w,
hasZ:z,hasM:A}=y;return{points:r(w)?q(w):w,hasZ:z,hasM:A,spatialReference:f}}}}function t(y){return k(y)?y.map(f=>q(f)):y}function q(y){return y.map(f=>u.toArray(f))}function k(y){for(const f of y)if(0!==f.length)return r(f);return!1}function r(y){return y.length&&(u.isFloat32Array(y[0])||u.isFloat64Array(y[0]))}a.clonePoint=function(y,f){if(!y)return null;if(d(y)){if(null==f)return y.clone();if(d(f))return f.copy(y)}null!=f?(f.x=y.x,f.y=y.y,f.spatialReference=y.spatialReference,y.hasZ?(f.z=y.z,f.hasZ=
y.hasZ):(f.z=null,f.hasZ=!1),y.hasM?(f.m=y.m,f.hasM=!0):(f.m=null,f.hasM=!1)):(f=m.makeDehydratedPoint(y.x,y.y,y.z,y.spatialReference),y.hasM&&(f.m=y.m,f.hasM=!0));return f};a.hydrateGeometry=g;a.hydrateGraphic=function(y,f){if(!y)return null;if(e(y))return y;f=new b({layer:f,sourceLayer:f});f.visible=y.visible;f.symbol=n.clone(y.symbol);f.attributes=n.clone(y.attributes);f.geometry=g(y.geometry);return f};a.isHydratedGeometry=h;a.isHydratedGraphic=e;a.isHydratedPoint=d;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatures":function(){define("exports ../../core/byteSizeEstimations ../../core/has ../../core/maybe ../../core/typedArrayUtil ../../core/uid ../../geometry/SpatialReference ../../geometry/support/aaBoundingBox ../../geometry/support/aaBoundingRect ../../geometry/support/quantizationUtils ../../geometry/support/typeUtils ../support/Field ./dehydratedFeatureComparison".split(" "),function(a,b,c,n,l,u,v,
m,h,d,e,g,p){function t(w,z,A){if(n.isNone(w))return null;switch(z){case "point":return{x:w.x,y:w.y,z:w.z,m:w.m,hasZ:null!=w.z,hasM:null!=w.m,type:"point",spatialReference:A};case "polyline":return{paths:w.paths,hasZ:!!w.hasZ,hasM:!!w.hasM,type:"polyline",spatialReference:A};case "polygon":return{rings:w.rings,hasZ:!!w.hasZ,hasM:!!w.hasM,type:"polygon",spatialReference:A};case "multipoint":return{points:w.points,hasZ:!!w.hasZ,hasM:!!w.hasM,type:"multipoint",spatialReference:A}}}function q(w){if(n.isNone(w))return 0;
let z=32;switch(w.type){case "point":z+=42;break;case "polyline":case "polygon":{var A=0;const x=2+(w.hasZ?1:0)+(w.hasM?1:0);w="polyline"===w.type?w.paths:w.rings;for(const B of w)A+=B.length;z+=8*A*x+64;z+=128*A;z=z+34+32*(w.length+1);break}case "multipoint":A=w.points.length;z+=8*A*(2+(w.hasZ?1:0)+(w.hasM?1:0))+64;z+=128*A;z=z+34+32;break;case "extent":z+=98;w.hasM&&(z+=32);w.hasZ&&(z+=32);break;case "mesh":z+=l.estimateSize(w.vertexAttributes.position),z+=l.estimateSize(w.vertexAttributes.normal),
z+=l.estimateSize(w.vertexAttributes.uv),z+=l.estimateSize(w.vertexAttributes.tangent)}return z}function k(w,z){m.empty(z);"mesh"===w.type&&(w=w.extent);switch(w.type){case "point":z[0]=z[3]=w.x;z[1]=z[4]=w.y;w.hasZ&&(z[2]=z[5]=w.z);break;case "polyline":for(var A=0;A<w.paths.length;A++)m.expandWithNestedArray(z,w.paths[A],w.hasZ);break;case "polygon":for(A=0;A<w.rings.length;A++)m.expandWithNestedArray(z,w.rings[A],w.hasZ);break;case "multipoint":m.expandWithNestedArray(z,w.points,w.hasZ);break;
case "extent":z[0]=w.xmin,z[1]=w.ymin,z[3]=w.xmax,z[4]=w.ymax,null!=w.zmin&&(z[2]=w.zmin),null!=w.zmax&&(z[5]=w.zmax)}}function r(w,z){h.empty(z);"mesh"===w.type&&(w=w.extent);switch(w.type){case "point":z[0]=z[2]=w.x;z[1]=z[3]=w.y;break;case "polyline":for(var A=0;A<w.paths.length;A++)h.expandWithNestedArray(z,w.paths[A]);break;case "polygon":for(A=0;A<w.rings.length;A++)h.expandWithNestedArray(z,w.rings[A]);break;case "multipoint":h.expandWithNestedArray(z,w.points);break;case "extent":z[0]=w.xmin,
z[1]=w.ymin,z[2]=w.xmax,z[3]=w.ymax}}const y=m.create(),f=h.create();a.equals=p.equals;a.DehydratedFeatureClass=function(w,z,A){this.uid=w;this.geometry=z;this.attributes=A;this.visible=!0;this.centroid=this.objectId=null};a.DehydratedFeatureSetClass=function(){this.exceededTransferLimit=!1;this.features=[];this.fields=[];this.hasZ=this.hasM=!1;this.transform=this.spatialReference=this.geohashFieldName=this.geometryProperties=this.globalIdFieldName=this.objectIdFieldName=this.geometryType=null};a.computeAABB=
k;a.computeAABR=r;a.estimateGeometryObjectSize=q;a.estimateSize=function(w){let z;z=32+b.estimateAttributesObjectSize(w.attributes);return z=z+3+(8+q(w.geometry))};a.expandAABB=function(w,z){k(w,y);m.expandWithAABB(z,y)};a.expandAABR=function(w,z){n.isSome(w)&&(r(w,f),h.expand(z,f,z))};a.fromFeatureSetJSON=function(w){const z=e.featureGeometryTypeKebabDictionary.fromJSON(w.geometryType),A=v.fromJSON(w.spatialReference),x=w.transform,B=w.features.map(C=>{var D=w.objectIdFieldName;C={uid:u.generateUID(),
objectId:D&&C.attributes?C.attributes[D]:null,attributes:C.attributes,geometry:t(C.geometry,z,A),visible:!0};D=C.geometry;if(n.isSome(D)&&x)switch(D.type){case "point":C.geometry=d.unquantizePoint(x,D,D,D.hasZ,D.hasM);break;case "multipoint":C.geometry=d.unquantizeMultipoint(x,D,D,D.hasZ,D.hasM);break;case "polygon":C.geometry=d.unquantizePolygon(x,D,D,D.hasZ,D.hasM);break;case "polyline":C.geometry=d.unquantizePolyline(x,D,D,D.hasZ,D.hasM);break;case "extent":C.geometry=D;break;case "mesh":C.geometry=
D}return C});return{geometryType:z,features:B,spatialReference:A,fields:w.fields?w.fields.map(C=>g.fromJSON(C)):null,objectIdFieldName:w.objectIdFieldName,globalIdFieldName:w.globalIdFieldName,geohashFieldName:w.geohashFieldName,geometryProperties:w.geometryProperties,hasZ:w.hasZ,hasM:w.hasM,exceededTransferLimit:w.exceededTransferLimit,transform:null}};a.fromJSONGeometry=t;a.getObjectId=function(w,z){return null!=w.objectId?w.objectId:w.attributes&&z?w.attributes[z]:null};a.hasGeometry=function(w){return n.isSome(w.geometry)};
a.hasVertices=function(w){if(n.isNone(w))return!1;switch(w.type){case "extent":case "point":return!0;case "polyline":for(const z of w.paths)if(0<z.length)return!0;return!1;case "polygon":for(const z of w.rings)if(0<z.length)return!0;return!1;case "multipoint":return 0<w.points.length;case "mesh":return!w.loaded||0<w.vertexAttributes.position.length}};a.isFeatureGeometry=function(w){return e.isFeatureGeometryType(w.type)};a.makeDehydratedPoint=function(w,z,A,x){return{x:w,y:z,z:A,hasZ:null!=A,hasM:!1,
spatialReference:x,type:"point"}};a.numVertices=function(w){if(n.isNone(w))return 0;switch(w.type){case "point":return 1;case "polyline":var z=0;for(var A of w.paths)z+=A.length;return z;case "polygon":A=0;for(z of w.rings)A+=z.length;return A;case "multipoint":return w.points.length;case "extent":return 2;case "mesh":return(w=w.vertexAttributes&&w.vertexAttributes.position)?w.length/3:0}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/quantizationUtils":function(){define(["exports",
"../../core/maybe","./jsonUtils"],function(a,b,c){function n({scale:E,translate:F},G){return Math.round((G-F[0])/E[0])}function l({scale:E,translate:F},G){return Math.round((F[1]-G)/E[1])}function u(E,F,G){const O=[];let K,L,R,M;for(let J=0;J<G.length;J++){const I=G[J];if(0<J){if(R=n(E,I[0]),M=l(E,I[1]),R!==K||M!==L)O.push(F(I,R-K,M-L)),K=R,L=M}else K=n(E,I[0]),L=l(E,I[1]),O.push(F(I,K,L))}return 0<O.length?O:null}function v(E,F,G,O){return u(E,G?O?D:C:O?C:B,F)}function m(E,F,G,O){const K=[];G=G?
O?D:C:O?C:B;for(O=0;O<F.length;O++){const L=u(E,G,F[O]);L&&3<=L.length&&K.push(L)}return K.length?K:null}function h(E,F,G,O){const K=[];G=G?O?D:C:O?C:B;for(O=0;O<F.length;O++){const L=u(E,G,F[O]);L&&2<=L.length&&K.push(L)}return K.length?K:null}function d({scale:E,translate:F},G){return G*E[0]+F[0]}function e({scale:E,translate:F},G){return F[1]-G*E[1]}function g(E,F,G){const O=Array(G.length);if(!G.length)return O;const [K,L]=E.scale;let R=d(E,G[0][0]);E=e(E,G[0][1]);O[0]=F(G[0],R,E);for(let M=1;M<
G.length;M++){const J=G[M];R+=J[0]*K;E-=J[1]*L;O[M]=F(J,R,E)}return O}function p(E,F,G){const O=Array(G.length);for(let K=0;K<G.length;K++)O[K]=g(E,F,G[K]);return O}function t(E,F,G,O){return g(E,G?O?D:C:O?C:B,F)}function q(E,F,G,O){return p(E,G?O?D:C:O?C:B,F)}function k(E,F,G,O){return p(E,G?O?D:C:O?C:B,F)}function r(E,F,G){let [O,K]=G[0],L=Math.min(O,F[0]),R=Math.min(K,F[1]),M=Math.max(O,F[2]);F=Math.max(K,F[3]);for(let J=1;J<G.length;J++){const [I,P]=G[J];O+=I;K+=P;0>I&&(L=Math.min(L,O));0<I&&
(M=Math.max(M,O));0>P?R=Math.min(R,K):0<P&&(F=Math.max(F,K))}E[0]=L;E[1]=R;E[2]=M;E[3]=F;return E}function y(E,F){if(!F.length)return null;E[0]=E[1]=Number.POSITIVE_INFINITY;E[2]=E[3]=Number.NEGATIVE_INFINITY;for(let G=0;G<F.length;G++)r(E,E,F[G]);return E}function f(E,F,G,O,K){F.xmin=n(E,G.xmin);F.ymin=l(E,G.ymin);F.xmax=n(E,G.xmax);F.ymax=l(E,G.ymax);F!==G&&(O&&(F.zmin=G.zmin,F.zmax=G.zmax),K&&(F.mmin=G.mmin,F.mmax=G.mmax));return F}function w(E,F,G,O,K){F.points=v(E,G.points,O,K);return F}function z(E,
F,G,O,K){F.x=n(E,G.x);F.y=l(E,G.y);F!==G&&(O&&(F.z=G.z),K&&(F.m=G.m));return F}function A(E,F,G,O,K){E=m(E,G.rings,O,K);if(!E)return null;F.rings=E;return F}function x(E,F,G,O,K){E=h(E,G.paths,O,K);if(!E)return null;F.paths=E;return F}const B=(E,F,G)=>[F,G],C=(E,F,G)=>[F,G,E[2]],D=(E,F,G)=>[F,G,E[2],E[3]];a.equals=function(E,F){if(E===F||null==E&&null==F)return!0;if(null==E||null==F)return!1;let G,O,K,L;E&&"upperLeft"===E.originPosition?(G=E.translate[0],O=E.translate[1],E=E.scale[0]):(G=b.isSome(E.extent)?
E.extent.xmin:0,O=b.isSome(E.extent)?E.extent.ymax:0,E=E.tolerance);F&&"upperLeft"===F.originPosition?(K=F.translate[0],L=F.translate[1],F=F.scale[0]):(K=b.isSome(F.extent)?F.extent.xmin:0,L=b.isSome(F.extent)?F.extent.ymax:0,F=F.tolerance);return G===K&&O===L&&E===F};a.getQuantizedBoundsCoordsArray=r;a.getQuantizedBoundsCoordsArrayArray=y;a.getQuantizedBoundsPaths=function(E){return y([0,0,0,0],E)};a.getQuantizedBoundsPoints=function(E){const F=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,
Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];return r(F,F,E)};a.getQuantizedBoundsRings=function(E){return y([0,0,0,0],E)};a.quantizeBounds=function(E,F,G){F[0]=n(E,G[0]);F[3]=l(E,G[1]);F[2]=n(E,G[2]);F[1]=l(E,G[3]);return F};a.quantizeExtent=f;a.quantizeGeometry=function(E,F){return E&&F?c.isPoint(F)?z(E,{},F,!1,!1):c.isPolyline(F)?x(E,{},F,!1,!1):c.isPolygon(F)?A(E,{},F,!1,!1):c.isMultipoint(F)?w(E,{},F,!1,!1):c.isExtent(F)?f(E,{},F,!1,!1):null:null};a.quantizeMultipoint=w;a.quantizePaths=
h;a.quantizePoint=z;a.quantizePoints=v;a.quantizePolygon=A;a.quantizePolyline=x;a.quantizeRings=m;a.quantizeX=n;a.quantizeY=l;a.toQuantizationTransform=function(E){return E?{originPosition:"upper-left"===E.originPosition?"upperLeft":"lower-left"===E.originPosition?"lowerLeft":E.originPosition,scale:E.tolerance?[E.tolerance,E.tolerance]:[1,1],translate:b.isSome(E.extent)?[E.extent.xmin,E.extent.ymax]:[0,0]}:null};a.unquantizeBounds=function(E,F,G){return G?(F[0]=d(E,G[0]),F[1]=e(E,G[3]),F[2]=d(E,G[2]),
F[3]=e(E,G[1]),F):[d(E,F[0]),e(E,F[3]),d(E,F[2]),e(E,F[1])]};a.unquantizeCoordsArray=g;a.unquantizeCoordsArrayArray=p;a.unquantizeExtent=function(E,F,G,O,K){F.xmin=d(E,G.xmin);F.ymin=e(E,G.ymin);F.xmax=d(E,G.xmax);F.ymax=e(E,G.ymax);F!==G&&(O&&(F.zmin=G.zmin,F.zmax=G.zmax),K&&(F.mmin=G.mmin,F.mmax=G.mmax));return F};a.unquantizeMultipoint=function(E,F,G,O,K){b.isSome(G)&&(F.points=t(E,G.points,O,K));return F};a.unquantizePaths=q;a.unquantizePoint=function(E,F,G,O,K){if(b.isNone(G))return F;F.x=d(E,
G.x);F.y=e(E,G.y);F!==G&&(O&&(F.z=G.z),K&&(F.m=G.m));return F};a.unquantizePoints=t;a.unquantizePolygon=function(E,F,G,O,K){b.isSome(G)&&(F.rings=k(E,G.rings,O,K));return F};a.unquantizePolyline=function(E,F,G,O,K){b.isSome(G)&&(F.paths=q(E,G.paths,O,K));return F};a.unquantizeRings=k;a.unquantizeX=d;a.unquantizeY=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/graphics/dehydratedFeatureComparison":function(){define(["exports","../../core/has",
"../../core/maybe"],function(a,b,c){function n(d,e){if(d===e)return!0;if(null==d||null==e||d.length!==e.length)return!1;for(let g=0;g<d.length;g++){const p=d[g],t=e[g];if(p.length!==t.length)return!1;for(let q=0;q<p.length;q++)if(p[q]!==t[q])return!1}return!0}function l(d,e){if(d===e)return!0;if(null==d||null==e||d.length!==e.length)return!1;for(let g=0;g<d.length;g++)if(!n(d[g],e[g]))return!1;return!0}function u(d,e){return v(d.spatialReference,e.spatialReference)?d.x===e.x&&d.y===e.y&&d.z===e.z&&
d.m===e.m:!1}function v(d,e){return d===e||d&&e&&d.equals(e)}function m(d,e){if(d===e)return!0;if(c.isNone(d)||c.isNone(e)||d.type!==e.type)return!1;switch(d.type){case "point":return u(d,e);case "extent":return d=d.hasZ!==e.hasZ||d.hasM!==e.hasM?!1:v(d.spatialReference,e.spatialReference)?d.xmin===e.xmin&&d.ymin===e.ymin&&d.zmin===e.zmin&&d.xmax===e.xmax&&d.ymax===e.ymax&&d.zmax===e.zmax:!1,d;case "polyline":return d=d.hasZ!==e.hasZ||d.hasM!==e.hasM?!1:v(d.spatialReference,e.spatialReference)?l(d.paths,
e.paths):!1,d;case "polygon":return d=d.hasZ!==e.hasZ||d.hasM!==e.hasM?!1:v(d.spatialReference,e.spatialReference)?l(d.rings,e.rings):!1,d;case "multipoint":return d=d.hasZ!==e.hasZ||d.hasM!==e.hasM?!1:v(d.spatialReference,e.spatialReference)?n(d.points,e.points):!1,d;case "mesh":return!1}}function h(d,e){if(d===e)return!0;if(!d||!e)return!1;const g=Object.keys(d),p=Object.keys(e);if(g.length!==p.length)return!1;for(const t of g)if(d[t]!==e[t])return!1;return!0}a.equals=function(d,e){return d===e?
!0:null!=d&&null!=e&&d.objectId===e.objectId&&m(d.geometry,e.geometry)&&h(d.attributes,e.attributes)?!0:!1};a.pointEquals=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/labelFormatUtils":function(){define("require exports ../../chunks/_rollupPluginBabelHelpers ../../core/Error ../../core/Logger ../../intl/date ../../intl/number ./fieldUtils ./labelUtils ../../support/arcadeOnDemand".split(" "),function(a,b,c,n,l,u,v,m,h,d){function e(){e=
c._asyncToGenerator(function*(k,r,y){if(!k||!k.symbol)return t;const f=k.where,w=h.getLabelExpression(k);k=f?yield new Promise((z,A)=>a(["../../core/sql/WhereClause"],z,A)):null;if("arcade"===w.type){const z=yield d.createLabelExpression(w.expression,y,r);y={type:"arcade",evaluate(A){try{const x=z.evaluate({$feature:"attributes"in A?z.repurposeFeature(A):A});if(null!=x)return x.toString()}catch(x){p.error(new n("arcade-expression-error","Encountered an error when evaluating label expression for feature",
{feature:A,expression:w}))}return null},needsHydrationToEvaluate(){return null==h.getSingleFieldArcadeExpression(w.expression)}}}else y={type:"simple",evaluate(z){return w.expression.replace(/{[^}]*}/g,A=>{var x=A.slice(1,-1);x=r.get(x);if(!x)return A;A=null;"attributes"in z?z&&z.attributes&&(A=z.attributes[x.name]):A=z.field(x.name);return null==A?"":g(A,x)})}};if(f){let z;try{z=k.WhereClause.create(f,r)}catch(x){return p.error(new n("bad-where-clause","Encountered an error when evaluating where clause, ignoring",
{where:f,error:x})),t}const A=y.evaluate;y.evaluate=x=>{const B="attributes"in x?void 0:q;try{if(z.testFeature(x,B))return A(x)}catch(C){p.error(new n("bad-where-clause","Encountered an error when evaluating where clause for feature",{where:f,feature:x,error:C}))}return null}}return y});return e.apply(this,arguments)}function g(k,r){if(null==k)return"";const y=r.domain;if(y)if("codedValue"===y.type||"coded-value"===y.type)for(var f of y.codedValues){if(f.code===k)return f.name}else if("range"===y.type){f=
+k;const w="range"in y?y.range[1]:y.maxValue;if(("range"in y?y.range[0]:y.minValue)<=f&&f<=w)return y.name}"date"===r.type||"esriFieldTypeDate"===r.type?k=u.formatDate(k,u.convertDateFormatToIntlOptions("short-date")):m.isNumericField(r)&&(k=v.formatNumber(+k));return k?k:""}const p=l.getLogger("esri.layers.support.labelFormatUtils"),t={type:"simple",evaluate(){return null}},q={getAttribute(k,r){return k.field(r)}};b.createLabelFunction=function(k,r,y){return e.apply(this,arguments)};b.formatField=
g;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DCalloutSymbolLayerFactory":function(){define(["exports","../../../../core/Logger","../../../../symbols/callouts/calloutUtils","./Graphics3DLineCalloutSymbolLayer"],function(a,b,c,n){const l=b.getLogger("esri.views.3d.layers.graphics.Graphics3DCalloutSymbolLayerFactory"),u={line:n.Graphics3DLineCalloutSymbolLayer};a.make=function(v,m){if(!c.hasCalloutSupport(v))return l.error("Graphics3DCalloutSymbolLayerFactory#make",
`symbol of type '${v.type}' does not support callouts`),null;if(!v.callout)return null;const h=u[v.callout.type];return h?new h(v,m):(l.error("Graphics3DCalloutSymbolLayerFactory#make",`unknown or unsupported callout type ${v.callout.type}`),null)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLineCalloutSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./pointUtils ./symbolComplexity ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Material ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/LineCalloutMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){g=function(C){function D(F,G){F=C.call(this,F,null,G,B)||this;F._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!1};F.ensureDrapedStatus(!1);return F}b._inheritsLoose(D,C);var E=D.prototype;E.doLoad=function(){var F=b._asyncToGenerator(function*(){this._material=new w.LineCalloutMaterial(this.materialParameters);this._context.stage.add(this._material)});return function(){return F.apply(this,arguments)}}();E.destroy=function(){C.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};E._perInstanceMaterialParameters=function(F){const G=this.materialParameters;G.screenOffset=F.screenOffset||u.ZEROS;G.centerOffsetUnits=F.centerOffsetUnits||"world";return G};E._defaultElevationInfoNoZ=function(){return x};E.createGraphics3DGraphic=function(F){const G=F.renderingInfo;F=F.graphic;const O=this.setGraphicElevationContext(F,new d.ElevationContext,G.elevationOffset||0);var K=G.symbol;const L="on-the-ground"===this._elevationContext.mode&&
("cim"===K.type||!K.symbolLayers.some(R=>"object"===R.type||"text"===R.type));if("label-3d"!==K.type&&L||"point-3d"===K.type&&K.symbolLayers.every(R=>"text"===R.type&&!v.textSymbolLayerSupportsVerticalOffset(R)))return null;K=p.computeCentroid(F.geometry);return n.isNone(K)?null:this._createAs3DShape(K,O,G,F.uid)};E.layerOpacityChanged=function(){if(n.isNone(this._material))return!0;this._material.setParameters(this.materialParameters);return!0};E.layerElevationInfoChanged=function(F,G,O){O=h.elevationModeChangeUpdateType(D.elevationModeChangeTypes,
O,this._elevationContext.mode);if(O!==h.SymbolUpdateType.UPDATE)return O;F.forEach(K=>{const L=G(K);n.isSome(L)&&this.updateGraphicElevationContext(K.graphic,L)});return O};E.slicePlaneEnabledChanged=function(){if(n.isNone(this._material))return!0;this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};E.physicalBasedRenderingChanged=function(){return!0};E.pixelRatioChanged=function(){return!0};E.setGraphicElevationContext=function(F,G,O=0){F=C.prototype.setGraphicElevationContext.call(this,
F,G);F.addOffsetRenderUnits(O);return F};E.updateGraphicElevationContext=function(F,G){this.setGraphicElevationContext(F,G.elevationContext,G.metadata.elevationOffset);G.needsElevationUpdates=h.needsElevationUpdates2D(G.elevationContext.mode)};E.computeComplexity=function(){return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:q.emptySymbolComplexity.memory}};E._createVertexData=function(F){const {translation:G,centerOffset:O}=F;return[[f.VertexAttribute.POSITION,
G?{size:3,data:[G[0],G[1],G[2]],exclusive:!0}:{size:3,data:[0,0,0],exclusive:!0}],[f.VertexAttribute.NORMAL,{size:3,data:[0,0,1],exclusive:!0}],[f.VertexAttribute.AUXPOS1,O?{size:4,data:[O[0],O[1],O[2],O[3]],exclusive:!0}:{size:4,data:[0,0,0,1],exclusive:!0}]]};E._getOrCreateMaterial=function(F){const G=this._perInstanceMaterialParameters(F),O=w.LineCalloutMaterial.uniqueMaterialIdentifier(G);if(n.isSome(this._material)&&O===this._material.uniqueMaterialIdentifier)return{material:this._material,isUnique:!1};
if(F.materialCollection){let K=F.materialCollection.get(O);n.isNone(K)&&(K=new w.LineCalloutMaterial(G),F.materialCollection.add(O,K));return{material:K,isUnique:!1}}return{material:new w.LineCalloutMaterial(G),isUnique:!0}};E._createAs3DShape=function(F,G,O,K){var L=[new r.Geometry(this._createVertexData(O),A,k.PrimitiveType.Point)];const R=this._getOrCreateMaterial(O);K=t.createStageObjectForHUD(this._context,F,L,[R.material],G,this._context.layer.uid,K);if(null===K)return null;L=new e.Graphics3DObject3DGraphicLayer(this,
K.object,L,R.isUnique?[R.material]:null,null,m.perObjectElevationAligner,G);L.metadata={elevationOffset:O.elevationOffset||0};L.alignedSampledElevation=K.sampledElevation;L.needsElevationUpdates=h.needsElevationUpdates2D(G.mode);t.extendPointGraphicElevationContext(L,F,this._context.elevationProvider);return L};b._createClass(D,[{key:"materialParameters",get:function(){const F=this.symbol;var G=F.callout;const O=n.isSome(G.color)?c.toUnitRGBA(G.color):[0,0,0,0];O[3]*=this._getLayerOpacity();const K=
l.pt2px(G.size||0);let L=null;if(F.verticalOffset){const {screenLength:M,minWorldLength:J,maxWorldLength:I}=F.verticalOffset;L={screenLength:l.pt2px(M),minWorldLength:J||0,maxWorldLength:null!=I?I:Infinity}}G=n.isSome(G.border)&&n.isSome(G.border.color)?c.toUnitRGBA(G.border.color):null;const R="object"===F.symbolLayers.getItemAt(0).type;return{color:O,size:K,verticalOffset:L,screenSizePerspective:this._context.screenSizePerspectiveEnabled?this._context.sharedResources.screenSizePerspectiveSettings:
null,screenOffset:[0,0],centerOffsetUnits:"world",borderColor:G,occlusionTest:!R,shaderPolygonOffset:R?0:void 0,depthHUDAlignStart:"label-3d"===F.type,hasSlicePlane:this._context.slicePlaneEnabled,renderOccluded:y.RenderOccludedFlag.Occlude,__tagStrict:"NoParameters"}}}]);return D}(g.Graphics3DSymbolLayer);g.elevationModeChangeTypes={definedChanged:h.SymbolUpdateType.UPDATE,staysOnTheGround:h.SymbolUpdateType.UPDATE,onTheGroundChanged:h.SymbolUpdateType.RECREATE};const z=new Uint16Array([0]),A=[[f.VertexAttribute.POSITION,
z],[f.VertexAttribute.NORMAL,z],[f.VertexAttribute.AUXPOS1,z]],x={mode:"relative-to-ground",offset:0},B={ignoreDrivers:!0,renderPriority:0,renderPriorityStep:1};a.Graphics3DLineCalloutSymbolLayer=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationAligners":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ./elevationAlignmentUtils ./graphicUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){function p(z,A,x,B){let C=!1;const D=x.spatialReference;var E=z.geometry,F=z.getShaderTransformation();z=A.requiresSampledElevationInfo;k[0]=F[12];k[1]=F[13];k[2]=F[14];E.invalidateBoundingInfo();var G=E.getMutableAttribute(g.VertexAttribute.POSITION);F=G.data;var O=E.vertexAttributes.get(g.VertexAttribute.MAPPOS).data;E=G.size;G=F.length/E;O=new e.SamplePosition(O,D);let K=0,L=0;for(let R=0;R<G;R++){r[0]=F[K];r[1]=F[K+1];r[2]=F[K+2];m.evaluateElevationInfoAtPoint(O,
x,A,B,w);z&&(L+=w.sampledElevation);if(d.TESTS_DISABLE_OPTIMIZATIONS)F[K]=O.array[O.offset],F[K+1]=O.array[O.offset+1],F[K+2]=w.z,v.projectBuffer(F,D,K,F,B.spatialReference,K,1),F[K]-=k[0],F[K+1]-=k[1],F[K+2]-=k[2],C=!0;else{q[0]=F[K]+k[0];q[1]=F[K+1]+k[1];q[2]=F[K+2]+k[2];B.setAltitude(q,w.z);F[K]=q[0]-k[0];F[K+1]=q[1]-k[1];F[K+2]=q[2]-k[2];const M=.01/B.unitInMeters;if(Math.abs(r[0]-F[K])>=M||Math.abs(r[1]-F[K+1])>=M||Math.abs(r[2]-F[K+2])>=M)C=!0}K+=E;O.offset+=3}return{update:C,averageGeometrySampledElevation:L/
G}}const t=n.create(),q=u.create(),k=u.create(),r=u.create(),y=n.create(),f=u.create(),w=new m.SampleElevationInfo;a.perLodInstanceElevationAligner=function(z,A,x,B){var C=z.graphics3DSymbolLayer.lodRenderer;if(b.isNone(C))return 0;const D=A.centerPointInElevationSR;m.evaluateElevationInfoAtPoint(D,x,A,B,w);A="absolute-height"!==A.mode?w.sampledElevation:0;C=C.instanceData;z=z.instanceIndex;C.getGlobalTransform(z,y);x=l.set(f,y[12],y[13],y[14]);d.TESTS_DISABLE_OPTIMIZATIONS?(q[0]=D.x,q[1]=D.y,q[2]=
w.z,v.computeTranslationToOriginAndRotation(D.spatialReference,q,y,B.spatialReference)&&C.setGlobalTransform(z,y)):B.setAltitudeOfTransformation(w.z,y);B=.01/B.unitInMeters;(d.TESTS_DISABLE_OPTIMIZATIONS||Math.abs(y[12]-x[0])>=B||Math.abs(y[13]-x[1])>=B||Math.abs(y[14]-x[2])>=B)&&C.setGlobalTransform(z,y);return A};a.perObjectElevationAligner=function(z,A,x,B){z=z.stageObject;const C=A.centerPointInElevationSR;let D=0;z.metadata.usesVerticalDistanceToGround?(m.evaluateElevationInfoAtPoint(C,x,A,B,
w),h.updateVertexAttributeAuxpos1w(z,w.verticalDistanceToGround),D=w.sampledElevation):(m.evaluateElevationInfoAtPoint(C,x,A,B,w),"absolute-height"!==A.mode&&(D=w.sampledElevation));A=c.copy(t,z.transformation);x=l.set(f,A[12],A[13],A[14]);d.TESTS_DISABLE_OPTIMIZATIONS?(q[0]=C.x,q[1]=C.y,q[2]=w.z,v.computeTranslationToOriginAndRotation(C.spatialReference,q,A,B.spatialReference)&&(z.transformation=A)):B.setAltitudeOfTransformation(w.z,A);B=.01/B.unitInMeters;if(Math.abs(A[12]-x[0])>=B||Math.abs(A[13]-
x[1])>=B||Math.abs(A[14]-x[2])>=B)z.transformation=A;return D};a.perVertexElevationAligner=function(z,A,x,B){z=z.stageObject;const C=z.geometryRecords;let D=0;for(const E of C){const {update:F,averageGeometrySampledElevation:G}=p(E,A,x,B);D+=G;F&&z.geometryVertexAttrsUpdated(E)}return D/C.length};a.sharedGeometryElevationAligner=function(z,A,x,B){z=z.stageObject;const C=z.geometryRecords;if(0===C.length)return 0;let D=0,E=null,F=0,G=!1;for(const O of C){const K=O.geometry.vertexAttributes.get(g.VertexAttribute.POSITION);
if(K!==E){const {update:L,averageGeometrySampledElevation:R}=p(O,A,x,B);F=R;E=K;G=L}G&&z.geometryVertexAttrsUpdated(O);D+=F}return D/C.length};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/elevationAlignmentUtils":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../layers/graphics/dehydratedFeatureUtils ./graphicUtils ../../support/ElevationProvider".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(r,y,f,w,z){const A=(m.isDehydratedPoint(r)?r.z:d.isSamplePosition(r)?r.array[r.offset+2]:r[2])||0;switch(f.mode){case "on-the-ground":f=c.unwrapOr(d.getElevationAtPoint(y,r,"ground"),0);z.verticalDistanceToGround=0;z.sampledElevation=f;z.z=f;break;case "relative-to-ground":r=c.unwrapOr(d.getElevationAtPoint(y,r,"ground"),0);f=f.geometryZWithOffset(A,w);z.verticalDistanceToGround=f;z.sampledElevation=r;z.z=f+r;break;case "relative-to-scene":r=c.unwrapOr(d.getElevationAtPoint(y,
r,"scene"),0);f=f.geometryZWithOffset(A,w);z.verticalDistanceToGround=f;z.sampledElevation=r;z.z=f+r;break;case "absolute-height":f=f.geometryZWithOffset(A,w);w=c.unwrapOr(d.getElevationAtPoint(y,r,"ground"),0);z.verticalDistanceToGround=f-w;z.sampledElevation=w;z.z=f;break;default:b.neverReached(f.mode),z.z=0}}let g=function(){this.z=this.sampledElevation=this.verticalDistanceToGround=0};a.SymbolUpdateType=void 0;(function(r){r[r.NONE=0]="NONE";r[r.UPDATE=1]="UPDATE";r[r.RECREATE=2]="RECREATE"})(a.SymbolUpdateType||
(a.SymbolUpdateType={}));const p={"absolute-height":{applyElevationAlignmentBuffer:function(r,y,f,w,z,A,x,B){A=B.calculateOffsetRenderUnits(x);B=B.featureExpressionInfoContext;y*=3;w*=3;for(x=0;x<z;++x){const C=r[y+1],D=r[y+2];f[w+0]=r[y+0];f[w+1]=C;f[w+2]=null==B?D+A:A;y+=3;w+=3}return 0},requiresAlignment:function(r){const y=r.featureExpressionInfoContext;return 0!==r.meterUnitOffset||null!=y}},"on-the-ground":{applyElevationAlignmentBuffer:function(r,y,f,w,z,A){let x=0;const B=A.spatialReference;
y*=3;w*=3;for(let C=0;C<z;++C){const D=r[y+0],E=r[y+1],F=c.unwrapOr(A.getElevation(D,E,r[y+2],B,"ground"),0);x+=F;f[w+0]=D;f[w+1]=E;f[w+2]=F;y+=3;w+=3}return x/z},requiresAlignment:()=>!0},"relative-to-ground":{applyElevationAlignmentBuffer:function(r,y,f,w,z,A,x,B){let C=0;x=B.calculateOffsetRenderUnits(x);B=B.featureExpressionInfoContext;const D=A.spatialReference;y*=3;w*=3;for(let E=0;E<z;++E){const F=r[y+0],G=r[y+1],O=r[y+2],K=c.unwrapOr(A.getElevation(F,G,O,D,"ground"),0);C+=K;f[w+0]=F;f[w+1]=
G;f[w+2]=null==B?O+K+x:K+x;y+=3;w+=3}return C/z},requiresAlignment:()=>!0},"relative-to-scene":{applyElevationAlignmentBuffer:function(r,y,f,w,z,A,x,B){let C=0;x=B.calculateOffsetRenderUnits(x);B=B.featureExpressionInfoContext;const D=A.spatialReference;y*=3;w*=3;for(let E=0;E<z;++E){const F=r[y+0],G=r[y+1],O=r[y+2],K=c.unwrapOr(A.getElevation(F,G,O,D,"scene"),0);C+=K;f[w+0]=F;f[w+1]=G;f[w+2]=null==B?O+K+x:K+x;y+=3;w+=3}return C/z},requiresAlignment:()=>!0}},t=l.create(),q=new g,k=u.create();a.SampleElevationInfo=
g;a.applyElevationAlignmentForHUD=function(r,y,f,w,z){e(y,f,z,w,q);h.updateVertexAttributeAuxpos1w(r,q.verticalDistanceToGround);f=q.sampledElevation;z=n.copy(t,r.transformation);k[0]=y.x;k[1]=y.y;k[2]=q.z;v.computeTranslationToOriginAndRotation(y.spatialReference,k,z,w.spatialReference)?r.transformation=z:console.warn("Could not locate symbol object properly, it might be misplaced");return f};a.applyPerVertexElevationAlignment=function(r,y,f,w,z,A,x,B,C,D,E){const F=p[E.mode];let G=0;if(v.projectBuffer(r,
y,f,w,C.spatialReference,z,B)&&(F.requiresAlignment(E)?(G=F.applyElevationAlignmentBuffer(w,z,A,x,B,C,D,E),r=A,z=x):r=w,v.projectBuffer(r,C.spatialReference,z,A,D.spatialReference,x,B)))return G};a.elevationModeChangeUpdateType=function(r,y,f){return null==y||null==f?r.definedChanged:"on-the-ground"===y&&"on-the-ground"===f?r.staysOnTheGround:y===f||"on-the-ground"!==y&&"on-the-ground"!==f?a.SymbolUpdateType.UPDATE:r.onTheGroundChanged};a.evaluateElevationAlignmentAtPoint=function(r,y,f,w){e(r,y,
f,w,q);return q.z};a.evaluateElevationInfoAtPoint=e;a.needsElevationUpdates2D=function(r){return"relative-to-ground"===r||"relative-to-scene"===r};a.needsElevationUpdates3D=function(r){return"absolute-height"!==r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/graphicUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/centroid ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/hydratedFeatures ../../webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){function k(f){var w=f.paths[0];if(!w||0===w.length)return null;w=g.getPointOnPath(w,g.getPathLength(w)/2);return p.makeDehydratedPoint(w[0],w[1],w[2],f.spatialReference)}function r(f,w,z){z=z?f:t.clonePoint(f);return w&&f?m.projectPoint(f,z,w)?z:null:z}function y(f){if(Array.isArray(f)){for(const w of f)if(!y(w))return!1;return!0}return null==f||0<=f}a.computeCentroid=function(f,w){if("point"===f.type)return r(f,w,!1);if(t.isHydratedGeometry(f))switch(f.type){case "extent":return r(f.center,
w,!1);case "polygon":return r(f.centroid,w,!1);case "polyline":return r(k(f),w,!0);case "mesh":return r(f.origin,w,!1)}else switch(f.type){case "extent":var z=isFinite(f.zmin);f=p.makeDehydratedPoint(.5*(f.xmax+f.xmin),.5*(f.ymax+f.ymin),z?.5*(f.zmax+f.zmin):void 0,f.spatialReference);return r(f,w,!0);case "polygon":return(z=f.rings[0])&&0!==z.length?(z=e.ringsCentroid(f.rings,f.hasZ),f=p.makeDehydratedPoint(z[0],z[1],z[2],f.spatialReference)):f=null,r(f,w,!0);case "polyline":return r(k(f),w,!0)}};
a.computeObjectRotation=function(f,w,z,A=n.create()){f=f||0;w=w||0;z=z||0;0!==f&&c.rotateZ(A,A,-f/180*Math.PI);0!==w&&c.rotateX(A,A,w/180*Math.PI);0!==z&&c.rotateY(A,A,z/180*Math.PI);return A};a.computeObjectScale=function(f=l.ONES,w,z,A=1){const x=Array(3);if(b.isNone(w)||b.isNone(z))x[0]=1,x[1]=1,x[2]=1;else{let C=0;for(let D=2;0<=D;D--){const E=f[D];let F;const G=null!=E,O=0===D&&!B&&!G,K=z[D];"symbol-value"===E||O?F=0!==K?w[D]/K:1:G&&"proportional"!==E&&isFinite(E)&&(F=0!==K?E/K:1);if(null!=F){var B=
x[D]=F;C=Math.max(C,Math.abs(F))}}for(f=2;0<=f;f--)null==x[f]?x[f]=B:0===x[f]&&(x[f]=.001*C)}for(B=2;0<=B;B--)x[B]/=A;return l.fromArray(x)};a.demResolutionForBoundingBox=function(f,w){return null!=w.minDemResolution?w.minDemResolution:h.isPoint(f)?w.minDemResolutionForPoints:.01*h.maximumDimension(f)};a.enlargeExtent=function(f,w,z,A=0){if(f){w||(w=d.create());let x=.5*f.width*(z-1);z=.5*f.height*(z-1);f.width<1E-7*f.height?x+=z/20:f.height<1E-7*f.width&&(z+=x/20);u.set(w,f.xmin-x-A,f.ymin-z-A,f.xmax+
x+A,f.ymax+z+A);return w}return null};a.isValidSize=y;a.mixinColorAndOpacity=function(f,w){const z=v.clone(v.ONES);b.isSome(f)&&(z[0]=f[0],z[1]=f[1],z[2]=f[2]);b.isSome(w)?z[3]=w:b.isSome(f)&&3<f.length&&(z[3]=f[3]);return z};a.overrideColor=function(f,w,z,A,x,B=[0,0,0,0]){for(let C=0;3>C;++C)b.isSome(f)&&null!=f[C]?B[C]=f[C]:b.isSome(z)&&null!=z[C]?B[C]=z[C]:B[C]=x[C];b.isSome(w)?B[3]=w:b.isSome(A)?B[3]=A:B[3]=x[3];return B};a.updateVertexAttributeAuxpos1w=function(f,w){for(let z=0;z<f.geometries.length;++z){const A=
f.geometries[z].getMutableAttribute(q.VertexAttribute.AUXPOS1);A&&A.data[3]!==w&&(A.data[3]=w,f.geometryVertexAttrsUpdated(f.geometryRecords[z]))}};a.validateSymbolLayerSize=function(f){null!=f.isPrimitive&&(f=[f.width,f.depth,f.height]);return y(f)?null:"Symbol sizes may not be negative values"};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationContext":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","../../../../symbols/support/unitConversionUtils","./featureExpressionInfoUtils"],function(a,b,c,n,l){let u=function(){function v(){this._renderUnitOffset=this._meterUnitOffset=0;this._unit="meters";this._metersPerElevationInfoUnit=1;this.mode=this.centerPointInElevationSR=this._featureExpressionInfoContext=null}var m=v.prototype;m.reset=function(){this.mode=null;this._renderUnitOffset=this._meterUnitOffset=0;this._featureExpressionInfoContext=null;this.unit="meters"};m.addOffsetRenderUnits=
function(h){this._renderUnitOffset+=h};m.geometryZWithOffset=function(h,d){d=this.calculateOffsetRenderUnits(d);return null!=this.featureExpressionInfoContext?d:h+d};m.calculateOffsetRenderUnits=function(h){let d=this._meterUnitOffset;const e=this.featureExpressionInfoContext;null!=e&&(d+=l.execute(e)*this._metersPerElevationInfoUnit);return d/h.unitInMeters+this._renderUnitOffset};m.setFromElevationInfo=function(h){this.mode=h.mode;this.unit=n.supportsUnit(h.unit)?h.unit:"meters";this.offsetElevationInfoUnits=
c.unwrapOr(h.offset,0)};m.updateFeatureExpressionInfoContext=function(h,d,e){if(c.isNone(h))this._featureExpressionInfoContext=null;else{var g=h&&h.arcade;g&&c.isSome(d)&&c.isSome(e)?(this._featureExpressionInfoContext=l.clone(h),l.setContextFeature(this._featureExpressionInfoContext,l.createFeature(g.modules,d,e))):this._featureExpressionInfoContext=h}};v.fromElevationInfo=function(h){const d=new v;c.isSome(h)&&d.setFromElevationInfo(h);return d};b._createClass(v,[{key:"featureExpressionInfoContext",
get:function(){return this._featureExpressionInfoContext}},{key:"meterUnitOffset",get:function(){return this._meterUnitOffset}},{key:"unit",get:function(){return this._unit},set:function(h){this._unit=h;this._metersPerElevationInfoUnit=n.getMetersPerUnit(h)}},{key:"requiresSampledElevationInfo",get:function(){return"absolute-height"!==this.mode}},{key:"offsetMeters",set:function(h){this._meterUnitOffset=h;this._renderUnitOffset=0}},{key:"offsetElevationInfoUnits",set:function(h){this._meterUnitOffset=
h*this._metersPerElevationInfoUnit;this._renderUnitOffset=0}}]);return v}();a.ElevationContext=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/featureExpressionInfoUtils":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/Logger","../../../../layers/graphics/hydratedFeatures","../../../../support/arcadeOnDemand"],function(a,b,c,n,l){function u(){u=b._asyncToGenerator(function*(m,
h,d){m=m&&m.expression;if("string"!==typeof m)return null;var e="0"===m?0:null;if(null!=e)return{cachedResult:e};e=yield l.loadArcade();const g=e.arcadeUtils;m=g.createSyntaxTree(m);return g.dependsOnView(m)?(null!=d&&d.error("Expressions containing '$view' are not supported on ElevationInfo"),{cachedResult:0}):{arcade:{func:g.createFunction(m),context:g.createExecContext(null,{sr:h}),modules:e}}});return u.apply(this,arguments)}const v=c.getLogger("esri.views.3d.layers.graphics.featureExpressionInfoUtils");
a.clone=function(m){return{cachedResult:m.cachedResult,arcade:m.arcade?{func:m.arcade.func,context:m.arcade.modules.arcadeUtils.createExecContext(null,{sr:m.arcade.context.spatialReference}),modules:m.arcade.modules}:null}};a.createContext=function(m,h,d){return u.apply(this,arguments)};a.createContextWithoutExpressionSupport=function(m){m=m&&m.expression;return"string"===typeof m&&(m="0"===m?0:null,null!=m)?{cachedResult:m}:null};a.createFeature=function(m,h,d){return m.arcadeUtils.createFeature(h.attributes,
h.geometry,d)};a.execute=function(m){if(null!=m){if(null!=m.cachedResult)return m.cachedResult;var h=m.arcade;h=m.arcade.modules.arcadeUtils.executeFunction(h.func,h.context);"number"!==typeof h&&(h=m.cachedResult=0);return h}return 0};a.extractExpressionInfo=function(m,h=!1){const d=(m=m&&m.featureExpressionInfo)&&m.expression;h||"0"===d||(m=null);return m};a.setContextFeature=function(m,h){null!=m&&null==m.cachedResult&&(h&&m.arcade?(h._geometry&&(h._geometry=n.hydrateGeometry(h._geometry)),m.arcade.modules.arcadeUtils.updateExecContext(m.arcade.context,
h)):v.errorOncePerTick("Arcade support required but not provided"))};a.zeroContext={cachedResult:0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObject3DGraphicLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(y){return y.isVisible?y.parameters.transparent?e.Transparency.TRANSPARENT:e.Transparency.OPAQUE:e.Transparency.INVISIBLE}let p=function(){function y(w,z,A,x,B,C,D,E=null){this.graphics3DSymbolLayer=w;this.stageObject=z;this._uniqueGeometries=A;this._uniqueMaterials=x;this._sharedResource=B;this.elevationAligner=C;this.elevationContext=D;this._edgeState=E;this.type="object3d";this._stage=this._stageLayer=null;this._addedToStage=this._visible=!1;this.alignedSampledElevation=
0;this.useObjectOriginAsAttachmentOrigin=this.needsElevationUpdates=!1;this.graphics3DSymbolLayer=w;this.stageObject=z}var f=y.prototype;f.initialize=function(w,z){this._stageLayer=z;this._stage=w;w.addMany(this._uniqueMaterials);w.addMany(this._uniqueGeometries);w.add(this.stageObject)};f.destroy=function(){var w=this._stage;this._stageLayer&&(w.removeMany(this._uniqueMaterials),w.removeMany(this._uniqueGeometries));w.remove(this.stageObject);this._addedToStage&&(this._stageLayer.remove(this.stageObject),
this._addedToStage=!1);w=this._stage.renderView.ensureEdgeView();w.hasObject(this.stageObject)&&w.removeObject(this.stageObject);this.stageObject.dispose();c.isSome(this._sharedResource)&&this._sharedResource.release();this._visible=!1;this._stage=this._stageLayer=null};f.layerOpacityChanged=function(w,z){if(!c.isNone(this._edgeState)){var A=g(this._edgeState.baseMaterial),x=!1;for(const B of this._edgeState.edgeMaterials)B.objectTransparency!==A&&(B.objectTransparency=A,x=!0);x&&this._resetEdgeObject(z);
this._stage.renderView.ensureEdgeView().updateAllComponentOpacities(this.stageObject,[w])}};f.slicePlaneEnabledChanged=function(w,z){c.isNone(this._edgeState)||(this._stage.renderView.ensureEdgeView().updateAllComponentMaterials(this.stageObject,this._edgeState.edgeMaterials,{hasSlicePlane:w},!z),this._edgeState.properties.hasSlicePlane=w)};f.setVisibility=function(w){if(null!=this._stage&&this._visible!==w&&((this._visible=w)?this._addedToStage?this.stageObject.setVisible(!0):(this._stageLayer.add(this.stageObject),
this._addedToStage=!0):this.stageObject.setVisible(!1),c.isSome(this._edgeState))){const z=this._stage.renderView.ensureEdgeView();z.hasObject(this.stageObject)?z.updateObjectVisibility(this.stageObject,w):w&&this._addOrUpdateEdgeObject(z,!1)}};f.alignWithElevation=function(w,z,A,x){null!=this.elevationAligner&&(c.isSome(A)&&m.setContextFeature(this.elevationContext.featureExpressionInfoContext,A),this.alignedSampledElevation=this.elevationAligner(this,this.elevationContext,w,z),this._resetEdgeObject(x))};
f.getCenterObjectSpace=function(w=l.create()){return n.copy(w,v.getCenter(this.stageObject.boundingVolumeObjectSpace.bounds))};f.getBoundingBoxObjectSpace=function(w=u.create()){const z=this.stageObject.boundingVolumeObjectSpace;u.setMin(w,z.min);u.setMax(w,z.max);return w};f.computeAttachmentOrigin=function(w){if(this.useObjectOriginAsAttachmentOrigin){var z=this.stageObject.transformation;w.render.origin[0]+=z[12];w.render.origin[1]+=z[13];w.render.origin[2]+=z[14];w.render.num++}else for(z of this.stageObject.geometryRecords)z.computeAttachmentOrigin(k)&&
(n.transformMat4(k,k,this.stageObject.transformation),n.add(w.render.origin,w.render.origin,k),w.render.num++)};f.getProjectedBoundingBox=function(){var w=b._asyncToGenerator(function*(z,A,x,B,C){C=this.getBoundingBoxObjectSpace(C);var D=r,E=u.isPoint(C)?1:D.length;for(var F=0;F<E;F++){const G=D[F];q[0]=C[G[0]];q[1]=C[G[1]];q[2]=C[G[2]];n.transformMat4(q,q,this.stageObject.transformation);t[3*F]=q[0];t[3*F+1]=q[1];t[3*F+2]=q[2]}if(!z(t,0,E))return null;u.empty(C);z=null;this.calculateRelativeScreenBounds&&
(z=this.calculateRelativeScreenBounds());for(D=0;D<3*E;D+=3){for(F=0;3>F;F++)C[F]=Math.min(C[F],t[D+F]),C[F+3]=Math.max(C[F+3],t[D+F]);z&&x.push({location:t.slice(D,D+3),screenSpaceBoundingRect:z})}if(A&&A.service&&"absolute-height"!==this.elevationContext.mode){u.center(C,k);x="relative-to-scene"===this.elevationContext.mode?"scene":"ground";E=0;if(A.useViewElevation)E=c.unwrapOr(A.service.getElevation(k[0],k[1],x),0);else try{const G=h.demResolutionForBoundingBox(C,A);E=c.unwrapOr(yield A.service.queryElevation(k[0],
k[1],B,G,x),0)}catch(G){}u.offset(C,0,0,-this.alignedSampledElevation+E)}return C});return function(z,A,x,B,C){return w.apply(this,arguments)}}();f.addObjectState=function(w,z){w===d.Object3DState.Highlight&&z.addObject(this.stageObject,this.stageObject.highlight());w===d.Object3DState.MaskOccludee&&z.addObject(this.stageObject,this.stageObject.maskOccludee())};f.removeObjectState=function(w){w.removeObject(this.stageObject)};f._resetEdgeObject=function(w){if(!c.isNone(this._edgeState)){var z=this._stage.renderView.ensureEdgeView();
this._visible?this._addOrUpdateEdgeObject(z,w):z.removeObject(this.stageObject)}};f._addOrUpdateEdgeObject=function(w,z){const A=this._edgeState;if(!c.isNone(A)){var x=g(A.baseMaterial);for(const B of A.edgeMaterials)B.objectTransparency=x;w.addOrUpdateObject3D(this.stageObject,A.edgeMaterials,A.properties,!z).then(()=>{var B;return null==(B=this._stageLayer)?void 0:B.sync()})}};b._createClass(y,[{key:"isElevationSource",get:function(){return!(!this.stageObject.metadata||!this.stageObject.metadata.isElevationSource)}},
{key:"visible",get:function(){return this._visible}}]);return y}();const t=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],q=l.create(),k=l.create(),r=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]];a.Graphics3DObject3DGraphicLayer=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/interfaces":function(){define(["exports"],function(a){a.Transparency=void 0;var b=a.Transparency||(a.Transparency=
{});b[b.INVISIBLE=0]="INVISIBLE";b[b.TRANSPARENT=1]="TRANSPARENT";b[b.OPAQUE=2]="OPAQUE";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ./elevationAlignmentUtils ./ElevationContext ./featureExpressionInfoUtils ./graphicUtils ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){function k(A,x){A=null!=A?x.attributes[A]:0;return null!=A&&isFinite(A)?A:0}function r(A){const x={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};A&&"visualVariables"in A&&A.visualVariables&&A.visualVariables.forEach(B=>{switch(B.type){case "color":x.color=!0;if(B.stops)for(let C=0;C<B.stops.length;C++){const D=B.stops[C].color;D&&(x.opacity=!0,1>D.a&&(x.opacityAlwaysOpaque=!1))}break;case "opacity":x.opacity=!0;x.opacityAlwaysOpaque=!1;break;case "size":x.size=
!0}});return x}const y=l.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayer");n=function(A){function x(C,D,E,F){var G=A.call(this,E.schedule)||this;G._context=E;G._elevationInfoOverride=null;G._ignoreDrivers=!1;G._drivenProperties={color:!1,opacity:!1,opacityAlwaysOpaque:!0,size:!1};G.complexity=null;G.logger=y;G._elevationOptions={supportsOffsetAdjustment:!1,supportsOnTheGround:!0};G.symbol=C;G.symbolLayer=D;G._renderPriority=F.renderPriority;G._renderPriorityStep=F.renderPriorityStep;
G._elevationContext=new d.ElevationContext;G.complexity=G.computeComplexity();G._ignoreDrivers=F.ignoreDrivers;G._ignoreDrivers||(G._drivenProperties=r(G._context.renderer));G._updateElevationContext();return G}b._inheritsLoose(x,A);var B=x.prototype;B.getCachedSize=function(){return null};B._drivenPropertiesChanged=function(C){if(this._ignoreDrivers)return!1;const D=this._drivenProperties;C=r(C);return C.color!==D.color||C.opacity!==D.opacity||C.opacityAlwaysOpaque!==D.opacityAlwaysOpaque||C.size!==
D.size};B._logGeometryCreationWarnings=function(C,D,E,F){const G="polygons"in C?C.polygons:null;F=`${F} geometry failed to be created`;let O=null;C.projectionSuccess?!D.length||1===D.length&&!D[0].length?O=`${F} (no ${E} were defined)`:Array.isArray(D)&&Array.isArray(D[0])?G&&0===G.length&&"rings"===E&&0<D.length&&2<D[0].length&&(O=`${F} (filled rings should use clockwise winding - try reversing the order of vertices)`):O=`${F} (${E} should be defined as a 2D array)`:O=`${F} (failed to project geometry to view spatial reference)`;
O&&y.warnOncePerTick(O)};B._validateGeometry=function(C,D=null,E=null){return u.isSome(D)&&!D.includes(C.type)?(this.logger.warn("unsupported geometry type for "+E+` symbol: ${C.type}`),!1):"point"!==C.type||isFinite(C.x)&&isFinite(C.y)?!0:(y.warn("point coordinate is not a valid number, graphic skipped"),!1)};B._defaultElevationInfoNoZ=function(){return f};B._defaultElevationInfoZ=function(){return w};B._updateElevationContext=function(){u.isSome(this._elevationInfoOverride)?(this._elevationContext.setFromElevationInfo(this._elevationInfoOverride),
this._elevationContext.updateFeatureExpressionInfoContext(null)):this._context.layer.elevationInfo?(this._elevationContext.setFromElevationInfo(this._context.layer.elevationInfo),this._elevationContext.updateFeatureExpressionInfoContext(this._context.featureExpressionInfoContext)):this._elevationContext.reset()};B.getDefaultElevationInfo=function(C){return C.hasZ?this._defaultElevationInfoZ():this._defaultElevationInfoNoZ()};B.getGeometryElevationMode=function(C,D=this.getDefaultElevationInfo(C)){return this._elevationContext.mode||
D.mode};B.setElevationInfoOverride=function(C){this._elevationInfoOverride=C;this._updateElevationContext()};B.setGraphicElevationContext=function(C,D){var E=u.unwrap(C.geometry);const F=this.getDefaultElevationInfo(E);D.unit=null!=this._elevationContext.unit?this._elevationContext.unit:F.unit;D.mode=this.getGeometryElevationMode(E,F);D.offsetMeters=u.unwrapOr(this._elevationContext.meterUnitOffset,u.unwrapOr(F.offset,0));if(E=!this._elevationOptions.supportsOnTheGround&&"on-the-ground"===D.mode)D.mode=
"relative-to-ground",D.offsetMeters=0;D.updateFeatureExpressionInfoContext(E?e.zeroContext:this._elevationContext.featureExpressionInfoContext,C,this._context.layer);return D};B.prepareSymbolLayerPatch=function(C){};B.updateGeometry=function(C,D){return!1};B.onRemoveGraphic=function(C){};B._getLayerOpacity=function(){if(this._context.graphicsCoreOwner&&"fullOpacity"in this._context.graphicsCoreOwner)return this._context.graphicsCoreOwner.fullOpacity;const C=this._context.layer.opacity;return null==
C?1:C};B._getCombinedOpacity=function(C,D=z){let E=1;this.draped||(E*=this._getLayerOpacity());if(this._drivenProperties.opacity)return E;u.isSome(C)?E*=C.a:D.hasIntrinsicColor||(E=0);return E};B._getCombinedOpacityAndColor=function(C,D=z){D=this._getCombinedOpacity(C,D);if(this._drivenProperties.color)return g.mixinColorAndOpacity(null,D);C=u.isSome(C)?c.toUnitRGB(C):v.ONES;return g.mixinColorAndOpacity(C,D)};B._getVertexOpacityAndColor=function(C,D=null){C=g.mixinColorAndOpacity(this._drivenProperties.color?
C.color:null,this._drivenProperties.opacity?C.opacity:null);u.isSome(D)&&(C[0]*=D,C[1]*=D,C[2]*=D,C[3]*=D);return C};B.isFastUpdatesEnabled=function(){return this._fastUpdates&&this._fastUpdates.enabled};B.computeComplexity=function(){return q.defaultSymbolLayerComplexity(this.symbol,this.symbolLayer)};B.globalPropertyChanged=function(C,D,E){switch(C){case "opacity":return this.layerOpacityChanged(D,E);case "elevationInfo":return C=this._elevationContext.mode,this._updateElevationContext(),this.layerElevationInfoChanged(D,
E,C)===h.SymbolUpdateType.RECREATE?!1:!0;case "slicePlaneEnabled":return this.slicePlaneEnabledChanged(D,E);case "physicalBasedRenderingEnabled":return this.physicalBasedRenderingChanged();case "pixelRatio":return this.pixelRatioChanged();default:return!1}};B.updateGraphics3DGraphicElevationInfo=function(C,D,E){let F=h.SymbolUpdateType.UPDATE;C.forEach(G=>{const O=D(G);u.isSome(O)?(this.setGraphicElevationContext(G.graphic,O.elevationContext),O.needsElevationUpdates=E(O.elevationContext.mode)):F=
h.SymbolUpdateType.RECREATE});return F};B.applyRendererDiff=function(C,D){return p.ApplyRendererDiffResult.Recreate_Symbol};B.getFastUpdateAttrValues=function(C){if(!this._fastUpdates.enabled)return null;const D=this._fastUpdates.visualVariables,E=D.size?k(D.size.field,C):0,F=D.color?k(D.color.field,C):0;C=D.opacity?k(D.opacity.field,C):0;return m.fromValues(E,F,C,0)};B.ensureDrapedStatus=function(C){if(null==this._draped)return this._draped=C,!0;C!==this.draped&&y.warnOnce("A symbol can only produce either draped or non-draped visualizations. Use two separate symbol instances for draped and non-draped graphics if necessary.");
return!1};B.test=function(){return{drivenProperties:this._drivenProperties,getVisVarFields:()=>{var C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S;return{size:null!=(C=null==(D=this._fastUpdates)?void 0:null==(E=D.visualVariables)?void 0:null==(F=E.size)?void 0:F.field)?C:null,color:null!=(G=null==(O=this._fastUpdates)?void 0:null==(K=O.visualVariables)?void 0:null==(L=K.color)?void 0:L.field)?G:null,opacity:null!=(R=null==(M=this._fastUpdates)?void 0:null==(J=M.visualVariables)?void 0:null==(I=J.opacity)?void 0:
I.field)?R:null,rotation:null!=(P=null==(N=this._fastUpdates)?void 0:null==(V=N.visualVariables)?void 0:null==(S=V.rotation)?void 0:S.field)?P:null}}}};b._createClass(x,[{key:"extentPadding",get:function(){return 0}},{key:"needsDrivenTransparentPass",get:function(){return this._drivenProperties.opacity&&!this._drivenProperties.opacityAlwaysOpaque}},{key:"draped",get:function(){return this._draped}}]);return x}(t.Loadable);const f={mode:"on-the-ground",offset:0,unit:"meters"},w={mode:"absolute-height",
offset:0,unit:"meters"},z={hasIntrinsicColor:!1};a.Graphics3DSymbolLayer=n;a.getAttributeValue=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/interfaces":function(){define(["exports"],function(a){a.ApplyRendererDiffResult=void 0;var b=a.ApplyRendererDiffResult||(a.ApplyRendererDiffResult={});b[b.Recreate_Symbol=0]="Recreate_Symbol";b[b.Recreate_Graphics=1]="Recreate_Graphics";b[b.Fast_Update=2]="Fast_Update";Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Loadable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../../core/promiseUtils"],function(a,b,c,n){let l=function(){function u(m){this.schedule=m;this._loadStatus=a.LoadStatus.LOADING;this.logger=null}var v=u.prototype;v.destroy=function(){this.abortLoad()};v.load=function(m,h){if(this._loadStatus===a.LoadStatus.LOADED)return m&&m(),c.unwrap(this._loader);
if(this._loadStatus===a.LoadStatus.FAILED)return h&&h(this._loadError),c.unwrap(this._loader);c.isNone(this._loader)&&(this._abortController=new AbortController,this._loader=this.doLoad(this._abortController.signal).then(()=>{this._abortController=null;this._loadStatus=a.LoadStatus.LOADED},d=>{this._loadError=d;this._abortController=null;this._loadStatus=a.LoadStatus.FAILED;!n.isAbortError(d)&&this.logger&&d.message&&this.logger.warn(d.message);throw d;}));this._loader.then(m,h).catch(()=>{});return this._loader};
v.abortLoad=function(){c.isSome(this._abortController)?this._abortController=c.abortMaybe(this._abortController):this._loadStatus===a.LoadStatus.LOADING&&(this._loadStatus=a.LoadStatus.FAILED);this._loader=null};b._createClass(u,[{key:"loadStatus",get:function(){return this._loadStatus}}]);return u}();a.LoadStatus=void 0;(function(u){u[u.LOADING=0]="LOADING";u[u.LOADED=1]="LOADED";u[u.FAILED=2]="FAILED"})(a.LoadStatus||(a.LoadStatus={}));a.Loadable=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/symbolComplexity":function(){define("exports ../../../../core/compilerUtils ../../../../core/maybe ../../../../symbols/support/ObjectSymbol3DLayerResource ./primitiveObjectSymbolUtils ../support/edgeUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodResources".split(" "),function(a,b,c,n,l,u,v,m){function h(k){let r=0,y=0,f=0,w=!1,z=0;const A={bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0,
draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}};for(const x of k)c.isNone(x)||(r+=x.primitivesPerFeature,y+=x.primitivesPerCoordinate,f+=x.drawCallsPerFeature,A.bytesPerFeature+=x.memory.bytesPerFeature,A.bytesPerFeatureLabel+=x.memory.bytesPerFeatureLabel,A.bytesPerCoordinate+=x.memory.bytesPerCoordinate,A.draped.bytesPerFeature+=x.memory.bytesPerFeature,A.draped.bytesPerFeatureLabel+=x.memory.bytesPerFeatureLabel,A.draped.bytesPerCoordinate+=x.memory.bytesPerCoordinate,w=
w||x.estimated,++z);return{primitivesPerFeature:r,primitivesPerCoordinate:y,drawCallsPerFeature:f,estimated:w,memory:A,numComplexities:z}}function d(k,r){const y=e(k,r);var f=u.hasEdges(r)?2:0;switch(r.type){case "extrude":return{primitivesPerFeature:-4,primitivesPerCoordinate:4,drawCallsPerFeature:f,estimated:!1,memory:y};case "fill":return"mesh-3d"===k.type?{primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:f,estimated:!1,memory:y}:c.isSome(r.outline)&&0<r.outline.size?{primitivesPerFeature:-4,
primitivesPerCoordinate:3,drawCallsPerFeature:0,estimated:!1,memory:y}:{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:y};case "water":return{primitivesPerFeature:-2,primitivesPerCoordinate:1,drawCallsPerFeature:0,estimated:!1,memory:y};case "line":return{primitivesPerFeature:-2,primitivesPerCoordinate:2,drawCallsPerFeature:0,estimated:!1,memory:y};case "object":return r.resource&&r.resource.href?{primitivesPerFeature:16,primitivesPerCoordinate:0,drawCallsPerFeature:0,
estimated:!0,memory:y}:{...g(r.resource&&r.resource.primitive||n.defaultPrimitive),memory:y};case "path":{var w=k=0;switch(r.profile){case "circle":k=10;break;case "quad":k=4;break;default:b.neverReached(r.profile);return}switch(r.join){case "round":w=3;break;case "miter":case "bevel":w=1;break;default:b.neverReached(r.join);return}f=2*k;w=k*w*2;let z=-2*w-f;switch(r.cap){case "none":break;case "butt":case "square":z+=2*(k-1);break;case "round":z+=2*(4*k+k);break;default:return}return{primitivesPerFeature:z,
primitivesPerCoordinate:w+f,drawCallsPerFeature:0,estimated:!1,memory:y}}case "text":case "icon":return{primitivesPerFeature:2,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:y}}}function e(k,r){k="point-3d"===k.type;switch(r.type){case "extrude":return r.edges&&0<r.edges.size?q.EXTRUDE_EDGES:q.EXTRUDE;case "fill":return c.isSome(r.outline)&&0<r.outline.size?q.FILL_OUTLINE:q.FILL;case "water":return q.FILL;case "line":return"round"===r.join?q.LINE_ROUND:q.LINE_MITER;case "path":switch(r.join){case "round":switch(r.profile){case "circle":return q.PATH_ROUND_CIRCLE;
case "quad":return q.PATH_ROUND_QUAD;default:b.neverReached(r.profile);return}case "miter":case "bevel":switch(r.profile){case "circle":return q.PATH_MITER_CIRCLE;case "quad":return q.PATH_MITER_QUAD;default:b.neverReached(r.profile);return}default:b.neverReached(r.join);return}case "object":return k?q.OBJECT_POINT:q.OBJECT_POLYGON;case "icon":case "text":return k?q.ICON_POINT:q.ICON_POLYGON}}function g(k){var r=t[k];if(r)return r;r=l.primitiveLodResources(k,null);r={primitivesPerFeature:m.geometriesFromLodLevelResources(r.levels[0]).reduce((y,
f)=>y+f.indices.get(v.VertexAttribute.POSITION).length/3,0),primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1};return t[k]=r}const p={primitivesPerFeature:0,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!0,memory:{bytesPerFeature:0,bytesPerCoordinate:0,bytesPerFeatureLabel:0,draped:{bytesPerFeature:0,bytesPerFeatureLabel:0,bytesPerCoordinate:0}}},t={},q={ICON_POINT:{bytesPerFeature:7127.413186968842,bytesPerFeatureLabel:4826.302896296296,bytesPerCoordinate:0,draped:{bytesPerFeature:3929.4396628895197,
bytesPerFeatureLabel:3550.1332222222227,bytesPerCoordinate:0}},ICON_POLYGON:{bytesPerFeature:9329.452613976147,bytesPerFeatureLabel:3675.3372604938268,bytesPerCoordinate:60.177252982212096,draped:{bytesPerFeature:6190.247450139383,bytesPerFeatureLabel:3744.074358024691,bytesPerCoordinate:59.488211068026104}},OBJECT_POINT:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,bytesPerCoordinate:0,draped:{bytesPerFeature:2350.5884192634558,bytesPerFeatureLabel:4446.651003703703,
bytesPerCoordinate:0}},OBJECT_POLYGON:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506,draped:{bytesPerFeature:4583.807620302299,bytesPerFeatureLabel:3665.342685185186,bytesPerCoordinate:60.11621818101506}},LINE_MITER:{bytesPerFeature:7321.028181375921,bytesPerFeatureLabel:4048.0226716049388,bytesPerCoordinate:186.55621386363578,draped:{bytesPerFeature:4246.856619435009,bytesPerFeatureLabel:3852.3737679012347,bytesPerCoordinate:163.47884002621583}},
LINE_ROUND:{bytesPerFeature:7482.205842738954,bytesPerFeatureLabel:4045.886987654321,bytesPerCoordinate:191.5452524171851,draped:{bytesPerFeature:4473.481387957992,bytesPerFeatureLabel:3842.1112395061728,bytesPerCoordinate:167.27703460226945}},PATH_MITER_CIRCLE:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275,draped:{bytesPerFeature:9010.489006415351,bytesPerFeatureLabel:4230.9109,bytesPerCoordinate:4618.2594178027275}},PATH_ROUND_CIRCLE:{bytesPerFeature:4104.727250200398,
bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957,draped:{bytesPerFeature:4104.727250200398,bytesPerFeatureLabel:4251.8525,bytesPerCoordinate:8019.043777064957}},PATH_MITER_QUAD:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203,draped:{bytesPerFeature:9416.372942261387,bytesPerFeatureLabel:4241.2757,bytesPerCoordinate:3176.7222742582203}},PATH_ROUND_QUAD:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826,
draped:{bytesPerFeature:6614.431545308682,bytesPerFeatureLabel:4206.7461,bytesPerCoordinate:5141.817789093826}},FILL:{bytesPerFeature:9478.244183633637,bytesPerFeatureLabel:3713.816824691358,bytesPerCoordinate:95.9343604185578,draped:{bytesPerFeature:6287.911108168086,bytesPerFeatureLabel:3790.785032098766,bytesPerCoordinate:83.08783220478168}},FILL_OUTLINE:{bytesPerFeature:13085.871870349445,bytesPerFeatureLabel:3392.613241975309,bytesPerCoordinate:118.63968023169875,draped:{bytesPerFeature:8437.199992480122,
bytesPerFeatureLabel:3973.5431172839503,bytesPerCoordinate:106.33556817014312}},EXTRUDE:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477,draped:{bytesPerFeature:19459.53727140414,bytesPerFeatureLabel:3743.7045209876546,bytesPerCoordinate:372.6819978900477}},EXTRUDE_EDGES:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,bytesPerCoordinate:374.3725221561312,draped:{bytesPerFeature:22266.888534913724,bytesPerFeatureLabel:3064.3193358024696,
bytesPerCoordinate:374.3725221561312}}};a.averageSymbolComplexities=function(k){k=h(k);0<k.numComplexities&&(k.primitivesPerFeature/=k.numComplexities,k.primitivesPerCoordinate/=k.numComplexities,k.drawCallsPerFeature/=k.numComplexities,k.memory.bytesPerFeature/=k.numComplexities,k.memory.bytesPerFeatureLabel/=k.numComplexities,k.memory.bytesPerCoordinate/=k.numComplexities,k.memory.draped.bytesPerFeature/=k.numComplexities,k.memory.draped.bytesPerFeatureLabel/=k.numComplexities,k.memory.draped.bytesPerCoordinate/=
k.numComplexities);return k};a.defaultSymbolComplexity=function(k){if("web-style"===k.type)return p;const r=k.symbolLayers.toArray().map(y=>d(k,y));return h(r)};a.defaultSymbolLayerComplexity=d;a.defaultSymbolLayerMemoryComplexity=e;a.emptySymbolComplexity=p;a.memoryEstimators=q;a.totalSymbolComplexities=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/primitiveObjectSymbolUtils":function(){define(["exports","../../../../core/has",
"../../webgl-engine/lib/GeometryUtil"],function(a,b,c){const n=[{tesselation:6,minScreenSpaceRadius:0},{tesselation:18,minScreenSpaceRadius:7},{tesselation:64,minScreenSpaceRadius:65}];a.isValidPrimitive=function(l){switch(l){case "sphere":case "cube":case "diamond":case "cylinder":case "cone":case "inverted-cone":case "tetrahedron":return!0}return!1};a.primitiveLodResources=function(l,u){const v=(m,h,d=!1)=>({levels:m.map(e=>{const g=h(e.tesselation);d&&c.cgToGIS(g);return{components:[{geometry:g,
material:u}],faceCount:g.indexCount/3,minScreenSpaceRadius:e.minScreenSpaceRadius}})});switch(l){case "sphere":return v([{tesselation:0,minScreenSpaceRadius:0},{tesselation:1,minScreenSpaceRadius:8},{tesselation:2,minScreenSpaceRadius:16},{tesselation:3,minScreenSpaceRadius:50},{tesselation:4,minScreenSpaceRadius:250}],m=>c.createPolySphereGeometry(.5,m,!0));case "cube":return v([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createBoxGeometry(1));case "cone":return v(n,m=>c.createConeGeometry(1,.5,
m,!1),!0);case "inverted-cone":return v(n,m=>c.createConeGeometry(1,.5,m,!0),!0);case "cylinder":return v(n,m=>c.createCylinderGeometry(1,.5,m,[0,0,1],[0,0,.5]));case "tetrahedron":return v([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createTetrahedronGeometry(1),!0);case "diamond":return v([{tesselation:0,minScreenSpaceRadius:0}],()=>c.createDiamondGeometry(1),!0)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/edgeUtils":function(){define("exports ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64 ./layerUtils ../../webgl-engine/lib/edgeRendering/interfaces".split(" "),
function(a,b,c,n,l,u,v,m){function h(p,t){if(n.isNone(p))return null;const q=n.isSome(p.color)?u.fromArray(b.toUnitRGBA(p.color)):u.fromValues(0,0,0,0),k=l.pt2px(p.size),r=l.pt2px(p.extensionLength);switch(p.type){case "solid":return d({color:q,size:k,extensionLength:r,...t});case "sketch":return{...g,color:q,size:k,extensionLength:r,...t,type:"sketch"}}}function d(p){return{...e,...p,type:"solid"}}const e={color:u.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:m.Transparency.OPAQUE,
hasSlicePlane:!1},g={color:u.fromValues(0,0,0,.2),size:1,extensionLength:0,opacity:1,objectTransparency:m.Transparency.OPAQUE,hasSlicePlane:!1};a.createMaterial=function(p,t){return h(p&&p.enabled&&p.edges||null,t)};a.createMaterialFromEdges=h;a.createSolidEdgeMaterial=d;a.hasEdges=function(p){return p&&p.enabled&&(v.isExtrudeSymbol3DLayer(p)||v.isFillSymbol3DLayer(p))&&n.isSome(p.edges)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/layerUtils":function(){define(["exports"],
function(a){a.isExtrudeSymbol3DLayer=function(b){return"extrude"===b.type};a.isFillSymbol3DLayer=function(b){return"fill"===b.type};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodResources":function(){define(["exports","../../../../../core/arrayUtils"],function(a,b){function c(n){const l=[];n.components.forEach(u=>{l.push(u.geometry)});return b.unique(l)}a.computeFaceCount=function(n){return c(n).reduce((l,
u)=>l+u.indexCount/3,0)};a.geometriesFromLodLevelResources=c;a.geometriesFromLodResources=function(n){const l=[];n.levels.forEach(u=>{u.components.forEach(v=>{l.push(v.geometry)})});return b.unique(l)};a.materialsFromLodResources=function(n){const l=[];n.levels.forEach(u=>{u.components.forEach(v=>{l.push(v.material)})});return b.unique(l)};a.texturesFromLodResources=function(n){const l=[];n.levels.forEach(u=>{u.components.forEach(v=>{v.textures&&l.push(...v.textures)})});return b.unique(l)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/pointUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/coordsUtils ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./graphicUtils ../../webgl-engine/lib/Object3D".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){const g=
n.create();a.createStageObjectForHUD=function(p,t,q,k,r,y,f,w){const z=q?q.length:0;var A=p.clippingExtent;l.projectPointToVector(t,g,p.elevationProvider.spatialReference);if(b.isSome(A)&&!u.containsPoint(A,g))return null;l.projectPointToVector(t,g,p.renderCoordsHelper.spatialReference);A=p.localOriginFactory.getOrigin(g);y=new e.Object3D({castShadow:!1,metadata:{layerUid:y,graphicUid:f,usesVerticalDistanceToGround:!0}});for(f=0;f<z;f++)y.addGeometry(q[f],k[f],c.IDENTITY,A,w);p=h.applyElevationAlignmentForHUD(y,
t,p.elevationProvider,p.renderCoordsHelper,r);return{object:y,sampledElevation:p}};a.extendPointGraphicElevationContext=function(p,t,q){p=p.elevationContext;q=q.spatialReference;l.projectPointToVector(t,g,q);p.centerPointInElevationSR=m.makeDehydratedPoint(g[0],g[1],t.hasZ?g[2]:0,q)};a.geometryToRenderInfo=function(p,t,q,k,r){const y=new Float64Array(3*p.length),f=new Float64Array(y.length);p.forEach((w,z)=>{y[3*z]=w[0];y[3*z+1]=w[1];y[3*z+2]=2<w.length?w[2]:0});t=h.applyPerVertexElevationAlignment(y,
t,0,f,0,y,0,y.length/3,q,k,r);return{numVertices:p.length,position:y,mapPosition:f,projectionSuccess:null!=t,sampledElevation:t}};a.placePointOnGeometry=function(p){switch(p.type){case "point":return p;case "polygon":case "extent":return d.computeCentroid(p);case "polyline":var t=p.paths[0];if(!t||0===t.length)break;t=v.getPointOnPath(t,v.getPathLength(t)/2);return m.makeDehydratedPoint(t[0],t[1],t[2],p.spatialReference);case "mesh":return p.origin}return null};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/sphere ../../support/mathUtils ./basicInterfaces ./ContentObject ./ContentObjectType ./GeometryRecord ./Object3DStateID ./Util ../materials/renderers/utils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,
p,t,q,k){e=function(f){function w(A={}){var x=f.call(this)||this;x.type=g.ContentObjectType.Object;x._geometryRecords=[];x._geometries=[];x._objectTransformation=l.create();x._bvObjectSpace=new y;x._bvWorldSpace=new y;x._bvDirty=!0;x._hasVolatileTransformation=!1;x._visible=!0;x.castShadow=null!=A.castShadow?A.castShadow:!0;x.metadata=A.metadata;x.metadata&&x.metadata.isElevationSource&&(x.metadata.lastValidElevationBB=new r);x.transformation=l.create();const {geometries:B,materials:C,transformations:D,
origins:E}=A;if(!Array.isArray(B))return b._assertThisInitialized(x);q.assert(C.length===B.length,"Object3D: materials don't match geometries");q.assert(D.length===B.length,"Object3D: transformations don't match geometries");x._geometryRecords.length=B.length;x._geometries.length=B.length;for(A=0;A<B.length;A++)x._geometries[A]=B[A],x._geometryRecords[A]=p.GeometryRecord.pool.acquire(B[A],C[A],l.clone(D[A]),{highlights:null,occludees:null,visible:x._visible},E&&E[A]);return x}b._inheritsLoose(w,f);
var z=w.prototype;z.dispose=function(){this._geometryRecords.length=0;this._geometries.length=0};z.addGeometry=function(A,x,B,C,D){B=B?B:l.IDENTITY;this._geometries.push(A);A=p.GeometryRecord.pool.acquire(A,x,B,{highlights:null,occludees:null,visible:this._visible},C,D);this._geometryRecords.push(A);this._hasVolatileTransformation=this._hasVolatileTransformation||c.isSome(A.shaderTransformation);this._emit("objectGeometryAdded",{object:this,record:A});this._invalidateBoundingVolume();return A};z.removeGeometry=
function(A){const x=this._geometryRecords.splice(A,1)[0];this._hasVolatileTransformation=c.isSome(x.shaderTransformation)?this._geometryRecords.some(B=>c.isSome(B.shaderTransformation)):this._hasVolatileTransformation;x.dispose();this._geometries.splice(A,1);this._emit("objectGeometryRemoved",{object:this,record:x});this._invalidateBoundingVolume();return x};z.removeAllGeometries=function(){for(;0<this.geometryRecords.length;)this.removeGeometry(0)};z.geometryVertexAttrsUpdated=function(A){this._emit("vertexAttrsUpdated",
{object:this,record:A});this._invalidateBoundingVolume()};z.setVisible=function(A){if(this._visible!==A){this._visible=A;for(const x of this._geometryRecords)x.instanceParameters.visible=this._visible;this._emit("visibilityChanged",this)}};z.maskOccludee=function(){const A=new t.Object3DStateID(d.Object3DState.MaskOccludee);for(const x of this._geometryRecords)x.instanceParameters.occludees=k.addObject3DStateID(x.instanceParameters.occludees,A);this._emit("occlusionChanged",this);return A};z.removeOcclude=
function(A){for(const x of this._geometryRecords)x.instanceParameters.occludees=k.removeObject3DStateID(x.instanceParameters.occludees,A);this._emit("occlusionChanged",this)};z.highlight=function(){const A=new t.Object3DStateID(d.Object3DState.Highlight);for(const x of this._geometryRecords)x.instanceParameters.highlights=k.addObject3DStateID(x.instanceParameters.highlights,A);this._emit("highlightChanged",this);return A};z.removeHighlight=function(A){for(const x of this._geometryRecords)x.instanceParameters.highlights=
k.removeObject3DStateID(x.instanceParameters.highlights,A);this._emit("highlightChanged",this)};z.getCombinedStaticTransformation=function(A,x){return n.multiply(c.unwrapOr(x,l.create()),this.transformation,A.getStaticTransformation())};z._getCombinedShaderTransformation=function(A,x){x=x||l.create();n.multiply(x,this.transformation,A.getShaderTransformation());return x};z.hasVolativeTransformation=function(){return this._hasVolatileTransformation};z._validateBoundingVolume=function(){if(this._bvDirty||
this._hasVolatileTransformation){this._bvObjectSpace.init();this._bvWorldSpace.init();for(var A=0;A<this._geometryRecords.length;++A){var x=this._geometryRecords[A],B=this._geometries[A].boundingInfo;c.isSome(B)&&(this._calculateTransformedBoundingVolume(B,this._bvObjectSpace,x.getShaderTransformation()),this._calculateTransformedBoundingVolume(B,this._bvWorldSpace,this._getCombinedShaderTransformation(x)))}u.lerp(this._bvObjectSpace.bounds,this._bvObjectSpace.min,this._bvObjectSpace.max,.5);u.lerp(this._bvWorldSpace.bounds,
this._bvWorldSpace.min,this._bvWorldSpace.max,.5);A=v.create();x=v.create();B=h.maxScale(this.transformation);for(let F=0;F<this._geometryRecords.length;++F){var C=this._geometries[F].boundingInfo;if(!c.isNone(C)){var D=this._geometryRecords[F].getShaderTransformation(),E=h.maxScale(D);u.transformMat4(A,C.getCenter(),D);D=u.distance(A,this._bvObjectSpace.bounds);C=C.getBSRadius()*E;this._bvObjectSpace.bounds[3]=Math.max(this._bvObjectSpace.bounds[3],D+C);u.transformMat4(x,A,this.transformation);E=
u.distance(x,this._bvWorldSpace.bounds);this._bvWorldSpace.bounds[3]=Math.max(this._bvWorldSpace.bounds[3],E+C*B)}}this._bvDirty=!1}};z._calculateTransformedBoundingVolume=function(A,x,B){const C=A.getBBMin();A=A.getBBMax();const D=v.clone(C),E=v.clone(A);u.transformMat4(D,D,B);u.transformMat4(E,E,B);for(var F=0;3>F;++F)x.min[F]=Math.min(x.min[F],D[F],E[F]),x.max[F]=Math.max(x.max[F],D[F],E[F]);for(F=0;3>F;++F){u.copy(D,C);u.copy(E,A);D[F]=A[F];E[F]=C[F];u.transformMat4(D,D,B);u.transformMat4(E,E,
B);for(let G=0;3>G;++G)x.min[G]=Math.min(x.min[G],D[G],E[G]),x.max[G]=Math.max(x.max[G],D[G],E[G])}};z._invalidateBoundingVolume=function(){this._bvDirty=!0;c.isSome(this._parentLayer)&&this._parentLayer.notifyObjectBBChanged(this,this._bvWorldSpace.bounds)};z._emit=function(A,x){c.isSome(this._parentLayer)&&this._parentLayer.events.emit(A,x)};b._createClass(w,[{key:"geometryRecords",get:function(){return this._geometryRecords}},{key:"geometries",get:function(){return this._geometries}},{key:"transformation",
get:function(){return this._objectTransformation},set:function(A){n.copy(this._objectTransformation,A);this._invalidateBoundingVolume();this._emit("objectTransformation",this)}},{key:"parentLayer",get:function(){return this._parentLayer},set:function(A){q.assert(null==this._parentLayer||null==A,"Object3D can only be added to a single Layer");this._parentLayer=A}},{key:"isVisible",get:function(){return this._visible}},{key:"boundingVolumeWorldSpace",get:function(){this._validateBoundingVolume();return this._bvWorldSpace}},
{key:"boundingVolumeObjectSpace",get:function(){this._validateBoundingVolume();return this._bvObjectSpace}},{key:"test",get:function(){const A=this;return{hasGeometry:x=>A._geometries.includes(x),getGeometryIndex:x=>A._geometries.indexOf(x)}}}]);return w}(e.ContentObject);let r=function(){function f(){this.min=v.fromValues(Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);this.max=v.fromValues(-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE)}f.prototype.isEmpty=function(){return this.max[0]<
this.min[0]&&this.max[1]<this.min[1]&&this.max[2]<this.min[2]};return f}(),y=function(f){function w(){var z=f.apply(this,arguments)||this;z.bounds=m.create();return z}b._inheritsLoose(w,f);w.prototype.init=function(){u.set(this.min,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE);u.set(this.max,-Number.MAX_VALUE,-Number.MAX_VALUE,-Number.MAX_VALUE);m.clear(this.bounds)};return w}(r);a.Object3D=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GeometryRecord":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/uid ../../../../chunks/vec3".split(" "),
function(a,b,c,n,l,u){let v=function(){function m(){this._disposed=!1}var h=m.prototype;h.acquire=function(d,e,g,p,t,q){this.id=l.generateUID();this.geometry=d;this.material=e;this.transformation=g;this.instanceParameters=p;this.origin=t;this._shaderTransformation=q;this._disposed=!1};h.release=function(){this._disposed=!1};h.dispose=function(){this._disposed=!0};h.getStaticTransformation=function(){return this.transformation};h.getShaderTransformation=function(){return c.isSome(this._shaderTransformation)?
this._shaderTransformation(this.transformation):this.transformation};h.computeAttachmentOrigin=function(d){return(this.material.computeAttachmentOrigin?this.material.computeAttachmentOrigin(this.geometry,d):this.geometry.computeAttachmentOrigin(d))?(u.transformMat4(d,d,this.getStaticTransformation()),!0):!1};b._createClass(m,[{key:"disposed",get:function(){return this._disposed}},{key:"shaderTransformation",get:function(){return this._shaderTransformation}}]);return m}();v.pool=new n(v);a.GeometryRecord=
v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Object3DStateID":function(){define(["exports","../../../../core/uid"],function(a,b){a.Object3DStateID=function(c){this.channel=c;this.id=b.generateUID()};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/LineCalloutMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2f32 ../../../../chunks/vec2f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/hud/HUD.glsl ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./internal/bufferWriterUtils ../shaders/LineCalloutTechnique ../shaders/LineCalloutTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){let k=function(A){function x(C){C=A.call(this,C,new y)||this;C.techniqueConfig=new q.LineCalloutTechniqueConfiguration;C._uniqueMaterialIdentifier=x.uniqueMaterialIdentifier(C.parameters);return C}b._inheritsLoose(x,A);var B=x.prototype;B.getPassParameters=function(){return this.parameters};B.getConfiguration=function(C,D){C=(null==D?void 0:D.slot)!==e.RenderSlot.LINE_CALLOUTS;this.techniqueConfig.occlusionTestEnabled=this.parameters.occlusionTest;this.techniqueConfig.hasVerticalOffset=
c.isSome(this.parameters.verticalOffset);this.techniqueConfig.hasScreenSizePerspective=c.isSome(this.parameters.screenSizePerspective);this.techniqueConfig.depthHudEnabled=C;this.techniqueConfig.depthHudAlignStartEnabled=!!this.parameters.depthHUDAlignStart;this.techniqueConfig.screenCenterOffsetUnitsEnabled="screen"===this.parameters.centerOffsetUnits?m.HUDSpace.Screen:m.HUDSpace.World;this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasMultipassGeometry=D?D.multipassGeometry.enabled:
!1;return this.techniqueConfig};B.intersect=function(){};B.requiresSlot=function(C){switch(C){case e.RenderSlot.LINE_CALLOUTS:case e.RenderSlot.LINE_CALLOUTS_HUD_DEPTH:return!0}return!1};B.createGLMaterial=function(C){return C.output===v.ShaderOutput.Color?new r(C):null};B.createBufferWriter=function(){return new z};B.validateParameters=function(C){C=x.uniqueMaterialIdentifier(C);C!==this._uniqueMaterialIdentifier&&(this._uniqueMaterialIdentifier=C)};x.uniqueMaterialIdentifier=function(C){return JSON.stringify({screenOffset:C.screenOffset||
[0,0],centerOffsetUnits:C.centerOffsetUnits||"world"})};b._createClass(x,[{key:"uniqueMaterialIdentifier",get:function(){return this._uniqueMaterialIdentifier}}]);return x}(d.Material),r=function(A){function x(){return A.apply(this,arguments)||this}b._inheritsLoose(x,A);x.prototype.beginSlot=function(B){return this.ensureTechnique(t.LineCalloutTechnique,B)};return x}(h),y=function(A){function x(){var B=A.apply(this,arguments)||this;B.screenOffset=l.ZEROS;B.color=[0,0,0,1];B.size=1;B.occlusionTest=
!1;B.shaderPolygonOffset=1E-5;B.depthHUDAlignStart=!1;B.centerOffsetUnits="world";B.hasSlicePlane=!1;return B}b._inheritsLoose(x,A);return x}(d.MaterialParameters);const f=u.newLayout().vec3f(g.VertexAttribute.POSITION).vec3f(g.VertexAttribute.NORMAL).vec2f(g.VertexAttribute.UV0).vec4f(g.VertexAttribute.AUXPOS1),w=[n.fromValues(0,0),n.fromValues(1,0),n.fromValues(0,1),n.fromValues(1,0),n.fromValues(1,1),n.fromValues(0,1)];let z=function(){function A(){this.vertexBufferLayout=f}var x=A.prototype;x.allocate=
function(B){return this.vertexBufferLayout.createBuffer(B)};x.elementCount=function(B){return 6*B.indices.get(g.VertexAttribute.POSITION).length};x.write=function(B,C,D,E){p.writePosition(C.indices.get(g.VertexAttribute.POSITION),C.vertexAttributes.get(g.VertexAttribute.POSITION).data,B.transformation,D.position,E,6);p.writeNormal(C.indices.get(g.VertexAttribute.NORMAL),C.vertexAttributes.get(g.VertexAttribute.NORMAL).data,B.invTranspTransformation,D.normal,E,6);p.writeBufferVec4(C.indices.get(g.VertexAttribute.AUXPOS1),
C.vertexAttributes.get(g.VertexAttribute.AUXPOS1).data,D.auxpos1,E,6);for(B=0;B<w.length;++B)D.uv0.setVec(E+B,w[B])};return A}();a.LineCalloutMaterial=k;a.Parameters=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/LineCallout.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){u=function(g){function p(){return g.apply(this,arguments)||this}c._inheritsLoose(p,g);var t=p.prototype;t.initializeConfiguration=function(q,k){k.spherical=q.viewingMode===n.ViewingMode.Global};t.initializeProgram=function(q){const k=p.shader.get().build(this.configuration);return new m.Program(q.rctx,k,v.Default3D)};t.setPipelineState=function(q){q=q?d.CompareFunction.ALWAYS:d.CompareFunction.LESS;return this.configuration.depthHudEnabled?e.makePipelineState({depthTest:{func:q},
depthWrite:e.defaultDepthWriteParams}):e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.ONE,d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:{func:q},colorWrite:e.defaultColorWriteParams})};t.initializePipeline=function(){return this.setPipelineState(this.configuration.hasMultipassGeometry)};return p}(u.ShaderTechnique);u.shader=new l.ReloadableShaderModule(h.LineCallout,()=>new Promise((g,p)=>a(["./LineCallout.glsl"],g,p)));
b.LineCalloutTechnique=u;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/LineCallout.glsl":function(){define("exports ../core/maybe ./vec2 ./vec2f64 ./vec4f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/AlignPixel.glsl ../views/3d/webgl-engine/core/shaderLibrary/hud/HUD.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassGeometryTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ScreenSizePerspective.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){function r(w){const z=new q.ShaderBuilder;z.include(v.AlignPixel);z.include(m.HUD,w);z.include(u.SliceDraw,w);z.attributes.add(k.VertexAttribute.UV0,"vec2");const {vertex:A,fragment:x}=z;A.uniforms.add([new g.Float4PassUniform("viewport",(B,C)=>C.camera.fullViewport),new p.FloatPassUniform("lineSize",(B,C)=>Math.ceil(B.size)*C.camera.pixelRatio),new e.Float2PassUniform("pixelToNDC",(B,C)=>c.set(f,2/C.camera.fullViewport[2],2/C.camera.fullViewport[3])),new p.FloatPassUniform("borderSize",
(B,C)=>b.isSome(B.borderColor)?C.camera.pixelRatio:0),new e.Float2PassUniform("screenOffset",(B,C)=>c.set(f,B.screenOffset[0]*C.camera.pixelRatio,B.screenOffset[1]*C.camera.pixelRatio))]);z.varyings.add("coverageSampling","vec4");z.varyings.add("lineSizes","vec2");w.hasMultipassGeometry&&z.varyings.add("depth","float");w.hasScreenSizePerspective&&d.addScreenSizePerspectiveAlignment(A);A.code.add(t.glsl`
    void main(void) {
      ProjectHUDAux projectAux;
      vec4 endPoint = projectPositionHUD(projectAux);

      vec3 vpos = projectAux.posModel;
      if (rejectBySlice(vpos)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }
    ${w.occlusionTestEnabled?t.glsl`
      if (!testVisibilityHUD(endPoint)) {
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }`:""}

    ${w.hasScreenSizePerspective?t.glsl`
      vec4 perspectiveFactor = screenSizePerspectiveScaleFactor(projectAux.absCosAngle, projectAux.distanceToCamera, screenSizePerspectiveAlignment);
      vec2 screenOffsetScaled = applyScreenSizePerspectiveScaleFactorVec2(screenOffset, perspectiveFactor);
        `:t.glsl`
      vec2 screenOffsetScaled = screenOffset;
        `}
      // Add view dependent polygon offset to get exact same original starting point. This is mostly
      // used to get the correct depth value
      vec3 posView = (view * vec4(position, 1.0)).xyz;
      ${w.hasMultipassGeometry?"depth \x3d posView.z;":""}

      applyHUDViewDependentPolygonOffset(auxpos1.w, projectAux.absCosAngle, posView);
      vec4 startPoint = proj * vec4(posView, 1.0);
      // Apply screen offset to both start and end point
      vec2 screenOffsetNorm = screenOffsetScaled * 2.0 / viewport.zw;
      startPoint.xy += screenOffsetNorm * startPoint.w;
      endPoint.xy += screenOffsetNorm * endPoint.w;
      // Align start and end to pixel origin
      vec4 startAligned = alignToPixelOrigin(startPoint, viewport.zw);
      vec4 endAligned = alignToPixelOrigin(endPoint, viewport.zw);
    ${w.depthHudEnabled?w.depthHudAlignStartEnabled?t.glsl`endAligned = vec4(endAligned.xy / endAligned.w * startAligned.w, startAligned.zw);`:t.glsl`startAligned = vec4(startAligned.xy / startAligned.w * endAligned.w, endAligned.zw);`:""}
      vec4 projectedPosition = mix(startAligned, endAligned, uv0.y);
      // The direction of the line in screen space
      vec2 screenSpaceDirection = normalize(endAligned.xy / endAligned.w - startAligned.xy / startAligned.w);
      vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x);
    ${w.hasScreenSizePerspective?t.glsl`
      float lineSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(lineSize, perspectiveFactor);
      float borderSizeScaled = applyScreenSizePerspectiveScaleFactorFloat(borderSize, perspectiveFactor);
        `:t.glsl`
      float lineSizeScaled = lineSize;
      float borderSizeScaled = borderSize;
        `}
      float halfPixelSize = lineSizeScaled * 0.5;
      // Calculate a pixel offset from the edge of the pixel, s.t. we keep the line aligned
      // to pixels if it has a full pixel size. Since pixel aligned biases to the bottom-left,
      // we bias the size to the right (for odd sizes) to balance out the bias. Grow sub-pixel
      // sizes towards the left or right s.t. there is a smooth transition (e.g. from 2 to 3 px).
      float halfWholePixelSize = floor(lineSizeScaled) * 0.5;
      float halfPixelSizeInt = floor(halfWholePixelSize);

      // Sub-pixel offset if we need to grow sub-pixels to the left
      float subpixelOffset = -fract(lineSizeScaled) * float(halfWholePixelSize > 0.0);

      // Pixel offset aligning to whole pixels and adding subpixel offset if needed
      float pixelOffset = -halfPixelSizeInt + subpixelOffset;

      // Compute full ndc offset, adding 1px padding for doing anti-aliasing and the border size
      float padding = 1.0 + borderSizeScaled;
      vec2 ndcOffset = (pixelOffset - padding + uv0.x * (lineSizeScaled + padding + padding)) * pixelToNDC;

      // Offset x/y from the center of the line in screen space
      projectedPosition.xy += perpendicularScreenSpaceDirection * ndcOffset * projectedPosition.w;

      // Compute a coverage varying which we can use in the fragment shader to determine
      // how much a pixel is actually covered by the line (i.e. to anti alias the line).
      // This works by computing two coordinates that can be linearly interpolated and then
      // subtracted to find out how far away from the line edge we are.
      float edgeDirection = (uv0.x * 2.0 - 1.0);

      float halfBorderSize = 0.5 * borderSizeScaled;
      float halfPixelSizeAndBorder = halfPixelSize + halfBorderSize;
      float outerEdgeCoverageSampler = edgeDirection * (halfPixelSizeAndBorder + halfBorderSize + 1.0);

      float isOneSided = float(lineSizeScaled < 2.0 && borderSize < 2.0);

      coverageSampling = vec4(
        // Edge coordinate
        outerEdgeCoverageSampler,

        // Border edge coordinate
        outerEdgeCoverageSampler - halfPixelSizeAndBorder * isOneSided,

        // Line offset
        halfPixelSize - 0.5,

        // Border offset
        halfBorderSize - 0.5 + halfPixelSizeAndBorder * (1.0 - isOneSided)
      );

      lineSizes = vec2(lineSizeScaled, borderSizeScaled);

      gl_Position = projectedPosition;
    }
  `);x.uniforms.add([new g.Float4PassUniform("uColor",B=>y(B.color)),new g.Float4PassUniform("borderColor",B=>y(B.borderColor))]);w.hasMultipassGeometry&&(x.include(h.multipassGeometryTest,w),x.uniforms.add(new e.Float2PassUniform("inverseViewport",(B,C)=>C.inverseViewport)));x.code.add(t.glsl`
    void main() {
      ${w.hasMultipassGeometry?"if( geometryDepthTest(gl_FragCoord.xy * inverseViewport, depth) ){ discard; }":""}

      // Mix between line and border coverage offsets depending on whether we need
      // a border (based on the sidedness).
      vec2 coverage = min(1.0 - clamp(abs(coverageSampling.xy) - coverageSampling.zw, 0.0, 1.0), lineSizes);

      // Mix between border and line color based on the line coverage (conceptually the line
      // blends on top of the border background).
      //
      // Anti-alias by blending final result using the full (including optional border) coverage
      // and the color alpha
      float borderAlpha = uColor.a * borderColor.a * coverage.y;
      float colorAlpha = uColor.a * coverage.x;

      float finalAlpha = mix(borderAlpha, 1.0, colorAlpha);

    ${w.depthHudEnabled?t.glsl`
      if (finalAlpha < 0.01) {
        discard;
      }
      `:t.glsl`
      vec3 finalRgb = mix(borderColor.rgb * borderAlpha, uColor.rgb, colorAlpha);
      gl_FragColor = vec4(finalRgb, finalAlpha);
      `}
  }
  `);return z}function y(w){return b.isSome(w)?w:l.ZEROS}const f=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:r},Symbol.toStringTag,{value:"Module"}));a.LineCallout=n;a.build=r})},"esri/views/3d/webgl-engine/shaders/LineCalloutTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/hud/HUD.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u){u=function(v){function m(){var h=v.apply(this,arguments)||this;h.screenCenterOffsetUnitsEnabled=n.HUDSpace.World;h.spherical=!1;h.occlusionTestEnabled=!0;h.hasVerticalOffset=!1;h.hasScreenSizePerspective=!1;h.depthHudEnabled=!1;h.depthHudAlignStartEnabled=!1;h.hasSlicePlane=!1;h.hasMultipassGeometry=!1;return h}b._inheritsLoose(m,v);return m}(u.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:n.HUDSpace.COUNT})],u.prototype,"screenCenterOffsetUnitsEnabled",void 0);
c.__decorate([l.parameter()],u.prototype,"spherical",void 0);c.__decorate([l.parameter()],u.prototype,"occlusionTestEnabled",void 0);c.__decorate([l.parameter()],u.prototype,"hasVerticalOffset",void 0);c.__decorate([l.parameter()],u.prototype,"hasScreenSizePerspective",void 0);c.__decorate([l.parameter()],u.prototype,"depthHudEnabled",void 0);c.__decorate([l.parameter()],u.prototype,"depthHudAlignStartEnabled",void 0);c.__decorate([l.parameter()],u.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],
u.prototype,"hasMultipassGeometry",void 0);c.__decorate([l.parameter({constValue:!0})],u.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([l.parameter({constValue:!1})],u.prototype,"isDraped",void 0);a.LineCalloutTechniqueConfiguration=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DGraphicCreationContext":function(){define(function(){return function(a,b,c){this.graphic=a;this.renderingInfo=b;this.layer=
c}})},"esri/views/3d/layers/graphics/graphicSymbolUtils":function(){define(["exports","./Graphics3DSymbol","./Graphics3DWebStyleSymbol"],function(a,b,c){a.getGraphics3DSymbol=function(n){return n instanceof c?n.graphics3DSymbol:n instanceof b?n:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DSymbol":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/maybe ../../../../core/promiseUtils ./Graphics3DGraphic ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayerFactory ./interfaces ./Loadable ./symbolComplexity".split(" "),
function(a,b,c,n,l,u,v,m,h,d){const e={renderPriority:0,renderPriorityStep:1,ignoreDrivers:!1};return function(g){function p(q,k,r){var y=g.call(this,k.schedule)||this;y._symbol=q;y._context=k;y._backgroundLayers=r;y._destroyed=!1;y.symbolLayers=[];y.referenced=0;y._extentPadding=0;return y}a._inheritsLoose(p,g);var t=p.prototype;t.doLoad=function(){var q=a._asyncToGenerator(function*(k){var r=this;let y=this._symbol.symbolLayers;this._extentPadding=0;this._backgroundLayers&&(y=this._backgroundLayers.concat(y));
const f=y.length;for(;this.symbolLayers.length<y.length;)this.symbolLayers.push(null);this.symbolLayers.length=y.length;const w=[];for(let z=0;z<f;z++){const A=y.getItemAt(z);if(!1===A.enabled)continue;e.renderPriority=1-(1+z)/f;e.renderPriorityStep=1/f;e.ignoreDrivers=A._ignoreDrivers;const x=v.make(this.symbol,A,this._context,e);w.push(n.onAbortOrThrow(k,()=>{this.symbolLayers[z]=null;x.destroy()}));this.symbolLayers[z]=x}yield b.forEach(this.symbolLayers,function(){var z=a._asyncToGenerator(function*(A,
x){if(c.isSome(A))try{yield A.load(),r._extentPadding+=Math.max(r._extentPadding,A.extentPadding)}catch{r.symbolLayers[x]=null}});return function(A,x){return z.apply(this,arguments)}}());for(const z of w)null==z?void 0:z.remove();w.length=0;n.throwIfAborted(k);if(this.symbolLayers.length&&!this.symbolLayers.some(z=>!!z))throw Error();});return function(k){return q.apply(this,arguments)}}();t.getSymbolLayerSize=function(q){q=this.symbolLayers[q];return c.isSome(q)?q.getCachedSize():null};t.createGraphics3DGraphic=
function(q,k){const r=q.graphic,y=Array(this.symbolLayers.length);for(let f=0;f<this.symbolLayers.length;f++){const w=this.symbolLayers[f];y[f]=c.isSome(w)?w.createGraphics3DGraphic(q):null}return new l(r,k||this,y,q.layer,this._context.arcade||this._context.featureExpressionInfoContext&&this._context.featureExpressionInfoContext.arcade&&this._context.featureExpressionInfoContext.arcade.modules||null)};t.globalPropertyChanged=function(q,k){const r=this.symbolLayers.length;for(let y=0;y<r;y++){const f=
this.symbolLayers[y],w=z=>{z=z.graphics[y];return z instanceof u.Graphics3DObject3DGraphicLayer?z:null};if(c.isSome(f)&&!f.globalPropertyChanged(q,k,w))return!1}return!0};t.applyRendererDiff=function(q,k){return this.loadStatus!==h.LoadStatus.LOADED?m.ApplyRendererDiffResult.Recreate_Symbol:this.symbolLayers.reduce((r,y)=>r!==m.ApplyRendererDiffResult.Recreate_Symbol&&c.isSome(y)?Math.min(r,y.applyRendererDiff(q,k)):r,m.ApplyRendererDiffResult.Fast_Update)};t.prepareSymbolPatch=function(q){if(this.loadStatus!==
h.LoadStatus.FAILED&&"partial"===q.diff.type){var k=q.diff.diff;if(k.symbolLayers&&"partial"===k.symbolLayers.type){var r=k.symbolLayers.diff;this.symbolLayers.forEach((y,f)=>{if(!c.isNone(y)){var w=r[f];if(w){const z={diff:w,graphics3DGraphicPatches:[],symbolLayerStatePatches:[]};y.prepareSymbolLayerPatch(z);q.symbolStatePatches.push(...z.symbolLayerStatePatches);z.graphics3DGraphicPatches.length&&q.graphics3DGraphicPatches.push((A,x)=>{const B=A.graphics[f];c.isSome(B)&&z.graphics3DGraphicPatches.forEach(C=>
C(B,x))})}}})}}};t.updateGeometry=function(q,k){for(let r=0;r<this.symbolLayers.length;r++){const y=this.symbolLayers[r];if(c.isNone(y))continue;const f=q.graphics[r];if(c.isNone(f)||!y.updateGeometry(f,k))return!1}return!0};t.onRemoveGraphic=function(q){for(let k=0;k<this.symbolLayers.length;k++){const r=this.symbolLayers[k];if(c.isNone(r))continue;const y=q.graphics[k];if(c.isSome(y))r.onRemoveGraphic(y)}};t.getFastUpdateStatus=function(){let q=0,k=0,r=0;this.symbolLayers.forEach(y=>{c.isNone(y)||
(y.loadStatus===h.LoadStatus.LOADING?q++:y.isFastUpdatesEnabled()?r++:k++)});return{loading:q,slow:k,fast:r}};t.destroy=function(){if(this.destroyed)console.error("Graphics3DSymbol.destroy called when already destroyed!");else{g.prototype.destroy.call(this);for(const q of this.symbolLayers)c.isSome(q)&&q.destroy();this.symbolLayers.length=0;this._destroyed=!0}};a._createClass(p,[{key:"symbol",get:function(){return this._symbol},set:function(q){this._symbol=q;for(let k=0;k<q.symbolLayers.length;k++){const r=
this.symbolLayers[k];c.isNone(r)||(r.symbol=q,r.symbolLayer=q.symbolLayers.items[k])}}},{key:"extentPadding",get:function(){return this._extentPadding}},{key:"complexity",get:function(){return d.totalSymbolComplexities(this.symbolLayers.map(q=>c.get(q,"complexity")))}},{key:"destroyed",get:function(){return this._destroyed}}]);return p}(h.Loadable)})},"esri/views/3d/layers/graphics/Graphics3DGraphic":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/asyncUtils ../../../../core/byteSizeEstimations ../../../../core/maybe ../../../../core/ObjectPool ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Polygon ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ../../../../layers/graphics/dehydratedFeatures ../../../../layers/graphics/featureConversionUtils ./enums ./featureExpressionInfoUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){const y=new l(Array,w=>g.set(w,g.ZERO),null,10,5),f=p.create();return function(){function w(A,x,B,C,D){this.graphic=A;this.graphics3DSymbol=x;this.graphics=B;this._labelGraphics=[];this._auxiliaryGraphics=[];{var E=k.VisibilityFlag._COUNT;const F=Array(k.VisibilityGroup._COUNT);for(let G=0;G<F.length;G++)F[G]=Array(E);E=F}this._visibilityFlags=E;this._featureExpressionFeature=null;this._optimizedGeometry={geometry:null,hasZ:!1,hasM:!1};this._extent=null;
this.isElevationSource=!1;++x.referenced;this._featureExpressionFeature=D?r.createFeature(D,A,C):null;for(const F of B)n.isSome(F)&&(this.isElevationSource=this.isElevationSource||F.isElevationSource)}var z=w.prototype;z.initialize=function(A,x){this._layer=x;this._stage=A;this._forEachSymbolLayerGraphic(B=>{B.initialize(A,x);B.setVisibility(this.isVisible())})};z.destroy=function(){this._forEachSymbolLayerGraphic(A=>A.destroy());this._auxiliaryGraphics=this.graphics=null;--this.graphics3DSymbol.referenced;
this.graphics3DSymbol=null};z.clearLabelGraphics=function(){this._forEachLabelGraphic(A=>A.destroy());this._labelGraphics.length=0};z.addLabelGraphic=function(A,x,B){this._labelGraphics.push(A);A.initialize(x,B);A.setVisibility(this.isVisible(k.VisibilityGroup.LABEL))};z.addAuxiliaryGraphic=function(A){this._auxiliaryGraphics.push(A);this._layer&&(A.initialize(this._stage,this._layer),A.setVisibility(this.isVisible()))};z.isVisible=function(A=k.VisibilityGroup.GRAPHIC,x){for(let B=0;B<=A;B++){const C=
this._visibilityFlags[B];for(let D=0;D<C.length;++D)if(!1===C[D]&&D!==x)return!1}return!0};z.hasVisibilityFlag=function(A,x){return null!=this._visibilityFlags[x][A]};z.setVisibilityFlag=function(A,x,B){const C=this.isVisible(B);this._visibilityFlags[B][A]=x;const D=this.isVisible(B);if(C===D)return!1;if(B===k.VisibilityGroup.LABEL)this._forEachLabelGraphic(E=>E.setVisibility(D));else{this._forEachSymbolLayerGraphic(F=>F.setVisibility(D));const E=this.isVisible(k.VisibilityGroup.LABEL);this._forEachLabelGraphic(F=>
F.setVisibility(E))}return!0};z.clearVisibilityFlag=function(A,x=k.VisibilityGroup.GRAPHIC){return this.setVisibilityFlag(A,void 0,x)};z.computeExtent=function(A){if(!this._extent){var x=this.graphic.geometry;if(n.isNone(x))return!1;this._extent=p.create();t.computeAABR(x,this._extent);x=x.spatialReference;if(!x.equals(A)&&!e.projectBoundingRect(this._extent,x,this._extent,A))return this._extent=null,!1}return!0};z.getAsOptimizedGeometry=function(A,x){if(n.isSome(this._optimizedGeometry.geometry)&&
this._optimizedGeometry.hasZ===A&&this._optimizedGeometry.hasM===x)return this._optimizedGeometry.geometry;this._optimizedGeometry.geometry=this._convertGraphicToOptimizedGeometry(this.graphic,A,x);this._optimizedGeometry.hasZ=A;this._optimizedGeometry.hasM=x;return this._optimizedGeometry.geometry};z._convertGraphicToOptimizedGeometry=function(A,x,B){A=A.geometry;if("mesh"===A.type||"extent"===A.type)A=d.fromExtent("mesh"===A.type?A.extent:A);return q.convertFromGeometry(A,x,B)};z.computeAttachmentOrigin=
function(){const A={render:{origin:h.create(),num:0},draped:{origin:v.create(),num:0}};for(const x of this.graphics)n.isNone(x)||x.computeAttachmentOrigin(A);A.render.num&&m.scale(A.render.origin,A.render.origin,1/A.render.num);A.draped.num&&u.scale(A.draped.origin,A.draped.origin,1/A.draped.num);return A};z.getProjectedBoundingBox=function(){var A=a._asyncToGenerator(function*(x,B,C,D,E){E||(E={boundingBox:null,requiresDrapedElevation:!1,screenSpaceObjects:[]});E.boundingBox?g.empty(E.boundingBox):
E.boundingBox=g.empty();E.requiresDrapedElevation=!1;yield b.forEach(this.graphics,function(){var F=a._asyncToGenerator(function*(G){if(!n.isNone(G)){var O="draped"===G.type?B:x,K=y.acquire();G=yield G.getProjectedBoundingBox(O,C,E.screenSpaceObjects,D,K);isFinite(G[2])&&isFinite(G[5])||(E.requiresDrapedElevation=!0);G&&g.expandWithAABB(E.boundingBox,K);y.release(K)}});return function(G){return F.apply(this,arguments)}}());return g.allFinite(E.boundingBox)||p.allFinite(g.toRect(E.boundingBox,f))?
E:null});return function(x,B,C,D,E){return A.apply(this,arguments)}}();z.needsElevationUpdates=function(){for(const A of this.graphics)if(n.isSome(A)&&("object3d"===A.type||"lod-instance"===A.type)&&A.needsElevationUpdates)return!0;for(const A of this._labelGraphics)if(A&&A.needsElevationUpdates)return!0;return!1};z.alignWithElevation=function(A,x,B){this._forEachRenderedGraphic(C=>{"object3d"!==C.type&&"lod-instance"!==C.type||C.alignWithElevation(A,x,this._featureExpressionFeature,B)})};z.addObjectStateSet=
function(A,x){this._forEachSymbolLayerGraphic(B=>B.addObjectState(A,x))};z.removeObjectState=function(A){this._forEachSymbolLayerGraphic(x=>x.removeObjectState(A))};z._forEachGraphicList=function(A,x){A.forEach(B=>B&&x(B))};z._forEachSymbolLayerGraphic=function(A){this._forEachGraphicList(this.graphics,A);this._forEachGraphicList(this._auxiliaryGraphics,A)};z._forEachLabelGraphic=function(A){this._forEachGraphicList(this._labelGraphics,A)};z._forEachRenderedGraphic=function(A){this._forEachSymbolLayerGraphic(A);
this._forEachLabelGraphic(A)};a._createClass(w,[{key:"labelGraphics",get:function(){return this._labelGraphics}},{key:"extent",get:function(){return this._extent}},{key:"destroyed",get:function(){return null==this.graphics}},{key:"isDraped",get:function(){let A=!1;this._forEachSymbolLayerGraphic(x=>{"draped"===x.type&&(A=!0)});return A}},{key:"usedMemory",get:function(){let A=c.estimateAttributesObjectSize(this.graphic.attributes);this._forEachSymbolLayerGraphic(x=>{const B=x.graphics3DSymbolLayer.complexity;
n.isNone(B)||(x="draped"===x.type?B.memory.draped:B.memory,A+=x.bytesPerFeature,x.bytesPerCoordinate&&(A+=t.numVertices(this.graphic.geometry)*x.bytesPerCoordinate))});return A}}]);return w}()})},"esri/views/3d/layers/graphics/Graphics3DSymbolLayerFactory":function(){define("exports ../../../../core/Logger ./Graphics3DExtrudeSymbolLayer ./Graphics3DIconSymbolLayer ./Graphics3DLineSymbolLayer ./Graphics3DMeshFillSymbolLayer ./Graphics3DObjectSymbolLayer ./Graphics3DPathSymbolLayer ./Graphics3DPolygonFillSymbolLayer ./Graphics3DTextSymbolLayer ./Graphics3DWaterSymbolLayer".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){const g=b.getLogger("esri.views.3d.layers.graphics.Graphics3DSymbolLayerFactory"),p={icon:n.Graphics3DIconSymbolLayer,object:v.Graphics3DObjectSymbolLayer,line:l.Graphics3DLineSymbolLayer,path:m.Graphics3DPathSymbolLayer,fill:h.Graphics3DPolygonFillSymbolLayer,extrude:c.Graphics3DExtrudeSymbolLayer,text:d.Graphics3DTextSymbolLayer,water:e.Graphics3DWaterSymbolLayer},t={"mesh-3d":{fill:u.Graphics3DMeshFillSymbolLayer}};a.make=function(q,k,r,y){const f=t[q.type]&&t[q.type][k.type]||
p[k.type];return f?new f(q,k,r,y):(g.error("GraphicsLayerFactory#make",`unknown symbol type ${k.type}`),null)};a.setSymbolClass=function(q,k){p[q]=k};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DExtrudeSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../chunks/earcut ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../renderers/support/renderingInfoUtils ../../../ViewingMode ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./polygonUtils ../support/edgeUtils ../../support/debugFlags ../../support/ElevationProvider ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L){function R(ka,la,Z,ca){var Y=new Uint32Array(ka.length);ca=[[K.VertexAttribute.POSITION,{size:3,data:Z.positions,exclusive:!0}],[K.VertexAttribute.NORMAL,{size:3,data:Z.normals,exclusive:!0}],[K.VertexAttribute.COLOR,{size:4,data:ca,exclusive:!0}],[K.VertexAttribute.SIZE,{size:1,data:Z.heights,exclusive:!0}]];Y=[[K.VertexAttribute.POSITION,ka],[K.VertexAttribute.NORMAL,ka],[K.VertexAttribute.COLOR,Y]];Z.elevation&&(ca.push([K.VertexAttribute.MAPPOS,
{size:3,data:Z.elevation}]),Y.push([K.VertexAttribute.MAPPOS,ka]));return new G.Geometry(ca,Y,F.PrimitiveType.Triangle,la)}function M(ka,la,Z,ca,Y,da,ha,ja,ma,pa,na,wa,xa,sa){let ya=0;var ra=2*ca.count;{var ua=ca.index,Ba=ca.count,Ea=Z.length/3,Ja=ma;d.copy(ba,xa);const va=0<wa?1:-1;ua*=3;let Ca=Ja;xa=3*Ca;let Ka=Ja+Ba;Ja=3*Ka;for(let Oa=0;Oa<Ba;++Oa)sa&&(ba[0]=ka[ua+0],ba[1]=ka[ua+1],ba[2]=ka[ua+2],d.normalize(ba,ba)),Y[xa+0]=ka[ua+0],Y[xa+1]=ka[ua+1],Y[xa+2]=ka[ua+2],da[xa+0]=la[ua+0],da[xa+1]=
la[ua+1],da[xa+2]=la[ua+2],ha[xa+0]=-va*ba[0],ha[xa+1]=-va*ba[1],ha[xa+2]=-va*ba[2],ja[Ca]=0,Y[Ja+0]=ka[ua+0]+wa*ba[0],Y[Ja+1]=ka[ua+1]+wa*ba[1],Y[Ja+2]=ka[ua+2]+wa*ba[2],da[Ja+0]=la[ua+0],da[Ja+1]=la[ua+1],da[Ja+2]=la[ua+2],ha[Ja+0]=va*ba[0],ha[Ja+1]=va*ba[1],ha[Ja+2]=va*ba[2],ja[Ka]=wa,xa+=3,Ja+=3,ua+=3,Ca+=1,Ka+=1;xa=ua=0;Ja=3*ra;ka=0>wa?ia:ea;la=0>wa?ea:ia;for(sa=0;sa<Ea;++sa)na[xa+0]=Z[ua+ka[0]],na[xa+1]=Z[ua+ka[1]],na[xa+2]=Z[ua+ka[2]],pa[Ja+0]=Z[ua+la[0]]+Ba,pa[Ja+1]=Z[ua+la[1]]+Ba,pa[Ja+2]=
Z[ua+la[2]]+Ba,xa+=3,Ja+=3,ua+=3}ma+=2*ca.count;ra=0;I(Y,da,ja,ha,ya,ca.pathLengths[0],ca.count,ma,pa,ra,wa);ma+=4*ca.pathLengths[0];ra+=2*ca.pathLengths[0];ya+=ca.pathLengths[0];for(Z=1;Z<ca.pathLengths.length;++Z)I(Y,da,ja,ha,ya,ca.pathLengths[Z],ca.count,ma,pa,ra,wa),ma+=4*ca.pathLengths[Z],ra+=2*ca.pathLengths[Z],ya+=ca.pathLengths[Z]}function J(ka,la,Z,ca,Y,da,ha){ca[da]=ca[ha];ha*=3;da*=3;ka[da+0]=ka[ha+0];ka[da+1]=ka[ha+1];ka[da+2]=ka[ha+2];la[da+0]=la[ha+0];la[da+1]=la[ha+1];la[da+2]=la[ha+
2];Z[da+0]=Y[0];Z[da+1]=Y[1];Z[da+2]=Y[2]}function I(ka,la,Z,ca,Y,da,ha,ja,ma,pa,na){let wa=Y,xa=Y+1,sa=Y+ha,ya=Y+ha+1,ra=ja,ua=ja+1,Ba=ja+2*da;ja=ja+2*da+1;0>na&&(wa=Y+ha+1,ya=Y);pa*=3;for(let Oa=0;Oa<da;++Oa){Oa===da-1&&(0<na?(xa=Y,ya=Y+ha):(xa=Y,wa=Y+ha));var Ea=ka,Ja=wa,va=xa,Ca=sa,Ka=V;Ja*=3;va*=3;Ca*=3;d.set(S,Ea[Ja++],Ea[Ja++],Ea[Ja++]);d.set(T,Ea[va++],Ea[va++],Ea[va++]);d.set(H,Ea[Ca++],Ea[Ca++],Ea[Ca++]);d.subtract(U,T,S);d.subtract(W,H,S);d.cross(Ka,W,U);d.normalize(Ka,Ka);J(ka,la,ca,Z,
V,ra,wa);J(ka,la,ca,Z,V,ua,xa);J(ka,la,ca,Z,V,Ba,sa);J(ka,la,ca,Z,V,ja,ya);ma[pa++]=ra;ma[pa++]=Ba;ma[pa++]=ja;ma[pa++]=ra;ma[pa++]=ja;ma[pa++]=ua;wa++;xa++;sa++;ya++;ra+=2;ua+=2;Ba+=2;ja+=2}}function P(ka,la,Z,ca){ka=ka.stageObject;const Y=ka.geometryRecords,da=Y.length,ha="absolute-height"!==la.mode;let ja=0;const ma=ka.transformation,pa=m.invert(h.create(),ma);for(let wa=0;wa<da;wa+=2){const xa=Y[wa].geometry,sa=xa.getMutableAttribute(K.VertexAttribute.POSITION).data,ya=xa.vertexAttributes.get(K.VertexAttribute.SIZE).data;
var na=xa.vertexAttributes.get(K.VertexAttribute.MAPPOS).data;na=new E.SamplePosition(na);const ra=sa.length/3;let ua=0,Ba=!1,Ea=0;const Ja=Z.spatialReference;for(let va=0;va<ra;va++){Q[0]=sa[ua];Q[1]=sa[ua+1];Q[2]=sa[ua+2];y.evaluateElevationInfoAtPoint(na,Z,la,ca,aa);ha&&(Ea+=aa.sampledElevation);D.TESTS_DISABLE_OPTIMIZATIONS?(d.set(X,na.array[na.offset+0],na.array[na.offset+1],aa.z+ya[ua/3]),ca.toRenderCoords(X,Ja,X)):(d.set(X,sa[ua+0],sa[ua+1],sa[ua+2]),d.transformMat4(X,X,ma),ca.setAltitude(X,
aa.z+ya[ua/3]));d.transformMat4(X,X,pa);sa[ua]=X[0];sa[ua+1]=X[1];sa[ua+2]=X[2];const Ca=.01/ca.unitInMeters;if(Math.abs(Q[0]-sa[ua])>=Ca||Math.abs(Q[1]-sa[ua+1])>=Ca||Math.abs(Q[2]-sa[ua+2])>=Ca)Ba=!0;na.offset+=3;ua+=3}Ba&&(xa.invalidateBoundingInfo(),ka.geometryVertexAttrsUpdated(Y[wa]),Y[wa+1].geometry.invalidateBoundingInfo(),ka.geometryVertexAttrsUpdated(Y[wa+1]));ja+=Ea/ra}return ja/da}const N=["polygon","extent"];z=function(ka){function la(ca,Y,da,ha){ca=ka.call(this,ca,Y,da,ha)||this;ca.ensureDrapedStatus(!1);
return ca}b._inheritsLoose(la,ka);var Z=la.prototype;Z.doLoad=function(){var ca=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){var Y=A.validateSymbolLayerSize(this._getSymbolSize());if(Y)throw new c("graphics3dextrudesymbollayer:invalid-size",Y);}Y=n.get(this.symbolLayer,"material","color");var da=this._getCombinedOpacityAndColor(Y);Y=e.fromArray(da);da=da[3];const ha=1>da||this.needsDrivenTransparentPass;Y={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,diffuse:Y,
ambient:Y,opacity:da,transparent:ha,cullFace:ha?F.CullFaceOptions.None:F.CullFaceOptions.Back,hasVertexColors:!0,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!0};this._material=new L.DefaultMaterial(Y);this._bottomMaterial=new L.DefaultMaterial({...Y,cullFace:F.CullFaceOptions.Back});this._context.stage.add(this._material);this._context.stage.add(this._bottomMaterial)});return function(){return ca.apply(this,arguments)}}();Z.destroy=
function(){ka.prototype.destroy.call(this);this._material&&(this._context.stage.remove(this._material),this._context.stage.remove(this._bottomMaterial))};Z.createGraphics3DGraphic=function(ca){const Y=ca.graphic;if(!this._validateGeometry(Y.geometry,N,this.symbolLayer.type))return null;const da=this._getVertexOpacityAndColor(ca.renderingInfo,255),ha=this.setGraphicElevationContext(Y,new f.ElevationContext);return this._createAs3DShape(Y,ca.renderingInfo,da,ha,Y.uid)};Z.layerOpacityChanged=function(ca,
Y){var da=n.get(this.symbolLayer,"material","color");da=this._getCombinedOpacity(da);const ha=1>da||this.needsDrivenTransparentPass;this._material.setParameters({opacity:da,transparent:ha});this._bottomMaterial.setParameters({opacity:da,transparent:ha});const ja=this._getLayerOpacity();ca.forEach(ma=>{ma=Y(ma);n.isSome(ma)&&ma.layerOpacityChanged(ja,this._context.isAsync)});return!0};Z.layerElevationInfoChanged=function(ca,Y){return this.updateGraphics3DGraphicElevationInfo(ca,Y,y.needsElevationUpdates3D)};
Z.slicePlaneEnabledChanged=function(ca,Y){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});this._bottomMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});ca.forEach(da=>{da=Y(da);n.isSome(da)&&da.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};Z.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._bottomMaterial.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!0});return!0};Z.pixelRatioChanged=function(){return!0};Z._getExtrusionSize=function(ca){if(ca.size&&this._drivenProperties.size){var Y;ca=null!=(Y=k.getDriverAxisSizeValue(ca.size,2))?Y:0}else ca=this._getSymbolSize();return ca/=this._context.renderCoordsHelper.unitInMeters};Z.applyRendererDiff=function(ca,Y){return this._drivenPropertiesChanged(Y)?x.ApplyRendererDiffResult.Recreate_Symbol:x.ApplyRendererDiffResult.Recreate_Graphics};Z._getSymbolSize=function(){var ca;return null!=(ca=
this.symbolLayer.size)?ca:1};Z._createAs3DShape=function(ca,Y,da,ha,ja){var ma=B.geometryAsPolygon(ca.geometry);if(n.isNone(ma))return null;ca=B.geometryToRenderInfo(ma,this._context.elevationProvider,this._context.renderCoordsHelper,ha);this._logGeometryCreationWarnings(ca,ma.rings,"rings","ExtrudeSymbol3DLayer");if(0===ma.rings.length||!ma.rings.some(Na=>0<Na.length))return null;var pa=A.computeCentroid(ma);if(n.isNone(pa))return null;var na=[];const wa=[],xa=[],sa=p.create(),ya=h.create(),ra=e.create(),
ua=this._context.renderCoordsHelper.viewingMode===r.ViewingMode.Global;ua||this._context.renderCoordsHelper.worldUpAtPosition(null,ra);g.computeTranslationToOriginAndRotation(ma.spatialReference,[pa.x,pa.y,0],ya,this._context.renderCoordsHelper.spatialReference);ma=h.create();m.invert(ma,ya);pa=v.create();u.normalFromMat4(pa,ma);const {polygons:Ba,mapPosition:Ea,position:Ja}=ca;var va=Ja.length/3;const Ca=new Float64Array(18*va),Ka=new Float64Array(18*va),Oa=new Float64Array(18*va);va=new Float64Array(6*
va);let Ra=0;for(let Na=0;Na<Ba.length;++Na){var Pa=Ba[Na];const Ua=Pa.count;if(this._context.clippingExtent&&(p.empty(sa),p.expandWithBuffer(sa,Pa.mapPosition),!p.intersectsClippingArea(sa,this._context.clippingExtent)))continue;const Ta=l.earcut(Pa.mapPosition,Pa.holeIndices,3);if(0===Ta.length)continue;const Za=new Uint32Array(6*Ua+Ta.length);var qa=new Uint32Array(Ta.length),za=6*Ua,Da=3*Ca.BYTES_PER_ELEMENT;Da=new t.BufferViewVec3f64(Ca.buffer,Ra*Da,Da,(Ra+za)*Da);var La=3*Ka.BYTES_PER_ELEMENT;
La=new t.BufferViewVec3f64(Ka.buffer,Ra*La,La,(Ra+za)*La);const ab=new Float64Array(Oa.buffer,3*Ra*Oa.BYTES_PER_ELEMENT,3*za);za=new Float64Array(va.buffer,1*Ra*va.BYTES_PER_ELEMENT,1*za);const hb=this._getExtrusionSize(Y);M(Ja,Ea,Ta,Pa,Da.typedBuffer,ab,La.typedBuffer,za,0,Za,qa,hb,ra,ua);q.transformMat4(Da,Da,ma);q.transformMat3(La,La,pa);Ra+=6*Ua;Pa=R(Za,Za.length-qa.length,{positions:Da.typedBuffer,elevation:ab,normals:La.typedBuffer,heights:za},da);na.push(Pa);wa.push(this._material);xa.push(h.IDENTITY);
qa=R(qa,0,{positions:Da.typedBuffer,elevation:ab,normals:La.typedBuffer,heights:za},da);na.push(qa);wa.push(this._bottomMaterial);xa.push(h.IDENTITY)}if(0===na.length)return null;Y=new O.Object3D({geometries:na,materials:wa,transformations:xa,metadata:{layerUid:this._context.layer.uid,graphicUid:ja,isElevationSource:!0}});Y.transformation=ya;da=C.createMaterial(this.symbolLayer,{opacity:this._getLayerOpacity()});da=n.isSome(da)?{baseMaterial:this._material,edgeMaterials:[da],properties:{mergeGeometries:!0,
hasSlicePlane:this._context.slicePlaneEnabled}}:null;na=new w.Graphics3DObject3DGraphicLayer(this,Y,na,null,null,P,ha,da);na.alignedSampledElevation=ca.sampledElevation;na.needsElevationUpdates=y.needsElevationUpdates3D(ha.mode);return na};return la}(z.Graphics3DSymbolLayer);const V=e.create(),S=e.create(),T=e.create(),H=e.create(),U=e.create(),W=e.create(),Q=e.create(),X=e.create(),ba=e.create(),aa=new y.SampleElevationInfo,ea=[0,2,1],ia=[0,1,2];a.Graphics3DExtrudeSymbolLayer=z;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/earcut":function(){define(["exports"],function(a){var b={exports:{}};(function(c){(function(n){n=n();void 0!==n&&(c.exports=n)})(function(){function n(D,E,F){F=F||2;var G=E&&E.length,O=G?E[0]*F:D.length,K=l(D,0,O,F,!0),L=[];if(!K||K.next===K.prev)return L;var R;if(G){var M=K;var J=F;K=[];var I;G=0;for(I=E.length;G<I;G++){var P=E[G]*J;var N=G<I-1?E[G+1]*J:D.length;P=l(D,P,N,J,!1);P===P.next&&(P.steiner=!0);K.push(p(P))}K.sort(h);
for(G=0;G<K.length;G++)J=K[G],E=M,(M=e(J,E))?(I=z(M,J),J=u(M,M.next),I=d(I),u(I,I.next),J=d(J),M=d(E===M?J:E)):M=E,M=u(M,M.next);K=M}if(D.length>80*F){var V=R=D[0];var S=G=D[1];for(J=F;J<O;J+=F)E=D[J],M=D[J+1],E<V&&(V=E),M<S&&(S=M),E>R&&(R=E),M>G&&(G=M);R=Math.max(R-V,G-S);R=0!==R?1/R:0}v(K,L,F,V,S,R);return L}function l(D,E,F,G,O){if(O===0<C(D,E,F,G))for(O=E;O<F;O+=G)var K=A(O,D[O],D[O+1],K);else for(O=F-G;O>=E;O-=G)K=A(O,D[O],D[O+1],K);K&&k(K,K.next)&&(D=K.next,x(K),K=D);return K}function u(D,E){if(!D)return D;
E||(E=D);do{var F=!1;if(D.steiner||!k(D,D.next)&&0!==q(D.prev,D,D.next))D=D.next;else{E=D.prev;x(D);D=E;if(D===D.next)break;F=!0}}while(F||D!==E);return E}function v(D,E,F,G,O,K,L){if(D){if(!L&&K){var R=D,M=R;do null===M.z&&(M.z=g(M.x,M.y,G,O,K)),M.prevZ=M.prev,M=M.nextZ=M.next;while(M!==R);M.prevZ.nextZ=null;M.prevZ=null;R=M;var J,I,P,N,V=1;do{M=R;var S=R=null;for(I=0;M;){I++;var T=M;for(J=P=0;J<V&&(P++,T=T.nextZ,T);J++);for(N=V;0<P||0<N&&T;)0!==P&&(0===N||!T||M.z<=T.z)?(J=M,M=M.nextZ,P--):(J=T,
T=T.nextZ,N--),S?S.nextZ=J:R=J,J.prevZ=S,S=J;M=T}S.nextZ=null;V*=2}while(1<I)}for(R=D;D.prev!==D.next;){M=D.prev;T=D.next;if(K)S=m(D,G,O,K);else a:if(S=D,I=S.prev,P=S,V=S.next,0<=q(I,P,V))S=!1;else{for(J=S.next.next;J!==S.prev;){if(t(I.x,I.y,P.x,P.y,V.x,V.y,J.x,J.y)&&0<=q(J.prev,J,J.next)){S=!1;break a}J=J.next}S=!0}if(S)E.push(M.i/F),E.push(D.i/F),E.push(T.i/F),x(D),R=D=T.next;else if(D=T,D===R){if(!L)v(u(D),E,F,G,O,K,1);else if(1===L){D=u(D);L=E;R=F;M=D;do T=M.prev,S=M.next.next,!k(T,S)&&r(T,M,
M.next,S)&&w(T,S)&&w(S,T)&&(L.push(T.i/R),L.push(M.i/R),L.push(S.i/R),x(M),x(M.next),M=D=S),M=M.next;while(M!==D);D=u(M);v(D,E,F,G,O,K,2)}else if(2===L)a:{L=D;do{for(R=L.next.next;R!==L.prev;){if(M=L.i!==R.i){S=S=S=S=void 0;M=L;T=R;if(S=M.next.i!==T.i&&M.prev.i!==T.i){b:{S=M;do{if(S.i!==M.i&&S.next.i!==M.i&&S.i!==T.i&&S.next.i!==T.i&&r(S,S.next,M,T)){S=!0;break b}S=S.next}while(S!==M);S=!1}S=!S}if(S){if(S=w(M,T)&&w(T,M)){S=M;I=!1;P=(M.x+T.x)/2;V=(M.y+T.y)/2;do S.y>V!==S.next.y>V&&S.next.y!==S.y&&
P<(S.next.x-S.x)*(V-S.y)/(S.next.y-S.y)+S.x&&(I=!I),S=S.next;while(S!==M);S=I}S=S&&(q(M.prev,M,T.prev)||q(M,T.prev,T))||k(M,T)&&0<q(M.prev,M,M.next)&&0<q(T.prev,T,T.next)}M=S}if(M){D=z(L,R);L=u(L,L.next);D=u(D,D.next);v(L,E,F,G,O,K);v(D,E,F,G,O,K);break a}R=R.next}L=L.next}while(L!==D)}break}}}}function m(D,E,F,G){var O=D.prev,K=D.next;if(0<=q(O,D,K))return!1;var L=O.x>D.x?O.x>K.x?O.x:K.x:D.x>K.x?D.x:K.x,R=O.y>D.y?O.y>K.y?O.y:K.y:D.y>K.y?D.y:K.y,M=g(O.x<D.x?O.x<K.x?O.x:K.x:D.x<K.x?D.x:K.x,O.y<D.y?
O.y<K.y?O.y:K.y:D.y<K.y?D.y:K.y,E,F,G);E=g(L,R,E,F,G);F=D.prevZ;for(G=D.nextZ;F&&F.z>=M&&G&&G.z<=E;){if(F!==D.prev&&F!==D.next&&t(O.x,O.y,D.x,D.y,K.x,K.y,F.x,F.y)&&0<=q(F.prev,F,F.next))return!1;F=F.prevZ;if(G!==D.prev&&G!==D.next&&t(O.x,O.y,D.x,D.y,K.x,K.y,G.x,G.y)&&0<=q(G.prev,G,G.next))return!1;G=G.nextZ}for(;F&&F.z>=M;){if(F!==D.prev&&F!==D.next&&t(O.x,O.y,D.x,D.y,K.x,K.y,F.x,F.y)&&0<=q(F.prev,F,F.next))return!1;F=F.prevZ}for(;G&&G.z<=E;){if(G!==D.prev&&G!==D.next&&t(O.x,O.y,D.x,D.y,K.x,K.y,G.x,
G.y)&&0<=q(G.prev,G,G.next))return!1;G=G.nextZ}return!0}function h(D,E){return D.x-E.x}function d(D){if(D.next.prev===D)return D;let E=D;do{const F=E.next;if(F.prev===E||F===E||F===D)break;E=F}while(1);return E}function e(D,E){var F=E,G=D.x,O=D.y,K=-Infinity;do{if(O<=F.y&&O>=F.next.y&&F.next.y!==F.y){var L=F.x+(O-F.y)*(F.next.x-F.x)/(F.next.y-F.y);if(L<=G&&L>K){K=L;if(L===G){if(O===F.y)return F;if(O===F.next.y)return F.next}var R=F.x<F.next.x?F:F.next}}F=F.next}while(F!==E);if(!R)return null;if(G===
K)return R;E=R;L=R.x;var M=R.y,J=Infinity;F=R;do{if(G>=F.x&&F.x>=L&&G!==F.x&&t(O<M?G:K,O,L,M,O<M?K:G,O,F.x,F.y)){var I=Math.abs(O-F.y)/(G-F.x);var P;if((P=w(F,D))&&!(P=I<J)&&(P=I===J)&&!(P=F.x>R.x)&&(P=F.x===R.x)){P=R;var N=F;P=0>q(P.prev,P,N.prev)&&0>q(N.next,P,P.next)}P&&(R=F,J=I)}F=F.next}while(F!==E);return R}function g(D,E,F,G,O){D=32767*(D-F)*O;E=32767*(E-G)*O;D=(D|D<<8)&16711935;D=(D|D<<4)&252645135;D=(D|D<<2)&858993459;E=(E|E<<8)&16711935;E=(E|E<<4)&252645135;E=(E|E<<2)&858993459;return(D|
D<<1)&1431655765|((E|E<<1)&1431655765)<<1}function p(D){var E=D,F=D;do{if(E.x<F.x||E.x===F.x&&E.y<F.y)F=E;E=E.next}while(E!==D);return F}function t(D,E,F,G,O,K,L,R){return 0<=(O-L)*(E-R)-(D-L)*(K-R)&&0<=(D-L)*(G-R)-(F-L)*(E-R)&&0<=(F-L)*(K-R)-(O-L)*(G-R)}function q(D,E,F){return(E.y-D.y)*(F.x-E.x)-(E.x-D.x)*(F.y-E.y)}function k(D,E){return D.x===E.x&&D.y===E.y}function r(D,E,F,G){var O=f(q(D,E,F)),K=f(q(D,E,G)),L=f(q(F,G,D)),R=f(q(F,G,E));return O!==K&&L!==R||0===O&&y(D,F,E)||0===K&&y(D,G,E)||0===
L&&y(F,D,G)||0===R&&y(F,E,G)?!0:!1}function y(D,E,F){return E.x<=Math.max(D.x,F.x)&&E.x>=Math.min(D.x,F.x)&&E.y<=Math.max(D.y,F.y)&&E.y>=Math.min(D.y,F.y)}function f(D){return 0<D?1:0>D?-1:0}function w(D,E){return 0>q(D.prev,D,D.next)?0<=q(D,E,D.next)&&0<=q(D,D.prev,E):0>q(D,E,D.prev)||0>q(D,D.next,E)}function z(D,E){var F=new B(D.i,D.x,D.y),G=new B(E.i,E.x,E.y),O=D.next,K=E.prev;D.next=E;E.prev=D;F.next=O;O.prev=F;G.next=F;F.prev=G;K.next=G;G.prev=K;return G}function A(D,E,F,G){D=new B(D,E,F);G?
(D.next=G.next,D.prev=G,G.next.prev=D,G.next=D):(D.prev=D,D.next=D);return D}function x(D){D.next.prev=D.prev;D.prev.next=D.next;D.prevZ&&(D.prevZ.nextZ=D.nextZ);D.nextZ&&(D.nextZ.prevZ=D.prevZ)}function B(D,E,F){this.i=D;this.x=E;this.y=F;this.nextZ=this.prevZ=this.z=this.next=this.prev=null;this.steiner=!1}function C(D,E,F,G){for(var O=0,K=F-G;E<F;E+=G)O+=(D[K]-D[E])*(D[E+1]+D[K+1]),K=E;return O}n.deviation=function(D,E,F,G){var O=E&&E.length,K=Math.abs(C(D,0,O?E[0]*F:D.length,F));if(O){O=0;for(var L=
E.length;O<L;O++)K-=Math.abs(C(D,E[O]*F,O<L-1?E[O+1]*F:D.length,F))}for(O=E=0;O<G.length;O+=3){L=G[O]*F;var R=G[O+1]*F,M=G[O+2]*F;E+=Math.abs((D[L]-D[M])*(D[R+1]-D[L+1])-(D[L]-D[R])*(D[M+1]-D[L+1]))}return 0===K&&0===E?0:Math.abs((E-K)/K)};n.flatten=function(D){for(var E=D[0][0].length,F={vertices:[],holes:[],dimensions:E},G=0,O=0;O<D.length;O++){for(var K=0;K<D[O].length;K++)for(var L=0;L<E;L++)F.vertices.push(D[O][K][L]);0<O&&(G+=D[O-1].length,F.holes.push(G))}return F};return n})})(b);a.earcut=
b.exports})},"esri/chunks/vec32":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(h,d,e){if(h.count!==d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var g=h.count,p=e[0],t=e[1],q=e[2],k=e[4],r=e[5],y=e[6],f=e[8],w=e[9],z=e[10],A=e[12],x=e[13];e=e[14];var B=h.typedBuffer;h=h.typedBufferStride;var C=d.typedBuffer;d=d.typedBufferStride;for(let E=0;E<g;E++){const F=E*h;var D=E*d;const G=C[D],O=C[D+
1];D=C[D+2];B[F]=p*G+k*O+f*D+A;B[F+1]=t*G+r*O+w*D+x;B[F+2]=q*G+y*O+z*D+e}}}function n(h,d,e){if(h.count!==d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var g=h.count,p=e[0],t=e[1],q=e[2],k=e[3],r=e[4],y=e[5],f=e[6],w=e[7];e=e[8];var z=h.typedBuffer;h=h.typedBufferStride;var A=d.typedBuffer;d=d.typedBufferStride;for(let B=0;B<g;B++){const C=B*h;var x=B*d;const D=A[x],E=A[x+1];x=A[x+2];z[C]=p*D+k*E+f*x;z[C+1]=t*D+r*E+w*x;z[C+2]=q*D+y*E+e*
x}}}function l(h,d,e){const g=Math.min(h.count,d.count),p=h.typedBuffer;h=h.typedBufferStride;const t=d.typedBuffer;d=d.typedBufferStride;for(let q=0;q<g;q++){const k=q*h,r=q*d;p[k]=e*t[r];p[k+1]=e*t[r+1];p[k+2]=e*t[r+2]}}function u(h,d){const e=Math.min(h.count,d.count),g=h.typedBuffer;h=h.typedBufferStride;const p=d.typedBuffer;d=d.typedBufferStride;for(let k=0;k<e;k++){const r=k*h;var t=k*d;const y=p[t],f=p[t+1];t=p[t+2];var q=y*y+f*f+t*t;0<q&&(q=1/Math.sqrt(q),g[r]=q*y,g[r+1]=q*f,g[r+2]=q*t)}}
function v(h,d,e){const g=Math.min(h.count,d.count),p=h.typedBuffer;h=h.typedBufferStride;const t=d.typedBuffer;d=d.typedBufferStride;for(let q=0;q<g;q++){const k=q*h,r=q*d;p[k]=t[r]>>e;p[k+1]=t[r+1]>>e;p[k+2]=t[r+2]>>e}}const m=Object.freeze(Object.defineProperty({__proto__:null,transformMat4:c,transformMat3:n,scale:l,normalize:u,shiftRight:v},Symbol.toStringTag,{value:"Module"}));a.normalize=u;a.scale=l;a.shiftRight=v;a.transformMat3=n;a.transformMat4=c;a.vec3=m})},"esri/geometry/support/buffer/math/common":function(){define(["exports",
"../../../../core/Logger"],function(a,b){b=b.getLogger("esri.views.3d.support.buffer.math");a.mathLogger=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/renderers/support/renderingInfoUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../Color","../../core/maybe","../visualVariables/support/visualVariableUtils"],function(a,b,c,n,l){function u(d,e){if(!d||d.symbol)return null;e=e&&e.renderer;return d&&n.isSome(e)&&e.getObservationRenderer?
e.getObservationRenderer(d):e}function v(d,e){return m.apply(this,arguments)}function m(){m=b._asyncToGenerator(function*(d,e){if(n.isSome(d.symbol))return d.symbol;const g=u(d,e);return n.isSome(g)&&g.getSymbolAsync(d,e)});return m.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(d,e){var g=u(d,e),p=yield v(d,e);if(!p)return null;p={renderer:g,symbol:p};if(!(g&&"visualVariables"in g&&g.visualVariables))return p;e=l.getVisualVariableValues(g,d,e);d=["proportional","proportional",
"proportional"];for(const {variable:t,value:q}of e)"color"===t.type?p.color=c.toUnitRGBA(q):"size"===t.type?"outline"===t.target?p.outlineSize=q:(e=t.axis,g=t.useSymbolValue?"symbol-value":q,"width"===e?d[0]=g:"depth"===e?d[1]=g:"height"===e?d[2]=g:d[0]="width-and-depth"===e?d[1]=g:d[1]=d[2]=g):"opacity"===t.type?p.opacity=q:"rotation"===t.type&&"tilt"===t.axis?p.tilt=q:"rotation"===t.type&&"roll"===t.axis?p.roll=q:"rotation"===t.type&&(p.heading=q);if(isFinite(d[0])||isFinite(d[1])||isFinite(d[2]))p.size=
d;return p});return h.apply(this,arguments)}a.getDriverAxisSizeValue=function(d,e=0){d=d[e];return"number"===typeof d&&isFinite(d)?d:null};a.getDriverAxisSizeValueAny=function(d){for(let e=0;3>e;e++){const g=d[e];if("number"===typeof g)return isFinite(g)?g:0}return 0};a.getRenderer=u;a.getRenderingInfo=function(d,e){const g=u(d,e);if(n.isSome(d.symbol))var p=d.symbol;else p=u(d,e),p=n.isSome(p)&&"dot-density"!==p.type?p.getSymbol(d,e):null;if(n.isNone(p))return null;p={renderer:g,symbol:p};if(n.isNone(g)||
!("visualVariables"in g)||!g.visualVariables)return p;e=l.getVisualVariableValues(g,d,e);d=["proportional","proportional","proportional"];for(const {variable:t,value:q}of e)switch(t.type){case "color":p.color=q.toRgba();break;case "size":if("outline"===t.target)p.outlineSize=q;else switch(e=t.useSymbolValue?"symbol-value":q,t.axis){case "width":d[0]=e;break;case "depth":d[1]=e;break;case "height":d[2]=e;break;case "width-and-depth":d[0]=d[1]=e;break;default:d[0]=d[1]=d[2]=e}break;case "opacity":p.opacity=
q;break;case "rotation":switch(t.axis){case "tilt":p.tilt=q;break;case "roll":p.roll=q;break;default:p.heading=q}}if("proportional"!==d[0]||"proportional"!==d[1]||"proportional"!==d[2])p.size=d;return p};a.getRenderingInfoAsync=function(d,e){return h.apply(this,arguments)};a.getSymbolAsync=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/polygonUtils":function(){define("exports ../../../../geometry ../../../../core/maybe ../../../../geometry/projection ../../../../geometry/support/triangulationUtils ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(t,q,k){const r=[];for(const {index:y,count:f}of t){if(1>=f)continue;t=3*y;const w=t+3*f;r.push({index:y,count:f,position:q.subarray(t,w),mapPosition:k?k.subarray(t,w):void 0})}return r}function p(t,q,k){const r=[];for(const {index:y,count:f,holeIndices:w,pathLengths:z}of t){if(1>=f)continue;t=3*y;const A=t+3*f,x=w.map(B=>B-y);r.push({index:y,count:f,holeIndices:x,pathLengths:z,position:q.subarray(t,A),mapPosition:k?k.subarray(t,A):void 0})}return r}a.createColorGeometry=
function(t){const q=[[h.VertexAttribute.POSITION,t.indices]],k=[[h.VertexAttribute.POSITION,{size:3,data:t.attributeData.position,exclusive:!0}]];c.isSome(t.attributeData.color)&&(k.push([h.VertexAttribute.COLOR,{size:4,data:t.attributeData.color,exclusive:!0}]),q.push([h.VertexAttribute.COLOR,new Uint32Array(t.indices.length)]));c.isSome(t.attributeData.uvMapSpace)&&(k.push([h.VertexAttribute.UVMAPSPACE,{size:4,data:t.attributeData.uvMapSpace,exclusive:!0}]),q.push([h.VertexAttribute.UVMAPSPACE,
t.indices]));c.isSome(t.attributeData.boundingRect)&&(k.push([h.VertexAttribute.BOUNDINGRECT,{size:9,data:t.attributeData.boundingRect,exclusive:!0}]),q.push([h.VertexAttribute.BOUNDINGRECT,t.indices]));c.isSome(t.attributeData.mapPosition)&&(k.push([h.VertexAttribute.MAPPOS,{size:3,data:t.attributeData.mapPosition,exclusive:!0}]),q.push([h.VertexAttribute.MAPPOS,t.indices]));return new m.Geometry(k,q)};a.createWaterGeometry=function(t){const q=[[h.VertexAttribute.POSITION,t.indices],[h.VertexAttribute.UV0,
t.indices]],k=[[h.VertexAttribute.POSITION,{size:3,data:t.attributeData.position,exclusive:!0}],[h.VertexAttribute.UV0,{size:2,data:t.attributeData.uv0,exclusive:!0}]];c.isSome(t.attributeData.mapPosition)&&(k.push([h.VertexAttribute.MAPPOS,{size:3,data:t.attributeData.mapPosition,exclusive:!0}]),q.push([h.VertexAttribute.MAPPOS,t.indices]));return new m.Geometry(k,q)};a.geometryAsPolygon=function(t){switch(t.type){case "extent":if(t instanceof d)return e.fromExtent(t);break;case "polygon":return t}return null};
a.geometryToRenderInfo=function(t,q,k,r){const y=l.pathsToTriangulationInfo(t.rings,t.hasZ,l.CounterClockwiseMode.CCW_IS_HOLE),f=new Float64Array(y.position.length);t=u.applyPerVertexElevationAlignment(y.position,t.spatialReference,0,f,0,y.position,0,y.position.length/3,q,k,r);q=null!=t;return{position:y.position,mapPosition:f,polygons:p(y.polygons,y.position,f),outlines:g(y.outlines,y.position,f),projectionSuccess:q,sampledElevation:t}};a.geometryToRenderInfoDraped=function(t,q){const k=l.pathsToTriangulationInfo(t.rings,
!1,l.CounterClockwiseMode.CCW_IS_HOLE);t=n.projectBuffer(k.position,t.spatialReference,0,k.position,q,0,k.position.length/3);for(q=2;q<k.position.length;q+=3)k.position[q]=v.DRAPED_Z;return{position:k.position,polygons:p(k.polygons,k.position),outlines:g(k.outlines,k.position),projectionSuccess:t}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/triangulationUtils":function(){define(["exports","../../chunks/earcut","./coordsUtils",
"./meshUtils/deduplicate"],function(a,b,c,n){function l(m,h,d){if(1===m.length)return m[0];h=new Float64Array(h);d=new Uint32Array(d);let e=0,g=0,p=0;for(const t of m){for(m=0;m<t.position.length;m++)h[e++]=t.position[m];for(m=0;m<t.faces.length;m++)d[g++]=t.faces[m]+p;p=e/3}return{position:h,faces:d}}function u(m,h,d){const e=m.length,g=Array(e),p=Array(e),t=Array(e);let q=0,k=0,r=0;var y=0;for(var f=0;f<e;++f)y+=m[f].length;y=new Float64Array(3*y);f=0;for(let x=e-1;0<=x;x--){var w=m[x],z=d===a.CounterClockwiseMode.CCW_IS_HOLE?
!c.isClockwise(w,!1,!1):!1;if(z&&1!==e)g[q++]=w;else{var A=w.length;for(let B=0;B<q;++B)A+=g[B].length;A={index:f,pathLengths:Array(q+1),count:A,holeIndices:Array(q)};A.pathLengths[0]=w.length;0<w.length&&(t[r++]={index:f,count:w.length});f=z?v(w,w.length-1,-1,y,f,w.length,h):v(w,0,1,y,f,w.length,h);for(w=0;w<q;++w)z=g[w],A.holeIndices[w]=f,A.pathLengths[w+1]=z.length,0<z.length&&(t[r++]={index:f,count:z.length}),f=v(z,0,1,y,f,z.length,h);q=0;0<A.count&&(p[k++]=A)}}for(m=0;m<q;++m)d=g[m],0<d.length&&
(t[r++]={index:f,count:d.length}),f=v(d,0,1,y,f,d.length,h);k<e&&(p.length=k);r<e&&(t.length=r);return{position:y,polygons:p,outlines:t}}function v(m,h,d,e,g,p,t){g*=3;for(let q=0;q<p;++q){const k=m[h];e[g++]=k[0];e[g++]=k[1];e[g++]=t?k[2]:0;h+=d}return g/3}a.CounterClockwiseMode=void 0;(function(m){m[m.NONE=0]="NONE";m[m.CCW_IS_HOLE=1]="CCW_IS_HOLE"})(a.CounterClockwiseMode||(a.CounterClockwiseMode={}));a.pathsToTriangulationInfo=u;a.triangulate=function(m){m=u(m.rings,m.hasZ,a.CounterClockwiseMode.CCW_IS_HOLE);
const h=[];let d=0,e=0;for(var g of m.polygons){const t=g.index,q=new Float64Array(m.position.buffer,3*t*m.position.BYTES_PER_ELEMENT,3*g.count);var p=g.holeIndices.map(k=>k-t);p=new Uint32Array(b.earcut(q,p,3));h.push({position:q,faces:p});d+=q.length;e+=p.length}g=l(h,d,e);m=n.deduplicate(g.position.buffer,6,{originalIndices:g.faces});g.position=new Float64Array(m.buffer);g.faces=m.indices;return g};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/meshUtils/deduplicate":function(){define(["exports",
"../../../core/mathUtils"],function(a,b){let c=null;a.deduplicate=function(n,l,u){var v,m=n.byteLength/(4*l),h=new Uint32Array(n,0,m*l);n=new Uint32Array(m);var d=null!=(v=null==u?void 0:u.minReduction)?v:0;const e=(v=(null==u?void 0:u.originalIndices)||null)?v.length:0;var g=(null==u?void 0:u.componentOffsets)||null;u=0;if(g)for(var p=0;p<g.length-1;p++){var t=g[p+1]-g[p];t>u&&(u=t)}else u=m;var q=Math.floor(1.1*u)+1;if(null==c||c.length<2*q)c=new Uint32Array(b.nextHighestPowerOfTwo(2*q));for(u=
0;u<2*q;u++)c[u]=0;u=0;t=(p=!!g&&!!v)?e:m;var k=p?new Uint32Array(e):null,r=0!==d?Math.ceil(7.84*1.96/(d*d)*d*(1-d)):t,y=1,f=g?g[1]:t;for(var w=0;w<t;w++){if(w===r){var z=1-u/w;if(z+1.96*Math.sqrt(z*(1-z)/w)<d)return null;r*=2}if(w===f){for(f=0;f<2*q;f++)c[f]=0;if(v)for(f=g[y-1];f<g[y];f++)k[f]=n[v[f]];f=g[++y]}z=p?v[w]:w;const C=z*l;var A=0;for(var x=0;x<l;x++)A=h[C+x]+A|0,A=A+(A<<11)+(A>>>2)|0;A>>>=0;x=A%q;let D=u;for(;0!==c[2*x+1];){if(c[2*x]===A){const E=c[2*x+1]-1;var B=E*l;a:{for(let F=0;F<
l;F++)if(h[C+F]!==h[B+F]){B=!1;break a}B=!0}if(B){D=n[E];break}}x++;x>=q&&(x-=q)}D===u&&(c[2*x]=A,c[2*x+1]=z+1,u++);n[z]=D}if(0!==d&&1-u/m<d)return null;if(p){for(m=g[y-1];m<k.length;m++)k[m]=n[v[m]];n=k}m=new Uint32Array(l*u);u=0;for(y=0;y<t;y++)if(n[y]===u){d=h;g=(p?v[y]:y)*l;q=m;k=u*l;r=l;for(w=0;w<r;w++)q[k+w]=d[g+w];u++}if(v&&!p){l=new Uint32Array(e);for(h=0;h<l.length;h++)l[h]=n[v[h]];n=l}return{buffer:m.buffer,indices:n,uniqueCount:u}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/OverlayRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/Handles ../../../core/MapUtils ../../../core/maybe ../../../core/PooledArray ../../../core/reactiveUtils ../../../core/SetUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/vec3f64 ../../ViewingMode ../layers/interfaces ../support/debugFlags ./interfaces ./Overlay ./OverlayFramebufferObject ./OverlayRenderTarget ../webgl-engine/core/shaderTechnique/ShaderTechniqueRepository ../webgl-engine/lib/AutoDisposable ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Camera ../webgl-engine/lib/GLMaterialRepository ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/GridLocalOriginFactory ../webgl-engine/lib/Material ../webgl-engine/lib/RenderContext ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/ShadowMap ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/lib/SSAOHelper ../webgl-engine/lib/TextureTechnique ../webgl-engine/lib/TextureTechniqueConfiguration ../webgl-engine/lighting/Lightsources ../webgl-engine/materials/StippleTextureRepository ../webgl-engine/shaders/CompositingTechniqueConfiguration ../../support/Scheduler ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H,U,W,Q,X,ba,aa){a.OverlayRenderer=function(Z){function ca(da){da=Z.call(this,da)||this;da._overlays=null;da._overlayRenderTarget=null;da._hasHighlights=!1;da._rendersOccluded=!1;da._hasWater=!1;da._handles=new u;da._frameTask=Q.ImmediateTask;da._drapeSourceRenderers=new Map;da._sortedDrapeSourceRenderersDirty=!1;da._sortedDrapeSourceRenderers=new h;da._rctx=null;da._materialRepository=null;da._screenToWorldRatio=
1;da._localOriginFactory=null;da.worldToPCSRatio=1;da.events=new l;da.longitudeCyclical=null;return da}b._inheritsLoose(ca,Z);var Y=ca.prototype;Y.initialize=function(){const da=this.view._stage.renderView;this._rctx=da.renderingContext;const ha=da.waterTextureRepository;this._stippleTextureRepository=new U.StippleTextureRepository(da.renderingContext);this._shaderTechniqueRepository=new D.ShaderTechniqueRepository({rctx:this._rctx,viewingMode:f.ViewingMode.Local,stippleTextureRepository:this._stippleTextureRepository,
waterTextureRepository:ha});this._renderContext=new M.OverlayRenderContext(this._rctx,new P.ShadowMap(this._rctx,this.view.state.viewingMode),new V.SSAOHelper(this._shaderTechniqueRepository,this._rctx,()=>{}));this._handles.add([d.watch(()=>ha.updating,()=>this.events.emit("content-changed"),d.syncAndInitial),d.watch(()=>this.spatialReference,ja=>this._localOriginFactory=new L.GridLocalOriginFactory(ja),d.syncAndInitial),d.on(()=>this.view.allLayerViews,"after-changes",()=>this._sortedDrapeSourceRenderersDirty=
!0)]);this._materialRepository=new O.GLMaterialRepository(da.textureRepository,this._shaderTechniqueRepository,ja=>{0<(ja.renderOccluded&la)!==this._rendersOccluded&&this._updateRendersOccluded();this.events.emit("content-changed");this.notifyChange("updating")},()=>this.events.emit("content-changed"));this._bindParameters.slot=I.RenderSlot.DRAPED_MATERIAL;this._bindParameters.highlightDepthTexture=K.createEmptyDepthTexture(this._rctx);this._bindParameters.camera=ka;this._bindParameters.transparencyPassType=
F.TransparencyPassType.NONE;this._bindParameters.lighting.groundLightingFactor=1;this._bindParameters.lighting.globalFactor=0;this._bindParameters.lighting.set([new H.AmbientLight(y.fromValues(1,1,1))]);this._frameTask=this.view.resourceController.scheduler.registerTask(Q.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};Y.dispose=function(){this._handles.destroy();this._drapeSourceRenderers.forEach(da=>da.destroy());this._drapeSourceRenderers.clear();this._debugTextureTechnique=m.releaseMaybe(this._debugTextureTechnique);
this._debugPatternTexture=m.disposeMaybe(this._debugPatternTexture);this._bindParameters.highlightDepthTexture=m.disposeMaybe(this._bindParameters.highlightDepthTexture);this._shaderTechniqueRepository=m.disposeMaybe(this._shaderTechniqueRepository);this._temporaryFBO=m.disposeMaybe(this._temporaryFBO);this._quadVAO=m.disposeMaybe(this._quadVAO);this.disposeOverlays()};Y.createGeometryDrapeSourceRenderer=function(da){return this.createDrapeSourceRenderer(da,N.SortedRenderGeometryRenderer)};Y.createDrapeSourceRenderer=
function(da,ha,ja){const ma=this._drapeSourceRenderers.get(da);m.isSome(ma)&&ma.destroy();ha=new ha({...ja,rendererContext:this,drapeSource:da});this._drapeSourceRenderers.set(da,ha);this._sortedDrapeSourceRenderersDirty=!0;"fullOpacity"in da&&this._handles.add(d.watch(()=>da.fullOpacity,()=>this.events.emit("content-changed")),da);return ha};Y.removeDrapeSourceRenderer=function(da){if(!m.isNone(da)){var ha=this._drapeSourceRenderers.get(da);m.isNone(ha)||(this._sortedDrapeSourceRenderersDirty=!0,
this._drapeSourceRenderers.delete(da),this._handles.remove(da),ha.destroy())}};Y.collectUnusedRenderTargetMemory=function(da){let ha=!1;if(m.isSome(this._overlayRenderTarget))for(const ja of this._overlayRenderTarget.renderTargets)ha=this._overlayRenderTarget.validateUsageForTarget(this.overlays[0].validTargets[ja.type]||!this.overlays[1].validTargets[ja.type],ja,da)||ha;return ha};Y.ensureDrapeTargets=function(da){m.isSome(this._overlays)&&this._overlays.forEach(ha=>{ha.hasTargetWithoutRasterImage=
e.someSet(da,ja=>ja.drapeTargetType===w.DrapeTargetType.WithoutRasterImage)})};Y.ensureDrapeSources=function(da){m.isSome(this._overlays)&&this._overlays.forEach(ha=>{ha.hasDrapedFeatureSource=e.someSet(da,ja=>ja.drapeSourceType===w.DrapeSourceType.Features);ha.hasDrapedRasterSource=e.someSet(da,ja=>ja.drapeSourceType===w.DrapeSourceType.RasterImage)})};Y.ensureOverlays=function(da,ha){m.isNone(this._overlays)&&(this._overlayRenderTarget=new C.OverlayRenderTarget(this._rctx),this._overlays=[new x.Overlay(A.OverlayIndex.INNER,
this._overlayRenderTarget),new x.Overlay(A.OverlayIndex.OUTER,this._overlayRenderTarget)]);this.ensureDrapeTargets(da);this.ensureDrapeSources(ha)};Y.disposeOverlays=function(){this._overlays=null;this._overlayRenderTarget=m.disposeMaybe(this._overlayRenderTarget);this.events.emit("textures-disposed")};Y.runTask=function(da,ha=()=>!0){this._frameTask.processQueue(da);da.done||this._processDrapeSources(da,ha)};Y._processDrapeSources=function(da,ha){let ja=!1;for(const [ma,pa]of this._drapeSourceRenderers){if(da.done)break;
(ma.destroyed||ha(ma))&&pa.commitChanges()&&(ja=!0,da.madeProgress())}this._updateSortedDrapeSourceRenderers();ja&&(m.isSome(this._overlays)&&0===this._drapeSourceRenderers.size&&this.disposeOverlays(),this.notifyChange("updating"),this.events.emit("content-changed"),this._updateHasHighlights(),this._updateRendersOccluded(),this._updateHasWater())};Y.processSyncDrapeSources=function(){this._processDrapeSources(Q.noBudget,da=>da.updatePolicy===F.UpdatePolicy.SYNC)};Y.isEmpty=function(){if(z.OVERLAY_DRAW_DEBUG_TEXTURE)return!1;
for(const da of this._drapeSourceRenderers.values())if(!da.isEmpty)return!1;return!0};Y.updateAnimation=function(da){let ha=!1;this._drapeSourceRenderers.forEach(ja=>ha=ja.updateAnimation(da)||ha);return ha};Y.updateDrapeSourceOrder=function(){this._sortedDrapeSourceRenderersDirty=!0};Y.drawTarget=function(da,ha,ja){const ma=da.canvasGeometries;if(0===ma.numViews)return!1;this._screenToWorldRatio=ja*da.mapUnitsPerPixel;const pa=ha.renderPass;if(this.isEmpty()||pa===J.RenderPass.MATERIAL_HIGHLIGHT&&
!this.hasHighlights||pa===J.RenderPass.MATERIAL_NORMAL&&!this.hasWater||!da.hasSomeSizedView())return!1;const na=ha.fbo;if(!na.isValid())return!1;const wa=2*da.resolution,xa=da.resolution;na.resize(wa,xa);const sa=this._rctx;ka.pixelRatio=da.pixelRatio*ja;this._renderContext.pass=pa;this._bindParameters.screenToWorldRatio=this._screenToWorldRatio;this._bindParameters.screenToPCSRatio=this._screenToWorldRatio*this.worldToPCSRatio;this._bindParameters.slot=pa===J.RenderPass.MATERIAL_NORMAL?I.RenderSlot.DRAPED_WATER:
I.RenderSlot.DRAPED_MATERIAL;da.applyViewport(this._rctx);na.bind(sa);da.index===A.OverlayIndex.INNER&&(sa.setClearColor(0,0,0,0),sa.clearSafe(X.ClearBufferBit.COLOR_BUFFER_BIT));const ya=ha.type===A.RenderTargetType.ColorNoRasterImage?a.DrawPassOption.ExcludeRasterImage:ha.type===A.RenderTargetType.Occluded?a.DrawPassOption.OccludedOnly:a.DrawPassOption.Normal;ya===a.DrawPassOption.OccludedOnly&&(this._renderContext.renderOccludedMask=la);if(z.OVERLAY_DRAW_DEBUG_TEXTURE&&ya!==a.DrawPassOption.OccludedOnly)for(ha=
0;ha<ma.numViews;ha++)this._setViewParameters(ma.extents[ha],da,ka),this._drawDebugTexture(da.resolution,ia[da.index]);0<this._drapeSourceRenderers.size&&this._sortedDrapeSourceRenderers.forAll(({drapeSource:ra,renderer:ua})=>{if(ya!==a.DrawPassOption.ExcludeRasterImage||ra.drapeSourceType!==w.DrapeSourceType.RasterImage){({fullOpacity:ra}=ra);var Ba=m.isSome(ra)&&1>ra&&pa===J.RenderPass.MATERIAL;Ba&&(this.bindTemporaryFramebuffer(this._rctx,wa,xa),sa.clearSafe(X.ClearBufferBit.COLOR_BUFFER_BIT));
for(let Ea=0;Ea<ma.numViews;Ea++)this._setViewParameters(ma.extents[Ea],da,ka),ua.render(this._renderContext,this._bindParameters);Ba&&m.isSome(this._temporaryFBO)&&(na.bind(sa),this.view._stage.renderView.compositingHelper.composite(this._renderContext.bindParameters,this._temporaryFBO.getTexture(),W.AlphaMode.PremultipliedAlpha,ra,W.CompositingFunction.OverlayWithTransparency,da.index))}});sa.bindFramebuffer(null);na.generateMipMap();this._renderContext.resetRenderOccludedMask();return!0};Y.bindTemporaryFramebuffer=
function(da,ha,ja){m.isNone(this._temporaryFBO)&&(this._temporaryFBO=new B.OverlayFramebufferObject(da,!1));this._temporaryFBO.resize(ha,ja);this._temporaryFBO.bind(da)};Y.reloadShaders=function(){var da=b._asyncToGenerator(function*(){yield this._shaderTechniqueRepository.reloadAll()});return function(){return da.apply(this,arguments)}}();Y.notifyContentChanged=function(){this.events.emit("content-changed")};Y.intersect=function(da,ha,ja,ma){let pa=0;for(const wa of this._drapeSourceRenderers.values()){var na;
pa=null!=(na=null==wa.intersect?void 0:wa.intersect(da,ha,ja,ma,pa))?na:pa}};Y._updateSortedDrapeSourceRenderers=function(){if(this._sortedDrapeSourceRenderersDirty&&(this._sortedDrapeSourceRenderersDirty=!1,this._sortedDrapeSourceRenderers.clear(),0!==this._drapeSourceRenderers.size)){var da=this.view.map.allLayers;this._drapeSourceRenderers.forEach((ha,ja)=>{const ma=da.indexOf(ja.layer);this._sortedDrapeSourceRenderers.push(new ea(ja,ha,0>ma?Infinity:ma))});this._sortedDrapeSourceRenderers.sort((ha,
ja)=>ha.index-ja.index)}};Y._setViewParameters=function(da,ha,ja){ja.viewport[0]=ja.viewport[1]=0;ja.viewport[2]=ja.viewport[3]=ha.resolution;r.ortho(ja.projectionMatrix,0,da[2]-da[0],0,da[3]-da[1],ja.near,ja.far);r.fromTranslation(ja.viewMatrix,[-da[0],-da[1],0]);this._bindParameters.camera=ja};Y._updateHasWater=function(){const da=v.someMap(this._drapeSourceRenderers,ha=>ha.hasWater);da!==this._hasWater&&(this._hasWater=da,this.events.emit("has-water",da))};Y._updateHasHighlights=function(){const da=
v.someMap(this._drapeSourceRenderers,ha=>ha.hasHighlights);da!==this._hasHighlights&&(this._hasHighlights=da,this.events.emit("has-highlights",da))};Y._updateRendersOccluded=function(){const da=v.someMap(this._drapeSourceRenderers,ha=>ha.rendersOccluded);da!==this._rendersOccluded&&(this._rendersOccluded=da,this.events.emit("renders-occluded",da))};Y._drawDebugTexture=function(da,ha){this._ensureDebugPatternResources(da,da);da=this._rctx;const ja=da.bindTechnique(this._debugTextureTechnique);ja.setUniform4f("uColor",
ha[0],ha[1],ha[2],1);ja.bindTexture("tex",this._debugPatternTexture);da.bindVAO(this._quadVAO);da.drawArrays(X.PrimitiveType.TRIANGLE_STRIP,0,aa.vertexCount(this._quadVAO,"geometry"))};Y._ensureDebugPatternResources=function(da,ha){if(!this._debugPatternTexture){var ja=new Uint8Array(da*ha*4),ma=0;for(let pa=0;pa<ha;pa++)for(let na=0;na<da;na++){const wa=Math.floor(na/10),xa=Math.floor(pa/10);2>wa||2>xa||10*wa>da-20||10*xa>ha-20?(ja[ma++]=255,ja[ma++]=255,ja[ma++]=255,ja[ma++]=255):(ja[ma++]=255,
ja[ma++]=255,ja[ma++]=255,wa&1&&xa&1?ja[ma++]=na&1^pa&1?0:255:ja[ma++]=wa&1^xa&1?0:128)}this._debugPatternTexture=new ba.Texture(this._rctx,{target:X.TextureType.TEXTURE_2D,pixelFormat:X.PixelFormat.RGBA,dataType:X.PixelType.UNSIGNED_BYTE,samplingMode:X.TextureSamplingMode.NEAREST,width:da,height:ha},ja);da=new T.TextureTechniqueConfiguration;da.hasAlpha=!0;this._debugTextureTechnique=this._shaderTechniqueRepository.acquire(S.TextureTechnique,da);this._quadVAO=K.createQuadVAO(this._rctx)}};b._createClass(ca,
[{key:"_bindParameters",get:function(){return this._renderContext.bindParameters}},{key:"rctx",get:function(){return this._rctx}},{key:"materialRepository",get:function(){return this._materialRepository}},{key:"screenToWorldRatio",get:function(){return this._screenToWorldRatio}},{key:"localOriginFactory",get:function(){return this._localOriginFactory}},{key:"updating",get:function(){return this._sortedDrapeSourceRenderersDirty||this._frameTask.updating||v.someMap(this._drapeSourceRenderers,da=>da.updating)}},
{key:"hasOverlays",get:function(){return m.isSome(this._overlays)&&m.isSome(this._overlayRenderTarget)}},{key:"gpuMemoryUsage",get:function(){return m.isSome(this._overlayRenderTarget)?this._overlayRenderTarget.gpuMemoryUsage:0}},{key:"overlays",get:function(){return m.unwrapOr(this._overlays,[])}},{key:"running",get:function(){return this.updating}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",get:function(){return this._rendersOccluded}},
{key:"test",get:function(){return{drapeSourceRenderers:this._drapeSourceRenderers,getDrapeSourceRenderer:da=>this._drapeSourceRenderers.get(da)}}}]);return ca}(E.AutoDisposableMixin(n));c.__decorate([g.property()],a.OverlayRenderer.prototype,"_frameTask",void 0);c.__decorate([g.property()],a.OverlayRenderer.prototype,"_sortedDrapeSourceRenderersDirty",void 0);c.__decorate([E.autoDispose()],a.OverlayRenderer.prototype,"_shaderTechniqueRepository",void 0);c.__decorate([E.autoDispose()],a.OverlayRenderer.prototype,
"_stippleTextureRepository",void 0);c.__decorate([g.property({constructOnly:!0})],a.OverlayRenderer.prototype,"view",void 0);c.__decorate([g.property()],a.OverlayRenderer.prototype,"worldToPCSRatio",void 0);c.__decorate([g.property()],a.OverlayRenderer.prototype,"spatialReference",void 0);c.__decorate([g.property({type:Boolean,readOnly:!0})],a.OverlayRenderer.prototype,"updating",null);a.OverlayRenderer=c.__decorate([k.subclass("esri.views.3d.terrain.OverlayRenderer")],a.OverlayRenderer);a.DrawPassOption=
void 0;(function(Z){Z[Z.Normal=0]="Normal";Z[Z.OccludedOnly=1]="OccludedOnly";Z[Z.ExcludeRasterImage=2]="ExcludeRasterImage"})(a.DrawPassOption||(a.DrawPassOption={}));let ea=function(Z,ca,Y){this.drapeSource=Z;this.renderer=ca;this.index=Y};const ia=[[1,.5,.5],[.5,.5,1]],ka=new G.Camera;ka.near=1;ka.far=1E4;ka.relativeElevation=null;const la=R.RenderOccludedFlag.OccludeAndTransparent;a.DRAPED_Z=-2;a.overlayRenderOccludedFlag=la;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/interfaces":function(){define(["exports"],function(a){a.DrapeSourceType=void 0;(function(b){b[b.RasterImage=0]="RasterImage";b[b.Features=1]="Features"})(a.DrapeSourceType||(a.DrapeSourceType={}));a.DrapeTargetType=void 0;(function(b){b[b.WithRasterImage=0]="WithRasterImage";b[b.WithoutRasterImage=1]="WithoutRasterImage"})(a.DrapeTargetType||(a.DrapeTargetType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/interfaces":function(){define(["exports"],
function(a){a.OverlayIndex=void 0;(function(b){b[b.INNER=0]="INNER";b[b.OUTER=1]="OUTER"})(a.OverlayIndex||(a.OverlayIndex={}));a.PatchType=void 0;(function(b){b[b.REGULAR=0]="REGULAR";b[b.HAS_NORTH_POLE=1]="HAS_NORTH_POLE";b[b.HAS_SOUTH_POLE=2]="HAS_SOUTH_POLE";b[b.HAS_BOTH_POLES=3]="HAS_BOTH_POLES"})(a.PatchType||(a.PatchType={}));a.NeighborIndex=void 0;(function(b){b[b.NORTH=0]="NORTH";b[b.NORTH_EAST=1]="NORTH_EAST";b[b.EAST=2]="EAST";b[b.SOUTH_EAST=3]="SOUTH_EAST";b[b.SOUTH=4]="SOUTH";b[b.SOUTH_WEST=
5]="SOUTH_WEST";b[b.WEST=6]="WEST";b[b.NORTH_WEST=7]="NORTH_WEST"})(a.NeighborIndex||(a.NeighborIndex={}));a.LODSnapping=void 0;(function(b){b[b.OFF=0]="OFF";b[b.ON=1]="ON"})(a.LODSnapping||(a.LODSnapping={}));a.RenderTargetType=void 0;(function(b){b[b.Color=0]="Color";b[b.ColorNoRasterImage=1]="ColorNoRasterImage";b[b.Highlight=2]="Highlight";b[b.Water=3]="Water";b[b.Occluded=4]="Occluded"})(a.RenderTargetType||(a.RenderTargetType={}));a.TextureUpdate=void 0;(function(b){b[b.FADING=0]="FADING";b[b.IMMEDIATE=
1]="IMMEDIATE";b[b.UNFADED=2]="UNFADED"})(a.TextureUpdate||(a.TextureUpdate={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Overlay":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../geometry/support/aaBoundingRect ./interfaces ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/LocalOriginFactory".split(" "),function(a,b,c,n,l,u,v){a.OverlaySource=void 0;(function(d){d[d.None=
0]="None";d[d.ColorAndWater=1]="ColorAndWater";d[d.Highlight=2]="Highlight";d[d.Occluded=3]="Occluded"})(a.OverlaySource||(a.OverlaySource={}));let m=function(){function d(g,p){this.index=g;this.renderTargets=p;this._extent=n.create();this.resolution=0;this.renderLocalOrigin=v.fromValues(0,0,0,"O");this.mapUnitsPerPixel=this.pixelRatio=1;this.canvasGeometries=new h;this.validTargets=null;this.hasTargetWithoutRasterImage=this.hasDrapedRasterSource=this.hasDrapedFeatureSource=!1;this.index=g;this.validTargets=
Array(p.renderTargets.length).fill(!1)}var e=d.prototype;e.getValidTexture=function(g){return this.validTargets[g]?this.renderTargets.getTarget(g).getTexture():null};e.getColorTexture=function(g){return(g=g===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(l.RenderTargetType.Color):g===a.OverlaySource.Highlight?this.renderTargets.getTarget(l.RenderTargetType.Highlight):this.renderTargets.getTarget(l.RenderTargetType.Occluded))?g.getTexture():null};e.getColorTextureNoRasterImage=function(){return this._needsColorWithoutRasterImage?
this.getValidTexture(l.RenderTargetType.ColorNoRasterImage):this.hasDrapedFeatureSource?this.getValidTexture(l.RenderTargetType.Color):null};e.getNormalTexture=function(g){return(g=g===a.OverlaySource.ColorAndWater?this.renderTargets.getTarget(l.RenderTargetType.Water):null)?g.getTexture():null};e.draw=function(g,p){const t=this.computeRenderTargetValidityBitfield();for(const q of this.renderTargets.renderTargets)this.validTargets[q.type]=q.type!==l.RenderTargetType.ColorNoRasterImage||this._needsColorWithoutRasterImage?
g.drawTarget(this,q,p):!1;g=this.computeRenderTargetValidityBitfield();return t^g?u.ValidationState.CHANGED:u.ValidationState.UNCHANGED};e.computeRenderTargetValidityBitfield=function(){const g=this.validTargets;return+g[l.RenderTargetType.Color]|+g[l.RenderTargetType.ColorNoRasterImage]<<1|+g[l.RenderTargetType.Highlight]<<2|+g[l.RenderTargetType.Water]<<3|+g[l.RenderTargetType.Occluded]<<4};e.setupGeometryViewsCyclical=function(g){this.setupGeometryViewsDirect();var p=.001*g.range;if(this._extent[0]-
p<=g.min){const t=this.canvasGeometries.extents[this.canvasGeometries.numViews++];n.offset(this._extent,g.range,0,t)}this._extent[2]+p>=g.max&&(p=this.canvasGeometries.extents[this.canvasGeometries.numViews++],n.offset(this._extent,-g.range,0,p))};e.setupGeometryViewsDirect=function(){this.canvasGeometries.numViews=1;n.copy(this.canvasGeometries.extents[0],this._extent)};e.hasSomeSizedView=function(){for(let g=0;g<this.canvasGeometries.numViews;g++){const p=this.canvasGeometries.extents[g];if(p[0]!==
p[2]&&p[1]!==p[3])return!0}return!1};e.applyViewport=function(g){g.setViewport(this.index===l.OverlayIndex.INNER?0:this.resolution,0,this.resolution,this.resolution)};b._createClass(d,[{key:"extent",get:function(){return this._extent}},{key:"_needsColorWithoutRasterImage",get:function(){return this.hasDrapedRasterSource&&this.hasDrapedFeatureSource&&this.hasTargetWithoutRasterImage}}]);return d}(),h=function(){this.extents=[n.create(),n.create(),n.create()];this.numViews=0};a.Overlay=m;a.computeOverlayResolution=
function(d,e,g){return Math.min(c.nextHighestPowerOfTwo(Math.max(d,e)+256),g)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LocalOriginFactory":function(){define(["exports","../../../../chunks/vec3f64"],function(a,b){let c=function(n,l){this.vec3=n;this.id=l};a.LocalOrigin=c;a.fromValues=function(n,l,u,v){return new c(b.fromValues(n,l,u),v)};a.fromVector=function(n,l){return new c(b.clone(n),l)};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayFramebufferObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec2f32 ../../webgl/enums ../../webgl/FramebufferObject".split(" "),function(a,b,c,n,l,u){let v=function(){function m(d,e){this.size=n.create();this._fbo=null;this._fbo=new u.FramebufferObject(d,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},{target:l.TextureType.TEXTURE_2D,
pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:l.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:e,maxAnisotropy:8,width:0,height:0})}var h=m.prototype;h.dispose=function(){this._fbo=c.disposeMaybe(this._fbo)};h.getTexture=function(){return this._fbo?this._fbo.colorTexture:null};h.isValid=function(){return null!==this._fbo};h.resize=function(d,e){this.size[0]=d;this.size[1]=e;this._fbo.resize(this.size[0],this.size[1])};h.bind=
function(d){d.bindFramebuffer(this._fbo)};h.generateMipMap=function(){this._fbo.colorTexture.descriptor.hasMipmap&&this._fbo.colorTexture.generateMipmap()};h.disposeRenderTargetMemory=function(){var d;null==(d=this._fbo)?void 0:d.resize(0,0)};b._createClass(m,[{key:"gpuMemoryUsage",get:function(){var d,e;return null!=(d=null==(e=this._fbo)?void 0:e.gpuMemoryUsage)?d:0}}]);return m}();a.OverlayFramebufferObject=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/OverlayRenderTarget":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./interfaces","./OverlayFramebufferObject","../webgl-engine/lib/RenderPass"],function(a,b,c,n,l){let u=function(){function v(h){const d=(e,g,p=!0)=>({type:g,fbo:new n.OverlayFramebufferObject(h,p),renderPass:e,valid:!1,lastUsed:Infinity});this.renderTargets=[d(l.RenderPass.MATERIAL,c.RenderTargetType.Color),d(l.RenderPass.MATERIAL,c.RenderTargetType.ColorNoRasterImage),d(l.RenderPass.MATERIAL_HIGHLIGHT,
c.RenderTargetType.Highlight,!1),d(l.RenderPass.MATERIAL_NORMAL,c.RenderTargetType.Water),d(l.RenderPass.MATERIAL,c.RenderTargetType.Occluded)]}var m=v.prototype;m.getTarget=function(h){return this.renderTargets[h].fbo};m.dispose=function(){for(const h of this.renderTargets)h.fbo.dispose()};m.disposeRenderTargetMemory=function(){for(const h of this.renderTargets)h.fbo.disposeRenderTargetMemory()};m.validateUsageForTarget=function(h,d,e){if(h)d.lastUsed=e;else if(1E3<e-d.lastUsed)d.fbo.disposeRenderTargetMemory(),
d.lastUsed=Infinity;else if(Infinity>d.lastUsed)return!0;return!1};b._createClass(v,[{key:"gpuMemoryUsage",get:function(){return this.renderTargets.reduce((h,d)=>h+d.fbo.gpuMemoryUsage,0)}}]);return v}();a.OverlayRenderTarget=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderTechnique/ShaderTechniqueRepository":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"../../../../../core/NestedMap"],function(a,b,c,n){let l=function(){function v(h){this._context=h;this._perConstructorInstances=new n.NestedMap;this._frameCounter=0;this._keepAliveFrameCount=-1}var m=v.prototype;m.dispose=function(){this._perConstructorInstances.forEach(h=>h.forEach(d=>d.technique.destroy()));this._perConstructorInstances.clear()};m.acquire=function(h,d){const e=d.key;let g=this._perConstructorInstances.get(h,e);if(c.isNone(g)){const p=new h(this._context,d,()=>this.release(p));g=
new u(p);this._perConstructorInstances.set(h,e,g)}++g.refCount;return g.technique};m.releaseAndAcquire=function(h,d,e){if(c.isSome(e)){if(d.key===e.key)return e;this.release(e)}return this.acquire(h,d)};m.release=function(h){c.isNone(h)||this._perConstructorInstances.empty||(h=this._perConstructorInstances.get(h.constructor,h.key),c.isNone(h)||(--h.refCount,0===h.refCount&&(h.refZeroFrame=this._frameCounter)))};m.frameUpdate=function(){this._frameCounter++;-1!==this._keepAliveFrameCount&&this._perConstructorInstances.forEach((h,
d)=>{h.forEach((e,g)=>{0===e.refCount&&e.refZeroFrame+this._keepAliveFrameCount<this._frameCounter&&(e.technique.destroy(),this._perConstructorInstances.delete(d,g))})})};m.reloadAll=function(){var h=b._asyncToGenerator(function*(){var d=this;const e=[];this._perConstructorInstances.forEach((g,p)=>{const t=function(){var q=b._asyncToGenerator(function*(k,r){if(r=r.shader)yield r.reload(),k.forEach(y=>{y.technique.reload(d._context)})});return function(k,r){return q.apply(this,arguments)}}();e.push(t(g,
p))});yield Promise.all(e)});return function(){return h.apply(this,arguments)}}();b._createClass(v,[{key:"viewingMode",get:function(){return this._context.viewingMode}},{key:"constructionContext",get:function(){return this._context}}]);return v}(),u=function(v){this.technique=v;this.refZeroFrame=this.refCount=0};a.ShaderTechniqueRepository=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/NestedMap":function(){define(["exports","../chunks/_rollupPluginBabelHelpers"],
function(a,b){let c=function(){function n(){this._outer=new Map}var l=n.prototype;l.clear=function(){this._outer.clear()};l.get=function(u,v){var m;return null==(m=this._outer.get(u))?void 0:m.get(v)};l.set=function(u,v,m){const h=this._outer.get(u);h?h.set(v,m):this._outer.set(u,new Map([[v,m]]))};l.delete=function(u,v){const m=this._outer.get(u);m&&(m.delete(v),0===m.size&&this._outer.delete(u))};l.forEach=function(u){this._outer.forEach((v,m)=>u(v,m))};b._createClass(n,[{key:"empty",get:function(){return 0===
this._outer.size}}]);return n}();a.NestedMap=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/AutoDisposable":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){const c=l=>function(u){function v(){var m=u.apply(this,arguments)||this;m._isDisposed=!1;return m}b._inheritsLoose(v,u);v.prototype.dispose=function(){for(const h of null!=(m=this._managedDisposables)?m:[]){var m;m=this[h];
this[h]=null;m&&"function"===typeof m.dispose&&m.dispose()}this._isDisposed=!0};b._createClass(v,[{key:"isDisposed",get:function(){return this._isDisposed}}]);return v}(l);let n=function(l){function u(){return l.apply(this,arguments)||this}b._inheritsLoose(u,l);return u}(c(function(){return function(){}}()));a.AutoDisposable=n;a.AutoDisposableMixin=c;a.autoDispose=function(){return(l,u)=>{if(!l.hasOwnProperty("_managedDisposables")){var v,m;l._managedDisposables=null!=(v=null==(m=l._managedDisposables)?
void 0:m.slice())?v:[]}l._managedDisposables.unshift(u)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterialRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/NestedMap ./Util".split(" "),function(a,b,c,n,l,u){const v=c.getLogger("esri.views.3d.webgl-engine.lib.GLMaterialRepository");c=function(){function h(e,g,p,t){this._textureRepository=
e;this._techniqueRepository=g;this.materialChanged=p;this.requestRender=t;this._id2glMaterialRef=new l.NestedMap}var d=h.prototype;d.dispose=function(){this._textureRepository.dispose()};d.acquire=function(e,g){this._ownMaterial(e);var p=this._id2glMaterialRef.get(g,e.id);n.isNone(p)&&(p=e.createGLMaterial({material:e,techniqueRep:this._techniqueRepository,textureRep:this._textureRepository,output:g}),p=new m(p),this._id2glMaterialRef.set(g,e.id,p));p.ref();return p.glMaterial};d.release=function(e,
g){const p=this._id2glMaterialRef.get(g,e.id);n.isSome(p)&&(p.unref(),p.referenced||(n.disposeMaybe(p.glMaterial),this._id2glMaterialRef.delete(g,e.id)))};d._ownMaterial=function(e){n.isSome(e.repository)&&e.repository!==this&&v.error("Material is already owned by a different material repository");e.repository=this};return h}();let m=function(){function h(e){this.glMaterial=e;this.refCnt=0}var d=h.prototype;d.ref=function(){++this.refCnt};d.unref=function(){--this.refCnt;u.assert(0<=this.refCnt)};
b._createClass(h,[{key:"referenced",get:function(){return 0<this.refCnt}}]);return h}();a.GLMaterialRepository=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GridLocalOriginFactory":function(){define("exports ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ./basicInterfaces ./Geometry ./LocalOriginFactory ./Object3D ./testUtils ./VertexAttribute ./WebGLLayer ../materials/RibbonLineMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){let r=function(){function f(z,A=125E4){this._originSR=z;this._gridSize=A;this._origins=new Map;this._objects=new Map;this._rootOriginId="root/"+c.generateUID()}var w=f.prototype;w.getOrigin=function(z){var A=this._origins.get(this._rootOriginId);if(null==A){A=p.gridLocalOriginFactory.rootOrigin;if(b.isSome(A))return this._origins.set(this._rootOriginId,e.fromValues(A[0],A[1],A[2],this._rootOriginId)),this.getOrigin(z);z=e.fromValues(z[0]+Math.random()-.5,
z[1]+Math.random()-.5,z[2]+Math.random()-.5,this._rootOriginId);this._origins.set(this._rootOriginId,z);return z}var x=this._gridSize;const B=Math.round(z[0]/x),C=Math.round(z[1]/x),D=Math.round(z[2]/x),E=`${B}/${C}/${D}`;let F=this._origins.get(E);const G=.5*x;l.subtract(y,z,A.vec3);y[0]=Math.abs(y[0]);y[1]=Math.abs(y[1]);y[2]=Math.abs(y[2]);if(y[0]<G&&y[1]<G&&y[2]<G)return F&&(x=Math.max(...y),l.subtract(y,z,F.vec3),y[0]=Math.abs(y[0]),y[1]=Math.abs(y[1]),y[2]=Math.abs(y[2]),Math.max(...y)<x)?F:
A;F||(F=e.fromValues(B*x,C*x,D*x,E),this._origins.set(E,F));return F};w._drawOriginBox=function(z,A=v.fromValues(1,1,0,1)){const x=window.view,B=x._stage;var C=A.toString();if(!this._objects.has(C)){this._material=new k.RibbonLineMaterial({width:2,color:A});B.add(this._material);A=new q.WebGLLayer({isPickable:!1});var D=new g.Object3D({castShadow:!1});B.add(D);A.add(D);B.add(A);this._objects.set(C,D)}C=this._objects.get(C);A=[0,1,5,4,0,2,1,7,6,2,0,1,3,7,5,4,6,2,0];D=A.length;const E=Array(3*D),F=
new Uint16Array(2*(D-1)),G=.5*this._gridSize;for(let O=0;O<D;O++)E[3*O]=z[0]+(A[O]&1?G:-G),E[3*O+1]=z[1]+(A[O]&2?G:-G),E[3*O+2]=z[2]+(A[O]&4?G:-G),0<O&&(F[2*O]=O-1,F[2*O+1]=O);m.projectBuffer(E,this._originSR,0,E,x.renderSpatialReference,0,D);z=new d.Geometry([[t.VertexAttribute.POSITION,{size:3,data:E,exclusive:!0}]],[[t.VertexAttribute.POSITION,F]],h.PrimitiveType.Line);B.add(z);C.addGeometry(z,this._material,n.IDENTITY)};return f}();const y=u.create();a.GridLocalOriginFactory=r;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/testUtils":function(){define(["exports"],function(a){a.gridLocalOriginFactory={rootOrigin:null};a.textTextureAtlas={orderedRepackingEnabled:!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/WebGLLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/PooledArray ./basicInterfaces ./ContentObject ./ContentObjectType ./DirtyEvents ./Octree".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){m=function(g){function p(q,k=""){var r,y,f;var w=g.call(this)||this;w.apiLayerUid=k;w.type=h.ContentObjectType.Layer;w.events=new c;w.isSliceable=!1;w._objects=new u;w._stageHandles=new n;w.apiLayerUid=k;w.isVisible=null!=(r=null==q?void 0:q.isVisible)?r:!0;w.isPickable=null!=(y=null==q?void 0:q.isPickable)?y:!0;w.updatePolicy=null!=(f=null==q?void 0:q.updatePolicy)?f:v.UpdatePolicy.ASYNC;return w}b._inheritsLoose(p,g);var t=p.prototype;t.destroy=function(){this.detachStage();
this._stage=null};t.attachStage=function(q){this.detachStage();this._stage=q;for(const k of d.DirtyEventNames)this._stageHandles.add(this.events.on(k,r=>q.handleEvent(k,r)))};t.detachStage=function(){this._stageHandles.removeAll();this.invalidateSpatialQueryAccelerator()};t.add=function(q){this._objects.push(q);q.parentLayer=this;this.events.emit("layerObjectAdded",{layer:this,object:q});l.isSome(this._octree)&&this._octree.add([q])};t.remove=function(q){this._objects.removeUnordered(q)&&(q.parentLayer=
null,this.events.emit("layerObjectRemoved",{layer:this,object:q}),l.isSome(this._octree)&&this._octree.remove([q]))};t.addMany=function(q){this._objects.pushArray(q);for(const k of q)k.parentLayer=this;this.events.emit("layerObjectsAdded",{layer:this,objects:q});l.isSome(this._octree)&&this._octree.add(q)};t.removeMany=function(q){const k=[];this._objects.removeUnorderedMany(q,q.length,k);if(0!==k.length){for(const r of k)r.parentLayer=null;this.events.emit("layerObjectsRemoved",{layer:this,objects:k});
l.isSome(this._octree)&&this._octree.remove(k)}};t.sync=function(){l.isSome(this._stage)&&this.updatePolicy!==v.UpdatePolicy.SYNC&&this._stage.syncLayer(this.id)};t.notifyObjectBBChanged=function(q,k){l.isSome(this._octree)&&this._octree.update(q,k)};t.getSpatialQueryAccelerator=function(){l.isNone(this._octree)&&50<this._objects.length&&this._createOctree();return this._octree};t.shaderTransformationChanged=function(){this.invalidateSpatialQueryAccelerator();this.events.emit("shaderTransformationChanged",
this)};t.invalidateSpatialQueryAccelerator=function(){this._octree=l.destroyMaybe(this._octree)};t._createOctree=function(){this._octree=new e(q=>q.boundingVolumeWorldSpace.bounds);this._octree.add(this._objects.data,this._objects.length)};b._createClass(p,[{key:"objects",get:function(){return this._objects}}]);return p}(m.ContentObject);a.WebGLLayer=m;a.isWebGLLayer=function(g){return l.isSome(g)&&g.type===h.ContentObjectType.Layer};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/DirtyEvents":function(){define(["exports"],function(a){a.DirtyEventNames="layerObjectAdded layerObjectRemoved layerObjectsAdded layerObjectsRemoved shaderTransformationChanged objectTransformation visibilityChanged occlusionChanged highlightChanged objectGeometryAdded objectGeometryRemoved vertexAttrsUpdated".split(" ");Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Octree":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/ObjectPool ../../../../core/PooledArray ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/frustum ../../../../geometry/support/ray ../../../../chunks/sphere ./Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(J,I,P){P[0]=J[0]+I;P[1]=J[1]+I;P[2]=J[2]+I}function g(J,I,P,N){if(1===I)J=P(J[0]),h.copy(J,N);else{C[0]=Infinity;C[1]=Infinity;C[2]=Infinity;D[0]=-Infinity;D[1]=-Infinity;D[2]=-Infinity;for(let H=0;H<I;H++){var V=P(J[H]);if(k(V[3])){var S=C,T=V;S[0]=Math.min(S[0],T[0]-T[3]);S[1]=Math.min(S[1],T[1]-T[3]);S[2]=Math.min(S[2],T[2]-T[3]);S=D;S[0]=Math.max(S[0],V[0]+V[3]);S[1]=Math.max(S[1],V[1]+V[3]);S[2]=Math.max(S[2],V[2]+V[3])}}l.lerp(N,C,D,.5);N[3]=Math.max(D[0]-
C[0],D[1]-C[1],D[2]-C[2])/2}}function p(J,I,P){if(!R.length)for(var N=0;8>N;++N)R.push({index:0,distance:0});for(N=0;8>N;++N){const V=f[N];R.data[N].index=N;R.data[N].distance=q(J,I,V)}R.sort((V,S)=>V.distance-S.distance);for(J=0;8>J;++J)P[J]=R.data[J].index}function t(J,I){let P=Infinity,N=null;for(let V=0;8>V;++V){const S=q(J,I,w[V]);S<P&&(P=S,N=w[V])}return N}function q(J,I,P){return I*(J[0]*P[0]+J[1]*P[1]+J[2]*P[2])}function k(J){return!isNaN(J)&&-Infinity!==J&&Infinity!==J&&0<J}let r=function(){function J(P,
N){this._objectToBoundingSphere=P;this._maximumObjectsPerNode=10;this._maximumDepth=20;this._degenerateObjects=new Set;this._root=new y;this._objectCount=0;N&&(void 0!==N.maximumObjectsPerNode&&(this._maximumObjectsPerNode=N.maximumObjectsPerNode),void 0!==N.maximumDepth&&(this._maximumDepth=N.maximumDepth))}var I=J.prototype;I.destroy=function(){this._degenerateObjects.clear();y.clearPool();A[0]=null;E.prune();R.prune()};I.add=function(P,N=P.length){this._objectCount+=N;this._grow(P,N);const V=y.acquire();
for(let S=0;S<N;S++){const T=P[S];this._isDegenerate(T)?this._degenerateObjects.add(T):(V.init(this._root),this._add(T,V))}y.release(V)};I.remove=function(P,N=null){this._objectCount-=P.length;const V=y.acquire();for(const S of P)P=b.isSome(N)?N:h.copy(this._objectToBoundingSphere(S),F),k(P[3])?(V.init(this._root),this._remove(S,P,V)):this._degenerateObjects.delete(S);y.release(V);this._shrink()};I.update=function(P,N){if(k(N[3])||!this._isDegenerate(P))A[0]=P,P=A,this.remove(P,N),this.add(P)};I.forEachAlongRay=
function(P,N,V){const S=m.wrap(P,N);this._forEachNode(this._root,T=>{if(!this._intersectsNode(S,T))return!1;T=T.node;T.terminals.forAll(H=>{this._intersectsObject(S,H)&&V(H)});null!==T.residents&&T.residents.forAll(H=>{this._intersectsObject(S,H)&&V(H)});return!0})};I.forEachAlongRayWithVerticalOffset=function(P,N,V,S){const T=m.wrap(P,N);this._forEachNode(this._root,H=>{if(!this._intersectsNodeWithOffset(T,H,S))return!1;H=H.node;H.terminals.forAll(U=>{this._intersectsObjectWithOffset(T,U,S)&&V(U)});
null!==H.residents&&H.residents.forAll(U=>{this._intersectsObjectWithOffset(T,U,S)&&V(U)});return!0})};I.forEach=function(P){this._forEachNode(this._root,N=>{N=N.node;N.terminals.forAll(P);null!==N.residents&&N.residents.forAll(P);return!0});this._degenerateObjects.forEach(P)};I.forEachDegenerateObject=function(P){this._degenerateObjects.forEach(P)};I.findClosest=function(P,N,V,S=()=>!0,T=Infinity){let H=Infinity,U=Infinity,W=null;const Q=t(P,N),X=ba=>{--T;if(S(ba)){var aa=this._objectToBoundingSphere(ba);
if(v.intersectsSphere(V,aa)){var ea=q(P,N,h.getCenter(aa)),ia=ea-aa[3];aa=ea+aa[3];ia<H&&(H=ia,U=aa,W=ba)}}};this._forEachNodeDepthOrdered(this._root,ba=>{if(0>=T||!v.intersectsSphere(V,ba.bounds))return!1;l.scale(B,Q,ba.halfSize);l.add(B,B,ba.bounds);if(q(P,N,B)>U)return!1;ba=ba.node;ba.terminals.forAll(aa=>X(aa));null!==ba.residents&&ba.residents.forAll(aa=>X(aa));return!0},P,N);return W};I.forEachInDepthRange=function(P,N,V,S,T,H,U){let W=-Infinity,Q=Infinity;const X={setRange:ka=>{V===J.DepthOrder.FRONT_TO_BACK?
(W=Math.max(W,ka.near),Q=Math.min(Q,ka.far)):(W=Math.max(W,-ka.far),Q=Math.min(Q,-ka.near))}};X.setRange(S);const ba=q(N,V,P),aa=t(N,V),ea=t(N,-V),ia=ka=>{if(U(ka)){var la=this._objectToBoundingSphere(ka),Z=h.getCenter(la);Z=q(N,V,Z)-ba;var ca=Z+la[3];Z-la[3]>Q||ca<W||!v.intersectsSphere(H,la)||T(ka,X)}};this._forEachNodeDepthOrdered(this._root,ka=>{if(!v.intersectsSphere(H,ka.bounds))return!1;l.scale(B,aa,ka.halfSize);l.add(B,B,ka.bounds);if(q(N,V,B)-ba>Q)return!1;l.scale(B,ea,ka.halfSize);l.add(B,
B,ka.bounds);if(q(N,V,B)-ba<W)return!1;ka=ka.node;ka.terminals.forAll(la=>ia(la));null!==ka.residents&&ka.residents.forAll(la=>ia(la));return!0},N,V)};I.forEachNode=function(P){this._forEachNode(this._root,N=>P(N.node,N.bounds,N.halfSize))};I.forEachNeighbor=function(P,N){const V=h.getRadius(N),S=h.getCenter(N),T=H=>{const U=this._objectToBoundingSphere(H);var W=h.getRadius(U);W=V+W;0>=l.squaredDistance(h.getCenter(U),S)-W*W&&P(H)};this._forEachNode(this._root,H=>{var U=h.getRadius(H.bounds);U=V+
U;if(0<l.squaredDistance(h.getCenter(H.bounds),S)-U*U)return!1;H=H.node;H.terminals.forAll(W=>T(W));null!==H.residents&&H.residents.forAll(W=>T(W));return!0});this.forEachDegenerateObject(T)};I._intersectsNode=function(P,N){e(N.bounds,2*-N.halfSize,C);e(N.bounds,2*N.halfSize,D);return d.rayBoxTest(P.origin,P.direction,C,D)};I._intersectsNodeWithOffset=function(P,N,V){e(N.bounds,2*-N.halfSize,C);e(N.bounds,2*N.halfSize,D);V.applyToMinMax(C,D);return d.rayBoxTest(P.origin,P.direction,C,D)};I._intersectsObject=
function(P,N){N=this._objectToBoundingSphere(N);return 0<N[3]?h.intersectsRay(N,P):!0};I._intersectsObjectWithOffset=function(P,N,V){N=this._objectToBoundingSphere(N);return 0<N[3]?h.intersectsRay(V.applyToBoundingSphere(N),P):!0};I._forEachNode=function(P,N){P=y.acquire().init(P);const V=[P];for(;0!==V.length;){P=V.pop();if(N(P)&&!P.isLeaf())for(let S=0;S<P.node.children.length;S++)P.node.children[S]&&V.push(y.acquire().init(P).advance(S));y.release(P)}};I._forEachNodeDepthOrdered=function(P,N,V,
S=J.DepthOrder.FRONT_TO_BACK){P=y.acquire().init(P);const T=[P];for(p(V,S,M);0!==T.length;){P=T.pop();if(N(P)&&!P.isLeaf())for(V=7;0<=V;--V)S=M[V],P.node.children[S]&&T.push(y.acquire().init(P).advance(S));y.release(P)}};I._remove=function(P,N,V){E.clear();N=V.advanceTo(N,(S,T)=>{E.push(S.node);E.push(T)})?V.node.terminals:V.node.residents;N.removeUnordered(P);if(0===N.length)for(P=E.length-2;0<=P&&this._purge(E.data[P],E.data[P+1]);P-=2);};I._nodeIsEmpty=function(P){if(0!==P.terminals.length)return!1;
if(null!==P.residents)return 0===P.residents.length;for(let N=0;N<P.children.length;N++)if(P.children[N])return!1;return!0};I._purge=function(P,N){0<=N&&(P.children[N]=null);return this._nodeIsEmpty(P)?(null===P.residents&&(P.residents=new n({shrink:!0})),!0):!1};I._add=function(P,N){N.advanceTo(this._objectToBoundingSphere(P))?N.node.terminals.push(P):(N.node.residents.push(P),N.node.residents.length>this._maximumObjectsPerNode&&N.depth<this._maximumDepth&&this._split(N))};I._split=function(P){const N=
P.node.residents;P.node.residents=null;for(let V=0;V<N.length;V++){const S=y.acquire().init(P);this._add(N.getItemAt(V),S);y.release(S)}};I._grow=function(P,N){0!==N&&(g(P,N,V=>this._objectToBoundingSphere(V),G),k(G[3])&&!this._fitsInsideTree(G)&&(this._nodeIsEmpty(this._root.node)?(h.copy(G,this._root.bounds),this._root.halfSize=1.25*G[3]):(P=this._rootBoundsForRootAsSubNode(G),this._placingRootViolatesMaxDepth(P)?this._rebuildTree(G,P):this._growRootAsSubNode(P),y.release(P))))};I._rebuildTree=
function(P,N){l.copy(O,N.bounds);O[3]=N.halfSize;g([P,O],2,V=>V,K);P=y.acquire().init(this._root);this._root.initFrom(null,K,1.25*K[3]);this._forEachNode(P,V=>{this.add(V.node.terminals.data,V.node.terminals.length);null!==V.node.residents&&this.add(V.node.residents.data,V.node.residents.length);return!0});y.release(P)};I._placingRootViolatesMaxDepth=function(P){const N=Math.log(P.halfSize/this._root.halfSize)*Math.LOG2E;let V=0;this._forEachNode(this._root,S=>{V=Math.max(V,S.depth);return V+N<=this._maximumDepth});
return V+N>this._maximumDepth};I._rootBoundsForRootAsSubNode=function(P){var N=P[3];let V=-Infinity;const S=this._root.bounds,T=this._root.halfSize;for(var H=0;3>H;H++){var U=Math.max(0,Math.ceil((S[H]-T-(P[H]-N))/(2*T)));const W=Math.max(0,Math.ceil((P[H]+N-(S[H]+T))/(2*T)))+1;V=Math.max(V,2**Math.ceil(Math.log(U+W)*Math.LOG2E));L[H].min=U;L[H].max=W}for(P=0;3>P;P++)N=L[P].min,H=L[P].max,U=(V-(N+H))/2,N+=Math.ceil(U),H+=Math.floor(U),x[P]=S[P]-T-N*T*2+(H+N)*T;x[3]=V*T*z;return y.acquire().initFrom(null,
x,V*T,0)};I._growRootAsSubNode=function(P){const N=this._root.node;l.copy(G,this._root.bounds);G[3]=this._root.halfSize;this._root.init(P);P.advanceTo(G,null,!0);P.node.children=N.children;P.node.residents=N.residents;P.node.terminals=N.terminals};I._shrink=function(){for(;;){const P=this._findShrinkIndex();if(-1===P)break;this._root.advance(P);this._root.depth=0}};I._findShrinkIndex=function(){if(0!==this._root.node.terminals.length||this._root.isLeaf())return-1;let P=null;const N=this._root.node.children;
let V=0,S=0;for(;S<N.length&&null==P;)V=S++,P=N[V];for(;S<N.length;)if(N[S++])return-1;return V};I._isDegenerate=function(P){P=this._objectToBoundingSphere(P)[3];return!k(P)};I._fitsInsideTree=function(P){const N=this._root.bounds,V=this._root.halfSize;return P[3]<=V&&P[0]>=N[0]-V&&P[0]<=N[0]+V&&P[1]>=N[1]-V&&P[1]<=N[1]+V&&P[2]>=N[2]-V&&P[2]<=N[2]+V};a._createClass(J,[{key:"bounds",get:function(){return this._root.bounds}},{key:"halfSize",get:function(){return this._root.halfSize}},{key:"root",get:function(){return this._root.node}},
{key:"maximumObjectsPerNode",get:function(){return this._maximumObjectsPerNode}},{key:"maximumDepth",get:function(){return this._maximumDepth}},{key:"objectCount",get:function(){return this._objectCount}}]);return J}(),y=function(){function J(){this.bounds=h.create();this.halfSize=0;this.initFrom(null,null,0,0)}var I=J.prototype;I.init=function(P){return this.initFrom(P.node,P.bounds,P.halfSize,P.depth)};I.initFrom=function(P,N,V,S=this.depth){this.node=b.isSome(P)?P:J.createEmptyNode();b.isSome(N)&&
h.copy(N,this.bounds);this.halfSize=V;this.depth=S;return this};I.advance=function(P){let N=this.node.children[P];N||(N=J.createEmptyNode(),this.node.children[P]=N);this.node=N;this.halfSize/=2;this.depth++;P=f[P];this.bounds[0]+=P[0]*this.halfSize;this.bounds[1]+=P[1]*this.halfSize;this.bounds[2]+=P[2]*this.halfSize;this.bounds[3]=this.halfSize*z;return this};I.advanceTo=function(P,N,V=!1){for(;;){if(this.isTerminalFor(P))return N&&N(this,-1),!0;if(this.isLeaf()){if(!V)return N&&N(this,-1),!1;this.node.residents=
null}const S=this._childIndex(P);N&&N(this,S);this.advance(S)}};I.isLeaf=function(){return null!=this.node.residents};I.isTerminalFor=function(P){return P[3]>this.halfSize/2};I._childIndex=function(P){const N=this.bounds;return(N[0]<P[0]?1:0)+(N[1]<P[1]?2:0)+(N[2]<P[2]?4:0)};J.createEmptyNode=function(){return{children:[null,null,null,null,null,null,null,null],terminals:new n({shrink:!0}),residents:new n({shrink:!0})}};J.acquire=function(){return J._pool.acquire()};J.release=function(P){J._pool.release(P)};
J.clearPool=function(){J._pool.prune()};return J}();y._pool=new c(y);(function(J){J=J.DepthOrder||(J.DepthOrder={});J[J.FRONT_TO_BACK=1]="FRONT_TO_BACK";J[J.BACK_TO_FRONT=-1]="BACK_TO_FRONT"})(r||(r={}));const f=[u.fromValues(-1,-1,-1),u.fromValues(1,-1,-1),u.fromValues(-1,1,-1),u.fromValues(1,1,-1),u.fromValues(-1,-1,1),u.fromValues(1,-1,1),u.fromValues(-1,1,1),u.fromValues(1,1,1)],w=[u.fromValues(-1,-1,-1),u.fromValues(-1,-1,1),u.fromValues(-1,1,-1),u.fromValues(-1,1,1),u.fromValues(1,-1,-1),u.fromValues(1,
-1,1),u.fromValues(1,1,-1),u.fromValues(1,1,1)],z=Math.sqrt(3),A=[null],x=h.create(),B=u.create(),C=u.create(),D=u.create(),E=new n,F=h.create(),G=h.create(),O=h.create(),K=h.create(),L=[{min:0,max:0},{min:0,max:0},{min:0,max:0}],R=new n,M=[0,0,0,0,0,0,0,0];return r})},"esri/views/3d/webgl-engine/materials/RibbonLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/mathUtils ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./VisualVariablePassParameters ./renderers/utils ../../../../chunks/RibbonLine.glsl ../shaders/RibbonLineTechnique ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E){function F(Y,da,ha,ja,ma){for(let pa=0;pa<ma;pa++)ha[ja++]=Y[da++];return ja}function G(Y,da,ha){da=da.get(A.VertexAttribute.POSITION).data;ha=ha?ha.get(A.VertexAttribute.POSITION):null;return Y.isClosed?ha?2<ha.length:6<da.length:!1}const O=c.getLogger("esri.views.3d.webgl-engine.materials.RibbonLineMaterial");var K;(function(Y){Y[Y.LEFT_JOIN_START=-2]="LEFT_JOIN_START";Y[Y.LEFT_JOIN_END=-1]="LEFT_JOIN_END";Y[Y.LEFT_CAP_START=-4]="LEFT_CAP_START";
Y[Y.LEFT_CAP_END=-5]="LEFT_CAP_END";Y[Y.RIGHT_JOIN_START=2]="RIGHT_JOIN_START";Y[Y.RIGHT_JOIN_END=1]="RIGHT_JOIN_END";Y[Y.RIGHT_CAP_START=4]="RIGHT_CAP_START";Y[Y.RIGHT_CAP_END=5]="RIGHT_CAP_END"})(K||(K={}));c=function(Y){function da(ja){ja=Y.call(this,ja,new R)||this;ja._vertexAttributeLocations=D.ribbonVertexAttributeLocations;ja.techniqueConfig=new E.RibbonLineTechniqueConfiguration;ja.layout=ja.createLayout();return ja}b._inheritsLoose(da,Y);var ha=da.prototype;ha.isClosed=function(ja,ma){return this.parameters.isClosed?
ma?2<ma.length:6<ja.length:!1};ha.getConfiguration=function(ja,ma){this.techniqueConfig.output=ja;this.techniqueConfig.draped=ma.slot===w.RenderSlot.DRAPED_MATERIAL;ja=l.isSome(this.parameters.stipplePattern)&&ja!==q.ShaderOutput.Highlight;this.techniqueConfig.stippleEnabled=ja;this.techniqueConfig.stippleOffColorEnabled=ja&&l.isSome(this.parameters.stippleOffColor);this.techniqueConfig.stippleScaleWithLineWidth=ja&&this.parameters.stippleScaleWithLineWidth;this.techniqueConfig.stipplePreferContinuous=
ja&&this.parameters.stipplePreferContinuous;this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasOccludees=this.parameters.hasOccludees;this.techniqueConfig.roundJoins="round"===this.parameters.join;this.techniqueConfig.capType=this.parameters.cap;this.techniqueConfig.hasPolygonOffset=this.parameters.hasPolygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=
this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.innerColorEnabled=0<this.parameters.innerWidth&&l.isSome(this.parameters.innerColor);this.techniqueConfig.falloffEnabled=0<this.parameters.falloff;this.techniqueConfig.occluder=this.parameters.renderOccluded===f.RenderOccludedFlag.OccludeAndTransparentStencil;this.techniqueConfig.transparencyPassType=ma.transparencyPassType;this.techniqueConfig.hasMultipassTerrain=ma.multipassTerrain.enabled;
this.techniqueConfig.cullAboveGround=ma.multipassTerrain.cullAboveGround;this.techniqueConfig.wireframe=this.parameters.wireframe;return this.techniqueConfig};ha.intersect=function(ja,ma,pa,na,wa,xa,sa,ya,ra){l.isSome(ra)?this._intersectDrapedLineGeometry(ja,na,ra,xa,sa):this._intersectLineGeometry(ja,ma,pa,na,sa)};ha._intersectDrapedLineGeometry=function(ja,ma,pa,na,wa){if(ma.options.selectionMode){ma=ja.vertexAttributes.get(A.VertexAttribute.POSITION).data;var xa=ja.vertexAttributes.get(A.VertexAttribute.SIZE),
sa=this.parameters.width;this.parameters.vvSizeEnabled?(xa=ja.vertexAttributes.get(A.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0],sa*=n.clamp(this.parameters.vvSizeOffset[0]+xa*this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])):xa&&(sa*=xa.data[0]);xa=na[0];na=na[1];ja=(sa/2+4)*ja.screenToWorldRatio;sa=Number.MAX_VALUE;var ya=0;for(let Ja=0;Ja<ma.length-5;Ja+=3){var ra=ma[Ja],ua=ma[Ja+1],Ba=xa-ra,Ea=na-ua;ra=ma[Ja+3]-ra;ua=ma[Ja+4]-ua;const va=n.clamp((ra*
Ba+ua*Ea)/(ra*ra+ua*ua),0,1);Ba=ra*va-Ba;Ea=ua*va-Ea;Ea=Ba*Ba+Ea*Ea;Ea<sa&&(sa=Ea,ya=Ja/3)}sa<ja*ja&&wa(pa.dist,pa.normal,ya,!1)}};ha._intersectLineGeometry=function(ja,ma,pa,na,wa){if(na.options.selectionMode&&!B.isInstanceHidden(ma))if(z.isTranslationMatrix(pa)){var xa=ja.vertexAttributes,sa=xa.get(A.VertexAttribute.POSITION).data;ma=this.parameters.width;if(this.parameters.vvSizeEnabled){var ya=xa.get(A.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0];ma*=n.clamp(this.parameters.vvSizeOffset[0]+ya*
this.parameters.vvSizeFactor[0],this.parameters.vvSizeMinSize[0],this.parameters.vvSizeMaxSize[0])}else xa.has(A.VertexAttribute.SIZE)&&(ma*=xa.get(A.VertexAttribute.SIZE).data[0]);var ra=na.camera,ua=V;v.copy(ua,na.point);ya=ma*ra.pixelRatio/2+4*ra.pixelRatio;m.set(ea[0],ua[0]-ya,ua[1]+ya,0);m.set(ea[1],ua[0]+ya,ua[1]+ya,0);m.set(ea[2],ua[0]+ya,ua[1]-ya,0);m.set(ea[3],ua[0]-ya,ua[1]-ya,0);for(ma=0;4>ma;ma++)if(!ra.unprojectFromRenderScreen(ea[ma],ia[ma]))return;p.fromPoints(ra.eye,ia[0],ia[1],ka);
p.fromPoints(ra.eye,ia[1],ia[2],la);p.fromPoints(ra.eye,ia[2],ia[3],Z);p.fromPoints(ra.eye,ia[3],ia[0],ca);var Ba=Number.MAX_VALUE;ma=0;ja=G(this.parameters,xa,ja.indices)?sa.length-2:sa.length-5;for(xa=0;xa<ja;xa+=3){J[0]=sa[xa]+pa[12];J[1]=sa[xa+1]+pa[13];J[2]=sa[xa+2]+pa[14];var Ea=(xa+3)%sa.length;I[0]=sa[Ea]+pa[12];I[1]=sa[Ea+1]+pa[13];I[2]=sa[Ea+2]+pa[14];if(!(0>p.signedDistance(ka,J)&&0>p.signedDistance(ka,I)||0>p.signedDistance(la,J)&&0>p.signedDistance(la,I)||0>p.signedDistance(Z,J)&&0>p.signedDistance(Z,
I)||0>p.signedDistance(ca,J)&&0>p.signedDistance(ca,I))){ra.projectToRenderScreen(J,S);ra.projectToRenderScreen(I,T);if(0>S[2]&&0<T[2])m.subtract(P,J,I),Ea=ra.frustum,Ea=-p.signedDistance(Ea[e.PlaneIndex.NEAR],J)/m.dot(P,p.normal(Ea[e.PlaneIndex.NEAR])),m.scale(P,P,Ea),m.add(J,J,P),ra.projectToRenderScreen(J,S);else if(0<S[2]&&0>T[2])m.subtract(P,I,J),Ea=ra.frustum,Ea=-p.signedDistance(Ea[e.PlaneIndex.NEAR],I)/m.dot(P,p.normal(Ea[e.PlaneIndex.NEAR])),m.scale(P,P,Ea),m.add(I,I,P),ra.projectToRenderScreen(I,
T);else if(0>S[2]&&0>T[2])continue;S[2]=0;T[2]=0;Ea=g.distance2(g.fromPoints(S,T,W),ua);Ea<Ba&&(Ba=Ea,m.copy(H,J),m.copy(U,I),ma=xa/3)}}pa=na.rayBegin;na=na.rayEnd;Ba<ya*ya&&(sa=Number.MAX_VALUE,g.closestLineSegmentPoint(g.fromPoints(H,U,W),g.fromPoints(pa,na,Q),N)&&(m.subtract(N,N,pa),sa=m.length(N),m.scale(N,N,1/sa),sa/=m.distance(pa,na)),wa(sa,N,ma,!1))}else O.error("intersection assumes a translation-only matrix")};ha.computeAttachmentOrigin=function(ja,ma){const pa=ja.vertexAttributes;if(!pa)return null;
ja=ja.indices;const na=pa.get(A.VertexAttribute.POSITION);return k.computeAttachmentOriginLines(na,ja?ja.get(A.VertexAttribute.POSITION):null,ja&&G(this.parameters,pa,ja),ma)};ha.createLayout=function(){const ja=t.newLayout().vec3f(A.VertexAttribute.POSITION).f32(A.VertexAttribute.SUBDIVISIONFACTOR).vec2f(A.VertexAttribute.UV0).vec3f(A.VertexAttribute.AUXPOS1).vec3f(A.VertexAttribute.AUXPOS2);this.parameters.vvSizeEnabled?ja.f32(A.VertexAttribute.SIZEFEATUREATTRIBUTE):ja.f32(A.VertexAttribute.SIZE);
this.parameters.vvColorEnabled?ja.f32(A.VertexAttribute.COLORFEATUREATTRIBUTE):ja.vec4f(A.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&ja.f32(A.VertexAttribute.OPACITYFEATUREATTRIBUTE);return ja};ha.createBufferWriter=function(){return new M(this.layout,this.parameters)};ha.requiresSlot=function(ja,ma){if(ja===w.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===f.RenderOccludedFlag.OccludeAndTransparentStencil)return ja===w.RenderSlot.OPAQUE_MATERIAL||ja===w.RenderSlot.OCCLUDER_MATERIAL||
ja===w.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;ma=y.outputFromPass(ma);return ma===q.ShaderOutput.Color||ma===q.ShaderOutput.Alpha?ja===(this.parameters.writeDepth?w.RenderSlot.TRANSPARENT_MATERIAL:w.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):ja===w.RenderSlot.OPAQUE_MATERIAL};ha.createGLMaterial=function(ja){return ja.output===q.ShaderOutput.Color||ja.output===q.ShaderOutput.Alpha||ja.output===q.ShaderOutput.Highlight||ja.output===q.ShaderOutput.Depth?new L(ja):null};ha.validateParameters=
function(ja){"miter"!==ja.join&&(ja.miterLimit=0)};return da}(f.Material);let L=function(Y){function da(){return Y.apply(this,arguments)||this}b._inheritsLoose(da,Y);var ha=da.prototype;ha._updateOccludeeState=function(ja){ja.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:ja.hasOccludees})};ha.beginSlot=function(ja){this._output!==q.ShaderOutput.Color&&this._output!==q.ShaderOutput.Alpha||this._updateOccludeeState(ja);return this.ensureTechnique(D.RibbonLineTechnique,
ja)};return da}(r),R=function(Y){function da(){var ha=Y.apply(this,arguments)||this;ha.width=0;ha.color=d.ONES;ha.join="miter";ha.cap=E.CapType.BUTT;ha.miterLimit=5;ha.writeDepth=!0;ha.hasPolygonOffset=!1;ha.stippleScaleWithLineWidth=!1;ha.stipplePreferContinuous=!0;ha.hasSlicePlane=!1;ha.vvFastUpdate=!1;ha.isClosed=!1;ha.falloff=0;ha.innerWidth=0;ha.hasOccludees=!1;ha.wireframe=!1;return ha}b._inheritsLoose(da,Y);return da}(x.VisualVariablePassParameters),M=function(){function Y(ha,ja){this.parameters=
ja;this.numJoinSubdivisions=0;this.vertexBufferLayout=ha;ha=ja.stipplePattern?1:0;switch(this.parameters.join){case "miter":case "bevel":this.numJoinSubdivisions=ha;break;case "round":this.numJoinSubdivisions=C.NUM_ROUND_JOIN_SUBDIVISIONS+ha}}var da=Y.prototype;da._isClosed=function(ha){return G(this.parameters,ha.vertexAttributes,ha.indices)};da.allocate=function(ha){return this.vertexBufferLayout.createBuffer(ha)};da.elementCount=function(ha){var ja=ha.indices.get(A.VertexAttribute.POSITION).length/
2+1;ha=this._isClosed(ha);ja=(ha?2:4)+((ha?ja:ja-1)-(ha?0:1))*(2*this.numJoinSubdivisions+4);ja+=2;this.parameters.wireframe&&(ja=2+4*(ja-2));return ja};da.write=function(ha,ja,ma,pa){var na;const wa=X,xa=ba,sa=aa,ya=ja.vertexAttributes.get(A.VertexAttribute.POSITION).data;var ra=ja.indices&&ja.indices.get(A.VertexAttribute.POSITION);const ua=null==(na=ja.vertexAttributes.get(A.VertexAttribute.DISTANCETOSTART))?void 0:na.data;ra&&ra.length!==2*(ya.length/3-1)&&console.warn("RibbonLineMaterial does not support indices");
let Ba=1,Ea=0;this.parameters.vvSizeEnabled?Ea=ja.vertexAttributes.get(A.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:ja.vertexAttributes.has(A.VertexAttribute.SIZE)&&(Ba=ja.vertexAttributes.get(A.VertexAttribute.SIZE).data[0]);let Ja=[1,1,1,1],va=0;this.parameters.vvColorEnabled?va=ja.vertexAttributes.get(A.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:ja.vertexAttributes.has(A.VertexAttribute.COLOR)&&(Ja=ja.vertexAttributes.get(A.VertexAttribute.COLOR).data);let Ca=0;this.parameters.vvOpacityEnabled&&
(Ca=ja.vertexAttributes.get(A.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);na=ya.length/3;ha=ha.transformation;const Ka=new Float32Array(ma.buffer);ra=this.vertexBufferLayout.stride/4;let Oa=pa*ra;pa=Oa;let Ra=0;const Pa=ua?(Na,Ua,Ta)=>Ra=ua[Ta]:(Na,Ua,Ta)=>Ra+=m.distance(Na,Ua),qa=(Na,Ua,Ta,Za,ab,hb,ta)=>{Ka[Oa++]=Ua[0];Ka[Oa++]=Ua[1];Ka[Oa++]=Ua[2];Ka[Oa++]=Za;Ka[Oa++]=ta;Ka[Oa++]=ab;Ka[Oa++]=Na[0];Ka[Oa++]=Na[1];Ka[Oa++]=Na[2];Ka[Oa++]=Ta[0];Ka[Oa++]=Ta[1];Ka[Oa++]=Ta[2];this.parameters.vvSizeEnabled?
Ka[Oa++]=Ea:Ka[Oa++]=Ba;this.parameters.vvColorEnabled?Ka[Oa++]=va:(Na=Math.min(4*hb,Ja.length-4),Ka[Oa++]=Ja[Na+0],Ka[Oa++]=Ja[Na+1],Ka[Oa++]=Ja[Na+2],Ka[Oa++]=Ja[Na+3]);this.parameters.vvOpacityEnabled&&(Ka[Oa++]=Ca)};Oa+=ra;m.set(xa,ya[0],ya[1],ya[2]);ha&&m.transformMat4(xa,xa,ha);if(ja=this._isClosed(ja)){var za=ya.length-3;m.set(wa,ya[za],ya[za+1],ya[za+2]);ha&&m.transformMat4(wa,wa,ha)}else m.set(sa,ya[3],ya[4],ya[5]),ha&&m.transformMat4(sa,sa,ha),qa(xa,xa,sa,1,K.LEFT_CAP_START,0,0),qa(xa,xa,
sa,1,K.RIGHT_CAP_START,0,0),m.copy(wa,xa),m.copy(xa,sa);za=ja?0:1;const Da=ja?na:na-1;for(let Na=za;Na<Da;Na++){var La=(Na+1)%na*3;m.set(sa,ya[La+0],ya[La+1],ya[La+2]);ha&&m.transformMat4(sa,sa,ha);Pa(wa,xa,Na);qa(wa,xa,sa,0,K.LEFT_JOIN_END,Na,Ra);qa(wa,xa,sa,0,K.RIGHT_JOIN_END,Na,Ra);La=this.numJoinSubdivisions;for(let Ua=0;Ua<La;++Ua){const Ta=(Ua+1)/(La+1);qa(wa,xa,sa,Ta,K.LEFT_JOIN_END,Na,Ra);qa(wa,xa,sa,Ta,K.RIGHT_JOIN_END,Na,Ra)}qa(wa,xa,sa,1,K.LEFT_JOIN_START,Na,Ra);qa(wa,xa,sa,1,K.RIGHT_JOIN_START,
Na,Ra);m.copy(wa,xa);m.copy(xa,sa)}ja?(m.set(sa,ya[3],ya[4],ya[5]),ha&&m.transformMat4(sa,sa,ha),Ra=Pa(wa,xa,Da),qa(wa,xa,sa,0,K.LEFT_JOIN_END,za,Ra),qa(wa,xa,sa,0,K.RIGHT_JOIN_END,za,Ra)):(Ra=Pa(wa,xa,Da),qa(wa,xa,xa,0,K.LEFT_CAP_END,Da,Ra),qa(wa,xa,xa,0,K.RIGHT_CAP_END,Da,Ra));F(Ka,pa+ra,Ka,pa,ra);Oa=F(Ka,Oa-ra,Ka,Oa,ra);this.parameters.wireframe&&this._addWireframeVertices(ma,pa,Oa,ra)};da._addWireframeVertices=function(ha,ja,ma,pa){const na=new Float32Array(ha.buffer,ma*Float32Array.BYTES_PER_ELEMENT);
ha=new Float32Array(ha.buffer,ja*Float32Array.BYTES_PER_ELEMENT,ma-ja);ja=0;for(ma=0;ma<ha.length-1;ma+=2*pa)ja=F(ha,ma,na,ja,pa),ja=F(ha,ma+2*pa,na,ja,pa),ja=F(ha,ma+1*pa,na,ja,pa),ja=F(ha,ma+2*pa,na,ja,pa),ja=F(ha,ma+1*pa,na,ja,pa),ja=F(ha,ma+3*pa,na,ja,pa)};return Y}();const J=h.create(),I=h.create(),P=h.create(),N=h.create(),V=h.create(),S=u.createRenderScreenPointArray3(),T=u.createRenderScreenPointArray3(),H=h.create(),U=h.create(),W=g.create(),Q=g.create(),X=h.create(),ba=h.create(),aa=h.create(),
ea=[u.createRenderScreenPointArray3(),u.createRenderScreenPointArray3(),u.createRenderScreenPointArray3(),u.createRenderScreenPointArray3()],ia=[h.create(),h.create(),h.create(),h.create()],ka=p.create(),la=p.create(),Z=p.create(),ca=p.create();a.Parameters=R;a.RibbonLineMaterial=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/GLMaterials":function(){define(["exports","../../../../core/maybe","../core/shaderLibrary/ShaderOutputOptions",
"./basicInterfaces","./RenderPass"],function(a,b,c,n,l){function u(m){switch(m){case l.RenderPass.MATERIAL:return c.ShaderOutput.Color;case l.RenderPass.MATERIAL_ALPHA:return c.ShaderOutput.Alpha;case l.RenderPass.MATERIAL_DEPTH:return c.ShaderOutput.Depth;case l.RenderPass.MATERIAL_NORMAL:return c.ShaderOutput.Normal;case l.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return c.ShaderOutput.Shadow;case l.RenderPass.MATERIAL_HIGHLIGHT:return c.ShaderOutput.Highlight;case l.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return c.ShaderOutput.Shadow;
case l.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return c.ShaderOutput.Shadow}}let v=function(){function m(d,e){this._material=d;this._repository=e;this._map=new Map}var h=m.prototype;h.destroy=function(){this._map.forEach((d,e)=>{b.isSome(d)&&this._repository.release(this._material,u(e))})};h.load=function(d,e){this._map.has(e)||this._map.set(e,this._repository.acquire(this._material,u(e)));e=this._map.get(e);if(b.isSome(e)){if(e.ensureResources(d)===n.ResourceState.LOADED)return e;this._repository.requestRender()}return null};
return m}();a.GLMaterials=v;a.outputFromPass=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RibbonLine.glsl":function(){define("exports ../core/maybe ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PiUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z){function A(B){const C=new y.ShaderBuilder,D=B.hasMultipassTerrain&&(B.output===c.ShaderOutput.Color||B.output===c.ShaderOutput.Alpha);C.include(h.PiUtils);C.include(l.RibbonVertexPosition,B);C.include(v.LineStipple,B);B.output===c.ShaderOutput.Depth&&C.include(u.OutputDepth,B);g.addProjViewLocalOrigin(C,B);const {vertex:E,fragment:F}=C;E.uniforms.add([new r.Matrix4PassUniform("inverseProjectionMatrix",(J,I)=>I.camera.inverseProjectionMatrix),new p.Float2PassUniform("nearFar",
(J,I)=>I.camera.nearFar),new q.FloatPassUniform("miterLimit",J=>"miter"!==J.join?0:J.miterLimit),new t.Float4PassUniform("viewport",(J,I)=>I.camera.fullViewport)]);E.constants.add("LARGE_HALF_FLOAT","float",65500);C.attributes.add(w.VertexAttribute.POSITION,"vec3");C.attributes.add(w.VertexAttribute.SUBDIVISIONFACTOR,"float");C.attributes.add(w.VertexAttribute.UV0,"vec2");C.attributes.add(w.VertexAttribute.AUXPOS1,"vec3");C.attributes.add(w.VertexAttribute.AUXPOS2,"vec3");C.varyings.add("vColor",
"vec4");C.varyings.add("vpos","vec3");C.varyings.add("linearDepth","float");D&&C.varyings.add("depth","float");const G=B.capType===z.CapType.ROUND,O=B.stippleEnabled&&B.stippleScaleWithLineWidth||G;O&&C.varyings.add("vLineWidth","float");const K=B.stippleEnabled&&B.stippleScaleWithLineWidth;K&&C.varyings.add("vLineSizeInv","float");const L=B.innerColorEnabled||G;L&&C.varyings.add("vLineDistance","float");const R=B.stippleEnabled&&G,M=B.falloffEnabled||R;M&&C.varyings.add("vLineDistanceNorm","float");
G&&(C.varyings.add("vSegmentSDF","float"),C.varyings.add("vReverseSegmentSDF","float"));E.code.add(k.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x);
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}
vec2 rotate(vec2 v, float a) {
float s = sin(a);
float c = cos(a);
mat2 m = mat2(c, -s, s, c);
return m * v;
}`);E.code.add(k.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);E.code.add(k.glsl`
    void clipAndTransform(inout vec4 pos, inout vec4 prev, inout vec4 next, in bool isStartVertex) {
      float vnp = nearFar[0] * 0.99;

      if(pos.z > -nearFar[0]) {
        //current pos behind ncp --> we need to clip
        if (!isStartVertex) {
          if(prev.z < -nearFar[0]) {
            //previous in front of ncp
            pos = mix(prev, pos, interp(vnp, prev, pos));
            next = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        } else {
          if(next.z < -nearFar[0]) {
            //next in front of ncp
            pos = mix(pos, next, interp(vnp, pos, next));
            prev = pos;
          } else {
            pos = vec4(0.0, 0.0, 0.0, 1.0);
          }
        }
      } else {
        //current position visible
        if (prev.z > -nearFar[0]) {
          //previous behind ncp
          prev = mix(pos, prev, interp(vnp, pos, prev));
        }
        if (next.z > -nearFar[0]) {
          //next behind ncp
          next = mix(next, pos, interp(vnp, next, pos));
        }
      }

      ${D?"depth \x3d pos.z;":""}
      linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

      pos = projectAndScale(pos);
      next = projectAndScale(next);
      prev = projectAndScale(prev);
    }
  `);E.uniforms.add(new q.FloatPassUniform("pixelRatio",(J,I)=>I.camera.pixelRatio));E.code.add(k.glsl`
  void main(void) {
    // unpack values from uv0.y
    bool isStartVertex = abs(abs(uv0.y)-3.0) == 1.0;

    float coverage = 1.0;

    // Check for special value of uv0.y which is used by the Renderer when graphics
    // are removed before the VBO is recompacted. If this is the case, then we just
    // project outside of clip space.
    if (uv0.y == 0.0) {
      // Project out of clip space
      gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
    }
    else {
      bool isJoin = abs(uv0.y) < 3.0;

      float lineSize = getSize();
      float lineWidth = lineSize * pixelRatio;

      ${O?k.glsl`vLineWidth = lineWidth;`:""}
      ${K?k.glsl`vLineSizeInv = 1.0 / lineSize;`:""}

      // convert sub-pixel coverage to alpha
      if (lineWidth < 1.0) {
        coverage = lineWidth;
        lineWidth = 1.0;
      }else{
        // Ribbon lines cannot properly render non-integer sizes. Round width to integer size if
        // larger than one for better quality. Note that we do render < 1 pixels more or less correctly
        // so we only really care to round anything larger than 1.
        lineWidth = floor(lineWidth + 0.5);
      }

      vec4 pos  = view * vec4(position.xyz, 1.0);
      vec4 prev = view * vec4(auxpos1.xyz, 1.0);
      vec4 next = view * vec4(auxpos2.xyz, 1.0);

      clipAndTransform(pos, prev, next, isStartVertex);

      vec2 left = (pos.xy - prev.xy);
      vec2 right = (next.xy - pos.xy);

      float leftLen = length(left);
      float rightLen = length(right);
  `);(B.stippleEnabled||G)&&E.code.add(k.glsl`
      float isEndVertex = float(!isStartVertex);
      vec2 segmentOrigin = mix(pos.xy, prev.xy, isEndVertex);
      vec2 segment = mix(right, left, isEndVertex);
      ${G?k.glsl`vec2 segmentEnd = mix(next.xy, pos.xy, isEndVertex);`:""}
    `);E.code.add(k.glsl`left = (leftLen > 0.001) ? left/leftLen : vec2(0.0, 0.0);
right = (rightLen > 0.001) ? right/rightLen : vec2(0.0, 0.0);
vec2 capDisplacementDir = vec2(0, 0);
vec2 joinDisplacementDir = vec2(0, 0);
float displacementLen = lineWidth;
if (isJoin) {
bool isOutside = (left.x * right.y - left.y * right.x) * uv0.y > 0.0;
joinDisplacementDir = normalize(left + right);
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);
if (leftLen > 0.001 && rightLen > 0.001) {
float nDotSeg = dot(joinDisplacementDir, left);
displacementLen /= length(nDotSeg * left - joinDisplacementDir);
if (!isOutside) {
displacementLen = min(displacementLen, min(leftLen, rightLen)/abs(nDotSeg));
}
}
if (isOutside && (displacementLen > miterLimit * lineWidth)) {`);B.roundJoins?E.code.add(k.glsl`
        vec2 startDir = leftLen < 0.001 ? right : left;
        startDir = PERPENDICULAR(startDir);

        vec2 endDir = rightLen < 0.001 ? left : right;
        endDir = PERPENDICULAR(endDir);

        float factor = ${B.stippleEnabled?k.glsl`min(1.0, subdivisionFactor * ${k.glsl.float(1.5)})`:k.glsl`subdivisionFactor`};

        float rotationAngle = acos(clamp(dot(startDir, endDir), -1.0, 1.0));
        joinDisplacementDir = rotate(startDir, -sign(uv0.y) * factor * rotationAngle);
      `):E.code.add(k.glsl`if (leftLen < 0.001) {
joinDisplacementDir = right;
}
else if (rightLen < 0.001) {
joinDisplacementDir = left;
}
else {
joinDisplacementDir = (isStartVertex || subdivisionFactor > 0.0) ? right : left;
}
joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);`);E.code.add(k.glsl`
        displacementLen = lineWidth;
      }
    } else {
      // CAP handling ---------------------------------------------------
      joinDisplacementDir = isStartVertex ? right : left;
      joinDisplacementDir = PERPENDICULAR(joinDisplacementDir);

      ${B.capType!==z.CapType.BUTT?k.glsl`capDisplacementDir = isStartVertex ? -right : left;`:""}
    }
  `);E.code.add(k.glsl`
    // Displacement (in pixels) caused by join/or cap
    vec2 dpos = joinDisplacementDir * sign(uv0.y) * displacementLen + capDisplacementDir * displacementLen;

    ${M||L?k.glsl`float lineDistNorm = sign(uv0.y) * pos.w;`:""}

    ${L?k.glsl`vLineDistance = lineWidth * lineDistNorm;`:""}
    ${M?k.glsl`vLineDistanceNorm = lineDistNorm;`:""}

    pos.xy += dpos;
  `);G&&E.code.add(k.glsl`vec2 segmentDir = normalize(segment);
vSegmentSDF = (isJoin && isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentOrigin, segmentDir) * pos.w) ;
vReverseSegmentSDF = (isJoin && !isStartVertex) ? LARGE_HALF_FLOAT : (dot(pos.xy - segmentEnd, -segmentDir) * pos.w);`);B.stippleEnabled&&(B.draped?E.uniforms.add(new q.FloatPassUniform("worldToScreenRatio",(J,I)=>1/I.screenToPCSRatio)):E.code.add(k.glsl`vec3 segmentCenter = mix((auxpos2 + position) * 0.5, (position + auxpos1) * 0.5, isEndVertex);
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),E.code.add(k.glsl`float segmentLengthScreenDouble = length(segment);
float segmentLengthScreen = segmentLengthScreenDouble * 0.5;
float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);
float segmentLengthRender = length(mix(auxpos2 - position, position - auxpos1, isEndVertex));
vStipplePatternStretch = worldToScreenRatio / discreteWorldToScreenRatio;`),B.draped?E.code.add(k.glsl`float segmentLengthPseudoScreen = segmentLengthScreen / pixelRatio * discreteWorldToScreenRatio / worldToScreenRatio;
float startPseudoScreen = uv0.x * discreteWorldToScreenRatio - mix(0.0, segmentLengthPseudoScreen, isEndVertex);`):E.code.add(k.glsl`float startPseudoScreen = mix(uv0.x, uv0.x - segmentLengthRender, isEndVertex) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),E.code.add(k.glsl`
      float patternLength = ${B.stippleScaleWithLineWidth?"lineSize * ":""} stipplePatternPixelSize;

      // Compute the coordinates at both start and end of the line segment, because we need both to clamp to in the fragment shader
      vStippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, segmentLengthScreen, patternLength);

      vStippleDistance = mix(vStippleDistanceLimits.x, vStippleDistanceLimits.y, isEndVertex);

      // Adjust the coordinate to the displaced position (the pattern is shortened/overextended on the in/outside of joins)
      if (segmentLengthScreenDouble >= 0.001) {
        // Project the actual vertex position onto the line segment. Note that the resulting factor is within [0..1] at the
        // original vertex positions, and slightly outside of that range at the displaced positions
        vec2 stippleDisplacement = pos.xy - segmentOrigin;
        float stippleDisplacementFactor = dot(segment, stippleDisplacement) / (segmentLengthScreenDouble * segmentLengthScreenDouble);

        // Apply this offset to the actual vertex coordinate (can be screen or pseudo-screen space)
        vStippleDistance += (stippleDisplacementFactor - isEndVertex) * (vStippleDistanceLimits.y - vStippleDistanceLimits.x);
      }

      // Cancel out perspective correct interpolation because we want this length the really represent the screen distance
      vStippleDistanceLimits *= pos.w;
      vStippleDistance *= pos.w;

      // Disable stipple distance limits on caps
      vStippleDistanceLimits = isJoin ?
                                 vStippleDistanceLimits :
                                 isStartVertex ?
                                  vec2(-1e038, vStippleDistanceLimits.y) :
                                  vec2(vStippleDistanceLimits.x, 1e038);
    `));E.code.add(k.glsl`
      // Convert back into NDC
      pos.xy = (pos.xy / viewport.zw) * pos.w;

      vColor = getColor();
      vColor.a *= coverage;

      ${B.wireframe&&!B.draped?"pos.z -\x3d 0.001 * pos.w;":""}

      // transform final position to camera space for slicing
      vpos = (inverseProjectionMatrix * pos).xyz;
      gl_Position = pos;
    }
  }
  `);D&&C.include(m.multipassTerrainTest,B);C.include(n.SliceDraw,B);F.include(e.ColorConversion);F.code.add(k.glsl`
  void main() {
    discardBySlice(vpos);
    ${D?"terrainDepthTest(gl_FragCoord, depth);":""}
  `);B.wireframe?F.code.add(k.glsl`vec4 finalColor = vec4(1.0, 0.0, 1.0, 1.0);`):(G&&F.code.add(k.glsl`
      float sdf = min(vSegmentSDF, vReverseSegmentSDF);
      vec2 fragmentPosition = vec2(
        min(sdf, 0.0),
        vLineDistance
      ) * gl_FragCoord.w;

      float fragmentRadius = length(fragmentPosition);
      float fragmentCapSDF = (fragmentRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float capCoverage = clamp(0.5 - fragmentCapSDF, 0.0, 1.0);

      if (capCoverage < ${k.glsl.float(d.symbolAlphaCutoff)}) {
        discard;
      }
    `),R?F.code.add(k.glsl`
      vec2 stipplePosition = vec2(
        min(getStippleSDF() * 2.0 - 1.0, 0.0),
        vLineDistanceNorm * gl_FragCoord.w
      );
      float stippleRadius = length(stipplePosition * vLineWidth);
      float stippleCapSDF = (stippleRadius - vLineWidth) * 0.5; // Divide by 2 to transform from double pixel scale
      float stippleCoverage = clamp(0.5 - stippleCapSDF, 0.0, 1.0);
      float stippleAlpha = step(${k.glsl.float(d.symbolAlphaCutoff)}, stippleCoverage);
      `):F.code.add(k.glsl`float stippleAlpha = getStippleAlpha();`),F.uniforms.add(new t.Float4PassUniform("intrinsicColor",J=>J.color)),F.code.add(k.glsl`discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);
vec4 color = intrinsicColor * vColor;`),B.innerColorEnabled&&(F.uniforms.add(new t.Float4PassUniform("innerColor",J=>b.unwrapOr(J.innerColor,J.color))),F.uniforms.add(new q.FloatPassUniform("innerWidth",(J,I)=>J.innerWidth*I.camera.pixelRatio)),F.code.add(k.glsl`float distToInner = abs(vLineDistance * gl_FragCoord.w) - innerWidth;
float innerAA = clamp(0.5 - distToInner, 0.0, 1.0);
float innerAlpha = innerColor.a + color.a * (1.0 - innerColor.a);
color = mix(color, vec4(innerColor.rgb, innerAlpha), innerAA);`)),F.code.add(k.glsl`vec4 finalColor = blendStipple(color, stippleAlpha);`),B.falloffEnabled&&(F.uniforms.add(new q.FloatPassUniform("falloff",J=>J.falloff)),F.code.add(k.glsl`finalColor.a *= pow(max(0.0, 1.0 - abs(vLineDistanceNorm * gl_FragCoord.w)), falloff);`)));F.code.add(k.glsl`
    if (finalColor.a < ${k.glsl.float(d.symbolAlphaCutoff)}) {
      discard;
    }

    ${B.output===c.ShaderOutput.Alpha?k.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${B.output===c.ShaderOutput.Color?k.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${B.output===c.ShaderOutput.Color&&B.transparencyPassType===f.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${B.output===c.ShaderOutput.Highlight?k.glsl`gl_FragColor = vec4(1.0);`:""}
    ${B.output===c.ShaderOutput.Depth?k.glsl`outputDepth(linearDepth);`:""}
  }
  `);return C}const x=Object.freeze(Object.defineProperty({__proto__:null,NUM_ROUND_JOIN_SUBDIVISIONS:1,build:A},Symbol.toStringTag,{value:"Module"}));a.NUM_ROUND_JOIN_SUBDIVISIONS=1;a.RibbonLine=x;a.build=A})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl":function(){define("exports ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,n,l,u,v,m){a.RibbonVertexPosition=function(h,d){const e=h.vertex;e.uniforms.add(new n.FloatPassUniform("intrinsicWidth",g=>g.width));d.vvSize?(h.attributes.add(v.VertexAttribute.SIZEFEATUREATTRIBUTE,"float"),e.uniforms.add(new b.Float3PassUniform("vvSizeMinSize",g=>g.vvSizeMinSize)),e.uniforms.add(new b.Float3PassUniform("vvSizeMaxSize",g=>g.vvSizeMaxSize)),e.uniforms.add(new b.Float3PassUniform("vvSizeOffset",g=>g.vvSizeOffset)),e.uniforms.add(new b.Float3PassUniform("vvSizeFactor",
g=>g.vvSizeFactor)),e.code.add(u.glsl`float getSize() {
return intrinsicWidth * clamp(vvSizeOffset + sizeFeatureAttribute * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).x;
}`)):(h.attributes.add(v.VertexAttribute.SIZE,"float"),e.code.add(u.glsl`float getSize(){
return intrinsicWidth * size;
}`));d.vvOpacity?(h.attributes.add(v.VertexAttribute.OPACITYFEATUREATTRIBUTE,"float"),e.constants.add("vvOpacityNumber","int",8),e.uniforms.add([new l.FloatsPassUniform("vvOpacityValues",g=>g.vvOpacityValues,8),new l.FloatsPassUniform("vvOpacityOpacities",g=>g.vvOpacityOpacities,8)]),e.code.add(u.glsl`float interpolateOpacity( float value ){
if (value <= vvOpacityValues[0]) {
return vvOpacityOpacities[0];
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f);
}
}
return vvOpacityOpacities[vvOpacityNumber - 1];
}
vec4 applyOpacity( vec4 color ){
return vec4(color.xyz, interpolateOpacity(opacityFeatureAttribute));
}`)):e.code.add(u.glsl`vec4 applyOpacity( vec4 color ){
return color;
}`);d.vvColor?(h.attributes.add(v.VertexAttribute.COLORFEATUREATTRIBUTE,"float"),e.constants.add("vvColorNumber","int",m.vvColorNumber),e.uniforms.add(new l.FloatsPassUniform("vvColorValues",g=>g.vvColorValues,m.vvColorNumber)),e.uniforms.add(new c.Float4sPassUniform("vvColorColors",g=>g.vvColorColors,m.vvColorNumber)),e.code.add(u.glsl`vec4 interpolateColor( float value ) {
if (value <= vvColorValues[0]) {
return vvColorColors[0];
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return mix(vvColorColors[i-1], vvColorColors[i], f);
}
}
return vvColorColors[vvColorNumber - 1];
}
vec4 getColor(){
return applyOpacity(interpolateColor(colorFeatureAttribute));
}`)):(h.attributes.add(v.VertexAttribute.COLOR,"vec4"),e.code.add(u.glsl`vec4 getColor(){
return applyOpacity(color);
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl":function(){define(["exports","../ShaderOutputOptions","../util/RgbaFloatEncoding.glsl","../../shaderModules/interfaces"],function(a,b,c,n){a.OutputDepth=function(l,u){l.fragment.include(c.RgbaFloatEncoding);u.output===b.ShaderOutput.Shadow?(l.extensions.add("GL_OES_standard_derivatives"),l.fragment.code.add(n.glsl`float _calculateFragDepth(const in float depth) {
const float SLOPE_SCALE = 2.0;
const float BIAS = 2.0 * .000015259;
float m = max(abs(dFdx(depth)), abs(dFdy(depth)));
float result = depth + SLOPE_SCALE * m + BIAS;
return clamp(result, .0, .999999);
}
void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_calculateFragDepth(_linearDepth));
}`)):u.output===b.ShaderOutput.Depth&&l.fragment.code.add(n.glsl`void outputDepth(float _linearDepth) {
gl_FragColor = float2rgba(_linearDepth);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl":function(){define("exports ../util/RgbaFloatEncoding.glsl ../util/View.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/FloatUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DUniform ../../../shaders/ensureColor4".split(" "),function(a,b,c,n,l,u,v,m,h){function d(g,
p){const t=!(p.draped&&p.stipplePreferContinuous),{vertex:q,fragment:k}=g;k.include(b.RgbaFloatEncoding);q.uniforms.add(new u.FloatUniform("stipplePatternPixelSize"));p.draped||(c.addCameraPosition(q,p),q.uniforms.add(new l.FloatPassUniform("worldToScreenPerDistanceRatio",(r,y)=>1/y.camera.perScreenPixelRatio)),q.code.add(v.glsl`float computeWorldToScreenRatio(vec3 segmentCenter) {
float segmentDistanceToCamera = length(segmentCenter - cameraPosition);
return worldToScreenPerDistanceRatio / segmentDistanceToCamera;
}`));g.varyings.add("vStippleDistance","float");p.stippleRequiresClamp&&g.varyings.add("vStippleDistanceLimits","vec2");p.stippleRequiresStretchMeasure&&g.varyings.add("vStipplePatternStretch","float");q.code.add(v.glsl`
    float discretizeWorldToScreenRatio(float worldToScreenRatio) {
      float step = ${e};

      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);
      return discreteWorldToScreenRatio;
    }
  `);q.code.add(v.glsl`vec2 computeStippleDistanceLimits(float startPseudoScreen, float segmentLengthPseudoScreen, float segmentLengthScreen, float patternLength) {`);q.code.add(v.glsl`
    if (segmentLengthPseudoScreen >= ${t?"patternLength":"1e4"}) {
  `);q.uniforms.add(new l.FloatPassUniform("pixelRatio",(r,y)=>y.camera.pixelRatio));q.code.add(v.glsl`
        // Round the screen length to get an integer number of pattern repetitions (minimum 1).
        float repetitions = segmentLengthScreen / (patternLength * pixelRatio);
        float flooredRepetitions = max(1.0, floor(repetitions + 0.5));
        float segmentLengthScreenRounded = flooredRepetitions * patternLength;

        ${p.stippleRequiresStretchMeasure?v.glsl`
              float stretch = repetitions / flooredRepetitions;

              // We need to impose a lower bound on the stretch factor to prevent the dots from merging together when there is only 1 repetition.
              // 0.75 is the lowest possible stretch value for flooredRepetitions > 1, so it makes sense as lower bound.
              vStipplePatternStretch = max(0.75, stretch);`:""}

        return vec2(0.0, segmentLengthScreenRounded);
      }
      return vec2(startPseudoScreen, startPseudoScreen + segmentLengthPseudoScreen);
    }
  `);k.uniforms.add(new m.Texture2DUniform("stipplePatternTexture"));k.uniforms.add(new u.FloatUniform("stipplePatternSDFNormalizer"));k.uniforms.add(new u.FloatUniform("stipplePatternTextureSize"));k.uniforms.add(new u.FloatUniform("stipplePatternPixelSizeInv"));k.code.add(v.glsl`float padTexture(float u) {
return (u * stipplePatternTextureSize + 1.0)/(stipplePatternTextureSize + 2.0);
}`);k.code.add(v.glsl`
    float getStippleSDF(out bool isClamped) {
      ${p.stippleRequiresClamp?v.glsl`
          float stippleDistanceClamped = clamp(vStippleDistance, vStippleDistanceLimits.x, vStippleDistanceLimits.y);
          vec2 aaCorrectedLimits = vStippleDistanceLimits + vec2(1.0, -1.0) / gl_FragCoord.w;
          isClamped = vStippleDistance < aaCorrectedLimits.x || vStippleDistance > aaCorrectedLimits.y;`:v.glsl`
          float stippleDistanceClamped = vStippleDistance;
          isClamped = false;`}

      float u = stippleDistanceClamped * gl_FragCoord.w * stipplePatternPixelSizeInv;
      ${p.stippleScaleWithLineWidth?v.glsl`u *= vLineSizeInv;`:""}
      u = padTexture(fract(u));

      float encodedSDF = rgba2float(texture2D(stipplePatternTexture, vec2(u, 0.5)));
      float sdf = (encodedSDF * 2.0 - 1.0) * stipplePatternSDFNormalizer;

      ${p.stippleRequiresStretchMeasure?v.glsl`return (sdf - 0.5) * vStipplePatternStretch + 0.5;`:v.glsl`return sdf;`}
    }

    float getStippleSDF() {
      bool ignored;
      return getStippleSDF(ignored);
    }

    float getStippleAlpha() {
      bool isClamped;
      float stippleSDF = getStippleSDF(isClamped);

      float antiAliasedResult = ${p.stippleScaleWithLineWidth?v.glsl`clamp(stippleSDF * vLineWidth + 0.5, 0.0, 1.0);`:v.glsl`clamp(stippleSDF + 0.5, 0.0, 1.0);`}

      return isClamped ? floor(antiAliasedResult + 0.5) : antiAliasedResult;
    }
  `);p.stippleOffColorEnabled?(k.uniforms.add(new n.Float4PassUniform("stippleOffColor",r=>h.ensureColor4(r.stippleOffColor))),k.code.add(v.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) {}
#define blendStipple(color, stippleAlpha) mix(color, stippleOffColor, stippleAlpha)`)):k.code.add(v.glsl`#define discardByStippleAlpha(stippleAlpha, threshold) if (stippleAlpha < threshold) { discard; }
#define blendStipple(color, stippleAlpha) vec4(color.rgb, color.a * stippleAlpha)`)}const e=v.glsl.float(.4);a.LineStipple=function(g,p){g.constants.add("stippleAlphaColorDiscard","float",.001);g.constants.add("stippleAlphaHighlightDiscard","float",.5);p.stippleEnabled?d(g,p):g.fragment.code.add(v.glsl`float getStippleAlpha() { return 1.0; }
#define discardByStippleAlpha(_stippleAlpha_, _threshold_) {}
#define blendStipple(color, _stippleAlpha_) color`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ensureColor4":function(){define(["exports","../../../../core/maybe","../../../../chunks/vec4","../../../../chunks/vec4f64"],function(a,b,c,n){const l=n.create();a.ensureColor4=function(u){return b.isNone(u)?n.ZEROS:4===u.length?u:c.set(l,u[0],u[1],u[2],1)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/shaders/RibbonLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,n,l,u,v){a.CapType=void 0;(function(m){m[m.BUTT=0]="BUTT";m[m.SQUARE=1]="SQUARE";m[m.ROUND=2]="ROUND";m[m.COUNT=3]="COUNT"})(a.CapType||(a.CapType=
{}));v=function(m){function h(){var d=m.apply(this,arguments)||this;d.output=n.ShaderOutput.Color;d.capType=a.CapType.BUTT;d.transparencyPassType=u.TransparencyPassType.NONE;d.occluder=!1;d.hasSlicePlane=!1;d.hasPolygonOffset=!1;d.writeDepth=!1;d.draped=!1;d.stippleEnabled=!1;d.stippleOffColorEnabled=!1;d.stippleScaleWithLineWidth=!1;d.stipplePreferContinuous=!0;d.roundJoins=!1;d.vvSize=!1;d.vvColor=!1;d.vvOpacity=!1;d.falloffEnabled=!1;d.innerColorEnabled=!1;d.hasOccludees=!1;d.hasMultipassTerrain=
!1;d.cullAboveGround=!1;d.wireframe=!1;return d}b._inheritsLoose(h,m);return h}(v.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:n.ShaderOutput.COUNT})],v.prototype,"output",void 0);c.__decorate([l.parameter({count:a.CapType.COUNT})],v.prototype,"capType",void 0);c.__decorate([l.parameter({count:u.TransparencyPassType.COUNT})],v.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter()],v.prototype,"occluder",void 0);c.__decorate([l.parameter()],v.prototype,"hasSlicePlane",
void 0);c.__decorate([l.parameter()],v.prototype,"hasPolygonOffset",void 0);c.__decorate([l.parameter()],v.prototype,"writeDepth",void 0);c.__decorate([l.parameter()],v.prototype,"draped",void 0);c.__decorate([l.parameter()],v.prototype,"stippleEnabled",void 0);c.__decorate([l.parameter()],v.prototype,"stippleOffColorEnabled",void 0);c.__decorate([l.parameter()],v.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([l.parameter()],v.prototype,"stipplePreferContinuous",void 0);c.__decorate([l.parameter()],
v.prototype,"roundJoins",void 0);c.__decorate([l.parameter()],v.prototype,"vvSize",void 0);c.__decorate([l.parameter()],v.prototype,"vvColor",void 0);c.__decorate([l.parameter()],v.prototype,"vvOpacity",void 0);c.__decorate([l.parameter()],v.prototype,"falloffEnabled",void 0);c.__decorate([l.parameter()],v.prototype,"innerColorEnabled",void 0);c.__decorate([l.parameter()],v.prototype,"hasOccludees",void 0);c.__decorate([l.parameter()],v.prototype,"hasMultipassTerrain",void 0);c.__decorate([l.parameter()],
v.prototype,"cullAboveGround",void 0);c.__decorate([l.parameter()],v.prototype,"wireframe",void 0);c.__decorate([l.parameter({constValue:!0})],v.prototype,"stippleRequiresClamp",void 0);c.__decorate([l.parameter({constValue:!0})],v.prototype,"stippleRequiresStretchMeasure",void 0);c.__decorate([l.parameter({constValue:!0})],v.prototype,"hasVvInstancing",void 0);c.__decorate([l.parameter({constValue:!0})],v.prototype,"hasSliceTranslatedView",void 0);a.RibbonLineTechniqueConfiguration=v;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/RibbonLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/RibbonLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){const r=new Map([[p.VertexAttribute.POSITION,0],[p.VertexAttribute.SUBDIVISIONFACTOR,1],[p.VertexAttribute.UV0,2],[p.VertexAttribute.AUXPOS1,3],[p.VertexAttribute.AUXPOS2,4],[p.VertexAttribute.COLOR,5],[p.VertexAttribute.COLORFEATUREATTRIBUTE,5],[p.VertexAttribute.SIZE,6],[p.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[p.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);v=function(f){function w(A,x,B){x=f.call(this,A,x,B)||this;x.stippleTextureRepository=A.stippleTextureRepository;
return x}c._inheritsLoose(w,f);var z=w.prototype;z.initializeProgram=function(A){const x=w.shader.get().build(this.configuration);return new d.Program(A.rctx,x,r)};z.destroy=function(){f.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=this.stipplePattern=null};z.bindPass=function(A,x){this.program.bindPass(A,x);this.stipplePattern!==A.stipplePattern&&(A=A.stipplePattern,this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,
A),this.stipplePattern=A);if(this.configuration.stippleEnabled){const {pixelSize:B,sdfNormalizer:C,pixels:D}=n.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",C);this.program.setUniform1f("stipplePatternTextureSize",D);this.program.setUniform1f("stipplePatternPixelSize",B);this.program.setUniform1f("stipplePatternPixelSizeInv",1/B)}};z._makePipelineState=function(A,x){const B=this.configuration,
C=A===m.TransparencyPassType.NONE,D=A===m.TransparencyPassType.FrontFace;return k.makePipelineState({blending:B.output===l.ShaderOutput.Color||B.output===l.ShaderOutput.Alpha?C?h.blendingDefault:h.oitBlending(A):null,depthTest:{func:h.oitDepthTest(A)},depthWrite:C?B.writeDepth&&k.defaultDepthWriteParams:h.oitDepthWrite(A),colorWrite:k.defaultColorWriteParams,stencilWrite:B.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:B.hasOccludees?x?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:null,
polygonOffset:C||D?B.hasPolygonOffset&&y:h.OITPolygonOffset})};z.initializePipeline=function(){var A=this.configuration;A.occluder&&(A=A.hasPolygonOffset&&y,this._occluderPipelineTransparent=k.makePipelineState({blending:h.blendingDefault,polygonOffset:A,depthTest:g.depthCompareAlways,depthWrite:null,colorWrite:k.defaultColorWriteParams,stencilWrite:null,stencilTest:g.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=k.makePipelineState({blending:h.blendingDefault,polygonOffset:A,
depthTest:g.depthCompareAlways,depthWrite:null,colorWrite:k.defaultColorWriteParams,stencilWrite:g.stencilWriteMaskOff,stencilTest:g.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=k.makePipelineState({blending:null,polygonOffset:A,depthTest:g.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:g.stencilWriteMaskOn,stencilTest:g.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};z.getPipelineState=function(A,x){return x?this._occludeePipelineState:this.configuration.occluder?A===e.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:A===e.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:f.prototype.getPipelineState.call(this,A,x)};c._createClass(w,[{key:"primitiveType",get:function(){return this.configuration.wireframe?q.PrimitiveType.LINES:q.PrimitiveType.TRIANGLE_STRIP}}]);return w}(v.ShaderTechnique);
v.shader=new u.ReloadableShaderModule(t.RibbonLine,()=>new Promise((f,w)=>a(["./RibbonLine.glsl"],f,w)));const y={factor:0,units:-4};b.RibbonLineTechnique=v;b.ribbonVertexAttributeLocations=r;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/StencilUtils":function(){define(["exports","./basicInterfaces","../../../webgl/enums"],function(a,b,c){const n={func:c.CompareFunction.LESS},l={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,
mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.ZERO}},u={function:{func:c.CompareFunction.ALWAYS,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}},v={function:{func:c.CompareFunction.EQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},
operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};b={function:{func:c.CompareFunction.NOTEQUAL,ref:b.StencilBits.OutlineVisualElementMask,mask:b.StencilBits.OutlineVisualElementMask},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}};a.depthCompareAlways={func:c.CompareFunction.ALWAYS};a.depthCompareLess=n;a.renderWhenBitIsNotSet=m=>({function:{func:c.CompareFunction.NOTEQUAL,ref:m,mask:m},operation:{fail:c.StencilOperation.KEEP,
zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.KEEP}});a.replaceBitWhenDepthTestPasses=m=>({function:{func:c.CompareFunction.ALWAYS,ref:m,mask:m},operation:{fail:c.StencilOperation.KEEP,zFail:c.StencilOperation.KEEP,zPass:c.StencilOperation.REPLACE}});a.stencilBaseAllZerosParams=l;a.stencilToolMaskBaseParams=u;a.stencilToolMaskOccluderParams=v;a.stencilToolTransparentOccluderParams=b;a.stencilWriteMaskOff={mask:0};a.stencilWriteMaskOn={mask:255};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderContext":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./BindParameters ./Camera ./Material ./RenderPass".split(" "),function(a,b,c,n,l,u,v){let m=function(){function e(g,p,t,q=null){this.rctx=g;this.sliceHelper=q;this.lastFrameCamera=new l.Camera;this.pass=v.RenderPass.MATERIAL;this.renderOccludedMask=d;this.bindParameters=new n.BindParameters(p,t,c.isSome(q)?q.plane:
null)}e.prototype.resetRenderOccludedMask=function(){this.renderOccludedMask=d};b._createClass(e,[{key:"isHighlightPass",get:function(){return this.pass===v.RenderPass.MATERIAL_HIGHLIGHT}}]);return e}(),h=function(e){function g(p,t,q,k,r){p=e.call(this,p,q,k,r)||this;p.offscreenRenderingHelper=t;p.sliceHelper=r;return p}b._inheritsLoose(g,e);return g}(m);const d=u.RenderOccludedFlag.Occlude|u.RenderOccludedFlag.OccludeAndTransparent|u.RenderOccludedFlag.OccludeAndTransparentStencil;a.OverlayRenderContext=
m;a.RenderContext=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowMap":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../ViewingMode ./Camera ./Util ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){function z(ca,Y){m.set(ka,ca[Y],ca[Y+3]);return ka}a.SnapshotSlot=void 0;(function(ca){ca[ca.Highlight=0]="Highlight";ca[ca.Default=1]="Default"})(a.SnapshotSlot||(a.SnapshotSlot={}));let A=function(){this.camera=new q.Camera;this.lightMat=v.create()},x=function(){function ca(da,ha,ja=0){this.rctx=da;this.viewingMode=ha;this._enabled=!1;this._snapshots=[];this.maxTextureSize=this._textureSize=0;this.numCascades=1;this.maxNumCascades=4;this.splitSchemeLambda=
0;this.warp=!0;this._cascadeDistances=[0,0,0,0,0];this._usedCascadeDistances=p.create();this._cascades=[new A,new A,new A,new A];this.maxTextureSize=this.rctx.parameters.maxTextureSize;this.snapshotCount=ja}var Y=ca.prototype;Y.dispose=function(){this._discardDepthTexture();this._discardAllSnapshots()};Y.getSnapshot=function(da){return this.enabled?this._snapshots[da]:null};Y.getCascades=function(){for(let da=0;da<this.numCascades;++da)N[da]=this._cascades[da];N.length=this.numCascades;return N};
Y.start=function(da,ha,ja){k.assert(this.enabled);this._textureSize=this._computeTextureSize(da.fullWidth,da.fullHeight);this._ensureDepthTexture();const {near:ma,far:pa}=this._clampNearFar(ja);this._computeCascadeDistances(pa,ma);this._setupMatrices(da,ha);ja=da.viewMatrix;da=da.projectionMatrix;for(let na=0;na<this.numCascades;++na)this._constructCascade(na,da,ja,ha);this.lastOrigin=null;this.clear()};Y.finish=function(da){k.assert(this.enabled);this.rctx.bindFramebuffer(da)};Y.getShadowMapMatrices=
function(da){if(!this.lastOrigin||!d.exactEquals(da,this.lastOrigin)){this.lastOrigin=this.lastOrigin||e.create();d.copy(this.lastOrigin,da);for(let ha=0;ha<this.numCascades;++ha){u.translate(V,this._cascades[ha].lightMat,da);for(let ja=0;16>ja;++ja)S[16*ha+ja]=V[ja]}}return S};Y.takeCascadeSnapshotTo=function(da,ha){k.assert(this.enabled);var ja=this._ensureSnapshot(ha);this._bindFbo();ha=this.rctx;ja=ha.bindTexture(ja,f.Texture.TEXTURE_UNIT_FOR_UPDATES);ha.gl.copyTexSubImage2D(r.TextureType.TEXTURE_2D,
0,da.camera.viewport[0],da.camera.viewport[1],da.camera.viewport[0],da.camera.viewport[1],da.camera.viewport[2],da.camera.viewport[3]);ha.bindTexture(ja,f.Texture.TEXTURE_UNIT_FOR_UPDATES)};Y.clear=function(){const da=this.rctx;this._bindFbo();da.setClearColor(1,1,1,1);da.clearSafe(r.ClearBufferBit.COLOR_BUFFER_BIT|r.ClearBufferBit.DEPTH_BUFFER_BIT)};Y._computeTextureSize=function(da,ha){return Math.min(this.maxTextureSize,2*2**Math.round(.5*Math.log(da*da+ha*ha)*Math.LOG2E+.35))};Y._ensureDepthTexture=
function(){n.isSome(this._depthTexture)&&this._depthTexture.descriptor.width===this._textureSize||(this._discardDepthTexture(),this._depthTexture=new f.Texture(this.rctx,{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:r.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize}),this._fbo=new y.FramebufferObject(this.rctx,{colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.DEPTH_RENDER_BUFFER,
width:this._textureSize,height:this._textureSize},this._depthTexture))};Y._ensureSnapshot=function(da){let ha=this._snapshots[da];if(n.isSome(ha)&&ha.descriptor.width===this._textureSize)return ha;this._discardSnapshot(da);ha=new f.Texture(this.rctx,{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:r.TextureSamplingMode.NEAREST,flipped:!0,width:this._textureSize,height:this._textureSize});return this._snapshots[da]=
ha};Y._discardDepthTexture=function(){this._fbo=n.disposeMaybe(this._fbo);this._depthTexture=n.disposeMaybe(this._depthTexture)};Y._discardSnapshot=function(da){this._snapshots[da]=n.disposeMaybe(this._snapshots[da])};Y._discardAllSnapshots=function(){for(let da=0;da<this.snapshotCount;++da)this._discardSnapshot(da)};Y._bindFbo=function(){const da=this.rctx;da.unbindTexture(this._depthTexture);da.bindFramebuffer(this._fbo)};Y._constructCascade=function(da,ha,ja,ma){const pa=this._cascades[da];var na=
-this._cascadeDistances[da],wa=-this._cascadeDistances[da+1];na=(ha[10]*na+ha[14])/Math.abs(ha[11]*na+ha[15]);ha=(ha[10]*wa+ha[14])/Math.abs(ha[11]*wa+ha[15]);k.assert(na<ha);for(wa=0;8>wa;++wa){g.set(E,0===wa%4||3===wa%4?-1:1,0===wa%4||1===wa%4?-1:1,4>wa?na:ha,1);g.transformMat4(F[wa],E,D);for(let xa=0;3>xa;++xa)F[wa][xa]/=F[wa][3]}d.negate(P,F[0]);u.translate(B,I,P);pa.camera.viewMatrix=B;for(na=0;8>na;++na)d.transformMat4(F[na],F[na],pa.camera.viewMatrix);d.copy(G,F[0]);d.copy(O,F[0]);for(na=1;8>
na;++na)for(ha=0;3>ha;++ha)G[ha]=Math.min(G[ha],F[na][ha]),O[ha]=Math.max(O[ha],F[na][ha]);G[2]-=200;O[2]+=200;pa.camera.near=-O[2];pa.camera.far=-G[2];this.warp?this._constructTrapezoidalProjection(ja,ma,pa):this._constructOrthogonalProjection(pa);u.multiply(pa.lightMat,pa.camera.projectionMatrix,pa.camera.viewMatrix);ja=this._textureSize/2;pa.camera.viewport[0]=0===da%2?0:ja;pa.camera.viewport[1]=0===Math.floor(da/2)?0:ja;pa.camera.viewport[2]=ja;pa.camera.viewport[3]=ja};Y._constructOrthogonalProjection=
function(da){u.ortho(da.camera.projectionMatrix,G[0],O[0],G[1],O[1],da.camera.near,da.camera.far)};Y._constructTrapezoidalProjection=function(da,ha,ja){var ma=1/F[0][3],pa=1/F[4][3];k.assert(ma<pa);ma+=Math.sqrt(ma*pa);var na=Math.sin(c.acosClamped(da[2]*ha[0]+da[6]*ha[1]+da[10]*ha[2]));da=F;var wa=ma/na;ha=K;var xa=L,sa=R;pa=M;ma=J;m.set(T,0,0);for(var ya=0;4>ya;++ya)m.add(T,T,da[ya]);m.scale(T,T,.25);m.set(H,0,0);for(ya=4;8>ya;++ya)m.add(H,H,da[ya]);m.scale(H,H,.25);m.lerp(U[0],da[4],da[5],.5);
m.lerp(U[1],da[5],da[6],.5);m.lerp(U[2],da[6],da[7],.5);m.lerp(U[3],da[7],da[4],.5);ya=0;var ra=m.squaredDistance(U[0],T);for(var ua=1;4>ua;++ua){var Ba=m.squaredDistance(U[ua],T);Ba<ra&&(ra=Ba,ya=ua)}m.subtract(W,U[ya],da[ya+4]);ya=W[0];W[0]=-W[1];W[1]=ya;m.subtract(Q,H,T);0>m.dot(Q,W)&&m.negate(W,W);m.lerp(W,W,Q,na);m.normalize(W,W);na=ya=m.dot(m.subtract(X,da[0],T),W);for(ra=1;8>ra;++ra)ua=m.dot(m.subtract(X,da[ra],T),W),ua<na?na=ua:ua>ya&&(ya=ua);m.copy(ha,T);m.scale(X,W,na-wa);m.add(ha,ha,X);
ua=-1;Ba=1;wa=ra=0;for(let Ea=0;8>Ea;++Ea){m.subtract(ba,da[Ea],ha);m.normalize(ba,ba);const Ja=W[0]*ba[1]-W[1]*ba[0];0<Ja?Ja>ua&&(ua=Ja,ra=Ea):Ja<Ba&&(Ba=Ja,wa=Ea)}k.verify(0<ua,"leftArea");k.verify(0>Ba,"rightArea");m.scale(aa,W,na);m.add(aa,aa,T);m.scale(ea,W,ya);m.add(ea,ea,T);ia[0]=-W[1];ia[1]=W[0];xa=k.rayRay2D(ha,da[wa],ea,m.add(X,ea,ia),1,xa);sa=k.rayRay2D(ha,da[ra],ea,X,1,sa);pa=k.rayRay2D(ha,da[ra],aa,m.add(X,aa,ia),1,pa);da=k.rayRay2D(ha,da[wa],aa,X,1,ma);k.verify(xa,"rayRay");k.verify(sa,
"rayRay");k.verify(pa,"rayRay");k.verify(da,"rayRay");sa=K;da=L;ha=M;pa=J;ma=ja.camera.projectionMatrix;m.subtract(la,ha,pa);m.scale(la,la,.5);Z[0]=la[0];Z[1]=la[1];Z[2]=0;Z[3]=la[1];Z[4]=-la[0];Z[5]=0;Z[6]=la[0]*la[0]+la[1]*la[1];Z[7]=la[0]*la[1]-la[1]*la[0];Z[8]=1;Z[6]=-m.dot(z(Z,0),sa);Z[7]=-m.dot(z(Z,1),sa);sa=m.dot(z(Z,0),ha)+Z[6];xa=m.dot(z(Z,1),ha)+Z[7];wa=m.dot(z(Z,0),pa)+Z[6];pa=m.dot(z(Z,1),pa)+Z[7];sa=-(sa+wa)/(xa+pa);Z[0]+=Z[1]*sa;Z[3]+=Z[4]*sa;Z[6]+=Z[7]*sa;sa=1/(m.dot(z(Z,0),ha)+Z[6]);
xa=1/(m.dot(z(Z,1),ha)+Z[7]);Z[0]*=sa;Z[3]*=sa;Z[6]*=sa;Z[1]*=xa;Z[4]*=xa;Z[7]*=xa;Z[2]=Z[1];Z[5]=Z[4];Z[8]=Z[7];Z[7]+=1;sa=m.dot(z(Z,1),da)+Z[7];xa=m.dot(z(Z,2),da)+Z[8];wa=m.dot(z(Z,1),ha)+Z[7];pa=m.dot(z(Z,2),ha)+Z[8];sa=-.5*(sa/xa+wa/pa);Z[1]+=Z[2]*sa;Z[4]+=Z[5]*sa;Z[7]+=Z[8]*sa;sa=m.dot(z(Z,1),da)+Z[7];xa=m.dot(z(Z,2),da)+Z[8];wa=-xa/sa;Z[1]*=wa;Z[4]*=wa;Z[7]*=wa;ma[0]=Z[0];ma[1]=Z[1];ma[2]=0;ma[3]=Z[2];ma[4]=Z[3];ma[5]=Z[4];ma[6]=0;ma[7]=Z[5];ma[8]=0;ma[9]=0;ma[10]=1;ma[11]=0;ma[12]=Z[6];ma[13]=
Z[7];ma[14]=0;ma[15]=Z[8];ja.camera.projectionMatrix[10]=2/(G[2]-O[2]);ja.camera.projectionMatrix[14]=-(G[2]+O[2])/(G[2]-O[2])};Y._setupMatrices=function(da,ha){u.multiply(C,da.projectionMatrix,da.viewMatrix);u.invert(D,C);da=this.viewingMode===t.ViewingMode.Global?da.eye:d.set(P,0,0,1);u.lookAt(I,[0,0,0],[-ha[0],-ha[1],-ha[2]],da)};Y._clampNearFar=function(da){let {near:ha,far:ja}=da;2>ha&&(ha=2);2>ja&&(ja=2);ha>=ja&&(ha=2,ja=4);return{near:ha,far:ja}};Y._computeCascadeDistances=function(da,ha){this.numCascades=
Math.min(1+Math.floor(k.logWithBase(da/ha,4)),this.maxNumCascades);const ja=(da-ha)/this.numCascades;da=(da/ha)**(1/this.numCascades);let ma=ha;for(let pa=0;pa<this.numCascades+1;++pa)this._cascadeDistances[pa]=c.lerp(ma,ha,this.splitSchemeLambda),ma*=da,ha+=ja};b._createClass(ca,[{key:"depthTexture",get:function(){return this._depthTexture}},{key:"textureSize",get:function(){return this._textureSize}},{key:"cascadeDistances",get:function(){return g.set(this._usedCascadeDistances,this._cascadeDistances[0],
1<this.numCascades?this._cascadeDistances[1]:Infinity,2<this.numCascades?this._cascadeDistances[2]:Infinity,3<this.numCascades?this._cascadeDistances[3]:Infinity)}},{key:"maxCascades",get:function(){return this.maxNumCascades},set:function(da){this.maxNumCascades=c.clamp(Math.floor(da),1,4)}},{key:"enabled",get:function(){return this._enabled},set:function(da){this._enabled=da;da||(this._discardDepthTexture(),this._discardAllSnapshots())}},{key:"ready",get:function(){return this._enabled&&n.isSome(this._depthTexture)}},
{key:"snapshotCount",get:function(){return this._snapshots.length},set:function(da){var ha=this._snapshots.length;if(da>ha){var ja=da-ha;this._snapshots.length=da;for(da=0;da<ja;++da)this._snapshots[ha+da]=null}else if(da<this.snapshotCount){ha-=da;for(ja=0;ja<ha;++ja)this._discardSnapshot(da+ja);this._snapshots.length=da}}},{key:"gpuMemoryUsage",get:function(){var da,ha;return this._snapshots.reduce((ja,ma)=>ja+w.getGpuMemoryUsage(ma),null!=(da=null==(ha=this._fbo)?void 0:ha.gpuMemoryUsage)?da:0)}},
{key:"test",get:function(){const da=this;return{maxNumCascades:this.maxNumCascades,cascades:this._cascades,textureSize:this._textureSize,set splitSchemeLambda(ha){da.splitSchemeLambda=ha},get splitSchemeLambda(){return da.splitSchemeLambda},set warp(ha){da.warp=ha},get warp(){return da.warp}}}}]);return ca}();const B=v.create(),C=v.create(),D=v.create(),E=p.create(),F=[];for(let ca=0;8>ca;++ca)F.push(p.create());const G=e.create(),O=e.create(),K=h.create(),L=h.create(),R=h.create(),M=h.create(),J=
h.create(),I=v.create(),P=e.create(),N=[],V=v.create(),S=new Float32Array(64),T=h.create(),H=h.create(),U=[h.create(),h.create(),h.create(),h.create()],W=h.create(),Q=h.create(),X=h.create(),ba=h.create(),aa=h.create(),ea=h.create(),ia=h.create(),ka=h.create(),la=h.create(),Z=l.create();a.ShadowMap=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SortedRenderGeometryRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/PooledArray ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ./ChangeSet ./Intersector ./IntersectorInterfaces ./ModelDirtyTypes ./rendererUtils ../materials/renderers/MergedRenderer".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){function w(B,C,D,E,F,G,O){const K={layerUid:G,graphicUid:O,triangleNr:C};C=L=>{L.set(k.IntersectorType.OVERLAY,K,B.dist,B.normal,B.transformation,D,E)};(null==F.results.min.drapedLayerOrder||D>=F.results.min.drapedLayerOrder)&&(null==F.results.min.dist||F.results.ground.dist<=F.results.min.dist)&&C(F.results.min);F.options.store!==k.StoreResults.MIN&&(null==F.results.max.drapedLayerOrder||D<F.results.max.drapedLayerOrder)&&(null==F.results.max.dist||
F.results.ground.dist>F.results.max.dist)&&C(F.results.max);F.options.store===k.StoreResults.ALL&&(G=q.newIntersectorResult(F.ray),C(G),F.results.all.push(G))}a.SortedRenderGeometryRenderer=function(B){function C(E){E=B.call(this,E)||this;E._pending=new z;E._changes=new t.ChangeSet;E._materialRenderers=new Map;E._sortedMaterialRenderers=new v;E._geometries=new Map;E._hasHighlights=!1;E._hasWater=!1;return E}b._inheritsLoose(C,B);var D=C.prototype;D.destroy=function(){this._changes.prune();this._materialRenderers.forEach(E=>
E.dispose());this._materialRenderers.clear();this._sortedMaterialRenderers.clear();this._geometries.clear()};D.commitChanges=function(){if(!this.updating)return!1;this._processAddsRemoves();let E=!1,F=!1,G=!1;y.splitRenderGeometryChangeSetByMaterial(this._changes).forEach((O,K)=>{let L=this._materialRenderers.get(K);!L&&0<O.adds.length&&(L=new f.MergedRenderer(this.rctx,this._materialRepository,K),this._materialRenderers.set(K,L),G=F=E=!0);if(L){var R=F||L.hasHighlights,M=G||L.hasWater;L.modify(O);
F=F||R!==L.hasHighlights;G=G||M!==L.hasWater;L.isEmpty&&(this._materialRenderers.delete(K),L.dispose(),E=!0)}});this._changes.clear();E&&this._updateSortedMaterialRenderers();F&&(this._hasHighlights=l.someMap(this._materialRenderers,O=>O.hasHighlights));G&&(this._hasWater=l.someMap(this._materialRenderers,O=>O.hasWater));this.notifyChange("updating");return!0};D.addGeometries=function(E,F){if(0!==E.length){var G=this._validateRenderGeometries(E);for(var O of G)this._geometries.set(O.id,O);O=this._pending.empty;
for(const K of G)this._pending.adds.add(K);O&&this.notifyChange("updating");F===r.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(E)}};D.removeGeometries=function(E,F){const G=this._pending.empty,O=this._pending.adds;for(const K of E)O.has(K)?(this._pending.removed.add(K),O.delete(K)):this._pending.removed.has(K)||this._pending.removes.add(K),this._geometries.delete(u.unwrap(K.id));G&&!this._pending.empty&&this.notifyChange("updating");F===r.ModelDirty.Geometry.UPDATE&&this._notifyGraphicGeometryChanged(E)};
D.modifyGeometries=function(E,F){const G=0===this._changes.updates.length;for(const O of E){const K=this._changes.updates.pushNew();K.renderGeometry=this._validateRenderGeometry(O);K.updateType=F}G&&0<this._changes.updates.length&&this.notifyChange("updating");switch(F){case r.ModelDirty.State.TRANSFORMATION:case r.ModelDirty.State.VERTEXATTRS:return this._notifyGraphicGeometryChanged(E);case r.ModelDirty.State.VISIBILITIES:return this._notifyGraphicVisibilityChanged(E)}};D.updateAnimation=function(E){let F=
!1;this._sortedMaterialRenderers.forAll(({materialRenderer:G})=>F=G.updateAnimation(E)||F);return F};D.render=function(E,F){for(let G=0;G<this._sortedMaterialRenderers.length;G++){const O=this._sortedMaterialRenderers.data[G];O.material.shouldRender(E)&&O.materialRenderer.render(E.pass,F)}};D.intersect=function(E,F,G,O,K){this._geometries.forEach(L=>{if(!O||O(L)){this._intersectRenderGeometry(L,G,F,0,E,K);var R=this.rendererContext.longitudeCyclical;R&&(L.boundingSphere[0]-L.boundingSphere[3]<R.min&&
this._intersectRenderGeometry(L,G,F,R.range,E,K),L.boundingSphere[0]+L.boundingSphere[3]>R.max&&this._intersectRenderGeometry(L,G,F,-R.range,E,K));K++}});return K};D._updateSortedMaterialRenderers=function(){this._sortedMaterialRenderers.clear();let E=0;this._materialRenderers.forEach((F,G)=>{G.insertOrder=E++;this._sortedMaterialRenderers.push({material:G,materialRenderer:F})});this._sortedMaterialRenderers.sort((F,G)=>{const O=G.material.renderPriority-F.material.renderPriority;return 0!==O?O:F.material.insertOrder-
G.material.insertOrder})};D._processAddsRemoves=function(){this._changes.adds.clear();this._changes.removes.clear();this._changes.adds.pushArray(Array.from(this._pending.adds));this._changes.removes.pushArray(Array.from(this._pending.removes));for(let E=0;E<this._changes.updates.length;)this._pending.has(this._changes.updates.data[E].renderGeometry)?this._changes.updates.removeUnorderedIndex(E):E++;this._pending.clear()};D._intersectRenderGeometry=function(E,F,G,O,K,L){if(E.instanceParameters.visible){var R=
0;u.isSome(E.transformation)&&(O+=E.transformation[12],R=E.transformation[13]);A[0]=G[0]-O;A[1]=G[1]-R;A[2]=1;x[0]=G[0]-O;x[1]=G[1]-R;x[2]=0;E.screenToWorldRatio=this.rendererContext.screenToWorldRatio;E.material.intersect(E,null,E.getShaderTransformation(),K,A,x,(M,J,I)=>{w(F,I,E.material.renderPriority,L,K,E.layerUid,E.graphicUid)},E.calculateShaderTransformation,F)}};D._notifyGraphicGeometryChanged=function(E){if(!u.isNone(this.drapeSource.notifyGraphicGeometryChanged))for(const G of E)if(E=G.graphicUid,
u.isSome(E)&&E!==F){this.drapeSource.notifyGraphicGeometryChanged(E);var F=E}};D._notifyGraphicVisibilityChanged=function(E){if(!u.isNone(this.drapeSource.notifyGraphicVisibilityChanged))for(const G of E)if(E=G.graphicUid,u.isSome(E)&&E!==F){this.drapeSource.notifyGraphicVisibilityChanged(E);var F=E}};D._validateRenderGeometries=function(E){for(const F of E)this._validateRenderGeometry(F);return E};D._validateRenderGeometry=function(E){u.isNone(E.origin)&&(E.origin=this._localOriginFactory.getOrigin(E.boundingSphere));
return E};b._createClass(C,[{key:"updating",get:function(){return!this._pending.empty||0<this._changes.updates.length}},{key:"rctx",get:function(){return this.rendererContext.rctx}},{key:"_materialRepository",get:function(){return this.rendererContext.materialRepository}},{key:"_localOriginFactory",get:function(){return this.rendererContext.localOriginFactory}},{key:"hasHighlights",get:function(){return this._hasHighlights}},{key:"hasWater",get:function(){return this._hasWater}},{key:"rendersOccluded",
get:function(){return l.someMap(this._materialRenderers,E=>E.rendersOccluded)}},{key:"isEmpty",get:function(){return!this.updating&&0===this._materialRenderers.size&&0===this._geometries.size}},{key:"test",get:function(){return{sortedMaterialRenderers:this._sortedMaterialRenderers}}}]);return C}(n);c.__decorate([m.property()],a.SortedRenderGeometryRenderer.prototype,"drapeSource",void 0);c.__decorate([m.property()],a.SortedRenderGeometryRenderer.prototype,"updating",null);c.__decorate([m.property()],
a.SortedRenderGeometryRenderer.prototype,"rctx",null);c.__decorate([m.property()],a.SortedRenderGeometryRenderer.prototype,"rendererContext",void 0);c.__decorate([m.property()],a.SortedRenderGeometryRenderer.prototype,"_materialRepository",null);c.__decorate([m.property()],a.SortedRenderGeometryRenderer.prototype,"_localOriginFactory",null);a.SortedRenderGeometryRenderer=c.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SortedRenderGeometryRenderer")],a.SortedRenderGeometryRenderer);let z=
function(){function B(){this.adds=new Set;this.removes=new Set;this.removed=new Set}var C=B.prototype;C.has=function(D){return this.adds.has(D)||this.removes.has(D)||this.removed.has(D)};C.clear=function(){this.adds.clear();this.removes.clear();this.removed.clear()};b._createClass(B,[{key:"empty",get:function(){return 0===this.adds.size&&0===this.removes.size&&0===this.removed.size}}]);return B}();const A=p.create(),x=p.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/ChangeSet":function(){define(["exports","../../../../core/PooledArray"],function(a,b){let c=function(){function l(){this.adds=new b;this.removes=new b;this.updates=new b({allocator:v=>v||new n,deallocator:v=>{v.renderGeometry=null;return v}})}var u=l.prototype;u.clear=function(){this.adds.clear();this.removes.clear();this.updates.clear()};u.prune=function(){this.adds.prune();this.removes.prune();this.updates.prune()};return l}(),n=function(){};a.ChangeSet=c;a.MaterialChangeSet=
function(){this.adds=[];this.removes=[];this.updates=[]};a.RenderGeometryUpdate=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ModelDirtyTypes":function(){define(["exports"],function(a){a.ModelDirty=void 0;(function(b){(function(c){c[c.ADD=1]="ADD";c[c.UPDATE=2]="UPDATE";c[c.REMOVE=4]="REMOVE"})(b.Geometry||(b.Geometry={}));(function(c){c[c.VISIBILITIES=1]="VISIBILITIES";c[c.VERTEXATTRS=2]="VERTEXATTRS";c[c.TRANSFORMATION=
4]="TRANSFORMATION";c[c.HIGHLIGHTS=8]="HIGHLIGHTS";c[c.OCCLUDEES=16]="OCCLUDEES"})(b.State||(b.State={}))})(a.ModelDirty||(a.ModelDirty={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/rendererUtils":function(){define(["exports","./ChangeSet"],function(a,b){a.splitRenderGeometryChangeSetByMaterial=function(c){const n=new Map,l=u=>{let v=n.get(u);v||(v=new b.MaterialChangeSet,n.set(u,v));return v};c.removes.forAll(u=>{1<=
u.data.indexCount&&l(u.material).removes.push(u)});c.adds.forAll(u=>{1<=u.data.indexCount&&l(u.material).adds.push(u)});c.updates.forAll(u=>{1<=u.renderGeometry.data.indexCount&&l(u.renderGeometry.material).updates.push(u)});return n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/MapUtils ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../support/buffer/glUtil ../../lib/GLMaterials ../../lib/Material ../../lib/ModelDirtyTypes ../../lib/RenderPass ../../lib/Util ../DrawParameters ../WaterMaterial ./Instance ./MergedGeometryBuffer ./MergedGeometryBufferPool ./utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){function w(L,R){const M=new Map;for(const J of L)z(M,J,!0);for(const J of R)z(M,J,!1);return M}function z(L,R,M){const J=R.origin;if(!n.isNone(J)){var I=L.get(J.id);null==I&&(I=new C(J.vec3),L.set(J.id,I));M?I.toAdd.push(R):I.toRemove.push(R)}}function A(L,R){let M;if(!L.some(I=>{if(I.to-I.from<R)return!1;M=I;return!0}))return null;const J=M.from;M.from+=R;M.from>=M.to&&L.removeUnordered(M);return J}function x(L){const R=new Map;L.forAll(J=>R.set(J.from,
J));let M=!0;for(;M;)M=!1,L.forEach(J=>{const I=R.get(J.to);I&&(J.to=I.to,R.delete(I.from),L.removeUnordered(I),M=!0)})}let B=function(){function L(M,J,I){this._rctx=M;this._materialRepository=J;this._material=I;this.type="MergedRenderer";this._dataByOrigin=new Map;this._renderCommandData=new l;this._hasOccludees=this._hasHighlights=!1;this._glMaterials=new h.GLMaterials(this._material,this._materialRepository);this._bufferWriter=I.createBufferWriter();this._bufferPool=new y.MergedGeometryBufferPool(M,
I.vertexAttributeLocations,m.glLayout(this._bufferWriter.vertexBufferLayout))}var R=L.prototype;R.dispose=function(){this._glMaterials.destroy();this._dataByOrigin.forEach(M=>M.buffer.dispose());this._dataByOrigin.clear();this._bufferPool.dispose()};R.modify=function(M){this._updateGeometries(M.updates);this._addAndRemoveGeometries(M.adds,M.removes);this._updateRenderCommands()};R._addAndRemoveGeometries=function(M,J){const I=this._bufferWriter,P=I.vertexBufferLayout.stride/4,N=this._dataByOrigin,
V=w(M,J);V.forEach((S,T)=>{V.delete(T);var H=S.toAdd.reduce((X,ba)=>X+I.elementCount(ba.data),0);let U=N.get(T);if(null==U)p.assert(0===S.toRemove.length),U=new D(S.origin,new r.MergedGeometryBuffer(this._bufferPool,H*P)),N.set(T,U);else if(0===S.toAdd.length&&U.instances.size===S.toRemove.length){U.buffer.dispose();N.delete(T);return}let W=0;U.instances.forEach(X=>W+=X.to-X.from);T=S.toRemove.reduce((X,ba)=>X+I.elementCount(ba.data),0);T=(W+H-T)*P;H=F;T<U.buffer.size/2?this._removeAndRebuild(U,S.toRemove,
P,T,H):0<S.toRemove.length&&this._remove(U,S.toRemove,P,H);0<S.toAdd.length&&(T=G,p.setMatrixTranslation3(T,-S.origin[0],-S.origin[1],-S.origin[2]),this._add(U,S.toAdd,P,T,H));const Q=U.buffer.vao.vertexBuffers.geometry;x(H);H.forAll(({from:X,to:ba})=>{X<ba&&(X*=4,Q.setSubData(U.buffer.array,X,X,4*ba))});H.clear();U.drawCommandsDirty=!0})};R._updateGeometries=function(M){const J=this._bufferWriter,I=J.vertexBufferLayout.stride/4;for(const P of M){M=P.renderGeometry;const N=this._dataByOrigin.get(M.origin.id),
V=N&&N.instances.get(M.id);if(!V)break;const S=P.updateType;S&e.ModelDirty.State.VISIBILITIES&&(V.isVisible=M.instanceParameters.visible);if(S&(e.ModelDirty.State.HIGHLIGHTS|e.ModelDirty.State.VISIBILITIES)){const T=M.instanceParameters.visible;V.hasHighlights=!!M.instanceParameters.highlights&&T}S&e.ModelDirty.State.OCCLUDEES&&(V.hasOccludees=!!M.instanceParameters.occludees);if(S&(e.ModelDirty.State.VERTEXATTRS|e.ModelDirty.State.TRANSFORMATION)){const {array:T,vao:H}=N.buffer;f.calculateTransformRelativeToOrigin(M,
O,K);J.write({transformation:O,invTranspTransformation:K},M.data,J.vertexBufferLayout.createView(T.buffer),V.from);p.assert(V.from+J.elementCount(M.data)===V.to,"material VBO layout has changed");H.vertexBuffers.geometry.setSubData(T,V.from*I*4,V.from*I*4,V.to*I*4)}N.drawCommandsDirty=!0}};R._updateRenderCommands=function(){this._hasOccludees=this._hasHighlights=!1;this._dataByOrigin.forEach(J=>{J.hasHiddenInstances=!1;J.hasHighlights=!1;J.hasOccludees=!1;c.someMap(J.instances,I=>{I.isVisible?(I.hasHighlights&&
(this._hasHighlights=!0,J.hasHighlights=!0),I.hasOccludees&&(this._hasOccludees=!0,J.hasOccludees=!0)):J.hasHiddenInstances=!0;return J.hasHiddenInstances&&J.hasHighlights&&J.hasOccludees})});const M=J=>{J.drawCommandsDefault=null;J.drawCommandsHighlight=null;J.drawCommandsOccludees=null;J.drawCommandsShadowHighlightRest=null;if(0!==J.instances.size)if(J.hasOccludees||J.hasHighlights||J.hasHiddenInstances){var I=k.sortInstancesByRange(J.instances);J.drawCommandsDefault=[];J.drawCommandsHighlight=
[];J.drawCommandsOccludees=[];J.drawCommandsShadowHighlightRest=[];for(const P of I)P.isVisible&&(P.hasOccludees?k.addOrMerge(J.drawCommandsOccludees,P):k.addOrMerge(J.drawCommandsDefault,P),P.hasHighlights?k.addOrMerge(J.drawCommandsHighlight,P):k.addOrMerge(J.drawCommandsShadowHighlightRest,P))}else J.drawCommandsDefault=[{first:0,count:4*J.buffer.size/this._bufferWriter.vertexBufferLayout.stride}]};this._dataByOrigin.forEach(J=>{J.drawCommandsDirty&&(M(J),J.drawCommandsDirty=!1)})};R.updateAnimation=
function(M){return this._material.update(M)};R.requiresSlot=function(M,J){return null==M||this._material.requiresSlot(M,J)};R.render=function(M,J){if(!this.requiresSlot(J.slot,M))return!1;const I=M===g.RenderPass.MATERIAL_HIGHLIGHT||M===g.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT;if(I&&!this._hasHighlights)return!1;const P=M===g.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,N=!(I||P);this._dataByOrigin.forEach(T=>{if(!I||T.hasHighlights){var H=(I?T.drawCommandsHighlight:P&&(T.hasOccludees||T.hasHighlights||
T.hasHiddenInstances)?T.drawCommandsShadowHighlightRest:T.drawCommandsDefault)||null,U=N&&T.drawCommandsOccludees||null;(n.isSome(H)||n.isSome(U))&&this._renderCommandData.push(new E(T.origin,T.buffer,H,U))}});if(0===this._renderCommandData.length)return!1;const V=this._rctx;M=this._glMaterials.load(V,M);if(n.isNone(M))return this._renderCommandData.clear(),!1;const S=M.beginSlot(J);V.bindTechnique(S,this._material.parameters,J,!1);this._renderCommandData.forAll(T=>{S.bindDraw(T,J);const {buffer:H,
renderCommands:U,occludeeCommands:W}=T;S.ensureAttributeLocations(H.vao);V.bindVAO(H.vao);T=S.primitiveType;n.isSome(U)&&this._renderCommands(V,T,U);n.isSome(W)&&(S.bindPipelineState(V,J.slot,!0),this._renderCommands(V,T,W),S.bindPipelineState(V,J.slot,!1))});this._renderCommandData.clear();return!0};R._renderCommands=function(M,J,I){for(let P=0;P<I.length;P++)M.drawArrays(J,I[P].first,I[P].count)};R._removeAndRebuild=function(M,J,I,P,N){for(var V of J)M.instances.delete(V.id);var S=k.sortInstancesByRange(M.instances);
M.instances.clear();J=M.buffer.size;P=M.buffer.alloc(P);V=0;for(const T of S){S=T.from*I;const H=T.to*I;P.copy(V,S,H);T.from=V/I;V+=H-S;T.to=V/I;M.instances.set(T.id,T)}N.push(new k.BufferRange(0,P.hasNewBuffer?M.buffer.array.length:J));P.dispose();M.buffer.erase(V,N.back().to);M.holes.clear()};R._remove=function(M,J,I,P){for(const N of J){J=N.id;const V=M.instances.get(J),S=V.from*I,T=V.to*I;M.buffer.erase(S,T);M.holes.push(new k.BufferRange(V.from,V.to));M.instances.delete(J);P.push(new k.BufferRange(S,
T))}x(M.holes)};R._add=function(M,J,I,P,N){if(0!==J.length){var V=this._bufferWriter,S=V.vertexBufferLayout.createView(M.buffer.array.buffer),T=0<M.holes.length,H=Number.MAX_SAFE_INTEGER,U=Number.MIN_SAFE_INTEGER;for(const Q of J){var W=n.isSome(Q.transformation)?u.multiply(O,P,Q.transformation):P;u.invert(K,W);const X=u.transpose(K,K);J=V.elementCount(Q.data);const ba=J*I;let aa=A(M.holes,J);n.isNone(aa)&&(aa=M.buffer.size/I,M.buffer.grow(ba),S=V.vertexBufferLayout.createView(M.buffer.array.buffer));
V.write({transformation:W,invTranspTransformation:X},Q.data,S,aa);W=Q.instanceParameters.visible;J=new k.Instance(Q.id,aa,aa+J,W,!!Q.instanceParameters.highlights&&W,!!Q.instanceParameters.occludees);p.assert(null==M.instances.get(Q.id));M.instances.set(Q.id,J);T?N.push(new k.BufferRange(J.from*I,J.to*I)):(H=Math.min(J.from,H),U=Math.max(J.to,U))}T||N.push(new k.BufferRange(H*I,U*I))}};b._createClass(L,[{key:"isEmpty",get:function(){return 0===this._dataByOrigin.size}},{key:"hasHighlights",get:function(){return this._hasHighlights}},
{key:"hasOccludees",get:function(){return this._hasOccludees}},{key:"hasWater",get:function(){return!this.isEmpty&&this._material instanceof q.WaterMaterial}},{key:"rendersOccluded",get:function(){return!this.isEmpty&&this._material.renderOccluded!==d.RenderOccludedFlag.Occlude}},{key:"test",get:function(){return{material:this._material,glMaterials:this._glMaterials,dataByOrigin:this._dataByOrigin}}}]);return L}(),C=function(L){this.origin=L;this.toAdd=[];this.toRemove=[]},D=function(L,R){this.origin=
L;this.buffer=R;this.instances=new Map;this.holes=new l({deallocator:null});this.drawCommandsDirty=this.hasOccludees=this.hasHighlights=this.hasHiddenInstances=!1},E=function(L){function R(M,J,I,P){M=L.call(this,M)||this;M.buffer=J;M.renderCommands=I;M.occludeeCommands=P;return M}b._inheritsLoose(R,L);return R}(t.DrawParameters);const F=new l({deallocator:null}),G=v.create(),O=v.create(),K=v.create();a.MergedRenderer=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/materials/DrawParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec3f64","../core/shaderLibrary/attributes/VertexNormal.glsl"],function(a,b,c,n){n=function(l){function u(v=c.create()){var m=l.call(this)||this;m.origin=v;m.slicePlaneLocalOrigin=m.origin;return m}b._inheritsLoose(u,l);return u}(n.VertexNormalDrawParameters);a.DrawParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/vec4f64 ./NormalAttribute.glsl ./VertexPosition.glsl ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform".split(" "),function(a,b,c,n,l,u,v,m,h){let d=function(g){function p(){var t=g.apply(this,arguments)||this;t.transformNormalViewFromGlobal=
c.create();return t}b._inheritsLoose(p,g);return p}(u.VertexPositionPassParameters),e=function(g){function p(){var t=g.apply(this,arguments)||this;t.transformNormalGlobalFromModel=c.create();t.toMapSpace=n.create();return t}b._inheritsLoose(p,g);return p}(u.VertexPositionDrawParameters);a.VertexNormal=function(g,p){p.normalType===l.NormalAttributeType.Attribute||p.normalType===l.NormalAttributeType.CompressedAttribute?(g.include(l.NormalAttribute,p),g.varyings.add("vNormalWorld","vec3"),g.varyings.add("vNormalView",
"vec3"),g.vertex.uniforms.add([new m.Matrix3DrawUniform("transformNormalGlobalFromModel",t=>t.transformNormalGlobalFromModel),new h.Matrix3PassUniform("transformNormalViewFromGlobal",t=>t.transformNormalViewFromGlobal)]),g.vertex.code.add(v.glsl`void forwardNormal() {
vNormalWorld = transformNormalGlobalFromModel * normalModel();
vNormalView = transformNormalViewFromGlobal * vNormalWorld;
}`)):p.normalType===l.NormalAttributeType.Ground?(g.include(u.VertexPosition,p),g.varyings.add("vNormalWorld","vec3"),g.vertex.code.add(v.glsl`
    void forwardNormal() {
      vNormalWorld = ${p.spherical?v.glsl`normalize(vPositionWorldCameraRelative);`:v.glsl`vec3(0.0, 0.0, 1.0);`}
    }
    `)):g.vertex.code.add(v.glsl`void forwardNormal() {}`)};a.VertexNormalDrawParameters=e;a.VertexNormalPassParameters=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl":function(){define(["exports","../util/DecodeNormal.glsl","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c,n){a.NormalAttributeType=void 0;(function(l){l[l.Attribute=0]="Attribute";
l[l.CompressedAttribute=1]="CompressedAttribute";l[l.Ground=2]="Ground";l[l.ScreenDerivative=3]="ScreenDerivative";l[l.COUNT=4]="COUNT"})(a.NormalAttributeType||(a.NormalAttributeType={}));a.NormalAttribute=function(l,u){u.normalType===a.NormalAttributeType.Attribute&&(l.attributes.add(n.VertexAttribute.NORMAL,"vec3"),l.vertex.code.add(c.glsl`vec3 normalModel() {
return normal;
}`));u.normalType===a.NormalAttributeType.CompressedAttribute&&(l.include(b.DecodeNormal),l.attributes.add(n.VertexAttribute.NORMALCOMPRESSED,"vec2"),l.vertex.code.add(c.glsl`vec3 normalModel() {
return decodeNormal(normalCompressed);
}`));u.normalType===a.NormalAttributeType.ScreenDerivative&&(l.extensions.add("GL_OES_standard_derivatives"),l.fragment.code.add(c.glsl`vec3 screenDerivativeNormal(vec3 positionView) {
return normalize(cross(dFdx(positionView), dFdy(positionView)));
}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DecodeNormal.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.DecodeNormal=function(c){const n=b.glsl`vec3 decodeNormal(vec2 f) {
float z = 1.0 - abs(f.x) - abs(f.y);
return vec3(f + sign(f) * min(z, 0.0), z);
}`;c.fragment.code.add(n);c.vertex.code.add(n)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/mat3f64 ../../../../../../chunks/mat4f64 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec3f64 ./PositionAttribute.glsl ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/Float3PassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix3DrawUniform ../../shaderModules/Matrix3PassUniform ../../shaderModules/Matrix4PassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){let q=function(r){function y(){var f=r.apply(this,arguments)||this;f.transformWorldFromViewTH=u.create();f.transformWorldFromViewTL=u.create();f.transformViewFromCameraRelativeRS=c.create();f.transformProjFromView=n.create();return f}b._inheritsLoose(y,r);return y}(e.NoParameters),k=function(r){function y(){var f=r.apply(this,arguments)||this;f.transformWorldFromModelRS=c.create();f.transformWorldFromModelTH=l.create();f.transformWorldFromModelTL=l.create();return f}
b._inheritsLoose(y,r);return y}(e.NoParameters);a.VertexPosition=function(r,y){r.include(v.PositionAttribute);const f=r.vertex;f.include(m.DoublePrecision,y);r.varyings.add("vPositionWorldCameraRelative","vec3");r.varyings.add("vPosition_view","vec3");f.uniforms.add([new d.Float3PassUniform("transformWorldFromViewTH",w=>w.transformWorldFromViewTH),new d.Float3PassUniform("transformWorldFromViewTL",w=>w.transformWorldFromViewTL),new p.Matrix3PassUniform("transformViewFromCameraRelativeRS",w=>w.transformViewFromCameraRelativeRS),
new t.Matrix4PassUniform("transformProjFromView",w=>w.transformProjFromView),new g.Matrix3DrawUniform("transformWorldFromModelRS",w=>w.transformWorldFromModelRS),new h.Float3DrawUniform("transformWorldFromModelTH",w=>w.transformWorldFromModelTH),new h.Float3DrawUniform("transformWorldFromModelTL",w=>w.transformWorldFromModelTL)]);f.code.add(e.glsl`vec3 positionWorldCameraRelative() {
vec3 rotatedModelPosition = transformWorldFromModelRS * positionModel();
vec3 transform_CameraRelativeFromModel = dpAdd(
transformWorldFromModelTL,
transformWorldFromModelTH,
-transformWorldFromViewTL,
-transformWorldFromViewTH
);
return transform_CameraRelativeFromModel + rotatedModelPosition;
}`);f.code.add(e.glsl`
    void forwardPosition(float fOffset) {
      vPositionWorldCameraRelative = positionWorldCameraRelative();
      if (fOffset != 0.0) {
        vPositionWorldCameraRelative += fOffset * ${y.spherical?e.glsl`normalize(transformWorldFromViewTL + vPositionWorldCameraRelative)`:e.glsl`vec3(0.0, 0.0, 1.0)`};
      }

      vPosition_view = transformViewFromCameraRelativeRS * vPositionWorldCameraRelative;
      gl_Position = transformProjFromView * vec4(vPosition_view, 1.0);
    }
  `);r.fragment.uniforms.add(new d.Float3PassUniform("transformWorldFromViewTL",w=>w.transformWorldFromViewTL));f.code.add(e.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`);r.fragment.code.add(e.glsl`vec3 positionWorld() {
return transformWorldFromViewTL + vPositionWorldCameraRelative;
}`)};a.VertexPositionDrawParameters=k;a.VertexPositionPassParameters=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.PositionAttribute=function(n){n.attributes.add(c.VertexAttribute.POSITION,"vec3");n.vertex.code.add(b.glsl`vec3 positionModel() { return position; }`)};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DoublePrecision.glsl":function(){define(["exports","../../../../../../core/has","../../shaderModules/interfaces"],function(a,b,c){a.DoublePrecision=function({code:n},l){l.doublePrecisionRequiresObfuscation?n.add(c.glsl`vec3 dpPlusFrc(vec3 a, vec3 b) {
return mix(a, a + b, vec3(notEqual(b, vec3(0))));
}
vec3 dpMinusFrc(vec3 a, vec3 b) {
return mix(vec3(0), a - b, vec3(notEqual(a, b)));
}
vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = dpPlusFrc(hiA, hiB);
vec3 e = dpMinusFrc(t1, hiA);
vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;
return t1 + t2;
}`):n.add(c.glsl`vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {
vec3 t1 = hiA + hiB;
vec3 e = t1 - hiA;
vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;
return t1 + t2;
}`)};a.doublePrecisionRequiresObfuscation=function(n){return b("force-double-precision-obfuscation")?!0:n.driverTest.doublePrecisionRequiresObfuscation};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/time ../../../../chunks/vec2f64 ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutputOptions ../lib/AnimationTimer ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./WaterGLMaterial ./WaterTechnique ./internal/DefaultBufferWriter ./internal/MaterialUtil".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){let k=function(y){function f(z){z=y.call(this,z,new r)||this;z._techniqueConfig=new p.WaterTechniqueConfiguration;z.animation=new v.AnimationTimer;return z}b._inheritsLoose(f,y);var w=f.prototype;w.getConfiguration=function(z,A){this._techniqueConfig.output=z;this._techniqueConfig.writeDepth=this.parameters.writeDepth;this._techniqueConfig.receiveShadows=this.parameters.receiveShadows;this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this._techniqueConfig.transparent=
this.parameters.transparent;this._techniqueConfig.hasScreenSpaceReflections=this.parameters.hasScreenSpaceReflections;this._techniqueConfig.hasCloudsReflections=this.parameters.hasCloudsReflections;this._techniqueConfig.isDraped=this.parameters.isDraped;this._techniqueConfig.transparencyPassType=A.transparencyPassType;this._techniqueConfig.enableOffset=A.camera.relativeElevation<d.OITPolygonOffsetLimit;this._techniqueConfig.hasMultipassTerrain=A.multipassTerrain.enabled;this._techniqueConfig.cullAboveGround=
A.multipassTerrain.cullAboveGround;return this._techniqueConfig};w.update=function(z){this.animation.enabled=35E3>Math.sqrt(this.parameters.waveTextureRepeat/this.parameters.waveStrength)*Math.min(z.camera.relativeElevation,z.camera.distance);z=this.animation.advance(z);this.setParameters({timeElapsed:c.secondsFromMilliseconds(this.animation.time)*this.parameters.animationSpeed},!1);return this.animation.enabled&&z};w.intersect=function(z,A,x,B,C,D,E){q.intersectTriangleGeometry(z,A,B,C,D,void 0,
E)};w.requiresSlot=function(z,A){switch(m.outputFromPass(A)){case u.ShaderOutput.Normal:return z===e.RenderSlot.DRAPED_WATER;case u.ShaderOutput.Color:if(this.parameters.isDraped)return z===e.RenderSlot.DRAPED_MATERIAL;break;case u.ShaderOutput.Highlight:return z===e.RenderSlot.OPAQUE_MATERIAL||z===e.RenderSlot.DRAPED_MATERIAL}A=e.RenderSlot.OPAQUE_MATERIAL;this.parameters.transparent&&(A=this.parameters.writeDepth?e.RenderSlot.TRANSPARENT_MATERIAL:e.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);
return z===A};w.createGLMaterial=function(z){if(z.output===u.ShaderOutput.Color&&this.parameters.isDraped)return z.output=u.ShaderOutput.Draped,new g.WaterGLMaterial(z);switch(z.output){case u.ShaderOutput.Color:case u.ShaderOutput.Normal:case u.ShaderOutput.Highlight:case u.ShaderOutput.Alpha:return new g.WaterGLMaterial(z)}return null};w.createBufferWriter=function(){return new t.DefaultBufferWriter(t.PositionUVLayout)};return f}(h.Material),r=function(y){function f(){var w=y.apply(this,arguments)||
this;w.waveStrength=.06;w.waveTextureRepeat=32;w.waveDirection=n.fromValues(1,0);w.waveVelocity=.05;w.flowStrength=.015;w.flowOffset=-.5;w.animationSpeed=.35;w.timeElapsed=0;w.color=l.fromValues(0,0,0,0);w.transparent=!0;w.writeDepth=!0;w.hasSlicePlane=!1;w.isDraped=!1;w.receiveShadows=!0;w.hasScreenSpaceReflections=!1;w.hasCloudsReflections=!1;return w}b._inheritsLoose(f,y);return f}(h.MaterialParameters);a.WaterMaterial=k;a.WaterMaterialParameters=r;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterGLMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ./WaterTechnique".split(" "),function(a,b,c,n,l,u,v){u=function(m){function h(){return m.apply(this,arguments)||this}b._inheritsLoose(h,m);var d=h.prototype;d._updateShadowState=function(e){e.shadowMap.enabled!==this._material.parameters.receiveShadows&&
this._material.setParameters({receiveShadows:e.shadowMap.enabled})};d._updateSSRState=function(e){e.ssr.enabled!==this._material.parameters.hasScreenSpaceReflections&&this._material.setParameters({hasScreenSpaceReflections:e.ssr.enabled})};d._updateCloudsReflectionState=function(e){e=c.isSome(e.clouds.data);e!==this._material.parameters.hasCloudsReflections&&this._material.setParameters({hasCloudsReflections:e})};d.ensureResources=function(e){const g=this._techniqueRepository.constructionContext.waterTextureRepository;
g.resourceState===l.ResourceState.NOT_LOADED&&g.loadTextures(e);return g.resourceState};d.beginSlot=function(e){this._output===n.ShaderOutput.Color&&(this._updateShadowState(e),this._updateSSRState(e),this._updateCloudsReflectionState(e));return this.ensureTechnique(v.WaterTechnique,e)};return h}(u);a.WaterGLMaterial=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/WaterTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ./DefaultTechniqueConfiguration ../../../../chunks/WaterSurface.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){d=function(f){function w(A,x,B){x=f.call(this,A,x,B)||this;x._textureRepository=A.waterTextureRepository;return x}c._inheritsLoose(w,f);var z=w.prototype;z.initializeConfiguration=function(A,x){x.spherical=A.viewingMode===l.ViewingMode.Global;x.doublePrecisionRequiresObfuscation=m.doublePrecisionRequiresObfuscation(A.rctx)};z.initializeProgram=function(A){const x=w.shader.get().build(this.configuration);return new q.Program(A.rctx,x,p.Default3D)};z.bindPass=
function(A,x){this.program.bindPass(A,x);this.configuration.output!==u.ShaderOutput.Color&&this.configuration.output!==u.ShaderOutput.Normal||this._textureRepository.bind(this.program)};z._setPipelineState=function(A){const x=this.configuration,B=A===g.TransparencyPassType.NONE,C=A===g.TransparencyPassType.FrontFace;return y.makePipelineState({blending:x.output!==u.ShaderOutput.Normal&&x.output!==u.ShaderOutput.Highlight&&x.transparent?B?t.blendingDefault:t.oitBlending(A):null,depthTest:{func:t.oitDepthTest(A)},
depthWrite:B?x.writeDepth&&y.defaultDepthWriteParams:t.oitDepthWrite(A),colorWrite:y.defaultColorWriteParams,polygonOffset:B||C?null:t.getOITPolygonOffset(x.enableOffset)})};z.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return w}(d.ShaderTechnique);d.shader=new h.ReloadableShaderModule(r.WaterSurface,()=>new Promise((f,w)=>a(["../shaders/WaterSurface.glsl"],f,w)));h=function(f){function w(){var z=f.apply(this,arguments)||this;z.output=u.ShaderOutput.Color;
z.transparencyPassType=g.TransparencyPassType.NONE;z.spherical=!1;z.receiveShadows=!1;z.hasSlicePlane=!1;z.transparent=!1;z.enableOffset=!0;z.writeDepth=!1;z.hasScreenSpaceReflections=!1;z.doublePrecisionRequiresObfuscation=!1;z.hasCloudsReflections=!1;z.isDraped=!1;z.hasMultipassTerrain=!1;z.cullAboveGround=!1;return z}c._inheritsLoose(w,f);return w}(k.DefaultTechniqueConfiguration);n.__decorate([e.parameter({count:u.ShaderOutput.COUNT})],h.prototype,"output",void 0);n.__decorate([e.parameter({count:g.TransparencyPassType.COUNT})],
h.prototype,"transparencyPassType",void 0);n.__decorate([e.parameter()],h.prototype,"spherical",void 0);n.__decorate([e.parameter()],h.prototype,"receiveShadows",void 0);n.__decorate([e.parameter()],h.prototype,"hasSlicePlane",void 0);n.__decorate([e.parameter()],h.prototype,"transparent",void 0);n.__decorate([e.parameter()],h.prototype,"enableOffset",void 0);n.__decorate([e.parameter()],h.prototype,"writeDepth",void 0);n.__decorate([e.parameter()],h.prototype,"hasScreenSpaceReflections",void 0);
n.__decorate([e.parameter()],h.prototype,"doublePrecisionRequiresObfuscation",void 0);n.__decorate([e.parameter()],h.prototype,"hasCloudsReflections",void 0);n.__decorate([e.parameter()],h.prototype,"isDraped",void 0);n.__decorate([e.parameter()],h.prototype,"hasMultipassTerrain",void 0);n.__decorate([e.parameter()],h.prototype,"cullAboveGround",void 0);n.__decorate([e.parameter({constValue:v.PBRMode.Water})],h.prototype,"pbrMode",void 0);n.__decorate([e.parameter({constValue:!0})],h.prototype,"useCustomDTRExponentForWater",
void 0);n.__decorate([e.parameter({constValue:!0})],h.prototype,"highStepCount",void 0);n.__decorate([e.parameter({constValue:!1})],h.prototype,"useFillLights",void 0);b.WaterTechnique=d;b.WaterTechniqueConfiguration=h;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/WaterSurface.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MainLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D){function E(G){const O=new B.ShaderBuilder,{vertex:K,fragment:L}=O,R=r.addProjViewLocalOrigin(O,G);O.include(l.Transform);O.attributes.add(D.VertexAttribute.POSITION,"vec3");O.attributes.add(D.VertexAttribute.UV0,"vec2");K.uniforms.add(new f.Float4PassUniform("waterColor",M=>M.color));if(G.output===c.ShaderOutput.Color||G.output===c.ShaderOutput.Alpha)O.include(d.NormalUtils,G),O.include(b.ForwardLinearDepth,G),O.varyings.add("vuv","vec2"),
O.varyings.add("vpos","vec3"),O.varyings.add("vnormal","vec3"),O.varyings.add("vtbnMatrix","mat3"),L.uniforms.add(R),G.hasMultipassTerrain&&O.varyings.add("depth","float"),K.code.add(A.glsl`
      void main(void) {
        if (waterColor.a < ${A.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vuv = uv0;
        vpos = position;

        vnormal = getLocalUp(vpos, localOrigin);
        vtbnMatrix = getTBNMatrix(vnormal);

        ${G.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}

        gl_Position = transformPosition(proj, view, vpos);
        ${G.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}
      }
    `);O.include(h.multipassTerrainTest,G);G.output===c.ShaderOutput.Alpha&&(O.include(n.SliceDraw,G),L.uniforms.add(new w.Float4Uniform("waterColor")),L.code.add(A.glsl`
        void main() {
          discardBySlice(vpos);
          ${G.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

          gl_FragColor = vec4(waterColor.a);
        }
      `));G.output===c.ShaderOutput.Color&&(O.include(m.MainLighting,{isGround:!1}),O.include(v.EvaluateAmbientLighting,{pbrMode:e.PBRMode.Disabled,lightingSphericalHarmonicsOrder:2}),O.include(t.WaterDistortion),O.include(n.SliceDraw,G),O.include(g.ReadShadowMapDraw,G),O.include(p.Water,G),L.uniforms.add([new w.Float4Uniform("waterColor"),new y.Float3PassUniform("lightingMainDirection",(M,J)=>J.lighting.lightingMainDirection),new y.Float3PassUniform("lightingMainIntensity",(M,J)=>J.lighting.mainLight.intensity),
new z.FloatPassUniform("timeElapsed",M=>M.timeElapsed),new x.Matrix4Uniform("view")]),r.addCameraPosition(L,G),L.include(k.ColorConversion),L.code.add(A.glsl`
      void main() {
        discardBySlice(vpos);
        ${G.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        vec3 localUp = vnormal;
        // the created normal is in tangent space
        vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);

        // we rotate the normal according to the tangent-bitangent-normal-Matrix
        vec3 n = normalize(vtbnMatrix * tangentNormalFoam.xyz);
        vec3 v = -normalize(vpos - cameraPosition);
        float shadow = ${G.receiveShadows?A.glsl`1.0 - readShadowMap(vpos, linearDepth)`:"1.0"};
        vec4 vPosView = view*vec4(vpos, 1.0);
        vec4 final = vec4(getSeaColor(n, v, lightingMainDirection, waterColor.rgb, lightingMainIntensity, localUp, shadow, tangentNormalFoam.w, vPosView.xyz, vpos + localOrigin), waterColor.w);

        // gamma correction
        gl_FragColor = delinearizeGamma(final);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${G.transparencyPassType===C.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));G.output===c.ShaderOutput.Normal&&(O.include(d.NormalUtils,G),O.include(t.WaterDistortion,G),O.include(n.SliceDraw,G),O.varyings.add("vpos","vec3"),O.varyings.add("vuv","vec2"),K.code.add(A.glsl`
        void main(void) {
          if (waterColor.a < ${A.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vuv = uv0;
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
        }
    `),L.uniforms.add(new z.FloatPassUniform("timeElapsed",M=>M.timeElapsed)),L.code.add(A.glsl`void main() {
discardBySlice(vpos);
vec4 tangentNormalFoam = getSurfaceNormalAndFoam(vuv, timeElapsed);
tangentNormalFoam.xyz = normalize(tangentNormalFoam.xyz);
gl_FragColor = vec4((tangentNormalFoam.xyz + vec3(1.0)) * 0.5, tangentNormalFoam.w);
}`));G.output===c.ShaderOutput.Draped&&(O.varyings.add("vpos","vec3"),K.code.add(A.glsl`
        void main(void) {
          if (waterColor.a < ${A.glsl.float(q.symbolAlphaCutoff)}) {
            // Discard this vertex
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
            return;
          }

          vpos = position;
          gl_Position = transformPosition(proj, view, vpos);
        }
    `),L.uniforms.add(new w.Float4Uniform("waterColor")),L.code.add(A.glsl`void main() {
gl_FragColor = waterColor;
}`));G.output===c.ShaderOutput.Highlight&&(O.include(u.OutputHighlight),O.varyings.add("vpos","vec3"),K.code.add(A.glsl`
      void main(void) {
        if (waterColor.a < ${A.glsl.float(q.symbolAlphaCutoff)}) {
          // Discard this vertex
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          return;
        }

        vpos = position;
        gl_Position = transformPosition(proj, view, vpos);
      }
    `),O.include(n.SliceDraw,G),L.code.add(A.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return O}const F=Object.freeze(Object.defineProperty({__proto__:null,build:E},Symbol.toStringTag,{value:"Module"}));a.WaterSurface=F;a.build=E})},"esri/views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl":function(){define(["exports","./ShaderOutputOptions","./attributes/VertexPosition.glsl","../shaderModules/Float2PassUniform","../shaderModules/interfaces"],function(a,b,c,n,l){a.ForwardLinearDepth=function(u,v){v.output===b.ShaderOutput.Color&&v.receiveShadows?(u.varyings.add("linearDepth",
"float"),u.vertex.code.add(l.glsl`void forwardLinearDepth() { linearDepth = gl_Position.w; }`)):v.output===b.ShaderOutput.Depth||v.output===b.ShaderOutput.Shadow?(u.include(c.VertexPosition,v),u.varyings.add("linearDepth","float"),u.vertex.uniforms.add(new n.Float2PassUniform("nearFar",(m,h)=>h.camera.nearFar)),u.vertex.code.add(l.glsl`void forwardLinearDepth() {
linearDepth = (-vPosition_view.z - nearFar[0]) / (nearFar[1] - nearFar[0]);
}`)):u.vertex.code.add(l.glsl`void forwardLinearDepth() {}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.NormalUtils=function(c,n){n.spherical?c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return normalize(pos + origin);
}`):c.vertex.code.add(b.glsl`vec3 getLocalUp(in vec3 pos, in vec3 origin) {
return vec3(0.0, 0.0, 1.0);
}`);n.spherical?c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = normalize(cross(vec3(0.0, 0.0, 1.0), n));
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`):c.vertex.code.add(b.glsl`mat3 getTBNMatrix(in vec3 n) {
vec3 t = vec3(1.0, 0.0, 0.0);
vec3 b = normalize(cross(n, t));
return mat3(t, b, n);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec3f64 ../util/RgbaFloatEncoding.glsl ../../shaderModules/Float4PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4sUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(t){t=t.fragment;t.include(n.RgbaFloatEncoding);t.uniforms.add([new d.Texture2DPassUniform("shadowMapTex",(q,k)=>k.shadowMap.depthTexture),new v.IntegerPassUniform("numCascades",(q,k)=>k.shadowMap.numCascades),new l.Float4PassUniform("cascadeDistances",(q,k)=>k.shadowMap.cascadeDistances),new u.FloatPassUniform("depthHalfPixelSz",(q,k)=>.5/k.shadowMap.textureSize)]);t.code.add(m.glsl`int chooseCascade(float depth, out mat4 mat) {
vec4 distance = cascadeDistances;
int i = depth < distance[1] ? 0 : depth < distance[2] ? 1 : depth < distance[3] ? 2 : 3;
mat = i == 0 ? shadowMapMatrix[0] : i == 1 ? shadowMapMatrix[1] : i == 2 ? shadowMapMatrix[2] : shadowMapMatrix[3];
return i;
}
vec3 lightSpacePosition(vec3 _vpos, mat4 mat) {
vec4 lv = mat * vec4(_vpos, 1.0);
lv.xy /= lv.w;
return 0.5 * lv.xyz + vec3(0.5);
}
vec2 cascadeCoordinates(int i, vec3 lvpos) {
return vec2(float(i - 2 * (i / 2)) * 0.5, float(i / 2) * 0.5) + 0.5 * lvpos.xy;
}
float readShadowMapDepth(vec2 uv, sampler2D _depthTex) {
return rgba2float(texture2D(_depthTex, uv));
}
float posIsInShadow(vec2 uv, vec3 lvpos, sampler2D _depthTex) {
return readShadowMapDepth(uv, _depthTex) < lvpos.z ? 1.0 : 0.0;
}
float filterShadow(vec2 uv, vec3 lvpos, float halfPixelSize, sampler2D _depthTex) {
float texSize = 0.5 / halfPixelSize;
vec2 st = fract((vec2(halfPixelSize) + uv) * texSize);
float s00 = posIsInShadow(uv + vec2(-halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s10 = posIsInShadow(uv + vec2(halfPixelSize, -halfPixelSize), lvpos, _depthTex);
float s11 = posIsInShadow(uv + vec2(halfPixelSize, halfPixelSize), lvpos, _depthTex);
float s01 = posIsInShadow(uv + vec2(-halfPixelSize, halfPixelSize), lvpos, _depthTex);
return mix(mix(s00, s10, st.x), mix(s01, s11, st.x), st.y);
}
float readShadowMap(const in vec3 _vpos, float _linearDepth) {
mat4 mat;
int i = chooseCascade(_linearDepth, mat);
if (i >= numCascades) { return 0.0; }
vec3 lvpos = lightSpacePosition(_vpos, mat);
if (lvpos.z >= 1.0) { return 0.0; }
if (lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) { return 0.0; }
vec2 uv = cascadeCoordinates(i, lvpos);
return filterShadow(uv, lvpos, depthHalfPixelSz, shadowMapTex);
}`)}let p=function(t){function q(){var k=t.apply(this,arguments)||this;k.origin=c.create();return k}b._inheritsLoose(q,t);return q}(m.NoParameters);a.ReadShadowMapBindParameters=p;a.ReadShadowMapDraw=function(t,q){q.receiveShadows&&(t.fragment.uniforms.add(new h.Matrix4sUniform("shadowMapMatrix",e.BindType.Draw,(k,r)=>r.shadowMap.getShadowMapMatrices(k.origin),4)),g(t))};a.ReadShadowMapPass=function(t,q){q.receiveShadows&&(t.fragment.uniforms.add(new h.Matrix4sUniform("shadowMapMatrix",e.BindType.Pass,
(k,r)=>r.shadowMap.getShadowMapMatrices(k.origin),4)),g(t))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerPassUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"int",n.BindType.Pass,(h,d,e)=>h.setUniform1i(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);
a.IntegerPassUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Matrix4sUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m,h,d){switch(m){case n.BindType.Pass:var e=l.call(this,v,"mat4",m,(g,p,t)=>g.setUniformMatrix4fv(v,h(p,t)),d)||this;return b._assertThisInitialized(e);case n.BindType.Draw:return e=
l.call(this,v,"mat4",m,(g,p,t)=>g.setUniformMatrix4fv(v,h(p,t)),d)||this,b._assertThisInitialized(e)}return e}b._inheritsLoose(u,l);return u}(c.Uniform);a.Matrix4sUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Water.glsl":function(){define("exports ./FoamRendering.glsl ./Gamma.glsl ./PhysicallyBasedRendering.glsl ./ScreenSpaceReflections.glsl ../util/CloudsParallaxShading.glsl ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,n,l,u,v,m){a.Water=function(h,d){h.include(n.PhysicallyBasedRendering,d);h.include(c.Gamma);h.include(b.FoamColor);d.hasCloudsReflections&&h.include(u.CloudsParallaxShading,d);d.hasScreenSpaceReflections&&h.include(l.ScreenSpaceReflections,d);h=h.fragment;h.constants.add("fresnelSky","vec3",[.02,1,15]).add("fresnelMaterial","vec2",[.02,.1]).add("roughness","float",.015).add("foamIntensityExternal","float",1.7).add("ssrIntensity","float",.65).add("ssrHeightFadeStart","float",3E5).add("ssrHeightFadeEnd",
"float",5E5).add("waterDiffusion","float",.92).add("waterSeaColorMod","float",.8).add("correctionViewingPowerFactor","float",.4).add("skyZenitColor","vec3",[.52,.68,.9]).add("skyColor","vec3",[.67,.79,.9]).add("cloudFresnelModifier","vec2",[1.2,.01]);h.code.add(m.glsl`PBRShadingWater shadingInfo;
vec3 getSkyGradientColor(in float cosTheta, in vec3 horizon, in vec3 zenit) {
float exponent = pow((1.0 - cosTheta), fresnelSky[2]);
return mix(zenit, horizon, exponent);
}`);h.uniforms.add([new v.FloatPassUniform("lightingSpecularStrength",(e,g)=>g.lighting.mainLight.specularStrength),new v.FloatPassUniform("lightingEnvironmentStrength",(e,g)=>g.lighting.mainLight.environmentStrength)]);h.code.add(m.glsl`vec3 getSeaColor(in vec3 n, in vec3 v, in vec3 l, vec3 color, in vec3 lightIntensity, in vec3 localUp, in float shadow, float foamIntensity, vec3 viewPosition, vec3 position) {
float reflectionHit = 0.0;
float reflectionHitDiffused = 0.0;
vec3 seaWaterColor = linearizeGamma(color);
vec3 h = normalize(l + v);
shadingInfo.NdotL = clamp(dot(n, l), 0.0, 1.0);
shadingInfo.NdotV = clamp(dot(n, v), 0.001, 1.0);
shadingInfo.VdotN = clamp(dot(v, n), 0.001, 1.0);
shadingInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
shadingInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
shadingInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
float upDotV = max(dot(localUp,v), 0.0);
vec3 skyHorizon = linearizeGamma(skyColor);
vec3 skyZenit = linearizeGamma(skyZenitColor);
vec3 skyColor = getSkyGradientColor(upDotV, skyHorizon, skyZenit );
float upDotL = max(dot(localUp,l),0.0);
float daytimeMod = 0.1 + upDotL * 0.9;
skyColor *= daytimeMod;
float shadowModifier = clamp(shadow, 0.8, 1.0);
vec3 fresnelModifier = fresnelReflection(shadingInfo.VdotN, vec3(fresnelSky[0]), fresnelSky[1]);
vec3 reflSky = lightingEnvironmentStrength * fresnelModifier * skyColor * shadowModifier;
vec3 reflSea = seaWaterColor * mix(skyColor, upDotL * lightIntensity * LIGHT_NORMALIZATION, 2.0 / 3.0) * shadowModifier;
vec3 specular = vec3(0.0);
if(upDotV > 0.0 && upDotL > 0.0) {
vec3 specularSun = brdfSpecularWater(shadingInfo, roughness, vec3(fresnelMaterial[0]), fresnelMaterial[1]);
vec3 incidentLight = lightIntensity * LIGHT_NORMALIZATION * shadow;
specular = lightingSpecularStrength * shadingInfo.NdotL * incidentLight * specularSun;
}
vec3 foam = vec3(0.0);
if(upDotV > 0.0) {
foam = foamIntensity2FoamColor(foamIntensityExternal, foamIntensity, skyZenitColor, daytimeMod);
}
float correctionViewingFactor = pow(max(dot(v, localUp), 0.0), correctionViewingPowerFactor);
vec3 normalCorrectedClouds = mix(localUp, n, correctionViewingFactor);
vec3 reflectedWorld = normalize(reflect(-v, normalCorrectedClouds));`);d.hasCloudsReflections&&h.code.add(m.glsl`vec4 cloudsColor = renderClouds(reflectedWorld, position);
cloudsColor.a = 1.0 - cloudsColor.a;
cloudsColor = pow(cloudsColor, vec4(GAMMA));
cloudsColor *= clamp(fresnelModifier.y*cloudFresnelModifier[0] - cloudFresnelModifier[1], 0.0, 1.0) * clamp((1.0 - totalFadeInOut), 0.0, 1.0);`);d.hasScreenSpaceReflections?h.code.add(m.glsl`vec3 viewDir = normalize(viewPosition);
vec4 viewNormalVectorCoordinate = view *vec4(n, 0.0);
vec3 viewNormal = normalize(viewNormalVectorCoordinate.xyz);
vec4 viewUp = view *vec4(localUp, 0.0);
vec3 viewNormalCorrectedSSR = mix(viewUp.xyz, viewNormal, correctionViewingFactor);
vec3 reflected = normalize(reflect(viewDir, viewNormalCorrectedSSR));
vec3 hitCoordinate = screenSpaceIntersection(reflected, viewPosition, viewDir, viewUp.xyz);
vec3 reflectedColor = vec3(0.0);
if (hitCoordinate.z > 0.0)
{
vec2 reprojectedCoordinate = reprojectionCoordinate(hitCoordinate);
vec2 dCoords = smoothstep(0.3, 0.6, abs(vec2(0.5, 0.5) - hitCoordinate.xy));
float heightMod = smoothstep(ssrHeightFadeEnd, ssrHeightFadeStart, -viewPosition.z);
reflectionHit = clamp(1.0 - (1.3*dCoords.y), 0.0, 1.0) * heightMod;
reflectionHitDiffused = waterDiffusion * reflectionHit;
reflectedColor = linearizeGamma(texture2D(lastFrameColorMap, reprojectedCoordinate).xyz)* reflectionHitDiffused * fresnelModifier.y * ssrIntensity;
}
float seaColorMod =  mix(waterSeaColorMod, waterSeaColorMod*0.5, reflectionHitDiffused);
vec3 waterRenderedColor = tonemapACES((1.0 - reflectionHitDiffused) * reflSky + reflectedColor + reflSea * seaColorMod + specular  + foam);`):h.code.add(m.glsl`vec3 waterRenderedColor = tonemapACES(reflSky + reflSea * waterSeaColorMod + specular + foam);`);d.hasCloudsReflections?d.hasScreenSpaceReflections?h.code.add(m.glsl`return waterRenderedColor * (1.0 - (1.0 - reflectionHit) * cloudsColor.a) + (1.0 - reflectionHit) * cloudsColor.xyz;
}`):h.code.add(m.glsl`return waterRenderedColor * (1.0 - cloudsColor.a) + cloudsColor.xyz;
}`):h.code.add(m.glsl`return waterRenderedColor;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/FoamRendering.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.FoamColor=function(c){c.fragment.code.add(b.glsl`vec3 foamIntensity2FoamColor(float foamIntensityExternal, float foamPixelIntensity, vec3 skyZenitColor, float dayMod){
return foamIntensityExternal * (0.075 * skyZenitColor * pow(foamPixelIntensity, 4.) +  50.* pow(foamPixelIntensity, 23.0)) * dayMod;
}`)};a.FoamIntensity=function(c){c.fragment.code.add(b.glsl`float normals2FoamIntensity(vec3 n, float waveStrength){
float normalizationFactor =  max(0.015, waveStrength);
return max((n.x + n.y)*0.3303545/normalizationFactor + 0.3303545, 0.0);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl":function(){define(["exports","./AnalyticalSkyModel.glsl","./PhysicallyBasedRenderingParameters.glsl","./PiUtils.glsl","../../shaderModules/interfaces"],function(a,b,c,n,l){a.PhysicallyBasedRendering=function(u,v){const m=u.fragment.code;u.include(n.PiUtils);if(v.pbrMode===c.PBRMode.Water||v.pbrMode===c.PBRMode.WaterOnIntegratedMesh)m.add(l.glsl`
    struct PBRShadingWater
    {
        float NdotL;   // cos angle between normal and light direction
        float NdotV;   // cos angle between normal and view direction
        float NdotH;   // cos angle between normal and half vector
        float VdotH;   // cos angle between view direction and half vector
        float LdotH;   // cos angle between light direction and half vector
        float VdotN;   // cos angle between view direction and normal vector
    };

    float dtrExponent = ${v.useCustomDTRExponentForWater?"2.2":"2.0"};
    `),m.add(l.glsl`vec3 fresnelReflection(float angle, vec3 f0, float f90) {
return f0 + (f90 - f0) * pow(1.0 - angle, 5.0);
}`),m.add(l.glsl`float normalDistributionWater(float NdotH, float roughness)
{
float r2 = roughness * roughness;
float NdotH2 = NdotH * NdotH;
float denom = pow((NdotH2 * (r2 - 1.0) + 1.0), dtrExponent) * PI;
return r2 / denom;
}`),m.add(l.glsl`float geometricOcclusionKelemen(float LoH)
{
return 0.25 / (LoH * LoH);
}`),m.add(l.glsl`vec3 brdfSpecularWater(in PBRShadingWater props, float roughness, vec3 F0, float F0Max)
{
vec3  F = fresnelReflection(props.VdotH, F0, F0Max);
float dSun = normalDistributionWater(props.NdotH, roughness);
float V = geometricOcclusionKelemen(props.LdotH);
float diffusionSunHaze = mix(roughness + 0.045, roughness + 0.385, 1.0 - props.VdotH);
float strengthSunHaze  = 1.2;
float dSunHaze = normalDistributionWater(props.NdotH, diffusionSunHaze)*strengthSunHaze;
return ((dSun + dSunHaze) * V) * F;
}
vec3 tonemapACES(const vec3 x) {
return (x * (2.51 * x + 0.03)) / (x * (2.43 * x + 0.59) + 0.14);
}`);else if(v.pbrMode===c.PBRMode.Normal||v.pbrMode===c.PBRMode.Schematic)u.include(b.AnalyticalSkyModel),m.add(l.glsl`struct PBRShadingInfo
{
float NdotL;
float NdotV;
float NdotH;
float VdotH;
float LdotH;
float NdotNG;
float RdotNG;
float NdotAmbDir;
float NdotH_Horizon;
vec3 skyRadianceToSurface;
vec3 groundRadianceToSurface;
vec3 skyIrradianceToSurface;
vec3 groundIrradianceToSurface;
float averageAmbientRadiance;
float ssao;
vec3 albedoLinear;
vec3 f0;
vec3 f90;
vec3 diffuseColor;
float metalness;
float roughness;
};`),m.add(l.glsl`float normalDistribution(float NdotH, float roughness)
{
float a = NdotH * roughness;
float b = roughness / (1.0 - NdotH * NdotH + a * a);
return b * b * INV_PI;
}`),m.add(l.glsl`const vec4 c0 = vec4(-1.0, -0.0275, -0.572,  0.022);
const vec4 c1 = vec4( 1.0,  0.0425,  1.040, -0.040);
const vec2 c2 = vec2(-1.04, 1.04);
vec2 prefilteredDFGAnalytical(float roughness, float NdotV) {
vec4 r = roughness * c0 + c1;
float a004 = min(r.x * r.x, exp2(-9.28 * NdotV)) * r.x + r.y;
return c2 * a004 + r.zw;
}`),m.add(l.glsl`vec3 evaluateEnvironmentIllumination(PBRShadingInfo inputs) {
vec3 indirectDiffuse = evaluateDiffuseIlluminationHemisphere(inputs.groundIrradianceToSurface, inputs.skyIrradianceToSurface, inputs.NdotNG);
vec3 indirectSpecular = evaluateSpecularIlluminationHemisphere(inputs.groundRadianceToSurface, inputs.skyRadianceToSurface, inputs.RdotNG, inputs.roughness);
vec3 diffuseComponent = inputs.diffuseColor * indirectDiffuse * INV_PI;
vec2 dfg = prefilteredDFGAnalytical(inputs.roughness, inputs.NdotV);
vec3 specularColor = inputs.f0 * dfg.x + inputs.f90 * dfg.y;
vec3 specularComponent = specularColor * indirectSpecular;
return (diffuseComponent + specularComponent);
}`),m.add(l.glsl`float gamutMapChanel(float x, vec2 p){
return (x < p.x) ? mix(0.0, p.y, x/p.x) : mix(p.y, 1.0, (x - p.x) / (1.0 - p.x) );
}`),m.add(l.glsl`vec3 blackLevelSoftCompression(vec3 inColor, PBRShadingInfo inputs){
vec3 outColor;
vec2 p = vec2(0.02 * (inputs.averageAmbientRadiance), 0.0075 * (inputs.averageAmbientRadiance));
outColor.x = gamutMapChanel(inColor.x, p) ;
outColor.y = gamutMapChanel(inColor.y, p) ;
outColor.z = gamutMapChanel(inColor.z, p) ;
return outColor;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/AnalyticalSkyModel.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.AnalyticalSkyModel=function(c){c=c.fragment.code;c.add(b.glsl`vec3 evaluateDiffuseIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float NdotNG)
{
return ((1.0 - NdotNG) * ambientGround + (1.0 + NdotNG) * ambientSky) * 0.5;
}`);c.add(b.glsl`float integratedRadiance(float cosTheta2, float roughness)
{
return (cosTheta2 - 1.0) / (cosTheta2 * (1.0 - roughness * roughness) - 1.0);
}`);c.add(b.glsl`vec3 evaluateSpecularIlluminationHemisphere(vec3 ambientGround, vec3 ambientSky, float RdotNG, float roughness)
{
float cosTheta2 = 1.0 - RdotNG * RdotNG;
float intRadTheta = integratedRadiance(cosTheta2, roughness);
float ground = RdotNG < 0.0 ? 1.0 - intRadTheta : 1.0 + intRadTheta;
float sky = 2.0 - ground;
return (ground * ambientGround + sky * ambientSky) * 0.5;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/WaterDistortion.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ./FoamRendering.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d){const e=l.create(),g=c.create();a.WaterDistortion=function(p){p.fragment.uniforms.add(new d.Texture2DUniform("texWaveNormal"));p.fragment.uniforms.add(new d.Texture2DUniform("texWavePerturbation"));p.fragment.uniforms.add([new m.Float4PassUniform("waveParams",t=>n.set(e,t.waveStrength,t.waveTextureRepeat,t.flowStrength,t.flowOffset)),new v.Float2PassUniform("waveDirection",t=>b.set(g,t.waveDirection[0]*t.waveVelocity,t.waveDirection[1]*t.waveVelocity))]);p.include(u.FoamIntensity);
p.fragment.code.add(h.glsl`const vec2  FLOW_JUMP = vec2(6.0/25.0, 5.0/24.0);
vec2 textureDenormalized2D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rg - 1.0;
}
float sampleNoiseTexture(vec2 _uv) {
return texture2D(texWavePerturbation, _uv).b;
}
vec3 textureDenormalized3D(sampler2D _tex, vec2 _uv) {
return 2.0 * texture2D(_tex, _uv).rgb - 1.0;
}
float computeProgress(vec2 uv, float time) {
return fract(time);
}
float computeWeight(vec2 uv, float time) {
float progress = computeProgress(uv, time);
return 1.0 - abs(1.0 - 2.0 * progress);
}
vec3 computeUVPerturbedWeigth(sampler2D texFlow, vec2 uv, float time, float phaseOffset) {
float flowStrength = waveParams[2];
float flowOffset = waveParams[3];
vec2 flowVector = textureDenormalized2D(texFlow, uv) * flowStrength;
float progress = computeProgress(uv, time + phaseOffset);
float weight = computeWeight(uv, time + phaseOffset);
vec2 result = uv;
result -= flowVector * (progress + flowOffset);
result += phaseOffset;
result += (time - progress) * FLOW_JUMP;
return vec3(result, weight);
}
const float TIME_NOISE_TEXTURE_REPEAT = 0.3737;
const float TIME_NOISE_STRENGTH = 7.77;
vec3 getWaveLayer(sampler2D _texNormal, sampler2D _dudv, vec2 _uv, vec2 _waveDir, float time) {
float waveStrength = waveParams[0];
vec2 waveMovement = time * -_waveDir;
float timeNoise = sampleNoiseTexture(_uv * TIME_NOISE_TEXTURE_REPEAT) * TIME_NOISE_STRENGTH;
vec3 uv_A = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.0);
vec3 uv_B = computeUVPerturbedWeigth(_dudv, _uv + waveMovement, time + timeNoise, 0.5);
vec3 normal_A = textureDenormalized3D(_texNormal, uv_A.xy) * uv_A.z;
vec3 normal_B = textureDenormalized3D(_texNormal, uv_B.xy) * uv_B.z;
vec3 mixNormal = normalize(normal_A + normal_B);
mixNormal.xy *= waveStrength;
mixNormal.z = sqrt(1.0 - dot(mixNormal.xy, mixNormal.xy));
return mixNormal;
}
vec4 getSurfaceNormalAndFoam(vec2 _uv, float _time) {
float waveTextureRepeat = waveParams[1];
vec3 normal = getWaveLayer(texWaveNormal, texWavePerturbation, _uv * waveTextureRepeat, waveDirection, _time);
float foam  = normals2FoamIntensity(normal, waveParams[0]);
return vec4(normal, foam);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/DefaultBufferWriter":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../lib/VertexAttribute","./bufferWriterUtils"],function(a,b,c,n){const l=b.newLayout().vec3f(c.VertexAttribute.POSITION),u=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec2f(c.VertexAttribute.UV0);b=b.newLayout().vec3f(c.VertexAttribute.POSITION).vec4u8(c.VertexAttribute.COLOR);
let v=function(){function m(d){this.vertexBufferLayout=d}var h=m.prototype;h.allocate=function(d){return this.vertexBufferLayout.createBuffer(d)};h.elementCount=function(d){return d.indices.get(c.VertexAttribute.POSITION).length};h.write=function(d,e,g,p){n.writeDefaultAttributes(e,this.vertexBufferLayout,d.transformation,d.invTranspTransformation,g,p)};return m}();a.DefaultBufferWriter=v;a.PositionColorLayout=b;a.PositionLayout=l;a.PositionUVLayout=u;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/Instance":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){function c(v,m){return v.from===m.from?v.to-m.to:v.from-m.from}let n=function(v){this.first=v.from;this.count=v.to-v.from},l=function(v=0,m=0){this.from=v;this.to=m},u=function(v){function m(h,d,e,g,p,t){d=v.call(this,d,e)||this;d.id=h;d.isVisible=g;d.hasHighlights=p;d.hasOccludees=t;return d}b._inheritsLoose(m,
v);return m}(l);a.BufferRange=l;a.DrawCommand=n;a.Instance=u;a.addOrMerge=function(v,m){if(0===v.length)v.push(new n(m));else{var h=v[v.length-1];h.first+h.count>=m.from?h.count=m.from-h.first+m.to-m.from:v.push(new n(m))}};a.sortInstancesByRange=function(v){return Array.from(v.values()).sort(c)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBuffer":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],
function(a,b){function c(l,u,v){return u<=v?l>=v?l:65536*Math.ceil(Math.max(2*l,v)/65536):l<=2*v?l:65536*Math.ceil(v/65536)}let n=function(){function l(v,m){this._pool=v;this._size=0;this._buffer=v.newBuffer(65536*Math.ceil(m/65536))}var u=l.prototype;u.dispose=function(){this._buffer=this._pool.deleteBuffer(this._buffer);this._size=0};u.release=function(){this.erase(0,this._size);this.dispose()};u.grow=function(v){this._resize(this._size+v,!0).dispose()};u.alloc=function(v){return this._resize(v,
!1)};u._resize=function(v,m){let h;const d=c(this._buffer.length,this._size,v);if(this._buffer.length!==d){const g=this._pool.newBuffer(d);m&&(g.array.set(this._buffer.array.subarray(0,Math.min(this._size,d))),g.vao.vertexBuffers.geometry.setSubData(g.array,0,0,g.array.byteLength));h=this._buffer;this._buffer=g}const e=this._size;this._size=v;return h?{dispose:()=>{h.array.fill(0,0,e);this._pool.deleteBuffer(h)},copy:(g,p,t)=>this._buffer.array.set(h.array.subarray(p,t),g),hasNewBuffer:!0}:{dispose:()=>
{},copy:(g,p,t)=>{g!==p&&this._buffer.array.copyWithin(g,p,t)},hasNewBuffer:!1}};u.erase=function(v,m){this._buffer.array.fill(0,v,m)};b._createClass(l,[{key:"vao",get:function(){return this._buffer.vao}},{key:"array",get:function(){return this._buffer.array}},{key:"size",get:function(){return this._size}}]);return l}();a.MergedGeometryBuffer=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/renderers/MergedGeometryBufferPool":function(){define(["exports",
"../../../../../core/maybe","../../../../../core/MemCache","../../../../../core/uid","../../lib/StaticFloat32ArrayObject"],function(a,b,c,n,l){function u(h,d){if(d===c.RemoveMode.ALL)h.forEach(e=>e.dispose());else return d=h.pop(),h=h.length*d.array.byteLength,d.dispose(),h}const v=c.MIN_PRIORITY+1;let m=function(){function h(e,g,p){this._rctx=e;this._locations=g;this._layout=p;this._cache=e.newCache(`MergedRenderer pool ${n.generateUID()}`,u)}var d=h.prototype;d.dispose=function(){this._cache.destroy()};
d.newBuffer=function(e){const g=e.toString(),p=this._cache.pop(g);return b.isSome(p)?(e=p.pop(),0<p.length&&this._cache.put(g,p,e.array.byteLength*p.length,v),e):new l.StaticFloat32ArrayObject(this._rctx,this._locations,this._layout,e)};d.deleteBuffer=function(e){const g=e.array.byteLength,p=e.array.length.toString(),t=this._cache.pop(p);b.isSome(t)?(t.push(e),this._cache.put(p,t,g*t.length,-1)):this._cache.put(p,[e],g,-1);return null};return h}();a.MergedGeometryBufferPool=m;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/StaticFloat32ArrayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../webgl/BufferObject","../../../webgl/enums","../../../webgl/VertexArrayObject"],function(a,b,c,n,l){let u=function(){function v(m,h,d,e){this.vao=new l.VertexArrayObject(m,h,{geometry:d},{geometry:c.BufferObject.createVertex(m,n.Usage.STATIC_DRAW)});this.array=new Float32Array(e);this.vao.vertexBuffers.geometry.setSize(this.array.byteLength)}
v.prototype.dispose=function(){this.vao.dispose(!0)};b._createClass(v,[{key:"length",get:function(){return this.array.length}}]);return v}();a.StaticFloat32ArrayObject=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOHelper":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../support/requestImageUtils ../core/shaderModules/interfaces ./glUtil3D ./SSAOTechnique ./SSAOTechniqueConfiguration ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){let q=function(){function r(f,w,z){this._techniqueRep=f;this._rctx=w;this._requestRender=z;this._enabled=!1;this._ssaoTechniqueConfig=new d.SSAOTechniqueConfiguration;this.quadVAO=null;this._blurSizePx=2;this._attenuation=.5}var y=r.prototype;y.dispose=function(){this.quadVAO=n.disposeMaybe(this.quadVAO)};y.disposeOffscreenBuffers=function(){n.applySome(this._ssaoFBO,f=>f.resize(0,0));n.applySome(this._blur0FBO,f=>f.resize(0,0));n.applySome(this._blur1FBO,f=>
f.resize(0,0))};y.computeSSAO=function(f,w,z){if(!(!this.enabled||n.isNone(w)||n.isNone(z)||n.isNone(this._noiseTexture)||n.isNone(this._ssaoFBO)||n.isNone(this._blur0FBO)||n.isNone(this._blur1FBO))){var A=this._rctx,x=f.camera,B=x.fullViewport,C=B[2],D=B[3],E=C/this._blurSizePx,F=D/this._blurSizePx;this._ssaoFBO.resize(C,D);this._blur0FBO.resize(E,F);this._blur1FBO.resize(E,F);E=1*C;F=1*D;A.bindFramebuffer(this._ssaoFBO);A.setViewport(0,0,C,D);var G=A.bindTechnique(this._ssaoTechnique,k,f);G.setUniform2f("rnmScale",
C/this._noiseTexture.descriptor.width,D/this._noiseTexture.descriptor.height);C=1/x.computeRenderPixelSizeAtDist(1);G.setUniform1f("projScale",1*C);G.setUniform2f("screenSize",E,F);D=l.distance(x.eye,x.center);x=20*x.computeRenderPixelSizeAtDist(D);x=Math.max(.1,x);G.setUniform1f("radius",x);G.setUniform1f("intensity",4*this._attenuation/x**6);G.bindTexture("rnm",this._noiseTexture);G.bindTexture("normalMap",z);G.bindTexture("depthMap",w);n.isNone(this.quadVAO)&&(this.quadVAO=m.createQuadVAO(this._rctx));
A.bindVAO(this.quadVAO);A.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,t.vertexCount(this.quadVAO,"geometry"));f=A.bindTechnique(this._blurTechnique,k,f);f.bindTexture("tex",this._ssaoFBO.colorTexture);f.bindTexture("normalMap",z);f.bindTexture("depthMap",w);A.setViewport(0,0,E/this._blurSizePx,F/this._blurSizePx);A.bindFramebuffer(this._blur0FBO);f.setUniform2f("screenSize",E,F);f.setUniform2f("blurSize",0,1*this._blurSizePx/F);5E4<D&&(C=Math.max(0,C-(D-5E4)));f.setUniform1f("projScale",C);A.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,
0,t.vertexCount(this.quadVAO,"geometry"));f.setUniform2f("blurSize",1*this._blurSizePx/E,0);A.bindFramebuffer(this._blur1FBO);f.bindTexture("tex",this._blur0FBO.colorTexture);A.drawArrays(e.PrimitiveType.TRIANGLE_STRIP,0,t.vertexCount(this.quadVAO,"geometry"));A.setViewport(B[0],B[1],B[2],B[3])}};y._selectPrograms=function(){this._ssaoTechniqueConfig.output=d.SSAOOutput.SSAO;this._ssaoTechnique=this._techniqueRep.releaseAndAcquire(h.SSAOTechnique,this._ssaoTechniqueConfig,this._ssaoTechnique);this._ssaoTechniqueConfig.output=
d.SSAOOutput.Blur;this._blurTechnique=this._techniqueRep.releaseAndAcquire(h.SSAOTechnique,this._ssaoTechniqueConfig,this._blurTechnique)};y._enable=function(){this.enabled||(this._enabled=!0,this._loadResources(()=>{this._enabled&&this._initialize()}))};y._loadResources=function(f){this._data?f():(new Promise((w,z)=>a(["./SSAOHelperData"],w,z))).then(w=>{this._data=w;f()})};y._initialize=function(){const f={target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGBA,dataType:e.PixelType.UNSIGNED_BYTE,
samplingMode:e.TextureSamplingMode.LINEAR,wrapMode:e.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0},w={colorTarget:e.TargetType.TEXTURE,depthStencilTarget:e.DepthStencilTargetType.NONE};u.requestImage(this._data.noiseTexture).then(z=>{this._enabled&&(this._ssaoFBO=new g.FramebufferObject(this._rctx,w,f),this._blur0FBO=new g.FramebufferObject(this._rctx,w,f),this._blur1FBO=new g.FramebufferObject(this._rctx,w,f),this._noiseTexture=new p.Texture(this._rctx,{target:e.TextureType.TEXTURE_2D,pixelFormat:e.PixelFormat.RGBA,
dataType:e.PixelType.UNSIGNED_BYTE,hasMipmap:!0,width:z.width,height:z.height},z),this._requestRender())});this._selectPrograms()};y._disable=function(){this._enabled=!1;this._noiseTexture=n.disposeMaybe(this._noiseTexture);this._blur1FBO=n.disposeMaybe(this._blur1FBO);this._blur0FBO=n.disposeMaybe(this._blur0FBO);this._ssaoFBO=n.disposeMaybe(this._ssaoFBO)};c._createClass(r,[{key:"enabled",get:function(){return this._enabled},set:function(f){f?this._enable():this._disable()}},{key:"ready",get:function(){return this.enabled&&
n.isSome(this._noiseTexture)&&n.isSome(this._ssaoFBO)&&n.isSome(this._blur0FBO)&&n.isSome(this._blur1FBO)}},{key:"colorTexture",get:function(){return n.isSome(this._blur1FBO)?this._blur1FBO.colorTexture:null}},{key:"width",get:function(){return n.isSome(this._ssaoFBO)?this._ssaoFBO.width:-1}},{key:"height",get:function(){return n.isSome(this._ssaoFBO)?this._ssaoFBO.height:-1}},{key:"gpuMemoryUsage",get:function(){return(n.isSome(this._blur0FBO)?this._blur0FBO.gpuMemoryUsage:0)+(n.isSome(this._blur1FBO)?
this._blur1FBO.gpuMemoryUsage:0)+(n.isSome(this._ssaoFBO)?this._ssaoFBO.gpuMemoryUsage:0)}},{key:"test",get:function(){return{ssao:this._ssaoFBO,blur:this._blur1FBO}}}]);return r}();const k=new v.NoParameters;b.SSAOHelper=q;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SSAO.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h){l=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var g=e.prototype;g.initializeProgram=function(p){const t=e.shader.get().build(this.configuration);return new v.Program(p.rctx,t,u.Default3D)};g.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return e}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(m.SSAO,()=>new Promise((d,e)=>a(["../shaders/SSAO.glsl"],d,e)));b.SSAOTechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SSAO.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float2Uniform ../views/3d/webgl-engine/core/shaderModules/FloatUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/SSAOTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(q){const k=new h.ShaderBuilder,r=k.fragment;k.include(b.ScreenSpacePass);if(q.output===e.SSAOOutput.Blur){var y=(p.filterRadius+1)/2;y=1/(2*y*y);r.include(c.ReadLinearDepth);r.uniforms.add([new d.Texture2DUniform("normalMap"),new d.Texture2DUniform("depthMap"),new d.Texture2DUniform("tex"),new u.Float2Uniform("blurSize"),new v.FloatUniform("projScale"),new l.Float2PassUniform("nearFar",(f,w)=>w.camera.nearFar)]);r.code.add(m.glsl`
      void blurFunction(vec2 uv, float r, float center_d, float sharpness, inout float wTotal, inout float bTotal) {
        float c = texture2D(tex, uv).r;
        float d = linearDepthFromTexture(depthMap, uv, nearFar);

        float ddiff = d - center_d;

        float w = exp(-r * r * ${m.glsl.float(y)} - ddiff * ddiff * sharpness);
        wTotal += w;
        bTotal += w * c;
      }
    `);r.code.add(m.glsl`
      void main(void) {
        float b = 0.0;
        float w_total = 0.0;

        float center_d = linearDepthFromTexture(depthMap, uv, nearFar);

        float sharpness = -0.05 * projScale/center_d;
        for (int r = -${m.glsl.int(p.filterRadius)}; r <= ${m.glsl.int(p.filterRadius)}; ++r) {
          float rf = float(r);
          vec2 uvOffset = uv + rf * blurSize;
          blurFunction(uvOffset, rf, center_d, sharpness, w_total, b);
        }

        gl_FragColor = vec4(b / w_total);
      }
    `)}q.output===e.SSAOOutput.SSAO&&(r.include(c.ReadLinearDepth),k.include(n.CameraSpace),r.uniforms.add(new d.Texture2DUniform("normalMap")),r.uniforms.add(new d.Texture2DUniform("depthMap")),r.uniforms.add(new d.Texture2DUniform("rnm")),r.uniforms.add(new v.FloatUniform("intensity")),r.uniforms.add(new v.FloatUniform("projScale")),r.uniforms.add(new v.FloatUniform("radius")),r.uniforms.add(new l.Float2PassUniform("nearFar",(f,w)=>w.camera.nearFar)),r.uniforms.add(new u.Float2Uniform("screenSize")),
r.uniforms.add(new u.Float2Uniform("rnmScale")),r.code.add(m.glsl`vec3 sphere[16];
void fillSphere() {
sphere[0] = vec3(0.186937, 0.0, 0.0);
sphere[1] = vec3(0.700542, 0.0, 0.0);
sphere[2] = vec3(-0.864858, -0.481795, -0.111713);
sphere[3] = vec3(-0.624773, 0.102853, -0.730153);
sphere[4] = vec3(-0.387172, 0.260319, 0.007229);
sphere[5] = vec3(-0.222367, -0.642631, -0.707697);
sphere[6] = vec3(-0.01336, -0.014956, 0.169662);
sphere[7] = vec3(0.122575, 0.1544, -0.456944);
sphere[8] = vec3(-0.177141, 0.85997, -0.42346);
sphere[9] = vec3(-0.131631, 0.814545, 0.524355);
sphere[10] = vec3(-0.779469, 0.007991, 0.624833);
sphere[11] = vec3(0.308092, 0.209288,0.35969);
sphere[12] = vec3(0.359331, -0.184533, -0.377458);
sphere[13] = vec3(0.192633, -0.482999, -0.065284);
sphere[14] = vec3(0.233538, 0.293706, -0.055139);
sphere[15] = vec3(0.417709, -0.386701, 0.442449);
}
float fallOffFunction(float vv, float vn, float bias) {
float f = max(radius * radius - vv, 0.0);
return f * f * f * max(vn-bias, 0.0);
}`),r.code.add(m.glsl`float aoValueFromPositionsAndNormal(vec3 C, vec3 n_C, vec3 Q) {
vec3 v = Q - C;
float vv = dot(v, v);
float vn = dot(normalize(v), n_C);
return fallOffFunction(vv, vn, 0.1);
}`),k.fragment.uniforms.add(new l.Float2PassUniform("zScale",(f,w)=>n.getZScale(w))),r.code.add(m.glsl`
      void main(void) {
        fillSphere();
        vec3 fres = normalize((texture2D(rnm, uv * rnmScale).xyz * 2.0) - vec3(1.0));
        float currentPixelDepth = linearDepthFromTexture(depthMap, uv, nearFar);

        if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
          gl_FragColor = vec4(0.0);
          return;
        }

        vec3 currentPixelPos = reconstructPosition(gl_FragCoord.xy,currentPixelDepth);

        // get the normal of current fragment
        vec4 norm4 = texture2D(normalMap, uv);
        vec3 norm = vec3(-1.0) + 2.0 * norm4.xyz;
        bool isTerrain = norm4.w<0.5;

        float sum = .0;
        vec3 tapPixelPos;

        // note: the factor 2.0 should not be necessary, but makes ssao much nicer.
        // bug or deviation from CE somewhere else?
        float ps = projScale/(2.0 * currentPixelPos.z * zScale.x + zScale.y);

        for(int i = 0; i < ${m.glsl.int(p.samples)}; ++i) {
          vec2 unitOffset = reflect(sphere[i], fres).xy;
          vec2 offset = vec2(-unitOffset * radius * ps);

          //don't use current or very nearby samples
          if ( abs(offset.x)<2.0 || abs(offset.y)<2.0) continue;

          vec2 tc = vec2(gl_FragCoord.xy + offset);
          if (tc.x < 0.0 || tc.y < 0.0 || tc.x > screenSize.x || tc.y > screenSize.y) continue;
          vec2 tcTap = tc / screenSize;
          float occluderFragmentDepth = linearDepthFromTexture(depthMap, tcTap, nearFar);

          if (isTerrain) {
            bool isTerrainTap = texture2D(normalMap, tcTap).w<0.5;
            if (isTerrainTap) {
              continue;
            }
          }

          tapPixelPos = reconstructPosition(tc, occluderFragmentDepth);

          sum+= aoValueFromPositionsAndNormal(currentPixelPos, norm, tapPixelPos);
        }

        // output the result
        float A = max(1.0-sum*intensity/float(${m.glsl.int(p.samples)}),0.0);

        // Anti-tone map to reduce contrast and drag dark region farther: (x^0.2 + 1.2 * x^4)/2.2
        A = (pow(A, 0.2) + 1.2 * A*A*A*A) / 2.2;
        gl_FragColor = vec4(A);
      }
    `));return k}const p={samples:16,filterRadius:4},t=Object.freeze(Object.defineProperty({__proto__:null,build:g},Symbol.toStringTag,{value:"Module"}));a.SSAO=t;a.build=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl":function(){define("exports ../../../../../../chunks/vec2 ../../../../../../chunks/vec2f64 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float2PassUniform ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces".split(" "),
function(a,b,c,n,l,u,v,m){function h(g){return 0===g.camera.projectionMatrix[11]?b.set(e,0,1):b.set(e,1,0)}const d=l.create(),e=c.create();a.CameraSpace=function(g){g.fragment.uniforms.add(new v.Float4PassUniform("projInfo",(p,t)=>{p=t.camera.projectionMatrix;t=0===p[11]?n.set(d,2/(t.camera.fullWidth*p[0]),2/(t.camera.fullHeight*p[5]),(1+p[12])/p[0],(1+p[13])/p[5]):n.set(d,-2/(t.camera.fullWidth*p[0]),-2/(t.camera.fullHeight*p[5]),(1-p[8])/p[0],(1-p[9])/p[5]);return t}));g.fragment.uniforms.add(new u.Float2PassUniform("zScale",
(p,t)=>h(t)));g.fragment.code.add(m.glsl`vec3 reconstructPosition(vec2 fragCoord, float depth) {
return vec3((fragCoord * projInfo.xy + projInfo.zw) * (zScale.x * depth + zScale.y), depth);
}`)};a.getZScale=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SSAOTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){a.SSAOOutput=void 0;(function(u){u[u.SSAO=0]="SSAO";u[u.Blur=1]="Blur";u[u.COUNT=2]="COUNT"})(a.SSAOOutput||(a.SSAOOutput={}));let l=function(u){function v(){var m=
u.apply(this,arguments)||this;m.output=a.SSAOOutput.SSAO;return m}b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.SSAOOutput.COUNT})],l.prototype,"output",void 0);a.SSAOTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/TextureOnly.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d){u=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);var p=g.prototype;p.initializeProgram=function(t){const q=g.shader.get().build();return new m.Program(t.rctx,q,v.Default3D)};p.initializePipeline=function(){return this.configuration.hasAlpha?d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams}):
d.makePipelineState({colorWrite:d.defaultColorWriteParams})};return g}(u.ShaderTechnique);u.shader=new l.ReloadableShaderModule(n.TextureOnlyShader,()=>new Promise((e,g)=>a(["../core/shaderLibrary/util/TextureOnly.glsl"],e,g)));b.TextureTechnique=u;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/TextureOnly.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform".split(" "),
function(a,b,c,n,l,u){function v(){const h=new l.ShaderBuilder;h.include(b.ScreenSpacePass);h.fragment.uniforms.add([new u.Texture2DUniform("tex"),new c.Float4Uniform("uColor")]);h.fragment.code.add(n.glsl`void main() {
vec4 texColor = texture2D(tex, uv);
gl_FragColor = texColor * uColor;
}`);return h}const m=Object.freeze(Object.defineProperty({__proto__:null,build:v},Symbol.toStringTag,{value:"Module"}));a.TextureOnlyShader=m;a.build=v})},"esri/views/3d/webgl-engine/lib/TextureTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.hasAlpha=!1;return m}b._inheritsLoose(v,
u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter()],l.prototype,"hasAlpha",void 0);a.TextureTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/StippleTextureRepository":function(){define(["exports","../../../../core/floatRGBA","../../../../core/maybe","../../../webgl/enums","../../../webgl/Texture"],function(a,b,c,n,l){function u(m,h){var d=m.map(k=>Math.round(k*h)),e=1/h;
m=Math.floor(d.reduce((k,r)=>k+r));var g=d.reduce((k,r)=>Math.max(k,r));g=(Math.floor(.5*(g-1))+.5)*e;var p=[];let t=1;for(var q of d){for(let k=0;k<q;k++)p.push(t*(Math.min(k,q-1-k)+.5)*e/g*.5+.5);t=-t}q=Math.round(d[0]/2);q=[...p.slice(q),...p.slice(0,q)];d=m+2;e=new Uint8Array(4*d);p=4;for(const k of q)b.packFloatRGBA(k,e,p),p+=4;e.copyWithin(0,p-4,p);e.copyWithin(p,4,8);return{encodedData:e,sdfNormalizer:g,paddedPixels:d,pixels:m}}let v=function(){function m(d){this._rctx=d;this.cache=new Map}
var h=m.prototype;h.dispose=function(){this.cache.forEach(d=>d.texture=c.disposeMaybe(d.texture));this.cache.clear()};h._acquire=function(d){if(c.isNone(d))return null;const e=this._patternId(d);var g=this.cache.get(e);if(g)return g.refCount++,g.bind;g=d.pixelRatio;const {encodedData:p,sdfNormalizer:t,pixels:q,paddedPixels:k}=u(d.pattern,g),r=q/g,y={refCount:1,texture:null,bind:f=>{c.isNone(y.texture)&&(y.texture=new l.Texture(this._rctx,{width:k,height:1,internalFormat:n.PixelFormat.RGBA,pixelFormat:n.PixelFormat.RGBA,
dataType:n.PixelType.UNSIGNED_BYTE,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE},p));f.bindTexture("stipplePatternTexture",y.texture);return{pixelSize:r,sdfNormalizer:t,pixels:q}}};this.cache.set(e,y);return y.bind};h.release=function(d){if(!c.isNone(d)){d=this._patternId(d);var e=this.cache.get(d);e&&(e.refCount--,0===e.refCount&&(c.isSome(e.texture)&&e.texture.dispose(),this.cache.delete(d)))}};h.swap=function(d,e){e=this._acquire(e);this.release(d);return e};h._patternId=function(d){return`${d.pattern.join(",")}-r${d.pixelRatio}`};
return m}();a.StippleTextureRepository=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){a.CompositingFunction=void 0;(function(u){u[u.Standard=0]="Standard";u[u.TransparentToHUDVisibility=1]="TransparentToHUDVisibility";
u[u.Transparency=2]="Transparency";u[u.OverlayWithTransparency=3]="OverlayWithTransparency";u[u.COUNT=4]="COUNT"})(a.CompositingFunction||(a.CompositingFunction={}));a.AlphaMode=void 0;(function(u){u[u.None=0]="None";u[u.Alpha=1]="Alpha";u[u.PremultipliedAlpha=2]="PremultipliedAlpha";u[u.COUNT=3]="COUNT"})(a.AlphaMode||(a.AlphaMode={}));let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.function=a.CompositingFunction.Standard;m.alphaMode=a.AlphaMode.None;m.hasOpacityFactor=!1;return m}
b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.CompositingFunction.COUNT})],l.prototype,"function",void 0);c.__decorate([n.parameter({count:a.AlphaMode.COUNT})],l.prototype,"alphaMode",void 0);c.__decorate([n.parameter()],l.prototype,"hasOpacityFactor",void 0);a.CompositingTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../lib/basicInterfaces ../lib/GLTextureMaterial ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderPass ../lib/RenderSlot ../lib/VertexAttribute ../lib/verticalOffsetUtils ./internal/bufferWriterUtils ./internal/MaterialUtil ../shaders/DefaultMaterialTechnique ../shaders/DefaultMaterialTechniqueConfiguration ../shaders/RealisticTreeTechnique".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B){function C(I){let P=v.newLayout();P=I.instancedDoublePrecision?P.vec3f(y.VertexAttribute.MODELORIGINHI).vec3f(y.VertexAttribute.MODELORIGINLO).mat3f(y.VertexAttribute.MODEL).mat3f(y.VertexAttribute.MODELNORMAL):P.mat4f(y.VertexAttribute.MODEL).mat4f(y.VertexAttribute.MODELNORMAL);c.isSome(I.instanced)&&I.instanced.includes("color")&&(P=P.vec4f(y.VertexAttribute.INSTANCECOLOR));c.isSome(I.instanced)&&I.instanced.includes("featureAttribute")&&
(P=P.vec4f(y.VertexAttribute.INSTANCEFEATUREATTRIBUTE));return P}t=function(I){function P(V){var S=I.call(this,V,E)||this;S.supportsEdges=!0;S.techniqueConfig=new x.DefaultMaterialTechniqueConfiguration;{var T=S.parameters;const H=T.textureId||T.normalTextureId||T.metallicRoughnessTextureId||T.emissiveTextureId||T.occlusionTextureId,U=v.newLayout().vec3f(y.VertexAttribute.POSITION).vec3f(y.VertexAttribute.NORMAL);T.hasVertexTangents&&U.vec4f(y.VertexAttribute.TANGENT);H&&U.vec2f(y.VertexAttribute.UV0);
T.hasVertexColors&&U.vec4u8(y.VertexAttribute.COLOR);T.hasSymbolColors&&U.vec4u8(y.VertexAttribute.SYMBOLCOLOR);T=U}S.vertexBufferLayout=T;S.instanceBufferLayout=V.instanced?C(S.parameters):null;return S}b._inheritsLoose(P,I);var N=P.prototype;N.isVisibleInPass=function(V){return V===k.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||V===k.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||V===k.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};N.isVisible=function(){var V=this.parameters;
if(!I.prototype.isVisible.call(this)||0===V.layerOpacity)return!1;const {instanced:S,hasVertexColors:T,hasSymbolColors:H,vvColorEnabled:U}=V,W=c.isSome(S)&&S.includes("color"),Q="replace"===V.colorMixMode,X=0<V.opacity;V=V.externalColor&&0<V.externalColor[3];return T&&(W||U||H)?Q?!0:X:T?Q?V:X:W||U||H?Q?!0:X:Q?V:X};N.getConfiguration=function(V,S){this.techniqueConfig.output=V;this.techniqueConfig.hasNormalTexture=!!this.parameters.normalTextureId;this.techniqueConfig.hasColorTexture=!!this.parameters.textureId;
this.techniqueConfig.hasVertexTangents=this.parameters.hasVertexTangents;this.techniqueConfig.instanced=!!this.parameters.instanced;this.techniqueConfig.instancedDoublePrecision=this.parameters.instancedDoublePrecision;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.hasVerticalOffset=c.isSome(this.parameters.verticalOffset);this.techniqueConfig.hasScreenSizePerspective=c.isSome(this.parameters.screenSizePerspective);this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;
this.techniqueConfig.hasSliceHighlight=this.parameters.hasSliceHighlight;this.techniqueConfig.alphaDiscardMode=this.parameters.textureAlphaMode;this.techniqueConfig.normalType="screenDerivative"===this.parameters.normals?h.NormalAttributeType.ScreenDerivative:h.NormalAttributeType.Attribute;this.techniqueConfig.transparent=this.parameters.transparent;this.techniqueConfig.writeDepth=this.parameters.writeDepth;c.isSome(this.parameters.customDepthTest)&&(this.techniqueConfig.customDepthTest=this.parameters.customDepthTest);
this.techniqueConfig.hasOccludees=this.parameters.hasOccludees;this.techniqueConfig.cullFace=this.parameters.hasSlicePlane?g.CullFaceOptions.None:this.parameters.cullFace;this.techniqueConfig.hasMultipassTerrain=S.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=S.multipassTerrain.cullAboveGround;this.techniqueConfig.hasModelTransformation=c.isSome(this.parameters.modelTransformation);if(V===m.ShaderOutput.Color||V===m.ShaderOutput.Alpha)this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors,
this.techniqueConfig.hasSymbolColors=this.parameters.hasSymbolColors,this.techniqueConfig.doubleSidedMode=this.parameters.treeRendering?d.NormalsDoubleSidedMode.WindingOrder:this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?d.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?d.NormalsDoubleSidedMode.WindingOrder:d.NormalsDoubleSidedMode.None,this.techniqueConfig.instancedColor=c.isSome(this.parameters.instanced)&&this.parameters.instanced.includes("color"),
this.techniqueConfig.receiveShadows=this.parameters.receiveShadows&&this.parameters.shadowMappingEnabled,this.techniqueConfig.receiveAmbientOcclusion=S.ssaoHelper.ready?this.parameters.receiveSSAO:!1,this.techniqueConfig.vvColor=this.parameters.vvColorEnabled,this.techniqueConfig.textureAlphaPremultiplied=!!this.parameters.textureAlphaPremultiplied,this.techniqueConfig.pbrMode=this.parameters.usePBR?this.parameters.isSchematic?e.PBRMode.Schematic:e.PBRMode.Normal:e.PBRMode.Disabled,this.techniqueConfig.hasMetalnessAndRoughnessTexture=
!!this.parameters.metallicRoughnessTextureId,this.techniqueConfig.hasEmissionTexture=!!this.parameters.emissiveTextureId,this.techniqueConfig.hasOcclusionTexture=!!this.parameters.occlusionTextureId,this.techniqueConfig.offsetBackfaces=!(!this.parameters.transparent||!this.parameters.offsetTransparentBackfaces),this.techniqueConfig.transparencyPassType=S.transparencyPassType,this.techniqueConfig.enableOffset=S.camera.relativeElevation<q.OITPolygonOffsetLimit,this.techniqueConfig.snowCover=this.hasSnowCover(S);
return this.techniqueConfig};N.hasSnowCover=function(V){return c.isSome(V.weather)&&V.weatherVisible&&"snowy"===V.weather.type&&"enabled"===V.weather.snowCover};N.intersect=function(V,S,T,H,U,W,Q){if(c.isSome(this.parameters.verticalOffset)){const ba=H.camera;n.set(M,T[12],T[13],T[14]);T=null;switch(H.viewingMode){case u.ViewingMode.Global:T=n.normalize(L,M);break;case u.ViewingMode.Local:T=n.copy(L,K)}let aa=0;var X=n.subtract(J,M,ba.eye);const ea=n.length(X);X=n.scale(X,X,1/ea);let ia=null;this.parameters.screenSizePerspective&&
(ia=n.dot(T,X));aa+=z.verticalOffsetAtDistance(ba,ea,this.parameters.verticalOffset,ia,this.parameters.screenSizePerspective);n.scale(T,T,aa);n.transformMat3(R,T,H.transform.inverseRotation);U=n.subtract(G,U,R);W=n.subtract(O,W,R)}z.intersectTriangleGeometry(V,S,H,U,W,f.getVerticalOffsetObject3D(H.verticalOffset),Q)};N.requiresSlot=function(V){return V===(this.parameters.transparent?this.parameters.writeDepth?r.RenderSlot.TRANSPARENT_MATERIAL:r.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:
r.RenderSlot.OPAQUE_MATERIAL)||V===r.RenderSlot.DRAPED_MATERIAL};N.createGLMaterial=function(V){return V.output===m.ShaderOutput.Color||V.output===m.ShaderOutput.Alpha||V.output===m.ShaderOutput.Depth||V.output===m.ShaderOutput.Normal||V.output===m.ShaderOutput.Shadow||V.output===m.ShaderOutput.Highlight?new D(V):null};N.createBufferWriter=function(){return new F(this.vertexBufferLayout,this.instanceBufferLayout)};return P}(t.Material);let D=function(I){function P(V){return I.call(this,{...V,...V.material.parameters})||
this}b._inheritsLoose(P,I);var N=P.prototype;N._updateParameters=function(V){const S=this._material.parameters;this.updateTexture(S.textureId);const T=V.camera.viewInverseTransposeMatrix;n.set(S.origin,T[3],T[7],T[11]);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(S.treeRendering?B.RealisticTreeTechnique:A.DefaultMaterialTechnique,V)};N._updateShadowState=function(V){V.shadowMap.enabled!==this._material.parameters.shadowMappingEnabled&&this._material.setParameters({shadowMappingEnabled:V.shadowMap.enabled})};
N._updateOccludeeState=function(V){V.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:V.hasOccludees})};N.beginSlot=function(V){if(this._output===m.ShaderOutput.Color||this._output===m.ShaderOutput.Alpha)this._updateShadowState(V),this._updateOccludeeState(V);return this._updateParameters(V)};return P}(p.GLTextureMaterial);p=function(I){function P(){var N=I.apply(this,arguments)||this;N.initTextureTransparent=!1;N.treeRendering=!1;N.hasVertexTangents=
!1;return N}b._inheritsLoose(P,I);return P}(A.DefaultMaterialPassParameters);const E=new p;let F=function(){function I(N,V){this.vertexBufferLayout=N;this.instanceBufferLayout=V}var P=I.prototype;P.allocate=function(N){return this.vertexBufferLayout.createBuffer(N)};P.elementCount=function(N){return N.indices.get(y.VertexAttribute.POSITION).length};P.write=function(N,V,S,T){w.writeDefaultAttributes(V,this.vertexBufferLayout,N.transformation,N.invTranspTransformation,S,T)};return I}();const G=l.create(),
O=l.create(),K=l.fromValues(0,0,1),L=l.create(),R=l.create(),M=l.create(),J=l.create();a.DefaultGLMaterial=D;a.DefaultMaterial=t;a.DefaultMaterialParameters=p;a.getInstanceBufferLayout=C;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../shaderModules/interfaces"],function(a,b,c){a.NormalsDoubleSidedMode=void 0;(function(n){n[n.None=
0]="None";n[n.View=1]="View";n[n.WindingOrder=2]="WindingOrder";n[n.COUNT=3]="COUNT"})(a.NormalsDoubleSidedMode||(a.NormalsDoubleSidedMode={}));a.Normals=function(n,l){n=n.fragment;n.code.add(c.glsl`struct ShadingNormalParameters {
vec3 normalView;
vec3 viewDirection;
} shadingParams;`);switch(l.doubleSidedMode){case a.NormalsDoubleSidedMode.None:n.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.View:n.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return dot(params.normalView, params.viewDirection) > 0.0 ? normalize(-params.normalView) : normalize(params.normalView);
}`);break;case a.NormalsDoubleSidedMode.WindingOrder:n.code.add(c.glsl`vec3 shadingNormal(ShadingNormalParameters params) {
return gl_FrontFacing ? normalize(params.normalView) : normalize(-params.normalView);
}`);break;default:b.neverReached(l.doubleSidedMode);case a.NormalsDoubleSidedMode.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/mat3f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/attributes/VertexNormal.glsl ../core/shaderLibrary/util/AlphaCutoff ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Material ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/DefaultMaterial.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){let B=function(C){function D(){var E=C.apply(this,arguments)||this;E.isSchematic=!1;E.usePBR=!1;E.mrrFactors=l.fromValues(0,1,.5);E.hasVertexColors=!1;E.hasSymbolColors=!1;E.doubleSided=!1;E.doubleSidedType="normal";E.cullFace=q.CullFaceOptions.Back;E.emissiveFactor=l.fromValues(0,0,0);E.instancedDoublePrecision=!1;E.normals="default";E.receiveSSAO=!0;E.receiveShadows=!0;E.castShadows=!0;E.shadowMappingEnabled=!1;E.ambient=l.fromValues(.2,.2,
.2);E.diffuse=l.fromValues(.8,.8,.8);E.externalColor=u.fromValues(1,1,1,1);E.colorMixMode="multiply";E.opacity=1;E.layerOpacity=1;E.origin=l.create();E.hasSlicePlane=!1;E.hasSliceHighlight=!0;E.offsetTransparentBackfaces=!1;E.vvSizeEnabled=!1;E.vvSizeMinSize=[1,1,1];E.vvSizeMaxSize=[100,100,100];E.vvSizeOffset=[0,0,0];E.vvSizeFactor=[1,1,1];E.vvSizeValue=[1,1,1];E.vvColorEnabled=!1;E.vvColorValues=[0,0,0,0,0,0,0,0];E.vvColorColors=[1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0];
E.vvSymbolAnchor=[0,0,0];E.vvSymbolRotationMatrix=n.create();E.vvOpacityEnabled=!1;E.vvOpacityValues=[];E.vvOpacityOpacities=[];E.transparent=!1;E.writeDepth=!0;E.customDepthTest=q.DepthTestFunction.Less;E.textureAlphaMode=q.AlphaDiscardMode.Blend;E.textureAlphaCutoff=e.defaultMaskAlphaCutoff;E.textureAlphaPremultiplied=!1;E.hasOccludees=!1;E.renderOccluded=r.RenderOccludedFlag.Occlude;return E}c._inheritsLoose(D,C);return D}(d.VertexNormalPassParameters);d=function(C){function D(){var E=C.apply(this,
arguments)||this;E.origin=l.create();E.slicePlaneLocalOrigin=E.origin;return E}c._inheritsLoose(D,C);return D}(d.VertexNormalDrawParameters);t=function(C){function D(){return C.apply(this,arguments)||this}c._inheritsLoose(D,C);var E=D.prototype;E.initializeConfiguration=function(F,G){G.spherical=F.viewingMode===v.ViewingMode.Global;G.doublePrecisionRequiresObfuscation=g.doublePrecisionRequiresObfuscation(F.rctx);G.textureCoordinateType=G.hasColorTexture||G.hasMetalnessAndRoughnessTexture||G.hasEmissionTexture||
G.hasOcclusionTexture||G.hasNormalTexture?h.TextureCoordinateAttributeType.Default:h.TextureCoordinateAttributeType.None};E.initializeProgram=function(F){return this._initializeProgram(F,D.shader)};E._initializeProgram=function(F,G){G=G.get().build(this.configuration);return new f.Program(F.rctx,G,k.Default3D)};E._convertDepthTestFunction=function(F){return F===q.DepthTestFunction.Lequal?A.CompareFunction.LEQUAL:A.CompareFunction.LESS};E._setPipeline=function(F,G){const O=this.configuration,K=F===
q.TransparencyPassType.NONE,L=F===q.TransparencyPassType.FrontFace;return x.makePipelineState({blending:O.output!==m.ShaderOutput.Color&&O.output!==m.ShaderOutput.Alpha||!O.transparent?null:K?y.blendingDefault:y.oitBlending(F),culling:(O.cullFace!==q.CullFaceOptions.None?!0:O.hasSlicePlane?!1:!O.transparent&&!O.doubleSidedMode)&&x.cullingParams(O.cullFace),depthTest:{func:y.oitDepthTest(F,this._convertDepthTestFunction(O.customDepthTest))},depthWrite:K||L?O.writeDepth&&x.defaultDepthWriteParams:null,
colorWrite:x.defaultColorWriteParams,stencilWrite:O.hasOccludees?w.stencilWriteMaskOn:null,stencilTest:O.hasOccludees?G?w.stencilToolMaskBaseParams:w.stencilBaseAllZerosParams:null,polygonOffset:K||L?null:y.getOITPolygonOffset(O.enableOffset)})};E.initializePipeline=function(){this._occludeePipelineState=this._setPipeline(this.configuration.transparencyPassType,!0);return this._setPipeline(this.configuration.transparencyPassType,!1)};E.getPipelineState=function(F,G){return G?this._occludeePipelineState:
C.prototype.getPipelineState.call(this,F,G)};return D}(t.ShaderTechnique);t.shader=new p.ReloadableShaderModule(z.DefaultMaterial,()=>new Promise((C,D)=>a(["./DefaultMaterial.glsl"],C,D)));b.DefaultMaterialDrawParameters=d;b.DefaultMaterialPassParameters=B;b.DefaultMaterialTechnique=t;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/DefaultMaterial.glsl":function(){define("exports ../core/maybe ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T){function H(W){const Q=new P.ShaderBuilder,X=Q.vertex.code,ba=Q.fragment.code;Q.include(G.HeaderComment,{name:"Default Material Shader",output:W.output});const aa=K.addProjViewLocalOrigin(Q,W);Q.include(e.PositionAttribute);Q.varyings.add("vpos","vec3");Q.include(D.VisualVariables,W);Q.include(h.InstancedDoublePrecision,W);Q.include(k.VerticalOffset,W);if(W.output===u.ShaderOutput.Color||W.output===u.ShaderOutput.Alpha)K.addCameraPosition(Q.vertex,
W),Q.include(d.NormalAttribute,W),Q.include(m.Transform,{linearDepth:!1,hasModelTransformation:W.hasModelTransformation}),W.normalType===d.NormalAttributeType.Attribute&&W.offsetBackfaces&&Q.include(l.Offset),Q.include(y.ComputeNormalTexture,W),Q.include(q.VertexNormal,W),W.instancedColor&&Q.attributes.add(S.VertexAttribute.INSTANCECOLOR,"vec4"),Q.varyings.add("localvpos","vec3"),Q.include(p.TextureCoordinateAttribute,W),Q.include(n.ForwardLinearDepth,W),Q.include(g.SymbolColor,W),Q.include(t.VertexColor,
W),Q.vertex.uniforms.add(new R.Float4PassUniform("externalColor",ea=>ea.externalColor)),Q.varyings.add("vcolorExt","vec4"),W.hasMultipassTerrain&&Q.varyings.add("depth","float"),W.hasModelTransformation&&Q.vertex.uniforms.add(new I.Matrix4PassUniform("model",ea=>b.isSome(ea.modelTransformation)?ea.modelTransformation:c.IDENTITY)),X.add(J.glsl`
      void main(void) {
        forwardNormalizedVertexColor();
        vcolorExt = externalColor;
        ${W.instancedColor?"vcolorExt *\x3d instanceColor;":""}
        vcolorExt *= vvColor();
        vcolorExt *= getSymbolColor();
        forwardColorMixMode();

        if (vcolorExt.a < ${J.glsl.float(E.symbolAlphaCutoff)}) {
          gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        } else {
          vpos = calculateVPos();
          localvpos = vpos - view[3].xyz;
          vpos = subtractOrigin(vpos);
          ${W.normalType===d.NormalAttributeType.Attribute?J.glsl`vNormalWorld = dpNormal(vvLocalNormal(normalModel()));`:""}
          vpos = addVerticalOffset(vpos, localOrigin);
          ${W.hasVertexTangents?"vTangent \x3d dpTransformVertexTangent(tangent);":""}
          gl_Position = transformPosition(proj, view, ${W.hasModelTransformation?"model,":""} vpos);
          ${W.normalType===d.NormalAttributeType.Attribute&&W.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
        }

        ${W.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        forwardLinearDepth();
        forwardTextureCoordinates();
      }
    `);W.output===u.ShaderOutput.Alpha&&(Q.include(v.SliceDraw,W),Q.include(F.DiscardOrAdjustAlphaPass,W),Q.include(z.multipassTerrainTest,W),Q.fragment.uniforms.add([new M.FloatPassUniform("opacity",ea=>ea.opacity),new M.FloatPassUniform("layerOpacity",ea=>ea.layerOpacity)]),W.hasColorTexture&&Q.fragment.uniforms.add(new N.Texture2DPassUniform("tex",ea=>ea.texture)),Q.fragment.include(O.MixExternalColor),ba.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${W.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${W.hasColorTexture?J.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${W.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        ${W.hasVertexColors?J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        gl_FragColor = vec4(opacity_);
      }
    `));W.output===u.ShaderOutput.Color&&(Q.include(v.SliceDraw,W),Q.include(w.EvaluateSceneLighting,W),Q.include(f.EvaluateAmbientOcclusion,W),Q.include(F.DiscardOrAdjustAlphaPass,W),Q.include(W.instancedDoublePrecision?C.ReadShadowMapPass:C.ReadShadowMapDraw,W),Q.include(z.multipassTerrainTest,W),K.addCameraPosition(Q.fragment,W),Q.fragment.uniforms.add([aa,new L.Float3PassUniform("ambient",ea=>ea.ambient),new L.Float3PassUniform("diffuse",ea=>ea.diffuse),new M.FloatPassUniform("opacity",ea=>ea.opacity),
new M.FloatPassUniform("layerOpacity",ea=>ea.layerOpacity),new M.FloatPassUniform("lightingGlobalFactor",(ea,ia)=>ia.lighting.globalFactor),new L.Float3PassUniform("lightingMainIntensity",(ea,ia)=>ia.lighting.mainLight.intensity)]),Q.fragment.constants.add("ambientBoostFactor","float",T.ambientBoost),W.hasColorTexture&&Q.fragment.uniforms.add(new N.Texture2DPassUniform("tex",ea=>ea.texture)),Q.include(B.PhysicallyBasedRenderingParameters,W),Q.include(x.PhysicallyBasedRendering,W),Q.fragment.include(O.MixExternalColor),
Q.include(A.Normals,W),ba.add(J.glsl`
      void main() {
        discardBySlice(vpos);
        ${W.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        ${W.hasColorTexture?J.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${W.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:J.glsl`vec4 texColor = vec4(1.0);`}
        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        ${W.normalType===d.NormalAttributeType.ScreenDerivative?J.glsl`
                vec3 normal = screenDerivativeNormal(localvpos);`:J.glsl`
                shadingParams.normalView = vNormalWorld;
                vec3 normal = shadingNormal(shadingParams);`}
        ${W.pbrMode===B.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        ${W.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":W.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${W.hasVertexColors?J.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:J.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${W.hasNormalTexture?J.glsl`
                mat3 tangentSpace = ${W.hasVertexTangents?"computeTangentSpace(normal);":"computeTangentSpace(normal, vpos, vuv0);"}
                vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`:J.glsl`vec3 shadingNormal = normal;`}
        vec3 normalGround = ${W.spherical?J.glsl`normalize(vpos + localOrigin);`:J.glsl`vec3(0.0, 0.0, 1.0);`}

        ${W.snowCover?J.glsl`
                float snow = smoothstep(0.5, 0.55, dot(normal, normalGround));
                albedo = mix(albedo, vec3(1), snow);
                shadingNormal = mix(shadingNormal, normal, snow);
                ssao = mix(ssao, 1.0, snow);`:""}

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;

        ${W.pbrMode===B.PBRMode.Normal||W.pbrMode===B.PBRMode.Schematic?J.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${W.snowCover?J.glsl`
                        mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                        emission = mix(emission, vec3(0.0), snow);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, shadingParams.viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:J.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${W.transparencyPassType===V.TransparencyPassType.Color?J.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:""}
      }
    `));Q.include(r.DefaultMaterialAuxiliaryPasses,W);return Q}const U=Object.freeze(Object.defineProperty({__proto__:null,build:H},Symbol.toStringTag,{value:"Module"}));a.DefaultMaterial=U;a.build=H})},"esri/views/3d/webgl-engine/core/shaderLibrary/Offset.glsl":function(){define(["exports","../shaderModules/interfaces"],function(a,b){a.Offset=function(c){c.vertex.code.add(b.glsl`vec4 offsetBackfacingClipPosition(vec4 posClip, vec3 posWorld, vec3 normalWorld, vec3 camPosWorld) {
vec3 camToVert = posWorld - camPosWorld;
bool isBackface = dot(camToVert, normalWorld) > 0.0;
if (isBackface) {
posClip.z += 0.0000003 * posClip.w;
}
return posClip;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl":function(){define("exports ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f64 ../ShaderOutputOptions ../util/DoublePrecision.glsl ../../shaderModules/Float3DrawUniform ../../shaderModules/interfaces ../../shaderModules/Matrix4PassUniform ../../../lib/VertexAttribute ../../../../../webgl/doublePrecisionUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d){const e=c.create();a.InstancedDoublePrecision=function(g,p){p.instanced&&p.instancedDoublePrecision&&(g.attributes.add(h.VertexAttribute.MODELORIGINHI,"vec3"),g.attributes.add(h.VertexAttribute.MODELORIGINLO,"vec3"),g.attributes.add(h.VertexAttribute.MODEL,"mat3"),g.attributes.add(h.VertexAttribute.MODELNORMAL,"mat3"));g=g.vertex;p.instancedDoublePrecision&&(g.include(l.DoublePrecision,p),g.uniforms.add(new u.Float3DrawUniform("viewOriginHi",(t,q)=>d.encodeDoubleHi(b.set(e,
q.camera.viewInverseTransposeMatrix[3],q.camera.viewInverseTransposeMatrix[7],q.camera.viewInverseTransposeMatrix[11]),e))),g.uniforms.add(new u.Float3DrawUniform("viewOriginLo",(t,q)=>d.encodeDoubleLo(b.set(e,q.camera.viewInverseTransposeMatrix[3],q.camera.viewInverseTransposeMatrix[7],q.camera.viewInverseTransposeMatrix[11]),e))));g.code.add(v.glsl`
    vec3 calculateVPos() {
      ${p.instancedDoublePrecision?"return model * localPosition().xyz;":"return localPosition().xyz;"}
    }
    `);g.code.add(v.glsl`
    vec3 subtractOrigin(vec3 _pos) {
      ${p.instancedDoublePrecision?v.glsl`
          vec3 originDelta = dpAdd(viewOriginHi, viewOriginLo, -modelOriginHi, -modelOriginLo);
          return _pos - originDelta;`:"return vpos;"}
    }
    `);g.code.add(v.glsl`
    vec3 dpNormal(vec4 _normal) {
      ${p.instancedDoublePrecision?"return normalize(modelNormal * _normal.xyz);":"return normalize(_normal.xyz);"}
    }
    `);p.output===n.ShaderOutput.Normal&&(g.uniforms.add(new m.Matrix4PassUniform("viewNormal",(t,q)=>q.camera.viewInverseTransposeMatrix)),g.code.add(v.glsl`
    vec3 dpNormalView(vec4 _normal) {
      ${p.instancedDoublePrecision?"return normalize((viewNormal * vec4(modelNormal * _normal.xyz, 1.0)).xyz);":"return normalize((viewNormal * _normal).xyz);"}
    }
    `));p.hasVertexTangents&&g.code.add(v.glsl`
    vec4 dpTransformVertexTangent(vec4 _tangent) {
      ${p.instancedDoublePrecision?"return vec4(modelNormal * _tangent.xyz, _tangent.w);":"return _tangent;"}

    }
    `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl":function(){define("exports ../../../collections/Component/Material/shader/DecodeSymbolColor.glsl ../../shaderModules/IntegerPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/internal/MaterialUtil".split(" "),function(a,b,c,n,l,u){a.SymbolColor=function(v,m){m.hasSymbolColors?(v.include(b.DecodeSymbolColor),
v.attributes.add(l.VertexAttribute.SYMBOLCOLOR,"vec4"),v.varyings.add("colorMixMode","mediump float"),v.vertex.code.add(n.glsl`int symbolColorMixMode;
vec4 getSymbolColor() {
return decodeSymbolColor(symbolColor, symbolColorMixMode) * 0.003921568627451;
}
void forwardColorMixMode() {
colorMixMode = float(symbolColorMixMode) + 0.5;
}`)):(v.fragment.uniforms.add(new c.IntegerPassUniform("colorMixMode",h=>u.colorMixModes[h.colorMixMode])),v.vertex.code.add(n.glsl`vec4 getSymbolColor() { return vec4(1.0); }
void forwardColorMixMode() {}`))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/DecodeSymbolColor.glsl":function(){define(["exports","../../../../../layers/support/symbolColorUtils","../../../../core/shaderModules/interfaces"],function(a,b,c){a.DecodeSymbolColor=function(n){n.vertex.code.add(c.glsl`
    vec4 decodeSymbolColor(vec4 symbolColor, out int colorMixMode) {
      float symbolAlpha = 0.0;

      const float maxTint = 85.0;
      const float maxReplace = 170.0;
      const float scaleAlpha = 3.0;

      if (symbolColor.a > maxReplace) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxReplace);
      } else if (symbolColor.a > maxTint) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Replace)};
        symbolAlpha = scaleAlpha * (symbolColor.a - maxTint);
      } else if (symbolColor.a > 0.0) {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Tint)};
        symbolAlpha = scaleAlpha * symbolColor.a;
      } else {
        colorMixMode = ${c.glsl.int(b.ColorMixModeEnum.Multiply)};
        symbolAlpha = 0.0;
      }

      return vec4(symbolColor.r, symbolColor.g, symbolColor.b, symbolAlpha);
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/symbolColorUtils":function(){define(["exports","../../../../core/mathUtils","../../../../core/maybe"],function(a,b,c){a.ColorMixModeEnum=void 0;(function(n){n[n.Multiply=1]="Multiply";n[n.Ignore=2]="Ignore";n[n.Replace=3]="Replace";n[n.Tint=4]="Tint"})(a.ColorMixModeEnum||(a.ColorMixModeEnum={}));a.encodeSymbolColor=function(n,l,u){if(c.isNone(n)||l===a.ColorMixModeEnum.Ignore)u[0]=
255,u[1]=255,u[2]=255,u[3]=255;else{var v=b.clamp(Math.round(85*n[3]),0,85);l=0===v||l===a.ColorMixModeEnum.Tint?0:l===a.ColorMixModeEnum.Replace?85:170;u[0]=b.clamp(Math.round(255*n[0]),0,255);u[1]=b.clamp(Math.round(255*n[1]),0,255);u[2]=b.clamp(Math.round(255*n[2]),0,255);u[3]=v+l}};a.parseColorMixMode=function(n){switch(n){case "multiply":return a.ColorMixModeEnum.Multiply;case "ignore":return a.ColorMixModeEnum.Ignore;case "replace":return a.ColorMixModeEnum.Replace;case "tint":return a.ColorMixModeEnum.Tint;
default:return a.ColorMixModeEnum.Multiply}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl":function(){define(["exports","../../shaderModules/interfaces","../../../lib/VertexAttribute"],function(a,b,c){a.VertexColor=function(n,l){l.hasVertexColors?(n.attributes.add(c.VertexAttribute.COLOR,"vec4"),n.varyings.add("vColor","vec4"),n.vertex.code.add(b.glsl`void forwardVertexColor() { vColor = color; }`),
n.vertex.code.add(b.glsl`void forwardNormalizedVertexColor() { vColor = color * 0.003921568627451; }`)):n.vertex.code.add(b.glsl`void forwardVertexColor() {}
void forwardNormalizedVertexColor() {}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl":function(){define("exports ../ShaderOutputOptions ../Slice.glsl ../Transform.glsl ../attributes/NormalAttribute.glsl ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexNormal.glsl ../output/OutputDepth.glsl ../output/OutputHighlight.glsl ../shading/VisualVariables.glsl ../util/AlphaDiscard.glsl ../util/View.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){a.DefaultMaterialAuxiliaryPasses=function(k,r){const y=k.vertex.code,f=k.fragment.code,w=r.hasModelTransformation;if(r.output===b.ShaderOutput.Depth||r.output===b.ShaderOutput.Shadow)g.addProjViewLocalOrigin(k,r),k.include(n.Transform,{linearDepth:!0,hasModelTransformation:w}),k.include(u.TextureCoordinateAttribute,r),k.include(d.VisualVariables,r),k.include(m.OutputDepth,r),k.include(c.SliceDraw,r),k.vertex.uniforms.add(new p.Float2PassUniform("nearFar",(z,
A)=>A.camera.nearFar)),k.varyings.add("depth","float"),r.hasColorTexture&&k.fragment.uniforms.add(new q.Texture2DPassUniform("tex",z=>z.texture)),y.add(t.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPositionWithDepth(proj, view, ${w?"model,":""} vpos, nearFar, depth);
        forwardTextureCoordinates();
      }
    `),k.include(e.DiscardOrAdjustAlphaPass,r),f.add(t.glsl`
      void main(void) {
        discardBySlice(vpos);
        ${r.hasColorTexture?t.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputDepth(depth);
      }
    `);r.output===b.ShaderOutput.Normal&&(g.addProjViewLocalOrigin(k,r),k.include(n.Transform,{linearDepth:!1,hasModelTransformation:w}),k.include(l.NormalAttribute,r),k.include(v.VertexNormal,r),k.include(u.TextureCoordinateAttribute,r),k.include(d.VisualVariables,r),r.hasColorTexture&&k.fragment.uniforms.add(new q.Texture2DPassUniform("tex",z=>z.texture)),k.varyings.add("vPositionView","vec3"),y.add(t.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        ${r.normalType===l.NormalAttributeType.Attribute?t.glsl`
        vNormalWorld = dpNormalView(vvLocalNormal(normalModel()));`:""}
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${w?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),k.include(c.SliceDraw,r),k.include(e.DiscardOrAdjustAlphaPass,r),f.add(t.glsl`
      void main() {
        discardBySlice(vpos);
        ${r.hasColorTexture?t.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}

        ${r.normalType===l.NormalAttributeType.ScreenDerivative?t.glsl`
            vec3 normal = screenDerivativeNormal(vPositionView);`:t.glsl`
            vec3 normal = normalize(vNormalWorld);
            if (gl_FrontFacing == false) normal = -normal;`}
        gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
      }
    `));r.output===b.ShaderOutput.Highlight&&(g.addProjViewLocalOrigin(k,r),k.include(n.Transform,{linearDepth:!1,hasModelTransformation:w}),k.include(u.TextureCoordinateAttribute,r),k.include(d.VisualVariables,r),r.hasColorTexture&&k.fragment.uniforms.add(new q.Texture2DPassUniform("tex",z=>z.texture)),y.add(t.glsl`
      void main(void) {
        vpos = calculateVPos();
        vpos = subtractOrigin(vpos);
        vpos = addVerticalOffset(vpos, localOrigin);
        gl_Position = transformPosition(proj, view, ${w?"model,":""} vpos);
        forwardTextureCoordinates();
      }
    `),k.include(c.SliceDraw,r),k.include(e.DiscardOrAdjustAlphaPass,r),k.include(h.OutputHighlight),f.add(t.glsl`
      void main() {
        discardBySlice(vpos);
        ${r.hasColorTexture?t.glsl`
        vec4 texColor = texture2D(tex, vuv0);
        discardOrAdjustAlpha(texColor);`:""}
        outputHighlight();
      }
    `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl":function(){define("exports ./DiscardOrAdjustAlphaBlend.glsl ../../shaderModules/FloatDrawUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/basicInterfaces".split(" "),function(a,b,c,n,l,u){function v(m,h,d){const e=m.fragment;h.alphaDiscardMode!==u.AlphaDiscardMode.Mask&&h.alphaDiscardMode!==
u.AlphaDiscardMode.MaskBlend||e.uniforms.add(d);switch(h.alphaDiscardMode){case u.AlphaDiscardMode.Blend:return m.include(b.DiscardOrAdjustAlphaBlend);case u.AlphaDiscardMode.Opaque:e.code.add(l.glsl`void discardOrAdjustAlpha(inout vec4 color) {
color.a = 1.0;
}`);break;case u.AlphaDiscardMode.Mask:e.code.add(l.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } else { color.a = 1.0; } }`);break;case u.AlphaDiscardMode.MaskBlend:m.fragment.code.add(l.glsl`#define discardOrAdjustAlpha(color) { if (color.a < textureAlphaCutoff) { discard; } }`)}}a.DiscardOrAdjustAlphaDraw=function(m,h){v(m,h,new c.FloatDrawUniform("textureAlphaCutoff",d=>d.textureAlphaCutoff))};a.DiscardOrAdjustAlphaPass=function(m,h){v(m,h,new n.FloatPassUniform("textureAlphaCutoff",
d=>d.textureAlphaCutoff))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/DiscardOrAdjustAlphaBlend.glsl":function(){define(["exports","./AlphaCutoff","../../shaderModules/interfaces"],function(a,b,c){a.DiscardOrAdjustAlphaBlend=function(n){n.fragment.code.add(c.glsl`
    #define discardOrAdjustAlpha(color) { if (color.a < ${c.glsl.float(b.symbolAlphaCutoff)}) { discard; } }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/FloatDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"float",n.BindType.Draw,(h,d,e)=>h.setUniform1f(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.FloatDrawUniform=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ./Normals.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform ../../shaderModules/Texture2DPassUniform ../../shaderTechnique/BindType ../../../lib/VertexAttribute".split(" "),function(a,b,c,n,l,u,v,m,h){a.ComputeNormalTexture=
function(d,e){const g=d.fragment;e.hasVertexTangents?(d.attributes.add(h.VertexAttribute.TANGENT,"vec4"),d.varyings.add("vTangent","vec4"),e.doubleSidedMode===n.NormalsDoubleSidedMode.WindingOrder?g.code.add(l.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = gl_FrontFacing ? vTangent.w : -vTangent.w;
vec3 tangent = normalize(gl_FrontFacing ? vTangent.xyz : -vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`):g.code.add(l.glsl`mat3 computeTangentSpace(vec3 normal) {
float tangentHeadedness = vTangent.w;
vec3 tangent = normalize(vTangent.xyz);
vec3 bitangent = cross(normal, tangent) * tangentHeadedness;
return mat3(tangent, bitangent, normal);
}`)):(d.extensions.add("GL_OES_standard_derivatives"),g.code.add(l.glsl`mat3 computeTangentSpace(vec3 normal, vec3 pos, vec2 st) {
vec3 Q1 = dFdx(pos);
vec3 Q2 = dFdy(pos);
vec2 stx = dFdx(st);
vec2 sty = dFdy(st);
float det = stx.t * sty.s - sty.t * stx.s;
vec3 T = stx.t * Q2 - sty.t * Q1;
T = T - normal * dot(normal, T);
T *= inversesqrt(max(dot(T,T), 1.e-10));
vec3 B = sign(det) * cross(normal, T);
return mat3(T, B, normal);
}`));e.textureCoordinateType!==b.TextureCoordinateAttributeType.None&&(d.include(c.VertexTextureCoordinates,e),d=e.supportsTextureAtlas,g.uniforms.add(e.pbrTextureBindType===m.BindType.Pass?v.createTexture2DPassSizeUniforms("normalTexture",p=>p.textureNormal,d):u.createTexture2DDrawSizeUniforms("normalTexture",p=>p.textureNormal,d)),g.code.add(l.glsl`
    vec3 computeTextureNormal(mat3 tangentSpace, vec2 uv) {
      vtc.uv = uv;
      ${e.supportsTextureAtlas?"vtc.size \x3d normalTextureSize;":""}
      vec3 rawNormal = textureLookup(normalTexture, vtc).rgb * 2.0 - 1.0;
      return tangentSpace * rawNormal;
    }
  `))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl":function(){define("exports ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f64 ../../shaderModules/Float4PassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,n,l,u){const v=c.create();a.EvaluateAmbientOcclusion=function(m,h){m=m.fragment;h.receiveAmbientOcclusion?
(m.uniforms.add([new u.Texture2DPassUniform("ssaoTex",(d,e)=>e.ssaoHelper.colorTexture),new n.Float4PassUniform("viewportPixelSz",(d,e)=>b.set(v,e.camera.fullViewport[0],e.camera.fullViewport[1],1/e.ssaoHelper.width,1/e.ssaoHelper.height))]),m.code.add(l.glsl`float evaluateAmbientOcclusion() {
return 1.0 - texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}
float evaluateAmbientOcclusionInverse() {
return texture2D(ssaoTex, (gl_FragCoord.xy - viewportPixelSz.xy) * viewportPixelSz.zw).a;
}`)):m.code.add(l.glsl`float evaluateAmbientOcclusion() { return 0.0; }
float evaluateAmbientOcclusionInverse() { return 1.0; }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl":function(){define("exports ./EvaluateAmbientLighting.glsl ./EvaluateAmbientOcclusion.glsl ./MainLighting.glsl ./PhysicallyBasedRendering.glsl ./PhysicallyBasedRenderingParameters.glsl ./PiUtils.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lighting/SceneLighting".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){a.EvaluateSceneLighting=function(p,t){const q=p.fragment;p.include(c.EvaluateAmbientOcclusion,t);t.pbrMode!==u.PBRMode.Disabled&&p.include(l.PhysicallyBasedRendering,t);p.include(b.EvaluateAmbientLighting,t);q.constants.add("ambientBoostFactor","float",g.ambientBoost);p.include(v.PiUtils);q.code.add(e.glsl`
    const float GAMMA_SRGB = 2.1;
    const float INV_GAMMA_SRGB = 0.4761904;
    ${t.pbrMode===u.PBRMode.Disabled?"":"const vec3 GROUND_REFLECTANCE \x3d vec3(0.2);"}
  `);q.uniforms.add(new h.Float3PassUniform("lightingMainDirection",(k,r)=>r.lighting.lightingMainDirection));q.code.add(e.glsl`
    float additionalDirectedAmbientLight(vec3 vPosWorld) {
      float vndl = dot(${t.spherical?e.glsl`normalize(vPosWorld)`:e.glsl`vec3(0.0, 0.0, 1.0)`}, lightingMainDirection);
      return smoothstep(0.0, 1.0, clamp(vndl * 2.5, 0.0, 1.0));
    }
  `);q.uniforms.add([new d.FloatPassUniform("lightingGlobalFactor",(k,r)=>r.lighting.globalFactor),new h.Float3PassUniform("lightingMainIntensity",(k,r)=>r.lighting.mainLight.intensity)]);q.code.add(e.glsl`vec3 evaluateAdditionalLighting(float ambientOcclusion, vec3 vPosWorld) {
float additionalAmbientScale = additionalDirectedAmbientLight(vPosWorld);
return (1.0 - ambientOcclusion) * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor * lightingMainIntensity;
}`);if(t.pbrMode===u.PBRMode.Disabled||t.pbrMode===u.PBRMode.WaterOnIntegratedMesh)p.include(n.MainLighting,t),q.code.add(e.glsl`vec3 evaluateSceneLighting(vec3 normalWorld, vec3 albedo, float shadow, float ssao, vec3 additionalLight)
{
vec3 mainLighting = evaluateMainLighting(normalWorld, shadow);
vec3 ambientLighting = calculateAmbientIrradiance(normalWorld, ssao);
vec3 albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
vec3 totalLight = mainLighting + ambientLighting + additionalLight;
totalLight = min(totalLight, vec3(PI));
vec3 outColor = vec3((albedoLinear / PI) * totalLight);
return pow(outColor, vec3(INV_GAMMA_SRGB));
}`);else if(t.pbrMode===u.PBRMode.Normal||t.pbrMode===u.PBRMode.Schematic)q.code.add(e.glsl`const float fillLightIntensity = 0.25;
const float horizonLightDiffusion = 0.4;
const float additionalAmbientIrradianceFactor = 0.02;
vec3 evaluateSceneLightingPBR(vec3 normal, vec3 albedo, float shadow, float ssao, vec3 additionalLight, vec3 viewDir, vec3 normalGround, vec3 mrr, vec3 _emission, float additionalAmbientIrradiance)
{
vec3 viewDirection = -viewDir;
vec3 mainLightDirection = lightingMainDirection;
vec3 h = normalize(viewDirection + mainLightDirection);
PBRShadingInfo inputs;
inputs.NdotL = clamp(dot(normal, mainLightDirection), 0.001, 1.0);
inputs.NdotV = clamp(abs(dot(normal, viewDirection)), 0.001, 1.0);
inputs.NdotH = clamp(dot(normal, h), 0.0, 1.0);
inputs.VdotH = clamp(dot(viewDirection, h), 0.0, 1.0);
inputs.NdotNG = clamp(dot(normal, normalGround), -1.0, 1.0);
vec3 reflectedView = normalize(reflect(viewDirection, normal));
inputs.RdotNG = clamp(dot(reflectedView, normalGround), -1.0, 1.0);
inputs.albedoLinear = pow(albedo, vec3(GAMMA_SRGB));
inputs.ssao = ssao;
inputs.metalness = mrr[0];
inputs.roughness = clamp(mrr[1] * mrr[1], 0.001, 0.99);`),q.code.add(e.glsl`inputs.f0 = (0.16 * mrr[2] * mrr[2]) * (1.0 - inputs.metalness) + inputs.albedoLinear * inputs.metalness;
inputs.f90 = vec3(clamp(dot(inputs.f0, vec3(50.0 * 0.33)), 0.0, 1.0));
inputs.diffuseColor = inputs.albedoLinear * (vec3(1.0) - inputs.f0) * (1.0 - inputs.metalness);`),t.useFillLights?q.uniforms.add(new m.BooleanPassUniform("hasFillLights",(k,r)=>r.enableFillLights)):q.constants.add("hasFillLights","bool",!1),q.code.add(e.glsl`vec3 ambientDir = vec3(5.0 * normalGround[1] - normalGround[0] * normalGround[2], - 5.0 * normalGround[0] - normalGround[2] * normalGround[1], normalGround[1] * normalGround[1] + normalGround[0] * normalGround[0]);
ambientDir = ambientDir != vec3(0.0)? normalize(ambientDir) : normalize(vec3(5.0, -1.0, 0.0));
inputs.NdotAmbDir = hasFillLights ? abs(dot(normal, ambientDir)) : 1.0;
vec3 mainLightIrradianceComponent = inputs.NdotL * (1.0 - shadow) * lightingMainIntensity;
vec3 fillLightsIrradianceComponent = inputs.NdotAmbDir * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightIrradianceComponent = calculateAmbientIrradiance(normal, ssao) + additionalLight;
inputs.skyIrradianceToSurface = ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;
inputs.groundIrradianceToSurface = GROUND_REFLECTANCE * ambientLightIrradianceComponent + mainLightIrradianceComponent + fillLightsIrradianceComponent ;`),q.uniforms.add([new d.FloatPassUniform("lightingSpecularStrength",(k,r)=>r.lighting.mainLight.specularStrength),new d.FloatPassUniform("lightingEnvironmentStrength",(k,r)=>r.lighting.mainLight.environmentStrength)]),q.code.add(e.glsl`vec3 horizonRingDir = inputs.RdotNG * normalGround - reflectedView;
vec3 horizonRingH = normalize(viewDirection + horizonRingDir);
inputs.NdotH_Horizon = dot(normal, horizonRingH);
vec3 mainLightRadianceComponent = lightingSpecularStrength * normalDistribution(inputs.NdotH, inputs.roughness) * lightingMainIntensity * (1.0 - shadow);
vec3 horizonLightRadianceComponent = lightingEnvironmentStrength * normalDistribution(inputs.NdotH_Horizon, min(inputs.roughness + horizonLightDiffusion, 1.0)) * lightingMainIntensity * fillLightIntensity;
vec3 ambientLightRadianceComponent = lightingEnvironmentStrength * calculateAmbientRadiance(ssao) + additionalLight;
inputs.skyRadianceToSurface = ambientLightRadianceComponent + mainLightRadianceComponent + horizonLightRadianceComponent;
inputs.groundRadianceToSurface = GROUND_REFLECTANCE * (ambientLightRadianceComponent + horizonLightRadianceComponent) + mainLightRadianceComponent;
inputs.averageAmbientRadiance = ambientLightIrradianceComponent[1] * (1.0 + GROUND_REFLECTANCE[1]);`),q.code.add(e.glsl`
        vec3 reflectedColorComponent = evaluateEnvironmentIllumination(inputs);
        vec3 additionalMaterialReflectanceComponent = inputs.albedoLinear * additionalAmbientIrradiance;
        vec3 emissionComponent = pow(_emission, vec3(GAMMA_SRGB));
        vec3 outColorLinear = reflectedColorComponent + additionalMaterialReflectanceComponent + emissionComponent;
        ${t.pbrMode===u.PBRMode.Schematic?e.glsl`vec3 outColor = pow(max(vec3(0.0), outColorLinear - 0.005 * inputs.averageAmbientRadiance), vec3(INV_GAMMA_SRGB));`:e.glsl`vec3 outColor = pow(blackLevelSoftCompression(outColorLinear, inputs), vec3(INV_GAMMA_SRGB));`}
        return outColor;
      }
    `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl":function(){define(["exports","../ShaderOutputOptions","../../shaderModules/interfaces","../../../../../webgl/checkWebGLError"],function(a,b,c,n){a.HeaderComment=function(l,u){u=c.glsl`
  /*
  *  ${u.name}
  *  ${u.output===b.ShaderOutput.Color?"RenderOutput: Color":u.output===b.ShaderOutput.Depth?"RenderOutput: Depth":u.output===b.ShaderOutput.Shadow?"RenderOutput: Shadow":u.output===b.ShaderOutput.Normal?"RenderOutput: Normal":u.output===b.ShaderOutput.Highlight?"RenderOutput: Highlight":""}
  */
  `;n.webglValidateShadersEnabled()&&(l.fragment.code.add(u),l.vertex.code.add(u))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl":function(){define(["exports","../../../../layers/support/symbolColorUtils","./ColorConversion.glsl","../../shaderModules/interfaces"],function(a,b,c,n){a.MixExternalColor=function(l){l.include(c.ColorConversion);l.code.add(n.glsl`
    vec3 mixExternalColor(vec3 internalColor, vec3 textureColor, vec3 externalColor, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      vec3 internalMixed = internalColor * textureColor;
      vec3 allMixed = internalMixed * externalColor;

      if (mode == ${n.glsl.int(b.ColorMixModeEnum.Multiply)}) {
        return allMixed;
      }
      if (mode == ${n.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${n.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalColor;
      }

      // tint (or something invalid)
      float vIn = rgb2v(internalMixed);
      vec3 hsvTint = rgb2hsv(externalColor);
      vec3 hsvOut = vec3(hsvTint.x, hsvTint.y, vIn * hsvTint.z);
      return hsv2rgb(hsvOut);
    }

    float mixExternalOpacity(float internalOpacity, float textureOpacity, float externalOpacity, int mode) {
      // workaround for artifacts in OSX using Intel Iris Pro
      // see: https://devtopia.esri.com/WebGIS/arcgis-js-api/issues/10475
      float internalMixed = internalOpacity * textureOpacity;
      float allMixed = internalMixed * externalOpacity;

      if (mode == ${n.glsl.int(b.ColorMixModeEnum.Ignore)}) {
        return internalMixed;
      }
      if (mode == ${n.glsl.int(b.ColorMixModeEnum.Replace)}) {
        return externalOpacity;
      }

      // multiply or tint (or something invalid)
      return allMixed;
    }
  `)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/DefaultMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){e=function(g){function p(){var t=g.apply(this,arguments)||this;t.output=n.ShaderOutput.Color;t.alphaDiscardMode=d.AlphaDiscardMode.Opaque;t.doubleSidedMode=v.NormalsDoubleSidedMode.None;t.pbrMode=m.PBRMode.Disabled;t.cullFace=d.CullFaceOptions.None;t.transparencyPassType=d.TransparencyPassType.NONE;t.normalType=l.NormalAttributeType.Attribute;t.textureCoordinateType=u.TextureCoordinateAttributeType.None;t.customDepthTest=d.DepthTestFunction.Less;t.spherical=!1;t.hasVertexColors=
!1;t.hasSymbolColors=!1;t.hasVerticalOffset=!1;t.hasSlicePlane=!1;t.hasSliceHighlight=!0;t.hasColorTexture=!1;t.hasMetalnessAndRoughnessTexture=!1;t.hasEmissionTexture=!1;t.hasOcclusionTexture=!1;t.hasNormalTexture=!1;t.hasScreenSizePerspective=!1;t.hasVertexTangents=!1;t.hasOccludees=!1;t.hasMultipassTerrain=!1;t.hasModelTransformation=!1;t.offsetBackfaces=!1;t.vvSize=!1;t.vvColor=!1;t.receiveShadows=!1;t.receiveAmbientOcclusion=!1;t.textureAlphaPremultiplied=!1;t.instanced=!1;t.instancedColor=!1;
t.instancedDoublePrecision=!1;t.doublePrecisionRequiresObfuscation=!1;t.writeDepth=!0;t.transparent=!1;t.enableOffset=!0;t.cullAboveGround=!1;t.snowCover=!1;return t}b._inheritsLoose(p,g);return p}(e.DefaultTechniqueConfiguration);c.__decorate([h.parameter({count:n.ShaderOutput.COUNT})],e.prototype,"output",void 0);c.__decorate([h.parameter({count:d.AlphaDiscardMode.COUNT})],e.prototype,"alphaDiscardMode",void 0);c.__decorate([h.parameter({count:v.NormalsDoubleSidedMode.COUNT})],e.prototype,"doubleSidedMode",
void 0);c.__decorate([h.parameter({count:m.PBRMode.COUNT})],e.prototype,"pbrMode",void 0);c.__decorate([h.parameter({count:d.CullFaceOptions.COUNT})],e.prototype,"cullFace",void 0);c.__decorate([h.parameter({count:d.TransparencyPassType.COUNT})],e.prototype,"transparencyPassType",void 0);c.__decorate([h.parameter({count:l.NormalAttributeType.COUNT})],e.prototype,"normalType",void 0);c.__decorate([h.parameter({count:u.TextureCoordinateAttributeType.COUNT})],e.prototype,"textureCoordinateType",void 0);
c.__decorate([h.parameter({count:d.DepthTestFunction.COUNT})],e.prototype,"customDepthTest",void 0);c.__decorate([h.parameter()],e.prototype,"spherical",void 0);c.__decorate([h.parameter()],e.prototype,"hasVertexColors",void 0);c.__decorate([h.parameter()],e.prototype,"hasSymbolColors",void 0);c.__decorate([h.parameter()],e.prototype,"hasVerticalOffset",void 0);c.__decorate([h.parameter()],e.prototype,"hasSlicePlane",void 0);c.__decorate([h.parameter()],e.prototype,"hasSliceHighlight",void 0);c.__decorate([h.parameter()],
e.prototype,"hasColorTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasMetalnessAndRoughnessTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasEmissionTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasOcclusionTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasNormalTexture",void 0);c.__decorate([h.parameter()],e.prototype,"hasScreenSizePerspective",void 0);c.__decorate([h.parameter()],e.prototype,"hasVertexTangents",void 0);c.__decorate([h.parameter()],
e.prototype,"hasOccludees",void 0);c.__decorate([h.parameter()],e.prototype,"hasMultipassTerrain",void 0);c.__decorate([h.parameter()],e.prototype,"hasModelTransformation",void 0);c.__decorate([h.parameter()],e.prototype,"offsetBackfaces",void 0);c.__decorate([h.parameter()],e.prototype,"vvSize",void 0);c.__decorate([h.parameter()],e.prototype,"vvColor",void 0);c.__decorate([h.parameter()],e.prototype,"receiveShadows",void 0);c.__decorate([h.parameter()],e.prototype,"receiveAmbientOcclusion",void 0);
c.__decorate([h.parameter()],e.prototype,"textureAlphaPremultiplied",void 0);c.__decorate([h.parameter()],e.prototype,"instanced",void 0);c.__decorate([h.parameter()],e.prototype,"instancedColor",void 0);c.__decorate([h.parameter()],e.prototype,"instancedDoublePrecision",void 0);c.__decorate([h.parameter()],e.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([h.parameter()],e.prototype,"writeDepth",void 0);c.__decorate([h.parameter()],e.prototype,"transparent",void 0);c.__decorate([h.parameter()],
e.prototype,"enableOffset",void 0);c.__decorate([h.parameter()],e.prototype,"cullAboveGround",void 0);c.__decorate([h.parameter()],e.prototype,"snowCover",void 0);c.__decorate([h.parameter({constValue:!0})],e.prototype,"hasVvInstancing",void 0);c.__decorate([h.parameter({constValue:!1})],e.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([h.parameter({constValue:!1})],e.prototype,"supportsTextureAtlas",void 0);c.__decorate([h.parameter({constValue:!0})],e.prototype,"useFillLights",void 0);
a.DefaultMaterialTechniqueConfiguration=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/RealisticTreeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/attributes/NormalAttribute.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderTechnique/ReloadableShaderModule ./DefaultMaterialTechnique ../../../../chunks/RealisticTree.glsl".split(" "),function(a,
b,c,n,l,u,v,m){v=function(h){function d(){return h.apply(this,arguments)||this}c._inheritsLoose(d,h);var e=d.prototype;e.initializeConfiguration=function(g,p){h.prototype.initializeConfiguration.call(this,g,p);p.hasMetalnessAndRoughnessTexture=!1;p.hasEmissionTexture=!1;p.hasOcclusionTexture=!1;p.hasNormalTexture=!1;p.hasModelTransformation=!1;p.normalType=n.NormalAttributeType.Attribute;p.doubleSidedMode=l.NormalsDoubleSidedMode.WindingOrder;p.hasVertexTangents=!1};e.initializeProgram=function(g){return this._initializeProgram(g,
d.shader)};return d}(v.DefaultMaterialTechnique);v.shader=new u.ReloadableShaderModule(m.RealisticTree,()=>new Promise((h,d)=>a(["./RealisticTree.glsl"],h,d)));b.RealisticTreeTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RealisticTree.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/Offset.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/InstancedDoublePrecision.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PositionAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/SymbolColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VerticalOffset.glsl ../views/3d/webgl-engine/core/shaderLibrary/default/DefaultMaterialAuxiliaryPasses.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRendering.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/VisualVariables.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/MixExternalColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J){function I(N){const V=new K.ShaderBuilder,S=V.vertex.code,T=V.fragment.code,H=C.addProjViewLocalOrigin(V,N);V.include(h.PositionAttribute);V.varyings.add("vpos","vec3");V.include(z.VisualVariables,N);V.include(v.InstancedDoublePrecision,N);V.include(p.VerticalOffset,N);if(N.output===n.ShaderOutput.Color||N.output===n.ShaderOutput.Alpha)C.addCameraPosition(V.vertex,N),V.include(m.NormalAttribute,N),V.include(u.Transform),
N.offsetBackfaces&&V.include(c.Offset),N.instancedColor&&V.attributes.add(M.VertexAttribute.INSTANCECOLOR,"vec4"),V.varyings.add("vNormalWorld","vec3"),V.varyings.add("localvpos","vec3"),N.hasMultipassTerrain&&V.varyings.add("depth","float"),V.include(e.TextureCoordinateAttribute,N),V.include(b.ForwardLinearDepth,N),V.include(d.SymbolColor,N),V.include(g.VertexColor,N),V.vertex.uniforms.add(new E.Float4PassUniform("externalColor",U=>U.externalColor)),V.varyings.add("vcolorExt","vec4"),S.add(G.glsl`
        void main(void) {
          forwardNormalizedVertexColor();
          vcolorExt = externalColor;
          ${N.instancedColor?"vcolorExt *\x3d instanceColor;":""}
          vcolorExt *= vvColor();
          vcolorExt *= getSymbolColor();
          forwardColorMixMode();

          if (vcolorExt.a < ${G.glsl.float(A.symbolAlphaCutoff)}) {
            gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
          } else {
            vpos = calculateVPos();
            localvpos = vpos - view[3].xyz;
            vpos = subtractOrigin(vpos);
            vNormalWorld = dpNormal(vvLocalNormal(normalModel()));
            vpos = addVerticalOffset(vpos, localOrigin);
            gl_Position = transformPosition(proj, view, vpos);
            ${N.offsetBackfaces?"gl_Position \x3d offsetBackfacingClipPosition(gl_Position, vpos, vNormalWorld, cameraPosition);":""}
          }
          ${N.hasMultipassTerrain?G.glsl`depth = (view * vec4(vpos, 1.0)).z;`:""}
          forwardLinearDepth();
          forwardTextureCoordinates();
        }
      `);N.output===n.ShaderOutput.Alpha&&(V.include(l.SliceDraw,N),V.include(x.DiscardOrAdjustAlphaPass,N),V.include(r.multipassTerrainTest,N),V.fragment.uniforms.add([new F.FloatPassUniform("opacity",U=>U.opacity),new F.FloatPassUniform("layerOpacity",U=>U.layerOpacity),new O.Matrix4Uniform("view")]),N.hasColorTexture&&V.fragment.uniforms.add(new L.Texture2DPassUniform("tex",U=>U.texture)),V.fragment.include(B.MixExternalColor),T.add(G.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.hasMultipassTerrain?G.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${N.hasColorTexture?G.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:G.glsl`vec4 texColor = vec4(1.0);`}
        ${N.hasVertexColors?G.glsl`float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:G.glsl`float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}

        gl_FragColor = vec4(opacity_);
      }
    `));N.output===n.ShaderOutput.Color&&(V.include(l.SliceDraw,N),V.include(k.EvaluateSceneLighting,N),V.include(q.EvaluateAmbientOcclusion,N),V.include(x.DiscardOrAdjustAlphaPass,N),V.include(N.instancedDoublePrecision?w.ReadShadowMapPass:w.ReadShadowMapDraw,N),V.include(r.multipassTerrainTest,N),C.addCameraPosition(V.fragment,N),V.fragment.uniforms.add([H,new D.Float3PassUniform("ambient",U=>U.ambient),new D.Float3PassUniform("diffuse",U=>U.diffuse),new F.FloatPassUniform("opacity",U=>U.opacity),
new F.FloatPassUniform("layerOpacity",U=>U.layerOpacity),new O.Matrix4Uniform("view"),new F.FloatPassUniform("lightingGlobalFactor",(U,W)=>W.lighting.globalFactor),new D.Float3PassUniform("lightingMainIntensity",(U,W)=>W.lighting.mainLight.intensity)]),V.fragment.constants.add("ambientBoostFactor","float",J.ambientBoost),N.hasColorTexture&&V.fragment.uniforms.add(new L.Texture2DPassUniform("tex",U=>U.texture)),V.include(f.PhysicallyBasedRenderingParameters,N),V.include(y.PhysicallyBasedRendering,
N),V.fragment.include(B.MixExternalColor),V.extensions.add("GL_OES_standard_derivatives"),T.add(G.glsl`
      void main() {
        discardBySlice(vpos);
        ${N.hasMultipassTerrain?G.glsl`terrainDepthTest(gl_FragCoord, depth);`:""}
        ${N.hasColorTexture?G.glsl`
                vec4 texColor = texture2D(tex, vuv0);
                ${N.textureAlphaPremultiplied?"texColor.rgb /\x3d texColor.a;":""}
                discardOrAdjustAlpha(texColor);`:G.glsl`vec4 texColor = vec4(1.0);`}
        vec3 viewDirection = normalize(vpos - cameraPosition);
        ${N.pbrMode===f.PBRMode.Normal?"applyPBRFactors();":""}
        float ssao = evaluateAmbientOcclusionInverse();
        ssao *= getBakedOcclusion();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${N.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":N.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 matColor = max(ambient, diffuse);
        ${N.hasVertexColors?G.glsl`
                vec3 albedo = mixExternalColor(vColor.rgb * matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(vColor.a * opacity, texColor.a, vcolorExt.a, int(colorMixMode));`:G.glsl`
                vec3 albedo = mixExternalColor(matColor, texColor.rgb, vcolorExt.rgb, int(colorMixMode));
                float opacity_ = layerOpacity * mixExternalOpacity(opacity, texColor.a, vcolorExt.a, int(colorMixMode));`}
        ${N.snowCover?G.glsl`albedo = mix(albedo, vec3(1), 0.9);`:G.glsl``}
        ${G.glsl`
            vec3 shadingNormal = normalize(vNormalWorld);
            albedo *= 1.2;
            vec3 viewForward = vec3(view[0][2], view[1][2], view[2][2]);
            float alignmentLightView = clamp(dot(viewForward, -lightingMainDirection), 0.0, 1.0);
            float transmittance = 1.0 - clamp(dot(viewForward, shadingNormal), 0.0, 1.0);
            float treeRadialFalloff = vColor.r;
            float backLightFactor = 0.5 * treeRadialFalloff * alignmentLightView * transmittance * (1.0 - shadow);
            additionalLight += backLightFactor * lightingMainIntensity;`}
        ${N.pbrMode===f.PBRMode.Normal||N.pbrMode===f.PBRMode.Schematic?N.spherical?G.glsl`vec3 normalGround = normalize(vpos + localOrigin);`:G.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`:G.glsl``}
        ${N.pbrMode===f.PBRMode.Normal||N.pbrMode===f.PBRMode.Schematic?G.glsl`
                float additionalAmbientIrradiance = additionalAmbientIrradianceFactor * lightingMainIntensity[2];
                ${N.snowCover?G.glsl`
                        mrr = vec3(0.0, 1.0, 0.04);
                        emission = vec3(0.0);`:""}

                vec3 shadedColor = evaluateSceneLightingPBR(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight, viewDirection, normalGround, mrr, emission, additionalAmbientIrradiance);`:G.glsl`vec3 shadedColor = evaluateSceneLighting(shadingNormal, albedo, shadow, 1.0 - ssao, additionalLight);`}
        gl_FragColor = highlightSlice(vec4(shadedColor, opacity_), vpos);
        ${N.transparencyPassType===R.TransparencyPassType.Color?G.glsl`gl_FragColor = premultiplyAlpha(gl_FragColor);`:G.glsl``}
      }
    `));V.include(t.DefaultMaterialAuxiliaryPasses,N);return V}const P=Object.freeze(Object.defineProperty({__proto__:null,build:I},Symbol.toStringTag,{value:"Module"}));a.RealisticTree=P;a.build=I})},"esri/views/3d/layers/graphics/Graphics3DIconSymbolLayer":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../symbols ../../../../core/asyncUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../chunks/mat4f64 ../../../../chunks/vec2f64 ../../../../chunks/vec3f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../support/arcadeOnDemand ../../../../symbols/support/IconSymbol3DLayerResource ../../../../symbols/support/utils ../../../2d/arcade/callExpressionWithFeature ./constants ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./placementUtils ./pointUtils ./sdfPrimitives ../support/FastSymbolUpdates ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/HUDMaterial ../../../../symbols/CIMSymbol".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H,U){function W(ka){return h.isNone(ka)?!1:"cross"===ka||"x"===ka}const Q=p.create(),X=q.fromValues(0,0,1);l=J.DEFAULT_TEX_SIZE;const ba=J.DEFAULT_SYMBOL_SIZE_RATIO,aa=[ba/2,ba/2,1-ba/2,1-ba/2];l=[l*ba,l*ba];O=function(ka){function la(ca,Y,da,ha){ca=ka.call(this,ca,Y,da,ha)||this;ca._cimLayers=null;ca._cimSymbolMaterials=new Map;ca._cimSymbolTextures=new Map;ca._cimMaterialParametersInfo=null;ca._cimRequiredFields=
null;ca._cimScaleFactorOrFunction=null;ca._size=null;ca._symbolTextureRatio=1;ca._outlineSize=0;ca._elevationOptions={supportsOffsetAdjustment:!0,supportsOnTheGround:!0};return ca}c._inheritsLoose(la,ka);var Z=la.prototype;Z.getCachedSize=function(){return{size:this._getIconSize()}};Z.doLoad=function(){var ca=c._asyncToGenerator(function*(Y){this._validateOrThrow();const da=this._prepareMaterialParameters();var ha=this._getPrimitive();if(h.isSome(ha))this._prepareResourcesPrimitive(da,ha);else{ha=
A.getIconHref(this.symbol,this.symbolLayer);const ja=g.dataComponents(ha);ja&&"application/json"===ja.mediaType?yield this._prepareResourcesCIM(da,JSON.parse(ja.data),Y):yield this._prepareResourcesHref(da,ha,Y)}});return function(Y){return ca.apply(this,arguments)}}();Z._validateOrThrow=function(){if(!this._drivenProperties.size){var ca=K.validateSymbolLayerSize(this._getIconSize());if(ca)throw new v("graphics3diconsymbollayer:invalid-size",ca);}};Z._getIconSize=function(){var ca=this.symbolLayer;
ca=Math.round(null!=ca.size?e.pt2px(ca.size):16);return this._drivenProperties.size?Math.max(ca,64):ca};Z._generateTextureCIM=function(ca){const Y=this._getGraphicHash(ca);let da=""===Y?null:this._cimSymbolTextures.get(Y);da||(ca=this._context.sharedResources.cimSymbolRasterizer.rasterizeCIMSymbol(this._cimLayers,ca,"esriGeometryPoint",{scaleFactor:this._cimScaleFactorOrFunction},null,null),this._cimMaterialParametersInfo.anchorPosition=this._getAnchorPos("relative",ca.anchorPosition),da=new T.Texture(ca.imageData,
{width:ca.imageData.width,height:ca.imageData.height,powerOfTwoResizeMode:N.PowerOfTwoResizeMode.PAD}),this._cimSymbolTextures.set(Y,da),this._context.stage.add(da));return da};Z._computeSize=function(ca,Y){ca=ca.width/ca.height;return 1<ca?[Y,Math.round(Y/ca)]:[Math.round(Y*ca),Y]};Z._prepareMaterialParameters=function(){const ca={anchorPosition:this._getAnchorPos(this.symbolLayer.anchor,this.symbolLayer.anchorPosition)},Y=this.symbol;if(Y&&"point-3d"===Y.type&&Y.hasVisibleVerticalOffset()){const {screenLength:da,
minWorldLength:ha,maxWorldLength:ja}=Y.verticalOffset;ca.verticalOffset={screenLength:e.pt2px(da),minWorldLength:ha||0,maxWorldLength:null!=ja?ja:Infinity}}this._context.screenSizePerspectiveEnabled&&(ca.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);ca.occlusionTest=!0;ca.hasSlicePlane=this._context.slicePlaneEnabled;return ca};Z._prepareResourcesPrimitive=function(ca,Y){var da=this._getOutlineSize();if(W(Y)&&0===da)throw Error("Nothing to render");this._outlineSize=
da;ca.color=this._getFillColor();ca.outlineColor=this._getOutlineColor();ca.outlineSize=this._outlineSize;da=this._context.sharedResources.textures.fromData(Y,()=>J.createTexture(Y));this._texture=da.texture;this._releaseTexture=da;ca.textureIsSignedDistanceField=!0;ca.distanceFieldBoundingBox=aa;ca.textureId=this._texture.id;da=this._getIconSize();this._size=[da,da];this._symbolTextureRatio=1/ba;this._createMaterialAndAddToStage(ca,this._context.stage)};Z._prepareResourcesHref=function(){var ca=
c._asyncToGenerator(function*(Y,da,ha){if(!m("esri-canvas-svg-support")&&g.isSVG(da))throw new v("graphics3diconsymbollayer:unsupported-image-format","IconSymbol3DLayer failed to load (SVG symbols are not supported in IE11)");this._outlineSize=this._getOutlineSize();Y.color=this._getFillColor();Y.outlineColor=this._getOutlineColor();Y.outlineSize=this._outlineSize;Y.textureIsSignedDistanceField=!1;const ja=this._getIconSize();ha=yield u.result(this._context.sharedResources.textures.fromUrl(da,ja*
this._context.graphicsCoreOwner.view.state.pixelRatio,{signal:ha}));if(!1===ha.ok)throw d.throwIfAbortError(ha.error),new v("graphics3diconsymbollayer:request-failed",`Failed to load (Request for icon resource failed: ${da})`);this._releaseTexture=ha.value;da=ha.value.texture;this._size=this._computeSize(da.params,ja);Y.textureId=da.id;this._createMaterialAndAddToStage(Y,this._context.stage)});return function(Y,da,ha){return ca.apply(this,arguments)}}();Z._prepareResourcesCIM=function(){var ca=c._asyncToGenerator(function*(Y,
da,ha){da=new U({data:da});if(!this._context.sharedResources.cimSymbolRasterizer){var ja=(yield new Promise((wa,xa)=>a(["../../../../symbols/cim/CIMSymbolRasterizer"],wa,xa))).CIMSymbolRasterizer;d.throwIfAborted(ha);this._context.sharedResources.cimSymbolRasterizer||(this._context.sharedResources.cimSymbolRasterizer=new ja(this._context.renderCoordsHelper.spatialReference,!0))}ja=this._context.layer.fields?this._context.layer.fields.map(wa=>wa.toJSON()):null;this._cimLayers=yield this._context.sharedResources.cimSymbolRasterizer.analyzeCIMSymbol(da,
ja,this._context.renderer&&"dictionary"===this._context.renderer.type?this._context.renderer.fieldMap:null,"esriGeometryPoint",{signal:ha});let ma;if(this._context.renderer&&"dictionary"===this._context.renderer.type&&this._context.renderer.scaleExpression)if(da=this._context.renderer,isNaN(da.scaleExpression)){const wa=yield w.createRendererExpression(da.scaleExpression,this._context.layer.spatialReference,ja);ma=(xa,sa,ya)=>{xa=x(wa,xa,{$view:ya},"esriGeometryPoint",sa);return null!==xa?xa:1}}else var pa=
Number(da.scaleExpression);this._cimScaleFactorOrFunction=pa||ma||1;pa=this._context.renderer?yield this._context.renderer.getRequiredFields(this._context.layer.fieldsIndex):[];d.throwIfAborted(ha);const na=this._context.layer.fieldsIndex;this._cimRequiredFields=pa.map(wa=>na.get(wa).name);this._cimMaterialParametersInfo=Y;this._cimMaterialParametersInfo.color=this._getFillColor();this._cimMaterialParametersInfo.outlineColor=[0,0,0,0];this._cimMaterialParametersInfo.outlineSize=0;this._cimMaterialParametersInfo.textureIsSignedDistanceField=
!1});return function(Y,da,ha){return ca.apply(this,arguments)}}();Z._getPrimitive=function(){return this.symbolLayer.resource&&this.symbolLayer.resource.href?null:this.symbolLayer.resource&&this.symbolLayer.resource.primitive||z.defaultPrimitive};Z._getOutlineSize=function(){var ca=0;ca=this.symbolLayer;if(h.isSome(ca.outline)&&null!=ca.outline.size)return Math.max(e.pt2px(ca.outline.size),0);ca=this._getPrimitive();ca=W(ca)?1.5:0;return Math.max(ca,0)};Z._getOutlineColor=function(){const ca=this._getLayerOpacity(),
Y=h.get(this.symbolLayer,"outline","color");if(h.isSome(Y)){const da=n.toUnitRGB(Y);return[da[0],da[1],da[2],Y.a*ca]}return[0,0,0,0]};Z._getFillColor=function(){if(W(this._getPrimitive()))return B.TRANSPARENT_UNIT;const ca=h.isNone(this._getPrimitive()),Y=h.get(this.symbolLayer,"material","color");return this._getCombinedOpacityAndColor(Y,{hasIntrinsicColor:ca})};Z._getAnchorPos=function(ca,Y){return"relative"===ca?t.fromValues((Y.x||0)+.5,-(Y.y||0)+.5):ca in R.namedAnchorToHUDMaterialAnchorPos?R.namedAnchorToHUDMaterialAnchorPos[ca]:
R.namedAnchorToHUDMaterialAnchorPos.center};Z._createMaterialAndAddToStage=function(ca,Y){this._fastUpdates=this._cimLayers?{enabled:!1}:I.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions());this._fastUpdates.enabled&&Object.assign(ca,this._fastUpdates.materialParameters);if(this._cimLayers){let da=h.isSome(ca.textureId)?this._cimSymbolMaterials.get(ca.textureId):null;da||(da=new H.HUDMaterial(ca),this._cimSymbolMaterials.set(h.unwrapOr(ca.textureId,0),da),
Y.add(da));return da}this._material=new H.HUDMaterial(ca);Y.add(this._material);return this._material};Z._setDrapingDependentMaterialParameters=function(){this.draped&&(this._forEachMaterial(ca=>{ca.setParameters({verticalOffset:null,screenSizePerspective:null,occlusionTest:!1,hasSlicePlane:!1,shaderPolygonOffset:0,isDraped:this.draped})}),this.layerOpacityChanged())};Z.destroy=function(){ka.prototype.destroy.call(this);this._forEachMaterial(ca=>this._context.stage.remove(ca));this._material=null;
this._cimSymbolMaterials.clear();this._cimSymbolTextures.forEach(ca=>this._context.stage.remove(ca));this._cimSymbolTextures.clear();this._releaseTexture=h.releaseMaybe(this._releaseTexture)};Z._getScaleFactor=function(ca,Y){if(this._drivenProperties.size&&ca.size){for(let da=0;3>da;da++){const ha=ca.size[da];ha&&"symbol-value"!==ha&&"proportional"!==ha&&(ca.size[da]=e.pt2px(ha))}if("symbol-value"===ca.size[0])return 1;if(isFinite(+ca.size[0]))return+ca.size[0]/Y;if(isFinite(+ca.size[2]))return+ca.size[2]/
Y}return 1};Z.createGraphics3DGraphic=function(ca){const Y=ca.graphic;if(!this._validateGeometry(Y.geometry))return null;let da;if(this._cimLayers){if(!this._cimLayers.length)return null;var ha=this._generateTextureCIM(Y);da=this._createMaterialAndAddToStage({textureId:ha.id,...this._cimMaterialParametersInfo},this._context.stage);var ja=[ha.params.width,ha.params.height]}else ja=this._size,da=h.unwrap(this._material);ha=M.placePointOnGeometry(Y.geometry);if(h.isNone(ha))return this.logger.warn(`unsupported geometry type for icon symbol: ${Y.geometry.type}`),
null;var ma=ca.renderingInfo;const pa=this._getVertexOpacityAndColor(ma);let na=1;this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||(na=this._getScaleFactor(ma,ja[0]>ja[1]?ja[0]:ja[1]));na*=this._symbolTextureRatio;ja=[ja[0]*na,ja[1]*na];ma=this.setGraphicElevationContext(Y,new E.ElevationContext);this.ensureDrapedStatus("on-the-ground"===ma.mode)&&this._setDrapingDependentMaterialParameters();return this.draped?this._createAsOverlay(Y,ha,da,pa,ja,ca.layer.uid):this._createAs3DShape(Y,
ha,da,pa,ja,ma,Y.uid)};Z.layerOpacityChanged=function(){const ca=this._getFillColor(),Y=this._getOutlineColor();this._forEachMaterial(da=>{da.setParameters({color:ca});da.setParameters({outlineColor:Y})});return!0};Z.layerElevationInfoChanged=function(ca,Y,da){const ha=this._elevationContext.mode;da=D.elevationModeChangeUpdateType(la.elevationModeChangeTypes,da,ha);if(da!==D.SymbolUpdateType.UPDATE)return da;const ja=D.needsElevationUpdates2D(ha)||"absolute-height"===ha;return this.updateGraphics3DGraphicElevationInfo(ca,
Y,()=>ja)};Z.slicePlaneEnabledChanged=function(){this.draped||this._forEachMaterial(ca=>{ca.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};Z.physicalBasedRenderingChanged=function(){return!0};Z.pixelRatioChanged=function(){return this._getPrimitive()?!0:!1};Z.applyRendererDiff=function(ca,Y){for(const da in ca.diff)switch(da){case "visualVariables":if(I.updateFastSymbolUpdatesState(this._fastUpdates,Y,this._fastVisualVariableConvertOptions()))h.isSome(this._material)&&
this._material.setParameters(this._fastUpdates.materialParameters);else return L.ApplyRendererDiffResult.Recreate_Symbol;break;default:return L.ApplyRendererDiffResult.Recreate_Symbol}return L.ApplyRendererDiffResult.Fast_Update};Z._defaultElevationInfoNoZ=function(){return ea};Z._createAs3DShape=function(ca,Y,da,ha,ja,ma,pa){const na=this.getFastUpdateAttrValues(ca);ca=na?xa=>I.evaluateModelTransform(this._fastUpdates.materialParameters,na,xa):null;ha=[V.createPointGeometry(X,null,ha,ja,ia,null,
na)];pa=M.createStageObjectForHUD(this._context,Y,ha,[da],ma,this._context.layer.uid,pa,ca);if(null===pa)return null;const wa=new G.Graphics3DObject3DGraphicLayer(this,pa.object,ha,null,null,C.perObjectElevationAligner,ma);wa.alignedSampledElevation=pa.sampledElevation;wa.needsElevationUpdates=D.needsElevationUpdates2D(ma.mode)||"absolute-height"===ma.mode;wa.getScreenSize=this._createScreenSizeGetter(ja,ca);wa.calculateRelativeScreenBounds=xa=>da.calculateRelativeScreenBounds(wa.getScreenSize(),
1,xa);M.extendPointGraphicElevationContext(wa,Y,this._context.elevationProvider);return wa};Z._createAsOverlay=function(ca,Y,da,ha,ja,ma){da.renderPriority=this._renderPriority;const pa=r.create();y.projectPointToVector(Y,pa,this._context.overlaySR);pa[2]=P.DRAPED_Z;Y=this._context.clippingExtent;if(h.isSome(Y)&&!f.containsPoint(Y,pa))return null;const na=this.getFastUpdateAttrValues(ca);Y=na?xa=>I.evaluateModelTransform(this._fastUpdates.materialParameters,na,xa):null;ha=V.createPointGeometry(X,
pa,ha,ja,null,null,na);ca=new S.RenderGeometry(ha,da,{layerUid:ma,graphicUid:ca.uid,calculateShaderTransformation:Y});pa[3]=0;k.copy(ca.boundingSphere,pa);const wa=new F(this,[ca],null,this._context.drapeSourceRenderer);wa.getScreenSize=this._createScreenSizeGetter(ja,Y);wa.calculateRelativeScreenBounds=xa=>da.calculateRelativeScreenBounds(wa.getScreenSize(),1,xa);return wa};Z._createScreenSizeGetter=function(ca,Y){const da=this._outlineSize+2;if(this._fastUpdates.enabled){const ha=ca[0]/this._symbolTextureRatio,
ja=ca[1]/this._symbolTextureRatio;return(ma=t.create())=>{const pa=Y(Q);ma[0]=pa[0]*ha+da;ma[1]=pa[5]*ja+da;return ma}}{const ha=ca[0]/this._symbolTextureRatio+da,ja=ca[1]/this._symbolTextureRatio+da;return(ma=t.create())=>{ma[0]=ha;ma[1]=ja;return ma}}};Z._fastVisualVariableConvertOptions=function(){var ca=this._size[0]>this._size[1]?this._size[0]:this._size[1];const Y=q.fromValues(ca,ca,ca),da=e.px2pt(1);ca*=da;ca=q.fromValues(ca,ca,ca);return{modelSize:Y,symbolSize:ca,unitInMeters:da,transformation:{anchor:q.ZEROS,
scale:q.ONES,rotation:q.ZEROS}}};Z._getGraphicHash=function(ca){let Y="";for(const da of this._cimRequiredFields)Y+=da+ca.attributes[da];return Y};Z._forEachMaterial=function(ca){h.isSome(this._material)&&ca(this._material);this._cimSymbolMaterials.forEach(ca)};Z.test=function(){return{...ka.prototype.test.call(this),material:this._material}};return la}(O.Graphics3DSymbolLayer);O.PRIMITIVE_SIZE=l;O.elevationModeChangeTypes={definedChanged:D.SymbolUpdateType.UPDATE,staysOnTheGround:D.SymbolUpdateType.NONE,
onTheGroundChanged:D.SymbolUpdateType.RECREATE};const ea={mode:"relative-to-ground",offset:0},ia=r.fromValues(0,0,0,1);b.Graphics3DIconSymbolLayer=O;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/arcade/callExpressionWithFeature":function(){define(["../../../core/Error","../../../core/Logger","../../../geometry/support/quantizationUtils"],function(a,b,c){function n(u){const v={};switch(u){case "esriGeometryPoint":return(m,h,d,e)=>c.unquantizePoint(h,
v,m,d,e);case "esriGeometryPolygon":return(m,h,d,e)=>c.unquantizePolygon(h,v,m,d,e);case "esriGeometryPolyline":return(m,h,d,e)=>c.unquantizePolyline(h,v,m,d,e);case "esriGeometryMultipoint":return(m,h,d,e)=>c.unquantizeMultipoint(h,v,m,d,e);default:return b.getLogger("esri.views.2d.support.arcadeOnDemand").error(new a("mapview-arcade",`Unable to handle geometryType: ${u}`)),m=>m}}const l=new Map;return function(u,v,m,h,d){if(u.referencesGeometry()&&d){{const {transform:e,hasZ:g,hasM:p}=d;l.has(h)||
l.set(h,n(h));h=l.get(h)(v.geometry,e,g,p);v={...v,geometry:h}}}v=u.repurposeFeature(v);try{return u.evaluate({...m,$feature:v})}catch(e){return b.getLogger("esri.views.2d.support.arcadeOnDemand").warn("Feature arcade evaluation failed:",e),null}}})},"esri/views/3d/layers/graphics/constants":function(){define(["exports","../../../../chunks/vec4f64"],function(a,b){const c=b.ZEROS;b=b.ONES;a.SUSPEND_RESUME_EXTENT_OPTIMISM=1.2;a.TRANSPARENT_UNIT=c;a.WHITE_UNIT=b;a.defaultIconElevationOffset=1;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DDrapedGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/ModelDirtyTypes".split(" "),function(a,b,c,n,l,u,v,m,h){let d=function(){function t(k,
r,y,f){this.graphics3DSymbolLayer=k;this.renderGeometries=r;this.boundingBox=y;this._drapeSourceRenderer=f;this.type="draped";this.stage=null;this.isElevationSource=this._addedToStage=this._visible=!1}var q=t.prototype;q.initialize=function(k){this.stage=k};q.setVisibility=function(k){if(null!=this.stage&&this._visible!==k)if((this._visible=k)&&!this._addedToStage)this._addedToStage=!0,this._drapeSourceRenderer.addGeometries(this.renderGeometries,h.ModelDirty.Geometry.ADD);else if(k||this._addedToStage){for(const r of this.renderGeometries)r.instanceParameters.visible=
this._visible;this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,h.ModelDirty.State.VISIBILITIES)}};q.destroy=function(){this.stage&&this._addedToStage&&this._drapeSourceRenderer.removeGeometries(this.renderGeometries,h.ModelDirty.Geometry.REMOVE);this._visible=this._addedToStage=!1;this.stage=null};q.getCenterObjectSpace=function(k=n.create()){return c.set(k,0,0,0)};q.getBoundingBoxObjectSpace=function(k=l.create()){return l.empty(k)};q.addObjectState=function(k,r){k===m.Object3DState.Highlight&&
(this.renderGeometries.forEach(y=>{const f=y.addHighlight();r.addRenderGeometry(y,f,this)}),this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,h.ModelDirty.State.HIGHLIGHTS))};q.removeObjectState=function(k){this.renderGeometries.forEach(r=>{k.removeRenderGeometry(r)})};q.removeRenderGeometryObjectState=function(k,r){k.removeHighlight(r);this._addedToStage&&this._drapeSourceRenderer.modifyGeometries(this.renderGeometries,h.ModelDirty.State.HIGHLIGHTS)};q.computeAttachmentOrigin=
function(k){for(const r of this.renderGeometries)r.computeAttachmentOrigin(p)&&(k.draped.origin[0]+=p[0],k.draped.origin[1]+=p[1],k.draped.num++)};q.getProjectedBoundingBox=function(){var k=a._asyncToGenerator(function*(r,y,f,w,z){l.empty(z);for(let A=0;A<this.renderGeometries.length;A++)this._getRenderGeometryProjectedBoundingRect(this.renderGeometries[A],r,e,f),l.expandWithRect(z,e);if(y){l.center(z,p);let A;r=v.demResolutionForBoundingBox(z,y);try{A=yield y.service.queryElevation(p[0],p[1],w,r,
"ground")}catch(x){}b.isSome(A)&&(z[2]=Math.min(z[2],A),z[5]=Math.max(z[5],A))}return z});return function(r,y,f,w,z){return k.apply(this,arguments)}}();q._getRenderGeometryProjectedBoundingRect=function(k,r,y,f){if(this.boundingBox)l.set(g,this.boundingBox);else{k=k.boundingSphere;const w=k[3];g[0]=k[0]-w;g[1]=k[1]-w;g[2]=k[2]-w;g[3]=k[0]+w;g[4]=k[1]+w;g[5]=k[2]+w}r(g,0,2);this.calculateRelativeScreenBounds&&f.push({location:l.center(g),screenSpaceBoundingRect:this.calculateRelativeScreenBounds()});
return l.toRect(g,y)};return t}();const e=u.create(),g=l.create(),p=n.create();return d})},"esri/views/3d/layers/graphics/placementUtils":function(){define(["exports","../../../../chunks/vec2f64","../../webgl-engine/lib/TextRenderer"],function(a,b,c){b={"bottom-left":b.fromValues(0,0),bottom:b.fromValues(.5,0),"bottom-right":b.fromValues(1,0),left:b.fromValues(0,.5),center:b.fromValues(.5,.5),right:b.fromValues(1,.5),"top-left":b.fromValues(0,1),top:b.fromValues(.5,1),"top-right":b.fromValues(1,1)};
a.anchorFromPlacements=function(n,l){switch(l){case "bottom":return"left"===n?"bottom-left":"right"===n?"bottom-right":"bottom";case "center":return n;case "top":return"left"===n?"top-left":"right"===n?"top-right":"top"}};a.horizontalPlacementFromAnchor=function(n){switch(n){case "bottom-left":case "left":case "top-left":return"left";case "bottom":case "center":case "top":return"center";case "bottom-right":case "right":case "top-right":return"right"}};a.horizontalPlacementToAnchorX={left:0,center:.5,
right:1};a.namedAnchorToHUDMaterialAnchorPos=b;a.textRenderAlignmentFromHorizontalPlacement=function(n){switch(n){case "left":return c.TextRenderAlignment.Left;case "right":return c.TextRenderAlignment.Right;default:return c.TextRenderAlignment.Center}};a.verticalPlacementFromAlignment=function(n){return"middle"===n?"center":n};a.verticalPlacementFromAnchor=function(n){switch(n){case "bottom-left":case "bottom":case "bottom-right":return"bottom";case "left":case "center":case "right":return"center";
case "top-left":case "top":case "top-right":return"top"}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextRenderer":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/mathUtils","../../../../core/maybe","../../support/debugFlags"],function(a,b,c,n,l){function u(e,g,p){e.canvas||(e.canvas=document.createElement("canvas"));e.canvas.width=g;e.canvas.height=p;return e.canvas}let v=
function(){function e(p,t,q,k=2048){this.text=p;this._alignment=t;this._parameters=q;this.maxSize=k;this._textWidths=[];this._lineWidths=[];this._heightMetrics=this._displayWidth=this._renderPixelRatio=null;this.key=`TextRenderer-${this._parameters.key}-${this._alignment}--${p}`;this._lines=p.split(/\r?\n/)}var g=e.prototype;g._getLineXOffset=function(p){switch(this._alignment){case a.TextRenderAlignment.Left:return this.backgroundHorizontalPadding;case a.TextRenderAlignment.Center:return(this.displayWidth-
this._lineWidths[p])/2;case a.TextRenderAlignment.Right:return this.displayWidth-this.backgroundHorizontalPadding-this._lineWidths[p]}};g.render=function(p,t=0,q=0){p.save();t/=this.renderPixelRatio;q/=this.renderPixelRatio;const k=t,r=q;var y=this.haloSize,f=this.firstLineYOffset;t+=y;q+=f+this.baselinePosition;const w=0<this.haloSize;w&&this._renderHalo(p,k,r,y,f);this._setFontProperties(p,this.renderedFontSize);for(y=0;y<this._lines.length;++y){const z=this._lines[y],A=this._getLineXOffset(y);
w&&(p.globalCompositeOperation="destination-out",p.fillStyle="rgb(0, 0, 0)",this._fillText(p,z,t+A,q),this._renderLineDecoration(p,t+A,q,this._textWidths[y]));p.globalCompositeOperation="source-over";p.fillStyle=this._parameters.textStyle;this._fillText(p,z,t+this._getLineXOffset(y),q);this._renderLineDecoration(p,t+A,q,this._textWidths[y]);q+=this.lineSpacing}if(l.TEXT_SHOW_BASELINE)for(p.strokeStyle="rgb(255, 0, 255, 0.5)",p.setLineDash([2,2]),p.lineWidth=1,t=r+f,q=0;q<this._lines.length;++q)f=
t+this.baselinePosition,this._drawLine(p,[k,f],[k+this.displayWidth,f]),t+=this.lineSpacing;l.TEXT_SHOW_BORDER&&(p.strokeStyle="rgb(255, 0, 255, 0.5)",p.setLineDash([]),p.lineWidth=1,this._drawBox(p,[k,r],[this.displayWidth,this.displayHeight]));this.hasBackground&&(this._roundedRect(p,k,r,this._parameters.definition.background.borderRadius*this.renderPixelRatio),p.globalCompositeOperation="destination-over",p.fillStyle=this._parameters.backgroundStyle,p.fill());p.restore()};g._renderLineDecoration=
function(p,t,q,k,r=!1){if("none"!==this._parameters.definition.font.decoration&&0!==k){var y=Math.max(this._parameters.definition.size/16,1);switch(this._parameters.definition.font.decoration){case "underline":q+=2*y;break;case "line-through":q-=.33*this.baselinePosition}var f=r?this.haloSize:0;p.strokeStyle=r?this._parameters.haloStyle:this._parameters.textStyle;p.lineWidth=this._toRenderUnit(y+2*f);p.beginPath();p.moveTo(this._toRenderUnit(t-f),this._toRenderUnit(q));p.lineTo(this._toRenderUnit(t+
k+f),this._toRenderUnit(q));p.stroke()}};g._roundedRect=function(p,t,q,k){t=this._toRenderUnit(t);q=this._toRenderUnit(q);const r=this.renderedWidth,y=this.renderedHeight;0===k?p.rect(t,q,r,y):(k=c.clamp(k,0,Math.floor(y/2)),p.beginPath(),p.moveTo(t,q+k),p.arcTo(t,q,t+k,q,k),p.lineTo(t+r-k,q),p.arcTo(t+r,q,t+r,q+k,k),p.lineTo(t+r,q+y-k),p.arcTo(t+r,q+y,t+r-k,q+y,k),p.lineTo(t+k,q+y),p.arcTo(t,q+y,t,q+y-k,k),p.closePath())};g._renderHalo=function(p,t,q,k,r){const y=this.renderedWidth,f=this.renderedHeight,
w=u(h,Math.max(y,512),Math.max(f,512)),z=w.getContext("2d");z.clearRect(0,0,y,f);this._setFontProperties(z,this.renderedFontSize);z.fillStyle=this._parameters.haloStyle;z.strokeStyle=this._parameters.haloStyle;var A=3>this.renderedHaloSize;z.lineJoin=A?"miter":"round";A?this._renderHaloEmulated(z,k,r):this._renderHaloNative(z,k,r);r+=this.baselinePosition;for(A=0;A<this._lines.length;++A){const x=this._getLineXOffset(A);this._renderLineDecoration(z,k+x,r,this._textWidths[A],!0);r+=this.lineSpacing}p.globalAlpha=
this._parameters.definition.halo.color[3];p.drawImage(w,0,0,y,f,this._toRenderUnit(t),this._toRenderUnit(q),y,f);p.globalAlpha=1};g._renderHaloEmulated=function(p,t,q){q+=this.baselinePosition;for(let k=0;k<this._lines.length;++k){const r=this._lines[k],y=this._getLineXOffset(k);for(const [f,w]of m)this._fillText(p,r,t+y+this.haloSize*f,q+this.haloSize*w);q+=this.lineSpacing}};g._renderHaloNative=function(p,t,q){const k=2*this.haloSize;q+=this.baselinePosition;for(let r=0;r<this._lines.length;++r){const y=
this._lines[r],f=this._getLineXOffset(r);for(let w=0;5>w;w++)p.lineWidth=this._toRenderUnit((.6+.1*w)*k),this._strokeText(p,y,t+f,q);q+=this.lineSpacing}};g._setFontProperties=function(p,t){p.font=this._parameters.fontString(t);p.textAlign="left";p.textBaseline="alphabetic"};g._ensureTextWidth=function(){if(n.isSome(this._displayWidth))return this._displayWidth;const p=u(h,512,512).getContext("2d");this._setFontProperties(p,this.fontSize);let t=2*this.haloSize;var q=this._parameters.definition.font;
if("italic"===q.style||"oblique"===q.style||"bold"===q.weight||"bolder"===q.weight)t+=.3*p.measureText("A").width;this._textWidths.length=0;q=this._lineWidths.length=0;for(const k of this._lines){const r=p.measureText(k).width,y=r+t;this._textWidths.push(r);this._lineWidths.push(y);q=Math.max(q,y)}return this._displayWidth=q};g._ensureHeightMetrics=function(){if(n.isNone(this._heightMetrics)){var p=u(h,512,512).getContext("2d");this._setFontProperties(p,this.fontSize);const t=p.measureText(this.text+
d),q=this.hasBackground?p.measureText(this._lines[0]):t;p=1===this._lines.length?q:this.hasBackground?p.measureText(this._lines[this._lines.length-1]):t;this._heightMetrics={paddingTop:t.actualBoundingBoxAscent-q.actualBoundingBoxAscent,paddingBottom:t.actualBoundingBoxDescent-p.actualBoundingBoxDescent,lineHeight:t.actualBoundingBoxAscent+t.actualBoundingBoxDescent,baselinePosition:t.actualBoundingBoxAscent}}return this._heightMetrics};g._toRenderUnit=function(p){return p*this.renderPixelRatio};
g._toRoundedRenderUnit=function(p){return Math.round(p*this.renderPixelRatio)};g._fillText=function(p,t,q,k){p.fillText(t,this._toRenderUnit(q),this._toRenderUnit(k))};g._strokeText=function(p,t,q,k){p.strokeText(t,this._toRenderUnit(q),this._toRenderUnit(k))};g._drawLine=function(p,t,q){p.beginPath();p.moveTo(this._toRoundedRenderUnit(t[0])+.5,this._toRoundedRenderUnit(t[1])+.5);p.lineTo(this._toRoundedRenderUnit(q[0])+.5,this._toRoundedRenderUnit(q[1])+.5);p.stroke()};g._drawBox=function(p,t,q){var k=
this._toRenderUnit(t[0]);t=this._toRenderUnit(t[1]);var r=this._toRenderUnit(q[0]);const y=this._toRenderUnit(q[1]);q=Math.floor(k)+.5;k=Math.ceil(k+r)-.5;r=Math.floor(t)+.5;t=Math.ceil(t+y)-.5;p.beginPath();p.moveTo(q,r);p.lineTo(k,r);p.lineTo(k,t);p.lineTo(q,t);p.lineTo(q,r);p.stroke()};b._createClass(e,[{key:"displayWidth",get:function(){return Math.ceil(this._ensureTextWidth()+2*this.backgroundHorizontalPadding)}},{key:"displayHeight",get:function(){return Math.ceil(this.lineSpacing*(this._lines.length-
1)+this.lineHeight+2*this.haloSize+this.backgroundTopPadding+this.backgroundBottomPadding)}},{key:"renderedWidth",get:function(){return Math.ceil(this._toRenderUnit(this.displayWidth))}},{key:"renderedHeight",get:function(){return Math.ceil(this._toRenderUnit(this.displayHeight))}},{key:"firstRenderedBaselinePosition",get:function(){return this._toRenderUnit(this.firstLineYOffset+this.baselinePosition)}},{key:"firstLineYOffset",get:function(){return this.backgroundTopPadding+this.haloSize}},{key:"heightMetrics",
get:function(){return this._ensureHeightMetrics()}},{key:"lineSpacing",get:function(){return(this.lineHeight+this.linePadding)*this._parameters.definition.lineSpacingFactor}},{key:"lineHeight",get:function(){return this.heightMetrics.lineHeight}},{key:"linePadding",get:function(){return.2*this.lineHeight}},{key:"baselinePosition",get:function(){return this.heightMetrics.baselinePosition}},{key:"renderedFontSize",get:function(){return this._toRenderUnit(this.fontSize)}},{key:"fontSize",get:function(){return this._parameters.definition.size}},
{key:"renderedHaloSize",get:function(){return this._toRenderUnit(this.haloSize)}},{key:"haloSize",get:function(){return this._parameters.haloSize}},{key:"backgroundHorizontalPadding",get:function(){return this.hasBackground?this._parameters.definition.background.padding[0]:0}},{key:"backgroundVerticalPadding",get:function(){return this.hasBackground?this._parameters.definition.background.padding[1]:0}},{key:"backgroundTopPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingTop)}},
{key:"backgroundBottomPadding",get:function(){return Math.max(0,this.backgroundVerticalPadding-this.heightMetrics.paddingBottom)}},{key:"hasBackground",get:function(){return!!this._parameters.backgroundStyle}},{key:"renderPixelRatio",get:function(){if(n.isNone(this._renderPixelRatio)){const p=this._parameters.definition.pixelRatio;this._renderPixelRatio=0<this.maxSize?Math.min(p,Math.min(this.maxSize/this.displayWidth,this.maxSize/this.displayHeight)):p}return this._renderPixelRatio}}]);return e}();
const m=[];for(let e=0;360>e;e+=22.5)m.push([Math.cos(Math.PI*e/180),Math.sin(Math.PI*e/180)]);a.TextRenderAlignment=void 0;(function(e){e[e.Left=0]="Left";e[e.Center=1]="Center";e[e.Right=2]="Right"})(a.TextRenderAlignment||(a.TextRenderAlignment={}));const h={canvas:null},d=(()=>{let e="";for(let g=32;127>g;g++)e+=String.fromCharCode(g);return e})();a.TextRenderer=v;a.getTextHelperCanvas=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FastSymbolUpdates":function(){define("exports ../../../../core/has ../../../../core/mathUtils ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../renderers/support/lengthUtils ../../support/debugFlags".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(K){return null!==K&&void 0!==K}function p(K){return"number"===typeof K}function t(K){return"string"===typeof K}function q(K,L){K&&K.push(L)}function k(K,L,R,M=v.create()){K=K||0;L=L||0;R=R||0;0!==K&&u.rotateZ(M,M,-K/180*Math.PI);0!==L&&u.rotateX(M,M,L/180*Math.PI);0!==R&&u.rotateY(M,M,R/180*Math.PI);return M}function r(K,L,R,M,J){const I=K.minSize,P=K.maxSize;if(K.expression)return q(J,"Could not convert size info: expression not supported"),!1;if(K.useSymbolValue)return K=
M.symbolSize[R],L.minSize[R]=K,L.maxSize[R]=K,L.offset[R]=L.minSize[R],L.factor[R]=0,L.type[R]=a.FastSizeType.DefinedSize,!0;if(g(K.field)){if(g(K.stops)){if(2===K.stops.length&&p(K.stops[0].size)&&p(K.stops[1].size))return y(K.stops[0].size,K.stops[1].size,K.stops[0].value,K.stops[1].value,L,R),L.type[R]=a.FastSizeType.DefinedSize,!0;q(J,"Could not convert size info: stops only supported with 2 elements");return!1}if(p(I)&&p(P)&&g(K.minDataValue)&&g(K.maxDataValue))return y(I,P,K.minDataValue,K.maxDataValue,
L,R),L.type[R]=a.FastSizeType.DefinedSize,!0;if(null!=d.meterIn[K.valueUnit])return L.minSize[R]=-Infinity,L.maxSize[R]=Infinity,L.offset[R]=0,L.factor[R]=1/d.meterIn[K.valueUnit],L.type[R]=a.FastSizeType.DefinedSize,!0;if("unknown"===K.valueUnit)return q(J,"Could not convert size info: proportional size not supported"),!1;q(J,"Could not convert size info: scale-dependent size not supported");return!1}if(!g(K.field)){if(K.stops&&K.stops[0]&&p(K.stops[0].size))return L.minSize[R]=K.stops[0].size,L.maxSize[R]=
K.stops[0].size,L.offset[R]=L.minSize[R],L.factor[R]=0,L.type[R]=a.FastSizeType.DefinedSize,!0;if(p(I))return L.minSize[R]=I,L.maxSize[R]=I,L.offset[R]=I,L.factor[R]=0,L.type[R]=a.FastSizeType.DefinedSize,!0}q(J,"Could not convert size info: unsupported variant of sizeInfo");return!1}function y(K,L,R,M,J,I){M=0<Math.abs(M-R)?(L-K)/(M-R):0;J.minSize[I]=0<M?K:L;J.maxSize[I]=0<M?L:K;J.offset[I]=K-R*M;J.factor[I]=M}function f(K,L,R,M){if(K.normalizationField||K.valueRepresentation)return q(M,"Could not convert size info: unsupported property"),
null;var J=K.field;if(null!=J&&!t(J))return q(M,"Could not convert size info: field is not a string"),null;if(!L.size)L.size={field:K.field,minSize:[0,0,0],maxSize:[0,0,0],offset:[0,0,0],factor:[0,0,0],type:[a.FastSizeType.Undefined,a.FastSizeType.Undefined,a.FastSizeType.Undefined]};else if(K.field)if(!L.size.field)L.size.field=K.field;else if(K.field!==L.size.field)return q(M,"Could not convert size info: multiple fields in use"),null;switch(K.axis){case "width":return(J=r(K,L.size,0,R,M))?L:null;
case "height":return(J=r(K,L.size,2,R,M))?L:null;case "depth":return(J=r(K,L.size,1,R,M))?L:null;case "width-and-depth":return(J=r(K,L.size,0,R,M))&&r(K,L.size,1,R,M),J?L:null;case null:case void 0:case "all":return(J=(J=(J=r(K,L.size,0,R,M))&&r(K,L.size,1,R,M))&&r(K,L.size,2,R,M))?L:null;default:return q(M,`Could not convert size info: unknown axis "${K.axis}""`),null}}function w(K,L,R){for(let M=0;3>M;++M){let J=L.unitInMeters;K.type[M]===a.FastSizeType.DefinedSize&&(J*=L.modelSize[M],K.type[M]=
a.FastSizeType.DefinedScale);K.minSize[M]/=J;K.maxSize[M]/=J;K.offset[M]/=J;K.factor[M]/=J}if(K.type[0]!==a.FastSizeType.Undefined)L=0;else if(K.type[1]!==a.FastSizeType.Undefined)L=1;else if(K.type[2]!==a.FastSizeType.Undefined)L=2;else return q(R,"No size axis contains a valid size or scale"),!1;for(R=0;3>R;++R)K.type[R]===a.FastSizeType.Undefined&&(K.minSize[R]=K.minSize[L],K.maxSize[R]=K.maxSize[L],K.offset[R]=K.offset[L],K.factor[R]=K.factor[L],K.type[R]=K.type[L]);return!0}function z(K,L,R){K[4*
L]=R.r/255;K[4*L+1]=R.g/255;K[4*L+2]=R.b/255;K[4*L+3]=R.a}function A(K,L,R){if(K.normalizationField)return q(R,"Could not convert color info: unsupported property"),null;if(t(K.field))if(K.stops){if(8<K.stops.length)return q(R,"Could not convert color info: too many color stops"),null;L.color={field:K.field,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]};K=K.stops;for(R=0;8>R;++R){const M=K[Math.min(R,K.length-1)];L.color.values[R]=M.value;z(L.color.colors,
R,M.color)}}else return q(R,"Could not convert color info: missing stops or colors"),null;else if(K.stops&&0<=K.stops.length)for(K=K.stops&&0<=K.stops.length&&K.stops[0].color,L.color={field:null,values:[0,0,0,0,0,0,0,0],colors:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]},R=0;8>R;R++)L.color.values[R]=Infinity,z(L.color.colors,R,K);else return q(R,"Could not convert color info: no field and no colors/stops"),null;return L}function x(K,L,R){if(K.normalizationField)return q(R,
"Could not convert opacity info: unsupported property"),null;if(t(K.field))if(K.stops){if(8<K.stops.length)return q(R,"Could not convert opacity info: too many opacity stops"),null;L.opacity={field:K.field,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]};K=K.stops;for(R=0;8>R;++R){const M=K[Math.min(R,K.length-1)];L.opacity.values[R]=M.value;L.opacity.opacityValues[R]=M.opacity}}else return q(R,"Could not convert opacity info: missing stops or opacities"),null;else if(K.stops&&0<=K.stops.length)for(K=
K.stops&&0<=K.stops.length&&K.stops[0].opacity,L.opacity={field:null,values:[0,0,0,0,0,0,0,0],opacityValues:[0,0,0,0,0,0,0,0]},R=0;8>R;R++)L.opacity.values[R]=Infinity,L.opacity.opacityValues[R]=K;else return q(R,"Could not convert opacity info: no field and no opacities/stops"),null;return L}function B(K,L,R){K=2===R&&"arithmetic"===K.rotationType;L.offset[R]=K?90:0;L.factor[R]=K?-1:1;L.type[R]=1}function C(K,L,R){if(!t(K.field))return q(R,"Could not convert rotation info: field is not a string"),
null;if(!L.rotation)L.rotation={field:K.field,offset:[0,0,0],factor:[1,1,1],type:[0,0,0]};else if(K.field)if(!L.rotation.field)L.rotation.field=K.field;else if(K.field!==L.rotation.field)return q(R,"Could not convert rotation info: multiple fields in use"),null;switch(K.axis){case "tilt":return B(K,L.rotation,0),L;case "roll":return B(K,L.rotation,1),L;case null:case void 0:case "heading":return B(K,L.rotation,2),L;default:return q(R,`Could not convert rotation info: unknown axis "${K.axis}""`),null}}
function D(K,L,R){if(!K)return null;const M=!L.supportedTypes||!!L.supportedTypes.size,J=!L.supportedTypes||!!L.supportedTypes.color,I=!L.supportedTypes||!!L.supportedTypes.rotation,P=!!L.supportedTypes&&!!L.supportedTypes.opacity,N=K.reduce((V,S)=>{if(!V)return V;if(S.valueExpression)return q(R,"Could not convert visual variables: arcade expressions not supported"),null;switch(S.type){case "size":return M?f(S,V,L,R):V;case "color":return J?A(S,V,R):V;case "opacity":return P?x(S,V,R):null;case "rotation":return I?
C(S,V,R):V;default:return null}},{size:null,color:null,opacity:null,rotation:null});return 0<K.length&&N&&!N.size&&!N.color&&!N.opacity&&!N.rotation||N&&N.size&&!w(N.size,L,R)?null:N}function E(K,L,R){if(!!K!==!!L||K&&K.field!==L.field)return!1;if(K&&"rotation"===R)for(R=0;3>R;R++)if(K.type[R]!==L.type[R]||K.offset[R]!==L.offset[R]||K.factor[R]!==L.factor[R])return!1;return!0}function F(K,L){const R={vvSizeEnabled:!1,vvSizeMinSize:null,vvSizeMaxSize:null,vvSizeOffset:null,vvSizeFactor:null,vvSizeValue:null,
vvColorEnabled:!1,vvColorValues:null,vvColorColors:null,vvOpacityEnabled:!1,vvOpacityValues:null,vvOpacityOpacities:null,vvSymbolAnchor:null,vvSymbolRotationMatrix:null},M=K&&null!=K.size;K&&K.size?(R.vvSizeEnabled=!0,R.vvSizeMinSize=K.size.minSize,R.vvSizeMaxSize=K.size.maxSize,R.vvSizeOffset=K.size.offset,R.vvSizeFactor=K.size.factor):K&&M&&(R.vvSizeValue=L.transformation.scale);K&&M&&(R.vvSymbolAnchor=L.transformation.anchor,R.vvSymbolRotationMatrix=l.create(),u.identity(O),k(L.transformation.rotation[2],
L.transformation.rotation[0],L.transformation.rotation[1],O),n.fromMat4(R.vvSymbolRotationMatrix,O));K&&K.color&&(R.vvColorEnabled=!0,R.vvColorValues=K.color.values,R.vvColorColors=K.color.colors);K&&K.opacity&&(R.vvOpacityEnabled=!0,R.vvOpacityValues=K.opacity.values,R.vvOpacityOpacities=K.opacity.opacityValues);return R}a.FastSizeType=void 0;(function(K){K[K.Undefined=0]="Undefined";K[K.DefinedSize=1]="DefinedSize";K[K.DefinedScale=2]="DefinedScale"})(a.FastSizeType||(a.FastSizeType={}));a.FastRotationType=
void 0;(function(K){K[K.Undefined=0]="Undefined";K[K.DefinedAngle=1]="DefinedAngle"})(a.FastRotationType||(a.FastRotationType={}));var G;(function(K){const L=v.create(),R=h.create();K.evaluateModelTransform=function(M,J,I){if(!M.vvSizeEnabled)return I;u.copy(L,I);I=M.vvSymbolRotationMatrix;u.set(O,I[0],I[1],I[2],0,I[3],I[4],I[5],0,I[6],I[7],I[8],0,0,0,0,1);u.multiply(L,L,O);for(I=0;3>I;++I)R[I]=c.clamp(M.vvSizeOffset[I]+J[0]*M.vvSizeFactor[I],M.vvSizeMinSize[I],M.vvSizeMaxSize[I]);u.scale(L,L,R);
u.translate(L,L,M.vvSymbolAnchor);return L};K.evaluateModelTransformScale=function(M,J,I){if(!J.vvSizeEnabled)return m.set(M,1,1,1);for(let P=0;3>P;++P)M[P]=c.clamp(J.vvSizeOffset[P]+I[0]*J.vvSizeFactor[P],J.vvSizeMinSize[P],J.vvSizeMaxSize[P]);return M}})(G||(G={}));const O=v.create();b=G.evaluateModelTransform;G=G.evaluateModelTransformScale;a.convertVisualVariables=D;a.evaluateModelTransform=b;a.evaluateModelTransformScale=G;a.getMaterialParams=F;a.initFastSymbolUpdatesState=function(K,L){return!K||
e.TESTS_DISABLE_FAST_UPDATES?{enabled:!1}:(K=D(K.visualVariables,L))?{enabled:!0,visualVariables:K,materialParameters:F(K,L),requiresShaderTransformation:K&&null!=K.size}:{enabled:!1}};a.updateFastSymbolUpdatesState=function(K,L,R){if(!L||!K.enabled)return!1;const M=K.visualVariables;L=D(L.visualVariables,R);if(!(L&&E(M.size,L.size,"size")&&E(M.color,L.color,"color")&&E(M.rotation,L.rotation,"rotation")&&E(M.opacity,L.opacity,"opacity")))return!1;K.visualVariables=L;K.materialParameters=F(L,R);K.requiresShaderTransformation=
L&&null!=L.size;return!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderGeometry":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4f64 ../../support/mathUtils ./basicInterfaces ./geometryDataUtils ./InstanceParameters ./Object3DStateID ./VertexAttribute ../materials/renderers/utils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){let k=function(){function y(w,z,A={}){this.data=w;this.material=z;this.boundingSphere=m.create();this.instanceParameters=new g.InstanceParameters;this._transformation=u.create();this._shaderTransformationDirty=!0;this.layerUid=c.unwrapOr(A.layerUid,null);this.graphicUid=c.unwrapOr(A.graphicUid,null);this.id=A.id?A.id:n.generateUID();this.boundingInfo=c.unwrapOr(A.boundingInfo,null);this.calculateShaderTransformation=c.unwrapOr(A.calculateShaderTransformation,
null);this.castShadow=A.castShadow?A.castShadow:!1}var f=y.prototype;f.updateTransformation=function(w){w(this._transformation);this._shaderTransformationDirty=!0;this.computeBoundingSphere(this._transformation,this.boundingSphere)};f.shaderTransformationChanged=function(){this._shaderTransformationDirty=!0};f.computeBoundingSphere=function(w,z,A=h.maxScale(w)){c.isNone(this.boundingInfo)||(v.transformMat4(z,this.boundingInfo.getCenter(),w),z[3]=this.boundingInfo.getBSRadius()*A)};f.getShaderTransformation=
function(){if(c.isNone(this.calculateShaderTransformation))return c.unwrapOr(this.transformation,u.IDENTITY);this._shaderTransformationDirty&&(this._shaderTransformation||(this._shaderTransformation=u.create()),l.copy(this._shaderTransformation,this.calculateShaderTransformation(c.unwrapOr(this.transformation,u.IDENTITY))),this._shaderTransformationDirty=!1);return this._shaderTransformation};f.computeAttachmentOrigin=function(w){if(this.material.computeAttachmentOrigin)return this.material.computeAttachmentOrigin(this,
w)?(c.isSome(this._transformation)&&v.transformMat4(w,w,this._transformation),!0):!1;const z=this.indices.get(t.VertexAttribute.POSITION),A=this.vertexAttributes.get(t.VertexAttribute.POSITION);return e.computeAttachmentOriginTriangles(A,z,w)?(c.isSome(this._transformation)&&v.transformMat4(w,w,this._transformation),!0):!1};f.addHighlight=function(){const w=new p.Object3DStateID(d.Object3DState.Highlight),z=this.instanceParameters;z.highlights=q.addObject3DStateID(z.highlights,w);return w};f.removeHighlight=
function(w){const z=this.instanceParameters;z.highlights=q.removeObject3DStateID(z.highlights,w)};b._createClass(y,[{key:"transformation",get:function(){return this._transformation}},{key:"hasShaderTransformation",get:function(){return c.isSome(this.calculateShaderTransformation)}},{key:"primitiveType",get:function(){return this.data.primitiveType}},{key:"indices",get:function(){return this.data.indices}},{key:"vertexAttributes",get:function(){return this.data.vertexAttributes}}]);return y}(),r=function(y){function f(){return y.apply(this,
arguments)||this}b._inheritsLoose(f,y);return f}(k);a.RenderGeometry=k;a.ValidatedRenderGeometry=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/InstanceParameters":function(){define(["exports"],function(a){a.InstanceParameters=function(){this.visible=!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLineSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/Error ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ../../../../renderers/support/renderingInfoUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./interfaces ./lineUtils ../support/FastSymbolUpdates ../support/markerUtils ../../support/debugFlags ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/LineMarkerMaterial ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/RibbonLineMaterial ../../../../geometry/Extent ../../../../geometry/Polygon".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G){const O=["polyline","polygon","extent"];c=function(L){function R(J,I,P,N){J=L.call(this,J,I,P,N)||this;J._uniformSize=1;return J}b._inheritsLoose(R,L);var M=R.prototype;M.doLoad=function(){var J=b._asyncToGenerator(function*(){this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[1,1,1],unitInMeters:1,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=
this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?w.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};if(!this._drivenProperties.size){const I=null!=this.symbolLayer.size?this.symbolLayer.size:u.px2pt(1);if(0>I)throw new n("graphics3dlinesymbollayer:invalid-size","Symbol sizes may not be negative values");this._uniformSize=I}this._markerTexture=z.prepareMarkerResources(this._context.sharedResources.textures,
this.symbolLayer.marker)});return function(){return J.apply(this,arguments)}}();M._getMaterialParameters=function(J,I=!1){var P;const N=this._getCombinedOpacityAndColor(I&&this._markerColor||this._materialColor);this._patternHidesLine&&!I&&(N[3]=0);J={width:this._computeMaterialWidth(null==(P=this.symbolLayer)?void 0:P.size),color:N,hasPolygonOffset:!0,join:this.symbolLayer.join||"miter",cap:f.parseCapType(this.symbolLayer.cap||"butt"),hasSlicePlane:this._context.slicePlaneEnabled,isClosed:J,stipplePattern:D.getStipplePatternForLinePattern(this.symbolLayer.pattern),
stippleScaleWithLineWidth:!0};return this._fastUpdates&&this._fastUpdates.visualVariables?{...J,...this._fastUpdates.materialParameters}:J};M.destroy=function(){L.prototype.destroy.call(this);this._forEachMaterial(J=>this._context.stage.remove(J));this._markerMaterial=this._wireframeRingMaterial=this._wireframeLineMaterial=this._ringMaterial=this._lineMaterial=null;this._markerTexture=l.releaseMaybe(this._markerTexture)};M._getDrivenSize=function(J){return this._drivenProperties.size&&J.size?u.pt2px(e.getDriverAxisSizeValueAny(J.size)):
1};M._getSizeFeatureAttributeData=function(J){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?r.getAttributeValue(this._fastUpdates.visualVariables.size.field,J):null};M._getDrivenColor=function(J){const I=h.fromValues(1,1,1,1);this._drivenProperties.color&&J.color&&(I[0]=J.color[0],I[1]=J.color[1],I[2]=J.color[2],0<J.color.length&&(I[3]=J.color[3]));this._drivenProperties.opacity&&J.opacity&&(I[3]=J.opacity);return I};M._getColorFeatureAttributeData=function(J){return this._fastUpdates.enabled&&
this._fastUpdates.visualVariables.color?r.getAttributeValue(this._fastUpdates.visualVariables.color.field,J):null};M._getOpacityFeatureAttributeData=function(J){return this._fastUpdates.enabled&&this._fastUpdates.visualVariables.opacity?r.getAttributeValue(this._fastUpdates.visualVariables.opacity.field,J):null};M.createGraphics3DGraphic=function(J){const I=J.graphic;if(!this._validateGeometry(I.geometry,O,this.symbolLayer.type))return null;const P=this.setGraphicElevationContext(I,new t.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===P.mode);return this.draped?this._createAsOverlay(J,this._context.layer.uid):this._createAs3DShape(J,P,I.uid)};M.applyRendererDiff=function(J,I){for(const P in J.diff)switch(P){case "visualVariables":if(w.updateFastSymbolUpdatesState(this._fastUpdates,I,this._vvConvertOptions))this._forEachMaterial(N=>N.setParameters(this._fastUpdates.materialParameters));else return y.ApplyRendererDiffResult.Recreate_Symbol;break;default:return y.ApplyRendererDiffResult.Recreate_Symbol}return y.ApplyRendererDiffResult.Fast_Update};
M.prepareSymbolLayerPatch=function(J){var I,P;if("partial"===J.diff.type){var N=J.diff.diff,V={};"complete"===(null==(I=N.size)?void 0:I.type)&&(V.width=this._computeMaterialWidth(N.size.newValue),delete N.size);"complete"===(null==(P=N.cap)?void 0:P.type)&&(V.cap=f.parseCapType(l.unwrapOr(N.cap.newValue,"butt")),delete N.cap);I=this._prepareMarkerPatch(J,N);this._prepareMaterialPatch(J,N,I);J.symbolLayerStatePatches.push(()=>this._forEachMaterial(S=>S.setParameters(V)))}};M.layerOpacityChanged=function(){this._forEachMaterial((J,
I)=>this._updateMaterialLayerOpacity(J,I));return!0};M._forEachMaterial=function(J){l.isSome(this._lineMaterial)&&J(this._lineMaterial);l.isSome(this._ringMaterial)&&J(this._ringMaterial);l.isSome(this._wireframeLineMaterial)&&J(this._wireframeLineMaterial);l.isSome(this._wireframeRingMaterial)&&J(this._wireframeRingMaterial);l.isSome(this._markerMaterial)&&J(this._markerMaterial,!0)};M._updateMaterialLayerOpacity=function(J,I=!1){var P=J.parameters.color;const N=l.get(this.symbolLayer,"material",
"color");I=this._patternHidesLine&&!I?0:this._getCombinedOpacity(N);P=h.fromValues(P[0],P[1],P[2],I);J.setParameters({color:P})};M.layerElevationInfoChanged=function(J,I,P){const N=this._elevationContext.mode;P=p.elevationModeChangeUpdateType(R.elevationModeChangeTypes,P,N);if(P!==p.SymbolUpdateType.UPDATE)return P;const V=p.needsElevationUpdates2D(N);return this.updateGraphics3DGraphicElevationInfo(J,I,()=>V)};M.slicePlaneEnabledChanged=function(){const J={hasSlicePlane:this._context.slicePlaneEnabled};
this._forEachMaterial(I=>I.setParameters(J));return!0};M.physicalBasedRenderingChanged=function(){return!0};M.pixelRatioChanged=function(){return!0};M._getGeometryAsPolygonOrPolyline=function(J){switch(J.type){case "extent":if(J instanceof F)return G.fromExtent(J);break;case "polygon":case "polyline":return J}return null};M._createAs3DShape=function(J,I,P){const N=this._getGeometryAsPolygonOrPolyline(J.graphic.geometry);var V="polygon"===N.type?N.rings:N.paths,S=[];const T=[],H=[],U=d.create(),W=
f.geometryToRenderInfo(N,this._context.elevationProvider,this._context.renderCoordsHelper,I);this._logGeometryCreationWarnings(W,V,"polygon"===N.type?"rings":"paths","LineSymbol3DLayer");for(V=0;V<W.lines.length;V++){const {position:Q,mapPosition:X}=W.lines[V];if(l.isSome(this._context.clippingExtent)&&(d.empty(U),d.expandWithBuffer(U,X),!d.intersectsClippingArea(U,this._context.clippingExtent)))continue;const ba=this._createGeometry(J,Q,X,N.type,K.ELEVATED);S.push(ba);T.push("polygon"===N.type?this.ringMaterial:
this.lineMaterial);H.push(v.IDENTITY);A.LINE_WIREFRAMES&&(S.push(ba.cloneShallow()),T.push("polygon"===N.type?this.wireframeRingMaterial:this.wireframeLineMaterial),H.push(v.IDENTITY));const aa=this.markerMaterial;l.isSome(aa)&&(S.push(ba.cloneShallow()),T.push(aa),H.push(v.IDENTITY))}if(0===S.length)return null;J=new x.Object3D({geometries:S,materials:T,transformations:H,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:P}});S=new k.Graphics3DObject3DGraphicLayer(this,J,S,null,
null,g.sharedGeometryElevationAligner,I);S.alignedSampledElevation=W.sampledElevation;S.needsElevationUpdates=p.needsElevationUpdates2D(I.mode);return S};M._createGeometry=function(J,I,P,N,V){const S=this._fastUpdates.enabled&&this._fastUpdates.visualVariables.color;return f.createGeometry({overlayInfo:V===K.DRAPED?{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper}:null,removeDuplicateStartEnd:"polygon"===N?f.RemoveDuplicateStartEnd.REMOVE:f.RemoveDuplicateStartEnd.KEEP,
uniformSize:this._uniformSize,attributeData:{position:I,mapPosition:P,size:this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?null:this._getDrivenSize(J.renderingInfo),color:S?null:this._getDrivenColor(J.renderingInfo),sizeFeature:this._getSizeFeatureAttributeData(J.graphic),colorFeature:this._getColorFeatureAttributeData(J.graphic),opacityFeature:this._getOpacityFeatureAttributeData(J.graphic)}})};M._createAsOverlay=function(J,I){const P=J.graphic,N=this._getGeometryAsPolygonOrPolyline(P.geometry);
var V="polygon"===N.type?N.rings:N.paths;const S="polygon"===N.type?this.ringMaterial:this.lineMaterial;S.renderPriority=this._renderPriority;const T=A.LINE_WIREFRAMES?"polygon"===N.type?this.wireframeRingMaterial:this.wireframeLineMaterial:null,H=this.markerMaterial;l.isSome(T)&&(T.renderPriority=this._renderPriority-.001);l.isSome(H)&&(H.renderPriority=this._renderPriority-.002);const U=[],W=d.create(),Q=d.empty();var X=f.geometryToRenderInfoDraped(N,this._context.overlaySR);this._logGeometryCreationWarnings(X,
V,"polygon"===N.type?"rings":"paths","LineSymbol3DLayer");for(const ba of X.lines){d.empty(W);d.expandWithBuffer(W,ba.position);if(!d.intersectsClippingArea(W,this._context.clippingExtent))continue;d.expandWithAABB(Q,W);const aa=this._createGeometry(J,ba.position,null,N.type,K.DRAPED);V=ea=>{ea=new B.RenderGeometry(aa,ea,{layerUid:I,graphicUid:P.uid});U.push(ea);return ea};if(l.isSome(H)){X=V(H);const ea=l.unwrap(this.symbolLayer.marker).placement;"begin"!==ea&&"begin-end"!==ea||d.expandWithBuffer(W,
ba.position,0,1);"end"!==ea&&"begin-end"!==ea||d.expandWithBuffer(W,ba.position,ba.position.length-3,1);this._updateBoundingSphere(X,W)}X=V(S);this._updateBoundingSphere(X,W);A.LINE_WIREFRAMES&&(V=V(T),this._updateBoundingSphere(V,W))}return new q(this,U,Q,this._context.drapeSourceRenderer)};M._updateBoundingSphere=function(J,I){m.set(J.boundingSphere,.5*(I[0]+I[3]),.5*(I[1]+I[4]),0,.5*Math.sqrt((I[3]-I[0])*(I[3]-I[0])+(I[4]-I[1])*(I[4]-I[1])))};M._computeMaterialWidth=function(J){J=l.unwrapOr(J,
u.px2pt(1));return this._drivenProperties.size?this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size?u.pt2px(1):1:u.pt2px(J)};M._prepareMaterialPatch=function(J,I,P){var N=I.material;l.isNone(N)?P.changed&&P.useMaterialColor&&this._patchMaterialColor(this._getCombinedOpacityAndColor(this._materialColor),this._markerMaterial,J):"collection"!==N.type&&(N="complete"===N.type?l.applySome(N.newValue,V=>V.color):"complete"===N.diff.color.type?N.diff.color.newValue:null,N=this._getCombinedOpacityAndColor(N),
P.useMaterialColor&&this._patchMaterialColor(h.clone(N),this._markerMaterial,J),this._patternHidesLine&&(N[3]=0),this._patchMaterialColor(N,this._lineMaterial,J),delete I.material)};M._prepareMarkerPatch=function(J,I){var P=I.marker;if(l.isNone(P)||"partial"!==P.type||l.isSome(P.diff.style)||l.isSome(P.diff.placement)||l.isSome(P.diff.color)&&"complete"!==P.diff.color.type)return{changed:!1,useMaterialColor:l.isNone(this._markerColor)};P=P.diff.color;if(l.isNone(P))return delete I.marker,{changed:!1,
useMaterialColor:l.isNone(this._markerColor)};P=l.unwrap(P.newValue);if(l.isNone(P))return delete I.marker,{changed:!0,useMaterialColor:!0};this._patchMaterialColor(this._getCombinedOpacityAndColor(P),this._markerMaterial,J);delete I.marker;return{changed:!0,useMaterialColor:!1}};M._patchMaterialColor=function(J,I,P){l.isNone(I)||P.symbolLayerStatePatches.push(()=>I.setParameters({color:J}))};b._createClass(R,[{key:"_materialColor",get:function(){return l.applySome(this.symbolLayer.material,J=>J.color)}},
{key:"_markerColor",get:function(){return l.applySome(this.symbolLayer.marker,J=>J.color)}},{key:"lineMaterial",get:function(){l.isNone(this._lineMaterial)&&(this._lineMaterial=new E.RibbonLineMaterial(this._getMaterialParameters(!1)),this._context.stage.add(this._lineMaterial));return this._lineMaterial}},{key:"ringMaterial",get:function(){l.isNone(this._ringMaterial)&&(this._ringMaterial=new E.RibbonLineMaterial(this._getMaterialParameters(!0)),this._context.stage.add(this._ringMaterial));return this._ringMaterial}},
{key:"wireframeLineMaterial",get:function(){l.isNone(this._wireframeLineMaterial)&&(this._wireframeLineMaterial=new E.RibbonLineMaterial({...this._getMaterialParameters(!1),wireframe:!0}),this._context.stage.add(this._wireframeLineMaterial));return this._wireframeLineMaterial}},{key:"wireframeRingMaterial",get:function(){l.isNone(this._wireframeRingMaterial)&&(this._wireframeRingMaterial=new E.RibbonLineMaterial({...this._getMaterialParameters(!0),wireframe:!0}),this._context.stage.add(this._wireframeRingMaterial));
return this._wireframeRingMaterial}},{key:"markerMaterial",get:function(){l.isNone(this._markerMaterial)&&l.isSome(this.symbolLayer.marker)&&l.isSome(this._markerTexture)&&(this._markerMaterial=new C.LineMarkerMaterial({...this._getMaterialParameters(!1,!0),placement:this.symbolLayer.marker.placement,textureId:this._markerTexture.texture.id}),this._context.stage.add(this._markerMaterial));return this._markerMaterial}},{key:"_patternHidesLine",get:function(){const J=this.symbolLayer.pattern;return l.isSome(J)&&
"style"===J.type&&"none"===J.style}}]);return R}(r.Graphics3DSymbolLayer);c.elevationModeChangeTypes={definedChanged:p.SymbolUpdateType.RECREATE,staysOnTheGround:p.SymbolUpdateType.NONE,onTheGroundChanged:p.SymbolUpdateType.RECREATE};var K;(function(L){L[L.DRAPED=0]="DRAPED";L[L.ELEVATED=1]="ELEVATED"})(K||(K={}));a.Graphics3DLineSymbolLayer=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/lineUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../core/typedArrayUtil ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/triangulationUtils ../../../ViewingMode ./constants ./elevationAlignmentUtils ../../terrain/OverlayRenderer ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){function f(A,x,B){const C=[];for(const {index:D,count:E}of A){if(1>=E)continue;A=3*D;const F=A+3*E;C.push({position:x.subarray(A,F),mapPosition:B?B.subarray(A,F):void 0})}return C}a.RemoveDuplicateStartEnd=void 0;(function(A){A[A.KEEP=0]="KEEP";A[A.REMOVE=1]="REMOVE"})(a.RemoveDuplicateStartEnd||(a.RemoveDuplicateStartEnd={}));const w=v.create(),z=v.create();a.createGeometry=function(A){const x=[],B=[];{const {attributeData:{position:K},removeDuplicateStartEnd:L}=
A;var C=K.length;C=(C=K[0]===K[C-3]&&K[1]===K[C-2]&&K[2]===K[C-1])&&L===a.RemoveDuplicateStartEnd.REMOVE;var D=K.length/3-(C?1:0),E=new Uint32Array(2*(D-1)),F=C?n.slice(K,0,K.length-3):K,G=0;for(var O=0;O<D-1;O++)E[G++]=O,E[G++]=O+1;B.push([r.VertexAttribute.POSITION,{size:3,data:F,exclusive:C}]);x.push([r.VertexAttribute.POSITION,E])}D=B[0][1].data;C=new Uint16Array(x[0][1].length);E=A.attributeData.mapPosition;c.isNone(E)||(x.push([r.VertexAttribute.MAPPOS,x[0][1]]),B.push([r.VertexAttribute.MAPPOS,
{size:3,data:E}]));c.isSome(A.attributeData.colorFeature)||(B.push([r.VertexAttribute.COLOR,{size:4,data:c.unwrapOr(A.attributeData.color,g.WHITE_UNIT)}]),x.push([r.VertexAttribute.COLOR,C]));c.isSome(A.attributeData.sizeFeature)||(B.push([r.VertexAttribute.SIZE,{size:1,data:[c.unwrapOr(A.attributeData.size,1)]}]),x.push([r.VertexAttribute.SIZE,C]));E=A.attributeData.colorFeature;c.isNone(E)||(B.push([r.VertexAttribute.COLORFEATUREATTRIBUTE,{size:1,data:new Float32Array([E])}]),x.push([r.VertexAttribute.COLOR,
C]));E=A.attributeData.sizeFeature;c.isNone(E)||(B.push([r.VertexAttribute.SIZEFEATUREATTRIBUTE,{size:1,data:new Float32Array([E])}]),x.push([r.VertexAttribute.SIZEFEATUREATTRIBUTE,C]));E=A.attributeData.opacityFeature;c.isNone(E)||(B.push([r.VertexAttribute.OPACITYFEATUREATTRIBUTE,{size:1,data:new Float32Array([E])}]),x.push([r.VertexAttribute.OPACITYFEATUREATTRIBUTE,C]));if(!c.isNone(A.overlayInfo)&&A.overlayInfo.renderCoordsHelper.viewingMode===e.ViewingMode.Global&&A.overlayInfo.spatialReference.isGeographic){C=
new Float64Array(D.length);A=h.getReferenceEllipsoid(A.overlayInfo.spatialReference);for(E=0;E<C.length;E+=3)m.lonLatToWebMercatorComparable(D,E,C,E,A);A=D.length/3;D=new Float32Array(A+1);E=w;F=z;O=G=0;u.set(E,C[O++],C[O++],C[O++]);D[0]=0;for(let K=1;K<A+1;++K)K===A&&(O=0),u.set(F,C[O++],C[O++],C[O++]),G+=l.dist(E,F),D[K]=G,[E,F]=[F,E];B.push([r.VertexAttribute.DISTANCETOSTART,{size:1,data:D}]);x.push([r.VertexAttribute.DISTANCETOSTART,x[0][1]])}return new k.Geometry(B,x,q.PrimitiveType.Line)};a.geometryToRenderInfo=
function(A,x,B,C){const {position:D,outlines:E}=d.pathsToTriangulationInfo("polygon"===A.type?A.rings:A.paths,A.hasZ,"polygon"===A.type?d.CounterClockwiseMode.CCW_IS_HOLE:d.CounterClockwiseMode.NONE),F=new Float64Array(D.length);A=p.applyPerVertexElevationAlignment(D,A.spatialReference,0,F,0,D,0,D.length/3,x,B,C);x=null!=A;return{lines:x?f(E,D,F):[],projectionSuccess:x,sampledElevation:A}};a.geometryToRenderInfoDraped=function(A,x){const {position:B,outlines:C}=d.pathsToTriangulationInfo("polygon"===
A.type?A.rings:A.paths,!1,"polygon"===A.type?d.CounterClockwiseMode.CCW_IS_HOLE:d.CounterClockwiseMode.NONE);A=m.projectBuffer(B,A.spatialReference,0,B,x,0,B.length/3);for(x=2;x<B.length;x+=3)B[x]=t.DRAPED_Z;return{lines:A?f(C,B):[],projectionSuccess:A}};a.parseCapType=function(A){switch(A){case "butt":return y.CapType.BUTT;case "square":return y.CapType.SQUARE;case "round":return y.CapType.ROUND;default:return null}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/support/markerUtils":function(){define(["exports","../../../../core/maybe","../graphics/sdfPrimitives"],function(a,b,c){function n(u,v){return u.fromData(v,()=>c.createTexture(v,64,32,6.4))}function l(u){return"diamond"===u?"kite":u}a.MARKER_SYMBOL_SIZE=32;a.MARKER_TEXTURE_SIZE=64;a.MARKER_THICKNESS=6.4;a.parseLineMarkerStyle=l;a.prepareMarkerResources=function(u,v){return b.isSome(v)?n(u,l(v.style)):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/materials/LineMarkerMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/GLMaterials ../lib/GLTextureMaterial ../lib/Material ../lib/RenderSlot ../lib/VertexAttribute ./VisualVariablePassParameters ../shaders/LineMarkerTechnique ../shaders/LineMarkerTechniqueConfiguration ../shaders/RibbonLineTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){let k=function(A){function x(C){C=A.call(this,C,new y)||this;C._vertexAttributeLocations=p.markerVertexAttributeLocations;C.techniqueConfig=new t.LineMarkerTechniqueConfiguration;C.layout=C.createLayout();return C}b._inheritsLoose(x,A);var B=x.prototype;B.dispose=function(){};B.getConfiguration=function(C,D){this.techniqueConfig.output=C;this.techniqueConfig.draped=D.slot===d.RenderSlot.DRAPED_MATERIAL;this.techniqueConfig.hasCap=this.parameters.cap!==q.CapType.BUTT;
this.techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;this.techniqueConfig.hasOccludees=this.parameters.hasOccludees;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.vvColor=this.parameters.vvColorEnabled;this.techniqueConfig.vvOpacity=this.parameters.vvOpacityEnabled;this.techniqueConfig.vvSize=this.parameters.vvSizeEnabled;this.techniqueConfig.occluder=this.parameters.renderOccluded===h.RenderOccludedFlag.OccludeAndTransparentStencil;this.techniqueConfig.transparencyPassType=
D.transparencyPassType;this.techniqueConfig.hasMultipassTerrain=D.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=D.multipassTerrain.cullAboveGround;return this.techniqueConfig};B.intersect=function(){};B.createLayout=function(){const C=l.newLayout().vec3f(e.VertexAttribute.POSITION).vec2f(e.VertexAttribute.UV0).vec3f(e.VertexAttribute.AUXPOS1);this.parameters.vvSizeEnabled?C.f32(e.VertexAttribute.SIZEFEATUREATTRIBUTE):C.f32(e.VertexAttribute.SIZE);this.parameters.vvColorEnabled?C.f32(e.VertexAttribute.COLORFEATUREATTRIBUTE):
C.vec4f(e.VertexAttribute.COLOR);this.parameters.vvOpacityEnabled&&C.f32(e.VertexAttribute.OPACITYFEATUREATTRIBUTE);return C};B.createBufferWriter=function(){return new f(this.layout,this.parameters)};B.requiresSlot=function(C,D){if(C===d.RenderSlot.DRAPED_MATERIAL)return!0;if(this.parameters.renderOccluded===h.RenderOccludedFlag.OccludeAndTransparentStencil)return C===d.RenderSlot.OPAQUE_MATERIAL||C===d.RenderSlot.OCCLUDER_MATERIAL||C===d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL;D=v.outputFromPass(D);
return D===u.ShaderOutput.Color||D===u.ShaderOutput.Alpha?C===(this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL):C===d.RenderSlot.OPAQUE_MATERIAL};B.createGLMaterial=function(C){return C.output===u.ShaderOutput.Color||C.output===u.ShaderOutput.Alpha||C.output===u.ShaderOutput.Highlight||C.output===u.ShaderOutput.Depth?new r(C):null};return x}(h.Material),r=function(A){function x(){return A.apply(this,arguments)||this}b._inheritsLoose(x,
A);var B=x.prototype;B._updateParameters=function(C){this.updateTexture(this._material.parameters.textureId);this._material.setParameters(this.textureBindParameters);return this.ensureTechnique(p.LineMarkerTechnique,C)};B._updateOccludeeState=function(C){C.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:C.hasOccludees})};B.beginSlot=function(C){this._output!==u.ShaderOutput.Color&&this._output!==u.ShaderOutput.Alpha||this._updateOccludeeState(C);return this._updateParameters(C)};
return x}(m.GLTextureMaterial),y=function(A){function x(){var B=A.apply(this,arguments)||this;B.width=0;B.color=[1,1,1,1];B.placement="end";B.cap=q.CapType.BUTT;B.writeDepth=!0;B.hasSlicePlane=!1;B.vvFastUpdate=!1;B.hasOccludees=!1;return B}b._inheritsLoose(x,A);return x}(g.VisualVariablePassParameters),f=function(){function A(B,C){this.vertexBufferLayout=B;this.parameters=C}var x=A.prototype;x.allocate=function(B){return this.vertexBufferLayout.createBuffer(B)};x.elementCount=function(){return"begin-end"===
this.parameters.placement?12:6};x.write=function(B,C,D,E){const F=C.vertexAttributes.get(e.VertexAttribute.POSITION).data,G=F.length/3;let O=1,K=0;this.parameters.vvSizeEnabled?K=C.vertexAttributes.get(e.VertexAttribute.SIZEFEATUREATTRIBUTE).data[0]:C.vertexAttributes.has(e.VertexAttribute.SIZE)&&(O=C.vertexAttributes.get(e.VertexAttribute.SIZE).data[0]);let L=[1,1,1,1],R=0;this.parameters.vvColorEnabled?R=C.vertexAttributes.get(e.VertexAttribute.COLORFEATUREATTRIBUTE).data[0]:C.vertexAttributes.has(e.VertexAttribute.COLOR)&&
(L=C.vertexAttributes.get(e.VertexAttribute.COLOR).data);let M=0;this.parameters.vvOpacityEnabled&&(M=C.vertexAttributes.get(e.VertexAttribute.OPACITYFEATUREATTRIBUTE).data[0]);const J=B.transformation,I=new Float32Array(D.buffer);let P=this.vertexBufferLayout.stride/4*E;const N=(S,T,H,U)=>{I[P++]=S[0];I[P++]=S[1];I[P++]=S[2];I[P++]=H[0];I[P++]=H[1];I[P++]=T[0];I[P++]=T[1];I[P++]=T[2];this.parameters.vvSizeEnabled?I[P++]=K:I[P++]=O;this.parameters.vvColorEnabled?I[P++]=R:(S=Math.min(4*U,L.length-
4),I[P++]=L[S+0],I[P++]=L[S+1],I[P++]=L[S+2],I[P++]=L[S+3]);this.parameters.vvOpacityEnabled&&(I[P++]=M)};let V;(function(S){S[S.ASCENDING=1]="ASCENDING";S[S.DESCENDING=-1]="DESCENDING"})(V||(V={}));B=(S,T)=>{const H=c.set(w,F[3*S],F[3*S+1],F[3*S+2]),U=z;let W=S+T;do c.set(U,F[3*W],F[3*W+1],F[3*W+2]),W+=T;while(c.equals(H,U)&&0<=W&&W<G);J&&(c.transformMat4(H,H,J),c.transformMat4(U,U,J));N(H,U,[-1,-1],S);N(H,U,[1,-1],S);N(H,U,[1,1],S);N(H,U,[-1,-1],S);N(H,U,[1,1],S);N(H,U,[-1,1],S)};C=this.parameters.placement;
"begin"!==C&&"begin-end"!==C||B(0,V.ASCENDING);"end"!==C&&"begin-end"!==C||B(G-1,V.DESCENDING)};return A}();const w=n.create(),z=n.create();a.LineMarkerMaterial=k;a.Parameters=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/RenderSlot ../lib/StencilUtils ../lib/VertexAttribute ../../../../chunks/LineMarker.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){const q=new Map([[g.VertexAttribute.POSITION,0],[g.VertexAttribute.UV0,2],[g.VertexAttribute.AUXPOS1,3],[g.VertexAttribute.SIZE,6],[g.VertexAttribute.SIZEFEATUREATTRIBUTE,6],[g.VertexAttribute.COLOR,5],[g.VertexAttribute.COLORFEATUREATTRIBUTE,5],[g.VertexAttribute.OPACITYFEATUREATTRIBUTE,7]]);u=function(k){function r(){return k.apply(this,arguments)||this}c._inheritsLoose(r,k);var y=r.prototype;y.initializeProgram=function(f){const w=r.shader.get().build(this.configuration);
return new h.Program(f.rctx,w,q)};y._makePipelineState=function(f,w){const z=this.configuration,A=f===v.TransparencyPassType.NONE;return t.makePipelineState({blending:z.output===n.ShaderOutput.Color||z.output===n.ShaderOutput.Alpha?A?m.blendingDefault:m.oitBlending(f):null,depthTest:{func:m.oitDepthTest(f)},depthWrite:A?z.writeDepth&&t.defaultDepthWriteParams:m.oitDepthWrite(f),colorWrite:t.defaultColorWriteParams,stencilWrite:z.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:z.hasOccludees?w?
e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:{factor:0,units:-10}})};y.initializePipeline=function(){this.configuration.occluder&&(this._occluderPipelineTransparent=t.makePipelineState({blending:m.blendingDefault,depthTest:e.depthCompareAlways,depthWrite:null,colorWrite:t.defaultColorWriteParams,stencilWrite:null,stencilTest:e.stencilToolTransparentOccluderParams}),this._occluderPipelineOpaque=t.makePipelineState({blending:m.blendingDefault,depthTest:e.depthCompareAlways,
depthWrite:null,colorWrite:t.defaultColorWriteParams,stencilWrite:e.stencilWriteMaskOff,stencilTest:e.stencilToolMaskOccluderParams}),this._occluderPipelineMaskWrite=t.makePipelineState({blending:null,depthTest:e.depthCompareLess,depthWrite:null,colorWrite:null,stencilWrite:e.stencilWriteMaskOn,stencilTest:e.stencilToolMaskBaseParams}));this._occludeePipelineState=this._makePipelineState(this.configuration.transparencyPassType,!0);return this._makePipelineState(this.configuration.transparencyPassType,
!1)};y.getPipelineState=function(f,w){return w?this._occludeePipelineState:this.configuration.occluder?f===d.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL?this._occluderPipelineTransparent:f===d.RenderSlot.OCCLUDER_MATERIAL?this._occluderPipelineOpaque:this._occluderPipelineMaskWrite:k.prototype.getPipelineState.call(this,f,w)};return r}(u.ShaderTechnique);u.shader=new l.ReloadableShaderModule(p.LineMarker,()=>new Promise((k,r)=>a(["./LineMarker.glsl"],k,r)));b.LineMarkerTechnique=u;b.markerVertexAttributeLocations=
q;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/LineMarker.glsl":function(){define("exports ../views/3d/layers/support/markerUtils ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/RibbonVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){function z(x){const B=new r.ShaderBuilder,C=x.hasMultipassTerrain&&(x.output===c.ShaderOutput.Color||x.output===c.ShaderOutput.Alpha);B.include(l.RibbonVertexPosition,x);x.output===c.ShaderOutput.Depth&&B.include(u.OutputDepth,x);const {vertex:D,fragment:E}=B;E.include(d.RgbaFloatEncoding);e.addProjViewLocalOrigin(B,x);B.attributes.add(w.VertexAttribute.POSITION,"vec3");B.attributes.add(w.VertexAttribute.UV0,"vec2");B.attributes.add(w.VertexAttribute.AUXPOS1,
"vec3");B.varyings.add("vColor","vec4");B.varyings.add("vpos","vec3");B.varyings.add("vUV","vec2");B.varyings.add("vSize","float");B.varyings.add("linearDepth","float");C&&B.varyings.add("depth","float");D.code.add(q.glsl`#define PERPENDICULAR(v) vec2(v.y, -v.x)
float interp(float ncp, vec4 a, vec4 b) {
return (-ncp - a.z) / (b.z - a.z);
}`);D.uniforms.add([new g.Float2PassUniform("nearFar",(F,G)=>G.camera.nearFar),new p.Float4PassUniform("viewport",(F,G)=>G.camera.fullViewport)]);D.code.add(q.glsl`vec4 projectAndScale(vec4 pos) {
vec4 posNdc = proj * pos;
posNdc.xy *= viewport.zw / posNdc.w;
return posNdc;
}`);D.code.add(q.glsl`void clip(vec4 pos, inout vec4 prev) {
float vnp = nearFar[0] * 0.99;
if (prev.z > -nearFar[0]) {
prev = mix(pos, prev, interp(vnp, pos, prev));
}
}`);x.draped||(D.uniforms.add(new k.Matrix4PassUniform("inverseProjectionMatrix",(F,G)=>G.camera.inverseProjectionMatrix)),D.code.add(q.glsl`vec3 inverseProject(vec4 posScreen) {
posScreen.xy = (posScreen.xy / viewport.zw) * posScreen.w;
return (inverseProjectionMatrix * posScreen).xyz;
}`),D.code.add(q.glsl`bool rayIntersectPlane(vec3 rayDir, vec3 planeOrigin, vec3 planeNormal, out vec3 intersection) {
float cos = dot(rayDir, planeNormal);
float t = dot(planeOrigin, planeNormal) / cos;
intersection = t * rayDir;
return abs(cos) > 0.001 && t > 0.0;
}`),D.uniforms.add(new t.FloatPassUniform("perScreenPixelRatio",(F,G)=>G.camera.perScreenPixelRatio)),D.code.add(q.glsl`
      vec4 toFront(vec4 displacedPosScreen, vec3 posLeft, vec3 posRight, vec3 prev, float lineWidth) {
        // Project displaced position back to camera space
        vec3 displacedPos = inverseProject(displacedPosScreen);

        // Calculate the plane that we want the marker to lie in. Note that this will always be an approximation since ribbon lines are generally
        // not planar and we do not know the actual position of the displaced prev vertices (they are offset in screen space, too).
        vec3 planeNormal = normalize(cross(posLeft - posRight, posLeft - prev));
        vec3 planeOrigin = posLeft;

        ${x.hasCap?"\n                if(prev.z \x3e posLeft.z) {\n                  vec2 diff \x3d posLeft.xy - posRight.xy;\n                  planeOrigin.xy +\x3d PERPENDICULAR(diff) / 2.0;\n                }\n              ":""};

        // Move the plane towards the camera by a margin dependent on the line width (approximated in world space). This tolerance corrects for the
        // non-planarity in most cases, but sharp joins can place the prev vertices at arbitrary positions so markers can still clip.
        float offset = lineWidth * perScreenPixelRatio;
        planeOrigin *= (1.0 - offset);

        // Intersect camera ray with the plane and make sure it is within clip space
        vec3 rayDir = normalize(displacedPos);
        vec3 intersection;
        if (rayIntersectPlane(rayDir, planeOrigin, planeNormal, intersection) && intersection.z < -nearFar[0] && intersection.z > -nearFar[1]) {
          return vec4(intersection.xyz, 1.0);
        }

        // Fallback: use depth of pos or prev, whichever is closer to the camera
        float minDepth = planeOrigin.z > prev.z ? length(planeOrigin) : length(prev);
        displacedPos *= minDepth / length(displacedPos);
        return vec4(displacedPos.xyz, 1.0);
      }
  `));D.uniforms.add(new t.FloatPassUniform("pixelRatio",(F,G)=>G.camera.pixelRatio));D.code.add(q.glsl`
    void main(void) {
      float coverage = 1.0;

      // Check for special value of uv0.y which is used by the Renderer when graphics
      // are removed before the VBO is recompacted. If this is the case, then we just
      // project outside of clip space.
      if (uv0.y == 0.0) {
        // Project out of clip space
        gl_Position = vec4(1e038, 1e038, 1e038, 1.0);
      }
      else {
        float lineSize = getSize();
        float lineWidth = max(lineSize, 1.0) * pixelRatio;

        vec4 pos  = view * vec4(position.xyz, 1.0);
        vec4 prev = view * vec4(auxpos1.xyz, 1.0);
        clip(pos, prev);

        vec4 posScreen = projectAndScale(pos);
        vec4 prevScreen = projectAndScale(prev);

        vec2 segment = posScreen.xy - prevScreen.xy;

        // normalize vector along line segment
        float segmentLen = length(segment);
        segment = (segmentLen > 0.001) ? segment / segmentLen : vec2(0.0, 0.0);

        // displace according to position in the texture
        vec2 displacementDirU = PERPENDICULAR(segment);
        vec2 displacementDirV = segment;

        float displacementLen = ${q.glsl.float(b.MARKER_TEXTURE_SIZE/b.MARKER_THICKNESS)} * lineWidth;

        vec4 displacedPosScreen = posScreen;
        displacedPosScreen.xy += uv0.x * displacementDirU * displacementLen + uv0.y * displacementDirV * displacementLen;
  `);x.draped||D.code.add(q.glsl`vec3 posRight = inverseProject(posScreen + vec4(displacementDirU.xy, 0.0, 0.0) * lineWidth);
vec3 posLeft = pos.xyz + (pos.xyz - posRight);
pos = toFront(displacedPosScreen, posLeft, posRight, prev.xyz, lineWidth);
displacedPosScreen = projectAndScale(pos);`);D.code.add(q.glsl`
        ${C?"depth \x3d pos.z;":""}
        linearDepth = (-pos.z - nearFar[0]) / (nearFar[1] - nearFar[0]);

        // Convert back into NDC
        displacedPosScreen.xy = (displacedPosScreen.xy / viewport.zw) * displacedPosScreen.w;

        // Convert texture coordinate into [0,1] and cancel out perspective correct interpolation
        vUV = (uv0 + 1.0) / 2.0;
        vUV *= displacedPosScreen.w;

        vSize = displacementLen;

        vColor = getColor();
        vColor.a *= coverage;

        // Use camera space for slicing
        vpos = pos.xyz;

        gl_Position = displacedPosScreen;
      }
    }
  `);C&&B.include(v.multipassTerrainTest,x);B.include(n.SliceDraw,x);E.uniforms.add([new p.Float4PassUniform("intrinsicColor",F=>F.color),new y.Texture2DPassUniform("tex",F=>F.texture)]);E.include(h.ColorConversion);E.code.add(q.glsl`
  void main() {
    discardBySlice(vpos);
    ${C?"terrainDepthTest(gl_FragCoord, depth);":""}

    vec4 finalColor = intrinsicColor * vColor;

    // Offset texture coordinate s.t. we sample texel centers
    float texelSize = ${q.glsl.float(1/b.MARKER_TEXTURE_SIZE)};
    vec2 samplePos = vUV * gl_FragCoord.w + vec2(0.5, -0.5) * texelSize;

    // Evaluate sdf
    float sdf = rgba2float(texture2D(tex, samplePos)) - 0.5;
    float distance = sdf * vSize;

    // Grow by a halfpixel to make sure the line is fully covered by the cross marker
    // (otherwise there will be a halo if they are different colours)
    distance -= 0.5;

    finalColor.a *= clamp(0.5 - distance, 0.0, 1.0);

    if (finalColor.a < ${q.glsl.float(m.symbolAlphaCutoff)}) {
      discard;
    }

    ${x.output===c.ShaderOutput.Alpha?q.glsl`gl_FragColor = vec4(finalColor.a);`:""}
    ${x.output===c.ShaderOutput.Color?q.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${x.output===c.ShaderOutput.Color&&x.transparencyPassType===f.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
    ${x.output===c.ShaderOutput.Highlight?q.glsl`gl_FragColor = vec4(1.0);`:""}
    ${x.output===c.ShaderOutput.Depth?q.glsl`outputDepth(linearDepth);`:""}
  }
  `);return B}const A=Object.freeze(Object.defineProperty({__proto__:null,build:z},Symbol.toStringTag,{value:"Module"}));a.LineMarker=A;a.build=z})},"esri/views/3d/webgl-engine/shaders/LineMarkerTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,
b,c,n,l,u,v){v=function(m){function h(){var d=m.apply(this,arguments)||this;d.output=n.ShaderOutput.Color;d.transparencyPassType=u.TransparencyPassType.NONE;d.occluder=!1;d.hasSlicePlane=!1;d.writeDepth=!1;d.draped=!1;d.hasCap=!1;d.vvSize=!1;d.vvColor=!1;d.vvOpacity=!1;d.hasOccludees=!1;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;return d}b._inheritsLoose(h,m);return h}(v.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:n.ShaderOutput.COUNT})],v.prototype,"output",void 0);c.__decorate([l.parameter({count:u.TransparencyPassType.COUNT})],
v.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter()],v.prototype,"occluder",void 0);c.__decorate([l.parameter()],v.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],v.prototype,"writeDepth",void 0);c.__decorate([l.parameter()],v.prototype,"draped",void 0);c.__decorate([l.parameter()],v.prototype,"hasCap",void 0);c.__decorate([l.parameter()],v.prototype,"vvSize",void 0);c.__decorate([l.parameter()],v.prototype,"vvColor",void 0);c.__decorate([l.parameter()],v.prototype,
"vvOpacity",void 0);c.__decorate([l.parameter()],v.prototype,"hasOccludees",void 0);c.__decorate([l.parameter()],v.prototype,"hasMultipassTerrain",void 0);c.__decorate([l.parameter()],v.prototype,"cullAboveGround",void 0);c.__decorate([l.parameter({constValue:!0})],v.prototype,"hasVvInstancing",void 0);c.__decorate([l.parameter({constValue:!0})],v.prototype,"hasSliceTranslatedView",void 0);a.LineMarkerTechniqueConfiguration=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/materials/lineStippleUtils":function(){define(["exports","../../../../core/maybe"],function(a,b){function c(v,m=2){return b.isNone(v)?v:{pattern:v.slice(),pixelRatio:m}}function n(v){return b.isSome(v)?c(u[v],8):null}const l={dash:[4,3],dot:[1,3],"long-dash":[8,3],"short-dash":[4,1],"short-dot":[1,1]},u={dash:l.dash,"dash-dot":[...l.dash,...l.dot],dot:l.dot,"long-dash":l["long-dash"],"long-dash-dot":[...l["long-dash"],...l.dot],"long-dash-dot-dot":[...l["long-dash"],...l.dot,
...l.dot],none:null,"short-dash":l["short-dash"],"short-dash-dot":[...l["short-dash"],...l["short-dot"]],"short-dash-dot-dot":[...l["short-dash"],...l["short-dot"],...l["short-dot"]],"short-dot":l["short-dot"],solid:null};a.createStipplePattern=c;a.createStipplePatternSimple=function(v,m=2){return{pattern:[v,v],pixelRatio:m}};a.getStipplePatternForLinePattern=function(v){return b.isSome(v)&&"style"===v.type?n(v.style):null};a.getStipplePatternForPatternStyle=n;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DMeshFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/has ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/MeshComponent ../../../../geometry/support/MeshMaterialMetallicRoughness ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../geometry/support/meshUtils/projection ../../../../layers/graphics/dehydratedFeatures ../../../ViewingMode ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ../support/edgeUtils ../support/symbolColorUtils ../../support/debugFlags ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/geometryDataUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/NativeLineMaterial ../../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N){const V=["mesh"];n=function(ia){function ka(Z,ca,Y,da){Z=ia.call(this,Z,ca,Y,da)||this;Z._materials=new Map;Z._textures=new Map;Z.ensureDrapedStatus(!1);return Z}b._inheritsLoose(ka,ia);var la=ka.prototype;la.doLoad=function(){var Z=b._asyncToGenerator(function*(){G.DRAW_MESH_GEOMETRY_NORMALS&&(this._debugVertexNormalMaterial=new P.NativeLineMaterial({color:[1,0,1,1]}),this._debugFaceNormalMaterial=new P.NativeLineMaterial({color:[0,
1,1,1]}))});return function(){return Z.apply(this,arguments)}}();la.destroy=function(){ia.prototype.destroy.call(this);this._context.stage.removeMany(Array.from(this._materials.values(),Z=>Z.material));this._context.stage.removeMany(Array.from(this._textures.values()));this._materials.clear();this._textures.clear()};la.createGraphics3DGraphic=function(Z){const ca=Z.graphic;if(!this._validateGeometry(ca.geometry,V,"fill on mesh-3d"))return null;const Y=this.setGraphicElevationContext(ca,new B.ElevationContext);
return this._createAs3DShape(ca,Z.renderingInfo,Y,ca.uid)};la.layerOpacityChanged=function(Z,ca){const Y=this._getLayerOpacity();this._materials.forEach(da=>{da.material.setParameters({layerOpacity:Y});const ha=da.material.parameters;this._setMaterialTransparentParameter(ha,da);da.material.setParameters({transparent:ha.transparent})});Z.forEach(da=>{da=ca(da);l.isSome(da)&&da.layerOpacityChanged(Y,this._context.isAsync)});return!0};la.layerElevationInfoChanged=function(Z,ca){return this.updateGraphics3DGraphicElevationInfo(Z,
ca,x.needsElevationUpdates3D)};la.slicePlaneEnabledChanged=function(Z,ca){this._materials.forEach(Y=>{Y.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});Z.forEach(Y=>{Y=ca(Y);l.isSome(Y)&&Y.slicePlaneEnabledChanged(this._context.slicePlaneEnabled,this._context.isAsync)});return!0};la.physicalBasedRenderingChanged=function(){const Z=this._usePBR();this._materials.forEach(ca=>ca.material.setParameters({usePBR:Z}));return!0};la.pixelRatioChanged=function(){return!0};la._requiresSymbolVertexColors=
function(){return this._drivenProperties.color||this._drivenProperties.opacity};la._colorOrTextureUid=function(Z){return l.isNone(Z)?"-":Z instanceof c?Z.toHex():Z.contentHash};la._materialPropertiesDefault=function(Z,ca){const Y=this._requiresSymbolVertexColors(),da=!!Z.vertexAttributes.color;Z=!!Z.vertexAttributes.tangent;return{hasSymbolVertexColors:Y,hasVertexColors:da,hasVertexTangents:Z,uid:`vc:${da},vt:${Z},vct${ca},svc:${Y}`}};la._materialProperties=function(Z,ca,Y){Z=this._materialPropertiesDefault(Z,
Y);if(!ca.material)return Z;const {color:da,colorTexture:ha,normalTexture:ja,doubleSided:ma,alphaCutoff:pa,alphaMode:na}=ca.material;Y=this._colorOrTextureUid(da);var wa=this._colorOrTextureUid(ha),xa=this._colorOrTextureUid(ja);Z.color=da;Z.colorTexture=ha;Z.normalTexture=ja;Z.uid=`${Z.uid},cmuid:${Y},ctmuid:${wa},ntmuid:${xa},ds:${ma},ac:${pa},am:${na}`;if(ca.material instanceof k){const {metallic:sa,roughness:ya,metallicRoughnessTexture:ra,emissiveColor:ua,emissiveTexture:Ba,occlusionTexture:Ea}=
ca.material;ca=this._colorOrTextureUid(ra);Y=this._colorOrTextureUid(ua);wa=this._colorOrTextureUid(Ba);xa=this._colorOrTextureUid(Ea);Z.metallic=sa;Z.roughness=ya;Z.metallicRoughnessTexture=ra;Z.emissiveColor=ua;Z.emissiveTexture=Ba;Z.occlusionTexture=Ea;Z.uid=`${Z.uid},mrm:${sa},mrr:${ya},mrt:${ca},emuid:${Y},etmuid:${wa},otmuid:${xa}`}return Z};la._setInternalColorValueParameters=function(Z,ca){ca.diffuse=c.toUnitRGB(Z);ca.opacity=Z.a};la._getLoadableTextureResource=function(Z){return Z.data?Z.data:
Z.url};la._getInternalTextureId=function(Z){Z=this._getInternalTexture(Z,O.AlphaDiscardMode.Opaque);return l.isSome(Z)?Z.id:null};la._getInternalTexture=function(Z,ca){const Y=this._getLoadableTextureResource(Z);if(!Y)return null;const da=`${Z.contentHash}/${ca}`;let ha=this._textures.get(da);ha||(ha=new M.Texture(Y,{mipmap:!0,wrap:this._castTextureWrap(Z.wrap),noUnpackFlip:!0,preMultiplyAlpha:ca!==O.AlphaDiscardMode.Opaque}),this._textures.set(da,ha),this._context.stage.add(ha),this._context.stage.loadImmediate(ha));
return ha};la._castTextureWrap=function(Z="repeat"){return"string"===typeof Z?(Z=this._castTextureWrapIndividual(Z),{s:Z,t:Z}):{s:this._castTextureWrapIndividual(Z.horizontal),t:this._castTextureWrapIndividual(Z.vertical)}};la._castTextureWrapIndividual=function(Z){switch(Z){case "clamp":return N.TextureWrapMode.CLAMP_TO_EDGE;case "mirror":return N.TextureWrapMode.MIRRORED_REPEAT;default:return N.TextureWrapMode.REPEAT}};la._setInternalMaterialParameters=function(Z,ca){l.isSome(Z.color)&&this._setInternalColorValueParameters(Z.color,
ca);if(l.isSome(Z.colorTexture)){const Y=this._getInternalTexture(Z.colorTexture,ca.textureAlphaMode);l.isSome(Y)?(ca.textureId=Y.id,ca.textureAlphaPremultiplied=!!Y.params.preMultiplyAlpha):ca.textureId=void 0}l.isSome(Z.normalTexture)&&(ca.normalTextureId=this._getInternalTextureId(Z.normalTexture));l.isSome(Z.emissiveColor)&&(ca.emissiveFactor=c.toUnitRGB(Z.emissiveColor));l.isSome(Z.emissiveTexture)&&(ca.emissiveTextureId=this._getInternalTextureId(Z.emissiveTexture));l.isSome(Z.occlusionTexture)&&
(ca.occlusionTextureId=this._getInternalTextureId(Z.occlusionTexture));l.isSome(Z.metallicRoughnessTexture)&&(ca.metallicRoughnessTextureId=this._getInternalTextureId(Z.metallicRoughnessTexture))};la._setExternalMaterialParameters=function(Z){var ca=this._drivenProperties.color;let Y=l.isSome(this.symbolLayer.material)?this.symbolLayer.material.colorMixMode:null;ca?Z.externalColor=g.ONES:(ca=l.isSome(this.symbolLayer.material)?this.symbolLayer.material.color:null,l.isSome(ca)?Z.externalColor=c.toUnitRGBA(ca):
(Y=null,Z.externalColor=g.ONES));Y&&(Z.colorMixMode=Y);Z.castShadows=!!this.symbolLayer.castShadows};la._hasTransparentVertexColors=function(Z){Z=Z.vertexAttributes.color;if(l.isNone(Z))return!1;for(let ca=3;ca<Z.length;ca+=4)if(255!==Z[ca])return!0;return!1};la._getOrCreateMaterial=function(Z,ca){var Y,da,ha,ja=null==(Y=ca.material)?void 0:Y.color;Y=null==(da=ca.material)?void 0:da.colorTexture;da=null==(ha=ca.material)?void 0:ha.alphaMode;ha="blend"===da;ja="opaque"!==da&&(this._hasTransparentVertexColors(Z)||
l.isSome(ja)&&1>ja.a||l.isSome(Y)&&Y.transparent||ha);Z=this._materialProperties(Z,ca,ja);if(ha=this._materials.get(Z.uid))return ha.material;ja={material:null,isComponentTransparent:ja,alphaMode:ca.material?ca.material.alphaMode:"opaque"};ha=null==Z.metallicRoughnessTexture&&null==Z.metallic&&null==Z.roughness;Y={usePBR:this._usePBR(),isSchematic:ha,hasVertexColors:Z.hasVertexColors,hasSymbolColors:Z.hasSymbolVertexColors,hasVertexTangents:Z.hasVertexTangents,ambient:e.ZEROS,diffuse:e.ONES,opacity:1,
doubleSided:!0,doubleSidedType:"winding-order",cullFace:O.CullFaceOptions.None,layerOpacity:this._getLayerOpacity(),hasSlicePlane:this._context.slicePlaneEnabled,initTextureTransparent:!0};ha||(Y.mrrFactors=[null!=Z.metallic?Z.metallic:1,null!=Z.roughness?Z.roughness:1,.5]);ca.material&&(Y.doubleSided=ca.material.doubleSided,Y.cullFace=ca.material.doubleSided?O.CullFaceOptions.None:O.CullFaceOptions.Back,Y.textureAlphaCutoff=ca.material.alphaCutoff);this._setExternalMaterialParameters(Y);this._setMaterialTransparentParameter(Y,
ja);this._setInternalMaterialParameters(Z,Y);ca=new I.DefaultMaterial(Y);ja.material=ca;this._materials.set(Z.uid,ja);this._context.stage.add(ca);return ca};la._usePBR=function(){return this._context.physicalBasedRenderingEnabled};la._setMaterialTransparentParameter=function(Z,ca){Z.transparent=this.needsDrivenTransparentPass||ca.isComponentTransparent||1>Z.layerOpacity||1>Z.opacity||Z.externalColor&&1>Z.externalColor[3];Z.textureAlphaMode="auto"===ca.alphaMode?Z.transparent?O.AlphaDiscardMode.MaskBlend:
O.AlphaDiscardMode.Opaque:"opaque"===ca.alphaMode?O.AlphaDiscardMode.Opaque:"mask"===ca.alphaMode?O.AlphaDiscardMode.Mask:O.AlphaDiscardMode.Blend};la._addDebugNormals=function(Z,ca,Y,da){var ha=ca.length,ja=Z.spatialReference.isGeographic?20015077/180:1;const ma=.1*Math.max(Z.extent.width*ja,Z.extent.height*ja,Z.extent.zmax-Z.extent.zmin),pa=[],na=[];Z=[];ja=[];for(let ua=0;ua<ha;ua++){var wa=ca[ua],xa=wa.vertexAttributes.get(J.VertexAttribute.POSITION),sa=wa.vertexAttributes.get(J.VertexAttribute.NORMAL);
const Ba=wa.indices.get(J.VertexAttribute.POSITION);wa=wa.indices.get(J.VertexAttribute.NORMAL);xa=xa.data;sa=sa.data;for(let Ea=0;Ea<Ba.length;Ea++){var ya=3*Ba[Ea];const Ja=3*wa[Ea];for(var ra=0;3>ra;ra++)pa.push(xa[ya+ra]);for(ra=0;3>ra;ra++)pa.push(xa[ya+ra]+sa[Ja+ra]*ma);na.push(na.length);na.push(na.length);if(0===Ea%3){this._calculateFaceNormal(xa,Ba,Ea,W);this._getFaceVertices(xa,Ba,Ea,T,H,U);d.add(T,T,H);d.add(T,T,U);d.scale(T,T,1/3);for(ya=0;3>ya;ya++)Z.push(T[ya]);for(ya=0;3>ya;ya++)Z.push(T[ya]+
W[ya]*ma);ja.push(ja.length);ja.push(ja.length)}}}ha=new K.Geometry([[J.VertexAttribute.POSITION,{data:pa,size:3,exclusive:!0}]],[[J.VertexAttribute.POSITION,new Uint32Array(na)]],O.PrimitiveType.Line);ca.push(ha);Y.push(this._debugVertexNormalMaterial);da.push(h.clone(da[0]));ha=new K.Geometry([[J.VertexAttribute.POSITION,{data:Z,size:3,exclusive:!0}]],[[J.VertexAttribute.POSITION,new Uint32Array(ja)]],O.PrimitiveType.Line);ca.push(ha);Y.push(this._debugFaceNormalMaterial);da.push(h.clone(da[0]))};
la._createAs3DShape=function(Z,ca,Y,da){Z=Z.geometry;if("mesh"!==Z.type)return null;ca=this._createGeometryInfo(Z,ca);if(!ca)return null;const {geometries:ha,materials:ja,transformations:ma,objectTransformation:pa}=ca;G.DRAW_MESH_GEOMETRY_NORMALS&&this._addDebugNormals(Z,ha,ja,ma);da=new R.Object3D({geometries:ha,materials:ja,transformations:ma,metadata:{layerUid:this._context.layer.uid,graphicUid:da}});da.transformation=pa;ca=this._createEdgeMaterial();ca=l.isSome(ca)?{baseMaterial:ja[0],edgeMaterials:[ca],
properties:{mergeGeometries:!0,hasSlicePlane:this._context.slicePlaneEnabled}}:null;ca=new C.Graphics3DObject3DGraphicLayer(this,da,ha,null,null,A.perObjectElevationAligner,Y,ca);ca.needsElevationUpdates=x.needsElevationUpdates3D(Y.mode);ca.useObjectOriginAsAttachmentOrigin=!0;ca.elevationContext.centerPointInElevationSR=this._getCenterPointInElevationSR(da);ca.alignedSampledElevation=A.perObjectElevationAligner(ca,ca.elevationContext,this._context.elevationProvider,this._context.renderCoordsHelper);
return ca};la._getCenterPointInElevationSR=function(Z){const ca=w.makeDehydratedPoint(0,0,0,this._context.elevationProvider.spatialReference);p.projectVectorToDehydratedPoint([Z.transformation[12],Z.transformation[13],Z.transformation[14]],this._context.renderCoordsHelper.spatialReference,ca);return ca};la._createComponentNormals=function(Z,ca,Y,da){switch(Y.shading||"flat"){case "source":return this._createComponentNormalsSource(Z,ca,Y,da);case "flat":return this._createComponentNormalsFlat(Z,da);
case "smooth":return this._createComponentNormalsSmooth(Z,da)}};la._createComponentNormalsSource=function(Z,ca,Y,da){if(l.isNone(ca))return this._createComponentNormalsFlat(Z,da);let ha=!1;if(!Y.trustSourceNormals)for(Y=0;Y<da.length;Y+=3){this._calculateFaceNormal(Z,da,Y,W);for(let ja=0;3>ja;ja++){const ma=3*da[Y+ja];T[0]=ca[ma+0];T[1]=ca[ma+1];T[2]=ca[ma+2];0>d.dot(W,T)&&(ca[ma+0]=-ca[ma+0],ca[ma+1]=-ca[ma+1],ca[ma+2]=-ca[ma+2],ha=!0)}}return{normals:ca,indices:da,didFlipNormals:ha}};la._createComponentNormalsFlat=
function(Z,ca){const Y=new Float32Array(ca.length),da=new Uint32Array(3*ca.length);for(let ha=0;ha<ca.length;ha+=3){const ja=this._calculateFaceNormal(Z,ca,ha,W);for(let ma=0;3>ma;ma++)Y[ha+ma]=ja[ma],da[ha+ma]=ha/3}return{normals:Y,indices:da,didFlipNormals:!1}};la._createComponentNormalsSmooth=function(Z,ca){const Y={};for(var da=0;da<ca.length;da+=3){var ha=this._calculateFaceNormal(Z,ca,da,W);for(var ja=0;3>ja;ja++){var ma=ca[da+ja];let pa=Y[ma];pa||(pa={normal:e.create(),count:0},Y[ma]=pa);d.add(pa.normal,
pa.normal,ha);pa.count++}}Z=new Float32Array(3*ca.length);da=new Uint32Array(3*ca.length);for(ha=0;ha<ca.length;ha++){ja=Y[ca[ha]];1!==ja.count&&(d.normalize(ja.normal,ja.normal),ja.count=1);for(ma=0;3>ma;ma++)Z[3*ha+ma]=ja.normal[ma];da[ha]=ha}return{normals:Z,indices:da,didFlipNormals:!1}};la._getFaceVertices=function(Z,ca,Y,da,ha,ja){const ma=3*ca[Y+0],pa=3*ca[Y+1];ca=3*ca[Y+2];da[0]=Z[ma+0];da[1]=Z[ma+1];da[2]=Z[ma+2];ha[0]=Z[pa+0];ha[1]=Z[pa+1];ha[2]=Z[pa+2];ja[0]=Z[ca+0];ja[1]=Z[ca+1];ja[2]=
Z[ca+2]};la._calculateFaceNormal=function(Z,ca,Y,da){this._getFaceVertices(Z,ca,Y,T,H,U);d.subtract(H,H,T);d.subtract(U,U,T);d.cross(T,H,U);d.normalize(da,T);return da};la._getOrCreateComponents=function(Z){return l.unwrapOr(Z.components,aa)};la._createPositionBuffer=function(Z,ca){let Y=Z.vertexAttributes.position;const da=ca.reprojection===ea.ECEF?ca.transformBeforeProject:null;l.isSome(da)&&(Y=f.transformPosition(Y,new Float64Array(Y.length),da));if(ca.reprojection===ea.NONE)return ca.needsBufferCopy?
new Float64Array(Y):Y;ca=l.isSome(da)?Y:new Float64Array(Y.length);p.projectBuffer(Y,Z.spatialReference,0,ca,this._context.renderCoordsHelper.spatialReference,0,Y.length/3);return ca};la._createNormalBuffer=function(Z,ca,Y){let da=Z.vertexAttributes.normal;if(l.isNone(da))return null;var ha=Y.reprojection===ea.ECEF?Y.transformBeforeProject:null;l.isSome(ha)&&(da=f.transformNormal(da,new Float32Array(da.length),ha));if("local"===this._context.graphicsCoreOwner.view.viewingMode||Y.reprojection===ea.NONE)return Y.needsBufferCopy&&
Z.vertexAttributes.normal===da?new Float32Array(da):da;Y=Z.vertexAttributes.position;ha=l.isSome(ha)?da:new Float32Array(da.length);return f.projectNormalToPCPF(da,Y,ca,Z.spatialReference,ha)};la._createTangentBuffer=function(Z,ca,Y){let da=Z.vertexAttributes.tangent;if(l.isNone(da))return null;var ha=Y.reprojection===ea.ECEF?Y.transformBeforeProject:null;l.isSome(ha)&&(da=f.transformTangent(da,new Float32Array(da.length),ha));if("local"===this._context.graphicsCoreOwner.view.viewingMode||Y.reprojection===
ea.NONE)return Y.needsBufferCopy&&Z.vertexAttributes.normal===da?new Float32Array(da):da;Y=Z.vertexAttributes.position;ha=l.isSome(ha)?da:new Float32Array(da.length);return f.projectTangentToPCPF(da,Y,ca,Z.spatialReference,ha)};la._createColorBuffer=function(Z){return Z.vertexAttributes.color};la._createSymbolColorBuffer=function(Z){if(this._requiresSymbolVertexColors()){Z=this._getVertexOpacityAndColor(Z);const ca=F.parseColorMixMode(l.get(this.symbolLayer,"material","colorMixMode")),Y=new Uint8Array(4);
F.encodeSymbolColor(Z,ca,Y);return Y}return null};la._createBuffers=function(Z,ca){var Y=Z.vertexAttributes&&Z.vertexAttributes.position;if(!Y)return this.logger.warn("Mesh geometry must contain position vertex attributes"),null;var da=Z.vertexAttributes.normal;const ha=Z.vertexAttributes.uv;var ja=Z.vertexAttributes.tangent;if(l.isSome(da)&&da.length!==Y.length)return this.logger.warn("Mesh normal vertex buffer must contain the same number of elements as the position buffer"),null;if(l.isSome(ja)&&
ja.length/4!==Y.length/3)return this.logger.warn("Mesh tangent vertex buffer must contain the same number of elements as the position buffer"),null;if(l.isSome(ha)&&ha.length/2!==Y.length/3)return this.logger.warn("Mesh uv vertex buffer must contain the same number of elements as the position buffer"),null;ja=this._computeReprojectionInfo(Z);Y=this._createPositionBuffer(Z,ja);da=this._createColorBuffer(Z);ca=this._createSymbolColorBuffer(ca);const ma=this._createNormalBuffer(Z,Y,ja),pa=this._createTangentBuffer(Z,
Y,ja);Z=ja.reprojection===ea.NONE&&l.isSome(ja.objectTransformation)?ja.objectTransformation:this._transformOriginLocal(Z,Y,ma,pa);ja=ja.reprojection===ea.NONE&&l.isSome(ja.geometryTransformation)?ja.geometryTransformation:h.create();return{positionBuffer:Y,normalBuffer:ma,tangentBuffer:pa,uvBuffer:ha,colorBuffer:da,symbolColorBuffer:ca,objectTransformation:Z,geometryTransformation:ja}};la._computeReprojectionInfo=function(Z){var ca=l.isSome(Z.transform);const Y=ca&&Z.transform.geographic?ea.NONE:
this._context.renderCoordsHelper.viewingMode===z.ViewingMode.Local?ea.NONE:ea.ECEF;if(ca){if(Y===ea.NONE)return ca=h.create(),p.computeTranslationToOriginAndRotation(Z.spatialReference,Z.transform.origin,ca,this._context.renderCoordsHelper.spatialReference),Z=h.clone(Z.transform.localMatrix),{reprojection:Y,objectTransformation:ca,geometryTransformation:Z,needsBufferCopy:!1};ca=m.fromTranslation(h.create(),Z.transform.origin);m.multiply(ca,ca,Z.transform.localMatrix);return{reprojection:Y,transformBeforeProject:ca,
needsBufferCopy:!0}}return{reprojection:Y,needsBufferCopy:!0}};la._transformOriginLocal=function(Z,ca,Y,da){const ha=this._context.renderCoordsHelper.spatialReference;var ja=Z.anchor;S[0]=ja.x;S[1]=ja.y;S[2]=ja.z;ja=h.create();p.computeTranslationToOriginAndRotation(Z.spatialReference,S,ja,ha);Z=r.BufferViewVec3f64.fromTypedArray(ca);m.invert(Q,ja);y.transformMat4(Z,Z,Q);if(l.isSome(Y)||l.isSome(da))u.fromMat4(X,ja),u.transpose(X,X),l.isSome(Y)&&(Y=r.BufferViewVec3f.fromTypedArray(Y),y.transformMat3(Y,
Y,X)),l.isSome(da)&&(da=r.BufferViewVec3f.fromTypedArray(da,4*da.BYTES_PER_ELEMENT),y.transformMat3(da,da,X));return ja};la._validateFaces=function(Z,ca){Z=Z.vertexAttributes.position.length/3;if(ca=ca.faces){let Y=-1;for(let da=0;da<ca.length;da++){const ha=ca[da];ha>Y&&(Y=ha)}if(Z<=Y)return this.logger.warn(`Vertex index ${Y} is out of bounds of the mesh position buffer`),!1}else if(0!==Z%3)return this.logger.warn("Mesh position buffer length must be a multiple of 9 if no component faces are defined (3 values per vertex * 3 vertices per triangle)"),
!1;return!0};la._getOrCreateFaces=function(Z,ca){return ca.faces?ca.faces:L.generateDefaultIndexArray(Z.vertexAttributes.position.length/3)};la._isOutsideClippingArea=function(Z){if(!this._context.clippingExtent)return!1;var ca=Z.vertexAttributes&&Z.vertexAttributes.position;if(!ca)return!1;const Y=this._context.elevationProvider.spatialReference,da=ca.length/3;Z.spatialReference.equals(Y)||(ca=new Float64Array(ca.length),p.projectBuffer(Z.vertexAttributes.position,Z.spatialReference,0,ca,Y,0,da));
t.empty(ba);t.expandWithBuffer(ba,ca,0,da);return!t.intersectsClippingArea(ba,this._context.clippingExtent)};la._createGeometryInfo=function(Z,ca){if(!p.canProjectWithoutEngine(Z.spatialReference,this._context.graphicsCoreOwner.view.spatialReference))return this.logger.warn("Geometry spatial reference is not compatible with the view"),null;if(this._isOutsideClippingArea(Z))return null;ca=this._createBuffers(Z,ca);if(l.isNone(ca))return null;const {positionBuffer:Y,uvBuffer:da,colorBuffer:ha,symbolColorBuffer:ja,
normalBuffer:ma,tangentBuffer:pa,objectTransformation:na,geometryTransformation:wa}=ca;var xa=this._getOrCreateComponents(Z);ca=[];const sa=[],ya=[];let ra=!1;for(const Ba of xa){if(!this._validateFaces(Z,Ba))return null;xa=this._getOrCreateFaces(Z,Ba);if(0===xa.length)continue;var ua=this._createComponentNormals(Y,ma,Ba,xa);ua.didFlipNormals&&(ra=!0);const Ea=[[J.VertexAttribute.POSITION,{size:3,data:Y,exclusive:!0}],[J.VertexAttribute.NORMAL,{size:3,data:ua.normals,exclusive:!0}]];ua=[[J.VertexAttribute.POSITION,
xa],[J.VertexAttribute.NORMAL,ua.indices]];l.isSome(ha)&&(Ea.push([J.VertexAttribute.COLOR,{size:4,data:ha,exclusive:!0}]),ua.push([J.VertexAttribute.COLOR,xa]));l.isSome(ja)&&(Ea.push([J.VertexAttribute.SYMBOLCOLOR,{size:4,data:ja,exclusive:!0}]),ua.push([J.VertexAttribute.SYMBOLCOLOR,new Uint16Array(xa.length)]));l.isSome(da)&&(Ea.push([J.VertexAttribute.UV0,{size:2,data:da,exclusive:!0}]),ua.push([J.VertexAttribute.UV0,xa]));l.isSome(pa)&&(Ea.push([J.VertexAttribute.TANGENT,{size:4,data:pa,exclusive:!0}]),
ua.push([J.VertexAttribute.TANGENT,xa]));xa=new K.Geometry(Ea,ua);ca.push(xa);sa.push(wa);ya.push(this._getOrCreateMaterial(Z,Ba))}ra&&this.logger.warn("Normals have been automatically flipped to be consistent with the counter clock wise face winding order. It is better to generate mesh geometries that have consistent normals.");return{geometries:ca,transformations:sa,materials:ya,objectTransformation:na}};la._createEdgeMaterial=function(){const Z={opacity:this._getLayerOpacity()};return E.createMaterial(this.symbolLayer,
Z)};return ka}(D.Graphics3DSymbolLayer);const S=e.create(),T=e.create(),H=e.create(),U=e.create(),W=e.create(),Q=h.create(),X=v.create(),ba=t.create(),aa=[new q];var ea;(function(ia){ia[ia.NONE=0]="NONE";ia[ia.ECEF=1]="ECEF"})(ea||(ea={}));a.Graphics3DMeshFillSymbolLayer=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/MeshComponent":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/ensureType ./MeshMaterial ./MeshMaterialMetallicRoughness ./MeshVertexAttributes".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){var p;const t=l.getLogger("esri.geometry.support.MeshComponent");c=p=function(q){function k(y){y=q.call(this,y)||this;y.faces=null;y.material=null;y.shading="source";y.trustSourceNormals=!1;return y}a._inheritsLoose(k,q);k.from=function(y){return h.ensureClass(p,y)};var r=k.prototype;r.castFaces=function(y){return g.castArray(y,Uint32Array,[Uint16Array],{loggerTag:".faces\x3d",stride:3},t)};r.castMaterial=function(y){return y&&"object"===typeof y&&("metallic"in y||
"roughness"in y||"metallicRoughnessTexture"in y)?h.ensureClass(e,y):h.ensureClass(d,y)};r.clone=function(){return new p({faces:n.clone(this.faces),shading:this.shading,material:n.clone(this.material),trustSourceNormals:this.trustSourceNormals})};r.cloneWithDeduplication=function(y,f){y={faces:n.clone(this.faces),shading:this.shading,material:this.material?this.material.cloneWithDeduplication(y,f):null,trustSourceNormals:this.trustSourceNormals};return new p(y)};return k}(c.JSONSupport);b.__decorate([u.property({json:{write:!0}})],
c.prototype,"faces",void 0);b.__decorate([v.cast("faces")],c.prototype,"castFaces",null);b.__decorate([u.property({type:d,json:{write:!0}})],c.prototype,"material",void 0);b.__decorate([v.cast("material")],c.prototype,"castMaterial",null);b.__decorate([u.property({type:String,json:{write:!0}})],c.prototype,"shading",void 0);b.__decorate([u.property({type:Boolean})],c.prototype,"trustSourceNormals",void 0);return c=p=b.__decorate([m.subclass("esri.geometry.support.MeshComponent")],c)})},"esri/geometry/support/MeshMaterial":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/JSONSupport ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshTexture".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){var g;n=g=function(p){function t(k){k=p.call(this,k)||this;k.color=null;k.colorTexture=null;k.normalTexture=null;k.alphaMode="auto";k.alphaCutoff=.5;k.doubleSided=!0;return k}a._inheritsLoose(t,p);var q=t.prototype;q.clone=function(){return this.cloneWithDeduplication(null,new Map)};q.cloneWithDeduplication=function(k,r){const y=l.isSome(k)?k.get(this):null;if(y)return y;r=new g(this.clonePropertiesWithDeduplication(r));l.isSome(k)&&k.set(this,r);return r};q.clonePropertiesWithDeduplication=
function(k){return{color:l.isSome(this.color)?this.color.clone():null,colorTexture:l.isSome(this.colorTexture)?this.colorTexture.cloneWithDeduplication(k):null,normalTexture:l.isSome(this.normalTexture)?this.normalTexture.cloneWithDeduplication(k):null,alphaMode:this.alphaMode,alphaCutoff:this.alphaCutoff,doubleSided:this.doubleSided}};return t}(n.JSONSupport);b.__decorate([u.property({type:c,json:{write:!0}})],n.prototype,"color",void 0);b.__decorate([u.property({type:e,json:{write:!0}})],n.prototype,
"colorTexture",void 0);b.__decorate([u.property({type:e,json:{write:!0}})],n.prototype,"normalTexture",void 0);b.__decorate([u.property({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaMode",void 0);b.__decorate([u.property({nonNullable:!0,json:{write:!0}})],n.prototype,"alphaCutoff",void 0);b.__decorate([u.property({nonNullable:!0,json:{write:!0}})],n.prototype,"doubleSided",void 0);return n=g=b.__decorate([d.subclass("esri.geometry.support.MeshMaterial")],n)})},"esri/geometry/support/MeshTexture":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/reader ../../core/accessorSupport/decorators/subclass ../../core/accessorSupport/decorators/writer ../../chunks/persistableUrlUtils ../../views/support/screenshotUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){var p;const t=new WeakMap;let q=0;c=p=function(k){function r(f){f=k.call(this,f)||this;f.wrap="repeat";return f}a._inheritsLoose(r,k);var y=r.prototype;y.writeData=function(f,w,z,A){f instanceof HTMLImageElement?(f={type:"image-element",src:e.toJSON(f.src,A),crossOrigin:f.crossOrigin},w[z]=f):f instanceof HTMLCanvasElement?(f=f.getContext("2d").getImageData(0,0,f.width,f.height),f={type:"canvas-element",imageData:this._encodeImageData(f)},w[z]=f):f instanceof HTMLVideoElement?
(f={type:"video-element",src:e.toJSON(f.src,A),autoplay:f.autoplay,loop:f.loop,muted:f.muted,crossOrigin:f.crossOrigin,preload:f.preload},w[z]=f):(f={type:"image-data",imageData:this._encodeImageData(f)},w[z]=f)};y.readData=function(f){switch(f.type){case "image-element":var w=new Image;w.src=f.src;w.crossOrigin=f.crossOrigin;return w;case "canvas-element":return f=this._decodeImageData(f.imageData),w=document.createElement("canvas"),w.width=f.width,w.height=f.height,w.getContext("2d").putImageData(f,
0,0),w;case "image-data":return this._decodeImageData(f.imageData);case "video-element":return w=document.createElement("video"),w.src=f.src,w.crossOrigin=f.crossOrigin,w.autoplay=f.autoplay,w.loop=f.loop,w.muted=f.muted,w.preload=f.preload,w}};y.clone=function(){const f={url:this.url,data:this.data,wrap:this._cloneWrap()};return new p(f)};y.cloneWithDeduplication=function(f){var w=f.get(this);if(w)return w;w=this.clone();f.set(this,w);return w};y._cloneWrap=function(){return"string"===typeof this.wrap?
this.wrap:{horizontal:this.wrap.horizontal,vertical:this.wrap.vertical}};y._encodeImageData=function(f){let w="";for(let z=0;z<f.data.length;z++)w+=String.fromCharCode(f.data[z]);return{data:btoa(w),width:f.width,height:f.height}};y._decodeImageData=function(f){const w=atob(f.data),z=new Uint8ClampedArray(w.length);for(let A=0;A<w.length;A++)z[A]=w.charCodeAt(A);return g.wrapImageData(z,f.width,f.height)};y._imageDataContainsTransparent=function(f){for(let w=3;w<f.data.length;w+=4)if(255!==f.data[w])return!0;
return!1};r.from=function(f){return"string"===typeof f?new p({url:f}):f instanceof HTMLImageElement||f instanceof HTMLCanvasElement||f instanceof ImageData||f instanceof HTMLVideoElement?new p({data:f}):v.ensureClass(p,f)};a._createClass(r,[{key:"url",get:function(){return this._get("url")||null},set:function(f){this._set("url",f);f&&this._set("data",null)}},{key:"data",get:function(){return this._get("data")||null},set:function(f){this._set("data",f);f&&this._set("url",null)}},{key:"transparent",
get:function(){var f=this.data,w=this.url;return f instanceof HTMLCanvasElement?this._imageDataContainsTransparent(f.getContext("2d").getImageData(0,0,f.width,f.height)):f instanceof ImageData?this._imageDataContainsTransparent(f):w&&(f=w.substr(w.length-4,4).toLowerCase(),w=w.substr(0,15).toLocaleLowerCase(),".png"===f||"data:image/png;"===w)?!0:!1},set:function(f){null!=f?this._override("transparent",f):this._clearOverride("transparent")}},{key:"contentHash",get:function(){const f="string"===typeof this.wrap?
this.wrap:"object"===typeof this.wrap?`${this.wrap.horizontal}/${this.wrap.vertical}`:"",w=(z="")=>`d:${z},t:${this.transparent},w:${f}`;if(null!=this.url)return w(this.url);if(null!=this.data){if(this.data instanceof HTMLImageElement||this.data instanceof HTMLVideoElement)return w(this.data.src);t.has(this.data)||t.set(this.data,++q);return w(t.get(this.data))}return w()}}]);return r}(n.JSONSupport);b.__decorate([l.property({type:String,json:{write:e.write}})],c.prototype,"url",null);b.__decorate([l.property({json:{write:{overridePolicy(){return{enabled:!this.url}}}}}),
l.property()],c.prototype,"data",null);b.__decorate([d.writer("data")],c.prototype,"writeData",null);b.__decorate([m.reader("data")],c.prototype,"readData",null);b.__decorate([l.property({type:Boolean,json:{write:{overridePolicy(){return{enabled:this._isOverridden("transparent")}}}}})],c.prototype,"transparent",null);b.__decorate([l.property({json:{write:!0}})],c.prototype,"wrap",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"contentHash",null);return c=p=b.__decorate([h.subclass("esri.geometry.support.MeshTexture")],
c)})},"esri/views/support/screenshotUtils":function(){define(["exports","../../core/has","../../core/mathUtils","../../core/maybe"],function(a,b,c,n){function l(f,w){const {format:z,quality:A,rotation:x,disableDecorations:B}=f||{};var C=e(f,w.padding);var D=w.width-C.left-C.right;w=w.height-C.top-C.bottom;C={x:0,y:0,width:D,height:w};if(f&&f.area){null!=f.area.x&&(C.x=Math.floor(f.area.x));null!=f.area.y&&(C.y=Math.floor(f.area.y));var E=null!=f.area.width?Math.floor(f.area.width):null,F=null!=f.area.height?
Math.floor(f.area.height):null;C.width=D-C.x;C.height=w-C.y;null!=E&&null!=F?(C.width=Math.min(C.width,E),C.height=Math.min(C.height,F)):null==E&&null!=F?(E=Math.min(C.width,E),C.height*=E/C.width,C.width=E):null!=E&&null==F&&(E=Math.min(C.height,F),C.width*=E/C.height,C.height=E)}C=d(C,f);E=Math.floor(Math.max(C.x,0));F=Math.floor(Math.max(C.y,0));D={x:E,y:F,width:Math.floor(Math.min(C.width,D-E)),height:Math.floor(Math.min(C.height,w-F))};w=D.width/D.height;C=C.width/C.height;C!==w&&(C>w?(w=Math.floor(D.width/
C),D={x:D.x,y:Math.floor(D.y+(D.height-w)/2),width:D.width,height:w}):(w=Math.floor(D.height*C),D={x:Math.floor(D.x+(D.width-w)/2),y:D.y,width:w,height:D.height}));const {width:G,height:O}=h(f,D);w=g(z);C=r[w];C=c.clamp(null!=A?A:C,0,100);return{format:w,quality:C,area:D,width:G,height:O,rotation:x,disableDecorations:!!B,ignoreBackground:!(!f||!f.ignoreBackground),ignorePadding:!(!f||!f.ignorePadding)}}function u(f,w){n.isNone(p)&&(p=document.createElement("canvas"));var z=p;if(w.premultipliedAlpha){{var A=
f.data;const B=A.length;for(let C=0;C<B;C+=4){var x=A[C+3];255!==x&&0<x&&(x=255/x,A[C+0]*=x,A[C+1]*=x,A[C+2]*=x)}}}z.width=f.width;z.height=f.height;A=z.getContext("2d");A.putImageData(f,0,0);w.flipY&&(A.save(),A.globalCompositeOperation="copy",A.scale(1,-1),A.translate(0,-A.canvas.height),A.drawImage(A.canvas,0,0),A.restore());return{ctx:A,canvas:z}}function v(f,w){return f.toDataURL(k[w.format],w.quality/100)}function m(f,w,z){z||(t||(t=document.createElement("canvas"),t.width=1,t.height=1),z=t);
return z.getContext("2d").createImageData(f,w)}function h(f,w){if(!f)return w;const z=f.width;f=f.height;if(null!=z&&null!=f)return{width:Math.floor(z),height:Math.floor(f)};if(null==z&&null==f)return w;w=w.width/w.height;return null==f?{width:Math.floor(z),height:Math.floor(z/w)}:{width:Math.floor(f*w),height:Math.floor(f)}}function d(f,w){if(!w||null==w.width||null==w.height)return f;w=w.width/w.height;const z=f.width/f.height;if(z===w)return f;if(z<w)return w=Math.floor(f.height*w),f.x-=(w-f.width)/
2,f.width=w,f;w=Math.floor(f.width/w);f.y-=(w-f.height)/2;f.height=w;return f}function e(f,w){return!w||f&&f.ignorePadding?y:w}function g(f){switch(f){case "png":case "jpg":case "jpeg":return f;case null:case void 0:return"png";default:return"png"}}let p=null,t=null,q=!0;const k={png:"image/png",jpg:"image/jpeg",jpeg:"image/jpeg"},r={png:100,jpg:98,jpeg:98},y={top:0,right:0,bottom:0,left:0};a.completeUserSettings=l;a.createEmptyImageData=function(f,w,z){if(!f||!w)throw Error("Cannot construct image data without dimensions");
if(q)try{return new ImageData(f,w)}catch(A){q=!1}return m(f,w,z)};a.encode=function(f,w,z){const {ctx:A,canvas:x}=u(f,z);f=A.getImageData(0,0,f.width,f.height);w=v(x,w);x.width=0;x.height=0;return{dataUrl:w,data:f}};a.encodeData=function(f,w){const {ctx:z,canvas:A}=u(f,w);f=z.getImageData(0,0,f.width,f.height);A.width=0;A.height=0;return f};a.getFormatAndQuality=function(f,w){f=g(f);const z=r[f];w=c.clamp(null!=w?w:z,0,100);return{format:f,quality:w}};a.getMaximumResolutionScale=function(f,w){return w/
Math.max(f[0],f[1])};a.resampleHermite=function(f,w,z,A=0,x=0,B=f.width-A,C=f.height-x,D=!1){const {data:E}=f,{width:F,height:G,data:O}=w;B/=F;C/=G;const K=Math.ceil(B/2),L=Math.ceil(C/2);f=f.width;for(let J=0;J<G;J++)for(let I=0;I<F;I++){const P=4*(I+(D?G-J-1:J)*F);let N=0,V=0,S=0,T=0,H=0,U=0;const W=(J+.5)*C;for(let Q=Math.floor(J*C);Q<(J+1)*C;Q++){var R=Math.abs(W-(Q+.5))/L;const X=(I+.5)*B;R*=R;for(let ba=Math.floor(I*B);ba<(I+1)*B;ba++){var M=Math.abs(X-(ba+.5))/K;M=Math.sqrt(R+M*M);if(1<=M)continue;
M=2*M*M*M-3*M*M+1;const aa=4*(A+ba+(x+Q)*f);U+=M*E[aa+3];V+=M;!z&&255>E[aa+3]&&(M=M*E[aa+3]/255);S+=M*E[aa];T+=M*E[aa+1];H+=M*E[aa+2];N+=M}}O[P]=S/N;O[P+1]=T/N;O[P+2]=H/N;O[P+3]=U/V}return w};a.screenshotSuperSampleSettings=function(f,w,z){if(!w)return f;const {framebufferWidth:A,framebufferHeight:x,pixelRatio:B,region:C}=f;w=e(f,z);z=w.left+w.right;const D=w.top+w.bottom,E=A-z,F=x-D,G=Math.min(8,Math.min((2048-z)/E,(2048-D)/F));return 1.5>G?f:{...f,framebufferWidth:Math.round(E*G)+z,framebufferHeight:Math.round(F*
G)+D,pixelRatio:B*G,resample:{region:{x:Math.round((C.x-w.left)*G)+w.left,y:Math.round((C.y-w.top)*G)+w.top,width:Math.round(C.width*G),height:Math.round(C.height*G)},width:A,height:x}}};a.toDataUrl=v;a.toRenderSettings=function(f,w){const z=l(f,w),A=z.area,x=z.width/A.width,B=e(z,w.padding),C=B.left+B.right,D=B.top+B.bottom;return{framebufferWidth:Math.floor((w.width-C)*x+C),framebufferHeight:Math.floor((w.height-D)*x+D),region:{x:Math.floor(A.x*x)+B.left,y:Math.floor(A.y*x)+B.top,width:z.width,
height:z.height},format:z.format,quality:z.quality,rotation:z.rotation,pixelRatio:x,layers:f&&f.layers?f.layers:[],disableDecorations:z.disableDecorations,ignoreBackground:z.ignoreBackground,ignorePadding:z.ignorePadding}};a.wrapImageData=function(f,w,z,A){if(!w||!z)throw Error("Cannot construct image data without dimensions");if(q)try{return new ImageData(f,w,z)}catch(x){q=!1}w=m(w,z,A);w.data.set(f,0);return w};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/geometry/support/MeshMaterialMetallicRoughness":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../Color ../../core/maybe ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./MeshMaterial ./MeshTexture".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){var g;u=g=function(p){function t(k){k=p.call(this,k)||this;k.emissiveColor=null;k.emissiveTexture=
null;k.occlusionTexture=null;k.metallic=1;k.roughness=1;k.metallicRoughnessTexture=null;return k}a._inheritsLoose(t,p);var q=t.prototype;q.clone=function(){return this.cloneWithDeduplication(null,new Map)};q.cloneWithDeduplication=function(k,r){const y=n.isSome(k)?k.get(this):null;if(y)return y;r=new g(this.clonePropertiesWithDeduplication(r));n.isSome(k)&&k.set(this,r);return r};q.clonePropertiesWithDeduplication=function(k){return{...p.prototype.clonePropertiesWithDeduplication.call(this,k),emissiveColor:n.isSome(this.emissiveColor)?
this.emissiveColor.clone():null,emissiveTexture:n.isSome(this.emissiveTexture)?this.emissiveTexture.cloneWithDeduplication(k):null,occlusionTexture:n.isSome(this.occlusionTexture)?this.occlusionTexture.cloneWithDeduplication(k):null,metallic:this.metallic,roughness:this.roughness,metallicRoughnessTexture:n.isSome(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.cloneWithDeduplication(k):null}};return t}(d);b.__decorate([l.property({type:c,json:{write:!0}})],u.prototype,"emissiveColor",
void 0);b.__decorate([l.property({type:e,json:{write:!0}})],u.prototype,"emissiveTexture",void 0);b.__decorate([l.property({type:e,json:{write:!0}})],u.prototype,"occlusionTexture",void 0);b.__decorate([l.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"metallic",void 0);b.__decorate([l.property({type:Number,nonNullable:!0,json:{write:!0},range:{min:0,max:1}})],u.prototype,"roughness",void 0);b.__decorate([l.property({type:e,json:{write:!0}})],u.prototype,"metallicRoughnessTexture",
void 0);return u=g=b.__decorate([h.subclass("esri.geometry.support.MeshMaterialMetallicRoughness")],u)})},"esri/geometry/support/MeshVertexAttributes":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/JSONSupport ../../core/lang ../../core/Logger ../../core/accessorSupport/decorators/property ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),function(a,b,c,n,l,u,v,m,h){function d(q,k,r,y){const {loggerTag:f,
stride:w}=k;return 0!==q.length%w?(y.error(f,`Invalid array length, expected a multiple of ${w}`),new r([])):q}function e(q,k,r,y,f){if(!q)return q;if(q instanceof k)return d(q,y,k,f);for(const w of r)if(q instanceof w)return d(new k(q),y,k,f);if(Array.isArray(q))return d(new k(q),y,k,f);r=r.map(w=>`'${w.name}'`);f.error(`Failed to set property, expected one of ${r}, but got ${q.constructor.name}`);return new k([])}function g(q,k,r){{const y=Array(q.length);for(let f=0;f<q.length;f++)y[f]=q[f];q=
y}k[r]=q}var p;const t=u.getLogger("esri.geometry.support.MeshVertexAttributes");a.MeshVertexAttributes=p=function(q){function k(y){y=q.call(this,y)||this;y.color=null;y.position=new Float64Array(0);y.uv=null;y.normal=null;y.tangent=null;return y}b._inheritsLoose(k,q);var r=k.prototype;r.castColor=function(y){return e(y,Uint8Array,[Uint8ClampedArray],{loggerTag:".color\x3d",stride:4},t)};r.castPosition=function(y){y&&y instanceof Float32Array&&t.warn(".position\x3d","Setting position attribute from a Float32Array may cause precision problems. Consider storing data in a Float64Array or a regular number array");
return e(y,Float64Array,[Float32Array],{loggerTag:".position\x3d",stride:3},t)};r.castUv=function(y){return e(y,Float32Array,[Float64Array],{loggerTag:".uv\x3d",stride:2},t)};r.castNormal=function(y){return e(y,Float32Array,[Float64Array],{loggerTag:".normal\x3d",stride:3},t)};r.castTangent=function(y){return e(y,Float32Array,[Float64Array],{loggerTag:".tangent\x3d",stride:4},t)};r.clone=function(){const y={position:l.clone(this.position),uv:l.clone(this.uv),normal:l.clone(this.normal),tangent:l.clone(this.tangent),
color:l.clone(this.color)};return new p(y)};r.clonePositional=function(){const y={position:l.clone(this.position),normal:l.clone(this.normal),tangent:l.clone(this.tangent),uv:this.uv,color:this.color};return new p(y)};return k}(n.JSONSupport);c.__decorate([v.property({json:{write:g}})],a.MeshVertexAttributes.prototype,"color",void 0);c.__decorate([m.cast("color")],a.MeshVertexAttributes.prototype,"castColor",null);c.__decorate([v.property({nonNullable:!0,json:{write:g}})],a.MeshVertexAttributes.prototype,
"position",void 0);c.__decorate([m.cast("position")],a.MeshVertexAttributes.prototype,"castPosition",null);c.__decorate([v.property({json:{write:g}})],a.MeshVertexAttributes.prototype,"uv",void 0);c.__decorate([m.cast("uv")],a.MeshVertexAttributes.prototype,"castUv",null);c.__decorate([v.property({json:{write:g}})],a.MeshVertexAttributes.prototype,"normal",void 0);c.__decorate([m.cast("normal")],a.MeshVertexAttributes.prototype,"castNormal",null);c.__decorate([v.property({json:{write:g}})],a.MeshVertexAttributes.prototype,
"tangent",void 0);c.__decorate([m.cast("tangent")],a.MeshVertexAttributes.prototype,"castTangent",null);a.MeshVertexAttributes=p=c.__decorate([h.subclass("esri.geometry.support.MeshVertexAttributes")],a.MeshVertexAttributes);a.castArray=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/meshUtils/projection":function(){define("exports ../../../core/Logger ../../../core/maybe ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../projection ../../projectionEllipsoid ../spatialReferenceUtils ../webMercatorUtils ../buffer/BufferView ../../../chunks/vec32".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(B,C,D,E,F,G){if(C){var O=D.count,K=d.getSphericalPCPF(F);if(r(F))for(D=0;D<O;D++)E.getVec(D,w),C.getVec(D,z),h.computeTranslationToOriginAndRotation(K,w,A,K),n.fromMat4(x,A),B===f.FROM_PCPF&&n.transpose(x,x),v.transformMat3(z,z,x),G.setVec(D,z);else for(F=0;F<O;F++){E.getVec(F,w);C.getVec(F,z);h.computeTranslationToOriginAndRotation(K,w,A,K);n.fromMat4(x,A);var L=g.y2lat(D.get(F,1));L=Math.cos(L);B===f.TO_PCPF&&(L=1/L);x[0]*=L;x[1]*=L;x[2]*=L;x[3]*=
L;x[4]*=L;x[5]*=L;B===f.FROM_PCPF&&n.transpose(x,x);v.transformMat3(z,z,x);v.normalize(z,z);G.setVec(F,z)}return G}}function k(B){return r(B)||B.isWebMercator}function r(B){return B.isWGS84||e.isCGCS2000(B)||e.isMars(B)||e.isMoon(B)}const y=b.getLogger("esri.geometry.support.meshUtils.normalProjection");var f;(function(B){B[B.TO_PCPF=0]="TO_PCPF";B[B.FROM_PCPF=1]="FROM_PCPF"})(f||(f={}));const w=m.create(),z=m.create(),A=u.create(),x=l.create();a.projectFromPCPF=function(B,C,D){h.projectBuffer(B,
d.getSphericalPCPF(D),0,C,D,0,B.length/3);return C};a.projectNormalFromPCPF=function(B,C,D,E,F){if(!k(E))return y.error("Cannot convert to spatial reference from PCPF"),F;q(f.FROM_PCPF,p.BufferViewVec3f.fromTypedArray(B),p.BufferViewVec3f64.fromTypedArray(C),p.BufferViewVec3f64.fromTypedArray(D),E,p.BufferViewVec3f.fromTypedArray(F));return F};a.projectNormalToPCPF=function(B,C,D,E,F){if(!k(E))return y.error("Cannot convert spatial reference to PCPF"),F;q(f.TO_PCPF,p.BufferViewVec3f.fromTypedArray(B),
p.BufferViewVec3f64.fromTypedArray(C),p.BufferViewVec3f64.fromTypedArray(D),E,p.BufferViewVec3f.fromTypedArray(F));return F};a.projectTangentFromPCPF=function(B,C,D,E,F){if(!k(E))return y.error("Cannot convert to spatial reference from PCPF"),F;q(f.FROM_PCPF,p.BufferViewVec3f.fromTypedArray(B,16),p.BufferViewVec3f64.fromTypedArray(C),p.BufferViewVec3f64.fromTypedArray(D),E,p.BufferViewVec3f.fromTypedArray(F,16));for(C=3;C<B.length;C+=4)F[C]=B[C];return F};a.projectTangentToPCPF=function(B,C,D,E,F){if(!k(E))return y.error("Cannot convert spatial reference to PCPF"),
F;q(f.TO_PCPF,p.BufferViewVec3f.fromTypedArray(B,4*Float32Array.BYTES_PER_ELEMENT),p.BufferViewVec3f64.fromTypedArray(C),p.BufferViewVec3f64.fromTypedArray(D),E,p.BufferViewVec3f.fromTypedArray(F,4*Float32Array.BYTES_PER_ELEMENT));for(C=3;C<B.length;C+=4)F[C]=B[C];return F};a.projectToPCPF=function(B,C,D){h.projectBuffer(B,C,0,D,d.getSphericalPCPF(C),0,B.length/3);return D};a.transformNormal=function(B,C,D){if(c.isNone(B))return C;n.normalFromMat4(x,D);B=p.BufferViewVec3f.fromTypedArray(B);D=p.BufferViewVec3f.fromTypedArray(C);
t.transformMat3(D,B,x);n.isOrthoNormal(x)||t.normalize(D,D);return C};a.transformPosition=function(B,C,D){if(c.isNone(B))return C;B=p.BufferViewVec3f64.fromTypedArray(B);const E=p.BufferViewVec3f64.fromTypedArray(C);t.transformMat4(E,B,D);return C};a.transformTangent=function(B,C,D){if(c.isNone(B))return C;n.normalFromMat4(x,D);D=p.BufferViewVec3f.fromTypedArray(B,4*Float32Array.BYTES_PER_ELEMENT);const E=p.BufferViewVec3f.fromTypedArray(C,4*Float32Array.BYTES_PER_ELEMENT);t.transformMat3(E,D,x);
n.isOrthoNormal(x)||t.normalize(E,E);if(B!==C)for(D=3;D<B.length;D+=4)C[D]=B[D];return C};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/NativeLineMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec2 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../geometry/support/lineSegment ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../core/shaderLibrary/ShaderOutputOptions ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ./renderers/utils ../shaders/NativeLineTechnique ../shaders/NativeLineTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D){const E=c.getLogger("esri.views.3d.webgl-engine.materials.NativeLineMaterial");var F;(function(ea){ea[ea.START=0]="START";ea[ea.END=1]="END"})(F||(F={}));c=function(ea){function ia(la){la=ea.call(this,la,new K)||this;la._techniqueConfig=new D.NativeLineTechniqueConfiguration;return la}b._inheritsLoose(ia,ea);var ka=ia.prototype;ka.getConfiguration=function(la,Z){this._techniqueConfig.output=la;this._techniqueConfig.hasSlicePlane=this.parameters.hasSlicePlane;
this._techniqueConfig.hasVertexColors=this.parameters.hasVertexColors;this._techniqueConfig.transparent=1>this.parameters.color[3]||1>this.parameters.width;this._techniqueConfig.draped=Z.slot===y.RenderSlot.DRAPED_MATERIAL;la=n.isSome(this.parameters.stipplePattern);this._techniqueConfig.stippleEnabled=la;this._techniqueConfig.stippleOffColorEnabled=la&&n.isSome(this.parameters.stippleOffColor);this._techniqueConfig.hasOccludees=this.parameters.hasOccludees;this._techniqueConfig.stipplePreferContinuous=
this.parameters.stipplePreferContinuous;return this._techniqueConfig};ka.intersect=function(la,Z,ca,Y,da,ha,ja,ma,pa){n.isSome(pa)?x.intersectDrapedRenderLineGeometry(la,Y,pa,ha,1,ja):this._intersectLineGeometry(la,Z,ca,Y,ja)};ka._intersectLineGeometry=function(la,Z,ca,Y,da){if(Y.options.selectionMode&&!B.isInstanceHidden(Z))if(f.isTranslationMatrix(ca)){var ha=la.vertexAttributes.get(w.VertexAttribute.POSITION).data,ja=Y.camera,ma=H;u.copy(ma,Y.point);v.set(U[0],ma[0]-2,ma[1]+2,0);v.set(U[1],ma[0]+
2,ma[1]+2,0);v.set(U[2],ma[0]+2,ma[1]-2,0);v.set(U[3],ma[0]-2,ma[1]-2,0);for(la=0;4>la;la++)if(!ja.unprojectFromRenderScreen(U[la],W[la]))return;g.fromPoints(ja.eye,W[0],W[1],Q);g.fromPoints(ja.eye,W[1],W[2],X);g.fromPoints(ja.eye,W[2],W[3],ba);g.fromPoints(ja.eye,W[3],W[0],aa);Z=Number.MAX_VALUE;la=0;for(let na=0;na<ha.length-5;na+=3)if(L[0]=ha[na]+ca[12],L[1]=ha[na+1]+ca[13],L[2]=ha[na+2]+ca[14],R[0]=ha[na+3]+ca[12],R[1]=ha[na+4]+ca[13],R[2]=ha[na+5]+ca[14],!(0>g.signedDistance(Q,L)&&0>g.signedDistance(Q,
R)||0>g.signedDistance(X,L)&&0>g.signedDistance(X,R)||0>g.signedDistance(ba,L)&&0>g.signedDistance(ba,R)||0>g.signedDistance(aa,L)&&0>g.signedDistance(aa,R))){ja.projectToRenderScreen(L,I);ja.projectToRenderScreen(R,P);if(0>I[2]&&0<P[2]){v.subtract(M,L,R);var pa=ja.frustum;pa=-g.signedDistance(pa[d.PlaneIndex.NEAR],L)/v.dot(M,g.normal(pa[d.PlaneIndex.NEAR]));v.scale(M,M,pa);v.add(L,L,M);ja.projectToRenderScreen(L,I)}else if(0<I[2]&&0>P[2])v.subtract(M,R,L),pa=ja.frustum,pa=-g.signedDistance(pa[d.PlaneIndex.NEAR],
R)/v.dot(M,g.normal(pa[d.PlaneIndex.NEAR])),v.scale(M,M,pa),v.add(R,R,M),ja.projectToRenderScreen(R,P);else if(0>I[2]&&0>P[2])continue;I[2]=0;P[2]=0;pa=e.distance2(e.fromPoints(I,P,S),ma);pa<Z&&(Z=pa,v.copy(N,L),v.copy(V,R),la=na/3)}ca=Y.rayBegin;Y=Y.rayEnd;4>Z&&(Z=Number.MAX_VALUE,e.closestLineSegmentPoint(e.fromPoints(N,V,S),e.fromPoints(ca,Y,T),J)&&(v.subtract(J,J,ca),Z=v.length(J),v.scale(J,J,1/Z),Z/=v.distance(ca,Y)),da(Z,J,la,!1))}else E.error("intersection assumes a translation-only matrix")};
ka.computeAttachmentOrigin=function(la,Z){la=la.vertexAttributes;if(!la)return!1;la=la.get(w.VertexAttribute.POSITION);return q.computeAttachmentOriginLines(la,null,!1,Z)};ka.requiresSlot=function(la){return la===y.RenderSlot.OPAQUE_MATERIAL||la===y.RenderSlot.DRAPED_MATERIAL};ka.createGLMaterial=function(la){return la.output===t.ShaderOutput.Color||la.output===t.ShaderOutput.Highlight?new G(la):null};ka.createBufferWriter=function(){const la=this.parameters.hasVertexColors?A.PositionColorLayout:
A.PositionLayout;return n.isNone(this.parameters.stipplePattern)?new A.DefaultBufferWriter(la):new O(la.clone().vec3f(w.VertexAttribute.AUXPOS1).vec2f(w.VertexAttribute.UV0))};return ia}(r.Material);let G=function(ea){function ia(){return ea.apply(this,arguments)||this}b._inheritsLoose(ia,ea);var ka=ia.prototype;ka._updateOccludeeState=function(la){la.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:la.hasOccludees})};ka.beginSlot=function(la){this._output===
t.ShaderOutput.Color&&this._updateOccludeeState(la);return this.ensureTechnique(C.NativeLineTechnique,la)};return ia}(k),O=function(){function ea(ka){this.vertexBufferLayout=ka}var ia=ea.prototype;ia.allocate=function(ka){return this.vertexBufferLayout.createBuffer(ka)};ia.elementCount=function(ka){return ka.indices.get(w.VertexAttribute.POSITION).length};ia.write=function(ka,la,Z,ca){z.writeDefaultAttributes(la,this.vertexBufferLayout,ka.transformation,ka.invTranspTransformation,Z,ca);this._writeAuxpos1(ka,
la,Z,ca);this._writeUV0(ka,la,Z,ca)};ia._writeAuxpos1=function(ka,la,Z,ca){var Y=Z.getField(w.VertexAttribute.AUXPOS1,p.BufferViewVec3f);Z=la.indices.get(w.VertexAttribute.POSITION);la=la.vertexAttributes.get(w.VertexAttribute.POSITION).data;ka=ka.transformation;const da=Y.typedBufferStride;Y=Y.typedBuffer;ca*=da;for(let ja=0;ja<Z.length-1;ja+=2)for(const ma of[1,0]){var ha=3*Z[ja+ma];const pa=la[ha],na=la[ha+1];ha=la[ha+2];const wa=ka[1]*pa+ka[5]*na+ka[9]*ha+ka[13],xa=ka[2]*pa+ka[6]*na+ka[10]*ha+
ka[14];Y[ca]=ka[0]*pa+ka[4]*na+ka[8]*ha+ka[12];Y[ca+1]=wa;Y[ca+2]=xa;ca+=da}};ia._writeUV0=function(ka,la,Z,ca){var Y,da=Z.getField(w.VertexAttribute.UV0,p.BufferViewVec2f),ha=la.indices.get(w.VertexAttribute.POSITION);Z=la.vertexAttributes.get(w.VertexAttribute.POSITION).data;const ja=null==(Y=la.vertexAttributes.get(w.VertexAttribute.DISTANCETOSTART))?void 0:Y.data;ka=ka.transformation;la=da.typedBufferStride;da=da.typedBuffer;ca*=la;let ma=0;da[ca]=F.START;da[ca+1]=ma;ca+=la;Y=3*ha[0];Y=v.set(L,
Z[Y],Z[Y+1],Z[Y+2]);ka&&v.transformMat4(Y,Y,ka);const pa=R,na=ha.length-1;let wa=1;const xa=ja?(ya,ra,ua)=>ma=ja[ua]:(ya,ra,ua)=>ma+=v.distance(ya,ra);for(let ya=1;ya<na;ya+=2){var sa=3*ha[ya];v.set(pa,Z[sa],Z[sa+1],Z[sa+2]);ka&&v.transformMat4(pa,pa,ka);xa(Y,pa,wa++);for(sa=0;2>sa;++sa)da[ca]=1-sa,da[ca+1]=ma,ca+=la;v.copy(Y,pa)}ha=3*ha[na];v.set(pa,Z[ha],Z[ha+1],Z[ha+2]);ka&&v.transformMat4(pa,pa,ka);xa(Y,pa,wa);da[ca]=F.END;da[ca+1]=ma};return ea}(),K=function(ea){function ia(){var ka=ea.apply(this,
arguments)||this;ka.color=h.ONES;ka.hasVertexColors=!1;ka.hasSlicePlane=!1;ka.width=1;ka.stipplePreferContinuous=!0;ka.hasOccludees=!1;return ka}b._inheritsLoose(ia,ea);return ia}(r.MaterialParameters);const L=m.create(),R=m.create(),M=m.create(),J=m.create(),I=l.createRenderScreenPointArray3(),P=l.createRenderScreenPointArray3(),N=m.create(),V=m.create(),S=e.create(),T=e.create(),H=m.create(),U=[l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),l.createRenderScreenPointArray3(),
l.createRenderScreenPointArray3()],W=[m.create(),m.create(),m.create(),m.create()],Q=g.create(),X=g.create(),ba=g.create(),aa=g.create();a.NativeLineMaterial=c;a.Parameters=K;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/NativeLineTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../../chunks/NativeLine.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){v=function(t){function q(r,y,f){y=t.call(this,r,y,f)||this;y.stipplePattern=null;y.stippleTextureBind=null;y.stippleTextureRepository=r.stippleTextureRepository;return y}c._inheritsLoose(q,t);var k=q.prototype;k.initializeProgram=function(r){const y=q.shader.get().build(this.configuration);return new h.Program(r.rctx,y,m.Default3D)};k.destroy=function(){t.prototype.destroy.call(this);this.stippleTextureRepository.release(this.stipplePattern);this.stippleTextureBind=
this.stipplePattern=null};k.bindPass=function(r,y){this.program.bindPass(r,y);this.stipplePattern!==r.stipplePattern&&(r=r.stipplePattern,this.stippleTextureBind=this.stippleTextureRepository.swap(this.stipplePattern,r),this.stipplePattern=r);if(this.stippleEnabled){const {pixelSize:f,sdfNormalizer:w,pixels:z}=n.isSome(this.stippleTextureBind)?this.stippleTextureBind(this.program):{pixelSize:1,sdfNormalizer:1,pixels:1};this.program.setUniform1f("stipplePatternSDFNormalizer",w);this.program.setUniform1f("stipplePatternTextureSize",
z);this.program.setUniform1f("stipplePatternPixelSize",f);this.program.setUniform1f("stipplePatternPixelSizeInv",1/f)}};k.initializePipeline=function(){const r=this.configuration,y=p.separateBlendingParams(g.BlendFactor.SRC_ALPHA,g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA,g.BlendFactor.ONE_MINUS_SRC_ALPHA),f=(w,z=null,A=null)=>p.makePipelineState({blending:z,depthTest:d.depthCompareLess,depthWrite:A,colorWrite:p.defaultColorWriteParams,stencilWrite:r.hasOccludees?d.stencilWriteMaskOn:null,
stencilTest:r.hasOccludees?w?d.stencilToolMaskBaseParams:d.stencilBaseAllZerosParams:null});return r.output===l.ShaderOutput.Color?(this._occludeePipelineState=f(!0,r.transparent||this.stippleEnabled?y:null,p.defaultDepthWriteParams),f(!1,r.transparent||this.stippleEnabled?y:null,p.defaultDepthWriteParams)):f(!1)};k.getPipelineState=function(r,y){return y?this._occludeePipelineState:t.prototype.getPipelineState.call(this,r,y)};c._createClass(q,[{key:"stippleEnabled",get:function(){return this.configuration.stippleEnabled&&
this.configuration.output!==l.ShaderOutput.Highlight}},{key:"primitiveType",get:function(){return g.PrimitiveType.LINES}}]);return q}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(e.NativeLine,()=>new Promise((t,q)=>a(["./NativeLine.glsl"],t,q)));b.NativeLineTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/NativeLine.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/LineStipple.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(r){const y=new p.ShaderBuilder;y.include(n.Transform);y.include(l.VertexColor,r);y.include(v.LineStipple,r);h.addProjViewLocalOrigin(y,r);const {vertex:f,fragment:w}=y;r.stippleEnabled&&(y.attributes.add(t.VertexAttribute.UV0,"vec2"),y.attributes.add(t.VertexAttribute.AUXPOS1,"vec3"),f.uniforms.add(new d.Float4PassUniform("viewport",(z,A)=>A.camera.fullViewport)));y.attributes.add(t.VertexAttribute.POSITION,"vec3");y.varyings.add("vpos","vec3");f.code.add(g.glsl`void main(void) {
vpos = position;
forwardNormalizedVertexColor();
gl_Position = transformPosition(proj, view, vpos);`);r.stippleEnabled&&(f.code.add(g.glsl`vec4 vpos2 = transformPosition(proj, view, auxpos1);
vec2 ndcToPixel = viewport.zw * 0.5;
float lineSegmentPixelSize = length((vpos2.xy / vpos2.w - gl_Position.xy / gl_Position.w) * ndcToPixel);`),r.draped?f.uniforms.add(new e.FloatPassUniform("worldToScreenRatio",(z,A)=>1/A.screenToPCSRatio)):f.code.add(g.glsl`vec3 segmentCenter = (position + auxpos1) * 0.5;
float worldToScreenRatio = computeWorldToScreenRatio(segmentCenter);`),f.code.add(g.glsl`float discreteWorldToScreenRatio = discretizeWorldToScreenRatio(worldToScreenRatio);`),r.draped?f.code.add(g.glsl`float startPseudoScreen = uv0.y * discreteWorldToScreenRatio - mix(0.0, lineSegmentPixelSize, uv0.x);
float segmentLengthPseudoScreen = lineSegmentPixelSize;`):f.code.add(g.glsl`float segmentLengthRender = length(position - auxpos1);
float startPseudoScreen = mix(uv0.y, uv0.y - segmentLengthRender, uv0.x) * discreteWorldToScreenRatio;
float segmentLengthPseudoScreen = segmentLengthRender * discreteWorldToScreenRatio;`),f.code.add(g.glsl`vec2 stippleDistanceLimits = computeStippleDistanceLimits(startPseudoScreen, segmentLengthPseudoScreen, lineSegmentPixelSize, stipplePatternPixelSize);
vStippleDistance = mix(stippleDistanceLimits.x, stippleDistanceLimits.y, uv0.x);
vStippleDistance *= gl_Position.w;`));f.code.add(g.glsl`}`);r.output===b.ShaderOutput.Highlight&&y.include(u.OutputHighlight);y.include(c.SliceDraw,r);w.uniforms.add(new e.FloatPassUniform("alphaCoverage",(z,A)=>Math.min(1,z.width*A.camera.pixelRatio)));r.hasVertexColors||w.uniforms.add(new d.Float4PassUniform("constantColor",z=>z.color));w.code.add(g.glsl`
  void main() {
    discardBySlice(vpos);

    vec4 color = ${r.hasVertexColors?"vColor":"constantColor"};

    float stippleAlpha = getStippleAlpha();
    discardByStippleAlpha(stippleAlpha, stippleAlphaColorDiscard);

    vec4 finalColor = blendStipple(vec4(color.rgb, color.a * alphaCoverage), stippleAlpha);

    if (finalColor.a < ${g.glsl.float(m.symbolAlphaCutoff)}) {
      discard;
    }

    ${r.output===b.ShaderOutput.Color?g.glsl`gl_FragColor = highlightSlice(finalColor, vpos);`:""}
    ${r.output===b.ShaderOutput.Highlight?g.glsl`outputHighlight();`:""}
  }
  `);return y}const k=Object.freeze(Object.defineProperty({__proto__:null,build:q},Symbol.toStringTag,{value:"Module"}));a.NativeLine=k;a.build=q})},"esri/views/3d/webgl-engine/shaders/NativeLineTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),function(a,b,c,n,l,u){u=function(v){function m(){var h=
v.apply(this,arguments)||this;h.output=n.ShaderOutput.Color;h.hasSlicePlane=!1;h.hasVertexColors=!1;h.transparent=!1;h.draped=!1;h.stippleEnabled=!1;h.stippleOffColorEnabled=!1;h.stipplePreferContinuous=!0;h.hasOccludees=!1;return h}b._inheritsLoose(m,v);return m}(u.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:n.ShaderOutput.COUNT})],u.prototype,"output",void 0);c.__decorate([l.parameter()],u.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],u.prototype,"hasVertexColors",
void 0);c.__decorate([l.parameter()],u.prototype,"transparent",void 0);c.__decorate([l.parameter()],u.prototype,"draped",void 0);c.__decorate([l.parameter()],u.prototype,"stippleEnabled",void 0);c.__decorate([l.parameter()],u.prototype,"stippleOffColorEnabled",void 0);c.__decorate([l.parameter()],u.prototype,"stipplePreferContinuous",void 0);c.__decorate([l.parameter()],u.prototype,"hasOccludees",void 0);c.__decorate([l.parameter({constValue:!1})],u.prototype,"stippleRequiresClamp",void 0);c.__decorate([l.parameter({constValue:!1})],
u.prototype,"stippleScaleWithLineWidth",void 0);c.__decorate([l.parameter({constValue:!1})],u.prototype,"stippleRequiresStretchMeasure",void 0);a.NativeLineTechniqueConfiguration=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DObjectSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../symbols/support/ObjectSymbol3DLayerResource ../../../../symbols/support/symbolLayerUtils3D ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DLodInstanceGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ./Loadable ./lodResourceUtils ./objectResourceUtils ./pointUtils ./primitiveObjectSymbolUtils ./symbolComplexity ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/lib/lodRendering/LodRenderer ../../webgl-engine/lib/lodRendering/LodResources ../../webgl-engine/materials/DefaultMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R){f=function(V){function S(H,U,W,Q){H=V.call(this,H,U,W,Q)||this;H._resources=null;H._optionalFields=[];H._instanceIndexToGraphicUid=new Map;H.hasLoadedPBRTextures=!1;H._disposeResourceHandles=[];H.ensureDrapedStatus(!1);H.hasLoadedPBRTextures=W.physicalBasedRenderingEnabled;return H}b._inheritsLoose(S,V);var T=S.prototype;T.getCachedSize=function(){const [H,U,W]=n.isSome(this._resources)?this._resources.symbolSize:[1,1,1];
return{width:H,depth:U,height:W}};T.doLoad=function(){var H=b._asyncToGenerator(function*(U){if(!this._drivenProperties.size&&w.validateSymbolLayerSize(this.symbolLayer))throw Error();const W=this.symbolLayer;this._resources=this.isPrimitive?yield this._createResourcesForPrimitive(W.resource?W.resource.primitive:p.defaultPrimitive,U):yield this._createResourcesForUrl(W.resource.href,U);this.layerOpacityChanged();this.slicePlaneEnabledChanged();this.physicalBasedRenderingChanged();this.complexity=
this.computeComplexity()});return function(U){return H.apply(this,arguments)}}();T._setMaterialTransparencyParams=function(H,U=n.get(this.symbolLayer,"material","color")){U=this._getCombinedOpacity(U);const W=1>U||this.needsDrivenTransparentPass;H.transparent=W;H.opacity=U;H.cullFace=W?G.CullFaceOptions.None:G.CullFaceOptions.Back;return H};T._createResourcesForPrimitive=function(){var H=b._asyncToGenerator(function*(U,W){if(!D.isValidPrimitive(U))throw Error(`Unknown object symbol primitive: ${U}`);
var Q=this.symbolLayer;const X=g.create(t.objectSymbolLayerPrimitiveBoundingBox(U)),ba=h.fromArray(g.size(X)),aa=h.fromArray(t.objectSymbolLayerSizeWithResourceSize(ba,Q)),ea=m.length(aa);var ia={usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0,ambient:h.ONES,diffuse:h.ONES,hasSlicePlane:this._context.slicePlaneEnabled,hasSliceHighlight:!1,castShadows:this.symbolLayer.castShadows,offsetTransparentBackfaces:!this.symbolLayer.isPrimitive};const ka=ia.usePBR;this._setMaterialTransparencyParams(ia);
const la=this.symbol;if("point-3d"===la.type&&la.verticalOffset){const {screenLength:Z,minWorldLength:ca,maxWorldLength:Y}=la.verticalOffset;ia.verticalOffset={screenLength:l.pt2px(Z),minWorldLength:ca||0,maxWorldLength:null!=Y?Y:Infinity};ia.castShadows=!1}this._context.screenSizePerspectiveEnabled&&(ia.screenSizePerspective=this._context.sharedResources.screenSizePerspectiveSettings);this._drivenProperties.color?ia.externalColor=d.ONES:(Q=n.isSome(Q.material)&&Q.material.color,Q=n.isSome(Q)?c.toUnitRGBA(Q):
d.ONES,ia.externalColor=Q);this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(X,aa,ba,n.none));ia.instanced=["transformation"];this._fastUpdates.enabled?(Object.assign(ia,this._fastUpdates.materialParameters),ia.instanced.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(ia.instanced.push("color"),this._optionalFields.push("color"));ia=new R.DefaultMaterial(ia);ia=D.primitiveLodResources(U,
ia);if(!ia)throw Error(`Unknown object symbol primitive: ${U}`);U=L.materialsFromLodResources(ia).map(Z=>({opacity:1,transparent:Z.parameters.transparent}));Q=yield this._createStageResources(ia,ka);W=yield this._createLodRenderer(ia,W);return{lodResources:ia,lodRenderer:W,stageResources:Q,symbolSize:aa,extentPadding:ea,isEsriSymbolResource:!1,isWosr:!1,originalMaterialParameters:U,physicalBasedRenderingEnabled:ka,resourceBoundingBox:X,resourceSize:ba,pivotOffset:n.none}});return function(U,W){return H.apply(this,
arguments)}}();T._createResourcesForUrl=function(){var H=b._asyncToGenerator(function*(U,W){var Q=["transformation"],X={materialParamsMixin:{instanced:Q,hasSlicePlane:this._context.slicePlaneEnabled,castShadows:this.symbolLayer.castShadows},streamDataRequester:this._context.streamDataRequester,cache:this._context.sharedResources.objectResourceCache};this._fastUpdates=F.initFastSymbolUpdatesState(this._context.renderer,this._fastVisualVariableConvertOptions(n.none,n.none,n.none,n.none));this._fastUpdates.enabled?
(Object.assign(X.materialParamsMixin,this._fastUpdates.materialParameters),Q.push("featureAttribute"),this._optionalFields.push("featureAttribute")):this._hasPerInstanceColor()&&(Q.push("color"),this._optionalFields.push("color"));Q=this.symbol;if("point-3d"===Q.type&&Q.verticalOffset){const {screenLength:pa,minWorldLength:na,maxWorldLength:wa}=Q.verticalOffset;X.materialParamsMixin.verticalOffset={screenLength:l.pt2px(pa),minWorldLength:na||0,maxWorldLength:null!=wa?wa:Infinity};X.materialParamsMixin.castShadows=
!1}X.signal=W;X.usePBR=this._context.physicalBasedRenderingEnabled;Q=X.usePBR;const ba=yield B.fetch(U,X);U=ba.isEsriSymbolResource;X=ba.isWosr;this._addDisposeResource(()=>ba.remove());const aa=x.makeLodResources(ba.lods);x.fillEstimatedMinScreenSpaceRadius(aa);aa.levels.sort((pa,na)=>pa.minScreenSpaceRadius-na.minScreenSpaceRadius);aa.levels[0].minScreenSpaceRadius=Math.min(2,aa.levels[0].minScreenSpaceRadius);const ea=this._context,ia=this._getExternalColorParameters(this.symbolLayer.material);
var ka=n.get(this.symbolLayer,"material","color");const la=this._getCombinedOpacity(ka,{hasIntrinsicColor:!0}),Z=this.needsDrivenTransparentPass;var ca=L.materialsFromLodResources(aa);ka=L.materialsFromLodResources(aa).map(pa=>({opacity:pa.parameters.opacity||1,transparent:pa.parameters.transparent}));ca.forEach(pa=>{const na=pa.parameters;pa.setParameters(ia);const wa=na.opacity*la;pa.setParameters({opacity:wa,transparent:1>wa||Z||na.transparent});ea.screenSizePerspectiveEnabled&&pa.setParameters({screenSizePerspective:ea.sharedResources.screenSizePerspectiveSettings})});
const Y=ba.referenceBoundingBox,da=h.fromArray(g.size(Y)),ha=h.fromArray(aa.levels[0].pivotOffset),ja=h.fromArray(t.objectSymbolLayerSizeWithResourceSize(da,this.symbolLayer)),ma=m.length(ja);F.updateFastSymbolUpdatesState(this._fastUpdates,this._context.renderer,this._fastVisualVariableConvertOptions(Y,ja,da,ha))&&ca.forEach(pa=>pa.setParameters(this._fastUpdates.materialParameters));ca=yield this._createStageResources(aa,Q);W=yield this._createLodRenderer(aa,W);return{lodResources:aa,lodRenderer:W,
stageResources:ca,symbolSize:ja,extentPadding:ma,isEsriSymbolResource:U,isWosr:X,originalMaterialParameters:ka,physicalBasedRenderingEnabled:Q,resourceBoundingBox:Y,resourceSize:da,pivotOffset:ha}});return function(U,W){return H.apply(this,arguments)}}();T._addDisposeResource=function(H){this._disposeResourceHandles.push(H)};T._createStageResources=function(){var H=b._asyncToGenerator(function*(U,W){const Q=this._context.stage,X=L.materialsFromLodResources(U);W!==this._context.physicalBasedRenderingEnabled&&
this.physicalBasedRenderingChanged();Q.addMany(X);this._addDisposeResource(()=>Q.removeMany(X));const ba=L.texturesFromLodResources(U);Q.addMany(ba);this._addDisposeResource(()=>Q.removeMany(ba));yield Q.load(ba);const aa=L.geometriesFromLodResources(U);Q.addMany(aa);this._addDisposeResource(()=>Q.removeMany(aa));return{materials:X,textures:ba,geometries:aa}});return function(U,W){return H.apply(this,arguments)}}();T._createLodRenderer=function(){var H=b._asyncToGenerator(function*(U,W){const Q=this._context.stage,
X=new K.LodRenderer(U,this._optionalFields,{layerUid:this._context.layer.uid,graphicUid:ba=>this._instanceIndexToGraphicUid.get(ba),notifyGraphicGeometryChanged:ba=>this._context.notifyGraphicGeometryChanged(this._instanceIndexToGraphicUid.get(ba)),notifyGraphicVisibilityChanged:ba=>this._context.notifyGraphicVisibilityChanged(this._instanceIndexToGraphicUid.get(ba))},this._fastUpdates.enabled?{applyTransform:(ba,aa,ea)=>{ba.getFeatureAttribute(aa,P);u.copy(ea,F.evaluateModelTransform(this._fastUpdates.materialParameters,
P,ea))},scaleFactor:(ba,aa,ea)=>{aa.getFeatureAttribute(ea,P);return F.evaluateModelTransformScale(ba,this._fastUpdates.materialParameters,P)}}:null);X.slicePlaneEnabled=this._context.slicePlaneEnabled;this._addDisposeResource(()=>{Q.removeRenderPlugin(X)});yield Q.addRenderPlugin(X.slots,X,W);return X});return function(U,W){return H.apply(this,arguments)}}();T._getExternalColorParameters=function(H){const U={};this._drivenProperties.color?U.externalColor=d.ONES:n.isSome(H)&&n.isSome(H.color)?U.externalColor=
c.toUnitRGBA(H.color):(U.externalColor=d.ONES,U.colorMixMode="ignore");return U};T.destroy=function(){V.prototype.destroy.call(this);this._cleanupResources()};T._cleanupResources=function(){this._disposeResourceHandles.forEach(H=>H());this._disposeResourceHandles.length=0;this._resources=null};T.createGraphics3DGraphic=function(H){const U=H.graphic;if(!this._validateGeometry(U.geometry))return null;const W=C.placePointOnGeometry(U.geometry);if(n.isNone(W))return this.logger.warn(`unsupported geometry type for icon symbol: ${U.geometry.type}`),
null;const Q=this.setGraphicElevationContext(U,new r.ElevationContext);return this._createAs3DShape(U,W,H.renderingInfo,Q,U.uid)};T.notifyDestroyGraphicLayer=function(H){this._instanceIndexToGraphicUid.delete(H.instanceIndex)};T.graphicLayerToGraphicId=function(){return 0};T.layerOpacityChanged=function(){if(n.isNone(this._resources))return!0;const H=this._drivenProperties.opacity,U=!this.isPrimitive,W=this._resources.stageResources.materials,Q=this._resources.originalMaterialParameters;for(let aa=
0;aa<W.length;aa++){const ea=W[aa];var X=n.get(this.symbolLayer,"material","color"),ba=Q[aa];X=this._getCombinedOpacity(X,{hasIntrinsicColor:U})*ba.opacity;ba=1>X||H||ba.transparent;ea.setParameters({opacity:X,transparent:ba});this.isPrimitive&&ea.setParameters({cullFace:ba?G.CullFaceOptions.None:G.CullFaceOptions.Back})}return!0};T.layerElevationInfoChanged=function(H,U){return this.updateGraphics3DGraphicElevationInfo(H,U,k.needsElevationUpdates3D)};T.slicePlaneEnabledChanged=function(){if(n.isNone(this._resources))return!0;
this._resources.lodRenderer.slicePlaneEnabled=this._context.slicePlaneEnabled;for(const H of this._resources.stageResources.materials)H.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};T.physicalBasedRenderingChanged=function(){if(n.isNone(this._resources))return!0;const {stageResources:H,isWosr:U}=this._resources;for(const W of H.materials)this.isPrimitive?W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0}):U||W.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,
isSchematic:!1});return!1===this.hasLoadedPBRTextures&&!0===this._context.physicalBasedRenderingEnabled?(this.hasLoadedPBRTextures=!0,!1):!0};T.pixelRatioChanged=function(){return!0};T.applyRendererDiff=function(H,U){if(n.isNone(this._resources))return z.ApplyRendererDiffResult.Recreate_Symbol;const {stageResources:{materials:W},lodRenderer:Q,resourceBoundingBox:X,symbolSize:ba,resourceSize:aa,pivotOffset:ea}=this._resources;for(const ia in H.diff)switch(ia){case "visualVariables":if(F.updateFastSymbolUpdatesState(this._fastUpdates,
U,this._fastVisualVariableConvertOptions(X,ba,aa,ea))){for(const ka of W)ka.setParameters(this._fastUpdates.materialParameters);Q.notifyShaderTransformationChanged()}else return z.ApplyRendererDiffResult.Recreate_Symbol;break;default:return z.ApplyRendererDiffResult.Recreate_Symbol}return z.ApplyRendererDiffResult.Fast_Update};T.computeComplexity=function(){if(n.isNone(this._resources))return V.prototype.computeComplexity.call(this);const H=L.geometriesFromLodLevelResources(this._resources.lodResources.levels[0]).reduce((W,
Q)=>W+Q.indices.get(O.VertexAttribute.POSITION).length,0)/3,U=E.defaultSymbolLayerMemoryComplexity(this.symbol,this.symbolLayer);return{primitivesPerFeature:H,primitivesPerCoordinate:0,drawCallsPerFeature:0,estimated:!1,memory:U}};T._hasLodRenderer=function(){return n.isSome(this._resources)};T._createAs3DShape=function(H,U,W,Q,X){if(!this._hasLodRenderer()||n.isNone(this._resources))return null;H=this.getFastUpdateAttrValues(H);const ba=!this._fastUpdates.enabled&&this._hasPerInstanceColor()?w.mixinColorAndOpacity(W.color,
W.opacity):null;var aa=this._context.clippingExtent;e.projectPointToVector(U,M,this._context.elevationProvider.spatialReference);if(n.isSome(aa)&&!g.containsPoint(aa,M))return null;aa=this._requiresTerrainElevation(Q);const ea=this._computeGlobalTransform(U,Q,I,N);W=this._computeLocalTransform(this._resources,this.symbolLayer,W,J);const ia=this._resources.lodRenderer.instanceData,ka=ia.addInstance();this._instanceIndexToGraphicUid.set(ka,X);ia.setLocalTransform(ka,W,!1);ia.setGlobalTransform(ka,ea);
H&&ia.setFeatureAttribute(ka,H);ba&&ia.setColor(ka,ba);X=new y(this,ka,q.perLodInstanceElevationAligner,Q);aa&&(X.alignedSampledElevation=N.sampledElevation);X.needsElevationUpdates=k.needsElevationUpdates3D(Q.mode);C.extendPointGraphicElevationContext(X,U,this._context.elevationProvider);return X};T._computeGlobalTransform=function(H,U,W,Q){k.evaluateElevationInfoAtPoint(H,this._context.elevationProvider,U,this._context.renderCoordsHelper,Q);M[0]=H.x;M[1]=H.y;M[2]=Q.z;e.computeTranslationToOriginAndRotation(H.spatialReference,
M,W,this._context.renderCoordsHelper.spatialReference);return W};T._computeLocalTransform=function(H,U,W,Q){u.identity(Q);this._applyObjectRotation(W,!1,Q);this._applyObjectRotation(U,!0,Q);this._applyObjectScale(H,W,Q);this._applyAnchor(H,U,Q);return Q};T._applyObjectScale=function(H,U,W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(H=w.computeObjectScale(this._drivenProperties.size&&U.size?U.size:H.symbolSize,H.symbolSize,H.resourceSize,this._context.renderCoordsHelper.unitInMeters),
1===H[0]&&1===H[1]&&1===H[2]||u.scale(W,W,H))};T.prepareSymbolLayerPatch=function(H){if("partial"===H.diff.type){var U=H.diff.diff;this._preparePatchTransform(H,U);this._preparePatchColor(H,U)}};T.updateGeometry=function(H,U){if(n.isNone(this._resources))return!0;const W=U&&C.placePointOnGeometry(U);if(n.isNone(W))return!1;U=this.getGeometryElevationMode(U);if(H.elevationContext.mode!==U)return!1;this._computeGlobalTransform(W,H.elevationContext,I,N);this._requiresTerrainElevation(H.elevationContext)&&
(H.alignedSampledElevation=N.sampledElevation);this._resources.lodRenderer.instanceData.setGlobalTransform(H.instanceIndex,I,!0);C.extendPointGraphicElevationContext(H,W,this._context.elevationProvider);return!0};T._preparePatchTransform=function(H,U){if((U.heading||U.tilt||U.roll||U.width||U.height||U.depth||U.anchor||U.anchorPosition)&&!n.isNone(this._resources)){var W=(ca,Y,da)=>n.unwrapOr(null!=ca&&"complete"===ca.type?ca.newValue:Y,da),Q=W(U.heading,this.symbolLayer.heading,0),X=W(U.tilt,this.symbolLayer.tilt,
0),ba=W(U.roll,this.symbolLayer.roll,0),aa=W(U.width,this.symbolLayer.width,void 0),ea=W(U.height,this.symbolLayer.height,void 0),ia=W(U.depth,this.symbolLayer.depth,void 0),ka=W(U.anchor,this.symbolLayer.anchor,void 0);W=W(U.anchorPosition,this.symbolLayer.anchorPosition,void 0);delete U.heading;delete U.tilt;delete U.roll;delete U.width;delete U.height;delete U.depth;delete U.anchor;delete U.anchorPosition;var la={heading:Q,tilt:X,roll:ba,anchor:ka,anchorPosition:W},Z=this._resources;this.loadStatus===
A.LoadStatus.LOADED&&H.symbolLayerStatePatches.push(()=>{Z.symbolSize=h.fromArray(t.objectSymbolLayerSizeWithResourceSize(Z.resourceSize,{width:aa,height:ea,depth:ia,isPrimitive:this.symbolLayer.isPrimitive}))});H.graphics3DGraphicPatches.push((ca,Y)=>{Y=this._computeLocalTransform(Z,la,Y,J);Z.lodRenderer.instanceData.setLocalTransform(ca.instanceIndex,Y,!0)})}};T._preparePatchColor=function(H,U){if(U.material&&"partial"===U.material.type&&(U=U.material.diff,U.color&&"complete"===U.color.type&&null!=
U.color.newValue&&null!=U.color.oldValue)){var W=U.color.newValue,Q=n.isSome(W)?c.toUnitRGBA(W):d.ONES;delete U.color;var X=this._resources;n.isNone(X)||H.graphics3DGraphicPatches.push(ba=>{this._hasPerInstanceColor()?(X.lodRenderer.instanceData.setColor(ba.instanceIndex,Q),ba=this._setMaterialTransparencyParams({},W)):ba=this._setMaterialTransparencyParams({externalColor:Q},W);for(const aa of X.stageResources.materials)aa.setParameters(ba)})}};T._requiresTerrainElevation=function(H){return"absolute-height"!==
H.mode};T._applyObjectRotation=function(H,U,W){if(!(this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation&&U))return w.computeObjectRotation(H.heading,H.tilt,H.roll,W)};T._computeAnchor=function(H,U,W){const Q=h.create();switch(W.anchor){case "center":m.copy(Q,g.center(H));m.negate(Q,Q);break;case "top":U=g.center(H);m.set(Q,-U[0],-U[1],-H[5]);break;case "bottom":U=g.center(H);m.set(Q,-U[0],-U[1],-H[2]);break;case "relative":U=g.center(H);H=g.size(H);W=(W=W.anchorPosition)?h.fromValues(W.x,
W.y,W.z):h.ZEROS;m.multiply(Q,H,W);m.add(Q,Q,U);m.negate(Q,Q);break;default:n.isSome(U)?m.negate(Q,U):m.copy(Q,h.ZEROS)}return Q};T._applyAnchor=function(H,U,W){this._fastUpdates.enabled&&this._fastUpdates.requiresShaderTransformation||(H=this._computeAnchor(H.resourceBoundingBox,H.pivotOffset,U))&&u.translate(W,W,H)};T._hasPerInstanceColor=function(){return this._drivenProperties.color||this._drivenProperties.opacity};T._fastVisualVariableConvertOptions=function(H,U,W,Q){const X=n.isSome(H)?h.fromArray(g.size(H)):
h.ONES;H=n.isSome(H)?this._computeAnchor(H,Q,this.symbolLayer):h.ZEROS;Q=this._context.renderCoordsHelper.unitInMeters;W=w.computeObjectScale(n.isSome(U)?U:void 0,U,W,Q);const ba=h.fromValues(this.symbolLayer.tilt||0,this.symbolLayer.roll||0,this.symbolLayer.heading||0);return{modelSize:X,symbolSize:n.isSome(U)?U:h.ONES,unitInMeters:Q,transformation:{anchor:H,scale:W,rotation:ba}}};b._createClass(S,[{key:"extentPadding",get:function(){return n.isSome(this._resources)?this._resources.extentPadding:
0}},{key:"isPrimitive",get:function(){return!(this.symbolLayer.resource&&this.symbolLayer.resource.href)}},{key:"lodRenderer",get:function(){return n.get(this._resources,"lodRenderer")}}]);return S}(f.Graphics3DSymbolLayer);const M=h.create(),J=v.create(),I=v.create(),P=d.create(),N=new k.SampleElevationInfo;a.Graphics3DObjectSymbolLayer=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DLodInstanceGraphicLayer":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ./featureExpressionInfoUtils ./graphicUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3DStateID".split(" "),
function(a,b,c,n,l,u,v,m,h,d){let e=function(){function r(f,w,z,A){this.graphics3DSymbolLayer=f;this.instanceIndex=w;this.elevationAligner=z;this.elevationContext=A;this.type="lod-instance";this._highlights=new Set;this.alignedSampledElevation=0;this.needsElevationUpdates=this.isElevationSource=!1}var y=r.prototype;y.initialize=function(){};y.setVisibility=function(f){const w=this.lodRenderer.instanceData;f!==w.getVisible(this.instanceIndex)&&w.setVisible(this.instanceIndex,f)};y.destroy=function(){null!=
this.instanceIndex&&(this.lodRenderer.instanceData.removeInstance(this.instanceIndex),this.graphics3DSymbolLayer.notifyDestroyGraphicLayer(this))};y.alignWithElevation=function(f,w,z){this.elevationAligner&&(v.setContextFeature(this.elevationContext.featureExpressionInfoContext,z),f=this.elevationAligner(this,this.elevationContext,f,w),b.isSome(f)&&(this.alignedSampledElevation=f))};y.getCenterObjectSpace=function(f=l.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,
k);return n.transformMat4(f,this.lodRenderer.baseBoundingSphere.center,k)};y.getBoundingBoxObjectSpace=function(f=u.create()){this.lodRenderer.instanceData.getCombinedLocalTransform(this.instanceIndex,k);const w=this.lodRenderer.baseBoundingBox;u.empty(f);for(let z=0;8>z;++z)n.set(p,0===(z&1)?w[0]:w[3],0===(z&2)?w[1]:w[4],0===(z&4)?w[2]:w[5]),n.transformMat4(p,p,k),u.expandWithVec3(f,p);return f};y.computeAttachmentOrigin=function(f){this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,
k);f.render.origin[0]+=k[12];f.render.origin[1]+=k[13];f.render.origin[2]+=k[14];f.render.num++};y.getProjectedBoundingBox=function(){var f=a._asyncToGenerator(function*(w,z,A,x,B){B=this.getBoundingBoxObjectSpace(B);var C=q;const D=u.isPoint(B)?1:C.length;this.lodRenderer.instanceData.getGlobalTransform(this.instanceIndex,k);for(var E=0;E<D;E++){const F=C[E];p[0]=B[F[0]];p[1]=B[F[1]];p[2]=B[F[2]];n.transformMat4(p,p,k);g[3*E]=p[0];g[3*E+1]=p[1];g[3*E+2]=p[2]}if(!w(g,0,D))return null;u.empty(B);w=
null;this.calculateRelativeScreenBounds&&(w=this.calculateRelativeScreenBounds());for(C=0;C<3*D;C+=3){for(E=0;3>E;E++)B[E]=Math.min(B[E],g[C+E]),B[E+3]=Math.max(B[E+3],g[C+E]);w&&A.push({location:g.slice(C,C+3),screenSpaceBoundingRect:w})}if(z&&(u.center(B,t),"absolute-height"!==this.elevationContext.mode)){let F;A=m.demResolutionForBoundingBox(B,z);try{F=yield z.service.queryElevation(t[0],t[1],x,A,"ground")}catch(G){}b.isSome(F)&&u.offset(B,0,0,-this.alignedSampledElevation+F)}return B});return function(w,
z,A,x,B){return f.apply(this,arguments)}}();y.addObjectState=function(f,w){f===h.Object3DState.Highlight&&(f=new d.Object3DStateID(f),this._addHighlightId(f),w.addExternal(z=>{this._removeHighlightId(z)},f))};y.removeObjectState=function(f){this._highlights.forEach(w=>f.remove(w))};y._addHighlightId=function(f){this._highlights.add(f);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,!0)};y._removeHighlightId=function(f){this._highlights.delete(f);this.lodRenderer.instanceData.setHighlight(this.instanceIndex,
0<this._highlights.size)};a._createClass(r,[{key:"lodRenderer",get:function(){return this.graphics3DSymbolLayer.lodRenderer}}]);return r}();const g=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],p=l.create(),t=l.create(),q=[[0,1,2],[3,1,2],[0,4,2],[3,4,2],[0,1,5],[3,1,5],[0,4,5],[3,4,5]],k=c.create();return e})},"esri/views/3d/layers/graphics/lodResourceUtils":function(){define(["exports","../../webgl-engine/lib/lodRendering/LodResources"],function(a,b){function c(l){const u=[];l.stageResources.geometries.forEach((v,
m)=>{u.push({material:l.stageResources.materials[m],geometry:v,textures:l.stageResources.textures})});return{components:u,minScreenSpaceRadius:l.lodThreshold,pivotOffset:l.pivotOffset}}function n(l,u=.05){l=b.computeFaceCount(l);return Math.sqrt(l/(u*Math.PI))}a.estimateMinScreenSpaceRadius=n;a.fillEstimatedMinScreenSpaceRadius=function(l){l.levels.forEach(u=>{u.minScreenSpaceRadius||(u.minScreenSpaceRadius=n(u))})};a.makeLodLevelResources=c;a.makeLodResources=function(l){return{levels:l.map(u=>c(u))}};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/objectResourceUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/devEnvironmentUtils ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../../../chunks/vec32 ../../../../chunks/vec42 ../../../../geometry/support/buffer/utils ../../glTF/DefaultLoadingContext ../../glTF/loader ../../glTF/internal/indexUtils ./wosrLoader ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/DefaultMaterial_COLOR_GAMMA ../../../webgl/enums ../../../../chunks/vec22 ../../../../chunks/vec43 ../../../../chunks/vec33".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G){function O(){O=b._asyncToGenerator(function*(R,M){var J=K(c.adjustStaticAGOUrl(R));if("wosr"===J.fileType)return R=yield M.cache?M.cache.loadWOSR(J.url,M):f.load(J.url,M),J=f.processLoadResult(R,M),{lods:[J],referenceBoundingBox:J.boundingBox,isEsriSymbolResource:!1,isWosr:!0,remove:R.remove};R=yield M.cache?M.cache.loadGLTF(J.url,M,M.usePBR):r.load(new k.DefaultLoadingContext(M.streamDataRequester),J.url,M,M.usePBR);var I=n.get(R.model.meta,
"ESRI_proxyEllipsoid");if(R.meta.isEsriSymbolResource&&n.isSome(I)&&R.meta.uri.includes("/RealisticTrees/"))a:for(var P=0;P<R.model.lods.length;++P){var N=R.model.lods[P];R.customMeta.esriTreeRendering=!0;for(var V of N.parts){N=V.attributes.normal;if(n.isNone(N))break a;const T=V.attributes.position,H=T.count,U=d.create(),W=d.create(),Q=d.create(),X=q.createBuffer(g.BufferViewVec4u8,H),ba=q.createBuffer(g.BufferViewVec3f,H),aa=v.invert(m.create(),V.transform);for(let ea=0;ea<H;ea++){T.getVec(ea,
W);N.getVec(ea,U);h.transformMat4(W,W,V.transform);h.subtract(Q,W,I.center);h.divide(Q,Q,I.radius);const ia=Q[2];var S=h.length(Q);S=Math.min(.45+.55*S*S,1);h.divide(Q,Q,I.radius);h.transformMat4(Q,Q,aa);h.normalize(Q,Q);P+1!==R.model.lods.length&&1<R.model.lods.length&&(-1<ia?h.lerp(Q,Q,U,.2):h.lerp(Q,Q,U,Math.min(-4*ia-3.8,1)));ba.setVec(ea,Q);X.set(ea,0,255*S);X.set(ea,1,255*S);X.set(ea,2,255*S);X.set(ea,3,255)}V.attributes.normal=ba;V.attributes.color=X}}V=R.meta.isEsriSymbolResource?{usePBR:M.usePBR,
isSchematic:!1,treeRendering:!!R.customMeta.esriTreeRendering,mrrFactors:[0,1,.2]}:{usePBR:M.usePBR,isSchematic:!1,treeRendering:!1,mrrFactors:[0,1,.5]};M={...M.materialParamsMixin,treeRendering:!!R.customMeta.esriTreeRendering};if(null!=J.specifiedLodIndex)return I=L(R,V,M,J.specifiedLodIndex),P=I[0].boundingBox,0!==J.specifiedLodIndex&&(P=L(R,V,M,0)[0].boundingBox),{lods:I,referenceBoundingBox:P,isEsriSymbolResource:R.meta.isEsriSymbolResource,isWosr:!1,remove:R.remove};J=L(R,V,M);return{lods:J,
referenceBoundingBox:J[0].boundingBox,isEsriSymbolResource:R.meta.isEsriSymbolResource,isWosr:!1,remove:R.remove}});return O.apply(this,arguments)}function K(R){const M=R.match(/(.*\.(gltf|glb))(\?lod=([0-9]+))?$/);return M?{fileType:"gltf",url:M[1],specifiedLodIndex:null!=M[4]?Number(M[4]):null}:R.match(/(.*\.(json|json\.gz))$/)?{fileType:"wosr",url:R,specifiedLodIndex:null}:{fileType:"unknown",url:R,specifiedLodIndex:null}}function L(R,M,J,I){const P=R.model,N=u.create(),V=[],S=new Map,T=new Map;
P.lods.forEach((H,U)=>{if(void 0===I||U===I){var W={name:H.name,stageResources:{textures:[],materials:[],geometries:[]},lodThreshold:n.isSome(H.lodThreshold)?H.lodThreshold:null,pivotOffset:[0,0,0],numberOfVertices:0,boundingBox:e.empty()};V.push(W);H.parts.forEach(Q=>{var X=Q.material+(Q.attributes.normal?"_normal":"")+(Q.attributes.color?"_color":"")+(Q.attributes.texCoord0?"_texCoord0":"")+(Q.attributes.tangent?"_tangent":"");const ba=P.materials.get(Q.material),aa=n.isSome(Q.attributes.texCoord0);
var ea=n.isSome(Q.attributes.normal);a:{switch(ba.alphaMode){case "BLEND":var ia=w.AlphaDiscardMode.Blend;break a;case "MASK":ia=w.AlphaDiscardMode.Mask;break a;case "OPAQUE":case null:case void 0:ia=w.AlphaDiscardMode.Opaque;break a}ia=void 0}if(!S.has(X)){if(aa){if(n.isSome(ba.textureColor)&&!T.has(ba.textureColor)){var ka=P.textures.get(ba.textureColor);T.set(ba.textureColor,new A.Texture(ka.data,{...ka.parameters,preMultiplyAlpha:ia!==w.AlphaDiscardMode.Opaque}))}n.isSome(ba.textureNormal)&&!T.has(ba.textureNormal)&&
(ka=P.textures.get(ba.textureNormal),T.set(ba.textureNormal,new A.Texture(ka.data,ka.parameters)));n.isSome(ba.textureOcclusion)&&!T.has(ba.textureOcclusion)&&(ka=P.textures.get(ba.textureOcclusion),T.set(ba.textureOcclusion,new A.Texture(ka.data,ka.parameters)));n.isSome(ba.textureEmissive)&&!T.has(ba.textureEmissive)&&(ka=P.textures.get(ba.textureEmissive),T.set(ba.textureEmissive,new A.Texture(ka.data,ka.parameters)));n.isSome(ba.textureMetallicRoughness)&&!T.has(ba.textureMetallicRoughness)&&
(ka=P.textures.get(ba.textureMetallicRoughness),T.set(ba.textureMetallicRoughness,new A.Texture(ka.data,ka.parameters)))}ka=ba.color[0]**(1/C.COLOR_GAMMA);var la=ba.color[1]**(1/C.COLOR_GAMMA),Z=ba.color[2]**(1/C.COLOR_GAMMA),ca=ba.emissiveFactor[0]**(1/C.COLOR_GAMMA);const Y=ba.emissiveFactor[1]**(1/C.COLOR_GAMMA),da=ba.emissiveFactor[2]**(1/C.COLOR_GAMMA),ha=n.isSome(ba.textureColor)&&aa?T.get(ba.textureColor):null;S.set(X,new B.DefaultMaterial({...M,transparent:ia===w.AlphaDiscardMode.Blend,customDepthTest:w.DepthTestFunction.Lequal,
textureAlphaMode:ia,textureAlphaCutoff:ba.alphaCutoff,diffuse:[ka,la,Z],ambient:[ka,la,Z],opacity:ba.opacity,doubleSided:ba.doubleSided,doubleSidedType:"winding-order",cullFace:ba.doubleSided?w.CullFaceOptions.None:w.CullFaceOptions.Back,hasVertexColors:!!Q.attributes.color,hasVertexTangents:!!Q.attributes.tangent,normals:ea?"default":"screenDerivative",castShadows:!0,receiveSSAO:!0,textureId:n.isSome(ha)?ha.id:void 0,colorMixMode:ba.colorMixMode,normalTextureId:n.isSome(ba.textureNormal)&&aa?T.get(ba.textureNormal).id:
void 0,textureAlphaPremultiplied:n.isSome(ha)&&!!ha.params.preMultiplyAlpha,occlusionTextureId:n.isSome(ba.textureOcclusion)&&aa?T.get(ba.textureOcclusion).id:void 0,emissiveTextureId:n.isSome(ba.textureEmissive)&&aa?T.get(ba.textureEmissive).id:void 0,metallicRoughnessTextureId:n.isSome(ba.textureMetallicRoughness)&&aa?T.get(ba.textureMetallicRoughness).id:void 0,emissiveFactor:[ca,Y,da],mrrFactors:[ba.metallicFactor,ba.roughnessFactor,M.mrrFactors[2]],isSchematic:!1,...J}))}a:{ea=Q.indices||Q.attributes.position.count;
switch(Q.primitiveType){case D.PrimitiveType.TRIANGLES:ea=y.trianglesToTriangles(ea);break a;case D.PrimitiveType.TRIANGLE_STRIP:ea=y.triangleStripToTriangles(ea);break a;case D.PrimitiveType.TRIANGLE_FAN:ea=y.triangleFanToTriangles(ea);break a}ea=void 0}ia=ea;ea=Q.attributes.position.count;ka=q.createBuffer(g.BufferViewVec3f,ea);p.transformMat4(ka,Q.attributes.position,Q.transform);ka=[[x.VertexAttribute.POSITION,{data:ka.typedBuffer,size:ka.elementCount,exclusive:!0}]];la=[[x.VertexAttribute.POSITION,
ia]];n.isSome(Q.attributes.normal)&&(Z=q.createBuffer(g.BufferViewVec3f,ea),l.normalFromMat4(N,Q.transform),p.transformMat3(Z,Q.attributes.normal,N),ka.push([x.VertexAttribute.NORMAL,{data:Z.typedBuffer,size:Z.elementCount,exclusive:!0}]),la.push([x.VertexAttribute.NORMAL,ia]));n.isSome(Q.attributes.tangent)&&(Z=q.createBuffer(g.BufferViewVec4f,ea),l.normalFromMat4(N,Q.transform),t.transformMat3(Z,Q.attributes.tangent,N),ka.push([x.VertexAttribute.TANGENT,{data:Z.typedBuffer,size:Z.elementCount,exclusive:!0}]),
la.push([x.VertexAttribute.TANGENT,ia]));n.isSome(Q.attributes.texCoord0)&&(Z=q.createBuffer(g.BufferViewVec2f,ea),E.normalizeIntegerBuffer(Z,Q.attributes.texCoord0),ka.push([x.VertexAttribute.UV0,{data:Z.typedBuffer,size:Z.elementCount,exclusive:!0}]),la.push([x.VertexAttribute.UV0,ia]));n.isSome(Q.attributes.color)&&(Z=q.createBuffer(g.BufferViewVec4u8,ea),4===Q.attributes.color.elementCount?Q.attributes.color instanceof g.BufferViewVec4f?t.scale(Z,Q.attributes.color,255):Q.attributes.color instanceof
g.BufferViewVec4u8?F.copy(Z,Q.attributes.color):Q.attributes.color instanceof g.BufferViewVec4u16&&t.scale(Z,Q.attributes.color,1/256):(F.fill(Z,255,255,255,255),ca=new g.BufferViewVec3u8(Z.buffer,0,4),Q.attributes.color instanceof g.BufferViewVec3f?p.scale(ca,Q.attributes.color,255):Q.attributes.color instanceof g.BufferViewVec3u8?G.copy(ca,Q.attributes.color):Q.attributes.color instanceof g.BufferViewVec3u16&&p.scale(ca,Q.attributes.color,1/256)),ka.push([x.VertexAttribute.COLOR,{data:Z.typedBuffer,
size:Z.elementCount,exclusive:!0}]),la.push([x.VertexAttribute.COLOR,ia]));Q=new z.Geometry(ka,la);W.stageResources.geometries.push(Q);W.stageResources.materials.push(S.get(X));aa&&(n.isSome(ba.textureColor)&&W.stageResources.textures.push(T.get(ba.textureColor)),n.isSome(ba.textureNormal)&&W.stageResources.textures.push(T.get(ba.textureNormal)),n.isSome(ba.textureOcclusion)&&W.stageResources.textures.push(T.get(ba.textureOcclusion)),n.isSome(ba.textureEmissive)&&W.stageResources.textures.push(T.get(ba.textureEmissive)),
n.isSome(ba.textureMetallicRoughness)&&W.stageResources.textures.push(T.get(ba.textureMetallicRoughness)));W.numberOfVertices+=ea;X=Q.boundingInfo;n.isSome(X)&&(e.expandWithVec3(W.boundingBox,X.getBBMin()),e.expandWithVec3(W.boundingBox,X.getBBMax()))})}});return V}a.fetch=function(R,M){return O.apply(this,arguments)};a.gltfToEngineResources=L;a.parseUrl=K;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/devEnvironmentUtils":function(){define(["exports"],
function(a){const b=/^devext.arcgis.com$/,c=/^qaext.arcgis.com$/,n=/^[\w-]*\.mapsdevext.arcgis.com$/,l=/^[\w-]*\.mapsqa.arcgis.com$/,u=[/^([\w-]*\.)?[\w-]*\.zrh-dev-local.esri.com$/,b,c,/^jsapps.esri.com$/,n,l];a.adjustStaticAGOUrl=function(v,m){return v?(m=m||globalThis.location.hostname)?null!=m.match(b)||null!=m.match(n)?v.replace("static.arcgis.com","staticdev.arcgis.com"):null!=m.match(c)||null!=m.match(l)?v.replace("static.arcgis.com","staticqa.arcgis.com"):v:v:v};a.isDevEnvironment=function(v){v=
v||globalThis.location.hostname;return u.some(m=>{var h;return null!=(null==(h=v)?void 0:h.match(m))})};a.isTelemetryDevEnvironment=function(v){v=v||globalThis.location.hostname;return[/^zrh-.+?\.esri\.com$/].concat(u).some(m=>{var h;return null!=(null==(h=v)?void 0:h.match(m))})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/vec42":function(){define(["exports","../geometry/support/buffer/math/common"],function(a,b){function c(h,d,e){if(h.count!==
d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var g=h.count,p=e[0],t=e[1],q=e[2],k=e[3],r=e[4],y=e[5],f=e[6],w=e[7],z=e[8],A=e[9],x=e[10],B=e[11],C=e[12],D=e[13],E=e[14];e=e[15];var F=h.typedBuffer;h=h.typedBufferStride;var G=d.typedBuffer;d=d.typedBufferStride;for(let K=0;K<g;K++){const L=K*h;var O=K*d;const R=G[O],M=G[O+1],J=G[O+2];O=G[O+3];F[L]=p*R+r*M+z*J+C*O;F[L+1]=t*R+y*M+A*J+D*O;F[L+2]=q*R+f*M+x*J+E*O;F[L+3]=k*R+w*M+B*J+e*O}}}function n(h,
d,e){if(h.count!==d.count)b.mathLogger.error("source and destination buffers need to have the same number of elements");else{var g=h.count,p=e[0],t=e[1],q=e[2],k=e[3],r=e[4],y=e[5],f=e[6],w=e[7];e=e[8];var z=h.typedBuffer;h=h.typedBufferStride;var A=d.typedBuffer;d=d.typedBufferStride;for(let B=0;B<g;B++){const C=B*h;var x=B*d;const D=A[x],E=A[x+1],F=A[x+2];x=A[x+3];z[C]=p*D+k*E+f*F;z[C+1]=t*D+r*E+w*F;z[C+2]=q*D+y*E+e*F;z[C+3]=x}}}function l(h,d){const e=Math.min(h.count,d.count),g=h.typedBuffer;
h=h.typedBufferStride;const p=d.typedBuffer;d=d.typedBufferStride;for(let k=0;k<e;k++){const r=k*h;var t=k*d;const y=p[t],f=p[t+1];t=p[t+2];var q=y*y+f*f+t*t;0<q&&(q=1/Math.sqrt(q),g[r]=q*y,g[r+1]=q*f,g[r+2]=q*t)}}function u(h,d,e){const g=Math.min(h.count,d.count),p=h.typedBuffer;h=h.typedBufferStride;const t=d.typedBuffer;d=d.typedBufferStride;for(let q=0;q<g;q++){const k=q*h,r=q*d;p[k]=e*t[r];p[k+1]=e*t[r+1];p[k+2]=e*t[r+2];p[k+3]=e*t[r+3]}}function v(h,d,e){const g=Math.min(h.count,d.count),p=
h.typedBuffer;h=h.typedBufferStride;const t=d.typedBuffer;d=d.typedBufferStride;for(let q=0;q<g;q++){const k=q*h,r=q*d;p[k]=t[r]>>e;p[k+1]=t[r+1]>>e;p[k+2]=t[r+2]>>e;p[k+3]=t[r+3]>>e}}const m=Object.freeze(Object.defineProperty({__proto__:null,transformMat4:c,transformMat3:n,normalize:l,scale:u,shiftRight:v},Symbol.toStringTag,{value:"Module"}));a.normalize=l;a.scale=u;a.shiftRight=v;a.transformMat3=n;a.transformMat4=c;a.vec4=m})},"esri/geometry/support/buffer/utils":function(){define("exports ./types ../../../chunks/mat32 ../../../chunks/mat42 ../../../chunks/scalar ../../../chunks/vec22 ../../../chunks/vec33 ../../../chunks/vec43".split(" "),
function(a,b,c,n,l,u,v,m){a.mat3=c.mat3;a.mat4=n.mat4;a.scalar=l.scalar;a.vec2=u.vec2;a.vec3=v.vec3;a.vec4=m.vec4;a.createBuffer=function(h,d){return new h(new ArrayBuffer(d*h.ElementCount*b.elementTypeSize(h.ElementType)))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat32":function(){define(["exports"],function(a){function b(n,l,u){const v=n.typedBuffer;n=n.typedBufferStride;const m=l.typedBuffer,h=l.typedBufferStride;l=u?u.count:l.count;
let d=(u&&u.dstIndex?u.dstIndex:0)*n;u=(u&&u.srcIndex?u.srcIndex:0)*h;for(let e=0;e<l;++e){for(let g=0;9>g;++g)v[d+g]=m[u+g];d+=n;u+=h}}const c=Object.freeze(Object.defineProperty({__proto__:null,copy:b},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.mat3=c})},"esri/chunks/mat42":function(){define(["exports"],function(a){function b(n,l,u){const v=n.typedBuffer;n=n.typedBufferStride;const m=l.typedBuffer,h=l.typedBufferStride;l=u?u.count:l.count;let d=(u&&u.dstIndex?u.dstIndex:0)*n;u=(u&&u.srcIndex?
u.srcIndex:0)*h;for(let e=0;e<l;++e){for(let g=0;16>g;++g)v[d+g]=m[u+g];d+=n;u+=h}}const c=Object.freeze(Object.defineProperty({__proto__:null,copy:b},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.mat4=c})},"esri/chunks/scalar":function(){define(["exports"],function(a){function b(l,u,v){const m=l.typedBuffer;l=l.typedBufferStride;const h=u.typedBuffer,d=u.typedBufferStride;u=v?v.count:u.count;let e=(v&&v.dstIndex?v.dstIndex:0)*l;v=(v&&v.srcIndex?v.srcIndex:0)*d;for(let g=0;g<u;++g)m[e]=h[v],e+=
l,v+=d}function c(l,u){const v=l.count;u||(u=new l.TypedArrayConstructor(v));for(let m=0;m<v;m++)u[m]=l.get(m);return u}const n=Object.freeze(Object.defineProperty({__proto__:null,copy:b,makeDense:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.makeDense=c;a.scalar=n})},"esri/chunks/vec22":function(){define(["exports","../geometry/support/buffer/types"],function(a,b){function c(v,m,h){const d=v.typedBuffer;v=v.typedBufferStride;const e=m.typedBuffer,g=m.typedBufferStride;m=h?h.count:m.count;let p=
(h&&h.dstIndex?h.dstIndex:0)*v;h=(h&&h.srcIndex?h.srcIndex:0)*g;for(let t=0;t<m;++t)d[p]=e[h],d[p+1]=e[h+1],p+=v,h+=g}function n(v,m,h){const d=v.typedBuffer,e=v.typedBufferStride,g=m.typedBuffer,p=m.typedBufferStride,t=h?h.count:m.count;let q=(h&&h.dstIndex?h.dstIndex:0)*e,k=(h&&h.srcIndex?h.srcIndex:0)*p;if(b.isInteger(m.elementType))if(h=b.maximumValue(m.elementType),b.isSigned(m.elementType))for(m=0;m<t;++m)d[q]=Math.max(g[k]/h,-1),d[q+1]=Math.max(g[k+1]/h,-1),q+=e,k+=p;else for(m=0;m<t;++m)d[q]=
g[k]/h,d[q+1]=g[k+1]/h,q+=e,k+=p;else c(v,m,h);return v}function l(v,m,h,d){var e,g;const p=v.typedBuffer,t=v.typedBufferStride;v=null!=(e=null==d?void 0:d.count)?e:v.count;d=(null!=(g=null==d?void 0:d.dstIndex)?g:0)*t;for(g=0;g<v;++g)p[d]=m,p[d+1]=h,d+=t}const u=Object.freeze(Object.defineProperty({__proto__:null,copy:c,normalizeIntegerBuffer:n,fill:l},Symbol.toStringTag,{value:"Module"}));a.copy=c;a.fill=l;a.normalizeIntegerBuffer=n;a.vec2=u})},"esri/chunks/vec33":function(){define(["exports"],
function(a){function b(l,u,v){const m=l.typedBuffer;l=l.typedBufferStride;const h=u.typedBuffer,d=u.typedBufferStride;u=v?v.count:u.count;let e=(v&&v.dstIndex?v.dstIndex:0)*l;v=(v&&v.srcIndex?v.srcIndex:0)*d;for(let g=0;g<u;++g)m[e]=h[v],m[e+1]=h[v+1],m[e+2]=h[v+2],e+=l,v+=d}function c(l,u,v,m,h){var d,e;const g=l.typedBuffer,p=l.typedBufferStride;l=null!=(d=null==h?void 0:h.count)?d:l.count;h=(null!=(e=null==h?void 0:h.dstIndex)?e:0)*p;for(e=0;e<l;++e)g[h]=u,g[h+1]=v,g[h+2]=m,h+=p}const n=Object.freeze(Object.defineProperty({__proto__:null,
copy:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.fill=c;a.vec3=n})},"esri/chunks/vec43":function(){define(["exports"],function(a){function b(l,u,v){const m=l.typedBuffer;l=l.typedBufferStride;const h=u.typedBuffer,d=u.typedBufferStride;u=v?v.count:u.count;let e=(v&&v.dstIndex?v.dstIndex:0)*l;v=(v&&v.srcIndex?v.srcIndex:0)*d;for(let g=0;g<u;++g)m[e]=h[v],m[e+1]=h[v+1],m[e+2]=h[v+2],m[e+3]=h[v+3],e+=l,v+=d}function c(l,u,v,m,h,d){var e,g;const p=l.typedBuffer,t=l.typedBufferStride;l=
null!=(e=null==d?void 0:d.count)?e:l.count;d=(null!=(g=null==d?void 0:d.dstIndex)?g:0)*t;for(g=0;g<l;++g)p[d]=u,p[d+1]=v,p[d+2]=m,p[d+3]=h,d+=t}const n=Object.freeze(Object.defineProperty({__proto__:null,copy:b,fill:c},Symbol.toStringTag,{value:"Module"}));a.copy=b;a.fill=c;a.vec4=n})},"esri/views/3d/glTF/DefaultLoadingContext":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../request ../../../core/asyncUtils ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils".split(" "),
function(a,b,c,n,l,u,v,m){let h=function(){function e(p){this.streamDataRequester=p}var g=e.prototype;g.loadJSON=function(){var p=b._asyncToGenerator(function*(t,q){return this._load("json",t,q)});return function(t,q){return p.apply(this,arguments)}}();g.loadBinary=function(){var p=b._asyncToGenerator(function*(t,q){return m.isDataProtocol(t)?(v.throwIfAborted(q),m.dataToArrayBuffer(t)):this._load("binary",t,q)});return function(t,q){return p.apply(this,arguments)}}();g.loadImage=function(){var p=
b._asyncToGenerator(function*(t,q){return this._load("image",t,q)});return function(t,q){return p.apply(this,arguments)}}();g._load=function(){var p=b._asyncToGenerator(function*(t,q,k){if(u.isNone(this.streamDataRequester))return(yield c(q,{responseType:d[t]})).data;t=yield n.result(this.streamDataRequester.request(q,t,k));if(!0===t.ok)return t.value;v.throwIfAbortError(t.error);throw new l("",`Request for resource failed: ${t.error}`);});return function(t,q,k){return p.apply(this,arguments)}}();
return e}();const d={image:"image",binary:"array-buffer",json:"json"};a.DefaultLoadingContext=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/loader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/mat4f64 ./DefaultErrorContext ./LoaderResult ./internal/Resource ../../webgl/enums".split(" "),function(a,b,c,n,l,u,v,m){function h(){h=b._asyncToGenerator(function*(y,f,w={},z=!0){const A=
yield v.Resource.load(y,q,f,w),x=`gltf_${t++}`,B={lods:[],materials:new Map,textures:new Map,meta:d(A)};y=!(!A.json.asset.extras||"symbolResource"!==A.json.asset.extras.ESRI_type);const C=new Map;yield e(A,function(){var D=b._asyncToGenerator(function*(E,F,G,O){var K;const L=null!=(K=C.get(G))?K:0;C.set(G,L+1);var R=void 0!==E.mode?E.mode:m.PrimitiveType.TRIANGLES;K=R===m.PrimitiveType.TRIANGLES||R===m.PrimitiveType.TRIANGLE_STRIP||R===m.PrimitiveType.TRIANGLE_FAN?R:null;if(c.isNone(K))q.warnUnsupported("Unsupported primitive mode ("+
r[R]+"). Skipping primitive.");else if(A.hasPositions(E)){R=A.getPositionData(E,w);var M=A.getMaterial(E,w,z),J=A.hasNormals(E)?A.getNormalData(E,w):null,I=A.hasTangents(E)?A.getTangentData(E,w):null,P=A.hasTextureCoordinates(E)?A.getTextureCoordinates(E,w):null,N=A.hasVertexColors(E)?A.getVertexColors(E,w):null;E=A.getIndexData(E,w);F={transform:n.clone(F),attributes:{position:yield R,normal:J?yield J:null,texCoord0:P?yield P:null,color:N?yield N:null,tangent:I?yield I:null},indices:yield E,primitiveType:K,
material:p(B,yield M,x)};E=null;c.isSome(B.meta)&&c.isSome(B.meta.ESRI_lod)&&"screenSpaceRadius"===B.meta.ESRI_lod.metric&&(E=B.meta.ESRI_lod.thresholds[G]);B.lods[G]=B.lods[G]||{parts:[],name:O,lodThreshold:E};B.lods[G].parts[L]=F}else q.warn("Skipping primitive without POSITION vertex attribute.")});return function(E,F,G,O){return D.apply(this,arguments)}}());for(const D of B.lods)D.parts=D.parts.filter(E=>!!E);return{model:B,meta:{isEsriSymbolResource:y,uri:A.uri},customMeta:{}}});return h.apply(this,
arguments)}function d(y){let f=null;y.json.nodes.forEach(w=>{w=w.extras;c.isSome(w)&&(w.ESRI_proxyEllipsoid||w.ESRI_lod)&&(f=w)});return f}function e(y,f){return g.apply(this,arguments)}function g(){g=b._asyncToGenerator(function*(y,f){function w(D,E){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(D,E){const F=A.nodes[D];D=y.getNodeTransform(D);q.warnUnsupportedIf(null!=F.weights,"Morph targets are not supported.");if(null!=F.mesh){const G=A.meshes[F.mesh];for(const O of G.primitives)C.push(f(O,
D,E,G.name))}for(const G of F.children||[])C.push(w(G,E))});return z.apply(this,arguments)}const A=y.json;var x=A.scenes[A.scene||0].nodes;const B=1<x.length,C=[];for(const D of x)x=A.nodes[D],C.push(w(D,0)),x.extensions&&x.extensions.MSFT_lod&&Array.isArray(x.extensions.MSFT_lod.ids)&&!B&&x.extensions.MSFT_lod.ids.forEach((E,F)=>w(E,F+1));yield Promise.all(C)});return g.apply(this,arguments)}function p(y,f,w){const z=x=>{const B=`${w}_tex_${x&&x.id}${x&&x.name?"_"+x.name:""}`;x&&!y.textures.has(B)&&
(x=u.makeTextureSource(x.data,{wrap:{s:x.wrapS,t:x.wrapT},mipmap:k.includes(x.minFilter),noUnpackFlip:!0}),y.textures.set(B,x));return B},A=`${w}_mat_${f.id}_${f.name}`;y.materials.has(A)||(f=u.makeMaterialParameters({color:[f.color[0],f.color[1],f.color[2]],opacity:f.color[3],alphaMode:f.alphaMode,alphaCutoff:f.alphaCutoff,doubleSided:f.doubleSided,colorMixMode:f.ESRI_externalColorMixMode,textureColor:f.colorTexture?z(f.colorTexture):void 0,textureNormal:f.normalTexture?z(f.normalTexture):void 0,
textureOcclusion:f.occlusionTexture?z(f.occlusionTexture):void 0,textureEmissive:f.emissiveTexture?z(f.emissiveTexture):void 0,textureMetallicRoughness:f.metallicRoughnessTexture?z(f.metallicRoughnessTexture):void 0,emissiveFactor:[f.emissiveFactor[0],f.emissiveFactor[1],f.emissiveFactor[2]],metallicFactor:f.metallicFactor,roughnessFactor:f.roughnessFactor}),y.materials.set(A,f));return A}let t=0;const q=new l.DefaultErrorContext,k=[m.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,m.TextureSamplingMode.LINEAR_MIPMAP_NEAREST],
r="POINTS LINES LINE_LOOP LINE_STRIP TRIANGLES TRIANGLE_STRIP TRIANGLE_FAN".split(" ");a.load=function(y,f){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/DefaultErrorContext":function(){define(["exports","../../../core/Error","../../../core/Logger"],function(a,b,c){const n=c.getLogger("esri.views.3d.glTF");c=function(){function l(){}var u=l.prototype;u.error=function(v){throw new b("gltf-loader-error",
v);};u.errorUnsupported=function(v){throw new b("gltf-loader-unsupported-feature",v);};u.errorUnsupportedIf=function(v,m){v&&this.errorUnsupported(m)};u.assert=function(v,m){v||this.error(m)};u.warn=function(v){n.warn(v)};u.warnUnsupported=function(v){this.warn("[Unsupported Feature] "+v)};u.warnUnsupportedIf=function(v,m){v&&this.warnUnsupported(m)};return l}();a.DefaultErrorContext=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/LoaderResult":function(){define(["exports",
"../../webgl/enums"],function(a,b){a.makeMaterialParameters=function(c={}){return{color:[1,1,1],opacity:1,alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1,castShadows:!0,receiveShadows:!0,receiveAmbientOcclustion:!0,textureColor:null,textureNormal:null,textureOcclusion:null,textureEmissive:null,textureMetallicRoughness:null,emissiveFactor:[0,0,0],metallicFactor:1,roughnessFactor:1,colorMixMode:"multiply",...c}};a.makeTextureSource=function(c,n={}){return{data:c,parameters:{wrap:{s:b.TextureWrapMode.REPEAT,
t:b.TextureWrapMode.REPEAT,...n.wrap},noUnpackFlip:!0,mipmap:!1,...n}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/Resource":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/compilerUtils ../../../../core/MapUtils ../../../../core/urlUtils ../../../../core/Version ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf64 ../../../../geometry/support/buffer/BufferView ../../../../chunks/scalar ./BinaryStreamReader ./enums ./fillDefaults ./pathUtils ../../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){function y(O){switch(O.componentType){case r.DataType.BYTE:return new e.BufferViewVec2i8(O.raw,O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*O.entryCount);case r.DataType.UNSIGNED_BYTE:return new e.BufferViewVec2u8(O.raw,O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*O.entryCount);case r.DataType.SHORT:return new e.BufferViewVec2i16(O.raw,O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*O.entryCount);case r.DataType.UNSIGNED_SHORT:return new e.BufferViewVec2u16(O.raw,
O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*O.entryCount);case r.DataType.UNSIGNED_INT:return new e.BufferViewVec2u32(O.raw,O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*O.entryCount);case r.DataType.FLOAT:return new e.BufferViewVec2f(O.raw,O.byteOffset,O.byteStride,O.byteOffset+O.byteStride*O.entryCount);default:c.neverReached(O.componentType)}}function f(O){return w.apply(this,arguments)}function w(){w=b._asyncToGenerator(function*(O){return new Promise((K,L)=>{const R=new Blob([O]),
M=new FileReader;M.onload=()=>{K(JSON.parse(M.result))};M.onerror=J=>{L(J)};M.readAsText(R)})});return w.apply(this,arguments)}function z(O,K){return A.apply(this,arguments)}function A(){A=b._asyncToGenerator(function*(O,K){return new Promise((L,R)=>{const M=new Blob([O],{type:K}),J=URL.createObjectURL(M),I=new Image;I.addEventListener("load",()=>{URL.revokeObjectURL(J);"decode"in I?I.decode().then(()=>L(I),()=>L(I)):L(I)});I.addEventListener("error",P=>{URL.revokeObjectURL(J);R(P)});I.src=J})});
return A.apply(this,arguments)}let x=function(){function O(L,R,M,J,I){this.context=L;this.errorContext=R;this.uri=M;this.json=J;this.glbBuffer=I;this.bufferLoaders=new Map;this.textureLoaders=new Map;this.textureCache=new Map;this.materialCache=new Map;this.nodeParentMap=new Map;this.nodeTransformCache=new Map;this.baseUri=k.splitURI(this.uri).dirPart;this._checkVersionSupported();this._checkRequiredExtensionsSupported();R.errorUnsupportedIf(null==J.scenes,"Scenes must be defined.");R.errorUnsupportedIf(null==
J.meshes,"Meshes must be defined");R.errorUnsupportedIf(null==J.nodes,"Nodes must be defined.");this._computeNodeParents()}O.load=function(){var L=b._asyncToGenerator(function*(R,M,J,I){if(l.isDataProtocol(J)){var P=l.dataComponents(J);if("model/gltf-binary"!==P.mediaType)try{const N=JSON.parse(P.isBase64?atob(P.data):P.data);return new O(R,M,J,N)}catch{}P=l.dataToArrayBuffer(J);if(O._isGLBData(P))return this._fromGLBData(R,M,J,P)}if(J.endsWith(".gltf"))return I=yield R.loadJSON(J,I),new O(R,M,J,
I);P=yield R.loadBinary(J,I);if(O._isGLBData(P))return this._fromGLBData(R,M,J,P);I=yield R.loadJSON(J,I);return new O(R,M,J,I)});return function(R,M,J,I){return L.apply(this,arguments)}}();O._isGLBData=function(L){L=new p.BinaryStreamReader(L);return 4<=L.remainingBytes()&&1179937895===L.readUint32()};O._fromGLBData=function(){var L=b._asyncToGenerator(function*(R,M,J,I){I=yield O._parseGLBData(M,I);return new O(R,M,J,I.json,I.binaryData)});return function(R,M,J,I){return L.apply(this,arguments)}}();
O._parseGLBData=function(){var L=b._asyncToGenerator(function*(R,M){const J=new p.BinaryStreamReader(M);R.assert(12<=J.remainingBytes(),"GLB binary data is insufficiently large.");var I=J.readUint32(),P=J.readUint32();const N=J.readUint32();R.assert(1179937895===I,"Magic first 4 bytes do not fit to expected GLB value.");R.assert(M.byteLength>=N,"GLB binary data is smaller than header specifies.");R.errorUnsupportedIf(2!==P,"An unsupported GLB container version was detected. Only version 2 is supported.");
M=0;let V,S;for(;8<=J.remainingBytes();)I=J.readUint32(),P=J.readUint32(),0===M?(R.assert(1313821514===P,"First GLB chunk must be JSON."),R.assert(0<=I,"No JSON data found."),V=yield f(J.readUint8Array(I))):1===M?(R.errorUnsupportedIf(5130562!==P,"Second GLB chunk expected to be BIN."),S=J.readUint8Array(I)):R.warnUnsupported("More than 2 GLB chunks detected. Skipping."),M+=1;V||R.error("No GLB JSON chunk detected.");return{json:V,binaryData:S}});return function(R,M){return L.apply(this,arguments)}}();
var K=O.prototype;K.getBuffer=function(){var L=b._asyncToGenerator(function*(R,M){const J=this.json.buffers[R],I=this.errorContext;if(null==J.uri)return I.assert(null!=this.glbBuffer,"GLB buffer not present"),this.glbBuffer;R=yield this._getBufferLoader(R,M);I.assert(R.byteLength===J.byteLength,"Buffer byte lengths should match.");return R});return function(R,M){return L.apply(this,arguments)}}();K._getBufferLoader=function(){var L=b._asyncToGenerator(function*(R,M){const J=this.bufferLoaders.get(R);
if(J)return J;M=this.context.loadBinary(this._resolveUri(this.json.buffers[R].uri),M).then(I=>new Uint8Array(I));this.bufferLoaders.set(R,M);return M});return function(R,M){return L.apply(this,arguments)}}();K.getAccessor=function(){var L=b._asyncToGenerator(function*(R,M){var J=this.errorContext;J.errorUnsupportedIf(!this.json.accessors,"Accessors missing.");R=this.json.accessors[R];J.errorUnsupportedIf(null==(null==R?void 0:R.bufferView),"Some accessor does not specify a bufferView.");J.errorUnsupportedIf(R.type in
[t.AttributeType.MAT2,t.AttributeType.MAT3,t.AttributeType.MAT4],`AttributeType ${R.type} is not supported`);J=this.json.bufferViews[R.bufferView];M=yield this.getBuffer(J.buffer,M);const I=E[R.type],P=F[R.componentType],N=I*P,V=J.byteStride||N;return{raw:M.buffer,byteStride:V,byteOffset:M.byteOffset+(J.byteOffset||0)+(R.byteOffset||0),entryCount:R.count,isDenselyPacked:V===N,componentCount:I,componentByteSize:P,componentType:R.componentType,min:R.min,max:R.max,normalized:!!R.normalized}});return function(R,
M){return L.apply(this,arguments)}}();K.getIndexData=function(){var L=b._asyncToGenerator(function*(R,M){if(null==R.indices)return null;R=yield this.getAccessor(R.indices,M);if(R.isDenselyPacked)switch(R.componentType){case r.DataType.UNSIGNED_BYTE:return new Uint8Array(R.raw,R.byteOffset,R.entryCount);case r.DataType.UNSIGNED_SHORT:return new Uint16Array(R.raw,R.byteOffset,R.entryCount);case r.DataType.UNSIGNED_INT:return new Uint32Array(R.raw,R.byteOffset,R.entryCount)}else switch(R.componentType){case r.DataType.UNSIGNED_BYTE:return g.makeDense(this._wrapAccessor(e.BufferViewUint8,
R));case r.DataType.UNSIGNED_SHORT:return g.makeDense(this._wrapAccessor(e.BufferViewUint16,R));case r.DataType.UNSIGNED_INT:return g.makeDense(this._wrapAccessor(e.BufferViewUint32,R))}});return function(R,M){return L.apply(this,arguments)}}();K.getPositionData=function(){var L=b._asyncToGenerator(function*(R,M){const J=this.errorContext;J.errorUnsupportedIf(null==R.attributes.POSITION,"No POSITION vertex data found.");R=yield this.getAccessor(R.attributes.POSITION,M);J.errorUnsupportedIf(R.componentType!==
r.DataType.FLOAT,"Expected type FLOAT for POSITION vertex attribute, but found "+G[R.componentType]);J.errorUnsupportedIf(3!==R.componentCount,"POSITION vertex attribute must have 3 components, but found "+R.componentCount.toFixed());return this._wrapAccessor(e.BufferViewVec3f,R)});return function(R,M){return L.apply(this,arguments)}}();K.getNormalData=function(){var L=b._asyncToGenerator(function*(R,M){const J=this.errorContext;J.assert(null!=R.attributes.NORMAL,"No NORMAL vertex data found.");R=
yield this.getAccessor(R.attributes.NORMAL,M);J.errorUnsupportedIf(R.componentType!==r.DataType.FLOAT,"Expected type FLOAT for NORMAL vertex attribute, but found "+G[R.componentType]);J.errorUnsupportedIf(3!==R.componentCount,"NORMAL vertex attribute must have 3 components, but found "+R.componentCount.toFixed());return this._wrapAccessor(e.BufferViewVec3f,R)});return function(R,M){return L.apply(this,arguments)}}();K.getTangentData=function(){var L=b._asyncToGenerator(function*(R,M){const J=this.errorContext;
J.assert(null!=R.attributes.TANGENT,"No TANGENT vertex data found.");R=yield this.getAccessor(R.attributes.TANGENT,M);J.errorUnsupportedIf(R.componentType!==r.DataType.FLOAT,"Expected type FLOAT for TANGENT vertex attribute, but found "+G[R.componentType]);J.errorUnsupportedIf(4!==R.componentCount,"TANGENT vertex attribute must have 4 components, but found "+R.componentCount.toFixed());return new e.BufferViewVec4f(R.raw,R.byteOffset,R.byteStride,R.byteOffset+R.byteStride*R.entryCount)});return function(R,
M){return L.apply(this,arguments)}}();K.getTextureCoordinates=function(){var L=b._asyncToGenerator(function*(R,M){const J=this.errorContext;J.assert(null!=R.attributes.TEXCOORD_0,"No TEXCOORD_0 vertex data found.");R=yield this.getAccessor(R.attributes.TEXCOORD_0,M);J.errorUnsupportedIf(2!==R.componentCount,"TEXCOORD_0 vertex attribute must have 2 components, but found "+R.componentCount.toFixed());if(R.componentType===r.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec2f,R);J.errorUnsupportedIf(!R.normalized,
"Integer component types are only supported for a normalized accessor for TEXCOORD_0.");return y(R)});return function(R,M){return L.apply(this,arguments)}}();K.getVertexColors=function(){var L=b._asyncToGenerator(function*(R,M){const J=this.errorContext;J.assert(null!=R.attributes.COLOR_0,"No COLOR_0 vertex data found.");R=yield this.getAccessor(R.attributes.COLOR_0,M);J.errorUnsupportedIf(4!==R.componentCount&&3!==R.componentCount,"COLOR_0 attribute must have 3 or 4 components, but found "+R.componentCount.toFixed());
if(4===R.componentCount){if(R.componentType===r.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec4f,R);if(R.componentType===r.DataType.UNSIGNED_BYTE)return this._wrapAccessor(e.BufferViewVec4u8,R);if(R.componentType===r.DataType.UNSIGNED_SHORT)return this._wrapAccessor(e.BufferViewVec4u16,R)}else if(3===R.componentCount){if(R.componentType===r.DataType.FLOAT)return this._wrapAccessor(e.BufferViewVec3f,R);if(R.componentType===r.DataType.UNSIGNED_BYTE)return this._wrapAccessor(e.BufferViewVec3u8,
R);if(R.componentType===r.DataType.UNSIGNED_SHORT)return this._wrapAccessor(e.BufferViewVec3u16,R)}J.errorUnsupported("Unsupported component type for COLOR_0 attribute: "+G[R.componentType])});return function(R,M){return L.apply(this,arguments)}}();K.hasPositions=function(L){return void 0!==L.attributes.POSITION};K.hasNormals=function(L){return void 0!==L.attributes.NORMAL};K.hasVertexColors=function(L){return void 0!==L.attributes.COLOR_0};K.hasTextureCoordinates=function(L){return void 0!==L.attributes.TEXCOORD_0};
K.hasTangents=function(L){return void 0!==L.attributes.TANGENT};K.getMaterial=function(){var L=b._asyncToGenerator(function*(R,M,J){var I=this.materialCache.get(R.material);if(!I){I=null!=R.material?q.material(this.json.materials[R.material]):q.material();const P=I.pbrMetallicRoughness,N=this.hasVertexColors(R),V=this.getTexture(P.baseColorTexture,M),S=this.getTexture(I.normalTexture,M),T=J?this.getTexture(I.occlusionTexture,M):null,H=J?this.getTexture(I.emissiveTexture,M):null;M=J?this.getTexture(P.metallicRoughnessTexture,
M):null;R=null!=R.material?R.material:-1;I={alphaMode:I.alphaMode,alphaCutoff:I.alphaCutoff,color:P.baseColorFactor,doubleSided:!!I.doubleSided,colorTexture:yield V,normalTexture:yield S,name:I.name,id:R,occlusionTexture:yield T,emissiveTexture:yield H,emissiveFactor:I.emissiveFactor,metallicFactor:P.metallicFactor,roughnessFactor:P.roughnessFactor,metallicRoughnessTexture:yield M,hasVertexColors:N,ESRI_externalColorMixMode:I.extras.ESRI_externalColorMixMode}}return I});return function(R,M,J){return L.apply(this,
arguments)}}();K.getTexture=function(){var L=b._asyncToGenerator(function*(R,M){if(!R)return null;this.errorContext.errorUnsupportedIf(0!==(R.texCoord||0),"Only TEXCOORD with index 0 is supported.");const J=R.index,I=this.errorContext;R=this.json.textures[J];const P=q.textureSampler(null!=R.sampler?this.json.samplers[R.sampler]:{});I.errorUnsupportedIf(null==R.source,"Source is expected to be defined for a texture.");const N=this.json.images[R.source],V=yield this._loadTextureImageData(J,R,M);return n.getOrCreateMapValue(this.textureCache,
J,()=>{const S=H=>33071===H||33648===H||10497===H,T=H=>{I.error(`Unexpected TextureSampler WrapMode: ${H}. Using default REPEAT(10497).`);return 10497};return{data:V,wrapS:S(P.wrapS)?P.wrapS:T(P.wrapS),wrapT:S(P.wrapT)?P.wrapT:T(P.wrapT),minFilter:P.minFilter,name:N.name,id:J}})});return function(R,M){return L.apply(this,arguments)}}();K.getNodeTransform=function(L){if(void 0===L)return C;var R=this.nodeTransformCache.get(L);if(!R){R=this.getNodeTransform(this._getNodeParent(L));const M=this.json.nodes[L];
if(M.matrix)R=v.multiply(m.create(),R,M.matrix);else if(M.translation||M.rotation||M.scale)R=m.clone(R),M.translation&&v.translate(R,R,M.translation),M.rotation&&(D[3]=h.getAxisAngle(D,M.rotation),v.rotate(R,R,D[3],D)),M.scale&&v.scale(R,R,M.scale);this.nodeTransformCache.set(L,R)}return R};K._wrapAccessor=function(L,R){return new L(R.raw,R.byteOffset,R.byteStride,R.byteOffset+R.byteStride*(R.entryCount-1)+R.componentByteSize*R.componentCount)};K._resolveUri=function(L){return l.makeAbsolute(L,this.baseUri)};
K._getNodeParent=function(L){return this.nodeParentMap.get(L)};K._checkVersionSupported=function(){const L=u.Version.parse(this.json.asset.version,"glTF");B.validate(L)};K._checkRequiredExtensionsSupported=function(){const L=this.json,R=this.errorContext;L.extensionsRequired&&0!==L.extensionsRequired.length&&R.errorUnsupported("gltf loader was not able to load unsupported feature. Required extensions: "+L.extensionsRequired.join(", "))};K._computeNodeParents=function(){this.json.nodes.forEach((L,
R)=>{L.children&&L.children.forEach(M=>{this.nodeParentMap.set(M,R)})})};K._loadTextureImageData=function(){var L=b._asyncToGenerator(function*(R,M,J){const I=this.textureLoaders.get(R);if(I)return I;M=this._createTextureLoader(M,J);this.textureLoaders.set(R,M);return M});return function(R,M,J){return L.apply(this,arguments)}}();K._createTextureLoader=function(){var L=b._asyncToGenerator(function*(R,M){R=this.json.images[R.source];if(R.uri)return this.context.loadImage(this._resolveUri(R.uri),M);
const J=this.errorContext;J.errorUnsupportedIf(null==R.bufferView,"Image bufferView must be defined.");J.errorUnsupportedIf(null==R.mimeType,"Image mimeType must be defined.");const I=this.json.bufferViews[R.bufferView];M=yield this.getBuffer(I.buffer,M);J.errorUnsupportedIf(null!=I.byteStride,"byteStride not supported for image buffer");return z(new Uint8Array(M.buffer,M.byteOffset+(I.byteOffset||0),I.byteLength),R.mimeType)});return function(R,M){return L.apply(this,arguments)}}();return O}();const B=
new u.Version(2,0,"glTF"),C=v.fromXRotation(m.create(),Math.PI/2),D=d.create(),E={SCALAR:1,VEC2:2,VEC3:3,VEC4:4},F={[r.DataType.BYTE]:1,[r.DataType.UNSIGNED_BYTE]:1,[r.DataType.SHORT]:2,[r.DataType.UNSIGNED_SHORT]:2,[r.DataType.FLOAT]:4,[r.DataType.UNSIGNED_INT]:4},G={5120:"BYTE",5121:"UNSIGNED_BYTE",5122:"SHORT",5123:"UNSIGNED_SHORT",5125:"UNSIGNED_INT",5126:"FLOAT"};a.Resource=x;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/BinaryStreamReader":function(){define(["exports"],
function(a){let b=function(){function c(l){this.data=l;this.offset4=0;this.dataUint32=new Uint32Array(this.data,0,Math.floor(this.data.byteLength/4))}var n=c.prototype;n.readUint32=function(){const l=this.offset4;this.offset4+=1;return this.dataUint32[l]};n.readUint8Array=function(l){const u=4*this.offset4;this.offset4+=l/4;return new Uint8Array(this.data,u,l)};n.remainingBytes=function(){return this.data.byteLength-4*this.offset4};return c}();a.BinaryStreamReader=b;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/enums":function(){define(["exports"],function(a){a.AttributeType=void 0;(function(b){b.SCALAR="SCALAR";b.VEC2="VEC2";b.VEC3="VEC3";b.VEC4="VEC4";b.MAT2="MAT2";b.MAT3="MAT3";b.MAT4="MAT4"})(a.AttributeType||(a.AttributeType={}));a.BufferViewTarget=void 0;(function(b){b[b.ARRAY_BUFFER=34962]="ARRAY_BUFFER";b[b.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER"})(a.BufferViewTarget||(a.BufferViewTarget={}));Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/fillDefaults":function(){define(["exports","../../../../core/compilerUtils","../../../webgl/enums"],function(a,b,c){const n={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1},l={pbrMetallicRoughness:n,emissiveFactor:[0,0,0],alphaMode:"OPAQUE",alphaCutoff:.5,doubleSided:!1},u={ESRI_externalColorMixMode:"tint"},v={magFilter:c.TextureSamplingMode.LINEAR,minFilter:c.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,
wrapS:c.TextureWrapMode.REPEAT,wrapT:c.TextureWrapMode.REPEAT};a.material=(m={})=>{const h={...n,...m.pbrMetallicRoughness};var d={...u,...m.extras};switch(d.ESRI_externalColorMixMode){case "multiply":case "tint":case "ignore":case "replace":break;default:b.neverReached(d.ESRI_externalColorMixMode),d.ESRI_externalColorMixMode="tint"}return{...l,...m,pbrMetallicRoughness:h,extras:d}};a.textureSampler=m=>({...v,...m});Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/glTF/internal/pathUtils":function(){define(["exports"],function(a){a.splitURI=function(b){let c,n;b.replace(/^(.*\/)?([^/]*)$/,(l,u,v)=>{c=u||"";n=v||"";return""});return{dirPart:c,filePart:n}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/glTF/internal/indexUtils":function(){define(["exports","../../../../core/typedArrayUtil","../../webgl-engine/lib/geometryDataUtils"],function(a,b,c){a.triangleFanToTriangles=function(n){var l=
"number"===typeof n?n:n.length;if(3>l)return new Uint16Array(0);l-=2;const u=65536>=l?new Uint16Array(3*l):new Uint32Array(3*l);if("number"===typeof n){n=0;for(var v=0;v<l;++v)u[n++]=0,u[n++]=v+1,u[n++]=v+2;return u}{v=n[0];let m=n[1],h=0;for(let d=0;d<l;++d){const e=n[d+2];u[h++]=v;u[h++]=m;m=u[h++]=e}return u}};a.triangleStripToTriangles=function(n){var l="number"===typeof n?n:n.length;if(3>l)return new Uint16Array(0);l-=2;const u=65536>=l?new Uint16Array(3*l):new Uint32Array(3*l);if("number"===
typeof n){n=0;for(var v=0;v<l;v+=1)0===v%2?(u[n++]=v,u[n++]=v+1):(u[n++]=v+1,u[n++]=v),u[n++]=v+2}else{v=0;for(let e=0;e<l;e+=1)if(0===e%2){var m=n[e],h=n[e+1],d=n[e+2];u[v++]=m;u[v++]=h;u[v++]=d}else m=n[e+1],h=n[e],d=n[e+2],u[v++]=m,u[v++]=h,u[v++]=d}return u};a.trianglesToTriangles=function(n,l=c.generateDefaultIndexArray){return"number"===typeof n?l(n):b.isUint16Array(n)||b.isUint8Array(n)?new Uint32Array(n):n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/graphics/wosrLoader":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/asyncUtils ../../../../core/Error ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/Version ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../support/requestImageUtils ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Geometry ../../webgl-engine/lib/Texture ../../webgl-engine/materials/DefaultMaterial ../../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){function y(){y=b._asyncToGenerator(function*(O,K){O=yield f(O,K);K=yield C(O.textureDefinitions,K);return{resource:O,textures:K}});return y.apply(this,arguments)}function f(O,K){return w.apply(this,arguments)}function w(){w=b._asyncToGenerator(function*(O,K){const L=v.isSome(K)&&K.streamDataRequester;if(L)return z(O,L,K);O=yield n.result(c(O,v.unwrap(K)));if(!0===O.ok)return O.value.data;m.throwIfAbortError(O.error);x(O.error)});return w.apply(this,arguments)}
function z(O,K,L){return A.apply(this,arguments)}function A(){A=b._asyncToGenerator(function*(O,K,L){O=yield n.result(K.request(O,"json",L));if(!0===O.ok)return O.value;m.throwIfAbortError(O.error);x(O.error.details.url)});return A.apply(this,arguments)}function x(O){throw new l("",`Request for object resource failed: ${O}`);}function B(O){const K=e.empty();O.forEach(L=>{L=L.boundingInfo;v.isSome(L)&&(e.expandWithVec3(K,L.getBBMin()),e.expandWithVec3(K,L.getBBMax()))});return K}function C(O,K){return D.apply(this,
arguments)}function D(){D=b._asyncToGenerator(function*(O,K){const L=[];for(const J in O){var R=O[J],M=R.images[0].data;if(!M){F.warn("Externally referenced texture data is not yet supported");continue}M=R.encoding+";base64,"+M;const I="/textureDefinitions/"+J,P="rgba"===R.channels?R.alphaChannelUsage||"transparency":"none",N={noUnpackFlip:!0,wrap:{s:r.TextureWrapMode.REPEAT,t:r.TextureWrapMode.REPEAT},preMultiplyAlpha:E(P)!==p.AlphaDiscardMode.Opaque};R=v.isSome(K)&&K.disableTextures?Promise.resolve(null):
g.requestImage(M,K);L.push(R.then(V=>({refId:I,image:V,params:N,alphaChannelUsage:P})))}O=yield Promise.all(L);K={};for(const J of O)K[J.refId]=J;return K});return D.apply(this,arguments)}function E(O){switch(O){case "mask":return p.AlphaDiscardMode.Mask;case "maskAndTransparency":return p.AlphaDiscardMode.MaskBlend;case "none":return p.AlphaDiscardMode.Opaque;case "transparency":return p.AlphaDiscardMode.Blend;default:return p.AlphaDiscardMode.Blend}}const F=u.getLogger("esri.views.3d.layers.graphics.objectResourceUtils"),
G=new h.Version(1,2,"wosr");a.createTextureResources=C;a.load=function(O,K){return y.apply(this,arguments)};a.processLoadResult=function(O,K){const L=[],R=[],M=[],J=[],I=O.resource;var P=h.Version.parse(I.version||"1.0","wosr");G.validate(P);P=I.model.name;const N=I.model.geometries,V=I.materialDefinitions;O=O.textures;let S=0;const T=new Map;for(let ea=0;ea<N.length;ea++){var H=N[ea],U=H,W=U.params,Q=W.topology;var X=!0;W.vertexAttributes||(F.warn("Geometry must specify vertex attributes"),X=!1);
switch(W.topology){case "PerAttributeArray":break;case "Indexed":case null:case void 0:Q=W.faces;if(!Q)F.warn("Indexed geometries must specify faces"),X=!1;else if(W.vertexAttributes)for(const ia in W.vertexAttributes)(W=Q[ia])&&W.values?(null!=W.valueType&&"UInt32"!==W.valueType&&(F.warn(`Unsupported indexed geometry indices type '${W.valueType}', only UInt32 is currently supported`),X=!1),null!=W.valuesPerElement&&1!==W.valuesPerElement&&(F.warn(`Unsupported indexed geometry values per element '${W.valuesPerElement}', only 1 is currently supported`),
X=!1)):(F.warn(`Indexed geometry does not specify face indices for '${ia}' attribute`),X=!1);break;default:F.warn(`Unsupported topology '${Q}'`),X=!1}U.params.material||(F.warn("Geometry requires material"),X=!1);U=U.params.vertexAttributes;for(const ia in U)U[ia].values||(F.warn("Geometries with externally defined attributes are not yet supported"),X=!1);if(X){X=H.params;X={id:1,material:X.material,texture:X.texture,region:X.texture};W=H.params.vertexAttributes;U=[];for(const ia in W)Q=W[ia],U.push([ia,
{data:Q.values,size:Q.valuesPerElement,exclusive:!0}]);W=[];if("PerAttributeArray"!==H.params.topology){H=H.params.faces;for(const ia in H)W.push([ia,new Uint32Array(H[ia].values)])}if((H=O&&O[X.texture])&&!T.has(X.texture)){const {image:ia,params:ka}=H;Q=new q.Texture(ia,ka);J.push(Q);T.set(X.texture,Q)}Q=(Q=T.get(X.texture))?Q.id:void 0;var ba=M[X.material]?M[X.material][X.texture]:null;if(!ba){ba=X.material.substring(X.material.lastIndexOf("/")+1);ba=V[ba].params;1===ba.transparency&&(ba.transparency=
0);var aa=H&&H.alphaChannelUsage;aa=0<ba.transparency||"transparency"===aa||"maskAndTransparency"===aa;const ia=H?E(H.alphaChannelUsage):void 0;H={ambient:d.fromArray(ba.diffuse),diffuse:d.fromArray(ba.diffuse),opacity:1-(ba.transparency||0),transparent:aa,textureAlphaMode:ia,textureAlphaCutoff:.33,textureId:Q,initTextureTransparent:!0,doubleSided:!0,cullFace:p.CullFaceOptions.None,colorMixMode:ba.externalColorMixMode||"tint",textureAlphaPremultiplied:H?!!H.params.preMultiplyAlpha:!1};v.isSome(K)&&
K.materialParamsMixin&&Object.assign(H,K.materialParamsMixin);ba=new k.DefaultMaterial(H);M[X.material]||(M[X.material]={});M[X.material][X.texture]=ba}R.push(ba);X=new t.Geometry(U,W);S+=W.position?W.position.length:0;L.push(X)}}return{name:P,stageResources:{textures:J,materials:R,geometries:L},pivotOffset:I.model.pivotOffset,boundingBox:B(L),numberOfVertices:S,lodThreshold:null}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/DefaultMaterial_COLOR_GAMMA":function(){define(["exports"],
function(a){a.COLOR_GAMMA=2.1;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f64 ../../../support/debugFlags ../../../support/buffer/glUtil ../Camera ../DefaultVertexAttributeLocations ../IntersectorInterfaces ../Octree ../RenderPass ../RenderSlot ../Util ./InstanceData ./InstanceOctree ./LevelSelector ./LodLevel ./RenderInstanceData ../../materials/DefaultMaterial ../../materials/internal/MaterialUtil ../../materials/renderers/utils ../../shaders/DefaultMaterialTechnique ../../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E){function F(N,V,S){const T=N.allocateHead();N=N.view;C.encodeDoubleVec3(V.modelOrigin,S,N.modelOriginHi,N.modelOriginLo,T);N.model.copyFrom(T,V.model,S);N.modelNormal.copyFrom(T,V.modelNormal,S);V.color&&N.color&&N.color.copyFrom(T,V.color,S);V.featureAttribute&&N.featureAttribute&&N.featureAttribute.copyFrom(T,V.featureAttribute,S)}let G=N=>{const V=N.baseBoundingSphere.radius;N=N.levels.map(S=>S.minScreenSpaceRadius);return new w.LevelSelector(V,
N)},O=function(){function N(S,T,H,U){this.type=p.IntersectorType.LOD;this.isGround=!1;this._levels=[];this._defaultRenderInstanceData=[];this._highlightRenderInstanceData=[];this._instanceIndex=0;this._slicePlane=!1;this._enableLevelSelection=!0;this._lastCamera=new e.Camera;this._updateCyclesWithStaticCamera=-1;this._needFullCycle=!1;this.slots=[k.RenderSlot.OPAQUE_MATERIAL,k.RenderSlot.TRANSPARENT_MATERIAL];this.canRender=!0;this._symbol=S;this._optionalFields=T;this._metadata=H;this._instanceBufferLayout=
x.getInstanceBufferLayout({instancedDoublePrecision:!0,instanced:T});this._glInstanceBufferLayout=d.glLayout(this._instanceBufferLayout,1);this._instanceData=new y.InstanceData(this._optionalFields,U);this._instanceData.on("instance-added",()=>this._requestUpdateCycle());this._instanceData.on("instance-removed",()=>this._requestUpdateCycle());this._instanceData.on("instance-transform-changed",W=>{this._requestUpdateCycle();this._metadata.notifyGraphicGeometryChanged(W.index)});this._instanceData.on("instance-visibility-changed",
W=>{this._requestUpdateCycle(!0);this._metadata.notifyGraphicVisibilityChanged(W.index)});this._instanceData.on("instance-highlight-changed",()=>this._requestUpdateCycle(!0));this._enableLevelSelection=1<this._symbol.levels.length}var V=N.prototype;V.initializeRenderContext=function(){var S=b._asyncToGenerator(function*(T,H){this._context=T;const U=T.renderContext.rctx,W=yield Promise.allSettled(this._symbol.levels.map(X=>{this._defaultRenderInstanceData.push(new A.RenderInstanceData(U,this._instanceBufferLayout));
this._highlightRenderInstanceData.push(new A.RenderInstanceData(U,this._instanceBufferLayout));return z.LodLevel.create(T,X,H)})),Q=W.map(X=>"fulfilled"===X.status?X.value:null).filter(X=>X);if(n.isAborted(H)||Q.length!==W.length){Q.forEach(X=>X.destroy());n.throwIfAborted(H);for(const X of W)if("rejected"===X.status)throw X.reason;}this._levels=Q;this._levelSelector=G(this)});return function(T,H){return S.apply(this,arguments)}}();V.uninitializeRenderContext=function(){this._invalidateOctree();this._levels.forEach(S=>
S.destroy());this._defaultRenderInstanceData.forEach(S=>S.destroy());this._highlightRenderInstanceData.forEach(S=>S.destroy())};V.prepareRender=function(S){if(!h.LOD_INSTANCE_RENDERER_DISABLE_UPDATES){if(this._enableLevelSelection){var T=S.bindParameters.contentCamera.equals(this._lastCamera);this._lastCamera.copyFrom(S.bindParameters.contentCamera);T||this._requestUpdateCycle()}T=this._needFullCycle?this._instanceData.size:2E3;this._needFullCycle=!1;this._updateInstances(S.bindParameters.contentCamera,
T);this.needsUpdates&&this._context.requestRender()}};V.render=function(S){if(this.baseMaterial.isVisible()&&this.baseMaterial.isVisibleInPass(S.pass)){S.rctx.bindVAO();var T=S.pass!==q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT;S.pass!==q.RenderPass.MATERIAL_HIGHLIGHT&&S.pass!==q.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT&&this._renderComponents(S,this._defaultRenderInstanceData);T&&this._renderComponents(S,this._highlightRenderInstanceData)}};V.intersect=function(S,T,H,U){if(this.baseMaterial.isVisible()){var W=
v.create();u.subtract(W,U,H);var Q=X=>{this._instanceData.getCombinedModelTransform(X,R);S.transform.set(R);u.transformMat4(M,H,S.transform.inverse);u.transformMat4(J,U,S.transform.inverse);const ba=this._instanceData.getState(X),aa=this._instanceData.getLodLevel(X),ea=this._levels.length;r.assert(ba&y.StateFlags.ACTIVE,"invalid instance state");r.assert(0<=aa&&aa<ea,"invaid lod level");this._levels[aa].intersect(S,T,M,J,X,this._metadata,ea)};this.baseMaterial.parameters.verticalOffset?this.octree.forEach(Q):
this.octree.forEachAlongRay(H,W,Q)}};V.queryDepthRange=function(S){return this._queryDepthRangeOctree(S)};V.notifyShaderTransformationChanged=function(){this._invalidateOctree()};V._requestUpdateCycle=function(S=!1){this._updateCyclesWithStaticCamera=-1;S&&(this._needFullCycle=!0);this.needsUpdates&&this._context.requestRender()};V._invalidateOctree=function(){this._octree&&(this._octree.destroy(),this._octree=null)};V._buildOctree=function(){const S=new f.InstanceOctree(this._instanceData,this.baseBoundingSphere);
var T=this._instanceData;T=T.view?T.view.state:null;for(let H=0;H<this._instanceData.capacity;++H)T.get(H)&y.StateFlags.ACTIVE&&S.addInstance(H);return S};V._queryDepthRangeOctree=function(S){var T=S.eye;const H=S.viewForward;var U=this.octree.findClosest(H,t.DepthOrder.FRONT_TO_BACK,S.frustum);const W=this.octree.findClosest(H,t.DepthOrder.BACK_TO_FRONT,S.frustum);return null!=U&&null!=W?(this._instanceData.view.boundingSphere.getVec(U,L),u.subtract(L,L,T),U=u.dot(L,H)-L[3],this._instanceData.view.boundingSphere.getVec(W,
L),u.subtract(L,L,T),T=u.dot(L,H)+L[3],{near:Math.max(S.near,U),far:Math.min(S.far,T)}):{near:Infinity,far:-Infinity}};V._startUpdateCycle=function(){this._updateCyclesWithStaticCamera++;this._defaultRenderInstanceData.forEach(S=>{S.startUpdateCylce()});this._highlightRenderInstanceData.forEach(S=>{S.startUpdateCylce()});this.needsUpdates&&this._context.requestRender()};V._updateInstances=function(S,T){const H=this._enableLevelSelection,U=this._levelSelector;U.updateCamera(S);this._defaultRenderInstanceData.forEach(ea=>
{ea.beginUpdate()});this._highlightRenderInstanceData.forEach(ea=>{ea.beginUpdate()});S=this._instanceData;const W=this._instanceData.view,Q=S.capacity;let X=this._instanceIndex;T=Math.min(S.size,T);for(let ea=0;ea<T;++ea){0===X&&this._startUpdateCycle();const ia=W.state.get(X);var ba=0;if(ia&y.StateFlags.ALLOCATED){var aa=W.lodLevel.get(X);ia&y.StateFlags.DEFAULT_ACTIVE&&this._defaultRenderInstanceData[aa].freeTail();ia&y.StateFlags.HIGHLIGHT_ACTIVE&&this._highlightRenderInstanceData[aa].freeTail();
ia&y.StateFlags.REMOVE?S.freeInstance(X):ia&y.StateFlags.VISIBLE?(aa=0,H&&(W.modelOrigin.getVec(X,K),aa=U.selectLevel(K,S.getCombinedMedianScaleFactor(X))),ba=ia&~(y.StateFlags.ACTIVE|y.StateFlags.TRANSFORM_CHANGED),0<=aa&&(ia&y.StateFlags.HIGHLIGHT?(F(this._highlightRenderInstanceData[aa],W,X),ba|=y.StateFlags.HIGHLIGHT_ACTIVE):(F(this._defaultRenderInstanceData[aa],W,X),ba|=y.StateFlags.DEFAULT_ACTIVE)),W.state.set(X,ba),W.lodLevel.set(X,aa)):(ba=ia&~(y.StateFlags.ACTIVE|y.StateFlags.TRANSFORM_CHANGED),
W.state.set(X,ba));this._octree&&(aa=!!(ia&y.StateFlags.ACTIVE),ba=!!(ba&y.StateFlags.ACTIVE),!aa&&ba?this._octree.addInstance(X):aa&&!ba?this._octree.removeInstance(X):aa&&ba&&ia&y.StateFlags.TRANSFORM_CHANGED&&(this._octree.removeInstance(X),this._octree.addInstance(X)));X=(X+1)%Q}else X=(X+1)%Q,T++}this._instanceIndex=X;this._defaultRenderInstanceData.forEach(ea=>{ea.endUpdate()});this._highlightRenderInstanceData.forEach(ea=>{ea.endUpdate()})};V._renderComponents=function(S,T){this.levels.forEach((H,
U)=>{H.components.forEach(W=>{this._renderComponent(S,T[U],W,U)})})};V._renderComponent=function(S,T,H,U){var W=S.bindParameters;if(0!==T.size&&H.material.requiresSlot(W.slot)){var {rctx:Q,pass:X}=S,ba=H.glMaterials.load(Q,X);if(!c.isNone(ba)){var aa=ba.beginSlot(W);ba=Q.bindTechnique(aa,H.material.parameters,W);Q.bindVAO(H.vao);aa.ensureAttributeLocations(H.vao);aa.bindDraw(P,W);h.LOD_INSTANCE_RENDERER_COLORIZE_BY_LEVEL&&S.pass===q.RenderPass.MATERIAL&&(ba.setUniform4fv("externalColor",I[Math.min(U,
I.length-1)]),ba.setUniform1i("colorMixMode",B.colorMixModes.replace));var ea=Q.capabilities.instancing;S=T.capacity;U=T.headIndex;W=T.tailIndex;ba=T.firstIndex;var ia=this._glInstanceBufferLayout,ka=(la,Z)=>{E.bindVertexBufferLayout(Q,g.Default3D,T.buffer,ia,la);ea.drawArraysInstanced(aa.primitiveType,0,H.vertexCount,Z-la);E.unbindVertexBufferLayout(Q,g.Default3D,T.buffer,ia)};H.material.parameters.transparent&&null!=ba?U>W?(r.assert(ba>=W&&ba<=U,"invalid firstIndex"),ka(ba,U),ka(W,ba)):U<W&&(ba<=
U?(r.assert(0<=ba&&ba<=U,"invalid firstIndex"),ka(ba,U),ka(W,S),ka(0,ba)):(r.assert(ba>=W&&ba<=S,"invalid firstIndex"),ka(ba,S),ka(0,U),ka(W,ba))):U>W?ka(W,U):U<W&&(ka(0,U),ka(W,S));Q.bindVAO(null)}}};b._createClass(N,[{key:"levels",get:function(){return this._levels}},{key:"baseBoundingBox",get:function(){return this._levels[this._levels.length-1].boundingBox}},{key:"baseBoundingSphere",get:function(){return this._levels[this._levels.length-1].boundingSphere}},{key:"baseMaterial",get:function(){return this._levels[this._levels.length-
1].components[0].material}},{key:"slicePlaneEnabled",get:function(){return this._slicePlane},set:function(S){this._slicePlane=S}},{key:"layerUid",get:function(){return this._metadata.layerUid}},{key:"instanceData",get:function(){return this._instanceData}},{key:"memoryUsage",get:function(){const S={cpu:0,gpu:0};this._defaultRenderInstanceData.forEach(T=>{T=T.memoryUsage;S.cpu+=T.cpu;S.gpu+=T.gpu});this._highlightRenderInstanceData.forEach(T=>{T=T.memoryUsage;S.cpu+=T.cpu;S.gpu+=T.gpu});return S}},
{key:"renderStats",get:function(){const S=this._instanceData.size,T=[];this._levels.forEach((H,U)=>{U=this._defaultRenderInstanceData[U].size+this._highlightRenderInstanceData[U].size;H=H.triangleCount;T.push({renderedInstances:U,renderedTriangles:U*H,trianglesPerInstance:H})});return{totalInstances:S,renderedInstances:T.reduce((H,U)=>H+U.renderedInstances,0),renderedTriangles:T.reduce((H,U)=>H+U.renderedTriangles,0),levels:T}}},{key:"needsTransparentPass",get:function(){return this._levels.some(S=>
S.components.some(T=>T.material.requiresSlot(k.RenderSlot.TRANSPARENT_MATERIAL)))}},{key:"needsHighlight",get:function(){return this._highlightRenderInstanceData.some(S=>0<S.size)}},{key:"needsUpdates",get:function(){return 0<this._instanceData.size&&1>this._updateCyclesWithStaticCamera}},{key:"octree",get:function(){this._octree||(this._octree=this._buildOctree());return this._octree}}]);return N}();const K=v.create(),L=m.create(),R=l.create(),M=v.create(),J=v.create(),I=[[1,0,1,1],[0,0,1,1],[0,
1,0,1],[1,1,0,1],[1,0,0,1]],P=new D.DefaultMaterialDrawParameters;a.LodRenderer=O;a.setLevelSelectorFactory=function(N){G=N};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/InstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Evented ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/buffer/BufferView ../../../support/mathUtils ../../../support/buffer/InterleavedLayout ../Util ../VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){a.StateFlags=void 0;(function(w){w[w.ALLOCATED=1]="ALLOCATED";w[w.DEFAULT_ACTIVE=2]="DEFAULT_ACTIVE";w[w.VISIBLE=4]="VISIBLE";w[w.HIGHLIGHT=8]="HIGHLIGHT";w[w.HIGHLIGHT_ACTIVE=16]="HIGHLIGHT_ACTIVE";w[w.REMOVE=32]="REMOVE";w[w.TRANSFORM_CHANGED=64]="TRANSFORM_CHANGED";w[w.ACTIVE=18]="ACTIVE"})(a.StateFlags||(a.StateFlags={}));let q=function(w){this.localTransform=w.getField(t.VertexAttribute.LOCALTRANSFORM,d.BufferViewMat4f64);this.globalTransform=w.getField(t.VertexAttribute.GLOBALTRANSFORM,
d.BufferViewMat4f64);this.modelOrigin=w.getField(t.VertexAttribute.MODELORIGIN,d.BufferViewVec3f64);this.model=w.getField(t.VertexAttribute.MODEL,d.BufferViewMat3f);this.modelNormal=w.getField(t.VertexAttribute.MODELNORMAL,d.BufferViewMat3f);this.modelScaleFactors=w.getField(t.VertexAttribute.MODELSCALEFACTORS,d.BufferViewVec2f);this.boundingSphere=w.getField(t.VertexAttribute.BOUNDINGSPHERE,d.BufferViewVec4f64);this.color=w.getField(t.VertexAttribute.COLOR,d.BufferViewVec4f);this.featureAttribute=
w.getField(t.VertexAttribute.FEATUREATTRIBUTE,d.BufferViewVec4f);this.state=w.getField(t.VertexAttribute.STATE,d.BufferViewUint8);this.lodLevel=w.getField(t.VertexAttribute.LODLEVEL,d.BufferViewUint8)};c=function(w){function z(x,B){var C=w.call(this)||this;C._capacity=0;C._size=0;C._next=0;{let D=g.newLayout().mat4f64(t.VertexAttribute.LOCALTRANSFORM).mat4f64(t.VertexAttribute.GLOBALTRANSFORM).vec4f64(t.VertexAttribute.BOUNDINGSPHERE).vec3f64(t.VertexAttribute.MODELORIGIN).mat3f(t.VertexAttribute.MODEL).mat3f(t.VertexAttribute.MODELNORMAL).vec2f(t.VertexAttribute.MODELSCALEFACTORS);
x.includes("color")&&(D=D.vec4f(t.VertexAttribute.COLOR));x.includes("featureAttribute")&&(D=D.vec4f(t.VertexAttribute.FEATUREATTRIBUTE));x=D=D.u8(t.VertexAttribute.STATE).u8(t.VertexAttribute.LODLEVEL).alignTo(8)}C._layout=x;C._shaderTransformation=B;return C}b._inheritsLoose(z,w);var A=z.prototype;A.addInstance=function(){this._size+1>this._capacity&&this._grow();const x=this._findSlot();this._view.state.set(x,a.StateFlags.ALLOCATED);this._size++;this.emit("instance-added",{index:x});return x};
A.removeInstance=function(x){const B=this._view.state;p.assert(0<=x&&x<this._capacity&&B.get(x)&a.StateFlags.ALLOCATED,"invalid instance handle");this._getStateFlag(x,a.StateFlags.ACTIVE)?this._setStateFlags(x,a.StateFlags.REMOVE):this.freeInstance(x);this.emit("instance-removed",{index:x})};A.freeInstance=function(x){const B=this._view.state;p.assert(0<=x&&x<this._capacity&&B.get(x)&a.StateFlags.ALLOCATED,"invalid instance handle");B.set(x,0);this._size--};A.setLocalTransform=function(x,B,C=!0){this._view.localTransform.setMat(x,
B);C&&this.updateModelTransform(x)};A.getLocalTransform=function(x,B){this._view.localTransform.getMat(x,B)};A.setGlobalTransform=function(x,B,C=!0){this._view.globalTransform.setMat(x,B);C&&this.updateModelTransform(x)};A.getGlobalTransform=function(x,B){this._view.globalTransform.getMat(x,B)};A.updateModelTransform=function(x){const B=this._view;var C=k;const D=r;B.localTransform.getMat(x,y);B.globalTransform.getMat(x,f);const E=u.multiply(f,f,y);m.set(C,E[12],E[13],E[14]);B.modelOrigin.setVec(x,
C);n.fromMat4(D,E);B.model.setMat(x,D);C=e.scaleFromMatrix(k,E);C.sort();B.modelScaleFactors.set(x,0,C[1]);B.modelScaleFactors.set(x,1,C[2]);n.invert(D,D);n.transpose(D,D);B.modelNormal.setMat(x,D);this._setStateFlags(x,a.StateFlags.TRANSFORM_CHANGED);this.emit("instance-transform-changed",{index:x})};A.getModelTransform=function(x,B){const C=this._view;C.model.getMat(x,r);C.modelOrigin.getVec(x,k);B[0]=r[0];B[1]=r[1];B[2]=r[2];B[3]=0;B[4]=r[3];B[5]=r[4];B[6]=r[5];B[7]=0;B[8]=r[6];B[9]=r[7];B[10]=
r[8];B[11]=0;B[12]=k[0];B[13]=k[1];B[14]=k[2];B[15]=1};A.applyShaderTransformation=function(x,B){this._shaderTransformation&&this._shaderTransformation.applyTransform(this,x,B)};A.getCombinedModelTransform=function(x,B){this.getModelTransform(x,B);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,x,B);return B};A.getCombinedLocalTransform=function(x,B){this._view.localTransform.getMat(x,B);this._shaderTransformation&&this._shaderTransformation.applyTransform(this,x,B);return B};
A.getCombinedMaxScaleFactor=function(x){let B=this._view.modelScaleFactors.get(x,1);this._shaderTransformation&&(x=this._shaderTransformation.scaleFactor(k,this,x),B*=Math.max(x[0],x[1],x[2]));return B};A.getCombinedMedianScaleFactor=function(x){let B=this._view.modelScaleFactors.get(x,0);this._shaderTransformation&&(x=this._shaderTransformation.scaleFactor(k,this,x),x.sort(),B*=x[1]);return B};A.getModel=function(x,B){this._view.model.getMat(x,B)};A.setFeatureAttribute=function(x,B){this._view.featureAttribute.setVec(x,
B)};A.getFeatureAttribute=function(x,B){this._view.featureAttribute.getVec(x,B)};A.setColor=function(x,B){this._view.color.setVec(x,B)};A.getColor=function(x,B){this._view.color.getVec(x,B)};A.setVisible=function(x,B){B!==this.getVisible(x)&&(this._setStateFlag(x,a.StateFlags.VISIBLE,B),this.emit("instance-visibility-changed",{index:x}))};A.getVisible=function(x){return this._getStateFlag(x,a.StateFlags.VISIBLE)};A.setHighlight=function(x,B){B!==this.getHighlight(x)&&(this._setStateFlag(x,a.StateFlags.HIGHLIGHT,
B),this.emit("instance-highlight-changed",{index:x}))};A.getHighlight=function(x){return this._getStateFlag(x,a.StateFlags.HIGHLIGHT)};A.getState=function(x){return this._view.state.get(x)};A.getLodLevel=function(x){return this._view.lodLevel.get(x)};A.countFlags=function(x){let B=0;for(let C=0;C<this._capacity;++C)this.getState(C)&x&&++B;return B};A._setStateFlags=function(x,B){const C=this._view.state;B|=C.get(x);C.set(x,B)};A._clearStateFlags=function(x,B){const C=this._view.state;B=C.get(x)&~B;
C.set(x,B)};A._setStateFlag=function(x,B,C){C?this._setStateFlags(x,B):this._clearStateFlags(x,B)};A._getStateFlag=function(x,B){return!!(this._view.state.get(x)&B)};A._grow=function(){const x=Math.max(1024,Math.floor(2*this._capacity)),B=this._layout.createBuffer(x);if(this._buffer){const C=new Uint8Array(this._buffer.buffer);(new Uint8Array(B.buffer)).set(C)}this._capacity=x;this._buffer=B;this._view=new q(this._buffer)};A._findSlot=function(){const x=this._view.state;let B=this._next;for(;x.get(B)&
a.StateFlags.ALLOCATED;)B=(B+1)%this._capacity;this._next=(B+1)%this._capacity;return B};b._createClass(z,[{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){return this._size}},{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}}]);return z}(c);const k=h.create(),r=l.create(),y=v.create(),f=v.create();a.InstanceData=c;a.InstanceDataView=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/lodRendering/InstanceOctree":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/sphere ../../../support/mathUtils ../Octree".split(" "),function(a,b,c,n,l,u,v){v=function(m){function h(e,g){var p=m.call(this,t=>l.wrap(p._instanceData.view.boundingSphere.getVec(t,p._tmpSphere)),{maximumDepth:25})||this;p._tmpSphere=l.create();p._tmpMat4=c.create();p._instanceData=e;
p._boundingSphere=g;return p}b._inheritsLoose(h,m);var d=h.prototype;d.addInstance=function(e){const g=this._instanceData.view.boundingSphere,p=this._instanceData.getCombinedModelTransform(e,this._tmpMat4);n.transformMat4(this._tmpSphere,this._boundingSphere.center,p);this._tmpSphere[3]=this._boundingSphere.radius*u.maxScale(p);g.setVec(e,this._tmpSphere);this.add([e])};d.removeInstance=function(e){this.remove([e])};return h}(v);a.InstanceOctree=v;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LevelSelector":function(){define(["exports","../Camera"],function(a,b){let c=function(){function n(u,v){this.thresholdScale=1;this._camera=new b.Camera;this._worldSpaceRadius=u;this._thresholds=v.map(m=>m)}var l=n.prototype;l.updateCamera=function(u){this._camera.copyFrom(u)};l.selectLevel=function(u,v){u=this._camera.computeScreenPixelSizeAt(u);v=this._worldSpaceRadius*v/u;u=this._thresholds;let m=-1;for(let h=
0;h<u.length;++h)v>=u[h]*this.thresholdScale&&(m=h);return m};return n}();a.LevelSelector=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodLevel":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ./LodComponentData".split(" "),function(a,b,c,n,l,u,
v){let m=function(){function h(e,g){this.minScreenSpaceRadius=e;this.components=g}h.create=function(){var e=b._asyncToGenerator(function*(g,p,t){const q=yield Promise.allSettled(p.components.map(r=>g.schedule(()=>new v.LodComponentData(g,r),t))),k=q.map(r=>"fulfilled"===r.status?r.value:null).filter(r=>r);if(n.isAborted(t)||k.length!==q.length){k.forEach(r=>r.destroy());n.throwIfAborted(t);for(const r of q)if("rejected"===r.status)throw r.reason;}return new h(p.minScreenSpaceRadius,k)});return function(g,
p,t){return e.apply(this,arguments)}}();var d=h.prototype;d.destroy=function(){this.components.forEach(e=>e.destroy())};d.intersect=function(e,g,p,t,q,k,r){this.components.forEach(y=>y.intersect(e,g,p,t,q,k,this.boundingSphere,r))};b._createClass(h,[{key:"boundingBox",get:function(){if(c.isNone(this._boundingBox)){const e=u.empty();this.components.forEach(g=>{c.isSome(g.boundingInfo)&&(u.expandWithVec3(e,g.boundingInfo.bbMin),u.expandWithVec3(e,g.boundingInfo.bbMax))});this._boundingBox=e}return this._boundingBox}},
{key:"boundingSphere",get:function(){if(c.isNone(this._boundingSphere)){const e=this.boundingBox,g=l.create();u.center(e,g);this._boundingSphere={center:g,radius:.5*u.diameter(e)}}return this._boundingSphere}},{key:"triangleCount",get:function(){return this.components.reduce((e,g)=>e+g.triangleCount,0)}}]);return h}();a.LodLevel=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/LodComponentData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../support/buffer/glUtil ../DefaultVertexAttributeLocations ../GLMaterials ../Intersector ../IntersectorInterfaces ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d){let e=function(){function g(t,q){const k=t.renderContext.rctx,{geometry:r,material:y}=q;this._materialRepository=t.materialRep;y.setParameters({instancedDoublePrecision:!0});t=y.createBufferWriter();q=t.vertexBufferLayout;const f=t.elementCount(r),w=t.allocate(f);t.write({},r,w,0);this.geometry=r;this.material=y;this.glMaterials=new l.GLMaterials(y,this._materialRepository);this.vertexBufferLayout=q;this.vbo=m.BufferObject.createVertex(k,h.Usage.STATIC_DRAW,w.buffer);
this.vao=new d.VertexArrayObject(k,n.Default3D,{geometry:c.glLayout(q)},{geometry:this.vbo});this.vertexCount=f}var p=g.prototype;p.destroy=function(){this.glMaterials.destroy();this.vbo.dispose();this.vao.dispose()};p.intersect=function(t,q,k,r,y,f,w,z){const A=this.geometry.id;this.material.intersect(this.geometry,null,t.transform.transform,t,k,r,(x,B,C,D,E)=>{0<=x&&(null==q||q(t.rayBegin,t.rayEnd,x))&&(C={layerUid:f.layerUid,graphicUid:f.graphicUid(y),geometryId:A,triangleNr:C,baseBoundingSphere:w,
numLodLevels:z},(null==t.results.min.drapedLayerOrder||E>=t.results.min.drapedLayerOrder)&&(null==t.results.min.dist||x<t.results.min.dist)&&t.results.min.set(v.IntersectorType.LOD,C,x,B,t.transform.transform,E),t.options.store!==v.StoreResults.MIN&&(null==t.results.max.drapedLayerOrder||E>=t.results.max.drapedLayerOrder)&&(null==t.results.max.dist||x>t.results.max.dist)&&t.results.max.set(v.IntersectorType.LOD,C,x,B,t.transform.transform,E),t.options.store===v.StoreResults.ALL&&(D=u.newIntersectorResult(t.results.min.ray),
D.set(v.IntersectorType.LOD,C,x,B,t.transform.transform,E),t.results.all.push(D)))})};b._createClass(g,[{key:"boundingInfo",get:function(){return this.geometry.boundingInfo}},{key:"triangleCount",get:function(){return this.vertexCount/3}}]);return g}();a.LodComponentData=e;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/RenderInstanceData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/buffer/BufferView ../Util ../VertexAttribute ./BackedBufferObject".split(" "),
function(a,b,c,n,l,u){let v=function(h){this.modelOriginHi=h.getField(l.VertexAttribute.MODELORIGINHI,c.BufferViewVec3f);this.modelOriginLo=h.getField(l.VertexAttribute.MODELORIGINLO,c.BufferViewVec3f);this.model=h.getField(l.VertexAttribute.MODEL,c.BufferViewMat3f);this.modelNormal=h.getField(l.VertexAttribute.MODELNORMAL,c.BufferViewMat3f);this.color=h.getField(l.VertexAttribute.INSTANCECOLOR,c.BufferViewVec4f);this.featureAttribute=h.getField(l.VertexAttribute.INSTANCEFEATUREATTRIBUTE,c.BufferViewVec4f)},
m=function(){function h(e,g){this._tailIndex=this._headIndex=0;this._captureFirstIndex=!0;this._updating=!1;this._prevHeadIndex=0;this._resized=!1;this._rctx=e;this._instanceBufferLayout=g;this._elementSize=g.stride;this._capacity=1}var d=h.prototype;d.destroy=function(){this._buffer&&this._buffer.destroy()};d.reset=function(){this._tailIndex=this._headIndex=0;this._firstIndex=null};d.startUpdateCylce=function(){this._captureFirstIndex=!0};d.beginUpdate=function(){n.assert(!this._updating,"already updating");
this._updating=!0;this._prevHeadIndex=this._headIndex};d.endUpdate=function(){n.assert(this._updating,"not updating");this.size<.3*this.capacity&&this._shrink();this._resized?(this._buffer.transferAll(),this._resized=!1):this._transferRange(this._prevHeadIndex,this._headIndex);this._updating=!1};d.allocateHead=function(){n.assert(this._updating,"not updating");this.isFull&&this._grow();const e=this.headIndex;this._captureFirstIndex&&(this._firstIndex=e,this._captureFirstIndex=!1);this._incrementHead();
n.assert(this._headIndex!==this._tailIndex,"invalid pointers");return e};d.freeTail=function(){n.assert(this._updating,"not updating");n.assert(0<this.size,"invalid size");const e=this._tailIndex===this._firstIndex;this._incrementTail();e&&(this._firstIndex=this._tailIndex)};d._grow=function(){this._resize(Math.max(1024,Math.floor(2*this._capacity)))};d._shrink=function(){this._resize(Math.max(1024,Math.floor(.5*this._capacity)))};d._resize=function(e){n.assert(this._updating,"not updating");if(e!==
this._capacity){var g=new u(this._rctx,this._elementSize,e);if(this._buffer){this._firstIndex&&(this._firstIndex=(this._firstIndex+this._capacity-this._tailIndex)%this._capacity);const p=this.size,t=this._compactInstances(g);n.assert(t===p,"invalid compaction");this._buffer.destroy();this._tailIndex=0;this._headIndex=t;this._prevHeadIndex=0}this._resized=!0;this._capacity=e;this._buffer=g;this._view=new v(this._instanceBufferLayout.createView(this._buffer.array))}};d._compactInstances=function(e){const g=
this._headIndex,p=this._tailIndex;return p<g?(this._buffer.copyRange(p,g,e),g-p):p>g?(this._buffer.copyRange(p,this._capacity,e),0<g&&this._buffer.copyRange(0,g,e,this._capacity-p),g+(this._capacity-p)):0};d._incrementHead=function(e=1){this._headIndex=(this._headIndex+e)%this._capacity};d._incrementTail=function(e=1){this._tailIndex=(this._tailIndex+e)%this._capacity};d._transferRange=function(e,g){e<g?this._buffer.transferRange(e,g):e>g&&(0<g&&this._buffer.transferRange(0,g),this._buffer.transferRange(e,
this._capacity))};b._createClass(h,[{key:"buffer",get:function(){return this._buffer.buffer}},{key:"view",get:function(){return this._view}},{key:"capacity",get:function(){return this._capacity}},{key:"size",get:function(){const e=this._headIndex,g=this._tailIndex;return e>=g?e-g:e+this._capacity-g}},{key:"isEmpty",get:function(){return this._headIndex===this._tailIndex}},{key:"isFull",get:function(){return this._tailIndex===(this._headIndex+1)%this._capacity}},{key:"headIndex",get:function(){return this._headIndex}},
{key:"tailIndex",get:function(){return this._tailIndex}},{key:"firstIndex",get:function(){return this._firstIndex}},{key:"memoryUsage",get:function(){return this._buffer?this._buffer.memoryUsage:{cpu:0,gpu:0}}}]);return h}();a.RenderInstanceData=m;a.RenderInstanceDataView=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/BackedBufferObject":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers",
"../../../../webgl/BufferObject","../../../../webgl/enums"],function(a,b,c){return function(){function n(u,v,m){this._elementSize=v;this._buffer=b.BufferObject.createVertex(u,c.Usage.STATIC_DRAW);this.resize(m)}var l=n.prototype;l.destroy=function(){this._buffer.dispose()};l.copyRange=function(u,v,m,h=0){u=new Uint8Array(this.array,u*this.elementSize,(v-u)*this.elementSize);(new Uint8Array(m.array,h*this.elementSize)).set(u)};l.transferAll=function(){this._buffer.setData(this._array)};l.transferRange=
function(u,v){u*=this._elementSize;this._buffer.setSubData(this._array,u,u,v*this._elementSize)};l.resize=function(u){const v=u*this._elementSize,m=new ArrayBuffer(v);this._array&&(u>=this._capacity?(new Uint8Array(m)).set(new Uint8Array(this._array)):(new Uint8Array(m)).set((new Uint8Array(this._array)).subarray(0,u*this._elementSize)));this._array=m;this._buffer.setSize(v);this._capacity=u};a._createClass(n,[{key:"elementSize",get:function(){return this._elementSize}},{key:"capacity",get:function(){return this._capacity}},
{key:"array",get:function(){return this._array}},{key:"buffer",get:function(){return this._buffer}},{key:"memoryUsage",get:function(){return{cpu:this._capacity*this._elementSize,gpu:this._capacity*this._elementSize}}}]);return n}()})},"esri/views/3d/layers/graphics/Graphics3DPathSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/mat2 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f32 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/support/aaBoundingBox ../../../../layers/graphics/dehydratedFeatures ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./interfaces ../support/FastSymbolUpdates ../../webgl-engine/lib/basicInterfaces ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/PathGeometry ../../webgl-engine/lib/pathGeometryUtils ../../webgl-engine/materials/DefaultMaterial ../../webgl-engine/materials/PathMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E){function F(V,S,T){switch(S){case "world":for(const H of V.vertices)h.add(I,H.pos,V.offset),T.worldUpAtPosition(I,J),H.setFrameFromUpVector(J),H.computeRotationAxisAndAngleFromUpVector();break;case "path":h.add(I,V.vertices[0].pos,V.offset);T.worldUpAtPosition(I,J);C.computeMinimumRotationTangentFrame(V,J);for(const H of V.vertices)V=Math.sign(h.dot(H.frame.right,H.vRight)),h.cross(H.rotationFrame.up,H.vRight,H.vLeft),h.scale(H.rotationFrame.up,
H.rotationFrame.up,V),h.normalize(H.rotationFrame.up,H.rotationFrame.up),S=h.dot(H.rotationFrame.up,H.frame.up),T=h.dot(H.rotationFrame.up,H.frame.right),h.scale(I,H.frame.up,-T),h.scale(P,H.frame.right,S),h.add(I,I,P),h.normalize(H.rotationFrame.right,I),C.vertexSpaceToProfileSpace(H.rotationRight,H.frame,H.rotationFrame.right),h.negate(I,H.vLeft),H.rotationAngle=-V*(Math.PI-n.acosClamped(h.dot(I,H.vRight))),0<Math.abs(H.rotationAngle)&&(V=n.reciprocalClamped(Math.cos(.5*H.rotationAngle)),u.set(H.miterStretch,
1+(V-1)*H.rotationRight[0]*H.rotationRight[0],(V-1)*H.rotationRight[0]*H.rotationRight[1],(V-1)*H.rotationRight[0]*H.rotationRight[1],1+(V-1)*H.rotationRight[1]*H.rotationRight[1])),H.maxStretchDistance=Math.abs(Math.min(H.vLeftLength,H.vRightLength)*n.reciprocalClamped(Math.cos(.5*(Math.PI-H.rotationAngle))))}}function G(V,S,T){switch(V){case "symbol-value":return T;case "proportional":return S;default:return V}}function O(V,S,T,H){V=V.stageObject;const U=V.geometryRecords;var W=0;R.spatialReference=
H.spatialReference;for(const ea of U){const ia=ea.geometry;if(!B.isPathGeometry(ia))continue;const ka=ia.path,la=ka.builder.path;M.spatialReference=ia.geometrySR;{var Q=la;var X=S,ba=T,aa=H;let Z=0;for(const ca of Q.vertices)q.evaluateElevationInfoAtPoint(ca.posES,ba,X,aa,N),Z+=N.sampledElevation,h.add(J,ca.pos,Q.offset),aa.setAltitude(J,N.z),h.subtract(ca.pos,J,Q.offset);Q.updatePathVertexInformation();Q=Z/Q.vertices.length}W+=Q;"world"!==ia.upVectorAlignment&&F(la,ia.upVectorAlignment,H);ka.onPathChanged();
ia.invalidateBoundingInfo();V.geometryVertexAttrsUpdated(ea)}return W/U.length}const K=["polyline"];let L=function(V){function S(H,U,W,Q){H=V.call(this,H,U,W,Q)||this;H._intrinsicSize=m.fromValues(1,1);H.upVectorAlignment="path";H.stencilWidth=.1;H.ensureDrapedStatus(!1);return H}b._inheritsLoose(S,V);var T=S.prototype;T.doLoad=function(){var H=b._asyncToGenerator(function*(){var U=l.isSome(this.symbolLayer.width)?this.symbolLayer.width:this.symbolLayer.height;const W=l.isSome(this.symbolLayer.height)?
this.symbolLayer.height:U;this._vvConvertOptions={modelSize:[1,1,1],symbolSize:[U,1,W],unitInMeters:this._context.renderCoordsHelper.unitInMeters,transformation:{anchor:[0,0,0],scale:[1,1,1],rotation:[0,0,0]},supportedTypes:{size:!0,color:!0,opacity:!0,rotation:!1}};this._fastUpdates=this._context.renderer&&this._context.renderer.visualVariables&&0<this._context.renderer.visualVariables.length?z.initFastSymbolUpdatesState(this._context.renderer,this._vvConvertOptions):{enabled:!1};var Q=this.symbolLayer.anchor||
"center";this.upVectorAlignment="path";"heading"===this.symbolLayer.profileRotation&&(this.upVectorAlignment="world");var X=this.symbolLayer.profile||"circle";switch(X){default:this._profile=C.Profile.circle(10);break;case "quad":this._profile=C.Profile.rect()}var ba=[0,0];"center"!==Q&&(ba={left:[.5,0],right:[-.5,0],top:[0,-.5],bottom:[0,.5]}[Q],this._profile.translate(ba[0],ba[1]));switch(this.symbolLayer.join||"simple"){case "round":this._extruder=new C.MiterExtruder(0,3);break;case "bevel":this._extruder=
new C.MiterExtruder(0,1);break;case "miter":this._extruder=new C.MiterExtruder(.8*Math.PI,1);break;default:this._extruder=new C.SimpleExtruder}Q=this.symbolLayer.cap||"butt";switch(Q){case "none":this._startCap=new C.NoCapBuilder;this._endCap=new C.NoCapBuilder;break;default:this._startCap=new C.TriangulationCapBuilder(this._profile,0);this._endCap=new C.TriangulationCapBuilder(this._profile,0,!0);break;case "square":this._startCap=new C.TriangulationCapBuilder(this._profile,-.5);this._endCap=new C.TriangulationCapBuilder(this._profile,
.5,!0);break;case "round":X="quad"===X?!0:!1,this._startCap=new C.RoundCapBuilder({profile:this._profile,flip:!1,breakNormals:X,subdivisions:3}),this._endCap=new C.RoundCapBuilder({profile:this._profile,flip:!0,breakNormals:X,subdivisions:3})}X=l.get(this.symbolLayer,"material","color");ba=this._getCombinedOpacityAndColor(X);X=e.fromArray(ba);ba=ba[3];const aa=1>ba||this.needsDrivenTransparentPass;Q={diffuse:X,ambient:X,opacity:ba,transparent:aa,hasVertexColors:!1,hasSlicePlane:this._context.slicePlaneEnabled,
castShadows:this.symbolLayer.castShadows,cullFace:aa||"none"===Q?A.CullFaceOptions.None:A.CullFaceOptions.Back,offsetTransparentBackfaces:!0};if(!this._drivenProperties.size&&(v.set(this._intrinsicSize,U,W),!f.isValidSize(this._intrinsicSize[0])||!f.isValidSize(this._intrinsicSize[1])))throw new c("graphics3dpathsymbollayer:invalid-size","Symbol sizes may not be negative values");this._fastUpdates.enabled&&this._fastUpdates.visualVariables.size||v.scale(this._intrinsicSize,this._intrinsicSize,1/this._context.renderCoordsHelper.unitInMeters);
this._fastUpdates.enabled?(U={...Q,...this._fastUpdates.materialParameters,size:m.fromArray(this._intrinsicSize)},this._material=new E.PathMaterial(U)):(Q.hasVertexColors=this._drivenProperties.color||this._drivenProperties.opacity,this._material=new D.DefaultMaterial(Q));this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});this._context.stage.add(this._material)});return function(){return H.apply(this,arguments)}}();T.destroy=function(){V.prototype.destroy.call(this);
this._context.stage.remove(this._material);this._material=null};T.createGraphics3DGraphic=function(H){const U=H.graphic;if(!this._validateGeometry(U.geometry,K,this.symbolLayer.type))return null;const W=this.setGraphicElevationContext(U,new k.ElevationContext);return this._createAs3DShape(U,H.renderingInfo,W,U.uid)};T.layerOpacityChanged=function(){var H=l.get(this.symbolLayer,"material","color");H=this._getCombinedOpacity(H);this._material.setParameters({opacity:H,transparent:1>H||this.needsDrivenTransparentPass});
return!0};T.layerElevationInfoChanged=function(H,U){return this.updateGraphics3DGraphicElevationInfo(H,U,q.needsElevationUpdates3D)};T.slicePlaneEnabledChanged=function(){this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};T.physicalBasedRenderingChanged=function(){this._material.setParameters({usePBR:this._context.physicalBasedRenderingEnabled,isSchematic:!0});return!0};T.pixelRatioChanged=function(){return!0};T.applyRendererDiff=function(H,U){for(const W in H.diff)switch(W){case "visualVariables":if(z.updateFastSymbolUpdatesState(this._fastUpdates,
U,this._vvConvertOptions))this._material.setParameters(this._fastUpdates.materialParameters);else return w.ApplyRendererDiffResult.Recreate_Symbol;break;default:return w.ApplyRendererDiffResult.Recreate_Symbol}return w.ApplyRendererDiffResult.Fast_Update};T.getVertexData=function(H){let U=0;const W=H.paths,Q=[],X=H.spatialReference,ba=this._context.elevationProvider.spatialReference,aa=this._context.renderCoordsHelper.spatialReference;for(var ea of W)U+=ea.length;ea=new Float64Array(3*U);const ia=
new Float64Array(3*U),ka=new Float64Array(3*U);let la=0;for(const Z of W){Q.push({index:la,numVertices:Z.length});for(const ca of Z)ea[la++]=ca[0],ea[la++]=ca[1],ea[la++]=H.hasZ?ca[2]:0}H=!0;X.equals(ba)?this._copyVertices(ea,0,ia,0,U):H=g.projectBuffer(ea,X,0,ia,ba,0,U);ba.equals(aa)?this._copyVertices(ia,0,ka,0,U):g.projectBuffer(ia,ba,0,ka,aa,0,U);return{pathVertexDataInfos:Q,vertexDataGS:ea,vertexDataES:ia,vertexDataRS:ka,projectionSuccess:H,terrainElevation:0}};T._copyVertices=function(H,U,W,
Q,X){U*=3;Q*=3;for(let ba=0;ba<X;++ba)W[Q++]=H[U++],W[Q++]=H[U++],W[Q++]=H[U++]};T._createAs3DShape=function(H,U,W,Q){var X=H.geometry,ba=[];const aa=[],ea=[],ia=X.spatialReference,ka=p.create(),la=this._context.renderCoordsHelper;M.spatialReference=ia;const Z=this.getVertexData(X);if(!Z.projectionSuccess)return this.logger.warn("PathSymbol3DLayer geometry failed to be created (failed to project geometry to view spatial reference)"),null;if(0<Z.pathVertexDataInfos.length){for(X=0;X<Z.pathVertexDataInfos.length;++X){var ca=
Z.pathVertexDataInfos[X],Y=ca.index;ca=ca.numVertices;if(2>ca)continue;if(l.isSome(this._context.clippingExtent)&&(p.empty(ka),p.expandWithBuffer(ka,Z.vertexDataES,3*Y,ca),!p.intersectsClippingArea(ka,this._context.clippingExtent)))continue;var da=[];for(var ha=Y;ha<Y+3*ca;){const pa=ha++,na=ha++,wa=ha++,xa=new C.PathVertex;h.set(xa.posGS,Z.vertexDataGS[pa],Z.vertexDataGS[na],Z.vertexDataGS[wa]);h.set(xa.posES,Z.vertexDataES[pa],Z.vertexDataES[na],Z.vertexDataES[wa]);const sa=q.evaluateElevationAlignmentAtPoint(xa.posES,
this._context.elevationProvider,W,la);h.set(J,Z.vertexDataRS[pa],Z.vertexDataRS[na],Z.vertexDataRS[wa]);la.setAltitude(J,sa);h.set(xa.pos,J[0],J[1],J[2]);da.push(xa)}Y=new C.Path(da);F(Y,this.upVectorAlignment,this._context.renderCoordsHelper);Y=new C.Builder(Y,this._profile,this._extruder,this._startCap,this._endCap);ca=null;this._fastUpdates.enabled?(ha=this._fastUpdates.visualVariables,ca=ha.size?y.getAttributeValue(ha.size.field,H):0,da=ha.color?y.getAttributeValue(ha.color.field,H):0,ha=ha.opacity?
y.getAttributeValue(ha.opacity.field,H):0,ca=new C.FastUpdatePathGeometry(Y,ca,da,ha)):(ca=[this._intrinsicSize[0],this._intrinsicSize[1]],this._drivenProperties.size&&(ca[0]*=G(U.size[0],"symbol-value"===U.size[2]?this.symbolLayer.height||0:U.size[2],this.symbolLayer.width||0),ca[1]*=G(U.size[2],"symbol-value"===U.size[0]?this.symbolLayer.width||0:U.size[0],this.symbolLayer.height||0)),da=null,this._drivenProperties.color&&(da=U.color),this._drivenProperties.opacity&&null!=U.opacity&&(da=da?[da[0],
da[1],da[2],U.opacity]:[1,1,1,U.opacity]),Y=new C.StaticPathGeometry(Y),Y.bake(ca),da&&Y.bakeVertexColors(da),ca=Y);const {vertexAttributes:ja,indices:ma}=ca.createGeometryData();Y=new B.PathGeometry(ja,ma,ca,ia,this.upVectorAlignment,this.stencilWidth);ba.push(Y);aa.push(this._material);ea.push(ca.xform)}if(0<ba.length)return H=new x.Object3D({geometries:ba,materials:aa,transformations:ea,metadata:{layerUid:this._context.layer.uid,graphicUid:Q}}),ba=new r.Graphics3DObject3DGraphicLayer(this,H,ba,
null,null,O,W),ba.alignedSampledElevation=Z.terrainElevation,ba.needsElevationUpdates=q.needsElevationUpdates3D(W.mode),ba}else 0!==X.paths.length&&X.paths.some(ja=>0<ja.length)||this.logger.warn("PathSymbol3DLayer geometry failed to be created (no paths were defined)");return null};return S}(y.Graphics3DSymbolLayer);const R=t.makeDehydratedPoint(0,0,0,null),M=t.makeDehydratedPoint(0,0,0,null),J=e.create(),I=d.create(),P=d.create(),N=new q.SampleElevationInfo;a.Graphics3DPathSymbolLayer=L;a.NUM_CIRCLE_PROFILE_SUBDIVISIONS=
10;a.NUM_ROUND_CAP_EXTRUSION_SUBDIVISIONS=3;a.NUM_ROUND_JOIN_SUBDIVISIONS=3;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2":function(){define(["exports","./common"],function(a,b){function c(C,D){C[0]=D[0];C[1]=D[1];C[2]=D[2];C[3]=D[3];return C}function n(C){C[0]=1;C[1]=0;C[2]=0;C[3]=1;return C}function l(C,D,E,F,G){C[0]=D;C[1]=E;C[2]=F;C[3]=G;return C}function u(C,D){if(C===D){const E=D[1];C[1]=D[2];C[2]=E}else C[0]=D[0],C[1]=D[2],C[2]=
D[1],C[3]=D[3];return C}function v(C,D){const E=D[0],F=D[1],G=D[2];D=D[3];let O=E*D-G*F;if(!O)return null;O=1/O;C[0]=D*O;C[1]=-F*O;C[2]=-G*O;C[3]=E*O;return C}function m(C,D){const E=D[0];C[0]=D[3];C[1]=-D[1];C[2]=-D[2];C[3]=E;return C}function h(C){return C[0]*C[3]-C[2]*C[1]}function d(C,D,E){const F=D[0],G=D[1],O=D[2];D=D[3];const K=E[0],L=E[1],R=E[2];E=E[3];C[0]=F*K+O*L;C[1]=G*K+D*L;C[2]=F*R+O*E;C[3]=G*R+D*E;return C}function e(C,D,E){const F=D[0],G=D[1],O=D[2];D=D[3];const K=Math.sin(E);E=Math.cos(E);
C[0]=F*E+O*K;C[1]=G*E+D*K;C[2]=F*-K+O*E;C[3]=G*-K+D*E;return C}function g(C,D,E){const F=D[1],G=D[2],O=D[3],K=E[0];E=E[1];C[0]=D[0]*K;C[1]=F*K;C[2]=G*E;C[3]=O*E;return C}function p(C,D){const E=Math.sin(D);D=Math.cos(D);C[0]=D;C[1]=E;C[2]=-E;C[3]=D;return C}function t(C,D){C[0]=D[0];C[1]=0;C[2]=0;C[3]=D[1];return C}function q(C){return"mat2("+C[0]+", "+C[1]+", "+C[2]+", "+C[3]+")"}function k(C){return Math.sqrt(C[0]**2+C[1]**2+C[2]**2+C[3]**2)}function r(C,D,E,F){C[2]=F[2]/F[0];E[0]=F[0];E[1]=F[1];
E[3]=F[3]-C[2]*E[1];return[C,D,E]}function y(C,D,E){C[0]=D[0]+E[0];C[1]=D[1]+E[1];C[2]=D[2]+E[2];C[3]=D[3]+E[3];return C}function f(C,D,E){C[0]=D[0]-E[0];C[1]=D[1]-E[1];C[2]=D[2]-E[2];C[3]=D[3]-E[3];return C}function w(C,D){return C[0]===D[0]&&C[1]===D[1]&&C[2]===D[2]&&C[3]===D[3]}function z(C,D){const E=C[0],F=C[1],G=C[2];C=C[3];const O=D[0],K=D[1],L=D[2];D=D[3];return Math.abs(E-O)<=b.EPSILON*Math.max(1,Math.abs(E),Math.abs(O))&&Math.abs(F-K)<=b.EPSILON*Math.max(1,Math.abs(F),Math.abs(K))&&Math.abs(G-
L)<=b.EPSILON*Math.max(1,Math.abs(G),Math.abs(L))&&Math.abs(C-D)<=b.EPSILON*Math.max(1,Math.abs(C),Math.abs(D))}function A(C,D,E){C[0]=D[0]*E;C[1]=D[1]*E;C[2]=D[2]*E;C[3]=D[3]*E;return C}function x(C,D,E,F){C[0]=D[0]+E[0]*F;C[1]=D[1]+E[1]*F;C[2]=D[2]+E[2]*F;C[3]=D[3]+E[3]*F;return C}const B=Object.freeze(Object.defineProperty({__proto__:null,copy:c,identity:n,set:l,transpose:u,invert:v,adjoint:m,determinant:h,multiply:d,rotate:e,scale:g,fromRotation:p,fromScaling:t,str:q,frob:k,LDU:r,add:y,subtract:f,
exactEquals:w,equals:z,multiplyScalar:A,multiplyScalarAndAdd:x,mul:d,sub:f},Symbol.toStringTag,{value:"Module"}));a.LDU=r;a.add=y;a.adjoint=m;a.copy=c;a.determinant=h;a.equals=z;a.exactEquals=w;a.frob=k;a.fromRotation=p;a.fromScaling=t;a.identity=n;a.invert=v;a.mat2=B;a.mul=d;a.multiply=d;a.multiplyScalar=A;a.multiplyScalarAndAdd=x;a.rotate=e;a.scale=g;a.set=l;a.str=q;a.sub=f;a.subtract=f;a.transpose=u})},"esri/views/3d/webgl-engine/lib/PathGeometry":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers",
"./Geometry"],function(a,b,c){c=function(n){function l(u,v,m,h,d,e){u=n.call(this,u,v)||this;u.path=m;u.geometrySR=h;u.upVectorAlignment=d;u.stencilWidth=e;return u}b._inheritsLoose(l,n);return l}(c.Geometry);a.PathGeometry=c;a.isPathGeometry=function(n){return"upVectorAlignment"in n};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/pathGeometryUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../chunks/mat2 ../../../../chunks/mat2f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/plane ../../../../geometry/support/ray ./GeometryUtil ./VertexAttribute ../materials/internal/MaterialUtil".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){function r(){return{up:e.create(),right:e.create()}}let y=function(){function U(){this.pos=e.create();this.posES=e.create();this.posGS=e.create();this.vRight=e.create();this.vLeft=e.create();this.frame=r();this.rotationFrame=r();this.rotationRight=h.create();this.rotationAngle=0;this.miterStretch=l.create()}var W=U.prototype;W.setFrameFromUpVector=function(Q){d.copy(this.frame.up,Q);d.add(P,this.vLeft,this.vRight);d.normalize(P,P);d.scale(I,this.frame.up,
d.dot(P,this.frame.up));d.subtract(S,P,I);d.normalize(S,S);d.cross(this.frame.right,S,this.frame.up)};W.computeRotationAxisAndAngleFromUpVector=function(){d.copy(this.rotationFrame.up,this.frame.up);d.copy(this.rotationFrame.right,this.frame.right);m.set(this.rotationRight,1,0);d.scale(I,this.frame.up,d.dot(this.frame.up,this.vLeft));d.subtract(I,this.vLeft,I);d.negate(I,I);d.normalize(I,I);d.scale(P,this.frame.up,d.dot(this.frame.up,this.vRight));d.subtract(P,this.vRight,P);d.normalize(P,P);d.cross(N,
this.rotationFrame.up,this.vLeft);this.rotationAngle=Math.sign(d.dot(N,this.vRight))*(Math.PI-c.acosClamped(d.dot(I,P)));if(0<Math.abs(this.rotationAngle)){const Q=c.reciprocalClamped(Math.cos(.5*this.rotationAngle));n.set(this.miterStretch,1+(Q-1),0,0,1)}this.maxStretchDistance=Math.abs(Math.min(this.vLeftLength,this.vRightLength)/Math.cos(.5*(Math.PI-this.rotationAngle)))};return U}(),f=function(){function U(){this.vertices=[];this.vertexIndices=[];this.vertexNormals=[];this.poles=[];this.poleIndices=
[];this.uvIndices=this.uvs=null}var W=U.prototype;W.addVertex=function(Q,X){this.vertices.push(h.clone(Q));this.vertexNormals.push(h.clone(X));return this.vertices.length-1};W.addUV=function(Q){this.uvs||(this.uvs=[],this.uvIndices=[]);this.uvs.push(Q);return this.uvs.length-1};W.addPole=function(Q,X=null){this.poles.push({position:h.clone(Q),normal:X?h.clone(X):null});return this.poles.length-1};W.addSegment=function(Q,X=null,ba=null){this.vertexIndices.push(Q.v0);this.vertexIndices.push(Q.v1);X&&
(this.uvIndices.push(X.v0),this.uvIndices.push(X.v1));ba&&(this.poleIndices.push(ba.v0),this.poleIndices.push(ba.v1))};W.hasUV=function(){return null!=this.uvs};W.translate=function(Q,X){for(const ba of this.vertices)ba[0]+=Q,ba[1]+=X;for(const ba of this.poles)ba.position[0]+=Q,ba.position[1]+=X};U.circle=function(Q=20){const X=new U,ba={v0:0,v1:0};X.addPole(h.fromValues(0,0));for(var aa=0;aa<Q;++aa){var ea=2*aa*Math.PI/Q,ia=Math.cos(ea);const ka=Math.sin(ea);ea=h.fromValues(.5*ia,.5*ka);ia=h.fromValues(ia,
ka);X.addVertex(ea,ia);X.addUV(aa/Q)}X.addUV(1);for(aa=0;aa<Q-1;++aa)ia={v0:aa,v1:aa+1},X.addSegment(ia,ia,ba);X.addSegment({v0:Q-1,v1:0},{v0:Q-1,v1:Q},ba);return X};U.rect=function(){const Q=new U,X=h.fromValues(-.5,-.5),ba=h.fromValues(.5,-.5),aa=h.fromValues(.5,.5),ea=h.fromValues(-.5,.5),ia=h.fromValues(0,-1),ka=h.fromValues(1,0),la=h.fromValues(0,1),Z=h.fromValues(-1,0);Q.addUV(0);Q.addUV(1);Q.addPole(h.fromValues(0,.5),la);Q.addPole(h.fromValues(0,.5));Q.addPole(h.fromValues(0,-.5));Q.addPole(h.fromValues(0,
-.5),ia);const ca={v0:0,v1:1};Q.addVertex(X,ia);Q.addVertex(ba,ia);Q.addSegment({v0:0,v1:1},ca,{v0:3,v1:3});Q.addVertex(ba,ka);Q.addVertex(aa,ka);Q.addSegment({v0:2,v1:3},ca,{v0:2,v1:1});Q.addVertex(aa,la);Q.addVertex(ea,la);Q.addSegment({v0:4,v1:5},ca,{v0:0,v1:0});Q.addVertex(ea,Z);Q.addVertex(X,Z);Q.addSegment({v0:6,v1:7},ca,{v0:1,v1:2});return Q};b._createClass(U,[{key:"numSegments",get:function(){return this.vertexIndices.length/2}}]);return U}(),w=function(){function U(W){this.vertices=[];this.offset=
e.create();this.xform=v.create();this.vertices=W;d.copy(this.offset,this.vertices[Math.floor((W.length-1)/2)].pos);for(const Q of this.vertices)d.subtract(Q.pos,Q.pos,this.offset);u.translate(this.xform,this.xform,this.offset);this.updatePathVertexInformation()}U.prototype.updatePathVertexInformation=function(){const W=this.vertices.length;let Q=this.vertices[0];Q.index=0;d.set(Q.vLeft,0,0,0);Q.vLeftLength=0;d.subtract(Q.vRight,this.vertices[1].pos,Q.pos);Q.vRightLength=d.length(Q.vRight);d.normalize(Q.vRight,
Q.vRight);let X=Q;for(let ba=1;ba<W;++ba)Q=this.vertices[ba],Q.index=ba,d.copy(Q.vLeft,X.vRight),Q.vLeftLength=X.vRightLength,ba<W-1?(d.subtract(Q.vRight,this.vertices[ba+1].pos,Q.pos),Q.vRightLength=d.length(Q.vRight),d.normalize(Q.vRight,Q.vRight)):(d.copy(Q.vRight,Q.vLeft),Q.vRightLength=Q.vLeftLength),X=Q};return U}(),z=function(){function U(){}var W=U.prototype;W.numProfilesPerJoin=function(){return 1};W.extrude=function(Q,X,ba){for(let aa=0;aa<X.vertices.length;++aa)ba(Q.index,Q.frame,X.vertices[aa],
X.vertexNormals[aa],!1)};return U}(),A=function(){function U(Q=.8*Math.PI,X=1){this.cutoffAngle=Q;this.numBendSubdivisions=X}var W=U.prototype;W.numProfilesPerJoin=function(){return this.numBendSubdivisions+1};W.extrude=function(Q,X,ba){var aa=T;if(Math.abs(Q.rotationAngle)>=this.cutoffAngle)for(var ea=0;ea<this.numBendSubdivisions+1;++ea){u.fromRotation(H,.5*-Q.rotationAngle+ea*Q.rotationAngle/this.numBendSubdivisions,Q.rotationFrame.up);var ia=aa,ka=Q.frame,la=H;d.transformMat4(ia.up,ka.up,la);
d.transformMat4(ia.right,ka.right,la);for(ia=0;ia<X.vertices.length;++ia)0<=m.dot(X.vertices[ia],Q.rotationRight)*Q.rotationAngle?ba(Q.index,aa,X.vertices[ia],X.vertexNormals[ia],!1):(m.transformMat2(R,X.vertices[ia],Q.miterStretch),ba(Q.index,Q.frame,R,X.vertexNormals[ia],!0))}else for(aa=0;aa<this.numBendSubdivisions+1;++aa)for(ea=0;ea<X.vertices.length;++ea)ia=0<=m.dot(X.vertices[ea],Q.rotationRight)*Q.rotationAngle,m.transformMat2(R,X.vertices[ea],Q.miterStretch),ba(Q.index,Q.frame,R,X.vertexNormals[ea],
ia?!1:!0)};return U}();const x={generateUV:!1};let B=function(){function U(){}U.prototype.rebuildConnectingProfileGeometry=function(W,Q,X){for(let ba=0;ba<Q.vertices.length;++ba)X(W.index,W.frame,Q.vertices[ba],Q.vertexNormals[ba],0,0)};return U}(),C=function(U){function W(){return U.call(this)||this}b._inheritsLoose(W,U);var Q=W.prototype;Q.getNumVertices=function(){return 0};Q.getNumIndices=function(){return 0};Q.rebuildCapGeometry=function(){};Q.buildTopology=function(){};return W}(B),D=function(U){function W(X,
ba=0,aa=!1){var ea=U.call(this)||this;ea.profile=X;ea.profilePlaneOffset=ba;ea.flip=aa;return ea}b._inheritsLoose(W,U);var Q=W.prototype;Q.getNumVertices=function(){return this.profile.vertices.length};Q.getNumIndices=function(){return 3*this.profile.numSegments};Q.rebuildConnectingProfileGeometry=function(X,ba,aa){for(let ea=0;ea<ba.vertices.length;++ea)aa(X.index,X.frame,ba.vertices[ea],ba.vertexNormals[ea],this.profilePlaneOffset,0)};Q.rebuildCapGeometry=function(X,ba){const aa=M;m.set(aa,0,0);
const ea=this.flip?1:-1;for(let ia=0;ia<this.profile.vertices.length;++ia)ba(X.index,X.frame,this.profile.vertices[ia],aa,this.profilePlaneOffset,ea)};Q.buildTopology=function(X,ba){X=this.vertexBufferStart+this.profile.vertexIndices[0];for(let aa=1;aa<this.profile.numSegments;++aa){const ea=this.vertexBufferStart+this.profile.vertexIndices[2*aa],ia=this.vertexBufferStart+this.profile.vertexIndices[2*aa+1];this.flip?ba(ia,ea,X):ba(X,ea,ia)}};return W}(B),E=function(U){function W(X){var ba=U.call(this)||
this;ba.flip=!1;ba.sign=0;ba.breakNormals=!1;ba.numSegments=3;ba.profile=X.profile;ba.flip=X.flip;ba.sign=ba.flip?1:-1;ba.breakNormals=X.breakNormals;ba.numSegments=X.subdivisions;return ba}b._inheritsLoose(W,U);var Q=W.prototype;Q.getNumVertices=function(){let X=0;X=this.profile.vertices.length*(this.numSegments-1);this.breakNormals&&(X+=this.profile.vertices.length);return X+=this.profile.poles.length};Q.getNumIndices=function(){let X;X=2*this.profile.numSegments*(this.numSegments-1);for(let ba=
0;ba<this.profile.numSegments;++ba)X=this.profile.poleIndices[this.profile.vertexIndices[2*ba]]===this.profile.poleIndices[this.profile.vertexIndices[2*ba+1]]?X+1:X+2;return 3*X};Q.rebuildCapGeometry=function(X,ba){const aa=X.frame,ea=.5*this.sign,ia=R,ka=M;m.set(ka,0,0);for(var la=0;la<this.profile.poles.length;++la){var Z=this.profile.poles[la];Z.normal?ba(X.index,aa,Z.position,Z.normal,ea,0):ba(X.index,aa,Z.position,ka,ea,this.sign)}if(this.breakNormals)for(la=0;la<this.profile.vertices.length;++la)ba(X.index,
aa,this.profile.vertices[la],this.profile.vertexNormals[la],0,0);for(la=0;la<this.numSegments-1;++la){var ca=(1-(la+1)/this.numSegments)*Math.PI*.5;Z=Math.sin(ca);ca=Math.cos(ca);for(let Y=0;Y<this.profile.vertices.length;++Y){const da=this.profile.poles[this.profile.poleIndices[Y]];m.subtract(ia,this.profile.vertices[Y],da.position);m.scale(ia,ia,Z);da.normal?(m.add(ia,ia,da.position),ba(X.index,aa,ia,da.normal,ea*ca,0)):(m.normalize(ka,ia),m.scale(ka,ka,Z),m.add(ia,ia,da.position),ba(X.index,aa,
ia,ka,ea*ca,this.sign*ca))}}};Q.buildTopology=function(X,ba){X=this.breakNormals?this.vertexBufferStart+this.profile.poles.length:this.firstProfileVertexIndex;const aa=this.breakNormals?this.vertexBufferStart+this.profile.poles.length+this.profile.vertices.length:this.vertexBufferStart+this.profile.poles.length;for(let ea=0;ea<this.profile.numSegments;++ea){const ia=this.profile.vertexIndices[2*ea],ka=this.profile.vertexIndices[2*ea+1],la=this.vertexBufferStart+this.profile.poleIndices[ia],Z=this.vertexBufferStart+
this.profile.poleIndices[ka];let ca=X+ia,Y=X+ka;for(let da=0;da<this.numSegments-1;++da){const ha=aa+da*this.profile.vertices.length+ia,ja=aa+da*this.profile.vertices.length+ka;this.flip?(ba(ha,Y,ca),ba(Y,ha,ja)):(ba(ca,Y,ha),ba(ja,ha,Y));ca=ha;Y=ja}this.flip?(ba(la,Y,ca),la!==Z&&ba(la,Z,Y)):(ba(ca,Y,la),la!==Z&&ba(Y,Z,la))}};return W}(B),F=function(){function U(Q,X,ba,aa,ea,ia=x){this.options=ia;this.numUVTotal=this.numNormalsTotal=this.numVerticesTotal=this.numExtrusionProfiles=this._triangleCount=
this._extrusionVertexCount=0;this.profile=X;this.path=Q;this.extruder=ba;this.startCap=aa;this.endCap=ea;Q=this.path.vertices.length-2;this.numExtrusionProfiles=ba.numProfilesPerJoin()*Q+2;this.numNormalsTotal=this.numVerticesTotal=X.vertices.length*this.numExtrusionProfiles;this.startCap.vertexBufferStart=this.numVerticesTotal;X=this.startCap.getNumVertices();this.numVerticesTotal+=X;this.numNormalsTotal+=X;this.endCap.vertexBufferStart=this.numVerticesTotal;X=this.endCap.getNumVertices();this.numVerticesTotal+=
X;this.numNormalsTotal+=X;this.pathVertexData=new Float32Array(1*this.numVerticesTotal);this.profileRightAxisData=new Float32Array(4*this.numVerticesTotal);this.profileUpAxisData=new Float32Array(4*this.numVerticesTotal);this.profileVertexAndNormalData=new Float32Array(4*this.numVerticesTotal);this.profile.hasUV()&&this.options.generateUV&&(this.numUVTotal=this.profile.uvs.length,this.uvData=new Float32Array(2*this.numUVTotal));this.originData=new Float32Array(3*this.path.vertices.length);this._rebuildGeometry();
this.buildTopology()}var W=U.prototype;W.emitVertex=function(Q,X,ba,aa,ea){this.profileRightAxisData[4*this._extrusionVertexCount]=X.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=X.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=X.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=X.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+1]=X.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=X.up[2];this.profileVertexAndNormalData[4*
this._extrusionVertexCount]=ba[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=ba[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=aa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=aa[1];this.pathVertexData[this._extrusionVertexCount]=Q;ea?(Q=this.path.vertices[Q],this.profileRightAxisData[4*this._extrusionVertexCount+3]=Q.rotationRight[0]*Q.maxStretchDistance,this.profileUpAxisData[4*this._extrusionVertexCount+3]=Q.rotationRight[1]*Q.maxStretchDistance):
(this.profileRightAxisData[4*this._extrusionVertexCount+3]=0,this.profileUpAxisData[4*this._extrusionVertexCount+3]=0);++this._extrusionVertexCount};W.emitCapVertex=function(Q,X,ba,aa,ea,ia){this.profileRightAxisData[4*this._extrusionVertexCount]=X.right[0];this.profileRightAxisData[4*this._extrusionVertexCount+1]=X.right[1];this.profileRightAxisData[4*this._extrusionVertexCount+2]=X.right[2];this.profileUpAxisData[4*this._extrusionVertexCount]=X.up[0];this.profileUpAxisData[4*this._extrusionVertexCount+
1]=X.up[1];this.profileUpAxisData[4*this._extrusionVertexCount+2]=X.up[2];this.profileVertexAndNormalData[4*this._extrusionVertexCount]=ba[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+1]=ba[1];this.profileVertexAndNormalData[4*this._extrusionVertexCount+2]=aa[0];this.profileVertexAndNormalData[4*this._extrusionVertexCount+3]=aa[1];this.pathVertexData[this._extrusionVertexCount]=Q;this.profileRightAxisData[4*this._extrusionVertexCount+3]=ea;this.profileUpAxisData[4*this._extrusionVertexCount+
3]=ia;++this._extrusionVertexCount};W.emitTriangle=function(Q,X,ba){this.vertexIndices[3*this._triangleCount]=Q;this.vertexIndices[3*this._triangleCount+1]=X;this.vertexIndices[3*this._triangleCount+2]=ba;this.pathVertexIndices[3*this._triangleCount]=this.pathVertexData[Q];this.pathVertexIndices[3*this._triangleCount+1]=this.pathVertexData[X];this.pathVertexIndices[3*this._triangleCount+2]=this.pathVertexData[ba];this.normalIndices[3*this._triangleCount]=Q;this.normalIndices[3*this._triangleCount+
1]=X;this.normalIndices[3*this._triangleCount+2]=ba;++this._triangleCount};W._rebuildGeometry=function(){var Q=(aa,ea,ia,ka,la)=>this.emitVertex(aa,ea,ia,ka,la);const X=(aa,ea,ia,ka,la,Z)=>this.emitCapVertex(aa,ea,ia,ka,la,Z);this._extrusionVertexCount=0;for(var ba of this.path.vertices)this.originData[3*ba.index]=ba.pos[0],this.originData[3*ba.index+1]=ba.pos[1],this.originData[3*ba.index+2]=ba.pos[2];this.startCap.rebuildConnectingProfileGeometry(this.path.vertices[0],this.profile,X);for(ba=1;ba<
this.path.vertices.length-1;++ba)this.extruder.extrude(this.path.vertices[ba],this.profile,Q);this.endCap.rebuildConnectingProfileGeometry(this.path.vertices[this.path.vertices.length-1],this.profile,X);this.startCap.rebuildCapGeometry(this.path.vertices[0],X);this.endCap.rebuildCapGeometry(this.path.vertices[this.path.vertices.length-1],X);if(this.profile.hasUV()&&this.options.generateUV)for(Q=0;Q<this.profile.uvs.length;++Q)this.uvData[2*Q]=this.profile.uvs[Q],this.uvData[2*Q+1]=0};W.buildTopology=
function(){const Q=(ia,ka,la)=>this.emitTriangle(ia,ka,la);this._triangleCount=0;const X=this.profile.vertices.length,ba=this.profile.numSegments,aa=this.numExtrusionProfiles-1;var ea=ba*aa*6;this.startCap.indexBufferStart=ea;this.startCap.firstProfileVertexIndex=0;ea+=this.startCap.getNumIndices();this.endCap.indexBufferStart=ea;this.endCap.firstProfileVertexIndex=X*(this.numExtrusionProfiles-1);ea+=this.endCap.getNumIndices();this.vertexIndices=new Uint32Array(ea);this.normalIndices=new Uint32Array(ea);
this.pathVertexIndices=new Uint32Array(ea);this.profile.hasUV()&&this.options.generateUV&&(this.uvIndices=new Uint32Array(ea));for(ea=0;ea<ba;++ea){const ia=this.profile.vertexIndices[2*ea],ka=this.profile.vertexIndices[2*ea+1];for(let la=0;la<aa;++la){const Z=la*X+ia,ca=(la+1)*X+ka,Y=la*X+ka;Q(Z,(la+1)*X+ia,ca);Q(Z,ca,Y)}}this.startCap.buildTopology(this.path.vertices[0],Q);this.endCap.buildTopology(this.path.vertices[this.path.vertices.length-1],Q)};W.onPathChanged=function(){this._rebuildGeometry()};
return U}(),G=function(){function U(W){this.builder=W}U.prototype.onPathChanged=function(){this.builder.onPathChanged()};b._createClass(U,[{key:"xform",get:function(){return this.builder.path.xform}}]);return U}(),O=function(U){function W(X){X=U.call(this,X)||this;X.vertexAttributePosition=null;X.vertexAttributeNormal=null;X.vertexAttributeColor=null;X.vertexAttributePosition=new Float32Array(3*X.builder.numVerticesTotal);X.vertexAttributeNormal=new Float32Array(3*X.builder.numNormalsTotal);X.vertexAttributeColor=
new Uint8Array(4);X.vertexAttributeColor[0]=255;X.vertexAttributeColor[1]=255;X.vertexAttributeColor[2]=255;X.vertexAttributeColor[3]=255;return X}b._inheritsLoose(W,U);var Q=W.prototype;Q.bakeVertexColors=function(X){this.vertexAttributeColor[0]=255*X[0];this.vertexAttributeColor[1]=255*X[1];this.vertexAttributeColor[2]=255*X[2];this.vertexAttributeColor[3]=255*(3<X.length?X[3]:1)};Q.bake=function(X){this.size=X;for(let ia=0;ia<this.builder.numVerticesTotal;++ia){var ba=this.builder.pathVertexData[ia],
aa=0===ba||ba===this.builder.path.vertices.length-1;ba*=3;var ea=L;d.set(ea,this.builder.originData[ba++],this.builder.originData[ba++],this.builder.originData[ba]);ba=4*ia;const ka=I,la=R,Z=P,ca=N,Y=V;let da=0,ha=0;d.set(ca,this.builder.profileRightAxisData[ba],this.builder.profileRightAxisData[ba+1],this.builder.profileRightAxisData[ba+2]);d.set(Y,this.builder.profileUpAxisData[ba],this.builder.profileUpAxisData[ba+1],this.builder.profileUpAxisData[ba+2]);m.set(la,this.builder.profileVertexAndNormalData[ba]*
X[0],this.builder.profileVertexAndNormalData[ba+1]*X[1]);if(aa)d.cross(Z,Y,ca),da=this.builder.profileRightAxisData[ba+3]*X[0],ha=this.builder.profileUpAxisData[ba+3];else{aa=M;const ja=J;m.set(aa,this.builder.profileRightAxisData[ba+3],this.builder.profileUpAxisData[ba+3]);const ma=m.length(aa);m.normalize(aa,aa);const pa=m.dot(la,aa);if(Math.abs(pa)>ma){m.set(ja,-aa[1],aa[0]);const na=m.dot(la,ja);m.scale(aa,aa,ma*Math.sign(pa));m.scale(ja,ja,na);m.add(la,aa,ja)}d.set(Z,0,0,0)}d.set(ka,ca[0]*la[0]+
Y[0]*la[1],ca[1]*la[0]+Y[1]*la[1],ca[2]*la[0]+Y[2]*la[1]);this.vertexAttributePosition[3*ia]=ea[0]+ka[0]+Z[0]*da;this.vertexAttributePosition[3*ia+1]=ea[1]+ka[1]+Z[1]*da;this.vertexAttributePosition[3*ia+2]=ea[2]+ka[2]+Z[2]*da;ea=R;m.set(ea,this.builder.profileVertexAndNormalData[ba+2],this.builder.profileVertexAndNormalData[ba+3]);this.vertexAttributeNormal[3*ia]=ca[0]*ea[0]+Y[0]*ea[1]+Z[0]*ha;this.vertexAttributeNormal[3*ia+1]=ca[1]*ea[0]+Y[1]*ea[1]+Z[1]*ha;this.vertexAttributeNormal[3*ia+2]=ca[2]*
ea[0]+Y[2]*ea[1]+Z[2]*ha}};Q.createGeometryData=function(){const X=[[q.VertexAttribute.POSITION,this.builder.vertexIndices],[q.VertexAttribute.NORMAL,this.builder.normalIndices]],ba=[[q.VertexAttribute.POSITION,{size:3,data:this.vertexAttributePosition,exclusive:!0}],[q.VertexAttribute.NORMAL,{size:3,data:this.vertexAttributeNormal,exclusive:!0}]];this.vertexAttributeColor&&(X.push([q.VertexAttribute.COLOR,new Uint32Array(this.builder.vertexIndices.length)]),ba.push([q.VertexAttribute.COLOR,{size:4,
data:this.vertexAttributeColor}]));return{vertexAttributes:ba,indices:X}};Q.onPathChanged=function(){U.prototype.onPathChanged.call(this);this.bake(this.size)};Q.intersect=function(X,ba,aa){const ea=this.builder.vertexIndices;k.intersectTriangles(X,ba,0,ea.length/3,ea,{size:3,data:this.vertexAttributePosition},void 0,void 0,aa)};return W}(G),K=function(U){function W(Q,X,ba,aa){var ea=U.call(this,Q)||this;ea.sizeAttributeValue=X;ea.colorAttributeValue=ba;ea.opacityAttributeValue=aa;ea.vvData=null;
ea.baked=new O(Q);ea.vvData=new Float32Array(4*ea.builder.path.vertices.length);for(Q=0;Q<ea.builder.path.vertices.length;++Q)ea.vvData[4*Q]=X,ea.vvData[4*Q+1]=ba,ea.vvData[4*Q+2]=aa,ea.vvData[4*Q+3]=0===Q||Q===ea.builder.path.vertices.length-1?1:0;return ea}b._inheritsLoose(W,U);W.prototype.createGeometryData=function(){return{vertexAttributes:[[q.VertexAttribute.POSITION,{size:3,data:this.builder.originData,exclusive:!0}],[q.VertexAttribute.PROFILERIGHT,{size:4,data:this.builder.profileRightAxisData,
exclusive:!0}],[q.VertexAttribute.PROFILEUP,{size:4,data:this.builder.profileUpAxisData,exclusive:!0}],[q.VertexAttribute.PROFILEVERTEXANDNORMAL,{size:4,data:this.builder.profileVertexAndNormalData,exclusive:!0}],[q.VertexAttribute.FEATUREVALUE,{size:4,data:this.vvData,exclusive:!0}]],indices:[[q.VertexAttribute.POSITION,this.builder.pathVertexIndices],[q.VertexAttribute.PROFILERIGHT,this.builder.vertexIndices],[q.VertexAttribute.PROFILEUP,this.builder.vertexIndices],[q.VertexAttribute.PROFILEVERTEXANDNORMAL,
this.builder.vertexIndices],[q.VertexAttribute.FEATUREVALUE,this.builder.pathVertexIndices]]}};return W}(G);const L=e.create(),R=h.create(),M=h.create(),J=h.create(),I=e.create(),P=e.create(),N=e.create(),V=e.create(),S=e.create(),T=r(),H=v.create();a.Builder=F;a.CapBuilder=B;a.Extruder=function(){};a.FastUpdatePathGeometry=K;a.MiterExtruder=A;a.NoCapBuilder=C;a.Path=w;a.PathGeometryData=G;a.PathVertex=y;a.Profile=f;a.RoundCapBuilder=E;a.SimpleExtruder=z;a.StaticPathGeometry=O;a.TriangulationCapBuilder=
D;a.computeMinimumRotationTangentFrame=function(U,W){let Q=null;const X=U.vertices.length,ba=e.create(),aa=e.create(),ea=e.create(),ia=e.create(),ka=e.create(),la=e.create(),Z=g.create();let ca=U.vertices[0];d.copy(aa,W);d.set(ba,0,1,0);t.makeOrthoBasisDirUpFallback(ca.vRight,aa,ba,ba,ea,aa,.99619469809);d.copy(ca.frame.up,aa);d.copy(ca.frame.right,ea);Q=ca;for(W=1;W<X;++W){ca=U.vertices[W];d.add(ka,ca.vLeft,ca.vRight);let Y=d.length(ka);0<Y?(Y=1/Math.sqrt(Y),ka[0]*=Y,ka[1]*=Y,ka[2]*=Y):(ka[0]=ca.vRight[0],
ka[1]=ca.vRight[1],ka[2]=ca.vRight[2]);d.add(la,Q.pos,Q.frame.up);g.fromPositionAndNormal(ca.pos,ka,Z);g.intersectRay(Z,p.wrap(la,ca.vLeft),ia)?(d.subtract(ia,ia,ca.pos),d.normalize(aa,ia),d.cross(ea,ka,aa),d.normalize(ea,ea)):t.makeOrthoBasisDirUpFallback(ka,Q.frame.up,Q.frame.right,ba,ea,aa,.99619469809);d.copy(ca.frame.up,aa);d.copy(ca.frame.right,ea);Q=ca}};a.makeFrame=r;a.profileSpaceToVertexSpace=function(U,W,Q){U[0]=Q[0]*W.right[0]+Q[1]*W.up[0];U[1]=Q[0]*W.right[1]+Q[1]*W.up[1];U[2]=Q[0]*W.right[2]+
Q[1]*W.up[2]};a.vertexSpaceToProfileSpace=function(U,W,Q){m.set(U,d.dot(Q,W.right),d.dot(Q,W.up))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat2f64":function(){define(["exports"],function(a){function b(){return[1,0,0,1]}function c(v){return[v[0],v[1],v[2],v[3]]}function n(v,m,h,d){return[v,m,h,d]}function l(v,m){return new Float64Array(v,m,4)}const u=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l},
Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.mat2f64=u})},"esri/views/3d/webgl-engine/materials/PathMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/Normals.glsl ../lib/geometryDataUtils ../lib/GLMaterial ../lib/Material ../lib/PathGeometry ../lib/RenderPass ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PathTechnique ./internal/bufferWriterUtils ./internal/MaterialUtil".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){g=function(B){function C(E){E=B.call(this,E,new A)||this;E.supportsEdges=!0;E._vertexAttributeLocations=y.pathVertexAttributeLocations;E._configuration=new y.PathTechniqueConfiguration;E.vertexBufferLayout=C.getVertexBufferLayout(E.parameters);return E}b._inheritsLoose(C,B);var D=C.prototype;D.getConfiguration=function(E,F){this._configuration.output=E;this._configuration.vvSize=this.parameters.vvSizeEnabled;this._configuration.vvColor=this.parameters.vvColorEnabled;
this._configuration.vvOpacity=this.parameters.vvOpacityEnabled;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=this.parameters.transparent;this._configuration.hasOccludees=this.parameters.hasOccludees;if(E===m.ShaderOutput.Color||E===m.ShaderOutput.Alpha)this._configuration.doubleSidedMode=this.parameters.doubleSided&&"normal"===this.parameters.doubleSidedType?h.NormalsDoubleSidedMode.View:this.parameters.doubleSided&&"winding-order"===this.parameters.doubleSidedType?
h.NormalsDoubleSidedMode.WindingOrder:h.NormalsDoubleSidedMode.None,this._configuration.receiveShadows=this.parameters.receiveShadows,this._configuration.receiveAmbientOcclusion=F.ssaoHelper.ready?this.parameters.receiveSSAO:!1;this._configuration.transparencyPassType=F.transparencyPassType;this._configuration.hasMultipassTerrain=F.multipassTerrain.enabled;this._configuration.cullAboveGround=F.multipassTerrain.cullAboveGround;return this._configuration};D.isVisibleInPass=function(E){return E===t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||
E===t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT||E===t.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT?this.parameters.castShadows:!0};D.isVisible=function(){const E=this.parameters;return B.prototype.isVisible.call(this)?0<E.opacity:!1};D.intersect=function(E,F,G,O,K,L,R){if(p.isPathGeometry(E)){F=E.path;G=[this.parameters.size[0],this.parameters.size[1]];if(this.parameters.vvSizeEnabled){var M=this.parameters.vvSizeOffset,J=this.parameters.vvSizeFactor;const I=this.parameters.vvSizeMinSize,P=this.parameters.vvSizeMaxSize,
N=F.sizeAttributeValue;G[0]*=c.clamp(M[0]+N*J[0],I[0],P[0]);G[1]*=c.clamp(M[2]+N*J[2],I[2],P[2])}M=Math.max(G[0],G[1]);E=E.boundingInfo;n.isNone(E)?this._intersectTriangles(F,G,K,L,R):(E=l.fromValues(E.bbMin[0]-M,E.bbMin[1]-M,E.bbMin[2]-M,E.bbMax[0]+M,E.bbMax[1]+M,E.bbMax[2]+M),M=[L[0]-K[0],L[1]-K[1],L[2]-K[2]],J=Math.sqrt(M[0]*M[0]+M[1]*M[1]+M[2]*M[2]),w.intersectAabbInvDir(E,K,[J/M[0],J/M[1],J/M[2]],O.tolerance)&&this._intersectTriangles(F,G,K,L,R))}};D._intersectTriangles=function(E,F,G,O,K){E.baked.size&&
E.baked.size[0]===F[0]&&E.baked.size[1]===F[1]||E.baked.bake(F);E.baked.intersect(G,O,K)};D.computeAttachmentOrigin=function(E,F){E=E.vertexAttributes;if(!E)return null;E=E.get(r.VertexAttribute.POSITION);return d.computeAttachmentOriginLines(E,null,!1,F)};D.createBufferWriter=function(){return new x(this.vertexBufferLayout)};D.requiresSlot=function(E){return E===(this.parameters.transparent?q.RenderSlot.TRANSPARENT_MATERIAL:q.RenderSlot.OPAQUE_MATERIAL)||E===q.RenderSlot.DRAPED_MATERIAL};D.createGLMaterial=
function(E){return E.output===m.ShaderOutput.Color||E.output===m.ShaderOutput.Alpha||E.output===m.ShaderOutput.Depth||E.output===m.ShaderOutput.Normal||E.output===m.ShaderOutput.Highlight||E.output===m.ShaderOutput.Shadow&&this.parameters.castShadows?new z(E):null};C.getVertexBufferLayout=function(E){let F=v.newLayout().vec3f(r.VertexAttribute.POSITION).vec4f(r.VertexAttribute.PROFILERIGHT).vec4f(r.VertexAttribute.PROFILEUP).vec4f(r.VertexAttribute.PROFILEVERTEXANDNORMAL);if(E.vvColorEnabled||E.vvSizeEnabled||
E.vvOpacityEnabled)F=F.vec4f(r.VertexAttribute.FEATUREVALUE);return F};return C}(g.Material);let z=function(B){function C(){return B.apply(this,arguments)||this}b._inheritsLoose(C,B);var D=C.prototype;D._updateOccludeeState=function(E){E.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:E.hasOccludees})};D._updateShadowState=function(E){(n.isNone(this.technique)||E.shadowMap.enabled!==this.technique.configuration.receiveShadows)&&this._material.setParameters({receiveShadows:E.shadowMap.enabled})};
D.beginSlot=function(E){if(this._output===m.ShaderOutput.Color||this._output===m.ShaderOutput.Alpha)this._updateShadowState(E),this._updateOccludeeState(E);return this.ensureTechnique(y.PathTechnique,E)};return C}(e),A=function(B){function C(){var D=B.apply(this,arguments)||this;D.doubleSided=!1;D.doubleSidedType="normal";D.receiveSSAO=!0;D.receiveShadows=!1;D.castShadows=!0;D.hasSlicePlane=!1;D.transparent=!1;D.hasOccludees=!1;return D}b._inheritsLoose(C,B);return C}(y.PathPassParameters),x=function(){function B(D){this.vertexBufferLayout=
D}var C=B.prototype;C.allocate=function(D){return this.vertexBufferLayout.createBuffer(D)};C.elementCount=function(D){return D.indices.get(r.VertexAttribute.POSITION).length};C.write=function(D,E,F,G){const O=K=>{if(E.vertexAttributes.has(K)){const L=E.vertexAttributes.get(K),R=E.indices.get(K);k.assert(4===L.size);const M=F.getField(K,u.BufferViewVec4f);if(M)f.writeBufferVec4(R,L.data,M,G);else throw Error("unable to acquire view for "+K);}};O(r.VertexAttribute.PROFILERIGHT);O(r.VertexAttribute.PROFILEUP);
O(r.VertexAttribute.PROFILEVERTEXANDNORMAL);this.vertexBufferLayout.hasField(r.VertexAttribute.FEATUREVALUE)&&O(r.VertexAttribute.FEATUREVALUE);f.writeDefaultAttributes(E,this.vertexBufferLayout,D.transformation,D.invTranspTransformation,F,G)};return B}();a.PathMaterial=g;a.PathMaterialParameters=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PathTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/attributes/PathVertexPosition.glsl ../core/shaderLibrary/shading/Normals.glsl ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/util/DoublePrecision.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ./DefaultTechniqueConfiguration ../../../../chunks/Path.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A){const x=new Map([[f.VertexAttribute.POSITION,0],[f.VertexAttribute.PROFILERIGHT,1],[f.VertexAttribute.PROFILEUP,2],[f.VertexAttribute.PROFILEVERTEXANDNORMAL,3],[f.VertexAttribute.FEATUREVALUE,4]]);m=function(B){function C(){var D=B.apply(this,arguments)||this;D.ambient=l.fromValues(.2,.2,.2);D.diffuse=l.fromValues(.8,.8,.8);D.specular=l.fromValues(0,0,0);D.opacity=1;return D}c._inheritsLoose(C,B);return C}(m.PathVertexPositionPassParameters);p=
function(B){function C(){return B.apply(this,arguments)||this}c._inheritsLoose(C,B);var D=C.prototype;D.initializeConfiguration=function(E,F){F.spherical=E.viewingMode===u.ViewingMode.Global;F.doublePrecisionRequiresObfuscation=e.doublePrecisionRequiresObfuscation(E.rctx)};D.initializeProgram=function(E){const F=C.shader.get().build(this.configuration);return new r.Program(E.rctx,F,x)};D._setPipelineState=function(E){const F=this.configuration,G=E===q.TransparencyPassType.NONE,O=E===q.TransparencyPassType.FrontFace;
return A.makePipelineState({blending:F.output!==v.ShaderOutput.Color&&F.output!==v.ShaderOutput.Alpha||!F.transparent?null:G?k.blendingDefault:k.oitBlending(E),culling:(F.hasSlicePlane?!1:!F.transparent&&F.doubleSidedMode!==h.NormalsDoubleSidedMode.None)&&A.frontFaceCullingParams,depthTest:{func:k.oitDepthTest(E)},depthWrite:G||O?A.defaultDepthWriteParams:null,colorWrite:A.defaultColorWriteParams,stencilWrite:F.hasOccludees?y.stencilWriteMaskOn:null,stencilTest:F.hasOccludees?y.stencilBaseAllZerosParams:
null,polygonOffset:G||O?null:k.OITPolygonOffset})};D.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return C}(p.ShaderTechnique);p.shader=new g.ReloadableShaderModule(z.Path,()=>new Promise((B,C)=>a(["../shaders/Path.glsl"],B,C)));g=function(B){function C(){var D=B.apply(this,arguments)||this;D.output=v.ShaderOutput.Color;D.doubleSidedMode=h.NormalsDoubleSidedMode.None;D.transparencyPassType=q.TransparencyPassType.NONE;D.spherical=!1;D.receiveShadows=
!1;D.receiveAmbientOcclusion=!1;D.vvSize=!1;D.vvColor=!1;D.vvOpacity=!1;D.hasSlicePlane=!1;D.transparent=!1;D.hasOccludees=!1;D.hasMultipassTerrain=!1;D.cullAboveGround=!1;D.doublePrecisionRequiresObfuscation=!1;return D}c._inheritsLoose(C,B);return C}(w.DefaultTechniqueConfiguration);n.__decorate([t.parameter({count:v.ShaderOutput.COUNT})],g.prototype,"output",void 0);n.__decorate([t.parameter({count:h.NormalsDoubleSidedMode.COUNT})],g.prototype,"doubleSidedMode",void 0);n.__decorate([t.parameter({count:q.TransparencyPassType.COUNT})],
g.prototype,"transparencyPassType",void 0);n.__decorate([t.parameter()],g.prototype,"spherical",void 0);n.__decorate([t.parameter()],g.prototype,"receiveShadows",void 0);n.__decorate([t.parameter()],g.prototype,"receiveAmbientOcclusion",void 0);n.__decorate([t.parameter()],g.prototype,"vvSize",void 0);n.__decorate([t.parameter()],g.prototype,"vvColor",void 0);n.__decorate([t.parameter()],g.prototype,"vvOpacity",void 0);n.__decorate([t.parameter()],g.prototype,"hasSlicePlane",void 0);n.__decorate([t.parameter()],
g.prototype,"transparent",void 0);n.__decorate([t.parameter()],g.prototype,"hasOccludees",void 0);n.__decorate([t.parameter()],g.prototype,"hasMultipassTerrain",void 0);n.__decorate([t.parameter()],g.prototype,"cullAboveGround",void 0);n.__decorate([t.parameter()],g.prototype,"doublePrecisionRequiresObfuscation",void 0);n.__decorate([t.parameter({constValue:d.PBRMode.Disabled})],g.prototype,"pbrMode",void 0);n.__decorate([t.parameter({constValue:!0})],g.prototype,"hasVvInstancing",void 0);n.__decorate([t.parameter({constValue:!1})],
g.prototype,"useCustomDTRExponentForWater",void 0);n.__decorate([t.parameter({constValue:!1})],g.prototype,"useFillLights",void 0);b.PathPassParameters=m;b.PathTechnique=p;b.PathTechniqueConfiguration=g;b.pathVertexAttributeLocations=x;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ./PositionAttribute.glsl ../../shaderModules/Float2PassUniform ../../shaderModules/Float3PassUniform ../../shaderModules/Float4sPassUniform ../../shaderModules/FloatsPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute ../../../materials/VisualVariablePassParameters".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){let g=function(p){function t(){var q=p.apply(this,arguments)||this;q.size=c.fromValues(1,1);return q}b._inheritsLoose(t,p);return t}(e.VisualVariablePassParameters);a.PathVertexPosition=function(p,t){p.attributes.add(d.VertexAttribute.FEATUREVALUE,"vec4");const q=p.vertex;q.code.add(h.glsl`bool isCapVertex() {
return featureValue.w == 1.0;
}`);q.uniforms.add(new l.Float2PassUniform("size",k=>k.size));t.vvSize?(q.uniforms.add(new u.Float3PassUniform("vvSizeMinSize",k=>k.vvSizeMinSize)),q.uniforms.add(new u.Float3PassUniform("vvSizeMaxSize",k=>k.vvSizeMaxSize)),q.uniforms.add(new u.Float3PassUniform("vvSizeOffset",k=>k.vvSizeOffset)),q.uniforms.add(new u.Float3PassUniform("vvSizeFactor",k=>k.vvSizeFactor)),q.code.add(h.glsl`vec2 getSize() {
return size * clamp(vvSizeOffset + featureValue.x * vvSizeFactor, vvSizeMinSize, vvSizeMaxSize).xz;
}`)):q.code.add(h.glsl`vec2 getSize(){
return size;
}`);t.vvOpacity?(q.constants.add("vvOpacityNumber","int",8),q.uniforms.add([new m.FloatsPassUniform("vvOpacityValues",k=>k.vvOpacityValues,8),new m.FloatsPassUniform("vvOpacityOpacities",k=>k.vvOpacityOpacities,8)]),q.code.add(h.glsl`vec4 applyOpacity(vec4 color) {
float value = featureValue.z;
if (value <= vvOpacityValues[0]) {
return vec4( color.xyz, vvOpacityOpacities[0]);
}
for (int i = 1; i < vvOpacityNumber; ++i) {
if (vvOpacityValues[i] >= value) {
float f = (value - vvOpacityValues[i-1]) / (vvOpacityValues[i] - vvOpacityValues[i-1]);
return vec4( color.xyz, mix(vvOpacityOpacities[i-1], vvOpacityOpacities[i], f));
}
}
return vec4( color.xyz, vvOpacityOpacities[vvOpacityNumber - 1]);
}`)):q.code.add(h.glsl`vec4 applyOpacity(vec4 color){
return color;
}`);t.vvColor?(q.constants.add("vvColorNumber","int",e.vvColorNumber),q.uniforms.add([new m.FloatsPassUniform("vvColorValues",k=>k.vvColorValues,e.vvColorNumber),new v.Float4sPassUniform("vvColorColors",k=>k.vvColorColors,e.vvColorNumber)]),q.code.add(h.glsl`vec4 getColor() {
float value = featureValue.y;
if (value <= vvColorValues[0]) {
return applyOpacity(vvColorColors[0]);
}
for (int i = 1; i < vvColorNumber; ++i) {
if (vvColorValues[i] >= value) {
float f = (value - vvColorValues[i-1]) / (vvColorValues[i] - vvColorValues[i-1]);
return applyOpacity(mix(vvColorColors[i-1], vvColorColors[i], f));
}
}
return applyOpacity(vvColorColors[vvColorNumber - 1]);
}`)):q.code.add(h.glsl`vec4 getColor(){
return applyOpacity(vec4(1, 1, 1, 1));
}`);p.include(n.PositionAttribute);p.attributes.add(d.VertexAttribute.PROFILERIGHT,"vec4");p.attributes.add(d.VertexAttribute.PROFILEUP,"vec4");p.attributes.add(d.VertexAttribute.PROFILEVERTEXANDNORMAL,"vec4");q.code.add(h.glsl`vec3 calculateVPos() {
vec2 size = getSize();
vec3 origin = position;
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileVertex = profileVertexAndNormal.xy * size;
vec2 profileNormal = profileVertexAndNormal.zw;
float positionOffsetAlongProfilePlaneNormal = 0.0;
float normalOffsetAlongProfilePlaneNormal = 0.0;`);q.code.add(h.glsl`if(!isCapVertex()) {
vec2 rotationRight = vec2(profileRight.w, profileUp.w);
float maxDistance = length(rotationRight);`);q.code.add(h.glsl`rotationRight = maxDistance > 0.0 ? normalize(rotationRight) : vec2(0, 0);
float rx = dot(profileVertex, rotationRight);
if (abs(rx) > maxDistance) {
vec2 rotationUp = vec2(-rotationRight.y, rotationRight.x);
float ry = dot(profileVertex, rotationUp);
profileVertex = rotationRight * maxDistance * sign(rx) + rotationUp * ry;
}
}else{
positionOffsetAlongProfilePlaneNormal = profileRight.w * size[0];
normalOffsetAlongProfilePlaneNormal = profileUp.w;
}
vec3 offset = right * profileVertex.x + up * profileVertex.y + forward * positionOffsetAlongProfilePlaneNormal;
return origin + offset;
}`);q.code.add(h.glsl`vec3 localNormal() {
vec3 right = profileRight.xyz;
vec3 up = profileUp.xyz;
vec3 forward = cross(up, right);
vec2 profileNormal = profileVertexAndNormal.zw;
vec3 normal = right * profileNormal.x + up * profileNormal.y;
if(isCapVertex()) {
normal += forward * profileUp.w;
}
return normal;
}`)};a.PathVertexPositionPassParameters=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Path.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/PathVertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/Normals.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C){function D(F){const G=new x.ShaderBuilder,O=k.addProjViewLocalOrigin(G,F),{vertex:K,fragment:L}=G;G.varyings.add("vpos","vec3");G.include(u.PathVertexPosition,F);if(F.output===c.ShaderOutput.Color||F.output===c.ShaderOutput.Alpha)G.include(l.Transform),G.include(t.ReadShadowMapDraw,F),G.include(b.ForwardLinearDepth,F),G.varyings.add("vnormal","vec3"),G.varyings.add("vcolor","vec4"),F.hasMultipassTerrain&&G.varyings.add("depth","float"),K.code.add(z.glsl`
      void main() {
        vpos = calculateVPos();
        vnormal = normalize(localNormal());

        ${F.hasMultipassTerrain?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
        gl_Position = transformPosition(proj, view, vpos);

        ${F.output===c.ShaderOutput.Color?"forwardLinearDepth();":""}

        vcolor = getColor();
      }
    `);G.include(e.multipassTerrainTest,F);F.output===c.ShaderOutput.Alpha&&(G.include(n.SliceDraw,F),L.uniforms.add(new w.FloatPassUniform("opacity",R=>R.opacity)),L.code.add(z.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}
        float combinedOpacity = vcolor.a * opacity;
        gl_FragColor = vec4(combinedOpacity);
      }
    `));F.output===c.ShaderOutput.Color&&(G.include(n.SliceDraw,F),G.include(d.EvaluateSceneLighting,F),G.include(h.EvaluateAmbientOcclusion,F),G.include(t.ReadShadowMapDraw,F),G.include(g.Normals,F),k.addCameraPosition(L,F),L.uniforms.add([O,new y.Float3PassUniform("ambient",R=>R.ambient),new y.Float3PassUniform("diffuse",R=>R.diffuse),new y.Float3PassUniform("specular",R=>R.specular),new w.FloatPassUniform("opacity",R=>R.opacity),new w.FloatPassUniform("lightingGlobalFactor",(R,M)=>M.lighting.globalFactor),
new y.Float3PassUniform("lightingMainIntensity",(R,M)=>M.lighting.mainLight.intensity)]),L.constants.add("ambientBoostFactor","float",C.ambientBoost),L.include(q.ColorConversion),L.code.add(z.glsl`
      void main() {
        discardBySlice(vpos);
        ${F.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, depth);":""}

        shadingParams.viewDirection = normalize(vpos - cameraPosition);
        shadingParams.normalView = vnormal;
        vec3 normal = shadingNormal(shadingParams);
        float ssao = evaluateAmbientOcclusionInverse();

        float additionalAmbientScale = additionalDirectedAmbientLight(vpos + localOrigin);
        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor * lightingGlobalFactor;
        ${F.receiveShadows?"float shadow \x3d readShadowMap(vpos, linearDepth);":F.spherical?"float shadow \x3d lightingGlobalFactor * (1.0 - additionalAmbientScale);":"float shadow \x3d 0.0;"}
        vec3 albedo = vcolor.rgb * max(ambient, diffuse); // combine the old material parameters into a single one
        float combinedOpacity = vcolor.a * opacity;
        albedo += 0.25 * specular; // don't completely ignore specular for now

        vec3 shadedColor = evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight);
        gl_FragColor = vec4(shadedColor, combinedOpacity);
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
        ${F.transparencyPassType===B.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(F.output===c.ShaderOutput.Depth||F.output===c.ShaderOutput.Shadow)G.include(l.Transform,{hasModelTransformation:!1,linearDepth:!0}),K.uniforms.add(new r.Float2PassUniform("nearFar",(R,M)=>M.camera.nearFar)),G.varyings.add("depth","float"),K.code.add(z.glsl`void main() {
vpos = calculateVPos();
gl_Position = transformPositionWithDepth(proj, view, vpos, nearFar, depth);
}`),G.include(n.SliceDraw,F),G.include(v.OutputDepth,F),L.code.add(z.glsl`void main() {
discardBySlice(vpos);
outputDepth(depth);
}`);F.output===c.ShaderOutput.Normal&&(G.include(l.Transform),G.include(p.NormalUtils,F),K.uniforms.add(new A.Matrix4PassUniform("viewNormal",(R,M)=>M.camera.viewInverseTransposeMatrix)),G.varyings.add("vnormal","vec3"),K.code.add(z.glsl`void main(void) {
vpos = calculateVPos();
vnormal = normalize((viewNormal * vec4(localNormal(), 1.0)).xyz);
gl_Position = transformPosition(proj, view, vpos);
}`),G.include(n.SliceDraw,F),L.uniforms.add(new f.Float4Uniform("waterColor")),L.code.add(z.glsl`void main() {
discardBySlice(vpos);
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) normal = -normal;
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 1.0);
}`));F.output===c.ShaderOutput.Highlight&&(G.include(l.Transform),G.include(p.NormalUtils,F),G.varyings.add("vnormal","vec3"),K.code.add(z.glsl`void main(void) {
vpos = calculateVPos();
gl_Position = transformPosition(proj, view, vpos);
}`),G.include(n.SliceDraw,F),G.include(m.OutputHighlight),L.code.add(z.glsl`void main() {
discardBySlice(vpos);
outputHighlight();
}`));return G}const E=Object.freeze(Object.defineProperty({__proto__:null,build:D},Symbol.toStringTag,{value:"Module"}));a.Path=E;a.build=D})},"esri/views/3d/layers/graphics/Graphics3DPolygonFillSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec4 ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/buffer/BufferView ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./lineUtils ./polygonUtils ../support/patternUtils ../support/uvUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/lineStippleUtils ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/RibbonLineMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D){const E=["polyline","polygon","extent"];q=function(K){function L(M,J,I,P){M=K.call(this,M,J,I,P)||this;M._needsUV=!1;M._hasOutline=!1;return M}b._inheritsLoose(L,K);var R=L.prototype;R.doLoad=function(){var M=b._asyncToGenerator(function*(){});return function(){return M.apply(this,arguments)}}();R._ensureMaterials=function(){this._ensureFillMaterial();this._ensureOutlineMaterial()};R._ensureFillMaterial=function(){if(!n.isSome(this._material)){var M=
n.get(this.symbolLayer,"material","color");M=this._getCombinedOpacityAndColor(M);this._material=f.createMaterial(this.symbolLayer,{color:M,transparent:1>M[3]||this.needsDrivenTransparentPass,polygonOffset:!1,hasVertexColors:!0,writeLinearDepth:!0,hasSlicePlane:this._context.slicePlaneEnabled},{isDraped:this.draped});this._needsUV=this._material instanceof C.PatternMaterial;this._context.stage.add(this._material)}};R._ensureOutlineMaterial=function(){const M=this.symbolLayer.outline;!n.isSome(this._outlineMaterial)&&
this._isValidOutline(M)&&(this._hasOutline=!0,this._outlineMaterial=(J=>{const I=B.getStipplePatternForLinePattern(M.pattern);return new D.RibbonLineMaterial({width:J,color:this._getOutlineColor(),hasPolygonOffset:!0,hasSlicePlane:this._context.slicePlaneEnabled,isClosed:!0,stipplePattern:I,stippleScaleWithLineWidth:!0,cap:r.parseCapType(M.patternCap||"butt")})})(l.pt2px(M.size)),this._context.stage.add(this._outlineMaterial))};R._isValidOutline=function(M){return n.isSome(M)&&M.size&&0<M.size&&n.isSome(M.color)&&
(n.isNone(M.pattern)||"style"!==M.pattern.type||"none"!==M.pattern.style)};R.destroy=function(){K.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null;this._context.stage.remove(this._outlineMaterial);this._outlineMaterial=null};R.createGraphics3DGraphic=function(M){const J=M.graphic;if(!this._validateGeometry(J.geometry,E,this.symbolLayer.type))return null;M=this._getVertexOpacityAndColor(M.renderingInfo,255);const I=this.setGraphicElevationContext(J,new g.ElevationContext);
this.ensureDrapedStatus("on-the-ground"===I.mode);this._ensureMaterials();return this.draped?this._createAsOverlay(J,M):this._createAs3DShape(J,M,I)};R.layerOpacityChanged=function(){if(n.isSome(this._material)){var M=this._material.parameters.color,J=n.get(this.symbolLayer,"material","color");J=this._getCombinedOpacity(J);this._material.setParameters({color:[M[0],M[1],M[2],J],transparent:1>J||this.needsDrivenTransparentPass})}n.isSome(this._outlineMaterial)&&(M=this._outlineMaterial.parameters.color,
this._outlineMaterial.setParameters({color:[M[0],M[1],M[2],this._getOutlineOpacity()]}));return!0};R.layerElevationInfoChanged=function(M,J,I){const P=this._elevationContext.mode;I=e.elevationModeChangeUpdateType(L.elevationModeChangeTypes,I,P);if(I!==e.SymbolUpdateType.UPDATE)return I;const N=e.needsElevationUpdates2D(P);return this.updateGraphics3DGraphicElevationInfo(M,J,()=>N)};R.slicePlaneEnabledChanged=function(){n.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});
n.isSome(this._outlineMaterial)&&this._outlineMaterial.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};R.physicalBasedRenderingChanged=function(){return!0};R.pixelRatioChanged=function(){return!0};R._createAs3DShape=function(M,J,I){const P=y.geometryAsPolygon(M.geometry);if(n.isNone(P))return null;G.renderData=y.geometryToRenderInfo(P,this._context.elevationProvider,this._context.renderCoordsHelper,I);G.color=J;J=G.renderData.position.length/3;this._needsUV&&(G.uvMapSpace=
new Float32Array(4*J),G.boundingRect=new Float64Array(9*J));G.outNum=0;G.outGeometries=[];G.outTransforms=[];G.outMaterials=[];this._createAs3DShapeFill(G);this._hasOutline&&this._createAs3DShapeOutline(G);this._logGeometryCreationWarnings(G.renderData,P.rings,"rings","FillSymbol3DLayer");if(0===G.outNum)return null;this._needsUV&&w.createMapSpaceUVCoords(d.BufferViewVec4f.fromTypedArray(G.uvMapSpace),d.BufferViewVec3f64.fromTypedArray(G.renderData.position),this._context.renderCoordsHelper,d.BufferViewMat3f64.fromTypedArray(G.boundingRect));
M=new z.Object3D({geometries:G.outGeometries,materials:G.outMaterials,transformations:G.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:M.uid}});M=new t.Graphics3DObject3DGraphicLayer(this,M,G.outGeometries,null,null,f.uvElevationAligner,I);M.alignedSampledElevation=G.renderData.sampledElevation;M.needsElevationUpdates=e.needsElevationUpdates2D(I.mode);return M};R._createAs3DShapeFill=function(M){var J=M.renderData.polygons;for(const {position:I,mapPosition:P,holeIndices:N,
index:V,count:S}of J){if(n.isSome(this._context.clippingExtent)&&(h.empty(F),h.expandWithBuffer(F,P),!h.intersectsClippingArea(F,this._context.clippingExtent)))continue;J=u.earcut(P,N,3);0!==J.length&&(J=new Uint32Array(J),J=y.createColorGeometry({indices:J,attributeData:{position:I,color:M.color,mapPosition:P,uvMapSpace:this._needsUV?new Float32Array(M.uvMapSpace.buffer,4*V*M.uvMapSpace.BYTES_PER_ELEMENT,4*S):null,boundingRect:this._needsUV?new Float64Array(M.boundingRect.buffer,9*V*M.boundingRect.BYTES_PER_ELEMENT,
9*S):null}}),M.outGeometries.push(J),M.outMaterials.push(n.unwrap(this._material)),M.outTransforms.push(v.IDENTITY),M.outNum++)}};R._createAs3DShapeOutline=function(M){if(this._hasOutline){var J=M.renderData.outlines;for(let I=0;I<J.length;++I){const {mapPosition:P,position:N}=J[I];if(n.isSome(this._context.clippingExtent)&&(h.empty(F),h.expandWithBuffer(F,P),!h.intersectsClippingArea(F,this._context.clippingExtent)))continue;const V=r.createGeometry({overlayInfo:null,removeDuplicateStartEnd:r.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:N,mapPosition:P}}),S=V.vertexAttributes.get(x.VertexAttribute.POSITION);S.data===N&&(S.data=new Float64Array(N));M.outGeometries.push(V);M.outMaterials.push(n.unwrap(this._outlineMaterial));M.outTransforms.push(v.IDENTITY);M.outNum++}}};R._createAsOverlay=function(M,J){const I=y.geometryAsPolygon(M.geometry);if(n.isNone(I))return null;n.unwrap(this._material).renderPriority=this._renderPriority+this._renderPriorityStep/2;n.isSome(this._outlineMaterial)&&(this._outlineMaterial.renderPriority=
this._renderPriority);O.renderData=y.geometryToRenderInfoDraped(I,this._context.overlaySR);O.color=J;J=O.renderData.position.length/3;this._needsUV&&(O.uvMapSpace=new Float32Array(4*J));O.outNum=0;O.outGeometries=[];O.outBoundingBox=h.empty();O.layerUid=this._context.layer.uid;O.graphicsUid=M.uid;this._createAsOverlayFill(O);this._hasOutline&&this._createAsOverlayOutline(O);this._logGeometryCreationWarnings(O.renderData,I.rings,"rings","FillSymbol3DLayer");if(0===O.outNum)return null;this._needsUV&&
w.createMapSpaceUVCoordsDraped(d.BufferViewVec4f.fromTypedArray(O.uvMapSpace),d.BufferViewVec3f64.fromTypedArray(O.renderData.position),this._context.overlaySR,this._context.graphicsCoreOwner.view.state.viewingMode);return 0<O.outNum?new p(this,O.outGeometries,O.outBoundingBox,this._context.drapeSourceRenderer):null};R._createAsOverlayFill=function(M){var J=M.renderData.polygons;for(const {position:I,holeIndices:P,index:N,count:V}of J){h.empty(F);h.expandWithBuffer(F,I);if(!h.intersectsClippingArea(F,
this._context.clippingExtent))continue;J=u.earcut(I,P,3);if(0===J.length)continue;h.expandWithAABB(M.outBoundingBox,F);J=new Uint32Array(J);J=y.createColorGeometry({indices:J,attributeData:{position:I,color:M.color,uvMapSpace:this._needsUV?new Float32Array(M.uvMapSpace.buffer,4*N*M.uvMapSpace.BYTES_PER_ELEMENT,4*V):null}});J=new A.RenderGeometry(J,n.unwrap(this._material),{layerUid:M.layerUid,graphicUid:M.graphicsUid});const S=F;m.set(J.boundingSphere,.5*(S[0]+S[3]),.5*(S[1]+S[4]),0,.5*Math.sqrt((S[3]-
S[0])*(S[3]-S[0])+(S[4]-S[1])*(S[4]-S[1])));M.outGeometries.push(J);M.outNum++}};R._createAsOverlayOutline=function(M){if(this._hasOutline){var J=M.renderData.outlines;for(let P=0;P<J.length;++P){var {position:I}=J[P];h.empty(F);h.expandWithBuffer(F,I);if(!h.intersectsClippingArea(F,this._context.clippingExtent))continue;h.expandWithAABB(M.outBoundingBox,F);I=r.createGeometry({overlayInfo:{spatialReference:this._context.overlaySR,renderCoordsHelper:this._context.renderCoordsHelper},removeDuplicateStartEnd:r.RemoveDuplicateStartEnd.REMOVE,
attributeData:{position:I}});I=new A.RenderGeometry(I,n.unwrap(this._outlineMaterial),{layerUid:M.layerUid,graphicUid:M.graphicsUid});const N=F;m.set(I.boundingSphere,.5*(N[0]+N[3]),.5*(N[1]+N[4]),0,.5*Math.sqrt((N[3]-N[0])*(N[3]-N[0])+(N[4]-N[1])*(N[4]-N[1])));M.outGeometries.push(I);M.outNum++}}};R._getOutlineOpacity=function(){const M=n.get(this.symbolLayer,"outline","color");return(this.draped?1:this._getLayerOpacity())*(n.isSome(M)?M.a:0)};R._getOutlineColor=function(){const M=n.get(this.symbolLayer,
"outline","color"),J=this._getOutlineOpacity();return k.mixinColorAndOpacity(n.isSome(M)?c.toUnitRGB(M):null,J)};R.test=function(){return{...K.prototype.test.call(this),createAsOverlay:(M,J)=>this._createAsOverlay(M,J),createAs3DShape:(M,J,I)=>this._createAs3DShape(M,J,I)}};return L}(q.Graphics3DSymbolLayer);q.elevationModeChangeTypes={definedChanged:e.SymbolUpdateType.RECREATE,staysOnTheGround:e.SymbolUpdateType.NONE,onTheGroundChanged:e.SymbolUpdateType.RECREATE};const F=h.create(),G={renderData:null,
color:null,uvMapSpace:null,boundingRect:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},O={renderData:null,color:null,uvMapSpace:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DPolygonFillSymbolLayer=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/patternUtils":function(){define("exports ../../../../core/has ../../../../core/maybe ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../graphics/ElevationAligners ./uvUtils ../../webgl-engine/lib/VertexAttribute ../../webgl-engine/materials/ColorMaterial ../../webgl-engine/materials/PatternMaterial ../../webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(k,r,y){if(c.isSome(k)){if("none"===k.style||"solid"===k.style)return"none"===k.style&&(r.color=n.fromValues(0,0,0,0),r.transparent=!0),new h.ColorMaterial(r);r.style=p(k.style);r.draped=y.isDraped;return new d.PatternMaterial(r)}return new h.ColorMaterial(r)}function p(k){switch(k){case "horizontal":return e.Style.Horizontal;case "vertical":return e.Style.Vertical;case "cross":return e.Style.Cross;case "forward-diagonal":return e.Style.ForwardDiagonal;case "backward-diagonal":return e.Style.BackwardDiagonal;
case "diagonal-cross":return e.Style.DiagonalCross}}function t(k){return k.material instanceof d.PatternMaterial&&!k.material.parameters.draped}function q(k,r){if(t(k)){var y=k.geometry.vertexAttributes;k=y.get(m.VertexAttribute.POSITION).data;const f=y.get(m.VertexAttribute.UVMAPSPACE).data;y=y.get(m.VertexAttribute.BOUNDINGRECT).data;v.createMapSpaceUVCoords(l.BufferViewVec4f.fromTypedArray(f),l.BufferViewVec3f64.fromTypedArray(k),r,l.BufferViewMat3f64.fromTypedArray(y))}}a.createMaterial=function(k,
r,y){return g(k&&k.pattern||null,r,y)};a.createMaterialFromPattern=g;a.parsePatternStyle=p;a.requiresUVUpdates=t;a.updateMapSpaceUVCoords=q;a.uvElevationAligner=function(k,r,y,f){r=u.perVertexElevationAligner(k,r,y,f);k=k.stageObject.geometryRecords;for(y=0;y<k.length;y++)q(k[y],f);return r};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/uvUtils":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/plane ../../../../geometry/support/buffer/BufferView ../../../ViewingMode".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){function p(K,L,R,M,J,I,P){u.set(K,L*J[0]+R*I[0]+M*P[0],L*J[1]+R*I[1]+M*P[1],L*J[2]+R*I[2]+M*P[2])}const t=v.create(),q=v.create(),k=d.create(),r=v.create(),y=v.create(),f=v.create(),w=l.create(),z=l.create(),A=l.create(),x=v.create(),B=v.create(),C=v.create(),D=c.create(),E=v.create(),F=v.create(),G=v.create(),O=v.create();a.createMapSpaceUVCoords=function(K,L,R,M,J=1){u.set(r,1,0,0);u.set(y,0,1,0);u.set(f,0,0,1);u.set(O,0,0,0);for(var I=0;I<L.count-1;I++)L.getVec(I,
q),u.add(O,O,q);u.scale(t,O,1/(L.count-1));I=L.count-1;if(I=d.fromManyPointsSampleAt(L,k,0,Math.floor(I/3),Math.floor(2/3*I))){b.isSome(R)?(R.basisMatrixAtPosition(t,D),u.set(E,D[0],D[1],D[2]),u.set(F,D[4],D[5],D[6]),u.set(G,D[8],D[9],D[10])):(u.set(E,1,0,0),u.set(F,0,1,0),u.set(G,0,0,1));R=d.normal(k);0>u.dot(R,G)&&u.scale(R,R,-1);u.copy(f,R);I=u.dot(R,F);var P=u.dot(R,E);Math.abs(I)<Math.abs(P)?(u.scaleAndAdd(r,E,R,-P),u.normalize(r,r),u.cross(y,r,R),u.normalize(y,y),u.scale(y,y,-1)):(u.scaleAndAdd(y,
F,R,-I),u.normalize(y,y),u.cross(r,y,R),u.normalize(r,r))}n.set(w,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);n.set(z,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(R=0;R<L.count;R++)L.getVec(R,q),I=u.dot(r,q),P=u.dot(y,q),w[0]=Math.min(w[0],I),w[1]=Math.min(w[1],P),z[0]=Math.max(z[0],I),z[1]=Math.max(z[1],P);R=u.dot(f,t);p(x,w[0],w[1],R,r,y,f);p(B,z[0],w[1],R,r,y,f);p(C,w[0],z[1],R,r,y,f);u.subtract(B,B,x);u.scale(B,B,.5);u.subtract(C,C,x);u.scale(C,C,.5);u.add(x,x,B);u.add(x,x,C);
R=w[1]%J;A[0]=w[0]-w[0]%J;A[1]=w[1]-R;for(R=0;R<L.count;R++)for(L.getVec(R,q),K.setValues(R,(u.dot(r,q)-A[0])/J,(u.dot(y,q)-A[1])/J,A[0]/J,A[1]/J),I=0;3>I;I++)M.set(R,I,x[I]),M.set(R,I+3,B[I]),M.set(R,I+6,C[I])};a.createMapSpaceUVCoordsDraped=function(K,L,R,M,J=1){if(R.isGeographic&&M===g.ViewingMode.Global){M=new Float64Array(L.typedBuffer.length);const I=3*L.count;R=h.getReferenceEllipsoid(R);for(let P=0;P<I;P+=3)m.lonLatToWebMercatorComparable(L.typedBuffer,P,M,P,R);L=e.BufferViewVec3f64.fromTypedArray(M)}n.set(w,
Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);for(M=0;M<L.count;M++)L.getVec(M,q),w[0]=Math.min(w[0],q[0]),w[1]=Math.min(w[1],q[1]);M=w[1]%J;A[0]=w[0]-w[0]%J;A[1]=w[1]-M;for(M=0;M<L.count;M++)L.getVec(M,q),K.setValues(M,(q[0]-A[0])/J,(q[1]-A[1])/J,A[0]/J,A[1]/J)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/ColorMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/ColorMaterialTechnique ../shaders/ColorMaterialTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){let q=function(y){function f(z){z=y.call(this,z,new r)||this;z.supportsEdges=!0;z._configuration=new t.ColorMaterialTechniqueConfiguration;return z}b._inheritsLoose(f,y);var w=f.prototype;w.getConfiguration=function(z,A){this._configuration.output=z;this._configuration.cullFace=this.parameters.cullFace;this._configuration.hasVertexColors=this.parameters.hasVertexColors;this._configuration.hasSlicePlane=this.parameters.hasSlicePlane;this._configuration.transparent=
this.parameters.transparent;this._configuration.polygonOffset=this.parameters.polygonOffset;this._configuration.writeDepth=this.parameters.writeDepth;this._configuration.hasOccludees=this.parameters.hasOccludees;this._configuration.transparencyPassType=A.transparencyPassType;this._configuration.enableOffset=A.camera.relativeElevation<h.OITPolygonOffsetLimit;this._configuration.hasMultipassTerrain=A.multipassTerrain.enabled;this._configuration.cullAboveGround=A.multipassTerrain.cullAboveGround;return this._configuration};
w.intersect=function(z,A,x,B,C,D,E){g.intersectTriangleGeometry(z,A,B,C,D,void 0,E)};w.requiresSlot=function(z,A){return z===d.RenderSlot.DRAPED_MATERIAL?!0:v.outputFromPass(A)===n.ShaderOutput.Highlight?z===d.RenderSlot.OPAQUE_MATERIAL:z===(this.parameters.transparent?this.parameters.writeDepth?d.RenderSlot.TRANSPARENT_MATERIAL:d.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL:d.RenderSlot.OPAQUE_MATERIAL)};w.createGLMaterial=function(z){return z.output===n.ShaderOutput.Color||z.output===n.ShaderOutput.Alpha||
z.output===n.ShaderOutput.Highlight||z.output===n.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new k(z):null};w.createBufferWriter=function(){return new e.DefaultBufferWriter(e.PositionColorLayout)};return f}(m.Material),k=function(y){function f(){return y.apply(this,arguments)||this}b._inheritsLoose(f,y);var w=f.prototype;w._updateOccludeeState=function(z){z.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:z.hasOccludees})};w.beginSlot=function(z){this._output!==
n.ShaderOutput.Color&&this._output!==n.ShaderOutput.Alpha||this._updateOccludeeState(z);return this.ensureTechnique(p.ColorMaterialTechnique,z)};return f}(u),r=function(y){function f(){var w=y.apply(this,arguments)||this;w.color=c.ZEROS;w.transparent=!1;w.writeDepth=!0;w.writeLinearDepth=!1;w.hasVertexColors=!1;w.polygonOffset=!1;w.hasSlicePlane=!1;w.cullFace=l.CullFaceOptions.None;w.hasOccludees=!1;return w}b._inheritsLoose(f,y);return f}(m.MaterialParameters);a.ColorMaterial=q;a.Parameters=r;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../../../../chunks/ColorMaterial.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){u=function(q){function k(){return q.apply(this,arguments)||this}c._inheritsLoose(k,q);var r=k.prototype;r.initializeProgram=function(y){const f=k.shader.get().build(this.configuration);return new d.Program(y.rctx,f,m.Default3D)};r._createPipeline=function(y,f){const w=this.configuration,z=y===v.TransparencyPassType.NONE,A=y===v.TransparencyPassType.FrontFace;return p.makePipelineState({blending:w.output!==n.ShaderOutput.Color&&w.output!==n.ShaderOutput.Alpha||!w.transparent?
null:z?h.blendingDefault:h.oitBlending(y),culling:p.cullingParams(w.cullFace),depthTest:{func:h.oitDepthTest(y)},depthWrite:z||A?w.writeDepth&&p.defaultDepthWriteParams:null,colorWrite:p.defaultColorWriteParams,stencilWrite:w.hasOccludees?e.stencilWriteMaskOn:null,stencilTest:w.hasOccludees?f?e.stencilToolMaskBaseParams:e.stencilBaseAllZerosParams:null,polygonOffset:z||A?w.polygonOffset&&t:h.getOITPolygonOffset(w.enableOffset)})};r.initializePipeline=function(){this._occludeePipelineState=this._createPipeline(this.configuration.transparencyPassType,
!0);return this._createPipeline(this.configuration.transparencyPassType,!1)};r.getPipelineState=function(y,f){return f?this._occludeePipelineState:q.prototype.getPipelineState.call(this,y,f)};return k}(u.ShaderTechnique);u.shader=new l.ReloadableShaderModule(g.ColorMaterial,()=>new Promise((q,k)=>a(["./ColorMaterial.glsl"],q,k)));const t={factor:1,units:1};b.ColorMaterialTechnique=u;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ColorMaterial.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){function y(w){const z=new q.ShaderBuilder,A=w.output===b.ShaderOutput.Depth,x=w.hasMultipassTerrain&&(w.output===b.ShaderOutput.Color||w.output===b.ShaderOutput.Alpha);e.addProjViewLocalOrigin(z,w);z.include(n.Transform,{hasModelTransformation:!1,linearDepth:A});z.include(l.VertexColor,w);z.attributes.add(r.VertexAttribute.POSITION,"vec3");z.varyings.add("vpos","vec3");x&&z.varyings.add("depth","float");const {vertex:B,fragment:C}=z;A&&(z.include(u.OutputDepth,
w),B.uniforms.add(new g.Float2PassUniform("nearFar",(D,E)=>E.camera.nearFar)),z.varyings.add("linearDepth","float"));B.code.add(t.glsl`
    void main(void) {
      vpos = position;
      forwardNormalizedVertexColor();
      ${x?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      gl_Position = ${A?t.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:t.glsl`transformPosition(proj, view, vpos);`}
    }
  `);z.include(c.SliceDraw,w);x&&z.include(m.multipassTerrainTest,w);C.include(d.ColorConversion);C.uniforms.add(new p.Float4PassUniform("eColor",D=>D.color));w.output===b.ShaderOutput.Highlight&&z.include(v.OutputHighlight);C.code.add(t.glsl`
  void main() {
    discardBySlice(vpos);
    ${x?"terrainDepthTest(gl_FragCoord, depth);":""}
    vec4 fColor = ${w.hasVertexColors?"vColor * eColor;":"eColor;"}

    if (fColor.a < ${t.glsl.float(h.symbolAlphaCutoff)}) {
      discard;
    }

    ${w.output===b.ShaderOutput.Alpha?t.glsl`gl_FragColor = vec4(fColor.a);`:""}

    ${w.output===b.ShaderOutput.Color?t.glsl`gl_FragColor = highlightSlice(fColor, vpos); ${w.transparencyPassType===k.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
    ${w.output===b.ShaderOutput.Highlight?t.glsl`outputHighlight();`:""};
    ${w.output===b.ShaderOutput.Depth?t.glsl`outputDepth(linearDepth);`:""};
  }
  `);return z}const f=Object.freeze(Object.defineProperty({__proto__:null,build:y},Symbol.toStringTag,{value:"Module"}));a.ColorMaterial=f;a.build=y})},"esri/views/3d/webgl-engine/shaders/ColorMaterialTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../materials/DefaultTechniqueConfiguration".split(" "),function(a,
b,c,n,l,u,v){v=function(m){function h(){var d=m.apply(this,arguments)||this;d.output=n.ShaderOutput.Color;d.cullFace=u.CullFaceOptions.None;d.hasSlicePlane=!1;d.hasVertexColors=!1;d.transparent=!1;d.polygonOffset=!1;d.enableOffset=!0;d.writeDepth=!0;d.hasOccludees=!1;d.transparencyPassType=u.TransparencyPassType.NONE;d.hasMultipassTerrain=!1;d.cullAboveGround=!1;return d}b._inheritsLoose(h,m);return h}(v.DefaultTechniqueConfiguration);c.__decorate([l.parameter({count:n.ShaderOutput.COUNT})],v.prototype,
"output",void 0);c.__decorate([l.parameter({count:u.CullFaceOptions.COUNT})],v.prototype,"cullFace",void 0);c.__decorate([l.parameter()],v.prototype,"hasSlicePlane",void 0);c.__decorate([l.parameter()],v.prototype,"hasVertexColors",void 0);c.__decorate([l.parameter()],v.prototype,"transparent",void 0);c.__decorate([l.parameter()],v.prototype,"polygonOffset",void 0);c.__decorate([l.parameter()],v.prototype,"enableOffset",void 0);c.__decorate([l.parameter()],v.prototype,"writeDepth",void 0);c.__decorate([l.parameter()],
v.prototype,"hasOccludees",void 0);c.__decorate([l.parameter({count:u.TransparencyPassType.COUNT})],v.prototype,"transparencyPassType",void 0);c.__decorate([l.parameter()],v.prototype,"hasMultipassTerrain",void 0);c.__decorate([l.parameter()],v.prototype,"cullAboveGround",void 0);a.ColorMaterialTechniqueConfiguration=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PatternMaterial":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../../../../geometry/support/buffer/BufferView ../../support/buffer/InterleavedLayout ../core/shaderLibrary/ShaderOutputOptions ../lib/basicInterfaces ../lib/GLMaterial ../lib/GLMaterials ../lib/Material ../lib/OrderIndependentTransparency ../lib/RenderSlot ../lib/Util ../lib/VertexAttribute ./PatternStyle ./internal/bufferWriterUtils ./internal/DefaultBufferWriter ./internal/MaterialUtil ../shaders/PatternTechnique".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){let w=function(B){function C(E){E=B.call(this,E,new x)||this;E.supportsEdges=!0;E._vertexAttributeLocations=f.patternVertexAttributeLocations;E.techniqueConfig=new f.PatternTechniqueConfiguration;return E}b._inheritsLoose(C,B);var D=C.prototype;D.getConfiguration=function(E,F){this.techniqueConfig.output=E;this.techniqueConfig.cullFace=this.parameters.cullFace;this.techniqueConfig.hasVertexColors=this.parameters.hasVertexColors;this.techniqueConfig.hasSlicePlane=
this.parameters.hasSlicePlane;this.techniqueConfig.polygonOffset=this.parameters.polygonOffset;this.techniqueConfig.writeDepth=this.parameters.writeDepth;this.techniqueConfig.style=this.parameters.style;this.techniqueConfig.patternSpacing=this.parameters.patternSpacing;this.techniqueConfig.lineWidth=this.parameters.lineWidth;this.techniqueConfig.draped=this.parameters.draped;this.techniqueConfig.transparencyPassType=F.transparencyPassType;this.techniqueConfig.enableOffset=F.camera.relativeElevation<
e.OITPolygonOffsetLimit;this.techniqueConfig.hasMultipassTerrain=F.multipassTerrain.enabled;this.techniqueConfig.cullAboveGround=F.multipassTerrain.cullAboveGround;return this.techniqueConfig};D.intersect=function(E,F,G,O,K,L,R){y.intersectTriangleGeometry(E,F,O,K,L,void 0,R)};D.requiresSlot=function(E,F){return E===g.RenderSlot.DRAPED_MATERIAL?!0:h.outputFromPass(F)===u.ShaderOutput.Highlight?E===g.RenderSlot.OPAQUE_MATERIAL:E===(this.parameters.writeDepth?g.RenderSlot.TRANSPARENT_MATERIAL:g.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL)};
D.createGLMaterial=function(E){return E.output===u.ShaderOutput.Color||E.output===u.ShaderOutput.Alpha||E.output===u.ShaderOutput.Highlight||E.output===u.ShaderOutput.Depth&&this.parameters.writeLinearDepth?new z(E):null};D.createBufferWriter=function(){const E=l.newLayout().vec3f(t.VertexAttribute.POSITION).vec4u8(t.VertexAttribute.COLOR).vec4f(t.VertexAttribute.UVMAPSPACE);this.parameters.draped||E.mat3f(t.VertexAttribute.BOUNDINGRECT);return new A(E)};return C}(d.Material),z=function(B){function C(){return B.apply(this,
arguments)||this}b._inheritsLoose(C,B);var D=C.prototype;D._updateParameters=function(E){return this.ensureTechnique(f.PatternTechnique,E)};D._updateOccludeeState=function(E){E.hasOccludees!==this._material.parameters.hasOccludees&&this._material.setParameters({hasOccludees:E.hasOccludees})};D.beginSlot=function(E){this._output!==u.ShaderOutput.Color&&this._output!==u.ShaderOutput.Alpha||this._updateOccludeeState(E);return this._updateParameters(E)};return C}(m),A=function(B){function C(){return B.apply(this,
arguments)||this}b._inheritsLoose(C,B);var D=C.prototype;D.write=function(E,F,G,O){for(const L of this.vertexBufferLayout.fieldNames){const R=F.vertexAttributes.get(L),M=F.indices.get(L);if(R&&M)switch(L){case t.VertexAttribute.POSITION:p.assert(3===R.size);var K=G.getField(L,n.BufferViewVec3f);K&&k.writePosition(M,R.data,E.transformation,K,O);break;case t.VertexAttribute.COLOR:p.assert(3===R.size||4===R.size);(K=G.getField(L,n.BufferViewVec4u8))&&k.writeColor(M,R.data,R.size,K,O);break;case t.VertexAttribute.UVMAPSPACE:p.assert(4===
R.size);(K=G.getField(L,n.BufferViewVec4f))&&k.writeBufferVec4(M,R.data,K,O);break;case t.VertexAttribute.BOUNDINGRECT:p.assert(9===R.size),(K=G.getField(L,n.BufferViewMat3f))&&this.writeBoundingRect(M,R.data,E.transformation,K,O)}}};D.writeBoundingRect=function(E,F,G,O,K){const L=O.typedBuffer;O=O.typedBufferStride;const R=E.length;K*=O;for(let J=0;J<R;++J){const I=9*E[J];var M=F[I];const P=F[I+1],N=F[I+2];L[K]=G[0]*M+G[4]*P+G[8]*N+G[12];L[K+1]=G[1]*M+G[5]*P+G[9]*N+G[13];L[K+2]=G[2]*M+G[6]*P+G[10]*
N+G[14];for(M=3;9>M;++M)L[K+M]=F[I+M];K+=O}};return C}(r.DefaultBufferWriter),x=function(B){function C(){var D=B.apply(this,arguments)||this;D.color=c.fromValues(1,1,1,1);D.writeDepth=!0;D.writeLinearDepth=!1;D.hasVertexColors=!1;D.polygonOffset=!1;D.hasSlicePlane=!1;D.cullFace=v.CullFaceOptions.None;D.hasOccludees=!1;D.style=q.Style.Cross;D.patternSpacing=10;D.lineWidth=1;D.draped=!0;return D}b._inheritsLoose(C,B);return C}(d.MaterialParameters);a.Parameters=x;a.PatternMaterial=w;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/PatternStyle":function(){define(["exports"],function(a){a.Style=void 0;var b=a.Style||(a.Style={});b[b.Horizontal=0]="Horizontal";b[b.Vertical=1]="Vertical";b[b.Cross=2]="Cross";b[b.ForwardDiagonal=3]="ForwardDiagonal";b[b.BackwardDiagonal=4]="BackwardDiagonal";b[b.DiagonalCross=5]="DiagonalCross";b[b.COUNT=6]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/shaders/PatternTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../core/shaderLibrary/ShaderOutputOptions ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../core/shaderTechnique/ShaderTechniqueConfiguration ../lib/basicInterfaces ../lib/OrderIndependentTransparency ../lib/Program ../lib/StencilUtils ../lib/VertexAttribute ../materials/DefaultTechniqueConfiguration ../materials/PatternStyle ../../../../chunks/Pattern.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){v=function(w){function z(){return w.apply(this,arguments)||this}c._inheritsLoose(z,w);var A=z.prototype;A.initializeProgram=function(x){const B=z.shader.get().build(this.configuration);return new e.Program(x.rctx,B,f)};A._setPipelineState=function(x,B){const C=this.configuration,D=x===h.TransparencyPassType.NONE,E=x===h.TransparencyPassType.FrontFace;return r.makePipelineState({blending:C.output===l.ShaderOutput.Color||C.output===l.ShaderOutput.Alpha?D?
d.blendingDefault:d.oitBlending(x):null,culling:r.cullingParams(C.cullFace),depthTest:{func:d.oitDepthTest(x)},depthWrite:D?C.writeDepth&&r.defaultDepthWriteParams:d.oitDepthWrite(x),colorWrite:r.defaultColorWriteParams,stencilWrite:C.hasOccludees?g.stencilWriteMaskOn:null,stencilTest:C.hasOccludees?B?g.stencilToolMaskBaseParams:g.stencilBaseAllZerosParams:null,polygonOffset:D||E?C.polygonOffset&&y:d.getOITPolygonOffset(C.enableOffset)})};A.initializePipeline=function(){this._occludeePipelineState=
this._setPipelineState(this.configuration.transparencyPassType,!0);return this._setPipelineState(this.configuration.transparencyPassType,!1)};A.getPipelineState=function(x,B){return B?this._occludeePipelineState:w.prototype.getPipelineState.call(this,x,B)};return z}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(k.Pattern,()=>new Promise((w,z)=>a(["./Pattern.glsl"],w,z)));const y={factor:1,units:1};u=function(w){function z(){var A=w.apply(this,arguments)||this;A.output=l.ShaderOutput.Color;
A.cullFace=h.CullFaceOptions.None;A.transparencyPassType=h.TransparencyPassType.NONE;A.hasSlicePlane=!1;A.hasVertexColors=!1;A.polygonOffset=!1;A.writeDepth=!0;A.hasOccludees=!1;A.enableOffset=!0;A.hasMultipassTerrain=!1;A.cullAboveGround=!1;return A}c._inheritsLoose(z,w);return z}(t.DefaultTechniqueConfiguration);n.__decorate([m.parameter({count:l.ShaderOutput.COUNT})],u.prototype,"output",void 0);n.__decorate([m.parameter({count:h.CullFaceOptions.COUNT})],u.prototype,"cullFace",void 0);n.__decorate([m.parameter({count:q.Style.COUNT})],
u.prototype,"style",void 0);n.__decorate([m.parameter({count:h.TransparencyPassType.COUNT})],u.prototype,"transparencyPassType",void 0);n.__decorate([m.parameter()],u.prototype,"hasSlicePlane",void 0);n.__decorate([m.parameter()],u.prototype,"hasVertexColors",void 0);n.__decorate([m.parameter()],u.prototype,"polygonOffset",void 0);n.__decorate([m.parameter()],u.prototype,"writeDepth",void 0);n.__decorate([m.parameter()],u.prototype,"hasOccludees",void 0);n.__decorate([m.parameter()],u.prototype,"patternSpacing",
void 0);n.__decorate([m.parameter()],u.prototype,"lineWidth",void 0);n.__decorate([m.parameter()],u.prototype,"enableOffset",void 0);n.__decorate([m.parameter()],u.prototype,"draped",void 0);n.__decorate([m.parameter()],u.prototype,"hasMultipassTerrain",void 0);n.__decorate([m.parameter()],u.prototype,"cullAboveGround",void 0);const f=new Map([[p.VertexAttribute.POSITION,0],[p.VertexAttribute.COLOR,3],[p.VertexAttribute.UVMAPSPACE,4],[p.VertexAttribute.BOUNDINGRECT,5]]);b.PatternTechnique=v;b.PatternTechniqueConfiguration=
u;b.patternVertexAttributeLocations=f;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Pattern.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/View.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/materials/PatternStyle".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){function w(x){const B=new k.ShaderBuilder,C=x.hasMultipassTerrain&&(x.output===b.ShaderOutput.Color||x.output===b.ShaderOutput.Alpha);x.draped||B.extensions.add("GL_OES_standard_derivatives");const D=x.output===b.ShaderOutput.Depth,{vertex:E,fragment:F}=B;e.addProjViewLocalOrigin(B,x);B.include(n.Transform,{hasModelTransformation:!1,linearDepth:D});B.include(l.VertexColor,x);D&&(B.include(u.OutputDepth,x),E.uniforms.add(new g.Float2PassUniform("nearFar",
(O,K)=>K.camera.nearFar)),B.varyings.add("linearDepth","float"));x.draped?E.uniforms.add(new t.FloatPassUniform("worldToScreenRatio",(O,K)=>1/K.screenToPCSRatio)):B.attributes.add(y.VertexAttribute.BOUNDINGRECT,"mat3");B.attributes.add(y.VertexAttribute.POSITION,"vec3");B.attributes.add(y.VertexAttribute.UVMAPSPACE,"vec4");B.varyings.add("vpos","vec3");B.varyings.add("vuv","vec2");C&&B.varyings.add("depth","float");const G=x.style===f.Style.ForwardDiagonal||x.style===f.Style.BackwardDiagonal||x.style===
f.Style.DiagonalCross;G&&E.code.add(q.glsl`
      const mat2 rotate45 = mat2(${q.glsl.float(.70710678118)}, ${q.glsl.float(-.70710678118)},
                                 ${q.glsl.float(.70710678118)}, ${q.glsl.float(.70710678118)});
    `);x.draped||(e.addCameraPosition(E,x),E.uniforms.add(new t.FloatPassUniform("worldToScreenPerDistanceRatio",(O,K)=>1/K.camera.perScreenPixelRatio)),E.code.add(q.glsl`vec3 projectPointToLineSegment(vec3 center, vec3 halfVector, vec3 point) {
float projectedLength = dot(halfVector, point - center) / dot(halfVector, halfVector);
return center + halfVector * clamp(projectedLength, -1.0, 1.0);
}`),E.code.add(q.glsl`vec3 intersectRayPlane(vec3 rayDir, vec3 rayOrigin, vec3 planeNormal, vec3 planePoint) {
float d = dot(planeNormal, planePoint);
float t = (d - dot(planeNormal, rayOrigin)) / dot(planeNormal, rayDir);
return rayOrigin + t * rayDir;
}`),E.code.add(q.glsl`
      float boundingRectDistanceToCamera() {
        vec3 center = vec3(boundingRect[0][0], boundingRect[0][1], boundingRect[0][2]);
        vec3 halfU = vec3(boundingRect[1][0], boundingRect[1][1], boundingRect[1][2]);
        vec3 halfV = vec3(boundingRect[2][0], boundingRect[2][1], boundingRect[2][2]);
        vec3 n = normalize(cross(halfU, halfV));

        vec3 viewDir = - vec3(view[0][2], view[1][2], view[2][2]);

        float viewAngle = dot(viewDir, n);
        float minViewAngle = ${q.glsl.float(.08715574274)};

        if (abs(viewAngle) < minViewAngle) {
          // view direction is (almost) parallel to plane -> clamp it to min angle
          float normalComponent = sign(viewAngle) * minViewAngle - viewAngle;
          viewDir = normalize(viewDir + normalComponent * n);
        }

        // intersect view direction with infinite plane that contains bounding rect
        vec3 planeProjected = intersectRayPlane(viewDir, cameraPosition, n, center);

        // clip to bounds by projecting to u and v line segments individually
        vec3 uProjected = projectPointToLineSegment(center, halfU, planeProjected);
        vec3 vProjected = projectPointToLineSegment(center, halfV, planeProjected);

        // use to calculate the closest point to camera on bounding rect
        vec3 closestPoint = uProjected + vProjected - center;

        return length(closestPoint - cameraPosition);
      }
    `));E.code.add(q.glsl`
    vec2 scaledUV() {
      vec2 uv = uvMapSpace.xy ${G?" * rotate45":""};
      vec2 uvCellOrigin = uvMapSpace.zw ${G?" * rotate45":""};

      ${x.draped?"":q.glsl`
            float distanceToCamera = boundingRectDistanceToCamera();
            float worldToScreenRatio = worldToScreenPerDistanceRatio / distanceToCamera;
          `}

      // Logarithmically discretize ratio to avoid jittering
      float step = 0.1;
      float discreteWorldToScreenRatio = log(worldToScreenRatio);
      discreteWorldToScreenRatio = ceil(discreteWorldToScreenRatio / step) * step;
      discreteWorldToScreenRatio = exp(discreteWorldToScreenRatio);

      vec2 uvOffset = mod(uvCellOrigin * discreteWorldToScreenRatio, ${q.glsl.float(x.patternSpacing)});
      return uvOffset + (uv * discreteWorldToScreenRatio);
    }
  `);E.code.add(q.glsl`
    void main(void) {
      vuv = scaledUV();
      vpos = position;
      ${C?"depth \x3d (view * vec4(vpos, 1.0)).z;":""}
      forwardNormalizedVertexColor();
      gl_Position = ${D?q.glsl`transformPositionWithDepth(proj, view, vpos, nearFar, linearDepth);`:q.glsl`transformPosition(proj, view, vpos);`}
    }
  `);B.include(c.SliceDraw,x);F.include(d.ColorConversion);x.draped&&F.uniforms.add(new t.FloatPassUniform("texelSize",(O,K)=>1/K.camera.pixelRatio));x.output===b.ShaderOutput.Highlight&&B.include(v.OutputHighlight);C&&B.include(m.multipassTerrainTest,x);x.output!==b.ShaderOutput.Highlight&&(F.code.add(q.glsl`
      const float lineWidth = ${q.glsl.float(x.lineWidth)};
      const float spacing = ${q.glsl.float(x.patternSpacing)};
      const float spacingINV = ${q.glsl.float(1/x.patternSpacing)};

      float coverage(float p, float txlSize) {
        p = mod(p, spacing);

        float halfTxlSize = txlSize / 2.0;

        float start = p - halfTxlSize;
        float end = p + halfTxlSize;

        float coverage = (ceil(end * spacingINV) - floor(start * spacingINV)) * lineWidth;
        coverage -= min(lineWidth, mod(start, spacing));
        coverage -= max(lineWidth - mod(end, spacing), 0.0);

        return coverage / txlSize;
      }
    `),x.draped||F.code.add(q.glsl`const int maxSamples = 5;
float sample(float p) {
vec2 dxdy = abs(vec2(dFdx(p), dFdy(p)));
float fwidth = dxdy.x + dxdy.y;
ivec2 samples = 1 + ivec2(clamp(dxdy, 0.0, float(maxSamples - 1)));
vec2 invSamples = 1.0 / vec2(samples);
float accumulator = 0.0;
for (int j = 0; j < maxSamples; j++) {
if(j >= samples.y) {
break;
}
for (int i = 0; i < maxSamples; i++) {
if(i >= samples.x) {
break;
}
vec2 step = vec2(i,j) * invSamples - 0.5;
accumulator += coverage(p + step.x * dxdy.x + step.y * dxdy.y, fwidth);
}
}
accumulator /= float(samples.x * samples.y);
return accumulator;
}`));F.uniforms.add(new p.Float4PassUniform("uColor",O=>O.color));F.code.add(q.glsl`
    void main() {
      discardBySlice(vpos);
      ${C?"terrainDepthTest(gl_FragCoord, depth);":""}
      vec4 color = ${x.hasVertexColors?"vColor * uColor;":"uColor;"}
      color = highlightSlice(color, vpos);

      ${x.output!==b.ShaderOutput.Highlight?q.glsl`color.a *= ${z(x)};`:""}

      if (color.a < ${q.glsl.float(h.symbolAlphaCutoff)}) {
        discard;
      }

      ${x.output===b.ShaderOutput.Alpha?q.glsl`gl_FragColor = vec4(color.a);`:""}

      ${x.output===b.ShaderOutput.Color?q.glsl`gl_FragColor = color; ${x.transparencyPassType===r.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}`:""}
      ${x.output===b.ShaderOutput.Highlight?q.glsl`outputHighlight();`:""}
      ${x.output===b.ShaderOutput.Depth?q.glsl`outputDepth(linearDepth);`:""};
    }
  `);return B}function z(x){function B(C){return x.draped?q.glsl`coverage(vuv.${C}, texelSize)`:q.glsl`sample(vuv.${C})`}switch(x.style){case f.Style.ForwardDiagonal:case f.Style.Horizontal:return B("y");case f.Style.BackwardDiagonal:case f.Style.Vertical:return B("x");case f.Style.DiagonalCross:case f.Style.Cross:return q.glsl`
        1.0 - (1.0 - ${B("x")}) * (1.0 - ${B("y")})
      `;default:return"0.0"}}const A=Object.freeze(Object.defineProperty({__proto__:null,build:w},Symbol.toStringTag,{value:"Module"}));a.Pattern=A;a.build=w})},"esri/views/3d/layers/graphics/Graphics3DTextSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Error ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/screenUtils ../../../../chunks/vec2f64 ../../../../symbols/callouts/calloutUtils ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./graphicUtils ./placementUtils ./pointUtils ../../webgl-engine/lib/GeometryUtil ../../webgl-engine/lib/TextRenderParameters ../../webgl-engine/lib/TextTextureFactory ../../webgl-engine/materials/HUDMaterial".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){function z(D,E,F){D&&D.forEach(G=>{const O=E(G);n.isSome(O)&&F(O,G.graphic)})}function A(D,E){if("baseline"===E.verticalPlacement)return E=q.horizontalPlacementToAnchorX[E.horizontalPlacement],D=n.isSome(D)?D.baselineAnchorY:0,v.fromValues(E,D);D=q.anchorFromPlacements(E.horizontalPlacement,E.verticalPlacement);return q.namedAnchorToHUDMaterialAnchorPos[D]}const x=[0,0,1];p=function(D){function E(G,O,K,L){G=D.call(this,G,O,K,L)||this;G._elevationOptions=
{supportsOffsetAdjustment:!0,supportsOnTheGround:!1};G.ensureDrapedStatus(!1);return G}b._inheritsLoose(E,D);var F=E.prototype;F.doLoad=function(){var G=b._asyncToGenerator(function*(){if(!this._drivenProperties.size){const O=t.validateSymbolLayerSize(this.symbolLayer.size);if(O)throw new c("graphics3dtextsymbollayer:invalid-size",O);}yield this._createTextRenderParameters()});return function(){return G.apply(this,arguments)}}();F._createTextRenderParameters=function(){var G=b._asyncToGenerator(function*(){this._textRenderParameters=
yield y.TextRenderParameters.fromSymbol(this.symbolLayer,this._context.graphicsCoreOwner.view.state.pixelRatio)});return function(){return G.apply(this,arguments)}}();F.destroy=function(){D.prototype.destroy.call(this)};F.createGraphics3DGraphic=function(G){G=G.graphic;const O=k.placePointOnGeometry(G.geometry);if(n.isNone(O))return this.logger.warn(`unsupported geometry type for text symbol: ${G.geometry.type}`),null;const K=this.symbolLayer.text;if(n.isNone(K)||""===K)return null;var L=m.hasCalloutSupport(this.symbol)&&
this.symbol.hasVisibleVerticalOffset()?this.symbol.verticalOffset:null;if(n.isSome(L)&&!m.textSymbolLayerSupportsVerticalOffset(this.symbolLayer))return this.logger.errorOncePerTick("Callouts and vertical offset on text symbols are currently only supported with 'center' "+`horizontal alignment (not with '${this.symbolLayer.horizontalAlignment}' alignment)`),null;L={...C,verticalOffset:L,horizontalPlacement:this.symbolLayer.horizontalAlignment,verticalPlacement:q.verticalPlacementFromAlignment(this.symbolLayer.verticalAlignment)};
return this._createAs3DShape(G,O,K,L)};F.createLabel=function(G,O,K,L){G=G.graphic;const R=k.placePointOnGeometry(G.geometry);if(n.isNone(R))return this.logger.warn(`unsupported geometry type for label: ${G.geometry.type}`),null;const M=O.text;return!M||/^\s+$/.test(M)?null:this._createAs3DShape(G,R,M,O,K,L)};F.setGraphicElevationContext=function(G,O,K=0){G=D.prototype.setGraphicElevationContext.call(this,G,O);G.addOffsetRenderUnits(K);return G};F.layerOpacityChanged=function(){this.logger.warn("layer opacity change not yet implemented in Graphics3DTextSymbolLayer");
return!1};F.layerElevationInfoChanged=function(G,O){z(G,O,(K,L)=>{this.updateGraphicElevationContext(L,K)});return d.SymbolUpdateType.UPDATE};F.slicePlaneEnabledChanged=function(G,O){z(G,O,K=>{for(const L of K.stageObject.geometryRecords)L.material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled})});return!0};F.physicalBasedRenderingChanged=function(){return!0};F.pixelRatioChanged=function(){return!1};F.updateGraphicElevationContext=function(G,O){this.setGraphicElevationContext(G,O.elevationContext,
O.metadata.elevationOffset);O.needsElevationUpdates=d.needsElevationUpdates2D(O.elevationContext.mode)||"absolute-height"===O.elevationContext.mode};F._defaultElevationInfoNoZ=function(){return B};F._createAs3DShape=function(G,O,K,L,R,M){const J=this.setGraphicElevationContext(G,new e.ElevationContext,L.elevationOffset);var I="polyline"===n.get(G.geometry,"type");G=G.uid;let P=null;var N=null;if(n.isNone(M)){N=q.textRenderAlignmentFromHorizontalPlacement(L.horizontalPlacement);P=new f(K,N,this._textRenderParameters);
let H=null;N=this._context.sharedResources.textures.fromData(P.key,()=>n.unwrap(P).create(),()=>{n.isSome(H)&&H.release()});var V=this._context.stage.renderView.textureRepository.acquire(N.texture.id);if(n.isNone(V)||l.isPromiseLike(V))return N.release(),null;H=V}V=A(P,L);V={occlusionTest:!0,screenOffset:L.screenOffset,anchorPosition:V,polygonOffset:!0,color:[1,1,1,1],centerOffsetUnits:L.centerOffsetUnits,debugDrawLabelBorder:L.debugDrawLabelBorder,drawInSecondSlot:!0};n.isSome(N)&&(V.textureId=N.texture.id);
n.isSome(M)&&(V.textureId=M.id);if(n.isSome(L.verticalOffset)){const {screenLength:H,minWorldLength:U,maxWorldLength:W}=L.verticalOffset;V.verticalOffset={screenLength:u.pt2px(H),minWorldLength:U||0,maxWorldLength:null!=W?W:Infinity}}if(this._context.screenSizePerspectiveEnabled){const {screenSizePerspectiveSettings:H,screenSizePerspectiveSettingsLabels:U}=this._context.sharedResources;V.screenSizePerspective=U.overridePadding(this._textRenderParameters.haloSize+this._textRenderParameters.definition.background.padding[0]);
V.screenSizePerspectiveAlignment=H}I&&(V.shaderPolygonOffset=1E-4);V.hasSlicePlane=this._context.slicePlaneEnabled;n.isSome(R)?(I=JSON.stringify(V),M=R.get(I),n.isNone(M)&&(M=new w.HUDMaterial(V),R.add(I,M))):M=new w.HUDMaterial(V);M=[M];I=L.translation;V=n.isSome(P)?[P.displayWidth,P.displayHeight]:[0,0];I=[r.createPointGeometry(x,I,null,V,L.centerOffset,[0,0],null)];G=k.createStageObjectForHUD(this._context,O,I,M,J,this._context.layer.uid,G);if(null===G)return null;R=new g.Graphics3DObject3DGraphicLayer(this,
G.object,I,n.isNone(R)?M:null,N,h.perObjectElevationAligner,J);R.alignedSampledElevation=G.sampledElevation;R.needsElevationUpdates=d.needsElevationUpdates2D(J.mode)||"absolute-height"===J.mode;const {displayWidth:S,displayHeight:T}=n.isSome(P)?P:L;R.getScreenSize=(H=v.create())=>{H[0]=S;H[1]=T;return H};R.metadata={labelText:K,elevationOffset:L.elevationOffset};k.extendPointGraphicElevationContext(R,O,this._context.elevationProvider);return R};return E}(p.Graphics3DSymbolLayer);const B={mode:"relative-to-ground",
offset:0},C={text:null,translation:[0,0,0],elevationOffset:0,centerOffset:[0,0,0,1],screenOffset:[0,0],horizontalPlacement:"center",verticalPlacement:"center",verticalOffset:null,centerOffsetUnits:null,debugDrawLabelBorder:!1,displayWidth:0,displayHeight:0};a.Graphics3DTextSymbolLayer=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextRenderParameters":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/Logger ../../../../core/maybe ../../../../core/screenUtils ../../../../chunks/vec4f64".split(" "),
function(a,b,c,n,l,u,v){const m=n.getLogger("esri.views.3d.webgl-engine.lib.TextRenderParameters");n=function(){function h(e){this.definition=e;this.key=JSON.stringify(e);this.haloSize=Math.round(e.halo.size);this.textStyle=this._colorToRGBA(e.color);this.haloStyle=this._colorToRGB(e.halo.color);this.backgroundStyle=0!==e.background.color[3]?this._colorToRGBA(e.background.color):null}var d=h.prototype;d.fontString=function(e){const g=this.definition.font;return`${g.style} ${g.weight} ${e}px ${g.family}, sans-serif`};
d._colorToRGB=function(e){return`rgb(${e.slice(0,3).map(g=>Math.floor(255*g)).toString()})`};d._colorToRGBA=function(e){return`rgba(${e.slice(0,3).map(g=>Math.floor(255*g)).toString()},${e[3]})`};h.fromSymbol=function(){var e=b._asyncToGenerator(function*(g,p=1){var t=l.get(g,"material","color");const q=l.mapOr(t,v.ZEROS,c.toUnitRGBA);t=l.mapOr(g.size,12,u.pt2px);const k=g.lineHeight,r=l.isSome(g.background)?c.toUnitRGBA(g.background.color):v.ZEROS,y={family:l.mapOr(g.font,"sans-serif",w=>w.family),
decoration:l.mapOr(g.font,"none",w=>w.decoration),weight:l.mapOr(g.font,"normal",w=>w.weight),style:l.mapOr(g.font,"normal",w=>w.style)};var f=g.halo;f=l.isSome(f)&&l.isSome(f.color)&&0<f.size?{size:u.pt2px(f.size),color:c.toUnitRGBA(f.color)}:{size:0,color:v.ZEROS};g=new h({color:q,size:t,background:{color:r,padding:l.isSome(g.background)?[.65*t,.5*t]:[0,0],borderRadius:l.isSome(g.background)?.375*t:0},lineSpacingFactor:k,font:y,halo:f,pixelRatio:p});p=g.fontString(t);try{yield document.fonts.load(p)}catch(w){m.warnOnce(`Failed to preload font '${p}'. Some text symbology may be rendered using the default browser font.`)}return g});
return function(g){return e.apply(this,arguments)}}();return h}();a.TextRenderParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextTextureFactory":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","./basicInterfaces","./TextRenderer","./Texture","../../../webgl/enums"],function(a,b,c,n,l){const u={canvas:null};return function(){function v(m,h,d){this._renderer=new c.TextRenderer(m,h,d)}v.prototype.create=
function(){const m=c.getTextHelperCanvas(u,this._renderer.renderedWidth,this._renderer.renderedHeight),h=m.getContext("2d");h.save();this._renderer.render(h,0,0);h.restore();return new n.Texture(m,{wrap:{s:l.TextureWrapMode.CLAMP_TO_EDGE,t:l.TextureWrapMode.CLAMP_TO_EDGE},noUnpackFlip:!1,mipmap:!0,preMultiplyAlpha:!0,powerOfTwoResizeMode:b.PowerOfTwoResizeMode.PAD})};a._createClass(v,[{key:"key",get:function(){return this._renderer.key}},{key:"baselineAnchorY",get:function(){return 1-this._renderer.firstRenderedBaselinePosition/
this._renderer.renderedHeight}},{key:"displayWidth",get:function(){return this._renderer.displayWidth}},{key:"displayHeight",get:function(){return this._renderer.displayHeight}}]);return v}()})},"esri/views/3d/layers/graphics/Graphics3DWaterSymbolLayer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../Color ../../../../core/maybe ../../../../core/unitUtils ../../../../chunks/earcut ../../../../chunks/mat4f64 ../../../../chunks/vec2 ../../../../chunks/vec2f64 ../../../../chunks/vec4 ../../../../chunks/common ../../../../geometry/support/aaBoundingBox ../../../../geometry/support/aaBoundingRect ./ElevationAligners ./elevationAlignmentUtils ./ElevationContext ./Graphics3DDrapedGraphicLayer ./Graphics3DObject3DGraphicLayer ./Graphics3DSymbolLayer ./polygonUtils ../../webgl-engine/lib/Object3D ../../webgl-engine/lib/RenderGeometry ../../webgl-engine/materials/WaterMaterial ../../webgl-engine/materials/internal/waterMaterialUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B){const C=["polyline","polygon","extent"];f=function(L){function R(J,I,P,N){return L.call(this,J,I,P,N)||this}b._inheritsLoose(R,L);var M=R.prototype;M.doLoad=function(){var J=b._asyncToGenerator(function*(){});return function(){return J.apply(this,arguments)}}();M.destroy=function(){L.prototype.destroy.call(this);this._context.stage.remove(this._material);this._material=null};M.createGraphics3DGraphic=function(J){J=J.graphic;if(!this._validateGeometry(J.geometry,
C,this.symbolLayer.type))return null;const I=this.setGraphicElevationContext(J,new k.ElevationContext);this.ensureDrapedStatus("on-the-ground"===I.mode);this.ensureMaterial();return this.draped?this._createAsOverlay(J):this._createAs3DShape(J,I,J.uid)};M.ensureMaterial=function(){if(!n.isSome(this._material)){var J=new x.WaterMaterialParameters,I=this.symbolLayer.color;n.isSome(I)&&(J.color=c.toUnitRGBA(I));I=this._getCombinedOpacity(I,{hasIntrinsicColor:!0});J.color=[J.color[0],J.color[1],J.color[2],
I];J.transparent=1>I||this.needsDrivenTransparentPass;J.waveDirection=n.isSome(this.symbolLayer.waveDirection)?R.headingVectorFromAngle(this.symbolLayer.waveDirection):h.fromValues(0,0);I=B.wavePresets[this.symbolLayer.waveStrength+"-"+this.symbolLayer.waterbodySize];J.waveStrength=I.waveStrength;J.waveTextureRepeat=I.textureRepeat;J.waveVelocity=I.waveVelocity;J.flowStrength=I.perturbationStrength;J.hasSlicePlane=this._context.slicePlaneEnabled;J.isDraped=this.draped;this._material=new x.WaterMaterial(J);
this._context.stage.add(this._material)}};M.layerOpacityChanged=function(){if(n.isNone(this._material))return!0;const J=this._material.parameters.color,I=this._getCombinedOpacity(this.symbolLayer.color,{hasIntrinsicColor:!0});this._material.setParameters({color:[J[0],J[1],J[2],I],transparent:1>I||this.needsDrivenTransparentPass});return!0};M.layerElevationInfoChanged=function(J,I,P){const N=this._elevationContext.mode;P=q.elevationModeChangeUpdateType(R.elevationModeChangeTypes,P,N);if(P!==q.SymbolUpdateType.UPDATE)return P;
const V=q.needsElevationUpdates2D(N);return this.updateGraphics3DGraphicElevationInfo(J,I,()=>V)};M.slicePlaneEnabledChanged=function(){n.isSome(this._material)&&this._material.setParameters({hasSlicePlane:this._context.slicePlaneEnabled});return!0};M.physicalBasedRenderingChanged=function(){return!0};M.pixelRatioChanged=function(){return!0};M._createAs3DShape=function(J,I,P){J=w.geometryAsPolygon(J.geometry);if(n.isNone(J))return null;O.renderData=w.geometryToRenderInfo(J,this._context.elevationProvider,
this._context.renderCoordsHelper,I);const N=O.renderData.position.length/3;O.uvCoords=new Float64Array(2*N);O.outNum=0;O.outGeometries=[];O.outTransforms=[];O.outMaterials=[];this._create3DShapeGeometries(O);this._logGeometryCreationWarnings(O.renderData,J.rings,"rings","WaterSymbol3DLayer");if(0===O.outNum)return null;this._createUVCoordsFromVertices(O.uvCoords,O.renderData.mapPosition,N,this._context.elevationProvider.spatialReference);P=new z.Object3D({geometries:O.outGeometries,materials:O.outMaterials,
transformations:O.outTransforms,castShadow:!1,metadata:{layerUid:this._context.layer.uid,graphicUid:P}});P=new y.Graphics3DObject3DGraphicLayer(this,P,O.outGeometries,null,null,t.perVertexElevationAligner,I);P.alignedSampledElevation=O.renderData.sampledElevation;P.needsElevationUpdates=q.needsElevationUpdates2D(I.mode);return P};M._createUVCoordsFromVertices=function(J,I,P,N){N=l.getMetersPerUnitForSR(N);p.empty(E);for(var V=0;V<P;V++)m.set(F,I[3*V],I[3*V+1]),p.expandPointInPlace(E,F);d.scale(E,
E,N);V=E[1]%R.unitSizeOfTexture;D[0]=E[0]-E[0]%R.unitSizeOfTexture;D[1]=E[1]-V;for(V=0;V<P;V++)J[2*V]=(I[3*V]*N-D[0])/R.unitSizeOfTexture,J[2*V+1]=(I[3*V+1]*N-D[1])/R.unitSizeOfTexture};M._create3DShapeGeometries=function(J){var I=J.renderData.polygons;const P=J.uvCoords;for(const {count:N,index:V,position:S,mapPosition:T,holeIndices:H}of I){if(n.isSome(this._context.clippingExtent)&&(g.empty(G),g.expandWithBuffer(G,T),!g.intersectsClippingArea(G,this._context.clippingExtent)))continue;I=u.earcut(T,
H,3);if(0===I.length)continue;I=new Uint32Array(I);const U=new Float64Array(P.buffer,2*V*P.BYTES_PER_ELEMENT,2*N);I=w.createWaterGeometry({indices:I,attributeData:{position:S,uv0:U,mapPosition:T}});J.outGeometries.push(I);J.outMaterials.push(n.unwrap(this._material));J.outTransforms.push(v.IDENTITY);J.outNum++}};M._createAsOverlay=function(J){const I=w.geometryAsPolygon(J.geometry);if(n.isNone(I))return null;n.unwrap(this._material).renderPriority=this._renderPriority;K.renderData=w.geometryToRenderInfoDraped(I,
this._context.overlaySR);const P=K.renderData.position.length/3;K.uvCoords=new Float64Array(2*P);K.outNum=0;K.outGeometries=[];K.outBoundingBox=g.empty();K.layerUid=this._context.layer.uid;K.graphicsUid=J.uid;this._createAsOverlayWater(K);this._logGeometryCreationWarnings(K.renderData,I.rings,"rings","WaterSymbol3DLayer");if(0===K.outNum)return null;this._createUVCoordsFromVertices(K.uvCoords,K.renderData.position,P,this._context.overlaySR);return 0<K.outNum?new r(this,K.outGeometries,K.outBoundingBox,
this._context.drapeSourceRenderer):null};M._createAsOverlayWater=function(J){const I=J.uvCoords;var P=J.renderData.polygons;for(const {position:V,holeIndices:S,index:T,count:H}of P)if(g.empty(G),g.expandWithBuffer(G,V),g.intersectsClippingArea(G,this._context.clippingExtent)&&(g.expandWithAABB(J.outBoundingBox,G),P=u.earcut(V,S,3),0!==P.length)){P=new Uint32Array(P);var N=new Float64Array(I.buffer,2*T*I.BYTES_PER_ELEMENT,2*H);P=w.createWaterGeometry({indices:P,attributeData:{position:V,uv0:N}});P=
new A.RenderGeometry(P,n.unwrap(this._material),{layerUid:J.layerUid,graphicUid:J.graphicsUid});N=G;d.set(P.boundingSphere,.5*(N[0]+N[3]),.5*(N[1]+N[4]),0,.5*Math.sqrt((N[3]-N[0])*(N[3]-N[0])+(N[4]-N[1])*(N[4]-N[1])));J.outGeometries.push(P);J.outNum++}};R.headingVectorFromAngle=function(J){const I=h.create();J=e.toRadian(J);I[0]=Math.sin(J);I[1]=Math.cos(J);return I};M.test=function(){return{...L.prototype.test.call(this),create3DShape:J=>this._createAs3DShape(J.graphic,J.elevationContext,J.graphicUid),
ensureMaterial:()=>this.ensureMaterial()}};return R}(f.Graphics3DSymbolLayer);f.unitSizeOfTexture=100;f.elevationModeChangeTypes={definedChanged:q.SymbolUpdateType.RECREATE,staysOnTheGround:q.SymbolUpdateType.NONE,onTheGroundChanged:q.SymbolUpdateType.RECREATE};const D=h.create(),E=p.create(),F=h.create(),G=g.create(),O={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,outGeometries:null,outMaterials:null,outTransforms:null},K={renderData:null,uvCoords:null,outNum:0,outBoundingBox:null,
outGeometries:null,outMaterials:null,outTransforms:null};a.Graphics3DWaterSymbolLayer=f;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/waterMaterialUtils":function(){define(["exports"],function(a){a.wavePresets={"calm-small":{waveStrength:.005,perturbationStrength:.02,textureRepeat:12,waveVelocity:.01},"rippled-small":{waveStrength:.02,perturbationStrength:.09,textureRepeat:32,waveVelocity:.07},"slight-small":{waveStrength:.05,
perturbationStrength:.07,textureRepeat:28,waveVelocity:.1},"moderate-small":{waveStrength:.075,perturbationStrength:.07,textureRepeat:24,waveVelocity:.1},"calm-medium":{waveStrength:.003125,perturbationStrength:.01,textureRepeat:8,waveVelocity:.02},"rippled-medium":{waveStrength:.035,perturbationStrength:.015,textureRepeat:12,waveVelocity:.07},"slight-medium":{waveStrength:.06,perturbationStrength:.015,textureRepeat:8,waveVelocity:.12},"moderate-medium":{waveStrength:.09,perturbationStrength:.03,
textureRepeat:4,waveVelocity:.12},"calm-large":{waveStrength:.01,perturbationStrength:0,textureRepeat:4,waveVelocity:.05},"rippled-large":{waveStrength:.025,perturbationStrength:.01,textureRepeat:8,waveVelocity:.11},"slight-large":{waveStrength:.06,perturbationStrength:.02,textureRepeat:3,waveVelocity:.13},"moderate-large":{waveStrength:.14,perturbationStrength:.03,textureRepeat:2,waveVelocity:.15}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/Graphics3DWebStyleSymbol":function(){define(["../../../../chunks/_rollupPluginBabelHelpers",
"../../../../core/maybe","./interfaces","./Loadable","./symbolComplexity"],function(a,b,c,n,l){return function(u){function v(h,d,e){d=u.call(this,d)||this;d.symbol=h;d.convert=e;d.graphics3DSymbol=null;d.referenced=0;return d}a._inheritsLoose(v,u);var m=v.prototype;m.getSymbolLayerSize=function(h){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getSymbolLayerSize(h):null};m.doLoad=function(){var h=a._asyncToGenerator(function*(d){d=yield this.symbol.fetchSymbol({signal:d});d.id=this.symbol.id;
this.graphics3DSymbol=this.convert(d);b.isSome(this.graphics3DSymbol)&&(yield this.graphics3DSymbol.load())});return function(d){return h.apply(this,arguments)}}();m.createGraphics3DGraphic=function(h){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.createGraphics3DGraphic(h,this):null};m.globalPropertyChanged=function(h,d){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.globalPropertyChanged(h,d):!1};m.applyRendererDiff=function(h,d){return b.isSome(this.graphics3DSymbol)?
this.graphics3DSymbol.applyRendererDiff(h,d):c.ApplyRendererDiffResult.Recreate_Symbol};m.prepareSymbolPatch=function(h){b.isSome(this.graphics3DSymbol)&&this.graphics3DSymbol.prepareSymbolPatch(h)};m.updateGeometry=function(h,d){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.updateGeometry(h,d):!1};m.onRemoveGraphic=function(){};m.getFastUpdateStatus=function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.getFastUpdateStatus():{loading:1,fast:0,slow:0}};m.destroy=function(){b.isSome(this.graphics3DSymbol)&&
this.graphics3DSymbol.destroy();this.graphics3DSymbol=void 0;u.prototype.destroy.call(this)};a._createClass(v,[{key:"symbolLayers",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.symbolLayers:[]}},{key:"extentPadding",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.extentPadding:0}},{key:"complexity",get:function(){return b.isSome(this.graphics3DSymbol)?this.graphics3DSymbol.complexity:l.emptySymbolComplexity}},{key:"destroyed",get:function(){return void 0===
this.graphics3DSymbol}}]);return v}(n.Loadable)})},"esri/views/3d/layers/graphics/labelPlacement":function(){define("exports ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../chunks/vec2f64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/support/aaBoundingBox ./graphicSymbolUtils ../../webgl-engine/materials/HUDMaterial".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){function g(C){C=d.getGraphics3DSymbol(C.graphics3DGraphic.graphics3DSymbol);
return n.isSome(C)?C.symbol.symbolLayers.getItemAt(0):null}function p(C,D){var E=D.graphics3DGraphic.graphic.geometry;if(n.isNone(E))return null;if(n.isSome(D.disablePlacement))return D.labelClass.labelPlacement?(w.warnOncePerTick(t(C.placement,D.disablePlacement.logEntityDescription)),q(D)):C;E=E.type;switch(E){case "polyline":case "polygon":case "extent":case "multipoint":if(D.labelClass.labelPlacement)return w.warnOncePerTick(t(C.placement,`'${E}' geometries`)),q(D)}return C}function t(C,D){return`the requested label placement '${C}' is currently unsupported for ${D} in SceneView.`}
function q(C){const D=C.graphics3DGraphic.graphic.geometry;if(n.isNone(D))return null;switch(D.type){case "polyline":case "extent":case "multipoint":return{placement:"center-center",normalizedOffset:null,anchor:"center"};case "polygon":return C=g(C),n.isSome(C)&&"extrude"===C.type?z["above-center"]:{placement:"center-center",normalizedOffset:null,anchor:"center"};case "point":return z["above-center"];case "mesh":return z["above-center"]}}function k(C,D=x){({graphics3DGraphic:C}=C);C=C.graphics[0];
(C=n.isSome(C)?C.stageObject.geometryRecords[0].material:null)&&C instanceof e.HUDMaterial?(C=C.parameters.anchorPosition,D[0]=2*(C[0]-.5),D[1]=2*(C[1]-.5)):(D[0]=0,D[1]=0);return D}function r(C,D,E){E=n.isSome(E)?E.getBoundingBoxObjectSpace(B):B;E=v.fromValues(E[3]-E[0],E[4]-E[1],E[5]-E[2]);C.centerOffset[0]=Math.sqrt(E[0]*E[0]+E[1]*E[1])/2*D.normalizedOffset[0];const F=C.translation[2],G=E[2]/2*D.normalizedOffset[1];C.translation[2]=0;C.elevationOffset=F+G;E=u.length(E);C.centerOffset[2]=E/2*D.normalizedOffset[2]}
function y(C){const D=C.labelClass.labelPlacement,{labelSymbol:E,graphics3DGraphic:F}=C;var G=d.getGraphics3DSymbol(F.graphics3DSymbol);G=n.applySome(G,O=>"point-3d"===O.symbol.type?O.symbol:null);C=z[D]||q(C);if(n.isSome(G)&&G.supportsCallout()&&G.hasVisibleVerticalOffset()&&!F.isDraped)return{placement:null,hasLabelVerticalOffset:!1,verticalOffset:f(G.verticalOffset),anchor:null,normalizedOffset:null};if(E&&E.hasVisibleVerticalOffset()&&(n.isNone(G)||!G.supportsCallout()||!G.verticalOffset||F.isDraped)){a:switch(C.placement){case "above-center":G=
!0;break a;default:G=!1}return G?{placement:"above-center",verticalOffset:f(E.verticalOffset),anchor:"bottom",normalizedOffset:[0,C.normalizedOffset[1],0],hasLabelVerticalOffset:!0}:(w.errorOncePerTick("Callouts and vertical offset on labels are currently only supported with 'above-center' label placement (not with "+D+" placement)"),null)}return{placement:null,verticalOffset:null,anchor:null,normalizedOffset:null,hasLabelVerticalOffset:!1}}function f(C){const {screenLength:D,minWorldLength:E,maxWorldLength:F}=
C;return{screenLength:D,minWorldLength:E,maxWorldLength:F}}const w=c.getLogger("esri.views.3d.layers.graphics.labelPlacement"),z={"above-center":{placement:"above-center",normalizedOffset:[0,1,0],anchor:"bottom"},"above-left":{placement:"above-left",normalizedOffset:[-1,1,0],anchor:"bottom-right"},"above-right":{placement:"above-right",normalizedOffset:[1,1,0],anchor:"bottom-left"},"below-center":{placement:"below-center",normalizedOffset:[0,-1,2],anchor:"top"},"below-left":{placement:"below-left",
normalizedOffset:[-1,-1,0],anchor:"top-right"},"below-right":{placement:"below-right",normalizedOffset:[1,-1,0],anchor:"top-left"},"center-center":{placement:"center-center",normalizedOffset:[0,0,1],anchor:"center"},"center-left":{placement:"center-left",normalizedOffset:[-1,0,0],anchor:"right"},"center-right":{placement:"center-right",normalizedOffset:[1,0,0],anchor:"left"}};b={"above-center":["default","esriServerPointLabelPlacementAboveCenter"],"above-left":["esriServerPointLabelPlacementAboveLeft"],
"above-right":["esriServerPointLabelPlacementAboveRight"],"below-center":["esriServerPointLabelPlacementBelowCenter"],"below-left":["esriServerPointLabelPlacementBelowLeft"],"below-right":["esriServerPointLabelPlacementBelowRight"],"center-center":["esriServerPointLabelPlacementCenterCenter"],"center-left":["esriServerPointLabelPlacementCenterLeft"],"center-right":["esriServerPointLabelPlacementCenterRight"]};for(const C in b){const D=z[C];b[C].forEach(E=>{z[E]=D})}Object.freeze&&(Object.freeze(z),
Object.keys(z).forEach(C=>{Object.freeze(z[C]);Object.freeze(z[C].normalizedOffset)}));const A=[0,0],x=[0,0],B=h.create();a.get=function(C){var D=y(C);if(n.isNone(D))return null;if(D.anchor)var E=D;else{E=C.labelClass.labelPlacement;var F=z[E],G=F||q(C);E&&!F&&w.warnOncePerTick(`the requested label placement '${E}' is currently unsupported in SceneView.`);E=p(G,C)}if(n.isNone(E))return null;F=!!D.hasLabelVerticalOffset;D={anchor:E.anchor,verticalOffset:D.verticalOffset,screenOffset:l.create(),centerOffset:m.fromValues(0,
0,0,-1),centerOffsetUnits:"world",translation:v.create(),elevationOffset:0,hasLabelVerticalOffset:F};F=C.graphics3DGraphic.graphic.geometry;if(n.isNone(F))C=null;else{switch(F.type){case "point":G=g(C);if(!n.isNone(G))switch(F=C.graphics3DGraphic.graphics[0],n.isSome(F)?F.getCenterObjectSpace(D.translation):u.set(D.translation,0,0,0),G.type){case "icon":case "text":({graphics3DGraphic:G}=C);F=n.isSome(F)?F.getScreenSize():null;!G.isDraped&&n.isSome(F)?(C=k(C),A[0]=F[0]/2*(E.normalizedOffset[0]-C[0]),
A[1]=F[1]/2*(E.normalizedOffset[1]-C[1]),D.screenOffset[0]=A[0],D.hasLabelVerticalOffset?(D.centerOffset[1]=A[1],D.centerOffsetUnits="screen"):D.screenOffset[1]=A[1]):D.hasLabelVerticalOffset||"center"===D.anchor||(z[C.labelClass.labelPlacement]&&w.warnOncePerTick(`the requested placement '${E.placement}' is currently unsupported for draped graphics`),D.anchor="center");break;case "object":r(D,E,F)}break;case "polygon":F=g(C);if(!n.isNone(F))switch(F.type){case "extrude":C=C.graphics3DGraphic.graphics[0],
n.isSome(C)?(C.getBoundingBoxObjectSpace(B),h.center(B,D.translation),D.translation[2]=h.height(B)/2):u.set(D.translation,0,0,0),r(D,E,C)}break;case "mesh":r(D,E,C.graphics3DGraphic.graphics[0])}C=D}return C};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/MaterialCollection":function(){define(["exports"],function(a){let b=function(){function c(l){this._stage=l;this._materials=new Map}var n=c.prototype;n.get=function(l){return this._materials.get(l)};
n.add=function(l,u){this._materials.set(l,u);this._stage.add(u)};n.dispose=function(){this._stage.removeMany(Array.from(this._materials.values()));this._materials.clear()};return c}();a.MaterialCollection=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextTextureAtlas":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/MapUtils ../../../../core/mathUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./ContentObjectType ./testUtils ./VertexAttribute ../../../support/Scheduler ../../../webgl/enums ../../../webgl/Texture".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){a.TextTextureAtlas=function(A){function x(C){C=A.call(this,C)||this;C.type=q.ContentObjectType.Texture;C.id=h.generateUID();C.events=new l;C._glTexture=null;C.needsClear=!1;C.elementsToAddOrUpdate=new Map;C.elementsToRemove=new Map;C.elementsToRender=new Map;C.elements=new Map;C.stageObjects=new Map;C.updating=!1;return C}b._inheritsLoose(x,A);var B=x.prototype;B.initialize=function(){this.stage=this.view._stage;this.canvas=this._create2DCanvas();
this.ctx=this.canvas.getContext("2d");this.stage.add(this);const C=this._computeAtlasResolution(this.view.width,this.view.height);this._createAtlasRegion(C);this._update2DCanvasSize();this._resetAtlasCursor()};B.unload=function(){this._glTexture=m.disposeMaybe(this._glTexture);this.updating=!1;this.events.emit("unloaded")};B._createDescriptor=function(C){return{target:f.TextureType.TEXTURE_2D,pixelFormat:f.PixelFormat.RGBA,dataType:f.PixelType.UNSIGNED_BYTE,wrapMode:f.TextureWrapMode.CLAMP_TO_EDGE,
flipped:!0,samplingMode:f.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,preMultiplyAlpha:!0,maxAnisotropy:C.parameters.maxMaxAnisotropy}};B.load=function(C){if(m.isSome(this._glTexture))return this._glTexture;this._glTexture=new w.Texture(C,this._createDescriptor(C),this.canvas);this.frameWorker=this.view.resourceController.scheduler.registerTask(y.TaskPriority.TEXT_TEXTURE_ATLAS,this);this.setDirty();return this._glTexture};B.dispose=function(){this.elementsToRender=this.elementsToRemove=
this.elementsToAddOrUpdate=this.elements=null;this.frameWorker=m.removeMaybe(this.frameWorker);this._glTexture&&(this.stage.remove(this),this._glTexture=m.disposeMaybe(this._glTexture));this.canvas.width=0;this.canvas.height=0;this.ctx=this.canvas=null};B._create2DCanvas=function(){const C=document.createElement("canvas");C.setAttribute("id","canvas2d");C.setAttribute("style","display:none");C.setAttribute("width",(512).toString());C.setAttribute("height",(512).toString());return C};B._update2DCanvasSize=
function(){this.canvas.setAttribute("width",this.atlas.size.width.toString());this.canvas.setAttribute("height",this.atlas.size.height.toString())};B._createAtlasRegion=function(C=512){this.atlas={size:{width:C,height:C},cursor:{x:0,y:0},lineHeight:0}};B._computeAtlasResolution=function(C,D){C=Math.max(C,D);C=v.nextHighestPowerOfTwo(C+256);return C=Math.min(C,4096)};B._resizeAtlas=function(C,D){D=D||C;const E=this.atlas;E.size.width=C;E.size.height=D;m.isSome(this._glTexture)&&this._glTexture.resize(C,
D);this._update2DCanvasSize()};B._resetAtlasCursor=function(){const C=this.atlas;C.cursor.x=2;C.cursor.y=4;C.lineHeight=0;this.needsClear=!0};B._getAtlasUsage=function(){const C=this.atlas;return(C.cursor.x+C.cursor.y*C.size.width)/(C.size.width*C.size.height)};B._getExpectedAtlasUsage=function(){const C=this.elementsToRemove.size,D=this.elementsToAddOrUpdate.size,E=this.elements.size;return this._getAtlasUsage()/E*(E+D-C)};B._addAtlasElement=function(C,D,E,F){const G=this.atlas,{renderedWidth:O,
renderedHeight:K,displayWidth:L,displayHeight:R}=C.textRenderer;C.placement.offset.x=G.cursor.x;C.placement.offset.y=G.cursor.y;C.placement.size.width=O;C.placement.size.height=K;C.placement.size.displayWidth=L;C.placement.size.displayHeight=R;C.placement.uvMinMax=[C.placement.offset.x/G.size.width,1-(C.placement.offset.y+K)/G.size.height,(C.placement.offset.x+O)/G.size.width,1-C.placement.offset.y/G.size.height];G.cursor.x+=E;G.lineHeight=Math.max(G.lineHeight,F);this.elements.set(D,C)};B._removeAtlasElement=
function(C){if(C&&this.elements.has(C.textId)){const D=C.placement.offset,E=C.placement.size;this.ctx.clearRect(D.x,D.y,E.width,E.height);this.elements.delete(C.textId)}};B._ensureStageObjects=function(C){var D=this.stageObjects.get(C);if(D)return D;D=new Set;this.stageObjects.set(C,D);return D};B._addStageObject=function(C,D){this._ensureStageObjects(C).add(D)};B._removeStageObject=function(C,D){(C=this.stageObjects.get(C))&&C.delete(D)&&(D.geometries[0].vertexAttributes.get(r.VertexAttribute.SIZE).data=
[0,0],D.geometryVertexAttrsUpdated(D.geometryRecords[0]))};B._processAddition=function(C,D){const E=this.atlas;var F=C.textId;const G=C.textRenderer.renderedWidth+2,O=C.textRenderer.renderedHeight+2+2;if(E.cursor.x+G<E.size.width&&E.cursor.y+O<E.size.height)this._addAtlasElement(C,F,G,O),this.elementsToRender.set(F,C),this.elementsToAddOrUpdate.delete(F);else if(E.cursor.y+O+E.lineHeight<E.size.height)E.cursor.x=2,E.cursor.y+=E.lineHeight,E.lineHeight=0,this._addAtlasElement(C,F,G,O),this.elementsToRender.set(F,
C),this.elementsToAddOrUpdate.delete(F);else{C=this._getExpectedAtlasUsage();(F=.85<C&&4096>E.size.width)&&this._resizeAtlas(2*E.size.width,2*E.size.height);if(!D||!F&&.95<C&&4096===E.size.width)return this._processRemovals(),z.OK;this._repack();return z.REPACK}return z.OK};B._processRemovals=function(){this.elementsToRemove.forEach((C,D)=>{const E=this.stageObjects.get(D);E&&0!==E.size||this._removeAtlasElement(C);E&&0===E.size&&this.stageObjects.delete(D)});this.elementsToRemove.clear()};B._repack=
function(){this._processRemovals();this.elements.forEach((C,D)=>{C.rendered=!1;this.elementsToAddOrUpdate.set(D,C)});this.elements.clear();this._resetAtlasCursor();this.elementsToRender.clear()};B._processRenderingRequest=function(C){this.ctx.clearRect(C.placement.offset.x,C.placement.offset.y,C.placement.size.width,C.placement.size.height);C.textRenderer.render(this.ctx,C.placement.offset.x,C.placement.offset.y);const D=this.stageObjects.get(C.textId);D&&D.forEach(E=>{E.geometries[0].vertexAttributes.get(r.VertexAttribute.UV0).data=
new Float32Array(C.placement.uvMinMax);E.geometries[0].vertexAttributes.get(r.VertexAttribute.SIZE).data=[C.placement.size.displayWidth,C.placement.size.displayHeight];E.geometryVertexAttrsUpdated(E.geometryRecords[0])});C.rendered=!0};B.runTask=function(C,D=!0){if(this._glTexture){var E=!1;u.someMap(this.elementsToAddOrUpdate,(G,O)=>(G=this.elements.get(O))&&G.rendered?((G=this.stageObjects.get(O))&&G.forEach(K=>{const L=K.geometries[0].vertexAttributes,R=this.elements.get(O);L.get(r.VertexAttribute.UV0).data=
new Float32Array(R.placement.uvMinMax);L.get(r.VertexAttribute.SIZE).data=new Float32Array([R.placement.size.displayWidth,R.placement.size.displayHeight]);K.geometryVertexAttrsUpdated(K.geometryRecords[0])}),this.elementsToAddOrUpdate.delete(O),!1):this._processAddition(this.elementsToAddOrUpdate.get(O),D)===z.REPACK?E=!0:!1);if(E)this.runTask(y.noBudget,!1);else{var F=!1;0<this.elementsToRender.size&&this.needsClear&&(this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.needsClear=!1);
u.someMap(this.elementsToRender,(G,O)=>{this._processRenderingRequest(G);this.elementsToRender.delete(O);F=!0;C.madeProgress();return C.done});F&&m.isSome(this._glTexture)&&this._glTexture.setData(this.canvas);this.updating=0<this.elementsToRender.size;!this.updating&&k.textTextureAtlas.orderedRepackingEnabled&&this.repackOrdered()}}};B.addTextTexture=function(C,D){const E=C.key;this.elementsToAddOrUpdate.has(E)||this.elementsToAddOrUpdate.set(E,{textId:E,placement:{offset:{x:0,y:0},size:{width:0,
height:0,displayWidth:0,displayHeight:0},uvMinMax:[]},textRenderer:C,rendered:!1});this._addStageObject(E,D);this.elementsToRemove.delete(E);this.setDirty()};B.removeTextTexture=function(C,D){C=C.key;this.elementsToRemove.set(C,this.elements.get(C));this._removeStageObject(C,D)};B.setDirty=function(){this._glTexture&&(this.updating=!0)};B.repackOrdered=function(){if(0!==this.elements.size){var C=[];this.elements.forEach((E,F)=>C.push({element:E,key:F}));var D=!0;for(let E=0;E<C.length-1;E++)if(0<
C[E].key.localeCompare(C[E+1].key)){D=!1;break}if(!D||this.elementsToRemove.size){C.sort((E,F)=>E.key.localeCompare(F.key));this.elements.clear();for(const {element:E,key:F}of C)this.elements.set(F,E);this._repack();this.setDirty()}}};b._createClass(x,[{key:"width",get:function(){return this.atlas.size.width}},{key:"height",get:function(){return this.atlas.size.height}},{key:"requiresFrameUpdates",get:function(){return!1}},{key:"glTexture",get:function(){return this._glTexture}},{key:"running",get:function(){return this.updating}},
{key:"test",get:function(){const {elements:C,stageObjects:D,elementsToRemove:E,atlas:F}=this,G=this;return{elements:C,stageObjects:D,elementsToRemove:E,atlas:F,_resizeAtlas:(O,K)=>G._resizeAtlas(O,K),run:(O,K)=>G.runTask(O,K)}}}]);return x}(n);c.__decorate([d.property({constructOnly:!0})],a.TextTextureAtlas.prototype,"view",void 0);c.__decorate([d.property({type:Boolean})],a.TextTextureAtlas.prototype,"updating",void 0);a.TextTextureAtlas=c.__decorate([t.subclass("esri.views.3d.webgl-engine.lib.TextTextureAtlas")],
a.TextTextureAtlas);var z;(function(A){A[A.OK=0]="OK";A[A.REPACK=1]="REPACK"})(z||(z={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ObjectResourceCache":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/Handles ../../../../core/handleUtils ../../../../core/maybe ../../../../core/promiseUtils ../../glTF/DefaultLoadingContext ../../glTF/loader ./wosrLoader".split(" "),function(a,b,
c,n,l,u,v,m,h){let d=function(){function g(){this.gltfCache=new Map;this.wosrCache=new Map;this.evictHandles=new c}var p=g.prototype;p.loadGLTF=function(t,q,k){return this._fromCache(this.gltfCache,k?`gltfPBR:${t}`:`gltf:${t}`,r=>m.load(new v.DefaultLoadingContext(r.streamDataRequester),t,r,k),q)};p.loadWOSR=function(t,q){return this._fromCache(this.wosrCache,`wosr:${t}:${q.disableTextures}`,k=>h.load(t,k),q)};p.destroy=function(){this.evictHandles.destroy();this.gltfCache.clear();this.wosrCache.clear()};
p._fromCache=function(t,q,k,r){return new Promise((y,f)=>{if(u.isAborted(r))f(u.createAbortError());else{var w=u.onAbort(r,()=>{this._remove(t,q);f(u.createAbortError())}),z=t.get(q);if(z)this.evictHandles.remove(q),z.refCount++,z.item.then(y,f);else{z=new AbortController;var A={refCount:1,abortController:z,item:k({...r,signal:z.signal}).then(x=>{A.abortController=null;x.remove=()=>this._remove(t,q);return x})};t.set(q,A);A.item.then(x=>{l.isSome(w)&&w.remove();y(x)},x=>{l.isSome(w)&&w.remove();f(x)})}}})};
p._remove=function(t,q){const k=t.get(q);k&&(k.refCount--,0===k.refCount&&this.evictHandles.add(n.timeoutHandle(()=>{t.delete(q);l.isSome(k.abortController)&&k.abortController.abort()},e),q))};b._createClass(g,[{key:"size",get:function(){return this.wosrCache.size+this.gltfCache.size}}]);return g}(),e=1E4;a.ObjectResourceCache=d;a.test={overrideEvictDelay(g){e=g;return{remove(){e=1E4}}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileTree3D":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Collection ../../../../core/Handles ../../../../core/Logger ../../../../core/maybe ../../../../core/PooledArray ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../geometry/support/aaBoundingRect ./FeatureTileDescriptor3D ./FeatureTileMeasurements3D ../../support/extentUtils ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){const z=v.getLogger("esri.views.3d.layers.support.FeatureTileTree3D");a.FeatureTileTree3D=function(B){function C(E){E=B.call(this,E)||this;E.tiles=new l;E.tileSize=512;E._idToTile=new Map;E._handles=new u;E._clients=new Set;E._dirty=!1;E._newTiles=new h;return E}b._inheritsLoose(C,B);var D=C.prototype;D.initialize=function(){this._handles.add([d.watch(()=>[this.tilingScheme,this.tileSize],()=>this._reset(),d.sync),d.watch(()=>{var E,F,G;return[this.tileSize,
null==(E=this.cameraOnSurface)?void 0:E.location,this.tilingScheme,null==(F=this.viewState)?void 0:F.contentCamera,null==(G=this.focus)?void 0:G.location]},()=>this._setDirty(),d.syncAndInitial)]);this.scheduler&&(this._frameWorker=this.scheduler.registerTask(w.TaskPriority.FEATURE_TILE_TREE,this))};D.destroy=function(){this._frameWorker=m.removeMaybe(this._frameWorker);this._handles=m.destroyMaybe(this._handles)};D.addClient=function(){const E=A++;this._clients.add(E);1===this._clients.size&&this._setDirty();
return{remove:()=>this._removeClient(E)}};D._removeClient=function(E){this._clients.delete(E);this._hasClients||this._clear()};D._setDirty=function(){!this._hasClients||this.suspended||this._dirty||(this._frameWorker?(this._dirty=!0,this.notifyChange("updating")):this.runTask(w.noBudget))};D._clear=function(){this.tiles.removeAll();this._idToTile.clear();this._reset();this._dirty=!1;this.notifyChange("updating")};D.runTask=function(E){this._dirty=!1;this._pendingTiles||(this._startUpdate(),m.isSome(this._frameWorker)&&
(this._frameWorker.priority=w.TaskPriority.FEATURE_TILE_TREE_ACTIVE));this._subdivideTilesForView(E);!this._pendingTiles&&m.isSome(this._frameWorker)&&(this._frameWorker.priority=w.TaskPriority.FEATURE_TILE_TREE);this.notifyChange("updating")};D._startUpdate=function(){this.suspended||(this.tilingScheme?(this._tileMeasurements||(this._tileMeasurements=new y.FeatureTileMeasurements3D({renderCoordsHelper:this.renderCoordsHelper,tilingScheme:this.tilingScheme,tileSize:this.tileSize})),this._tileMeasurements.begin(this.viewState.contentCamera,
this.focus.location,this.cameraOnSurface.location.z),this._pendingTiles=this._getRootTiles()):this._clear())};D._reset=function(){this._newTiles.clear();this._pendingTiles=this._tileMeasurements=null;this._setDirty()};D._getRootTiles=function(){return this.rootTileIds.map(E=>new r.FeatureTileDescriptor3D(E[0],E[1],E[2],this.tilingScheme))};D._purgeHorizonTiles=function(E){E.sort((F,G)=>{F=F.measures.screenRect;G=G.measures.screenRect;return F[1]+F[3]-(G[1]+G[3])});k.empty(x);for(let F=0;F<E.length;F++)if(k.expand(x,
E.data[F].measures.screenRect,x),10<k.height(x))return E.data.slice(F,E.length);return[]};D._subdivideTilesForView=function(E){if(this._pendingTiles){for(;0<this._pendingTiles.length&&!E.done;){const F=this._pendingTiles.pop();E.madeProgress();if(!this.filterExtentRect||k.intersects(this.filterExtentRect,F.extent))this._tileMeasurements.updateTile(F),F.measures.visibility!==r.Visibility.INVISIBLE&&(F.measures.shouldSplit?(this.tilingScheme.ensureMaxLod(F.lij[0]+1),this._pendingTiles.push(...F.getChildren())):
this._newTiles.push(F))}0===this._pendingTiles.length&&(this._updateTiles(this._purgeHorizonTiles(this._newTiles)),this._newTiles.clear(),this._tileMeasurements.end(),this._pendingTiles=null)}};D._updateTiles=function(E){for(var F of this.tiles.items)F.used=!1;E=E.filter(G=>{const O=this._idToTile.get(G.id);O?(O.copyMeasurementsFrom(G),O.used=!0):this._idToTile.set(G.id,G);return!O});F=this.tiles.items.filter(G=>G.used?!1:(this._idToTile.delete(G.id),!0));this.tiles.removeMany(F);this.tiles.addMany(E);
this._sortTiles()};D._sortTiles=function(){this.viewState.fixedContentCamera||this.tiles.sort((E,F)=>E.measures.visibility!==F.measures.visibility?E.measures.visibility===r.Visibility.VISIBLE_ON_SURFACE?-1:1:E.measures.distance-F.measures.distance);this.tiles.forEach((E,F)=>E.loadPriority=F)};b._createClass(C,[{key:"tilingScheme",get:function(){const E=this.tilingSchemeOwner.tilingScheme;return E?E.clone():null}},{key:"filterExtent",set:function(E){if(m.isSome(E)&&!E.spatialReference.equals(this.viewState.spatialReference))z.error("#extent",
"extent spatial reference needs to be in the same spatial reference as the view");else{var F=this._get("filterExtent");F===E||m.isSome(F)&&E&&F.equals(E)||(E=m.isSome(E)?E.clone():null,this._set("filterExtent",E),this._setDirty())}}},{key:"filterExtentRect",get:function(){if(m.isNone(this.filterExtent)||!this.tilingScheme)return null;const E=k.create();f.toBoundingRect(this.filterExtent,E,this.tilingScheme.spatialReference);return E}},{key:"rootTileIds",get:function(){return this.filterExtentRect?
this.tilingScheme.rootTilesInExtent(this.filterExtentRect):[[0,0,0]]}},{key:"suspended",set:function(E){E!==this._get("suspended")&&(this._set("suspended",E),this._setDirty())}},{key:"updating",get:function(){return this._dirty||!!this._pendingTiles}},{key:"_hasClients",get:function(){return 0<this._clients.size}},{key:"running",get:function(){return this.updating}}]);return C}(n);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"scheduler",void 0);c.__decorate([e.property({constructOnly:!0})],
a.FeatureTileTree3D.prototype,"renderCoordsHelper",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"tilingSchemeOwner",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"cameraOnSurface",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"focus",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,"viewState",void 0);c.__decorate([e.property({constructOnly:!0})],a.FeatureTileTree3D.prototype,
"terrain",void 0);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"tiles",void 0);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"tileSize",void 0);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"tilingScheme",null);c.__decorate([e.property()],a.FeatureTileTree3D.prototype,"filterExtent",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"filterExtentRect",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,
"rootTileIds",null);c.__decorate([e.property({value:!1})],a.FeatureTileTree3D.prototype,"suspended",null);c.__decorate([e.property({readOnly:!0})],a.FeatureTileTree3D.prototype,"updating",null);a.FeatureTileTree3D=c.__decorate([q.subclass("esri.views.3d.layers.support.FeatureTileTree3D")],a.FeatureTileTree3D);let A=0;const x=k.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileDescriptor3D":function(){define(["exports",
"../../../../geometry/support/aaBoundingRect"],function(a,b){let c=function(){function n(u,v,m,h=null){this.lij=[0,0,0];this.extent=b.create();this.loadPriority=this.resolution=0;this.measures={visibility:a.Visibility.VISIBLE_ON_SURFACE,screenRect:b.create(),distance:0,shouldSplit:!1};this.used=!1;h&&this.acquire(u,v,m,h)}var l=n.prototype;l.acquire=function(u,v,m,h){this.tilingScheme=h;this.id=n.id(u,v,m);this.lij[0]=u;this.lij[1]=v;this.lij[2]=m;h.getExtent(u,v,m,this.extent);this.resolution=h.resolutionAtLevel(u)};
l.release=function(){this.tilingScheme=null};l.getChildren=function(u){const v=this.lij[0]+1,m=2*this.lij[1],h=2*this.lij[2];if(!u)return[new n(v,m,h,this.tilingScheme),new n(v,m+1,h,this.tilingScheme),new n(v,m,h+1,this.tilingScheme),new n(v,m+1,h+1,this.tilingScheme)];u[0].acquire(v,m,h,this.tilingScheme);u[1].acquire(v,m+1,h,this.tilingScheme);u[2].acquire(v,m,h+1,this.tilingScheme);u[3].acquire(v,m+1,h+1,this.tilingScheme);return u};l.copyMeasurementsFrom=function(u){this.measures.visibility=
u.measures.visibility;this.measures.shouldSplit=u.measures.shouldSplit;this.measures.distance=u.measures.distance;b.copy(u.measures.screenRect,this.measures.screenRect)};n.id=function(u,v,m){return`${u}/${v}/${m}`};return n}();a.Visibility=void 0;(function(n){n[n.INVISIBLE=0]="INVISIBLE";n[n.VISIBLE_WHEN_EXTENDED=1]="VISIBLE_WHEN_EXTENDED";n[n.VISIBLE_ON_SURFACE=2]="VISIBLE_ON_SURFACE"})(a.Visibility||(a.Visibility={}));a.FeatureTileDescriptor3D=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileMeasurements3D":function(){define("exports ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/triangle ./FeatureTileDescriptor3D ./FeatureTileVisibility3D ../../webgl-engine/lib/Camera".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){let g=function(){function w(A){this.camera=
new e.Camera;this.focusOnMap=[0,0];this.screenRect=l.create();this.tileSize=A.tileSize;this.renderCoordsHelper=A.renderCoordsHelper;this.tilingScheme=A.tilingScheme;this.visibility=new d.FeatureTileVisibility3D(A.renderCoordsHelper)}var z=w.prototype;z.begin=function(A,x,B){this.camera.copyFrom(A);this.surfaceElevation=B;this.focusOnMap[0]=x.x;this.focusOnMap[1]=x.y;l.fromValues(0,0,A.fullWidth,A.fullHeight,this.screenRect);this.visibility.begin(this.camera,B)};z.end=function(){this.visibility.end()};
z.updateTile=function(A){A.measures.visibility=this.visibility.calculate(A);A.measures.distance=l.distance(A.extent,this.focusOnMap);A.measures.visibility!==h.Visibility.INVISIBLE&&this._updateScreenMeasure(A)};z._updateScreenMeasure=function(A){const x=A.measures.screenRect;l.empty(x);let B=0;const C=A.lij[0]+2,D=A.lij[1]<<2,E=A.lij[2]<<2;var F=this._tileSizeWithBias(A);F*=F;for(let G=0;4>G;G++)for(let O=0;4>O;O++)if(B+=this._computeScreenArea(A,C,D+G,E+O,x),B>F){A.measures.shouldSplit=!0;return}A.measures.shouldSplit=
!1};z._tileSizeWithBias=function(A){return A.measures.visibility===h.Visibility.VISIBLE_WHEN_EXTENDED?5*this.tileSize:this.tileSize};z._computeScreenArea=function(A,x,B,C,D){this._projectToScreen(x,B,C,A.measures.visibility===h.Visibility.VISIBLE_WHEN_EXTENDED,t);l.empty(p);for(A=0;4>A;A++)l.expandPointInPlace(p,t[A]);l.expand(D,p,D);return m.areaPoints2d(t[0],t[1],t[2])+m.areaPoints2d(t[0],t[2],t[3])};z._projectToScreen=function(A,x,B,C,D){this.tilingScheme.ensureMaxLod(A);this.tilingScheme.getExtent(A,
x,B,q);this._toRenderCoords(q,0,3,r[0]);this._toRenderCoords(q,2,3,r[1]);this._toRenderCoords(q,2,1,r[2]);this._toRenderCoords(q,0,1,r[3]);C&&(this._projectToPlane(r,this.camera.frustum[u.PlaneIndex.NEAR]),this._projectToPlane(r,this.camera.frustum[u.PlaneIndex.TOP]),this._projectToPlane(r,this.camera.frustum[u.PlaneIndex.BOTTOM]));for(A=0;4>A;A++)this.camera.projectToRenderScreen(r[A],f),this.camera.renderToScreen(f,D[A])};z._projectToPlane=function(A,x){for(var B=0;4>B;B++)y[B]=v.signedDistance(x,
A[B]);B=Math.max(y[0],y[1],y[2],y[3]);if(0<B)for(x=c.scale(k,v.normal(x),-B),B=0;4>B;B++)c.add(A[B],A[B],x)};z._toRenderCoords=function(A,x,B,C){k[0]=A[x];k[1]=A[B];k[2]=this.surfaceElevation;this.renderCoordsHelper.toRenderCoords(k,this.tilingScheme.spatialReference,C);return C};return w}();const p=l.create(),t=[b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray(),b.createScreenPointArray()],q=l.create(),k=n.create(),r=[n.create(),n.create(),n.create(),n.create()],y=[0,
0,0,0],f=b.createRenderScreenPointArray3();a.FeatureTileMeasurements3D=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/FeatureTileVisibility3D":function(){define("exports ../../../../core/mathUtils ../../../../core/ObjectPool ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/projectionEllipsoid ../../../../geometry/support/frustum ../../../../geometry/support/plane ../../../../geometry/support/ray ../../../ViewingMode ./FeatureTileDescriptor3D ../../state/Frustum ../../support/FrustumExtentIntersection".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){let t=function(){function f(z){this.renderCoordsHelper=z;this.surfaceElevation=0;this.cache=new Map;this.frustum=new g.Frustum(z);this.extendedFrustum=new g.Frustum(z);this.intersector=new p.FrustumExtentIntersection({renderCoordsHelper:z});this.renderCoordsHelper=z}var w=f.prototype;w.begin=function(z,A){this.surfaceElevation=A;this.aboveGround=this.renderCoordsHelper.getAltitude(z.eye)>A;this.frustum.update(z);this._shortenFrustumFarPlane(this.frustum);this._updateExtendedFrustum(z)};
w.end=function(){this.cache.clear()};w.calculate=function(z){if(this.allTilesInvisible)return e.Visibility.INVISIBLE;const A=this.renderCoordsHelper.viewingMode===d.ViewingMode.Global&&2<=z.lij[0]&&6>z.lij[0],x=this._getOrCalculateSingleTileVisibility(z,!A);return x!==e.Visibility.INVISIBLE&&A?this._calculateAggregatedChildrenVisibility(z):x};w._shortenFrustumFarPlane=function(z){var A=g.Frustum.nearFarLineIndices;const x=z.mutablePoints;for(const B of A){const [C,D]=B;A=x[C];n.subtract(q,x[D],A);
n.scale(q,q,.95);n.add(x[D],A,q)}z.updatePoints(x)};w._calculateAggregatedChildrenVisibility=function(z){let A=e.Visibility.INVISIBLE;var x=this.cache.get(z.id);if(null!=x)return x;x=y.acquire();z.getChildren(x);for(const B of x){const C=this.calculate(B);if(C!==e.Visibility.INVISIBLE&&(A=C,C===e.Visibility.VISIBLE_ON_SURFACE))break}y.release(x);this.cache.set(z.id,A);return A};w._getOrCalculateSingleTileVisibility=function(z,A){var x=this.cache.get(z.id);if(null!=x)return x;x=this._calculateSingleTileVisibility(z);
A&&this.cache.set(z.id,x);return x};w._calculateSingleTileVisibility=function(z){if(!this.aboveGround&&this.renderCoordsHelper.viewingMode===d.ViewingMode.Global&&12>z.lij[0]){if(this._calculateSingleTileVisibilitySided(z,!1)===e.Visibility.INVISIBLE)return this._calculateSingleTileVisibilitySided(z,!0)}else return this._calculateSingleTileVisibilitySided(z,this.aboveGround)};w._calculateSingleTileVisibilitySided=function(z,A){this.intersector.update(z.extent,z.tilingScheme.spatialReference,this.surfaceElevation,
A);z=u.getReferenceEllipsoid(z.tilingScheme.spatialReference).radius;return this.intersector.isVisibleInFrustum(this.extendedFrustum,z)?this.intersector.isVisibleInFrustum(this.frustum,z,!0)?e.Visibility.VISIBLE_ON_SURFACE:e.Visibility.VISIBLE_WHEN_EXTENDED:e.Visibility.INVISIBLE};w._updateExtendedFrustum=function(z){this.extendedFrustum.update(z);this._shortenFrustumFarPlane(this.extendedFrustum);var A=this.renderCoordsHelper.worldUpAtPosition(z.eye,q);this.aboveGround||n.negate(A,A);A=b.acosClamped(-n.dot(A,
z.viewForward));this.allTilesInvisible=A>(Math.PI+z.fovY)/2;if(!this.allTilesInvisible&&(this.hasExtendedFrustum=A>z.fovY/2)){z=this._extendedFrustumParameters();A=this.extendedFrustum.mutablePoints;for(let x=0;4>x;x++){const B=z.pointIndices[x],C=A[B],D=this.renderCoordsHelper.getAltitude(C);if(z.needsAltitudeAdjustment(D)){this.renderCoordsHelper.worldUpAtPosition(C,q);switch(B){case v.PointIndex.FAR_BOTTOM_LEFT:case v.PointIndex.FAR_TOP_LEFT:case v.PointIndex.NEAR_BOTTOM_LEFT:case v.PointIndex.NEAR_TOP_LEFT:m.projectVector(this.extendedFrustum.planes[v.PlaneIndex.LEFT],
q,q);break;case v.PointIndex.FAR_BOTTOM_RIGHT:case v.PointIndex.FAR_TOP_RIGHT:case v.PointIndex.NEAR_BOTTOM_RIGHT:case v.PointIndex.NEAR_TOP_RIGHT:m.projectVector(this.extendedFrustum.planes[v.PlaneIndex.RIGHT],q,q)}n.scale(q,q,z.direction);this.renderCoordsHelper.intersectInfiniteManifold(h.wrap(C,q),z.zWithMargin,C)}}this.extendedFrustum.updatePoints(A);m.fromPoints(A[v.PointIndex.NEAR_BOTTOM_LEFT],A[v.PointIndex.NEAR_BOTTOM_RIGHT],A[v.PointIndex.NEAR_TOP_RIGHT],k);m.fromPoints(A[v.PointIndex.NEAR_BOTTOM_RIGHT],
A[v.PointIndex.NEAR_TOP_RIGHT],A[v.PointIndex.NEAR_TOP_LEFT],r);0>n.dot(m.normal(k),m.normal(r))&&(z=this.extendedFrustum.mutablePoints,this.aboveGround?[z[v.PointIndex.NEAR_BOTTOM_LEFT],z[v.PointIndex.NEAR_BOTTOM_RIGHT]]=[z[v.PointIndex.NEAR_BOTTOM_RIGHT],z[v.PointIndex.NEAR_BOTTOM_LEFT]]:[z[v.PointIndex.NEAR_TOP_LEFT],z[v.PointIndex.NEAR_TOP_RIGHT]]=[z[v.PointIndex.NEAR_TOP_RIGHT],z[v.PointIndex.NEAR_TOP_LEFT]],this.extendedFrustum.updatePoints(z))}};w._extendedFrustumParameters=function(){return this.aboveGround?
this._extendedFrustumParametersAboveSurface():this._extendedFrustumParametersBelowSurface()};w._extendedFrustumParametersAboveSurface=function(){const z=this.surfaceElevation-1;return{zWithMargin:z,pointIndices:g.Frustum.planePointIndices.bottom,direction:-1,needsAltitudeAdjustment(A){return A>z}}};w._extendedFrustumParametersBelowSurface=function(){const z=this.surfaceElevation+1;return{zWithMargin:z,pointIndices:g.Frustum.planePointIndices.top,direction:1,needsAltitudeAdjustment(A){return A<z}}};
return f}();const q=l.create(),k=m.create(),r=m.create(),y=new c(Array,f=>{4!==f.length&&(f[0]=new e.FeatureTileDescriptor3D,f[1]=new e.FeatureTileDescriptor3D,f[2]=new e.FeatureTileDescriptor3D,f[3]=new e.FeatureTileDescriptor3D)},f=>{f[0].release();f[1].release();f[2].release();f[3].release()});a.FeatureTileVisibility3D=t;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/Frustum":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers",
"../../../chunks/vec3","../../../chunks/vec3f64","../../../geometry/support/frustum"],function(a,b,c,n,l){function u(m,h,d){m.origin=h;m.endpoint=d;c.direction(m.direction,h,d)}let v=function(){function m(d){this.renderCoordsHelper=d;this.frustum=l.create();this._points=l.createPoints();this.lines=Array(12);this._origin=n.create();this._direction=n.create();this._altitude=null;for(d=0;12>d;d++)this.lines[d]={origin:null,direction:n.create(),endpoint:null}}var h=m.prototype;h.update=function(d){l.fromMatrix(d.viewMatrix,
d.projectionMatrix,this.frustum,this._points);c.copy(this._origin,d.eye);c.copy(this._direction,d.viewForward);this._altitude=this.renderCoordsHelper.getAltitude(this._origin);this._updateLines()};h.updatePoints=function(d){for(let e=0;e<this._points.length;e++)c.copy(this._points[e],d[e]);l.computePlanes(this.frustum,this._points);this._updateLines()};h.intersectsSphere=function(d){return l.intersectsSphere(this.frustum,d)};h.intersectsRay=function(d){return l.intersectsRay(this.frustum,d)};h.intersectsLineSegment=
function(d,e){return l.intersectsLineSegment(this.frustum,d,e)};h.intersectsPoint=function(d){return l.intersectsPoint(this.frustum,d)};h._updateLines=function(){const d=this._points;for(let e=0;4>e;e++){const g=e+4;u(this.lines[e],d[e],d[g]);u(this.lines[e+4],d[e],3===e?d[0]:d[e+1]);u(this.lines[e+8],d[g],3===e?d[4]:d[g+1])}};b._createClass(m,[{key:"planes",get:function(){return this.frustum}},{key:"points",get:function(){return this._points}},{key:"mutablePoints",get:function(){return this._points}},
{key:"direction",get:function(){return this._direction}},{key:"altitude",get:function(){return this._altitude}}]);return m}();v.planePointIndices=l.planePointIndices;v.nearFarLineIndices=[[l.PointIndex.NEAR_BOTTOM_LEFT,l.PointIndex.FAR_BOTTOM_LEFT],[l.PointIndex.NEAR_BOTTOM_RIGHT,l.PointIndex.FAR_BOTTOM_RIGHT],[l.PointIndex.NEAR_TOP_RIGHT,l.PointIndex.FAR_TOP_RIGHT],[l.PointIndex.NEAR_TOP_LEFT,l.PointIndex.FAR_TOP_LEFT]];a.Frustum=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/FrustumExtentIntersection":function(){define("exports ../../../core/compilerUtils ../../../core/mathUtils ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/lineSegment ../../../geometry/support/plane ../../../geometry/support/ray ../../ViewingMode ./intersectionUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){const y=.5*Math.PI,f=y/Math.PI*180;let w=function(){function F(O){this.renderCoordsHelper=O.renderCoordsHelper;this.extent=Array(4);this.planes=Array(6);this.maxSpan=0;this.center={origin:v.create(),direction:v.create()};for(O=0;4>O;O++)this.extent[O]={origin:v.create(),direction:v.create(),cap:{next:null,direction:v.create()}},this.planes[O]=t.create();this.planes[g.PlaneIndex.NEAR]=t.create();this.planes[g.PlaneIndex.FAR]=t.create();this.planesWithoutFar=
this.planes.slice(0,5)}var G=F.prototype;G.update=function(O,K,L,R=!0){const M=this.extent;this._toRenderBoundingExtent(O,K,L);u.add(this.center.origin,M[0].origin,M[2].origin);u.scale(this.center.origin,this.center.origin,.5);this.renderCoordsHelper.worldUpAtPosition(this.center.origin,this.center.direction);R||u.scale(this.center.direction,this.center.direction,-1);for(L=0;4>L;L++){const J=M[L];this.renderCoordsHelper.worldUpAtPosition(J.origin,J.direction);const I=M[3===L?0:L+1];J.cap.next=I.origin;
u.direction(J.cap.direction,J.origin,I.origin);t.fromVectorsAndPoint(J.direction,J.cap.direction,J.origin,this.planes[L]);R||u.scale(J.direction,J.direction,-1)}t.fromVectorsAndPoint(M[0].cap.direction,M[1].cap.direction,M[0].origin,this.planes[g.PlaneIndex.NEAR]);R?t.negate(this.planes[g.PlaneIndex.NEAR],this.planes[g.PlaneIndex.FAR]):(t.copy(this.planes[g.PlaneIndex.FAR],this.planes[g.PlaneIndex.NEAR]),t.negate(this.planes[g.PlaneIndex.NEAR],this.planes[g.PlaneIndex.NEAR]));this.maxSpan=Math.max(Math.abs(O[0]-
O[2]),Math.abs(O[1]-O[3]));this.maxSpanSpatialReference=K;this.minGlobalAltitude=.9*h.getReferenceEllipsoid(this.maxSpanSpatialReference).radius};G.isVisibleInFrustum=function(O,K,L=!1){if(null==O)return!1;if(this.renderCoordsHelper.viewingMode===k.ViewingMode.Global){if(this.maxSpan>(this.maxSpanSpatialReference.isGeographic?f:y*K))return!0;if(O.altitude>=this.minGlobalAltitude)return this._isVisibleInFrustumGlobal(O)}if(0===this.maxSpan)return K=this.extent[0],!L&&O.intersectsRay(q.wrap(K.origin,
K.direction))?!0:!1;for(K=0;K<this.extent.length;K++){var R=this.extent[K];if(!L&&O.intersectsRay(q.wrap(R.origin,R.direction))||O.intersectsLineSegment(p.fromPoints(R.origin,R.cap.next,E),R.cap.direction))return!0}L=L?this.planes:this.planesWithoutFar;for(K=0;K<O.lines.length;K++)if(R=O.lines[K],r.frustumLineSegment(L,R.origin,R.endpoint,R.direction))return!0;return!1};G._toRenderBoundingExtentGlobal=function(O,K,L){e.center(O,A);A[2]=L;m.computeTranslationToOriginAndRotation(K,A,x,this.renderCoordsHelper.spatialReference);
n.invert(B,x);d.empty(C);for(const {x0:R,x1:M,y0:J,y1:I}of z)for(let P=0;5>P;P++){const N=P/4;A[0]=c.lerp(O[R],O[M],N);A[1]=c.lerp(O[J],O[I],N);A[2]=L;m.projectVectorToVector(A,K,A,this.renderCoordsHelper.spatialReference);u.transformMat4(A,A,B);d.expandWithVec3(C,A)}u.set(this.extent[0].origin,C[0],C[1],C[2]);u.set(this.extent[1].origin,C[3],C[1],C[2]);u.set(this.extent[2].origin,C[3],C[4],C[2]);u.set(this.extent[3].origin,C[0],C[4],C[2]);for(O=0;4>O;++O)u.transformMat4(this.extent[O].origin,this.extent[O].origin,
x)};G._toRenderBoundingExtentLocal=function(O,K,L){m.projectBoundingRect(O,K,D,this.renderCoordsHelper.spatialReference);u.set(this.extent[0].origin,D[0],D[1],L);u.set(this.extent[1].origin,D[2],D[1],L);u.set(this.extent[2].origin,D[2],D[3],L);u.set(this.extent[3].origin,D[0],D[3],L)};G._toRenderBoundingExtent=function(O,K,L){switch(this.renderCoordsHelper.viewingMode){case k.ViewingMode.Global:this._toRenderBoundingExtentGlobal(O,K,L);break;case k.ViewingMode.Local:this._toRenderBoundingExtentLocal(O,
K,L);break;default:b.neverReached(this.renderCoordsHelper.viewingMode)}};G._isVisibleInFrustumGlobal=function(O){if(0>t.signedDistance(O.planes[g.PlaneIndex.NEAR],this.center.origin)&&0>u.dot(this.center.direction,O.direction))return!0;for(let K=0;4>K;K++){const L=this.extent[K];if(0>t.signedDistance(O.planes[g.PlaneIndex.NEAR],L.origin)&&0>u.dot(L.direction,O.direction))return!0}return!1};return F}();const z=[{x0:0,y0:1,x1:2,y1:1},{x0:0,y0:3,x1:2,y1:3},{x0:0,y0:1,x1:0,y1:3},{x0:2,y0:1,x1:2,y1:3}],
A=v.create(),x=l.create(),B=l.create(),C=d.create(),D=e.create(),E=p.create();a.FrustumExtentIntersection=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/extentUtils":function(){define(["exports","../../../core/maybe","../../../chunks/vec3f64","../../../geometry/projection"],function(a,b,c,n){const l=c.create();a.projectToBoundingBox=function(u,v,m){if(b.isNone(u)||b.isNone(m))return!1;let h;l[0]=null!=u.xmin?u.xmin:0;l[1]=null!=
u.ymin?u.ymin:0;l[2]=null!=u.zmin?u.zmin:0;h=n.projectBuffer(l,u.spatialReference,0,v,m,0,1);l[0]=null!=u.xmax?u.xmax:0;l[1]=null!=u.ymax?u.ymax:0;l[2]=null!=u.zmax?u.zmax:0;h=h&&n.projectBuffer(l,u.spatialReference,0,v,m,3,1);null==u.xmin&&(v[0]=-Infinity);null==u.ymin&&(v[1]=-Infinity);null==u.zmin&&(v[2]=-Infinity);null==u.xmax&&(v[3]=Infinity);null==u.ymax&&(v[4]=Infinity);null==u.zmax&&(v[5]=Infinity);return h};a.toBoundingRect=function(u,v,m){if(b.isNone(u)||b.isNone(m))return!1;let h;l[0]=
null!=u.xmin?u.xmin:0;l[1]=null!=u.ymin?u.ymin:0;l[2]=null!=u.zmin?u.zmin:0;h=n.projectBuffer(l,u.spatialReference,0,l,m,0,1);v[0]=l[0];v[1]=l[1];l[0]=null!=u.xmax?u.xmax:0;l[1]=null!=u.ymax?u.ymax:0;l[2]=null!=u.zmax?u.zmax:0;h=h&&n.projectBuffer(l,u.spatialReference,0,l,m,0,1);v[2]=l[0];v[3]=l[1];null==u.xmin&&(v[0]=-Infinity);null==u.ymin&&(v[1]=-Infinity);null==u.xmax&&(v[2]=Infinity);null==u.ymax&&(v[3]=Infinity);return h};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/ViewState":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../core/accessorSupport/watch ../../../chunks/vec3f64 ../../../geometry/projectionEllipsoid ../../ViewAnimation ../../ViewingMode ./Constraints ./controllers/AnimationController ./controllers/CameraController ../support/PropertiesPool ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z){c=function(C){function D(){var F=C.apply(this,arguments)||this;F._propertiesPool=new w.PropertiesPool({camera:z.Camera},a._assertThisInitialized(F));F._lastSeenCameraProjectionValues=new z.Camera;F.events=new n;F.viewingMode=k.ViewingMode.Global;F._cameraChanged=!1;F.updateQueue=[];F.processingUpdates=!1;return F}a._inheritsLoose(D,C);var E=D.prototype;E.init=function(F,G){this._set("viewingMode",F);this._set("spatialReference",G);this._set("constraints",
new r.Constraints({mode:this.viewingMode}))};E.exit=function(){this.cameraController=null;this._propertiesPool.destroy();this._propertiesPool=new w.PropertiesPool({camera:z.Camera},this)};E.createInitialCamera=function(){if(this.viewingMode===k.ViewingMode.Global){const F=t.getReferenceEllipsoid(this.spatialReference).radius;this.camera=new z.Camera(p.fromValues(4*F,0,0),p.fromValues(F,0,0),p.fromValues(0,0,1))}else this.camera=new z.Camera(p.fromValues(0,0,100),p.fromValues(0,0,0),p.fromValues(0,
1,0))};E.switchCameraController=function(F){this.cameraController=F;return F.state!==f.State.Rejected};E.stopActiveCameraController=function(){return this.cameraController&&!this.cameraController.stopController()?!1:!0};E.updateCamera=function(F){this.updateQueue.push(F);this._processUpdateQueue()};E._processUpdateQueue=function(){if(0!==this.updateQueue.length&&!this.processingUpdates){this.processingUpdates=!0;var F=this.updateQueue.shift();A.copyFrom(this._get("camera"));F(A);this.camera=A;this.processingUpdates=
!1;this._processUpdateQueue()}};E._cameraProjectionChanged=function(F,G){return F.fov!==G.fov||F.fullViewport[0]!==G.fullViewport[0]||F.fullViewport[1]!==G.fullViewport[1]||F.fullViewport[2]!==G.fullViewport[2]||F.fullViewport[3]!==G.fullViewport[3]||F.padding[z.PaddingSide.TOP]!==G.padding[z.PaddingSide.TOP]||F.padding[z.PaddingSide.RIGHT]!==G.padding[z.PaddingSide.RIGHT]||F.padding[z.PaddingSide.BOTTOM]!==G.padding[z.PaddingSide.BOTTOM]||F.padding[z.PaddingSide.LEFT]!==G.padding[z.PaddingSide.LEFT]?
!0:!1};a._createClass(D,[{key:"animation",get:function(){return this.cameraController instanceof y.AnimationController&&l.isSome(this.cameraController.viewAnimation)?this.cameraController.viewAnimation:null}},{key:"camera",get:function(){return this._get("camera")},set:function(F){F!==A&&A.copyFrom(F);A.computeUp(this.viewingMode);x.camera=A;this.events.emit("before-camera-change",x);F=this._get("camera");this._cameraProjectionChanged(this._lastSeenCameraProjectionValues,A)&&(this._lastSeenCameraProjectionValues.copyFrom(A),
B.camera=this._lastSeenCameraProjectionValues,this.events.emit("camera-projection-changed",B));if(!F||!F.equals(A))if(this._set("camera",this._propertiesPool.get("camera").copyFrom(A)),this._cameraChanged=!F||!F.almostEquals(A)){const G=g.afterDispatch(()=>{this._cameraChanged=!1;G.remove()})}}},{key:"pixelRatio",get:function(){return this.camera.pixelRatio}},{key:"contentCamera",get:function(){return l.isSome(this._contentCamera)?this._contentCamera:this.camera},set:function(F){this._contentCamera=
l.isSome(F)?F.clone():null}},{key:"fixedContentCamera",get:function(){return l.isSome(this._contentCamera)}},{key:"isGlobal",get:function(){return this.viewingMode===k.ViewingMode.Global}},{key:"isLocal",get:function(){return this.viewingMode===k.ViewingMode.Local}},{key:"navigating",get:function(){return!(!this.cameraController||!this.cameraController.isInteractive)}},{key:"stationary",get:function(){return!this._cameraChanged&&!this.navigating}},{key:"cameraController",get:function(){return this._get("cameraController")},
set:function(F){this.stopActiveCameraController()?(F&&(this.own(u.watch(()=>F.state,G=>{if(G===f.State.Finished||G===f.State.Stopped)this._set("cameraController",null),this.updateCamera(O=>F.onControllerEnd(O))},u.sync)),F.onControllerStart(this.camera)),this._set("cameraController",F)):F&&(F.state=f.State.Rejected)}}]);return D}(c);b.__decorate([v.property({readOnly:!0,type:q})],c.prototype,"animation",null);b.__decorate([v.property({type:z.Camera})],c.prototype,"camera",null);b.__decorate([v.property()],
c.prototype,"pixelRatio",null);b.__decorate([v.property({})],c.prototype,"_contentCamera",void 0);b.__decorate([v.property({type:z.Camera})],c.prototype,"contentCamera",null);b.__decorate([v.property({readOnly:!0})],c.prototype,"fixedContentCamera",null);b.__decorate([v.property({readOnly:!0})],c.prototype,"constraints",void 0);b.__decorate([v.property({readOnly:!0})],c.prototype,"events",void 0);b.__decorate([v.property({readOnly:!0})],c.prototype,"isGlobal",null);b.__decorate([v.property({readOnly:!0})],
c.prototype,"isLocal",null);b.__decorate([v.property({readOnly:!0})],c.prototype,"viewingMode",void 0);b.__decorate([v.property({readOnly:!0})],c.prototype,"spatialReference",void 0);b.__decorate([v.property({readOnly:!0})],c.prototype,"navigating",null);b.__decorate([v.property({readOnly:!0})],c.prototype,"stationary",null);b.__decorate([v.property()],c.prototype,"_cameraChanged",void 0);b.__decorate([v.property()],c.prototype,"cameraController",null);b=c=b.__decorate([e.subclass("esri.views.3d.state.ViewState")],
c);const A=new z.Camera,x={camera:null},B={camera:null};return b})},"esri/views/3d/state/ViewStateManager":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Camera ../../../Viewpoint ../../../core/Accessor ../../../core/Handles ../../../core/Logger ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/screenUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/Extent ../../../geometry/Point ../../../geometry/support/webMercatorUtils ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ./ConstraintsManager ./Frustum ./GoToOperation ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/PropertiesPool ../support/viewpointUtils ../webgl-engine/lib/Camera".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M){const J=v.getLogger("esri.views.3d.state.ViewStateManager");l=function(H){function U(Q){var X=H.call(this,Q)||this;X.propertiesPool=new L.PropertiesPool({frustum:F.Frustum},a._assertThisInitialized(X));X.handles=new u;X.cameraSetByUser=!1;X.gotoOperation=null;X.ready=!1;X._windowDevicePixelRatio=1;X._devicePixelRatioOverride=null;X._maximumPixelRatioOverride=null;X.test={contentCameraResetState:new Map,setDevicePixelRatio:ba=>
X._devicePixelRatioOverride=ba,setMaximumPixelRatio:ba=>X._maximumPixelRatioOverride=ba};return X}a._inheritsLoose(U,H);var W=U.prototype;W.installContentCameraReset=function(Q){this.handles.remove("contentCameraReset");this.test.contentCameraResetState.clear();if(!this.view.state.fixedContentCamera)return!1;const X=this.zoom,ba=this.view.state.camera.distance**2,aa=y.fromArray(this.view.state.camera.center),ea=Q.sticky?this.contentCamera.clone():null;this.handles.add([h.watch(()=>this.contentCamera,
()=>{Q.sticky||(this.handles.remove("contentCameraReset"),this.test.contentCameraResetState.clear())}),h.watch(()=>this.zoom,ia=>{this.test.contentCameraResetState.set("view.zoom",Math.abs(ia-X)/2);2<Math.abs(ia-X)?this.contentCamera=null:this.view.state.fixedContentCamera||(this.contentCamera=ea)}),h.watch(()=>this.view.state.camera,ia=>{ia=r.squaredDistance(aa,ia.center);this.test.contentCameraResetState.set("camera.center",ia/ba);ia>ba?this.contentCamera=null:this.view.state.fixedContentCamera||
(this.contentCamera=ea)})],"contentCameraReset");return!0};W._paddingToArray=function(Q,X,ba){Q?f.set(ba,Q.top||0,Q.right||0,Q.bottom||0,Q.left||0):f.set(ba,0,0,0,0);for(Q=0;4>Q;Q++)ba[Q]=Math.round(ba[Q]*X)};W.initialize=function(){this.handles.add([h.on(()=>this.view.state.events,"before-camera-change",Q=>this._updateElevation(Q.camera))]);h.watch(()=>this.view.state.camera,Q=>this._updateElevation(Q),{once:!0,sync:!0});this.handles.add(d.addFrameTask({prepare:()=>this._prepareFrame()}));this.handles.add(h.watch(()=>
this.view.state.cameraController,()=>{this.cameraSetByUser=!0;this.handles.remove("pending-initial-view")}));this.handles.add(h.on(()=>this.view.state.events,"camera-projection-changed",()=>this.notifyChange("scale")))};W.destroy=function(){this.deinit();this.handles&&(this.handles.destroy(),this.handles=null);this.propertiesPool&&(this.propertiesPool.destroy(),this.propertiesPool=null)};W.init=function(){this.constraintsManager=new E.ConstraintsManager({view:this.view});this._prepareFrame();var Q=
this._getInitialProperties();this.cameraSetByUser=!1;this._set("ready",!0);for(const X of Q)this.set(X.name,X.value);this.cameraSetByUser||((Q=this.view.get("map.initialViewProperties.viewpoint")||this.view.initialExtent)&&this.isCompatible(Q)?this._setInitialView(Q):this.view.state.viewingMode===B.ViewingMode.Local&&this.handles.add(h.when(()=>this.view.basemapTerrain.ready,()=>{this.handles.remove("pending-initial-view");this._setInitialView(this.view.dataExtent)},{once:!0,initial:!0}),"pending-initial-view"))};
W.deinit=function(){this._cancelGoToOperation();this.ready&&(this._override("padding",this.padding),this._set("ready",!1),this._clearOverride("hasInitialView"),this.cameraSetByUser=!1,this.handles.remove("pending-initial-view"),this.constraintsManager&&(this.constraintsManager.destroy(),this.constraintsManager=null))};W.goTo=function(){var Q=a._asyncToGenerator(function*(X,ba){ba={animate:!0,...ba};m.isSome(this.gotoOperation)&&this.gotoOperation.abort(ba.animate);this.gotoOperation=new G.GoToOperation(X,
ba,this.view);this.view.resourceController.scheduler.stopFrame();return this.gotoOperation});return function(X,ba){return Q.apply(this,arguments)}}();W.debugSetCameraOnContent=function(){this.setStateCamera(D.cameraOnContentAlongViewDirection(this.view),{applyConstraints:!1})};W.step=function(Q){const X=this.view.state,ba=X&&this.view.state.cameraController;ba&&(X.updateCamera(aa=>{ba.stepController(Q,aa)}),ba.steppingFinished&&ba.finishController())};W._cancelGoToOperation=function(){m.isSome(this.gotoOperation)&&
(this.gotoOperation.abort(),this.gotoOperation=null)};W._getInitialProperties=function(){const Q=new Set,X=[];for(const {propertyName:ba,overrides:aa}of P){const ea=Q.has(ba),ia=this._isOverridden(ba);!ea&&ia&&X.push({name:ba,value:this._get(ba)});this._clearOverride(ba);(ea||ia)&&aa.forEach(ka=>Q.add(ka))}return X};W._setInitialView=function(Q){if(!m.isNone(Q)&&!this.cameraSetByUser)if(Q instanceof c)this.setStateCamera(K.externalToInternal(this.view,Q),{applyConstraints:!1});else if(Q instanceof
n)if(Q.targetGeometry instanceof z){var X=K.fromExtent(this.view,Q.targetGeometry,0,.5,K.OrientationMode.LOCKED);m.isSome(X)&&this.setStateCamera(K.externalToInternal(this.view,X),{applyConstraints:!0})}else X={applyConstraints:!Q.camera},Q=this._viewpointToCamera(Q),this.setStateCamera(Q,X);else X=K.fromExtent(this.view,Q,0,.5,K.OrientationMode.LOCKED),m.isSome(X)&&this.setStateCamera(K.externalToInternal(this.view,X),{applyConstraints:!0})};W._updatePropertyBeforeReady=function(Q,X){if(this.ready)return!1;
this._override(Q,X);X&&I.includes(Q)&&this._override("hasInitialView",!0);return!0};W.isCompatible=function(Q){return m.isNone(Q)?!1:Q instanceof n?Q.camera?this.isCompatible(Q.camera):this.isCompatible(Q.targetGeometry):Q instanceof c?this.isCompatible(Q.position):Q.spatialReference&&x.canProject(Q.spatialReference,this.view.spatialReference)};W._getPreservingHeadingTilt=function(Q=N){this.cameraSetByUser?(Q.heading=this.camera.heading,Q.tilt=this.camera.tilt):(Q.heading=0,Q.tilt=.5);return Q};W._centerPointAtDistanceToCamera=
function(Q,X,ba=S){const {heading:aa,tilt:ea}=this._getPreservingHeadingTilt();Q=K.getObserverForPointAtDistance(this.view,aa,ea,Q,X,K.OrientationMode.ADJUST);if(m.isNone(Q))return null;ba.copyFrom(this.view.state.camera);ba.eye=Q.eye;ba.center=Q.center;ba.up=Q.up;return ba};W._centerToCamera=function(Q){const X=this.view.pointsOfInterest.centerOnContent;X.runTask();return this._centerPointAtDistanceToCamera(Q,X.distance)};W._extentToCamera=function(Q){const {heading:X,tilt:ba}=this._getPreservingHeadingTilt();
Q=K.fromExtent(this.view,Q,X,ba,K.OrientationMode.ADJUST,V);return m.isSome(Q)?K.externalToInternal(this.view,Q):null};W._scaleToCamera=function(Q){if(null==Q)return null;const X=this.view.pointsOfInterest.centerOnContent;X.runTask();const ba=X.renderLocation;Q=K.scaleToDistance(this.view,Q,X.location.latitude);return this._centerPointAtDistanceToCamera(ba,Q)};W._zoomToCamera=function(Q){return this._scaleToCamera(K.zoomToScale(this.view,Q))};W._viewpointToCamera=function(Q){return K.externalToInternal(this.view,
R.toCamera(this.view,Q))};W.setStateCamera=function(Q,X){if(m.isNone(Q)||!this.view.state.stopActiveCameraController())return!1;this.cameraSetByUser=!0;X.doNotCancelGoToOperation||this._cancelGoToOperation();this.view.state.updateCamera(ba=>{X.positionAndOrientationOnly?(ba.eye=Q.eye,ba.center=Q.center,ba.up=Q.up):ba.copyFrom(Q);X.applyConstraints&&C.applyAll(this.view,ba)});X.applyConstraints||(this.view.state.cameraController=new O.SurfaceCollisionCorrectionController({view:this.view,desiredCamera:Q}));
return!0};W._prepareFrame=function(){const {surface:Q,canvas:X}=this.view;if(Q&&X){this._windowDevicePixelRatio=window.devicePixelRatio;var ba=this._devicePixelRatio,aa=Math.round(Q.clientWidth*ba),ea=Math.round(Q.clientHeight*ba);if(0!==aa&&0!==ea){if(X.width!==aa||X.height!==ea)X.width=aa,X.height=ea;if(this.view.state){const ia=this.view.state.camera;if(ia.fullWidth!==aa||ia.fullHeight!==ea||ia.pixelRatio!==ba)S.copyFrom(ia),S.pixelRatio!==ba&&(this._paddingToArray(this.padding,ba,T),S.padding=
T),S.fullWidth=aa,S.fullHeight=ea,S.pixelRatio=ba,this.view.state.camera=S}}}};W._updateElevation=function(Q){var X=this.view.basemapTerrain&&this.view.basemapTerrain.spatialReference;const ba=this.view.renderCoordsHelper.getAltitude(Q.eye);X=X?D.surfaceElevationBelowRenderLocation(this.view,Q.eye):0;Q.relativeElevation=ba-X};a._createClass(U,[{key:"camera",get:function(){const Q=this._get("camera");if(!this.ready)return Q;const X=K.internalToExternal(this.view,this.view.state.camera);return X&&Q&&
X.equals(Q)?Q:X},set:function(Q){this._updatePropertyBeforeReady("camera",Q)||(this.view.elevationProvider.enableElevationCache(!0),this.setStateCamera(K.externalToInternal(this.view,Q),{applyConstraints:!1})||J.error("#camera\x3d","Invalid camera",Q),this.view.elevationProvider.enableElevationCache(!1))}},{key:"contentCamera",get:function(){const Q=this._get("contentCamera");if(!this.ready)return Q;const X=K.internalToExternal(this.view,this.view.state.contentCamera);return X&&Q&&X.equals(Q)?Q:X},
set:function(Q){this._updatePropertyBeforeReady("contentCamera",Q)||(Q=K.externalToInternal(this.view,Q),m.isNone(Q)?this.view.state.contentCamera=null:(this._updateElevation(Q),this.view.state.contentCamera=Q))}},{key:"center",get:function(){return this.ready?this.view.pointsOfInterest.centerOnContent.location:this._get("center")},set:function(Q){this._updatePropertyBeforeReady("center",Q)||(Q?this.isCompatible(Q)?this.setStateCamera(this._centerToCamera(Q),{applyConstraints:!0})?this.view.pointsOfInterest.centerOnContent.runTask():
J.error("#center\x3d","Invalid center",Q):J.error("#center\x3d","Center has an incompatible spatial reference (center: "+(Q.spatialReference?Q.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",Q):J.error("#center\x3d","Center may not be null or undefined"))}},{key:"extent",get:function(){if(!this.ready)return this._get("extent");var Q=this.view;Q=K.toExtent(Q,Q.state.camera,Q.pointsOfInterest.centerOnContent.renderLocation);return m.isSome(Q)?Q:this._get("extent")},set:function(Q){this._updatePropertyBeforeReady("extent",
Q)||(Q?this.isCompatible(Q)?this.setStateCamera(this._extentToCamera(Q),{applyConstraints:!0})||J.error("#extent\x3d","Invalid extent",Q):J.error("#extent\x3d","Extent has an incompatible spatial reference (extent: "+(Q.spatialReference?Q.spatialReference.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",Q):J.error("#extent\x3d","Extent may not be null or undefined"))}},{key:"frustum",get:function(){const Q=this.propertiesPool.get("frustum");Q.renderCoordsHelper=this.view.renderCoordsHelper;
Q.update(this.view.state.camera);return Q}},{key:"hasInitialView",get:function(){return!!this.view.get("map.initialViewProperties.viewpoint")}},{key:"scale",get:function(){if(this.ready){const Q=this.view.pointsOfInterest.centerOnContent;return K.distanceToScale(this.view,Q.distance,Q.location.latitude)}return this._get("scale")},set:function(Q){this._updatePropertyBeforeReady("scale",Q)||this.setStateCamera(this._scaleToCamera(Q),{applyConstraints:!0})||J.error("#scale\x3d","Invalid scale",Q)}},
{key:"padding",get:function(){if(!this.ready)return this._get("padding");var Q=this.view.state.camera,X=Q.padding;const ba=Q.pixelRatio;Q=this._get("padding");const aa=Math.round(X[M.PaddingSide.TOP]/ba),ea=Math.round(X[M.PaddingSide.RIGHT]/ba),ia=Math.round(X[M.PaddingSide.BOTTOM]/ba);X=Math.round(X[M.PaddingSide.LEFT]/ba);return null!=Q&&Q.top===aa&&Q.right===ea&&Q.bottom===ia&&Q.left===X?Q:{top:aa,right:ea,bottom:ia,left:X}},set:function(Q){this._updatePropertyBeforeReady("padding",Q)||(this._paddingToArray(Q,
this.view.state.camera.pixelRatio,T),this.view.state.updateCamera(X=>X.padding=T))}},{key:"screenCenter",get:function(){const Q=this.padding;return e.createScreenPoint((this.view.width-(Q.left+Q.right))/2+Q.left,(this.view.height-(Q.top+Q.bottom))/2+Q.top)}},{key:"viewpoint",get:function(){return this.ready?R.fromCamera(this.view,this.camera):this._get("viewpoint")},set:function(Q){if(!this._updatePropertyBeforeReady("viewpoint",Q))if(Q)if(this.isCompatible(Q))this.setStateCamera(this._viewpointToCamera(Q),
{applyConstraints:!Q.camera})||J.error("#viewpoint\x3d","Invalid viewpoint",Q);else{var X=m.isSome(Q.camera)?Q.camera.position:Q.targetGeometry;X=m.isSome(X)&&X.spatialReference;J.error("#viewpoint\x3d","Viewpoint has an incompatible spatial reference (viewpoint: "+(X?X.wkid:"none")+", view: "+this.view.spatialReference.wkid+")",Q)}else J.error("#viewpoint\x3d","Viewpoint may not be null or undefined")}},{key:"zoom",get:function(){return this.ready?K.scaleToZoom(this.view,this.scale):this._get("zoom")},
set:function(Q){this._updatePropertyBeforeReady("zoom",Q)||this.setStateCamera(this._zoomToCamera(Q),{applyConstraints:!0})||J.error("#zoom\x3d","Invalid zoom",Q)}},{key:"maximumPixelRatio",get:function(){if(m.isSome(this._maximumPixelRatioOverride))return this._maximumPixelRatioOverride;let Q=Infinity;const {maximumPixelRatio:X,maximumRenderResolution:ba}=this.view.qualitySettings;null!=X&&(Q=Math.min(Q,X));null!=ba&&(Q=Math.min(Q,ba/Math.max(this.view.width,this.view.height)));return Q}},{key:"_devicePixelRatio",
get:function(){return m.isNone(this._devicePixelRatioOverride)?Math.min(this._windowDevicePixelRatio,this.maximumPixelRatio):this._devicePixelRatioOverride}}]);return U}(l);b.__decorate([g.property({type:c,dependsOn:["view.state.camera","ready"]})],l.prototype,"camera",null);b.__decorate([g.property({type:c,dependsOn:["view.state.contentCamera","ready"]})],l.prototype,"contentCamera",null);b.__decorate([g.property({type:A})],l.prototype,"center",null);b.__decorate([g.property({type:z})],l.prototype,
"extent",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"frustum",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"hasInitialView",null);b.__decorate([g.property({readOnly:!0,type:Boolean})],l.prototype,"ready",void 0);b.__decorate([g.property({type:Number})],l.prototype,"scale",null);b.__decorate([g.property()],l.prototype,"padding",null);b.__decorate([g.property({readOnly:!0})],l.prototype,"screenCenter",null);b.__decorate([g.property({constructOnly:!0})],l.prototype,"view",
void 0);b.__decorate([g.property({type:n})],l.prototype,"viewpoint",null);b.__decorate([g.property({type:Number})],l.prototype,"zoom",null);b.__decorate([g.property()],l.prototype,"maximumPixelRatio",null);b.__decorate([g.property()],l.prototype,"_devicePixelRatio",null);b.__decorate([g.property()],l.prototype,"_windowDevicePixelRatio",void 0);b.__decorate([g.property()],l.prototype,"_devicePixelRatioOverride",void 0);b.__decorate([g.property()],l.prototype,"_maximumPixelRatioOverride",void 0);b=
l=b.__decorate([k.subclass("esri.views.3d.state.ViewStateManager")],l);const I="camera viewpoint extent scale center zoom".split(" "),P=[{propertyName:"camera",overrides:["viewpoint"]},{propertyName:"viewpoint",overrides:["extent"]},{propertyName:"extent",overrides:["center","scale"]},{propertyName:"center",overrides:[]},{propertyName:"scale",overrides:["zoom"]},{propertyName:"zoom",overrides:[]},{propertyName:"padding",overrides:[]}],N={heading:0,tilt:0},V=new c,S=new M.Camera,T=w.create();return b})},
"esri/views/3d/state/ConstraintsManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../ViewingMode ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/common ./NearFarHeuristic ./SurfaceCollisionConstraint".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){a.ConstraintsManager=function(w){function z(x){var B=w.call(this,x)||this;B._handles=new l;B.nearFarHeuristic=y.createNearFarHeuristic(x.view.state.viewingMode,x.view.basemapTerrain,x.view.renderCoordsHelper.spatialReference);return B}b._inheritsLoose(z,w);var A=z.prototype;A.initialize=function(){this._handles.add([m.watch(()=>{var x,B,C,D;return[null==(x=this.view.constraints)?void 0:null==(B=x.clipDistance)?void 0:B.near,null==(C=this.view.constraints)?
void 0:null==(D=C.clipDistance)?void 0:D.far]},()=>this._clipDistanceNearFarChanged()),m.watch(()=>{var x,B;return null==(x=this.view.constraints)?void 0:null==(B=x.clipDistance)?void 0:B.mode},()=>this._updateNearFar()),this.view.state.events.on("before-camera-change",x=>this._updateCameraNearFar(x.camera)),m.watch(()=>this.view.renderDataExtent,()=>this._updateNearFar(),m.sync),m.watch(()=>{var x,B,C,D;return[null==(x=this.view.constraints)?void 0:null==(B=x.altitude)?void 0:B.min,null==(C=this.view.constraints)?
void 0:null==(D=C.altitude)?void 0:D.max]},()=>this._updateAltitude(),m.sync),m.watch(()=>{var x,B;return null==(x=this.view.constraints)?void 0:null==(B=x.tilt)?void 0:B.max},()=>this._updateTiltMax(),m.sync),m.watch(()=>{var x,B;return null==(x=this.view.constraints)?void 0:null==(B=x.tilt)?void 0:B.mode},()=>this._updateTilt(),m.sync),m.watch(()=>{var x;return null==(x=this.view.state)?void 0:x.camera},()=>this._updateTiltAutoMax(),m.sync),m.watch(()=>{var x,B,C,D,E,F;return[null==(x=this.view.map)?
void 0:null==(B=x.ground)?void 0:null==(C=B.navigationConstraint)?void 0:C.type,null==(D=this.view.state)?void 0:null==(E=D.constraints)?void 0:null==(F=E.collision)?void 0:F.enabled]},()=>this._updateCollision(),m.sync)]);this.view.state.isLocal&&this._handles.add(m.watch(()=>this.view.renderDataExtent,x=>this._updateLocalSurfaceDistance(x),m.initial));this._updateNearFar();this.view.state.viewingMode!==t.ViewingMode.Local&&this._updateAltitude();this._updateTilt();this._updateCollision();this._set("surfaceCollisionConstraint",
new f.SurfaceCollisionConstraint({view:this.view}))};A.destroy=function(){this._handles=v.destroyMaybe(this._handles);this.surfaceCollisionConstraint&&(this.surfaceCollisionConstraint.destroy(),this._set("surfaceCollisionConstraint",null))};A._clipDistanceNearFarChanged=function(){var x;const B=null==(x=this.view.constraints)?void 0:x.clipDistance;B&&"auto"!==B.mode&&this.view.state.updateCamera(C=>{this._updateCameraNearFarManual(C,B);return!0})};A._updateNearFar=function(){this.view.state.updateCamera(x=>
{this._updateCameraNearFar(x);return!0})};A._updateCameraNearFar=function(x){const B=this.view.constraints&&this.view.constraints.clipDistance;"manual"===(B?B.mode:"auto")?this._updateCameraNearFarManual(x,B):this._updateCameraNearFarAuto(x,B)};A._updateCameraNearFarAuto=function(x,B){this.nearFarHeuristic.compute(x.eye,x.center,this.view.renderDataExtent,k.surfaceElevationBelowRenderLocation(this.view,x.eye),x);B&&B.autoUpdate(x.near,x.far)};A._updateCameraNearFarManual=function(x,B){B&&(x.near=
B.near,x.far=B.far)};A._updateCollision=function(){var x,B,C;const D=null==(x=this.view.map)?void 0:null==(B=x.ground)?void 0:null==(C=B.navigationConstraint)?void 0:C.type;x=D?"stay-above"===D:!0;B=this.view.state.constraints.collision;x!==B.enabled&&((B.enabled=x)&&this._reapplyConstraints(r.ConstraintTypes.COLLISION),(x=this.view.constraints&&this.view.constraints.tilt)&&"auto"!==x.mode||this._updateTiltAuto())};A._updateAltitude=function(){const x=this.view.constraints&&this.view.constraints.altitude;
this.view.state.constraints.altitude=x&&this.view.state.viewingMode!==t.ViewingMode.Local?{min:x.min,max:x.max}:null;this._reapplyConstraints()};A._updateTiltMax=function(){const x=this.view.constraints&&this.view.constraints.tilt;x&&"auto"!==x.mode&&(this._updateTiltManual(x),this._reapplyConstraints())};A._updateTilt=function(){const x=this.view.constraints&&this.view.constraints.tilt;"manual"===(x?x.mode:"auto")?this._updateTiltManual(x):this._updateTiltAuto();this._reapplyConstraints()};A._updateTiltManual=
function(x){const B=this.view.state.constraints;B.tilt=B.createConstantMaxTilt(u.deg2rad(x.max))};A._updateTiltAuto=function(){const x=this.view.state.constraints;x.tilt=x.createDefaultTilt();this._updateTiltAutoMax()};A._updateTiltAutoMax=function(){const x=this.view.constraints&&this.view.constraints.tilt;if(x&&"auto"===x.mode){var B=this.view.state.constraints;B.tilt&&(B=B.tilt(this.view.state.camera.distance).max,x.autoUpdate(u.rad2deg(B)))}};A._updateLocalSurfaceDistance=function(x){if(!v.isNone(x)){var B=
Math.max(x.width,x.height);0>=B||(x.hasZ&&(B=Math.max(B,x.zmax-x.zmin)),x=this.view.state,B=3*B/Math.atan(x.camera.fov/2),B!==x.constraints.distance&&(x.constraints.distance=B))}};A._reapplyConstraints=function(x=r.ConstraintTypes.ALL){this.view.state.updateCamera(B=>q.applyAll(this.view,B,{selection:x,interactionType:r.InteractionType.NONE,interactionFactor:null,interactionStartCamera:null,interactionDirection:null,tiltMode:r.TiltMode.TUMBLE}))};return z}(n);c.__decorate([h.property({constructOnly:!0})],
a.ConstraintsManager.prototype,"view",void 0);c.__decorate([h.property({readOnly:!0})],a.ConstraintsManager.prototype,"surfaceCollisionConstraint",void 0);a.ConstraintsManager=c.__decorate([p.subclass("esri.views.3d.state.ConstraintsManager")],a.ConstraintsManager);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/NearFarHeuristic":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../core/unitUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/Extent ../../../geometry/projectionEllipsoid ../../ViewingMode".split(" "),
function(a,b,c,n,l,u,v,m,h){function d(q,k,r,y){r=2/r;q/k>r?(y.far=q,y.near=y.far/k):(y.near=r,y.far=y.near*k);return y}let e=function(){function q(k,r){this.elevationProvider=k;this._referenceEllipsoid=m.getReferenceEllipsoid(r);this.unitInMeters=n.getMetersPerUnitForSR(r,this._referenceEllipsoid.metersPerDegree)}q.prototype.compute=function(k,r,y,f,w){w||(w={near:0,far:0});var z=k[2]*this.unitInMeters,A=z;f=z-f;var x=this.elevationProvider?this.elevationProvider.elevationBounds:null;x&&(z=0<=f?
A-this.unitInMeters*x.min:this.unitInMeters*x.max-A);y=c.isSome(y)?y:new v({xmin:0,ymin:0,zmin:0,xmax:0,ymax:0,zmax:0});A=Math.max(y.xmax-y.xmin,y.ymax-y.ymin,4*Math.max(y.xmax-y.xmin,y.ymax-y.ymin));l.subtract(t,r,k);p[0]=0<t[0]?y.xmax:y.xmin;p[1]=0<t[1]?y.ymax:y.ymin;p[2]=0<t[2]?A/2:-A/2;l.subtract(p,p,k);l.normalize(t,t);k=1.1*l.dot(p,t)*this.unitInMeters;r=Math.sqrt(z*(z+2*this._referenceEllipsoid.radius));y=Math.max(y.xmax-y.xmin,y.ymax-y.ymin);x=1E-4*y*this.unitInMeters;z=b.clamp((z-x)/(.001*
y*this.unitInMeters-x),0,1);z=b.lerp(r,k,z*z*z);z*=Math.max(Math.log(Math.abs(f)),1);z=Math.min(z,Math.max(34064E4,A));z/=this.unitInMeters;return d(z,2E4,this.unitInMeters,w)};return q}(),g=function(){function q(k){this._referenceEllipsoid=m.getReferenceEllipsoid(k)}q.prototype.compute=function(k,r,y,f,w){w||(w={near:0,far:0});k=l.length(k)-this._referenceEllipsoid.radius;k=Math.max(Math.abs(k-f),Math.abs(k));f=Math.sqrt(k*(k+2*(this._referenceEllipsoid.radius+Math.min(0,f))));k=b.clamp(2E4-(Math.log(k)-
7.983)/9.011*19E3,1E3,2E4);return d(1.2*f,k,1,w)};return q}();const p=u.create(),t=u.create();a.createNearFarHeuristic=function(q,k,r){return q===h.ViewingMode.Global?new g(r):new e(k,r)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/state/SurfaceCollisionConstraint":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../camera/constraintUtils ../camera/intersectionUtils ../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){a.SurfaceCollisionConstraint=function(t){function q(r){r=t.call(this,r)||this;r.handles=new l;return r}b._inheritsLoose(q,t);var k=q.prototype;k.initialize=function(){this.handles.add(this.view.basemapTerrain.on("elevation-change",r=>this._handleElevationChangeEvent(r)))};k.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};k._handleElevationChangeEvent=function(r){this.view.state.cameraController||g.eyeWithinExtent(this.view,this.view.state.camera,
r.extent,r.spatialReference)&&this._applyToCurrentCamera()};k._applyToCurrentCamera=function(){this.view.state.updateCamera(r=>{p.applySurfaceCollisionConstraint(this.view,r,p.Mode.EYE_AND_CENTER)})};return q}(n);c.__decorate([u.property({constructOnly:!0})],a.SurfaceCollisionConstraint.prototype,"view",void 0);a.SurfaceCollisionConstraint=c.__decorate([d.subclass("esri.views.3d.state.ElevationCollisionConstraint")],a.SurfaceCollisionConstraint);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/GoToOperation":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../Camera ../../../Viewpoint ../../../core/Error ../../../core/maybe ../../../core/promiseUtils ../../../core/reactiveUtils ../camera/constraintUtils ./controllers/CameraController ./controllers/PointToPointAnimationController ./controllers/SurfaceCollisionCorrectionController ../support/cameraUtils ../support/viewpointUtils ../camera/constraintUtils/surfaceCollision".split(" "),function(a,
b,c,n,l,u,v,m,h,d,e,g,p,t,q){let k=function(){function r(f,w,z){this.target=f;this.options=w;this.view=z;this.state="pending";this.animationController=this.abortController=null;this.promise=new Promise((A,x)=>{this.resolveCallback=A;this.rejectCallback=x;A=new AbortController;if(u.isSome(this.options.signal))v.onAbort(this.options.signal,()=>{this.abort()});this.abortController=A;this.waitForReady()})}var y=r.prototype;y.then=function(f,w){return this.promise.then(f,w)};y.catch=function(f){return this.promise.catch(f)};
y.resolve=function(f){this.state="finished";return this.resolveCallback(f)};y.reject=function(f){this.state="finished";return this.rejectCallback(f)};y.abort=function(f=!1){switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":this.reject(v.createAbortError());break;case "wait-for-animation-finish":!f&&u.isSome(this.animationController)&&this.view.state.cameraController===this.animationController&&this.animationController.active&&this.animationController.stopController(),
this.reject(v.createAbortError())}};y.waitForReady=function(){var f=b._asyncToGenerator(function*(){this.state="wait-for-ready";if(!this.view.ready)try{yield m.whenOnce(()=>this.view.ready,this.abortController.signal)}catch(w){return this.reject(w)}this.createViewPoint()});return function(){return f.apply(this,arguments)}}();y.createViewPoint=function(){"finished"!==this.state&&(this.state="wait-for-viewpoint",this.animationController=this.options.animate?this._getAnimationController():null,t.create(this.view,
this.target,this.abortController.signal).then(f=>{"finished"!==this.state&&(f=this._getCameraFromViewpoint(f),u.isNone(f)||(this.options.animate?u.isNone(this.animationController)||this.startAnimation(f,this.animationController):(this.view.stateManager.setStateCamera(f.camera,{applyConstraints:!f.isFullySpecified,positionAndOrientationOnly:!0,doNotCancelGoToOperation:!0}),this.resolve())))},f=>{this.reject(f)}))};y._getCameraFromViewpoint=function(f){const w=!!(this.target instanceof n&&this.target.camera||
this.target instanceof c);var z=f.camera;if(u.isNone(z))return null;if(!this.view.stateManager.isCompatible(z))return f=(f=z.position)&&f.spatialReference,this.reject(new l("GotoAnimation:incompatible-spatialreference",`Resulting camera has an incompatible spatial reference (camera: ${f?f.wkid:"none"}, view: ${this.view.spatialReference.wkid})`,{camera:z})),null;z=p.externalToInternal(this.view,z);return u.isNone(z)?(this.reject(new l("GotoAnimation:invalid-camera","Resulting camera is invalid")),
null):{viewpoint:f,camera:z,isFullySpecified:w}};y.startAnimation=function(f,w){this.state="wait-for-animation-finish";const z=w.viewAnimation;if(u.isNone(z))this.reject(new l("GotoAnimation:missing-animation","Unreachable code in view.stateManager"));else{z.update(f.viewpoint,"running");if(!w.active||u.isNone(w.viewAnimation)||w.viewAnimation.target!==f.viewpoint||this.view.state.cameraController!==w)return this.abort();if(f.isFullySpecified){var A=new g.SurfaceCollisionCorrectionController({view:this.view,
desiredCamera:f.camera});q.applySurfaceCollisionConstraint(this.view,f.camera,q.Mode.EYE_AND_CENTER)}else h.applyAll(this.view,f.camera);w.begin(f.camera,this.options);var x=B=>{if(!u.isNone(this.view.state))switch(w.state){case d.State.Finished:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.resolve()}break;case d.State.Ready:case d.State.Rejected:case d.State.Running:case d.State.Stopped:switch(this.state){case "pending":case "wait-for-ready":case "wait-for-viewpoint":case "wait-for-animation-finish":this.reject(B)}}};
z.when(()=>{const B=this.view.state.cameraController;A&&(B&&B.active?B instanceof e.PointToPointAnimationController&&u.isSome(B.viewAnimation)&&B.viewAnimation.target===f.viewpoint&&(this.view.state.cameraController=A):u.isSome(w.viewAnimation)&&w.viewAnimation.target===f.viewpoint&&"finished"===w.state&&(this.view.state.cameraController=A))},B=>x(B));w.asyncResult={resolve:()=>x(),reject:B=>x(B)}}};y._getAnimationController=function(){let f;var w=null;w=this.view.state.cameraController;w instanceof
e.PointToPointAnimationController&&(w.updateStateFromViewAnimation(),w.active&&(f=w,w=f.viewAnimation));return null!=f||(f=new e.PointToPointAnimationController({view:this.view,mode:"animation"}),w=f.viewAnimation,this.view.state.switchCameraController(f))?f:(u.isSome(w)&&w.stop(),this.reject(new l("GotoAnimation:goto-cannot-interrupt","Cannot start an animation while interacting")),null)};return r}();a.GoToOperation=k;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/controllers/SurfaceCollisionCorrectionController":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../camera/constraintUtils ../../camera/intersectionUtils ./CameraController ../../camera/constraintUtils/surfaceCollision".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){a.SurfaceCollisionCorrectionController=function(t){function q(r){r=t.call(this,r)||this;r.handles=new n;return r}b._inheritsLoose(q,t);var k=q.prototype;k.onControllerStart=function(){this.state=g.State.Running;this.handles.add(this.view.basemapTerrain.on("elevation-change",r=>this._handleElevationChangeEvent(r)));this._applyCorrection()};k.onControllerEnd=function(){this.handles.removeAll()};k.stepController=function(){};k._handleElevationChangeEvent=function(r){e.eyeWithinExtent(this.view,
this.desiredCamera,r.extent,r.spatialReference)&&this._applyCorrection()};k._applyCorrection=function(){this.view.state.updateCamera(r=>{r.copyViewFrom(this.desiredCamera);p.applySurfaceCollisionConstraint(this.view,r,p.Mode.EYE_AND_CENTER)||this.constraintEnabled||(this.state=g.State.Stopped)})};b._createClass(q,[{key:"desiredCamera",set:function(r){this._set("desiredCamera",r.clone())}},{key:"canStop",get:function(){return!0}},{key:"constraintEnabled",get:function(){return this.view.state.constraints.collision.enabled}}]);
return q}(g.CameraController);c.__decorate([l.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"view",void 0);c.__decorate([l.property({constructOnly:!0})],a.SurfaceCollisionCorrectionController.prototype,"desiredCamera",null);a.SurfaceCollisionCorrectionController=c.__decorate([h.subclass("esri.views.3d.state.controllers.SurfaceCollisionCorrectionController")],a.SurfaceCollisionCorrectionController);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/state/helpers/SceneIntersectionHelper":function(){define("exports ../../../../core/maybe ../../../../core/PooledArray ../../../../core/screenUtils ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/ray ../../../../geometry/support/vectorStacks ../../../ViewingMode ../../support/geometryUtils/ray ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/intersectorUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(x){f&&f.viewingMode===x||(f=g.newIntersector(x));return f}let k=function(){function x(C,D,E){this.viewingMode=C;this._forEachLayer=D;this.view=E;this.externalIntersectionHandlers=new c;this.tolerance=g.DEFAULT_TOLERANCE;this.tmpRay=m.create();this.tmpRegion=v.create();this.validateHUDIntersector=g.newIntersector(this.viewingMode);this.validateHUDIntersector.options.hud=!1}var B=x.prototype;B.intersectScreen=function(C,D,E){return this.intersectRay(this._getPickRay(C,
this.tmpRay),q(this.viewingMode),D,E)};B.intersectScreenFreePointFallback=function(C,D,E){return this.intersectRayFreePointFallback(this._getPickRay(C,this.tmpRay),D,E)};B.intersectRayFreePointFallback=function(C,D,E){return this.intersectRay(C,q(this.viewingMode),D,E)||this._intersectRayFreePointLocal(C,D)};B.intersectRay=function(C,D,E,F){D.options.selectionMode=!1;D.options.store=p.StoreResults.MIN;this.computeIntersection(C,D,F);return D.results.min?D.results.min.getIntersectionPoint(E):!1};B.getCenterRayWithSubpixelOffset=
function(C,D,E=.5,F=.5){C.getRenderCenter(A,E,F);A[0]+=.0466;A[1]-=.0123;return e.fromRenderAtEye(C,A,D)};B.intersectIntersectorScreen=function(C,D,E){this.computeIntersection(this._getPickRay(C,this.tmpRay),D,E)};B.intersectToolIntersectorScreen=function(C,D,E){C=this._getPickRay(C,this.tmpRay);this.intersectToolIntersectorRay(C,D,E)};B.intersectToolIntersectorRay=function(C,D,E){D.options.selectionMode=!0;this.computeIntersection(C,D,E);const F=D.results.min;this.view.basemapTerrain&&this.view.basemapTerrain.opaque||
t.isValidIntersectorResult(F)&&F.intersector!==p.IntersectorType.TERRAIN||(D.options.selectionMode=!1,this.computeIntersection(C,D,E))};B.setTolerance=function(C=g.DEFAULT_TOLERANCE){this.tolerance=C};B.addIntersectionHandler=function(C){this.externalIntersectionHandlers.push(C);this.externalIntersectionHandlers.sort((D,E)=>D.type===p.IntersectorType.TERRAIN?1:E.type===p.IntersectorType.TERRAIN?-1:0)};B.removeIntersectionHandler=function(C){null!=this.externalIntersectionHandlers.removeUnordered(C)&&
this.externalIntersectionHandlers.sort((D,E)=>D.type===p.IntersectorType.TERRAIN?1:E.type===p.IntersectorType.TERRAIN?-1:0)};B._getPickRay=function(C,D){return e.fromScreen(this.view.state.camera,C,D)};B._intersectRayFreePointLocal=function(C,D){if(this.viewingMode!==d.ViewingMode.Local||b.isNone(C))return!1;var E=this.view.renderDataExtent;if(b.isNone(E))return l.add(D,C.origin,l.normalize(h.sv3d.get(),C.direction)),!0;var F=Math.max(E.xmax-E.xmin,E.ymax-E.ymin,8*Math.max(E.xmax-E.xmin,E.ymax-E.ymin));
if(0===F)return l.add(D,C.origin,l.normalize(h.sv3d.get(),C.direction)),!0;var G=this.view.state.camera;const O=Math.max(0,E.xmin-G.eye[0],G.eye[0]-E.xmax);E=Math.max(0,E.ymin-G.eye[1],G.eye[1]-E.ymax);G=F/Math.max(1,Math.max(0,Math.log(F/(Math.abs(G.relativeElevation)+Number.MIN_VALUE)))**2);G=Math.max(G,Math.min(Math.sqrt(O*O+E*E),F));F=l.scale(h.sv3d.get(),C.direction,G/l.length(C.direction));l.add(D,C.origin,F);return!0};B.intersectElevationFromScreen=function(C,D,E=0,F=null){return this._intersectElevation(this._getPickRay(C,
this.tmpRay),D,E,F)};B._intersectElevation=function(C,D,E=0,F=null){if(b.isNone(C))return null;var G=b.isSome(D)?D.mode:"absolute-height",O=b.isSome(D)?b.unwrapOr(D.offset,0):0,K="on-the-ground"!==G?O+E:0;D=K/this.view.renderCoordsHelper.unitInMeters;if("absolute-height"===G)return this.view.renderCoordsHelper.intersectInfiniteManifold(C,K,z)?(E=this.view.computeMapPointFromVec3d(z),E.z-=O,E):null;O=this.view.state.camera;const L=n.castRenderScreenPointArray3(h.sv3d.get());O.projectToRenderScreen(C.origin,
L);K=new w(null,this._forEachLayer);const R=this.view.slicePlane,M=b.isSome(R)?t.sliceFilterPredicate(R):null,J=g.newIntersector(this.viewingMode);J.options.store=p.StoreResults.MIN;J.options.verticalOffset=D;D=C.origin;C=l.add(h.sv3d.get(),D,C.direction);J.reset(D,C,O);J.point=L;const I=b.isSome(F)?"type"in F&&"graphics"===F.type?P=>P.metadata.layerUid!==F.uid:P=>P.metadata.graphicUid!==F.uid:null;switch(G){case "relative-to-scene":J.intersect(K.layers,L,this.tolerance,null,P=>(b.isNone(I)||I(P))&&
P.metadata&&P.metadata.isElevationSource);this.externalIntersectionHandlers.forAll(P=>{P.type!==p.IntersectorType.I3S&&P.type!==p.IntersectorType.TERRAIN||P.intersect(J,P.slicePlaneEnabled?M:null,J.rayBegin,J.rayEnd,L)});break;case "on-the-ground":case "relative-to-ground":this.externalIntersectionHandlers.forAll(P=>{P.isGround&&P.intersect(J,P.slicePlaneEnabled?M:null,J.rayBegin,J.rayEnd,L)})}return J.results.min.getIntersectionPoint(z)?(G=this.view.computeMapPointFromVec3d(z),G.z=E,G):null};B.computeIntersection=
function(C,D,E){if(!b.isNone(C)){var F=this.view.state.camera,G=n.castRenderScreenPointArray3(h.sv3d.get());F.projectToRenderScreen(C.origin,G);var O=new w(E,this._forEachLayer);D.options.selectOpaqueTerrainOnly=!E||!("include"in E||"exclude"in E);var K=C.origin,L=l.add(h.sv3d.get(),C.origin,C.direction);D.reset(K,L,F);D.intersect(O.layers,G,this.tolerance);C=this.view.slicePlane;var R=b.isSome(C)?t.sliceFilterPredicate(C):null;D.intersect(O.sliceableLayers,G,this.tolerance,R);var M=E&&(E.requiresGroundFeedback||
E.enableDraped);this.externalIntersectionHandlers.forAll(J=>{D.options.isFiltered=!O.filterLayerUid(J.layerUid);(J.isGround&&M||!D.options.isFiltered)&&J.intersect(D,J.slicePlaneEnabled?R:null,K,L,G)});C=h.sv3d.get();if(E&&E.enableDraped&&D.results.ground.getIntersectionPoint(C)){E=this.view.basemapTerrain;F=E.overlayManager.renderer;const J=this.view.renderCoordsHelper.spatialReference,I=h.sv3d.get();this.view.renderCoordsHelper.fromRenderCoords(C,I,E.spatialReference);I[2]=b.unwrapOr(this.view.elevationProvider.getElevation(C[0],
C[1],C[2],J,"ground"),0);F.intersect(D,I,D.results.ground,P=>O.filterRenderGeometry(P))}D.sortResults();this._processHUDResults(D)}};B._processHUDResults=function(C){var D=C.results.hud;v.copy(this.tmpRegion,v.NEGATIVE_INFINITY);const E=this.view.state.camera,F=[],G=this.tmpRegion;var O=I=>{const P=new y(I);E.projectToRenderScreen(I.target.center,P.screenPoint);P.screenPoint[0]=Math.floor(P.screenPoint[0]);P.screenPoint[1]=Math.floor(P.screenPoint[1]);F.push(P);v.expandPointInPlace(G,P.screenPoint)};
C.sortResults(D.all);b.isSome(D.min.dist)&&O(D.min);for(var K of D.all)D.min.target.object!==K.target.object&&D.max.target.object!==K.target.object&&O(K);b.isSome(D.max.dist)&&D.max.target.object!==D.min.target.object&&O(D.max);if(F.length){G[0]===G[2]&&(G[2]+=1);G[1]===G[3]&&(G[3]+=1);D=E.fullWidth;O=E.fullHeight;var L=Math.max(0,G[0]-1),R=Math.max(0,G[1]-1);K=Math.min(v.width(G)+2,D-L);var M=Math.min(v.height(G)+2,O-R),J=new Uint8Array(K*M*4);this.view._stage.renderView.readHUDVisibility(L,R,K,
M,J);L=!0;R=b.isNone(C.results.max.dist);M=0;for(const I of F)for(const P of r)if(J[4*(Math.min(I.screenPoint[0]+P[0],D)-G[0]+(Math.min(I.screenPoint[1]+P[1],O)-G[1])*K)]){L&&(C.results.min.copy(I.result),L=!1);R&&C.results.max.copy(I.result);C.options.store===p.StoreResults.ALL&&C.results.all.splice(M++,0,I.result);break}}};return x}();const r=(()=>{const x=[];for(let B=-1;1>=B;B++)for(let C=-1;1>=C;C++)x.push([C+1,B+1]);return x})();let y=function(x){this.result=x;this.screenPoint=n.createRenderScreenPointArray3()},
f,w=function(){function x(C,D){this.layers=[];this.sliceableLayers=[];this.include=null==C?void 0:C.include;this.exclude=null==C?void 0:C.exclude;D(E=>{E.isPickable&&this.filterLayerUid(E.apiLayerUid)&&(E.isSliceable?this.sliceableLayers:this.layers).push(E)})}var B=x.prototype;B.filterLayerUid=function(C){const {include:D,exclude:E}=this;return b.isNone(C)?null==D&&null==E:(null==D||D.has(C))&&(null==E||!E.has(C))};B.filterRenderGeometry=function(C){return this.filterLayerUid(C.layerUid)};return x}();
const z=u.create(),A=n.createRenderScreenPointArray3();a.SceneIntersectionHelper=k;a.isIntersectionHandler=function(x){return"object"===typeof x&&"intersect"in x};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/CombinedElevationProvider":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Evented ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/graphics/ElevationQuery".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){function t(q,k,r,y,f,w,z){for(const A of k)k=A.getElevation(r,y,f,w,z),u.isSome(k)&&(q=u.isSome(q)?Math.max(k,q):k);return q}a.CombinedElevationProvider=function(q){function k(y){y=q.call(this,y)||this;y.im=[];y.ground=[];y.scene=[];y.handles=new Map;y.lastElevationQuery=null;y.elevationCacheEnabled=!1;return y}b._inheritsLoose(k,q);var r=k.prototype;r.destroy=function(){this._elevationQuery=u.destroyMaybe(this._elevationQuery)};r.enableElevationCache=function(y){y||
(this.lastElevationQuery=null);this.elevationCacheEnabled=y};r.getElevation=function(y,f,w,z,A){if(this.elevationCacheEnabled&&null!=this.lastElevationQuery){var x=this.lastElevationQuery;if(y===x.x&&f===x.y&&w===x.z&&z.equals(x.spatialReference)&&A===x.queryContext)return x.result}x=t(null,this.im,y,f,w,z,A);u.isNone(x)&&(x=t(x,this.ground,y,f,w,z,A));"scene"===A&&(x=t(x,this.scene,y,f,w,z,A));this.elevationCacheEnabled&&(this.lastElevationQuery={x:y,y:f,z:w,spatialReference:z,queryContext:A,result:x});
return x};r.queryElevation=function(y,f,w,z,A,x=null,B=0){const C=v.createResolver();this.elevationQuery.queryElevation(y,f,x,B).then(D=>{"scene"===A&&(D=t(D,this.scene,y,f,w,z,A));C.resolve(D)}).catch(D=>{v.isAbortError(D)?C.reject(D):C.resolve(this.getElevation(y,f,w,z,A))});return C.promise};r.register=function(y,f){this.handles.set(f,f.on("elevation-change",w=>this.emit("elevation-change",w)));this[y].push(f)};r.unregister=function(y){this.handles.has(y)&&(this.handles.get(y).remove(),this.handles.delete(y));
for(const f of[this.im,this.ground,this.scene]){const w=f.indexOf(y);-1<w&&f.splice(w,1)}};b._createClass(k,[{key:"elevationQuery",get:function(){u.isNone(this._elevationQuery)&&(this._elevationQuery=new p.ElevationQuery(this.view.resourceController.scheduler,this.view.spatialReference,()=>this.view.map&&this.view.map.ground,{maximumAutoTileRequests:4}));return this._elevationQuery}}]);return k}(l.EventedMixin(n));c.__decorate([m.property({constructOnly:!0})],a.CombinedElevationProvider.prototype,
"view",void 0);c.__decorate([m.property({readOnly:!0,aliasOf:"view.basemapTerrain.spatialReference"})],a.CombinedElevationProvider.prototype,"spatialReference",void 0);a.CombinedElevationProvider=c.__decorate([g.subclass("esri.views.3d.support.CombinedElevationProvider")],a.CombinedElevationProvider);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/graphics/ElevationQuery":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../geometry ../../../../core/arrayUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../support/Scheduler ../../../../geometry/Multipoint".split(" "),
function(a,b,c,n,l,u,v,m){c=function(){function d(g,p){this.spatialReference=g;this.view=p}var e=d.prototype;e.getElevation=function(g,p,t){return this.view.elevationProvider.getElevation(g,p,0,this.spatialReference,t)};e.queryElevation=function(){var g=b._asyncToGenerator(function*(p,t,q,k,r){return this.view.elevationProvider.queryElevation(p,t,0,this.spatialReference,r,q,k)});return function(p,t,q,k,r){return g.apply(this,arguments)}}();return d}();let h=function(){function d(g,p,t,q){this.spatialReference=
p;this._getElevationQueryProvider=t;this._queries=[];this._queryOptions={...q,ignoreInvisibleLayers:!0};this._frameTask=g.registerTask(v.TaskPriority.ELEVATION_QUERY,this)}var e=d.prototype;e.destroy=function(){this._frameTask.remove()};e.queryElevation=function(g,p,t,q=0){return new Promise((k,r)=>{const y={x:g,y:p,minDemResolution:q,result:{resolve:k,reject:r},signal:t};this._queries.push(y);u.onAbort(t,()=>{n.remove(this._queries,y);r(u.createAbortError())})})};e.runTask=function(){const g=this._queries;
this._queries=[];const p=this._getElevationQueryProvider();if(p){var t=g.map(y=>[y.x,y.y]),q=g.reduce((y,f)=>Math.min(y,f.minDemResolution),Infinity);t=new m({points:t,spatialReference:this.spatialReference});var k=1<g.length&&g.some(y=>!!y.signal)?new AbortController:null,r=l.isSome(k)?k.signal:g[0].signal;if(l.isSome(k)){let y=0;g.forEach(f=>u.onAbort(f.signal,()=>{y++;f.result.reject(u.createAbortError());y===g.length&&k.abort()}))}p.queryElevation(t,{...this._queryOptions,minDemResolution:q,signal:r}).then(y=>
{g.forEach((f,w)=>{l.isSome(f.signal)&&f.signal.aborted?f.result.reject(u.createAbortError()):f.result.resolve(y.geometry.points[w][2])})}).catch(y=>{g.forEach(f=>f.result.reject(y))})}else g.forEach(y=>y.result.reject())};b._createClass(d,[{key:"running",get:function(){return 0<this._queries.length}},{key:"test",get:function(){const g=this;return{update:()=>0<g._queries.length&&g.runTask()}}}]);return d}();a.ElevationQuery=h;a.ViewElevationProvider=c;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/DisplayQualityProfile":function(){define(["../../../core/has"],function(a){function b(){const n=!!a("esri-mobile"),l=!!a("ios");return{low:{graphics3D:{maxTotalNumberOfFeatures:25E3,maxTotalNumberOfPrimitives:85E4,polygonLodFactor:.5,polylineLodFactor:1,snapshotAvailable:!1},heatmap:{pixelRatio:.125,maxTotalNumberOfFeatures:25E3},sceneService:{"3dObject":{lodFactor:.2,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:0},
point:{lodFactor:1},integratedMesh:{lodFactor:.6},pointCloud:{lodFactor:.5},uncompressedTextureDownsamplingEnabled:!0},tiledSurface:{lodBias:-1,angledSplitBias:.5,reduceTileLevelDifferences:!1,textureFadeDuration:0},antialiasingEnabled:!1,physicalBasedRenderingEnabled:!1,highQualityTransparency:!1,memoryLimit:200,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},medium:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:n?
.8:1,polylineLodFactor:n?1.2:1.5,snapshotAvailable:!l},heatmap:{pixelRatio:.25,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:n},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,
physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:n?600:750,additionalCacheMemory:n?0:150,frameRate:0,maximumRenderResolution:null,maximumPixelRatio:1},high:{graphics3D:{maxTotalNumberOfFeatures:5E4,maxTotalNumberOfPrimitives:17E5,polygonLodFactor:n?1.2:2,polylineLodFactor:n?1.2:2,snapshotAvailable:!l},heatmap:{pixelRatio:.5,maxTotalNumberOfFeatures:5E4},sceneService:{"3dObject":{lodFactor:1,lodCrossfadeinDuration:0,lodCrossfadeoutDuration:0,lodCrossfadeUncoveredDuration:400},
point:{lodFactor:1},integratedMesh:{lodFactor:1},pointCloud:{lodFactor:1},uncompressedTextureDownsamplingEnabled:!1},tiledSurface:{lodBias:0,angledSplitBias:1,reduceTileLevelDifferences:!a("disable-feature:reduce-map-tile-levels"),textureFadeDuration:400},antialiasingEnabled:!0,physicalBasedRenderingEnabled:!0,highQualityTransparency:!0,memoryLimit:n?900:1500,additionalCacheMemory:0,frameRate:0,maximumRenderResolution:n?null:4096,maximumPixelRatio:n?1:null}}}let c=function(){function n(){}n.isValidProfile=
function(l){return l in n.profiles};n.getDefaultProfile=function(){return a("trident")||a("esri-iPhone")?"low":"medium"};n.apply=function(l,u){l=n.profiles[l];u.graphics3D.maxTotalNumberOfFeatures=l.graphics3D.maxTotalNumberOfFeatures;u.graphics3D.maxTotalNumberOfPrimitives=l.graphics3D.maxTotalNumberOfPrimitives;u.graphics3D.polygonLodFactor=l.graphics3D.polygonLodFactor;u.graphics3D.polylineLodFactor=l.graphics3D.polylineLodFactor;u.graphics3D.snapshotAvailable=l.graphics3D.snapshotAvailable;{const v=
u.sceneService["3dObject"],m=l.sceneService["3dObject"];v.lodFactor=m.lodFactor;v.lodCrossfadeinDuration=m.lodCrossfadeinDuration;v.lodCrossfadeoutDuration=m.lodCrossfadeoutDuration;v.lodCrossfadeUncoveredDuration=m.lodCrossfadeUncoveredDuration}u.sceneService.point.lodFactor=l.sceneService.point.lodFactor;u.sceneService.integratedMesh.lodFactor=l.sceneService.integratedMesh.lodFactor;u.sceneService.pointCloud.lodFactor=l.sceneService.pointCloud.lodFactor;u.sceneService.uncompressedTextureDownsamplingEnabled=
l.sceneService.uncompressedTextureDownsamplingEnabled;u.tiledSurface.lodBias=l.tiledSurface.lodBias;u.tiledSurface.angledSplitBias=l.tiledSurface.angledSplitBias;u.tiledSurface.reduceTileLevelDifferences=l.tiledSurface.reduceTileLevelDifferences;u.tiledSurface.textureFadeDuration=l.tiledSurface.textureFadeDuration;u.heatmap.pixelRatio=l.heatmap.pixelRatio;u.heatmap.maxTotalNumberOfFeatures=l.heatmap.maxTotalNumberOfFeatures;u.antialiasingEnabled=l.antialiasingEnabled;u.physicallyBasedRenderingEnabled=
l.physicalBasedRenderingEnabled;u.highQualityTransparency=l.highQualityTransparency;u.memoryLimit=l.memoryLimit;u.additionalCacheMemory=l.additionalCacheMemory;u.frameRate=l.frameRate;u.maximumRenderResolution=l.maximumRenderResolution;u.maximumPixelRatio=l.maximumPixelRatio};return n}();c.debug={reset(){const n=b();for(const l in n)c.profiles[l]=n[l]}};(c||(c={})).profiles=b();return c})},"esri/views/3d/support/HighlightOptions":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec4f32 ../../../chunks/vec4f64".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){n=function(p){function t(){var q=p.apply(this,arguments)||this;q.color=new c([0,255,255]);q.haloColor=null;q.haloOpacity=1;q.fillOpacity=.25;q.shadowOpacity=.4;q.shadowColor=new c([0,0,0]);q.shadowDifference=.2;return q}a._inheritsLoose(t,p);t.toEngineOptions=function(q){const k=c.toUnitRGBA(q.color),r=l.isSome(q.haloColor)?c.toUnitRGBA(q.haloColor):k,y=c.toUnitRGBA(q.shadowColor);return{color:e.fromValues(k[0],k[1],k[2],k[3]),haloColor:e.fromValues(r[0],r[1],r[2],
r[3]),haloOpacity:q.haloOpacity,haloOpacityOccluded:.25*q.haloOpacity,fillOpacity:q.fillOpacity,fillOpacityOccluded:.25*q.fillOpacity,shadowOpacity:q.shadowOpacity,shadowColor:g.fromValues(y[0],y[1],y[2],y[3]),occludedShadowOpacity:q.shadowOpacity*(1-q.shadowDifference)}};return t}(n);b.__decorate([u.property({type:c})],n.prototype,"color",void 0);b.__decorate([u.property({type:c})],n.prototype,"haloColor",void 0);b.__decorate([u.property()],n.prototype,"haloOpacity",void 0);b.__decorate([u.property()],
n.prototype,"fillOpacity",void 0);b.__decorate([u.property()],n.prototype,"shadowOpacity",void 0);b.__decorate([u.property({type:c})],n.prototype,"shadowColor",void 0);b.__decorate([u.property()],n.prototype,"shadowDifference",void 0);return n=b.__decorate([d.subclass("esri.views.3d.support.HighlightOptions")],n)})},"esri/chunks/vec4f32":function(){define(["exports"],function(a){function b(){return new Float32Array(4)}function c(f){const w=new Float32Array(4);w[0]=f[0];w[1]=f[1];w[2]=f[2];w[3]=f[3];
return w}function n(f,w,z,A){const x=new Float32Array(4);x[0]=f;x[1]=w;x[2]=z;x[3]=A;return x}function l(f,w){return new Float32Array(f,w,4)}function u(){return b()}function v(){return n(1,1,1,1)}function m(){return n(1,0,0,0)}function h(){return n(0,1,0,0)}function d(){return n(0,0,1,0)}function e(){return n(0,0,0,1)}const g=b(),p=v(),t=m(),q=h(),k=d(),r=e(),y=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l,zeros:u,ones:v,unitX:m,unitY:h,unitZ:d,unitW:e,
ZEROS:g,ONES:p,UNIT_X:t,UNIT_Y:q,UNIT_Z:k,UNIT_W:r},Symbol.toStringTag,{value:"Module"}));a.ONES=p;a.UNIT_W=r;a.UNIT_X=t;a.UNIT_Y=q;a.UNIT_Z=k;a.ZEROS=g;a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.ones=v;a.unitW=e;a.unitX=m;a.unitY=h;a.unitZ=d;a.vec4f32=y;a.zeros=u})},"esri/views/3d/support/MapCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../geometry ../../../core/Error ../../../core/unitUtils ../../../geometry/projectionEllipsoid ../../../portal/support/geometryServiceUtils ../../../rest/geometryService/project ../../../rest/support/ProjectParameters ../../../geometry/Point ../../../geometry/SpatialReference".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){c=function(){function g(p,t){this.spatialReference=t;this.unitInMeters=l.getMetersPerUnitForSR(this.spatialReference,u.getReferenceEllipsoid(this.spatialReference).metersPerDegree);this._geometryServiceURLPromise=v.getGeometryServiceURL(p&&p.get("portalItem")).catch(()=>{throw new n("mapcoordshelper:missing-geometry-service","Must specify geometryService in esri/config");})}g.prototype.toGeographic=function(){var p=b._asyncToGenerator(function*(t){var q=yield this._geometryServiceURLPromise;
let k=!0;Array.isArray(t[0])&&"number"!==typeof t[0]||(t=[t],k=!1);t=t.map(r=>r instanceof d?r:new d(r,this.spatialReference));t=new h({geometries:t,outSpatialReference:e.WGS84});q=(yield m.project(q,t)).map(r=>"point"===r.type?[r.x,r.y]:void 0);return k?q:q[0]});return function(t){return p.apply(this,arguments)}}();return g}();a.MapCoordsHelper=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/portal/support/geometryServiceUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../config ../../core/Error ../Portal ../../rest/geometryService/project ../../rest/support/ProjectParameters".split(" "),
function(a,b,c,n,l,u,v){function m(){return h.apply(this,arguments)}function h(){h=b._asyncToGenerator(function*(e=null,g){var p,t;if(c.geometryServiceUrl)return c.geometryServiceUrl;if(!e)throw new n("internal:geometry-service-url-not-configured");e="portal"in e?e.portal||l.getDefault():e;yield e.load({signal:g});g=null==(p=e.helperServices)?void 0:null==(t=p.geometry)?void 0:t.url;if(!g)throw new n("internal:geometry-service-url-not-configured");return g});return h.apply(this,arguments)}function d(){d=
b._asyncToGenerator(function*(e,g,p=null,t){p=yield m(p,t);const q=new v;q.geometries=[e];q.outSpatialReference=g;if((e=yield u.project(p,q,{signal:t}))&&Array.isArray(e)&&1===e.length)return e[0];throw new n("internal:geometry-service-projection-failed");});return d.apply(this,arguments)}a.getGeometryServiceURL=m;a.projectGeometry=function(e,g){return d.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/QualitySettings":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){let h=function(q){function k(){var r=q.apply(this,arguments)||this;r.minTotalNumberOfFeatures=2E3;r.maxTotalNumberOfFeatures=5E4;r.maxTotalNumberOfPrimitives=17E5;r.snapshotAvailable=!0;r.polygonLodFactor=1;r.polylineLodFactor=1;return r}a._inheritsLoose(k,q);return k}(c);b.__decorate([n.property()],h.prototype,"minTotalNumberOfFeatures",void 0);b.__decorate([n.property()],h.prototype,"maxTotalNumberOfFeatures",void 0);b.__decorate([n.property()],h.prototype,"maxTotalNumberOfPrimitives",
void 0);b.__decorate([n.property()],h.prototype,"snapshotAvailable",void 0);b.__decorate([n.property()],h.prototype,"polygonLodFactor",void 0);b.__decorate([n.property()],h.prototype,"polylineLodFactor",void 0);h=b.__decorate([m.subclass("esri.views.3d.support.QualitySettings.Graphics3DSettings")],h);let d=function(q){function k(){var r=q.apply(this,arguments)||this;r.lodFactor=1;return r}a._inheritsLoose(k,q);return k}(c);b.__decorate([n.property()],d.prototype,"lodFactor",void 0);d=b.__decorate([m.subclass("esri.views.3d.support.QualitySettings.LoDFactorSettings")],
d);let e=function(q){function k(){var r=q.apply(this,arguments)||this;r.lodCrossfadeinDuration=0;r.lodCrossfadeoutDuration=0;r.lodCrossfadeUncoveredDuration=0;return r}a._inheritsLoose(k,q);return k}(d);e=b.__decorate([m.subclass("esri.views.3d.support.QualitySettings.LoDFactor3DObjectSettings")],e);let g=function(q){function k(){var r=q.apply(this,arguments)||this;r["3dObject"]=new e;r.point=new d;r.integratedMesh=new d;r.pointCloud=new d;r.uncompressedTextureDownsamplingEnabled=!1;return r}a._inheritsLoose(k,
q);return k}(c);b.__decorate([n.property({type:e})],g.prototype,"3dObject",void 0);b.__decorate([n.property({type:d})],g.prototype,"point",void 0);b.__decorate([n.property({type:d})],g.prototype,"integratedMesh",void 0);b.__decorate([n.property({type:d})],g.prototype,"pointCloud",void 0);b.__decorate([n.property()],g.prototype,"uncompressedTextureDownsamplingEnabled",void 0);g=b.__decorate([m.subclass("esri.views.3d.support.QualitySettings.SceneServiceSettings")],g);let p=function(q){function k(){var r=
q.apply(this,arguments)||this;r.lodBias=0;r.angledSplitBias=1;r.reduceTileLevelDifferences=!0;r.textureFadeDuration=500;return r}a._inheritsLoose(k,q);return k}(c);b.__decorate([n.property()],p.prototype,"lodBias",void 0);b.__decorate([n.property()],p.prototype,"angledSplitBias",void 0);b.__decorate([n.property()],p.prototype,"reduceTileLevelDifferences",void 0);b.__decorate([n.property()],p.prototype,"textureFadeDuration",void 0);p=b.__decorate([m.subclass("esri.views.3d.support.QualitySettings.TiledSurfaceSettings")],
p);let t=function(q){function k(){var r=q.apply(this,arguments)||this;r.pixelRatio=1;r.maxTotalNumberOfFeatures=5E4;return r}a._inheritsLoose(k,q);return k}(c);b.__decorate([n.property()],t.prototype,"pixelRatio",void 0);b.__decorate([n.property()],t.prototype,"maxTotalNumberOfFeatures",void 0);t=b.__decorate([m.subclass("esri.views.3d.support.QualitySettings.HeatmapSettings")],t);c=function(q){function k(){var r=q.apply(this,arguments)||this;r.graphics3D=new h;r.sceneService=new g;r.tiledSurface=
new p;r.heatmap=new t;r.antialiasingEnabled=!0;r.physicallyBasedRenderingEnabled=!1;r.highQualityTransparency=!0;return r}a._inheritsLoose(k,q);return k}(c);b.__decorate([n.property({type:h})],c.prototype,"graphics3D",void 0);b.__decorate([n.property({type:g})],c.prototype,"sceneService",void 0);b.__decorate([n.property({type:p})],c.prototype,"tiledSurface",void 0);b.__decorate([n.property({type:t})],c.prototype,"heatmap",void 0);b.__decorate([n.property()],c.prototype,"antialiasingEnabled",void 0);
b.__decorate([n.property()],c.prototype,"physicallyBasedRenderingEnabled",void 0);b.__decorate([n.property()],c.prototype,"highQualityTransparency",void 0);b.__decorate([n.property()],c.prototype,"memoryLimit",void 0);b.__decorate([n.property()],c.prototype,"additionalCacheMemory",void 0);b.__decorate([n.property()],c.prototype,"frameRate",void 0);b.__decorate([n.property()],c.prototype,"maximumRenderResolution",void 0);b.__decorate([n.property()],c.prototype,"maximumPixelRatio",void 0);return c=
b.__decorate([m.subclass("esri.views.3d.support.QualitySettings.QualitySettings")],c)})},"esri/views/3d/support/RenderCoordsHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/unitUtils ../../../chunks/mat4 ../../../chunks/vec3 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/Axis ../../../geometry/support/coordinateSystem ../../../geometry/support/plane ../../../geometry/support/vectorStacks ../../../layers/graphics/dehydratedFeatureUtils ../../ViewingMode ../../support/spatialReferenceSupport".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){function k(y){if(q.isSpatialReferenceSupported(y,t.ViewingMode.Global))return 1;y=d.renderSRFromViewSR(!1,y);return n.getMetersPerUnitForSR(y)}let r=function(){function y(w,z,A,x){this.viewingMode=w;this.spatialReference=z;this.unitInMeters=A;this.coordinateSystem=x;this._coordinateSystem=d.create(x)}var f=y.prototype;f.getAltitude=function(w){return d.altitudeAt(this.coordinateSystem,w)};f.setAltitude=function(w,z,A=w){return d.setAltitudeAt(this.coordinateSystem,
A,z,w)};f.setAltitudeOfTransformation=function(w,z){d.setAltitudeOfTransformation(this.coordinateSystem,z,w,z)};f.worldUpAtPosition=function(w,z){return d.normalAt(this.coordinateSystem,w,z)};f.worldBasisAtPosition=function(w,z,A){return d.axisAt(this.coordinateSystem,w,z,A)};f.basisMatrixAtPosition=function(w,z){const A=this.worldBasisAtPosition(w,h.Axis.X,g.sv3d.get()),x=this.worldBasisAtPosition(w,h.Axis.Y,g.sv3d.get());w=this.worldBasisAtPosition(w,h.Axis.Z,g.sv3d.get());l.set(z,A[0],A[1],A[2],
0,x[0],x[1],x[2],0,w[0],w[1],w[2],0,0,0,0,1);return z};f.intersectManifoldClosestSilhouette=function(w,z,A){d.elevate(this.coordinateSystem,z,this._coordinateSystem);d.intersectRayClosestSilhouette(this._coordinateSystem,w,A);return A};f.intersectManifold=function(w,z,A){d.elevate(this.coordinateSystem,z,this._coordinateSystem);z=g.sv3d.get();return d.intersectRay(this._coordinateSystem,w,z)?u.copy(A,z):null};f.intersectInfiniteManifold=function(w,z,A){if(this.viewingMode===t.ViewingMode.Global)return this.intersectManifold(w,
z,A);d.elevate(this.coordinateSystem,z,this._coordinateSystem);z=this._coordinateSystem.value;const x=g.sv3d.get();return e.intersectRay(z.plane,w,x)?u.copy(A,x):null};f.toRenderCoords=function(w,z,A){return p.isDehydratedPoint(w)?v.projectPointToVector(w,z,this.spatialReference):v.projectVectorToVector(w,z,A,this.spatialReference)};f.fromRenderCoords=function(w,z,A=null){return p.isDehydratedPoint(z)?(c.isSome(A)&&(z.spatialReference=A),v.projectVectorToDehydratedPoint(w,this.spatialReference,z)):
z instanceof m?v.projectVectorToPoint(w,this.spatialReference,z):v.projectVectorToVector(w,this.spatialReference,z,A)?z:null};y.create=function(w,z){switch(w){case t.ViewingMode.Local:return new y(t.ViewingMode.Local,z,n.getMetersPerUnitForSR(z),d.createLocal());case t.ViewingMode.Global:return new y(t.ViewingMode.Global,z,1,d.createGlobal(z))}};y.renderUnitScaleFactor=function(w,z){return k(w)/k(z)};b._createClass(y,[{key:"extent",set:function(w){w&&d.setExtent(this.coordinateSystem,w,this.coordinateSystem)}}]);
return y}();a.RenderCoordsHelper=r;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/ResourceController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./index ./MemoryController ./StreamDataLoader ../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){a.ResourceControllerMain=function(w){function z(){var A=w.apply(this,arguments)||this;A.updating=!1;return A}b._inheritsLoose(z,w);return z}(n);c.__decorate([d.property({readOnly:!0})],a.ResourceControllerMain.prototype,"updating",void 0);a.ResourceControllerMain=c.__decorate([t.subclass("esri.views.3d.support.ResourceController")],a.ResourceControllerMain);var f;(function(w){let z=function(A){function x(){var C=A.apply(this,arguments)||this;C._scheduler=
null;C._memoryController=null;C._streamDataLoader=null;C._scheduleTask=y.ImmediateTask;C._cameraChangeTime=0;C._handles=new l;C._frameTask=null;C._state=y.State.IDLE;return C}b._inheritsLoose(x,A);var B=x.prototype;B.initialize=function(){this._cameraChangeTime=performance.now();this._scheduler=y.newScheduler();this._memoryController=k.newMemoryController(this.view);this._streamDataLoader=new r.StreamDataLoader;this._streamDataLoader.setup(q.maxDownloadSlots,q.downloadSlotsPerClient,this._scheduler);
this._handles.add([v.watch(()=>{var C;return null==(C=this.view.state)?void 0:C.camera},(C,D)=>this._cameraChangedHandler(C,D),v.sync),v.watch(()=>this.view.stationary,()=>this._stationaryChangedHandler())]);this._frameTask=m.addFrameTask({update:C=>this._frame(C)});this._scheduleTask=this._scheduler.registerTask(y.TaskPriority.RESOURCE_CONTROLLER)};B.destroy=function(){this._handles=u.destroyMaybe(this._handles);this._scheduleTask.remove();this._frameTask=u.removeMaybe(this._frameTask);this._streamDataLoader=
u.destroyMaybe(this._streamDataLoader);this._memoryController=u.destroyMaybe(this._memoryController);this._scheduler=u.destroyMaybe(this._scheduler)};B.schedule=function(C,D,E){return this._scheduleTask.schedule(C,D,E)};B.createStreamDataRequester=function(C){const D=this._streamDataLoader;return{request(E,F,G){return D.request(E,F,C,G)},get busy(){return!D.hasDownloadSlots(C)}}};B._frame=function(C){if(!this.view.suspended){if(this.view.stateManager&&(this.view.stateManager.step(h.secondsFromMilliseconds(C.deltaTime)),
!this._scheduler))return;this._updateState();this._scheduler.state=this._state;this._scheduler.updateBudget(C)?(this._memoryController.update(),this._scheduler.frame()):this._memoryController.updating&&this._memoryController.update()}};B._cameraChangedHandler=function(C,D){C&&D&&C.almostEquals(D)||(this._cameraChangeTime=performance.now(),this._updateState(),this._scheduler.state=this._state)};B._stationaryChangedHandler=function(){this.memoryController.resetStableQuality()};B._updateState=function(){this.view.animation?
this._state=y.State.ANIMATING:this.view.interacting?this._state=y.State.INTERACTING:(this._state===y.State.ANIMATING&&(this._cameraChangeTime=0),300>=performance.now()-this._cameraChangeTime?this._state=y.State.INTERACTING:this._state=y.State.IDLE)};b._createClass(x,[{key:"updating",get:function(){var C,D,E;return!!(null!=(C=this._memoryController)&&C.updating||null!=(D=this._streamDataLoader)&&D.updating||null!=(E=this._scheduleTask)&&E.updating)}},{key:"scheduler",get:function(){return this._scheduler}},
{key:"memoryController",get:function(){return this._memoryController}},{key:"test",get:function(){return{getQueueStats:C=>this._streamDataLoader.test.loadQueue.getStatsForType(C),state:this._state}}}]);return x}(a.ResourceControllerMain);c.__decorate([d.property({constructOnly:!0})],z.prototype,"view",void 0);c.__decorate([d.property()],z.prototype,"_scheduler",void 0);c.__decorate([d.property()],z.prototype,"_memoryController",void 0);c.__decorate([d.property()],z.prototype,"_streamDataLoader",void 0);
c.__decorate([d.property()],z.prototype,"_scheduleTask",void 0);c.__decorate([d.property({readOnly:!0})],z.prototype,"updating",null);z=c.__decorate([t.subclass("esri.views.3d.support.ResourceController")],z);w.ResourceController=z})(f||(f={}));a.newResourceController=function(w){return new f.ResourceController({view:w})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/index":function(){define(["exports"],function(a){a.ClientType=
void 0;(function(c){c[c.ELEVATION=0]="ELEVATION";c[c.BASEMAP=1]="BASEMAP";c[c.I3S_INDEX=2]="I3S_INDEX";c[c.I3S_DATA=3]="I3S_DATA";c[c.SYMBOLOGY=4]="SYMBOLOGY"})(a.ClientType||(a.ClientType={}));const b=(()=>{const c=[];c[a.ClientType.ELEVATION]=10;c[a.ClientType.BASEMAP]=10;c[a.ClientType.I3S_INDEX]=10;c[a.ClientType.I3S_DATA]=10;c[a.ClientType.SYMBOLOGY]=5;return c})();a.downloadSlotsPerClient=b;a.maxDownloadSlots=30;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/MemoryController":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Logger ../../../core/maybe ../../../core/MemCache ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../layers/support/MemoryManagedLayerView".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p){const t=
l.getLogger("esri.views.3d.support.MemoryController");let q=function(k){function r(f){f=k.call(this,f)||this;f._quality=1;f._memoryUsed=0;f._updating=!1;f.minQuality=.1;f._stableQuality=0;f._downscaleMemoryUsed=0;f._canFastRecover=!1;f._memoryPredicted=0;f._cacheStorage=new v.MemCacheStorage;f._numQualityChanges=0;f._maxMemory=500;f._additionalCacheMemory=100;return f}b._inheritsLoose(r,k);var y=r.prototype;y.destroy=function(){this._cacheStorage.destroy()};y.newCache=function(f,w){return new v.MemCache(f,
this._cacheStorage,w)};y.resetStableQuality=function(){this._stableQuality=0};y.disableMemCache=function(){this.additionalCacheMemory=-4096};y.update=function(){this._updateMemory();if(!(0>=this._memoryPredicted)||this._updating){var f=this._layersUpdating();if(.6>this._memoryPredicted&&this._canFastRecover)this._stableQuality=this._downscaleMemoryUsed=0,this._canFastRecover=!1,this._updateQuality(1);else if(f){if(1.1<this._memoryPredicted||1<this._memoryUsed)0<this._stableQuality?(this._downscaleMemoryUsed=
0,this._updateQuality(this._stableQuality)):this._quality>this.minQuality&&this._downscaleMemoryUsed<this._memoryUsed&&(this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryUsed,this._canFastRecover=!1)}else this._downscaleMemoryUsed=0,1<this._memoryUsed?(this._stableQuality=0,this._canFastRecover=!1,f=this._updateQuality(this._quality/1.3),this._downscaleMemoryUsed=this._memoryPredicted):this._stableQuality!==this._quality&&(.75>this._memoryUsed&&1>this._quality?(this._stableQuality=
this._quality,f=this._updateQuality(this._quality+.05)):1>this._quality&&(this._canFastRecover=!0));this._updating=f}};y._updateQuality=function(f){f=Math.min(Math.max(f,this.minQuality),1);if(f===this._quality)return!1;this._quality=f;++this._numQualityChanges;return!0};y._layersUpdating=function(){return this.view.allLayerViews.some(f=>!!f.updating)};y._updateMemory=function(){let f=0,w=0;this.view.basemapTerrain&&this.view.basemapTerrain.getUsedMemory&&(f+=this.view.basemapTerrain.getUsedMemory());
var z=this.view._stage&&this.view._stage.renderView&&this.view._stage.renderView.edgeView;u.isSome(z)&&(f+=z.usedMemory);this.view.allLayerViews&&this.view.allLayerViews.forEach(x=>{if(p.isMemoryManagedLayerView(x)){const B=x.ignoresMemoryFactor()?this._quality:1;f+=x.getUsedMemory()*B;w+=x.getUnloadedMemory()*B}});var A=null==this._warnMemoryUsage||Math.round(10*f)!==Math.round(10*this._warnMemoryUsage);z=1048576*this.maxMemory;if(f>z&&A){this._warnMemoryUsage=f;A=B=>(B/1048576).toLocaleString(void 0,
{maximumFractionDigits:1})+" MB";const x=Math.round(100*this._quality);t.warn(`Memory Limit exceeded! Limit: ${A(z)} Current: ${A(f)} Projected: ${A(f+w)} Quality: ${x}%`)}this._memoryUsed=f/z;this._memoryPredicted=(f+w)/z;this._cacheStorage.maxSize=Math.max(0,z-f+1048576*this.additionalCacheMemory)};b._createClass(r,[{key:"maxMemory",get:function(){return this._maxMemory},set:function(f){null==f||0>=f||(this._stableQuality=0,this._canFastRecover=!1,this._maxMemory<f&&this._updateQuality(1),this._maxMemory=
f)}},{key:"additionalCacheMemory",get:function(){return this._additionalCacheMemory},set:function(f){null!=f&&0<=f&&(this._additionalCacheMemory=f)}},{key:"memoryFactor",get:function(){return this._quality}},{key:"updating",get:function(){return this._updating}},{key:"usedMemory",get:function(){return this._memoryUsed}},{key:"test",get:function(){const f=this;return{cacheStorage:this._cacheStorage,resetQualityChanges:()=>{const w=f._numQualityChanges;f._numQualityChanges=0;return w}}}}]);return r}(n);
c.__decorate([m.property({constructOnly:!0})],q.prototype,"view",void 0);c.__decorate([m.property()],q.prototype,"maxMemory",null);c.__decorate([m.property()],q.prototype,"additionalCacheMemory",null);c.__decorate([m.property()],q.prototype,"memoryFactor",null);c.__decorate([m.property()],q.prototype,"updating",null);c.__decorate([m.property()],q.prototype,"usedMemory",null);c.__decorate([m.property()],q.prototype,"_quality",void 0);c.__decorate([m.property()],q.prototype,"_memoryUsed",void 0);c.__decorate([m.property()],
q.prototype,"_updating",void 0);c.__decorate([m.property()],q.prototype,"_stableQuality",void 0);c.__decorate([m.property()],q.prototype,"_maxMemory",void 0);c.__decorate([m.property()],q.prototype,"_additionalCacheMemory",void 0);q=c.__decorate([g.subclass("esri.views.3d.support.MemoryController")],q);a.newMemoryController=function(k){return new q({view:k})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/support/MemoryManagedLayerView":function(){define(["exports"],
function(a){a.isMemoryManagedLayerView=function(b){return"function"===typeof b.getUsedMemory};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/StreamDataLoader":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../request ../../../core/Accessor ../../../core/arrayUtils ../../../core/Error ../../../core/lang ../../../core/maybe ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ./AsyncWorkerQueue ../webgl-engine/lib/Util ../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){function r(z){if(2>z.byteLength)return"unknown";z=new Uint8Array(z,0,z.byteLength);return 137===z[0]&&80===z[1]?"image/png":71===z[0]&&73===z[1]?"image/gif":66===z[0]&&77===z[1]?"image/bmp":255===z[0]&&216===z[1]?"image/jpeg":"unknown"}a.StreamDataLoader=function(z){function A(){var B=z.apply(this,arguments)||this;B._tasks=new Map;B._onLoadQueue=[];B._doneQueue=[];B.updating=!1;return B}b._inheritsLoose(A,z);var x=A.prototype;x.setup=function(B,C,D){this._loadQueue=
new t.AsyncWorkerQueue((E,F)=>this._startLoading(E,F),(E,F)=>this._doneLoadingCB(E,F),B,C);D&&(this._frameTask=D.registerTask(k.TaskPriority.STREAM_DATA_LOADER,this))};x.destroy=function(){this._frameTask=h.removeMaybe(this._frameTask);this._tasks.forEach(B=>h.abortMaybe(B.abortController));this._loadQueue=h.destroyMaybe(this._loadQueue);this._tasks=this._doneQueue=this._onLoadQueue=null};x.hasDownloadSlots=function(B){return this._loadQueue.hasQuota(B)};x.request=function(B,C,D,E={}){const F=d.createResolver();
F.__signal=h.isSome(E)?E.signal:null;const G=this._createOrUpdateTask(B,C,D,E,F);d.onAbort(E,()=>this._cancelRequest(G,F));return F.promise};x._createTask=function(B,C,D,E,F,G){B=new w(B,C,D,E,F);this._updateTask(B,G);this._tasks.set(F,B);1===this._tasks.size&&this._set("updating",!0);this._loadQueue.push(B);return B};x._cancelRequest=function(B,C){u.removeUnordered(B.resolvers,C);C.reject(d.createAbortError());0===B.resolvers.length&&(B.status===a.TaskStatus.DOWNLOADING&&(B.status=a.TaskStatus.CANCELLED,
this._loadQueue.cancel(B),B.abortController.abort(),B.request=null,B.abortController=null),B.status=a.TaskStatus.CANCELLED,this._tasks.delete(B.key),0===this._tasks.size&&this._set("updating",!1))};x._updateTask=function(B,C){B.resolvers.push(C)};x._createOrUpdateTask=function(B,C,D,E,F){const G=`${h.isSome(E)&&E.uid||B}:${C}:${D}`,O=this._tasks.get(G);return O?(this._updateTask(O,F),O):this._createTask(B,E,C,D,G,F)};x._doneLoadingCB=function(B,C){this._loadQueue&&(q.assert(B.status===a.TaskStatus.DOWNLOADING),
B.status=a.TaskStatus.DOWNLOADED,this._frameTask?this._doneQueue.push({task:B,err:C}):this._doneLoading(B,C))};x.runTask=function(B){for(;!B.done&&0<this._onLoadQueue.length;){var C=this._onLoadQueue.shift();d.throwIfAborted(C.task.abortController);C.task.abortController=null;C.callback(C.task);B.madeProgress()}for(;!B.done&&0<this._doneQueue.length;)C=this._doneQueue.shift(),C.task.status!==a.TaskStatus.DOWNLOADED&&(C.err=C.err||d.createAbortError()),this._doneLoading(C.task,C.err),B.madeProgress()};
x._doneLoading=function(B,C){if(C&&!d.isAbortError(C)&&0<B.numRetries)--B.numRetries,this._loadQueue.push(B);else{var D=B.result instanceof HTMLImageElement?0:B.resolvers.length;for(const E of B.resolvers)if(C)d.isAbortError(C)?E.reject(C):E.reject(new v("stream-data-loader:request-error",`Failed to request resource at '${B.url}'. ${C}`,{url:B.url,error:C}));else{--D;const F=0>=D?B.result:m.clone(B.result);E.resolve(F)}this._tasks.delete(B.key);0===this._tasks.size&&this._set("updating",!1)}};x._startLoading=
function(B,C){if(B.status===a.TaskStatus.CANCELLED)return!1;B.startTime=performance.now();B.status=a.TaskStatus.DOWNLOADING;let D,E;switch(B.docType){case "binary":E="array-buffer";D=0;break;case "image":E="image";break;case "image+type":E="array-buffer";break;default:E="json"}B.abortController=new AbortController;const F=B.abortController.signal;B.request=n(B.url,{...B.options,responseType:E,timeout:D,signal:F});let G=()=>{};const O=L=>{B.duration=performance.now()-B.startTime;B.size=L instanceof
ArrayBuffer?L.byteLength:B.size||0;B.result=L;this._frameTask?this._onLoadQueue.push({callback:C,task:B}):(B.abortController=null,C(B))},K=L=>{B.status===a.TaskStatus.DOWNLOADING&&C(B,L);G()};if("image+type"!==B.docType)return B.request.then(L=>O(L.data),K),!0;B.request.then(L=>{L=L.data;const R=r(L);E="image";B.size=L.byteLength;if("unknown"===R)B.request=n(B.url,{responseType:E,timeout:D,signal:F}),B.request.then(J=>O(J.data),K);else{L=new Blob([L],{type:R});var M=window.URL.createObjectURL(L);
G=()=>window.URL.revokeObjectURL(M);B.request=n(M,{responseType:E,timeout:D,signal:F});B.request.then(J=>O(new f(J.data,R,G)),K)}},K);return!0};b._createClass(A,[{key:"running",get:function(){return 0<this._doneQueue.length||0<this._onLoadQueue.length}},{key:"test",get:function(){return{loadQueue:this._loadQueue}}}]);return A}(l);c.__decorate([e.property({readOnly:!0})],a.StreamDataLoader.prototype,"updating",void 0);a.StreamDataLoader=c.__decorate([p.subclass("esri.views.3d.support.StreamDataLoader")],
a.StreamDataLoader);const y={numRetries:0};let f=function(){function z(A,x,B){this.image=A;this.type=x;this.release=B}b._createClass(z,[{key:"isOpaque",get:function(){return"image/jpeg"===this.type}}]);return z}(),w=function(z){function A(x,B,C,D,E){D=z.call(this,D)||this;D.url=x;D.options=B;D.docType=C;D.key=E;D.result=null;D.status=a.TaskStatus.QUEUED;D.request=null;D.abortController=null;D.resolvers=[];D.startTime=0;D.numRetries=y.numRetries;return D}b._inheritsLoose(A,z);return A}(t.BaseTask);
a.TaskStatus=void 0;(function(z){z[z.QUEUED=1]="QUEUED";z[z.DOWNLOADING=2]="DOWNLOADING";z[z.DOWNLOADED=3]="DOWNLOADED";z[z.CANCELLED=4]="CANCELLED"})(a.TaskStatus||(a.TaskStatus={}));a.ImageWithType=f;a.test=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/AsyncWorkerQueue":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../webgl-engine/lib/Util"],function(a,b,c){let n=function(v){this.typeWorkerQuota=v;
this.tasks=[];this.numWorkers=0;this.statistics=new l},l=function(){this.speed=this.duration=this.size=this.requests=0},u=function(){function v(h,d,e,g){this._workerFunc=h;this._callbackFunc=d;this._maxTotalNumWorkers=e;this._totalNumWorkers=0;this._clients=g.map(p=>new n(p))}var m=v.prototype;m.hasQuota=function(h){return(h=this._clients[h])?this._totalNumWorkers<this._maxTotalNumWorkers||h.numWorkers+h.tasks.length<h.typeWorkerQuota:!1};m.push=function(h){const d=this._clients[h.client];d&&(this._totalNumWorkers<
this._maxTotalNumWorkers?(d.numWorkers++,this._totalNumWorkers++,this._workerFunc(h,(e,g)=>this._taskCallback(e,g))):d.tasks.push(h))};m.cancel=function(h){this._taskFinished(h);h._cancelled=!0};m.destroy=function(){this._clients.length=0};m._taskFinished=function(h){const d=this._clients[h.client];this._totalNumWorkers--;d.numWorkers--;d.statistics.requests++;d.statistics.size+=h.size||0;d.statistics.duration+=h.duration||0;d.statistics.speed=0<d.statistics.duration?d.statistics.size/d.statistics.duration:
0;c.assert(0<=d.numWorkers);this._next()};m._next=function(){for(const h of this._clients)if(h&&h.numWorkers<h.typeWorkerQuota&&this._processQueue(h))return;for(const h of this._clients)if(h&&this._processQueue(h))break};m._processQueue=function(h){for(;0<h.tasks.length;)if(this._workerFunc(h.tasks.shift(),(d,e)=>this._taskCallback(d,e)))return h.numWorkers++,this._totalNumWorkers++,!0;return!1};m._taskCallback=function(h,d){h._cancelled||(this._callbackFunc(h,d),this._taskFinished(h))};m.getStatsForType=
function(h){return(h=this._clients[h])?{quota:h.typeWorkerQuota,workers:h.numWorkers,queueSize:h.tasks.length,requestStats:h.statistics}:null};b._createClass(v,[{key:"test",get:function(){const h=this;return{set workerFunc(d){h._workerFunc=d}}}}]);return v}();a.AsyncWorkerQueue=u;a.BaseTask=function(v){this.client=v;this._cancelled=!1;this.duration=this.size=0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/SceneViewPerformanceInfo":function(){define(["../../../core/byteSizeEstimations",
"../../../core/maybe","../layers/support/MemoryManagedLayerView","./LayerPerformanceInfo","../terrain/terrainUtils"],function(a,b,c,n,l){return function(u){this.usedMemory=this.totalMemory=0;this.quality=1;this.edgesMemory=this.terrainMemory=this.load=0;this.layerPerformanceInfos=[];var v=u.resourceController.memoryController;this.totalMemory=v.maxMemory*a.ByteSizeUnit.MEGABYTES;this.usedMemory=Math.round(v.usedMemory*this.totalMemory);this.quality=v.memoryFactor;this.load=u.resourceController.scheduler.load;
this.terrainMemory=u.basemapTerrain?u.basemapTerrain.getUsedMemory():0;v=u._stage&&u._stage.renderView&&u._stage.renderView.edgeView;this.edgesMemory=b.isSome(v)?v.usedMemory:0;u.allLayerViews.items.forEach(m=>{(c.isMemoryManagedLayerView(m)||l.isSurfaceLayerView(m))&&this.layerPerformanceInfos.push(new n(m,u))});this.layerPerformanceInfos.sort((m,h)=>h.memory-m.memory)}})},"esri/views/3d/support/LayerPerformanceInfo":function(){define(["../layers/support/PerformanceInfoLayerView","../terrain/terrainUtils"],
function(a,b){return function(c,n){this.layer=null;this.displayedNumberOfFeatures=this.memory=0;this.totalNumberOfFeatures=this.maximumNumberOfFeatures=null;this.layer=c.layer;this.memory=b.isSurfaceLayerView(c)?n.basemapTerrain.getUsedMemoryForLayerView(c):c.getUsedMemory();a.isPerformanceInfoLayerView(c)&&(c=c.performanceInfo,this.displayedNumberOfFeatures=c.displayedNumberOfFeatures,this.maximumNumberOfFeatures=c.maximumNumberOfFeatures,this.totalNumberOfFeatures=c.totalNumberOfFeatures)}})},"esri/views/3d/layers/support/PerformanceInfoLayerView":function(){define(["exports"],
function(a){a.isPerformanceInfoLayerView=function(b){return"performanceInfo"in b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/terrainUtils":function(){define("exports ../../../core/Collection ../../../core/compilerUtils ../../../core/maybe ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ../support/StreamDataLoader ./interfaces ../../../chunks/terrainUtilsPlanar ../../../chunks/terrainUtilsSpherical".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(B){return"imagery-tile"===(null==B?void 0:B.type)||"wcs"===(null==B?void 0:B.type)}function p(B){return"imagery-tile-3d"===(null==B?void 0:B.type)}function t(B){return"tile-3d"===(null==B?void 0:B.type)}function q(B){return"vector-tile-3d"===(null==B?void 0:B.type)}function k(B){return"wmts-3d"===(null==B?void 0:B.type)}function r(B){return"elevation-3d"===(null==B?void 0:B.type)}function y(B){return B&&(t(B)||p(B)||q(B)||k(B))}function f(B,C,D,E){return A[E].checkIfTileInfoSupportedForViewSR(B,
D,C)}function w(B,C,D){B=u.getTileMaxtrixSetFromActiveLayer(B);if(n.isSome(B))if(b.isCollection(B)){if(B=B.find(E=>null==f(E.tileInfo,E.fullExtent,C,D)))return{tileInfo:B.tileInfo,fullExtent:B.fullExtent}}else return{tileInfo:B.tileInfo,fullExtent:B.fullExtent};return{tileInfo:null,fullExtent:null}}function z(B){return B.isWGS84||B.isWebMercator||l.isCGCS2000(B)||!l.isEarth(B)}const A={[v.ViewingMode.Global]:e.terrainUtilsSpherical,[v.ViewingMode.Local]:d.terrainUtilsPlanar};a.ENABLE_WATERPROOFNESS_TESTS=
!1;const x={force512VTL:!1};d=[h.NeighborIndex.NORTH,h.NeighborIndex.EAST,h.NeighborIndex.SOUTH,h.NeighborIndex.WEST];e=[h.NeighborIndex.NORTH_EAST,h.NeighborIndex.SOUTH_EAST,h.NeighborIndex.SOUTH_WEST,h.NeighborIndex.NORTH_WEST];a.ENABLE_TERRAIN_INTERNAL_CHECKS=!1;a.almostEquals=function(B,C,D=1E-5){return Math.abs(B-C)<D};a.checkIfTileInfoSupportedForView=f;a.enableWaterproofnessTests=function(B){a.ENABLE_WATERPROOFNESS_TESTS=B};a.eps=1E-5;a.getLayerWithExtentRange=function(B){return p(B)?{fullExtent:B.fullExtent,
minScale:B.layer.minScale,maxScale:B.layer.maxScale,tilemapCache:null}:B.layer};a.getTileInfoAndExtentFromWMTSLayer=w;a.getTiledLayerInfo=function(B,C,D){var E=null;let F=null;if("wmts"===(null==B?void 0:B.type))B=w(B,C,D),E=B.tileInfo,F=B.fullExtent;else if(F=g(B)?B.getCompatibleFullExtent(C):B.fullExtent,E=D===v.ViewingMode.Local,g(B))E=B.getCompatibleTileInfo(C,F,E);else if("vector-tile"===(null==B?void 0:B.type)){E=E&&!z(C)||x.force512VTL;const G=B.tileInfo.spatialReference.isGeographic;E=E?B.tileInfo:
B.tileInfo.getOrCreateCompatible(256,G?1:2)}else E=B.tileInfo;return n.isSome(E)&&n.isSome(F)&&null==f(E,F,C,D)?{tileInfo:E,fullExtent:F}:null};a.internalAssert=function(B,C){};a.isBlendableLayerView=function(B){return B&&(t(B)||k(B)||p(B)||q(B))};a.isEast=function(B){return B===h.NeighborIndex.NORTH_EAST||B===h.NeighborIndex.EAST||B===h.NeighborIndex.SOUTH_EAST};a.isElevationLayerView=r;a.isGroupLayer=function(B){return"group"===(null==B?void 0:B.type)};a.isImageryTileLayerView=p;a.isImageryTileRenderInfo=
function(B){var C;B=null==B?void 0:null==(C=B.sourceLayerInfo)?void 0:C.data;return n.isSome(B)&&"type"in B&&"raster-tile"===B.type};a.isMapTileLayerView=y;a.isNorth=function(B){return B===h.NeighborIndex.NORTH_EAST||B===h.NeighborIndex.NORTH||B===h.NeighborIndex.NORTH_WEST};a.isNorthCorner=function(B){return B===h.NeighborIndex.NORTH_WEST||B===h.NeighborIndex.NORTH_EAST};a.isProjectableRasterLayer=g;a.isRasterTileRenderInfo=function(B){var C;B=null==B?void 0:null==(C=B.sourceLayerInfo)?void 0:C.data;
return B instanceof HTMLImageElement||B instanceof m.ImageWithType||B instanceof HTMLCanvasElement||B instanceof ImageData};a.isSouth=function(B){return B===h.NeighborIndex.SOUTH_EAST||B===h.NeighborIndex.SOUTH||B===h.NeighborIndex.SOUTH_WEST};a.isSurfaceLayerView=function(B){return y(B)||r(B)};a.isTerrainSurfaceLayer=function(B){switch(B.type){case "building-scene":case "csv":case "feature":case "geo-rss":case "geojson":case "graphics":case "group":case "integrated-mesh":case "kml":case "line-of-sight":case "map-notes":case "ogc-feature":case "point-cloud":case "route":case "scene":case "stream":case "voxel":case "subtype-group":case "unknown":case "unsupported":case "wfs":case null:return!1;
case "base-dynamic":case "base-elevation":case "base-tile":case "bing-maps":case "elevation":case "imagery":case "imagery-tile":case "map-image":case "media":case "open-street-map":case "tile":case "vector-tile":case "wcs":case "web-tile":case "wms":case "wmts":return!0;default:return c.neverReached(B.type),!1}};a.isTextureTileRenderInfo=function(B){var C;B=null==B?void 0:null==(C=B.sourceLayerInfo)?void 0:C.data;return n.isSome(B)&&"type"in B&&"tile-texture"===B.type};a.isTileLayerView=t;a.isVectorTileLayerView=
q;a.isVectorTileRenderInfo=function(B){var C;B=null==B?void 0:null==(C=B.sourceLayerInfo)?void 0:C.data;return n.isSome(B)&&"type"in B&&"vector-tile"===B.type};a.isWMTSLayerView=k;a.isWest=function(B){return B===h.NeighborIndex.NORTH_WEST||B===h.NeighborIndex.WEST||B===h.NeighborIndex.SOUTH_WEST};a.isWestCorner=function(B){return B===h.NeighborIndex.NORTH_WEST||B===h.NeighborIndex.SOUTH_WEST};a.lij2s=function(B){return"["+B[0]+","+B[1]+","+B[2]+"]"};a.neighborCornerIndices=e;a.neighborEdgeIndices=
d;a.oppositeCorner=function(B){return B===h.NeighborIndex.NORTH_EAST?h.NeighborIndex.SOUTH_WEST:B===h.NeighborIndex.NORTH_WEST?h.NeighborIndex.SOUTH_EAST:B===h.NeighborIndex.SOUTH_WEST?h.NeighborIndex.NORTH_EAST:h.NeighborIndex.NORTH_WEST};a.oppositeEdge=function(B){return B===h.NeighborIndex.NORTH?h.NeighborIndex.SOUTH:B===h.NeighborIndex.EAST?h.NeighborIndex.WEST:B===h.NeighborIndex.SOUTH?h.NeighborIndex.NORTH:h.NeighborIndex.EAST};a.releaseTileData=function(B){n.isSome(B)&&"release"in B&&B.release();
return null};a.test=x;a.useFetchTileForLayer=function(B){return B.fetchTile&&!1!==B.hasOverriddenFetchTile};a.v32s=function(B){return"("+B[0]+","+B[1]+","+B[2]+")"};a.vtlAssumes256PixelSizeAsDefault=z;a.weakAssert=function(B,C){B||console.warn("Terrain: "+C)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/terrainUtilsPlanar":function(){define("exports ../core/Error ../core/maybe ./vec3 ./vec3f64 ../geometry/projection ../geometry/support/aaBoundingRect ../views/3d/terrain/TerrainConst ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,n,l,u,v,m,h){function d(y,f,w=0){y=y.extent;return c.isNone(y)?!1:0===w?v.containsPoint(y,f):v.containsPointWithMargin(y,f,w*Math.min(y[2]-y[0],y[3]-y[1]))}function e(y,f,w,z){n.copy(t,w);t[z]=f[z];z=n.subtract(t,t,f);var A=n.subtract(q,y,f);A=n.dot(A,z);const x=n.dot(z,z);f=0>=A?f:x<=A?w:n.add(t,f,n.scale(z,z,A/x));y=n.subtract(t,y,f);return Math.PI/2-Math.atan(y[2]/Math.sqrt(y[0]*y[0]+y[1]*y[1]))}function g(y,f,w){y=y.extent;if(c.isNone(y))return 0;k[0]=y[0];k[1]=y[1];k[2]=w;r[0]=
y[2];r[1]=y[3];r[2]=w;y=w=Infinity;f[0]<k[0]?w=e(f,k,r,0):f[0]>r[0]&&(w=e(f,r,k,0));f[1]<k[1]?y=e(f,k,r,1):f[1]>r[1]&&(y=e(f,r,k,1));return Math.min(w,y)}function p(y,f,w){if(c.isNone(y))return h.getMissingTileInfoError();if(y.spatialReference.isGeographic&&!u.canProjectToWGS84ComparableLonLat(y.spatialReference))return new b("tilingscheme:local-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in local scenes");var z=h.TilingScheme.checkUnsupported(y);if(c.isSome(z))return z;
if(c.isNone(w))return new b("tilingscheme:extent-not-exist","The layer does not provide a layer extent.");{var A=y.lods;z=A[0].resolution*2**A[0].level;var x=[z*y.size[0],z*y.size[1]];const B=[y.origin.x,y.origin.y];w=v.fromExtent(w);const C=v.create();h.TilingScheme.computeRowColExtent(w,x,B,C);x=(C[2]-C[0])*(C[3]-C[1]);x>m.MAX_ROOT_TILES?(A=A[0].scale*2**A[0].level,z=Math.max((w[3]-w[1])/y.size[1],(w[2]-w[0])/y.size[0])*A/z,w=Math.floor(Math.log(z)/Math.log(10)),z=Math.ceil(z/10**w)*10**w,z=new b("tilingscheme:too-many-root-tiles",
"Scale of level 0 of the tiling scheme (1:"+Math.floor(A).toLocaleString()+") is too large for the layer's extent. Suggested scale: 1:"+z.toLocaleString()+".",{level0Scale:A,suggestedLevel0Scale:z,requiredNumRootTiles:x,allowedNumRootTiles:m.MAX_ROOT_TILES})):z=null}if(z)return z;y=y.spatialReference;return!c.isSome(f)||y.equals(f)||f.isWGS84&&y.isWebMercator?null:new b("tilingscheme:spatial-reference-mismatch","The tiling scheme does not match the spatial reference of the local scene")}const t=l.create(),
q=l.create(),k=l.create(),r=l.create();l=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:d,tiltToExtentEdge:g,checkIfTileInfoSupportedForViewSR:p},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=p;a.isInsideExtent=d;a.terrainUtilsPlanar=l;a.tiltToExtentEdge=g})},"esri/chunks/terrainUtilsSpherical":function(){define("exports ../core/Error ../core/maybe ../geometry/projection ../geometry/support/spatialReferenceUtils ../views/3d/terrain/TilingScheme".split(" "),
function(a,b,c,n,l,u){function v(){return!0}function m(){return 0}function h(e,g){if(c.isNone(e))return u.getMissingTileInfoError();const p=e.lods.length-1,t=e.spatialReference,q=n.canProjectToWGS84ComparableLonLat(t)||l.isMars(t)||l.isMoon(t);if(t.isWebMercator){if(!u.TilingScheme.makeWebMercatorAuxiliarySphere(p).compatibleWith(e))return new b("tilingscheme:incompatible-global-web-mercator","The tiling scheme is not compatible with the ArcGIS Online Web Mercator tiling scheme")}else if(q){if(!u.TilingScheme.makeGCSWithTileSize(e.spatialReference,
e.size[0],p).compatibleWith(e))return e.spatialReference.isWGS84?new b("tilingscheme:incompatible-global-wgs84","The tiling scheme is not compatible with the ArcGIS Online WGS84 tiling scheme"):new b("tilingscheme:incompatible-global","The tiling scheme is not compatible with the ArcGIS Online tiling scheme")}else return new b("tilingscheme:global-unsupported-spatial-reference","The tiling scheme spatial reference is not supported in global scenes");if(c.isSome(g)&&!e.spatialReference.equals(g))return new b("tilingscheme:spatial-reference-mismatch",
"The tiling scheme does not match the spatial reference of the global scene")}const d=Object.freeze(Object.defineProperty({__proto__:null,isInsideExtent:v,tiltToExtentEdge:m,checkIfTileInfoSupportedForViewSR:h},Symbol.toStringTag,{value:"Module"}));a.checkIfTileInfoSupportedForViewSR=h;a.isInsideExtent=v;a.terrainUtilsSpherical=d;a.tiltToExtentEdge=m})},"esri/views/3d/support/SharedSymbolResources":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/Handles ../../../core/handleUtils ../../../core/reactiveUtils ../../../geometry/projectionEllipsoid ./index ./StreamTextureCollection ../webgl-engine/lib/screenSizePerspectiveUtils ../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){let g=function(){function t(k){this.streamDataRequester=this.textures=null;this.graphicsOwners=[];this.cimSymbolRasterizer=this.screenSizePerspectiveHandles=null;this.viewState=k.viewState;this.view=k.view;this.pointsOfInterest=k.pointsOfInterest;this.objectResourceCache=k.objectResourceCache;this.streamDataRequester=k.resourceController.createStreamDataRequester(m.ClientType.SYMBOLOGY);this.textures=new h.StreamTextureCollection(this.streamDataRequester,k.view._stage,
{preMultiplyAlpha:!0,wrap:{s:e.TextureWrapMode.CLAMP_TO_EDGE,t:e.TextureWrapMode.CLAMP_TO_EDGE}},k.resourceController.scheduler);const r=v.getReferenceEllipsoid(this.view.spatialReference).radius;this.screenSizePerspectiveSettings=d.getSettings(k.viewingMode,r);this.screenSizePerspectiveSettingsLabels=d.getLabelSettings(k.viewingMode,r)}var q=t.prototype;q.destroy=function(){this.textures.destroy();this.streamDataRequester=this.textures=null};q.addGraphicsOwner=function(k){if(!k)return l.makeHandle();
this.graphicsOwners.push(k);const r=u.watch(()=>{var y;return null==(y=k.layer)?void 0:y.screenSizePerspectiveEnabled},()=>this._updateScreenSizePerspectiveEnabled());this._updateScreenSizePerspectiveEnabled();return l.makeHandle(()=>{r.remove();c.removeUnordered(this.graphicsOwners,k);this._updateScreenSizePerspectiveEnabled()})};q._updateScreenSizePerspectiveEnabled=function(){var k=this.graphicsOwners.some(r=>{var y;return!0===(null==(y=r.layer)?void 0:y.screenSizePerspectiveEnabled)});k&&!this.screenSizePerspectiveHandles?
(this.screenSizePerspectiveHandles=new n,k=()=>this._updateScreenSizePerspectiveSettings(),this.screenSizePerspectiveHandles.add([u.watch(()=>this.pointsOfInterest.centerOnSurfaceInfrequent.distance,k,u.sync),this.viewState.events.on("camera-projection-changed",k)]),this._updateScreenSizePerspectiveSettings()):!k&&this.screenSizePerspectiveHandles&&(this.screenSizePerspectiveHandles.destroy(),this.screenSizePerspectiveHandles=null)};q._updateScreenSizePerspectiveSettings=function(){p.distance=this.pointsOfInterest.centerOnSurfaceInfrequent.distance;
p.fovY=this.viewState.camera.fovY;this.screenSizePerspectiveSettings.update(p);this.screenSizePerspectiveSettingsLabels.update(p);this.view._stage.renderView.requestRender()};b._createClass(t,[{key:"test",get:function(){return{screenSizePerspectiveHandles:this.screenSizePerspectiveHandles}}}]);return t}();const p={distance:0,fovY:0};a.SharedSymbolResources=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/StreamTextureCollection":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/promiseUtils ../../../core/urlUtils ./TextureCollection ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Texture".split(" "),
function(a,b,c,n,l,u,v,m){u=function(h){function d(g,p,t,q){p=h.call(this,p,q)||this;p._streamDataRequester=g;p._parameters=t;return p}b._inheritsLoose(d,h);var e=d.prototype;e.fromUrl=function(){var g=b._asyncToGenerator(function*(p,t,q){var k=this;n.throwIfAborted(q);const r=c.isSome(q)&&q.signal,y=this.makeUid(p,t);let f=this._textureRequests.get(y);if(!f){q=new AbortController;const w=this._streamDataRequester.request(p,"image",{uid:y,signal:q.signal});f={referenceCount:0,texture:null,textureAsync:null,
abortController:q};this._textureRequests.set(y,f);f.textureAsync=w.then(function(){var z=b._asyncToGenerator(function*(A){A=k._createTexture(p,A,t);f.texture=A;f.abortController=null;k._stage.add(A);yield k._stage.load(A);return{uid:y,texture:A,release:()=>k._release(y)}});return function(A){return z.apply(this,arguments)}}(),z=>{f.abortController=null;throw z;})}f.referenceCount++;return(new Promise((w,z)=>{n.onAbort(r,()=>{z(n.createAbortError())});f.textureAsync.then(w,z)})).catch(w=>{this._release(y);
throw w;})});return function(p,t,q){return g.apply(this,arguments)}}();e._createTexture=function(g,p,t){const q={...this._parameters,powerOfTwoResizeMode:v.PowerOfTwoResizeMode.PAD};if(l.isSVG(g)){if(t||0===p.width&&0===p.height)g=p.width?p.height/p.width:1,t=t||64,1<g?(p.width=Math.round(t/g),p.height=t):(p.width=t,p.height=Math.round(t*g));this._stage.renderView&&this._stage.renderView.renderingContext.driverTest.svgAlwaysPremultipliesAlpha&&(q.preMultiplyAlpha=!1)}q.width=p.width;q.height=p.height;
return new m.Texture(p,q)};return d}(u.TextureCollection);a.StreamTextureCollection=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/PointsOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/support/ray ../debugFlags ../debugUtils ../PropertiesPool ../geometryUtils/ray ./CameraOnSurface ./CenterOnSurface ./ContentGeometryUpdates ./Focus ./StableSurfaceCenter ./SurfaceGeometryUpdates ../../webgl-engine/lib/Intersector ../../webgl-engine/lib/IntersectorInterfaces ../../webgl-engine/lib/verticalOffsetUtils ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G){a.PointsOfInterest=function(M){function J(P){P=M.call(this,P)||this;P._handles=new l;P._tmpRay=q.create();P._centerRayDirty=!0;P._surfaceAltitudeAtCenter=0;P._surfaceAltitudeAtCenterDirty=!0;P._contentAltitudeAtCenter=0;P._contentAltitudeAtCenterDirty=!0;P._propertiesPool=new y.PropertiesPool({renderPointOfView:O},b._assertThisInitialized(P));P.renderPointOfView=t.create();P._pois=[];P._debugCenters=new Map;return P}b._inheritsLoose(J,
M);var I=J.prototype;I.initialize=function(){var P;const {state:N,basemapTerrain:V,renderCoordsHelper:S,map:T}=this.view;this._surfaceIntersector=D.newIntersector(N.viewingMode);this._surfaceIntersector.options.backfacesTerrain=N.isGlobal?!1:!0;this._surfaceIntersector.options.invisibleTerrain=!1;this._surfaceIntersector.options.store=E.StoreResults.MIN;this._contentIntersector=D.newIntersector(N.viewingMode);var H=()=>this._estimateSurfaceAltitudeAtCenter();const U=this.view.resourceController.scheduler,
W=u.unwrap(null==(P=this.view.basemapTerrain)?void 0:P.elevationQueryCache);P={state:N,scheduler:U,surface:V,renderCoordsHelper:S};this._set("centerOnSurfaceInfrequent",new z.CenterOnSurface({...P,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,estimateSurfaceAltitudeAtCenter:H}));this._set("centerOnSurfaceFrequent",new z.CenterOnSurface({...P,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:H}));this._set("contentCenterOnSurface",new z.CenterOnSurface({...P,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,
estimateSurfaceAltitudeAtCenter:H,cameraName:"contentCamera"}));this._set("centerOnContent",new z.CenterOnSurface({...P,task:G.TaskPriority.POINT_OF_INTEREST_FREQUENT,estimateSurfaceAltitudeAtCenter:()=>this._estimateContentAltitudeAtCenter()}));this._set("cameraOnSurface",new w.CameraOnSurface({...P,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:T}));this._set("contentCameraOnSurface",new w.CameraOnSurface({...P,cache:W,task:G.TaskPriority.POINT_OF_INTEREST_INFREQUENT,map:T,cameraName:"contentCamera"}));
this._set("surfaceGeometryUpdates",new C.SurfaceGeometryUpdates({...P,centerOnSurfaces:[this.centerOnSurfaceFrequent,this.centerOnContent,this.centerOnSurfaceInfrequent]}));this._set("contentGeometryUpdates",new A.ContentGeometryUpdates({contentLayerViews:this.view.allLayerViews,renderCoordsHelper:S}));this._set("surfaceOrigin",new B.StableSurfaceCenter({cache:W,view:this.view}));this._set("focus",new x.Focus({state:N,scheduler:U,surface:V,renderCoordsHelper:S,centerOnSurface:this.contentCenterOnSurface,
estimateSurfaceIntersectionAtRenderPoint:(Q,X)=>this._estimateSurfaceIntersectionAtRenderPoint(Q,this.view.state.contentCamera,X)}));this._pois.push(this.centerOnContent,this.centerOnSurfaceFrequent,this.centerOnSurfaceInfrequent,this.contentCenterOnSurface,this.cameraOnSurface,this.contentCameraOnSurface,this.focus);H=this.view.graphics;this._debugCenters.set(this.centerOnContent,new r.PointGraphics(H,"red","CenterOnContent"));this._debugCenters.set(this.centerOnSurfaceFrequent,new r.PointGraphics(H,
"red","CenterOnSurface"));this._debugCenters.set(this.centerOnSurfaceInfrequent,new r.PointGraphics(H,"red","CenterOnSurface"));this._debugCenters.set(this.contentCenterOnSurface,new r.PointGraphics(H,"red","ContentCenterOnSurface"));this._debugCenters.set(this.cameraOnSurface,new r.PointGraphics(H,"blue","CameraOnSurface"));this._debugCenters.set(this.contentCameraOnSurface,new r.PointGraphics(H,"blue","ContentCameraOnSurface"));this._debugCenters.set(this.focus,new r.PointGraphics(H,"green","Focus"));
this._handles.add([v.watch(()=>N.camera,Q=>this._cameraChanged(Q),v.sync),v.watch(()=>V.extent,()=>this._updateCenterPointsOfInterest()),v.when(()=>!V.updating,()=>this._updateCenterPointsOfInterest(),v.sync),v.on(()=>this.surfaceGeometryUpdates.events,"request-update",()=>this._updateCenterPointsOfInterest()),v.on(()=>this.contentGeometryUpdates.events,"request-update",()=>this._updateCenterOnContent()),v.when(()=>k.SHOW_POI,Q=>this._setDebug(Q),v.initial)]);this._cameraChanged(this.view.state.camera);
for(const Q of this._pois)Q.runTask()};I.destroy=function(){this._setDebug(!1);this._handles.destroy();this._propertiesPool.destroy();for(const P of this._pois)P.destroy();this.surfaceOrigin.destroy()};I._estimateContentAltitudeAtCenter=function(){if(!this._contentAltitudeAtCenterDirty)return this._contentAltitudeAtCenter;this._contentAltitudeAtCenterDirty=!1;const P=this.centerRay;if(u.isNone(P))return this._contentAltitudeAtCenter;this.view.sceneIntersectionHelper.intersectRay(P,this._contentIntersector,
K,R)?this._contentAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K):this._contentAltitudeAtCenter=this._estimateSurfaceAltitudeAtCenter();return this._contentAltitudeAtCenter};I._estimateSurfaceAltitudeAtCenter=function(){if(!this.view.basemapTerrain)return 0;if(!this._surfaceAltitudeAtCenterDirty)return this._surfaceAltitudeAtCenter;this._surfaceAltitudeAtCenterDirty=!1;const P=this.centerRay;if(u.isNone(P))return this._surfaceAltitudeAtCenter;const N=P.origin,V=p.add(K,P.origin,P.direction);
this._surfaceIntersector.resetWithRay(P,this.view.state.camera);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,N,V);this._surfaceIntersector.results.min.getIntersectionPoint(K)&&(this._surfaceAltitudeAtCenter=this.view.renderCoordsHelper.getAltitude(K));return this._surfaceAltitudeAtCenter};I._estimateSurfaceIntersectionAtRenderPoint=function(P,N,V){P=f.fromRenderAtEye(N,P,L);if(u.isNone(P))return null;const S=P.origin,T=p.add(K,P.origin,P.direction);this._surfaceIntersector.resetWithRay(P,
N);this.view.basemapTerrain.intersect(this._surfaceIntersector,null,S,T);return this._surfaceIntersector.results.min.getIntersectionPoint(V)?V:null};I._cameraChanged=function(P){this._updateCenterPointsOfInterest();P=P.eye;p.exactEquals(this.renderPointOfView,P)||this._set("renderPointOfView",p.copy(this._propertiesPool.get("renderPointOfView"),P))};I._updateCenterPointsOfInterest=function(){this._contentAltitudeAtCenterDirty=this._surfaceAltitudeAtCenterDirty=this._centerRayDirty=!0;for(const P of this._pois)P.updateRenderLocation()};
I._updateCenterOnContent=function(){this._contentAltitudeAtCenterDirty=!0;this.centerOnContent.updateRenderLocation()};I._setDebug=function(P){if(P)for(const N of this._pois)this._handles.add(v.watch(()=>N.renderLocation,V=>this._debugCenters.get(N).show(V,N.renderCoordsHelper.spatialReference),v.initial),"debug");else this._debugCenters.forEach(N=>N.hide()),this._handles.remove("debug")};b._createClass(J,[{key:"updating",get:function(){var P;return!!(null!=(P=this.surfaceGeometryUpdates)&&P.updating||
this._pois.some(N=>N.updating))}},{key:"centerRay",get:function(){this._centerRayDirty&&(this._centerRay=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(this.view.state.camera,this._tmpRay),this._centerRayDirty=!1);return this._centerRay}},{key:"test",get:function(){return{update:()=>{this.surfaceGeometryUpdates.runTask();for(const P of this._pois)P.runTask()},surfaceGeometryUpdates:this.surfaceGeometryUpdates}}}]);return J}(n);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,
"centerOnContent",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceFrequent",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"centerOnSurfaceInfrequent",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentCenterOnSurface",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"cameraOnSurface",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,
"contentCameraOnSurface",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"focus",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"renderPointOfView",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceOrigin",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"contentGeometryUpdates",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"surfaceGeometryUpdates",
void 0);c.__decorate([m.property({constructOnly:!0})],a.PointsOfInterest.prototype,"view",void 0);c.__decorate([m.property({readOnly:!0})],a.PointsOfInterest.prototype,"updating",null);a.PointsOfInterest=c.__decorate([g.subclass("esri.views.3d.support.PointsOfInterest")],a.PointsOfInterest);const O=Array,K=t.create(),L=q.create(),R={exclude:new Set([F.TERRAIN_ID])};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/debugUtils":function(){define("exports ../../../geometry ../../../Graphic ../../../symbols ../../../core/maybe ../../../geometry/Polygon ../../../symbols/FillSymbol3DLayer ../../../symbols/PolygonSymbol3D ../../../geometry/Point ../../../symbols/PointSymbol3D ../../../symbols/IconSymbol3DLayer ../../../symbols/TextSymbol3DLayer".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){b=function(){function p(q,k,r=""){this.graphics=q;this._symbol=new d({symbolLayers:[new e({material:{color:k},outline:{color:[255,255,255],size:1},resource:{primitive:"circle"}}),new g({text:r,halo:{color:"white",size:1/.75},material:{color:k},size:12})]})}var t=p.prototype;t.show=function(q,k){l.isNone(k)||(this.hide(),q=new h({x:q[0],y:q[1],z:q[2],spatialReference:k}),this._graphic=new c({geometry:q,symbol:this._symbol}),this.graphics.add(this._graphic))};t.hide=
function(){l.isSome(this._graphic)&&(this.graphics.remove(this._graphic),this._graphic=null)};return p}();n=function(){function p(q,k,r=""){this.graphics=q;this._graphics=[];this._outline=new m({symbolLayers:[new v({material:{color:[0,0,0,0]},outline:{color:k,size:2}})]});this._text=new d({symbolLayers:[new g({text:r,halo:{color:"white",size:1/.75},material:{color:k},size:12})]})}var t=p.prototype;t.show=function(q){this.hide();const k=new h({x:q.xmin,y:q.ymin,z:q.zmax,spatialReference:q.spatialReference});
this._graphics.push(new c({geometry:u.fromExtent(q),symbol:this._outline}));this._graphics.push(new c({geometry:k,symbol:this._text}));this.graphics.addMany(this._graphics)};t.hide=function(){this.graphics.removeMany(this._graphics);this._graphics.length=0};return p}();a.ExtentGraphics=n;a.PointGraphics=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/CameraOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../cameraUtils ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){const r=Array;a.CameraOnSurface=function(f){function w(A){A=f.call(this,A)||this;A._dirty=!1;A._propertiesPool=new q.PropertiesPool({location:p,renderLocation:r},b._assertThisInitialized(A));A._estimatedSurfaceAltitude=0;A._pendingElevationQueryController=null;A.cameraName="camera";A.renderLocation=g.create();A.tmpPoint=new p;return A}b._inheritsLoose(w,f);var z=w.prototype;z.initialize=function(){this.scheduler&&this.handles.add(this.scheduler.registerTask(this.task,
this));this.runTask();if(this.map){const A=()=>this._setDirty();this.handles.add(l.on(()=>{var x,B;return null==(x=this.map)?void 0:null==(B=x.ground)?void 0:B.layers},"change",A,{onListenerAdd:A,onListenerRemove:A}))}this._updateRenderLocation()};z.destroy=function(){this._cancelPendingRequest();this._propertiesPool.destroy();this._propertiesPool=null};z.updateRenderLocation=function(){this._setDirty();this._updateRenderLocation()};z._setDirty=function(){this._dirty||(this._dirty=!0,this.notifyChange("updating"))};
z._cancelPendingRequest=function(){const A=this._pendingElevationQueryController;A&&(this._pendingElevationQueryController=null,A.abort(),this.notifyChange("updating"))};z.runTask=function(){this._cancelPendingRequest();this._dirty=!1;this.notifyChange("updating");if(this.map&&this.map.ground){this.renderCoordsHelper.fromRenderCoords(this._camera.eye,this.tmpPoint,this.state.spatialReference);var A=new AbortController;this.map.ground.queryElevation(this.tmpPoint,{signal:A.signal,cache:this.cache}).then(x=>
this._updateSurfaceAltitude(x.geometry.z)).catch(x=>{n.isAbortError(x)||this._updateSurfaceAltitude(0)}).catch(()=>{}).then(()=>{this._pendingElevationQueryController===A&&(this._pendingElevationQueryController=null,this.notifyChange("updating"));A=null});this._pendingElevationQueryController=A}else this._updateSurfaceAltitude(0)};z._updateSurfaceAltitude=function(A){this._estimatedSurfaceAltitude!==A&&(this._estimatedSurfaceAltitude=A,this._updateRenderLocation())};z._updateRenderLocation=function(){this.renderCoordsHelper.setAltitude(y,
this._estimatedSurfaceAltitude,this._camera.eye);e.exactEquals(this._get("renderLocation"),y)||this._set("renderLocation",e.copy(this._propertiesPool.get("renderLocation"),y))};b._createClass(w,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const A=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,A,this.state.spatialReference);return A}},{key:"scale",get:function(){const A=this._camera,x=e.distance(A.eye,
this.renderLocation);return t.distanceToScale({renderCoordsHelper:this.renderCoordsHelper,state:{camera:A}},x,0)}},{key:"updating",get:function(){return this._dirty||null!=this._pendingElevationQueryController}},{key:"running",get:function(){return!this._pendingElevationQueryController&&this._dirty}}]);return w}(k.PointOfInterest);c.__decorate([u.property({constructOnly:!0})],a.CameraOnSurface.prototype,"scheduler",void 0);c.__decorate([u.property({constructOnly:!0})],a.CameraOnSurface.prototype,
"cache",void 0);c.__decorate([u.property({constructOnly:!0})],a.CameraOnSurface.prototype,"task",void 0);c.__decorate([u.property({constructOnly:!0})],a.CameraOnSurface.prototype,"cameraName",void 0);c.__decorate([u.property({readOnly:!0})],a.CameraOnSurface.prototype,"location",null);c.__decorate([u.property({constructOnly:!0})],a.CameraOnSurface.prototype,"map",void 0);c.__decorate([u.property({readOnly:!0})],a.CameraOnSurface.prototype,"renderLocation",void 0);c.__decorate([u.property({readOnly:!0})],
a.CameraOnSurface.prototype,"scale",null);c.__decorate([u.property({readOnly:!0})],a.CameraOnSurface.prototype,"updating",null);a.CameraOnSurface=c.__decorate([d.subclass("esri.views.3d.support.CameraOnSurface")],a.CameraOnSurface);const y=g.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/PointOfInterest":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h,d){a.PointOfInterest=function(e){function g(p){p=e.call(this,p)||this;p.handles=new l;return p}b._inheritsLoose(g,e);g.prototype.destroy=function(){this.handles.destroy()};return g}(n);c.__decorate([u.property({constructOnly:!0})],a.PointOfInterest.prototype,"renderCoordsHelper",void 0);c.__decorate([u.property({constructOnly:!0})],a.PointOfInterest.prototype,"surface",void 0);c.__decorate([u.property({constructOnly:!0})],a.PointOfInterest.prototype,"state",void 0);a.PointOfInterest=
c.__decorate([d.subclass("esri.views.3d.support.PointOfInterest")],a.PointOfInterest);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/CenterOnSurface":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/support/aaBoundingRect ../debugFlags ../PropertiesPool ./PointOfInterest".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){const w=Array;a.CenterOnSurface=function(B){function C(E){E=B.call(this,E)||this;E._propertiesPool=new y.PropertiesPool({location:p,renderLocation:w},b._assertThisInitialized(E));E._currentSurfaceAltitude=0;E._latestSurfaceAltitude=0;E.cameraName="camera";E.distance=0;E.renderLocation=g.create();E.updating=!1;return E}b._inheritsLoose(C,B);var D=C.prototype;D.initialize=function(){this._frameWorker=this.scheduler.registerTask(this.task,this);this.runTask()};
D.destroy=function(){this._frameWorker=l.removeMaybe(this._frameWorker);this._propertiesPool=l.destroyMaybe(this._propertiesPool)};D.updateRenderLocation=function(){this.updating=!0;this._updateRenderLocation()};D.runTask=function(){this._latestSurfaceAltitude=this.estimateSurfaceAltitudeAtCenter();this._updateRenderLocation();this.updating=!1};D._updateRenderLocation=function(){const E=z;let F=this._calculateSurfaceIntersection(this._currentSurfaceAltitude,E);var G=this._currentSurfaceAltitude!==
this._latestSurfaceAltitude;!F&&G&&(F=this._calculateSurfaceIntersection(this._latestSurfaceAltitude,E))&&(this._currentSurfaceAltitude=this._latestSurfaceAltitude);G=A;F&&this._latestSurfaceAltitudeChangesDistanceSignificantly(E,G)&&(e.copy(E,G),this._currentSurfaceAltitude=this._latestSurfaceAltitude);F?this.distance=e.distance(this._camera.eye,E):(e.scale(E,this._camera.viewForward,this._get("distance")),e.add(E,E,this._camera.eye));e.exactEquals(this._get("renderLocation"),E)||this._set("renderLocation",
e.copy(this._propertiesPool.get("renderLocation"),E))};D._calculateSurfaceIntersection=function(E,F){var G=this._camera;if(!this.renderCoordsHelper.intersectManifold(G.ray,E,F))return!1;if(this.state.isGlobal){const O=q.getReferenceEllipsoid(this.renderCoordsHelper.spatialReference).radius;E=O+E;const K=e.squaredLength(G.eye),L=K<E*E,R=e.distance(G.eye,F);L&&R>O/4&&(e.scale(F,G.viewForward,E-Math.sqrt(K)),e.add(F,F,G.eye))}else G=this.surface.ready?this.surface.extent:null,l.isSome(G)&&t.projectBoundingRect(G,
this.surface.spatialReference,x,this.renderCoordsHelper.spatialReference)&&(F[0]=n.clamp(F[0],x[0],x[2]),F[1]=n.clamp(F[1],x[1],x[3]));return!0};D._latestSurfaceAltitudeChangesDistanceSignificantly=function(E,F){if(this._latestSurfaceAltitude===this._currentSurfaceAltitude||null==E)return!1;if(this._calculateSurfaceIntersection(this._latestSurfaceAltitude,F)){if(r.TESTS_DISABLE_OPTIMIZATIONS)return!0;const G=this._camera.eye;E=e.distance(G,E);F=e.distance(G,F);if(.05<Math.abs(F-E)/E)return!0}return!1};
b._createClass(C,[{key:"_camera",get:function(){return this.state[this.cameraName]}},{key:"location",get:function(){const E=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,E,this.state.spatialReference);return E}},{key:"estimatedSurfaceAltitude",get:function(){return this._latestSurfaceAltitude}},{key:"running",get:function(){return this.updating}}]);return C}(f.PointOfInterest);c.__decorate([u.property({constructOnly:!0})],a.CenterOnSurface.prototype,
"scheduler",void 0);c.__decorate([u.property({constructOnly:!0})],a.CenterOnSurface.prototype,"task",void 0);c.__decorate([u.property({constructOnly:!0})],a.CenterOnSurface.prototype,"cameraName",void 0);c.__decorate([u.property()],a.CenterOnSurface.prototype,"distance",void 0);c.__decorate([u.property({constructOnly:!0})],a.CenterOnSurface.prototype,"estimateSurfaceAltitudeAtCenter",void 0);c.__decorate([u.property({readOnly:!0})],a.CenterOnSurface.prototype,"location",null);c.__decorate([u.property({readOnly:!0})],
a.CenterOnSurface.prototype,"renderLocation",void 0);c.__decorate([u.property()],a.CenterOnSurface.prototype,"updating",void 0);a.CenterOnSurface=c.__decorate([d.subclass("esri.views.3d.support.CenterOnSurface")],a.CenterOnSurface);const z=g.create(),A=g.create(),x=k.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/ContentGeometryUpdates":function(){define(["exports","../../../../core/Evented","../../../../core/Handles"],
function(a,b,c){let n=function(){function u(m){this.handles=new c;this.events=new b;this.contentLayerViews=m.contentLayerViews;this.handles.add(this.contentLayerViews.on("change",h=>this._layerViewsChanged(h)));this._layerViewsChanged({added:this.contentLayerViews.toArray(),removed:[],moved:[],target:this.contentLayerViews})}var v=u.prototype;v.destroy=function(){this.handles&&(this.handles.destroy(),this.handles=null)};v._layerViewsChanged=function(m){m.added.forEach(h=>{"esri.views.3d.layers.SceneLayerView3D"===
h.declaredClass&&this.handles.add(h.on("visible-geometry-changed",()=>this._contentChanged()),h.uid)});m.removed.forEach(h=>this.handles.remove(h.uid))};v._contentChanged=function(){this.events.emit("request-update",l)};return u}();const l={};a.ContentGeometryUpdates=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/Focus":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/mathUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/ray ../PropertiesPool ./PointOfInterest ../../webgl-engine/lib/Camera ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){const w=Array;a.Focus=function(B){function C(E){E=B.call(this,E)||this;E._propertiesPool=new k.PropertiesPool({location:t,renderLocation:w},b._assertThisInitialized(E));E._dirty=!0;E.renderLocation=E._propertiesPool.get("renderLocation");return E}b._inheritsLoose(C,B);var D=C.prototype;D.initialize=function(){this.handles.add([l.watch(()=>this.centerOnSurface.renderLocation,()=>this.updateRenderLocation()),l.watch(()=>this.state.contentCamera,()=>this.updateRenderLocation())]);
this.scheduler&&this.handles.add(this.scheduler.registerTask(f.TaskPriority.POINT_OF_INTEREST_FREQUENT,this))};D.destroy=function(){this._propertiesPool.destroy();this._propertiesPool=null};D.runTask=function(){var E=this._get("renderLocation");const F=this.centerOnSurface.renderLocation;var G=this.renderCoordsHelper,O=this.state.contentCamera;this._dirty=!1;G.worldUpAtPosition(F,z);G=Math.max(0,(Math.acos(g.dot(z,O.viewForward))-.5*Math.PI)*(O.aboveGround?1:-1));Number.isNaN(G)?E&&g.equals(E,F)||
(E=this._propertiesPool.get("renderLocation"),g.copy(E,F),this._set("renderLocation",E)):(G=1-n.clamp(G/(.5*Math.PI),0,1),G*=G*G,this._calculateScreenHorizontalEdgeOnSurface(x),O=this._propertiesPool.get("renderLocation"),g.lerp(O,F,x,G),E&&g.equals(E,O)||this._set("renderLocation",O))};D._calculateScreenHorizontalEdgeOnSurface=function(E){const F=this.state.contentCamera;var G=F.getRenderCenter(u.createRenderScreenPointArray3());G[1]=F.aboveGround?F.padding[y.PaddingSide.BOTTOM]:F.fullHeight-F.padding[y.PaddingSide.TOP];
if(this.estimateSurfaceIntersectionAtRenderPoint(G,E))return E;const O=this.renderCoordsHelper.getAltitude(this.centerOnSurface.renderLocation);return F.unprojectFromRenderScreen(G,A)&&(g.subtract(A,A,F.eye),G=g.normalize(A,A),this.renderCoordsHelper.intersectManifold(q.wrap(F.eye,G),O,E))?E:this.renderCoordsHelper.setAltitude(E,O,F.eye)};D.updateRenderLocation=function(){this._dirty=!0};b._createClass(C,[{key:"updating",get:function(){return this._dirty||this.centerOnSurface.updating}},{key:"location",
get:function(){const E=this._propertiesPool.get("location");this.renderCoordsHelper.fromRenderCoords(this.renderLocation,E,this.state.spatialReference);return E}},{key:"running",get:function(){return this._dirty}}]);return C}(r.PointOfInterest);c.__decorate([v.property()],a.Focus.prototype,"_dirty",void 0);c.__decorate([v.property({constructOnly:!0})],a.Focus.prototype,"scheduler",void 0);c.__decorate([v.property({constructOnly:!0})],a.Focus.prototype,"centerOnSurface",void 0);c.__decorate([v.property({constructOnly:!0})],
a.Focus.prototype,"estimateSurfaceIntersectionAtRenderPoint",void 0);c.__decorate([v.property({readOnly:!0})],a.Focus.prototype,"updating",null);c.__decorate([v.property({readOnly:!0})],a.Focus.prototype,"location",null);c.__decorate([v.property({readOnly:!0})],a.Focus.prototype,"renderLocation",void 0);a.Focus=c.__decorate([e.subclass("esri.views.3d.support.CenterOnSurface")],a.Focus);const z=p.create(),A=p.create(),x=p.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/support/pointsOfInterest/StableSurfaceCenter":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Handles ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/Point ../../../../geometry/support/aaBoundingRect".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){a.StableSurfaceCenter=function(r){function y(w){w=r.call(this,w)||this;w.location=null;w._updateController=null;w._handles=new l;return w}b._inheritsLoose(y,r);var f=y.prototype;f.initialize=function(){this.view.state.isLocal&&(this._handles.add([m.watch(()=>{var w,z;return[null==(w=this.surfaceView)?void 0:w.spatialReference,null==(z=this.surfaceView)?void 0:z.extent]},()=>this._update()),m.on(()=>{var w;return null==(w=this.surface)?void 0:w.layers},"change",
()=>this._update())]),this._update())};f.destroy=function(){this._handles.destroy()};f._update=function(){this._updateController&&(this._updateController.abort(),this._updateController=null);if(this.surfaceView&&!u.isNone(this.surfaceView.extent)&&this.surfaceView.spatialReference){var w=k.center(this.surfaceView.extent);w=new q({x:w[0],y:w[1],z:0,spatialReference:this.surfaceView.spatialReference});this.surface&&0<this.surface.layers.length?(this._set("location",null),this._updateController=new AbortController,
this.surface.queryElevation(w,{noDataValue:0,signal:this._updateController.signal,cache:this.cache}).then(z=>{this._updateController=null;this._set("location",z.geometry)}).catch(z=>{v.isAbortError(z)||z&&"elevation-query:invalid-layer"===z.name||console.error("StableSurfaceCenter failed to update: ",z)})):this._set("location",w)}else this._set("location",null)};b._createClass(y,[{key:"renderLocation",get:function(){if(!this.location)return null;const w=t.create();this.view.renderCoordsHelper.toRenderCoords(this.location,
w);return w}}]);return y}(n);c.__decorate([h.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"view",void 0);c.__decorate([h.property({constructOnly:!0})],a.StableSurfaceCenter.prototype,"cache",void 0);c.__decorate([h.property({readOnly:!0,aliasOf:"view.map.ground"})],a.StableSurfaceCenter.prototype,"surface",void 0);c.__decorate([h.property({readOnly:!0,aliasOf:"view.basemapTerrain"})],a.StableSurfaceCenter.prototype,"surfaceView",void 0);c.__decorate([h.property({readOnly:!0})],a.StableSurfaceCenter.prototype,
"location",void 0);c.__decorate([h.property({readOnly:!0})],a.StableSurfaceCenter.prototype,"renderLocation",null);a.StableSurfaceCenter=c.__decorate([p.subclass("esri.views.3d.terrain.StableSurfaceCenter")],a.StableSurfaceCenter);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/pointsOfInterest/SurfaceGeometryUpdates":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingRect ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){a.SurfaceGeometryUpdates=function(w){function z(){var x=w.apply(this,arguments)||this;x.handles=new u;x._tileGeometryUpdateExtent=t.empty();x._tileGeometryUpdateSpatialReference=null;x.events=new l;x.updating=!1;return x}b._inheritsLoose(z,w);var A=z.prototype;A.initialize=function(){this.handles.add([this.surface.on("elevation-change",x=>this._tileGeometryChanged(x)),this.scheduler.registerTask(q.TaskPriority.SURFACE_GEOMETRY_UPDATES,this)])};A.destroy=function(){this.handles=
v.destroyMaybe(this.handles)};A.runTask=function(){this.updating&&(this._centerIntersectsExtent(this._tileGeometryUpdateExtent,this._tileGeometryUpdateSpatialReference)&&this.events.emit("request-update",k),t.empty(this._tileGeometryUpdateExtent),this._set("updating",!1))};A._tileGeometryChanged=function(x){this._tileGeometryUpdateSpatialReference=x.spatialReference;t.expand(this._tileGeometryUpdateExtent,x.tile.extent,this._tileGeometryUpdateExtent);this._set("updating",!0)};A._furthestCenterOnSurface=
function(){let x=this.centerOnSurfaces[0];for(let B=1;B<this.centerOnSurfaces.length;B++){const C=this.centerOnSurfaces[B];C.distance>x.distance&&(x=C)}return x};A._centerIntersectsExtent=function(x,B){const C=this.state.camera.eye,D=f,E=this._furthestCenterOnSurface();this.renderCoordsHelper.fromRenderCoords(C,r,B);this.renderCoordsHelper.fromRenderCoords(E.renderLocation,y,B);r[0]<y[0]?(D[0]=r[0],D[2]=y[0]):(D[0]=y[0],D[2]=r[0]);r[1]<y[1]?(D[1]=r[1],D[3]=y[1]):(D[1]=y[1],D[3]=r[1]);return t.intersects(D,
x)};b._createClass(z,[{key:"running",get:function(){return this.updating}}]);return z}(n);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"state",void 0);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"centerOnSurfaces",void 0);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"renderCoordsHelper",void 0);c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"scheduler",void 0);
c.__decorate([m.property({constructOnly:!0})],a.SurfaceGeometryUpdates.prototype,"surface",void 0);c.__decorate([m.property({readOnly:!0})],a.SurfaceGeometryUpdates.prototype,"updating",void 0);a.SurfaceGeometryUpdates=c.__decorate([g.subclass("esri.views.3d.support.SurfaceGeometryUpdates")],a.SurfaceGeometryUpdates);const k={},r=p.create(),y=p.create(),f=t.empty();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainSurface":function(){define("require ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/arrayUtils ../../../core/CollectionFlattener ../../../core/Evented ../../../core/Handles ../../../core/Logger ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ../../../core/promiseUtils ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/aliasOf ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/property ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4 ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../core/support/WatchUpdatingTracking ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ../../../layers/mixins/RefreshableLayer ../../../layers/support/ElevationQueryTileCache ../../../layers/support/layerUtils ../../../layers/support/LercDecoder ../../2d/engine/vectorTiles/VectorTile ../support/cameraUtils ../support/debugFlags ../support/extentUtils ../support/index ../support/updatingProperties ./ElevationBounds ./ElevationData ./ExtentHelper ./interfaces ./LayerClass ./OverlayManager ./PlanarPatch ./RenderOrder ./SphericalPatch ./TerrainConst ./TerrainRenderer ./TerrainSurfacePerformanceInfo ./terrainUtils ./Tile ./TilePerLayerInfo ./TileUpdate ./tileUtils ./TilingSchemeLogic ./UpsampleInfo ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/lib/basicInterfaces ../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H,U,W,Q,X,ba,aa,ea,ia,ka,la,Z,ca,Y,da,ha,ja,ma,pa,na,wa,xa,sa){function ya(Oa,Ra){return Oa[0]===Ra[0]&&Oa[1]===Ra[1]&&Oa[2]===Ra[2]}function ra(Oa){return Oa.isLeaf?!1:Oa.children.some(Ra=>Ra.shouldLoad)||Oa.children.some(Ra=>ra(Ra))}const ua=d.getLogger("esri.views.3d.terrain.TerrainSurface");l=function(Oa){function Ra(qa){var za,Da;var La=Oa.call(this,qa)||this;La._elevationBounds=new U.ElevationBounds;La._iteratorPool=
new p(ma.IteratorPreorder,Na=>Na.remove=()=>La._iteratorPool.release(Na));La._postorderIterator=new ma.IteratorPostorder;La._hasPendingUpdates=!1;La._pendingUpdates=0;La._asyncWorkItems=0;La._allTilesDirty=!0;La._allTilesSorted=!0;La._visible=!1;La._usedMemory=null;La._performanceInfo=new ca;La._viewChanged=!1;La._inFrameTask=!1;La._viewChangeUpdateDirty=!1;La._eyePosRenderSR=C.create();La._eyePosSurfaceSR=C.create();La._splitLimits=new da.SplitLimits;La._snapLevel=Infinity;La._frustum=K.create();
La._viewProjectionMatrix=x.create();La._layerViews=[[],[]];La._layerIndexByUid=[new Map,new Map];La._basemapLayerViewHandles=new Map;La._handles=new h;La._watchUpdatingTracking=new E.WatchUpdatingTracking;La._frameTask=sa.ImmediateTask;La._allTiles=new t;La._upsampleInfoPool=new p(na.UpsampleInfo);La._rootTilesExtent=O.create();La._maxNumUpdating=1;La.maxTextureScale=1.2;La.backgroundColor=null;La._updatingRootTiles=!1;La.deferTileNeighborUpdate=!1;La.neighborTilesToUpdate=new Set;La.totalGeometryUpdates=
0;La.totalTileUpdates=0;La._layerViewsDirty=!1;La._isGlobal=!(null!=(za=qa.view)&&null!=(Da=za.state)&&Da.isLocal);return La}b._inheritsLoose(Ra,Oa);var Pa=Ra.prototype;Pa.initialize=function(){this._lercDecoder=I.acquireDecoder(this.view.resourceController);this._tilePool=this.view.state.isLocal?new p(ea.PlanarPatch):new p(ka.SphericalPatch);var qa=this.view.resourceController.memoryController;this._upsampleMapCache=qa.newCache("esri.views.3d.terrain.upsample",za=>za.unloadMapData());this._elevationQueryCache=
new M.ElevationQueryTileCache(qa.newCache("elevation-query"));this._set("overlayManager",new aa.OverlayManager({surface:this}));this._handles.add([k.watch(()=>this.overlayManager.hasHighlights,za=>this._renderer.setNeedsHighlight(za)),k.watch(()=>this.overlayManager.rendersOccluded,za=>this._renderer.setRenderOccludedOverlay(za))],"overlayManager");this._renderer=new Z({overlayRenderer:this.overlayManager.renderer,ellipsoidRadius:G.getReferenceEllipsoid(this.view.spatialReference).radius,stage:this.view._stage,
allTiles:this._allTiles});this._handles.add([k.watch(()=>this.baseOpacity,za=>{this._handleLayerViewChanges();this._updateBaseOpacity(za)},k.syncAndInitial),k.watch(()=>this.hasCompositeBlendMode,()=>{this._updateBaseOpacity(this.baseOpacity)},k.syncAndInitial),k.watch(()=>this.renderingDisabled,()=>this._updateTransparentTerrain(),k.sync),k.watch(()=>this.backgroundColor,za=>{this._handleLayerViewChanges();this._renderer.updateTileBackground(za)},k.syncAndInitial),k.watch(()=>this.view.pointsOfInterest,
za=>{this._renderer.pointsOfInterest=za;this._watchUpdatingTracking.removeAll();za&&this._watchUpdatingTracking.add(()=>za.focus.renderLocation,()=>()=>this._allTilesSorted=!1)}),k.watch(()=>V.TERRAIN_TILE_TREE_SHOW_TILES,za=>{za&&!this._treeDebugger?(new Promise((Da,La)=>a(["../layers/support/TerrainTileTree3DDebugger"],Da,La))).then(({TerrainTileTree3DDebugger:Da})=>{!this._treeDebugger&&V.TERRAIN_TILE_TREE_SHOW_TILES&&(this._treeDebugger=new Da({view:this.view}))}):za||(this._treeDebugger=g.destroyMaybe(this._treeDebugger))},
k.initial)]);this._extentHelper=Q.create(this.viewingMode,{layers:this.view.map.allLayers,layerViews:this.view.allLayerViews,viewSpatialReference:this.view.spatialReference});qa=this.view.defaultsFromMap?new v({getCollections:()=>{var za,Da,La;return null==(za=this.view)?void 0:null==(Da=za.defaultsFromMap)?void 0:null==(La=Da.mapCollections)?void 0:La.map(({layers:Na})=>Na)},getChildrenFunction:za=>za&&"layers"in za?za.layers:null}):this.view.map.allLayers;qa=new pa.TilingSchemeLogic({layers:qa,
extentHelper:this._extentHelper,viewingMode:this.viewingMode,viewSpatialReference:this.view.spatialReference});this._set("tilingSchemeLogic",qa);this._updateTilingScheme();this._elevationDataRequester=this.view.resourceController.createStreamDataRequester(T.ClientType.ELEVATION);this._mapDataRequester=this.view.resourceController.createStreamDataRequester(T.ClientType.BASEMAP);this._frameTask=this.view.resourceController.scheduler.registerTask(sa.TaskPriority.TERRAIN_SURFACE,this);this._handles.add([k.watch(()=>
this._extentHelper.stencilEnabledExtents,za=>this._renderer.setStencilEnabledLayerExtents(za),k.initial),k.watch(()=>this.tilingSchemeLogic.tilingScheme,()=>this._updateTilingScheme(),k.sync),k.watch(()=>this.extent,()=>this._updateRootTiles(),k.initial),this.view.on("resize",()=>this._viewChangeUpdate()),k.watch(()=>{var za,Da;const La=this.view,Na=La.state;return[this.lodBias,this.lodSnapping,null==(za=La.resourceController)?void 0:null==(Da=za.memoryController)?void 0:Da.memoryFactor,Na.camera,
Na.contentCamera,Na.fixedContentCamera]},()=>this._viewChangeUpdate(),k.syncAndInitial),k.watch(()=>{var za,Da;return null==(za=this.view.qualitySettings)?void 0:null==(Da=za.tiledSurface)?void 0:Da.textureFadeDuration},za=>this._renderer.textureFadingEnabled=0<za,k.initial),k.watch(()=>this._userClippingExtent,()=>this._updateClippingExtent(),k.sync)]);this._handles.add(this.view.allLayerViews.on("after-changes",()=>this._layerViewsDirty=!0));this._layerViewsDirty=!0;this._handleLayerViewChanges()};
Pa.destroy=function(){this._frameTask.remove();this._handles.destroy();this._watchUpdatingTracking.destroy();this._lercDecoder=g.releaseMaybe(this._lercDecoder);this._removeAllTiles();this._upsampleMapCache=g.destroyMaybe(this._upsampleMapCache);this._elevationQueryCache=g.destroyMaybe(this._elevationQueryCache);this._set("tilingSchemeLogic",g.destroyMaybe(this.tilingSchemeLogic));this._extentHelper=g.destroyMaybe(this._extentHelper);this._basemapLayerViewHandles.forEach((qa,za)=>this._unregisterTiledLayerView(za));
this._mapDataRequester=this._elevationDataRequester=null;this._set("overlayManager",g.destroyMaybe(this.overlayManager));this._tilePool=g.destroyMaybe(this._tilePool);da.Tile.prune();this._treeDebugger&&(this._treeDebugger.destroy(),this._treeDebugger=null);this._renderer=g.destroyMaybe(this._renderer);this._iteratorPool=g.destroyMaybe(this._iteratorPool);this._set("view",null);this._upsampleInfoPool=g.destroyMaybe(this._upsampleInfoPool);P.printAllocations();ha.printAllocations()};Pa._updateTransparentTerrain=
function(){var qa,za;const Da=!this.renderingDisabled&&!this.opaque;null==(qa=this.view)?void 0:null==(za=qa._stage)?void 0:za.renderView.setRenderParameters({transparentTerrain:Da})};Pa.intersect=function(qa,za,Da,La){this._renderer.intersect(qa,za,Da,La)};Pa.getElevation=function(qa,za,Da,La){qa=this.getTileWithElevation(qa,za,Da,La,Ba);return g.isNone(qa)?null:W.sampleElevation(Ba[0],Ba[1],qa.renderData.geometryState.samplerData)};Pa.getTileWithElevation=function(qa,za,Da,La,Na=Ba){var Ua;const Ta=
this.rootTiles;if(g.isNone(Ta)||!Ta.length||0===Ta[0].layerInfo[ba.LayerClass.ELEVATION].length)return null;Na[0]=qa;Na[1]=za;Na[2]=Da;if(!F.projectVectorToVector(Na,La,Na,null==(Ua=this.tilingScheme)?void 0:Ua.spatialReference))return ua.error("TerrainSurface.getElevation(): could not project given point to tiling scheme coordinate system"),null;for(let Za of Ta)if(Za.containsPoint(Na)){for(;Za&&!Za.rendered&&!Za.isLeaf;)qa=0,Na[0]>.5*(Za.extent[0]+Za.extent[2])&&(qa+=1),Na[1]<.5*(Za.extent[1]+Za.extent[3])&&
(qa+=2),Za=Za.children[qa];if((Na=Za.renderData)&&Na.geometryState.samplerData)return Za;break}return null};Pa.getScale=function(qa){if(this.tilingScheme){if(!F.projectPointToVector(qa,Ba,this.spatialReference))return ua.error("TerrainSurface.getScale(): could not project given point to tiling scheme coordinate system"),null;qa=this.rootTiles;if(g.isSome(qa))for(let Da of qa){var za;if(null!=(za=Da)&&za.containsPoint(Ba)){for(;!Da.isLeaf&&!Da.rendered;)za=0,Ba[0]>Da.children[0].extent[2]&&(za+=1),
Ba[1]<Da.children[0].extent[1]&&(za+=2),Da=Da.children[za];return this._getLodBiasCorrectedScale(Da.level)}}}return 1E100};Pa.getSphereElevationBounds=function(qa,za,Da,La,Na){var Ua;Ba[0]=qa;Ba[1]=za;Ba[2]=Da;Ba[3]=La;if(!F.projectVectorToVector(Ba,Na,Ba,null==(Ua=this.tilingScheme)?void 0:Ua.spatialReference))return ua.error("TerrainSurface.getSphereElevationBounds(): could not project given point to tiling scheme coordinate system"),null;let Ta=Infinity,Za=-Infinity;const ab=hb=>{if(hb&&O.intersectsSphere(hb.extent,
Ba))if(hb.isLeaf||hb.rendered)Ta=Math.min(Ta,hb.elevationBounds[0]),Za=Math.max(Za,hb.elevationBounds[1]);else for(const ta of hb.children)ab(ta)};qa=this.rootTiles;if(g.isSome(qa))for(const hb of qa)ab(hb);return{min:Ta,max:Za}};Pa.getSphereScale=function(qa,za){if(!this.tilingScheme)return null;if(!F.projectPointToVector(qa,Ba,this.spatialReference))return ua.error("TerrainSurface.getSphereScale(): could not project given point to tiling scheme coordinate system"),null;Ba[3]=za;let Da=null;const La=
Na=>{if(Na&&O.intersectsSphere(Na.extent,Ba))if(Na.isLeaf||Na.rendered)Na=this._getLodBiasCorrectedScale(Na.level),Da=null==Da?Na:Math.min(Da,Na);else for(const Ua of Na.children)La(Ua)};qa=this.rootTiles;if(g.isSome(qa))for(const Na of qa)La(Na);return Da};Pa.queryVisibleScaleRange=function(qa,za,Da,La){za=za?this.tilingScheme.levelAtScale(za):0;Da=Da?this.tilingScheme.levelAtScale(Da):Infinity;const Na=this.lodBias;this._renderer.queryVisibleLevelRange(qa,za+Na,Da+Na,La)};Pa._updateBaseOpacity=
function(qa){const za=this._renderer.opaque;this._renderer.opaque=1<=qa&&!this.hasCompositeBlendMode;this._renderer.isTransparent=this._allSurfaceLayersTransparent();(qa=za!==this._renderer.opaque)&&this._updateTransparentTerrain();this._updateTileTextures(qa?X.TextureUpdate.UNFADED:X.TextureUpdate.IMMEDIATE)};Pa._updateTilingScheme=function(){var qa,za;const Da=this.tilingSchemeLogic.tilingScheme;Da!==this.tilingScheme&&(Y.weakAssert(!!Da,"tiling scheme cannot be reset to undefined"),this._isGlobal=
!(null!=(qa=this.view)&&null!=(za=qa.state)&&za.isLocal),this.tilingScheme&&this._removeAllTiles(),this._set("tilingScheme",Da),this._updateClippingExtent(),Da&&(this._updateTiledLayers(),this._renderer.setTileSize(Da.pixelSize),this.overlayManager.setSpatialReference(Da.spatialReference),this._updateRootTiles()))};Pa._acquireTile=function(qa,za,Da,La){const Na=this._tilePool.acquire();Ja[0]=qa;Ja[1]=za;Ja[2]=Da;Na.init(Ja,La,this);return Na};Pa._updateRootTiles=function(){const {extent:qa,tilingScheme:za}=
this;if(za){var Da=Ea,La=za.rootTilesInExtent(qa,Da,5*la.MAX_ROOT_TILES);if(g.isSome(this.rootTiles)){if(La.length>la.MAX_ROOT_TILES){ua.warn(la.TOO_MANY_ROOT_TILES_AFTER_CHANGE_ERROR);return}const Na=this.rootTiles.map(Ta=>Ta.lij),Ua=u.difference(Na,La,ya);this._updatingRootTiles=!0;if(0<Ua.removed.length||0<Ua.added.length){const Ta=this.rootTiles.filter(Za=>-1<Ua.removed.findIndex(ab=>ya(ab,Za.lij))?(this._purgeTile(Za,!0),!1):!0);Ua.added.forEach(Za=>Ta.push(this._newRootTile(Za)));this._setRootTiles(Ta)}}else this._updatingRootTiles=
!0,La.length>la.MAX_ROOT_TILES&&(ua.warn(la.TOO_MANY_ROOT_TILES_FOR_LAYER_ERROR),La=za.rootTilesInExtent(qa,Da,la.MAX_ROOT_TILES)),this._setRootTiles(La.map(Na=>this._newRootTile(Na)));O.equals(Da,this._rootTilesExtent)||(this._rootTilesExtent=O.create(Da));this.visible=!0;this._viewChangeUpdate();this.overlayManager.setPlacementDirty();this.notifyChange("ready");this._allTiles.forEach(Na=>{Na.isLoaded&&this._prepareToLoadTile(Na)});this._allTiles.forAll(Na=>{Na.isLoaded&&(this._updateTileGeometry(Na),
this._updateTileNeighborsAfterGeometryChange(Na))});this._updatingRootTiles=!1;this.checkAllTileWaterproofness()}};Pa._newRootTile=function(qa){qa=this._acquireTile(0,qa[1],qa[2],null);qa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===ja.TileUpdate.SPLIT&&qa.setPendingUpdate(ja.TileUpdate.SPLIT);this._loadTile(qa);this.deferTileNeighborUpdate||qa.checkGeometryWaterproofness();return qa};Pa._setRootTiles=function(qa){this._set("rootTiles",qa);this._allTiles.clear();if(g.isSome(qa)){const za=
this._iteratorPool.acquire();for(za.reset(qa);!za.done;)this._allTiles.push(za.next());za.remove()}this._renderer.setRootTiles(this.rootTiles);this._updateTilesVisibility(qa)};Pa._runViewChangeUpdateIfDirty=function(){this._viewChangeUpdateDirty&&(this._viewChangeUpdateDirty=!1,this._viewChangeUpdate())};Pa._viewChangeUpdate=function(){this.view&&!this.suspended&&this.tilingScheme&&this._visible&&(this._inFrameTask?this._viewChangeUpdateDirty=!0:(this._viewChangeUpdateDirty=!1,this._updateViewDependentParameters(),
this._updateTilesVisibility(this.rootTiles)))};Pa._updateClippingStatus=function(qa){qa.updateClippingStatus(this.extent)&&qa.resetPendingUpdate(ja.TileUpdate.GEOMETRY)&&this._updateTileGeometry(qa)};Pa._updateTilesVisibility=function(qa){if(!g.isNone(qa)){var za=ma.hasLoadableSiblings(qa),Da=za?this._elevationBounds.min:Infinity;za=za?this._elevationBounds.max:-Infinity;var La=this.view.state.fixedContentCamera,Na=this.extent,Ua=this._viewProjectionMatrix;this.setTileTreeDirty();var Ta=this._iteratorPool.acquire();
for(Ta.reset(qa);!Ta.done;){qa=Ta.next();qa.updateClippingStatus(Na)&&qa.resetPendingUpdate(ja.TileUpdate.GEOMETRY)&&this._updateTileGeometry(qa);qa.setPendingUpdate(ja.TileUpdate.RENDERDATA);const Za=qa.computeVisibility();La||Za?(qa.updateScreenDepth(Ua),qa.renderData&&(Da=Math.min(qa.elevationBounds[0],Da),za=Math.max(qa.elevationBounds[1],za))):Ta.skipSubtree()}Ta.remove();this._allTilesDirty=this._viewChanged=!0;isFinite(Da)&&isFinite(za)&&(this._elevationBounds.min!==Da||this._elevationBounds.max!==
za)&&(this._elevationBounds.min=Da,this._elevationBounds.max=za,this.emit("elevation-bounds-change",null))}};Pa._updateViewDependentParameters=function(){const qa=this.view.state.camera,za=this.view.state.contentCamera,Da=Math.tan(.5*za.fovX),La=Math.tan(.5*za.fovY),Na=this.tilingScheme.pixelSize,Ua=2**-this.lodBias*qa.pixelRatio;this._splitLimits.aboveGround=qa.aboveGround;this._splitLimits.fovX=Da;this._splitLimits.fovY=La;this._splitLimits.relativeWidthLimit=Na/qa.width*this.maxTextureScale*Ua;
this._splitLimits.relativeHeightLimit=Na/qa.height*this.maxTextureScale*Ua;this._splitLimits.maxLod=this.tilingScheme.getMaxLod();this._splitLimits.angledSplitBias=this.view.qualitySettings.tiledSurface.angledSplitBias;this.view.state.fixedContentCamera?(g.isNone(this._splitLimits.frustum)&&(this._splitLimits.frustum=K.create()),K.copy(this._splitLimits.frustum,za.frustum)):this._splitLimits.frustum=null;K.copy(this._frustum,qa.frustum);A.multiply(this._viewProjectionMatrix,za.projectionMatrix,za.viewMatrix);
B.copy(this._eyePosRenderSR,za.eye);F.projectVectorToVector(qa.eye,this.view.renderSpatialReference,this._eyePosSurfaceSR,this.spatialReference)};Pa._updateRenderData=function(qa){qa.rendered&&!qa.shouldLoad&&(ra(qa)?(this._loadChildren(qa),this.deferTileNeighborUpdate||(this._checkTileNeighborsWaterproofness(qa),qa.children.forEach(za=>za.checkGeometryWaterproofness()))):qa.isLeaf&&qa.parent&&qa.parent.shouldLoad&&this._loadParent(qa))};Pa._updateTileGeometry=function(qa){qa.updateVisibility();this._renderer.updateTileGeometry(qa);
this._updateTileNeighborsAfterGeometryChange(qa);this._elevationUpdate(qa);this._usedMemory=null;this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(qa)};Pa._updateTileNeighborsAfterGeometryChange=function(qa,za){if(this.deferTileNeighborUpdate){const Da=this.neighborTilesToUpdate;qa.forEachLoadedNeighbor(La=>{Da.add(La)})}else qa.updateNeighborsAfterGeometryChange(za)};Pa._updateTileTexture=function(qa,za){const Da=qa.resetPendingUpdate(ja.TileUpdate.TEXTURE_FADING)?ja.TileUpdate.TEXTURE_FADING:
qa.resetPendingUpdate(ja.TileUpdate.TEXTURE_NOFADING)?ja.TileUpdate.TEXTURE_NOFADING:!1;Da&&(this._renderer.updateTileTexture(qa,Da),this._usedMemory=null,za.madeProgress())};Pa._elevationUpdate=function(qa){Ca.spatialReference=this.spatialReference;Ca.tile=qa;Ca.extent=qa.extent;this.emit("elevation-change",Ca)};Pa.runTask=function(qa){this._handleLayerViewChanges(qa);this._frameTask.processQueue(qa);this._inFrameTask=!0;this._pendingUpdates=0;this._hasPendingUpdates=!1;this._updateTileStatus(qa);
this._sortTiles(qa);const za=!this.view.state.fixedContentCamera;this._mergeAndSplit(qa,za);qa.run(()=>this._updateElevation(qa));qa.run(()=>this._updateTextures(qa));za||this._mergeAndSplit(qa,!0);this._inFrameTask=!1;this._runViewChangeUpdateIfDirty();qa.done?this.requestUpdate():this._usedMemory=this._recalculateUsedMemory();this.notifyChange("updatingProgressValue")};Pa._updateTileStatus=function(qa){if(this._viewChanged&&this.rootTiles&&!qa.done){this._viewChanged=!1;var za=this._iteratorPool.acquire();
for(za.reset(this.rootTiles);!za.done;){var Da=za.next();if(Da.loadable){var La=Da.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping);if(La===ja.TileUpdate.SPLIT){Da.resetPendingUpdate(ja.TileUpdate.MERGE);Da.isLeaf&&(Da.setPendingUpdate(ja.TileUpdate.SPLIT),za.skipSubtree());continue}Da.resetPendingUpdate(ja.TileUpdate.SPLIT)&&Da.updateAgentSuspension();La===ja.TileUpdate.VSPLITMERGE&&Da.updateAgents(ba.LayerClass.ELEVATION)}za.skipSubtree();if(!Da.isLeaf){Da.setPendingUpdate(ja.TileUpdate.MERGE);
Da.resetPendingUpdate(ja.TileUpdate.SPLIT);La=this._iteratorPool.acquire();La.resetOne(Da);for(Da=La.next();!La.done;Da=La.next())this._updateClippingStatus(Da),Da.updateVisibility(),Da.loadable&&Da.updateScreenDepth(this._viewProjectionMatrix);La.remove()}}za.remove();this.requestUpdate();qa.madeProgress()}};Pa._sortTiles=function(qa){qa.done||this._allTilesSorted||(ma.sortTilesByPOI(this._allTiles,this.view.pointsOfInterest.focus.renderLocation),this._allTilesSorted=!0,this._treeDebugger&&this._treeDebugger.update(),
qa.madeProgress())};Pa._prepareBatchTileGeometryUpdate=function(){Y.internalAssert(0===this.neighborTilesToUpdate.size);this.deferTileNeighborUpdate=!0};Pa._batchUpdateUpdatedTileNeighbors=function(){this.deferTileNeighborUpdate=!1;const qa=this.neighborTilesToUpdate;(()=>{(()=>{for(const za of qa)za.updateNeighborDataAndGeometryIfNeeded()})();(()=>{for(const za of qa)za.updateNeighborsWithChangedEdgeResolution()})();qa.clear()})()};Pa._mergeAndSplit=function(qa,za){if(!this.suspended&&!qa.done&&
this._allTilesDirty){this._allTilesDirty=!1;this.requestUpdate();this._prepareBatchTileGeometryUpdate();for(var Da=!1;!qa.done;){Da=!0;let La=!1;const Na=!this._allTiles.some(Ua=>{if(Ua.resetPendingUpdate(ja.TileUpdate.MERGE)){if(!za)return Ua.setPendingUpdate(ja.TileUpdate.MERGE),qa.done;this._mergeTile(Ua);La=!0;qa.madeProgress()}else Ua.resetPendingUpdate(ja.TileUpdate.SPLIT)&&(this._splitTile(Ua),La=!0,qa.madeProgress());!qa.done&&Ua.resetPendingUpdate(ja.TileUpdate.RENDERDATA)&&(this._updateRenderData(Ua),
qa.madeProgress());return qa.done});La&&(this._allTilesSorted=!1,this._allTilesDirty=!0);if(Na){if(!La)break;this._updateTilesVisibility(this.rootTiles)}else this._allTilesDirty=!0}Da||(this._allTilesDirty=!0);this._batchUpdateUpdatedTileNeighbors();this._sortTiles(qa)}};Pa._updateElevation=function(qa){this._prepareBatchTileGeometryUpdate();this._allTiles.some(za=>{za.resetPendingUpdate(ja.TileUpdate.GEOMETRY)&&(this._updateTileGeometry(za),this._updateTileTexture(za,qa),qa.madeProgress());return qa.done});
this._batchUpdateUpdatedTileNeighbors();return qa.hasProgressed};Pa._updateTextures=function(qa){this._allTiles.some(za=>{this._updateTileTexture(za,qa);return qa.done});return qa.hasProgressed};Pa._updateClippingExtent=function(){this.spatialReference&&(this.updateTileOverlayParams(xa.RenderRequestType.UPDATE),this.overlayManager.setPlacementDirty(),this._updateRootTiles())};Pa._getLodBiasCorrectedScale=function(qa){const za=this.tilingScheme.levels;qa=e.clamp(qa-this.lodBias,0,za.length-1);const Da=
qa-Math.floor(qa);return za[Math.floor(qa)].scale*(1-Da)+za[Math.ceil(qa)].scale*Da};Pa._removeAllTiles=function(){g.isSome(this.rootTiles)&&(this.rootTiles.forEach(qa=>this._purgeTile(qa,!1)),this._setRootTiles(null),this.notifyChange("ready"));this._allTiles.clear();this.visible=!1};Pa._purgeDescendantTiles=function(qa){if(qa.isLeaf)return!1;let za=!1;for(let Da=0;4>Da;++Da)za=this._purgeTile(qa.children[Da],!1)||za;qa.unsetChildren();return za};Pa._purgeTile=function(qa,za){const Da=this._purgeDescendantTiles(qa)||
qa.rendered;this._allTiles.removeUnordered(qa);this._unloadTile(qa);za&&this._updateTileNeighborsAfterGeometryChange(qa);this._tilePool.release(qa);return Da};Pa._unloadTile=function(qa){this.deferTileNeighborUpdate&&this.neighborTilesToUpdate.delete(qa);qa.unload(this._renderer)};Pa._splitTile=function(qa){Y.weakAssert(qa.isLeaf,"tile that is already split should not be split again!");const za=qa.level+1,Da=2*qa.lij[1],La=2*qa.lij[2];qa.setChildren(this._createTile(za,Da,La,qa),this._createTile(za,
Da,La+1,qa),this._createTile(za,Da+1,La,qa),this._createTile(za,Da+1,La+1,qa));qa.setPendingUpdate(ja.TileUpdate.RENDERDATA);qa.updateAgentSuspension();this._allTiles.pushArray(qa.children);this._allTilesDirty=!0;this._emitTileScaleChange(qa,za);++this._performanceInfo.numSplit};Pa._emitTileScaleChange=function(qa,za=qa.level){Ka.spatialReference=this.spatialReference;Ka.extent=qa.extent;Ka.scale=this._getLodBiasCorrectedScale(za);this.emit("scale-change",Ka)};Pa._createTile=function(qa,za,Da,La){Y.weakAssert(!!La,
"_createTile sanity check");qa=this._acquireTile(qa,za,Da,La);qa.updateClippingStatus(this.extent);qa.loadable&&(qa.updateScreenDepth(this._viewProjectionMatrix),qa.shouldSplit(this._splitLimits,this._eyePosRenderSR,this.lodSnapping)===ja.TileUpdate.SPLIT&&qa.setPendingUpdate(ja.TileUpdate.SPLIT));return qa};Pa._mergeTile=function(qa){Y.weakAssert(!qa.hasPendingUpdate(ja.TileUpdate.SPLIT),"_mergeTile sanity check");this._purgeDescendantTiles(qa)&&(Y.weakAssert(!qa.renderData,"_mergeTile sanity check"),
this._loadTile(qa),this._updateTileNeighborsAfterGeometryChange(qa),this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(qa));this._allTilesDirty=!0;++this._performanceInfo.numMerged;this._emitTileScaleChange(qa)};Pa._checkTileAndNeighborsWaterproofness=function(qa){qa.checkGeometryWaterproofness();this._checkTileNeighborsWaterproofness(qa)};Pa._checkTileNeighborsWaterproofness=function(qa){Y.ENABLE_WATERPROOFNESS_TESTS&&qa.forallNeighbors(za=>za.isLoaded?(za.checkGeometryWaterproofness(),
!0):!1)};Pa._loadChildren=function(qa){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(qa);Y.weakAssert(qa.rendered,"parent should be rendered");this._unloadTile(qa);const za=qa.children;za.forEach(Da=>this._prepareToLoadTile(Da));za.forEach(Da=>this._loadTilePrepared(Da));this._updateTileNeighborsAfterGeometryChange(qa,qa.level+1);this.deferTileNeighborUpdate||(za.forEach(Da=>Da.updateNeighborsWithChangedEdgeResolution()),za.forEach(Da=>Da.checkGeometryWaterproofness()),this._checkTileNeighborsWaterproofness(qa))};
Pa._loadParent=function(qa){this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(qa);qa=qa.parent;this._unloadChildren(qa);this._loadTile(qa);this._updateTileNeighborsAfterGeometryChange(qa);this.deferTileNeighborUpdate||this._checkTileAndNeighborsWaterproofness(qa)};Pa._unloadChildren=function(qa){if(!qa.isLeaf)for(let za=0;4>za;++za){const Da=qa.children[za];this._unloadChildren(Da);this._unloadTile(Da)}};Pa._postLoadTile=function(qa){qa.setPendingUpdate(ja.TileUpdate.RENDERDATA);
this.requestUpdate();this._allTilesDirty=!0;this.overlayManager&&this.overlayManager.hasOverlays&&this.overlayManager.setTileParameters(qa);this._elevationUpdate(qa)};Pa._loadTile=function(qa){qa.load(this._renderer);this._postLoadTile(qa)};Pa._loadTilePrepared=function(qa){qa.loadPrepared(this._renderer);this._postLoadTile(qa)};Pa._prepareToLoadTile=function(qa){qa.prepareToLoad(this._renderer)};Pa._elevationDataArrived=function(qa,za,Da){Da=new W.ElevationData(qa.lij,qa.extent,Da);qa.dataArrived(za,
ba.LayerClass.ELEVATION,Da);Da=[qa];qa=qa.level;const La=this._iteratorPool.acquire();for(La.reset(Da);!La.done;){const Na=La.next();Na.findElevationBoundsForLayer(za,qa);Na.computeElevationBounds()}La.remove();this._updateTilesVisibility(Da)};Pa._handleLayerViewChanges=function(qa=sa.noBudget){if(this._layerViewsDirty){var za=this._layerViewsDirty=!1,Da=new Set,La=-1;for(const Ua of this.view.allLayerViews.items)if(Da.add(Ua.uid),Y.isSurfaceLayerView(Ua))if(this._basemapLayerViewHandles.has(Ua.uid)){var Na=
this._layerClassFromLayerView(Ua);Na=this._getLayerIdxByUID(Na,Ua.uid);if(g.isSome(Na)){if(Na<La||g.isNone(La))za=!0;La=Na}}else this._registerTiledLayerView(Ua),Ua.layer.loaded&&(za=!0);this._basemapLayerViewHandles.forEach((Ua,Ta)=>{Da.has(Ta)||(this._unregisterTiledLayerView(Ta),za=!0)});za&&this._updateTiledLayers();this._renderer.isTransparent=this._allSurfaceLayersTransparent();this.hasCompositeBlendMode=this._hasCompositeBlendMode();qa.madeProgress()}};Pa._allSurfaceLayersTransparent=function(){var qa,
za;let Da=0===(null==(qa=this.view.map)?void 0:null==(za=qa.ground)?void 0:za.opacity);for(const La of this.view.allLayerViews.items)if(Y.isMapTileLayerView(La)&&!J.isBaseLayer(La.layer)&&0!==La.fullOpacity){Da=!1;break}return Da};Pa._hasCompositeBlendMode=function(){for(const qa of this.view.allLayerViews.items)if(Y.isBlendableLayerView(qa)){const za=Y.isGroupLayer(qa.layer.parent)?"normal":qa.layer.blendMode;if(wa.isCompositeBlendMode(wa.blendModeFromString[za]))return!0}return!1};Pa._layerClassFromLayerView=
function(qa){return Y.isElevationLayerView(qa)?ba.LayerClass.ELEVATION:ba.LayerClass.MAP};Pa._registerTiledLayerView=function(qa){const za=[],Da=this._layerClassFromLayerView(qa);za.push(k.watch(()=>qa.suspended,()=>this._updateTiledLayers()));za.push(k.watch(()=>qa.fullOpacity,()=>this._updateTileTextures(X.TextureUpdate.UNFADED)));za.push(k.watch(()=>"effectiveScaleRange"in qa.layer?qa.layer.effectiveScaleRange:null,()=>this._restartAllAgents(Da)));Y.isBlendableLayerView(qa)&&za.push(k.watch(()=>
qa.layer.blendMode,()=>{this.hasCompositeBlendMode=this._hasCompositeBlendMode();this._updateTileTextures(X.TextureUpdate.UNFADED)}));qa.on("data-changed",()=>{const La=this._getLayerIdxByUID(Da,qa.uid);g.isSome(La)&&this._invalidateLayerData(La,Da)});this._basemapLayerViewHandles.set(qa.uid,za)};Pa._unregisterTiledLayerView=function(qa){const za=this._basemapLayerViewHandles.get(qa);if(za){for(let Da=0;Da<za.length;Da++)za[Da].remove();this._basemapLayerViewHandles.delete(qa)}};Pa._updateTiledLayers=
function(){if(this.tilingScheme&&!this.view.suspended){var qa=[[],[]],za=null;this.view.allLayerViews.forEach(La=>{if(La.layer&&!La.suspended&&Y.isSurfaceLayerView(La)&&La.fullExtent){var Na=this._layerClassFromLayerView(La);if(Na===ba.LayerClass.MAP){const Ua=La.displayLevelRange.maxLevel;Infinity!==Ua&&(null===za||Ua>za)&&(za=Ua)}qa[Na].push(La)}});for(const La of ba.LayerClasses){var Da=this._layerViews[La];const Na=qa[La];Na.reverse();const Ua=Na.length;let Ta=Da.length!==Ua;const Za=Array(Ua),
ab=Array(Da.length);this._layerIndexByUid[La].clear();for(let hb=0;hb<Ua;hb++){this._layerIndexByUid[La].set(Na[hb].uid,hb);const ta=Da.indexOf(Na[hb]);Za[hb]=ta;hb!==ta&&(Ta=!0);-1<ta&&(ab[ta]=hb)}if(Ta){Da=this._postorderIterator;for(Da.reset(this.rootTiles);!Da.done;)Da.next().modifyLayers(ab,Za,La);this._layerViews[La]=Na;this._restartAllAgents(La);this._updateTilesVisibility(this.rootTiles)}}this.tilingScheme.ensureMaxLod(za)&&this._viewChangeUpdate()}};Pa._restartAllAgents=function(qa){const za=
this._postorderIterator;for(za.reset(this.rootTiles);!za.done;){const Da=za.next();Da.restartAgents(qa);qa===ba.LayerClass.ELEVATION&&Da.computeElevationBounds()}};Pa.layerViewByIndex=function(qa,za){return this._layerViews[za][qa]};Pa.numLayers=function(qa){return this._layerViews[qa].length};Pa._updateTileTextures=function(qa){this._allTiles.forAll(za=>{za.updateAgents(ba.LayerClass.MAP);qa===X.TextureUpdate.IMMEDIATE?this.renderer.updateTileTexture(za,ja.TileUpdate.TEXTURE_NOFADING):za.updateRenderData(ba.LayerClass.MAP,
qa)});this._renderer.isTransparent=this._allSurfaceLayersTransparent()};Pa._invalidateLayerData=function(qa,za){this._allTiles.forAll(Da=>Da.removeLayerAgent(qa,za));this._allTiles.forAll(Da=>Da.invalidateLayerData(qa,za))};Pa.setTileTreeDirty=function(){this._allTilesDirty=!0};Pa.requestRender=function(qa=xa.RenderRequestType.UPDATE){this.renderer.setNeedsRender(qa)};Pa.requestUpdate=function(){1===++this._pendingUpdates&&(this._hasPendingUpdates=!0)};Pa.requestTileData=function(qa,za,Da,La){const Na=
this.layerViewByIndex(za,Da);za=Na.layer;if(!za.tilemapCache||Y.isVectorTileLayerView(Na))return this._requestTileData(qa,Da,Na,La);++this._asyncWorkItems;return za.tilemapCache.fetchAvailability(qa.lij[0],qa.lij[1],qa.lij[2],{...La,timeout:6E3}).then(()=>--this._asyncWorkItems).catch(Ua=>{--this._asyncWorkItems;q.isAbortError(Ua)||this._dataMissing(qa,Da,Na,{notInTilemap:!0});throw Ua;}).then(()=>this._frameTask.schedule(()=>this._requestTileData(qa,Da,Na,La),La.signal))};Pa._requestTileData=function(qa,
za,Da,La){return za===ba.LayerClass.ELEVATION?Y.isElevationLayerView(Da)?this._requestElevationTileData(qa,Da,La):Promise.reject():Y.isMapTileLayerView(Da)?this._requestMapTileData(qa,Da,La):Promise.reject()};Pa._requestElevationTileData=function(qa,za,Da){++this._asyncWorkItems;const La=Ta=>{if(!q.isAborted(Da)){var Za=this._layerIndexByUid[ba.LayerClass.ELEVATION].get(za.uid);null==Za?ua.warn("TerrainSurface: received data from unknown layer %d %s",ba.LayerClass.ELEVATION,qa.lij.toString()):(this._usedMemory=
null,this.requestUpdate(),this._elevationDataArrived(qa,Za,Ta))}},Na=Ta=>{q.isAbortError(Ta)||(this._dataMissing(qa,ba.LayerClass.ELEVATION,za,Ta),this.requestUpdate())};if(Y.useFetchTileForLayer(za.layer))return za.layer.fetchTile(qa.lij[0],qa.lij[1],qa.lij[2],{noDataValue:la.ELEVATION_NODATA_VALUE,signal:Da.signal}).then(Ta=>{if(q.isAborted(Da))ua.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true.");else return this._frameTask.schedule(()=>
La(Ta),Da.signal,Na)},Na).finally(()=>{--this._asyncWorkItems});const Ua=za.getTileUrl(qa.lij[0],qa.lij[1],qa.lij[2]);return this._elevationDataRequester.request(Ua,"binary",Da).then(Ta=>this._lercDecoder.decode(Ta,{noDataValue:la.ELEVATION_NODATA_VALUE},Da.signal)).then(Ta=>{Ta?La({values:Ta.pixelData,width:Ta.width,height:Ta.height,noDataValue:Ta.noDataValue,minValue:Ta.minValue,maxValue:Ta.maxValue}):Na(Error("LERC decoding failed"))},Na).finally(()=>{--this._asyncWorkItems})};Pa._requestMapTileData=
function(qa,za,Da){++this._asyncWorkItems;const La=(ab,hb)=>{--this._asyncWorkItems;Y.releaseTileData(hb);q.isAborted(Da)||(this._dataMissing(qa,ba.LayerClass.MAP,za,ab),this.requestUpdate())},Na=ab=>hb=>La(hb,ab),Ua=ab=>this._frameTask.schedule(()=>{--this._asyncWorkItems;this.requestUpdate();q.isAborted(Da)?Y.releaseTileData(ab):this._mapTileDataArrived(qa,za,ab)},Da.signal,Na(ab)).catch(Na(ab)),Ta=(ab,hb=null)=>this._frameTask.schedule(()=>La(ab,hb));if(Y.isVectorTileLayerView(za)){var Za=za.schemaHelper.getLevelRowColumn(qa.lij);
return za.fetchTile(Za[0],Za[1],Za[2],Da).then(Ua,Ta)}if(Y.isImageryTileLayerView(za))return za.fetchTile(qa.lij[0],qa.lij[1],qa.lij[2],Da).then(Ua,Ta);if(Y.isTileLayerView(za)&&Y.useFetchTileForLayer(za.layer))return za.layer.fetchTile(qa.lij[0],qa.lij[1],qa.lij[2],Da).then(ab=>{q.isAborted(Da)?(ua.warnOnce("A call to fetchTile resolved even though the request was aborted. fetchTile should not resolve if options.signal.aborted is true."),Ta(q.createAbortError())):Ua(ab)},Ta);Za=za.getTileUrl(qa.lij[0],
qa.lij[1],qa.lij[2]);R.isRefreshableLayer(za.layer)&&za.layer.refreshTimestamp&&(Za+=`${Za.includes("?")?"\x26":"?"}_ts=${za.layer.refreshTimestamp}`);return this._mapDataRequester.request(Za,za.hasMixedImageFormats?"image+type":"image",Da).then(Ua,Ta)};Pa._mapTileDataArrived=function(qa,za,Da){za=this._getLayerIdxByUID(ba.LayerClass.MAP,za.uid);g.isSome(za)?qa.dataArrived(za,ba.LayerClass.MAP,Da):(Y.releaseTileData(Da),ua.warn("TerrainSurface: received data from unknown layer"))};Pa._getLayerIdxByUID=
function(qa,za){return this._layerIndexByUid[qa].get(za)};Pa._dataMissing=function(qa,za,Da,La){Da=this._getLayerIdxByUID(za,Da.uid);g.isSome(Da)?qa.dataMissing(Da,za,La):ua.warn("TerrainSurface: received data from unknown layer")};Pa.updateTileOverlayParams=function(qa){this.rootTiles&&this.overlayManager&&(this._allTiles.forAll(za=>{za.renderData&&this.overlayManager.setTileParameters(za)}),this._renderer.setNeedsRender(qa))};Pa.getUsedMemory=function(){if(!this.tilingScheme)return 0;g.isNone(this._usedMemory)&&
(this._usedMemory=this._recalculateUsedMemory());return g.isSome(this._usedMemory)?this._usedMemory:0};Pa._recalculateUsedMemory=function(){return this.tilingScheme?this._allTiles.reduce((qa,za)=>qa+za.usedMemory,0):null};Pa.getUsedMemoryForLayerView=function(qa){let za=0;const Da=this._layerClassFromLayerView(qa),La=this._getLayerIdxByUID(Da,qa.uid);g.isSome(La)&&this._allTiles.forAll(Na=>za+=Na.getUsedMemoryForLayer(Da,La));return za};Pa.getTile=function(qa){if(g.isNone(qa)||g.isNone(this.rootTiles))return null;
const za=qa.split("/").map(Ua=>+Ua);if(0===za[0])return this.rootTiles.find(Ua=>Ua.lij[1]===za[1]&&Ua.lij[2]===za[2]);qa=2**za[0];const Da=Math.floor(za[1]/qa),La=Math.floor(za[2]/qa);let Na;this.rootTiles.some(Ua=>Ua.lij[1]===Da&&Ua.lij[2]===La?(Na=Ua,!0):!1);if(Na){for(qa=1<<za[0]-1;Na.lij[0]<za[0];){let Ua=za[1]&qa?2:0;0<(za[2]&qa)&&Ua++;if(!Na.children[Ua])return null;Na=Na.children[Ua];qa>>=1}Y.weakAssert(Na.lij[0]===za[0]&&Na.lij[1]===za[1]&&Na.lij[2]===za[2],"not the right tile?");return Na}return null};
Pa.checkAllTileWaterproofness=function(){if(Y.ENABLE_WATERPROOFNESS_TESTS){var qa=this.rootTiles;if(!g.isNone(qa)){var za=Na=>{var Ua,Ta,Za,ab;return null!=(Ua=0<(null==Na?void 0:null==(Ta=Na.renderData)?void 0:null==(Za=Ta.geometryInfo)?void 0:null==(ab=Za.indices)?void 0:ab.length))?Ua:!1},Da=Na=>{var Ua,Ta,Za;Na.renderData&&!Na.renderData.geometryState&&console.error("Tile[",Na.lij,"] has renderData but not geometryState");Na.renderData&&!Na.renderData.geometryInfo&&console.error("Tile[",Na.lij,
"] has renderData but not geometryInfo");null==(Ua=Na.renderData)||!Ua.geometryInfo||0<(null!=(Ta=null==(Za=Na.renderData.geometryInfo.indices)?void 0:Za.length)?Ta:0)||console.error("Tile[",Na.lij,"] has renderData but no indices - geometryInfo: ",Na.renderData.geometryInfo);if(za(Na)){Na.checkGeometryWaterproofness();for(const ab of Na.children)Ua=ab,Ta=Na,za(Ua)&&console.error("Tile[",Ua.lij,"] has geometry although parent[",Ta.lij,"] has geom")}else if(Na.isLeaf)console.error("Tile[",Na.lij,"] has no geometry and no children, from root to leaf");
else for(const ab of Na.children)Da(ab)},La=Na=>{var Ua,Ta;const Za=null!=(Ua=null==(Ta=Na.parent)?void 0:Ta.visible)?Ua:!0;Ua=Na.visible;Na.computeVisibility();Ta=Na.visible;Ua!==Ta&&Za&&console.error(" Tile[",Na.lij,"] has out of date visibility: ",Ua," instead of ",Ta);if(!Na.isLeaf)for(const ab of Na.children)La(ab)};for(const Na of qa)Da(Na),La(Na)}}};Pa.isEastEndWrap=function(qa){return this.isGlobal&&qa[2]===this.lijEastEnd(qa[0])-1};Pa.isWestEndWrap=function(qa){return this.isGlobal&&0===
qa[2]};Pa.lijEastEnd=function(qa){return 2**(qa+(this.spatialReference.isGeographic?1:0))};Pa.wrapEastWest=function(qa){const za=this.lijEastEnd(qa[0]),Da=qa[2];return 0<=Da&&Da<za?qa:this.isGlobal?[qa[0],qa[1],(Da+(0>Da?za:0))%za]:null};b._createClass(Ra,[{key:"renderer",get:function(){return this._renderer}},{key:"frustum",get:function(){return this._frustum}},{key:"snapLevel",get:function(){var qa,za,Da=null==(qa=this.view.pointsOfInterest)?void 0:null==(za=qa.contentCameraOnSurface)?void 0:za.scale;
Da&&(qa=this.view.state.contentCamera,qa=N.directionToHeadingTilt(this.view,qa.eye,qa.viewForward,qa.up).tilt,90<qa&&(qa=180-qa),qa=2*(qa/90)**2,Da=N.scaleToZoom(this.view,Da)-qa,.25<Math.abs(this._snapLevel-Da)&&(Math.round(Da)!==Math.round(this._snapLevel)&&(this._viewChanged=!0),this._snapLevel=Da));return Math.round(this._snapLevel)}},{key:"lodSnapping",get:function(){return this.view.qualitySettings.tiledSurface.reduceTileLevelDifferences?X.LODSnapping.ON:X.LODSnapping.OFF}},{key:"upsampleInfoPool",
get:function(){return this._upsampleInfoPool}},{key:"upsampleMapCache",get:function(){return this._upsampleMapCache}},{key:"elevationQueryCache",get:function(){return this._elevationQueryCache}},{key:"mapTileRequester",get:function(){return this._mapDataRequester}},{key:"_userClippingExtent",get:function(){var {spatialReference:qa}=this,{clippingArea:za}=this.view;if(g.isNone(za)||g.isNone(qa))return null;const Da=O.create();qa=S.toBoundingRect(za,Da,qa)?Da:null;za=this._get("extent");return O.equals(qa,
za)?za:qa}},{key:"rootTilesExtent",get:function(){return this._rootTilesExtent}},{key:"extent",get:function(){const qa=O.intersection(this.groundExtent,this._userClippingExtent,O.create()),za=this._get("extent");return O.equals(qa,za)?za:qa}},{key:"groundExtent",get:function(){return g.isSome(this._tilingSchemeExtent)?this._tilingSchemeExtent:this._rootTilesExtent}},{key:"_tilingSchemeExtent",get:function(){var qa;return null==(qa=this.tilingSchemeLogic)?void 0:qa.extent}},{key:"updating",get:function(){this._hasPendingUpdates||
(this._maxNumUpdating=1);return!!((this._watchUpdatingTracking.updating||this._hasPendingUpdates||this._viewChanged||this._allTilesDirty||0<this._asyncWorkItems||!this._allTilesSorted||this._layerViewsDirty)&&this.ready&&!this.suspended||this.overlayManager.updating||this._frameTask.updating)}},{key:"updatingProgressValue",get:function(){this._maxNumUpdating=Math.max(this._pendingUpdates,this._maxNumUpdating);return 1-this._pendingUpdates/this._maxNumUpdating}},{key:"viewingMode",get:function(){return this.view.state.viewingMode}},
{key:"ready",get:function(){return g.isSome(this.rootTiles)}},{key:"renderOrder",set:function(qa){this._renderer.renderOrder=qa;this._set("renderOrder",qa)}},{key:"spatialReference",get:function(){var qa,za;return null!=(qa=null==(za=this.tilingScheme)?void 0:za.spatialReference)?qa:null}},{key:"slicePlaneEnabled",set:function(qa){this._renderer.slicePlaneEnabled=qa;this._set("slicePlaneEnabled",qa);this._updateTransparentTerrain()}},{key:"velvetOverground",set:function(qa){qa!==this.velvetOverground&&
(this._renderer.velvetOverground=qa);this._set("velvetOverground",qa)}},{key:"visible",set:function(qa){qa!==this._visible&&(this._visible=qa,this._renderer.setVisibility(qa),this.suspended=!qa)}},{key:"opaque",get:function(){return this._renderer.opaque}},{key:"suspended",set:function(qa){this._set("suspended",qa);this._viewChangeUpdate()}},{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"updatingRootTiles",get:function(){return this._updatingRootTiles}},{key:"running",
get:function(){return this.updating&&this.ready&&!this.suspended}},{key:"lodBias",get:function(){return this.view.qualitySettings.tiledSurface.lodBias-(1-this.view.resourceController.memoryController.memoryFactor)*la.MAX_MEMORY_LOD_BIAS}},{key:"performanceInfo",get:function(){const qa=this._performanceInfo;qa.numNodes=this._allTiles.length;qa.numLeaves=qa.numVisible=qa.numRendered=qa.numLoadedPerLevel.length=qa.numRenderedPerLevel.length=0;this._allTiles.forAll(za=>{za.isLeaf&&qa.numLeaves++;const Da=
za.level;za.renderData&&(qa.numLoadedPerLevel[Da]=(qa.numLoadedPerLevel[Da]||0)+1);za.visible&&(qa.numVisible++,za.rendered&&(qa.numRenderedPerLevel[Da]=(qa.numRenderedPerLevel[Da]||0)+1,qa.numRendered++))});return qa}},{key:"test",get:function(){const qa=this;return{renderer:qa._renderer,lercDecoder:qa._lercDecoder,forceReload:()=>{g.isSome(qa.rootTiles)&&(qa._mergeTile(qa.rootTiles[0]),qa._viewChangeUpdate())},getTiles:()=>qa._allTiles.toArray(),getRenderedTiles(){va.clear();qa._allTiles.forAll(Da=>
{Da.visible&&Da.rendered&&va.push(Da)});const za=va.toArray();ma.sortTiles(qa.renderOrder,za);return za},lockTilingScheme(za,Da){qa._extentHelper.defaultTiledLayersExtent=Da;qa.tilingSchemeLogic.test.lockTilingScheme(za)}}}},{key:"isGlobal",get:function(){return this._isGlobal}},{key:"shadingEnabled",get:function(){return this._renderer.shadingEnabled}},{key:"isWebMercator",get:function(){var qa;return!(null==(qa=this.tilingScheme)||!qa.spatialReference.isWebMercator)}},{key:"isWebMercatorOnPlateeCarree",
get:function(){var qa;return this.isWebMercator&&L.isPlateCarree(null==(qa=this.view)?void 0:qa.renderSpatialReference)}}]);return Ra}(m.EventedMixin(l));c.__decorate([w.property()],l.prototype,"_renderer",void 0);c.__decorate([w.property()],l.prototype,"_hasPendingUpdates",void 0);c.__decorate([w.property()],l.prototype,"_asyncWorkItems",void 0);c.__decorate([w.property()],l.prototype,"_allTilesDirty",void 0);c.__decorate([w.property()],l.prototype,"_allTilesSorted",void 0);c.__decorate([w.property()],
l.prototype,"_viewChanged",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"_watchUpdatingTracking",void 0);c.__decorate([w.property()],l.prototype,"_frameTask",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"snapLevel",null);c.__decorate([w.property({readOnly:!0})],l.prototype,"lodSnapping",null);c.__decorate([w.property({constructOnly:!0})],l.prototype,"view",void 0);c.__decorate([w.property()],l.prototype,"_userClippingExtent",null);c.__decorate([w.property()],l.prototype,
"_rootTilesExtent",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"extent",null);c.__decorate([w.property({readOnly:!0})],l.prototype,"groundExtent",null);c.__decorate([w.property({readOnly:!0})],l.prototype,"_tilingSchemeExtent",null);c.__decorate([w.property({readOnly:!0})],l.prototype,"updating",null);c.__decorate([w.property(H.updatingProgress)],l.prototype,"updatingProgress",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"updatingProgressValue",null);c.__decorate([w.property()],
l.prototype,"_maxNumUpdating",void 0);c.__decorate([w.property({aliasOf:"view.map.ground.opacity"})],l.prototype,"baseOpacity",void 0);c.__decorate([w.property()],l.prototype,"hasCompositeBlendMode",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"overlayManager",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"viewingMode",null);c.__decorate([w.property()],l.prototype,"maxTextureScale",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"ready",null);c.__decorate([w.property({value:ia.RenderOrder.FRONT_TO_BACK})],
l.prototype,"renderOrder",null);c.__decorate([w.property({readOnly:!0})],l.prototype,"rootTiles",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"spatialReference",null);c.__decorate([w.property({type:n,aliasOf:"view.map.ground.surfaceColor"})],l.prototype,"backgroundColor",void 0);c.__decorate([w.property({value:!1})],l.prototype,"slicePlaneEnabled",null);c.__decorate([w.property({readOnly:!0})],l.prototype,"tilingScheme",void 0);c.__decorate([w.property({readOnly:!0,aliasOf:"tilingSchemeLogic.tilingSchemeLocked"})],
l.prototype,"tilingSchemeLocked",void 0);c.__decorate([w.property({readOnly:!0})],l.prototype,"tilingSchemeLogic",void 0);c.__decorate([w.property({value:!0})],l.prototype,"velvetOverground",null);c.__decorate([r.aliasOf("_renderer.wireframe")],l.prototype,"wireframe",void 0);c.__decorate([w.property({value:!1})],l.prototype,"suspended",null);c.__decorate([w.property({readOnly:!0,aliasOf:"view.qualitySettings.tiledSurface.textureFadeDuration"})],l.prototype,"textureFadeDuration",void 0);c.__decorate([w.property()],
l.prototype,"_layerViewsDirty",void 0);c.__decorate([r.aliasOf("_renderer.renderPatchBorders")],l.prototype,"renderPatchBorders",void 0);c.__decorate([r.aliasOf("_renderer.renderingDisabled")],l.prototype,"renderingDisabled",void 0);c=l=c.__decorate([z.subclass("esri.views.3d.terrain.TerrainSurface")],l);const Ba=D.create(),Ea=O.create(),Ja=[0,0,0],va=new t,Ca={spatialReference:null,tile:null,extent:null,context:"ground"},Ka={spatialReference:null,extent:null,scale:0};return c})},"esri/layers/support/ElevationQueryTileCache":function(){define(["exports"],
function(a){let b=function(){function c(l){this.store=l}var n=c.prototype;n.destroy=function(){this.store.destroy()};n.get=function(l){return this.store.get(l)};n.put=function(l,u){this.store.put(l,u,u.values.byteLength+256)};return c}();a.ElevationQueryTileCache=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/layers/support/LercDecoder":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/workers/WorkerHandle"],
function(a,b,c,n){let l=function(v){function m(d=null){var e=v.call(this,"LercWorker","_decode",{_decode:g=>[g.buffer]},d,{strategy:"dedicated"})||this;e.schedule=d;e.ref=0;return e}b._inheritsLoose(m,v);var h=m.prototype;h.decode=function(d,e,g){return d&&0!==d.byteLength?this.invoke({buffer:d,options:e},g):Promise.resolve(null)};h.release=function(){0>=--this.ref&&(u.forEach((d,e)=>{d===this&&u.delete(e)}),this.destroy())};return m}(n.WorkerHandle);const u=new Map;a.acquireDecoder=function(v=null){let m=
u.get(c.unwrap(v));m||(c.isSome(v)?(m=new l(h=>v.schedule(h)),u.set(v,m)):(m=new l,u.set(null,m)));++m.ref;return m};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/core/workers/WorkerHandle":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../arrayUtils ../handleUtils ../Logger ../maybe ../promiseUtils ./workers".split(" "),function(a,b,c,n,l,u,v,m){const h=l.getLogger("esri.core.workers.WorkerHandle");l=function(){function d(g,p,
t,q,k={}){this._mainMethod=p;this._transferLists=t;this._listeners=[];this._promise=m.open(g,{...k,schedule:q}).then(r=>{if(void 0===this._thread){this._thread=r;this._promise=null;k.hasInitialize&&this.broadcast({},"initialize");for(const y of this._listeners)this._connectListener(y)}else r.close()});this._promise.catch(r=>h.error(`Failed to initialize ${g} worker: ${r}`))}var e=d.prototype;e.on=function(g,p){const t={removed:!1,eventName:g,callback:p,threadHandle:null};this._listeners.push(t);this._connectListener(t);
return n.makeHandle(()=>{t.removed=!0;c.remove(this._listeners,t);this._thread&&u.isSome(t.threadHandle)&&t.threadHandle.remove()})};e.destroy=function(){this._thread&&(this._thread.close(),this._thread=null);this._promise=null};e.invoke=function(g,p){return this.invokeMethod(this._mainMethod,g,p)};e.invokeMethod=function(g,p,t){if(this._thread){var q=this._transferLists[g];q=q?q(p):[];return this._thread.invoke(g,p,{transferList:q,signal:t})}return this._promise?this._promise.then(()=>{v.throwIfAborted(t);
return this.invokeMethod(g,p,t)}):Promise.reject(null)};e.broadcast=function(g,p){return this._thread?Promise.all(this._thread.broadcast(p,g)).then(()=>{}):this._promise?this._promise.then(()=>this.broadcast(g,p)):Promise.reject()};e._connectListener=function(g){this._thread&&this._thread.on(g.eventName,g.callback).then(p=>{g.removed||(g.threadHandle=p)})};b._createClass(d,[{key:"promise",get:function(){return this._promise}}]);return d}();a.WorkerHandle=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTile":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/mat3 ../../../../chunks/mat3f32 ./enums ./RenderBucket ./decluttering/config ../webgl/TiledDisplayObject".split(" "),function(a,b,c,n,l,u,v,m,h){h=function(e){function g(t,q,k,r,y,f,w=null){q=e.call(this,t,q,k,r,y,4096,4096)||this;q._memCache=w;q.type="vector-tile";q._referenced=0;q._hasSymbolBuckets=
!1;q._memoryUsedByLayerData=0;q.layerData=new Map;q.layerCount=0;q.status="loading";q.allSymbolsFadingOut=!1;q.lastOpacityUpdate=0;q.symbols=new Map;q.isCoverage=!1;q.neededForCoverage=!1;q.decluttered=!1;q.invalidating=!1;q.parentTile=null;q.childrenTiles=new Set;q._processed=!1;q._referenced=1;q.styleRepository=f;q.id=t.id;return q}b._inheritsLoose(g,e);var p=g.prototype;p.setData=function(t){this.changeDataImpl(t);this.requestRender();this.ready();this.invalidating=!1;this._processed=!0};p.deleteLayerData=
function(t){let q=!1;for(const k of t)this.layerData.has(k)&&(t=this.layerData.get(k),this._memoryUsedByLayerData-=t.memoryUsed,t.type===u.BucketType.SYMBOL&&this.symbols.has(k)&&(this.symbols.delete(k),q=!0),t.destroy(),this.layerData.delete(k),this.layerCount--);c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData);q&&this.emit("symbols-changed");this.requestRender()};p.processed=function(){return this._processed};p.hasData=function(){return 0<this.layerCount};
p.dispose=function(){"unloaded"!==this.status&&(d.delete(this),g._destroyRenderBuckets(this.layerData),this.layerData=null,this._memoryUsedByLayerData=this.layerCount=0,this.destroy(),this.status="unloaded")};p.release=function(){return 0===--this._referenced?(this.dispose(),this.stage=null,!0):!1};p.retain=function(){++this._referenced};p.changeDataImpl=function(t){let q=!1;if(t){const {bucketsWithData:k,emptyBuckets:r}=t;t=this._createRenderBuckets(k);if(r&&0<r.byteLength){const y=new Uint32Array(r);
for(const f of y)this._deleteLayerData(f)}for(const [y,f]of t)this._deleteLayerData(y),f.type===u.BucketType.SYMBOL&&(this.symbols.set(y,f.symbols),q=!0),this._memoryUsedByLayerData+=f.memoryUsed,this.layerData.set(y,f),this.layerCount++;c.isSome(this._memCache)&&this._memCache.updateSize(this.key.id,this,this._memoryUsedByLayerData)}this._hasSymbolBuckets=!1;for(const [,k]of this.layerData)k.type===u.BucketType.SYMBOL&&(this._hasSymbolBuckets=!0);q&&this.emit("symbols-changed")};p.attachWithContext=
function(t){this.stage={context:t,trashDisplayObject(q){q.processDetach()},untrashDisplayObject(){return!1}}};p.setTransform=function(t,q){e.prototype.setTransform.call(this,t,q);var k=q/(t.resolution*t.pixelRatio);q=this.width/this.rangeX*k;k*=this.height/this.rangeY;const r=[0,0];t.toScreen(r,[this.x,this.y]);const y=this.transforms.tileUnitsToPixels;n.identity(y);n.translate(y,y,r);n.rotate(y,y,Math.PI*t.rotation/180);n.scale(y,y,[q,k,1])};p._createTransforms=function(){return{dvs:l.create(),tileMat3:l.create(),
tileUnitsToPixels:l.create()}};g._destroyRenderBuckets=function(t){if(t){var q=new Set;t.forEach(k=>{q.has(k)||(k.destroy(),q.add(k))});t.clear()}};p._createRenderBuckets=function(t){const q=new Map,k=new Map;for(const r of t){t=this._deserializeBucket(r,k);for(const y of t.layerUIDs)q.set(y,t)}return q};p._deserializeBucket=function(t,q){let k=q.get(t);if(k)return k;switch((new Uint32Array(t))[0]){case u.BucketType.FILL:k=new v.FillRenderBucket(t,this.styleRepository);break;case u.BucketType.LINE:k=
new v.LineRenderBucket(t,this.styleRepository);break;case u.BucketType.SYMBOL:k=new v.SymbolRenderBucket(t,this.styleRepository,this);break;case u.BucketType.CIRCLE:k=new v.CircleRenderBucket(t,this.styleRepository)}q.set(t,k);return k};p._deleteLayerData=function(t){if(this.layerData.has(t)){var q=this.layerData.get(t);this._memoryUsedByLayerData-=q.memoryUsed;q.destroy();this.layerData.delete(t);this.layerCount--}};b._createClass(g,[{key:"hasSymbolBuckets",get:function(){return this._hasSymbolBuckets}},
{key:"isFading",get:function(){return this._hasSymbolBuckets&&performance.now()-this.lastOpacityUpdate<m.FADE_DURATION}},{key:"isHoldingForFade",get:function(){return this._hasSymbolBuckets&&(!this.allSymbolsFadingOut||performance.now()-this.lastOpacityUpdate<m.FADE_DURATION)}},{key:"wasRequested",get:function(){return"errored"===this.status||"loaded"===this.status||"reloading"===this.status}},{key:"referenced",get:function(){return this._referenced}},{key:"memoryUsage",get:function(){return(this._memoryUsedByLayerData+
256)/(this._referenced||1)}}]);return g}(h.TiledDisplayObject);const d=new Map;a.VectorTile=h;a.printAllocations=function(){d.forEach((e,g)=>{console.log(`\n${g.key}:`);e[0].forEach(p=>console.log(p));console.log("\x3d\x3d\x3d\x3d\x3d\x3d\x3d\x3d");e[1].forEach(p=>console.log(p))})};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/mat3f32":function(){define(["exports"],function(a){function b(){const v=new Float32Array(9);v[0]=1;v[4]=1;v[8]=1;
return v}function c(v){const m=new Float32Array(9);m[0]=v[0];m[1]=v[1];m[2]=v[2];m[3]=v[3];m[4]=v[4];m[5]=v[5];m[6]=v[6];m[7]=v[7];m[8]=v[8];return m}function n(v,m,h,d,e,g,p,t,q){const k=new Float32Array(9);k[0]=v;k[1]=m;k[2]=h;k[3]=d;k[4]=e;k[5]=g;k[6]=p;k[7]=t;k[8]=q;return k}function l(v,m){return new Float32Array(v,m,9)}const u=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=
l;a.fromValues=n;a.mat3f32=u})},"esri/views/2d/engine/vectorTiles/enums":function(){define(["exports"],function(a){a.MemoryBufferType=void 0;(function(b){b[b.UNKNOWN=0]="UNKNOWN";b[b.FILL_VERTEX=1]="FILL_VERTEX";b[b.FILL_DD_VERTEX=2]="FILL_DD_VERTEX";b[b.FILL_INDEX=3]="FILL_INDEX";b[b.OUTLINE_VERTEX=4]="OUTLINE_VERTEX";b[b.OUTLINE_DD_VERTEX=5]="OUTLINE_DD_VERTEX";b[b.OUTLINE_INDEX=6]="OUTLINE_INDEX";b[b.LINE_VERTEX=7]="LINE_VERTEX";b[b.LINE_DD_VERTEX=8]="LINE_DD_VERTEX";b[b.LINE_INDEX=9]="LINE_INDEX";
b[b.ICON_VERTEX=10]="ICON_VERTEX";b[b.ICON_DD_VERTEX=11]="ICON_DD_VERTEX";b[b.ICON_INDEX=12]="ICON_INDEX";b[b.TEXT_VERTEX=13]="TEXT_VERTEX";b[b.TEXT_DD_VERTEX=14]="TEXT_DD_VERTEX";b[b.TEXT_INDEX=15]="TEXT_INDEX";b[b.CIRCLE_VERTEX=16]="CIRCLE_VERTEX";b[b.CIRCLE_INDEX=17]="CIRCLE_INDEX"})(a.MemoryBufferType||(a.MemoryBufferType={}));a.BucketType=void 0;(function(b){b[b.FILL=1]="FILL";b[b.LINE=2]="LINE";b[b.SYMBOL=3]="SYMBOL";b[b.CIRCLE=4]="CIRCLE"})(a.BucketType||(a.BucketType={}));a.DrawPhase=void 0;
(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.OPAQUE=1]="OPAQUE";b[b.TRANSLUCENT=2]="TRANSLUCENT";b[b.SYMBOLS=3]="SYMBOLS";b[b.HITTEST=4]="HITTEST"})(a.DrawPhase||(a.DrawPhase={}));a.ShaderProgramType=void 0;(function(b){b[b.BACKGROUND=0]="BACKGROUND";b[b.FILL=1]="FILL";b[b.OUTLINE=2]="OUTLINE";b[b.LINE=3]="LINE";b[b.ICON=4]="ICON";b[b.CIRCLE=5]="CIRCLE";b[b.TEXT=6]="TEXT";b[b.TILEINFO=7]="TILEINFO"})(a.ShaderProgramType||(a.ShaderProgramType={}));a.StyleUpdateType=void 0;(function(b){b[b.PAINTER_CHANGED=
0]="PAINTER_CHANGED";b[b.LAYOUT_CHANGED=1]="LAYOUT_CHANGED";b[b.LAYER_CHANGED=2]="LAYER_CHANGED";b[b.LAYER_REMOVED=3]="LAYER_REMOVED";b[b.SPRITES_CHANGED=4]="SPRITES_CHANGED"})(a.StyleUpdateType||(a.StyleUpdateType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/RenderBucket":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./enums ./decluttering/util ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m){let h=function(){function t(k,r){this.layerUIDs=[];this.isDestroyed=!1;this.data=k;this.memoryUsed=k.byteLength;let y=1;k=new Uint32Array(k);this.layerUIDs=[];const f=k[y++];for(let w=0;w<f;w++)this.layerUIDs[w]=k[y++];this.bufferDataOffset=y;r&&(this.layer=r.getStyleLayerByUID(this.layerUIDs[0]))}var q=t.prototype;q.destroy=function(){this.isDestroyed||(this.doDestroy(),this.isDestroyed=!0)};q.prepareForRendering=function(k){c.isNone(this.data)||(this.doPrepareForRendering(k,
this.data,this.bufferDataOffset),this.data=null)};b._createClass(t,[{key:"isPreparedForRendering",get:function(){return c.isNone(this.data)}},{key:"offset",get:function(){return this.bufferDataOffset}}]);return t}(),d=function(t){function q(r,y){y=t.call(this,r,y)||this;y.type=n.BucketType.LINE;y.lineIndexStart=0;y.lineIndexCount=0;r=new Uint32Array(r);let f=y.bufferDataOffset;y.lineIndexStart=r[f++];y.lineIndexCount=r[f++];const w=r[f++];if(0<w){const z=new Map;for(let A=0;A<w;A++){const x=r[f++],
B=r[f++],C=r[f++];z.set(x,[B,C])}y.patternMap=z}y.bufferDataOffset=f;return y}b._inheritsLoose(q,t);var k=q.prototype;k.hasData=function(){return 0<this.lineIndexCount};k.triangleCount=function(){return this.lineIndexCount/3};k.doDestroy=function(){c.isSome(this.lineVertexArrayObject)&&this.lineVertexArrayObject.dispose();c.isSome(this.lineVertexBuffer)&&this.lineVertexBuffer.dispose();c.isSome(this.lineIndexBuffer)&&this.lineIndexBuffer.dispose();this.lineIndexBuffer=this.lineVertexBuffer=this.lineVertexArrayObject=
null;this.memoryUsed=0};k.doPrepareForRendering=function(r,y,f){y=new Uint32Array(y);var w=new Int32Array(y.buffer);const z=y[f++];this.lineVertexBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*f,z));f+=z;w=y[f++];this.lineIndexBuffer=u.BufferObject.createIndex(r,v.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*f,w));f+=w;f=this.layer.lineMaterial;this.lineVertexArrayObject=new m.VertexArrayObject(r,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.lineVertexBuffer},
this.lineIndexBuffer)};return q}(h),e=function(t){function q(r,y){y=t.call(this,r,y)||this;y.type=n.BucketType.FILL;y.fillIndexStart=0;y.fillIndexCount=0;y.outlineIndexStart=0;y.outlineIndexCount=0;r=new Uint32Array(r);let f=y.bufferDataOffset;y.fillIndexStart=r[f++];y.fillIndexCount=r[f++];y.outlineIndexStart=r[f++];y.outlineIndexCount=r[f++];const w=r[f++];if(0<w){const z=new Map;for(let A=0;A<w;A++){const x=r[f++],B=r[f++],C=r[f++];z.set(x,[B,C])}y.patternMap=z}y.bufferDataOffset=f;return y}b._inheritsLoose(q,
t);var k=q.prototype;k.hasData=function(){return 0<this.fillIndexCount||0<this.outlineIndexCount};k.triangleCount=function(){return(this.fillIndexCount+this.outlineIndexCount)/3};k.doDestroy=function(){c.isSome(this.fillVertexArrayObject)&&this.fillVertexArrayObject.dispose();c.isSome(this.fillVertexBuffer)&&this.fillVertexBuffer.dispose();c.isSome(this.fillIndexBuffer)&&this.fillIndexBuffer.dispose();this.fillIndexBuffer=this.fillVertexBuffer=this.fillVertexArrayObject=null;c.isSome(this.outlineVertexArrayObject)&&
this.outlineVertexArrayObject.dispose();c.isSome(this.outlineVertexBuffer)&&this.outlineVertexBuffer.dispose();c.isSome(this.outlineIndexBuffer)&&this.outlineIndexBuffer.dispose();this.outlineIndexBuffer=this.outlineVertexBuffer=this.outlineVertexArrayObject=null;this.memoryUsed=0};k.doPrepareForRendering=function(r,y,f){y=new Uint32Array(y);var w=new Int32Array(y.buffer),z=y[f++];this.fillVertexBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*f,z));f+=z;z=y[f++];
this.fillIndexBuffer=u.BufferObject.createIndex(r,v.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*f,z));f+=z;z=y[f++];this.outlineVertexBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*f,z));f+=z;w=y[f++];this.outlineIndexBuffer=u.BufferObject.createIndex(r,v.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*f,w));f+=w;y=this.layer;f=y.fillMaterial;y=y.outlineMaterial;this.fillVertexArrayObject=new m.VertexArrayObject(r,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.fillVertexBuffer},
this.fillIndexBuffer);this.outlineVertexArrayObject=new m.VertexArrayObject(r,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.outlineVertexBuffer},this.outlineIndexBuffer)};return q}(h),g=function(t){function q(r,y,f){y=t.call(this,r,y)||this;y.type=n.BucketType.SYMBOL;y.iconPerPageElementsMap=new Map;y.glyphPerPageElementsMap=new Map;y.symbolInstances=[];y.isIconSDF=!1;y.opacityChanged=!1;y.lastOpacityUpdate=0;y.symbols=[];const w=new Uint32Array(r),z=new Int32Array(r);r=new Float32Array(r);
let A=y.bufferDataOffset;y.isIconSDF=!!w[A++];var x=w[A++];for(var B=0;B<x;B++){var C=w[A++],D=w[A++],E=w[A++];y.iconPerPageElementsMap.set(C,[D,E])}x=w[A++];for(B=0;B<x;B++)C=w[A++],D=w[A++],E=w[A++],y.glyphPerPageElementsMap.set(C,[D,E]);x=w[A++];B=w[A++];y.iconOpacity=new Int32Array(x);y.textOpacity=new Int32Array(B);A=l.deserializeSymbols(w,z,r,A,y.symbols,f);y.bufferDataOffset=A;return y}b._inheritsLoose(q,t);var k=q.prototype;k.hasData=function(){return 0<this.iconPerPageElementsMap.size||0<
this.glyphPerPageElementsMap.size};k.triangleCount=function(){let r=0;for(const [,y]of this.iconPerPageElementsMap)r+=y[1];for(const [,y]of this.glyphPerPageElementsMap)r+=y[1];return r/3};k.doDestroy=function(){c.isSome(this.iconVertexArrayObject)&&this.iconVertexArrayObject.dispose();c.isSome(this.iconVertexBuffer)&&this.iconVertexBuffer.dispose();c.isSome(this.iconOpacityBuffer)&&this.iconOpacityBuffer.dispose();c.isSome(this.iconIndexBuffer)&&this.iconIndexBuffer.dispose();this.iconIndexBuffer=
this.iconOpacityBuffer=this.iconVertexBuffer=this.iconVertexArrayObject=null;c.isSome(this.textVertexArrayObject)&&this.textVertexArrayObject.dispose();c.isSome(this.textVertexBuffer)&&this.textVertexBuffer.dispose();c.isSome(this.textOpacityBuffer)&&this.textOpacityBuffer.dispose();c.isSome(this.textIndexBuffer)&&this.textIndexBuffer.dispose();this.textIndexBuffer=this.textOpacityBuffer=this.textVertexBuffer=this.textVertexArrayObject=null;this.memoryUsed=0};k.updateOpacityInfo=function(){if(this.opacityChanged){this.opacityChanged=
!1;var r=c.unwrap(this.iconOpacity),y=c.unwrap(this.iconOpacityBuffer);0<r.length&&r.byteLength===y.size&&y.setSubData(r);r=c.unwrap(this.textOpacity);y=c.unwrap(this.textOpacityBuffer);0<r.length&&r.byteLength===y.size&&y.setSubData(r)}};k.doPrepareForRendering=function(r,y,f){y=new Uint32Array(y);var w=new Int32Array(y.buffer),z=y[f++];this.iconVertexBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*f,z));f+=z;z=y[f++];this.iconIndexBuffer=u.BufferObject.createIndex(r,
v.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*f,z));f+=z;z=y[f++];this.textVertexBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*f,z));f+=z;w=y[f++];this.textIndexBuffer=u.BufferObject.createIndex(r,v.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*f,w));f+=w;this.iconOpacityBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,c.unwrap(this.iconOpacity).buffer);this.textOpacityBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,c.unwrap(this.textOpacity).buffer);
y=this.layer;f=y.iconMaterial;y=y.textMaterial;this.iconVertexArrayObject=new m.VertexArrayObject(r,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.iconVertexBuffer,opacity:this.iconOpacityBuffer},this.iconIndexBuffer);this.textVertexArrayObject=new m.VertexArrayObject(r,y.getAttributeLocations(),y.getLayoutInfo(),{geometry:this.textVertexBuffer,opacity:this.textOpacityBuffer},this.textIndexBuffer)};return q}(h),p=function(t){function q(r,y){y=t.call(this,r,y)||this;y.type=n.BucketType.CIRCLE;
y.circleIndexStart=0;y.circleIndexCount=0;r=new Uint32Array(r);let f=y.bufferDataOffset;y.circleIndexStart=r[f++];y.circleIndexCount=r[f++];y.bufferDataOffset=f;return y}b._inheritsLoose(q,t);var k=q.prototype;k.hasData=function(){return 0<this.circleIndexCount};k.triangleCount=function(){return this.circleIndexCount/3};k.doDestroy=function(){c.isSome(this.circleVertexArrayObject)&&this.circleVertexArrayObject.dispose();c.isSome(this.circleVertexBuffer)&&this.circleVertexBuffer.dispose();c.isSome(this.circleIndexBuffer)&&
this.circleIndexBuffer.dispose();this.circleIndexBuffer=this.circleVertexBuffer=this.circleVertexArrayObject=null;this.memoryUsed=0};k.doPrepareForRendering=function(r,y,f){y=new Uint32Array(y);var w=new Int32Array(y.buffer);const z=y[f++];this.circleVertexBuffer=u.BufferObject.createVertex(r,v.Usage.STATIC_DRAW,new Int32Array(w.buffer,4*f,z));f+=z;w=y[f++];this.circleIndexBuffer=u.BufferObject.createIndex(r,v.Usage.STATIC_DRAW,new Uint32Array(y.buffer,4*f,w));f+=w;f=this.layer.circleMaterial;this.circleVertexArrayObject=
new m.VertexArrayObject(r,f.getAttributeLocations(),f.getLayoutInfo(),{geometry:this.circleVertexBuffer},this.circleIndexBuffer)};return q}(h);a.CircleRenderBucket=p;a.FillRenderBucket=e;a.LineRenderBucket=d;a.RenderBucketBase=h;a.SymbolRenderBucket=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/util":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe",
"../enums","./core"],function(a,b,c,n,l){let u=function(d){this.tile=d;this.parent=null;this.children=new Set},v=function(){function d(){this.nodes=new Map;this.roots=new Set}var e=d.prototype;e.create=function(g){const p=new u(g);let t;const q=[];this.nodes.forEach(k=>{this._canConnectDirectly(p,k)&&q.push(k);!t&&this._canConnectDirectly(k,p)&&(t=k)});if(t){for(const k of q)t.children.delete(k),p.children.add(k),k.parent=p;t.children.add(p);p.parent=t}else{this.roots.add(p);for(const k of q)p.children.add(k),
k.parent=p,this.roots.delete(k)}this.nodes.set(g.key.id,p);return p};e.destroy=function(g){c.isSome(g.parent)?(g.parent.children.delete(g),g.children.forEach(p=>{c.isSome(g.parent)&&g.parent.children.add(p)})):this.roots.delete(g);g.children.forEach(p=>{(p.parent=g.parent)||this.roots.add(p)});this.nodes.delete(g.tile.key.id)};e.clear=function(){this.roots.clear();this.nodes.clear()};e._canConnectDirectly=function(g,p){let {level:t,row:q,col:k}=p.tile.key;for({world:p}=p.tile.key;0<t;){t--;q>>=1;
k>>=1;if(g.tile.key.level===t&&g.tile.key.row===q&&g.tile.key.col===k&&g.tile.key.world===p)return!0;if(this.nodes.has(`${t}/${q}/${k}/${p}`))break}return!1};return d}(),m=function(){function d(){this._tileGraph=new v;this._tileArray=null}var e=d.prototype;e.has=function(g){return"string"===typeof g?this._tileGraph.nodes.has(g):this._tileGraph.nodes.has(g.key.id)};e.getAll=function(){this._tileArray||(this._tileArray=[],this._tileGraph.nodes.forEach(g=>{this._tileArray.push(g.tile)}));return this._tileArray};
e.getRoots=function(){const g=[];this._tileGraph.roots.forEach(p=>{g.push(p.tile)});return g};e.getParent=function(g){g=this._tileGraph.nodes.get("string"===typeof g?g:g.key.id);return c.isSome(g.parent)&&g.parent.tile};e.getChildren=function(g){const p=[];this._tileGraph.nodes.get("string"===typeof g?g:g.key.id).children.forEach(t=>{p.push(t.tile)});return p};e.get=function(g){return this._tileGraph.nodes.get(g).tile};e.removeKey=function(g){g=this._tileGraph.nodes.get(g);this._tileGraph.destroy(g);
this._tileArray=null};e.forEach=function(g){this._tileGraph.nodes.forEach((p,t)=>g(p.tile,t))};e.add=function(g){this._tileGraph.create(g);this._tileArray=null};e.remove=function(g){g=this._tileGraph.nodes.get(g.key.id);this._tileGraph.destroy(g);this._tileArray=null};e.clear=function(){this._tileGraph.clear();this._tileArray=[]};return d}(),h=function(){function d(g,p,t){this._rows=Math.ceil(p/t);this._columns=Math.ceil(g/t);this._cellSize=t;this.cells=Array(this._rows);for(g=0;g<this._rows;g++)for(this.cells[g]=
Array(this._columns),p=0;p<this._columns;p++)this.cells[g][p]=[]}var e=d.prototype;e.getCell=function(g,p){p=Math.min(Math.max(Math.floor(p/this._cellSize),0),this._rows-1);g=Math.min(Math.max(Math.floor(g/this._cellSize),0),this._columns-1);return this.cells[p]&&this.cells[p][g]||null};e.getCellSpan=function(g,p,t,q){return[Math.min(Math.max(Math.floor(g/this._cellSize),0),this.columns-1),Math.min(Math.max(Math.floor(p/this._cellSize),0),this.rows-1),Math.min(Math.max(Math.floor(t/this._cellSize),
0),this.columns-1),Math.min(Math.max(Math.floor(q/this._cellSize),0),this.rows-1)]};b._createClass(d,[{key:"cellSize",get:function(){return this._cellSize}},{key:"columns",get:function(){return this._columns}},{key:"rows",get:function(){return this._rows}}]);return d}();a.GridIndex=h;a.TileForest=m;a.TileGraph=v;a.TileNode=u;a.deserializeSymbols=function(d,e,g,p,t,q){const k=e[p++];for(let f=0;f<k;f++){const w=new l.VTLSymbol(q);w.xTile=e[p++];w.yTile=e[p++];w.hash=e[p++];w.priority=e[p++];var r=
e[p++];for(var y=0;y<r;y++){const z=e[p++],A=e[p++],x=e[p++],B=e[p++],C=!!e[p++],D=e[p++],E=g[p++],F=g[p++],G=e[p++],O=e[p++];w.colliders.push({xTile:z,yTile:A,dxPixels:x,dyPixels:B,hard:C,partIndex:D,width:G,height:O,minLod:E,maxLod:F})}r=d[p++];for(y=0;y<r;y++)w.textVertexRanges.push([d[p++],d[p++]]);r=d[p++];for(y=0;y<r;y++)w.iconVertexRanges.push([d[p++],d[p++]]);t.push(w)}return p};a.tileCoordChange=function(d,e,g,p,t,q){g-=t;if(0<=g)return(e>>g)+(p-(q<<g))*(d>>g);g=-g;return e-(q-(p<<g))*(d>>
g)<<g};a.writeOpacityToBuffers=function(d,e,g){for(const [f,w]of d.symbols){{var p=d,t=e,q=g,k=w;const z=p.layerData.get(f);if(z.type===n.BucketType.SYMBOL){for(const A of k){k=A.unique;var r=void 0;if(A.selectedForRendering){var y=k.parts[0];r=y.startOpacity;y=y.targetOpacity;p.allSymbolsFadingOut=p.allSymbolsFadingOut&&0===y;r=q?Math.floor(127*r)|y<<7:y?255:0;r|=r<<24|r<<16|r<<8}else r=0;for(const [x,B]of A.iconVertexRanges)for(y=x;y<x+B;y+=4)z.iconOpacity[y/4]=r;A.selectedForRendering?(r=k.parts[1],
k=r.startOpacity,r=r.targetOpacity,p.allSymbolsFadingOut=p.allSymbolsFadingOut&&0===r,k=q?Math.floor(127*k)|r<<7:r?255:0,r=k<<24|k<<16|k<<8|k):r=0;for(const [x,B]of A.textVertexRanges)for(k=x;k<x+B;k+=4)z.textOpacity[k/4]=r}z.lastOpacityUpdate=t;z.opacityChanged=!0}}}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/core":function(){define(["exports"],function(a){a.VTLSymbol=function(b){this.hash=this.yTile=
this.xTile=0;this.priority=1;this.colliders=[];this.textVertexRanges=[];this.iconVertexRanges=[];this.tile=b};a.VTLUniqueSymbol=function(){this.tileSymbols=[];this.parts=[{startTime:0,startOpacity:0,targetOpacity:0,show:!1},{startTime:0,startOpacity:0,targetOpacity:0,show:!1}];this.show=!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/decluttering/config":function(){define(["exports"],function(a){a.COLLISION_GRID_CELL_SIZE=
32;a.DECLUTTER_BUDGET=1.5;a.DECLUTTER_TILES=!0;a.FADE_DURATION=200;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/TiledDisplayObject":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/mat3","../DisplayObject","../../tiling/TileKey"],function(a,b,c,n,l){n=function(u){function v(h,d,e,g,p,t=g,q=p){var k=u.call(this)||this;k.triangleCountReportedInDebug=0;k.triangleCount=0;k.texture=
null;k.key=new l(h);k.x=d;k.y=e;k.width=g;k.height=p;k.rangeX=t;k.rangeY=q;return k}b._inheritsLoose(v,u);var m=v.prototype;m.destroy=function(){this.texture&&(this.texture.dispose(),this.texture=null)};m.setTransform=function(h,d){d/=h.resolution*h.pixelRatio;const e=this.transforms.tileMat3,[g,p]=h.toScreenNoRotation([0,0],[this.x,this.y]);c.set(e,this.width/this.rangeX*d,0,0,0,this.height/this.rangeY*d,0,g,p,1);c.multiply(this.transforms.dvs,h.displayViewMat3,e)};return v}(n.DisplayObject);a.TiledDisplayObject=
n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/DisplayObject":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Evented ../../../core/has ../../../core/maybe ../../../core/promiseUtils".split(" "),function(a,b,c,n,l,u){const v=1/n("mapview-transitions-duration");c=function(m){function h(){var e=m.apply(this,arguments)||this;e._fadeOutResolver=null;e._fadeInResolver=null;e._clips=null;e.computedVisible=
!0;e.computedOpacity=1;e.fadeTransitionEnabled=!1;e.inFadeTransition=!1;e._isReady=!1;e._opacity=1;e._stage=null;e._visible=!0;return e}b._inheritsLoose(h,m);var d=h.prototype;d._getTransforms=function(){l.isNone(this._transforms)&&(this._transforms=this._createTransforms());return this._transforms};d.fadeIn=function(){if(this._fadeInResolver)return this._fadeInResolver.promise;this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.computedOpacity=0;this.fadeTransitionEnabled=
!0;this._fadeInResolver=u.createResolver();this.requestRender();return this._fadeInResolver.promise};d.fadeOut=function(){if(this._fadeOutResolver)return this._fadeOutResolver.promise;this._fadeInResolver&&(this._fadeInResolver(),this._fadeInResolver=null);this.fadeTransitionEnabled=!0;this._fadeOutResolver=u.createResolver();this.requestRender();return this._fadeOutResolver.promise};d.beforeRender=function(e){this.updateTransitionProperties(e.deltaTime,e.state.scale)};d.afterRender=function(e){this._fadeInResolver&&
this.computedOpacity===this.opacity?(this._fadeInResolver(),this._fadeInResolver=null):this._fadeOutResolver&&0===this.computedOpacity&&(this._fadeOutResolver(),this._fadeOutResolver=null)};d.remove=function(){var e;null==(e=this.parent)?void 0:e.removeChild(this)};d.setTransform=function(e){};d.processRender=function(e){this.stage&&this.computedVisible&&this.doRender(e)};d.requestRender=function(){this.stage&&this.stage.requestRender()};d.processDetach=function(){this._fadeInResolver&&(this._fadeInResolver(),
this._fadeInResolver=null);this._fadeOutResolver&&(this._fadeOutResolver(),this._fadeOutResolver=null);this.onDetach();this.emit("detach")};d.updateTransitionProperties=function(e,g){if(this.fadeTransitionEnabled){g=this._fadeOutResolver||!this.visible?0:this.opacity;const p=this.computedOpacity;p===g?this.computedVisible=this.visible:(e*=v,this.computedOpacity=p>g?Math.max(g,p-e):Math.min(g,p+e),this.computedVisible=0<this.computedOpacity,e=g===this.computedOpacity,this.inFadeTransition=!e,e||this.requestRender())}else this.computedOpacity=
this.opacity,this.computedVisible=this.visible};d.onAttach=function(){};d.onDetach=function(){};d.doRender=function(e){};d.ready=function(){this._isReady||(this._isReady=!0,this.emit("isReady"),this.requestRender())};b._createClass(h,[{key:"clips",get:function(){return this._clips},set:function(e){this._clips=e;this.requestRender()}},{key:"isReady",get:function(){return this._isReady}},{key:"opacity",get:function(){return this._opacity},set:function(e){this._opacity!==e&&(this._opacity=Math.min(1,
Math.max(e,0)),this.requestRender())}},{key:"stage",get:function(){return this._stage},set:function(e){if(this._stage!==e){var g=this._stage;(this._stage=e)?this._stage.untrashDisplayObject(this)||(this.onAttach(),this.emit("attach")):g.trashDisplayObject(this)}}},{key:"transforms",get:function(){return this._getTransforms()}},{key:"visible",get:function(){return this._visible},set:function(e){this._visible!==e&&(this._visible=e,this.requestRender())}}]);return h}(c);a.DisplayObject=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/tiling/TileKey":function(){define(["../../../chunks/_rollupPluginBabelHelpers","../../../core/ObjectPool"],function(a,b){let c=function(){function n(u,v,m,h){this.set(u,v,m,h)}n.getId=function(u,v,m,h){return"object"===typeof u?`${u.level}/${u.row}/${u.col}/${u.world}`:`${u}/${v}/${m}/${h}`};var l=n.prototype;l.acquire=function(u,v,m,h){this.set(u,v,m,h)};l.contains=function(u){const v=u.level-this.level;return this.row===
u.row>>v&&this.col===u.col>>v&&this.world===u.world};l.equals=function(u){return this.level===u.level&&this.row===u.row&&this.col===u.col&&this.world===u.world};l.clone=function(){return new n(this)};l.release=function(){this.world=this.col=this.row=this.level=0};l.set=function(u,v,m,h){if(null==u)this.world=this.col=this.row=this.level=0;else if("object"===typeof u)this.level=u.level||0,this.row=u.row||0,this.col=u.col||0,this.world=u.world||0;else if("string"===typeof u){const [d,e,g,p]=u.split("/");
this.level=parseFloat(d);this.row=parseFloat(e);this.col=parseFloat(g);this.world=parseFloat(p)}else this.level=+u,this.row=+v,this.col=+m,this.world=+h||0;return this};l.toString=function(){return`${this.level}/${this.row}/${this.col}/${this.world}`};l.getParentKey=function(){return 0>=this.level?null:new n(this.level-1,this.row>>1,this.col>>1,this.world)};l.getChildKeys=function(){const u=this.level+1,v=this.row<<1,m=this.col<<1,h=this.world;return[new n(u,v,m,h),new n(u,v,m+1,h),new n(u,v+1,m,
h),new n(u,v+1,m+1,h)]};l.compareRowMajor=function(u){return this.row<u.row?-1:this.row>u.row?1:this.col<u.col?-1:this.col>u.col?1:0};a._createClass(n,[{key:"key",get:function(){return this}},{key:"id",get:function(){return this.toString()},set:function(u){this.set(u)}},{key:"hash",get:function(){return(this.world&3)<<30|(this.col&4095)<<22|(this.row&4095)<<8|this.level&63}}]);return n}();c.pool=new b(c,null,null,25,50);return c})},"esri/views/3d/support/updatingProperties":function(){define(["exports"],
function(a){a.updatingProgress={readOnly:!0,value:.5,get(){return this.updating?this.updatingProgressValue:1}};a.updatingProgressValue={value:.5,readOnly:!0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ElevationBounds":function(){define(["exports"],function(a){let b=function(){function c(n=0,l=0){this.min=n;this.max=l;this.level=0;this.hasNoDataValues=!1}c.prototype.copyFrom=function(n){this.min=n.min;this.max=n.max;this.level=
n.level;this.hasNoDataValues=n.hasNoDataValues};return c}();a.ElevationBounds=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ElevationData":function(){define(["exports","../../../core/mathUtils","../../../core/maybe","../support/mathUtils","./TerrainConst"],function(a,b,c,n,l){function u(m,h,d){if(c.isNone(d))return null;for(const q of d){if(!q)continue;var e=q.safeWidth;d=b.clamp(q.dy*(q.y1-h),0,e);e=b.clamp(q.dx*(m-q.x0),0,e);
const k=Math.floor(d),r=Math.floor(e);var g=q.width,p=k*g+r,t=q.pixelData;const y=t[p],f=t[p+1];p+=g;g=t[p];t=t[p+1];if(y+g+f+t<.5*l.ELEVATION_NODATA_VALUE)return d-=k,e-=r,m=y+(f-y)*e,m+(g+(t-g)*e-m)*d}return null}let v=function(){function m(d,e,g){this.type="elevation";this.samplerData=null;this.level=d[0];this.i=d[1];this.j=d[2];this.extent=e;d=g.noDataValue;const p=g.values;let t=Infinity,q=-Infinity,k=!0,r=!1;for(let y=0;y<p.length;y++){const f=p[y];f!==d?(t=f<t?f:t,q=f>q?f:q,k=!1):r=!0}k&&(q=
t=0);this.samplerData={pixelData:g.values,width:g.width,height:g.height,noDataValue:d,safeWidth:.99999999*(g.width-1),dx:(g.width-1)/(e[2]-e[0]),dy:(g.width-1)/(e[3]-e[1]),x0:e[0],y1:e[3]};this.bounds=[t,-3E38<q?q:0];this.hasNoDataValues=r}var h=m.prototype;h.release=function(){this.bounds=this.samplerData=null};h.computeMinMaxValue=function(d,e,g,p){p.min=Infinity;p.max=-Infinity;p.hasNoDataValues=!1;d-=this.level;if(0>=d)return p;var t=2**d;if(Math.floor(e/t)!==this.i||Math.floor(g/t)!==this.j)return p;
var q=Infinity,k=-Infinity,r=this.samplerData.width,y=this.samplerData.pixelData,f=.5*l.ELEVATION_NODATA_VALUE;d=(r-1)/t;g=(g-this.j*t)*d;let w=(e-this.i*t)*d;if(1>d){const x=Math.floor(g),B=Math.floor(w);var z=x+B*r;e=y[z];t=y[z+1];var A=y[z+r];z=y[z+r+1];if(e+t+A+z<f)return q=g-x,f=w-B,k=n.bilerp(e,t,A,z,q,f),r=n.bilerp(e,t,A,z,q+d,f),y=n.bilerp(e,t,A,z,q,f+d),d=n.bilerp(e,t,A,z,q+d,f+d),p.min=Math.min(k,r,y,d),p.max=Math.max(k,r,y,d),p;g=x;w=B;d=1}else g=Math.floor(g),w=Math.floor(w),d=Math.ceil(d);
for(e=g;e<=g+d;e++)for(t=w;t<=w+d;t++)A=y[e+t*r],A<f?(q=Math.min(q,A),k=Math.max(k,A)):p.hasNoDataValues=!0;p.min=q;p.max=k;return p};return m}();a.ElevationData=v;a.sampleElevation=u;a.sampleElevationOrZero=function(m,h,d){m=u(m,h,d);return c.isSome(m)?m:0};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/ExtentHelper":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../layers/support/layerUtils ../../ViewingMode ./TerrainConst ./terrainUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){function y(z,A){return u.isSome(z)&&!z.spatialReference.equals(A)?g.projectWithoutEngine(z,z.spatialReference,A):z}a.ExtentHelper=function(z){function A(B){B=z.call(this,B)||this;B._handles=new l;return B}b._inheritsLoose(A,z);var x=A.prototype;x.initialize=function(){this._handles.add([this.layerViews.on("change",()=>this.notifyChange("stencilEnabledExtents"))])};x.destroy=function(){this._handles.destroy();this._handles=null};x._computeStencilEnabledExtents=
function(){const B=[];this.layerViews.forEach(C=>{C=C.layer;"IntegratedMeshLayer"===C.operationalLayerType&&null!=this.viewSpatialReference&&(C=y(C.fullExtent,this.viewSpatialReference),u.isSome(C)&&B.push(p.fromExtent(C)))});return B};b._createClass(A,[{key:"layerViewsExtent",get:function(){return this._computeLayerViewsExtent()}},{key:"tiledLayersExtent",get:function(){return this._computeTiledLayersExtent()}},{key:"stencilEnabledExtents",get:function(){return this._computeStencilEnabledExtents()}}]);
return A}(n);c.__decorate([v.property({readOnly:!0})],a.ExtentHelper.prototype,"layerViewsExtent",null);c.__decorate([v.property({readOnly:!0})],a.ExtentHelper.prototype,"tiledLayersExtent",null);c.__decorate([v.property({readOnly:!0})],a.ExtentHelper.prototype,"stencilEnabledExtents",null);c.__decorate([v.property()],a.ExtentHelper.prototype,"viewSpatialReference",void 0);c.__decorate([v.property()],a.ExtentHelper.prototype,"tilingScheme",void 0);c.__decorate([v.property()],a.ExtentHelper.prototype,
"defaultTiledLayersExtent",void 0);c.__decorate([v.property({constructOnly:!0})],a.ExtentHelper.prototype,"layers",void 0);c.__decorate([v.property({constructOnly:!0})],a.ExtentHelper.prototype,"layerViews",void 0);a.ExtentHelper=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelper")],a.ExtentHelper);let f=function(z){function A(){return z.apply(this,arguments)||this}b._inheritsLoose(A,z);var x=A.prototype;x._computeLayerViewsExtent=function(){return this._globalExtent};x._computeTiledLayersExtent=
function(){return this._globalExtent};b._createClass(A,[{key:"_globalExtent",get:function(){return this.viewSpatialReference.isWebMercator?k.WEBMERCATOR_WORLD_EXTENT:k.GEOGRAPHIC_WORLD_EXTENT}}]);return A}(a.ExtentHelper);f=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperGlobal")],f);let w=function(z){function A(){return z.apply(this,arguments)||this}b._inheritsLoose(A,z);var x=A.prototype;x._computeLayerViewsExtent=function(){const B=p.empty(),C=this.viewSpatialReference;this.layerViews.forEach(F=>
{const G=F.layer;!F.isResolved()||"graphics"===G.type&&G.internal||(F=y("fullExtentInLocalViewSpatialReference"in F&&F.fullExtentInLocalViewSpatialReference||F.layer.fullExtent,C),p.expand(B,F,B))});const D=p.allFinite(B)?B:null,E=this._get("layerViewsExtent");return p.equals(D,E)?E:D};x._computeTiledLayersExtent=function(){const B=this.tilingScheme;if(!B)return null;const C=this.viewSpatialReference,D=p.empty();this.layers.forEach(G=>{if(G.loaded&&t.isTiledLayer(G)){const L=r.getTiledLayerInfo(G,
C,q.ViewingMode.Local);if(!u.isNone(L)){var {tileInfo:O,fullExtent:K}=L;u.isSome(O)&&u.isSome(K)&&(r.isProjectableRasterLayer(G)||B.compatibleWith(O)&&K.spatialReference.equals(B.spatialReference))&&p.expand(D,K,D)}}});p.expand(D,this.defaultTiledLayersExtent,D);const E=p.allFinite(D)?D:null,F=this._get("tiledLayersExtent");return p.equals(E,F)?F:E};return A}(a.ExtentHelper);w=c.__decorate([e.subclass("esri.views.3d.terrain.ExtentHelperLocal")],w);a.create=function(z,A){return z===q.ViewingMode.Global?
new f(A):new w(A)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/LayerClass":function(){define(["exports"],function(a){a.LayerClass=void 0;var b=a.LayerClass||(a.LayerClass={});b[b.ELEVATION=0]="ELEVATION";b[b.MAP=1]="MAP";a.LayerClasses=[a.LayerClass.ELEVATION,a.LayerClass.MAP];Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/OverlayManager":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Cyclical ../../../core/Handles ../../../core/has ../../../core/mathUtils ../../../core/maybe ../../../core/reactiveUtils ../../../core/scheduling ../../../core/time ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/vec2 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../geometry/support/ray ../../../chunks/sphere ../../../geometry/support/vector ../../../geometry/support/webMercatorUtils ../state/utils/viewUtils ../support/debugFlags ../support/debugUtils ./interfaces ./Overlay ./OverlayRenderer ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/Intersector ../webgl-engine/lib/LocalOriginFactory ../webgl-engine/lib/SortedRenderGeometryRenderer ../webgl-engine/parts/requireUtils ../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S){const T=[[-.1,-2,3.9,2],[-.1,-3.9,3.9,.1],[-2,-3.9,2,.1],[-3.9,-3.9,.1,.1],[-3.9,-2,.1,2],[-3.9,-.1,.1,3.9],[-2,-.1,2,3.9],[-.1,-.1,3.9,3.9]];let H;a.OverlayManager=function(ia){function ka(Z){Z=ia.call(this,Z)||this;Z._handles=new u;Z._spatialReference=null;Z._renderSR=null;Z._overlaySREqualsRenderSR=!0;Z._drapeSources=new Set;Z._drapeTargets=new Set;Z._placementDirty=!1;Z._contentUpdated=!1;Z._drawTexturesDirty=
!1;Z._drawTexturesAnimateDirty=!1;Z._hasUnusedRenderTargets=!1;Z._longitudeCyclical=null;Z._latestOriginId=0;Z._maxResolution=v("esri-mobile")?2048:4096;Z._animationTimeLast=0;return Z}b._inheritsLoose(ka,ia);var la=ka.prototype;la.initialize=function(){const Z=this.view;this.renderer=new M.OverlayRenderer({view:Z,worldToPCSRatio:this._worldToPCSRatio,spatialReference:this._spatialReference});this._groundIntersector=I.newIntersector(this.view.state.viewingMode);this._groundIntersector.options.backfacesTerrain=
!0;this._groundIntersector.options.invisibleTerrain=!0;this._groundIntersector.options.hud=!1;this._handles.add([this.renderer.events.on("has-highlights",()=>{this.setDrawTexturesDirty();this.notifyChange("hasHighlights")}),this.renderer.events.on("has-water",ca=>{var Y;return null==(Y=Z._stage)?void 0:Y.renderView.setRenderParameters({hasOverlayWater:ca})}),this.renderer.events.on("renders-occluded",()=>{this.setDrawTexturesDirty();this.notifyChange("rendersOccluded")}),this.renderer.events.on("content-changed",
()=>this.setDrawTexturesDirty()),this.renderer.events.on("textures-disposed",()=>this.updateOverlayResult()),d.watch(()=>{var ca,Y,da;return[null==(ca=Z.pointsOfInterest)?void 0:ca.renderPointOfView,null==(Y=Z.pointsOfInterest)?void 0:null==(da=Y.centerOnSurfaceFrequent)?void 0:da.location]},()=>this.setPlacementDirty()),d.watch(()=>{var ca;return null==(ca=Z.state)?void 0:ca.pixelRatio},()=>this.setPlacementDirty(),d.sync),this.surface.on("elevation-change",()=>this.setPlacementDirty()),Z.on("resize",
()=>this.setPlacementDirty()),e.addFrameTask({preRender:ca=>{this._contentUpdated=!1;this.renderer.processSyncDrapeSources();this.renderer.hasOverlays&&(this._dispatchAnimationUpdate(ca),this._drawOverlayTextures(this.renderer.overlays,J.RenderRequestType.UPDATE));this._hasUnusedRenderTargets&&this._collectUnusedRenderTargetMemory()}}),Z.resourceController.scheduler.registerTask(S.TaskPriority.OVERLAY,this),Z._stage.renderView.events.on("force-camera-for-screenshot",ca=>{this._updateOverlays(ca,J.RenderRequestType.BACKGROUND);
this.renderer.hasOverlays&&this._drawOverlayTextures(this.renderer.overlays,J.RenderRequestType.BACKGROUND,ca)})])};la.destroy=function(){this.renderer.dispose();this._handles&&(this._handles.destroy(),this._handles=null);h.isSome(H)&&(H.hide(),H=null)};la.setSpatialReference=function(Z){this._spatialReference=Z;this.renderer.spatialReference=Z;this._longitudeCyclical=null;const ca=this.view.renderSpatialReference;h.isSome(Z)&&h.isSome(ca)?(this._renderSR=ca,this._overlaySREqualsRenderSR=Z.equals(this._renderSR),
this._isSpherical&&(this._longitudeCyclical=Z.isWebMercator?new l.Cyclical(-2.0037508342787E7,2.0037508342787E7):new l.Cyclical(-180,180),this.renderer.longitudeCyclical=this._longitudeCyclical),this.renderer&&(this.renderer.worldToPCSRatio=this._worldToPCSRatio)):this.renderer.disposeOverlays()};la.registerDrapeSource=function(Z,ca,Y){this._drapeSources.add(Z);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources);ca=this.renderer.createDrapeSourceRenderer(Z,ca,Y);this._updateDrapeSourceExtent(Z);
this._setContentDirty();this.notifyChange("running");return ca};la.registerGeometryDrapeSource=function(Z){return this.registerDrapeSource(Z,N.SortedRenderGeometryRenderer)};la._updateDrapeSourceExtent=function(Z){2===this.renderer.overlays.length&&h.isSome(Z.setDrapingExtent)&&h.isSome(this._spatialReference)&&Z.setDrapingExtent(this.renderer.overlays,this._spatialReference)};la.unregisterDrapeSource=function(Z){this._drapeSources.has(Z)&&(this._drapeSources.delete(Z),this.renderer.removeDrapeSourceRenderer(Z),
this.renderer.ensureDrapeSources(this._drapeSources),this._setContentDirty(),this.notifyChange("running"))};la.registerDrapeTarget=function(Z){this._drapeTargets.add(Z);this.renderer.ensureOverlays(this._drapeTargets,this._drapeSources)};la.updateOverlayResult=function(){var Z;null==(Z=this.view._stage)?void 0:Z.renderView.setRenderParameters({overlays:this.renderer.overlays})};la.unregisterDrapeTarget=function(Z){this._drapeTargets.delete(Z);this.renderer.ensureDrapeTargets(this._drapeTargets)};
la._setContentDirty=function(){this.setPlacementDirty();this.setDrawTexturesDirty()};la.setPlacementDirty=function(){this._placementDirty=!0};la.runTask=function(){this._updateOverlays(this.view.state.camera,J.RenderRequestType.UPDATE)};la._updateOverlays=function(Z,ca){if(this._spatialReference){var Y=R.computeOverlayResolution(Z.fullWidth,Z.fullHeight,this._maxResolution);this._computeOverlayExtents(Z,Y,Q);var da=B.width(Q.inner)/B.width(Q.outer);this.renderer.ensureOverlays(this._drapeTargets,
this._drapeSources);Z=this._updateOverlay(L.OverlayIndex.INNER,Q.inner,Y,1*Q.pixelRatioAdjustment,Q.mapUnitsPerPixel);Y=this._updateOverlay(L.OverlayIndex.OUTER,Q.outer,Y,da*Q.pixelRatioAdjustment,Q.mapUnitsPerPixel);if(Z===ea.EXTENT||Y===ea.EXTENT)this._drapeSources.forEach(ha=>this._updateDrapeSourceExtent(ha)),this.surface.updateTileOverlayParams(ca);Z===ea.NONE&&Y===ea.NONE||this.setDrawTexturesDirty();this._placementDirty=!1}};la._updateOverlay=function(Z,ca,Y,da,ha){if(0===this.renderer.overlays.length)return ea.NONE;
Z=this.renderer.overlays[Z];const ja=Z.mapUnitsPerPixel;Z.mapUnitsPerPixel=ha;Z.pixelRatio=da;{da=Z.extent;const ma=O.TESTS_DISABLE_OPTIMIZATIONS?0:1E-5*Math.max(ca[2]-ca[0],ca[3]-ca[1],da[2]-da[0],da[3]-da[1]);da=Math.abs(da[0]-ca[0])<=ma&&Math.abs(da[1]-ca[1])<=ma&&Math.abs(da[2]-ca[2])<=ma&&Math.abs(da[3]-ca[3])<=ma}if(da&&Y===Z.resolution)return ja===ha?ea.NONE:ea.RERENDER_ONLY;B.copy(Z.extent,ca);Z.resolution=Y;ca=B.center(Z.extent);Z.renderLocalOrigin=P.fromValues(ca[0],ca[1],0,`OV_${this._latestOriginId++}`);
return ea.EXTENT};la.setTileParameters=function(Z){const ca=Z.renderData.overlay;if(0<this.renderer.overlays.length){const Y=this.renderer.overlays[L.OverlayIndex.INNER],da=this.renderer.overlays[L.OverlayIndex.OUTER];Z=B.intersection(Z.extent,this.surface.extent,X);this._rectInsideRect(Y.extent,Z)||this._rectanglesOverlap(Z,Y.extent)||this._rectanglesOverlap(Z,da.extent)?(this._setTileOverlayData(Z,L.OverlayIndex.INNER,ca),this._setTileOverlayData(Z,L.OverlayIndex.OUTER,ca)):(this._clearTileOverlayData(L.OverlayIndex.INNER,
ca),this._clearTileOverlayData(L.OverlayIndex.OUTER,ca))}else this._clearTileOverlayData(L.OverlayIndex.INNER,ca),this._clearTileOverlayData(L.OverlayIndex.OUTER,ca)};la.overlayPixelSizeInMapUnits=function(Z){if(0===this.renderer.overlays.length)return 0;const ca=this.renderer.overlays[L.OverlayIndex.INNER],Y=this.renderer.overlays[L.OverlayIndex.OUTER];Z=this._pointIsInExtent(Z,ca.extent)?ca:Y;return(Z.extent[2]-Z.extent[0])/Z.resolution};la._setTileOverlayData=function(Z,ca,Y){if(0!==this.renderer.overlays.length){var da=
this.renderer.overlays[ca].extent,ha=B.width(da),ja=B.height(da),ma=Z[0];if(this._longitudeCyclical){ma=this._longitudeCyclical.minimalMonotonic(da[0],ma);const pa=this._longitudeCyclical.minimalMonotonic(da[0],Z[2]);ma>pa&&(ma=pa-(Z[2]-Z[0]))}Y.setScale(ca,B.width(Z)/ha,B.height(Z)/ja);Y.setOffset(ca,(ma-da[0])/ha,(Z[1]-da[1])/ja)}};la._clearTileOverlayData=function(Z,ca){ca.setScale(Z,-1,-1);ca.setOffset(Z,-1,-1)};la.reloadShaders=function(){var Z=b._asyncToGenerator(function*(){V.removeLoadedShaderModules();
yield this.renderer.reloadShaders();this.setDrawTexturesDirty();this.runTask()});return function(){return Z.apply(this,arguments)}}();la._dispatchAnimationUpdate=function(Z){const ca=g.Milliseconds(Z.time-this._animationTimeLast);if(ca>=this.surface.view._stage.renderView.animationTimestep||h.isSome(this.forcedAnimationTime)||this._drawTexturesDirty||this._drawTexturesAnimateDirty)this.renderer.updateAnimation({dt:ca,forcedTime:this.forcedAnimationTime,camera:this.view.state.camera})&&(this._drawTexturesAnimateDirty=
!0),this._animationTimeLast=Z.time};la.setDrawTexturesDirty=function(){this.renderer.hasOverlays?this._drawTexturesDirty=this._contentUpdated=!0:this.setPlacementDirty()};la._intersectGroundFromView=function(Z,ca,Y,da){Y=this.view.sceneIntersectionHelper.getCenterRayWithSubpixelOffset(Z,aa,ca,Y);if(h.isNone(Y))return!1;ca=Y.origin;Y=y.add(W,Y.origin,Y.direction);this._groundIntersector.reset(ca,Y,Z);this._groundIntersector.intersect([],null);this.view.basemapTerrain.intersect(this._groundIntersector,
null,ca,Y);return this._groundIntersector.results.min.getIntersectionPoint(da)};la._findHorizonBasedPointOfInterest=function(Z,ca){var Y=.5;Y=this.view.renderCoordsHelper.getAltitude(Z.eye);const da=this.view.pointsOfInterest.centerOnSurfaceFrequent;var ha=m.clamp(da.estimatedSurfaceAltitude,Z.aboveGround?-Infinity:Y+1E-5,Z.aboveGround?Y-1E-5:Infinity);Y=Z.aboveGround;if("global"===this.view.viewingMode){var ja=W;D.closestPointOnSilhouette(D.fromRadius(D.tmpSphere,x.getReferenceEllipsoid(this.view.spatialReference).radius+
ha),C.wrap(Z.eye,Z.viewForward),ja);y.subtract(ja,ja,Z.eye);ha=l.cyclicalPI.normalize(E.angleAroundAxis(Z.viewForward,ja,Z.viewRight))/Z.fovY+.5;ja=0>=ha||1<=ha?.5:.55;Y=Y?ja*ha:ha+ja*(1-ha)}else ha=z.fromValues(0,Math.tan(.5*Math.PI-Math.acos(-Z.viewForward[2])),1,0),ha=w.transformMat4(ha,ha,Z.projectionMatrix)[1],ha=m.clamp(.5+.5*ha,0,1),Y=1===ha||0===ha?.5:Y?.55*ha:1-.55*(1-ha);return this._intersectGroundFromView(Z,.5,Y,ca)?y.sqrDist(ca,Z.eye)<da.distance*da.distance:!1};la._computeOverlayExtents=
function(Z,ca,Y){var da=this.view.pointsOfInterest.centerOnSurfaceFrequent.renderLocation,ha=f.create();this._findHorizonBasedPointOfInterest(Z,ha)||y.copy(ha,da);var ja=Math.max(.1,y.distance(Z.eye,ha));da=G.viewAngle(this.view.renderCoordsHelper,da,Z.eye);const ma=Math.PI/2-Math.abs(da-Math.PI/2);O.OVERLAY_SHOW_CENTER?(h.isNone(H)&&(H=new K.PointGraphics(this.view.graphics,"red")),H.show(ha,this._renderSR)):h.isSome(H)&&H.hide();this._overlaySREqualsRenderSR||A.projectVectorToVector(ha,this._renderSR,
ha,this._spatialReference);da=this.surface.extent;var pa=!this._isSpherical&&h.isSome(this._spatialReference)&&this._spatialReference.isGeographic,na=pa&&h.isSome(this._spatialReference)?1/x.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1;ja=Z.perRenderPixelRatio*ja*na;Y.mapUnitsPerPixel=ja/this._worldToPCSRatio;ja=ca*ja/2;var wa=!1;pa=pa?90:Infinity;this._isSpherical&&h.isSome(da)&&h.isSome(this._spatialReference)&&(this._spatialReference.isWebMercator?(ja/=Math.cos(F.y2lat(ha[1])),
pa=da[3]):(wa=!0,ja/=x.getReferenceEllipsoid(this._spatialReference).metersPerDegree,pa=90),ja>=pa&&(ja=pa,ha[1]=0,this._spatialReference.isWebMercator&&(ha[0]=0)));na=1;wa&&(na=1/Math.max(.2,Math.cos(Math.abs(m.deg2rad(ha[1])))),180<ja*na&&(na=180/ja),Y.mapUnitsPerPixel*=na);wa=Math.log(2)/12;ja=Math.exp(Math.round(Math.log(ja)/wa)*wa);const xa=ja*na;wa=.5*ca/(32*xa);var sa=.5*ca/(32*ja);ha[0]=Math.round(ha[0]*wa)/wa;ha[1]=Math.round(ha[1]*sa)/sa;wa=Y.inner;wa[0]=ha[0]-xa;wa[1]=ha[1]-ja;wa[2]=ha[0]+
xa;wa[3]=ha[1]+ja;this._isSpherical&&this._shiftExtentToFitBounds(wa,Infinity,pa);sa=Y.outer;6*xa>B.width(da)?B.copy(sa,h.unwrap(da)):ma<=.25*Math.PI?(sa[0]=wa[0]-xa,sa[1]=wa[1]-ja,sa[2]=wa[2]+xa,sa[3]=wa[3]+ja):(A.projectVectorToVector(Z.eye,this._renderSR,W,this._spatialReference),r.subtract(U,ha,W),Z=-Math.atan2(U[1],U[0])+.125*Math.PI,0>Z&&(Z+=2*Math.PI),w.scale(U,T[Math.floor(Z/(.25*Math.PI))],2*ja),U[0]*=na,U[2]*=na,w.add(sa,wa,U));this._isSpherical?(sa[0]=this._longitudeCyclical.clamp(sa[0]),
sa[2]=this._longitudeCyclical.clamp(sa[2]),sa[1]=Math.max(sa[1],-pa),sa[3]=Math.min(sa[3],pa)):(Z=B.intersection(wa,da,X),ha=B.intersection(sa,da,ba),B.contains(Z,ha)&&(sa[2]=sa[0],sa[3]=sa[1]));ca=Math.abs(wa[2]-wa[0])/ca;Y.mapUnitsPerPixel=Math.max(Y.mapUnitsPerPixel,ca);Y.pixelRatioAdjustment=Y.mapUnitsPerPixel/ca};la._drawOverlayTextures=function(Z,ca,Y=this.view.state.camera){if(0!==Z.length&&(this._drawTexturesDirty||this._drawTexturesAnimateDirty)){var da=this._drawTexturesDirty;this._drawTexturesAnimateDirty=
this._drawTexturesDirty=!1;var ha=this._drawOverlay(Z[L.OverlayIndex.INNER],Y);Z=this._drawOverlay(Z[L.OverlayIndex.OUTER],Y);ha!==J.ValidationState.CHANGED&&Z!==J.ValidationState.CHANGED||this.surface.updateTileOverlayParams(J.RenderRequestType.UPDATE);this._collectUnusedRenderTargetMemory();this.updateOverlayResult();da?(this.surface.requestRender(ca),ca===J.RenderRequestType.UPDATE&&this.surface.requestUpdate()):this.surface.requestRender(J.RenderRequestType.BACKGROUND)}};la._drawOverlay=function(Z,
ca){this._longitudeCyclical?Z.setupGeometryViewsCyclical(this._longitudeCyclical):Z.setupGeometryViewsDirect();return Z.draw(this.renderer,ca.pixelRatio)};la._collectUnusedRenderTargetMemory=function(){this._hasUnusedRenderTargets=!1;if(this.renderer.hasOverlays){const Z=performance.now();this._hasUnusedRenderTargets=this.renderer.collectUnusedRenderTargetMemory(Z)}};la._rectanglesOverlap=function(Z,ca){return h.isNone(Z)?!1:this._longitudeCyclical?(this._longitudeCyclical.contains(ca[0],ca[2],Z[0])||
this._longitudeCyclical.contains(ca[0],ca[2],Z[2])||this._longitudeCyclical.contains(Z[0],Z[2],ca[0]))&&!(Z[1]>ca[3]||Z[3]<ca[1]):B.intersects(Z,ca)};la._rectInsideRect=function(Z,ca){return h.isNone(ca)?!1:this._longitudeCyclical?this._longitudeCyclical.contains(Z[0],Z[2],ca[0])&&this._longitudeCyclical.contains(Z[0],Z[2],ca[2])&&ca[1]>Z[1]&&ca[3]<Z[3]:B.contains(Z,ca)};la._pointIsInExtent=function(Z,ca){if(this._longitudeCyclical)return this._longitudeCyclical.contains(ca[0],ca[2],Z.x)&&Z.y>=ca[1]&&
Z.y<=ca[3];const Y=Z.x;Z=Z.y;return Y>ca[0]&&Y<ca[2]&&Z>ca[1]&&Z<ca[3]};la._shiftExtentToFitBounds=function(Z,ca,Y){let da=0,ha=0;Z[0]<-ca?da=Z[0]+ca:Z[2]>ca&&(da=ca-Z[2]);Z[1]<-Y?ha=Z[1]+Y:Z[3]>Y&&(ha=Y-Z[3]);B.offset(Z,da,ha)};b._createClass(ka,[{key:"running",get:function(){return this._placementDirty&&(0<this._drapeSources.size||0<this.view.graphics.length||O.OVERLAY_DRAW_DEBUG_TEXTURE)&&!!this._spatialReference&&!this.suspended&&this.surface.ready}},{key:"_isSpherical",get:function(){return this.view.state.isGlobal}},
{key:"_worldToPCSRatio",get:function(){return h.isSome(this._spatialReference)&&this._spatialReference.isGeographic&&!this.view.state.isLocal?x.getReferenceEllipsoid(this._spatialReference).metersPerDegree:1}},{key:"view",get:function(){return this.surface.view}},{key:"updating",get:function(){return this.running||this.renderer.updating||this._contentUpdated}},{key:"hasHighlights",get:function(){return this.renderer.hasHighlights}},{key:"rendersOccluded",get:function(){return this.renderer.rendersOccluded}},
{key:"hasOverlays",get:function(){return this.renderer.hasOverlays}},{key:"gpuMemoryUsage",get:function(){return this.renderer.gpuMemoryUsage}},{key:"test",get:function(){return{renderer:this.renderer,update:()=>this.runTask()}}}]);return ka}(n);c.__decorate([p.property()],a.OverlayManager.prototype,"_spatialReference",void 0);c.__decorate([p.property({readOnly:!0})],a.OverlayManager.prototype,"running",null);c.__decorate([p.property()],a.OverlayManager.prototype,"_placementDirty",void 0);c.__decorate([p.property()],
a.OverlayManager.prototype,"_contentUpdated",void 0);c.__decorate([p.property()],a.OverlayManager.prototype,"_isSpherical",null);c.__decorate([p.property()],a.OverlayManager.prototype,"_worldToPCSRatio",null);c.__decorate([p.property()],a.OverlayManager.prototype,"renderer",void 0);c.__decorate([p.property({constructOnly:!0})],a.OverlayManager.prototype,"surface",void 0);c.__decorate([p.property({readOnly:!0,aliasOf:"surface.suspended"})],a.OverlayManager.prototype,"suspended",void 0);c.__decorate([p.property({readOnly:!0})],
a.OverlayManager.prototype,"updating",null);c.__decorate([p.property({type:Boolean})],a.OverlayManager.prototype,"hasHighlights",null);c.__decorate([p.property({type:Boolean})],a.OverlayManager.prototype,"rendersOccluded",null);a.OverlayManager=c.__decorate([k.subclass("esri.views.3d.terrain.OverlayManager")],a.OverlayManager);const U=z.create(),W=f.create(),Q={inner:B.create(),outer:B.create(),mapUnitsPerPixel:0,pixelRatioAdjustment:1},X=B.create(),ba=B.create(),aa=C.create();var ea;(function(ia){ia[ia.NONE=
0]="NONE";ia[ia.EXTENT=1]="EXTENT";ia[ia.RERENDER_ONLY=2]="RERENDER_ONLY"})(ea||(ea={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/requireUtils":function(){define(["exports"],function(a){a.removeLoadedShaderModules=function(){var b;const c=null==(b=globalThis.require)?void 0:b.modules;if(c){b=Object.keys(c);for(const n of b)-1!==n.search(".glsl")&&delete c[n]}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/PlanarPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/SpatialReference ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ../../../geometry/support/frustum ../../../geometry/support/spatialReferenceUtils ./PatchGeometryFactory ./Tile ../webgl-engine/materials/internal/MaterialUtil".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p){let t=
function(k){function r(f,w,z){var A=k.call(this)||this;A.horizontalScaleFactor=1;A.extentInRenderSR=m.create();void 0!==f&&A.init(f,w,z);return A}b._inheritsLoose(r,k);var y=r.prototype;y.init=function(f,w,z){k.prototype.init.call(this,f,w,z);f=z.view.renderSpatialReference;z=z.spatialReference;this.horizontalScaleFactor=w=c.isSome(f)&&d.isPlateCarree(f)&&z.isGeographic?this.ellipsoid.radius*Math.PI/180:1;z=this.extentInRenderSR;f=this.extent;if(this.surface.isWebMercatorOnPlateeCarree)w=n.fromValues(f[0],
f[1],0),l.projectVectorToVector(w,u.WebMercator,w,u.PlateCarree),f=n.fromValues(f[2],f[3],0),l.projectVectorToVector(f,u.WebMercator,f,u.PlateCarree),z[0]=w[0],z[1]=w[1],z[2]=f[0],z[3]=f[1];else for(let A=0;4>A;++A)z[A]=f[A]*w;this.centerAtSeaLevel[0]=.5*(z[0]+z[2]);this.centerAtSeaLevel[1]=.5*(z[1]+z[3]);this.centerAtSeaLevel[2]=0;this._edgeLen=Math.max(z[2]-z[0],z[3]-z[1]);this._edgeLen2=this._edgeLen*this._edgeLen;this.updateRadiusAndCenter()};y.updateRadiusAndCenter=function(){this._updateCenter();
var f=this.extentInRenderSR;const w=.5*(f[2]-f[0]);f=.5*(f[3]-f[1]);this._center[g.CenterPosition.MIDDLE][3]=Math.max(Math.sqrt(w*w+f*f),.5*(this.elevationBounds[0]-this.elevationBounds[1]))};y._isVisible=function(f){return h.intersectsAABB(f,this._aabb())};y._aabb=function(){const f=this.extentInRenderSR;return v.wrap(f[0],f[1],this.elevationBounds[0],f[2],f[3],this.elevationBounds[1])};y.intersectsRay=function(f,w,z,A){q[0]=1/w[0];q[1]=1/w[1];q[2]=1/w[2];return p.intersectAabbInvDirBefore(this._aabb(),
f,q,z,A)};y.createGeometry=function(){e.createPlanarGlobePatch(this.renderData,this.horizontalScaleFactor);this.setMemoryDirty()};y.getDefaultVerticesPerRowOnLevel=function(){return 9>this.level?3:2};y.updateCornerElevations=function(){e.updateCornerElevationsPlanar(this.renderData,this.horizontalScaleFactor)};y.updateEdgeElevations=function(){e.updateEdgesElevationsAndNormalsPlanar(this.renderData,this.horizontalScaleFactor)};return r}(g.Tile);const q=n.create();a.PlanarPatch=t;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchGeometryFactory":function(){define("exports ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../geometry/support/aaBoundingBox ../../../geometry/support/aaBoundingRect ./ElevationData ./interfaces ./PatchGeometry ./PatchGeometryLUT ./PatchRenderData ./TerrainConst ./terrainUtils".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){function k(Z,
ca,Y,da,ha,ja){const ma=ca-1;var pa=Z.vertexAttributes.count,na=2*(Math.min(ca-2,da[1])-Math.max(1,da[0]))*(Math.min(ca-2,ha[1])-Math.max(1,ha[0]));const wa=q.neighborEdgeIndices.map((Ja,va)=>0===va&&ha[1]<ca-2||1===va&&da[1]<ca-2||2===va&&1<ha[0]||3===va&&1<da[0]);var xa=Z.outerEdges.reduce((Ja,va,Ca)=>Ja+(wa[Ca]?0:ma-2+va.count-1),0);const sa=Y.reduce((Ja,va)=>Ja+ma*(2*(va.latitudeResolution-1)+1),0);na=3*(na+xa+sa)*(ja?2:1);const ya=new (65536<pa?Uint32Array:Uint16Array)(na);let ra=0;pa=(Ja,va,
Ca)=>{ya[ra++]=Ja;ya[ra++]=va;ya[ra++]=Ca};xa=(Ja,va,Ca)=>{ya[ra++]=Ja;ya[ra++]=va;ya[ra++]=va;ya[ra++]=Ca;ya[ra++]=Ca;ya[ra++]=Ja};const ua=ja?xa:pa,Ba=ca-2,Ea=ma-2;(()=>{for(let Ja=Math.max(ha[0],1)-1;Ja<Math.min(ha[1],ca-2)-1;++Ja)for(let va=Math.max(da[0],1)-1;va<Math.min(da[1],ca-2)-1;++va){const Ca=Ja*Ba+va,Ka=Ca+1,Oa=Ka+Ba,Ra=Oa-1;ua(Ca,Ka,Oa);ua(Oa,Ra,Ca)}})();(()=>{for(let va=0;4>va;++va){if(wa[va])continue;const Ca=Z.outerEdges[va],Ka=Z.innerEdges[va];let Oa=0,Ra=0;const Pa=Ca.count,qa=
Ka.count;ma-2+Ca.count-1;const za=1===va||2===va?(Da,La,Na)=>ua(Da,La,Na):(Da,La,Na)=>ua(Da,Na,La);for(;Oa<Pa-1||Ra<qa-1;){const Da=Ka.getVertexOffset(Ra),La=Ca.getVertexOffset(Oa);var Ja=Oa<Pa-1;const Na=Ra<qa-1,Ua=Ja?ma*(Oa+.5)/(Pa-1):0,Ta=Na?1+Ea*(Ra+.5)/(qa-1):0;Ja&&(!Na||Ua<=Ta)?(++Oa,Ja=Ca.getVertexOffset(Oa),za(Da,La,Ja)):(++Ra,Ja=Ka.getVertexOffset(Ra),za(Da,La,Ja))}}})();Y.forEach(Ja=>{let va=Z.outerEdges[Ja.connectedOuterEdgeOffset].offset0;for(let Ca=0;Ca<Ja.latitudeResolution;++Ca){const Ka=
0===Ca?Ja.rowOffset:va+ca;for(let Oa=0;Oa<ma;Oa++)ua(va,va+1,Ka+Oa),Ca<Ja.latitudeResolution-1&&ua(va+1,Ka+Oa+1,Ka+Oa),++va;va=Ka}});Z.indices=ya;Z.indexCount=na}function r(Z,ca){const Y=Z.localOrigin,da=Z.geometryInfo;Z=Z.geometryState.neighborData.edgeResolutions;const ha=da.numVerticesPerSide-2,ja=da.vertexAttributes.position.typedBuffer;for(let pa=0;4>pa;++pa){var ma=0===pa||2===pa;da.innerEdges[pa]=new e.EdgeDescriptor(ja,Y,(0===pa?ha-1:0)*ha+(1===pa?ha-1:0),(ma?0:1)*ha+(ma?1:0),ha);ma=Z[pa]+
1;da.outerEdges[pa]=new e.EdgeDescriptor(ja,Y,ca,1,ma);ca+=ma}}function y(Z,ca){x(Z,ca);var Y=Z.geometryState.clippingArea,da=Z.tile.extent;Y=c.isSome(Y)&&(da[0]<Y[0]||da[2]>Y[2]||da[1]<Y[1]||da[3]>Y[3])?K:O;for(da=0;4>da;++da)Y(Z,da,ca);M(Z,ca)}function f(Z,ca,Y,da,ha){const ja=Math.cos(Y);Y=Math.sin(Y);const ma=Math.sin(ca);da=ha+da;Z[0]=Math.cos(ca)*ja*da;Z[1]=ma*ja*da;Z[2]=Y*da}function w(Z,ca,Y){return Z?da=>(Math.PI/2-2*Math.atan(Math.exp(-da/ca)))*ca:da=>da*Y}function z(Z,ca){var Y=Z.geometryState;
const da=Z.tile,ha=da.extent,ja=c.unwrapOr(Y.clippingArea,ha);var ma=Z.geometryInfo;const pa=ma.boundingBox,na=ma.outerEdges,wa=Y.neighborData.cornerNeighborData,xa=ma.uvOffsetAndScale[2],sa=ma.uvOffsetAndScale[3],ya=0<xa?1/xa:1,ra=0<sa?1/sa:1,ua=-ma.uvOffsetAndScale[0]*ya,Ba=-ma.uvOffsetAndScale[1]*ra;ma=da.surface.isWebMercatorOnPlateeCarree;const Ea=w(ma,ma?da.ellipsoid.radius:0,ca),Ja=Y.samplerData,va=Y.neighborData.edgeNeighbours,Ca=Z.localOrigin;Z=(Ka,Oa,Ra,Pa,qa)=>{var za=ha[1]*(1-qa)+ha[3]*
qa,Da=b.clamp(ha[0]*(1-Pa)+ha[2]*Pa,ja[0],ja[2]);za=b.clamp(za,ja[1],ja[3]);var La=[za===ha[3],Da===ha[2],za===ha[1],Da===ha[0]];const Na=!La[3]&&!La[1]||!La[0]&&!La[2];La=Na?La[0]&&c.isSome(va[0])?va[0]:La[1]&&c.isSome(va[1])?va[1]:La[2]&&c.isSome(va[2])?va[2]:La[3]&&c.isSome(va[3])?va[3]:null:null;Ra=Na?La?La.neighborTile.level===da.level?.5*(h.sampleElevationOrZero(Da,za,Ja)+h.sampleElevationOrZero(Da,za,La.neighborSamplerData)):h.sampleElevationOrZero(Da,za,La.neighborSamplerData):h.sampleElevationOrZero(Da,
za,Ja):wa[Ra].elevation;Da=Da*ca-Ca[0];za=Ea(za)-Ca[1];Ra-=Ca[2];P(Da,za,Ra,pa);Pa=b.clamp(ua+Pa*ya,0,1);qa=b.clamp(Ba+qa*ra,0,1);Ka.setVertexRawXYZUV(Oa,Da,za,Ra,Pa,qa)};for(Y=0;4>Y;++Y)ma=na[Y],Z(ma,0,0===Y?3:1===Y?1:2,1===Y?1:0,0===Y?1:0),Z(ma,ma.count-1,2===Y?1:3===Y?3:0,3===Y?0:1,2===Y?0:1)}function A(Z){B(Z,(ca,Y,da,ha)=>{var ja=Z.tile.extentInRadians;f(ca,ja[0===Y?0:2],ja[0===da?1:3],ha,Z.tile.ellipsoid.radius)})}function x(Z,ca){const Y=Z.tile;c.isSome(Y.renderData.geometryState.clippingArea)?
z(Z,ca):B(Z,(da,ha,ja,ma)=>{var pa=Z.tile.extent,na=w(Y.surface.isWebMercatorOnPlateeCarree,Y.ellipsoid.radius,ca);ja=0===ja?pa[1]:pa[3];da[0]=(0===ha?pa[0]:pa[2])*ca;da[1]=na(ja);da[2]=ma})}function B(Z,ca){var Y=Z.geometryInfo;const da=Y.outerEdges,ha=Z.geometryState.neighborData.cornerNeighborData,ja=Y.boundingBox,ma=Z.localOrigin;Z=(pa,na,wa,xa,sa)=>{ca(T,wa,xa,ha[na].elevation);for(na=0;3>na;++na)T[na]-=ma[na];P(T[0],T[1],T[2],ja);pa.setVertexRawXYZUV(sa,T[0],T[1],T[2],wa,xa)};for(Y=0;4>Y;++Y){const pa=
da[Y];Z(pa,0===Y?3:1===Y?1:2,1===Y?1:0,0===Y?1:0,0);Z(pa,2===Y?1:3===Y?3:0,3===Y?0:1,2===Y?0:1,pa.count-1)}}function C(Z){var ca,Y;const da=Z.vao;Z=Z.geometryInfo.vertexAttributes;null==da?void 0:null==(ca=da.vertexBuffers)?void 0:null==(Y=ca.geometry)?void 0:Y.setSubData(Z.position.typedBuffer)}function D(Z){A(Z);for(let ca=0;4>ca;++ca)E(Z,ca);R(Z)}function E(Z,ca){var Y,da,ha,ja=Z.geometryState,ma=ja.neighborData;const pa=Z.tile;pa.level;const na=pa.extent;var wa=na[2]-na[0],xa=na[3]-na[1],sa=pa.extentInRadians;
const ya=sa[0];sa[1];const ra=sa[2];sa[3];const ua=pa.ellipsoid.radius,Ba=L(Z);sa=ma.edgeNeighbours[ca];const Ea=ma.edgeResolutions[ca],Ja=1===ca||3===ca;ma=1===ca?1:0;var va=0===ca?1:0,Ca=na[0]+ma*wa;xa=na[1]+va*xa;var Ka=ya*(1-ma)+ra*ma;const Oa=Ba(va);sa=null==sa?void 0:sa.neighborTile;var Ra=pa.level-(null!=(Y=null==sa?void 0:sa.level)?Y:pa.level);const Pa=2**Ra,qa=Ea*Pa,za=(gb=>{if(!gb)return 0;const lb=Ja?0:1;gb=pa.lij[lb+1]-gb.lij[lb+1]*Pa;return(Ja?Pa-1-gb:gb)*Ea})(sa),Da=null==sa?void 0:
sa.extent;Y=(ca+2)%4;const La=ja.samplerData,Na=null==sa?void 0:null==(da=sa.renderData)?void 0:null==(ha=da.geometryState)?void 0:ha.samplerData;da=sa&&0===Ra;ha=(gb,lb,yb,Ib)=>.5*(h.sampleElevationOrZero(gb,lb,Na)+h.sampleElevationOrZero(yb,Ib,La));ja=(gb,lb)=>h.sampleElevationOrZero(gb,lb,Na);const Ua=da?ha:ja;let Ta=Da?1===Y?Da[2]:Da[0]:Ca,Za=Da?0===Y?Da[3]:Da[1]:xa;ha=(gb,lb,yb)=>{gb=(za+gb)/qa;Za=Da[1]*(1-gb)+Da[3]*gb;return Ua(Ta,Za,lb,yb)};ja=(gb,lb,yb)=>{gb=(za+gb)/qa;Ta=Da[0]*(1-gb)+Da[2]*
gb;return Ua(Ta,Za,lb,yb)};ha=sa?Ja?ha:ja:(gb,lb,yb)=>h.sampleElevationOrZero(lb,yb,La);let ab=ma,hb=Ca,ta=Ka,Fa=va,Sa=xa,Xa=Oa,Ya=Math.sin(ta),eb=Math.cos(ta),fb=Math.cos(Xa),mb=Math.sin(Xa);const jb=Ja?()=>Ba(Fa):()=>Oa;ma=gb=>{Fa=gb;Sa=na[1]*(1-gb)+na[3]*gb;Xa=jb();fb=Math.cos(Xa);mb=Math.sin(Xa)};va=gb=>{ab=gb;hb=na[0]*(1-gb)+na[2]*gb;ta=ya*(1-ab)+ra*ab;Ya=Math.sin(ta);eb=Math.cos(ta)};ma=Ja?ma:va;ja=Z.geometryInfo;va=ja.boundingBox;Ka=ja.vertexAttributes;Ca=Ka.position.typedBuffer;xa=Ka.uv0.typedBuffer;
Ka=Ka.normal.typedBuffer;ja=ja.outerEdges[ca];Ra=ja.getVertexOffset(1);Y=Ea+1;var kb=Z.localOrigin;Z=kb[0];const ub=kb[1];kb=kb[2];const ob=pa.surface.shadingEnabled;var rb=1===ca?-1:3===ca?1:0;ca=0===ca?-1:2===ca?1:0;wa/=Ea;const cb=rb*wa,Ia=ca*wa,Ha=1/Ea*rb,Va=1/Ea*ca,$a=gb=>{n.sub(U,gb,X);n.cross(W,U,aa);n.cross(Q,W,U);n.add(ea,ea,Q)};for(wa=1;wa<Y-1;++wa){ma(wa/Ea);ca=ha(wa,hb,Sa);var db=ua+ca;ca=eb*fb*db;rb=Ya*fb*db;const gb=mb*db,lb=ca-Z,yb=rb-ub,Ib=gb-kb;P(lb,yb,Ib,va);db=t.GEOMETRY_VERTEX_STRIDE*
Ra;Ca[db+0]=lb;Ca[db+1]=yb;Ca[db+2]=Ib;xa[db+0]=ab;xa[db+1]=Fa;ob&&(n.set(ea,0,0,0),n.set(X,ca,rb,gb),n.normalize(aa,X),ca=(Db,Fb)=>{Fb=h.sampleElevationOrZero(hb+Db*cb,Sa+Db*Ia,Fb);Fb=ua+Fb;var Jb=ab+Db*Ha,Kb=ya*(1-Jb)+ra*Jb;Jb=Math.sin(Kb);Kb=Math.cos(Kb);Db=Ba(Fa+Db*Va);const Ob=Math.cos(Db);Db=l.fromValues(Kb*Ob*Fb,Jb*Ob*Fb,Math.sin(Db)*Fb);$a(Db)},sa&&ca(-1,Na),sa&&!da||ca(1,La),Ka[db+0]=ea[0],Ka[db+1]=ea[1],Ka[db+2]=ea[2]);++Ra}if(ob)for(sa=1;sa<Y-1;++sa)ja.getVertexRawNormal(ea,sa),ja.getVertex(X,
sa),n.normalize(aa,X),ja.getVertex(H,sa-1),$a(H),ja.getVertex(H,sa+1),$a(H),n.normalize(ea,ea),ja.setVertexRawNormal(sa,ea[0],ea[1],ea[2])}function F(Z,ca,Y,da,ha,ja,ma){const pa=(wa,xa)=>h.sampleElevationOrZero(wa,xa,Y),na=(wa,xa)=>h.sampleElevationOrZero(wa,xa,da);return ma===ha?!Z||ca?pa:null:ma===ja?Z?na:null:null}function G(Z,ca,Y,da){if(ca!==Z)return()=>0;Z=ca?3:2;const ha=ca?1:0,ja=da(Z,ha),ma=da(ha,Z),pa=(null!=ja?1:0)+(null!=ma?1:0),na=ca?Y:0,wa=ca?0:Y;return(xa,sa,ya)=>((null!=ja?-(ja(xa+
na,sa+wa)-ya):0)+(null!=ma?+(ma(xa-na,sa-wa)-ya):0))/pa}function O(Z,ca,Y){var da=Z.geometryState.neighborData,ha=Z.tile,ja=ha.surface,ma=ja.shadingEnabled,pa=da.edgeResolutions[ca],na=ha.extent;const wa=pa+1,xa=da.edgeNeighbours[ca];da=Z.localOrigin;const sa=Z.geometryState.samplerData;var ya=(Da,La)=>h.sampleElevationOrZero(Da,La,sa),ra=(Da,La)=>.5*(h.sampleElevationOrZero(Da,La,xa.neighborSamplerData)+h.sampleElevationOrZero(Da,La,sa)),ua=(Da,La)=>h.sampleElevationOrZero(Da,La,xa.neighborSamplerData);
const Ba=(null==xa?void 0:xa.neighborTile.level)===ha.level;ra=Ba?ra:ua;ya=c.isSome(xa)?ra:ya;ra=Z.geometryInfo;Z=ra.outerEdges[ca];ja=w(ja.isWebMercatorOnPlateeCarree,ha.ellipsoid.radius,Y);ua=ra.boundingBox;ra=1===ca||3===ca;const Ea=1===ca?na[2]:na[0],Ja=0===ca?na[3]:na[1],va=1===ca?1:0,Ca=0===ca?1:0;ha=(na[2]-na[0])/pa;const Ka=null==xa?void 0:xa.neighborSamplerData,Oa=c.isSome(xa);var Ra=(Da,La)=>F(Oa,Ba,sa,Ka,Da,La,ca);const Pa=G(ra,!0,ha,Ra);Ra=G(ra,!1,ha,Ra);for(let Da=1;Da<wa-1;++Da){var qa=
Da/pa,za=ra?Ea:na[0]*(1-qa)+na[2]*qa;const La=ra?na[1]*(1-qa)+na[3]*qa:Ja,Na=ra?va:qa;qa=ra?qa:Ca;const Ua=ya(za,La),Ta=za*Y-da[0],Za=ja(La)-da[1],ab=Ua-da[2];P(Ta,Za,ab,ua);if(ma){const hb=Pa(za,La,Ua);za=Ra(za,La,Ua);Z.setVertexRawXYZUVN(Da,Ta,Za,ab,Na,qa,hb,za,ha)}else Z.setVertexRawXYZUV(Da,Ta,Za,ab,Na,qa)}if(ma)for(Y=ra?0:1,ma=ra?1:0,pa=1;pa<wa-1;++pa)Z.getNormal(ia,pa),na=Z.getVertexZ(pa-1),da=Z.getVertexZ(pa+1),da=na-da,na=ia[0]+.5*Y*da,da=ia[1]+.5*ma*da,ya=2*ha,ja=1/Math.sqrt(na*na+da*da+
ya*ya),Z.setVertexRawNormal(pa,ja*na,ja*da,ja*ya)}function K(Z,ca,Y){var da=Z.geometryState.neighborData,ha=Z.tile,ja=ha.level,ma=ha.surface,pa=ma.shadingEnabled;const na=da.edgeNeighbours[ca];var wa=da.edgeResolutions[ca],xa=ha.extent,sa=Z.geometryState,ya=c.unwrapOr(sa.clippingArea,S),ra=Z.geometryInfo,ua=ra.uvOffsetAndScale[0];da=ra.uvOffsetAndScale[1];var Ba=ua+ra.uvOffsetAndScale[2],Ea=da+ra.uvOffsetAndScale[3];Ba=Ba>ua?1/(Ba-ua):1;Ea=Ea>da?1/(Ea-da):1;ua=-ua*Ba;const Ja=-da*Ea;da=wa+1;var va=
[xa[3]>ya[3],xa[2]>ya[2],xa[1]<ya[1],xa[0]<ya[0]];const Ca=sa.samplerData;sa=(ab,hb)=>h.sampleElevationOrZero(ab,hb,Ca);const Ka=(null==na?void 0:na.neighborTile.level)===ja;var Oa=(ab,hb)=>{const ta=h.sampleElevationOrZero(ab,hb,na.neighborSamplerData);return Ka?.5*(ta+h.sampleElevationOrZero(ab,hb,Ca)):ta};Oa=c.isSome(na)?Oa:sa;va=va[ca]?sa:Oa;sa=ra.outerEdges[ca];Oa=ra.boundingBox;ra=1===ca||3===ca;const Ra=b.clamp(1===ca?xa[2]:xa[0],ya[0],ya[2]),Pa=b.clamp(0===ca?xa[3]:xa[1],ya[1],ya[3]),qa=1===
ca?1:0,za=0===ca?1:0;Z=Z.localOrigin;ma=w(ma.isWebMercatorOnPlateeCarree,ha.ellipsoid.radius,Y);ha=(xa[2]-xa[0])/wa;const Da=null==na?void 0:na.neighborSamplerData,La=c.isSome(na),Na=(null==na?void 0:na.neighborTile.level)===ja;var Ua=(ab,hb)=>F(La,Na,Ca,Da,ab,hb,ca);ja=G(ra,!0,ha,Ua);Ua=G(ra,!1,ha,Ua);for(let ab=1;ab<da-1;++ab){var Ta=ab/wa,Za=ra?Ra:b.clamp(xa[0]*(1-Ta)+xa[2]*Ta,ya[0],ya[2]);const hb=ra?b.clamp(xa[1]*(1-Ta)+xa[3]*Ta,ya[1],ya[3]):Pa,ta=ra?qa:b.clamp(ua+Ta*Ba,0,1);Ta=ra?b.clamp(Ja+
Ta*Ea,0,1):za;const Fa=va(Za,hb),Sa=Za*Y-Z[0],Xa=ma(hb)-Z[1],Ya=Fa-Z[2];P(Sa,Xa,Ya,Oa);if(pa){const eb=ja(Za,hb,Fa);Za=Ua(Za,hb,Fa);sa.setVertexRawXYZUVN(ab,Sa,Xa,Ya,ta,Ta,eb,Za,ha)}else sa.setVertexRawXYZUV(ab,Sa,Xa,Ya,ta,Ta)}if(pa)for(Y=ra?0:1,pa=ra?1:0,wa=1;wa<da-1;++wa)sa.getNormal(ia,wa),xa=sa.getVertexZ(wa-1),ya=sa.getVertexZ(wa+1),ya=xa-ya,xa=ia[0]+.5*Y*ya,ya=ia[1]+.5*pa*ya,Ba=2*ha,Ea=1/Math.sqrt(xa*xa+ya*ya+Ba*Ba),sa.setVertexRawNormal(wa,Ea*xa,Ea*ya,Ea*Ba)}function L(Z){Z=Z.tile;if(Z.surface.isWebMercator){const Y=
Z.extent,da=Z.ellipsoid.radius;return ha=>{var ja=Y[1];return Math.PI/2-2*Math.atan(Math.exp(-(ja+ha*(Y[3]-ja))/da))}}const ca=Z.extentInRadians;return Y=>ca[1]*(1-Y)+ca[3]*Y}function R(Z){Z.tile.surface.shadingEnabled&&I(Z,(ca,Y,da,ha,ja,ma,pa)=>{{var na=H;const wa=L(Y);Y=Y.tile;const xa=Y.extent;q.internalAssert(m.containsXYWithMargin(xa,ja,ma,1));ja=(ja-xa[0])/(xa[2]-xa[0]);const sa=Y.extentInRadians;ja=sa[0]*(1-ja)+sa[2]*ja;ma=wa((ma-xa[1])/(xa[3]-xa[1]));f(na,ja,ma,pa,Y.ellipsoid.radius)}n.sub(U,
H,da);n.cross(W,U,ha);n.cross(ca,W,U)})}function M(Z,ca){Z.tile.surface.shadingEnabled&&I(Z,(Y,da,ha,ja,ma,pa,na)=>{J(Z,ca)(H,ma,pa,na);da=H[0]-ha[0];ja=H[1]-ha[1];ha=H[2]-ha[2];Y[0]=-da*ha;Y[1]=-ja*ha;Y[2]=da*da+ja*ja})}function J(Z,ca){return Z.tile.surface.isWebMercatorOnPlateeCarree?(Y,da,ha,ja)=>{var ma=Z.tile.ellipsoid.radius;Y[0]=da*ca;Y[1]=(Math.PI/2-2*Math.atan(Math.exp(-ha/ma)))*ma;Y[2]=ja}:(Y,da,ha,ja)=>{Y[0]=da*ca;Y[1]=ha*ca;Y[2]=ja}}function I(Z,ca){var Y;if(Z.tile.surface.shadingEnabled){var da=
Z.geometryState.neighborData.cornerNeighborData,ha=Z.tile,ja=ha.extent,ma="local"===(null==(Y=Z.tile.surface.view)?void 0:Y.viewingMode);ma&&n.set(aa,0,0,1);{const wa=(ya,ra,ua,Ba,Ea,Ja)=>{ya=(1===Ja?Ea.extent[0]:3===Ja?Ea.extent[2]:ya)+N[ua][0]*Ba;ra=(0===Ja?Ea.extent[1]:2===Ja?Ea.extent[3]:ra)+N[ua][1]*Ba;q.internalAssert(m.containsXYWithMargin(Ea.extent,ya,ra,1));ua=h.sampleElevationOrZero(ya,ra,Ea.renderData.geometryState.samplerData);ca(Q,Ea.renderData,X,aa,ya,ra,ua);n.add(ea,ea,Q)},xa=(ya,ra,
ua,Ba)=>{const Ea=ua.extent[0===Ba||1===Ba?2:0]+N[ya][0]*ra;ya=ua.extent[0===Ba||3===Ba?3:1]+N[ya][1]*ra;q.internalAssert(m.containsXYWithMargin(ua.extent,Ea,ya,1));ra=h.sampleElevationOrZero(Ea,ya,ua.renderData.geometryState.samplerData);ca(Q,ua.renderData,X,aa,Ea,ya,ra);n.add(ea,ea,Q)},sa=(ya,ra,ua,Ba,Ea,Ja)=>{var va=N[ya][0]*ra;ra*=N[ya][1];ya=ua.extent[0===Ba||1===Ba?2:0]+va;Ba=ua.extent[0===Ba||3===Ba?3:1]+ra;va=Ea.extent[0===Ja||1===Ja?2:0]+va;ra=Ea.extent[0===Ja||3===Ja?3:1]+ra;q.internalAssert(m.containsXYWithMargin(ua.extent,
ya,Ba,1));q.internalAssert(m.containsXYWithMargin(Ea.extent,va,ra,1));Ja=h.sampleElevationOrZero(ya,Ba,ua.renderData.geometryState.samplerData);Ea=h.sampleElevationOrZero(va,ra,Ea.renderData.geometryState.samplerData);ca(Q,ua.renderData,X,aa,ya,Ba,.5*(Ja+Ea));n.add(ea,ea,Q)};Y=ya=>{var ra=0===ya||1===ya?ja[2]:ja[0],ua=0===ya||3===ya?ja[3]:ja[1];ya=da[ya].cornerTiles;var Ba=ya.reduce((va,Ca)=>{var Ka;return Math.min(va,null!=(Ka=null==Ca?void 0:Ca.level)?Ka:Infinity)},Infinity);for(var Ea=0;4>Ea;++Ea){var Ja=
ya[Ea];la[Ea]=(null==Ja?void 0:Ja.level)===Ba?Ja:null}for(ya=0;4>ya;++ya)if(Ba=la[(ya+3)%4],Ea=la[ya],null!=Ba&&Ba!==ha&&Ba===Ea){Ea=(Ba.extent[2]-Ba.extent[0])/Math.max(Ba.renderData.geometryState.neighborData.edgeResolutions[(ya+2)%4],2**(ha.level-Ba.level));Ja=(ya+0)%4;const va=(ya+1)%4;wa(ra,ua,(ya+3)%4,Ea,Ba,ya);wa(ra,ua,Ja,Ea,Ba,ya);wa(ra,ua,va,Ea,Ba,ya);return ea}q.internalAssert(la.some(va=>(null==va?void 0:va.isLoaded)||va===ha));ra=la.reduce((va,Ca)=>Ca?Ca.extent[2]-Ca.extent[0]:va,0);ua=
la.reduce((va,Ca)=>{var Ka;return Math.max(va,null!=(Ka=null==Ca?void 0:Ca.renderData.geometryState.numVerticesPerSide)?Ka:1)},1);ra/=ua;for(ua=0;4>ua;++ua)if(ya=la[(ua+3)%4],Ba=la[(ua+0)%4],ya||Ba)Ea=0===ua?1:1===ua?2:2===ua?3:0,Ja=0===ua?2:1===ua?3:2===ua?0:1,ya&&Ba?sa(ua,ra,ya,Ea,Ba,Ja):xa(ua,ra,null!=ya?ya:Ba,ya?Ea:Ja);return ea};for(var pa=0;4>pa;++pa){var na=Z.geometryInfo.outerEdges[pa];na.getVertex(X,1===pa||2===pa?0:na.count-1);ma||n.normalize(aa,X);n.set(ea,0,0,0);na=Y(pa);n.normalize(ka[pa],
na)}}Z=Z.geometryInfo.outerEdges;for(ma=0;4>ma;++ma)Y=Z[ma],pa=ka[0===ma?3:1===ma?1:2],Y.setVertexRawNormal(0,pa[0],pa[1],pa[2]),pa=ka[2===ma?1:3===ma?3:0],Y.setVertexRawNormal(Y.count-1,pa[0],pa[1],pa[2])}}function P(Z,ca,Y,da){Z<da[0]?da[0]=Z:Z>da[3]&&(da[3]=Z);ca<da[1]?da[1]=ca:ca>da[4]&&(da[4]=ca);Y<da[2]?da[2]=Y:Y>da[5]&&(da[5]=Y)}const N=[[0,1],[1,0],[0,-1],[-1,0]],V=new g.PatchGeometryLUT,S=m.fromValues(-Infinity,-Infinity,Infinity,Infinity),T=l.create(),H=l.create(),U=l.create(),W=l.create(),
Q=l.create(),X=l.create(),ba=l.create(),aa=l.create(),ea=l.create(),ia=l.create(),ka=[l.create(),l.create(),l.create(),l.create()],la=[null,null,null,null];a.createPlanarGlobePatch=function(Z,ca){var Y=Z.tile;const da=Y.extent,ha=Z.localOrigin,ja=Z.geometryState;var ma=Y.surface;const pa=ma.isWebMercatorOnPlateeCarree,na=ma.shadingEnabled,wa=da[0],xa=da[1],sa=da[2]-wa,ya=da[3]-xa;var ra=ja.clippingArea;ma=c.isSome(ra)?Math.max(0,(ra[0]-da[0])/sa):0;const ua=c.isSome(ra)?Math.max(0,(ra[1]-da[1])/ya):
0,Ba=c.isSome(ra)?Math.min(1,(ra[2]-da[0])/sa):1,Ea=c.isSome(ra)?Math.min(1,(ra[3]-da[1])/ya):1;var Ja=Ba-ma,va=Ea-ua;const Ca=0<Ja?1/Ja:1,Ka=0<va?1/va:1,Oa=-ma*Ca,Ra=-ua*Ka;Ja=ja.numVerticesPerSide;const Pa=Ja-1;va=(Ja-2)**2;var qa=ja.neighborData.edgeResolutions.reduce((Xa,Ya)=>Xa+Ya+1,0);va+=qa;qa=e.acquireTerrainAttributes(va);const za=qa.position.typedBuffer,Da=qa.uv0.typedBuffer,La=qa.normal.typedBuffer,Na=Z.geometryInfo,Ua=Na.boundingBox;v.empty(Ua);let Ta=0;Y=Y.ellipsoid.radius;const Za=ja.samplerData;
ra=c.isSome(ra)?ra:S;const ab=m.fromValues(Math.max(da[0],ra[0]),Math.max(da[1],ra[1]),Math.min(da[2],ra[2]),Math.min(da[3],ra[3])),hb=ha[0],ta=ha[1],Fa=ha[2],Sa=w(pa,Y,ca);(()=>{for(let ub=1;ub<=Pa-1;ub++){var Xa=ub/Pa,Ya=Ra+Xa*Ka;Xa=b.clamp(xa+Xa*ya,ab[1],ab[3]);Ya=b.clamp(Ya,0,1);const ob=Sa(Xa)-ta,rb=sa/Pa;for(let cb=1;cb<=Pa-1;cb++){var eb=cb/Pa,fb=Oa+eb*Ca;eb=b.clamp(wa+eb*sa,ab[0],ab[2]);var mb=b.clamp(fb,0,1);fb=h.sampleElevationOrZero(eb,Xa,Za);var jb=eb*ca-hb,kb=fb-Fa;P(jb,ob,kb,Ua);fb=
t.GEOMETRY_VERTEX_STRIDE*Ta;za[fb+0]=jb;za[fb+1]=ob;za[fb+2]=kb;Da[fb+0]=mb;Da[fb+1]=Ya;if(na){jb=h.sampleElevationOrZero(eb+rb,Xa,Za);kb=h.sampleElevationOrZero(eb-rb,Xa,Za);mb=h.sampleElevationOrZero(eb,Xa+rb,Za);const Ia=h.sampleElevationOrZero(eb,Xa-rb,Za);eb=.25*(kb-jb);mb=.25*(Ia-mb);jb=rb;kb=Math.sqrt(eb*eb+mb*mb+jb*jb);La[fb+0]=eb/kb;La[fb+1]=mb/kb;La[fb+2]=jb/kb}++Ta}}})();Na.numVerticesPerSide=ja.numVerticesPerSide;Na.vertexAttributes=qa;u.set(Z.geometryInfo.uvOffsetAndScale,ma,ua,Ba-ma,
Ea-ua);r(Z,Ta);y(Z,ca);Ta=va;k(Na,ja.numVerticesPerSide,[],[0,Ja-1],[0,Ja-1],ja.wireframe);Z.intersectionData=null};a.createSphericalGlobePatch=function(Z,ca){var Y=Z.tile;const {extent:da,extentInRadians:ha,surface:ja}=Y,ma=Z.localOrigin,pa=Z.geometryState;var na=ja.isWebMercator;const wa=ja.shadingEnabled,xa=pa.numVerticesPerSide,sa=xa-1,ya=(xa-2)**2,ra=na&&(ca===d.PatchType.HAS_SOUTH_POLE||ca===d.PatchType.HAS_BOTH_POLES),ua=na&&(ca===d.PatchType.HAS_NORTH_POLE||ca===d.PatchType.HAS_BOTH_POLES);
var Ba=6*((ra?1:0)+(ua?1:0))*(sa+1);ca=pa.neighborData;na=ca.edgeResolutions.reduce((ta,Fa)=>ta+Fa+1,0);const Ea=e.acquireTerrainAttributes(ya+Ba+na);Ba=Z.geometryInfo;Ba.numVerticesPerSide=pa.numVerticesPerSide;Ba.vertexAttributes=Ea;u.set(Ba.uvOffsetAndScale,0,0,1,1);const Ja=Ea.position.typedBuffer,va=Ea.uv0.typedBuffer,Ca=Ea.normal.typedBuffer,Ka=Ba.boundingBox;v.empty(Ka);const Oa=ma[0],Ra=ma[1],Pa=ma[2];V.update(sa,ha);let qa=0;const za=pa.samplerData,Da=Y.ellipsoid.radius,La=L(Z),Na=xa-2,Ua=
da[0],Ta=da[2],Za=da[1],ab=da[3];(()=>{for(let Ya=1;Ya<=Na;Ya++){const eb=Ya/sa,fb=Za*(1-eb)+ab*eb;var ta=La(eb);const mb=Math.cos(ta);ta=Math.sin(ta);for(let jb=1;jb<=Na;jb++){const kb=jb/sa;var Fa=V.sinLonLUT[jb],Sa=V.cosLonLUT[jb],Xa=Da+h.sampleElevationOrZero(Ua*(1-kb)+Ta*kb,fb,za);Sa=Sa*mb*Xa-Oa;Fa=Fa*mb*Xa-Ra;Xa=ta*Xa-Pa;P(Sa,Fa,Xa,Ka);const ub=t.GEOMETRY_VERTEX_STRIDE*qa;Ja[ub+0]=Sa;Ja[ub+1]=Fa;Ja[ub+2]=Xa;va[ub+0]=kb;va[ub+1]=eb;++qa}}})();wa&&(()=>{const ta=Ya=>{n.subtract(U,Ya,ba);n.cross(W,
U,aa);n.cross(Q,W,U);return Q},Fa=Ea.position,Sa=Ea.normal;qa=0;const Xa=(Ya,eb,fb)=>{if(1<Ya&&1<eb&&Ya<Na&&eb<Na)Fa.getVec(qa+fb,H);else{fb=Ya/sa;var mb=Ua*(1-fb)+Ta*fb;fb=V.sinLonLUT[Ya];Ya=V.cosLonLUT[Ya];var jb=eb/sa;eb=Za*(1-jb)+ab*jb;var kb=La(jb);jb=Math.cos(kb);kb=Math.sin(kb);mb=Da+h.sampleElevationOrZero(mb,eb,za);n.set(H,Ya*jb*mb-Oa,fb*jb*mb-Ra,kb*mb-Pa)}n.add(ea,ea,ta(H))};for(let Ya=1;Ya<=Na;Ya++)for(let eb=1;eb<=Na;eb++)Fa.getVec(qa,ba),n.add(X,ba,Z.localOrigin),n.normalize(aa,X),n.set(ea,
0,0,0),Xa(eb-1,Ya,-1),Xa(eb+1,Ya,1),Xa(eb,Ya-1,-Na),Xa(eb,Ya+1,+Na),n.normalize(ea,ea),Sa.setVec(qa,ea),++qa})();qa=ya;r(Z,ya);D(Z);qa=ya+na;const hb=[];(()=>{const ta=(Fa,Sa)=>{Sa*=xa;P(-Oa,-Ra,-Pa+Fa*Da,Ka);hb.push({connectedRowOffset:Sa,connectedOuterEdgeOffset:1===Fa?0:2,rowOffset:qa,latitudeResolution:6});Sa=Math.PI/2-2*Math.atan(Math.exp(-(-1===Fa?Za:ab)/Da));const Xa=Fa*Math.PI/2-Sa;Fa=.99*(1===Fa?1:-1);const Ya=Da+0;for(let mb=1;6>=mb;++mb){var eb=Sa+mb/6*Xa;const jb=Math.cos(eb);eb=Math.sin(eb);
for(let kb=0;kb<=sa;kb++){var fb=kb/sa;const ub=V.cosLonLUT[kb]*jb*Ya-Oa,ob=V.sinLonLUT[kb]*jb*Ya-Ra,rb=eb*Ya-Pa;P(ub,ob,rb,Ka);const cb=t.GEOMETRY_VERTEX_STRIDE*qa;Ja[cb+0]=ub;Ja[cb+1]=ob;Ja[cb+2]=rb;va[cb+0]=fb;va[cb+1]=Fa;wa&&(fb=1/Math.sqrt(ub*ub+ob*ob+rb*rb),Ca[cb+0]=fb*ub,Ca[cb+1]=fb*ob,Ca[cb+2]=fb*rb);++qa}}};ra&&ta(-1,0);ua&&ta(1,sa)})();k(Ba,pa.numVerticesPerSide,hb,[0,xa-1],[0,xa-1],pa.wireframe);Z.intersectionData=null;for(Y=0;4>Y;++Y)q.internalAssert(Ba.outerEdges[Y].count===ca.edgeResolutions[Y]+
1)};a.updateCornerElevationsPlanar=function(Z,ca){x(Z,ca);M(Z,ca);C(Z)};a.updateCornerElevationsSpherical=function(Z){var ca,Y;A(Z);R(Z);const da=Z.vao;Z=Z.geometryInfo.vertexAttributes;null==da?void 0:null==(ca=da.vertexBuffers)?void 0:null==(Y=ca.geometry)?void 0:Y.setSubData(Z.position.typedBuffer)};a.updateEdgesElevationsAndNormalsPlanar=function(Z,ca){y(Z,ca);C(Z)};a.updateEdgesElevationsSpherical=function(Z){D(Z);C(Z)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/PatchGeometry":function(){define("exports ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferPool ../support/buffer/InterleavedLayout ./TerrainConst ./terrainUtils ../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,n,l,u,v,m){let h=function(){function g(t,q,k,r,y){this._buf=t;this._localOrigin=q;this.offset0=k;this.stride=r;this.count=y}var p=g.prototype;p.getVertexOffset=function(t){v.internalAssert(0<=t&&t<this.count);
return this.offset0+this.stride*t};p.getVertex=function(t,q){q=this.getVertexOffset(q)*u.GEOMETRY_VERTEX_STRIDE;t[0]=this._buf[q+0]+this._localOrigin[0];t[1]=this._buf[q+1]+this._localOrigin[1];t[2]=this._buf[q+2]+this._localOrigin[2]};p.getVertexZ=function(t){t=this.getVertexOffset(t)*u.GEOMETRY_VERTEX_STRIDE;return this._buf[t+2]+this._localOrigin[2]};p.setVertex=function(t,q,k,r){t=this.getVertexOffset(t)*u.GEOMETRY_VERTEX_STRIDE;this._buf[t+0]=q[0]-this._localOrigin[0];this._buf[t+1]=q[1]-this._localOrigin[1];
this._buf[t+2]=q[2]-this._localOrigin[2];this._buf[t+3]=k;this._buf[t+4]=r};p.getNormal=function(t,q){q=this.getVertexOffset(q)*u.GEOMETRY_VERTEX_STRIDE;t[0]=this._buf[q+5];t[1]=this._buf[q+6];t[2]=this._buf[q+7]};p.setVertexRawXYZUV=function(t,q,k,r,y,f){t=this.getVertexOffset(t)*u.GEOMETRY_VERTEX_STRIDE;this._buf[t+0]=q;this._buf[t+1]=k;this._buf[t+2]=r;this._buf[t+3]=y;this._buf[t+4]=f};p.setVertexRawXYZUVN=function(t,q,k,r,y,f,w,z,A){t=this.getVertexOffset(t)*u.GEOMETRY_VERTEX_STRIDE;this._buf[t+
0]=q;this._buf[t+1]=k;this._buf[t+2]=r;this._buf[t+3]=y;this._buf[t+4]=f;this._buf[t+5]=w;this._buf[t+6]=z;this._buf[t+7]=A};p.setVertexRawNormal=function(t,q,k,r){t=this.getVertexOffset(t)*u.GEOMETRY_VERTEX_STRIDE;this._buf[t+5]=q;this._buf[t+6]=k;this._buf[t+7]=r};p.getVertexRawNormal=function(t,q){q=this.getVertexOffset(q)*u.GEOMETRY_VERTEX_STRIDE;t[0]=this._buf[q+5];t[1]=this._buf[q+6];t[2]=this._buf[q+7]};return g}();const d=l.newLayout().vec3f(m.VertexAttribute.POSITION).vec2f(m.VertexAttribute.UV0).vec3f(m.VertexAttribute.NORMAL),
e=new n.BufferPool(g=>d.createBuffer(g),g=>g.count);a.EdgeDescriptor=h;a.PatchGeometry=function(){this.vertexAttributes=this.indices=null;this.boundingBox=c.empty();this.numVerticesPerSide=this.indexCount=0;this.uvOffsetAndScale=b.create();this.outerEdges=[null,null,null,null];this.innerEdges=[null,null,null,null]};a.acquireTerrainAttributes=function(g){return e.acquire(g)};a.clearCaches=function(){e.clear()};a.releaseGeometry=function(g){e.release(g.vertexAttributes);g.vertexAttributes=null;g.indices=
null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/geometry/support/buffer/BufferPool":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/PooledArray"],function(a,b,c){let n=function(){function l(v,m){this._factoryCallback=v;this._lengthCallback=m;this._pool=new Map}var u=l.prototype;u.acquire=function(v){if(!l.test.disabled){var m=this._pool.get(v);if(m&&0!==m.length)return m.pop()}try{return this._factoryCallback(v)}catch(h){m=
window.performance&&window.performance.memory;let d="";m&&(d=`\n  totalJSHeapSize: ${m.totalJSHeapSize}, usedJSHeapSize: ${m.usedJSHeapSize}, jsHeapSizeLimit: ${m.jsHeapSizeLimit}`);console.log("Array allocation of size "+v+" failed: "+h+d);throw h;}};u.release=function(v){if(!l.test.disabled){var m=this._lengthCallback(v),h=this._pool.get(m);h||(h=new c({shrink:!0}),this._pool.set(m,h));h.push(v)}};u.clear=function(){this._pool.clear()};b._createClass(l,[{key:"test",get:function(){return{size:this._pool.size}}}]);
return l}();n.test={disabled:!1};a.BufferPool=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchGeometryLUT":function(){define(["exports","./TerrainConst"],function(a,b){let c=function(){function n(){this.sinLonLUT=Array(b.MAX_PATCH_TESSELATION+1);this.cosLonLUT=Array(b.MAX_PATCH_TESSELATION+1)}n.prototype.update=function(l,u){const v=u[0];u=u[2];for(let h=0;h<=l;h++){var m=h/l;m=v*(1-m)+u*m;this.sinLonLUT[h]=Math.sin(m);this.cosLonLUT[h]=
Math.cos(m)}};return n}();a.PatchGeometryLUT=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/PatchRenderData":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/arrayUtils ../../../core/mathUtils ../../../core/maybe ../../../geometry/support/aaBoundingBox ../../../core/has ../../../geometry/Extent ../../../geometry/support/Ellipsoid ../support/buffer/glUtil ./ElevationData ./GeometryState ./interfaces ./LayerClass ./PatchGeometry ./terrainUtils ./TextureFader ./Tile ./TileOverlayData ./tileUtils ../webgl-engine/lib/DefaultVertexAttributeLocations ../../webgl/BufferObject ../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){v=function(){function B(){this.geometryInfo=new q.PatchGeometry;this.geometryState=this.intersectionData=null;this._textureRef=new r.TextureFader(()=>this.tile.surface.textureFadeDuration);this.overlay=new f;this._geometryStateChangedSinceLastUpdate=!0;this._wireframeChanged=this._clippingAreaChanged=this._cornerElevationChanged=this._edgeNeighborChanged=this._edgeResolutionChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=this._hasGeometry=
!1}var C=B.prototype;C.init=function(D){this._tile=D;this.clear();D=this.geometryInfo;D.indices=null;D.vertexAttributes=null;u.empty(D.boundingBox);D.indexCount=0;D.numVerticesPerSide=0;this.intersectionData=null;this.geometryState=new g.GeometryState;this.localOrigin=null;this.overlay.clear()};C.clear=function(){this._releaseGeometry();this.releaseTexture();this._textureRef.clear()};C.updateGeometryIfChanged=function(D,E){E=this.updateGeometryStateAndPrepareForGeometryGeneration(E);this._hasGeometry=
!0;return this.updateNeighborDataAndGeometryIfNeeded(E,D)};C.updateNeighborDataAndGeometryIfNeeded=function(D=!1,E=this.vao.context){const F=this._updateNeighborData();if(D=D||this._geometryStateChangedSinceLastUpdate||F)this._updateGeometry(E),this._geometryStateChangedSinceLastUpdate=!1;return D};C._calculateEdgeResolution=function(D,E){const F=this.tile,G=this.geometryState.numVerticesPerSide-1;if(!F.surface.isGlobal){var O=F.surface.extent;if(l.isSome(O)&&(0===D&&F.extent[3]>O[3]||1===D&&F.extent[2]>
O[2]||2===D&&F.extent[1]<O[1]||3===D&&F.extent[0]<O[0]))return G}const K=F.level;O=k.neighborEdgeIndices[D];E=E||F.findNeighborTile(O,M=>M.isLoaded||M.level===K);if(!E||E.isLeaf&&!E.isLoaded){var L;k.internalAssert(l.isNone(null==(L=F.surface)?void 0:L.rootTiles)||F.surface.updatingRootTiles||!F.shouldHaveNeighbor(O));return G}if(E.isLoaded)return L=E.renderData.geometryState,E=K-E.level,0===E?Math.max(L.numVerticesPerSide-1,G):Math.max(1,L.neighborData.edgeResolutions[(D+2)%4]/2**E);k.internalAssert(!E.isLeaf);
let R=G;E.forAllSubtreeOnSide(k.oppositeEdge(O),M=>{if(M===F)return!0;if(M.isLoaded)return R=Math.max(R,2**(M.level-K)),!0;k.internalAssert(!M.isLeaf);return!1});return R};C._updateNeighborData=function(){const D=this.tile,E=M=>M.isLoaded||M.level===D.level,F=M=>M.isLoaded,G=[null,null,null,null],O=[null,null,null,null];(()=>{for(let M=0;4>M;++M){const J=D.findNeighborTile(k.neighborEdgeIndices[M],E);G[M]=J;O[M]=null!=J&&J.isLoaded?J:null}})();const K=[null,null,null,null];(()=>{for(let M=0;4>M;++M)K[M]=
D.findNeighborTile(k.neighborCornerIndices[M],F)})();const L=this.geometryState.neighborData;let R=!1;(()=>{for(let M=0;4>M;++M){const J=L.edgeResolutions[M],I=G[M],P=this._calculateEdgeResolution(M,I);L.edgeResolutions[M]=P;J!==P&&(this._edgeResolutionChanged=R=!0,I&&I!==D&&!I.isLoaded&&I.level===D.level&&(L.modifiedEdgeResolutions[M]=!0))}})();(()=>{const M=(P,N)=>{var V=P.reduce((Q,X)=>{var ba;return Math.min(Q,null!=(ba=null==X?void 0:X.level)?ba:Infinity)},Infinity);for(var S=0;4>S;++S){var T=
P[(S+3)%4],H=P[S];if(T&&T.level<D.level&&T===H){P=T;var U=D.getNeighborEdgeStartVertexIndex(S,P);V=1===(S&1);var W=(U+(0===N||1===N&&!V||3===N&&V?1:0))/2**(D.level-P.level);U=V?0===N||1===N?P.extent[0]:P.extent[2]:n.lerp(P.extent[0],P.extent[2],W);V=V?n.lerp(P.extent[1],P.extent[3],W):0===N||3===N?P.extent[1]:P.extent[3];return e.sampleElevationOrZero(U,V,P.renderData.geometryState.samplerData)}}S=N=0;for(T=0;4>T;++T)if((H=P[T])&&H.level===V){const Q=H.extent;H=e.sampleElevationOrZero(Q[0===T||1===
T?0:2],Q[0===T||3===T?1:3],null==(U=H.renderData)?void 0:null==(W=U.geometryState)?void 0:W.samplerData);S+=H;N++}return N?S/N:0},J=L.cornerNeighborData,I=(P,N)=>{const V=J[P],S=V.cornerTiles;for(let H=0;4>H;++H){var T=k.neighborCornerIndices[H];const U=N[H];T=null==U?void 0:U.findCorner(k.oppositeCorner(T),W=>(null==W?void 0:W.isLoaded)||W===D);S[H]=T}P=M(S,P);return V.elevation!==P?(V.elevation=P,!0):!1};for(let P=0;4>P;++P){const N=[K[P],O[(P+1)%4],D,O[P]],V=N.map((S,T)=>N[(T+4-P)%4]);I(P,V)&&
(R=this._cornerElevationChanged=!0)}})();(()=>{const M=L.edgeNeighbours;for(let V=0;4>V;++V){var J,I=O[V];I&&(k.internalAssert(null==I?void 0:I.isLoaded),k.internalAssert((null==I?void 0:I.lij[0])<=D.lij[0]));var P=M[V];const S=null==P?void 0:P.version;if(null==I||!I.isLoaded||I.lij[0]>D.lij[0])I=null;else{var N=I.renderData.geometryState;I={neighborSamplerData:N.samplerData,neighborEdgeOverlapResolution:N.neighborData.edgeResolutions[V+2],version:N.samplerDataVersion,neighborVerticesPerSide:N.numVerticesPerSide,
neighborTile:I}}N=null!=(J=null==I?void 0:I.version)?J:null;N=P&&I&&S!==N;const T=P&&I&&(null==P?void 0:P.neighborTile)!==(null==I?void 0:I.neighborTile);P=null!=P!==(null!=I)||N||T;this._edgeNeighborChanged||(this._edgeNeighborChanged=P);R||(R=P);if(P||!S)M[V]=I}})();return R};C.updateEdgeAfterResolutionChange=function(D){var E,F;const G=this._calculateEdgeResolution(D),O=this.geometryState.neighborData.edgeResolutions,K=O[D];k.internalAssert((null!=(E=null==(F=this.geometryState.neighborData.edgeNeighbours[D])?
void 0:F.neighborTile.level)?E:0)<=this.tile.level);G!==K&&(O[D]=G,this._edgeResolutionChanged=!0,B.deferTileNeighborUpdate?B.neighborTilesToUpdate.add(this.tile):this._updateGeometry(this.vao.context))};C._updateGeometry=function(D){this.intersectionData=null;const E=this.tile;var F=E.lij,G=B.updatedGeometryTiles.get(F)||0;B.updatedGeometryTiles.set(F,G+1);F=this.geometryInfo.vertexAttributes;F=!this._vao||!F||this._wireframeChanged||this._numVerticesPerSideChanged||this._samplerDataChanged||this._clippingAreaChanged||
this._edgeResolutionChanged;G=!F&&this._edgeNeighborChanged;const O=!G&&this._cornerElevationChanged;this._wireframeChanged=this._clippingAreaChanged=this._cornerElevationChanged=this._edgeNeighborChanged=this._edgeResolutionChanged=this._samplerDataChanged=this._numVerticesPerSideChanged=!1;F?(this._releaseGeometry(),this._createGeometry(D)):G?E.updateEdgeElevations():O?E.updateCornerElevations():console.warn("Update for no reason?")};C.releaseGeometry=function(){return this._releaseGeometry()};
C.ensureTexture=function(D,E){l.isSome(this._texture)&&this._texture.descriptor.width!==D&&this.releaseTexture();l.isNone(this._texture)&&(this._texture=E(),this.tile.setMemoryDirty());return this._texture};C.releaseTexture=function(){l.isSome(this._texture)&&(this._texture.release(),this._texture=null,this.tile.setMemoryDirty())};C.updateGeometryStateAndPrepareForGeometryGeneration=function(D){const E=this._getElevationInfo();var F=E.samplerData?this.tile.getElevationBasedVerticesPerSide(E.maxTileLevel):
this.tile.getDefaultVerticesPerRowOnLevel();F=Math.max(F,5);let G=this.tile.clippingArea;if(!this.tile.intersectsClippingArea||this.tile.isWithinClippingArea)G=null;const O=this.geometryState;let K=!1;O.numVerticesPerSide!==F&&(this._numVerticesPerSideChanged=!0,O.numVerticesPerSide=F,O.samplerDataVersion++,K=!0);E.changed&&(this._samplerDataChanged=!0,O.samplerData=E.samplerData,O.samplerDataVersion++,K=!0);c.equals(O.clippingArea,G)||(this._clippingAreaChanged=!0,O.clippingArea=G,K=!0);O.wireframe!==
D&&(this._wireframeChanged=!0,O.wireframe=D,K=!0);this._geometryStateChangedSinceLastUpdate||(this._geometryStateChangedSinceLastUpdate=K);this._hasGeometry=!0;return K};C._createGeometry=function(D){this.tile.createGeometry();const E=this.geometryInfo.vertexAttributes,F=this.geometryInfo.indices,G=D.gl;this._vao=new x.VertexArrayObject(D,z.Default3D,{geometry:d.glLayout(E.layout)},{geometry:A.BufferObject.createVertex(D,G.STATIC_DRAW,E.buffer)},A.BufferObject.createIndex(D,G.STATIC_DRAW,F));this._hasGeometry=
!0};C._releaseGeometry=function(){this._hasGeometry=!1;if(!this._vao)return!1;this._vao.dispose();this._vao=null;q.releaseGeometry(this.geometryInfo);return!0};C.setTextureReference=function(D,E=r.ActivationTime.Immediate){l.isSome(D)&&D.texture!==this._texture&&this.releaseTexture();this._textureRef.push(D,E)};C._getElevationInfo=function(){const D=this.geometryState.samplerData,E=this.tile.layerInfo[t.LayerClass.ELEVATION],F=E.length;let G=Array(F),O=0;var K=0;let L=!1;for(let J=0;J<F;J++){var R=
E[J];if(l.isSome(R.upsampleInfo)){R=R.upsampleInfo.tile;var M=R.layerInfo[t.LayerClass.ELEVATION][J].data;M=M&&M.samplerData;D&&D[O]===M||(L=!0);G[O++]=M;K=Math.max(K,R.lij[0])}else R.data&&(M=this.tile.surface.layerViewByIndex(J,t.LayerClass.ELEVATION),w.fallsWithinLayer(this.tile,M.layer,!1)&&(K=R.data,D&&D[O]===K.samplerData||(L=!0),G[O++]=K.samplerData,K=this.tile.level))}l.isSome(D)&&D.length!==O&&(L=!0);0<O?G.length=O:G=null;return{changed:L,samplerData:G,maxTileLevel:K}};C.checkGeometryWaterproofness=
function(){};b._createClass(B,[{key:"tile",get:function(){return this._tile}},{key:"hasGeometry",get:function(){return this._hasGeometry}},{key:"vao",get:function(){return this._vao}},{key:"textureReference",get:function(){return this._textureRef.current}},{key:"nextTextureReference",get:function(){return this._textureRef.next}},{key:"textureFadeFactor",get:function(){return this._textureRef.fadeFactor}},{key:"textureIsFading",get:function(){return this._textureRef.isFading}},{key:"estimatedGeometryMemoryUsage",
get:function(){const D=l.mapOr(this.intersectionData,0,E=>E.estimatedMemoryUsage);return this.geometryInfo.indices.byteLength+this.geometryInfo.vertexAttributes.byteLength+D}},{key:"textureDescriptor",get:function(){return l.isSome(this._texture)?this._texture.descriptor:null}},{key:"test",get:function(){return{hasTexture:null!=this._texture}}}]);return B}();v.updatedGeometryTiles=new Map;v.deferTileNeighborUpdate=!1;v.neighborTilesToUpdate=new Set;Object.defineProperty(a,"ActivationTime",{enumerable:!0,
get:()=>r.ActivationTime});a.PatchRenderData=v;a.isElevationSampleIn=function(B,C,D){if(l.isSome(D))for(const F of D)if(F){D=F.x0;var E=F.width;const G=D+(E-1)/F.dx,O=F.y1;E=O-(E-1)/F.dy;if(B>=D-k.eps&&B<=G+k.eps&&E-k.eps<=C&&C<=O+k.eps)return!0}return!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/GeometryState":function(){define(["exports"],function(a){let b=function(){this.elevation=0;this.normal=[0,0,1];this.cornerTiles=[null,
null,null,null]},c=function(){this.edgeNeighbours=[null,null,null,null];this.cornerNeighborData=[new b,new b,new b,new b];this.edgeResolutions=[1,1,1,1];this.modifiedEdgeResolutions=[!1,!1,!1,!1]};a.CornerNeighborData=b;a.EdgeNeighborData=function(){};a.GeometryState=function(){this.numVerticesPerSide=0;this.clippingArea=this.samplerData=null;this.wireframe=!1;this.samplerDataVersion=0;this.neighborData=new c};a.NeighborhoodData=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/TextureFader":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","./interfaces"],function(a,b,c,n){let l=function(){function u(m){this._getFadeDuration=m;this._delayedTime=this._fadeStart=0}var v=u.prototype;v.clear=function(){this._current=c.destroyMaybe(this._current);this._next=c.destroyMaybe(this._next);this._waiting=c.destroyMaybe(this._waiting);this._delayed=c.destroyMaybe(this._delayed)};v.push=function(m,h=a.ActivationTime.Immediate){this._delayed=
c.destroyMaybe(this._delayed);this._push(m,h)};v._push=function(m,h){this._isFadingEnabled||this.clear();if(c.isNone(this._current))this._current=m;else{var d=u.test.fadeMoment||performance.now();h!==a.ActivationTime.Immediate?(this._delayed=m,this._delayedTime=d+h):c.isNone(this._next)?(this._next=m,this._fadeStart=this._alignFadeStart(d)):c.isNone(m)||(c.destroyMaybe(this._waiting),this._waiting=m)}};v._alignFadeStart=function(m){const h=this._getFadeDuration();return m+h-m%h};b._createClass(u,
[{key:"current",get:function(){if(c.isNone(this._current))return null;if(!this._isFadingEnabled){var m=this._delayed||this._waiting||this._next||this._current;m!==this._current&&(this._current=null,this.clear(),this._current=m)}m=u.test.fadeMoment;c.isSome(this._delayed)&&(m=m||performance.now(),m>=this._delayedTime&&(this._push(this._delayed,a.ActivationTime.Immediate),this._delayed=null));if(c.isSome(this._next)){m=m||performance.now();var h=this._fadeDuration;const d=c.isSome(this._current)&&this._next.texture===
this._current.texture,e=this._next.type!==n.TextureUpdate.FADING;h=m-this._fadeStart>=h;if(d||e||h)c.destroyMaybe(this._current),this._current=this._next,this._next=this._waiting,this._waiting=null,this._fadeStart=this._alignFadeStart(m)}return this._current}},{key:"next",get:function(){return this._next}},{key:"fadeFactor",get:function(){if(c.isNone(this._next))return 1;var m=u.test.fadeMoment||performance.now();m=Math.max(0,m-this._fadeStart);const h=this._fadeDuration;return m>h?0:1-m/h}},{key:"isFading",
get:function(){return c.isSome(this._next)||c.isSome(this._delayed)}},{key:"_fadeDuration",get:function(){return c.isNone(this._waiting)?this._getFadeDuration():.5*this._getFadeDuration()}},{key:"_isFadingEnabled",get:function(){return 0<this._getFadeDuration()}}]);return u}();l.test={fadeMoment:0};a.ActivationTime=void 0;(function(u){u[u.Immediate=0]="Immediate";u[u.Delayed=5E3]="Delayed"})(a.ActivationTime||(a.ActivationTime={}));a.TextureFader=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Tile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../core/ObjectPool ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/common ../../../geometry/projectionEllipsoid ../../../geometry/support/aaBoundingRect ../../../chunks/sphere ../../2d/engine/vectorTiles/VectorTile ../support/StreamDataLoader ./ElevationBounds ./ElevationTileAgent ./interfaces ./LayerClass ./MapTileAgent ./RasterTile ./TerrainConst ./terrainUtils ./TileAgent ./TilePerLayerInfo ./TileTexture ./TileUpdate ./tileUtils ../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G){function O(U,W,Q,X){const ba=Q===f.LayerClass.ELEVATION?T.acquire():S.acquire();ba.init(U,W,Q,X);return ba}function K(U){U.dispose();U instanceof r.ElevationTileAgent?T.release(U):U instanceof w.MapTileAgent&&S.release(U)}function L(U,W,Q){return Math.abs(U-W)<=Q}function R(U,W,Q){return n.isNone(U)||n.isNone(W)||W===U?!1:U.level>=W.level?M(U,W,Q):M(W,U,x.oppositeCorner(Q))}function M(U,W,Q){x.internalAssert(U.level>=W.level);var X=
x.isWestCorner(Q),ba=x.isNorthCorner(Q);Q=U.extent;const aa=W.extent;var ea=[X?Q[0]:Q[2],ba?Q[3]:Q[1]];const ia=[X?aa[2]:aa[0],ba?aa[1]:aa[3]];X=1E-5*(Q[2]-Q[0]);ba=L(ea[0],ia[0],X)||U.surface.isGlobal&&L(ea[0],-ia[0],X);ea=L(ea[1],ia[1],X);return ba&&ea?!0:U.level===W.level||!ba&&!ea?!1:ba?J(aa[1],aa[3],Q[1],Q[3],X):J(aa[0],aa[2],Q[0],Q[2],X)}function J(U,W,Q,X,ba=d.EPSILON){return U-ba<=Q&&Q<=X&&X<=W+ba}const I=h.create(),P=h.create(),N=h.create();let V=function(){function U(){this.lij=[0,0,0];
this._children=[null,null,null,null];this._pendingUpdates=0;this._dirty=!0;this._previouslyRendered=!1;this.extent=g.create();this._elevationBounds=v.create();this.layerInfo=[[],[]];this.extentInRadians=g.create();this.centerAtSeaLevel=h.create();this._center=[h.create(),p.create(),h.create()];this.up=h.unitZ();this._intersectsClippingArea=this._isWithinClippingArea=!0;this._maxTesselation=0;this._usedMemory=null;this._curvatureHeight=this._edgeLen2=this._edgeLen=this.renderOrder=this._screenDepth=
this._mapDataRefCount=this._mapTileMemory=0}U.prune=function(){S.prune(0);T.prune(0);C.TilePerLayerInfo.prune()};var W=U.prototype;W.computeVisibility=function(){this._dirty=!1;const Q=this._intersectsClippingArea&&this._isVisible(this.surface.frustum);Q!==this._visible&&(this._visible=Q,this._surface.emit("tiles-visibility-changed"),this._surface.renderer.setNeedsRender(),this.updateAgentSuspension());return this._visible};W.init=function(Q,X,ba){this.lij[0]=Q[0];this.lij[1]=Q[1];this.lij[2]=Q[2];
this.ellipsoid=e.getReferenceEllipsoid(ba.tilingScheme.spatialReference);ba.tilingScheme.getExtent(Q[0],Q[1],Q[2],this.extent);ba.tilingScheme.convertExtentToRadians(this.extent,this.extentInRadians);this._intersectsClippingArea=this._isWithinClippingArea=!0;this._clippingArea=null;this._mapDataRefCount=0;ba.upsampleMapCache.pop(this.key);this._edgeLen2=this._edgeLen=0;this._center[a.CenterPosition.MIDDLE][3]=0;this.vlevel=Q?Q[0]:0;X&&X.elevationBounds?u.copy(this._elevationBounds,X.elevationBounds):
u.set(this._elevationBounds,0,0);this._pendingUpdates=0;this.renderData=null;this._screenDepth=0;this._previouslyRendered=this._visible=!1;this._parent=X;this.unsetChildren();this._surface=ba;this.updateVisibility();for(const aa of f.LayerClasses){Q=ba.numLayers(aa);X=this.layerInfo[aa];for(const ea of X)ea.release();X.length=Q;for(let ea=0;ea<Q;ea++)X[ea]=C.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool),aa===f.LayerClass.ELEVATION&&this.findElevationBoundsForLayer(ea,-1)}this.computeElevationBounds();
this._maxTesselation=Math.min(ba.tilingScheme.pixelSize,A.MAX_PATCH_TESSELATION)};W.release=function(){x.weakAssert(!this.renderData,"tile.renderData was not unloaded");this._surface.upsampleMapCache.pop(this.key);for(const Q of f.LayerClasses){for(const X of this.layerInfo[Q])X.release();this.layerInfo[Q].length=0}this._surface=this._parent=null;this.setMemoryDirty()};W.refMapData=function(){++this._mapDataRefCount;this.isCached||this._surface.upsampleMapCache.pop(this.key)};W.unrefMapData=function(){--this._mapDataRefCount;
if(this.isCached){this.setMemoryDirty();const Q=this.cachedMemory;0<Q&&this._surface.upsampleMapCache.put(this.key,this,Q)}};W.setMemoryDirty=function(){this._usedMemory=null};W._ensureUsedMemory=function(){if(n.isSome(this._usedMemory))return this._usedMemory;let Q=this._mapTileMemory=this._usedMemory=0;for(var {data:X}of this.layerInfo[f.LayerClass.MAP])X instanceof t.VectorTile?Q+=this._getTerrainDataMemory(X):this._mapTileMemory+=this._getTerrainDataMemory(X);X=this.cpuImageMemorySize;for(const ba of this.layerInfo[f.LayerClass.ELEVATION])this._usedMemory+=
ba.data?X:0;this.renderData&&(this._usedMemory+=this.renderData.estimatedGeometryMemoryUsage,this._mapTileMemory+=G.getGpuMemoryUsage(this.renderData.textureDescriptor));this.isCached&&this._surface.upsampleMapCache.updateSize(this.key,this,this._mapTileMemory+Q);return this._usedMemory};W.getUsedMemoryForLayer=function(Q,X){X=this.layerInfo[Q][X];return null!=X&&X.data?Q===f.LayerClass.MAP?this.isCached?0:this._getTerrainDataMemory(X.data):Q===f.LayerClass.ELEVATION?this.cpuImageMemorySize:0:0};
W._getTerrainDataMemory=function(Q){return Q instanceof D?G.getGpuMemoryUsage(Q.texture):Q instanceof HTMLImageElement||Q instanceof q.ImageWithType?this.cpuImageMemorySize:Q instanceof t.VectorTile||Q instanceof z.RasterTile?Q.memoryUsage:0};W.updateScreenDepth=function(Q){var X=this._center[a.CenterPosition.MIDDLE];const ba=X[0],aa=X[1];X=X[2];const ea=Q[2]*ba+Q[6]*aa+Q[10]*X+Q[14];this._screenDepth=0>ea?0:ea/(Q[3]*ba+Q[7]*aa+Q[11]*X+Q[15])};W.shouldSplit=function(Q,X,ba){if(n.isSome(Q.frustum)&&
(!this._intersectsClippingArea||!this._isVisible(Q.frustum)))return E.TileUpdate.NONE;const aa=this.level;m.subtract(I,this._center[a.CenterPosition.MIDDLE],X);var ea=m.squaredLength(I);let ia=a.CenterPosition.MIDDLE;m.subtract(P,this._center[a.CenterPosition.TOP],X);var ka=m.squaredLength(P);ka<ea&&(ea=ka,ia=a.CenterPosition.TOP);m.subtract(P,this._center[a.CenterPosition.BOTTOM],X);ka=m.squaredLength(P);ka<ea&&(ea=ka,ia=a.CenterPosition.BOTTOM);if(this._edgeLen2>ea&&aa<Q.maxLod)return E.TileUpdate.SPLIT;
ea=Math.sqrt(ea);const la=this._edgeLen/(Q.fovX*ea*2);ka=()=>{const Y=aa+Math.ceil(-Math.log2(Q.relativeWidthLimit/la));return Y!==this.vlevel?(this.vlevel=Y,E.TileUpdate.VSPLITMERGE):E.TileUpdate.NONE_HIT_MAXLOD};if(ba===y.LODSnapping.ON&&1===this._surface.snapLevel-aa)return aa>=Q.maxLod?ka():E.TileUpdate.SPLIT;const Z=m.dot(this.up,I);ba=this._elevationBounds[1]-this._elevationBounds[0];const ca=ba/this.edgeLen;return Q.aboveGround&&0<Z&&.001>ca&&0<Z/ea-Math.sin(this._curvatureHeight/(this.edgeLen*
Math.SQRT1_2)*Math.PI)-ca?E.TileUpdate.NONE:la<Q.relativeWidthLimit?this.vlevel!==this.level?(this.vlevel=this.level,E.TileUpdate.VSPLITMERGE):E.TileUpdate.NONE:aa>=Q.maxLod?ka():6<aa&&(m.subtract(P,this._center[ia],X),m.scale(N,this.up,Z),m.subtract(N,N,P),ka=m.squaredLength(N),ka>this.radius*this.radius&&(m.scale(N,N,this.radius/Math.sqrt(ka)),m.add(N,N,this._center[ia]),m.subtract(N,X,N),Math.min(1,(Math.abs(m.dot(N,this.up))+.5*ba+this._curvatureHeight)/m.length(N))*(this._edgeLen/(Q.fovY*ea*
2))<.1/Q.angledSplitBias*Q.relativeHeightLimit))?E.TileUpdate.NONE:E.TileUpdate.SPLIT};W.setChildren=function(Q,X,ba,aa){x.weakAssert(!!(Q&&X&&ba&&aa),"Null child passed");this._children[0]=Q;this._children[1]=X;this._children[2]=ba;this._children[3]=aa};W.unsetChildren=function(){this._children[0]=null;this._children[1]=null;this._children[2]=null;this._children[3]=null};W.prepareToLoad=function(Q){this.refMapData();for(const X of f.LayerClasses)this._createOrUpdateAgents(0,X);Q.updateTileGeometryState(this)};
W.load=function(Q){this.prepareToLoad(Q);this.loadPrepared(Q)};W.loadPrepared=function(Q){Q.loadTile(this)};W.unload=function(Q){Q.unloadTile(this);for(const X of f.LayerClasses){Q=this.layerInfo[X];for(const ba of Q)ba.loadingAgent&&ba.loadingAgent!==B.TILE_AGENT_DONE&&(K(ba.loadingAgent),ba.loadingAgent=null),ba.pendingUpdates=0}this.resetPendingUpdate(E.TileUpdate.GEOMETRY);this.resetPendingUpdate(E.TileUpdate.TEXTURE_NOFADING);this.resetPendingUpdate(E.TileUpdate.TEXTURE_FADING);this.unrefMapData()};
W.unloadMapData=function(){const Q=this.layerInfo[f.LayerClass.MAP];for(const X of Q)X.loadingAgent&&X.loadingAgent!==B.TILE_AGENT_DONE&&(K(X.loadingAgent),X.loadingAgent=null),X.pendingUpdates=0;this.renderData&&this.renderData.releaseTexture();this.setMemoryDirty()};W.updateClippingStatus=function(Q){if(g.equals(Q,this._clippingArea))return!1;var X=this._intersectsClippingArea;const ba=this._isWithinClippingArea;n.isSome(Q)?(this._intersectsClippingArea=this.intersectsExtent(Q),this._isWithinClippingArea=
this._isWithinExtent(Q)):this._isWithinClippingArea=this._intersectsClippingArea=!0;this._clippingArea=Q;this.updateVisibility();Q=ba&&this._isWithinClippingArea;X=!ba&&!X&&!this._isWithinClippingArea&&!this._intersectsClippingArea;!this.renderData||Q||X||this.setPendingUpdate(E.TileUpdate.GEOMETRY);return!0};W.updateVisibility=function(){this._dirty=!0;this._surface.setTileTreeDirty()};W.getLayerInfo=function(Q,X){return this.layerInfo[X][Q]};W.hasLayerData=function(Q,X){Q=this.layerInfo[X][Q];return!(!Q||
!Q.data||Q.dataInvalidated)};W._isSuspended=function(Q){return this.hasPendingUpdate(E.TileUpdate.SPLIT)?!0:Q===f.LayerClass.ELEVATION?!1:!this.loadable};W.hasPendingUpdate=function(Q){return(this._pendingUpdates&Q)===Q};W.setPendingUpdate=function(Q){this._pendingUpdates|=Q;Q===E.TileUpdate.SPLIT||Q===E.TileUpdate.MERGE?this._surface.setTileTreeDirty():this._surface.requestUpdate()};W.resetPendingUpdate=function(Q){return this.hasPendingUpdate(Q)?(this._pendingUpdates&=~Q,!0):!1};W.requestLayerData=
function(Q,X,ba){const aa=this.layerInfo[X][Q];if(aa.waitingAgents.has(ba))return console.warn("agent already requested this piece of map data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),ba.tile.lij.toString(),X,Q),!0;aa.waitingAgents.push(ba);if(aa.data&&!aa.dataInvalidated)return console.warn("agent requested existing data (tile %s, agent tile %s, layer: %d/%d)",this.lij.toString(),ba.tile.lij.toString(),X,Q),ba.dataArrived(this),!0;if(aa.requestPromise)return!0;n.abortMaybe(aa.requestAbort);
aa.requestAbort=new AbortController;const ea=this._surface.requestTileData(this,Q,X,aa.requestAbort);if(!ea)return aa.requestAbort=null,!1;Q=()=>{aa.requestPromise===ea&&(aa.requestPromise=null,aa.requestAbort=null)};aa.requestPromise=ea;ea.then(Q,Q);return!0};W.hasLij=function(Q){return this.lij[0]===Q[0]&&this.lij[1]===Q[1]&&this.lij[2]===Q[2]};W.findByLij=function(Q){return this.hasLij(Q)?this:this.isLeaf?null:(Q=this._children[0].findByLij(Q)||this._children[1].findByLij(Q)||this._children[2].findByLij(Q)||
this._children[3].findByLij(Q))?Q:null};W.distanceToSquared=function(Q){return m.squaredLength(m.subtract(N,this._center[a.CenterPosition.MIDDLE],Q))};W.containsPoint=function(Q){const X=this.extent;return Q[0]>=X[0]&&Q[1]>=X[1]&&Q[0]<=X[2]&&Q[1]<=X[3]};W.unrequestLayerData=function(Q,X,ba){Q=this.layerInfo[X][Q];X=Q.waitingAgents;ba=null!=X.removeUnordered(ba);x.weakAssert(ba,"agent has not requested this piece of map data");1>X.length&&(Q.abortRequest(),this.setMemoryDirty())};W.dataArrived=function(Q,
X,ba){Q=this.layerInfo[X][Q];Q.data=ba;Q.dataInvalidated=!1;Q.waitingAgents.forAll(aa=>aa.dataArrived(this));Q.waitingAgents.clear();this.setMemoryDirty()};W.dataMissing=function(Q,X,ba){ba.notInTilemap||console.error(`Tile ${this.lij.toString()} layer ${X}/${Q} error ${ba}`);Q=this.layerInfo[X][Q];Q.dataMissing=!0;Q.waitingAgents.forAll(aa=>aa.dataMissing());Q.waitingAgents.clear();this.setMemoryDirty()};W.updateRenderData=function(Q,X){switch(Q){case f.LayerClass.MAP:return this._updateTexture(X);
case f.LayerClass.ELEVATION:return this._updateGeometry()}};W._updateTexture=function(Q){this.renderData&&(this.resetPendingUpdate(Q===y.TextureUpdate.FADING?E.TileUpdate.TEXTURE_NOFADING:E.TileUpdate.TEXTURE_FADING),this.setPendingUpdate(Q===y.TextureUpdate.FADING?E.TileUpdate.TEXTURE_FADING:E.TileUpdate.TEXTURE_NOFADING))};W._updateGeometry=function(){this.setPendingUpdate(E.TileUpdate.GEOMETRY);for(const Q of this.layerInfo[f.LayerClass.ELEVATION])Q.pendingUpdates|=E.TileUpdate.GEOMETRY};W.invalidateLayerData=
function(Q,X){this.layerInfo[X][Q].invalidateSourceData();this.restartAgents(X)};W.computeElevationBounds=function(){const Q=this._elevationBounds;u.set(Q,Number.MAX_VALUE,-Number.MAX_VALUE);const X=this.layerInfo[f.LayerClass.ELEVATION];let ba=!0;for(const aa of X)n.isSome(aa.elevationBounds)&&(Q[0]=Math.min(Q[0],aa.elevationBounds.min),Q[1]=Math.max(Q[1],aa.elevationBounds.max),aa.elevationBounds.hasNoDataValues||(ba=!1));ba&&(Q[0]=Math.min(Q[0],0),Q[1]=Math.max(Q[1],0));this.updateRadiusAndCenter();
this._surface.setTileTreeDirty()};W._updateCenter=function(){const Q=this._elevationBounds;m.scale(N,this.up,.5*(Q[0]+Q[1]));m.add(this._center[a.CenterPosition.MIDDLE],this.centerAtSeaLevel,N);m.scale(N,this.up,Q[0]);m.add(this._center[a.CenterPosition.TOP],this.centerAtSeaLevel,N);m.scale(N,this.up,Q[1]);m.add(this._center[a.CenterPosition.BOTTOM],this.centerAtSeaLevel,N)};W.findElevationBoundsForLayer=function(Q,X){const ba=this.layerInfo[f.LayerClass.ELEVATION][Q];if(!(n.isSome(ba.elevationBounds)&&
ba.elevationBounds.level>=X)&&(X=this._surface.layerViewByIndex(Q,f.LayerClass.ELEVATION),X=x.getLayerWithExtentRange(X),F.fallsWithinLayer(this,X,!1))){X=H;var aa=!1;if(ba.data)Q=ba.data,X.min=Q.bounds[0],X.max=Q.bounds[1],X.hasNoDataValues=Q.hasNoDataValues,X.level=this.level,aa=!0;else{let ea=0,ia,ka;for(let la=this._parent;la&&(!ka||ea<A.getElevationDesiredResolutionLevel(this.level))&&!(ea=this.vlevel-la.level,ia=ka||ia,ka=la.layerInfo[f.LayerClass.ELEVATION][Q].data,!ka&&ia&&ea>=A.getElevationDesiredResolutionLevel(this.level));la=
la.parent);if(ka=ka||ia)ka.computeMinMaxValue(this.lij[0],this.lij[1],this.lij[2],X),Infinity!==X.min&&(X.level=ka.level,aa=!0)}aa&&(n.isNone(ba.elevationBounds)&&(ba.elevationBounds=new k.ElevationBounds),ba.elevationBounds.copyFrom(X))}};W.modifyLayers=function(Q,X,ba){ba=this.layerInfo[ba];for(var aa of ba)aa.loadingAgent&&aa.loadingAgent!==B.TILE_AGENT_DONE&&(K(aa.loadingAgent),aa.loadingAgent=null),aa.waitingAgents.clear();for(aa=0;aa<ba.length;++aa)void 0===Q[aa]&&ba[aa].release();Q=Array(...ba);
aa=X.length;ba.length=aa;for(let ea=0;ea<aa;ea++){const ia=X[ea];ba[ea]=-1<ia?Q[ia]:C.TilePerLayerInfo.acquire(this._surface.upsampleInfoPool)}this.setMemoryDirty()};W.restartAgents=function(Q){this.renderData&&(this._createOrUpdateAgents(0,Q),this.updateRenderData(Q,y.TextureUpdate.FADING))};W.updateAgents=function(Q){if(this.renderData){const X=this.layerInfo[Q];for(const ba of X)ba.loadingAgent===B.TILE_AGENT_DONE&&(ba.loadingAgent=null);this._createOrUpdateAgents(0,Q)}};W.updateAgentSuspension=
function(){for(const Q of f.LayerClasses){const X=this._isSuspended(Q);for(const ba of this.layerInfo[Q])ba.loadingAgent&&ba.loadingAgent!==B.TILE_AGENT_DONE&&(ba.loadingAgent.setSuspension(X),ba.loadingAgent===B.TILE_AGENT_DONE&&this.updateRenderData(Q,y.TextureUpdate.FADING))}};W.removeLayerAgent=function(Q,X){Q=this.layerInfo[X][Q];Q.loadingAgent&&Q.loadingAgent!==B.TILE_AGENT_DONE&&Q.loadingAgent.dispose();Q.loadingAgent=null};W.agentDone=function(Q,X){const ba=this.layerInfo[X][Q];ba.loadingAgent=
B.TILE_AGENT_DONE;!ba.data&&n.isNone(ba.upsampleInfo)&&this._createOrUpdateAgents(Q+1,X)};W._createOrUpdateAgents=function(Q,X){const ba=this.layerInfo[X];if(0!==ba.length){var aa=(()=>{for(let ia=Q;ia<ba.length;++ia){const ka=this._surface.layerViewByIndex(ia,X);if(x.isBlendableLayerView(ka)&&"normal"!==ka.layer.blendMode)return!0}return!1})(),ea=this._isSuspended(X);for(let ia=Q;ia<ba.length;++ia){const ka=ba[ia];let la=!1;const Z=this._surface.layerViewByIndex(ia,X),ca=x.getLayerWithExtentRange(Z);
ka.loadingAgent?F.fallsWithinLayer(this,ca,!1)?(ka.loadingAgent!==B.TILE_AGENT_DONE&&ka.loadingAgent.setSuspension(ea),ka.loadingAgent!==B.TILE_AGENT_DONE&&(la=ka.loadingAgent.update())):ka.dispose():F.fallsWithinLayer(this,ca,!1)&&(ka.loadingAgent=O(this,ia,X,ea),(la=ka.loadingAgent.startLoading())?ka.loadingAgent===B.TILE_AGENT_DONE&&this.setPendingUpdate(E.TileUpdate.GEOMETRY):(K(ka.loadingAgent),ka.loadingAgent=B.TILE_AGENT_DONE));ka.loadingAgent===B.TILE_AGENT_DONE&&this.updateRenderData(X,y.TextureUpdate.FADING);
if(!aa&&la&&Z.isOpaque)break}}};W._isWithinExtent=function(Q){const X=this.extent;return X[0]>=Q[0]&&Q[2]>=X[2]&&X[1]>=Q[1]&&Q[3]>=X[3]};W.intersectsExtent=function(Q){const X=this.extent;return X[2]>=Q[0]&&Q[2]>=X[0]&&X[3]>=Q[1]&&Q[3]>=X[1]};W.getElevationBasedVerticesPerSide=function(Q){const X=this.vlevel-this.level;Q=Math.max(this.level-Q,A.getElevationDesiredResolutionLevel(this.level)-X);return c.clamp((this.maxTesselation>>Q)+1,2,this.maxTesselation+1)};W._findLIJ=function(Q,X){if(!Q)return null;
var ba=this.surface.rootTiles;if(n.isSome(ba))for(var aa of ba){ba=aa.level;var ea=Q[0];ba>ea?ba=!1:(ba=ea-ba,ea=Math.floor(Q[2]/2**ba),ba=Math.floor(Q[1]/2**ba)===aa.lij[1]&&ea===aa.lij[2]);if(ba){for(ba=Q[0]-aa.level-1;0<=ba&&!aa.isLeaf&&!X(aa);)aa=aa.children[2*(Q[1]>>ba&1)+(Q[2]>>ba&1)],ba--;return X(aa)?aa:null}}return null};W.findNeighborTile=function(Q,X){const ba=this.lij;return(Q=this.getNeighborLIJ(ba,Q))?ba[0]===Q[0]&&ba[1]===Q[1]&&ba[2]===Q[2]?X(this)?this:null:this._findLIJ(Q,X):null};
W.findCorner=function(Q,X){Q=Q===y.NeighborIndex.NORTH_EAST?1:Q===y.NeighborIndex.NORTH_WEST?0:Q===y.NeighborIndex.SOUTH_WEST?2:3;let ba=this;for(;!(ba.isLeaf||X&&X(ba));)ba=ba.children[Q];return ba};W.findNeighborCornerTileExact=function(Q,X){var ba;return null==(ba=this.findNeighborTile(Q,aa=>X(aa)||aa.level===this.level))?void 0:ba.findCorner(x.oppositeCorner(Q),X)};W.forAllSubtreeOnSide=function(Q,X){const ba=Q===y.NeighborIndex.NORTH?[0,1]:Q===y.NeighborIndex.NORTH_EAST?[1]:Q===y.NeighborIndex.EAST?
[1,3]:Q===y.NeighborIndex.SOUTH_EAST?[3]:Q===y.NeighborIndex.SOUTH?[2,3]:Q===y.NeighborIndex.SOUTH_WEST?[2]:Q===y.NeighborIndex.WEST?[0,2]:[0],aa=ea=>{X(ea)||ea.isLeaf||ba.forEach(ia=>aa(ea.children[ia]))};aa(this)};W.forallNeighbors=function(Q){x.neighborCornerIndices.forEach(X=>this.findNeighborCornerTileExact(X,Q));x.neighborEdgeIndices.forEach(X=>{var ba;return null==(ba=this.findNeighborTile(X,aa=>aa.level===this.level||Q(aa)))?void 0:ba.forAllSubtreeOnSide(x.oppositeEdge(X),Q)})};W.getNeighborEdgeStartVertexIndex=
function(Q,X){X=null!=X?X:this.findNeighborTile(x.neighborEdgeIndices[Q],ea=>ea.isLoaded);if(!X||!this.isLoaded||!X.isLoaded)return 0;var ba=this.level-X.level;if(0===ba)return 0;ba=2**ba;const aa=(Q=1===(Q&1))?0:1;X=this.lij[aa+1]-X.lij[aa+1]*ba;return Q?ba-1-X:X};W._updateNeighborsWithChangedEdgeResolution=function(){for(let X=0;4>X;++X)if(this.renderData.geometryState.neighborData.modifiedEdgeResolutions[X]){var Q=x.neighborEdgeIndices[X];const ba=this.findNeighborTile(Q,aa=>aa.isLoaded||aa.level===
this.level);if(ba){if(!ba.isLoaded){x.internalAssert(!ba.isLeaf);const aa=(X+2)%4;Q=x.oppositeEdge(Q);ba.forAllSubtreeOnSide(Q,ea=>{if(ea.isLoaded)return ea.updateEdgeAfterResolutionChange(aa),!0;x.internalAssert(!ea.isLeaf);return!1})}this.renderData.geometryState.neighborData.modifiedEdgeResolutions[X]=!1}}};W.updateNeighborDataAndGeometryIfNeeded=function(){this.isLoaded&&this.renderData.updateNeighborDataAndGeometryIfNeeded()};W.updateNeighborsAfterGeometryChange=function(Q=this.level){this.forEachLoadedNeighbor(X=>
this._updateNeighbor(X));x.neighborEdgeIndices.forEach(X=>{X=this.findNeighborTile(X,ba=>ba.isLoaded&&ba.level<Q);null==X?void 0:X.updateNeighborsWithChangedEdgeResolution()})};W.updateNeighborsWithChangedEdgeResolution=function(){this.isLoaded&&this._updateNeighborsWithChangedEdgeResolution()};W.updateEdgeAfterResolutionChange=function(Q){this.renderData.updateEdgeAfterResolutionChange(Q)};W.forEachLoadedNeighbor=function(Q){const X=this.level,ba=aa=>aa.level===X||aa.isLoaded;x.neighborEdgeIndices.forEach((aa,
ea)=>{var ia,ka;const la=this.findNeighborTile(aa,ba);null!=la&&la!==this&&la.forAllSubtreeOnSide(x.oppositeEdge(aa),Z=>Z.isLoaded?(Q(Z),!0):!1);(aa=null==(ia=this.renderData)?void 0:null==(ka=ia.geometryState)?void 0:ka.neighborData)&&(aa.modifiedEdgeResolutions[ea]=!1)});x.neighborCornerIndices.forEach(aa=>{var ea;const ia=null==(ea=this.findNeighborTile(aa,ba))?void 0:ea.findCorner(x.oppositeCorner(aa),ka=>ka.isLoaded);x.internalAssert(!ia||R(this,ia,aa));null!=ia&&ia.isLoaded&&Q(ia)})};W._updateNeighbor=
function(Q){null!=Q&&Q.isLoaded&&Q.updateNeighborDataAndGeometryIfNeeded()};W.getNeighborLIJ=function(Q,X){const ba=x.isNorth(X)?-1:x.isSouth(X)?1:0;X=x.isWest(X)?-1:x.isEast(X)?1:0;Q=[Q[0],Q[1]+ba,Q[2]+X];return 0>Q[1]?null:this.surface.isGlobal?this.wrapLIJ(Q):0>Q[2]?null:Q};W.wrapLIJ=function(Q){return!Q||0>Q[1]||Q[1]>=2**Q[0]?null:this.surface.wrapEastWest(Q)};W.compareLIJs=function(Q){const X=this.lij;var ba=X[0],aa=Q[0];if(ba===aa)return[X,Q];const ea=ba-aa;if(0>ea)return ba=2**-ea,[[aa,X[1]*
ba,X[2]*ba],Q];aa=2**ea;return[X,[ba,Q[1]*aa,Q[2]*aa]]};W.checkGeometryWaterproofness=function(){x.ENABLE_WATERPROOFNESS_TESTS&&(x.internalAssert(this.isLoaded),this.renderData.checkGeometryWaterproofness())};W.shouldHaveNeighbor=function(Q){const X=this.extent,ba=this.surface.rootTilesExtent,aa=.25*(X[2]-X[0]);if(x.isNorth(Q)&&X[3]+aa>=ba[3]||x.isSouth(Q)&&X[1]-aa<=ba[1])return!1;const ea=this.surface.isGlobal;return!ea&&x.isWest(Q)&&X[0]-aa<=ba[0]||!ea&&x.isEast(Q)&&X[2]+aa>=ba[2]?!1:!0};b._createClass(U,
[{key:"isCached",get:function(){return!this.shouldLoad&&0>=this._mapDataRefCount}},{key:"maxTesselation",get:function(){return this._maxTesselation}},{key:"isWithinClippingArea",get:function(){return this._isWithinClippingArea}},{key:"intersectsClippingArea",get:function(){return this._intersectsClippingArea}},{key:"clippingArea",get:function(){return this._clippingArea}},{key:"parent",get:function(){return this._parent}},{key:"children",get:function(){return this._children}},{key:"surface",get:function(){return this._surface}},
{key:"elevationBounds",get:function(){return this._elevationBounds}},{key:"level",get:function(){return this.lij[0]}},{key:"key",get:function(){return`${this.lij[0]}/${this.lij[1]}/${this.lij[2]}`}},{key:"edgeLen",get:function(){return this._edgeLen}},{key:"radius",get:function(){return this._center[a.CenterPosition.MIDDLE][3]}},{key:"screenDepth",get:function(){return this._screenDepth}},{key:"visible",get:function(){this._dirty&&this.computeVisibility();return this._visible}},{key:"loadable",get:function(){return this.visible||
this._surface.view.state.fixedContentCamera}},{key:"rendered",get:function(){const Q=!!this.renderData;Q!==this._previouslyRendered&&(this._surface.emit("tiles-visibility-changed"),this._previouslyRendered=Q,this._surface.renderer.setNeedsRender());return Q}},{key:"shouldLoad",get:function(){if(!this.loadable)return!1;if(this._surface.lodSnapping===y.LODSnapping.ON){const Q=this.level-this._surface.snapLevel;if(0===Q)return!0;if(1===Q)return!1}return this.isLeaf}},{key:"usedMemory",get:function(){return this._ensureUsedMemory()+
(this.isCached?0:this._mapTileMemory)}},{key:"cachedMemory",get:function(){return this.isCached?this.mapTileMemory:0}},{key:"mapTileMemory",get:function(){this._ensureUsedMemory();return this.layerInfo[f.LayerClass.MAP].reduce((Q,X)=>Q+(X instanceof t.VectorTile?X.memoryUsage:0),this._mapTileMemory)}},{key:"cpuImageMemorySize",get:function(){const Q=this._surface.tilingScheme.pixelSize;return Q*Q*4}},{key:"isLoaded",get:function(){var Q,X;return null!=(Q=null==(X=this.renderData)?void 0:X.hasGeometry)?
Q:!1}},{key:"updating",get:function(){if(this.hasPendingUpdates)return!0;for(const Q of f.LayerClasses){const X=this.layerInfo[Q];for(const ba of X)if(ba.loadingAgent&&ba.loadingAgent!==B.TILE_AGENT_DONE&&ba.loadingAgent.updating)return!0}return!1}},{key:"hasPendingUpdates",get:function(){return 0!==this._pendingUpdates}},{key:"isLeaf",get:function(){return null==this._children[0]}},{key:"test",get:function(){return{cachedMemory:this.cachedMemory}}},{key:"westNeighborWestExtent",get:function(){return this.extent[0]*
(this.isWestEnd?-1:1)}},{key:"eastNeighborEastExtent",get:function(){return this.extent[2]*(this.isEastEnd?-1:1)}},{key:"isEastEnd",get:function(){return this.lij[2]===this.surface.lijEastEnd(this.level)-1}},{key:"isWestEnd",get:function(){return 0===this.lij[2]}},{key:"isNorthEnd",get:function(){return 0===this.lij[1]}},{key:"isSouthEnd",get:function(){return this.extent[1]+d.EPSILON>=this.surface.extent[1]}}]);return U}();const S=new l(w.MapTileAgent),T=new l(r.ElevationTileAgent),H=new k.ElevationBounds;
a.CenterPosition=void 0;(function(U){U[U.TOP=0]="TOP";U[U.MIDDLE=1]="MIDDLE";U[U.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SplitLimits=function(){this.angledSplitBias=this.maxLod=this.relativeHeightLimit=this.relativeWidthLimit=this.fovY=this.fovX=0;this.aboveGround=!0};a.Tile=V;a.almostEquals=L;a.isCornerNeighbor=R;a.isEdgeNeighbor=function(U,W,Q){if(n.isNone(U)||n.isNone(W))return!1;if(0===U.level&&0===W.level&&(U.isEastEnd&&W.isWestEnd&&Q===y.NeighborIndex.EAST||U.isWestEnd&&
W.isEastEnd&&Q===y.NeighborIndex.WEST))return!0;const X=1E-6*(U.extent[2]-U.extent[0]);switch(Q){case y.NeighborIndex.NORTH:return L(U.extent[3],W.extent[1],X);case y.NeighborIndex.SOUTH:return L(U.extent[1],W.extent[3],X);case y.NeighborIndex.EAST:return L(U.extent[2],W.extent[0],X)||L(U.extent[2],-W.extent[0],X);case y.NeighborIndex.WEST:return L(U.extent[0],W.extent[2],X)||L(U.extent[0],-W.extent[2],X)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/terrain/ElevationTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,n){n=function(l){function u(){var v=l.apply(this,arguments)||this;v._scaleRangeEnabled=!1;return v}b._inheritsLoose(u,l);b._createClass(u,[{key:"_desiredMinLevelDelta",get:function(){return c.getElevationDesiredResolutionLevel(this.tile.level)-(this.tile.vlevel-this.tile.level)}},{key:"_progressiveLevelModulo",get:function(){return 0}}]);
return u}(n.TileAgent);a.ElevationTileAgent=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileAgent":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ./interfaces ./TerrainConst ./terrainUtils ./tileUtils".split(" "),function(a,b,c,n,l,u,v){let m=function(){function e(){}var g=e.prototype;g.init=function(p,t,q,k){this.tile=p;this._layerIdx=t;this._layerClass=q;this._suspended=k;this._tileLayerInfo=
p.getLayerInfo(t,q);this._tileRequested=null;p=this._findAncestorWithData();this._setUpsampleTile(p)};g.startLoading=function(){return this._requestNext()};g.dispose=function(){this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this),this._tileRequested=null);this._tileLayerInfo=this.tile=null};g.setSuspension=function(p){p!==this._suspended&&((this._suspended=p)?this._tileRequested&&(this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,
this),this._tileRequested=null):this._tileLayerInfo.data||this.update())};g.update=function(){const p=this._findAncestorWithData();this._setUpsampleTile(p);return this._requestNext()};g.dataArrived=function(p){this._setUpsampleTile(p);this._tileRequested=null;p===this.tile?this.tile.updateRenderData(this._layerClass,n.TextureUpdate.FADING):this._requestNext()};g.dataMissing=function(){this._tileRequested=null;this._tileLayerInfo.data=null;this._requestNext()};g._agentDone=function(){this.tile.agentDone(this._layerIdx,
this._layerClass);this.dispose()};g._requestNext=function(){if(this._suspended)return!0;const p=this._findNextDownload();if(this._tileRequested){if(p===this._tileRequested)return!0;this._tileRequested.unrequestLayerData(this._layerIdx,this._layerClass,this);this._tileRequested=null}c.isSome(p)?p.requestLayerData(this._layerIdx,this._layerClass,this)&&(this._tileRequested=p):this._agentDone();return!!this._tileRequested};g._findNextDownload=function(){const p=this._layerIdx,t=this._layerClass;var q=
this.tile.surface.layerViewByIndex(p,t);const k=u.getLayerWithExtentRange(q),{minLevel:r,maxLevel:y}=q.dataLevelRange;q=this._desiredMinLevelDelta;const f=this._progressiveLevelModulo+q,w=this._scaleRangeEnabled?v.fallsWithinLayer:()=>!0;let z=this.tile;const A=z.level;let x;var B=this._tileLayerInfo.upsampleInfo;const C=c.isSome(B)?B.tile.level:-1;B=c.isSome(B)?C-A>=q:!1;const D=c.get(k,"tilemapCache");for(;z&&w(z,k,!1)&&z.level>=r;){const E=z.level,F=A-E,G=z.layerInfo[t][p];if(G.data&&F>=q){(!B||
E>C)&&this._setUpsampleTile(z);G.dataInvalidated&&(x=z);break}if((c.isNone(D)||"unavailable"!==D.getAvailability(z.lij[0],z.lij[1],z.lij[2]))&&E<=y&&!G.data&&!G.dataMissing){if(c.isNone(x)||z.level===r||0===E%l.PROGRESSIVE_LOADING_MODULO||A-x.level<q)x=z;if(F>=f)break}z=z.parent}c.isSome(x)&&A-x.level<q&&this._tileLayerInfo.upsampleInfo&&(x=null);return x};g._findAncestorWithData=function(){const p=this.tile.vlevel,t=this._desiredMinLevelDelta;let q;for(let k=this.tile;k;k=k.parent)if(k.hasLayerData(this._layerIdx,
this._layerClass)){if(p-k.level>=t)return k;q=k}return q};g._setUpsampleTile=function(p){this._tileLayerInfo.setUpsampleInfo(this.tile,p);this.tile.updateRenderData(this._layerClass,n.TextureUpdate.FADING)};b._createClass(e,[{key:"updating",get:function(){return!!this._tileRequested}},{key:"test",get:function(){return{findNextDownload:()=>this._findNextDownload(),tileLayerInfo:this._tileLayerInfo}}}]);return e}();var h=function(e){function g(){return e.apply(this,arguments)||this}b._inheritsLoose(g,
e);g.prototype.dispose=function(){};b._createClass(g,[{key:"_desiredMinLevelDelta",get:function(){throw d;}},{key:"_progressiveLevelModulo",get:function(){throw d;}}]);return g}(m);const d=Error("Abstract method called on TileAgent");h=new h;a.TILE_AGENT_DONE=h;a.TileAgent=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/tileUtils":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../core/maybe","../../../core/PooledArray"],
function(a,b,c,n){function l(d,e){e(d);if(!d.isLeaf)for(const g of d.children)l(g,e)}function u(d,e){return d.lij[0]-e.lij[0]||d.lij[1]-e.lij[1]||d.lij[2]-e.lij[2]}function v(d,e,g){const p=d.screenDepth,t=e.screenDepth;return p<t?-g:p>t?g:u(d,e)}let m=function(){function d(){this._queue=new n;this._last=null;this.remove=()=>{}}var e=d.prototype;e.resetOne=function(g){this._queue.clear();this._queue.push(g);this._last=null};e.reset=function(g=null){this._queue.clear();c.isSome(g)&&this._queue.pushArray(g);
this._last=null};e.skipSubtree=function(){this._last=null};e.next=function(){this._last&&!this._last.isLeaf&&this._queue.pushArray(this._last.children);return this._last=this._queue.pop()};b._createClass(d,[{key:"done",get:function(){return 0===this._queue.length&&(!this._last||this._last.isLeaf)}}]);return d}(),h=function(){function d(){this.q=new n}var e=d.prototype;e.reset=function(g){this.q.clear();if(!c.isNone(g))for(this.q.pushArray(g),g=0;g<this.q.length;++g){const p=this.q.data[g];p.isLeaf||
this.q.pushArray(p.children)}};e.next=function(){return this.q.pop()};b._createClass(d,[{key:"done",get:function(){return 0===this.q.length}}]);return d}();a.IteratorPostorder=h;a.IteratorPreorder=m;a.compareTiles=v;a.computeUpsampleInfo=function(d,e,g){let p=1,t=0,q=0;for(;d!==e;)if(p*=.5,t*=.5,q*=.5,d.lij[2]&1&&(t+=.5),0===(d.lij[1]&1)&&(q+=.5),d=d.parent,null==d)throw Error("tile was not a descendant of upsampleTile");g.init(e,t,q,p)};a.fallsWithinLayer=function(d,e,g){if(c.isNone(e)||c.isNone(e.fullExtent))return!1;
const p=e.fullExtent,t=d.extent;if(g){if(t[0]<p.xmin||t[1]<p.ymin||t[2]>p.xmax||t[3]>p.ymax)return!1}else if(p.xmin>t[2]||p.ymin>t[3]||p.xmax<t[0]||p.ymax<t[1])return!1;d=d.surface.tilingScheme.levels[d.level].scale;return 0<e.minScale&&d>1.00000001*e.minScale||0<e.maxScale&&d<.99999999*e.maxScale?!1:!0};a.hasLoadableSiblings=function(d){for(let e=0;e<d.length;e++){const g=d[e],p=g.parent;if(p)for(let t=0;4>t;t++){const q=p.children[t];if(q&&q!==g&&q.loadable)return!0}}return!1};a.sortTiles=function(d,
e){e.sort((g,p)=>v(g,p,d))};a.sortTilesByPOI=function(d,e){const g=new Map;d.forAll(p=>g.set(p.lij,p.distanceToSquared(e)));d.sort((p,t)=>g.get(p.lij)-g.get(t.lij)||u(p,t))};a.tilesAreRelated=function(d,e){if(!d||!e||d[0]===e[0])return!1;const g=d[0]<e[0],p=g?d:e;d=g?e:d;e=1<<d[0]-p[0];return Math.floor(d[1]/e)===p[1]&&Math.floor(d[2]/e)===p[2]};a.traverseTilesPreorder=function(d,e){if(Array.isArray(d))for(let g=0;g<d.length;g++)l(d[g],e);else l(d,e)};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/MapTileAgent":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","./TerrainConst","./TileAgent"],function(a,b,c,n){n=function(l){function u(){var v=l.call(this)||this;v._scaleRangeEnabled=!0;return v}b._inheritsLoose(u,l);b._createClass(u,[{key:"_desiredMinLevelDelta",get:function(){return 0}},{key:"_progressiveLevelModulo",get:function(){return c.PROGRESSIVE_LOADING_MODULO}}]);return u}(n.TileAgent);a.MapTileAgent=
n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/RasterTile":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../chunks/RasterColorizer.glsl ../../webgl/enums ../../webgl/rasterUtils".split(" "),function(a,b,c,n,l,u){const v={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,
colormapOffset:null,stretchType:"none",type:"stretch"};let m=function(){function h(e,g,p=null,t=null){this.type="raster-tile";this._interpolation=this._bandIds=this._symbolizerParameters=this._source=this._memoryUsed=null;this._dirty=!1;this._transformGrid=null;this.isRendereredSource=!1;this.lij=this.rawPixelData=this.symbolizerRenderer=null;this.opacity=1;this.lij=e;this.source=g;this.width=p||g.width;this.height=t||g.height}var d=h.prototype;d.bind=function(e){if(!(this.source&&this.source.pixels&&
0<this.source.pixels.length))return!1;(c.isNone(this._rasterTexture)||this._dirty)&&this._updateRasterTexture(e,this.bandIds);c.isSome(this._rasterTexture)&&(this._updateColormapTexture(e),this.transformGrid&&c.isNone(this._transformGridTexture)&&(this._transformGridTexture=u.createTransformTexture(e,this.transformGrid)));return!0};d.getUniforms=function(){const {symbolizerParameters:e,transformGrid:g,width:p,height:t,opacity:q}=this,k=u.getCommonUniforms(g,[p,t],[this.source.width,this.source.height],
q),r=u.getColormapUniforms(e.colormap,e.colormapOffset),y="stretch"===this.symbolizerParameters.type?u.getStretchUniforms(this.symbolizerParameters):null,f="hillshade"===this.symbolizerParameters.type?u.getShadedReliefUniforms(this.symbolizerParameters):null;return new n.ColorizerUniforms(k,r,y||f,this._rasterTexture,this._transformGridTexture,this._colormapTexture)};d.release=function(){this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);
this._colormapTexture=c.disposeMaybe(this._colormapTexture);this.rawPixelData=this.transformGrid=this.source=null;return!0};d._updateRasterTexture=function(e,g){const p=this.source?this.source.extractBands(g):null;p&&p.pixels&&0<p.pixels.length?(g=c.isNone(g)&&c.isNone(this.bandIds)||c.isSome(g)&&c.isSome(this.bandIds)&&g.join("")===this.bandIds.join(""),c.isSome(this._rasterTexture)&&g||(this._rasterTexture=c.disposeMaybe(this._rasterTexture),g=this._getRasterTextureInterpolation(this.interpolation),
this._rasterTexture=u.createRasterTexture(e,p,g,this.isRendereredSource||this.hasStretchTypeNone()))):this._rasterTexture=c.disposeMaybe(this._rasterTexture)};d.hasStretchTypeNone=function(){return"stretchType"in this.symbolizerParameters&&"none"===this.symbolizerParameters.stretchType&&!this.symbolizerParameters.useGamma&&"u8"===this.source.pixelType};d._getRasterTextureInterpolation=function(e){return"lut"===this.symbolizerParameters.type||"nearest"===e||"majority"===e?"nearest":"bilinear"};d._updateColormapTexture=
function(e){const g=this._colormap,p=this.symbolizerParameters.colormap;if(!p)this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormap=null;else if(!g)this._colormapTexture=u.createColormapTexture(e,p),this._colormap=p;else if(p.length!==g.length||p.some((t,q)=>t!==g[q]))this._colormapTexture=c.disposeMaybe(this._colormapTexture),this._colormapTexture=u.createColormapTexture(e,p),this._colormap=p};b._createClass(h,[{key:"source",get:function(){return this._source},set:function(e){this._source=
e;this._rasterTexture=c.disposeMaybe(this._rasterTexture);this._memoryUsed=null}},{key:"symbolizerParameters",get:function(){return this.isRendereredSource?{...v,maxCutOff:[1,1,1],factor:[1,1,1]}:this._symbolizerParameters||v},set:function(e){this._symbolizerParameters=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){c.isSome(e)&&0<e.length?this._bandIds&&e.every((g,p)=>this._bandIds[p]?g===this._bandIds[p]:!1)||(this._bandIds=e,this._dirty=!0):this._bandIds=null}},{key:"interpolation",
get:function(){return this._interpolation||"nearest"},set:function(e){this._interpolation=e;c.isSome(this._rasterTexture)&&(e=this._getRasterTextureInterpolation(e),this._rasterTexture.setSamplingMode("bilinear"===e?l.TextureSamplingMode.LINEAR:l.TextureSamplingMode.NEAREST))}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e;this._transformGridTexture=c.disposeMaybe(this._transformGridTexture);this._memoryUsed=null}},{key:"memoryUsage",get:function(){c.isNone(this._memoryUsed)&&
(this._memoryUsed=[this._rasterTexture,this._transformGridTexture,this._colormapTexture].map(e=>c.isSome(e)?e.descriptor.width*e.descriptor.height*4:0).reduce((e,g)=>e+g,0));return this._memoryUsed}}]);return h}();a.RasterTile=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/RasterColorizer.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/maybe ./vec3f64 ../views/2d/engine/imagery/enums ../views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions ../views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl ../views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ./BlendLayers.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/ColorConversion.glsl ../views/3d/webgl-engine/core/shaderModules/BooleanPassUniform ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/FloatsPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){function B(K){const L=new A.ShaderBuilder;L.include(e.TileComposite);L.include(m.Common);L.include(v.Colormap);K.tileBlendInput===d.TileBlendInput.GridComposite&&(L.extensions.add("GL_OES_standard_derivatives"),L.fragment.include(h.BackgroundGrid));const R=K.tileBlendInput===d.TileBlendInput.ColorComposite;R&&L.fragment.uniforms.add(new r.Float3PassUniform("backgroundColor",N=>N.backgroundColor));K.baseOpacityMode!==g.BaseOpacityMode.One&&L.fragment.uniforms.add(new y.FloatPassUniform("baseOpacity",
N=>N.baseOpacity));const M=K.baseOpacityMode===g.BaseOpacityMode.OnBaseLayer,J=K.baseOpacityMode===g.BaseOpacityMode.OnBackground||K.baseOpacityMode===g.BaseOpacityMode.OnBaseLayer,I=K.blendMode!==u.LayerBlendMode.Normal;L.fragment.include(p.BlendModes,K);const P=K.tileBlendInput!==d.TileBlendInput.LayerOnly;if(I&&!P||M)L.fragment.uniforms.add(new x.Texture2DPassUniform("fboColor",N=>N.fboTexture)),L.fragment.uniforms.add(new y.FloatPassUniform("tileSize",N=>c.isSome(N.fboTexture)?N.fboTexture.descriptor.width:
1));L.fragment.code.add(z.glsl`
    vec4 applyBackgroundBlend(vec4 layerColor) {
      ${P||M?z.glsl`
          vec4 bgColor = ${M?z.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize)`:R?z.glsl`vec4(backgroundColor, 1.0)`:z.glsl`gridColor(vuv)`};
          ${J?z.glsl`bgColor *= baseOpacity;`:""}`:""}
      ${I?z.glsl`
            vec3 pmColorLayer = layerColor.rgb * layerColor.a;
            vec4 fboTex = ${P?z.glsl`bgColor;`:z.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${M?" * baseOpacity":""};`}
            vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
            return applyBlendMode(pmColorLayer.rgb, layerColor.a * u_opacity, Cb, fboTex.a);`:P||M?z.glsl`
            float composeAlpha = layerColor.a * u_opacity;
            vec4 pmColorLayer = vec4(layerColor.rgb, 1.0);
            return mix(bgColor, pmColorLayer, composeAlpha);`:z.glsl`
            return layerColor * layerColor.a * u_opacity;`}
    }
  `);K.colorizerType===l.RasterColorizerType.Stretch?C(L,K):K.colorizerType===l.RasterColorizerType.Lut?L.fragment.code.add(z.glsl`void main() {
vec2 pixelLocation = getPixelLocation(uv);
if (isOutside(pixelLocation)) {
gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
return;
}
vec4 currentPixel = getPixel(pixelLocation);
gl_FragColor = applyBackgroundBlend(colormap(currentPixel, true));
}`):K.colorizerType===l.RasterColorizerType.Hillshade&&D(L,K);return L}function C(K,L){K.fragment.uniforms.add([new w.IntegerPassUniform("u_bandCount",M=>M.symbolizer.u_bandCount),new f.FloatsPassUniform("u_minCutOff",M=>M.symbolizer.u_minCutOff,3),new f.FloatsPassUniform("u_maxCutOff",M=>M.symbolizer.u_maxCutOff,3),new f.FloatsPassUniform("u_factor",M=>M.symbolizer.u_factor,3),new y.FloatPassUniform("u_minOutput",M=>M.symbolizer.u_minOutput),new y.FloatPassUniform("u_maxOutput",M=>M.symbolizer.u_maxOutput),
new q.BooleanPassUniform("u_useGamma",M=>M.symbolizer.u_useGamma),new f.FloatsPassUniform("u_gamma",M=>M.symbolizer.u_gamma,3),new f.FloatsPassUniform("u_gammaCorrection",M=>M.symbolizer.u_gammaCorrection,3),new y.FloatPassUniform("u_opacity",M=>M.common.u_opacity)]);K.fragment.code.add(z.glsl`float stretchOneValue(float val, float minCutOff, float maxCutOff, float minOutput, float maxOutput, float factor, bool useGamma, float gamma, float gammaCorrection) {
if (val >= maxCutOff) {
return maxOutput;
} else if (val <= minCutOff) {
return minOutput;
}
float stretchedVal;
if (useGamma) {
float tempf = 1.0;
float outRange = maxOutput - minOutput;
float relativeVal = (val - minCutOff) / (maxCutOff - minCutOff);
if (gamma > 1.0) {
tempf -= pow(1.0 / outRange, relativeVal * gammaCorrection);
}
stretchedVal = (tempf * outRange * pow(relativeVal, 1.0 / gamma) + minOutput) / 255.0;
} else {
stretchedVal = minOutput + (val - minCutOff) * factor;
}
return stretchedVal;
}`);const R=L.applyColormap?z.glsl`gl_FragColor = applyBackgroundBlend(colormap(vec4(grayVal, grayVal, grayVal, currentPixel.a), !u_useGamma));`:z.glsl`gl_FragColor = applyBackgroundBlend(vec4(grayVal, grayVal, grayVal, currentPixel.a));`;K.fragment.code.add(z.glsl`
      void main() {
        vec2 pixelLocation = getPixelLocation(uv);
        if (isOutside(pixelLocation)) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }

        vec4 currentPixel = getPixel(pixelLocation);
        ${L.stretchType===l.RasterColorizerStretchType.Noop?z.glsl`
        gl_FragColor = applyBackgroundBlend(currentPixel);`:z.glsl`
        if (currentPixel.a == 0.0) {
          gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
          return;
        }
        if (u_bandCount == 1) {
          float grayVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          ${R}
        } else {
          float redVal = stretchOneValue(currentPixel.r, u_minCutOff[0], u_maxCutOff[0], u_minOutput, u_maxOutput, u_factor[0], u_useGamma, u_gamma[0], u_gammaCorrection[0]);
          float greenVal = stretchOneValue(currentPixel.g, u_minCutOff[1], u_maxCutOff[1], u_minOutput, u_maxOutput, u_factor[1], u_useGamma, u_gamma[1], u_gammaCorrection[1]);
          float blueVal = stretchOneValue(currentPixel.b, u_minCutOff[2], u_maxCutOff[2], u_minOutput, u_maxOutput, u_factor[2], u_useGamma, u_gamma[2], u_gammaCorrection[2]);
          gl_FragColor = applyBackgroundBlend(vec4(redVal, greenVal, blueVal, currentPixel.a));
        }`}
      }`)}function D(K,L){K=K.fragment;K.uniforms.add([new x.Texture2DPassUniform("u_image",R=>R.u_image),new w.IntegerPassUniform("u_hillshadeType",R=>R.symbolizer.u_hillshadeType),new f.FloatsPassUniform("u_sinZcosAs",R=>R.symbolizer.u_sinZcosAs,6),new f.FloatsPassUniform("u_sinZsinAs",R=>R.symbolizer.u_sinZsinAs,6),new f.FloatsPassUniform("u_cosZs",R=>R.symbolizer.u_cosZs,6),new f.FloatsPassUniform("u_weights",R=>R.symbolizer.u_weights,6),new k.Float2PassUniform("u_factor",R=>R.symbolizer.u_factor),
new y.FloatPassUniform("u_minValue",R=>R.symbolizer.u_minValue),new y.FloatPassUniform("u_maxValue",R=>R.symbolizer.u_maxValue),new k.Float2PassUniform("u_srcImageSize",R=>R.common.u_srcImageSize)]);K.include(t.ColorConversion);K.code.add(z.glsl`vec4 overlay(float val, float minValue, float maxValue, float hillshade, float alpha) {
val = clamp((val - minValue) / (maxValue - minValue), 0.0, 1.0);
vec3 hsv = rgb2hsv(colormap(vec4(val, val, val, 1.0), false).rgb);
hsv.z = hillshade;
return vec4(hsv2rgb(hsv) * alpha, alpha);
}`);K.code.add(z.glsl`float getNeighborHoodAlpha(float a, float b, float c, float d, float e, float f, float g, float h, float i){
if (a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0 || a == 0.0 || a == 0.0 || a==0.0) {
return 0.0;
}  else {
return e;
}
}`);L=L.applyColormap?z.glsl`gl_FragColor = applyBackgroundBlend(overlay(ve.r, u_minValue, u_maxValue, hillshade, alpha));`:z.glsl`hillshade *= alpha;
gl_FragColor = applyBackgroundBlend(vec4(hillshade, hillshade, hillshade, alpha));`;K.code.add(z.glsl`
    void main() {
      vec2 pixelLocation = getPixelLocation(uv);
      if (isOutside(pixelLocation)) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      vec4 currentPixel = getPixel(pixelLocation);
      if (currentPixel.a == 0.0) {
        gl_FragColor = applyBackgroundBlend(vec4(0.0, 0.0, 0.0, 0.0));
        return;
      }

      //mirror edge pixels
      vec2 axy = vec2(-1.0, -1.0);
      vec2 bxy = vec2(0.0, -1.0);
      vec2 cxy = vec2(1.0, -1.0);
      vec2 dxy = vec2(-1.0, 0.0);
      vec2 fxy = vec2(1.0, 0.0);
      vec2 gxy = vec2(-1.0, 1.0);
      vec2 hxy = vec2(0.0, 1.0);
      vec2 ixy = vec2(1.0, 1.0);
      vec2 onePixel = 1.0 / u_srcImageSize;
      if (pixelLocation.s < onePixel.s) {
        axy[0] = 1.0;
        dxy[0] = 1.0;
        gxy[0] = 1.0;
      }
      if (pixelLocation.t < onePixel.t) {
        axy[1] = 1.0;
        bxy[1] = 1.0;
        cxy[1] = 1.0;
      }
      if (pixelLocation.s > 1.0 - onePixel.s) {
        cxy[0] = -1.0;
        fxy[0] = -1.0;
        ixy[0] = -1.0;
      }
      if (pixelLocation.t > 1.0 - onePixel.t) {
        gxy[1] = -1.0;
        hxy[1] = -1.0;
        ixy[1] = -1.0;
      }

      // calculate hillshade
      vec4 va = texture2D(u_image, pixelLocation + onePixel * axy);
      vec4 vb = texture2D(u_image, pixelLocation + onePixel * bxy);
      vec4 vc = texture2D(u_image, pixelLocation + onePixel * cxy);
      vec4 vd = texture2D(u_image, pixelLocation + onePixel * dxy);
      vec4 ve = texture2D(u_image, pixelLocation);
      vec4 vf = texture2D(u_image, pixelLocation + onePixel * fxy);
      vec4 vg = texture2D(u_image, pixelLocation + onePixel * gxy);
      vec4 vh = texture2D(u_image, pixelLocation + onePixel * hxy);
      vec4 vi = texture2D(u_image, pixelLocation + onePixel * ixy);

      // calculate the rate of z change along the x, y, and diagonal direction
      float dzx = (vc + 2.0 * vf + vi - va - 2.0 * vd - vg).r * u_factor.s;
      float dzy = (vg + 2.0 * vh + vi - va - 2.0 * vb - vc).r * u_factor.t;
      float dzd = sqrt(1.0 + dzx * dzx + dzy * dzy);
      float hillshade = 0.0;

      // traditional single light source
      if (u_hillshadeType == 0){
        float cosDelta = u_sinZsinAs[0] * dzy - u_sinZcosAs[0] * dzx;
        float z = (u_cosZs[0] + cosDelta) / dzd;
        if (z < 0.0)  z = 0.0;
        hillshade = z;
      } else {
        // multi-directional with 6 light sources
        for (int k = 0; k < 6; k++) {
        float cosDelta = u_sinZsinAs[k] * dzy - u_sinZcosAs[k] * dzx;
        float z = (u_cosZs[k] + cosDelta) / dzd;
        if (z < 0.0) z = 0.0;
        hillshade = hillshade + z * u_weights[k];
        if (k == 5) break;
        }
      }

      // set color
      float alpha = getNeighborHoodAlpha(va.a, vb.a, vc.a, vd.a, ve.a, vf.a, vg.a, vh.a, vi.a);
      alpha *= u_opacity;
      ${L}
    }
  `)}let E=function(K){function L(R,M,J,I,P,N){R=K.call(this,R,I,P)||this;R.colormap=M;R.symbolizer=J;R.u_colormap=N;R.backgroundColor=n.ZEROS;R.fboTexture=null;R.baseOpacity=1;return R}b._inheritsLoose(L,K);return L}(m.CommonPassParameters),F=function(K){function L(){return K.apply(this,arguments)||this}b._inheritsLoose(L,K);return L}(E),G=function(K){function L(){return K.apply(this,arguments)||this}b._inheritsLoose(L,K);return L}(E);const O=Object.freeze(Object.defineProperty({__proto__:null,ColorizerUniforms:E,
ColorizerStretchUniforms:F,ColorizerHillshadeUniforms:G,build:B},Symbol.toStringTag,{value:"Module"}));a.ColorizerHillshadeUniforms=G;a.ColorizerStretchUniforms=F;a.ColorizerUniforms=E;a.RasterColorizer=O;a.build=B})},"esri/views/2d/engine/imagery/enums":function(){define(["exports"],function(a){a.RasterColorizerType=void 0;(function(b){b[b.Stretch=0]="Stretch";b[b.Lut=1]="Lut";b[b.Hillshade=2]="Hillshade";b[b.COUNT=3]="COUNT"})(a.RasterColorizerType||(a.RasterColorizerType={}));a.RasterColorizerStretchType=
void 0;(function(b){b[b.Noop=0]="Noop";b[b.PerBand=1]="PerBand";b[b.COUNT=2]="COUNT"})(a.RasterColorizerStretchType||(a.RasterColorizerStretchType={}));Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions":function(){define(["exports"],function(a){a.AlphaBlendMode=void 0;(function(b){b[b.OneMinusSourceAlpha=0]="OneMinusSourceAlpha";b[b.SourceAlpha=1]="SourceAlpha";b[b.COUNT=2]="COUNT"})(a.AlphaBlendMode||
(a.AlphaBlendMode={}));a.LayerBlendMode=void 0;(function(b){b[b.Normal=0]="Normal";b[b.Average=1]="Average";b[b.Lighten=2]="Lighten";b[b.Lighter=3]="Lighter";b[b.Plus=4]="Plus";b[b.Screen=5]="Screen";b[b.ColorDodge=6]="ColorDodge";b[b.Darken=7]="Darken";b[b.Multiply=8]="Multiply";b[b.ColorBurn=9]="ColorBurn";b[b.Overlay=10]="Overlay";b[b.SoftLight=11]="SoftLight";b[b.HardLight=12]="HardLight";b[b.VividLight=13]="VividLight";b[b.Hue=14]="Hue";b[b.Saturation=15]="Saturation";b[b.Luminosity=16]="Luminosity";
b[b.Color=17]="Color";b[b.DestinationOver=18]="DestinationOver";b[b.DestinationAtop=19]="DestinationAtop";b[b.DestinationIn=20]="DestinationIn";b[b.DestinationOut=21]="DestinationOut";b[b.SourceAtop=22]="SourceAtop";b[b.SourceIn=23]="SourceIn";b[b.SourceOut=24]="SourceOut";b[b.Xor=25]="Xor";b[b.Difference=26]="Difference";b[b.Exclusion=27]="Exclusion";b[b.Minus=28]="Minus";b[b.Invert=29]="Invert";b[b.Reflect=30]="Reflect";b[b.COUNT=31]="COUNT"})(a.LayerBlendMode||(a.LayerBlendMode={}));a.blendModeFromString=
{normal:a.LayerBlendMode.Normal,average:a.LayerBlendMode.Average,lighten:a.LayerBlendMode.Lighten,lighter:a.LayerBlendMode.Lighter,screen:a.LayerBlendMode.Screen,plus:a.LayerBlendMode.Plus,"color-dodge":a.LayerBlendMode.ColorDodge,darken:a.LayerBlendMode.Darken,multiply:a.LayerBlendMode.Multiply,"color-burn":a.LayerBlendMode.ColorBurn,overlay:a.LayerBlendMode.Overlay,"soft-light":a.LayerBlendMode.SoftLight,"hard-light":a.LayerBlendMode.HardLight,"vivid-light":a.LayerBlendMode.VividLight,hue:a.LayerBlendMode.Hue,
saturation:a.LayerBlendMode.Saturation,luminosity:a.LayerBlendMode.Luminosity,color:a.LayerBlendMode.Color,difference:a.LayerBlendMode.Difference,exclusion:a.LayerBlendMode.Exclusion,minus:a.LayerBlendMode.Minus,invert:a.LayerBlendMode.Invert,reflect:a.LayerBlendMode.Reflect,"destination-over":a.LayerBlendMode.DestinationOver,"destination-atop":a.LayerBlendMode.DestinationAtop,"destination-in":a.LayerBlendMode.DestinationIn,"destination-out":a.LayerBlendMode.DestinationOut,"source-atop":a.LayerBlendMode.SourceAtop,
"source-in":a.LayerBlendMode.SourceIn,"source-out":a.LayerBlendMode.SourceOut,xor:a.LayerBlendMode.Xor};a.isCompositeBlendMode=function(b){return b===a.LayerBlendMode.DestinationOver||b===a.LayerBlendMode.DestinationAtop||b===a.LayerBlendMode.DestinationIn||b===a.LayerBlendMode.DestinationOut||b===a.LayerBlendMode.SourceAtop||b===a.LayerBlendMode.SourceIn||b===a.LayerBlendMode.SourceOut||b===a.LayerBlendMode.Xor};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Colormap.glsl":function(){define(["exports","../../shaderModules/FloatPassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,n){a.Colormap=function(l){l.fragment.uniforms.add([new n.Texture2DPassUniform("u_colormap",u=>u.u_colormap),new b.FloatPassUniform("u_colormapOffset",u=>u.colormap.u_colormapOffset),new b.FloatPassUniform("u_colormapMaxIndex",u=>u.colormap.u_colormapMaxIndex),new b.FloatPassUniform("u_opacity",
u=>u.common.u_opacity)]);l.fragment.code.add(c.glsl`vec4 colormap(vec4 currentPixel, bool isFloat) {
float clrIndex = isFloat ? currentPixel.r - u_colormapOffset : currentPixel.r * 255.0 - u_colormapOffset;
vec4 result;
if (currentPixel.a == 0.0 || clrIndex > u_colormapMaxIndex) {
result = vec4(0.0, 0.0, 0.0, 0.0);
} else {
vec2 clrPosition = vec2((clrIndex + 0.5) / (u_colormapMaxIndex + 1.0), 0.0);
result = texture2D(u_colormap, clrPosition);
}
return result;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Common.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ./Projection.glsl ../terrain/TileComposite.glsl ../../shaderModules/BooleanPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),function(a,b,c,n,l,u,v){n=function(m){function h(d,e,g){var p=m.call(this)||this;p.common=
d;p.u_image=e;p.u_transformGrid=g;return p}b._inheritsLoose(h,m);return h}(n.TileCompositePassParameters);a.Common=function(m){m.include(c.Projection);m.fragment.uniforms.add([new v.Texture2DPassUniform("u_image",h=>h.u_image),new l.BooleanPassUniform("u_flipY",h=>h.common.u_flipY),new l.BooleanPassUniform("u_applyTransform",h=>h.common.u_applyTransform)]);m.fragment.code.add(u.glsl`vec2 getPixelLocation(vec2 coords) {
vec2 targetLocation = u_flipY ? vec2(coords.s, 1.0 - coords.t) : coords;
if (!u_applyTransform) {
return targetLocation;
}
return projectPixelLocation(targetLocation);
}
bool isOutside(vec2 coords){
if (coords.t>1.00001 ||coords.t<-0.00001 || coords.s>1.00001 ||coords.s<-0.00001) {
return true;
} else {
return false;
}
}
vec4 getPixel(vec2 pixelLocation) {
return texture2D(u_image, pixelLocation);
}`)};a.CommonPassParameters=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/raster/Projection.glsl":function(){define(["exports","../../shaderModules/Float2PassUniform","../../shaderModules/interfaces","../../shaderModules/Texture2DPassUniform"],function(a,b,c,n){a.Projection=function(l){l.fragment.uniforms.add(new n.Texture2DPassUniform("u_transformGrid",u=>u.u_transformGrid));l.fragment.uniforms.add(new b.Float2PassUniform("u_transformSpacing",
u=>u.common.u_transformSpacing));l.fragment.uniforms.add(new b.Float2PassUniform("u_transformGridSize",u=>u.common.u_transformGridSize));l.fragment.uniforms.add(new b.Float2PassUniform("u_targetImageSize",u=>u.common.u_targetImageSize));l.fragment.code.add(c.glsl`vec2 projectPixelLocation(vec2 coords) {
vec2 index_image = floor(coords * u_targetImageSize);
vec2 oneTransformPixel = vec2(0.25 / u_transformGridSize.s, 1.0 / u_transformGridSize.t);
vec2 index_transform = floor(index_image / u_transformSpacing) / u_transformGridSize;
vec2 pos = fract((index_image + vec2(0.5, 0.5)) / u_transformSpacing);
vec2 srcLocation;
vec2 transform_location = index_transform + oneTransformPixel * 0.5;
if (pos.s <= pos.t) {
vec4 ll_abc = texture2D(u_transformGrid, vec2(transform_location.s, transform_location.t));
vec4 ll_def = texture2D(u_transformGrid, vec2(transform_location.s + oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ll_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ll_def.rgb, vec3(pos, 1.0));
} else {
vec4 ur_abc = texture2D(u_transformGrid, vec2(transform_location.s + 2.0 * oneTransformPixel.s, transform_location.t));
vec4 ur_def = texture2D(u_transformGrid, vec2(transform_location.s + 3.0 * oneTransformPixel.s, transform_location.t));
srcLocation.s = dot(ur_abc.rgb, vec3(pos, 1.0));
srcLocation.t = dot(ur_def.rgb, vec3(pos, 1.0));
}
return srcLocation;;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec2f64 ../../shaderModules/Float2PassUniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../../lib/VertexAttribute".split(" "),function(a,b,c,n,l,u,v){let m=function(h){function d(){var e=h.apply(this,
arguments)||this;e.scale=1;e.offset=c.ZEROS;return e}b._inheritsLoose(d,h);return d}(u.NoParameters);a.TileComposite=function(h){h.attributes.add(v.VertexAttribute.POSITION,"vec2");h.attributes.add(v.VertexAttribute.UV0,"vec2");h.vertex.uniforms.add(new l.FloatPassUniform("scale",d=>d.scale));h.vertex.uniforms.add(new n.Float2PassUniform("offset",d=>d.offset));h.varyings.add("uv","vec2");h.varyings.add("vuv","vec2");h.vertex.code.add(u.glsl`void main(void) {
gl_Position = vec4(position, 0.0, 1.0);
uv = uv0 * scale + offset;
vuv = uv0;
}`)};a.TileCompositePassParameters=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.BackgroundGrid=function(c){c.code.add(b.glsl`
    float lineFactorAtPosition(float value) {
      float pos = value * ${b.glsl.float(257)};
      if(pos < 0.5 || pos > ${b.glsl.float(256.5)}) {
        return 1.0;
      }

      pos = pos + 0.5;
      float modulo = mod(pos, 16.0);
      return modulo <= 2.0 ?  1.0 - abs(modulo - 1.0) : 0.0;
    }

    float lineFactorAtUV(vec2 uv) {
      return max(lineFactorAtPosition(uv.x), lineFactorAtPosition(uv.y));
    }

    float lineFactor(vec2 uv) {
      vec2 offset = fwidth(uv) * 0.25;
      return (lineFactorAtUV(vec2(uv.x + offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y + offset.y)) +
              lineFactorAtUV(vec2(uv.x + offset.x, uv.y - offset.y)) +
              lineFactorAtUV(vec2(uv.x - offset.x, uv.y - offset.y))) / 4.0;
    }

    vec4 gridColor(vec2 uv) {
      float line = lineFactor(uv) * 0.1 + 0.9;
      return vec4(vec3(1.0, 0.972, 0.918) * line, 1.0);
    }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TileBlendInput":function(){define(["exports"],function(a){a.TileBlendInput=void 0;var b=a.TileBlendInput||(a.TileBlendInput={});b[b.LayerOnly=0]="LayerOnly";b[b.ColorComposite=1]="ColorComposite";b[b.GridComposite=2]="GridComposite";b[b.COUNT=3]="COUNT";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/chunks/BlendLayers.glsl":function(){define("exports ../core/maybe ../views/3d/webgl-engine/core/shaderLibrary/output/BlendOptions ../views/3d/webgl-engine/core/shaderLibrary/terrain/BackgroundGrid.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(t){const q=new d.ShaderBuilder;var k=t.output===a.BlendLayersOutput.GridOnly;const r=t.output===a.BlendLayersOutput.GridComposite;var y=r||k,f=t.output===a.BlendLayersOutput.ColorOnly;const w=t.output===a.BlendLayersOutput.ColorComposite;var z=w||f;const A=r||w;q.include(l.TileComposite);z&&q.fragment.uniforms.add(new v.Float3PassUniform("backgroundColor",x=>x.backgroundColor));t.baseOpacityMode!==a.BaseOpacityMode.One&&q.fragment.uniforms.add(new m.FloatPassUniform("baseOpacity",
x=>x.baseOpacity));y&&(q.extensions.add("GL_OES_standard_derivatives"),q.fragment.include(n.BackgroundGrid));if(k||f)return q.fragment.code.add(h.glsl`
    void main() {
      gl_FragColor = ${f?h.glsl`vec4(backgroundColor, 1.0)`:h.glsl`gridColor(uv)`};
    }
  `),q;k=t.blendMode!==c.LayerBlendMode.Normal;y=t.baseOpacityMode===a.BaseOpacityMode.OnBaseLayer;f=t.baseOpacityMode===a.BaseOpacityMode.OnBackground||t.baseOpacityMode===a.BaseOpacityMode.OnBaseLayer;z=t.premultipliedSource;q.fragment.uniforms.add(new e.Texture2DPassUniform("tex",x=>x.texture));q.fragment.uniforms.add(new m.FloatPassUniform("opacity",x=>x.opacity));if(k||y||z)q.fragment.uniforms.add(new e.Texture2DPassUniform("fboColor",x=>x.fboTexture)),q.fragment.uniforms.add(new m.FloatPassUniform("tileSize",
x=>b.isSome(x.fboTexture)?x.fboTexture.descriptor.width:1));q.fragment.include(u.BlendModes,t);q.fragment.code.add(h.glsl`
    void main() {
      ${A||y||z?h.glsl`
      vec4 bgColor = ${w?h.glsl`vec4(backgroundColor, 1.0)`:r?h.glsl`gridColor(uv)`:h.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize)`};
      ${f?h.glsl`bgColor *= baseOpacity;`:""}`:""}
      vec4 colorLayer = texture2D(tex, uv);
      ${k?h.glsl`
          vec4 fboTex = ${A?h.glsl`bgColor;`:h.glsl`texture2D(fboColor, gl_FragCoord.xy / tileSize) ${y?" * baseOpacity":""};`}
          vec3 Cb = fboTex.a == 0.0 ? fboTex.rgb : vec3(fboTex.rgb * fboTex.a);
          gl_FragColor = applyBlendMode(colorLayer.rgb, colorLayer.a * opacity, Cb, fboTex.a);`:h.glsl`
          vec4 pmColorLayer = vec4(colorLayer.xyz, 1.0);
          float composeAlpha = colorLayer.a * opacity;
          gl_FragColor = ${z?h.glsl`bgColor * (1.0 - composeAlpha) + colorLayer * opacity;`:A||y?h.glsl`mix(bgColor, pmColorLayer, composeAlpha);`:h.glsl`pmColorLayer * composeAlpha;`}`}
    }
  `);return q}a.BlendLayersOutput=void 0;(function(t){t[t.Composite=0]="Composite";t[t.ColorOnly=1]="ColorOnly";t[t.GridOnly=2]="GridOnly";t[t.ColorComposite=3]="ColorComposite";t[t.GridComposite=4]="GridComposite";t[t.COUNT=5]="COUNT"})(a.BlendLayersOutput||(a.BlendLayersOutput={}));a.BaseOpacityMode=void 0;(function(t){t[t.One=0]="One";t[t.OnBackground=1]="OnBackground";t[t.OnBaseLayer=2]="OnBaseLayer";t[t.COUNT=3]="COUNT"})(a.BaseOpacityMode||(a.BaseOpacityMode={}));const p=Object.freeze(Object.defineProperty({__proto__:null,
get BlendLayersOutput(){return a.BlendLayersOutput},get BaseOpacityMode(){return a.BaseOpacityMode},build:g},Symbol.toStringTag,{value:"Module"}));a.BlendLayers=p;a.build=g})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/BlendModes.glsl":function(){define(["exports","../output/BlendOptions","../../shaderModules/interfaces"],function(a,b,c){a.BlendModes=function(n,l){l=l.blendMode;if(l!==b.LayerBlendMode.Normal){l===b.LayerBlendMode.Reflect&&n.code.add(c.glsl`float reflectBlend(in float cb, in float cl) {
return (cl == 1.0) ? cl : min(cb * cb / (1.0 - cl), 1.0);
}`);l!==b.LayerBlendMode.ColorDodge&&l!==b.LayerBlendMode.VividLight||n.code.add(c.glsl`float colorDodge(in float cb, in float cl) {
return (cb == 0.0) ? 0.0 : (cl == 1.0) ? 1.0 : min(1.0, cb / (1.0 - cl));
}`);l!==b.LayerBlendMode.ColorBurn&&l!==b.LayerBlendMode.VividLight||n.code.add(c.glsl`float colorBurn(in float cb, in float cl) {
return (cb == 1.0) ? 1.0 : (cl == 0.0) ? 0.0 : 1.0 - min(1.0, (1.0 - cb) / cl);
}`);l===b.LayerBlendMode.Overlay&&n.code.add(c.glsl`float overlay(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (1.0 - 2.0 * (1.0 - cl ) * (1.0 - cb)) + step(0.5, cl) * (2.0 * cl * cb);
}`);l===b.LayerBlendMode.HardLight&&n.code.add(c.glsl`float hardLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * (2.0 * cl * cb) + step(0.5, cl) * (1.0 - 2.0 * (1.0 - cl) * (1.0 - cb));
}`);l===b.LayerBlendMode.SoftLight&&n.code.add(c.glsl`float softLight(in float cb, in float cl) {
if (cl <= 0.5) {
return cb - (1.0 - 2.0 * cl) * cb * (1.0 - cb);
}
if (cb <= 0.25) {
return cb + (2.0 * cl - 1.0) * cb * ((16.0 * cb - 12.0) * cb + 3.0);
}
return cb + (2.0 * cl - 1.0) * (sqrt(cb) - cb);
}`);l===b.LayerBlendMode.VividLight&&n.code.add(c.glsl`float vividLight(in float cb, in float cl) {
return (1.0 - step(0.5, cl)) * colorBurn(cb, 2.0 * cl) + step(0.5, cl) * colorDodge(cb, (2.0 * (cl - 0.5)));
}`);if(l===b.LayerBlendMode.Hue||l===b.LayerBlendMode.Saturation||l===b.LayerBlendMode.Color||l===b.LayerBlendMode.Luminosity)n.code.add(c.glsl`float minv3(in vec3 c) {
return min(min(c.r, c.g), c.b);
}
float maxv3(in vec3 c) {
return max(max(c.r, c.g), c.b);
}
float lumv3(in vec3 c) {
return dot(c, vec3(0.3, 0.59, 0.11));
}
vec3 clipColor(vec3 color) {
float lum = lumv3(color);
float mincol = minv3(color);
float maxcol = maxv3(color);
if (mincol < 0.0) {
color = lum + ((color - lum) * lum) / (lum - mincol);
}
if (maxcol > 1.0) {
color = lum + ((color - lum) * (1.0 - lum)) / (maxcol - lum);
}
return color;
}
vec3 setLum(vec3 cbase, vec3 clum) {
return clipColor(cbase + vec3(lumv3(clum) - lumv3(cbase)));
}`),l!==b.LayerBlendMode.Hue&&l!==b.LayerBlendMode.Saturation||n.code.add(c.glsl`float satv3(vec3 c) {
return maxv3(c) - minv3(c);
}
vec3 setLumSat(vec3 cbase, vec3 csat, vec3 clum)
{
float minbase = minv3(cbase);
float sbase = satv3(cbase);
float ssat = satv3(csat);
return setLum(sbase > 0.0 ? (cbase - minbase) * ssat / sbase : vec3(0.0), clum);
}`);n.code.add(c.glsl`
    vec4 applyBlendMode(vec3 cl, float ol, vec3 cb, float ob) {
      ${l===b.LayerBlendMode.Multiply?c.glsl`return vec4(cl * ol * cb * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Average?c.glsl`return vec4((cb + cl) * 0.5 * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Lighten?c.glsl`return vec4(max(cb, cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Darken?c.glsl`return vec4(min(cl, cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
l===b.LayerBlendMode.Lighter?c.glsl`return vec4(cl * ol + cb * ob, ol + ob);`:l===b.LayerBlendMode.Plus?c.glsl`return clamp(vec4(cl.rgb + cb.rgb, ol + ob), 0.0, 1.0);`:l===b.LayerBlendMode.Minus?c.glsl`return vec4(clamp(vec3(cb.rgb - cl.rgb), 0.0, 1.0), ob * ol);`:l===b.LayerBlendMode.Screen?c.glsl`return vec4((cl + cb - cl * cb) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Difference?c.glsl`return vec4(abs(cb - cl) * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:
l===b.LayerBlendMode.Invert?c.glsl`return vec4((1.0 - cb) * ol * ob + cb * ob * (1.0 - ol), ob);`:l===b.LayerBlendMode.DestinationOver?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob, ol + ob - ol * ob);`:l===b.LayerBlendMode.DestinationAtop?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * ol, ol);`:l===b.LayerBlendMode.DestinationOut?c.glsl`return vec4(cb * ob * (1.0 - ol), ob * (1.0 - ol));`:l===b.LayerBlendMode.SourceAtop?c.glsl`return vec4(cl * ol * ob + cb * ob * (1.0 - ol), ob);`:l===b.LayerBlendMode.SourceOut?
c.glsl`return vec4(cl * ol * (1.0 - ob), ol * (1.0 - ob));`:l===b.LayerBlendMode.Xor?c.glsl`return vec4(cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), ol * (1.0 - ob) + ob * (1.0 - ol));`:l===b.LayerBlendMode.DestinationIn?c.glsl`return vec4(cb * ob * ol, ol * ob);`:l===b.LayerBlendMode.SourceIn?c.glsl`return vec4(cl * ol * ob, ol * ob);`:l===b.LayerBlendMode.Hue?c.glsl`
          vec3 f = setLumSat(cl, cb, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Saturation?c.glsl`
          vec3 f = setLumSat(cb, cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Color?c.glsl`
          vec3 f = setLum(cl, cb);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Luminosity?c.glsl`
          vec3 f = setLum(cb, cl);
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Exclusion?c.glsl`
          vec3 f = cl + cb - 2.0 * cl * cb;
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Reflect?c.glsl`
          vec3 f = vec3(reflectBlend(cb.r, cl.r), reflectBlend(cb.g, cl.g), reflectBlend(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.ColorDodge?c.glsl`
          vec3 f = vec3(colorDodge(cb.r, cl.r), colorDodge(cb.g, cl.g), colorDodge(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.ColorBurn?c.glsl`
          vec3 f = vec3(colorBurn(cb.r, cl.r), colorBurn(cb.g, cl.g), colorBurn(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.Overlay?c.glsl`
          vec3 f = vec3(overlay(cb.r, cl.r), overlay(cb.g, cl.g), overlay(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.SoftLight?c.glsl`
          vec3 f = vec3(softLight(cb.r, cl.r), softLight(cb.g, cl.g), softLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.HardLight?c.glsl`
          vec3 f = vec3(hardLight(cb.r, cl.r), hardLight(cb.g, cl.g), hardLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:l===b.LayerBlendMode.VividLight?c.glsl`
          vec3 f = vec3(vividLight(cb.r, cl.r), vividLight(cb.g, cl.g), vividLight(cb.b, cl.b));
          return vec4(f * ol * ob + cl * ol * (1.0 - ob) + cb * ob * (1.0 - ol), mix(ob, 1.0, ol));`:c.glsl``}
    }
  `)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/rasterUtils":function(){define("exports ../../chunks/vec2f64 ./context-util ./enums ./FramebufferObject ./Texture".split(" "),function(a,b,c,n,l,u){a.createColormapTexture=function(v,m){return new u.Texture(v,{width:m.length/4,height:1,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,
wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},m)};a.createFrameBuffer=function(v,m,h,d){d=new u.Texture(v,{width:m,height:h,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:n.PixelFormat.RGBA,samplingMode:n.TextureSamplingMode.NEAREST,dataType:d?n.PixelType.UNSIGNED_BYTE:n.PixelType.FLOAT,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1});return new l.FramebufferObject(v,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER,
width:m,height:h},d)};a.createRasterTexture=function(v,m,h="nearest",d=!1){var e;const g=(d=!(d&&"u8"===m.pixelType))?n.PixelType.FLOAT:n.PixelType.UNSIGNED_BYTE,p=null==m.pixels||0===m.pixels.length?null:d?m.getAsRGBAFloat():m.getAsRGBA(),t=null==(e=v.capabilities.textureFloat)?void 0:e.textureFloatLinear;return new u.Texture(v,{width:m.width,height:m.height,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:v.type===c.ContextType.WEBGL2&&d?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA,
samplingMode:!t||"bilinear"!==h&&"cubic"!==h?n.TextureSamplingMode.NEAREST:n.TextureSamplingMode.LINEAR,dataType:g,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1},p)};a.createTransformTexture=function(v,m){const {spacing:h,offsets:d,coefficients:e,size:[g,p]}=m;var t=1<h[0];m={width:t?4*g:g,height:p,target:n.TextureType.TEXTURE_2D,pixelFormat:n.PixelFormat.RGBA,internalFormat:v.type===c.ContextType.WEBGL2?n.SizedPixelFormat.RGBA32F:n.PixelFormat.RGBA,dataType:n.PixelType.FLOAT,samplingMode:n.TextureSamplingMode.NEAREST,
wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,flipped:!1};const q=new Float32Array(t?g*p*16:2*d.length);if(t)for(let k=0,r=0;k<e.length;k++)q[r++]=e[k],2===k%3&&(q[r++]=1);else for(t=0;t<p;t++)for(let k=0;k<g;k++){const r=4*(t*g+k),y=2*(k*p+t);q[r]=d[y];q[r+1]=d[y+1];q[r+3]=-1===d[y]?0:1}return new u.Texture(v,m,q)};a.getBasicGridUniforms=function(v,m){return{u_scale:v,u_offset:m}};a.getColormapUniforms=function(v,m){return{u_colormapOffset:m||0,u_colormapMaxIndex:v?v.length/4-1:0}};a.getCommonUniforms=
function(v,m,h,d=1,e=!0){return{u_flipY:e,u_applyTransform:v?!0:!1,u_opacity:d,u_transformSpacing:v?v.spacing:b.ZEROS,u_transformGridSize:v?v.size:b.ZEROS,u_targetImageSize:m,u_srcImageSize:h}};a.getShadedReliefUniforms=function(v){return{u_hillshadeType:v.hillshadeType,u_sinZcosAs:v.sinZcosAs,u_sinZsinAs:v.sinZsinAs,u_cosZs:v.cosZs,u_weights:v.weights,u_factor:v.factor,u_minValue:v.minValue,u_maxValue:v.maxValue}};a.getStretchUniforms=function(v){return{u_bandCount:v.bandCount,u_minOutput:v.outMin,
u_maxOutput:v.outMax,u_minCutOff:v.minCutOff,u_maxCutOff:v.maxCutOff,u_factor:v.factor,u_useGamma:v.useGamma,u_gamma:v.gamma,u_gammaCorrection:v.gammaCorrection}};a.getUniformLocationInfos=function(v,m){v=v.gl;m=m.glName;const h=v.getProgramParameter(m,v.ACTIVE_UNIFORMS),d=new Map;let e;for(let g=0;g<h;g++)(e=v.getActiveUniform(m,g))&&d.set(e.name,{location:v.getUniformLocation(m,e.name),info:e});return d};a.setTextures=function(v,m,h,d){h.length===d.length&&(d.some(e=>null==e)||h.some(e=>null==e)||
h.forEach((e,g)=>{m.setUniform1i(e,g);v.bindTexture(d[g],g)}))};a.setUniforms=function(v,m,h){Object.keys(h).forEach(d=>{var e=m.get(d)||m.get(d+"[0]");if(e){var g=h[d];if(null!==e&&null!=g)switch({info:e}=e,e.type){case n.UniformType.FLOAT:1<e.size?v.setUniform1fv(d,g):v.setUniform1f(d,g);break;case n.UniformType.FLOAT_VEC2:v.setUniform2fv(d,g);break;case n.UniformType.FLOAT_VEC3:v.setUniform3fv(d,g);break;case n.UniformType.FLOAT_VEC4:v.setUniform4fv(d,g);break;case n.UniformType.FLOAT_MAT3:v.setUniformMatrix3fv(d,
g);break;case n.UniformType.FLOAT_MAT4:v.setUniformMatrix4fv(d,g);break;case n.UniformType.INT:1<e.size?v.setUniform1iv(d,g):v.setUniform1i(d,g);break;case n.UniformType.BOOL:v.setUniform1i(d,g?1:0);break;case n.UniformType.INT_VEC2:case n.UniformType.BOOL_VEC2:v.setUniform2iv(d,g);break;case n.UniformType.INT_VEC3:case n.UniformType.BOOL_VEC3:v.setUniform3iv(d,g);break;case n.UniformType.INT_VEC4:case n.UniformType.BOOL_VEC4:v.setUniform4iv(d,g)}}})};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TilePerLayerInfo":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/maybe ../../../core/ObjectPool ../../../core/PooledArray ./terrainUtils ./tileUtils".split(" "),function(a,b,c,n,l,u,v){let m=function(){function e(){this.waitingAgents=new l;this.requestAbort=this.requestPromise=this.loadingAgent=this._upsampleInfo=null;this.pendingUpdates=0}e.acquire=function(p){const t=h.acquire();t._init(p);return t};
var g=e.prototype;g.release=function(){this.dispose();d.delete(this);h.release(this)};g.dispose=function(){this.loadingAgent=c.disposeMaybe(this.loadingAgent);this.abortRequest();this._unsetUpsampleInfo();this.pendingUpdates=0;this._data=u.releaseTileData(this._data)};e.prune=function(){h.prune(0)};g._init=function(p){this.waitingAgents.clear();this._data=u.releaseTileData(this._data);this.dataInvalidated=this.dataMissing=!1;this._unsetUpsampleInfo();this.abortRequest();this.loadingAgent=null;this.pendingUpdates=
0;this._pool=p;this.elevationBounds=null};g.invalidateSourceData=function(){this.dataInvalidated=!0;this.dataMissing=!1;this._unsetUpsampleInfo()};g.abortRequest=function(){this.requestAbort=c.abortMaybe(this.requestAbort);this.requestPromise=null};g._unsetUpsampleInfo=function(){c.isSome(this._upsampleInfo)&&(this._upsampleInfo.tile.unrefMapData(),this._pool.release(this._upsampleInfo),this._upsampleInfo=null)};g.setUpsampleInfo=function(p,t){if(p===t||c.isNone(t))this._unsetUpsampleInfo();else{if(c.isNone(this._upsampleInfo))this._upsampleInfo=
this._pool.acquire();else{if(this._upsampleInfo.tile===t)return;this._upsampleInfo.tile.unrefMapData()}t.refMapData();v.computeUpsampleInfo(p,t,this._upsampleInfo)}};b._createClass(e,[{key:"upsampleInfo",get:function(){return this._upsampleInfo}},{key:"data",get:function(){return this._data},set:function(p){u.releaseTileData(this._data);this._data=p}}]);return e}();const h=new n(m,null,()=>{}),d=new Map;a.TilePerLayerInfo=m;a.printAllocations=function(){0<d.size&&(console.log(`${d.size} live TilePerLayerInfo allocations:`),
d.forEach(e=>console.log(e,"\n")))};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileTexture":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(n){this._texture=n;this.type="tile-texture";this._refCount=1}var c=b.prototype;c.retain=function(){++this._refCount};c.release=function(){--this._refCount;0===this._refCount&&this._texture.dispose()};c.generateMipmap=function(){this._texture.generateMipmap()};
a._createClass(b,[{key:"texture",get:function(){return this._texture}},{key:"descriptor",get:function(){return this._texture.descriptor}}]);return b}()})},"esri/views/3d/terrain/TileUpdate":function(){define(["exports"],function(a){a.TileUpdate=void 0;var b=a.TileUpdate||(a.TileUpdate={});b[b.NONE=0]="NONE";b[b.NONE_HIT_MAXLOD=1]="NONE_HIT_MAXLOD";b[b.SPLIT=2]="SPLIT";b[b.VSPLITMERGE=4]="VSPLITMERGE";b[b.MERGE=8]="MERGE";b[b.RENDERDATA=16]="RENDERDATA";b[b.GEOMETRY=32]="GEOMETRY";b[b.TEXTURE_NOFADING=
64]="TEXTURE_NOFADING";b[b.TEXTURE_FADING=128]="TEXTURE_FADING";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileOverlayData":function(){define(["../../../chunks/_rollupPluginBabelHelpers"],function(a){return function(){function b(){this._scales=[-1,-1,-1,-1];this._offsets=[-1,-1,-1,-1]}var c=b.prototype;c.clear=function(){this._scales[0]=this._scales[1]=this._scales[2]=this._scales[3]=-1;this._offsets[0]=this._offsets[1]=this._offsets[2]=
this._offsets[3]=-1};c.setScale=function(n,l,u){this._scales[2*n]=l;this._scales[2*n+1]=u};c.setOffset=function(n,l,u){this._offsets[2*n]=l;this._offsets[2*n+1]=u};a._createClass(b,[{key:"scales",get:function(){return this._scales}},{key:"offsets",get:function(){return this._offsets}}]);return b}()})},"esri/views/3d/terrain/RenderOrder":function(){define(["exports"],function(a){a.RenderOrder=void 0;var b=a.RenderOrder||(a.RenderOrder={});b[b.BACK_TO_FRONT=-1]="BACK_TO_FRONT";b[b.NONE=0]="NONE";b[b.FRONT_TO_BACK=
1]="FRONT_TO_BACK";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/SphericalPatch":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../geometry/projection ../../../geometry/projectionEllipsoid ../../../geometry/support/frustum ../../../geometry/support/plane ./interfaces ./PatchGeometryFactory ./Tile".split(" "),function(a,b,c,n,l,u,v,m,
h,d,e,g){g=function(q){function k(y,f,w){var z=q.call(this)||this;z.obb=Array(8);for(let A=0;8>A;A++)z.obb[A]=l.create();void 0!==y&&z.init(y,f,w);return z}b._inheritsLoose(k,q);var r=k.prototype;r.init=function(y,f,w){q.prototype.init.call(this,y,f,w);f=this.ellipsoid.radius;w=this.extentInRadians[0];const z=this.extentInRadians[1],A=this.extentInRadians[2],x=this.extentInRadians[3];y=y[0];const B=c.lerp(z,x,.5),C=c.lerp(w,A,.5);this._edgeLen=(A-w)*Math.cos(0===y?0:Math.min(Math.abs(z),Math.abs(x)))*
f;this._edgeLen2=this._edgeLen*this._edgeLen;this._curvatureHeight=f-Math.sqrt(f*f-this._edgeLen2/4);u.lonLatToSphericalPCPF(this.centerAtSeaLevel,C,B,this.ellipsoid.radius);f=l.fromArray(this.centerAtSeaLevel);n.normalize(f,f);this.up=f;this._updateOBB();this.updateRadiusAndCenter()};r.updateRadiusAndCenter=function(){if(0===this.lij[0])n.set(this._center[a.CenterPosition.MIDDLE],0,0,0),n.set(this._center[a.CenterPosition.TOP],0,0,0),n.set(this._center[a.CenterPosition.BOTTOM],0,0,0),this.ellipsoid||
(this.ellipsoid=v.getReferenceEllipsoid(this.surface.spatialReference)),this._center[a.CenterPosition.MIDDLE][3]=this.ellipsoid.radius+this.elevationBounds[1];else{this._updateCenter();const y=Math.max(n.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[0]),n.squaredDistance(this._center[a.CenterPosition.MIDDLE],this.obb[1]));this._center[a.CenterPosition.MIDDLE][3]=Math.sqrt(y)}};r._isVisible=function(y){if(!m.intersectsSphere(y,this._center[a.CenterPosition.MIDDLE]))return!1;if(10>
this.lij[0])return!0;const f=this.obb;for(let A=0;A<m.NumPlanes.NUM;A++){var w=A===m.PlaneIndex.NEAR,z=y[A];w&&(t[0]=z[0],t[1]=z[1],t[2]=z[2],t[3]=z[3]-this.surface.view.state.camera.near);w=w?t:z;for(z=0;8>z;z++){const x=f[z];if(0>w[0]*x[0]+w[1]*x[1]+w[2]*x[2]+w[3])break}if(8===z)return!1}return!0};r.computeElevationBounds=function(){q.prototype.computeElevationBounds.call(this);this._updateOBB()};r.createGeometry=function(){const y=this._getPatchType(this.lij[1],this.lij[0]);e.createSphericalGlobePatch(this.renderData,
y);this.setMemoryDirty()};r._updateOBB=function(){const y=this.extentInRadians,f=this.obb;for(let w=0;2>w;w++){const z=this.elevationBounds[w];let A=4*w;u.lonLatToSphericalPCPF(f[A++],y[0],y[1],this.ellipsoid.radius+z);u.lonLatToSphericalPCPF(f[A++],y[0],y[3],this.ellipsoid.radius+z);u.lonLatToSphericalPCPF(f[A++],y[2],y[3],this.ellipsoid.radius+z);u.lonLatToSphericalPCPF(f[A++],y[2],y[1],this.ellipsoid.radius+z)}if(this.surface.isWebMercator)switch(this._getPatchType(this.lij[1],this.lij[0])){case d.PatchType.HAS_NORTH_POLE:n.set(f[1],
0,0,this.ellipsoid.radius);n.set(f[2],0,0,this.ellipsoid.radius);n.set(f[5],0,0,this.ellipsoid.radius);n.set(f[6],0,0,this.ellipsoid.radius);break;case d.PatchType.HAS_SOUTH_POLE:n.set(f[0],0,0,-this.ellipsoid.radius),n.set(f[3],0,0,-this.ellipsoid.radius),n.set(f[4],0,0,-this.ellipsoid.radius),n.set(f[7],0,0,-this.ellipsoid.radius)}};r._getPatchType=function(y,f){return y===(1<<f)-1?0===y?d.PatchType.HAS_BOTH_POLES:d.PatchType.HAS_SOUTH_POLE:0===y?d.PatchType.HAS_NORTH_POLE:d.PatchType.REGULAR};
r.intersectsRay=function(y,f,w,z){var A=this._center[a.CenterPosition.MIDDLE];w=A[3]+w;var x=A[0]-y[0];z=A[1]-y[1];y=A[2]-y[2];A=(x*f[0]+z*f[1]+y*f[2])/(f[0]*f[0]+f[1]*f[1]+f[2]*f[2]);x=f[0]*A-x;z=f[1]*A-z;f=f[2]*A-y;return x*x+z*z+f*f<w*w};r.getDefaultVerticesPerRowOnLevel=function(){return this.level<p.length?p[this.level]+1:2};r.updateCornerElevations=function(){e.updateCornerElevationsSpherical(this.renderData)};r.updateEdgeElevations=function(){e.updateEdgesElevationsSpherical(this.renderData)};
return k}(g.Tile);const p=[128,64,32,16,16,8,8,4],t=h.create();a.CenterPosition=void 0;(function(q){q[q.TOP=0]="TOP";q[q.MIDDLE=1]="MIDDLE";q[q.BOTTOM=2]="BOTTOM"})(a.CenterPosition||(a.CenterPosition={}));a.SphericalPatch=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainRenderer":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../Color ../../../core/Accessor ../../../core/maybe ../../../core/ObjectPool ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../chunks/mat4f64 ../../../chunks/vec3 ../../../chunks/vec3f64 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/buffer/BufferView ../../ViewingMode ./interfaces ./LayerClass ./Overlay ./OverlayRenderer ./PatchGeometry ./PatchRenderData ./RenderOrder ./ScaleRangeQueries ./terrainUtils ./TileRenderer ./TileUpdate ./tileUtils ../webgl-engine/collections/Component/ComponentIntersectionData ../webgl-engine/core/shaderLibrary/ShaderOutputOptions ../webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../../../chunks/Terrain.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../webgl-engine/lib/basicInterfaces ../webgl-engine/lib/glUtil3D ../webgl-engine/lib/Intersector ../webgl-engine/lib/IntersectorInterfaces ../webgl-engine/lib/Material ../webgl-engine/lib/RenderPass ../webgl-engine/lib/RenderSlot ../webgl-engine/lib/screenSizePerspectiveUtils ../webgl-engine/lib/VertexAttribute ../webgl-engine/lib/verticalOffsetUtils ../webgl-engine/materials/DrawParameters ../webgl-engine/materials/internal/MaterialUtil ../webgl-engine/shaders/TerrainTechnique ../webgl-engine/shaders/TerrainTechniqueConfiguration ../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H,U,W,Q,X,ba,aa,ea,ia){function ka(ja,ma,pa){pa[0]=ja[0]*ma[2]+ma[0];pa[1]=ja[1]*ma[3]+ma[1];pa[2]=ja[2]*ma[2];pa[3]=ja[3]*ma[3]}const la=k.create(),Z=q.create();n=function(ja){function ma(na){na=ja.call(this,na)||this;na.type=V.IntersectorType.TERRAIN;na.isGround=!0;na.tileSize=256;na._techniqueConfiguration=new ea.TerrainTechniqueConfiguration;na._passParameters=new M.TerrainPassParameters;na.rctx=null;na._isTransparent=
!1;na._scaleRangeQueries=new D.ScaleRangeQueries;na.renderDataPool=new u(B.PatchRenderData);na._patchGroups=new Map;na.patchGroupsDirty=!0;na.tileIterator=new O.IteratorPreorder;na.highestVisibleLODTile=null;na.visible=!0;na._opaque=!0;na._velvetOverground=!0;na._castShadows=!0;na.emptyTex=null;na.tileRenderer=null;na.stencilEnabledLayerExtents=[];na.numTilesRendered=0;na.numTilesCulled=0;na.numOriginsRendered=0;na.needsHighlight=!1;na.renderOccludedFlags=S.RenderOccludedFlag.Occlude;return na}a._inheritsLoose(ma,
ja);var pa=ma.prototype;pa.initialize=function(){this.stage.addRenderPlugin([H.RenderSlot.OPAQUE_TERRAIN,H.RenderSlot.TRANSPARENT_TERRAIN,H.RenderSlot.OCCLUDED_TERRAIN],this)};pa.destroy=function(){this.stage.removeRenderPlugin(this);x.clearCaches()};pa.setDebugScreenSizePerspective=function(na){this._techniqueConfiguration.screenSizePerspective!==na&&(this._techniqueConfiguration.screenSizePerspective=na,this.setNeedsRender())};pa.toggleShading=function(){this._techniqueConfiguration.shading=!this._techniqueConfiguration.shading;
this.setNeedsRender()};pa.setRootTiles=function(na){this._rootTiles=na;this.setNeedsRender()};pa.setNeedsHighlight=function(na){this.needsHighlight=na;this.setNeedsRender()};pa.setRenderOccludedOverlay=function(na){this.renderOccludedFlags=na?A.overlayRenderOccludedFlag:S.RenderOccludedFlag.Occlude;this.setNeedsRender()};pa.setStencilEnabledLayerExtents=function(na){this.stencilEnabledLayerExtents=na;this.setNeedsRender()};pa.setTileSize=function(na){this.tileSize=na;l.isSome(this.tileRenderer)&&
(this.tileRenderer.tileSize=na);this.setNeedsRender()};pa._prepareTileForLoading=function(na){na.renderData||(na.renderData=this.renderDataPool.acquire(),na.renderData.init(na),na.renderData.localOrigin=this._getLocalOriginOfTile(na))};pa.loadTile=function(na){this._prepareTileForLoading(na);this.updateTileGeometry(na);this.updateTileTexture(na,G.TileUpdate.TEXTURE_FADING)};pa.queryVisibleLevelRange=function(na,wa,xa,sa){this._scaleRangeQueries.queryVisibleLevelRange(na,wa,xa,sa);this.setNeedsRender()};
pa.updateTileTexture=function(na,wa){l.isSome(this.tileRenderer)&&(this.tileRenderer.updateTileTexture(na,wa===G.TileUpdate.TEXTURE_FADING?f.TextureUpdate.FADING:f.TextureUpdate.UNFADED),this.setNeedsRender(),na.resetPendingUpdate(wa))};pa.updateTileGeometryState=function(na){this._prepareTileForLoading(na);na.renderData.updateGeometryStateAndPrepareForGeometryGeneration(this.wireframe)};pa.updateTileGeometry=function(na){for(const wa of na.layerInfo[w.LayerClass.ELEVATION])wa.pendingUpdates&=~G.TileUpdate.GEOMETRY;
na.resetPendingUpdate(G.TileUpdate.GEOMETRY);na.renderData.updateGeometryIfChanged(this.rctx,this.wireframe)&&this.setNeedsRender()};pa.unloadTile=function(na){const wa=na.renderData;wa&&(wa.releaseGeometry(),this.renderDataPool.release(wa),wa.clear(),na.renderData=null,na.setMemoryDirty(),this.setNeedsRender())};pa._getLocalOriginOfTile=function(na){const wa=Math.max(0,7*Math.floor((na.level-3)/7));if(this.isGlobal&&0===wa)return t.ZEROS;for(;na.parent&&na.level>wa;)na=na.parent;return na.centerAtSeaLevel};
pa.setVisibility=function(na){this.visible=na;this.setNeedsRender()};pa.getStats=function(){return{numTilesRendered:this.numTilesRendered,numTilesCulled:this.numTilesCulled,numOriginsRendered:this.numOriginsRendered}};pa.setNeedsRender=function(na=I.RenderRequestType.UPDATE){this.patchGroupsDirty=!0;this._context.requestRender(na)};pa.initializeRenderContext=function(na){this._context=na;this.rctx=na.renderContext.rctx;this._techniqueRepository=na.shaderTechniqueRepository;this.tileRenderer=new F.TileRenderer(this.rctx,
this.tileSize,this._techniqueRepository);this.updateTileBackground();this.emptyTex=P.createEmptyTexture(this.rctx)};pa.uninitializeRenderContext=function(){this.emptyTex=l.disposeMaybe(this.emptyTex);this.tileRenderer=l.disposeMaybe(this.tileRenderer)};pa.intersect=function(na,wa,xa,sa){if(this._rootTiles&&(!na.options.selectOpaqueTerrainOnly||!na.options.selectionMode||this._opaque)){var ya=ca,ra=Y;p.subtract(ya,sa,xa);p.set(ra,1/ya[0],1/ya[1],1/ya[2]);var ua=na.results.min,Ba=na.results.max,Ea=
na.results.ground,Ja=na.options.store===V.StoreResults.MIN,va=!!na.results.ground.target,Ca=Q.getVerticalOffsetTerrain(na.verticalOffset),Ka=na.tolerance,Oa,Ra=Ja&&l.isSome(ua.dist)?ua.dist:Infinity,Pa=za=>{var Da=za.renderData;if(null!=Da&&Da.vao){var La=Da.geometryInfo;k.set(la,La.boundingBox);var Na=Da.localOrigin;l.isSome(Ca)&&(Ca.localOrigin=Na,Ca.applyToAabb(la));da[0]=xa[0]-Na[0];da[1]=xa[1]-Na[1];da[2]=xa[2]-Na[2];if(ba.intersectAabbInvDirBefore(la,da,ra,Ka,Ra)){var Ua=(ab,hb,ta)=>{ab.set(this.type,
za,hb,ta,g.IDENTITY);Ra=Ja&&l.isSome(ua.dist)?ua.dist:Infinity};Da=(ab,hb)=>{l.isSome(hb)&&0<=ab&&(na.options.backfacesTerrain||0>p.dot(hb,ya))&&(na.options.invisibleTerrain||!na.options.selectionMode||null==wa||wa(xa,sa,ab))&&((null==Ea.dist||ab<Ea.dist)&&Ua(Ea,ab,hb),na.options.isFiltered||(na.options.store===V.StoreResults.ALL&&(l.isNone(Oa)?(Oa=N.newIntersectorResult(na.ray),Ua(Oa,ab,hb),na.results.all.push(Oa)):ab<Oa.dist&&Ua(Oa,ab,hb)),(null==ua.dist||ab<ua.dist)&&Ua(ua,ab,hb),na.options.store!==
V.StoreResults.MIN&&(null==Ba.dist||ab>Ba.dist)&&Ua(Ba,ab,hb)))};var Ta=ha;p.subtract(Ta,sa,Na);Na=La.indices;var Za=La.vertexAttributes;Za={data:Za.getField(W.VertexAttribute.POSITION,r.BufferViewVec3f).typedBuffer,size:3,stride:Za.stride/4};La=La.indexCount/3;if(l.isNone(Ca)&&La>K.componentMinimalSizeForIntersectionData){const ab=za.renderData;l.isNone(ab.intersectionData)&&(ab.intersectionData=new K.ComponentIntersectionData(Na,0,La,Za));ab.intersectionData.intersectRay({r0:da,r1:Ta},Da)}else ba.intersectTriangles(da,
Ta,0,La,Na,Za,null,Ca,Da)}}},qa=this._rootTiles;l.isSome(qa)&&(()=>{const za=this.tileIterator;za.reset(qa);const Da=na.options.invisibleTerrain;for(;!za.done;){const La=za.next();!(La.visible||Da&&La.intersectsClippingArea)||!l.isSome(Ca)&&!La.intersectsRay(xa,ya,Ka,Ra)||va&&this._useStencilForTile(La)?za.skipSubtree():Pa(La)}})()}};pa.prepareTechnique=function(na){if(na.bindParameters.slot===H.RenderSlot.OCCLUDED_TERRAIN){if(0===(na.renderOccludedMask&A.overlayRenderOccludedFlag))return null}else if(na.bindParameters.slot!==
(this.opaque?H.RenderSlot.OPAQUE_TERRAIN:H.RenderSlot.TRANSPARENT_TERRAIN))return null;switch(na.pass){case T.RenderPass.MATERIAL:return this._techniqueConfiguration.hasScreenSpaceReflections=na.bindParameters.ssr.enabled,this._techniqueConfiguration.hasCloudsReflections=l.isSome(na.bindParameters.clouds.data),this._techniqueConfiguration.receiveShadows=na.bindParameters.shadowMap.ready,this._techniqueConfiguration.receiveAmbientOcclusion=na.bindParameters.ssaoHelper.ready,this._techniqueConfiguration.overlayMode=
this.overlayRenderer.isEmpty()?R.OverlayMode.Disabled:this.overlayRenderer.hasWater?R.OverlayMode.EnabledWithWater:R.OverlayMode.Enabled,this._updateTechnique(L.ShaderOutput.Color,(na.bindParameters.slot===H.RenderSlot.OCCLUDED_TERRAIN?z.OverlaySource.Occluded:z.OverlaySource.ColorAndWater)===z.OverlaySource.Occluded);case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:if(this._castShadows&&1===na.bindParameters.lighting.globalFactor)return this._techniqueConfiguration.receiveShadows=
this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Shadow,!1);break;case T.RenderPass.MATERIAL_DEPTH:if(!this.isTransparent||!this.overlayRenderer.isEmpty())return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Depth,!1);break;case T.RenderPass.MATERIAL_NORMAL:return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Normal,
!1);case T.RenderPass.MATERIAL_HIGHLIGHT:if(this.needsHighlight)return this._techniqueConfiguration.receiveShadows=this._techniqueConfiguration.receiveAmbientOcclusion=!1,this._updateTechnique(L.ShaderOutput.Highlight,!1)}return null};pa.render=function(na,wa){const xa=na.pass,sa=1===na.bindParameters.lighting.globalFactor;this._updatePatchGroups();wa.useStencil=!1;switch(xa){case T.RenderPass.MATERIAL:this._renderMaterialPass(na,wa,na.bindParameters.slot===H.RenderSlot.OCCLUDED_TERRAIN?z.OverlaySource.Occluded:
z.OverlaySource.ColorAndWater);break;case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:case T.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:this._castShadows&&sa&&this._renderAuxiliaryPass(na,wa,z.OverlaySource.None);break;case T.RenderPass.MATERIAL_DEPTH:this.isTransparent&&this.overlayRenderer.isEmpty()||this._renderAuxiliaryPass(na,wa,z.OverlaySource.None);break;case T.RenderPass.MATERIAL_NORMAL:this._renderAuxiliaryPass(na,wa,z.OverlaySource.None);break;case T.RenderPass.MATERIAL_HIGHLIGHT:this.needsHighlight&&
(this._renderAuxiliaryPass(na,wa,z.OverlaySource.Highlight),na.rctx.clearSafe(ia.ClearBufferBit.DEPTH_BUFFER_BIT))}this._scaleRangeQueries.hasPendingQueries()&&this.setNeedsRender()};pa._renderMaterialPass=function(na,wa,xa){const {rctx:sa}=na;this._passParameters.overlaySource=xa;sa.bindTechnique(wa,this._passParameters,na.bindParameters);this.numOriginsRendered=this.numTilesCulled=this.numTilesRendered=0;this._scaleRangeQueries.prepareQueries();this.opaque?this._renderPatchGroups(na,wa,xa):na.offscreenRenderingHelper.renderToTargets(()=>
this._renderPatchGroups(na,wa,xa),na.offscreenRenderingHelper.tmpColor,na.offscreenRenderingHelper.mainDepth,[0,0,0,0]);this._scaleRangeQueries.processQueries()};pa._renderAuxiliaryPass=function(na,wa,xa){const sa=na.rctx;this._passParameters.overlaySource=xa;sa.bindTechnique(wa,this._passParameters,na.bindParameters);this._renderPatchGroupsAuxiliary(na,wa,xa)};pa.updateTileBackground=function(na=null){if(!l.isNone(this.tileRenderer)){var wa=this.tileRenderer,xa=null;l.isSome(na)&&(na=c.toUnitRGBA(na),
xa=t.fromValues(na[0]||0,na[1]||0,na[2]||0));wa.setBackground(xa);this.allTiles.forAll(sa=>wa.updateTileTexture(sa,f.TextureUpdate.FADING));this._techniqueConfiguration.tileBlendInput=wa.backgroundIsGrid?J.TileBlendInput.GridComposite:l.isSome(wa.backgroundColor)?J.TileBlendInput.ColorComposite:J.TileBlendInput.LayerOnly;this.setNeedsRender()}};pa._updatePatchGroups=function(){if(this.patchGroupsDirty){this.highestVisibleLODTile=null;this._rebuildPatchGroups();if(this.renderOrder!==C.RenderOrder.NONE){const na=
Array.from(this._patchGroups.values());na.forEach(wa=>O.sortTiles(this.renderOrder,wa));na.sort((wa,xa)=>O.compareTiles(wa[0],xa[0],this.renderOrder));this._patchGroups=new Map(na.map(wa=>[wa[0].renderData.localOrigin,wa]))}this.patchGroupsDirty=!1}};pa._rebuildPatchGroups=function(){var na;const wa=this._rootTiles;if(!l.isNone(wa)){null==(na=wa[0])?void 0:na.surface.checkAllTileWaterproofness();this._patchGroups.clear();for(const xa of wa)this._rebuildPatchGroupsForRootTile(xa)}};pa._rebuildPatchGroupsForRootTile=
function(na){const wa=this.tileIterator;for(wa.resetOne(na);!wa.done;){na=wa.next();const xa=na.renderData;if(xa&&!na.visible)this.numTilesCulled++,wa.skipSubtree();else if(!na.rendered)this.numTilesCulled++;else if(xa){const sa=this._patchGroups.get(xa.localOrigin)||[];this._patchGroups.set(xa.localOrigin,sa);sa.push(na);if(!this.highestVisibleLODTile||na.vlevel>this.highestVisibleLODTile.vlevel)this.highestVisibleLODTile=na;wa.skipSubtree()}}};pa._useStencilForTile=function(na){for(const wa of this.stencilEnabledLayerExtents)if(na.intersectsExtent(wa))return!0;
return!1};pa._renderPatchGroupsAuxiliary=function(na,wa,xa){const sa=0<this.stencilEnabledLayerExtents.length;this._patchGroups.forEach(ya=>{wa.program.bindDraw(new X.DrawParameters(ya[0].renderData.localOrigin),na.bindParameters);for(let ra=0;ra<ya.length;ra++)this._renderPatch(na,wa,ya[ra],ia.PrimitiveType.TRIANGLES,sa,xa)});na.rctx.bindVAO(null)};pa._renderPatchGroups=function(na,wa,xa){const sa=na.rctx;var ya=na.bindParameters.camera;const ra=wa.program;this._techniqueConfiguration.screenSizePerspective&&
this.pointsOfInterest&&U.getSettings(this.stage.viewingMode,this.ellipsoidRadius).update({distance:this.pointsOfInterest.centerOnSurfaceFrequent.distance,fovY:ya.fovY});const ua=0<this.stencilEnabledLayerExtents.length,Ba=xa===z.OverlaySource.Occluded;Ba&&(ra.bindTexture("tex",this.emptyTex),ra.setUniform1f("blend",1),ra.setUniform4fv("texOffsetAndScale",q.ZEROS));ya=l.isSome(this.tileRenderer)&&l.isSome(this.tileRenderer.backgroundColor)?this.tileRenderer.backgroundColor:t.ZEROS;this._techniqueConfiguration.tileBlendInput===
J.TileBlendInput.ColorComposite&&ra.setUniform3fv("backgroundColor",ya);const Ea=this.wireframe?ia.PrimitiveType.LINES:ia.PrimitiveType.TRIANGLES;this._techniqueConfiguration.textureFadingEnabled&&ra.bindTexture("texNext",this.emptyTex);this._patchGroups.forEach(Ja=>{wa.program.bindDraw(new X.DrawParameters(Ja[0].renderData.localOrigin),na.bindParameters);this.numOriginsRendered++;for(let va=0;va<Ja.length;va++){const Ca=Ja[va],Ka=Ca.renderData.textureReference;if(!l.isNone(Ka)){if(!Ba){this._scaleRangeQueries.scaleQueriesForTile(Ca);
ka(Ca.renderData.geometryInfo.uvOffsetAndScale,Ka.offsetAndScale,Z);ra.setUniform4fv("texOffsetAndScale",Z);ra.bindTexture("tex",Ka.texture.texture);const Oa=Ca.renderData.textureFadeFactor,Ra=1>Oa?Ca.renderData.nextTextureReference:null;this._techniqueConfiguration.textureFadingEnabled&&l.isSome(Ra)&&1>Oa?(ka(Ca.renderData.geometryInfo.uvOffsetAndScale,Ra.offsetAndScale,Z),ra.setUniform1f("fadeFactor",Oa),ra.setUniform4fv("nextTexOffsetAndScale",Z),ra.setUniform3fv("nextTexOpacities",Ra.opacities),
ra.bindTexture("texNext",Ra.texture.texture)):ra.setUniform1f("fadeFactor",1);Ca.renderData.textureIsFading&&this.setNeedsRender();ra.setUniform3fv("textureOpacities",Ka.opacities)}this._renderPatch(na,wa,Ca,Ea,ua,xa);Ca.renderOrder=this.numTilesRendered;this.numTilesRendered++}}});sa.bindVAO(null)};pa._renderPatch=function(na,wa,xa,sa,ya,ra){const ua=xa.renderData,Ba=ua.vao,Ea=Ba.indexBuffer;if(!l.isNone(Ea)){var Ja=wa.program;ra!==z.OverlaySource.None&&this._bindOverlayPatchData(Ja,ua.overlay);
ya&&(wa.useStencil=this._useStencilForTile(xa),wa.bindPipelineState(na.rctx,na.bindParameters.slot));wa=ua.geometryInfo.indexCount;na.rctx.bindVAO(Ba);Ja.assertCompatibleVertexAttributeLocations(Ba);na.rctx.drawElements(sa,wa,Ea.indexType,0)}};pa._bindOverlayPatchData=function(na,wa){na.setUniform4fv("overlayTexOffset",wa.offsets);na.setUniform4fv("overlayTexScale",wa.scales)};pa._updateTechnique=function(na,wa){this._techniqueConfiguration.output=na;na===L.ShaderOutput.Color&&(this._techniqueConfiguration.atmosphere=
this.isGlobal&&this._velvetOverground);this._techniqueConfiguration.renderOccluded=wa;this._techniqueConfiguration.stencilEnabled=!1;return this._shaderTechnique=this._techniqueRepository.releaseAndAcquire(aa.TerrainTechnique,this._techniqueConfiguration,this._shaderTechnique)};a._createClass(ma,[{key:"isGlobal",get:function(){return this.stage.viewingMode===y.ViewingMode.Global}},{key:"shadingEnabled",get:function(){var na;return null==(na=this._techniqueConfiguration)?void 0:na.shading}},{key:"canRender",
get:function(){return this.visible&&!!this._rootTiles&&!this.renderingDisabled}},{key:"renderingDisabled",set:function(na){this._set("renderingDisabled",!!na);this.setNeedsRender()}},{key:"opaque",get:function(){return this._opaque&&!this._techniqueConfiguration.hasSlicePlane},set:function(na){this._opaque!==na&&(this._opaque=na,this.setNeedsRender())}},{key:"needsLinearDepth",get:function(){return this.overlayRenderer.hasWater}},{key:"isTransparent",get:function(){return this._isTransparent},set:function(na){this._isTransparent!==
na&&(this._isTransparent=na,this.setNeedsRender())}},{key:"renderPatchBorders",get:function(){return!!this._techniqueConfiguration.tileBorders},set:function(na){this._techniqueConfiguration.tileBorders!==na&&(this._techniqueConfiguration.tileBorders=na,this.setNeedsRender(),this.notifyChange("renderPatchBorders"))}},{key:"cullBackFaces",get:function(){return this._techniqueConfiguration.backfaceCullingEnabled},set:function(na){this._techniqueConfiguration.backfaceCullingEnabled!==na&&(this._techniqueConfiguration.backfaceCullingEnabled=
na,this.notifyChange("cullBackFaces"),this.setNeedsRender())}},{key:"renderOrder",set:function(na){this._set("renderOrder",na);this.setNeedsRender()}},{key:"velvetOverground",set:function(na){this._velvetOverground!==na&&(this._velvetOverground=na,this.setNeedsRender())}},{key:"layerUid",get:function(){return Q.TERRAIN_ID}},{key:"slicePlaneEnabled",get:function(){return this._techniqueConfiguration.hasSlicePlane},set:function(na){this._techniqueConfiguration.hasSlicePlane!==na&&(this._techniqueConfiguration.hasSlicePlane=
na,this.setNeedsRender())}},{key:"textureFadingEnabled",set:function(na){this._techniqueConfiguration.textureFadingEnabled!==na&&(this._techniqueConfiguration.textureFadingEnabled=na,this.setNeedsRender())}},{key:"wireframe",set:function(na){this._get("wireframe")!==na&&(this._set("wireframe",na),this.allTiles.forAll(wa=>{wa.isLoaded&&(this.updateTileGeometry(wa),wa.updateNeighborsAfterGeometryChange())}),this.setNeedsRender())}},{key:"test",get:function(){return{tileRenderer:this.tileRenderer}}}]);
return ma}(n);b.__decorate([v.property({constructOnly:!0})],n.prototype,"overlayRenderer",void 0);b.__decorate([v.property({constructOnly:!0})],n.prototype,"stage",void 0);b.__decorate([v.property({readOnly:!0})],n.prototype,"isGlobal",null);b.__decorate([v.property({constructOnly:!0})],n.prototype,"allTiles",void 0);b.__decorate([v.property({constructOnly:!0})],n.prototype,"ellipsoidRadius",void 0);b.__decorate([v.property({value:!1})],n.prototype,"renderingDisabled",null);b.__decorate([v.property()],
n.prototype,"renderPatchBorders",null);b.__decorate([v.property()],n.prototype,"cullBackFaces",null);b.__decorate([v.property({value:C.RenderOrder.FRONT_TO_BACK})],n.prototype,"renderOrder",null);b.__decorate([v.property()],n.prototype,"wireframe",null);b=n=b.__decorate([e.subclass("esri.views.3d.terrain.TerrainRenderer")],n);const ca=t.create(),Y=t.create(),da=t.create(),ha=t.create();return b})},"esri/views/3d/terrain/ScaleRangeQueries":function(){define(["exports","../../../core/ObjectPool","../../../core/PooledArray",
"../../../chunks/vec4","../../../chunks/vec4f64"],function(a,b,c,n,l){let u=function(){this.extent=l.create();this.maxLevel=this.minLevel=0;this.callback=null},v=function(){function m(){this._queries=new c({initialSize:10});this._queriesInvPtr=0;this._queryQueue=new c({initialSize:30});this._queryPool=new b(u)}var h=m.prototype;h.queryVisibleLevelRange=function(d,e,g,p){const t=this._queryPool.acquire();n.copy(t.extent,d);t.minLevel=e?e:-Number.MAX_VALUE;t.maxLevel=null!=g?g:Number.MAX_VALUE;t.callback=
p;this._queryQueue.push(t)};h.hasPendingQueries=function(){return 0!==this._queryQueue.length};h.prepareQueries=function(){for(;this._queries.length<this._queries.data.length&&0<this._queryQueue.length;){const d=this._queryQueue.pop();this._queries.push(d)}this._queriesInvPtr=this._queries.length};h.processQueries=function(){for(let d=0;d<this._queries.length;d++){const e=this._queries.data[d];this._queryPool.release(e);e.callback(d>=this._queriesInvPtr);e.callback=null}this._queries.clear()};h.scaleQueriesForTile=
function(d){const e=d.level;let g=0;for(;g<this._queriesInvPtr;){const p=this._queries.data[g],t=p.extent;e>=p.minLevel&&e<=p.maxLevel&&t[0]<=d.extent[2]&&t[2]>=d.extent[0]&&t[1]<=d.extent[3]&&t[3]>=d.extent[1]?(this._queries.swapElements(g,this._queriesInvPtr-1),this._queriesInvPtr--):g++}};return m}();a.ScaleRangeQueries=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileRenderer":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/mathUtils ../../../core/maybe ../../../chunks/vec2 ../../../chunks/vec2f64 ../../../layers/support/layerUtils ../support/StreamDataLoader ./BlendLayersTechnique ./interfaces ./LayerClass ./terrainUtils ./TextureFader ./TextureReference ./TileCompositor ./TileTexture ./TileUpdate ../webgl-engine/core/shaderLibrary/output/BlendOptions ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A){function x(G,O){E.layerIndex=O;const K=G.layerInfo[e.LayerClass.MAP][O];if(n.isSome(K.data))return l.set(E.offset,0,0),E.tile=G,E.scale=1,E.sourceLod=G.lij,E.sourceLayerInfo=K,E;G=K.upsampleInfo;return n.isSome(G)?(O=G.tile.layerInfo[e.LayerClass.MAP][O],E.tile=G.tile,l.copy(E.offset,G.offset),E.scale=G.scale,E.sourceLod=G.tile.lij,E.sourceLayerInfo=O,E):null}let B=function(){function G(K,L,R){this._rctx=K;this.tileSize=L;this._techniqueRepository=
R;this._passParameters=new h.BlendLayersPassParameters;this._backgroundColor=this._backgroundTexture=null;this._backgroundDirty=!1;this._blackTex=null;this._numTexturedLayer=0;this._maxAnisotropy=this._rctx.parameters.maxMaxAnisotropy;this._composition=new q.TileCompositor(this._rctx,this._techniqueRepository);this._blackTex=new k(w.createColorTexture(this._rctx,[0,0,0,1]));this._ensureBackgroundTexture(this.tileSize)}var O=G.prototype;O.dispose=function(){this._composition=n.disposeMaybe(this._composition);
this._backgroundTexture=n.releaseMaybe(this._backgroundTexture);this._blackTex=n.releaseMaybe(this._blackTex)};O.updateTileTexture=function(K,L){if(K.renderData){for(var R=K.surface,M=R.baseOpacity,J=this._numTexturedLayer=0,I=this.tileSize,P=!1,N=R.view.state.pixelRatio,V=!1,S=K.layerInfo[e.LayerClass.MAP],T=S.length,H=0;H<S.length;H++){const W=R.layerViewByIndex(H,e.LayerClass.MAP),Q=W.fullOpacity;C[H]=Q;v.isBaseLayer(W.layer)&&T>=S.length&&(T=H);if(0===Q){S[H].pendingUpdates&=~(r.TileUpdate.TEXTURE_NOFADING&
r.TileUpdate.TEXTURE_FADING);continue}++J;const X=x(K,H);if(X){S[H].pendingUpdates&=~(r.TileUpdate.TEXTURE_NOFADING&r.TileUpdate.TEXTURE_FADING);if(g.isBlendableLayerView(W)){var U=g.isGroupLayer(W.layer.parent)?"normal":W.layer.blendMode;D[H]=U;if(U="normal"!==U)V=U,P=!1}g.isVectorTileLayerView(W)?I=Math.max(I,this.tileSize*N):1===M&&1===Q&&(W.isOpaque||this._dataToTexture(X)&&X.sourceLayerInfo.data.descriptor.isOpaque)&&(P=!0);++this._numTexturedLayer}}this._composition.cleanupFBOPool(N,S.length);
N=I;I=c.nextHighestPowerOfTwo(N);R=I*I;M=N*N;R===M?I=N:(N=I/2,I=R-M<M-N*N?I:N);R=I/this.tileSize;--H;this._ensureBackgroundTexture(this.tileSize);0===this._numTexturedLayer?this._useBackgroundTexture(K,J):(1!==this._numTexturedLayer||V||!this._useLayerTexture(K,H,T,C[H]))&&this._composeMapLayers(K,L,H,T,C,D,I,R,!P||V)}};O._ensureBackgroundTexture=function(K){n.isNone(this._backgroundTexture)&&(this._backgroundTexture=this._buildTexture(K),this._backgroundDirty=!0);this._backgroundDirty&&(this._composition.bindPool(0,
K),this._passParameters.offset=u.ZEROS,this._passParameters.scale=1,this._passParameters.opacity=1,this._passParameters.blendMode=y.LayerBlendMode.Normal,n.isSome(this.backgroundColor)&&(this._passParameters.backgroundColor=this.backgroundColor),this._composition.drawBackground(this._passParameters,n.isSome(this.backgroundColor)?f.BlendLayersOutput.ColorOnly:f.BlendLayersOutput.GridOnly),this._composition.copyFBOToTexture(this._backgroundTexture),this._composition.releasePool(),this._backgroundDirty=
!1)};O._useBackgroundTexture=function(K,L){let R=p.ActivationTime.Immediate;if(K.surface.view.layerViewManager.updating||0<L)R=p.ActivationTime.Delayed;this._backgroundTexture&&n.isNone(K.renderData.textureReference)&&(R=p.ActivationTime.Immediate);K.renderData.setTextureReference(n.isSome(this._backgroundTexture)?new t.TextureReference(this._backgroundTexture,d.TextureUpdate.FADING,F,K.surface.baseOpacity,1,0):null,R)};O._useLayerTexture=function(K,L,R,M){var J=L<R;R=J?1:K.surface.baseOpacity;J=
J?K.surface.baseOpacity:1;L=x(K,L);return this._dataToTexture(L)?(K.renderData.setTextureReference(new t.TextureReference(L.sourceLayerInfo.data,d.TextureUpdate.FADING,L,R,M,J)),!0):!1};O._composeMapLayers=function(K,L,R,M,J,I,P,N,V){this._composition.bindPool(0,P);const S=K.surface.baseOpacity;let T=!1,H=z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,U=!1,W=0;for(;0<=R;R--){const X=x(K,R);if(X&&0!==J[R]){var Q=R<M&&1>S&&!T;this._passParameters.baseOpacity=Q?S:1;Q&&(T=!0);Q=0===W;Q=V&&Q?this.backgroundIsGrid?
f.BlendLayersOutput.GridComposite:f.BlendLayersOutput.ColorComposite:f.BlendLayersOutput.Composite;g.isVectorTileRenderInfo(X)?(this._passParameters.opacity=J[R],this._passParameters.blendMode=y.blendModeFromString[I[R]],U=this._composition.drawVectorData(this._passParameters,X,N,this.tileSize,P,U,Q)):g.isImageryTileRenderInfo(X)?(this._passParameters.opacity=J[R],this._passParameters.blendMode=y.blendModeFromString[I[R]],this._composition.drawImageryTileData(X,Q,this._passParameters),this._hasNearestInterpolation(X)&&
(H=z.TextureSamplingMode.NEAREST)):this._dataToTexture(X)&&(this._passParameters.texture=X.sourceLayerInfo.data.texture,this._passParameters.offset=X.offset,this._passParameters.scale=X.scale,this._passParameters.opacity=J[R],this._passParameters.blendMode=y.blendModeFromString[I[R]],this._composition.drawRasterData(Q,this._passParameters));W++}}M=K.renderData.ensureTexture(P,()=>this._buildTexture(P,H));this._composition.copyFBOToTexture(M);this._composition.releasePool();K.renderData.setTextureReference(new t.TextureReference(M,
L,F,T?1:S,1,0))};O._hasNearestInterpolation=function(K){K=K.sourceLayerInfo.data;return K.source?"nearest"===K.interpolation:!1};O._dataToTexture=function(K){g.isRasterTileRenderInfo(K)&&this._rasterDataToTexture(K);return g.isTextureTileRenderInfo(K)};O._rasterDataToTexture=function(K){const L=K.sourceLayerInfo;L.data=this._buildTexture(L.data);K.tile.setMemoryDirty()};O.setBackground=function(K){this._backgroundColor!==K&&(this._backgroundColor=K,this._backgroundDirty=!0)};O._buildTexture=function(K,
L=z.TextureSamplingMode.LINEAR_MIPMAP_LINEAR){if(n.isNone(K))return null;const R={target:z.TextureType.TEXTURE_2D,pixelFormat:z.PixelFormat.RGBA,dataType:z.PixelType.UNSIGNED_BYTE,wrapMode:z.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:L,maxAnisotropy:this._maxAnisotropy,flipped:!0,hasMipmap:!0};L=this._rctx;let M;if("number"===typeof K)R.width=R.height=K,M=new k(new A.Texture(L,R));else if(K instanceof m.ImageWithType)R.isOpaque=K.isOpaque,M=new k(new A.Texture(L,R,K.image)),K.release();else try{M=
new k(new A.Texture(L,R,K))}catch(J){M=new k(w.createEmptyTexture(L)),console.warn("TileRenderer: failed to execute 'texImage2D', cross-origin image may not be loaded.")}K=L.bindTexture(M.texture,A.Texture.TEXTURE_UNIT_FOR_UPDATES);M.generateMipmap();L.bindTexture(K,A.Texture.TEXTURE_UNIT_FOR_UPDATES);return M};b._createClass(G,[{key:"backgroundIsGrid",get:function(){return n.isNone(this._backgroundColor)}},{key:"backgroundColor",get:function(){return this._backgroundColor}},{key:"test",get:function(){return{backgroundTexture:this._backgroundTexture}}}]);
return G}();const C=[],D=[],E={tile:null,sourceLayerInfo:null,sourceLod:null,offset:[0,0],scale:1,layerIndex:0},F={offset:[0,0],scale:1};a.TileRenderer=B;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/BlendLayersTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../chunks/vec3f64 ./BlendModeTechniqueConfiguration ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileComposite.glsl ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){m=function(r){function y(){var f=r.apply(this,arguments)||this;f.opacity=1;f.baseOpacity=1;f.texture=null;f.fboTexture=null;f.blendMode=v.LayerBlendMode.Normal;f.backgroundColor=l.ZEROS;return f}c._inheritsLoose(y,r);return y}(m.TileCompositePassParameters);e=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var f=y.prototype;f.initializeProgram=function(w){const z=y.shader.get().build(this.configuration);return new t.Program(w.rctx,
z,p.Default3D)};f.initializePipeline=function(){return k.makePipelineState({blending:k.simpleBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams})};return y}(e.ShaderTechnique);e.shader=new d.ReloadableShaderModule(h.BlendLayers,()=>new Promise((r,y)=>a(["../webgl-engine/core/shaderLibrary/util/BlendLayers.glsl"],r,y)));u=function(r){function y(){var f=r.apply(this,arguments)||this;f.output=h.BlendLayersOutput.Composite;f.baseOpacityMode=h.BaseOpacityMode.One;
f.premultipliedSource=!1;return f}c._inheritsLoose(y,r);return y}(u.BlendModeTechniqueConfiguration);n.__decorate([g.parameter({count:h.BlendLayersOutput.COUNT})],u.prototype,"output",void 0);n.__decorate([g.parameter({count:h.BaseOpacityMode.COUNT})],u.prototype,"baseOpacityMode",void 0);n.__decorate([g.parameter()],u.prototype,"premultipliedSource",void 0);b.BlendLayersPassParameters=m;b.BlendLayersTechnique=e;b.BlendLayersTechniqueConfiguration=u;Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/BlendModeTechniqueConfiguration":function(){define(["exports","../../../chunks/_rollupPluginBabelHelpers","../../../chunks/tslib.es6","../webgl-engine/core/shaderLibrary/output/BlendOptions","../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n,l){let u=function(v){function m(){var h=v.apply(this,arguments)||this;h.blendMode=n.LayerBlendMode.Normal;return h}b._inheritsLoose(m,v);return m}(l.ShaderTechniqueConfiguration);
c.__decorate([l.parameter({count:n.LayerBlendMode.COUNT})],u.prototype,"blendMode",void 0);a.BlendModeTechniqueConfiguration=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TextureReference":function(){define(["exports","../../../chunks/vec3f64","../../../chunks/vec4f64"],function(a,b,c){let n=function(){function l(u,v,m,h,d,e){this.texture=u;this.type=v;u.retain();this.offsetAndScale=c.fromValues(m.offset[0],m.offset[1],m.scale,
m.scale);this.opacities=b.fromValues(h,e,d)}l.prototype.destroy=function(){this.texture.release()};return l}();a.TextureReference=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TileCompositor":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../core/Logger ../../../core/maybe ../../../chunks/vec2f64 ../../2d/engine/imagery/enums ../../2d/engine/vectorTiles/VectorTileRendererHelper3D ./BlendLayersTechnique ./LayerClass ./RasterColorizerTechnique ./support/FBOPool ../webgl-engine/core/shaderLibrary/output/BlendOptions ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../../../chunks/BlendLayers.glsl ../webgl-engine/lib/BindParameters ../webgl-engine/lib/DefaultVertexBufferLayouts ../webgl-engine/lib/glUtil3D ../../webgl/enums ../../webgl/Texture ../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){const z=c.getLogger("esri.views.3d.terrain");c=function(){function A(B,C){this._rctx=B;this._techniqueRepository=C;this._fboPools=[];this._doubleBufferFbo=[];this._vectorTileHelper=new v.VectorTileRendererHelper3D;this._bindParameters=new q.BindParameters(null,null,null);this._blendLayersTechniqueConfig=new m.BlendLayersTechniqueConfiguration;this._poolToWrite=0;this._vaoQuad=r.createQuadVAO(this._rctx,k.Pos2Tex);this._fboPools.push(new e.FBOPool(this._rctx));
this._fboPools.push(new e.FBOPool(this._rctx))}var x=A.prototype;x.dispose=function(){this._fboPools.forEach(B=>{B.clear();B=null});this._fboPools=null;this._doubleBufferFbo.forEach(B=>B=n.disposeMaybe(B));this._vaoQuad=n.disposeMaybe(this._vaoQuad);this._vectorTileHelper=n.disposeMaybe(this._vectorTileHelper);this._backgroundTechnique=n.releaseMaybe(this._backgroundTechnique);this._applyOpacityTechnique=n.releaseMaybe(this._applyOpacityTechnique);this._blendLayersTechnique=n.releaseMaybe(this._blendLayersTechnique)};
x._getBlendLayersTechnique=function(B,C,D,E=!1){this._blendLayersTechniqueConfig.output=C;this._blendLayersTechniqueConfig.blendMode=B;this._blendLayersTechniqueConfig.baseOpacityMode=D?C===t.BlendLayersOutput.Composite?t.BaseOpacityMode.OnBaseLayer:t.BaseOpacityMode.OnBackground:t.BaseOpacityMode.One;this._blendLayersTechniqueConfig.premultipliedSource=E;return this._blendLayersTechnique=this._techniqueRepository.releaseAndAcquire(m.BlendLayersTechnique,this._blendLayersTechniqueConfig,this._blendLayersTechnique)};
x.drawBackground=function(B,C){C=this._getBlendLayersTechnique(g.LayerBlendMode.Normal,C,!1);B=this._rctx.bindTechnique(C,B,this._bindParameters);this._render(B)};x._render=function(B){this._rctx.bindVAO(this._vaoQuad);B.assertCompatibleVertexAttributeLocations(this._vaoQuad);this._rctx.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,w.vertexCount(this._vaoQuad,"geometry"))};x.drawRasterData=function(B,C,D=!1){if(!n.isNone(C.texture)){var E=1>C.baseOpacity;C.blendMode!==g.LayerBlendMode.Normal||E||D?
(C.fboTexture=this._currentFBO.colorTexture,this._switchPool(this._currentFBO.width)):C.fboTexture=null;B=this._getBlendLayersTechnique(C.blendMode,B,E,D);C=this._rctx.bindTechnique(B,C,this._bindParameters);this._render(C)}};x.drawImageryTileData=function(B,C,D){var E=B.sourceLayerInfo.data;if(E.source){B.tile.surface.layerViewByIndex(B.layerIndex,h.LayerClass.MAP).ensureSymbolizerParameters(E);var F=1>D.baseOpacity;D.blendMode!==g.LayerBlendMode.Normal||F?(D.fboTexture=this._currentFBO.colorTexture,
this._switchPool(this._currentFBO.width)):D.fboTexture=null;C=this._getRasterColorizerTechnique(E,C,D.blendMode,F);F=this._rctx.bindTechnique(C);E.bind(this._rctx)&&(E.opacity=D.opacity,E=E.getUniforms(),E.scale=B.scale,E.offset=B.offset,E.backgroundColor=D.backgroundColor,E.fboTexture=D.fboTexture,E.baseOpacity=D.baseOpacity,C.bindPass(E,null),this._render(F))}};x._getRasterColorizerTechnique=function(B,C,D,E){const F=B.symbolizerParameters,G=["stretch","lut","hillshade"].indexOf(F.type);n.isNone(this._rasterColorizerConfig)&&
(this._rasterColorizerConfig=new d.RasterColorizerTechniqueConfiguration,this._rctx.gl.getExtension("WEBGL_color_buffer_float"),this._rctx.gl.getExtension("OES_texture_float"));this._rasterColorizerConfig.tileBlendInput=C===t.BlendLayersOutput.ColorComposite?p.TileBlendInput.ColorComposite:C===t.BlendLayersOutput.GridComposite?p.TileBlendInput.GridComposite:p.TileBlendInput.LayerOnly;this._rasterColorizerConfig.blendMode=D;this._rasterColorizerConfig.baseOpacityMode=E?C===t.BlendLayersOutput.Composite?
t.BaseOpacityMode.OnBaseLayer:t.BaseOpacityMode.OnBackground:t.BaseOpacityMode.One;this._rasterColorizerConfig.colorizerType=G;this._rasterColorizerConfig.applyColormap=!!F.colormap;this._rasterColorizerConfig.stretchType=B.hasStretchTypeNone()?u.RasterColorizerStretchType.Noop:u.RasterColorizerStretchType.PerBand;return this._rasterColorizerTechnique=this._techniqueRepository.releaseAndAcquire(d.RasterColorizerTechnique,this._rasterColorizerConfig,this._rasterColorizerTechnique)};x.drawVectorData=
function(B,C,D,E,F,G,O){const K=this._rctx,L=C.sourceLayerInfo.data,R=C.tile.surface.layerViewByIndex(C.layerIndex,h.LayerClass.MAP),M=1>B.baseOpacity||1>B.opacity||B.blendMode!==g.LayerBlendMode.Normal||O!==t.BlendLayersOutput.Composite;this._getBlendLayersTechnique(B.blendMode,O,1>B.baseOpacity,M).bindPipelineState(K);let J;M?(J=this._acquire(F),K.bindFramebuffer(J),K.setClearColor(0,0,0,0),K.clearSafe(y.ClearBufferBit.COLOR_BUFFER_BIT|y.ClearBufferBit.DEPTH_BUFFER_BIT)):G&&K.clearSafe(y.ClearBufferBit.DEPTH_BUFFER_BIT);
try{this._vectorTileHelper.render(K,C.sourceLod,L,R.painter,R.layer.styleRepository,R.schemaHelper,Math.round(1/C.scale),C.offset,E,D)}catch(I){z.warnOnce("A render call containing vector tiles did not resolve correctly.",I)}return n.isSome(J)?(K.bindFramebuffer(this._currentFBO),B.texture=J.colorTexture,B.offset=l.ZEROS,B.scale=1,this.drawRasterData(O,B,M),J.release(),G):!0};x.copyFBOToTexture=function(B){const C=this._rctx,D=C.bindTexture(B.texture,f.Texture.TEXTURE_UNIT_FOR_UPDATES),E=B.descriptor;
C.gl.copyTexImage2D(y.TextureType.TEXTURE_2D,0,E.pixelFormat,0,0,E.width,E.height,0);B.generateMipmap();C.bindTexture(D,f.Texture.TEXTURE_UNIT_FOR_UPDATES)};x._initFBO=function(B,C){this._rctx.bindFramebuffer(B);this._rctx.setViewport(0,0,C,C);this._rctx.setClearColor(0,0,0,0);this._rctx.setClearDepth(1);this._rctx.clearSafe(y.ClearBufferBit.COLOR_BUFFER_BIT|y.ClearBufferBit.DEPTH_BUFFER_BIT)};x._acquire=function(B){return this._fboPools[this._poolToWrite].acquire(B)};x.bindPool=function(B,C){this._poolToWrite=
B;null==this._doubleBufferFbo[B]&&(this._doubleBufferFbo[B]=this._acquire(C),this._initFBO(this._doubleBufferFbo[B],C))};x._switchPool=function(B){this._releaseCurrentFBO();this._doubleBufferFbo[this._poolToWrite]=null;this._poolToWrite=0===this._poolToWrite?1:0;this.bindPool(this._poolToWrite,B)};x._releaseCurrentFBO=function(){this._doubleBufferFbo[this._poolToWrite].release();this._doubleBufferFbo[this._poolToWrite]=null};x.releasePool=function(){this._rctx.bindFramebuffer(null);this._releaseCurrentFBO()};
x.cleanupFBOPool=function(B,C){if(B!==this._lastPixelRatio||C!==this._lastNumLayers)this._fboPools.forEach(D=>D.clear()),this._lastPixelRatio=B,this._lastNumLayers=C};b._createClass(A,[{key:"_currentFBO",get:function(){return this._doubleBufferFbo[this._poolToWrite]}}]);return A}();a.TileCompositor=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/vectorTiles/VectorTileRendererHelper3D":function(){define(["exports","../../../../geometry",
"../../../../Viewpoint","../../ViewState","../../../../geometry/Point"],function(a,b,c,n,l){b=function(){function u(){this._renderParams={context:null,drawPhase:1,state:new n({viewpoint:new c({targetGeometry:new l(0,0),scale:1,rotation:0}),size:[256,256]}),stationary:!0,pixelRatio:1,displayLevel:-1,requiredLevel:-1,globalOpacity:1,renderPass:"background",styleLayer:null,styleLayerUID:-1,painter:null,glyphMosaic:null,spriteMosaic:null,profiler:null,renderingOptions:null,requestRender:null,deltaTime:-1,
timeline:null,time:0,hasClipping:!1,blendMode:null,dataUploadCounter:0,effects:null,inFadeTransition:!1,requireFBO:!1}}var v=u.prototype;v.dispose=function(){this._renderParams=null};v.render=function(m,h,d,e,g,p,t,q,k,r){const y=p.adjustLevel(h[0]),f=this._renderParams;f.context=m;f.painter=e;f.glyphMosaic=e.glyphMosaic;f.spriteMosaic=e.spriteMosaic;f.pixelRatio=r;f.displayLevel=y;f.requiredLevel=y;r=p.getScale(h[0]);const [w,z]=p.getShift(h,t*r);h=.125*t*r/k;p=d.transforms.dvs;p[0]=h;p[4]=-h;p[6]=
-1-w-q[0]*t*2;p[7]=1+z+(1-q[1])*t*2-2;f.state.size[0]=k;f.state.size[1]=k;d.stage||d.attachWithContext(m);d.triangleCount=0;e.drawTile(f,d,g)};return u}();a.VectorTileRendererHelper3D=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/ViewState":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../Viewpoint ../../core/JSONSupport ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df32 ../../chunks/mat2df64 ../../chunks/mat3 ../../chunks/mat3f32 ../../chunks/vec2 ../../chunks/vec2f32 ../../chunks/vec2f64 ../../core/libs/gl-matrix-2/types/vec2 ./viewpointUtils ../../geometry/Extent ../../geometry/Point".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){var B;const C=[0,0];c=B=function(D){function E(G){G=D.call(this,G)||this;G._viewpoint2D={center:f.create(),rotation:0,scale:0,spatialReference:null};G.center=[0,0];G.extent=new A;G.id=0;G.inverseTransform=t.create();G.resolution=0;G.rotation=0;G.scale=0;G.transform=t.create();G.transformNoRotation=t.create();G.displayMat3=k.create();G.displayViewMat3=k.create();G.viewMat3=k.create();G.viewMat2d=p.create();G.worldScreenWidth=0;G.size=[0,0];return G}
a._inheritsLoose(E,D);var F=E.prototype;F.copy=function(G){const O=this.size,K=this.viewpoint;K&&O?(this.viewpoint=z.copy(K,G.viewpoint),this._set("size",r.copy(O,G.size))):(this.viewpoint=G.viewpoint.clone(),this._set("size",[G.size[0],G.size[1]]));this._set("pixelRatio",G.pixelRatio);return this};F.clone=function(){return new B({size:this.size,viewpoint:this.viewpoint.clone(),pixelRatio:this.pixelRatio})};F.toMap=function(G,O,K){if(w.isVec2(O))return r.transformMat2d(G,O,this.inverseTransform);
C[0]=O;C[1]=K;return r.transformMat2d(G,C,this.inverseTransform)};F.toScreen=function(G,O,K){if(w.isVec2(O))return r.transformMat2d(G,O,this.transform);C[0]=O;C[1]=K;return r.transformMat2d(G,C,this.transform)};F.toScreenNoRotation=function(G,O,K){if(w.isVec2(O))return r.transformMat2d(G,O,this.transformNoRotation);C[0]=O;C[1]=K;return r.transformMat2d(G,C,this.transformNoRotation)};F.getScreenTransform=function(G,O){const {center:K}=this._viewpoint2D,L=this._get("pixelRatio")||1,R=this._get("size");
z.getMatrix(G,K,R,O,0,L);return G};F._update=function(){const {center:G,spatialReference:O,scale:K,rotation:L}=this._viewpoint2D,R=this._get("pixelRatio")||1,M=this._get("size"),J=new n({targetGeometry:new x(G[0],G[1],O),scale:K,rotation:L});this._set("viewpoint",J);if(M&&O&&K){this.resolution=z.getResolution(J);this.rotation=L;this.scale=K;this.spatialReference=O;r.copy(this.center,G);q.set(this.displayMat3,0!==M[0]?2/M[0]:0,0,0,0,0!==M[1]?-2/M[1]:0,0,-1,1,1);var I=q.identity(this.viewMat3),P=y.fromValues(M[0]/
2,M[1]/2),N=y.fromValues(-M[0]/2,-M[1]/2),V=e.toRadian(L);q.translate(I,I,P);q.rotate(I,I,V);q.translate(I,I,N);q.multiply(this.displayViewMat3,this.displayMat3,I);I=g.fromTranslation(this.viewMat2d,P);g.rotate(I,I,V);g.translate(I,I,N);z.getExtent(this.extent,J,M);z.getTransform(this.transform,J,M,R);g.invert(this.inverseTransform,this.transform);z.getTransformNoRotation(this.transformNoRotation,J,M,R);this.worldScreenWidth=z.getWorldScreenWidth(this.spatialReference,this.resolution);this._set("id",
this.id+1);return this}};a._createClass(E,[{key:"pixelRatio",set:function(G){this._set("pixelRatio",G);this._update()}},{key:"size",set:function(G){this._set("size",G);this._update()}},{key:"viewpoint",set:function(G){if(G){const O=this._viewpoint2D,K=G.targetGeometry;O.center[0]=K.x;O.center[1]=K.y;O.rotation=G.rotation;O.scale=G.scale;O.spatialReference=K.spatialReference}this._update()}}]);return E}(l.JSONSupport);b.__decorate([u.property({readOnly:!0})],c.prototype,"id",void 0);b.__decorate([u.property({value:1,
json:{write:!0}})],c.prototype,"pixelRatio",null);b.__decorate([u.property({json:{write:!0}})],c.prototype,"size",null);b.__decorate([u.property()],c.prototype,"spatialReference",void 0);b.__decorate([u.property({type:n,json:{write:!0}})],c.prototype,"viewpoint",null);return c=B=b.__decorate([d.subclass("esri.views.2d.ViewState")],c)})},"esri/chunks/mat2df64":function(){define(["exports"],function(a){function b(){return[1,0,0,1,0,0]}function c(v){return[v[0],v[1],v[2],v[3],v[4],v[5]]}function n(v,
m,h,d,e,g){return[v,m,h,d,e,g]}function l(v,m){return new Float64Array(v,m,6)}const u=Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.mat2df64=u})},"esri/core/libs/gl-matrix-2/types/vec2":function(){define(["exports"],function(a){function b(n){return n instanceof Float32Array&&2<=n.length}function c(n){return Array.isArray(n)&&2<=n.length}a.isVec2=function(n){return b(n)||
c(n)};a.isVec2f32=b;a.isVec2f64=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/viewpointUtils":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../Viewpoint ../../core/Collection ../../core/maybe ../../core/unitUtils ../../chunks/common ../../chunks/mat2d ../../chunks/mat2df64 ../../chunks/vec2 ../../chunks/vec2f64 ../../geometry/Extent ../../geometry/Geometry ../../geometry/Point ../../geometry/projection ../../geometry/SpatialReference ../../geometry/support/spatialReferenceUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){function y(aa,ea){return ea.type?d.set(aa,ea.x,ea.y):d.copy(aa,ea)}function f(aa,ea){return Math.max(aa.width/Math.max(1,ea[0]),aa.height/Math.max(1,ea[1]))*G(aa.spatialReference)}function w(aa,ea,ia,ka){return z.apply(this,arguments)}function z(){z=b._asyncToGenerator(function*(aa,ea,ia,ka){if(!aa||Array.isArray(aa)&&!aa.length)return null;n.isCollection(aa)&&(aa=aa.toArray());if(Array.isArray(aa)&&aa.length&&"object"===typeof aa[0]){var la=aa.every(ja=>
"attributes"in ja);var Z=aa.some(ja=>!ja.geometry),ca=aa;if(la&&Z&&ea&&ea.allLayerViews){la=new Map;for(var Y of aa)aa=Y.layer,Z=la.get(aa)||[],ca=Y.attributes[aa.objectIdField],null!=ca&&Z.push(ca),la.set(aa,Z);const ja=[];la.forEach((ma,pa)=>{const na=ea.allLayerViews.find(wa=>wa.layer.id===pa.id);if("queryFeatures"in na){const wa=pa.createQuery();wa.objectIds=ma;wa.returnGeometry=!0;ja.push(na.queryFeatures(wa))}});Y=yield Promise.all(ja);aa=[];for(var da of Y)if(da&&da.features&&da.features.length)for(var ha of da.features)l.isSome(ha.geometry)&&
aa.push(ha.geometry);ca=aa}for(const ja of ca)ka=yield w(ja,ea,ia,ka);return ka}if(Array.isArray(aa)&&2===aa.length&&"number"===typeof aa[0]&&"number"===typeof aa[1])la=new t(aa);else if(aa instanceof p)la=aa;else if("geometry"in aa)if(aa.geometry)la=aa.geometry;else if(aa.layer){const ja=aa.layer;da=ea.allLayerViews.find(ma=>ma.layer.id===ja.id);"queryFeatures"in da&&(ha=ja.createQuery(),ha.objectIds=[aa.attributes[ja.objectIdField]],ha.returnGeometry=!0,da=yield da.queryFeatures(ha),la=l.get(da,
"features",0,"geometry"))}if(l.isNone(la))return null;da="point"===la.type?new g({xmin:la.x,ymin:la.y,xmax:la.x,ymax:la.y,spatialReference:la.spatialReference}):la.extent;if(!da)return null;q.isLoaded()||q.canProjectWithoutEngine(da.spatialReference,ia)||(yield q.load());ia=q.project(da,ia);return ia?ka=ka?ka.union(ia):ia:null});return z.apply(this,arguments)}function A(aa){if(aa&&(!Array.isArray(aa)||"number"!==typeof aa[0])&&("object"===typeof aa||Array.isArray(aa)&&"object"===typeof aa[0])){if("layer"in
aa&&aa.layer&&aa.layer.minScale&&aa.layer.maxScale){var ea=aa.layer;return{min:ea.minScale,max:ea.maxScale}}if(Array.isArray(aa)&&aa.length&&aa.every(ia=>"layer"in ia)){let ia=ea=0;for(const ka of aa)(aa=ka.layer)&&aa.minScale&&aa.maxScale&&(ea=aa.minScale<ea?aa.minScale:ea,ia=aa.maxScale>ia?aa.maxScale:ia);return ea&&ia?{min:ea,max:ia}:null}}}function x(aa,ea){return r.equals(aa.wkid?aa:aa.spatialReference||k.WGS84,ea)?aa:q.project(aa,ea)}function B(){B=b._asyncToGenerator(function*(aa,ea){if(!aa||
!ea)return new c({targetGeometry:new t,scale:0,rotation:0});let ia=ea.spatialReference;const {constraints:ka,padding:la,viewpoint:Z,size:ca}=ea,Y=[la?ca[0]-la.left-la.right:ca[0],la?ca[1]-la.top-la.bottom:ca[1]];let da=null;aa instanceof c?da=aa:aa.viewpoint?da=aa.viewpoint:aa.target&&"esri.Viewpoint"===aa.target.declaredClass&&(da=aa.target);let ha=null;if(da&&da.targetGeometry)ha=da.targetGeometry;else if(aa instanceof g)ha=aa;else if(aa||aa&&("center"in aa||"extent"in aa||"target"in aa))ha=(yield w(aa.center,
ea,ia))||(yield w(aa.extent,ea,ia))||(yield w(aa.target,ea,ia))||(yield w(aa,ea,ia));!ha&&Z&&Z.targetGeometry?ha=Z.targetGeometry:!ha&&ea.extent&&(ha=ea.extent);if(!ia){var ja=ea.spatialReference||ea.extent||ha;ia=ja.wkid?ja:ja.spatialReference||k.WGS84}q.isLoaded()||r.equals(ha.spatialReference,ia)||q.canProjectWithoutEngine(ha,ia)||(yield q.load());ja=x(ha.center?ha.center:ha,ia);var ma=null;da&&l.isSome(da.targetGeometry)&&"point"===da.targetGeometry.type?ma=da.scale:"scale"in aa&&aa.scale?ma=
aa.scale:"zoom"in aa&&-1!==aa.zoom&&ka&&ka.effectiveLODs?ma=ka.zoomToScale(aa.zoom):Array.isArray(ha)||"point"===ha.type||"extent"===ha.type&&0===ha.width&&0===ha.height?(ma=x(ea.extent,ia),ma=l.isSome(ma)?f(ma,Y):ea.extent?f(ea.extent,Y):Z.scale):ma=f(x(ha.extent,ia),Y);if(ea=A(aa))ea.min&&ea.min>ma?ma=ea.min:ea.max&&ea.max<ma&&(ma=ea.max);ea=0;da?ea=da.rotation:aa.hasOwnProperty("rotation")?ea=aa.rotation:Z&&(ea=Z.rotation);aa=new c({targetGeometry:ja,scale:ma,rotation:ea});ka&&(aa=ka.fit(aa),ka.constrainByGeometry(aa),
ka.rotationEnabled||(aa.rotation=ea));return aa});return B.apply(this,arguments)}function C(aa,ea){const ia=aa.targetGeometry,ka=ea.targetGeometry;ia.x=ka.x;ia.y=ka.y;ia.spatialReference=ka.spatialReference;aa.scale=ea.scale;aa.rotation=ea.rotation;return aa}function D(aa,ea,ia){return ia?d.set(aa,.5*(ea[0]-ia.right+ia.left),.5*(ea[1]-ia.bottom+ia.top)):d.scale(aa,ea,.5)}function E(aa,ea,ia,ka){I(aa,ea,ia,ka);return m.invert(aa,aa)}function F(aa){var ea=aa.scale;aa=aa.targetGeometry;aa=l.isSome(aa)&&
r.isValid(aa.spatialReference)?1/(39.37*u.getMetersPerUnitForSR(aa.spatialReference)*96):1;return ea*aa}function G(aa){return r.isValid(aa)?39.37*u.getMetersPerUnitForSR(aa)*96:1}function O(aa){return(aa=r.getInfo(aa))?aa.valid[1]-aa.valid[0]:0}const K=180/Math.PI,L=function(){const aa=e.create();return function(ea,ia,ka){const la=ia.targetGeometry;y(aa,la);ia=.5*F(ia);ea.xmin=aa[0]-ia*ka[0];ea.ymin=aa[1]-ia*ka[1];ea.xmax=aa[0]+ia*ka[0];ea.ymax=aa[1]+ia*ka[1];ea.spatialReference=la.spatialReference;
return ea}}(),R=function(){const aa=e.create();return function(ea,ia,ka){return d.sub(ea,d.scale(ea,ia,.5),D(aa,ia,ka))}}(),M=function(){const aa=h.create(),ea=e.create();return function(ia,ka,la,Z){const ca=F(ka);ka=v.toRadian(ka.rotation)||0;d.set(ea,ca,ca);m.fromScaling(aa,ea);m.rotate(aa,aa,ka);m.translate(aa,aa,R(ea,la,Z));m.translate(aa,aa,[0,Z.top-Z.bottom]);return d.set(ia,aa[4],aa[5])}}(),J=function(){const aa=e.create(),ea=e.create(),ia=e.create();return function(ka,la,Z,ca,Y,da){d.negate(aa,
la);d.scale(ea,Z,.5*da);d.set(ia,1/ca*da,-1/ca*da);m.fromTranslation(ka,ea);Y&&m.rotate(ka,ka,Y);m.scale(ka,ka,ia);m.translate(ka,ka,aa);return ka}}(),I=function(){const aa=e.create();return function(ea,ia,ka,la){const Z=F(ia),ca=v.toRadian(ia.rotation)||0;y(aa,ia.targetGeometry);return J(ea,aa,ka,Z,ca,la)}}(),P=function(){const aa=e.create();return function(ea,ia,ka,la){const Z=F(ia);y(aa,ia.targetGeometry);return J(ea,aa,ka,Z,0,la)}}(),N=function(){const aa=e.create(),ea=e.create(),ia=[0,0,0];return function(ka,
la,Z){d.subtract(aa,ka,la);d.normalize(aa,aa);d.subtract(ea,ka,Z);d.normalize(ea,ea);d.cross(ia,aa,ea);ka=Math.acos(d.dot(aa,ea)/(d.length(aa)*d.length(ea)))*K;0>ia[2]&&(ka=-ka);isNaN(ka)&&(ka=0);return ka}}(),V=function(){const aa=e.create();return function(ea,ia,ka,la){const Z=ea.targetGeometry;C(ea,ia);M(aa,ia,ka,la);Z.x+=aa[0];Z.y+=aa[1];return ea}}(),S=function(){return function(aa,ea,ia){C(aa,ea);ea=aa.targetGeometry;ea.x=ia.x;ea.y=ia.y;ea.spatialReference=ia.spatialReference;return aa}}(),
T=function(){const aa=e.create();return function(ea,ia,ka,la,Z){Z||(Z="center");d.sub(aa,ka,la);d.scale(aa,aa,.5);ka=aa[0];la=aa[1];switch(Z){case "center":d.set(aa,0,0);break;case "left":d.set(aa,-ka,0);break;case "top":d.set(aa,0,la);break;case "right":d.set(aa,ka,0);break;case "bottom":d.set(aa,0,-la);break;case "top-left":d.set(aa,-ka,la);break;case "bottom-left":d.set(aa,-ka,-la);break;case "top-right":d.set(aa,ka,la);break;case "bottom-right":d.set(aa,ka,-la)}ba(ea,ia,aa);return ea}}(),H=function(){const aa=
e.create();return function(ea,ia,ka,la,Z){C(ea,ia);isNaN(ka)||0===ka||(Q(aa,la,ia,Z),ea.scale=ia.scale*ka,X(aa,aa,ea,Z),ba(ea,ea,d.set(aa,aa[0]-la[0],la[1]-aa[1])));return ea}}(),U=function(){const aa=e.create();return function(ea,ia,ka,la,Z,ca){C(ea,ia);isNaN(ka)||0===ka||(Q(aa,Z,ia,ca),ea.scale=ia.scale*ka,ea.rotation+=la,X(aa,aa,ea,ca),ba(ea,ea,d.set(aa,aa[0]-Z[0],Z[1]-aa[1])));return ea}}(),W=function(){const aa=e.create(),ea=e.create();return function(ia,ka,la,Z,ca,Y,da){R(ea,Y,da);d.add(aa,
ca,ea);return Z?U(ia,ka,la,Z,aa,Y):H(ia,ka,la,aa,Y)}}(),Q=function(){const aa=h.create();return function(ea,ia,ka,la){return d.transformMat2d(ea,ia,E(aa,ka,la,1))}}(),X=function(){const aa=h.create();return function(ea,ia,ka,la){return d.transformMat2d(ea,ia,I(aa,ka,la,1))}}(),ba=function(){const aa=e.create(),ea=h.create();return function(ia,ka,la){C(ia,ka);const Z=F(ka),ca=ia.targetGeometry;m.fromRotation(ea,v.toRadian(ka.rotation)||0);m.scale(ea,ea,e.fromValues(Z,Z));d.transformMat2d(aa,la,ea);
ca.x+=aa[0];ca.y+=aa[1];return ia}}();a.addPadding=V;a.angleBetween=N;a.centerAt=S;a.copy=C;a.create=function(aa,ea){return B.apply(this,arguments)};a.extentToScale=f;a.getAnchor=D;a.getExtent=L;a.getMatrix=J;a.getPaddingMapTranslation=M;a.getPaddingScreenTranslation=R;a.getResolution=F;a.getResolutionToScaleFactor=G;a.getTransform=I;a.getTransformNoRotation=P;a.getWorldScreenWidth=function(aa,ea){return Math.round(O(aa)/ea)};a.getWorldWidth=O;a.padAndScaleAndRotateBy=W;a.resize=T;a.rotateBy=function(aa,
ea,ia){C(aa,ea);aa.rotation+=ia;return aa};a.rotateTo=function(aa,ea,ia){C(aa,ea);aa.rotation=ia;return aa};a.scaleAndRotateBy=U;a.scaleTo=function(aa,ea,ia){C(aa,ea);aa.scale=ia;return aa};a.setExtent=function(aa,ea,ia,ka,la){S(aa,ea,ia.center);aa.scale=f(ia,ka);la&&la.constraints&&la.constraints.constrain(aa);return aa};a.toMap=Q;a.toScreen=X;a.translateBy=ba;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/RasterColorizerTechnique":function(){define("require exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../2d/engine/imagery/enums ./BlendModeTechniqueConfiguration ../../../chunks/RasterColorizer.glsl ../webgl-engine/core/shaderLibrary/terrain/TileBlendInput ../../../chunks/BlendLayers.glsl ../webgl-engine/core/shaderTechnique/ReloadableShaderModule ../webgl-engine/core/shaderTechnique/ShaderTechnique ../webgl-engine/core/shaderTechnique/ShaderTechniqueConfiguration ../webgl-engine/lib/DefaultVertexAttributeLocations ../webgl-engine/lib/Program ../../webgl/enums ../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){e=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var f=y.prototype;f.initializeProgram=function(w){const z=y.shader.get().build(this.configuration);return new t.Program(w.rctx,z,p.Default3D)};f.initializePipeline=function(){return k.makePipelineState({blending:k.simpleBlendingParams(q.BlendFactor.ONE,q.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:k.defaultColorWriteParams})};return y}(e.ShaderTechnique);e.shader=new d.ReloadableShaderModule(v.RasterColorizer,
()=>new Promise((r,y)=>a(["../webgl-engine/core/shaderLibrary/raster/RasterColorizer.glsl"],r,y)));u=function(r){function y(){var f=r.apply(this,arguments)||this;f.colorizerType=l.RasterColorizerType.Stretch;f.stretchType=l.RasterColorizerStretchType.Noop;f.tileBlendInput=m.TileBlendInput.LayerOnly;f.baseOpacityMode=h.BaseOpacityMode.One;f.applyColormap=!0;return f}c._inheritsLoose(y,r);return y}(u.BlendModeTechniqueConfiguration);n.__decorate([g.parameter({count:l.RasterColorizerType.COUNT})],u.prototype,
"colorizerType",void 0);n.__decorate([g.parameter({count:l.RasterColorizerStretchType.COUNT})],u.prototype,"stretchType",void 0);n.__decorate([g.parameter({count:m.TileBlendInput.COUNT})],u.prototype,"tileBlendInput",void 0);n.__decorate([g.parameter({count:h.BaseOpacityMode.COUNT})],u.prototype,"baseOpacityMode",void 0);n.__decorate([g.parameter()],u.prototype,"applyColormap",void 0);b.RasterColorizerTechnique=e;b.RasterColorizerTechniqueConfiguration=u;Object.defineProperties(b,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/support/FBOPool":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../core/ObjectPool","../../../webgl/enums","../../../webgl/FramebufferObject"],function(a,b,c,n,l){let u=function(){function m(d){this._rctx=d;this._pools=new Map}var h=m.prototype;h.acquire=function(d){return this._getPool(d).acquire()};h.clear=function(){this._pools.forEach(d=>d.destroy());this._pools.clear()};h._getPool=function(d){var e=
this._pools.get(d);e||(e=v.bind(v,this._rctx,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.DEPTH_RENDER_BUFFER,width:d,height:d},g=>this._getPool(g.width).release(g)),e=new c(e,null,()=>{}),this._pools.set(d,e));return e};return m}(),v=function(m){function h(d,e,g){var p=m.call(this,d,e)||this;p.release=()=>g(b._assertThisInitialized(p));return p}b._inheritsLoose(h,m);return h}(l.FramebufferObject);a.FBOPool=u;a.PooledFramebufferObject=v;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentIntersectionData":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/mathUtils ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../materials/internal/MaterialUtil".split(" "),function(a,b,c,n,l,u){function v(y,f,w){let z=0,A=Infinity;for(let B=0;3>B;++B){var x=y[B];if(f[B]<x){if(1E-6>=w[B])return!1;z=Math.max(z,(x-f[B])/w[B])}else-1E-6>=
w[B]&&(A=Math.min(A,(x-f[B])/w[B]));if(z>A)return!1;x=y[B+3];if(f[B]>x){if(-1E-6<=w[B])return!1;z=Math.max(z,(x-f[B])/w[B])}else 1E-6<=w[B]&&(A=Math.min(A,(x-f[B])/w[B]));if(z>A)return!1}return!0}function m(y,f,w,z,A,x){let B=z;for(;w<B;){var C=y[w];f[6*C+A+3]<=x?++w:(--B,y[w]=y[B],y[B]=C)}C=w;for(B=z;C<B;)z=y[B-1],f[6*z+A]>=x?--B:(y[B-1]=y[C],y[C]=z,++C);return{next:w,mid:C}}function h(y,f,w,z){if(z<=w)return l.fromValues(NaN,NaN,NaN,NaN,NaN,NaN);var A=6*y[w];for(var x=0;3>x;++x)k[x]=f[A+0+x],r[x]=
f[A+3+x];for(w+=1;w<z;++w)for(A=6*y[w],x=0;3>x;++x)k[x]=Math.min(k[x],f[A+0+x]),r[x]=Math.max(r[x],f[A+3+x]);return l.fromValues(k[0],k[1],k[2],r[0],r[1],r[2])}function d(y){var f=y[3]-y[0];const w=y[4]-y[1],z=y[5]-y[2];f=f>w?f>z?0:w>z?1:2:w>z?1:z>f?2:0;return{axis:f,midValue:(y[f]+y[f+3])/2}}function e(y,f,w,z,A){w-=f;const x=new Float32Array(6*w);for(let C=0;C<w;++C){var B=3*(C+f);const D=y[B+0]*A,E=y[B+1]*A;B=y[B+2]*A;for(let F=0;3>F;++F){const G=z[D+F],O=z[E+F],K=z[B+F];x[6*C+F]=Math.min(G,O,
K);x[6*C+3+F]=Math.max(G,O,K)}}return x}function g(y,f,w,z){const A=z-w;var x=0;for(var B=w;B<z;++B)for(var C=0;3>C;++C)x=Math.max(f[3*B+C],x);z=65535>=x?new Uint16Array(3*A):new Uint32Array(3*A);for(x=0;x<A;++x)for(B=3*(y[x]+w),C=0;3>C;++C)z[3*x+C]=f[B+C];return z}let p=function(y,f,w,z,A){this.aabb=y;this.axis=f;this.d=w;this.midStartIndex=z;this.rightStartIndex=A},t=function(){function y(w,z,A,x){this.globalTriangleVertexIndices=w;this.firstTriangleIndex=z;this.positionAttribute=x;this.rayDirection=
n.create();this.bspNodeTree=[];this.vertexPositionBuffer=x.data;this.vertexPositionStride=x.stride;const B=A-z,C=65535>=B?new Uint16Array(B):new Uint32Array(B);this.indices=C;for(let D=0;D<B;++D)C[D]=D;{const D=e(w,z,A,x.data,x.stride),E=c.clamp(Math.log2(B/40),2,10),F=(G,O,K)=>{var L=h(C,D,G,O);const R=O-G;if(40>=R)return G=new p(L,void 0,0,G,O),this.bspNodeTree.push(G),G;const {axis:M,midValue:J}=d(L),I=m(C,D,G,O,M,J),P=(N,V)=>{if(!(K>E)){var S=V-N;if(!(40>S||S>=.8*R))return F(N,V,K+1)}};L=new p(L,
M,J,I.next,I.mid);this.bspNodeTree.push(L);L.leftNode=P(G,I.next);L.rightNode=P(I.mid,O);return L};F(0,B,0);this.triangleVertexIndices=g(C,w,z,A)}}var f=y.prototype;f.intersectRayTriangleRange=function(w,z){{if(w>=z)return;const J=this.triangleVertexIndices,I=this.positionAttribute.data,P=this.positionAttribute.stride;var A=this.rayOrigin;const N=A[0],V=A[1];A=A[2];var x=this.rayDirection;const S=x[0],T=x[1];x=x[2];for(let H=w,U=3*w;H<z;++H){var B=J[U]*P,C=I[B],D=I[B+1],E=I[B+2],F=J[U+1]*P;B=I[F];
var G=I[F+1];F=I[F+2];var O=J[U+2]*P,K=I[O],L=I[O+1];O=I[O+2];U+=3;B-=C;G-=D;F-=E;K-=C;L-=D;O-=E;var R=T*O-L*x,M=x*K-O*S;const W=S*L-K*T,Q=B*R+G*M+F*W;if(!(Math.abs(Q)<=Number.EPSILON)){C=N-C;D=V-D;E=A-E;R=C*R+D*M+E*W;if(0<Q){if(0>R||R>Q)continue}else if(0<R||R<Q)continue;M=D*F-G*E;E=E*B-F*C;D=C*G-B*D;C=S*M+T*E+x*D;if(0<Q){if(0>C||R+C>Q)continue}else if(0<C||R+C<Q)continue;D=(K*M+L*E+O*D)/Q;0<=D&&(E=this.indices[H]+this.firstTriangleIndex,B=u.computeNormal(B,G,F,K,L,O,q),this.callback(D,B,E,!1))}}}y.numFacesTested+=
z-w};f.intersectRay=function(w,z){y.numFacesTested=0;var A=n.fromValues(w.r0[0],w.r0[1],w.r0[2]),x=n.fromValues(w.r1[0],w.r1[1],w.r1[2]);w=x[0]-A[0];const B=x[1]-A[1];x=x[2]-A[2];1E-6>w*w+B*B+x*x||(this.rayOrigin=A,A=this.rayDirection,A[0]=w,A[1]=B,A[2]=x,A=this.triangleVertexIndices.length/3,this.callback=z,this.intersectRayBSP(this.bspNodeTree[0],0,A))};f.intersectRayBSP=function(w,z,A){const x=this.rayOrigin,B=this.rayDirection;if(v(w.aabb,x,B)){var C=w.axis,D=w.d;if(x[C]<D||0>B[C]){const E=w.midStartIndex;
if(z<E){const F=w.leftNode;void 0!==F?this.intersectRayBSP(F,z,E):this.intersectRayTriangleRange(z,E)}}this.intersectRayTriangleRange(w.midStartIndex,w.rightStartIndex);if(x[C]>D||0<B[C])z=w.rightStartIndex,z<A&&(w=w.rightNode,void 0!==w?this.intersectRayBSP(w,z,A):this.intersectRayTriangleRange(z,A))}};b._createClass(y,[{key:"estimatedMemoryUsage",get:function(){return this.triangleVertexIndices.byteLength+this.indices.byteLength}}]);return y}();t.numFacesTested=0;const q=n.create(),k=[Infinity,
Infinity,Infinity],r=[-Infinity,-Infinity,-Infinity];a.ComponentIntersectionData=t;a.componentMinimalSizeForIntersectionData=200;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/vec4f64 ../../../../../../geometry/support/aaBoundingRect ../../../../terrain/interfaces ../../renderPasses/AllRenderPasses ../shading/PhysicallyBasedRenderingParameters.glsl ../shading/Water.glsl ../../shaderModules/Float3PassUniform ../../shaderModules/Float4DrawUniform ../../shaderModules/Float4Uniform ../../shaderModules/FloatPassUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(f,w){f.extensions.add("GL_OES_standard_derivatives");w.pbrMode!==v.PBRMode.Water&&w.pbrMode!==v.PBRMode.WaterOnIntegratedMesh||f.include(m.Water,w);const {vertex:z,fragment:A}=f;f.varyings.add("vtcOverlay","vec4");z.code.add(p.glsl`void setOverlayVTC(in vec2 uv) {
vtcOverlay = vec4(uv, uv) * overlayTexScale + overlayTexOffset;
}`);A.code.add(p.glsl`bool isValid(vec2 uv, vec2 dxdy) {
return (uv.x >= 0.0 + dxdy.x) && (uv.x <= 1.0 - dxdy.x) && (uv.y >= 0.0 + dxdy.y) && (uv.y <= 1.0 - dxdy.y);
}
vec4 getOverlayColor(sampler2D ov0Tex, vec4 texCoords) {
vec4 color0 = texture2D(ov0Tex, vec2(texCoords.x * 0.5, texCoords.y));
vec4 color1 = texture2D(ov0Tex, vec2(texCoords.z * 0.5 + 0.5, texCoords.w));
bool isValid0 = isValid(texCoords.xy, fwidth(texCoords.xy));
bool isValid1 = isValid(texCoords.zw, vec2(0.0, 0.0));
return mix(color1 * float(isValid1), color0, float(isValid0));
}`);A.code.add(p.glsl`vec4 getCombinedOverlayColor() {
return overlayOpacity * getOverlayColor(ovColorTex, vtcOverlay);
}`);if(w.pbrMode===v.PBRMode.Water||w.pbrMode===v.PBRMode.WaterOnIntegratedMesh)A.uniforms.add([new h.Float3PassUniform("lightingMainDirection",(x,B)=>B.lighting.lightingMainDirection),new h.Float3PassUniform("lightingMainIntensity",(x,B)=>B.lighting.mainLight.intensity)]),A.code.add(p.glsl`vec4 getOverlayWaterColor(vec4 maskInput, vec4 colorInput, vec3 vposEyeDir,
float shadow, vec3 localUp, mat3 tbn, vec3 position, vec3 positionWorld) {
vec3 n = normalize(tbn *  (2.0 * maskInput.rgb - vec3(1.0)));
vec3 v = vposEyeDir;
vec3 final = getSeaColor(n, v, lightingMainDirection, colorInput.rgb, lightingMainIntensity, localUp, 1.0 - shadow, maskInput.w, position, positionWorld);
return vec4(final, colorInput.w);
}`)}function k(f,w){return 0===w.overlays.length?null:f.identifier===u.RenderPassIdentifier.Material&&f.subPass===u.MaterialSubPass.Color?w.overlays[l.OverlayIndex.INNER].getColorTextureNoRasterImage():f.identifier===u.RenderPassIdentifier.Highlight?w.overlays[l.OverlayIndex.INNER].getValidTexture(l.RenderTargetType.Highlight):null}a.OverlayMode=void 0;(function(f){f[f.Disabled=0]="Disabled";f[f.Enabled=1]="Enabled";f[f.EnabledWithWater=2]="EnabledWithWater";f[f.COUNT=3]="COUNT"})(a.OverlayMode||
(a.OverlayMode={}));let r=function(f){function w(){var z=f.apply(this,arguments)||this;z.overlayOpacity=1;return z}b._inheritsLoose(w,f);return w}(p.NoParameters);const y=c.create();a.OverlayIM=function(f,w){const {vertex:z,fragment:A}=f;z.uniforms.add([new d.Float4DrawUniform("overlayTexOffset",(x,B)=>{for(const C of B.overlays){const {index:D,extent:E}=C;0<n.area(E)&&(y[2*D]=x.toMapSpace[0]/n.width(E)-E[0]/n.width(E),y[2*D+1]=x.toMapSpace[1]/n.height(E)-E[1]/n.height(E))}return y}),new d.Float4DrawUniform("overlayTexScale",
(x,B)=>{for(const C of B.overlays){const {index:D,extent:E}=C;0<n.area(E)&&(y[2*D]=x.toMapSpace[2]/n.width(E),y[2*D+1]=x.toMapSpace[3]/n.height(E))}return y})]);A.constants.add("overlayOpacity","float",1);A.uniforms.add(new t.Texture2DPassUniform("ovColorTex",(x,B)=>k(x,B)));q(f,w)};a.OverlayTerrain=function(f,w){f.vertex.uniforms.add([new e.Float4Uniform("overlayTexOffset"),new e.Float4Uniform("overlayTexScale")]);f.fragment.uniforms.add([new g.FloatPassUniform("overlayOpacity",z=>z.overlayOpacity),
new t.Texture2DPassUniform("ovColorTex",(z,A)=>0===A.overlays.length?null:A.overlays[l.OverlayIndex.INNER].getColorTexture(z.overlaySource))]);q(f,w)};a.OverlayTerrainPassParameters=r;a.getColorTexture=k;a.overlay=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/renderPasses/AllRenderPasses":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3f64","../shaderLibrary/attributes/VertexNormal.glsl"],
function(a,b,c,n){let l=function(h){function d(){var e=h.apply(this,arguments)||this;e.slicePlaneLocalOrigin=c.create();e.origin=e.slicePlaneLocalOrigin;return e}b._inheritsLoose(d,h);return d}(n.VertexNormalPassParameters);n=function(h){function d(){return h.apply(this,arguments)||this}b._inheritsLoose(d,h);return d}(n.VertexNormalDrawParameters);a.RenderPassIdentifier=void 0;(function(h){h[h.Material=0]="Material";h[h.ShadowMap=1]="ShadowMap";h[h.Highlight=2]="Highlight"})(a.RenderPassIdentifier||
(a.RenderPassIdentifier={}));a.MaterialSubPass=void 0;(function(h){h[h.Color=0]="Color";h[h.Alpha=1]="Alpha";h[h.Depth=2]="Depth";h[h.Normal=3]="Normal"})(a.MaterialSubPass||(a.MaterialSubPass={}));let u=function(h){function d(){var e=h.apply(this,arguments)||this;e.identifier=a.RenderPassIdentifier.Material;e.transparent=!1;e.integratedMesh=!1;return e}b._inheritsLoose(d,h);return d}(l),v=function(h){function d(){var e=h.apply(this,arguments)||this;e.identifier=a.RenderPassIdentifier.ShadowMap;return e}
b._inheritsLoose(d,h);return d}(l),m=function(h){function d(){var e=h.apply(this,arguments)||this;e.identifier=a.RenderPassIdentifier.Highlight;return e}b._inheritsLoose(d,h);return d}(l);a.DrawParameters=n;a.HighlightPassParameters=m;a.MaterialPassParameters=u;a.PassParameters=l;a.ShadowMapPassParameters=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/Float4DrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers",
"./Uniform","../shaderTechnique/BindType"],function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"vec4",n.BindType.Draw,(h,d,e)=>h.setUniform4fv(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.Float4DrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/Terrain.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ./vec3 ./vec3f64 ../views/3d/terrain/interfaces ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/Transform.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateAmbientOcclusion.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/NormalUtils.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/HeaderComment.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3DrawUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4DrawUniform ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/lighting/SceneLighting".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L){function R(P){const N=new G.ShaderBuilder;N.include(z.HeaderComment,{name:"Terrain Shader",output:P.output});N.attributes.add(K.VertexAttribute.POSITION,"vec3");N.attributes.add(K.VertexAttribute.UV0,"vec2");N.attributes.add(K.VertexAttribute.NORMAL,"vec3");const {vertex:V,fragment:S}=N;V.uniforms.add([new F.Matrix4PassUniform("proj",(T,H)=>H.camera.projectionMatrix),new E.Matrix4DrawUniform("view",(T,H)=>c.translate(J,H.camera.viewMatrix,
T.origin)),new x.Float3DrawUniform("origin",T=>T.origin)]);S.uniforms.add(new x.Float3DrawUniform("origin",T=>T.origin));if(P.output===m.ShaderOutput.Color){N.include(d.Transform);N.include(k.NormalUtils,P);N.include(w.TerrainTexture,P);N.include(q.EvaluateSceneLighting,P);const T=P.overlayMode!==f.OverlayMode.Disabled,H=P.overlayMode===f.OverlayMode.EnabledWithWater;T&&N.include(f.OverlayTerrain,{...P,pbrMode:r.PBRMode.Water});H&&N.include(e.VertexTangent,P);N.varyings.add("vnormal","vec3");N.varyings.add("vpos",
"vec3");(P.atmosphere||P.screenSizePerspective)&&V.uniforms.add(new F.Matrix4PassUniform("viewNormal",(W,Q)=>Q.camera.viewInverseTransposeMatrix));const U=P.receiveShadows&&!P.renderOccluded;U&&N.varyings.add("linearDepth","float");P.tileBorders&&N.varyings.add("vuv","vec2");P.atmosphere&&(V.uniforms.add(new B.Float3PassUniform("lightingMainDirection",(W,Q)=>Q.lighting.lightingMainDirection)),N.varyings.add("wnormal","vec3"),N.varyings.add("wlight","vec3"));P.screenSizePerspective&&(N.varyings.add("screenSizeDistanceToCamera",
"float"),N.varyings.add("screenSizeCosAngle","float"));V.code.add(D.glsl`
      void main(void) {
        vpos = position;
        vnormal = ${P.shading?D.glsl`normal`:D.glsl`getLocalUp(vpos, origin)`};
        vec2 uv = uv0;
        ${P.atmosphere?D.glsl`
        wnormal = normalize((viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz);
        wlight = normalize((view  * vec4(lightingMainDirection, 1.0)).xyz);`:""}
        ${P.tileBorders?D.glsl`vuv = uv;`:""}
        ${P.screenSizePerspective?D.glsl`
        vec3 viewPos = (view * vec4(vpos, 1.0)).xyz;
        screenSizeDistanceToCamera = length(viewPos);
        vec3 viewSpaceNormal = (viewNormal * vec4(normalize(vpos + origin), 1.0)).xyz;
        screenSizeCosAngle = abs(viewSpaceNormal.z);`:""}
        gl_Position = transformPosition(proj, view, vpos);
        ${U?D.glsl`linearDepth = gl_Position.w;`:""}
        forwardTextureCoordinates(uv);
        ${T?D.glsl`setOverlayVTC(uv);`:""}
        ${H?D.glsl`forwardVertexTangent(vnormal);`:D.glsl``}
      }
    `);N.extensions.add("GL_OES_standard_derivatives");N.extensions.add("GL_EXT_shader_texture_lod");N.include(h.SliceDraw,P);N.include(q.EvaluateSceneLighting,P);N.include(t.EvaluateAmbientOcclusion,P);N.include(y.ReadShadowMapDraw,P);S.uniforms.add([new x.Float3DrawUniform("cameraPosition",(W,Q)=>l.subtract(I,Q.camera.eye,W.origin)),new B.Float3PassUniform("viewDirection",(W,Q)=>l.normalize(I,l.set(I,Q.camera.viewMatrix[12],Q.camera.viewMatrix[13],Q.camera.viewMatrix[14]))),new C.FloatPassUniform("lightingGlobalFactor",
(W,Q)=>Q.lighting.globalFactor),new B.Float3PassUniform("lightingMainDirection",(W,Q)=>Q.lighting.lightingMainDirection),new B.Float3PassUniform("lightingMainIntensity",(W,Q)=>Q.lighting.mainLight.intensity)]);S.constants.add("ambientBoostFactor","float",L.ambientBoost);H&&S.uniforms.add([new O.Texture2DPassUniform("ovWaterTex",(W,Q)=>0===Q.overlays.length?null:Q.overlays[v.OverlayIndex.INNER].getNormalTexture(W.overlaySource)),new E.Matrix4DrawUniform("view",(W,Q)=>c.translate(J,Q.camera.viewMatrix,
W.origin))]);S.code.add(D.glsl`const float sliceOpacity = 0.2;
float lum(vec3 c) {
return (min(min(c.r, c.g), c.b) + max(max(c.r, c.g), c.b)) * 0.5;
}`);S.code.add(D.glsl`
      void main() {
        ${U?D.glsl`float shadow = readShadowMap(vpos, linearDepth);`:D.glsl`float shadow = 0.0;`}
        vec3 normal = normalize(vnormal);
        float vndl = dot(normal, lightingMainDirection);
        float ssao = evaluateAmbientOcclusionInverse();
        vec4 tileColor = getTileColor();
        ${T?D.glsl`
            vec4 overlayColorOpaque = getOverlayColor(ovColorTex, vtcOverlay);
            vec4 overlayColor = overlayOpacity * overlayColorOpaque;
            vec4 groundColor = tileColor;
            tileColor = tileColor * (1.0 - overlayColor.a) + overlayColor;`:""}
        if (rejectBySlice(vpos)) {
          tileColor *= sliceOpacity;
        }
        ${P.atmosphere?D.glsl`
            float ndotl = clamp(vndl, 0.0, 1.0);
            vec3 atm = vec3(clamp(1.0 - dot(-viewDirection, wnormal), 0.0, 1.0));
            atm *= clamp(1.0 - lum(tileColor.rgb) * 1.5, 0.0, 1.0); //avoid atmosphere on bright base maps
            atm *= clamp(ndotl * 2.0, 0.0, 1.0); // avoid atmosphere on dark side of the globe
            atm *= tileColor.a; // premultiply with tile alpha`:""}

        vec3 albedo = ${P.atmosphere?D.glsl`atm + tileColor.rgb;`:D.glsl`tileColor.rgb;`}

        // heuristic shading function used in the old terrain, now used to add ambient lighting
        float additionalAmbientScale = smoothstep(0.0, 1.0, clamp(vndl${P.shading?"":D.glsl`*2.5`}, 0.0, 1.0));

        vec3 additionalLight = ssao * lightingMainIntensity * additionalAmbientScale * ambientBoostFactor ${P.shading?"":D.glsl`* lightingGlobalFactor`};

        gl_FragColor = vec4(evaluateSceneLighting(normal, albedo, shadow, 1.0 - ssao, additionalLight), tileColor.a);
        ${H?D.glsl`
            vec4 overlayWaterMask = getOverlayColor(ovWaterTex, vtcOverlay);
            float waterNormalLength = length(overlayWaterMask);
            if (waterNormalLength > 0.95) {
              mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, vnormal);
              vec4 waterOverlayColor = vec4(overlayColor.w > 0.0 ? overlayColorOpaque.xyz/overlayColor.w : vec3(1.0), overlayColor.w);
              vec4 viewPosition = view*vec4(vpos, 1.0);
              vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, waterOverlayColor, -normalize(vpos - cameraPosition), shadow, vnormal, tbnMatrix, viewPosition.xyz,  vpos + origin);
              vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
              // un-gamma the ground color to mix in linear space
              gl_FragColor = mix(groundColor, waterColorNonLinear, waterColorLinear.w);
            }`:""}
        ${P.screenSizePerspective?D.glsl`
          float perspectiveScale = screenSizePerspectiveScaleFloat(1.0, screenSizeCosAngle, screenSizeDistanceToCamera, vec4(0.0, 0.0, 0.0, 0.0));
          if (perspectiveScale <= 0.25) {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), perspectiveScale * 4.0);
          }
          else if (perspectiveScale <= 0.5) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.25) * 4.0);
          }
          else if (perspectiveScale >= 0.99) {
            gl_FragColor = mix(gl_FragColor, vec4(0.0, 1.0, 0.0, 1.0), 0.2);
          }
          else {
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 1.0, 1.0), (perspectiveScale - 0.5) * 2.0);
          }`:""}
        ${P.tileBorders?D.glsl`
            vec2 dVuv = fwidth(vuv);
            vec2 edgeFactors = smoothstep(vec2(0.0), 1.5 * dVuv, min(vuv, 1.0 - vuv));
            float edgeFactor = 1.0 - min(edgeFactors.x, edgeFactors.y);
            gl_FragColor = mix(gl_FragColor, vec4(1.0, 0.0, 0.0, 1.0), edgeFactor);`:""}
        gl_FragColor = highlightSlice(gl_FragColor, vpos);
      }
    `)}if(P.output===m.ShaderOutput.Depth||P.output===m.ShaderOutput.Shadow)N.include(d.Transform,{hasModelTransformation:!1,linearDepth:!0}),N.include(g.OutputDepth,{output:P.output}),N.include(k.NormalUtils,P),N.varyings.add("linearDepth","float"),V.uniforms.add(new A.Float2PassUniform("nearFar",(T,H)=>H.camera.nearFar)),V.code.add(D.glsl`void main(void) {
gl_Position = transformPositionWithDepth(proj, view, position, nearFar, linearDepth);
}`),S.code.add(D.glsl`void main() {
outputDepth(linearDepth);
}`);P.output===m.ShaderOutput.Normal&&(N.include(d.Transform),N.include(k.NormalUtils,P),N.varyings.add("vnormal","vec3"),N.varyings.add("vpos","vec3"),V.uniforms.add(new F.Matrix4PassUniform("viewNormal",(T,H)=>H.camera.viewInverseTransposeMatrix)),V.code.add(D.glsl`
        void main(void) {
          vec3 normal = ${P.shading?D.glsl`normal`:D.glsl`getLocalUp(position, origin)`};
          vpos = position;

          gl_Position = transformPosition(proj, view, vpos);
          vnormal = normalize((viewNormal * vec4(normal, 1.0)).xyz);
        }
    `),S.code.add(D.glsl`void main() {
vec3 normal = normalize(vnormal);
if (gl_FrontFacing == false) {
normal = -normal;
}
gl_FragColor = vec4(vec3(0.5) + 0.5 * normal, 0.0);
}`));P.output===m.ShaderOutput.Highlight&&(N.include(d.Transform),N.include(k.NormalUtils,P),N.include(f.OverlayTerrain,P),V.code.add(D.glsl`void main() {
setOverlayVTC(uv0);
gl_Position = transformPosition(proj, view, position);
}`),N.include(p.OutputHighlight),S.code.add(D.glsl`void main() {
vec4 overlayColor = getCombinedOverlayColor();
if (overlayColor.a == 0.0) {
gl_FragColor = vec4(0.0);
return;
}
outputHighlight();
}`));return N}let M=function(P){function N(){return P.apply(this,arguments)||this}b._inheritsLoose(N,P);return N}(f.OverlayTerrainPassParameters);const J=n.create(),I=u.create();n=Object.freeze(Object.defineProperty({__proto__:null,TerrainPassParameters:M,build:R},Symbol.toStringTag,{value:"Module"}));a.Terrain=n;a.TerrainPassParameters=M;a.build=R})},"esri/views/3d/webgl-engine/core/shaderLibrary/attributes/VertexTangent.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,
b){a.VertexTangent=function(c,n){c.varyings.add("tbnTangent","vec3");c.varyings.add("tbnBiTangent","vec3");n.spherical?c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), n));
tbnBiTangent = normalize(cross(n, tbnTangent));
}`):c.vertex.code.add(b.glsl`void forwardVertexTangent(vec3 n) {
tbnTangent = vec3(1.0, 0.0, 0.0);
tbnBiTangent = normalize(cross(n, tbnTangent));
}`);c.fragment.code.add(b.glsl`mat3 getTBNMatrix(vec3 n) {
return mat3(tbnTangent, tbnBiTangent, n);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/terrain/TerrainTexture.glsl":function(){define("exports ./BackgroundGrid.glsl ./TileBlendInput ../../shaderModules/Float3Uniform ../../shaderModules/Float4Uniform ../../shaderModules/FloatUniform ../../shaderModules/interfaces ../../shaderModules/Texture2DUniform".split(" "),function(a,b,c,n,l,u,v,m){a.TerrainTexture=function(h,d){h.varyings.add("vtc","vec2");
h.vertex.uniforms.add(new l.Float4Uniform("texOffsetAndScale"));h.fragment.uniforms.add(new m.Texture2DUniform("tex"));h.fragment.uniforms.add(new n.Float3Uniform("textureOpacities"));const e=d.textureFadingEnabled&&!d.renderOccluded;e&&(h.vertex.uniforms.add(new l.Float4Uniform("nextTexOffsetAndScale")),h.varyings.add("nvtc","vec2"),h.fragment.uniforms.add(new m.Texture2DUniform("texNext")),h.fragment.uniforms.add(new n.Float3Uniform("nextTexOpacities")),h.fragment.uniforms.add(new u.FloatUniform("fadeFactor")));
const g=d.tileBlendInput===c.TileBlendInput.ColorComposite;(d=d.tileBlendInput===c.TileBlendInput.GridComposite)&&h.fragment.include(b.BackgroundGrid);g&&h.fragment.uniforms.add(new n.Float3Uniform("backgroundColor"));h.vertex.code.add(v.glsl`
  void forwardTextureCoordinates(in vec2 uv) {
    vtc = uv * texOffsetAndScale.zw + texOffsetAndScale.xy;
    ${e?v.glsl`nvtc = uv * nextTexOffsetAndScale.zw + nextTexOffsetAndScale.xy;`:v.glsl``}
  }`);h.fragment.code.add(v.glsl`
    vec4 applyBaseOpacity(vec4 _color, vec3 _opacities) {
      return _opacities.z <= 0.0 ? _color : _color * _opacities.x;
    }

    vec4 getColor(vec4 color, vec2 uv, vec3 opacities) {
      ${d||g?v.glsl`
              if (opacities.y <= 0.0) {
                return color * opacities.z * opacities.x;
              }
              vec4 bg = ${g?v.glsl`vec4(backgroundColor, 1.0)`:v.glsl`gridColor(uv)`} * opacities.y;
              float alpha = opacities.z * color.a;
              return mix(bg, color, alpha) * opacities.x;`:v.glsl`return color;`}
    }`);e?h.fragment.code.add(v.glsl`vec4 getTileColor() {
vec4 color = getColor(texture2D(tex, vtc), vtc, textureOpacities);
if (fadeFactor >= 1.0) {
return color;
}
vec4 nextColor = getColor(texture2D(texNext, nvtc), nvtc, nextTexOpacities);
return mix(nextColor, color, fadeFactor);
}`):h.fragment.code.add(v.glsl`vec4 getTileColor() {
return getColor(texture2D(tex, vtc), vtc, textureOpacities);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/TerrainTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../ViewingMode ../../../../chunks/Terrain.glsl ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/basicInterfaces ../lib/DefaultVertexAttributeLocations ../lib/Program ../lib/StencilUtils ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){v=function(t){function q(){var r=t.apply(this,arguments)||this;r.useStencil=!1;return r}c._inheritsLoose(q,t);var k=q.prototype;k.initializeConfiguration=function(r,y){y.spherical=r.viewingMode===n.ViewingMode.Global};k.initializeProgram=function(r){const y=q.shader.get().build(this.configuration);return new d.Program(r.rctx,y,h.Default3D)};k.initializePipeline=function(){this._stencilPipelineState=this._createPipeline(!0);return this._createPipeline(!1)};k._createPipeline=
function(r){const y=this.configuration,f=y.backfaceCullingEnabled&&!y.renderOccluded;return p.makePipelineState({blending:y.renderOccluded?p.simpleBlendingParams(g.BlendFactor.ONE,g.BlendFactor.ONE_MINUS_SRC_ALPHA):null,culling:f&&p.backFaceCullingParams,depthTest:!y.renderOccluded&&{func:g.CompareFunction.LESS},depthWrite:!y.renderOccluded&&p.defaultDepthWriteParams,colorWrite:p.defaultColorWriteParams,stencilTest:r?e.renderWhenBitIsNotSet(m.StencilBits.IntegratedMeshMaskExcluded):null})};k.getPipelineState=
function(r,y){return this.useStencil?this._stencilPipelineState:t.prototype.getPipelineState.call(this,r,y)};return q}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(l.Terrain,()=>new Promise((t,q)=>a(["../core/shaderLibrary/terrain/Terrain.glsl"],t,q)));b.TerrainTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/TerrainTechniqueConfiguration":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/has ../core/shaderLibrary/ShaderOutputOptions ../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../core/shaderLibrary/terrain/Overlay.glsl ../core/shaderLibrary/terrain/TileBlendInput ../core/shaderTechnique/ShaderTechniqueConfiguration ../materials/DefaultTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d){d=function(e){function g(){var p=e.apply(this,arguments)||this;p.output=l.ShaderOutput.Color;p.overlayMode=v.OverlayMode.Disabled;p.tileBlendInput=m.TileBlendInput.LayerOnly;p.spherical=!1;p.atmosphere=!1;p.receiveShadows=!1;p.hasSlicePlane=!1;p.backfaceCullingEnabled=!1;p.stencilEnabled=!1;p.textureFadingEnabled=!1;p.renderOccluded=!1;p.hasScreenSpaceReflections=!1;p.hasCloudsReflections=!1;p.tileBorders=!1;p.screenSizePerspective=!1;p.receiveAmbientOcclusion=!1;p.shading=
n("enable-feature:terrain-shading");return p}b._inheritsLoose(g,e);return g}(d.DefaultTechniqueConfiguration);c.__decorate([h.parameter({count:l.ShaderOutput.COUNT})],d.prototype,"output",void 0);c.__decorate([h.parameter({count:v.OverlayMode.COUNT})],d.prototype,"overlayMode",void 0);c.__decorate([h.parameter({count:m.TileBlendInput.COUNT})],d.prototype,"tileBlendInput",void 0);c.__decorate([h.parameter()],d.prototype,"spherical",void 0);c.__decorate([h.parameter()],d.prototype,"atmosphere",void 0);
c.__decorate([h.parameter()],d.prototype,"receiveShadows",void 0);c.__decorate([h.parameter()],d.prototype,"hasSlicePlane",void 0);c.__decorate([h.parameter()],d.prototype,"backfaceCullingEnabled",void 0);c.__decorate([h.parameter()],d.prototype,"stencilEnabled",void 0);c.__decorate([h.parameter()],d.prototype,"textureFadingEnabled",void 0);c.__decorate([h.parameter()],d.prototype,"renderOccluded",void 0);c.__decorate([h.parameter()],d.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([h.parameter()],
d.prototype,"hasCloudsReflections",void 0);c.__decorate([h.parameter()],d.prototype,"tileBorders",void 0);c.__decorate([h.parameter()],d.prototype,"screenSizePerspective",void 0);c.__decorate([h.parameter()],d.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([h.parameter()],d.prototype,"shading",void 0);c.__decorate([h.parameter({constValue:!0})],d.prototype,"isGround",void 0);c.__decorate([h.parameter({constValue:u.PBRMode.Disabled})],d.prototype,"pbrMode",void 0);c.__decorate([h.parameter({constValue:!1})],
d.prototype,"highStepCount",void 0);c.__decorate([h.parameter({constValue:!1})],d.prototype,"useCustomDTRExponentForWater",void 0);c.__decorate([h.parameter({constValue:!1})],d.prototype,"useFillLights",void 0);a.TerrainTechniqueConfiguration=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/TerrainSurfacePerformanceInfo":function(){define(function(){return function(){this.numMerged=this.numSplit=this.numRendered=this.numVisible=this.numLeaves=
this.numNodes=0;this.numRenderedPerLevel=[];this.numLoadedPerLevel=[]}})},"esri/views/3d/terrain/TilingSchemeLogic":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/reactiveUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../../../geometry/projection ../../../geometry/support/aaBoundingRect ../../../geometry/support/spatialReferenceUtils ../../../layers/support/layerUtils ../../ViewingMode ./terrainUtils ./TilingScheme".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){a.TilingSchemeLogic=function(w){function z(x){x=w.call(this,x)||this;x._handles=new l;return x}b._inheritsLoose(z,w);var A=z.prototype;A.initialize=function(){this._handles.add(this.layers.on("change",()=>this._update()));this._handles.add(v.watch(()=>this.extentHelper.layerViewsExtent,()=>this._setAdHocTilingScheme()));this._update();this.tilingSchemeLocked||this._setAdHocTilingScheme()};A.destroy=function(){this._handles=u.destroyMaybe(this._handles);
this._waitTask=null};A._update=function(){this._waitTask=null;if(!this.tilingSchemeLocked){var x;this.layers.some(C=>!k.isTiledLayer(C)||C.isRejected()?!1:!C.isFulfilled()||u.isSome(y.getTiledLayerInfo(C,this.viewSpatialReference,this.viewingMode))?(x=C,"vector-tile"!==(null==C?void 0:C.type)&&!y.isProjectableRasterLayer(C)):!1);if(x)if(x.isResolved()){var B=y.getTiledLayerInfo(x,this.viewSpatialReference,this.viewingMode);u.isSome(B)&&(B=new f.TilingScheme(B.tileInfo),this._lockTilingScheme(B))}else this._updateWhen(x)}};
A._updateWhen=function(x){const B=x.when().catch(()=>{}).then(()=>{B!==this._waitTask||this.destroyed||this._update()});this._waitTask=B};A._lockTilingScheme=function(x){if(this.viewingMode===r.ViewingMode.Global){const B=x.levels.length-1;x.spatialReference.isWebMercator?x=f.TilingScheme.makeWebMercatorAuxiliarySphere(B):p.canProjectToWGS84ComparableLonLat(x.spatialReference)&&(x=f.TilingScheme.makeGCSWithTileSize(x.spatialReference,x.pixelSize,B))}this.tilingSchemeLocked=!0;this.tilingScheme=x;
this.extentHelper.tilingScheme=this.tilingScheme;this._updateTiledLayerExtent();this._handles.removeAll();this._handles.add(v.watch(()=>this.extentHelper.tiledLayersExtent,()=>this._updateTiledLayerExtent()))};A._updateTiledLayerExtent=function(){this._set("extent",this.extentHelper.tiledLayersExtent)};A._setAdHocTilingScheme=function(){if(this.viewingMode===r.ViewingMode.Global){var x=this.extentHelper.viewSpatialReference;const B=p.canProjectToWGS84ComparableLonLat(x)||q.isMars(x)||q.isMoon(x);
x.isWebMercator?this.tilingScheme=f.TilingScheme.WebMercatorAuxiliarySphere:B&&(this.tilingScheme=f.TilingScheme.makeGCSWithTileSize(x,256));this._set("extent",this.extentHelper.layerViewsExtent)}else x=this.extentHelper.layerViewsExtent,u.isSome(x)&&!t.equals(x,this.extent)&&(this.tilingScheme=f.TilingScheme.fromExtent(x,this.extentHelper.viewSpatialReference),this._set("extent",x))};b._createClass(z,[{key:"test",get:function(){return{lockTilingScheme:x=>this._lockTilingScheme(x),done:!this._waitTask}}}]);
return z}(n);c.__decorate([m.property()],a.TilingSchemeLogic.prototype,"tilingScheme",void 0);c.__decorate([m.property({readOnly:!0})],a.TilingSchemeLogic.prototype,"extent",void 0);c.__decorate([m.property({value:!1})],a.TilingSchemeLogic.prototype,"tilingSchemeLocked",void 0);c.__decorate([m.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewSpatialReference",void 0);c.__decorate([m.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"layers",void 0);c.__decorate([m.property({constructOnly:!0})],
a.TilingSchemeLogic.prototype,"extentHelper",void 0);c.__decorate([m.property({constructOnly:!0})],a.TilingSchemeLogic.prototype,"viewingMode",void 0);a.TilingSchemeLogic=c.__decorate([g.subclass("esri.views.3d.terrain.TilingSchemeLogic")],a.TilingSchemeLogic);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/UpsampleInfo":function(){define(["exports","../../../chunks/vec2f64"],function(a,b){let c=function(){function n(){this.offset=
b.create();this.scale=0;this.tile=null}var l=n.prototype;l.init=function(u,v,m,h){this.tile=u;this.offset[0]=v;this.offset[1]=m;this.scale=h};l.dispose=function(){this.tile=null;this.offset[0]=0;this.scale=this.offset[1]=0};return n}();a.UpsampleInfo=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/Stage":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/Accessor ../../../core/Handles ../../../core/maybe ../../../core/PooledArray ../../../core/promiseUtils ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../state/helpers/SceneIntersectionHelper ./lib/AutoDisposable ./lib/basicInterfaces ./lib/ChangeSet ./lib/GeometryRecord ./lib/WebGLLayer ./parts/Model ./parts/RenderView ../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A){var x;a.Stage=x=function(B){function C(E){E=B.call(this,E)||this;E._handles=new l;E._model=new w.Model;E._layers=new v;E._changeSet=new r.ChangeSet;E._layerSyncSet=new Set;return E}b._inheritsLoose(C,B);var D=C.prototype;D.initialize=function(){this._set("renderView",new z.RenderView(this));this._frameTask=this.resourceController.scheduler.registerTask(A.TaskPriority.STAGE,this);this._handles.add(this._frameTask)};D.destroy=function(){y.GeometryRecord.pool.prune(0);
this._handles.destroy();this.dispose()};D.add=function(E){this._model.add(E);f.isWebGLLayer(E)&&(E.attachStage(this),this._addLayer(E));this.renderView.requestRender()};D.remove=function(E){u.isNone(E)||(this.renderView.requestRender(),this._model.remove(E),f.isWebGLLayer(E)&&(this._removeLayer(E),E.detachStage()))};D.addMany=function(E){u.isSome(E)&&(this._model.addMany(E),this.renderView.requestRender())};D.removeMany=function(E){u.isSome(E)&&(this._model.removeMany(E),this.renderView.requestRender())};
D.load=function(){var E=b._asyncToGenerator(function*(F){u.isNone(F)||(Array.isArray(F)||(F=[F]),yield Promise.all(F.filter(G=>u.isNone(G.glTexture)).map(G=>this.schedule(()=>this._model.has(G)?G.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique):null))))});return function(F){return E.apply(this,arguments)}}();D.loadImmediate=function(E){return E.load(this.renderView.renderingContext,()=>this.renderView.textureRepository.textureTechnique)};D.forEachOfType=
function(E,F){this._model.forEachOfType(E,F)};D.handleEvent=function(E,F){this.destroyed||(this._model.dirtySet[E](F),this.renderView.requestRender())};D.runTask=function(E){this._frameTask.processQueue(E);E.done||this._commit()};D._commit=function(){const E=this._model.dirtySet;x.DebugSettings.logDirtySet&&console.log("Dirty set: "+E.formatDebugInfo());E.commit(this._changeSet);x.DebugSettings.logDirtySet&&(console.log("RGs add: "+this._changeSet.adds.map(F=>F.id)),console.log("RGs remove: "+this._changeSet.removes.map(F=>
F.id)));this._layerSyncSet.clear();this.renderView.modify(this._changeSet);this.renderView.requestRender()};D.schedule=function(E,F){return this._frameTask.schedule(E,F)};D.syncLayer=function(E){this._layerSyncSet.add(E);this.renderView.requestRender()};D.processSyncLayers=function(){const E=this._model.dirtySet;this._layers.forAll(F=>{if(this._layerSyncSet.has(F.id)||F.updatePolicy===k.UpdatePolicy.SYNC)E.commitLayer(F.id,this._changeSet),this._layerSyncSet.delete(F.id)});for(const F of this._layerSyncSet)E.commitLayer(F,
this._changeSet);this._layerSyncSet.clear();this.renderView.modify(this._changeSet)};D.getObject=function(E){return this._model.getObject(E)};D._addLayer=function(E){this._layers.includes(E)||this._layers.push(E)};D._removeLayer=function(E){this._commit();null!=this._layers.removeUnordered(E)&&(this._model.dirtySet.getResidentRenderGeometries(E.id,this._changeSet.removes),this.renderView.modify(this._changeSet))};D.addRenderPlugin=function(E,F,G){E=this.renderView.renderPlugins.add(E,F,G);G=()=>{t.isIntersectionHandler(F)&&
this.sceneIntersectionHelper.addIntersectionHandler(F)};if(m.isPromiseLike(E))return E.then(G);G()};D.removeRenderPlugin=function(E){t.isIntersectionHandler(E)&&this.sceneIntersectionHelper.removeIntersectionHandler(E);this.renderView.renderPlugins.remove(E)};b._createClass(C,[{key:"viewingMode",get:function(){return this.state.viewingMode}},{key:"updating",get:function(){return this._model.dirtySet.dirty||this.renderView.updating||this._frameTask.updating}},{key:"running",get:function(){return this._model.dirtySet.dirty}},
{key:"layers",get:function(){return this._layers}},{key:"performanceInfo",get:function(){return{renderView:this.renderView.performanceInfo,model:this._model.getStats()}}},{key:"test",get:function(){const E=this;return{getCount(F){return E._model.test.content.filter(G=>G.type===F).length},model:E._model}}}]);return C}(q.AutoDisposableMixin(n));a.Stage.DebugSettings={endFrameContentValidation:!1,logDirtySet:!1};c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"resourceController",void 0);
c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"options",void 0);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"state",void 0);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"sceneIntersectionHelper",void 0);c.__decorate([h.property({readOnly:!0})],a.Stage.prototype,"viewingMode",null);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"container",void 0);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"renderSR",void 0);
c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"_handles",void 0);c.__decorate([h.property({readOnly:!0})],a.Stage.prototype,"updating",null);c.__decorate([h.property({constructOnly:!0})],a.Stage.prototype,"_model",void 0);c.__decorate([q.autoDispose(),h.property()],a.Stage.prototype,"renderView",void 0);a.Stage=x=c.__decorate([p.subclass("esri.views.3d.webgl-engine.Stage")],a.Stage);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/Model":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../lib/ContentObjectType ../lib/GridLocalOriginFactory ../lib/ModelDirtySet ../lib/RenderGeometry ../lib/Util ../lib/WebGLLayer".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){a.Model=function(r){function y(){var w=r.apply(this,arguments)||this;w.dirtySet=new p({model:b._assertThisInitialized(w)});w._content=new Map;w._originFactory=new g.GridLocalOriginFactory(null,75E4);return w}b._inheritsLoose(y,r);var f=y.prototype;f.getObject=function(w){return this._content.get(w)};f.add=function(w){const z=w.id;q.assert(!this._content.has(z),"Model/Stage already contains object to be added");this._content.set(z,w);k.isWebGLLayer(w)&&this.dirtySet.layerAdded(w)};
f.remove=function(w){q.assert(this._content.has(w.id),"Model/Stage doesn't contain object to be removed");this._content.delete(w.id);w.unload();k.isWebGLLayer(w)&&this.dirtySet.layerRemoved(w)};f.addMany=function(w){for(const z of w)l.isSome(z)&&(q.assert(!this._content.has(z.id),"Model/Stage already contains object to be added"),this._content.set(z.id,z))};f.removeMany=function(w){for(const z of w)q.assert(this._content.has(z.id),"Model/Stage doesn't contain object to be removed"),this._content.delete(z.id),
z.unload()};f.has=function(w){return this._content.has(w.id)};f.forEachOfType=function(w,z){this._content.forEach(A=>{A.type===w&&z(A)})};f.getRenderGeometry=function(w,z){const {geometry:A,material:x,id:B,shaderTransformation:C,origin:D,instanceParameters:E}=z,F=new t.RenderGeometry(A,x,{id:B,boundingInfo:A.boundingInfo,calculateShaderTransformation:C,castShadow:w.castShadow});F.updateTransformation(G=>w.getCombinedStaticTransformation(z,G));F.origin=D||this._originFactory.getOrigin(F.boundingSphere);
F.instanceParameters=E;return F};f.updateRenderGeometryTransformation=function(w,z,A){if(l.isNone(w))return!1;A.updateTransformation(B=>w.getCombinedStaticTransformation(z,B));const x=this._originFactory.getOrigin(A.boundingSphere);return A.origin!==x};f.getStats=function(){const w={},z=Array.from(this._content.values());for(let A=0;A<e.ContentObjectType.COUNT;++A)w[A]=z.filter(x=>x.type===A).length;return{contentTypes:w,dirtySet:this.dirtySet.formatDebugInfo()}};b._createClass(y,[{key:"test",get:function(){return{content:Array.from(this._content.values())}}}]);
return y}(n);c.__decorate([u.property({constructOnly:!0})],a.Model.prototype,"dirtySet",void 0);a.Model=c.__decorate([d.subclass("esri.views.3d.webgl-engine.parts.Model")],a.Model);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ModelDirtySet":function(){define("../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/MapUtils ../../../../core/maybe ../../../../core/uid ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./GeometryRecord ./ModelDirtyTypes ./Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){c=function(q){function k(y){y=q.call(this,y)||this;y._residentGeomRecords=new Map;y._dirtyGeomRecords=new Map;y.dirty=!1;return y}a._inheritsLoose(k,q);var r=k.prototype;r.commit=function(y){this.dirty=!1;this._dirtyGeomRecords.forEach((f,w)=>this.commitLayer(w,y))};r.commitLayer=function(y,f){const w=this._dirtyGeomRecords.get(y);w&&(w.forEach((z,A)=>{const x=this._ensureGeomRecord(y,A);z.forEach((B,C)=>{var D=B[0],E=B[1],F=B[2];B=!1;if(E&p.ModelDirty.Geometry.UPDATE){var G=
x.get(C);if(G){G=G[1];if(F&p.ModelDirty.State.TRANSFORMATION){const O=this.model.getObject(A);this.model.updateRenderGeometryTransformation(O,D,G)&&(B=!0)}B||f.updates.push({renderGeometry:G,updateType:F})}else t.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid update")}if(E&p.ModelDirty.Geometry.REMOVE||B)(F=x.get(C))?(f.removes.push(F[1]),x.delete(C),F[0].disposed&&g.GeometryRecord.pool.release(F[0])):E===p.ModelDirty.Geometry.REMOVE&&t.assert(!1,"ModelDirtySet.getAddRemoveListFilteredByLayers: invalid remove");
if(E&p.ModelDirty.Geometry.ADD||B)E=this.model.getObject(A),l.isSome(E)&&(E=this.model.getRenderGeometry(E,D),D=[D,E],f.adds.push(E),x.set(C,D))});0===x.size&&this._residentGeomRecords.get(y).delete(A)}),0===this._residentGeomRecords.get(y).size&&this._residentGeomRecords.delete(y),this._dirtyGeomRecords.delete(y))};r.getResidentRenderGeometries=function(y,f){(y=this._residentGeomRecords.get(y))&&y.forEach(w=>w.forEach(z=>f.push(z[1])))};r._objectStateChanged=function(y,f){for(const w of f.geometryRecords)this._updateOrCreateDirtyRecord(f,
w,null,p.ModelDirty.Geometry.UPDATE,0,0,p.ModelDirty.Geometry.UPDATE,p.ModelDirty.Geometry.ADD|p.ModelDirty.Geometry.REMOVE,y)};r.visibilityChanged=function(y){this._objectStateChanged(p.ModelDirty.State.VISIBILITIES,y)};r.highlightChanged=function(y){this._objectStateChanged(p.ModelDirty.State.HIGHLIGHTS,y)};r.occlusionChanged=function(y){this._objectStateChanged(p.ModelDirty.State.OCCLUDEES,y)};r.vertexAttrsUpdated=function(y){this._updateOrCreateDirtyRecord(y.object,y.record,null,p.ModelDirty.Geometry.UPDATE,
0,0,p.ModelDirty.Geometry.UPDATE,p.ModelDirty.Geometry.ADD|p.ModelDirty.Geometry.REMOVE,p.ModelDirty.State.VERTEXATTRS)};r.layerAdded=function(y){y.objects.forAll(f=>this._layerObjectAdded(y,f))};r.layerRemoved=function(y){y.objects.forAll(f=>this._layerObjectRemoved(y,f))};r.layerObjectAdded=function(y){this._layerObjectAdded(y.layer,y.object)};r._layerObjectAdded=function(y,f){y=y.id;for(const w of f.geometryRecords)this._objectGeometryAdded(f,w,y)};r.layerObjectRemoved=function(y){this._layerObjectRemoved(y.layer,
y.object)};r.layerObjectsAdded=function(y){for(const f of y.objects)this._layerObjectAdded(y.layer,f)};r.layerObjectsRemoved=function(y){for(const f of y.objects)this._layerObjectRemoved(y.layer,f)};r._layerObjectRemoved=function(y,f){y=y.id;for(const w of f.geometryRecords)this._objectGeometryRemoved(f,w,y)};r.shaderTransformationChanged=function(y){(y=this._residentGeomRecords.get(y.id))&&y.forEach((f,w)=>{(w=this.model.getObject(w))&&w.hasVolativeTransformation()&&f.forEach(z=>{z[1].shaderTransformationChanged()})})};
r.objectTransformation=function(y){const f=this._getParentLayerId(y);this._ensureGeomRecord(f,y.id).forEach(w=>{this._updateOrCreateDirtyRecord(y,w[0],f,p.ModelDirty.Geometry.UPDATE,0,0,p.ModelDirty.Geometry.UPDATE,p.ModelDirty.Geometry.ADD|p.ModelDirty.Geometry.REMOVE,p.ModelDirty.State.TRANSFORMATION)})};r.objectGeometryAdded=function(y){this._objectGeometryAdded(y.object,y.record)};r._objectGeometryAdded=function(y,f,w=null){this._updateOrCreateDirtyRecord(y,f,w,p.ModelDirty.Geometry.ADD,p.ModelDirty.Geometry.REMOVE,
0,0,0)};r.objectGeometryRemoved=function(y){this._objectGeometryRemoved(y.object,y.record)};r._objectGeometryRemoved=function(y,f,w=null){this._updateOrCreateDirtyRecord(y,f,w,p.ModelDirty.Geometry.REMOVE,p.ModelDirty.Geometry.ADD,p.ModelDirty.Geometry.UPDATE,0,0)};r._updateOrCreateDirtyRecord=function(y,f,w,z,A,x,B,C,D){w=l.unwrapOr(w,this._getParentLayerId(y));const E=f.id;y=this._ensureDirtyRecord(w,y.id);(w=y.get(E))?(f=w[1],f&A?(y.delete(E),w[0].disposed&&g.GeometryRecord.pool.release(w[0])):
f&x?(w[1]=z,w[2]=D):f&B?w[2]|=D:f&C||t.assert(!1,"ModelDirtySet.objectGeometryAdded: inconsistent state")):y.set(E,[f,z,D]);this.dirty=this._hasDirtyGeometryRecords};r._ensureGeomRecord=function(y,f){let w=this._residentGeomRecords.get(y);w||(w=new Map,this._residentGeomRecords.set(y,w));y=w.get(f);y||(y=new Map,w.set(f,y));return y};r._ensureDirtyRecord=function(y,f){let w=this._dirtyGeomRecords.get(y);w||(w=new Map,this._dirtyGeomRecords.set(y,w));y=w.get(f);y||(y=new Map,w.set(f,y));return y};
r._getParentLayerId=function(y){return l.isSome(y.parentLayer)?y.parentLayer.id:u.NullUID};r.formatDebugInfo=function(){const y=["ADD","UPD",void 0,"REM"];let f="";this._dirtyGeomRecords.forEach((w,z)=>{w.forEach((A,x)=>{0<f.length&&(f+="\n");f+=z+"."+x;const B=[];A.forEach(C=>{const D=C[1];B[D]||(B[D]=[]);B[D].push(C[0].geometry.id)});for(A=0;A<B.length;A++)if(B[A])for(f+=" "+y[A-1]+": ",x=0;x<B[A].length;x++)f+=B[A][x]+", "})});return f};a._createClass(k,[{key:"_hasDirtyGeometryRecords",get:function(){return n.someMap(this._dirtyGeomRecords,
y=>n.someMap(y,f=>f&&0<f.size))}},{key:"test",get:function(){const y=this;return{get residentLayerCount(){return y._residentGeomRecords.size},get residentObjectCount(){return Array.from(y._residentGeomRecords.values()).reduce((f,w)=>f+w.size,0)}}}}]);return k}(c);b.__decorate([v.property({constructOnly:!0})],c.prototype,"model",void 0);b.__decorate([v.property()],c.prototype,"dirty",void 0);return c=b.__decorate([e.subclass("esri.views.3d.webgl-engine.lib.ModelDirtySet")],c)})},"esri/views/3d/webgl-engine/parts/RenderView":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/has ../../../../core/Logger ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/scheduling ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../collections/Component/ComponentObjectCollection ../core/shaderTechnique/ShaderTechniqueRepository ../lib/AutoDisposable ../lib/basicInterfaces ../lib/CompositingHelper ../lib/depthRangeUtils ../lib/GLMaterialRepository ../lib/MagnifierHelper ../lib/Renderer ../lib/RenderingContext ../lib/TextureRepository ../materials/StippleTextureRepository ../materials/internal/WaterTextureRepository ./contextCache ./requireUtils ./ScreenshotManager ./testUtils ../../../webgl/context-util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R){const M=v.getLogger("esri.views.3d.webgl-engine.parts.View");a.RenderView=function(I){function P(V){var S=I.call(this,{})||this;S.events=new l;S.waterTextureRepository=new F.WaterTextureRepository;S._magnifierHelper=new x.MagnifierHelper;S._needsUpdate=!0;S._needsRender=!0;S._idleSuspend=!0;S._needsWaterReflectionUpdate=!1;S._lastAnimationUpdate=0;S._container=V.container;S._viewingMode=V.viewingMode;S._initializeContext(V);
h.watch(()=>{var T;return null==(T=S.waterTextureRepository)?void 0:T.updating},()=>S.requestRender(),h.initial);S._magnifierHelper.events.on("request-render",()=>S.requestRender());S._stippleTextureRepository=new E.StippleTextureRepository(S._rctx);S._shaderTechniqueRepository=new r.ShaderTechniqueRepository({rctx:S._rctx,viewingMode:V.viewingMode,stippleTextureRepository:S._stippleTextureRepository,waterTextureRepository:S.waterTextureRepository});S._textureRepository=new D.TextureRepository(V,
S._shaderTechniqueRepository,S._rctx);S._textureRepository.events.on("changed",T=>S.requestRender(T));S._materialRepository=new A.GLMaterialRepository(S._textureRepository,S._shaderTechniqueRepository,()=>S.requestRender(),()=>S.requestRender());S._compositingHelper=new w(S._rctx,S._shaderTechniqueRepository);S._renderer=new B.Renderer(S._materialRepository,S._textureRepository,S._shaderTechniqueRepository,S._rctx,S._compositingHelper,S._magnifierHelper,T=>S.requestRender(T),(T,H)=>V.schedule(T,H),
V);S._screenshotManager=new K.ScreenshotManager(S._rctx,(T,H,U)=>S._renderer.render(T,H,H,U),T=>S.requestRender(T),V.options.screenshot.renderOverlay,T=>S.events.emit("force-camera-for-screenshot",T),()=>S._renderer.disposeOffscreenBuffers());S._registerFrameTask(V);return S}b._inheritsLoose(P,I);var N=P.prototype;N.normalizeCtorArgs=function(){return{}};N.dispose=function(){this._container.contains(this._canvas)&&this._container.removeChild(this._canvas);this._frameTask=m.removeMaybe(this._frameTask);
this._shaderTechniqueRepository=m.disposeMaybe(this._shaderTechniqueRepository);I.prototype.dispose.call(this);this._rctx=this._tmpDepthBuffer=null};N.requestRender=function(V=f.RenderRequestType.UPDATE){V===f.RenderRequestType.UPDATE?this._needsUpdate=!0:this._needsRender=!0};N.ensureEdgeView=function(){return this._renderer.ensureEdgeView()};N.updateLightSources=function(V,S,T){this._renderer.updateLightSources(V,S,T);this.requestRender()};N.setRenderParameters=function(V){void 0!==V.idleSuspend&&
this._idleSuspend!==!!V.idleSuspend&&(this._idleSuspend=!!V.idleSuspend,this.requestRender());this._renderer.setRenderParameters(V)};N.modify=function(V){this._renderer.modify(V);V.clear()};N.takeScreenshot=function(V){return this._screenshotManager.takeScreenshot(V)};N.getAlpha=function(){return this._rctx.contextAttributes.alpha};N.readAccumulatedShadow=function(V){return this._renderer.readAccumulatedShadow(V[0],V[1])};N.readHUDVisibility=function(V,S,T,H,U){this._renderer.readHUDVisibility(V,
S,T,H,U)};N.getMinimalDepthForArea=function(V,S,T,H,U,W=U){W=H.constrainWindowSize(S,T,U*H.pixelRatio,W*H.pixelRatio);const Q=this._ensureDepthBuffer(W);this._renderer.readDepthPixels(H,W,Q);U=Number.MAX_VALUE;for(let X=0;X<W[2]*W[3];X++){const ba=z.textureToDepth(4*X,Q,H.nearFar);U>ba&&ba!==H.nearFar[0]&&ba!==H.nearFar[1]&&(U=ba)}m.isSome(V)&&(V=V.pickDepth(S*H.pixelRatio,T*H.pixelRatio,H),m.isSome(V)&&U>V&&V!==H.nearFar[0]&&V!==H.nearFar[1]&&(U=V));return U===Number.MAX_VALUE?void 0:U};N._ensureDepthBuffer=
function(V){V=4*V[2]*V[3];if(m.isNone(this._tmpDepthBuffer)||this._tmpDepthBuffer.byteLength<V)this._tmpDepthBuffer=new Uint8Array(V);return this._tmpDepthBuffer};N.reloadShaders=function(){var V=b._asyncToGenerator(function*(){O.removeLoadedShaderModules();yield this._shaderTechniqueRepository.reloadAll();this.requestRender()});return function(){return V.apply(this,arguments)}}();N._registerFrameTask=function(V){const S=V.state,T={viewCamera:S.camera,frameHasDecorations:!1};let H=!1,U=f.RenderRequestType.BACKGROUND,
W=!1;this._frameTask=d.addFrameTask({preRender:Q=>{H=this.updating;U=this._needsUpdate?f.RenderRequestType.UPDATE:f.RenderRequestType.BACKGROUND;V.processSyncLayers();const X=e.Milliseconds(Q.time-this._lastAnimationUpdate);if(X>this.animationTimestep||m.isSome(this.forcedAnimationTime)||H||this._needsRender)this._renderer.updateAnimation({camera:S.camera,dt:X,forcedTime:this.forcedAnimationTime})&&this.requestRender(f.RenderRequestType.BACKGROUND),this._lastAnimationUpdate=Q.time},render:()=>{if((this._needsUpdate||
this._needsRender||!this._idleSuspend||!this._renderer.isCameraFinal||this._needsWaterReflectionUpdate)&&0<S.camera.fullWidth&&0<S.camera.fullHeight){const Q=this._needsUpdate&&this._idleSuspend&&this._renderer.isCameraFinal;this._needsWaterReflectionUpdate=this._needsUpdate=this._needsRender=!1;this._renderer.render(null,S.camera,S.contentCamera,f.Decorations.ON);W=!0;Q&&this._renderer.hasWaterReflection&&(this.requestRender(f.RenderRequestType.BACKGROUND),this._needsWaterReflectionUpdate=!0)}},
update:()=>{T.viewCamera=S.camera;T.frameHasDecorations=this._renderer.hasSlicePlane||this._magnifierHelper.enabled;this._textureRepository.update();this._screenshotManager.update(T)},finish:()=>{W&&(this._renderer.finish(U),W=!1)}})};N._initializeContext=function(V){var S;const T=V.options;this._canvas=T.canvas;this._canvas||(this._canvas=document.createElement("canvas"));this._canvas.setAttribute("style","width: 100%; height:100%; display:block;");const H={alpha:T.alpha||!1,premultipliedAlpha:!0,
antialias:!1,depth:!0,stencil:null==T.stencil?!0:T.stencil,powerPreference:"high-performance",preserveDrawingBuffer:null!=(S=T.preserveDrawingBuffer)?S:!1};S=R.createContextOrErrorHTML("3d",this._canvas,H);m.isNone(S)?(V=u("esri-force-webgl"),M.error("A WebGL context with the requested version ("+V?V:"automatic) could not be created.")):(this._rctx=this._newRenderingContext(S,V),this._loadShaderOnlyExtensions(),!T.alpha&&this._rctx.contextAttributes.alpha&&M.error("WebGL context has alpha channel even though no alpha channel was requested"),
!this._rctx.contextAttributes.alpha&&11<=u("safari")&&(this._container.style.backgroundColor="black"),this._container.appendChild(this._canvas))};N._newRenderingContext=function(V,S){const T={disabledExtensions:S.options.deactivatedWebGLExtensions||{},debugWebGLExtensions:S.options.debugWebGLExtensions||{},maxAnisotropy:8},H=(U,W)=>S.resourceController.memoryController.newCache(U,W);if(L.contextCache.enabled){let U=J.get(V);if(U)return U.configure(T),U.newCache=H,U.ref(),U;U=new C.RenderingContext(V,
T,H);J.set(V,U);U.ref();return U}return new C.RenderingContext(V,T,H)};N._loadShaderOnlyExtensions=function(){this._rctx.capabilities.enable("standardDerivatives");this._rctx.capabilities.enable("shaderTextureLOD");this._rctx.capabilities.enable("textureFloat")};b._createClass(P,[{key:"performanceInfo",get:function(){const V=this._rctx.gl;return{renderer:this._renderer.performanceInfo,textureMemory:void 0!==V.getUsedTextureMemory?V.getUsedTextureMemory():void 0,renderbufferMemory:void 0!==V.getUsedRenderbufferMemory?
V.getUsedRenderbufferMemory():void 0,VBOMemory:void 0!==V.getUsedVBOMemory?V.getUsedVBOMemory():void 0}}},{key:"updating",get:function(){return this._needsUpdate||this._needsWaterReflectionUpdate||this._renderer.updating||this._textureRepository.updating||this.waterTextureRepository.updating||this._magnifierHelper.updating}},{key:"edgeView",get:function(){return this._renderer.edgeView}},{key:"textureRepository",get:function(){return this._textureRepository}},{key:"compositingHelper",get:function(){return this._compositingHelper}},
{key:"magnifier",set:function(V){this._magnifierHelper.magnifier=V}},{key:"renderingContext",get:function(){return this._rctx}},{key:"capabilities",get:function(){return this._rctx.capabilities}},{key:"canvas",get:function(){return this._canvas}},{key:"shadowsEnabled",get:function(){return this._renderer.shadowsEnabled}},{key:"renderPlugins",get:function(){return this._renderer.renderPlugins}},{key:"test",get:function(){return{renderer:this._renderer}}},{key:"gpuMemoryUsage",get:function(){return this._renderer.gpuMemoryUsage}},
{key:"animationTimestep",get:function(){return this._renderer.animationTimestep}},{key:"componentObjectCollection",get:function(){m.isNone(this._componentObjectCollection)&&(this._componentObjectCollection=new k.ComponentObjectCollection(this._renderer.renderPassManager,this._viewingMode));return this._componentObjectCollection},set:function(V){this._componentObjectCollection=V}}]);return P}(y.AutoDisposableMixin(n));c.__decorate([g.property({type:Boolean,readOnly:!0})],a.RenderView.prototype,"updating",
null);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_rctx",void 0);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_container",void 0);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_canvas",void 0);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_stippleTextureRepository",void 0);c.__decorate([y.autoDispose(),g.property()],a.RenderView.prototype,"waterTextureRepository",void 0);c.__decorate([y.autoDispose(),g.property()],a.RenderView.prototype,"_magnifierHelper",void 0);
c.__decorate([y.autoDispose(),g.property()],a.RenderView.prototype,"_textureRepository",void 0);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_compositingHelper",void 0);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_renderer",void 0);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_screenshotManager",void 0);c.__decorate([y.autoDispose()],a.RenderView.prototype,"componentObjectCollection",null);c.__decorate([y.autoDispose()],a.RenderView.prototype,"_componentObjectCollection",
void 0);c.__decorate([g.property()],a.RenderView.prototype,"_needsUpdate",void 0);c.__decorate([g.property()],a.RenderView.prototype,"_needsWaterReflectionUpdate",void 0);a.RenderView=c.__decorate([q.subclass("esri.views.3d.webgl-engine.parts.RenderView")],a.RenderView);const J=G.getContextCache();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObjectCollection":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/Logger ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../chunks/vec4f32 ../../../../../chunks/vec32 ../../../../../chunks/vec33 ../../../../ViewingMode ../../../layers/i3s/I3SUtil ../../../layers/support/symbolColorUtils ../../../support/orientedBoundingBox ../../../support/buffer/glUtil ../../../support/buffer/InterleavedLayout ./ComponentData ./ComponentObject ./IntersectionGeometry ./Renderable ./RenderGeometry ./RenderSubmitSystem ./SourceGeometry ./Material/ComponentMaterial ./Material/shader/ComponentData.glsl ../../lib/ComponentUtils ../../lib/Util ../../lib/VertexAttribute ../../lib/verticalOffsetUtils ../../lib/edgeRendering/bufferLayouts ../../lib/edgeRendering/EdgeProcessingWorker ../../lib/TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P){function N(W,Q){return W===Q?D.ComponentParameterSummary.All:0===W?D.ComponentParameterSummary.None:D.ComponentParameterSummary.Some}const V=c.getLogger("esri.views.3d.webgl-engine.collections.Component.ComponentObjectCollection");c=function(){function W(X,ba){this._renderManager=X;this._viewingMode=ba;this._objects=[new l,new l];this._renderSubmit=new B.RenderSubmitSystem(this);this._renderManager.register(this._renderSubmit);
this._componentBufferManager=new M.BufferManager(X.rctx,2)}var Q=W.prototype;Q.dispose=function(){G.assert(0===this._objects[w.State.Hidden].length&&0===this._objects[w.State.Visible].length,"ObjectCollection should be empty upon disposal");this._componentBufferManager.destroy()};Q.createObject=function(X){const ba=new w.ComponentObject;ba.toMapSpace=X.toMapSpace;ba.transform=X.transform;ba.obb=k.clone(X.obb);ba.components=new f(this._componentBufferManager,X.geometry.componentOffsets);ba.renderable=
this._createRenderable(X,ba.components);ba.intersectionGeometry=new z(X.geometry.positionData,ba.components);this._objects[ba.visible].push(ba);return ba};Q.destroyObject=function(X){this._objects[X.visible].removeUnordered(X);X.dispose();this._notifyDirty()};Q.setObjectVisibility=function(X,ba){ba!==X.visible&&(this._objects[X.visible].removeUnordered(X),this._objects[ba].push(X),X.visible=ba,this._notifyDirty())};Q.preSubmit=function(X){const ba=X.camera.eye;this.visibleObjects.forAll(aa=>aa.renderable.meta.cameraDepthSquared=
m.squaredDistance(ba,aa.obb.center))};Q.getMaterial=function(X){return X.renderable.material};Q.updateMaterial=function(X,ba){X=X.renderable.material;ba(X);X.dirty&&this._notifyDirty()};Q.setAllComponentVisibilities=function(X,ba){X.components.visibility.reset(ba);X.components.visibilityDirty();this._notifyDirty()};Q.forEachVisibleComponent=function(X,ba){return X.components.visibility.forEachComponent(ba)};Q.getComponentCount=function(X){const ba=X.components.visibility.componentCount();return{visible:ba,
invisible:X.components.count-ba}};Q.setComponentData=function(X,ba){const aa=X.renderable.material,ea=X.components;var ia=ea.materialDataBuffer;const ka=ea.materialDataIndices,la={castShadows:!0,pickable:!0,externalColor:d.create(),externalColorMixMode:q.ColorMixModeEnum.Multiply,elevationOffset:0};ia=ia.textureBuffer;const Z=new Uint8Array(4),ca=new Uint32Array(Z.buffer);let Y=0,da=0,ha=0,ja=ea.verticalOffsets,ma=Infinity,pa=-Infinity,na=!1,wa=!1,xa=0;for(let sa=0;sa<ea.count;sa++)ba(sa,la),Y+=+(1>
la.externalColor[3]),da+=+(la.externalColorMixMode===q.ColorMixModeEnum.Replace&&1===la.externalColor[3]),ha+=+la.castShadows,q.encodeSymbolColor(la.externalColor,la.externalColorMixMode,Z),Z[2]=Z[2]&254|+la.castShadows,ia.setData(ka[sa],0,Z[0],Z[1],Z[2],Z[3]),na||(na=0<sa&&xa!==ca[0]),xa=ca[0],wa||(wa=0!==la.elevationOffset),wa&&n.isNone(ja)&&(ja=Array(sa).fill(0)),n.isSome(ja)&&(ja[sa]=la.elevationOffset),ma=Math.min(ma,la.elevationOffset),pa=Math.max(pa,la.elevationOffset),E.encodeElevationOffset(la.elevationOffset,
Z),ia.setData(ka[sa],1,Z[0],Z[1],Z[2],Z[3]),la.pickable!==F.getVisibility(ea.pickability,sa)&&(ea.pickability=F.updateVisibilityWithCount(ea.pickability,ea.count,sa,la.pickable));ea.verticalOffsets=wa?ja:null;X.offsetObb=wa?t.computeOffsetObb(X.obb,ma,pa,this._viewingMode,n.isSome(X.offsetObb)?X.offsetObb:k.clone(X.obb)):null;na||wa?(aa.componentParameters=new D.ComponentParametersVarying,aa.componentParameters.castShadows=N(ha,ea.count),aa.componentParameters.transparent=N(Y,ea.count),aa.componentParameters.opaqueOverride=
N(da,ea.count),aa.componentParameters.texture=ia,ia.updateTexture()):(aa.componentParameters=new D.ComponentParametersUniform,aa.componentParameters.castShadows=la.castShadows?D.ComponentParameterSummary.All:D.ComponentParameterSummary.None,aa.componentParameters.externalColor=la.externalColor,aa.componentParameters.externalColorMixMode=la.externalColorMixMode);this._notifyDirty()};Q.getComponentAabb=function(X,ba,aa,ea=!1){X.intersectionGeometry.getComponentAabb(ba,aa);const ia=X.components.verticalOffsets;
if(ea||n.isNone(ia))return aa;ba=ia[ba];if(this._viewingMode===p.ViewingMode.Local||0===ba)return aa[2]+=ba,aa[5]+=ba,aa;ba=n.unwrap(K.getVerticalOffsetI3S(ba));ba.localOrigin=X.transform.position;return ba.applyToAabb(aa)};Q.getComponentObb=function(X){return X.obb};Q.getObjectTransform=function(X){return X.transform};Q.getComponentPositions=function(X,ba,aa){return X.intersectionGeometry.getComponentPositions(ba,aa)};Q.intersect=function(X,ba,aa,ea,ia,ka){n.isSome(ia)&&(ia.localOrigin=X.transform.position);
const la=u.invert(T,X.transform.rotationScale);m.sub(H,ba,X.transform.position);m.sub(U,aa,X.transform.position);m.transformMat3(H,H,la);m.transformMat3(U,U,la);ba=u.transpose(T,la);return X.intersectionGeometry.intersect(H,U,ea,ba,ia,X.components.verticalOffsets,ka)};Q.addEdges=function(X,ba,aa,ea){const {indices:ia,positions:ka}=X.intersectionGeometry,la=X.components.offsets;return ba.addComponentObject(X,X.transform,{center:X.obb.center,radius:k.radius(X.obb)},ka,ia,la,aa,ea)};Q.extractEdgeInformation=
function(){var X=b._asyncToGenerator(function*(ba,aa,ea){var ia=ba.components.visibility;if(ia.allInvisible())return{buffer:R.extractComponentsEdgeLocationsLayout.createBuffer(0),origin:[0,0,0]};const {indices:ka,positions:la}=ba.intersectionGeometry,Z=ba.components.offsets,ca=L.EdgeInputBufferLayout.createBuffer(la.count);g.copy(ca.position,la);e.transformMat3(ca.position,ca.position,ba.transform.rotationScale);this._setComponentIndices(ca.componentIndex,ka,Z);ia=this._computeVisibilityIndices(ka,
ia,Z,ca.count);ba=h.clone(ba.transform.position);aa=yield aa.extractComponentsEdgeLocations({indices:ia,indicesLength:ia.length,skipDeduplicate:!0,data:ca,writerSettings:{reducedPrecision:!1,variants:0}},ea);return{origin:ba,buffer:aa}});return function(ba,aa,ea){return X.apply(this,arguments)}}();Q._setComponentIndices=function(X,ba,aa){let ea=0;for(let ka=0;ka<aa.length-1;ka++){var ia=aa[ka];const la=aa[ka+1];for(;ia<la;ia++)X.set(ba?ba[ia]:ia,ea);ea++}};Q._computeVisibilityIndices=function(X,ba,
aa,ea){if(X&&ba.allVisible())return X;let ia=0;ba.forEachComponentRange((Z,ca)=>{ia+=aa[ca]-aa[Z];return!0});const ka=2===(null==X?void 0:X.BYTES_PER_ELEMENT)||65536>=ea?new Uint16Array(ia):new Uint32Array(ia);let la=0;ba.forEachComponentRange((Z,ca)=>{Z=aa[Z];for(ca=aa[ca];Z<ca;Z++)ka[la++]=X?X[Z]:Z;return!0});return ka};Q.addComponentHighlight=function(X,ba){X=X.components;n.isNone(X.highlightCounts)&&(X.highlightCounts=new Uint32Array(X.count+1));0===X.highlightCounts[ba]++&&(X.highlightsDirty(),
this._notifyDirty());X.highlightCounts[X.count]++};Q.removeComponentHighlight=function(X,ba){X=X.components;if(n.isNone(X.highlightCounts))V.warn("Removing non-existing highlight.");else{var aa=X.highlightCounts[ba],ea=X.highlightCounts[X.count];0===aa?V.warn("Removing non-existing highlight."):1<aa?(X.highlightCounts[ba]=aa-1,X.highlightCounts[X.count]=ea-1):(X.highlightCounts[ba]=0,X.highlightsDirty(),this._notifyDirty(),1===ea?X.highlightCounts=null:X.highlightCounts[X.count]=ea-1)}};Q.clearHighlights=
function(X){X=X.components;n.isSome(X.highlightCounts)&&(X.highlightCounts=null,X.highlightsDirty(),this._notifyDirty())};Q.getObjectGPUMemoryUsage=function(X){return X.renderable.meta.gpuMemoryEstimate};Q._createRenderable=function(X,ba){const aa=this._renderManager.rctx,ea=X.geometry;var ia=ea.vertices.layoutParameters,ka=J.BufferObject.createVertex(aa,I.Usage.STATIC_DRAW,ea.vertices.data);const la=n.applySome(ea.indices,da=>J.BufferObject.createIndex(aa,I.Usage.STATIC_DRAW,da));var Z=r.glLayout(C.createVertexBufferLayout(ia));
const ca=new Uint16Array(ea.vertices.count);for(let da=0;da<ba.count;da++){var Y=ba.offsets[da];const ha=ba.offsets[da+1],ja=ba.materialDataIndices[da];if(n.isSome(ea.indices))for(;Y<ha;Y++)ca[ea.indices[Y]]=ja;else for(;Y<ha;Y++)ca[Y]=ja}ba=J.BufferObject.createVertex(aa,I.Usage.STATIC_DRAW,ca.buffer);X=new D.ComponentMaterial(X.transform,X.toMapSpace);Z=new P.VertexArrayObject(aa,X.attributeLocations,{data:Z,componentIndices:S},{data:ka,componentIndices:ba},n.unwrap(la));ia=new x.RenderGeometry(Z,
I.PrimitiveType.TRIANGLES,ia,n.isSome(la));ka={cameraDepthSquared:.5,gpuMemoryEstimate:ka.byteSize+ba.byteSize+(n.isSome(la)?la.byteSize:0)};return new A.Renderable(X,ia,ka)};Q._notifyDirty=function(){this._renderManager.notifyDirty()};b._createClass(W,[{key:"visibleObjects",get:function(){return this._objects[w.State.Visible]}}]);return W}();const S=r.glLayout(y.newLayout().u16(O.VertexAttribute.COMPONENTINDEX)),T=v.create(),H=h.create(),U=h.create();a.ComponentObjectCollection=c;Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/I3SUtil":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../request ../../../../core/arrayUtils ../../../../core/Error ../../../../core/has ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/typedArrayUtil ../../../../chunks/mat3 ../../../../chunks/mat3f64 ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/quat ../../../../chunks/quatf32 ../../../../chunks/quatf64 ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../../chunks/vec4f64 ../../../../geometry/projection ../../../../geometry/projectionEllipsoid ../../../../geometry/SpatialReference ../../../../geometry/support/aaBoundingRect ../../../../geometry/support/spatialReferenceUtils ../../../../rest/support/Query ../../../ViewingMode ./I3SBinaryReader ./I3SProjectionUtil ../support/edgeUtils ../support/symbolColorUtils ../../support/orientedBoundingBox".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K){function L(va){return va&&parseInt(va.substring(va.lastIndexOf("/")+1,va.length),10)}function R(va,Ca){var Ka=Ca[0],Oa=Ca[1];Ca=Ca[3];const Ra=va[0]-Ka;Ka-=va[2];const Pa=va[1]-Oa;va=Oa-va[3];Oa=Math.max(Ra,Ka,0);const qa=Math.max(Pa,va,0);Oa=Oa*Oa+qa*qa;return Oa>Ca*Ca?a.MbsIntersectResult.OUTSIDE:0<Oa?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Ra,Ka,Pa,va)>Ca?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE}
function M(va,Ca,Ka){const Oa=[],Ra=Ka&&Ka.missingFields;Ka=Ka&&Ka.originalFields;for(const Pa of va){va=Pa.toLowerCase();let qa=!1;for(const za of Ca)if(va===za.name.toLowerCase()){Oa.push(za.name);qa=!0;Ka&&Ka.push(Pa);break}!qa&&Ra&&Ra.push(Pa)}return Oa}function J(){J=b._asyncToGenerator(function*(va,Ca,Ka,Oa,Ra){if(0===Ca.length)return[];const Pa=va.attributeStorageInfo;if(v.isSome(va.associatedLayer))try{return yield P(va.associatedLayer,Ca,Ka,Oa)}catch(qa){if(va.associatedLayer.loaded)throw qa;
}if(Pa){Ca=I(Ca,Ka,Ra);if(v.isNone(Ca))throw new l("scenelayer:features-not-loaded","Tried to query attributes for unloaded features");const qa=va.parsedUrl.path;va=yield Promise.all(Ca.map(za=>S(qa,Pa,za.node,za.indices,Oa).then(Da=>{for(let La=0;La<za.graphics.length;La++){const Na=za.graphics[La],Ua=Da[La];if(Na.attributes)for(const Ta in Na.attributes)Ta in Ua||(Ua[Ta]=Na.attributes[Ta]);Na.attributes=Ua}return za.graphics})));return n.flatten(va)}throw new l("scenelayer:no-attribute-source",
"This scene layer does not have a source for attributes available");});return J.apply(this,arguments)}function I(va,Ca,Ka){const Oa=new Map,Ra=[];Ka=Ka();for(const za of va){var Pa=za.attributes[Ca];for(var qa=0;qa<Ka.length;qa++){va=Ka[qa];const Da=va.featureIds.indexOf(Pa);if(0<=Da){Pa=Oa.get(va.node);Pa||(Pa={node:va.node,indices:[],graphics:[]},Ra.push(Pa),Oa.set(va.node,Pa));Pa.indices.push(Da);for(Pa.graphics.push(za);0<qa;qa--)Ka[qa]=Ka[qa-1];Ka[0]=va;break}}}return Ra}function P(va,Ca,Ka,
Oa){return N.apply(this,arguments)}function N(){N=b._asyncToGenerator(function*(va,Ca,Ka,Oa){Ca.sort((qa,za)=>qa.attributes[Ka]-za.attributes[Ka]);var Ra=Ca.map(qa=>qa.attributes[Ka]);const Pa=[];Oa=M(Oa,va.fields,{originalFields:Pa});va=yield V(va,Ra,Oa);for(Ra=0;Ra<Ca.length;Ra++){const qa=Ca[Ra],za=va[Ra],Da={};if(qa.attributes)for(const La in qa.attributes)Da[La]=qa.attributes[La];for(let La=0;La<Pa.length;La++)Da[Pa[La]]=za[Oa[La]];qa.attributes=Da}return Ca});return N.apply(this,arguments)}
function V(va,Ca,Ka){var Oa=va.capabilities.query.maxRecordCount;if(null!=Oa&&Ca.length>Oa)return Oa=n.splitIntoChunks(Ca,Oa),Promise.all(Oa.map(Ra=>V(va,Ra,Ka))).then(n.flatten);Oa=new C({objectIds:Ca,outFields:Ka,orderByFields:[va.objectIdField]});return va.queryFeatures(Oa).then(Ra=>{if(Ra&&Ra.features&&Ra.features.length===Ca.length)return Ra.features.map(Pa=>Pa.attributes);throw new l("scenelayer:feature-not-in-associated-layer","Feature not found in associated feature layer");})}function S(va,
Ca,Ka,Oa,Ra){const Pa=[];for(const qa of Ca)qa&&Ra.includes(qa.name)&&Pa.push({url:`${va}/nodes/${Ka.resources.attributes}/attributes/${qa.key}/0`,storageInfo:qa});return m.eachAlways(Pa.map(qa=>c(qa.url,{responseType:"array-buffer"}).then(za=>E.readBinaryAttribute(qa.storageInfo,za.data)))).then(qa=>{const za=[];for(const Da of Oa){const La={};for(let Na=0;Na<qa.length;Na++)null!=qa[Na].value&&(La[Pa[Na].storageInfo.name]=T(qa[Na].value,Da));za.push(La)}return za})}function T(va,Ca){if(!va)return null;
Ca=va[Ca];return h.isInt16Array(va)?-32768===Ca?null:Ca:h.isInt32Array(va)?Ca===ka?null:Ca:Ca!==Ca?null:Ca}function H(va){var Ca=va.store.indexCRS||va.store.geographicCRS;const Ka=void 0===Ca?va.store.indexWKT:void 0;if(Ka)if(va.spatialReference){if(Ka!==va.spatialReference.wkt)throw new l("layerview:store-spatial-reference-wkt-index-incompatible","The indeWKT of the scene layer store does not match the WKT of the layer spatial reference",{});}else throw new l("layerview:no-store-spatial-reference-wkt-index-and-no-layer-spatial-reference",
"Found indeWKT in the scene layer store but no layer spatial reference",{});Ca=Ca?new A(L(Ca)):va.spatialReference;return Ca.equals(va.spatialReference)?va.spatialReference:Ca}function U(va){var Ca=va.store.vertexCRS||va.store.projectedCRS;const Ka=void 0===Ca?va.store.vertexWKT:void 0;if(Ka)if(va.spatialReference){if(Ka!==va.spatialReference.wkt)throw new l("layerview:store-spatial-reference-wkt-vertex-incompatible","The vertexWKT of the scene layer store does not match the WKT of the layer spatial reference",
{});}else throw new l("layerview:no-store-spatial-reference-wkt-vertex-and-no-layer-spatial-reference","Found vertexWKT in the scene layer store but no layer spatial reference",{});Ca=Ca?new A(L(Ca)):va.spatialReference;return Ca.equals(va.spatialReference)?va.spatialReference:Ca}function W(va,Ca,Ka){if(!w.canProjectWithoutEngine(va,Ca))throw new l("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});if("local"===
Ka&&!Q(va,Ca))throw new l("layerview:spatial-reference-incompatible","The spatial reference of this scene layer is incompatible with the spatial reference of the view",{});}function Q(va,Ca){return va.equals(Ca)||va.isWGS84&&Ca.isWebMercator||va.isWebMercator&&Ca.isWGS84}function X(va,Ca,Ka){const Oa=H(va);va=U(va);W(Oa,Ca,Ka);W(va,Ca,Ka)}function ba(va,Ca,Ka,Oa,Ra=0){if(Oa===z.getSphericalPCPF(Oa))if(Ca.isGeographic){var Pa=z.getReferenceEllipsoid(Ca);Oa=1+Math.max(0,Ra)/(Pa.radius+va.center[2]);
r.set(Ka.center,va.center[0],va.center[1],va.center[2]+Ra);w.projectBuffer(Ka.center,Ca,0,Ka.center,z.getSphericalPCPF(Ca),0,1);t.copy(Ka.quaternion,va.quaternion);t.conjugate(xa,va.quaternion);r.set(Ba,0,0,1);r.transformQuat(Ba,Ba,xa);r.set(Ba,va.halfSize[0]*Math.abs(Ba[0]),va.halfSize[1]*Math.abs(Ba[1]),va.halfSize[2]*Math.abs(Ba[2]));r.scale(Ba,Ba,Pa.inverseFlattening);r.add(Ka.halfSize,va.halfSize,Ba);r.scale(Ka.halfSize,Ka.halfSize,Oa)}else{{K.corners(va,sa);r.set(Ka.center,va.center[0],va.center[1],
va.center[2]+Ra);w.computeTranslationToOriginAndRotation(Ca,Ka.center,wa,z.getSphericalPCPF(Ca));r.set(Ka.center,wa[12],wa[13],wa[14]);Oa=2*Math.sqrt(1+wa[0]+wa[5]+wa[10]);xa[0]=(wa[6]-wa[9])/Oa;xa[1]=(wa[8]-wa[2])/Oa;xa[2]=(wa[1]-wa[4])/Oa;xa[3]=.25*Oa;t.multiply(Ka.quaternion,xa,va.quaternion);t.conjugate(xa,Ka.quaternion);let qa=Oa=va=0;for(Pa of sa)Pa[2]+=Ra,w.projectBuffer(Pa,Ca,0,Pa,z.getSphericalPCPF(Ca),0,1),r.sub(Ba,Pa,Ka.center),r.transformQuat(Ba,Ba,xa),va=Math.max(va,Math.abs(Ba[0])),
Oa=Math.max(Oa,Math.abs(Ba[1])),qa=Math.max(qa,Math.abs(Ba[2]));r.set(Ka.halfSize,va,Oa,qa)}}else Ca.isWGS84&&(Oa.isWebMercator||B.isPlateCarree(Oa))?(r.copy(pa,va.center),pa[2]+=Ra,Ra=z.getSphericalPCPF(Oa),w.projectBuffer(pa,Ca,0,pa,Ra,0,1),aa(Ra,va,pa,Oa,Ka)):Ca.isWebMercator&&B.isPlateCarree(Oa)?(r.copy(pa,va.center),pa[2]+=Ra,aa(Ca,va,pa,Oa,Ka)):va===Ka?(Ka.center[2]+=Ra,w.projectBuffer(Ka.center,Ca,0,Ka.center,Oa,0,1)):(r.set(Ka.center,va.center[0],va.center[1],va.center[2]+Ra),w.projectBuffer(Ka.center,
Ca,0,Ka.center,Oa,0,1),t.copy(Ka.quaternion,va.quaternion),r.copy(Ka.halfSize,va.halfSize))}function aa(va,Ca,Ka,Oa,Ra){const Pa=d.fromQuat(na,Ca.quaternion);for(let za=0;8>za;++za){for(var qa=0;3>qa;++qa)ma[qa]=Ca.halfSize[qa]*(0!==(za&1<<qa)?-1:1);for(qa=0;3>qa;++qa){let Da=Ka[qa];for(let La=0;3>La;++La)Da+=ma[La]*Pa[3*La+qa];ha[3*za+qa]=Da}}w.projectBuffer(ha,va,0,ha,Oa,0,8);K.compute(ja,Ra)}const ea=x.create(),ia=f.create();a.MbsIntersectResult=void 0;(function(va){va[va.OUTSIDE=0]="OUTSIDE";
va[va.INTERSECTS_CENTER_OUTSIDE=1]="INTERSECTS_CENTER_OUTSIDE";va[va.INTERSECTS_CENTER_INSIDE=2]="INTERSECTS_CENTER_INSIDE";va[va.INSIDE=3]="INSIDE"})(a.MbsIntersectResult||(a.MbsIntersectResult={}));const ka=-(2**31);f=G.createSolidEdgeMaterial({color:[0,0,0,0],opacity:0});let la=function(){this.material=this.edgeMaterial=null;this.castShadows=!0};const Z=y.create(),ca=y.create(),Y=y.create(),da=k.create(),ha=new Float64Array(24),ja={data:ha,size:3},ma=y.create(),pa=y.create(),na=e.create(),wa=p.create(),
xa=q.create(),sa=[[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0],[0,0,0]],ya=x.create(),ra=x.create(),ua=K.create(),Ba=[0,0,0],Ea={data:Array(72),size:3},Ja=p.create();a.SymbolInfo=la;a.addWraparound=function(va,Ca){return(va|0)+(Ca|0)|0};a.checkPointCloudLayerCompatibleWithView=function(va,Ca){W(va.spatialReference,Ca.spatialReference,Ca.viewingMode)};a.checkPointCloudLayerValid=function(va){var Ca;(Ca=null==va.store||null==va.store.defaultGeometrySchema)||(va=va.store.defaultGeometrySchema,
Ca=!!(null==va.geometryType||"points"!==va.geometryType||null!=va.topology&&"PerAttributeArray"!==va.topology||null!=va.encoding&&""!==va.encoding&&"lepcc-xyz"!==va.encoding||null==va.vertexAttributes||null==va.vertexAttributes.position));if(Ca)throw new l("pointcloud:unsupported-geometry-schema","The geometry schema of this point cloud scene layer is not supported.",{});};a.checkSceneLayerCompatibleWithView=function(va,Ca){X(va,Ca.spatialReference,Ca.viewingMode)};a.checkSceneLayerValid=function(va){var Ca;
(Ca=null==va.store||null==va.store.defaultGeometrySchema)||(Ca=va.store.defaultGeometrySchema,Ca=!!(null!=Ca.geometryType&&"triangles"!==Ca.geometryType||null!=Ca.topology&&"PerAttributeArray"!==Ca.topology||null==Ca.vertexAttributes||null==Ca.vertexAttributes.position));if(Ca)throw new l("scenelayer:unsupported-geometry-schema","The geometry schema of this scene layer is not supported.",{url:va.parsedUrl.path});};a.checkSpatialReference=W;a.checkSpatialReferences=X;a.computeOffsetObb=function(va,
Ca,Ka,Oa,Ra){t.copy(Ra.quaternion,va.quaternion);if(Oa===D.ViewingMode.Global){t.conjugate(da,va.quaternion);r.transformQuat(Z,va.center,da);r.abs(ca,Z);r.min(Y,ca,va.halfSize);r.sub(Y,ca,Y);Oa=r.length(Y);r.add(Y,ca,va.halfSize);const Pa=r.length(Y);Oa<Ka?(r.copy(Ra.center,va.center),r.set(Z,Ka,Ka,Ka),r.add(Ra.halfSize,va.halfSize,Z)):(Ca=0<Pa?1+Ca/Pa:1,Oa=0<Oa?1+Ka/Oa:1,Ka=(Oa+Ca)/2,Ca=(Oa-Ca)/2,r.scale(Ra.halfSize,ca,Ca),r.scaleAndAdd(Ra.halfSize,Ra.halfSize,va.halfSize,Ka),r.scale(Ra.center,ca,
Ka),r.scaleAndAdd(Ra.center,Ra.center,va.halfSize,Ca),r.sign(Z,Z),r.multiply(Ra.center,Ra.center,Z),r.transformQuat(Ra.center,Ra.center,Ra.quaternion))}else Oa=r.set(Z,0,0,1),r.scaleAndAdd(Ra.center,va.center,Oa,(Ka+Ca)/2),t.conjugate(da,va.quaternion),r.transformQuat(Oa,Oa,da),r.abs(Oa,Oa),r.scaleAndAdd(Ra.halfSize,va.halfSize,Oa,(Ka-Ca)/2);return Ra};a.computeVisibilityObb=function(va,Ca,Ka,Oa,Ra,Pa){if(!Pa||0===Pa.length||v.isNone(Ca))return null;const qa=F.computeGlobalTransformation(va.mbs,Ra,
Ka,Ca);g.invert(Ja,qa);let za;const Da=()=>{if(!za)if(za=sa,x.empty(ra),v.isSome(va.serviceObb)){ba(va.serviceObb,Ka,ua,Ca,Ra);K.corners(ua,za);for(var Ta of za)r.transformMat4(Ta,Ta,Ja),x.expandPointInPlace(ra,Ta)}else{var Za=va.mbs;Ta=Za[3];w.projectVectorToVector(Za,Ka,Ba,Ca);r.transformMat4(Ba,Ba,Ja);Ba[2]+=Ra;for(Za=0;8>Za;++Za){const ab=za[Za];r.copy(ab,[Ba[0]+(Za&1?Ta:-Ta),Ba[1]+(Za&2?Ta:-Ta),Ba[2]+(Za&4?Ta:-Ta)]);x.expandPointInPlace(ra,ab)}}};let La=Infinity,Na=-Infinity;const Ua=Ta=>{if("replace"===
Ta.type&&(Ta=Ta.geometry,Ta.hasZ)){x.empty(ya);var Za=Ta.spatialReference||Oa;Ta=Ta.rings.reduce((ab,hb)=>hb.reduce((ta,Fa)=>{w.projectVectorToVector(Fa,Za,Ba,Ca);r.transformMat4(Ba,Ba,Ja);x.expandPointInPlace(ya,Ba);return Math.min(Ba[2],ta)},ab),Infinity);Da();x.intersects(ra,ya)&&(La=Math.min(La,Ta),Na=Math.max(Na,Ta))}};Pa.forEach(Ta=>Ua(Ta));if(Infinity===La)return null;Pa=(Ta,Za,ab)=>{r.transformMat4(Ba,ab,qa);Ta[Za+0]=Ba[0];Ta[Za+1]=Ba[1];Ta[Za+2]=Ba[2];Za+=24;ab[2]=La;r.transformMat4(Ba,ab,
qa);Ta[Za+0]=Ba[0];Ta[Za+1]=Ba[1];Ta[Za+2]=Ba[2];Za+=24;ab[2]=Na;r.transformMat4(Ba,ab,qa);Ta[Za+0]=Ba[0];Ta[Za+1]=Ba[1];Ta[Za+2]=Ba[2]};for(let Ta=0;8>Ta;++Ta)Pa(Ea.data,3*Ta,za[Ta]);return K.compute(Ea)};a.containsDraco=function(va){if(u("disable-feature:i3s-draco")||!va)return!1;for(const Ka of va)for(const Oa of Ka.geometryBuffers){var Ca;if("draco"===(null==(Ca=Oa.compressedAttributes)?void 0:Ca.encoding))return!0}return!1};a.extractWkid=L;a.filterInPlace=function(va,Ca,Ka){let Oa=0,Ra=0;for(let Pa=
0;Pa<Ca.length&&Oa<va.length;Pa++)va[Oa]===Ca[Pa]&&(Ka(Pa)&&(va[Ra]=va[Oa],Ra++),Oa++);va.length=Ra};a.findFieldsCaseInsensitive=M;a.findIntersectingNodes=function(va,Ca,Ka,Oa,Ra,Pa){const qa=Ca!==Oa;Ra.traverse(Ka,za=>{let Da=za.mbs;qa&&(Da=ia,w.projectBoundingSphere(za.mbs,Oa,Da,Ca));if(R(va,Da)===a.MbsIntersectResult.OUTSIDE)return!1;Pa(za);return!0})};a.getCacheKeySuffix=function(va,Ca){return v.isNone(Ca)?"@null":Ca===z.getSphericalPCPF(Ca)?"@ECEF":va.equals(Ca)?"":null!=Ca.wkid?"@"+Ca.wkid:
null};a.getCachedAttributeValue=T;a.getClipRect=function(va,Ca){if(0===Ca.rotationScale[1]&&0===Ca.rotationScale[2]&&0===Ca.rotationScale[3]&&0===Ca.rotationScale[5]&&0===Ca.rotationScale[6]&&0===Ca.rotationScale[7])return ea[0]=(va[0]-Ca.position[0])/Ca.rotationScale[0],ea[1]=(va[1]-Ca.position[1])/Ca.rotationScale[4],ea[2]=(va[2]-Ca.position[0])/Ca.rotationScale[0],ea[3]=(va[3]-Ca.position[1])/Ca.rotationScale[4],ea};a.getIndexCrs=H;a.getSymbolInfo=function(va){const Ca=new la;var Ka=!1;let Oa=
!1;for(const Pa of va.symbolLayers.items)if("fill"===Pa.type&&Pa.enabled){var Ra=Pa.material;va=Pa.edges;v.isSome(Ra)&&!Ka&&(Ka=Ra.color,Ra=O.parseColorMixMode(Ra.colorMixMode),v.isSome(Ka)?Ca.material={color:[Ka.r/255,Ka.g/255,Ka.b/255],alpha:Ka.a,colorMixMode:Ra}:Ca.material={color:[1,1,1],alpha:1,colorMixMode:O.ColorMixModeEnum.Multiply},Ca.castShadows=Pa.castShadows,Ka=!0);v.isSome(va)&&!Oa&&(Ca.edgeMaterial=G.createMaterialFromEdges(va,{}),Oa=!0)}Ca.material||(Ca.material={color:[1,1,1],alpha:1,
colorMixMode:O.ColorMixModeEnum.Multiply});return Ca};a.getVertexCrs=U;a.intersectBoundingBoxWithMbs=function(va,Ca){var Ka=Ca[0],Oa=Ca[1],Ra=Ca[2];Ca=Ca[3];const Pa=va[0]-Ka;Ka-=va[3];const qa=va[1]-Oa;Oa-=va[4];const za=va[2]-Ra;va=Ra-va[5];Ra=Math.max(Pa,Ka,0);const Da=Math.max(qa,Oa,0),La=Math.max(za,va,0);Ra=Ra*Ra+Da*Da+La*La;return Ra>Ca*Ca?a.MbsIntersectResult.OUTSIDE:0<Ra?a.MbsIntersectResult.INTERSECTS_CENTER_OUTSIDE:-Math.max(Pa,Ka,qa,Oa,za,va)>Ca?a.MbsIntersectResult.INSIDE:a.MbsIntersectResult.INTERSECTS_CENTER_INSIDE};
a.intersectBoundingRectWithMbs=R;a.invalidateMbs=function(va){v.isSome(va)&&(va[3]=-1)};a.invalidateObb=function(va){v.isSome(va)&&(va.halfSize[0]=-1)};a.isSupportedLocalModeProjection=Q;a.isValidMbs=function(va){return 0<=va[3]};a.isValidObb=function(va){return v.isSome(va)&&0<=va.halfSize[0]};a.objectIdFilter=function(va,Ca,Ka){let Oa=0,Ra=0;for(;Oa<Ka.length;)0<=n.binaryIndexOf(va,Ka[Oa])===Ca&&(Ka[Ra]=Ka[Oa],Ra++),Oa++;Ka.length=Ra};a.rendererNeedsTextures=function(va){if(null==va||"simple"!==
va.type&&"class-breaks"!==va.type&&"unique-value"!==va.type||("unique-value"===va.type||"class-breaks"===va.type)&&null==va.defaultSymbol)return!0;va=va.getSymbols();if(0===va.length)return!0;for(const Ca of va){if("mesh-3d"!==Ca.type||0===Ca.symbolLayers.length)return!0;for(const Ka of Ca.symbolLayers.items)if("fill"!==Ka.type||v.isNone(Ka.material)||v.isNone(Ka.material.color)||"replace"!==Ka.material.colorMixMode)return!0}return!1};a.transformObb=ba;a.transparentEdgeMaterial=f;a.whenGraphicAttributes=
function(va,Ca,Ka,Oa,Ra){return J.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/quatf32":function(){define(["exports"],function(a){function b(){const v=new Float32Array(4);v[3]=1;return v}function c(v){const m=new Float32Array(4);m[0]=v[0];m[1]=v[1];m[2]=v[2];m[3]=v[3];return m}function n(v,m,h,d){const e=new Float32Array(4);e[0]=v;e[1]=m;e[2]=h;e[3]=d;return e}function l(v,m){return new Float32Array(v,m,4)}const u=
Object.freeze(Object.defineProperty({__proto__:null,create:b,clone:c,fromValues:n,createView:l},Symbol.toStringTag,{value:"Module"}));a.clone=c;a.create=b;a.createView=l;a.fromValues=n;a.quatf32=u})},"esri/views/3d/layers/i3s/I3SBinaryReader":function(){define("exports ../../../../core/Error ../../../../core/lang ../../../../core/Logger ./LEPCC ../../webgl-engine/lib/VertexAttribute".split(" "),function(a,b,c,n,l,u){function v(x,B,C){let D="",E=0;for(;E<C;){var F=x[B+E];if(128>F)D+=String.fromCharCode(F),
E++;else if(192<=F&&224>F){if(E+1>=C)throw new b("utf8-decode-error","UTF-8 Decode failed. Two byte character was truncated.");D+=String.fromCharCode((F&31)<<6|x[B+E+1]&63);E+=2}else if(224<=F&&240>F){if(E+2>=C)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");D+=String.fromCharCode((F&15)<<12|(x[B+E+1]&63)<<6|x[B+E+2]&63);E+=3}else if(240<=F&&248>F){if(E+3>=C)throw new b("utf8-decode-error","UTF-8 Decode failed. Multi byte character was truncated.");F=(F&
7)<<18|(x[B+E+1]&63)<<12|(x[B+E+2]&63)<<6|x[B+E+3]&63;D=65536<=F?D+String.fromCharCode((F-65536>>10)+55296,(F&1023)+56320):D+String.fromCharCode(F);E+=4}else throw new b("utf8-decode-error","UTF-8 Decode failed. Invalid multi byte sequence.");}return D}function m(x,B){const C={byteOffset:0,byteCount:0,fields:Object.create(null)};let D=0;for(let E=0;E<B.length;E++){const F=B[E],G=F.valueType||F.type;C.fields[F.property]=(0,A[G])(x,D);D+=z[G].BYTES_PER_ELEMENT}C.byteCount=D;return C}function h(x,B,
C){const D=[];let E,F=0,G;for(G=0;G<x;G+=1){E=B[G];if(0<E){if(D.push(v(C,F,E-1)),0!==C[F+E-1])throw new b("string-array-error","Invalid string array: missing null termination.");}else D.push(null);F+=E}return D}function d(x,B){return new z[B.valueType](x,B.byteOffset,B.count*B.valuesPerElement)}function e(x,B){return new Uint8Array(x,B.byteOffset,B.byteCount)}function g(x,B,C){x=null!=B.header?m(x,B.header):{byteOffset:0,byteCount:0,fields:{count:C}};C={header:x,byteOffset:x.byteCount,byteCount:0,
entries:Object.create(null)};let D=x.byteCount;for(let E=0;E<B.ordering.length;E++){const F=B.ordering[E],G=c.clone(B[F]);G.count=x.fields.count;if("String"===G.valueType){if(G.byteOffset=D,G.byteCount=x.fields[F+"ByteCount"],"UTF-8"!==G.encoding)throw new b("unsupported-encoding","Unsupported String encoding.",{encoding:G.encoding});}else if(r(G.valueType)){const O=y(G.valueType);D+=0!==D%O?O-D%O:0;G.byteOffset=D;G.byteCount=O*G.valuesPerElement*G.count}else throw new b("unsupported-value-type",
"Unsupported binary valueType",{valueType:G.valueType});D+=G.byteCount;C.entries[F]=G}C.byteCount=D-C.byteOffset;return C}function p(x,B,C){B!==x&&f.error(`Invalid ${C} buffer size\n expected: ${x}, actual: ${B})`);if(B<x)throw new b("buffer-too-small","Binary buffer is too small",{expectedSize:x,actualSize:B});}function t(x){return{isDraco:!1,isLegacy:!1,color:null!=x.color,normal:null!=x.normal,uv0:null!=x.uv0,uvRegion:null!=x.uvRegion,featureIndex:null!=x.faceRange&&null!=x.featureId}}function q(x){const B=
{isDraco:!1,isLegacy:!0,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of x.ordering)if(x.vertexAttributes[C])switch(C){case "normal":B.normal=!0;break;case "color":B.color=!0;break;case "uv0":B.uv0=!0;break;case "region":B.uvRegion=!0}x.featureAttributes&&x.featureAttributeOrder&&(B.featureIndex=!0);return B}function k(x){const B={isDraco:!0,isLegacy:!1,color:!1,normal:!1,uv0:!1,uvRegion:!1,featureIndex:!1};for(const C of x)switch(C){case "normal":B.normal=!0;break;case "uv0":B.uv0=
!0;break;case "color":B.color=!0;break;case "uv-region":B.uvRegion=!0;break;case "feature-index":B.featureIndex=!0}return B}function r(x){return z.hasOwnProperty(x)}function y(x){return r(x)?z[x].BYTES_PER_ELEMENT:0}const f=n.getLogger("esri.views.3d.layers.i3s.I3SBinaryReader"),w={position:u.VertexAttribute.POSITION,normal:u.VertexAttribute.NORMAL,color:u.VertexAttribute.COLOR,uv0:u.VertexAttribute.UV0,region:u.VertexAttribute.UVREGION},z={Float32:Float32Array,Float64:Float64Array,UInt8:Uint8Array,
Int8:Int8Array,UInt16:Uint16Array,Int16:Int16Array,UInt32:Uint32Array,Int32:Int32Array},A={Float32:(x,B)=>(new DataView(x,0)).getFloat32(B,!0),Float64:(x,B)=>(new DataView(x,0)).getFloat64(B,!0),UInt8:(x,B)=>(new DataView(x,0)).getUint8(B),Int8:(x,B)=>(new DataView(x,0)).getInt8(B),UInt16:(x,B)=>(new DataView(x,0)).getUint16(B,!0),Int16:(x,B)=>(new DataView(x,0)).getInt16(B,!0),UInt32:(x,B)=>(new DataView(x,0)).getUint32(B,!0),Int32:(x,B)=>(new DataView(x,0)).getInt32(B,!0)};a.createAttributeDataIndex=
g;a.createGeometryDescriptor=function(x,B){return x&&x.compressedAttributes&&"draco"===x.compressedAttributes.encoding?k(x.compressedAttributes.attributes):x?t(x):q(B)};a.createGeometryDescriptorForDraco=k;a.createGeometryDescriptorFromDefinition=t;a.createGeometryDescriptorFromSchema=q;a.createGeometryIndexFromSchema=function(x,B){var C=m(x,B&&B.header);let D=C.byteCount;const E={isDraco:!1,header:C,byteOffset:C.byteCount,byteCount:0,vertexAttributes:{}};C=C.fields;var F=null!=C.vertexCount?C.vertexCount:
C.count;for(var G of B.ordering){if(!B.vertexAttributes[G])continue;const K={...B.vertexAttributes[G],byteOffset:D,count:F};E.vertexAttributes[w[G]?w[G]:"_"+G]=K;D+=y(K.valueType)*K.valuesPerElement*F}G=C.faceCount;if(B.faces&&G){E.faces={};for(var O of B.ordering)B.faces[O]&&(F={...B.faces[O],byteOffset:D,count:G},E.faces[O]=F,D+=y(F.valueType)*F.valuesPerElement*G)}O=C.featureCount;if(B.featureAttributes&&B.featureAttributeOrder&&O){E.featureAttributes={};for(const K of B.featureAttributeOrder)B.featureAttributes[K]&&
(C={...B.featureAttributes[K],byteOffset:D,count:O},E.featureAttributes[K]=C,G="UInt64"===C.valueType?8:y(C.valueType),D+=G*C.valuesPerElement*O)}p(D,x.byteLength,"geometry");E.byteCount=D-E.byteOffset;return E};a.createRawView=e;a.createTypedView=d;a.getBytesPerValue=y;a.isValueType=r;a.readBinaryAttribute=function(x,B,C){if("lepcc-rgb"===x.encoding)return l.decodeRGB(B);if("lepcc-intensity"===x.encoding)return l.decodeIntensity(B);if(null!=x.encoding&&""!==x.encoding)throw new b("unknown-attribute-storage-info-encoding",
"Unknown Attribute Storage Info Encoding");x["attributeByteCounts "]&&!x.attributeByteCounts&&(f.warn("Warning: Trailing space in 'attributeByteCounts '."),x.attributeByteCounts=x["attributeByteCounts "]);"ObjectIds"===x.ordering[0]&&x.hasOwnProperty("objectIds")&&(f.warn("Warning: Case error in objectIds"),x.ordering[0]="objectIds");C=g(B,x,C);p(C.byteOffset+C.byteCount,B.byteLength,"attribute");if(x=C.entries.attributeValues||C.entries.objectIds){if("String"===x.valueType){C=C.entries.attributeByteCounts;
const D=d(B,C);B=e(B,x);return h(C.count,D,B)}return d(B,x)}throw new b("bad-attribute-storage-info","Bad attributeStorageInfo specification.");};a.readHeader=m;a.readStringArray=h;a.valueType2ArrayBufferReader=A;a.valueType2TypedArrayClassMap=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/LEPCC":function(){define(["exports","../../../../core/Error"],function(a,b){function c(v,m,h){return{identifier:String.fromCharCode.apply(null,
new Uint8Array(v,h+u.identifierOffset,u.identifierLength)),version:m.getUint16(h+u.versionOffset,!0),checksum:m.getUint32(h+u.checksumOffset,!0)}}function n(v,m,h){const d=[];m=l(v,m,d);const e=[];for(let g=0;g<d.length;g++){e.length=0;m=l(v,m,e);for(let p=0;p<e.length;p++)h.push(e[p]+d[g])}return m}function l(v,m,h){var d=new DataView(v,m),e=d.getUint8(0);const g=e&31;var p=!!(e&32),t=(e&192)>>6;e=0;if(0===t)e=d.getUint32(1,!0),m+=5;else if(1===t)e=d.getUint16(1,!0),m+=3;else if(2===t)e=d.getUint8(1),
m+=2;else throw new b("lepcc-decode-error","Bad count type");if(p)throw new b("lepcc-decode-error","LUT not implemented");v=new Uint8Array(v,m,Math.ceil(e*g/8));t=p=d=0;const q=-1>>>32-g;for(let k=0;k<e;k++){for(;p<g;)d|=v[t]<<p,p+=8,t+=1;h[k]=d&q;d>>>=g;p-=g;32<p+g&&(d|=v[t-1]>>8-p)}return m+t}const u={identifierOffset:0,identifierLength:10,versionOffset:10,checksumOffset:12,byteCount:16};a.decodeIntensity=function(v){const m=new DataView(v,0);var h=0;const {identifier:d,version:e}=c(v,m,h);h+=u.byteCount;
if("Intensity "!==d)throw new b("lepcc-decode-error","Bad identifier");if(1<e)throw new b("lepcc-decode-error","Unknown version");var g=h;var p=m.getUint32(g+0,!0);var t=m.getUint32(g+4,!0);var q=m.getUint32(g+8,!0);var k=m.getUint16(g+12,!0);var r=m.getUint8(g+14);m.getUint8(g+15);h+=16;if(t*2**32+p!==v.byteLength)throw new b("lepcc-decode-error","Bad size");p=new Uint16Array(q);if(8===r){if(q+h!==v.byteLength)throw new b("lepcc-decode-error","Bad size");v=new Uint8Array(v,h,q);for(h=0;h<q;h++)p[h]=
v[h]*k}else if(16===r){if(2*q+h!==v.byteLength)throw new b("lepcc-decode-error","Bad size");v=new Uint16Array(v,h,q);for(h=0;h<q;h++)p[h]=v[h]*k}else{r=[];if(l(v,h,r)!==v.byteLength)throw new b("lepcc-decode-error","Bad size");for(v=0;v<q;v++)p[v]=r[v]*k}return p};a.decodeRGB=function(v){var m=new DataView(v,0),h=0;const {identifier:d,version:e}=c(v,m,h);h+=u.byteCount;if("ClusterRGB"!==d)throw new b("lepcc-decode-error","Bad identifier");if(1<e)throw new b("lepcc-decode-error","Unknown version");
var g=h;var p=m.getUint32(g+0,!0);var t=m.getUint32(g+4,!0);var q=m.getUint32(g+8,!0);var k=m.getUint16(g+12,!0);var r=m.getUint8(g+14);g=m.getUint8(g+15);h+=16;if(t*2**32+p!==v.byteLength)throw new b("lepcc-decode-error","Bad size");if((2===r||1===r)&&0===g){if(3*k+q+h!==v.byteLength||256<k)throw new b("lepcc-decode-error","Bad count");m=new Uint8Array(v,h,3*k);h=new Uint8Array(v,h+3*k,q);v=new Uint8Array(3*q);for(k=0;k<q;k++)p=h[k],v[3*k]=m[3*p],v[3*k+1]=m[3*p+1],v[3*k+2]=m[3*p+2];return v}if(0===
r&&0===g){if(3*q+h!==v.byteLength||0!==k)throw new b("lepcc-decode-error","Bad count");return(new Uint8Array(v,h)).slice()}if(2>=r&&1===g){if(h+3!==v.byteLength||1!==k)throw new b("lepcc-decode-error","Bad count");v=m.getUint8(h);k=m.getUint8(h+1);h=m.getUint8(h+2);m=new Uint8Array(3*q);for(p=0;p<q;p++)m[3*p]=v,m[3*p+1]=k,m[3*p+2]=h;return m}throw new b("lepcc-decode-error","Bad method "+r+","+g);};a.decodeXYZ=function(v){var m=new DataView(v,0),h=0;const {identifier:d,version:e}=c(v,m,h);h+=u.byteCount;
if("LEPCC     "!==d)throw new b("lepcc-decode-error","Bad identifier");if(1<e)throw new b("lepcc-decode-error","Unknown version");var g=h;var p=m.getUint32(g+0,!0);var t=m.getUint32(g+4,!0);var q=m.getFloat64(g+8,!0);var k=m.getFloat64(g+16,!0);var r=m.getFloat64(g+24,!0);var y=m.getFloat64(g+32,!0);var f=m.getFloat64(g+40,!0);var w=m.getFloat64(g+48,!0);var z=m.getFloat64(g+56,!0);var A=m.getFloat64(g+64,!0);var x=m.getFloat64(g+72,!0);var B=m.getUint32(g+80,!0);m.getUint32(g+84,!0);h+=88;if(t*2**
32+p!==v.byteLength)throw new b("lepcc-decode-error","Bad size");p=new Float64Array(3*B);t=[];B=[];m=[];g=[];h=n(v,h,t);h=n(v,h,B);h=n(v,h,m);h=n(v,h,g);if(h!==v.byteLength)throw new b("lepcc-decode-error","Bad length");h=v=0;for(let C=0;C<t.length;C++){h+=t[C];let D=0;for(let E=0;E<B[C];E++){D+=m[v];const F=g[v];p[3*v]=Math.min(y,q+2*z*D);p[3*v+1]=Math.min(f,k+2*A*h);p[3*v+2]=Math.min(w,r+2*x*F);v++}}return{errorX:z,errorY:A,errorZ:x,result:p}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/layers/i3s/I3SProjectionUtil":function(){define(["exports","../../../../chunks/mat4f64","../../../../chunks/vec3f64","../../../../geometry/projection","../../../../geometry/projectionEllipsoid"],function(a,b,c,n,l){function u(v,m,h){const d=c.create(),e=2**(4*Math.ceil(Math.log(v[3])*Math.LOG2E/4)+1);if(h.isGeographic){var g=e/l.getReferenceEllipsoid(h).radius*180/Math.PI;h=Math.max(-90,Math.min(90,Math.round(v[1]/g)*g));g/=Math.cos((Math.abs(h)-g/2)/180*Math.PI);d[0]=Math.round(v[0]/
g)*g;d[1]=h}else h=Math.round(v[1]/e),d[0]=Math.round(v[0]/e)*e,d[1]=h*e;d[2]=Math.round((v[2]+m)/e)*e;return d}a.computeGlobalTransformation=function(v,m,h,d){v=u(v,m,h);m=b.create();n.computeTranslationToOriginAndRotation(h,v,m,d);return m};a.getLocalOrigin=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/orientedBoundingBox":function(){define("exports ../../../chunks/mat3 ../../../chunks/mat3f64 ../../../chunks/quat ../../../chunks/quatf32 ../../../chunks/quatf64 ../../../chunks/vec3 ../../../chunks/vec3f32 ../../../chunks/vec3f64 ../../../chunks/vec4 ../../../chunks/vec4f64 ../../../geometry/support/aaBoundingBox ../../../geometry/support/plane ./dito".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(C=[0,0,0],D=[-1,-1,-1],E=[0,0,0,1]){return{center:h.clone(C),halfSize:m.clone(D),quaternion:l.clone(E)}}function k(C,D){const E=p.signedDistance(D,C.center);C=r(C,p.normal(D));return E>C?1:E<-C?-1:0}function r(C,D){n.conjugate(y,C.quaternion);v.transformQuat(f,D,y);C=C.halfSize;return Math.abs(f[0]*C[0])+Math.abs(f[1]*C[1])+Math.abs(f[2]*C[2])}const y=u.create(),f=h.create(),w=h.create(),z=e.create(),A=c.create(),x=[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.1,
1.2],B=(()=>{const C=new Int8Array(162);let D=0;const E=F=>{for(let G=0;G<F.length;G++)C[D+G]=F[G];D+=6};E([6,2,3,1,5,4]);E([0,2,3,1,5,4]);E([0,2,3,7,5,4]);E([0,1,3,2,6,4]);E([0,1,3,2,0,0]);E([0,1,5,7,3,2]);E([0,1,3,7,6,4]);E([0,1,3,7,6,2]);E([0,1,5,7,6,2]);E([0,1,5,4,6,2]);E([0,1,5,4,0,0]);E([0,1,3,7,5,4]);E([0,2,6,4,0,0]);E([0,0,0,0,0,0]);E([1,3,7,5,0,0]);E([2,3,7,6,4,0]);E([2,3,7,6,0,0]);E([2,3,1,5,7,6]);E([0,1,5,7,6,2]);E([0,1,5,7,6,4]);E([0,1,3,7,6,4]);E([4,5,7,6,2,0]);E([4,5,7,6,0,0]);E([4,
5,1,3,7,6]);E([0,2,3,7,5,4]);E([6,2,3,7,5,4]);E([6,2,3,1,5,4]);return C})();a.ObbArray=function(C){this.buffer=new ArrayBuffer(56*C);this.obbs=Array(C);for(let D=0;D<C;D++)this.obbs[D]={center:h.createView(this.buffer,56*D),halfSize:m.createView(this.buffer,56*D+24),quaternion:l.createView(this.buffer,56*D+36)}};a.clone=function(C){return q(C.center,C.halfSize,C.quaternion)};a.compute=function(C,D){D=D||q();t.computeOBB(C,D);return D};a.corners=function(C,D){for(let E=0;8>E;++E){const F=D[E];F[0]=
E&1?-C.halfSize[0]:C.halfSize[0];F[1]=E&2?-C.halfSize[1]:C.halfSize[1];F[2]=E&4?-C.halfSize[2]:C.halfSize[2];v.transformQuat(F,F,C.quaternion);v.add(F,F,C.center)}};a.create=q;a.intersectLine=function(C,D,E,F=0){n.conjugate(y,C.quaternion);v.subtract(f,D,C.center);D=v.transformQuat(f,f,y);E=v.transformQuat(w,E,y);let G=-Infinity,O=Infinity;for(let K=0;3>K;K++)if(1E-6<Math.abs(E[K])){const L=(F+C.halfSize[K]-D[K])/E[K],R=(-F-C.halfSize[K]-D[K])/E[K];G=Math.max(G,Math.min(L,R));O=Math.min(O,Math.max(L,
R))}else if(D[K]>C.halfSize[K]+F||D[K]<-C.halfSize[K]-F)return!1;return G<=O};a.intersectPlane=k;a.isVisible=function(C,D){return 0>=k(C,D[0])&&0>=k(C,D[1])&&0>=k(C,D[2])&&0>=k(C,D[3])&&0>=k(C,D[4])&&0>=k(C,D[5])};a.maximumDistancePlane=function(C,D){const E=p.signedDistance(D,C.center);C=r(C,p.normal(D));return E+C};a.minimumDistancePlane=function(C,D){const E=p.signedDistance(D,C.center);C=r(C,p.normal(D));return E-C};a.projectedArea=function(C,D,E,F,G){n.conjugate(y,C.quaternion);v.sub(f,D,C.center);
v.transformQuat(f,f,y);var O=f[0]<-C.halfSize[0]?-1:f[0]>C.halfSize[0]?1:0,K=f[1]<-C.halfSize[1]?-1:f[1]>C.halfSize[1]?1:0,L=f[2]<-C.halfSize[2]?-1:f[2]>C.halfSize[2]?1:0;D=Math.abs(O)+Math.abs(K)+Math.abs(L);if(0===D)return Infinity;D=1===D?4:6;O=6*(O+3*K+9*L+13);b.fromQuat(A,C.quaternion);b.scale(A,A,C.halfSize);for(K=0;K<D;K++)L=B[O+K],v.set(f,((L&1)<<1)-1,(L&2)-1,((L&4)>>1)-1),v.transformMat3(f,f,A),v.add(z,C.center,f),z[3]=1,d.transformMat4(z,z,E),L=1/Math.max(1E-6,z[3]),x[2*K]=z[0]*L,x[2*K+
1]=z[1]*L;C=2*D-2;E=x[0]*(x[3]-x[C+1])+x[C]*(x[1]-x[C-1]);for(D=2;D<C;D+=2)E+=x[D]*(x[D+3]-x[D-1]);return Math.abs(E)*F*G*.125};a.projectedRadius=r;a.radius=function(C){return v.len(C.halfSize)};a.set=function(C,D){v.copy(D.center,C.center);v.copy(D.halfSize,C.halfSize);n.copy(D.quaternion,C.quaternion)};a.toAaBoundingBox=function(C,D){D||(D=g.create());var E=b.fromQuat(A,C.quaternion);const F=C.halfSize[0]*Math.abs(E[0])+C.halfSize[1]*Math.abs(E[3])+C.halfSize[2]*Math.abs(E[6]),G=C.halfSize[0]*Math.abs(E[1])+
C.halfSize[1]*Math.abs(E[4])+C.halfSize[2]*Math.abs(E[7]);E=C.halfSize[0]*Math.abs(E[2])+C.halfSize[1]*Math.abs(E[5])+C.halfSize[2]*Math.abs(E[8]);D[0]=C.center[0]-F;D[1]=C.center[1]-G;D[2]=C.center[2]-E;D[3]=C.center[0]+F;D[4]=C.center[1]+G;D[5]=C.center[2]+E;return D};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/dito":function(){define(["exports"],function(a){function b(Q,X,ba,aa,ea,ia){if(!(1E-6>X[0]*X[0]+X[1]*X[1]+X[2]*X[2]))for(g(E,
ba,X),g(F,aa,X),g(G,ea,X),c(Q,X,D),K[1]=D[0],O[1]=D[1],L[1]=O[1]-K[1],ba=[ba,aa,ea],aa=[E,F,G],ea=0;3>ea;++ea){c(Q,ba[ea],D);K[0]=D[0];O[0]=D[1];c(Q,aa[ea],D);K[2]=D[0];O[2]=D[1];L[0]=O[0]-K[0];L[2]=O[2]-K[2];const ka=v(L);ka<ia.quality&&(e(ia.b0,ba[ea]),e(ia.b1,X),e(ia.b2,aa[ea]),ia.quality=ka)}}function c(Q,X,ba){const {data:aa,size:ea}=Q;ba[0]=Number.POSITIVE_INFINITY;ba[1]=Number.NEGATIVE_INFINITY;for(Q=0;Q<aa.length;Q+=ea){const ia=aa[Q]*X[0]+aa[Q+1]*X[1]+aa[Q+2]*X[2];ba[0]=Math.min(ba[0],ia);
ba[1]=Math.max(ba[1],ia)}}function n(Q,X,ba){e(ba.center,Q);d(ba.halfSize,X,.5);ba.quaternion[0]=0;ba.quaternion[1]=0;ba.quaternion[2]=0;ba.quaternion[3]=1}function l(Q,X,ba,aa,ea,ia){c(Q,X,D);ea[0]=D[0];ia[0]=D[1];c(Q,ba,D);ea[1]=D[0];ia[1]=D[1];c(Q,aa,D);ea[2]=D[0];ia[2]=D[1]}function u(Q,X,ba,aa,ea,ia,ka){T[0]=Q[0];T[1]=Q[1];T[2]=Q[2];T[3]=X[0];T[4]=X[1];T[5]=X[2];T[6]=ba[0];T[7]=ba[1];T[8]=ba[2];var la=ka.quaternion,Z=T,ca=Z[0]+Z[4]+Z[8];if(0<ca)ca=Math.sqrt(ca+1),la[3]=.5*ca,ca=.5/ca,la[0]=(Z[5]-
Z[7])*ca,la[1]=(Z[6]-Z[2])*ca,la[2]=(Z[1]-Z[3])*ca;else{ca=0;Z[4]>Z[0]&&(ca=1);Z[8]>Z[3*ca+ca]&&(ca=2);const Y=(ca+1)%3,da=(ca+2)%3;let ha=Math.sqrt(Z[3*ca+ca]-Z[3*Y+Y]-Z[3*da+da]+1);la[ca]=.5*ha;ha=.5/ha;la[3]=(Z[3*Y+da]-Z[3*da+Y])*ha;la[Y]=(Z[3*Y+ca]+Z[3*ca+Y])*ha;la[da]=(Z[3*da+ca]+Z[3*ca+da])*ha}m(H,aa,ea);d(H,H,.5);d(ka.center,Q,H[0]);d(S,X,H[1]);m(ka.center,ka.center,S);d(S,ba,H[2]);m(ka.center,ka.center,S);d(ka.halfSize,ia,.5)}function v(Q){return Q[0]*Q[1]+Q[0]*Q[2]+Q[1]*Q[2]}function m(Q,
X,ba){Q[0]=X[0]+ba[0];Q[1]=X[1]+ba[1];Q[2]=X[2]+ba[2]}function h(Q,X,ba){Q[0]=X[0]-ba[0];Q[1]=X[1]-ba[1];Q[2]=X[2]-ba[2]}function d(Q,X,ba){Q[0]=X[0]*ba;Q[1]=X[1]*ba;Q[2]=X[2]*ba}function e(Q,X,ba=0){Q[0]=X[ba+0];Q[1]=X[ba+1];Q[2]=X[ba+2]}function g(Q,X,ba){const aa=X[0],ea=X[1];X=X[2];const ia=ba[0],ka=ba[1];ba=ba[2];Q[0]=ea*ba-X*ka;Q[1]=X*ia-aa*ba;Q[2]=aa*ka-ea*ia}function p(Q,X){var ba=X[0]*X[0]+X[1]*X[1]+X[2]*X[2];0<ba&&(ba=1/Math.sqrt(ba),Q[0]=X[0]*ba,Q[1]=X[1]*ba,Q[2]=X[2]*ba)}function t(Q,
X){const ba=X[0]-Q[0],aa=X[1]-Q[1];Q=X[2]-Q[2];return ba*ba+aa*aa+Q*Q}const q=[0,0,0],k=[0,0,0],r=[0,0,0],y=[0,0,0],f=[0,0,0],w=[0,0,0],z=[0,0,0],A=[0,0,0],x=[0,0,0],B=[0,0,0],C=[0,0,0],D=[0,0],E=[0,0,0],F=[0,0,0],G=[0,0,0],O=[0,0,0],K=[0,0,0],L=[0,0,0],R=[0,0,0],M=[0,0,0],J=[0,0,0],I=[0,0,0],P=[0,0,0],N=[0,0,0],V=[0,0,0],S=[0,0,0],T=[1,0,0,0,1,0,0,0,1],H=[0,0,0];let U=function(Q){this.minVert=Array(7);this.maxVert=Array(7);this.buffer=new ArrayBuffer(448);var X=0;this.minProj=new Float64Array(this.buffer,
X,7);X+=56;this.maxProj=new Float64Array(this.buffer,X,7);X+=56;for(var ba=0;7>ba;++ba)this.minVert[ba]=new Float64Array(this.buffer,X,3),X+=24;for(ba=0;7>ba;++ba)this.maxVert[ba]=new Float64Array(this.buffer,X,3),X+=24;for(X=0;7>X;++X)this.minProj[X]=Number.POSITIVE_INFINITY,this.maxProj[X]=Number.NEGATIVE_INFINITY;X=Array(7);ba=Array(7);const {data:aa,size:ea}=Q;for(Q=0;Q<aa.length;Q+=ea){var ia=aa[Q];ia<this.minProj[0]&&(this.minProj[0]=ia,X[0]=Q);ia>this.maxProj[0]&&(this.maxProj[0]=ia,ba[0]=
Q);ia=aa[Q+1];ia<this.minProj[1]&&(this.minProj[1]=ia,X[1]=Q);ia>this.maxProj[1]&&(this.maxProj[1]=ia,ba[1]=Q);ia=aa[Q+2];ia<this.minProj[2]&&(this.minProj[2]=ia,X[2]=Q);ia>this.maxProj[2]&&(this.maxProj[2]=ia,ba[2]=Q);ia=aa[Q]+aa[Q+1]+aa[Q+2];ia<this.minProj[3]&&(this.minProj[3]=ia,X[3]=Q);ia>this.maxProj[3]&&(this.maxProj[3]=ia,ba[3]=Q);ia=aa[Q]+aa[Q+1]-aa[Q+2];ia<this.minProj[4]&&(this.minProj[4]=ia,X[4]=Q);ia>this.maxProj[4]&&(this.maxProj[4]=ia,ba[4]=Q);ia=aa[Q]-aa[Q+1]+aa[Q+2];ia<this.minProj[5]&&
(this.minProj[5]=ia,X[5]=Q);ia>this.maxProj[5]&&(this.maxProj[5]=ia,ba[5]=Q);ia=aa[Q]-aa[Q+1]-aa[Q+2];ia<this.minProj[6]&&(this.minProj[6]=ia,X[6]=Q);ia>this.maxProj[6]&&(this.maxProj[6]=ia,ba[6]=Q)}for(Q=0;7>Q;++Q)ia=X[Q],e(this.minVert[Q],aa,ia),ia=ba[Q],e(this.maxVert[Q],aa,ia)},W=function(){this.b0=[1,0,0];this.b1=[0,1,0];this.b2=[0,0,1];this.quality=0};a.computeOBB=function(Q,X){const {data:ba,size:aa}=Q;var ea=ba.length/aa;if(!(0>=ea)){var ia=new U(Q);m(q,ia.minProj,ia.maxProj);d(q,q,.5);h(k,
ia.maxProj,ia.minProj);var ka=v(k),la=new W;la.quality=ka;14>ea&&(Q={data:new Float64Array(ia.buffer,112,42),size:3});var Z=[0,0,0],ca=[0,0,0],Y=[0,0,0];ea=[0,0,0];var da=[0,0,0],ha=[0,0,0],ja=[0,0,0];var ma=Q;var pa=t(ia.maxVert[0],ia.minVert[0]),na=0;for(var wa=1;7>wa;++wa){const xa=t(ia.maxVert[wa],ia.minVert[wa]);xa>pa&&(pa=xa,na=wa)}e(Z,ia.minVert[na]);e(ca,ia.maxVert[na]);if(1E-6>t(Z,ca))ma=1;else{h(ea,Z,ca);p(ea,ea);{const {data:xa,size:sa}=ma;ia=Number.NEGATIVE_INFINITY;pa=0;for(na=0;na<xa.length;na+=
sa)C[0]=xa[na]-Z[0],C[1]=xa[na+1]-Z[1],C[2]=xa[na+2]-Z[2],wa=ea[0]*C[0]+ea[1]*C[1]+ea[2]*C[2],wa=C[0]*C[0]+C[1]*C[1]+C[2]*C[2]-wa*wa/(ea[0]*ea[0]+ea[1]*ea[1]+ea[2]*ea[2]),wa>ia&&(ia=wa,pa=na);e(Y,xa,pa)}1E-6>ia?ma=2:(h(da,ca,Y),p(da,da),h(ha,Y,Z),p(ha,ha),g(ja,da,ea),p(ja,ja),b(ma,ja,ea,da,ha,la),ma=0)}switch(ma){case 1:n(q,k,X);return;case 2:ka=Q;e(M,ea);Math.abs(ea[0])>Math.abs(ea[1])&&Math.abs(ea[0])>Math.abs(ea[2])?M[0]=0:Math.abs(ea[1])>Math.abs(ea[2])?M[1]=0:M[2]=0;1E-6>M[0]*M[0]+M[1]*M[1]+
M[2]*M[2]&&(M[0]=M[1]=M[2]=1);g(J,ea,M);p(J,J);g(I,ea,J);p(I,I);l(ka,ea,J,I,P,N);h(V,N,P);u(ea,J,I,P,N,V,X);return}ma=Q;{ia=D;const {data:xa,size:sa}=ma;e(y,xa);e(r,y);ia[0]=R[0]*ja[0]+R[1]*ja[1]+R[2]*ja[2];ia[1]=ia[0];for(pa=sa;pa<xa.length;pa+=sa)na=xa[pa]*ja[0]+xa[pa+1]*ja[1]+xa[pa+2]*ja[2],na<ia[0]&&(ia[0]=na,e(y,xa,pa)),na>ia[1]&&(ia[1]=na,e(r,xa,pa))}ja=Z[0]*ja[0]+Z[1]*ja[1]+Z[2]*ja[2];D[1]-1E-6<=ja&&(r[0]=void 0);D[0]+1E-6>=ja&&(y[0]=void 0);void 0!==r[0]&&(h(f,r,Z),p(f,f),h(w,r,ca),p(w,w),
h(z,r,Y),p(z,z),g(A,w,ea),p(A,A),g(x,z,da),p(x,x),g(B,f,ha),p(B,B),b(ma,A,ea,w,f,la),b(ma,x,da,z,w,la),b(ma,B,ha,f,z,la));void 0!==y[0]&&(h(f,y,Z),p(f,f),h(w,y,ca),p(w,w),h(z,y,Y),p(z,z),g(A,w,ea),p(A,A),g(x,z,da),p(x,x),g(B,f,ha),p(B,B),b(ma,A,ea,w,f,la),b(ma,x,da,z,w,la),b(ma,B,ha,f,z,la));l(Q,la.b0,la.b1,la.b2,P,N);Q=[0,0,0];h(Q,N,P);la.quality=v(Q);la.quality<ka?u(la.b0,la.b1,la.b2,P,N,Q,X):n(q,k,X)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/collections/Component/ComponentData":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/maybe","../../../../../core/typedArrayUtil","./IndexRange/ComponentRangeRunLengthEncoded","../../lib/AutoDisposable"],function(a,b,c,n,l){function u(v,m,h){const d=[],e=[];let g=h.length,p=h.length;m.forEachComponent(t=>{0<v[t]?(g!==t-1&&(d.length&&d.push(h[g+1]-d[d.length-1]),d.push(h[t])),g=t):(p!==t-1&&(e.length&&e.push(h[p+1]-e[e.length-1]),
e.push(h[t])),p=t);return!0});d.length&&d.push(h[g+1]-d[d.length-1]);e.length&&e.push(h[p+1]-e[e.length-1]);return{highlightRanges:d,defaultRanges:e}}return function(v){function m(d,e){var g=v.call(this)||this;g.pickability=null;g.highlightCounts=null;g.verticalOffsets=null;g.cachedGeometryRanges=null;g.cachedHighlightRanges=null;g.cachedDefaultRanges=null;g.offsets=c.slice(e);e=g.count;g.visibility=new n.ComponentRangeRunLengthEncoded(e);g.materialDataBuffer=d.getBuffer(e);g.materialDataIndices=
new Uint16Array(e);for(d=0;d<e;d++)g.materialDataIndices[d]=g.materialDataBuffer.acquireIndex();return g}a._inheritsLoose(m,v);var h=m.prototype;h.dispose=function(){v.prototype.dispose.call(this);for(let d=0;d<this.count;d++)this.materialDataBuffer.releaseIndex(this.materialDataIndices[d])};h.highlightsDirty=function(){this.cachedDefaultRanges=this.cachedHighlightRanges=null};h.visibilityDirty=function(){this.cachedGeometryRanges=null;this.highlightsDirty()};h._updateCachedHighlightRanges=function(){if((b.isNone(this.cachedHighlightRanges)||
b.isNone(this.cachedDefaultRanges))&&b.isSome(this.highlightCounts)){const {highlightRanges:d,defaultRanges:e}=u(this.highlightCounts,this.visibility,this.offsets);this.cachedHighlightRanges=d;this.cachedDefaultRanges=e}};a._createClass(m,[{key:"count",get:function(){return this.offsets.length-1}},{key:"geometryRanges",get:function(){b.isNone(this.cachedGeometryRanges)&&(this.cachedGeometryRanges=this.visibility.computeOffsetRanges(this.offsets));return this.cachedGeometryRanges}},{key:"highlightRanges",
get:function(){if(b.isNone(this.highlightCounts))return null;this._updateCachedHighlightRanges();return this.cachedHighlightRanges}},{key:"defaultShadowMapRanges",get:function(){if(b.isNone(this.highlightCounts))return this.geometryRanges;this._updateCachedHighlightRanges();return this.cachedDefaultRanges}}]);return m}(l.AutoDisposable)})},"esri/views/3d/webgl-engine/collections/Component/IndexRange/ComponentRangeRunLengthEncoded":function(){define(["exports"],function(a){let b=function(){function c(l){this._totalCount=
l;this._indexRanges=[0,l]}var n=c.prototype;n.allVisible=function(){return this.componentCount()===this._totalCount};n.allInvisible=function(){return 0===this._indexRanges.length};n.componentCount=function(){const l=this._indexRanges;let u=0;for(let v=0;v<l.length;v+=2)u+=l[v+1];return u};n.reset=function(l){if("all"===l||l.length===this._totalCount)this._indexRanges=[0,this._totalCount];else{{const m=[];if(0!==l.length){var u=l[0],v=1;for(let h=1;h<l.length;h++){const d=l[h];u+v===d?v+=1:(m.push(u),
m.push(v),u=d,v=1)}m.push(u);m.push(v)}l=m}this._indexRanges=l}};n.forEachComponent=function(l){const u=this._indexRanges;for(let m=0;m<u.length;m+=2){var v=u[m];const h=v+u[m+1];for(;v<h;v++)if(!l(v))return!1}return!0};n.forEachComponentRange=function(l){const u=this._indexRanges;for(let v=0;v<u.length;v+=2){const m=u[v];if(!l(m,m+u[v+1]))return!1}return!0};n.computeOffsetRanges=function(l){const u=Array(this._indexRanges.length),v=this._indexRanges;for(let h=0;h<v.length;h+=2){var m=v[h];const d=
l[m];m=l[m+v[h+1]];u[h]=d;u[h+1]=m-d}return u};return c}();a.ComponentRangeRunLengthEncoded=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/ComponentObject":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,n){let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.visible=a.State.Hidden;
return m}b._inheritsLoose(v,u);return v}(n.AutoDisposable);c.__decorate([n.autoDispose()],l.prototype,"renderable",void 0);c.__decorate([n.autoDispose()],l.prototype,"components",void 0);a.State=void 0;(function(u){u[u.Hidden=0]="Hidden";u[u.Visible=1]="Visible"})(a.State||(a.State={}));a.ComponentObject=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/IntersectionGeometry":function(){define("../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/aaBoundingBox ../../../../../geometry/support/buffer/BufferView ./ComponentIntersectionData ../../lib/ComponentUtils ../../lib/geometryDataUtils ../../materials/internal/MaterialUtil".split(" "),
function(a,b,c,n,l,u,v,m,h,d){let e=function(){function t(k,r){this._indices=b.isSome(k.indices)?k.indices:h.generateDefaultIndexArray(k.positions.length/3);this._positions=new u.BufferViewVec3f(k.positions);this._components=r;this._componentIntersectionData=Array(r.count)}var q=t.prototype;q.getComponentAabb=function(k,r){if(b.isSome(this._perComponentAabbs)){for(let y=0;6>y;y++)r[y]=this._perComponentAabbs[6*k+y];return r}this._computePerComponentAabbs();return this.getComponentAabb(k,r)};q.getComponentPositions=
function(k,r){r.indices=this._indices;r.data=this._positions.typedBuffer;r.stride=this._positions.typedBufferStride;r.startIndex=this._components.offsets[k];r.endIndex=this._components.offsets[k+1]};q.intersect=function(k,r,y,f,w,z,A){const x={data:this._positions.typedBuffer,stride:this._positions.typedBufferStride,size:3},B=this._indices,C=this._components.offsets,D=d.computeInvDir(k,r,g),E=k[2],F=r[2];this._components.visibility.forEachComponent(G=>{if(!m.getVisibility(this._components.pickability,
G))return!0;var O=this.getComponentAabb(G,p);if(b.isSome(z)){var K=z[G];b.isSome(w)?w.componentOffset=K:(k[2]=E-K,r[2]=F-K)}b.isSome(w)&&w.applyToAabb(O);if(!d.intersectAabbInvDir(O,k,D,y))return!0;O=C[G]/3;K=C[G+1]/3;const L=(M,J,I)=>{A(G,M,c.transformMat3(J,J,f),I)},R=K-O;b.isNone(w)&&R>v.componentMinimalSizeForIntersectionData?(null==this._componentIntersectionData[G]&&(this._componentIntersectionData[G]=new v.ComponentIntersectionData(this._indices,O,K,x)),this._componentIntersectionData[G].intersectRay({r0:k,
r1:r},L)):d.intersectTriangles(k,r,O,K,B,x,void 0,w,L);return!0})};q._computePerComponentAabbs=function(){const k=this._components.count;this._perComponentAabbs=new Float32Array(6*k);const r=this._indices,y=this._positions.typedBuffer,f=this._positions.typedBufferStride,w=this._components.offsets;let z=0;for(let B=0;B<k;B++){var A=w[B];const C=w[B+1];let D=Infinity,E=Infinity,F=Infinity,G=-Infinity,O=-Infinity,K=-Infinity;for(;A<C;A++){var x=r[A]*f;const L=y[x],R=y[x+1];x=y[x+2];D=Math.min(D,L);E=
Math.min(E,R);F=Math.min(F,x);G=Math.max(G,L);O=Math.max(O,R);K=Math.max(K,x)}this._perComponentAabbs[z++]=D;this._perComponentAabbs[z++]=E;this._perComponentAabbs[z++]=F;this._perComponentAabbs[z++]=G;this._perComponentAabbs[z++]=O;this._perComponentAabbs[z++]=K}};a._createClass(t,[{key:"positions",get:function(){return this._positions}},{key:"indices",get:function(){return this._indices}}]);return t}();const g=n.create(),p=l.create();return e})},"esri/views/3d/webgl-engine/lib/ComponentUtils":function(){define(["exports"],
function(a){function b(c=!0){return{isVisibleBit:!c,data:new Uint32Array(0)}}a.defaultVisibilities=b;a.getVisibility=function(c,n){if(null==c)return!0;const {isVisibleBit:l,data:u}=c,v=8*u.BYTES_PER_ELEMENT;return n<u.length*v?(c=n/v|0,n=0!==(u[c]&1<<n-c*v)===l):!c.isVisibleBit};a.updateVisibilityWithCount=function(c,n,l,u){if(l>=n)return c;null==c&&(c=b());let v=c.data;const m=8*v.BYTES_PER_ELEMENT,h=l/m|0,d=l-m*h,e=v;u=u===c.isVisibleBit;l<e.length*m||!u||(l=Math.max(h+1,Math.ceil(1.5*e.length)),
l=Math.min(l,((n-1)/m|0)+1),v=new Uint32Array(l),v.set(e));h<v.length&&(v[h]=v[h]&~(1<<d)|(u?1:0)<<d);c.data=v;return c};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Renderable":function(){define(["exports"],function(a){let b=function(){function c(n,l,u){this.material=n;this.geometry=l;this.meta=u}c.prototype.dispose=function(){this.material.dispose();this.geometry.dispose()};return c}();a.Renderable=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/RenderGeometry":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/tslib.es6","../../lib/AutoDisposable"],function(a,b,c,n){let l=function(u){function v(m,h,d,e){var g=u.call(this)||this;g.primitiveType=h;g.parameters=d;g.indexed=e;g.vao=m;return g}b._inheritsLoose(v,u);return v}(n.AutoDisposable);c.__decorate([n.autoDispose()],
l.prototype,"vao",void 0);a.RenderGeometry=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/RenderSubmitSystem":function(){define(["exports","./DepthRange"],function(a,b){let c=function(){function n(u){this._objects=u}var l=n.prototype;l.submit=function(u,v){this._objects.preSubmit(v);this._objects.visibleObjects.forAll(m=>m.renderable.material.submit(u,v,m))};l.queryShadowCasterDepthRange=function(u){return this._objects.visibleObjects.length?
b.computeDepthRange(u,this._objects.visibleObjects):null};return n}();a.RenderSubmitSystem=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/DepthRange":function(){define("exports ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/quat ../../../../../chunks/quatf64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../geometry/support/plane ../../../support/orientedBoundingBox ../../lib/depthRange".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){function p(O,K,L){return m.set(O,K.data[L+0],K.data[L+1],K.data[L+2])}function t(O,K){O.push(K[0]);O.push(K[1]);O.push(K[2])}function q(O,K,L,R){u.conjugate(B,O.quaternion);m.sub(C,K,O.center);m.transformQuat(C,C,B);const M=8*((C[0]<-O.halfSize[0]?-1:C[0]>O.halfSize[0]?1:0)+3*(C[1]<-O.halfSize[1]?-1:C[1]>O.halfSize[1]?1:0)+9*(C[2]<-O.halfSize[2]?-1:C[2]>O.halfSize[2]?1:0)+13);K=A[M];if(0===K)return K;n.fromQuat(x,O.quaternion);n.scale(x,x,O.halfSize);const J=(I,P)=>
{P=A[M+P+1];m.set(I,((P&1)<<1)-1,(P&2)-1,((P&4)>>1)-1);m.transformMat3(I,I,x);return m.add(I,O.center,I)};L.length=0;t(L,J(D,0));t(L,J(E,1));t(L,J(C,2));t(L,J(F,3));R(L);if(1===K)return K;L.length=0;t(L,D);t(L,F);t(L,J(C,4));t(L,J(G,5));R(L);if(2===K)return K;L.length=0;t(L,D);t(L,G);t(L,J(C,6));t(L,E);R(L);return K}const k=new c({allocator:O=>O||{near:Infinity,far:-Infinity,mask:0,object:null},deallocator:O=>{O.object=null;return O}}),r=g.empty(),y=h.create(),f=h.create(),w=new c({deallocator:null}),
z=new c({deallocator:null}),A=(()=>{const O=new Int8Array(216);let K=0;const L=R=>{for(let M=0;M<R.length;M++)O[K+M]=R[M];K+=8};L([3,0,6,2,3,1,5,4]);L([2,0,2,3,1,5,4,0]);L([3,1,0,2,3,7,5,4]);L([2,0,1,3,2,6,4,0]);L([1,0,1,3,2,0,0,0]);L([2,1,5,7,3,2,0,0]);L([3,2,0,1,3,7,6,4]);L([2,2,0,1,3,7,6,0]);L([3,3,0,1,5,7,6,2]);L([2,0,1,5,4,6,2,0]);L([1,0,1,5,4,0,0,0]);L([2,1,3,7,5,4,0,0]);L([1,0,2,6,4,0,0,0]);L([0,0,0,0,0,0,0,0]);L([1,1,3,7,5,0,0,0]);L([2,2,3,7,6,4,0,0]);L([1,2,3,7,6,0,0,0]);L([2,3,1,5,7,6,2,
0]);L([3,4,0,1,5,7,6,2]);L([2,5,7,6,4,0,1,0]);L([3,5,0,1,3,7,6,4]);L([2,4,5,7,6,2,0,0]);L([1,4,5,7,6,0,0,0]);L([2,5,1,3,7,6,4,0]);L([3,6,0,2,3,7,5,4]);L([2,6,2,3,7,5,4,0]);L([3,7,6,2,3,1,5,4]);return O})(),x=l.create(),B=v.create(),C=h.create(),D=h.create(),E=h.create(),F=h.create(),G=h.create();a.computeDepthRange=function(O,K){const L=g.empty(),{eye:R,frustum:M,viewForward:J}=O;K.forAll(I=>{var P=b.isSome(I.offsetObb)?I.offsetObb:I.obb;const N=m.dot(m.sub(C,P.center,R),J),V=e.projectedRadius(P,
J);if(!g.within(L,N-V)||!g.within(L,N+V)){a:{var S=0;for(let T=0;4>T;T++){const H=e.intersectPlane(P,M[T]);if(0<H){P=-1;break a}0===H&&(S|=1<<T)}P=S}-1!==P&&(0===P?(r.far=N+V,r.near=N-V,g.union(L,r)):(S=k.pushNew(),S.near=N-V,S.far=N+V,S.mask=P,S.object=I))}});for(O=0;O<k.length;O++){const I=k.data[O];g.within(L,I.near)&&g.within(L,I.far)||(r.far=I.far,r.near=Infinity,K=b.isSome(I.object.offsetObb)?I.object.offsetObb:I.object.obb,0===q(K,R,w,P=>{var N=z;for(var V=0;4>V&&0<P.length;V++)if(0!==(I.mask&
1<<V)){{var S=M[V],T=P,H=N;H.length=0;const U=T.length-3;p(y,T,U);const W=d.signedDistance(S,y);0>=W&&(H.push(y[0]),H.push(y[1]),H.push(y[2]));let Q=0,X=W;for(Q;Q<U;Q+=3){p(f,T,Q);const ba=d.signedDistance(S,f);0>X*ba&&(m.lerp(y,f,y,ba/(ba-X)),t(H,y));0>=ba&&t(H,f);X=ba;m.copy(y,f)}0>X*W&&(p(f,T,U),m.lerp(y,f,y,W/(W-X)),t(H,y))}S=P;P=N;N=S}for(N=0;N<P.length;N+=3)m.set(y,P.data[N+0],P.data[N+1],P.data[N+2]),V=m.dot(m.sub(y,y,R),J),r.near=Math.min(r.near,V)})&&(r.near=0),g.union(L,r))}k.length=0;return L};
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/depthRange":function(){define(["exports"],function(a){function b(n,l){return{near:n,far:l}}function c(n,l,u){n.near=l;n.far=u;return n}a.ZERO={near:0,far:0};a.create=b;a.empty=function(n){return n?c(n,Infinity,-Infinity):b(Infinity,-Infinity)};a.set=c;a.union=function(n,l,u=n){u.near=Math.min(n.near,l.near);u.far=Math.max(n.far,l.far);return u};a.within=function(n,l){return n.near<=
l&&l<=n.far};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/SourceGeometry":function(){define(["exports","../../../support/buffer/InterleavedLayout","../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl","../../lib/VertexAttribute"],function(a,b,c,n){a.createVertexBufferLayout=function(l){const u=b.newLayout().vec3f(n.VertexAttribute.POSITION);l.normals&&u.vec2i16(n.VertexAttribute.NORMALCOMPRESSED,
{glNormalized:!0});l.textureCoordinates===c.TextureCoordinateAttributeType.Default?u.vec2f(n.VertexAttribute.UV0):l.textureCoordinates===c.TextureCoordinateAttributeType.Atlas&&(u.vec2f(n.VertexAttribute.UV0),u.vec4u16(n.VertexAttribute.UVREGION,{glNormalized:!0}));l.colors&&u.vec4u8(n.VertexAttribute.COLOR,{glNormalized:!0});return u.alignTo(4)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentMaterial":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ../../../../../../core/maybe ../../../../../../chunks/mat3 ../../../../../../chunks/mat3f32 ../../../../../../chunks/vec3 ../../../../../../chunks/vec3f32 ../../../../../../chunks/vec4 ../../../../../../chunks/vec4f32 ../../../../layers/support/symbolColorUtils ../../../../terrain/interfaces ./ComponentTechnique ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/material/MaterialBase ../../../core/renderPasses/AllRenderPasses ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/AlphaCutoff ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/util/TwoVectorPosition ../../../lib/basicInterfaces".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E){function F(R){switch(R){case f.MaterialSubPass.Color:return w.ShaderOutput.Color;case f.MaterialSubPass.Alpha:return w.ShaderOutput.Alpha;case f.MaterialSubPass.Depth:return w.ShaderOutput.Depth;case f.MaterialSubPass.Normal:return w.ShaderOutput.Normal}}let G=function(R){function M(I,P){var N=R.call(this)||this;N.toMapSpace=P;N.baseColor=d.fromValues(1,1,1,1);N.usePBR=!1;N.hasParametersFromSource=!1;N.mrrFactors=m.fromValues(1,1,.5);
N.emissiveFactor=m.fromValues(0,0,0);N.baseColorTexture=null;N.metallicRoughnessTexture=null;N.emissionTexture=null;N.occlusionTexture=null;N.normalTexture=null;N.objectOpacity=1;N.commonMaterialParameters=new K;N.componentParameters=new L;N.textureAlphaCutoff=B.defaultMaskAlphaCutoff;N.alphaDiscardMode=E.AlphaDiscardMode.Opaque;N.isIntegratedMesh=!1;N.polygonOffsetEnabled=!1;N.ellipsoidMode=C.EllipsoidMode.Earth;N.hasOccludees=!1;N._techniqueConfiguration=new t.ComponentTechniqueConfiguration;P=
new D.TwoVectorPosition(I.position);const V=u.clone(I.rotationScale);l.invert(V,V);N.transformNormalGlobalFromModel=l.transpose(V,V);N.transformWorldFromModelTL=P.low;N.transformWorldFromModelTH=P.high;N.transformWorldFromModelRS=I.rotationScale;return N}b._inheritsLoose(M,R);var J=M.prototype;J.dispose=function(){this._technique=n.releaseMaybe(this._technique);this.normalTexture=this.occlusionTexture=this.emissionTexture=this.metallicRoughnessTexture=this.baseColorTexture=null};J.prepareTechnique=
function(I,P,N,V){const S=this._techniqueConfiguration;S.hasVertexColors=V.colors;S.hasNormals=V.normals;S.textureCoordinateType=V.textureCoordinates;S.hasMetalnessAndRoughnessTexture=n.isSome(this.metallicRoughnessTexture);S.hasEmissionTexture=n.isSome(this.emissionTexture);S.hasOcclusionTexture=n.isSome(this.occlusionTexture);S.hasNormalTexture=n.isSome(this.normalTexture);S.transparencyPassType=P.identifier===f.RenderPassIdentifier.Material&&null!=N.transparencyPassType?N.transparencyPassType:
E.TransparencyPassType.NONE;S.hasMultipassTerrain=P.identifier===f.RenderPassIdentifier.Material&&null!=N.multipassTerrain?N.multipassTerrain.enabled:!1;S.cullAboveGround=P.identifier===f.RenderPassIdentifier.Material&&null!=N.multipassTerrain?N.multipassTerrain.cullAboveGround:!1;S.ellipsoidMode=this.ellipsoidMode;S.componentData=this.componentParameters.type;S.cullFace=this.commonMaterialParameters.cullFace;S.doubleSidedMode=this.commonMaterialParameters.doubleSided?A.NormalsDoubleSidedMode.View:
A.NormalsDoubleSidedMode.None;S.hasBaseColorTexture=n.isSome(this.baseColorTexture);V=this._computeWhichMaterialPass();S.blendingEnabled=V===O.Transparent||V===O.OpaqueAndTransparent;S.alphaDiscardMode=this.alphaDiscardMode;S.integratedMeshMode=this.isIntegratedMesh?(0===N.overlays.length?0:n.isSome(N.overlays[g.OverlayIndex.INNER].getColorTextureNoRasterImage()))?k.getOverlayNormalTexture(N)?t.IntegratedMeshMode.ColorOverlayWithWater:t.IntegratedMeshMode.ColorOverlay:t.IntegratedMeshMode.NoOverlay:
t.IntegratedMeshMode.None;S.isGround=this.isIntegratedMesh;S.hasPolygonOffset=this.polygonOffsetEnabled;V=this.hasParametersFromSource&&n.isNone(this.baseColorTexture);S.pbrMode=S.integratedMeshMode===t.IntegratedMeshMode.ColorOverlayWithWater?x.PBRMode.WaterOnIntegratedMesh:this.usePBR?V?x.PBRMode.Schematic:x.PBRMode.Normal:x.PBRMode.Disabled;S.normalType=S.integratedMeshMode===t.IntegratedMeshMode.None?S.hasNormals?z.NormalAttributeType.CompressedAttribute:z.NormalAttributeType.ScreenDerivative:
z.NormalAttributeType.Ground;S.hasSlicePlane=n.isSome(N.slicePlane)&&this.commonMaterialParameters.hasSlicePlane;P.identifier===f.RenderPassIdentifier.ShadowMap?(S.output=w.ShaderOutput.Shadow,S.vertexDiscardMode=r.VertexDiscardMode.None):P.identifier===f.RenderPassIdentifier.Highlight?(S.output=w.ShaderOutput.Highlight,S.vertexDiscardMode=r.VertexDiscardMode.None):(this._computeWhichMaterialPass()===O.OpaqueAndTransparent?S.vertexDiscardMode=P.transparent?r.VertexDiscardMode.Opaque:r.VertexDiscardMode.Transparent:
S.vertexDiscardMode=r.VertexDiscardMode.None,S.output=F(P.subPass),P.subPass===f.MaterialSubPass.Alpha&&(S.hasOccludees=N.hasOccludees),P.subPass===f.MaterialSubPass.Color?(S.receiveAmbientOcclusion=N.ssaoHelper.ready,S.hasOccludees=N.hasOccludees,S.receiveShadows=N.shadowMap.ready,S.hasScreenSpaceReflections=N.ssr.enabled,S.hasCloudsReflections=n.isSome(N.clouds.data)):(S.receiveAmbientOcclusion=!1,S.receiveShadows=!1),S.snowCover=this.hasSnowCover(N));this._technique=I.releaseAndAcquire(p.ComponentTechnique,
S,this._technique);this._setClean();return this._technique};J.hasSnowCover=function(I){return n.isSome(I.weather)&&I.weatherVisible&&"snowy"===I.weather.type&&"enabled"===I.weather.snowCover};J.submit=function(I,P,N){if(0!==this.objectOpacity){var V=N.renderable.geometry,S=N.components;N=N.renderable.meta.cameraDepthSquared;var T=S.geometryRanges,H=S.highlightRanges;S=S.defaultShadowMapRanges;switch(this._computeWhichMaterialPass()){case O.Opaque:I.materialOpaque.submitDraw(this,V,T,N);break;case O.Transparent:I.materialTransparent.submitDraw(this,
V,T,N);break;case O.OpaqueAndTransparent:I.materialOpaque.submitDraw(this,V,T,N);I.materialTransparent.submitDraw(this,V,T,N);break;case O.IntegratedMesh:I.materialIntegratedMesh.submitDraw(this,V,T,N),(0===P.overlays.length?0:n.isSome(P.overlays[g.OverlayIndex.INNER].getValidTexture(g.RenderTargetType.Highlight)))&&I.highlightIntegratedMesh.submitDraw(this,V,T,N)}(P=this.componentParameters.castShadows!==a.ComponentParameterSummary.None)&&I.shadowMap.submitDraw(this,V,T,N);n.isSome(H)&&(I.highlight.submitDraw(this,
V,H,N),P&&I.highlightShadowMap.submitDraw(this,V,H,N));P&&n.isSome(S)&&I.defaultShadowMap.submitDraw(this,V,S,N)}};J._computeWhichMaterialPass=function(){return this.isIntegratedMesh?O.IntegratedMesh:1>this.objectOpacity?O.Transparent:this.componentParameters.opaqueOverride===a.ComponentParameterSummary.All?O.Opaque:1>this.baseColor[3]||this.alphaDiscardMode===E.AlphaDiscardMode.Blend||this.alphaDiscardMode===E.AlphaDiscardMode.MaskBlend?O.Transparent:this.componentParameters.transparent===a.ComponentParameterSummary.None?
O.Opaque:this.componentParameters.transparent===a.ComponentParameterSummary.All?O.Transparent:O.OpaqueAndTransparent};b._createClass(M,[{key:"texture",get:function(){return n.isSome(this.baseColorTexture)?this.baseColorTexture.glTexture:null}},{key:"textureMetallicRoughness",get:function(){return n.isSome(this.metallicRoughnessTexture)?this.metallicRoughnessTexture.glTexture:null}},{key:"textureEmissive",get:function(){return n.isSome(this.emissionTexture)?this.emissionTexture.glTexture:null}},{key:"textureOcclusion",
get:function(){return n.isSome(this.occlusionTexture)?this.occlusionTexture.glTexture:null}},{key:"textureNormal",get:function(){return n.isSome(this.normalTexture)?this.normalTexture.glTexture:null}},{key:"attributeLocations",get:function(){return k.attributeLocations}}]);return M}(y.MaterialBase);c.__decorate([y.parameter({vectorOps:h.vec4})],G.prototype,"baseColor",void 0);c.__decorate([y.parameter()],G.prototype,"usePBR",void 0);c.__decorate([y.parameter()],G.prototype,"hasParametersFromSource",
void 0);c.__decorate([y.parameter({vectorOps:v.vec3})],G.prototype,"mrrFactors",void 0);c.__decorate([y.parameter({vectorOps:v.vec3})],G.prototype,"emissiveFactor",void 0);c.__decorate([y.parameter({dispose:!0})],G.prototype,"baseColorTexture",void 0);c.__decorate([y.parameter({dispose:!0})],G.prototype,"metallicRoughnessTexture",void 0);c.__decorate([y.parameter({dispose:!0})],G.prototype,"emissionTexture",void 0);c.__decorate([y.parameter({dispose:!0})],G.prototype,"occlusionTexture",void 0);c.__decorate([y.parameter({dispose:!0})],
G.prototype,"normalTexture",void 0);c.__decorate([y.parameter()],G.prototype,"objectOpacity",void 0);c.__decorate([y.parameterBlock()],G.prototype,"commonMaterialParameters",void 0);c.__decorate([y.parameterBlock()],G.prototype,"componentParameters",void 0);c.__decorate([y.parameter()],G.prototype,"textureAlphaCutoff",void 0);c.__decorate([y.parameter()],G.prototype,"alphaDiscardMode",void 0);c.__decorate([y.parameter()],G.prototype,"isIntegratedMesh",void 0);c.__decorate([y.parameter()],G.prototype,
"polygonOffsetEnabled",void 0);c.__decorate([y.parameter()],G.prototype,"ellipsoidMode",void 0);c.__decorate([y.parameter()],G.prototype,"hasOccludees",void 0);a.ShadingNormalSource=void 0;(function(R){R[R.VERTEX=0]="VERTEX";R[R.GROUND=1]="GROUND";R[R.SCREEN_DERIVATIVE=2]="SCREEN_DERIVATIVE"})(a.ShadingNormalSource||(a.ShadingNormalSource={}));var O;(function(R){R[R.Opaque=0]="Opaque";R[R.Transparent=1]="Transparent";R[R.OpaqueAndTransparent=2]="OpaqueAndTransparent";R[R.IntegratedMesh=3]="IntegratedMesh"})(O||
(O={}));let K=function(R){function M(){var J=R.apply(this,arguments)||this;J.doubleSided=!1;J.cullFace=E.CullFaceOptions.Back;J.hasSlicePlane=!0;return J}b._inheritsLoose(M,R);return M}(y.MaterialParameterBlock);c.__decorate([y.parameter()],K.prototype,"doubleSided",void 0);c.__decorate([y.parameter()],K.prototype,"cullFace",void 0);c.__decorate([y.parameter()],K.prototype,"hasSlicePlane",void 0);let L=function(R){function M(){var J=R.apply(this,arguments)||this;J.externalColor=d.fromValues(1,1,1,
1);J.externalColorMixMode=e.ColorMixModeEnum.Multiply;J.castShadows=a.ComponentParameterSummary.All;return J}b._inheritsLoose(M,R);b._createClass(M,[{key:"transparent",get:function(){return 1>this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"opaqueOverride",get:function(){return this.externalColorMixMode===e.ColorMixModeEnum.Replace&&1===this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"visible",get:function(){return 0<
this.externalColor[3]?a.ComponentParameterSummary.All:a.ComponentParameterSummary.None}},{key:"type",get:function(){return q.ComponentDataType.Uniform}}]);return M}(y.MaterialParameterBlock);c.__decorate([y.parameter({vectorOps:h.vec4})],L.prototype,"externalColor",void 0);c.__decorate([y.parameter()],L.prototype,"externalColorMixMode",void 0);c.__decorate([y.parameter()],L.prototype,"castShadows",void 0);a.ComponentParameterSummary=void 0;(function(R){R[R.All=0]="All";R[R.Some=1]="Some";R[R.None=
2]="None"})(a.ComponentParameterSummary||(a.ComponentParameterSummary={}));v=function(R){function M(){var J=R.apply(this,arguments)||this;J.texture=null;J.transparent=a.ComponentParameterSummary.None;J.opaqueOverride=a.ComponentParameterSummary.None;J.castShadows=a.ComponentParameterSummary.None;return J}b._inheritsLoose(M,R);b._createClass(M,[{key:"type",get:function(){return q.ComponentDataType.Varying}}]);return M}(y.MaterialParameterBlock);c.__decorate([y.parameter()],v.prototype,"texture",void 0);
c.__decorate([y.parameter()],v.prototype,"transparent",void 0);c.__decorate([y.parameter()],v.prototype,"opaqueOverride",void 0);c.__decorate([y.parameter()],v.prototype,"castShadows",void 0);a.CommonMaterialParameters=K;a.ComponentMaterial=G;a.ComponentParametersUniform=L;a.ComponentParametersVarying=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechnique":function(){define("require exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../ViewingMode ./ComponentTechniqueConfiguration ./shader/ComponentData.glsl ../../../../../../chunks/ComponentShader.glsl ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderTechnique/ReloadableShaderModule ../../../core/shaderTechnique/ShaderTechnique ../../../lib/basicInterfaces ../../../lib/OrderIndependentTransparency ../../../lib/Program ../../../lib/StencilUtils ../../../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){e=function(r){function y(){return r.apply(this,arguments)||this}c._inheritsLoose(y,r);var f=y.prototype;f.bindDraw=function(w,z){const A=this.program;A.bindDraw(w,z);A.rebindTextures();w.componentParameters.type===u.ComponentDataType.Varying&&w.componentParameters.texture.bind(A,"componentColorTex","componentColorTexInvDim")};f.initializeConfiguration=function(w,z){z.spherical=w.viewingMode===n.ViewingMode.Global;z.doublePrecisionRequiresObfuscation=h.doublePrecisionRequiresObfuscation(w.rctx)};
f.initializeProgram=function(w){const z=y.shader.get(),A=z.build(this.configuration);return new t.Program(w.rctx,A,z.attributeLocations)};f._setPipelineState=function(w){const z=this.configuration,A=z.integratedMeshMode!==l.IntegratedMeshMode.None,x=w===g.TransparencyPassType.NONE,B=w===g.TransparencyPassType.FrontFace;return k.makePipelineState({blending:z.output!==m.ShaderOutput.Color&&z.output!==m.ShaderOutput.Alpha||!z.blendingEnabled?null:x?p.blendingDefault:p.oitBlending(w),culling:k.cullingParams(z.cullFace),
depthTest:{func:p.oitDepthTest(w)},depthWrite:x||B?k.defaultDepthWriteParams:null,colorWrite:k.defaultColorWriteParams,stencilWrite:A||z.hasOccludees?q.stencilWriteMaskOn:null,stencilTest:A?q.replaceBitWhenDepthTestPasses(g.StencilBits.IntegratedMeshMaskExcluded):z.hasOccludees?q.stencilBaseAllZerosParams:null,polygonOffset:x||B?z.hasPolygonOffset?{factor:2,units:2}:null:p.OITPolygonOffset})};f.initializePipeline=function(){return this._setPipelineState(this.configuration.transparencyPassType)};return y}(e.ShaderTechnique);
e.shader=new d.ReloadableShaderModule(v.ComponentShader,()=>new Promise((r,y)=>a(["./shader/ComponentShader.glsl"],r,y)));b.ComponentTechnique=e;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration":function(){define("exports ../../../../../../chunks/_rollupPluginBabelHelpers ../../../../../../chunks/tslib.es6 ./shader/ComponentData.glsl ./shader/VertexDiscardByOpacity.glsl ../../../core/shaderLibrary/ShaderOutputOptions ../../../core/shaderLibrary/attributes/NormalAttribute.glsl ../../../core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../../../core/shaderLibrary/shading/Normals.glsl ../../../core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../../../core/shaderLibrary/util/EllipsoidMode ../../../core/shaderTechnique/BindType ../../../core/shaderTechnique/ShaderTechniqueConfiguration ../../../lib/basicInterfaces".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){a.PassDiscardMode=void 0;(function(k){k[k.None=0]="None";k[k.Transparent=1]="Transparent";k[k.Opaque=2]="Opaque";k[k.COUNT=3]="COUNT"})(a.PassDiscardMode||(a.PassDiscardMode={}));a.IntegratedMeshMode=void 0;(function(k){k[k.None=0]="None";k[k.NoOverlay=1]="NoOverlay";k[k.ColorOverlay=2]="ColorOverlay";k[k.ColorOverlayWithWater=3]="ColorOverlayWithWater";k[k.COUNT=4]="COUNT"})(a.IntegratedMeshMode||(a.IntegratedMeshMode={}));let q=function(k){function r(){var y=
k.apply(this,arguments)||this;y.output=u.ShaderOutput.Color;y.textureCoordinateType=m.TextureCoordinateAttributeType.None;y.componentData=n.ComponentDataType.Uniform;y.cullFace=t.CullFaceOptions.Back;y.vertexDiscardMode=l.VertexDiscardMode.None;y.doubleSidedMode=h.NormalsDoubleSidedMode.WindingOrder;y.alphaDiscardMode=t.AlphaDiscardMode.Opaque;y.integratedMeshMode=a.IntegratedMeshMode.None;y.transparencyPassType=t.TransparencyPassType.NONE;y.ellipsoidMode=e.EllipsoidMode.Earth;y.pbrMode=d.PBRMode.Disabled;
y.normalType=v.NormalAttributeType.Attribute;y.spherical=!1;y.doublePrecisionRequiresObfuscation=!1;y.hasVertexColors=!1;y.hasNormals=!1;y.hasSlicePlane=!1;y.hasBaseColorTexture=!1;y.receiveAmbientOcclusion=!0;y.receiveShadows=!0;y.blendingEnabled=!0;y.hasScreenSpaceReflections=!1;y.hasPolygonOffset=!1;y.hasMetalnessAndRoughnessTexture=!1;y.hasEmissionTexture=!1;y.hasOcclusionTexture=!1;y.hasNormalTexture=!1;y.hasOccludees=!1;y.hasMultipassTerrain=!1;y.cullAboveGround=!1;y.isGround=!1;y.hasCloudsReflections=
!0;y.snowCover=!1;return y}b._inheritsLoose(r,k);return r}(p.ShaderTechniqueConfiguration);c.__decorate([p.parameter({count:u.ShaderOutput.COUNT})],q.prototype,"output",void 0);c.__decorate([p.parameter({count:m.TextureCoordinateAttributeType.COUNT})],q.prototype,"textureCoordinateType",void 0);c.__decorate([p.parameter({count:n.ComponentDataType.COUNT})],q.prototype,"componentData",void 0);c.__decorate([p.parameter({count:t.CullFaceOptions.COUNT})],q.prototype,"cullFace",void 0);c.__decorate([p.parameter({count:l.VertexDiscardMode.COUNT})],
q.prototype,"vertexDiscardMode",void 0);c.__decorate([p.parameter({count:h.NormalsDoubleSidedMode.COUNT})],q.prototype,"doubleSidedMode",void 0);c.__decorate([p.parameter({count:t.AlphaDiscardMode.COUNT})],q.prototype,"alphaDiscardMode",void 0);c.__decorate([p.parameter({count:a.IntegratedMeshMode.COUNT})],q.prototype,"integratedMeshMode",void 0);c.__decorate([p.parameter({count:t.TransparencyPassType.COUNT})],q.prototype,"transparencyPassType",void 0);c.__decorate([p.parameter({count:e.EllipsoidMode.COUNT})],
q.prototype,"ellipsoidMode",void 0);c.__decorate([p.parameter({count:d.PBRMode.COUNT})],q.prototype,"pbrMode",void 0);c.__decorate([p.parameter({count:v.NormalAttributeType.COUNT})],q.prototype,"normalType",void 0);c.__decorate([p.parameter()],q.prototype,"spherical",void 0);c.__decorate([p.parameter()],q.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([p.parameter()],q.prototype,"hasVertexColors",void 0);c.__decorate([p.parameter()],q.prototype,"hasNormals",void 0);c.__decorate([p.parameter()],
q.prototype,"hasSlicePlane",void 0);c.__decorate([p.parameter()],q.prototype,"hasBaseColorTexture",void 0);c.__decorate([p.parameter()],q.prototype,"receiveAmbientOcclusion",void 0);c.__decorate([p.parameter()],q.prototype,"receiveShadows",void 0);c.__decorate([p.parameter()],q.prototype,"blendingEnabled",void 0);c.__decorate([p.parameter()],q.prototype,"hasScreenSpaceReflections",void 0);c.__decorate([p.parameter()],q.prototype,"hasPolygonOffset",void 0);c.__decorate([p.parameter()],q.prototype,
"hasMetalnessAndRoughnessTexture",void 0);c.__decorate([p.parameter()],q.prototype,"hasEmissionTexture",void 0);c.__decorate([p.parameter()],q.prototype,"hasOcclusionTexture",void 0);c.__decorate([p.parameter()],q.prototype,"hasNormalTexture",void 0);c.__decorate([p.parameter()],q.prototype,"hasOccludees",void 0);c.__decorate([p.parameter()],q.prototype,"hasMultipassTerrain",void 0);c.__decorate([p.parameter()],q.prototype,"cullAboveGround",void 0);c.__decorate([p.parameter()],q.prototype,"isGround",
void 0);c.__decorate([p.parameter()],q.prototype,"hasCloudsReflections",void 0);c.__decorate([p.parameter()],q.prototype,"snowCover",void 0);c.__decorate([p.parameter({constValue:g.BindType.Draw})],q.prototype,"pbrTextureBindType",void 0);c.__decorate([p.parameter({constValue:!0})],q.prototype,"hasSliceHighlight",void 0);c.__decorate([p.parameter({constValue:!1})],q.prototype,"hasSliceInVertexProgram",void 0);c.__decorate([p.parameter({constValue:!1})],q.prototype,"useCustomDTRExponentForWater",void 0);
c.__decorate([p.parameter({constValue:!1})],q.prototype,"hasVertexTangents",void 0);c.__decorate([p.parameter({constValue:!0})],q.prototype,"supportsTextureAtlas",void 0);c.__decorate([p.parameter({constValue:!1})],q.prototype,"highStepCount",void 0);c.__decorate([p.parameter({constValue:!1})],q.prototype,"instancedDoublePrecision",void 0);c.__decorate([p.parameter({constValue:!0})],q.prototype,"useFillLights",void 0);a.ComponentTechniqueConfiguration=q;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl":function(){define("exports ../../../../../../../core/compilerUtils ../../../../../../../core/floatRGBA ./DecodeSymbolColor.glsl ../../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../../core/shaderModules/Float2Uniform ../../../../core/shaderModules/Float4DrawUniform ../../../../core/shaderModules/IntegerDrawUniform ../../../../core/shaderModules/interfaces ../../../../core/shaderModules/Texture2DUniform ../../../../lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){function g(t){const {vertex:q,fragment:k}=t;q.uniforms.add(new v.Float4DrawUniform("externalColor",r=>r.componentParameters.externalColor));k.uniforms.add(new m.IntegerDrawUniform("externalColorMixMode",r=>r.componentParameters.externalColorMixMode));t.varyings.add("vExternalColor","vec4");q.code.add(h.glsl`float readElevationOffset() {
return 0.0;
}
vec4 forwardExternalColor(out bool castShadows) {
vExternalColor = externalColor;
castShadows = true;
return externalColor;
}`);k.code.add(h.glsl`void readExternalColor(out vec4 color, out int colorMixMode) {
color = vExternalColor;
colorMixMode = externalColorMixMode;
}`)}a.ComponentDataType=void 0;(function(t){t[t.Uniform=0]="Uniform";t[t.Varying=1]="Varying";t[t.COUNT=2]="COUNT"})(a.ComponentDataType||(a.ComponentDataType={}));const p=2**32/1E4;a.ComponentData=function(t,q){switch(q.componentData){case a.ComponentDataType.Varying:{const {vertex:k,fragment:r}=t;k.include(l.RgbaFloatEncoding);k.uniforms.add([new d.Texture2DUniform("componentColorTex"),new u.Float2Uniform("componentColorTexInvDim")]);t.attributes.add(e.VertexAttribute.COMPONENTINDEX,"float");t.varyings.add("vExternalColorMixMode",
"mediump float");t.varyings.add("vExternalColor","vec4");t.include(n.DecodeSymbolColor);k.constants.add("elevationScale","float",2*p);k.code.add(h.glsl`vec4 _readComponentColor() {
float normalizedIndex = (componentIndex * 2.0 + 0.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return texture2D(componentColorTex, indexCoord);
}
float readElevationOffset() {
float normalizedIndex = (componentIndex * 2.0 + 1.5) * componentColorTexInvDim.x;
vec2 indexCoord = vec2(
mod(normalizedIndex, 1.0),
(floor(normalizedIndex) + 0.5) * componentColorTexInvDim.y
);
return (rgba2float(texture2D(componentColorTex, indexCoord)) - 0.5) * elevationScale;
}
vec4 forwardExternalColor(out bool castShadows) {
vec4 componentColor = _readComponentColor() * 255.0;
float shadowFlag = mod(componentColor.b * 255.0, 2.0);
componentColor.b -= shadowFlag;
castShadows = shadowFlag >= 1.0;
int decodedColorMixMode;
vExternalColor = decodeSymbolColor(componentColor, decodedColorMixMode) * 0.003921568627451;
vExternalColorMixMode = float(decodedColorMixMode) + 0.5;
return vExternalColor;
}`);r.code.add(h.glsl`void readExternalColor(out vec4 externalColor, out int externalColorMixMode) {
externalColor = vExternalColor;
externalColorMixMode = int(vExternalColorMixMode);
}`)}break;case a.ComponentDataType.Uniform:return g(t);case a.ComponentDataType.COUNT:break;default:b.neverReached(q.componentData)}};a.MAX_ELEVATION_OFFSET=p;a.encodeElevationOffset=function(t,q){c.packFloatRGBA(t/p*.5+.5,q)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderModules/IntegerDrawUniform":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","./Uniform","../shaderTechnique/BindType"],
function(a,b,c,n){c=function(l){function u(v,m){return l.call(this,v,"int",n.BindType.Draw,(h,d,e)=>h.setUniform1i(v,m(d,e)))||this}b._inheritsLoose(u,l);return u}(c.Uniform);a.IntegerDrawUniform=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl":function(){define(["exports","../../../../core/shaderModules/interfaces"],function(a,b){a.VertexDiscardMode=void 0;(function(c){c[c.None=
0]="None";c[c.Transparent=1]="Transparent";c[c.Opaque=2]="Opaque";c[c.COUNT=3]="COUNT"})(a.VertexDiscardMode||(a.VertexDiscardMode={}));a.VertexDiscardByOpacity=function(c,n){c=c.vertex;c.code.add(b.glsl`#define VERTEX_DISCARD_CUTOFF (1.0 - 1.0 / 255.0)`);switch(n.vertexDiscardMode){case a.VertexDiscardMode.None:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) {}`);break;case a.VertexDiscardMode.Opaque:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ >  VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`);
break;case a.VertexDiscardMode.Transparent:c.code.add(b.glsl`#define vertexDiscardByOpacity(_opacity_) { if (_opacity_ <= VERTEX_DISCARD_CUTOFF) {  gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode":function(){define(["exports","../../../../../../geometry/support/spatialReferenceUtils"],function(a,b){a.EllipsoidMode=void 0;(function(c){c[c.Earth=
1]="Earth";c[c.Mars=2]="Mars";c[c.Moon=3]="Moon";c[c.COUNT=4]="COUNT"})(a.EllipsoidMode||(a.EllipsoidMode={}));a.getEllipsoidMode=function(c){return c&&b.isMars(c)?a.EllipsoidMode.Mars:c&&b.isMoon(c)?a.EllipsoidMode.Moon:a.EllipsoidMode.Earth};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ComponentShader.glsl":function(){define("exports ../geometry/support/Ellipsoid ../views/3d/terrain/interfaces ../views/3d/webgl-engine/collections/Component/Material/ComponentTechniqueConfiguration ../views/3d/webgl-engine/collections/Component/Material/shader/ComponentData.glsl ../views/3d/webgl-engine/collections/Component/Material/shader/VertexDiscardByOpacity.glsl ../views/3d/webgl-engine/core/shaderLibrary/ForwardLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/ShaderOutputOptions ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/NormalAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/TextureCoordinateAttribute.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/attributes/VertexPosition.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeNormalTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/EvaluateSceneLighting.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/PhysicallyBasedRenderingParameters.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/terrain/Overlay.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaCutoff ../views/3d/webgl-engine/core/shaderLibrary/util/AlphaDiscard.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/EllipsoidMode ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/basicInterfaces ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P){function N(T){const H=new M.ShaderBuilder;H.include(t.VertexPosition,T);H.include(p.VertexNormal,T);H.include(g.VertexColor,T);H.include(e.TextureCoordinateAttribute,T);H.include(v.ForwardLinearDepth,T);H.include(l.ComponentData,T);H.include(F.DiscardOrAdjustAlphaDraw,T);H.include(h.SlicePass,T);H.include(B.ReadBaseColorTexture,T);H.include(u.VertexDiscardByOpacity,T);const {vertex:U,fragment:W}=H;W.uniforms.add(new R.Matrix4Uniform("view"));
if(T.pbrMode===x.PBRMode.Normal||T.pbrMode===x.PBRMode.Schematic)H.include(x.PhysicallyBasedRenderingParameters,T),T.hasNormalTexture&&H.include(f.ComputeNormalTexture,T);T.output===m.ShaderOutput.Shadow&&T.componentData===l.ComponentDataType.Varying?U.code.add(L.glsl`#define discardShadows(castShadows) { if(!castShadows) { gl_Position = vec4(1e38, 1e38, 1e38, 1.0); return; } }`):U.code.add(L.glsl`#define discardShadows(castShadows) {}`);const Q=T.integratedMeshMode===n.IntegratedMeshMode.ColorOverlay||
T.integratedMeshMode===n.IntegratedMeshMode.ColorOverlayWithWater,X=Q&&T.output===m.ShaderOutput.Color&&T.pbrMode===x.PBRMode.WaterOnIntegratedMesh;Q&&(H.include(z.EvaluateSceneLighting,T),H.include(D.OverlayIM,T),T.spherical?U.code.add(L.glsl`
      const float invEllipsoidRadius = ${L.glsl.float(1/(T.ellipsoidMode===G.EllipsoidMode.Earth?b.earth.radius:T.ellipsoidMode===G.EllipsoidMode.Mars?b.mars.radius:b.moon.radius))};
      vec2 projectOverlay(vec3 pos) {
        return pos.xy / (1.0 + invEllipsoidRadius * pos.z);
      }
      `):U.code.add(L.glsl`vec2 projectOverlay(vec3 pos) { return pos.xy; }`));X&&(H.varyings.add("tbnTangent","vec3"),H.varyings.add("tbnBiTangent","vec3"),H.varyings.add("groundNormal","vec3"));U.code.add(L.glsl`
    void main() {
      bool castShadows;
      vec4 externalColor = forwardExternalColor(castShadows);
      discardShadows(castShadows);

      vertexDiscardByOpacity(externalColor.a);

      if (externalColor.a < ${L.glsl.float(E.symbolAlphaCutoff)}) {
        // Discard this vertex
        gl_Position = vec4(1e38, 1e38, 1e38, 1.0);
        return;
      }

      forwardPosition(readElevationOffset());
      forwardNormal();
      forwardTextureCoordinates();
      forwardVertexColor();
      forwardLinearDepth();
      ${X?T.spherical?L.glsl`
                groundNormal = normalize(positionWorld());
                tbnTangent = normalize(cross(vec3(0.0, 0.0, 1.0), groundNormal));
                tbnBiTangent = normalize(cross(groundNormal, tbnTangent));`:L.glsl`
                groundNormal = vec3(0.0, 0.0, 1.0);
                tbnTangent = vec3(1.0, 0.0, 0.0);
                tbnBiTangent = vec3(0.0, 1.0, 0.0);`:""}
      ${Q?L.glsl`setOverlayVTC(projectOverlay(position));`:""}
    }
  `);T.output===m.ShaderOutput.Alpha&&(W.include(r.ReadLinearDepth),H.include(A.multipassTerrainTest,T),H.include(y.ComputeMaterialColor,T),Q&&W.uniforms.add(new J.Texture2DPassUniform("ovColorTex",(ba,aa)=>D.getColorTexture(ba,aa))),W.code.add(L.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${T.hasMultipassTerrain?L.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Q?L.glsl`
                vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);
                materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        gl_FragColor = vec4(materialColor.a);
      }
    `));T.output===m.ShaderOutput.Color&&(W.include(r.ReadLinearDepth),H.include(A.multipassTerrainTest,T),H.include(y.ComputeMaterialColor,T),H.include(w.ComputeShadingNormal,T),H.include(z.EvaluateSceneLighting,T),T.receiveShadows?(H.include(C.ReadShadowMapPass,T),W.code.add(L.glsl`float evaluateShadow() {
return readShadowMap(vPositionWorldCameraRelative, linearDepth);
}`)):W.code.add(L.glsl`float evaluateShadow() { return 0.0; }`),Q&&W.uniforms.add(new J.Texture2DPassUniform("ovColorTex",(ba,aa)=>D.getColorTexture(ba,aa))),W.code.add(L.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);
        ${T.hasMultipassTerrain?L.glsl`terrainDepthTest(gl_FragCoord, vPosition_view.z);`:""}

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        vec4 externalColor;
        int externalColorMixMode;
        readExternalColor(externalColor, externalColorMixMode);

        vec4 materialColor = computeMaterialColor(
          textureColor,
          externalColor,
          externalColorMixMode
        );
        ${Q?L.glsl`vec4 overlayColor = getOverlayColor(ovColorTex, vtcOverlay);`:""}
    `),T.pbrMode===x.PBRMode.Normal||T.pbrMode===x.PBRMode.Schematic?(W.uniforms.add(new O.Float3PassUniform("lightingMainIntensity",(ba,aa)=>aa.lighting.mainLight.intensity)),W.code.add(L.glsl`
        ${T.pbrMode===x.PBRMode.Normal?L.glsl`
                applyPBRFactors();
                if (int(externalColorMixMode) == 3) {
                  mrr = vec3(0.0, 0.6, 0.2);
                }`:""}
        vec3 normalVertex = shadingNormalWorld();
        float additionalIrradiance = 0.02 * lightingMainIntensity[2];
      `),T.hasNormalTexture?W.code.add(L.glsl`mat3 tangentSpace = computeTangentSpace(normalVertex, vPositionWorldCameraRelative, vuv0);
vec3 shadingNormal = computeTextureNormal(tangentSpace, vuv0);`):W.code.add(L.glsl`vec3 shadingNormal = normalVertex;`),W.code.add(L.glsl`${T.spherical?L.glsl`vec3 normalGround = normalize(positionWorld());`:L.glsl`vec3 normalGround = vec3(0.0, 0.0, 1.0);`}
      `),W.code.add(L.glsl`
        vec3 viewDir = normalize(vPositionWorldCameraRelative);
        float ssao = 1.0 - occlusion * (1.0 - evaluateAmbientOcclusion());

        ${T.snowCover?L.glsl`
                vec3 surfaceNormal = normalize(shadingNormalWorld());
                float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
                materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);

                shadingNormal = mix(shadingNormal, surfaceNormal, snow);
                ssao = mix(ssao, 0.0, snow);
                mrr = mix(mrr, vec3(0.0, 1.0, 0.04), snow);
                emission = mix(emission, vec3(0.0), snow);`:""}

        ${Q?L.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec3 additionalLight = evaluateAdditionalLighting(ssao, positionWorld());
        vec4 shadedColor = vec4(evaluateSceneLightingPBR(shadingNormal, materialColor.rgb, evaluateShadow(), ssao, additionalLight, viewDir, normalGround, mrr, emission, additionalIrradiance), materialColor.a);
        `)):(T.receiveShadows?W.code.add(L.glsl`float shadow = evaluateShadow();`):T.spherical?(W.uniforms.add(new K.FloatPassUniform("lightingGlobalFactor",(ba,aa)=>aa.lighting.globalFactor)),W.code.add(L.glsl`float additionalAmbientScale = additionalDirectedAmbientLight(positionWorld());
float shadow = lightingGlobalFactor * (1.0 - additionalAmbientScale);`)):W.code.add(L.glsl`float shadow = 0.0;`),X&&W.uniforms.add(new J.Texture2DPassUniform("ovNormalTex",(ba,aa)=>V(aa))),T.snowCover&&(H.extensions.add("GL_OES_standard_derivatives"),W.code.add(L.glsl`vec3 surfaceNormal = normalize(cross(dFdx(vPositionWorldCameraRelative), dFdy(vPositionWorldCameraRelative)));
float snow = smoothstep(0.5, 0.55, dot(surfaceNormal, normalize(positionWorld())));
materialColor.rgb = mix(materialColor.rgb, vec3(1), snow);`)),W.code.add(L.glsl`
        float ambientOcclusion = evaluateAmbientOcclusion();
        vec3 additionalLight = evaluateAdditionalLighting(ambientOcclusion, positionWorld());

        ${Q?L.glsl` materialColor = materialColor * (1.0 - overlayColor.a) + overlayColor;`:""}

        vec4 shadedColor = vec4(evaluateSceneLighting(shadingNormalWorld(), materialColor.rgb, shadow, ambientOcclusion, additionalLight), materialColor.a);
      ${X?L.glsl`
              vec4 overlayWaterMask = getOverlayColor(ovNormalTex, vtcOverlay);
              float waterNormalLength = length(overlayWaterMask);
              if (waterNormalLength > 0.95) {
                mat3 tbnMatrix = mat3(tbnTangent, tbnBiTangent, groundNormal);
                vec4 waterColorLinear = getOverlayWaterColor(overlayWaterMask, overlayColor, -normalize(vPositionWorldCameraRelative), shadow, groundNormal, tbnMatrix, vPosition_view, positionWorld());
                vec4 waterColorNonLinear = delinearizeGamma(vec4(waterColorLinear.xyz, 1.0));
                // un-gamma the ground color to mix in linear space
                shadedColor = mix(shadedColor, waterColorNonLinear, waterColorLinear.w);
              }`:""}
      `)),W.code.add(L.glsl`
        gl_FragColor = highlightSlice(shadedColor, vPositionWorldCameraRelative);
        ${T.transparencyPassType===I.TransparencyPassType.Color?"gl_FragColor \x3d premultiplyAlpha(gl_FragColor);":""}
      }
    `));if(T.output===m.ShaderOutput.Depth||T.output===m.ShaderOutput.Shadow)H.include(q.OutputDepth,T),W.code.add(L.glsl`void main() {
discardBySlice(vPositionWorldCameraRelative);
vec4 textureColor = readBaseColorTexture();
discardOrAdjustAlpha(textureColor);
outputDepth(linearDepth);
}`);T.output===m.ShaderOutput.Normal&&(H.include(w.ComputeShadingNormal,T),W.code.add(L.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        // note: the alpha component needs to be 1.0 in order for this material
        // to influence ambient occlusion, see the ssao fragment shader
        float alpha = ${T.normalType===d.NormalAttributeType.Ground?"0.0":"1.0"};
        gl_FragColor = vec4(vec3(.5) + .5 * shadingNormal_view(), alpha);
      }
    `));T.output===m.ShaderOutput.Highlight&&(H.include(k.OutputHighlight),W.code.add(L.glsl`
      void main() {
        discardBySlice(vPositionWorldCameraRelative);

        vec4 textureColor = readBaseColorTexture();
        discardOrAdjustAlpha(textureColor);

        ${Q?L.glsl`
                vec4 overlayColor = getCombinedOverlayColor();
                if (overlayColor.a == 0.0) {
                  gl_FragColor = vec4(0.0);
                  return;
                }`:""}

        outputHighlight();
      }
    `));return H}function V(T){return 0===T.overlays.length?null:T.overlays[c.OverlayIndex.INNER].getValidTexture(c.RenderTargetType.Water)}P=new Map([[P.VertexAttribute.POSITION,0],[P.VertexAttribute.NORMAL,1],[P.VertexAttribute.NORMALCOMPRESSED,1],[P.VertexAttribute.COLOR,2],[P.VertexAttribute.UV0,3],[P.VertexAttribute.UVREGION,4],[P.VertexAttribute.COMPONENTINDEX,5]]);const S=Object.freeze(Object.defineProperty({__proto__:null,attributeLocations:P,build:N,getOverlayNormalTexture:V},Symbol.toStringTag,
{value:"Module"}));a.ComponentShader=S;a.attributeLocations=P;a.build=N;a.getOverlayNormalTexture=V})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeMaterialColor.glsl":function(){define("exports ../attributes/VertexColor.glsl ../util/MixExternalColor.glsl ../../shaderModules/Float4DrawUniform ../../shaderModules/FloatDrawUniform ../../shaderModules/interfaces".split(" "),function(a,b,c,n,l,u){a.ComputeMaterialColor=function(v,m){v.include(b.VertexColor,m);v.fragment.include(c.MixExternalColor);
v=v.fragment;v.uniforms.add(new n.Float4DrawUniform("baseColor",h=>h.baseColor));v.uniforms.add(new l.FloatDrawUniform("objectOpacity",h=>h.objectOpacity));m.hasVertexColors?v.code.add(u.glsl`vec3 _baseColor() {
return baseColor.rgb * vColor.rgb;
}
float _baseOpacity() {
return baseColor.a * vColor.a;
}`):v.code.add(u.glsl`vec3 _baseColor() {
return baseColor.rgb;
}
float _baseOpacity() {
return baseColor.a;
}`);v.code.add(u.glsl`vec4 computeMaterialColor(vec4 textureColor, vec4 externalColor, int externalColorMixMode) {
vec3 baseColor = _baseColor();
float baseOpacity = _baseOpacity();
vec3 color = mixExternalColor(
baseColor,
textureColor.rgb,
externalColor.rgb,
externalColorMixMode
);
float opacity = objectOpacity * mixExternalOpacity(
baseOpacity,
textureColor.a,
externalColor.a,
externalColorMixMode
);
return vec4(color, opacity);
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ComputeShadingNormal.glsl":function(){define("exports ../../../../../../core/compilerUtils ../attributes/NormalAttribute.glsl ../attributes/VertexNormal.glsl ../attributes/VertexPosition.glsl ./Normals.glsl ../../shaderModules/interfaces".split(" "),function(a,b,c,n,l,u,v){a.ComputeShadingNormal=function(m,h){const d=m.fragment;switch(h.doubleSidedMode){case u.NormalsDoubleSidedMode.None:d.code.add(v.glsl`vec3 _adjustDoublesided(vec3 normal) {
return normal;
}`);break;case u.NormalsDoubleSidedMode.View:m.include(l.VertexPosition,h);d.code.add(v.glsl`vec3 _adjustDoublesided(vec3 normal) {
return dot(normal, vPositionWorldCameraRelative) > 0.0 ? -normal : normal;
}`);break;case u.NormalsDoubleSidedMode.WindingOrder:d.code.add(v.glsl`vec3 _adjustDoublesided(vec3 normal) {
return gl_FrontFacing ? normal : -normal;
}`);break;default:b.neverReached(h.doubleSidedMode);case u.NormalsDoubleSidedMode.COUNT:}switch(h.normalType){case c.NormalAttributeType.Attribute:case c.NormalAttributeType.CompressedAttribute:m.include(n.VertexNormal,h);d.code.add(v.glsl`vec3 shadingNormalWorld() {
return _adjustDoublesided(normalize(vNormalWorld));
}
vec3 shadingNormal_view() {
vec3 normal = normalize(vNormalView);
return gl_FrontFacing ? normal : -normal;
}`);break;case c.NormalAttributeType.ScreenDerivative:m.extensions.add("GL_OES_standard_derivatives");m.include(l.VertexPosition,h);d.code.add(v.glsl`vec3 shadingNormalWorld() {
return normalize(cross(
dFdx(vPositionWorldCameraRelative),
dFdy(vPositionWorldCameraRelative)
));
}
vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view)));
}`);break;case c.NormalAttributeType.Ground:h.spherical?(m.include(l.VertexPosition,h),d.code.add(v.glsl`vec3 shadingNormalWorld() {
return normalize(positionWorld());
}`)):d.code.add(v.glsl`vec3 shadingNormalWorld() {
return vec3(0.0, 0.0, 1.0);
}`);m.extensions.add("GL_OES_standard_derivatives");d.code.add(v.glsl`vec3 shadingNormal_view() {
return normalize(cross(dFdx(vPosition_view),dFdy(vPosition_view))).xyz;
}`);break;default:b.neverReached(h.normalType);case c.NormalAttributeType.COUNT:}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/shading/ReadBaseColorTexture.glsl":function(){define("exports ../attributes/TextureCoordinateAttribute.glsl ../attributes/VertexTextureCoordinates.glsl ../util/TextureAtlasLookup.glsl ../../shaderModules/interfaces ../../shaderModules/Texture2DDrawUniform".split(" "),function(a,
b,c,n,l,u){a.ReadBaseColorTexture=function(v,m){const h=v.fragment;m.hasBaseColorTexture?(v.include(c.VertexTextureCoordinates,m),m=m.textureCoordinateType===b.TextureCoordinateAttributeType.Atlas,h.uniforms.add(u.createTexture2DDrawSizeUniforms("baseColorTexture",d=>d.texture,m)),m?(v.include(n.TextureAtlasLookup),h.code.add(l.glsl`vec4 readBaseColorTexture() {
return textureAtlasLookup(baseColorTexture, baseColorTextureSize, vuv0, vuvRegion);
}`)):h.code.add(l.glsl`vec4 readBaseColorTexture() {
return texture2D(baseColorTexture, vuv0);
}`)):h.code.add(l.glsl`vec4 readBaseColorTexture() { return vec4(1.0); }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/material/MaterialBase":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers","../shaderModules/interfaces"],function(a,b,c){c=function(l){function u(){var m=l.apply(this,arguments)||this;m._dirty=!0;return m}b._inheritsLoose(u,l);var v=u.prototype;v._setDirty=function(){this._dirty=
!0};v._setClean=function(){this._dirty=!1;if(null!=this._parameterBlocks)for(const m of this._parameterBlocks)this[m]._setClean()};v._checkParameterBlocksDirty=function(){if(null==this._parameterBlocks)return!1;for(const m of this._parameterBlocks)if(this[m].dirty)return!0;return!1};b._createClass(u,[{key:"dirty",get:function(){return this._dirty||this._checkParameterBlocksDirty()}}]);return u}(c.NoParameters);let n=function(){function l(){this._dirty=!0}var u=l.prototype;u._setDirty=function(){this._dirty=
!0};u._setClean=function(){this._dirty=!1};b._createClass(l,[{key:"dirty",get:function(){return this._dirty}}]);return l}();a.MaterialBase=c;a.MaterialParameterBlock=n;a.parameter=function(l={}){return(u,v)=>{var m;const h=null!=(m=u._parameterCount)?m:0;u._parameterCount=h+1;if(l.vectorOps){const d=l.vectorOps;Object.defineProperty(u,v,{get(){return this[h]},set(e){const g=this[h];if(null==g)this[h]=e;else{if(d.equals(g,e))return;d.copy(g,e)}this._setDirty()}})}else Object.defineProperty(u,v,{get(){return this[h]},
set(d){this[h]!==d&&(l.dispose&&this[h]&&this[h].dispose(),this[h]=d,this._setDirty())}})}};a.parameterBlock=function(){return(l,u)=>{var v;const m=null!=(v=l._parameterCount)?v:0;l._parameterCount=m+1;l._parameterBlocks=l._parameterBlocks||[];l._parameterBlocks.push(m);Object.defineProperty(l,u,{get(){return this[m]},set(h){this[m]!==h&&(this[m]=h,this._setDirty())}})}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/util/TwoVectorPosition":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/vec3","../../../../../chunks/vec3f32","../../../../../chunks/vec3f64"],function(a,b,c,n,l){let u=function(){function m(d){this._low=n.create();this._high=n.create();d&&this.set(d)}var h=m.prototype;h.set=function(d){const e=this._low,g=this._high;c.copy(e,d);c.sub(g,d,e)};h.setElements=function(d,e,g){c.set(v,d,e,g);this.set(v)};h.get=function(d){return c.add(d,this._low,this._high)};h.getLowScaled=function(d){return c.scale(d,
this._low,1)};b._createClass(m,[{key:"low",get:function(){return this._low}},{key:"high",get:function(){return this._high}}]);return m}();const v=l.create();a.TwoVectorPosition=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/bufferLayouts":function(){define(["exports","../../../support/buffer/glUtil","../../../support/buffer/InterleavedLayout","../VertexAttribute"],function(a,b,c,n){const l=c.newLayout().vec3f(n.VertexAttribute.POSITION).u16(n.VertexAttribute.COMPONENTINDEX).u16(n.VertexAttribute.U16PADDING),
u=c.newLayout().vec2u8(n.VertexAttribute.SIDENESS);b=b.glLayout(u);c=c.newLayout().vec3f(n.VertexAttribute.POSITION0).vec3f(n.VertexAttribute.POSITION1).u16(n.VertexAttribute.COMPONENTINDEX).u8(n.VertexAttribute.VARIANTOFFSET,{glNormalized:!0}).u8(n.VertexAttribute.VARIANTSTROKE).u8(n.VertexAttribute.VARIANTEXTENSION,{glNormalized:!0}).u8(n.VertexAttribute.U8PADDING,{glPadding:!0}).u16(n.VertexAttribute.U16PADDING,{glPadding:!0});const v=c.clone().vec3f(n.VertexAttribute.NORMAL),m=c.clone().vec3f(n.VertexAttribute.NORMALA).vec3f(n.VertexAttribute.NORMALB);
n=new Map([[n.VertexAttribute.POSITION0,0],[n.VertexAttribute.POSITION1,1],[n.VertexAttribute.COMPONENTINDEX,2],[n.VertexAttribute.VARIANTOFFSET,3],[n.VertexAttribute.VARIANTSTROKE,4],[n.VertexAttribute.VARIANTEXTENSION,5],[n.VertexAttribute.NORMAL,6],[n.VertexAttribute.NORMALA,6],[n.VertexAttribute.NORMALB,7],[n.VertexAttribute.SIDENESS,8]]);a.CommonInstancesLayout=c;a.EdgeInputBufferLayout=l;a.EdgeShaderAttributeLocations=n;a.RegularEdgeInstancesLayout=v;a.SilhouetteEdgeInstancesLayout=m;a.VertexLayout=
u;a.glVertexLayout=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeProcessingWorker":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../geometry/support/meshUtils/deduplicate ../../../support/meshProcessing ../../../support/buffer/InterleavedLayout ../../../support/buffer/workerHelper ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(x){const B=p(x.data,x.skipDeduplicate,x.indices,x.indicesLength);q.updateSettings(x.writerSettings);k.updateSettings(x.writerSettings);return d.extractEdges(B,q,k)}function g(x){return{data:m.EdgeInputBufferLayout.createView(x.dataBuffer),indices:"Uint32Array"===x.indicesType?new Uint32Array(x.indicesBuffer):"Uint16Array"===x.indicesType?new Uint16Array(x.indicesBuffer):void 0,indicesLength:x.indicesLength,writerSettings:x.writerSettings,skipDeduplicate:x.skipDeduplicate}}
function p(x,B,C,D){if(B)return B=n.computeNeighbors(C,D,x.count),{faces:C,facesLength:D,neighbors:B,vertices:x};x=c.deduplicate(x.buffer,x.stride/4,{originalIndices:C,originalIndicesLength:D});D=n.computeNeighbors(x.indices,D,x.uniqueCount);return{faces:x.indices,facesLength:x.indices.length,neighbors:D,vertices:m.EdgeInputBufferLayout.createView(x.buffer)}}let t=function(){function x(){}var B=x.prototype;B.extract=function(){var C=b._asyncToGenerator(function*(D){var E=g(D);D=e(E);E=[E.data.buffer];
E.push(D.regular.lodInfo.lengths.buffer);E.push(D.silhouette.lodInfo.lengths.buffer);return{result:{regular:{instancesData:u.packInterleavedBuffer(D.regular.instancesData,E),lodInfo:{lengths:D.regular.lodInfo.lengths.buffer}},silhouette:{instancesData:u.packInterleavedBuffer(D.silhouette.instancesData,E),lodInfo:{lengths:D.silhouette.lodInfo.lengths.buffer}},averageEdgeLength:D.averageEdgeLength},transferList:E}});return function(D){return C.apply(this,arguments)}}();B.extractComponentsEdgeLocations=
function(){var C=b._asyncToGenerator(function*(D){D=g(D);D=p(D.data,D.skipDeduplicate,D.indices,D.indicesLength);D=d.extractEdges(D,f,w);const E=[];return{result:u.packInterleavedBuffer(D.regular.instancesData,E),transferList:E}});return function(D){return C.apply(this,arguments)}}();B.extractEdgeLocations=function(){var C=b._asyncToGenerator(function*(D){D=g(D);D=p(D.data,D.skipDeduplicate,D.indices,D.indicesLength);D=d.extractEdges(D,y,w);const E=[];return{result:u.packInterleavedBuffer(D.regular.instancesData,
E),transferList:E}});return function(D){return C.apply(this,arguments)}}();return x}();const q=new h.RegularEdgeBufferWriter,k=new h.SilhouetteEdgeBufferWriter;h=function(){function x(){}var B=x.prototype;B.allocate=function(C){return z.createBuffer(C)};B.trim=function(C,D){return C.slice(0,D)};B.write=function(C,D,E){C.position0.setVec(D,E.position0);C.position1.setVec(D,E.position1)};return x}();let r=function(){function x(){}var B=x.prototype;B.allocate=function(C){return A.createBuffer(C)};B.trim=
function(C,D){return C.slice(0,D)};B.write=function(C,D,E){C.position0.setVec(D,E.position0);C.position1.setVec(D,E.position1);C.componentIndex.set(D,E.componentIndex)};return x}();const y=new h,f=new r,w={allocate:()=>null,write:()=>{},trim:()=>null},z=l.newLayout().vec3f(v.VertexAttribute.POSITION0).vec3f(v.VertexAttribute.POSITION1),A=l.newLayout().vec3f(v.VertexAttribute.POSITION0).vec3f(v.VertexAttribute.POSITION1).u16(v.VertexAttribute.COMPONENTINDEX).u16(v.VertexAttribute.U16PADDING,{glPadding:!0});
a.EdgeProcessingWorker=t;a.default=function(){return new t};a.extract=e;a.extractComponentsEdgeLocationsLayout=A;a.extractEdgeLocationsLayout=z;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/meshProcessing":function(){define(["exports"],function(a){a.computeNeighbors=function(b,c,n){c/=3;const l=new Uint32Array(n+1),u=new Uint32Array(n+1);var v=(k,r)=>{k<r?l[k+1]++:u[r+1]++};for(var m=0;m<c;m++){var h=b[3*m],d=b[3*m+1],e=b[3*m+2];
v(h,d);v(d,e);v(e,h)}m=v=0;for(h=0;h<n;h++)d=l[h+1],e=u[h+1],l[h+1]=v,u[h+1]=m,v+=d,m+=e;const g=new Uint32Array(6*c),p=l[n];v=(k,r,y)=>{k<r?(k=l[k+1]++,g[2*k]=r,g[2*k+1]=y):(r=u[r+1]++,g[2*p+2*r]=k,g[2*p+2*r+1]=y)};for(m=0;m<c;m++)h=b[3*m],d=b[3*m+1],e=b[3*m+2],v(h,d,m),v(d,e,m),v(e,h,m);v=(k,r)=>{const y=2*k;k=r-k;for(r=1;r<k;r++){const f=g[y+2*r],w=g[y+2*r+1];let z=r-1;for(z;0<=z&&g[y+2*z]>f;z--)g[y+2*z+2]=g[y+2*z],g[y+2*z+3]=g[y+2*z+1];g[y+2*z+2]=f;g[y+2*z+3]=w}};for(m=0;m<n;m++)v(l[m],l[m+1]),
v(p+u[m],p+u[m+1]);const t=new Int32Array(3*c),q=(k,r)=>k===b[3*r]?0:k===b[3*r+1]?1:k===b[3*r+2]?2:-1;c=(k,r)=>{k=q(k,r);t[3*r+k]=-1};v=(k,r,y,f)=>{k=q(k,r);t[3*r+k]=f;y=q(y,f);t[3*f+y]=r};for(m=0;m<n;m++){h=l[m];d=l[m+1];e=u[m];const k=u[m+1];for(;h<d&&e<k;){const r=g[2*h],y=g[2*p+2*e];r===y?(v(m,g[2*h+1],y,g[2*p+2*e+1]),h++,e++):r<y?(c(m,g[2*h+1]),h++):(c(y,g[2*p+2*e+1]),e++)}for(;h<d;)c(m,g[2*h+1]),h++;for(;e<k;)c(g[2*p+2*e],g[2*p+2*e+1]),e++}return t};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/buffer/workerHelper":function(){define(["exports","../../../../geometry/support/buffer/BufferView","./InterleavedLayout"],function(a,b,c){function n(v){const m=[];v.fields.forEach((h,d)=>{var e=h.constructor;m.push([d,{...h,constructor:`${e.ElementType}_${e.ElementCount}`}])});return{stride:v.stride,fields:m,fieldNames:v.fieldNames}}function l(v){const m=c.newLayout();m.stride=v.stride;m.fieldNames=v.fieldNames;v.fields.forEach(h=>
m.fields.set(h[0],{...h[1],constructor:u.get(h[1].constructor)}));return m}b=[b.BufferViewFloat,b.BufferViewVec2f,b.BufferViewVec3f,b.BufferViewVec4f,b.BufferViewMat3f,b.BufferViewMat4f,b.BufferViewFloat64,b.BufferViewVec2f64,b.BufferViewVec3f64,b.BufferViewVec4f64,b.BufferViewMat3f64,b.BufferViewMat4f64,b.BufferViewUint8,b.BufferViewVec2u8,b.BufferViewVec3u8,b.BufferViewVec4u8,b.BufferViewUint16,b.BufferViewVec2u16,b.BufferViewVec3u16,b.BufferViewVec4u16,b.BufferViewUint32,b.BufferViewVec2u32,b.BufferViewVec3u32,
b.BufferViewVec4u32,b.BufferViewInt8,b.BufferViewVec2i8,b.BufferViewVec3i8,b.BufferViewVec4i8,b.BufferViewInt16,b.BufferViewVec2i16,b.BufferViewVec3i16,b.BufferViewVec4i16,b.BufferViewInt32,b.BufferViewVec2i32,b.BufferViewVec3i32,b.BufferViewVec4i32];const u=new Map;b.forEach(v=>u.set(`${v.ElementType}_${v.ElementCount}`,v));a.packInterleavedBuffer=function(v,m){m.push(v.buffer);return{buffer:v.buffer,layout:n(v.layout)}};a.packLayout=n;a.unpackInterleavedBuffer=function(v){return l(v.layout).createView(v.buffer)};
a.unpackLayout=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgeBufferWriters":function(){define("exports ../../../../../core/RandomLCG ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../support/buffer/glUtil ./bufferLayouts".split(" "),function(a,b,c,n,l,u){function v(y){const f=e;f[0]=y.position0[0];f[1]=y.position0[1];f[2]=y.position0[2];f[3]=y.position1[0];f[4]=y.position1[1];f[5]=y.position1[2];
p[0]=5381;for(y=0;y<g.length;y++)p[0]=31*p[0]+g[y];return p[0]}function m(y){const f=e;f[0]=h(y.position0[0]);f[1]=h(y.position0[1]);f[2]=h(y.position0[2]);f[3]=h(y.position1[0]);f[4]=h(y.position1[1]);f[5]=h(y.position1[2]);p[0]=5381;for(y=0;y<g.length;y++)p[0]=31*p[0]+g[y];return p[0]}function h(y){return Math.round(1E4*y)/1E4}let d=function(){function y(){}var f=y.prototype;f.updateSettings=function(w){this.settings=w;this.edgeHashFunction=w.reducedPrecision?m:v};f.write=function(w,z,A){var x=
this.edgeHashFunction(A);r.seed=x;x=r.getIntRange(0,255);const B=r.getIntRange(0,this.settings.variants-1);var C=r.getFloat();C=-(1-Math.min(C/.7,1))+Math.max(0,C-.7)/(1-.7);C=255*(Math.abs(C)**1.2*(0>C?-1:1)*.5+.5);w.position0.setVec(z,A.position0);w.position1.setVec(z,A.position1);w.componentIndex.set(z,A.componentIndex);w.variantOffset.set(z,x);w.variantStroke.set(z,B);w.variantExtension.set(z,C)};f.trim=function(w,z){return w.slice(0,z)};return y}();const e=new Float32Array(6),g=new Uint32Array(e.buffer),
p=new Uint32Array(1);let t=function(){function y(){this.commonWriter=new d}var f=y.prototype;f.updateSettings=function(w){this.commonWriter.updateSettings(w)};f.allocate=function(w){return u.RegularEdgeInstancesLayout.createBuffer(w)};f.write=function(w,z,A){this.commonWriter.write(w,z,A);c.add(k,A.faceNormal0,A.faceNormal1);c.normalize(k,k);w.normal.setVec(z,k)};f.trim=function(w,z){return this.commonWriter.trim(w,z)};return y}();t.Layout=u.RegularEdgeInstancesLayout;t.glLayout=l.glLayout(u.RegularEdgeInstancesLayout,
1);let q=function(){function y(){this.commonWriter=new d}var f=y.prototype;f.updateSettings=function(w){this.commonWriter.updateSettings(w)};f.allocate=function(w){return u.SilhouetteEdgeInstancesLayout.createBuffer(w)};f.write=function(w,z,A){this.commonWriter.write(w,z,A);w.normalA.setVec(z,A.faceNormal0);w.normalB.setVec(z,A.faceNormal1)};f.trim=function(w,z){return this.commonWriter.trim(w,z)};return y}();q.Layout=u.SilhouetteEdgeInstancesLayout;q.glLayout=l.glLayout(u.SilhouetteEdgeInstancesLayout,
1);const k=n.create(),r=new b;a.CommonBufferWriter=d;a.RegularEdgeBufferWriter=t;a.SilhouetteEdgeBufferWriter=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/edgePreprocessing":function(){define("exports ../../../../../core/arrayUtils ../../../../../core/mathUtils ../../../../../core/typedArrayUtil ../../../../../chunks/vec3 ../../../../../chunks/vec3f64".split(" "),function(a,b,c,n,l,u){function v(p,t){const q=
c.acosClamped(p.cosAngle),k=d.fwd,r=d.ortho;l.direction(k,p.position1,p.position0);p=0<l.dot(l.cross(r,p.faceNormal0,p.faceNormal1),k)?-1:1;return q*p>t}function m(p){const t=p.faces.length/3,q=p.faces;p=p.neighbors;var k=0;for(var r=0;r<t;r++){var y=p[3*r+1],f=p[3*r+2],w=q[3*r],z=q[3*r+1],A=q[3*r+2];k+=-1===p[3*r]||w<z?1:0;k+=-1===y||z<A?1:0;k+=-1===f||A<w?1:0}k=new Int32Array(4*k);r=0;for(y=0;y<t;y++){f=p[3*y];w=p[3*y+1];z=p[3*y+2];A=q[3*y];const x=q[3*y+1],B=q[3*y+2];if(-1===f||A<x)k[r++]=A,k[r++]=
x,k[r++]=y,k[r++]=f;if(-1===w||x<B)k[r++]=x,k[r++]=B,k[r++]=y,k[r++]=w;if(-1===z||B<A)k[r++]=B,k[r++]=A,k[r++]=y,k[r++]=z}return k}function h(p){const t=p.faces.length/3,q=p.vertices.position;p=p.faces;const k=e.v0,r=e.v1,y=e.v2,f=new Float32Array(3*t);for(let w=0;w<t;w++){const z=p[3*w+1],A=p[3*w+2];q.getVec(p[3*w],k);q.getVec(z,r);q.getVec(A,y);l.subtract(r,r,k);l.subtract(y,y,k);l.cross(k,r,y);l.normalize(k,k);f[3*w]=k[0];f[3*w+1]=k[1];f[3*w+2]=k[2]}return f}a.EdgeType=void 0;(function(p){p[p.SOLID=
0]="SOLID";p[p.SKETCH=1]="SKETCH"})(a.EdgeType||(a.EdgeType={}));const d={edge:{position0:u.create(),position1:u.create(),faceNormal0:u.create(),faceNormal1:u.create(),componentIndex:0,cosAngle:0},ortho:u.create(),fwd:u.create()},e={v0:u.create(),v1:u.create(),v2:u.create()},g={anglePlanar:4,angleSignificantEdge:35};a.extractEdges=function(p,t,q,k=g){const r=p.vertices.position;var y=p.vertices.componentIndex,f=c.deg2rad(k.anglePlanar);k=c.deg2rad(k.angleSignificantEdge);const w=Math.cos(k),z=Math.cos(f),
A=d.edge,x=A.position0,B=A.position1,C=A.faceNormal0,D=A.faceNormal1,E=h(p),F=m(p),G=F.length/4;p=t.allocate(G);k=0;const O=q.allocate(G);let K=0,L=0,R=0;const M=b.range(0,G),J=new Float32Array(G);n.forEach(J,(V,S,T)=>{r.getVec(F[4*S],x);r.getVec(F[4*S+1],B);T[S]=l.distance(x,B)});M.sort((V,S)=>J[S]-J[V]);const I=[],P=[];for(let V=0;V<G;V++){var N=M[V];const S=J[N],T=F[4*N],H=F[4*N+1],U=F[4*N+2];N=F[4*N+3];const W=-1===N;r.getVec(T,x);r.getVec(H,B);if(W)l.set(C,E[3*U],E[3*U+1],E[3*U+2]),l.copy(D,
C),A.componentIndex=y.get(T),A.cosAngle=l.dot(C,D);else{l.set(C,E[3*U],E[3*U+1],E[3*U+2]);l.set(D,E[3*N],E[3*N+1],E[3*N+2]);A.componentIndex=y.get(T);A.cosAngle=l.dot(C,D);if(A.cosAngle>z)continue;-.9999>A.cosAngle&&l.copy(D,C)}L+=S;R++;W||A.cosAngle<w?(t.write(p,k++,A),I.push(S)):v(A,f)&&(q.write(O,K++,A),P.push(S))}y=new Float32Array(I.reverse());f=new Float32Array(P.reverse());return{regular:{instancesData:t.trim(p,k),lodInfo:{lengths:y}},silhouette:{instancesData:q.trim(O,K),lodInfo:{lengths:f}},
averageEdgeLength:L/R}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/BufferManager":function(){define(["exports","./ManagedTextureBackedBuffer"],function(a,b){let c=function(){function n(u,v=1){this.rctx=u;this.fieldCount=v;this.buffers=[]}var l=n.prototype;l.garbageCollect=function(){this.buffers=this.buffers.filter(u=>0===u.activeCount?(u.dispose(),!1):!0)};l.destroy=function(){this.buffers.forEach(u=>
u.dispose());this.buffers=[]};l.getBuffer=function(u){for(const v of this.buffers)if(v.availableCount>=u)return v;if(u>b.MAX_INDEX_COUNT)return null;u=new b.ManagedTextureBackedBuffer(this.rctx,this.fieldCount);this.buffers.push(u);return u};l.updateTextures=function(){for(const u of this.buffers)u.textureBuffer.updateTexture()};return n}();a.BufferManager=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/ManagedTextureBackedBuffer":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","./SimpleIndexManager","./TextureBackedBuffer"],function(a,b,c,n){let l=function(){function u(m,h=1){this.textureBuffer=new n.TextureBackedBuffer(m,h);this.indexManager=new c.SimpleIndexManager(65536)}var v=u.prototype;v.dispose=function(){this.textureBuffer.dispose();this.textureBuffer=void 0};v.acquireIndex=function(){const m=this.indexManager.acquire();this.textureBuffer.resizeToFit(m);return m};v.releaseIndex=function(m){this.indexManager.release(m)};
b._createClass(u,[{key:"availableCount",get:function(){return this.indexManager.availableCount}},{key:"activeCount",get:function(){return this.indexManager.activeCount}}]);return u}();a.MAX_INDEX_COUNT=65536;a.ManagedTextureBackedBuffer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/SimpleIndexManager":function(){define(["exports","../../../../../chunks/_rollupPluginBabelHelpers"],function(a,b){let c=
function(){function n(u){this.maxCount=u;this._nextIndex=0;this.recycledIndices=[]}var l=n.prototype;l.acquire=function(){if(0<this.recycledIndices.length)return this.recycledIndices.pop();if(this.availableCount)return this._nextIndex++};l.release=function(u){this.recycledIndices.push(u)};b._createClass(n,[{key:"activeCount",get:function(){return this._nextIndex-this.recycledIndices.length}},{key:"availableCount",get:function(){return this.recycledIndices.length+this.maxCount-this._nextIndex}}]);
return n}();a.SimpleIndexManager=c;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureBackedBuffer/TextureBackedBuffer":function(){define(["exports","../../../../../geometry/support/buffer/BufferView","../../../../webgl/enums","../../../../webgl/Texture"],function(a,b,c,n){let l=function(){function u(m,h=1){this.rctx=m;this.fieldCount=h;this.textureWidth=4096;this.dirty=!0;this.texture=new n.Texture(this.rctx,{target:c.TextureType.TEXTURE_2D,
pixelFormat:c.PixelFormat.RGBA,dataType:c.PixelType.UNSIGNED_BYTE,samplingMode:c.TextureSamplingMode.NEAREST,wrapMode:c.TextureWrapMode.CLAMP_TO_EDGE,width:this.textureWidth,height:1,flipped:!1});this.data=new b.BufferViewVec4u8(new ArrayBuffer(4*this.textureWidth))}var v=u.prototype;v.dispose=function(){this.texture.dispose();this.data=this.texture=void 0};v.setData=function(m,h,d,e,g,p){m=m*this.fieldCount+h;this.dirty=!0;this.data.set(m,0,d);this.data.set(m,1,e);this.data.set(m,2,g);this.data.set(m,
3,p)};v.setDataElement=function(m,h,d,e){m=m*this.fieldCount+h;this.dirty=!0;this.data.set(m,d,e)};v.resizeToFit=function(m){m*=this.fieldCount;m>=this.data.count&&(m=new b.BufferViewVec4u8(new ArrayBuffer(Math.ceil((m+1)/this.textureWidth)*this.textureWidth*4)),m.typedBuffer.set(this.data.typedBuffer),this.data=m)};v.updateTexture=function(){if(this.dirty){var m=this.texture.descriptor.width;this.data.count>m*this.texture.descriptor.height&&this.texture.resize(m,this.data.count/m);this.texture.setData(this.data.typedBuffer);
this.dirty=!1}};v.bind=function(m,h,d){m.bindTexture(h,this.texture);m.setUniform2f(d,1/this.texture.descriptor.width,1/this.texture.descriptor.height)};return u}();a.TextureBackedBuffer=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/CompositingHelper":function(){define("../../../../core/maybe ../../terrain/interfaces ./glUtil3D ../../../../chunks/Compositing.glsl ../shaders/CompositingTechnique ../shaders/CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m){return function(){function h(e,g){this._rctx=e;this._techniqueRepository=g;this._configuration=new u.CompositingTechniqueConfiguration;this._passParameters=new n.CompositingPassParameters}var d=h.prototype;d.dispose=function(){this._vao=a.disposeMaybe(this._vao)};d.compositeTransparent=function(e,g,p,t,q=1){this._configuration.alphaMode=u.AlphaMode.Alpha;this._configuration.function=u.CompositingFunction.Transparency;this._configuration.hasOpacityFactor=1!==q;this._passParameters.colorTexture=
g;this._passParameters.alphaTexture=p;this._passParameters.frontFaceTexture=t;g=this._rctx;p=this._techniqueRepository.acquire(l.CompositingTechnique,this._configuration);g.bindTechnique(p,this._passParameters,e);e=this._ensureVAO();g.bindVAO(e);g.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,m.vertexCount(e,"geometry"));p.release()};d.composite=function(e,g,p=u.AlphaMode.None,t=1,q=u.CompositingFunction.Standard,k=b.OverlayIndex.INNER){const r=this._rctx;this._configuration.alphaMode=p;this._configuration.function=
q;this._configuration.hasOpacityFactor=1!==t;this._passParameters.overlayIndex=k;this._passParameters.texture=g;this._passParameters.opacity=t;g=this._techniqueRepository.acquire(l.CompositingTechnique,this._configuration);r.bindTechnique(g,this._passParameters,e);e=this._ensureVAO();r.bindVAO(e);r.drawArrays(v.PrimitiveType.TRIANGLE_STRIP,0,m.vertexCount(e,"geometry"));g.release()};d._ensureVAO=function(){a.isNone(this._vao)&&(this._vao=c.createQuadVAO(this._rctx));return this._vao};return h}()})},
"esri/chunks/Compositing.glsl":function(){define("exports ./_rollupPluginBabelHelpers ../core/compilerUtils ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/IntegerPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/shaders/CompositingTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d){function e(t){const q=new m.ShaderBuilder;q.include(n.ScreenSpacePass);const k=q.fragment;switch(t.function){case d.CompositingFunction.Standard:k.uniforms.add(new h.Texture2DPassUniform("tex",r=>r.texture));t.hasOpacityFactor?(k.uniforms.add(new l.FloatPassUniform("opacity",r=>r.opacity)),k.code.add(v.glsl`void main() {
gl_FragColor = texture2D(tex, uv) * opacity;
}`)):k.code.add(v.glsl`void main() {
gl_FragColor = texture2D(tex, uv);
}`);break;case d.CompositingFunction.OverlayWithTransparency:k.uniforms.add(new h.Texture2DPassUniform("tex",r=>r.texture));k.uniforms.add(new u.IntegerPassUniform("overlayIdx",r=>r.overlayIndex));t.hasOpacityFactor&&k.uniforms.add(new l.FloatPassUniform("opacity",r=>r.opacity));k.code.add(v.glsl`
        void main() {
          vec2 overlayUV = overlayIdx == 0 ? vec2(uv.x * 0.5, uv.y) : vec2(uv.x * 0.5 + 0.5, uv.y);
          gl_FragColor = texture2D(tex, overlayUV) ${t.hasOpacityFactor?"* opacity":""};
        }`);break;case d.CompositingFunction.TransparentToHUDVisibility:k.uniforms.add(new h.Texture2DPassUniform("tex",r=>r.texture));k.code.add(v.glsl`void main() {
gl_FragColor = vec4(1.0 - texture2D(tex, uv).a);
}`);break;case d.CompositingFunction.Transparency:k.uniforms.add([new h.Texture2DPassUniform("colorTexture",r=>r.colorTexture),new h.Texture2DPassUniform("alphaTexture",r=>r.alphaTexture),new h.Texture2DPassUniform("frontFaceTexture",r=>r.frontFaceTexture)]);k.code.add(v.glsl`void main() {
vec4 srcColor = texture2D(colorTexture, uv);
if(srcColor.a <= 1e-5){
discard;
}
float srcAlpha = texture2D(alphaTexture, uv).r;
vec4 frontFace = texture2D(frontFaceTexture, uv);
gl_FragColor = vec4(mix(srcColor.rgb/srcColor.a, frontFace.rgb, frontFace.a), 1.0 - srcAlpha);
}`);break;case d.CompositingFunction.COUNT:break;default:c.neverReached(t.function)}return q}let g=function(t){function q(){var k=t.apply(this,arguments)||this;k.overlayIndex=0;k.opacity=1;return k}b._inheritsLoose(q,t);return q}(v.NoParameters);const p=Object.freeze(Object.defineProperty({__proto__:null,CompositingPassParameters:g,build:e},Symbol.toStringTag,{value:"Module"}));a.Compositing=p;a.CompositingPassParameters=g;a.build=e})},"esri/views/3d/webgl-engine/shaders/CompositingTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/Compositing.glsl ./CompositingTechniqueConfiguration ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){l=function(g){function p(){return g.apply(this,arguments)||this}c._inheritsLoose(p,g);var t=p.prototype;t.initializeProgram=function(q){const k=p.shader.get().build(this.configuration);return new v.Program(q.rctx,k,u.Default3D)};t.initializePipeline=function(){if(this.configuration.function===h.CompositingFunction.TransparentToHUDVisibility)return e.makePipelineState({colorWrite:{r:!1,g:!0,b:!1,a:!1}});switch(this.configuration.alphaMode){case h.AlphaMode.None:return e.makePipelineState({colorWrite:e.defaultColorWriteParams});
case h.AlphaMode.Alpha:return e.makePipelineState({blending:e.separateBlendingParams(d.BlendFactor.SRC_ALPHA,d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams});default:return e.makePipelineState({blending:e.simpleBlendingParams(d.BlendFactor.ONE,d.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:e.defaultColorWriteParams})}};return p}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(m.Compositing,()=>new Promise((g,p)=>
a(["./Compositing.glsl"],g,p)));b.CompositingTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/depthRangeUtils":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/floatRGBA ../../../../core/maybe ../../../../core/PooledArray ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/vec3 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../../../../geometry/support/frustum ../../../../chunks/sphere ../../support/mathUtils ./depthRange ./Octree ./Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){function r(R,M){if(M.isVisible){var J=t.empty(),I=M.getSpatialQueryAccelerator();n.isSome(I)?y(J,R,I):f(J,R,M.objects);return J}}function y(R,M,J){var I=M.eye;const P=M.viewForward,N=M.frustum,V=T=>T.isVisible;var S=J.objectCount;500>S?(t.set(G,M.near,Math.min(R.near,M.far)),J.forEachInDepthRange(I,P,q.DepthOrder.FRONT_TO_BACK,G,(T,H)=>{w(R,M,T);G.far=R.near;H.setRange(G)},N,V),t.set(G,Math.max(R.far,M.near),M.far),J.forEachInDepthRange(I,P,q.DepthOrder.BACK_TO_FRONT,
G,(T,H)=>{w(R,M,T);G.near=R.far;H.setRange(G)},N,V)):(S=Math.max(Math.min(S,500),Math.ceil(.1*S)),I=J.findClosest(P,q.DepthOrder.FRONT_TO_BACK,N,V,S),J=J.findClosest(P,q.DepthOrder.BACK_TO_FRONT,N,V,S),I&&J&&(A(R,M,I.boundingVolumeWorldSpace.bounds),A(R,M,J.boundingVolumeWorldSpace.bounds)))}function f(R,M,J){O.clear();J.forAll(I=>{I.isVisible&&0!==I.geometryRecords.length&&O.add(I)});O.empty||(O.sort(M),t.set(G,M.near,Math.min(R.near,M.far)),O.forEachInDepthRange(G,q.DepthOrder.FRONT_TO_BACK,(I,
P)=>{P<R.near&&w(R,M,I)}),t.set(G,Math.max(R.far,M.near),M.far),O.forEachInDepthRange(G,q.DepthOrder.BACK_TO_FRONT,(I,P,N)=>{R.far=Math.max(R.far,N)}))}function w(R,M,J){if(J.isVisible&&e.intersectsSphere(M.frustum,J.boundingVolumeWorldSpace.bounds)){var I=J.transformation,P=F;J.geometryRecords.forEach(N=>{u.multiply(P,I,N.getShaderTransformation());const V=p.maxScale(P);z(R,M,N.geometry.boundingInfo,P,V)})}}function z(R,M,J,I,P){if(!n.isNone(J)){var N=M.eye,V=M.viewForward;m.transformMat4(E,J.center,
I);N=V[0]*(E[0]-N[0])+V[1]*(E[1]-N[1])+V[2]*(E[2]-N[2]);E[3]=J.radius*P;if(!(N-E[3]>R.near&&N+E[3]<R.far)&&e.intersectsSphere(M.frustum,E))if(100<J.radius&&J.getChildren())for(J=J.getChildren(),N=0;8>N;++N)J[N]&&z(R,M,J[N],I,P);else L.unionDepthRangeWithAABB(R,M.viewProjectionMatrix,I,J.bbMin,J.bbMax)}}function A(R,M,J){var I=M.eye;M=M.viewForward;I=(J[0]-I[0])*M[0]+(J[1]-I[1])*M[1]+(J[2]-I[2])*M[2];R.near=Math.min(R.near,I-J[3]);R.far=Math.max(R.far,I+J[3])}let x=function(){function R(){this._items=
new l({allocator:J=>J||{obj:null,distance:0,near:0,far:0},deallocator:J=>{J.obj=null;J.distance=0;J.near=0;J.far=0;return J}})}var M=R.prototype;M.clear=function(){this._items.clear()};M.add=function(J){this._items.pushNew().obj=J};M.sort=function(J){const I=J.eye,P=J.viewForward;this._items.forAll(N=>{const V=N.obj.boundingVolumeWorldSpace.bounds,S=(V[0]-I[0])*P[0]+(V[1]-I[1])*P[1]+(V[2]-I[2])*P[2];N.distance=S;N.near=S-V[3];N.far=S+V[3]});this._items.sort((N,V)=>N.distance-V.distance)};M.forEachInDepthRange=
function(J,I,P){if(I===q.DepthOrder.FRONT_TO_BACK)for(I=0;I<this._items.length;++I){var N=this._items.data[I];N.far<J.near||N.near>J.far||P(N.obj,N.near,N.far)}else for(I=this._items.length-1;0<=I;--I)N=this._items.data[I],N.far<J.near||N.near>J.far||P(N.obj,N.near,N.far)};b._createClass(R,[{key:"length",get:function(){return this._items.length}},{key:"empty",get:function(){return 0===this._items.length}}]);return R}(),B=function(){function R(){this.view=v.create();this.viewProj=v.create();this.frustum=
e.create();this.geometries=[];this.near=[];this.far=[];this.nearCandidates=[];this.farCandidates=[];this.range={near:0,far:0};this.looseRange={near:0,far:0}}var M=R.prototype;M.compute=function(J,I){this._reset();u.copy(this.view,J.viewMatrix);u.multiply(this.viewProj,J.projectionMatrix,this.view);e.copy(this.frustum,J.frustum);J=this.view;const P=J[2],N=J[6],V=J[10],S=J[14];J=this.range;let T=0;I.forEach(W=>{if(W.instanceParameters.visible&&W.castShadow){if(W.hasShaderTransformation){W.computeBoundingSphere(W.getShaderTransformation(),
E,1);var Q=E}else Q=W.boundingSphere;var X=P*Q[0]+N*Q[1]+V*Q[2]+S,ba=X-Q[3];Q=X+Q[3];this.geometries[T]=W;this.near[T]=-Q;this.far[T]=-ba;++T}});if(0===this.geometries.length)return J;for(I=0;I<this.geometries.length;++I)this.near[I]>J.far&&(J.far=this.near[I]),2<this.near[I]&&this.far[I]<J.near&&(J.near=this.far[I]);I=this.looseRange;I.near=Math.max(.5*J.near,2);I.far=2*J.far;var H=0;let U=0;for(let W=0;W<this.geometries.length;++W)this.near[W]<J.near&&(this.near[W]>=I.near?J.near=this.near[W]:this.nearCandidates[H++]=
W),this.far[W]>J.far&&(this.far[W]<=I.far?J.far=this.far[W]:this.farCandidates[U++]=W);if(0===this.nearCandidates.length&&0===this.farCandidates.length)return J;this.nearCandidates.sort((W,Q)=>this.near[W]<this.near[Q]?-1:this.near[W]>this.near[Q]?1:0);this.farCandidates.sort((W,Q)=>this.far[W]<this.far[Q]?1:this.far[W]>this.far[Q]?-1:0);for(I=0;I<this.nearCandidates.length;++I)H=this.nearCandidates[I],this.near[H]<J.near&&(H=this.geometries[H],this._includeNearBoundingInfoRec(H.boundingInfo,H.getShaderTransformation()));
for(I=0;I<this.farCandidates.length;++I)H=this.farCandidates[I],this.far[H]>J.far&&(H=this.geometries[H],this._includeFarBoundingInfoRec(H.boundingInfo,H.getShaderTransformation()));return J};M._reset=function(){this.geometries.length=0;this.near.length=0;this.far.length=0;this.nearCandidates.length=0;this.farCandidates.length=0;this.range.near=Number.MAX_VALUE;this.range.far=-Number.MAX_VALUE};M._includeNearBoundingInfoRec=function(J,I){if(!n.isNone(J)){var P=J.getCenter();m.transformMat4(E,P,I);
P=p.maxScale(I);var N=E[0],V=E[1],S=E[2];P*=J.getBSRadius();var T=this.frustum;if(!(T[0][0]*N+T[0][1]*V+T[0][2]*S+T[0][3]>P||T[1][0]*N+T[1][1]*V+T[1][2]*S+T[1][3]>P||T[2][0]*N+T[2][1]*V+T[2][2]*S+T[2][3]>P||T[3][0]*N+T[3][1]*V+T[3][2]*S+T[3][3]>P||(N=this.view[2]*N+this.view[6]*V+this.view[10]*S+this.view[14],V=N+P,2>-(N-P)||-V>=this.range.near)))if(-V>this.looseRange.near)this.range.near=-V;else{if(100<P&&(P=J.getChildren(),void 0!==P)){for(J=0;8>J;++J)void 0!==P[J]&&this._includeNearBoundingInfoRec(P[J],
I);return}L.unionDepthRangeWithAABB(this.range,this.viewProj,I,J.getBBMin(),J.getBBMax())}}};M._includeFarBoundingInfoRec=function(J,I){if(!n.isNone(J)){var P=J.getBSRadius(),N=J.getCenter();m.transformMat4(E,N,I);var V=p.maxScale(I);N=E[0];var S=E[1],T=E[2];P*=V;V=this.frustum;if(!(V[0][0]*N+V[0][1]*S+V[0][2]*T+V[0][3]>P||V[1][0]*N+V[1][1]*S+V[1][2]*T+V[1][3]>P||V[2][0]*N+V[2][1]*S+V[2][2]*T+V[2][3]>P||V[3][0]*N+V[3][1]*S+V[3][2]*T+V[3][3]>P||(N=this.view[2]*N+this.view[6]*S+this.view[10]*T+this.view[14]-
P,-N<=this.range.far)))if(-N<this.looseRange.far)this.range.far=-N;else{if(100<P&&(P=J.getChildren(),void 0!==P)){for(J=0;8>J;++J)void 0!==P[J]&&this._includeFarBoundingInfoRec(P[J],I);return}L.unionDepthRangeWithAABB(this.range,this.viewProj,I,J.getBBMin(),J.getBBMax())}}};return R}(),C=function(){function R(){this.modelViewProj=v.create();this.clipPosition=[d.create(),d.create(),d.create(),d.create(),d.create(),d.create(),d.create(),d.create()]}var M=R.prototype;M.unionDepthRangeWithAABB=function(J,
I,P,N,V){var S=this.modelViewProj;u.multiply(S,I,P);I=!1;for(P=0;8>P;++P){const T=this.clipPosition[P],H=0===P||3===P||4===P||7===P?N[0]:V[0],U=0===P||1===P||4===P||5===P?N[1]:V[1],W=4>P?N[2]:V[2];T[0]=S[0]*H+S[4]*U+S[8]*W+S[12];T[1]=S[1]*H+S[5]*U+S[9]*W+S[13];T[2]=S[2]*H+S[6]*U+S[10]*W+S[14];T[3]=S[3]*H+S[7]*U+S[11]*W+S[15]}for(N=0;12>N;++N){V=this._clipTriangle(this.clipPosition[D[N][0]],this.clipPosition[D[N][1]],this.clipPosition[D[N][2]]);S=!0;for(P=0;P<V.length;++P)if(2<=V[P][3]){S=!1;break}if(!S)for(I=
!0,S=0;S<V.length;++S)P=V[S][3],P<J.near&&(J.near=P),P>J.far&&(J.far=P)}return I};M._inside=function(J,I){if(0===I)return J[0]>=-J[3];if(1===I)return J[1]>=-J[3];if(2===I)return J[0]<=J[3];if(3===I)return J[1]<=J[3];k.assert(!1)};M._intersect=function(J,I,P){let N=0;0===P?N=(-J[3]-J[0])/(I[0]-J[0]+I[3]-J[3]):1===P?N=(-J[3]-J[1])/(I[1]-J[1]+I[3]-J[3]):2===P?N=(J[3]-J[0])/(I[0]-J[0]-I[3]+J[3]):3===P&&(N=(J[3]-J[1])/(I[1]-J[1]-I[3]+J[3]));return h.lerp(d.create(),J,I,N)};M._clipTriangle=function(J,I,
P){J=[J,I,P];for(I=0;4>I;++I){P=J;J=[];for(let N=0;N<P.length;++N){const V=P[N],S=P[(N+1)%P.length];this._inside(S,I)?(this._inside(V,I)||J.push(this._intersect(V,S,I)),J.push(S)):this._inside(V,I)&&J.push(this._intersect(V,S,I))}}return J};return R}();const D=[[0,1,3],[2,3,1],[1,5,2],[6,2,5],[5,4,6],[7,6,4],[4,0,7],[3,7,0],[3,2,7],[6,7,2],[4,5,0],[1,0,5]],E=g.create(),F=v.create(),G=t.empty(),O=new x,K=new B,L=new C;a.DepthRangeFromRenderGeometries=B;a.depthRangeFromLayer=r;a.depthRangeFromScene=
function(R,M,J){if(1E4>M.size)return K.compute(R,M);const I=t.empty();J.forAll(P=>{P.isVisible&&t.union(I,r(R,P))});return I};a.textureToDepth=function(R,M,J){return c.unpackFloatRGBA(M,R)*(J[1]-J[0])+J[0]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/MagnifierHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/reactiveUtils ../../../../core/screenUtils ../../../../core/urlUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./DefaultVertexBufferLayouts ./glUtil3D ./Program ./VertexAttribute ../shaders/Magnifier.glsl ../../../magnifier/resources ../../../webgl/enums ../../../webgl/renderState ../../../webgl/Texture".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E){a.MagnifierHelper=function(F){function G(){var K=F.apply(this,arguments)||this;K._handles=new u;K._magnifier=null;K._imageSources=null;K._imageLoadTask=null;K._resources=null;K._passParameters=new x.MagnifierPassParameters;K.events=new l;K.attributeLocations=new Map([[A.VertexAttribute.POSITION,0]]);K.tmpScreenPoint=e.createScreenPointArray();K.tmpRenderPoint=e.createRenderScreenPointArray();return K}b._inheritsLoose(G,F);var O=G.prototype;
O.dispose=function(){this._magnifier=null;this._handles.destroy();m.isSome(this._imageLoadTask)&&(this._imageLoadTask.task.abort(),this._imageLoadTask=null);this._disposeResources()};O.render=function(K,L){var R=this._validMagnifier;if(!m.isNone(R)){var M=L.camera.pixelRatio,J=Math.ceil(M*R.size);this._updateResources(K,J);if(!m.isNone(this._resources)){this._passParameters.maskEnabled=R.maskEnabled;this._passParameters.overlayEnabled=R.overlayEnabled;var I=this._resources.program;K.useProgram(I);
I.bindPass(this._passParameters,L);var P=this._resources.textures,N=Math.ceil(1/this.factor*J);P.input.resize(N,N);var V=L.camera.fullWidth,S=L.camera.fullHeight;e.screenPointObjectToArray(R.position,this.tmpScreenPoint);L=L.camera.screenToRender(this.tmpScreenPoint,this.tmpRenderPoint);var T=.5*N,H=.5*N;L[0]=v.clamp(L[0],T,V-T-1);L[1]=v.clamp(L[1],H,S-H-1);T=Math.floor(L[0]-T);H=Math.floor(L[1]-H);I.bindTexture("textureInput",P.input);K.gl.copyTexImage2D(P.input.descriptor.target,0,P.input.descriptor.pixelFormat,
T,H,N,N,0);N=-1+(L[0]+R.offset.x*M)/V*2;R=-1+(L[1]-R.offset.y*M)/S*2;V=J/V*2;J=J/S*2;K.bindVAO(this._resources.vao);I.bindTexture("textureOverlay",P.overlay);I.bindTexture("textureMask",P.mask);I.setUniform4f("drawPosition",N,R,V,J);K.setPipelineState(this._resources.pipelineState);K.drawArrays(C.PrimitiveType.TRIANGLE_STRIP,0,4)}}};O._updateResourceLoading=function(){var K=this;const L=this._validMagnifier;if(!m.isNone(L)){var R=L.maskUrl,M=L.overlayUrl;!m.isSome(this._imageLoadTask)||this._imageLoadTask.maskUrl===
R&&this._imageLoadTask.overlayUrl===M||(this._imageLoadTask.task.abort(),this._imageSources=this._imageLoadTask=null);m.isSome(this._imageSources)||m.isSome(this._imageLoadTask)||(this._imageLoadTask={maskUrl:R,overlayUrl:M,task:h.createTask(function(){var J=b._asyncToGenerator(function*(I){const P=m.isNone(R)||m.isNone(M)?B.loadMagnifierResources(I):null,N=m.isSome(R)?y.requestImage(R,{signal:I}):P.then(V=>V.mask);I=m.isSome(M)?y.requestImage(M,{signal:I}):P.then(V=>V.overlay);K._imageSources={mask:yield N,
overlay:yield I};K._disposeResources();K.events.emit("request-render")});return function(I){return J.apply(this,arguments)}}())},this._imageLoadTask.task.promise.then(()=>this.notifyChange("updating"),()=>this.notifyChange("updating")))}};O._updateResources=function(K,L){this.enabled?m.isSome(this._resources)?this._resources.textures.size!==L&&(K=this._createTextureResources(K,L),m.isNone(K)?this._disposeResources():(this._disposeTextureResources(this._resources.textures),this._resources.textures=
K)):(L=this._createTextureResources(K,L),m.isNone(L)||(this._resources={textures:L,program:this._createProgram(K),vao:w.createQuadVAO(K,f.Pos2,this.attributeLocations,0,1),pipelineState:D.makePipelineState({blending:D.simpleBlendingParams(C.BlendFactor.ONE,C.BlendFactor.ONE_MINUS_SRC_ALPHA),depthTest:null,depthWrite:null,colorWrite:D.defaultColorWriteParams})})):this._disposeResources()};O._disposeResources=function(){m.isNone(this._resources)||(this._disposeTextureResources(this._resources.textures),
this._resources.program.dispose(),this._resources.vao.dispose(),this._resources=null)};O._disposeTextureResources=function(K){K.mask.dispose();K.overlay.dispose();K.input.dispose()};O._createTextureResources=function(K,L){if(m.isNone(this._imageSources))return null;this._imageSources.overlay.width=L;this._imageSources.overlay.height=L;this._imageSources.mask.width=L;this._imageSources.mask.height=L;const R=new E.Texture(K,{target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.RGBA,internalFormat:C.PixelFormat.RGBA,
dataType:C.PixelType.UNSIGNED_BYTE,wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:C.TextureSamplingMode.LINEAR,flipped:!0,preMultiplyAlpha:g.isSVG(this._imageSources.overlay.src)&&K.driverTest.svgAlwaysPremultipliesAlpha?!1:!0},this._imageSources.overlay),M=new E.Texture(K,{target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.ALPHA,internalFormat:C.PixelFormat.ALPHA,dataType:C.PixelType.UNSIGNED_BYTE,wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:C.TextureSamplingMode.LINEAR,flipped:!0},
this._imageSources.mask);return{input:new E.Texture(K,{target:C.TextureType.TEXTURE_2D,pixelFormat:C.PixelFormat.RGBA,internalFormat:C.PixelFormat.RGBA,dataType:C.PixelType.UNSIGNED_BYTE,wrapMode:C.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:C.TextureSamplingMode.LINEAR,flipped:!1}),mask:M,overlay:R,size:L}};O._createProgram=function(K){return new z.Program(K,x.build(),this.attributeLocations)};b._createClass(G,[{key:"updating",get:function(){return m.isNone(this._imageSources)&&m.isSome(this._imageLoadTask)&&
!this._imageLoadTask.task.finished}},{key:"magnifier",get:function(){return this._magnifier},set:function(K){K!==this._magnifier&&(this._handles.removeAll(),this._magnifier=K,K=()=>{this._updateResourceLoading();this.events.emit("request-render")},m.isSome(this._magnifier)&&this._handles.add(d.watch(()=>m.applySome(this._magnifier,L=>L.version),K)),K())}},{key:"enabled",get:function(){return m.isSome(this._validMagnifier)}},{key:"_validMagnifier",get:function(){return m.isSome(this._magnifier)&&this._magnifier.visible&&
m.isSome(this._magnifier.position)&&0<this._magnifier.size?this._magnifier:null}},{key:"factor",get:function(){return m.isSome(this._magnifier)?this._magnifier.factor||1:1}}]);return G}(n);c.__decorate([p.property()],a.MagnifierHelper.prototype,"_imageSources",void 0);c.__decorate([p.property()],a.MagnifierHelper.prototype,"_imageLoadTask",void 0);c.__decorate([p.property({readOnly:!0})],a.MagnifierHelper.prototype,"updating",null);a.MagnifierHelper=c.__decorate([r.subclass("esri/views/3d/webgl-engine/lib/MagnifierHelper")],
a.MagnifierHelper);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/Magnifier.glsl":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderModules/BooleanPassUniform ../core/shaderModules/Float4Uniform ../core/shaderModules/interfaces ../core/shaderModules/ShaderBuilder ../core/shaderModules/Texture2DUniform ../lib/VertexAttribute".split(" "),function(a,b,c,n,l,u,v,m){let h=function(d){function e(){var g=
d.apply(this,arguments)||this;g.maskEnabled=!1;g.overlayEnabled=!1;return g}b._inheritsLoose(e,d);return e}(l.NoParameters);a.MagnifierPassParameters=h;a.build=function(){const d=new u.ShaderBuilder;d.attributes.add(m.VertexAttribute.POSITION,"vec2");d.vertex.uniforms.add(new n.Float4Uniform("drawPosition"));d.varyings.add("vUV","vec2");d.vertex.code.add(l.glsl`void main(void) {
vUV = position;
gl_Position = vec4(drawPosition.xy + vec2(position - 0.5) * drawPosition.zw, 0.0, 1.0);
}`);d.fragment.uniforms.add(new v.Texture2DUniform("textureInput"));d.fragment.uniforms.add(new v.Texture2DUniform("textureMask"));d.fragment.uniforms.add(new v.Texture2DUniform("textureOverlay"));d.fragment.uniforms.add(new c.BooleanPassUniform("maskEnabled",e=>e.maskEnabled));d.fragment.uniforms.add(new c.BooleanPassUniform("overlayEnabled",e=>e.overlayEnabled));d.fragment.code.add(l.glsl`const float barrelFactor = 1.1;
vec2 barrel(vec2 uv) {
vec2 uvn = uv * 2.0 - 1.0;
if (uvn.x == 0.0 && uvn.y == 0.0) {
return vec2(0.5, 0.5);
}
float theta = atan(uvn.y, uvn.x);
float r = pow(length(uvn), barrelFactor);
return r * vec2(cos(theta), sin(theta)) * 0.5 + 0.5;
}
void main() {
float mask = maskEnabled ? texture2D(textureMask, vUV).a : 1.0;
vec4 inputColor = texture2D(textureInput, barrel(vUV)) * mask;
vec4 overlayColor = overlayEnabled ? texture2D(textureOverlay, vUV) : vec4(0);
gl_FragColor = overlayColor + (1.0 - overlayColor.a) * inputColor;
}`);return d};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/magnifier/resources":function(){define(["require","exports","../../chunks/_rollupPluginBabelHelpers","../../core/promiseUtils","../../support/requestImageUtils"],function(a,b,c,n,l){function u(){u=c._asyncToGenerator(function*(m){var h=new Promise((e,g)=>a(["./mask-svg"],p=>e(v(p)),g)),d=new Promise((e,g)=>a(["./overlay-svg"],p=>e(v(p)),g));h=l.requestImage((yield h).default,{signal:m});
d=l.requestImage((yield d).default,{signal:m});d={mask:yield h,overlay:yield d};n.throwIfAborted(m);return d});return u.apply(this,arguments)}const v=m=>Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"}));b.loadMagnifierResources=function(m){return u.apply(this,arguments)};Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Renderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/MapUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/time ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/mat4 ../../../../chunks/mat4f64 ../../../../chunks/boundedPlane ../../support/animationUtils ../../support/debugFlags ../core/renderPasses/RenderPassManager ../core/shaderLibrary/hud/HUDUniforms ./basicInterfaces ./BoundingInfo ./depthRange ./depthRangeUtils ./glUtil3D ./Highlight ./Material ./OffscreenRendering ./RenderContext ./rendererUtils ./RenderPass ./RenderPluginManager ./RenderSlot ./ShadowAccumulator ./ShadowHighlight ./ShadowMap ./SliceHelper ./SmaaRenderPass ./SSAOHelper ./edgeRendering/EdgeView ./edgeRendering/interfaces ../materials/renderers/MergedRenderer ../shaders/CompositingTechniqueConfiguration ../statistics/RendererPerformanceInfo ../../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H,U,W,Q,X){a.Renderer=function(la){function Z(Y,da,ha,ja,ma,pa,na,wa,xa){var sa=la.call(this,{})||this;sa._materialRepository=Y;sa._shaderTechniqueRepository=ha;sa._rctx=ja;sa._compositingHelper=ma;sa._magnifierHelper=pa;sa._requestRender=na;sa._stage=xa;sa._materialRenderers=new Map;sa._needsTransparentPass=!1;sa._hasHUDElements=!1;sa._hasHighlights=!1;sa._hasWater=!1;sa._hasOverlayWater=!1;sa._content=new Map;
sa._isRendering=!1;sa._fallbackDepthStencilTexture=null;sa.performanceInfo=new Q.RendererPerformanceInfo;sa._antialiasing=A.AntiAliasingMode.SMAA;sa._oitEnabled=!1;sa._multipassTerrain=!0;sa._transparentTerrain=!1;sa._hasAnimations=!1;sa._animationTimestep=d.Milliseconds(0);sa._handles=new u;sa._renderHiddenTransparentEdges=()=>{};sa._oitUsed=!1;sa._smaaPass=new V.SmaaRenderPass(sa._rctx,ha);sa._oitEnabled=sa._hasOITSupport;sa._requestRender();sa._offscreenRendering=new G.OffscreenRendering(sa._rctx,
sa._compositingHelper);sa._sliceHelper=new N;sa._shadowMap=new P.ShadowMap(sa._rctx,xa.viewingMode,2);sa._ssaoHelper=new S.SSAOHelper(ha,sa._rctx,()=>sa._requestRender());sa._highlight=new E.Highlight(ha,sa._rctx);sa._shadowHighlight=new I.ShadowHighlight(sa._rctx,xa.viewingMode);sa._shadowAccumulator=new J.ShadowAccumulator(sa._rctx,ha,xa,ya=>{const ra=sa.shadowsEnabled;sa._shadowMap.enabled=!0;sa._ensureCameraBindParameters(ya.camera,ya.contentCamera);sa._renderPlugins.prepareRender();sa._shadowMap.enabled=
ra},(ya,ra,ua)=>{ya.shadowMap.start(ya.camera,ra,ua);sa._renderShadowCascades(L.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL,ya.shadowMap);ya.camera.setGLViewport(sa._rctx);sa._ensureCameraBindParameters(ya.camera,ya.contentCamera)},()=>sa._requestRender());sa._renderContext=new O.RenderContext(sa._rctx,sa._offscreenRendering,sa._shadowMap,sa._ssaoHelper,sa._sliceHelper);sa._renderPlugins=new R.RenderPluginManager({renderContext:sa._renderContext,shaderTechniqueRepository:ha,textureRep:da,materialRep:sa._materialRepository,
requestRender:sa._requestRender,schedule:wa});sa.renderPassManager=new w.RenderPassManager(sa._rctx,sa._shaderTechniqueRepository);sa._renderPlugins.add(sa.renderPassManager.slots(),sa.renderPassManager);sa._handles.add([h.watch(()=>sa._stage.state.camera,()=>sa._requestRender(),h.syncAndInitial),h.watch(()=>f.EDGES_SHOW_HIDDEN_TRANSPARENT_EDGES,ya=>{sa._renderHiddenTransparentEdges=ya?()=>sa._renderEdges(H.Transparency.TRANSPARENT):()=>{};sa._requestRender()},h.initial)]);return sa}b._inheritsLoose(Z,
la);var ca=Z.prototype;ca.normalizeCtorArgs=function(){return{}};ca.dispose=function(){this._handles.destroy();this._smaaPass.dispose();this._materialRenderers.forEach(Y=>Y.dispose());this._materialRenderers.clear();this._edgeView=m.destroyMaybe(this._edgeView);this._offscreenRendering.dispose();this._fallbackDepthStencilTexture=m.disposeMaybe(this._fallbackDepthStencilTexture);this._shadowMap.enabled=!1;this._shadowMap.dispose();this._ssaoHelper.enabled=!1;this._ssaoHelper.dispose();this._highlight.dispose();
this._shadowHighlight.dispose();this._shadowAccumulator.dispose();x.BoundingInfo.prune();this._content.clear()};ca.disposeOffscreenBuffers=function(){this._offscreenRendering.dispose();this._shadowMap.dispose();this._smaaPass.disable();this._ssaoHelper.disposeOffscreenBuffers()};ca.ensureEdgeView=function(){m.isNone(this._edgeView)&&(this._edgeView=new T.EdgeView({rctx:this._rctx,renderSR:this._stage.renderSR,viewingMode:this._stage.viewingMode,techniqueRepository:this._shaderTechniqueRepository,
setNeedsRender:()=>this._requestRender(),schedule:Y=>this._stage.resourceController.schedule(Y)}),this._handles.add(h.watch(()=>m.applySome(this._edgeView,Y=>Y.updating),()=>this._requestRender(),h.sync)),this._requestRender());return this._edgeView};ca.setRenderParameters=function(Y){const {_shadowMap:da,_ssaoHelper:ha,_bindParameters:ja}=this;void 0!==Y.screenSpaceReflectionsEnabled&&ja.ssr.enabled!==Y.screenSpaceReflectionsEnabled&&(ja.ssr.enabled=Y.screenSpaceReflectionsEnabled,this._requestRender());
void 0!==Y.shadowMap&&da.enabled!==Y.shadowMap&&(da.enabled=Y.shadowMap,this._requestRender());void 0!==Y.shadowMapMaxCascades&&da.maxCascades!==Y.shadowMapMaxCascades&&(da.maxCascades=Y.shadowMapMaxCascades,this._requestRender());if(m.isSome(Y.environment)){m.isSome(Y.environment.weather)&&(this._bindParameters.weather=Y.environment.weather,this._bindParameters.weatherVisible=Y.weatherVisible,this._renderContext.bindParameters.weather=Y.environment.weather,this._renderContext.bindParameters.weatherVisible=
Y.weatherVisible);void 0!==Y.environment.lighting.ambientOcclusionEnabled&&ha.enabled!==Y.environment.lighting.ambientOcclusionEnabled&&(ha.enabled=Y.environment.lighting.ambientOcclusionEnabled,this._requestRender());void 0!==Y.environment.lighting.waterReflectionEnabled&&this._waterReflectionEnabled!==Y.environment.lighting.waterReflectionEnabled&&(this._waterReflectionEnabled=Y.environment.lighting.waterReflectionEnabled,this._requestRender());var ma="sun"===Y.environment.lighting.type;ja.enableFillLights!==
ma&&(ja.enableFillLights=ma,this._requestRender())}Y.background&&this._offscreenRendering.background!==Y.background&&(this._offscreenRendering.background=Y.background,this._requestRender());ma=Y.antialiasingEnabled?A.AntiAliasingMode.SMAA:A.AntiAliasingMode.NONE;void 0!==Y.antialiasingEnabled&&this._antialiasing!==ma&&(this._antialiasing=ma,this._requestRender());void 0!==Y.highQualityTransparency&&this._multipassTerrain!==Y.highQualityTransparency&&(this._oitEnabled=(this._multipassTerrain=Y.highQualityTransparency)&&
this._hasOITSupport,this._requestRender());void 0!==Y.defaultHighlightOptions&&(this._highlight.setDefaultOptions(Y.defaultHighlightOptions),this._shadowHighlight.setDefaultOptions(Y.defaultHighlightOptions),this._requestRender());void 0!==Y.overlays&&this._bindParameters.overlays!==Y.overlays&&(this._bindParameters.overlays=Y.overlays,this._requestRender());void 0!==Y.slicePlane&&this._sliceHelper.plane!==Y.slicePlane&&(this._sliceHelper.plane=m.unwrap(Y.slicePlane),this._requestRender());void 0!==
Y.transparentTerrain&&this._transparentTerrain!==Y.transparentTerrain&&(this._transparentTerrain=Y.transparentTerrain,this._requestRender());void 0!==Y.hasOverlayWater&&this._hasOverlayWater!==Y.hasOverlayWater&&(this._hasOverlayWater=Y.hasOverlayWater,this._requestRender());void 0!==Y.shadowCastOptions&&this._shadowAccumulator.setOptions(Y.shadowCastOptions)};ca.modify=function(Y){this._isRendering&&console.warn("Renderer.modify called while rendering");const {adds:da,removes:ha,updates:ja}=Y;if(0!==
da.length||0!==ha.length||0!==ja.length){ha.forAll(({id:pa})=>this._content.delete(pa));da.forAll(pa=>this._content.set(pa.id,pa));var ma=!1;K.splitRenderGeometryChangeSetByMaterial(Y).forEach((pa,na)=>{let wa=this._materialRenderers.get(na);if(!wa)if(0<pa.adds.length)wa=new U.MergedRenderer(this._rctx,this._materialRepository,na),this._materialRenderers.set(na,wa);else return;wa.modify(pa);wa.isEmpty&&(ma=!0)});ma&&this._materialRenderers.forEach((pa,na)=>{pa.isEmpty&&(this._materialRenderers.delete(na),
pa.dispose())});this._hasHighlights=v.someMap(this._materialRenderers,pa=>pa.hasHighlights);this._bindParameters.hasOccludees=v.someMap(this._materialRenderers,pa=>pa.hasOccludees);this._hasWater=v.someMap(this._materialRenderers,pa=>pa.hasWater);this._needsTransparentPass=v.someMap(this._materialRenderers,pa=>pa.requiresSlot(M.RenderSlot.TRANSPARENT_MATERIAL,L.RenderPass.MATERIAL));this._hasHUDElements=v.someMap(this._materialRenderers,pa=>pa.requiresSlot(M.RenderSlot.LINE_CALLOUTS_HUD_DEPTH,L.RenderPass.MATERIAL)||
pa.requiresSlot(M.RenderSlot.HUD_MATERIAL,L.RenderPass.MATERIAL)||pa.requiresSlot(M.RenderSlot.LABEL_MATERIAL,L.RenderPass.MATERIAL));this._requestRender()}};ca.updateAnimation=function(Y){this._hasAnimations=!1;this._materialRenderers.forEach(da=>this._hasAnimations=da.updateAnimation(Y)||this._hasAnimations);return this._hasAnimations=this._renderPlugins.updateAnimation(Y)||this._hasAnimations};ca.updateLightSources=function(Y,da,ha){this._bindParameters.lighting.groundLightingFactor=da;this._bindParameters.lighting.globalFactor=
ha;this._bindParameters.lighting.set(Y)};ca.render=function(Y,da,ha,ja){this._isRendering=!0;this.performanceInfo.prerender(this._rctx);this._bindParameters.transparencyPassType=A.TransparencyPassType.NONE;var ma=this._offscreenRendering;ma.needLastFrameColorTexture=this.hasWaterReflection;ma.advanceCurrentRenderTarget();const pa=r.create(this._sliceHelper.plane);ja===A.Decorations.OFF&&(this._sliceHelper.plane=null);this._rctx.bindFramebuffer(Y);da.setGLViewport(this._rctx);this._ensureCameraBindParameters(da,
ha);this._renderPlugins.prepareRender();this.performanceInfo.advance(Q.Statistics.Prepare);var na=this._computeDepthRange(da);this._renderShadowMap(Y,da,this._bindParameters.lighting.lightingMainDirection,na);this.performanceInfo.advance(Q.Statistics.Shadowmap);ma.initializeFrame(da);this._ensureBindParameters(da,ha);this._renderLinearDepth();this.performanceInfo.advance(Q.Statistics.Lineardepth);this._accumulateShadows(na,da,ha);this._renderNormal();this.performanceInfo.advance(Q.Statistics.Normals);
this._ensureBindParametersSSR();this._ssaoHelper.computeSSAO(this._bindParameters,ma.linearDepthTexture,ma.normalTexture);this.performanceInfo.advance(Q.Statistics.SSAO);this._renderContext.pass=L.RenderPass.MATERIAL;ma.bindFramebuffer();this._renderOpaqueGeometry();this.performanceInfo.advance(Q.Statistics.Opaque);da=this._multipassTerrain&&this._transparentTerrain;this._renderTerrainLinearDepth(da);this._setMultipassEnabled(da);this._setTerrainCulling(da);this._renderEdges(H.Transparency.OPAQUE);
this.performanceInfo.advance(Q.Statistics.OpaqueEdges);this._offscreenRendering.bindTarget(this._offscreenRendering.currentColorTarget,this._offscreenRendering.mainDepth);this._renderSlot(M.RenderSlot.VOXEL);this._renderHiddenTransparentEdges();(ha=this._needsTransparentPass||this._renderPlugins.needsTransparentPass)&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry());this.performanceInfo.advance(Q.Statistics.Transparent);
this._renderGeometryLinearDepth(da);na=this._renderHUDVisibility();da||this._renderInternalSlot(M.RenderSlot.LINE_CALLOUTS);this.performanceInfo.advance(Q.Statistics.Hudvisibility);this._renderEdges(H.Transparency.TRANSPARENT,da);this.performanceInfo.advance(Q.Statistics.TransparentEdges);this._renderTransparentTerrain();this._transparentTerrain&&na&&(da?this._renderLineCallouts(z.HUDTransparentRenderStyle.Occluded):ma.compositeTransparentTerrainOntoHUDVisibility(this._bindParameters),this._renderHUD(z.HUDTransparentRenderStyle.Occluded,
ma.framebuffer),this.performanceInfo.advance(Q.Statistics.HudOccluded));this.performanceInfo.advance(Q.Statistics.TransparentTerrain);this._setTerrainCulling(!1);this._transparentTerrain&&(ma.compositeTransparentTerrainOntoMain(this._bindParameters),da&&(this._renderEdges(H.Transparency.OPAQUE),this.performanceInfo.advance(Q.Statistics.OpaqueEdges),ha&&(this._oitEnabled?this._renderOrderIndependentTransparency(()=>this._renderTransparentGeometry(),!1):this._renderTransparentGeometry()),this.performanceInfo.advance(Q.Statistics.Transparent),
this._renderEdges(H.Transparency.TRANSPARENT),this.performanceInfo.advance(Q.Statistics.TransparentEdges)));da&&this._renderLineCallouts(z.HUDTransparentRenderStyle.NotOccluded);this._setMultipassEnabled(!1);this._shadowAccumulator.render(this._bindParameters);ma.renderToTargets(()=>{this._renderInternalSlot(M.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL);this._renderSlot(M.RenderSlot.POSTPROCESSING_ENVIRONMENT_TRANSPARENT);this._renderSlot(M.RenderSlot.LASERLINES)},ma.currentColorTarget,
ma.mainDepth);this.performanceInfo.advance(Q.Statistics.Atmosphere);this._renderPlugins.needsLaserlineWithContrastControl&&ma.renderTmpAndCompositeToMain(()=>this._renderSlot(M.RenderSlot.LASERLINES_CONTRAST_CONTROL),this._bindParameters,W.AlphaMode.PremultipliedAlpha);this.performanceInfo.advance(Q.Statistics.Laserline);this._renderOccluded();this.performanceInfo.advance(Q.Statistics.Occluded);ma=(ja=ja===A.Decorations.ON&&this._magnifierHelper.enabled)&&m.isNone(Y)?this._offscreenRendering.getFramebuffer(this._offscreenRendering.tmpColor,
this._offscreenRendering.tmpDepth):Y;this._rctx.bindFramebuffer(ma);da=this._offscreenRendering.colorTexture;!this._renderAntiAliasing(this._antialiasing,da)&&m.isSome(da)&&this._compositingHelper.composite(this._bindParameters,da,W.AlphaMode.None);this.performanceInfo.advance(Q.Statistics.Antialiasing);this._renderHUD(z.HUDTransparentRenderStyle.NotOccluded,ma);this.performanceInfo.advance(Q.Statistics.HudNotoccluded);this._renderHighlights(ma,this._bindParameters);this.performanceInfo.advance(Q.Statistics.Highlights);
ja&&this._magnifierHelper.render(this._rctx,this._bindParameters);ma!==Y&&(this._rctx.bindFramebuffer(Y),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.tmpColorTexture,W.AlphaMode.None));this._disposeOITBuffers();this._renderContext.lastFrameCamera.copyFrom(this._bindParameters.camera);this._sliceHelper.plane=pa;this._isRendering=!1;if(this.onPostRender)this.onPostRender();this.performanceInfo.postrender()};ca.finish=function(Y){this._hasAnimations||(this._animationTimestep=
d.Milliseconds(0));Y===A.RenderRequestType.BACKGROUND&&(this._rctx.gl.getError(),this._animationTimestep=d.Milliseconds(Math.max(.9*this._animationTimestep+this.performanceInfo.elapsedTime/y.MAXIMUM_ANIMATION_LOAD*(1-.9),y.MINIMUM_IDLE_ANIMATION_MS)))};ca.readDepthPixels=function(Y,da,ha){const ja=this._offscreenRendering.bindTarget(this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth);this._needsLinearDepth||(this._ensureBindParameters(Y,Y),this._bindParameters.camera.setGLViewport(this._rctx),
this._rctx.setClearColor(0,0,0,0),this._rctx.clearSafe(X.ClearBufferBit.COLOR_BUFFER_BIT|X.ClearBufferBit.DEPTH_BUFFER_BIT|X.ClearBufferBit.STENCIL_BUFFER_BIT),this._renderGeometryAndTransparentTerrainPass(L.RenderPass.MATERIAL_DEPTH));ja.readPixels(da[0],da[1],da[2],da[3],X.PixelFormat.RGBA,X.PixelType.UNSIGNED_BYTE,ha)};ca.readHUDVisibility=function(Y,da,ha,ja,ma){this._offscreenRendering.bindTarget(this._offscreenRendering.hudVisibility).readPixels(Y,da,ha,ja,X.PixelFormat.RGBA,X.PixelType.UNSIGNED_BYTE,
ma)};ca.readAccumulatedShadow=function(Y,da){return this._shadowAccumulator.readAccumulatedShadow(Y,da)};ca._setMultipassEnabled=function(Y){this._bindParameters.multipassTerrain.enabled=this._bindParameters.multipassGeometry.enabled=Y};ca._setTerrainCulling=function(Y){this._bindParameters.multipassTerrain.cullAboveGround=Y};ca._renderSlot=function(Y){this._bindParameters.slot=Y;this._renderPlugins.render()};ca._renderEdges=function(Y,da=!1){const ha=this._edgeView;m.isSome(ha)&&ha.shouldRender()&&
this._offscreenRendering.renderTmpAndCompositeToMain(()=>ha.render(this._bindParameters,Y),this._bindParameters,W.AlphaMode.Alpha,da)};ca._renderShadowMap=function(Y,da,ha,ja){const ma=this._shadowMap;ma.enabled&&(ma.start(da,ha,ja),this._shadowHighlight.updateParameters(da,ha),this.needsShadowHighlight?(this._renderShadowCascades(L.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT,this._shadowMap,pa=>ma.takeCascadeSnapshotTo(pa,P.SnapshotSlot.Highlight)),ma.clear(),this._renderShadowCascades(L.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT,
this._shadowMap,pa=>{ma.takeCascadeSnapshotTo(pa,P.SnapshotSlot.Default);this._renderGeometryAndTransparentTerrainPass(L.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT)})):this._renderShadowCascades(L.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL),ma.finish(Y),da.setGLViewport(this._rctx))};ca._renderShadowCascades=function(Y,da=this._shadowMap,ha=ja=>{}){for(const ja of da.getCascades())ja.camera.setGLViewport(this._rctx),this._ensureCameraBindParameters(ja.camera,ja.camera),this._renderGeometryAndTransparentTerrainPass(Y),
ha(ja)};ca._renderLinearDepth=function(){this._needsLinearDepth?this._offscreenRendering.renderToTargets(()=>this._renderGeometryAndTransparentTerrainPass(L.RenderPass.MATERIAL_DEPTH),this._offscreenRendering.linearDepth,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.linearDepth);this._bindParameters.linearDepthTexture=this._offscreenRendering.linearDepthTexture};ca._renderTerrainLinearDepth=function(Y){Y?(Y=this._renderContext.pass,
this._renderContext.pass=L.RenderPass.MATERIAL_DEPTH,this._offscreenRendering.renderToTargets(()=>this._renderTransparentTerrain(),this._offscreenRendering.terrainLinearDepth,this._offscreenRendering.tmpDepth,[-1E10,-1E10,-1E10,1],!0,!0),this._renderContext.pass=Y):this._offscreenRendering.disposeTarget(this._offscreenRendering.terrainLinearDepth);this._bindParameters.multipassTerrain.linearDepthTexture=this._offscreenRendering.terrainLinearDepthTexture};ca._renderGeometryLinearDepth=function(Y){Y?
(Y=this._renderContext.pass,this._offscreenRendering.renderToTargets(()=>this._renderGeometryPass(L.RenderPass.MATERIAL_DEPTH),this._offscreenRendering.geometryLinearDepth,this._offscreenRendering.tmpDepth,[1,1,1,1],!0,!0),this._renderContext.pass=Y):this._offscreenRendering.disposeTarget(this._offscreenRendering.geometryLinearDepth);this._bindParameters.multipassGeometry.linearDepthTexture=this._offscreenRendering.geometryLinearDepthTexture};ca._renderNormal=function(){this.needsNormal?this._offscreenRendering.renderToTargets(()=>
{this._renderGeometryAndTransparentTerrainPass(L.RenderPass.MATERIAL_NORMAL)},this._offscreenRendering.normal,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0):this._offscreenRendering.disposeTarget(this._offscreenRendering.normal)};ca._computeDepthRange=function(Y){if(!this.needsDepthRange)return B.ZERO;const da=C.depthRangeFromScene(Y,this._content,this._stage.layers);B.union(da,this.renderPlugins.queryDepthRange(Y));da.near=Math.max(Y.near,da.near);da.far=Math.min(Y.far,da.far);return da};ca._renderGeometryAndTransparentTerrainPass=
function(Y){this._renderContext.pass=Y;this._renderGeometryPass(Y);this._renderTransparentTerrain()};ca._renderGeometryPass=function(Y){this._renderContext.pass=Y;this._renderOpaqueGeometry();this._renderTransparentGeometry()};ca._renderOpaqueGeometry=function(){this._renderSlot(M.RenderSlot.INTEGRATED_MESH);this._renderSlot(M.RenderSlot.OPAQUE_TERRAIN);this._renderInternalSlot(M.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(M.RenderSlot.OPAQUE_MATERIAL);this._renderSlot(M.RenderSlot.POSTPROCESSING_ENVIRONMENT_OPAQUE)};
ca._renderTransparentGeometry=function(){this._renderInternalSlot(M.RenderSlot.TRANSPARENT_MATERIAL);this._renderSlot(M.RenderSlot.TRANSPARENT_MATERIAL)};ca._renderTransparentTerrain=function(){this._renderSlot(M.RenderSlot.TRANSPARENT_TERRAIN)};ca._renderHUDVisibility=function(){let Y=!1;this._renderContext.offscreenRenderingHelper&&this._renderContext.offscreenRenderingHelper.renderHUDVisibility(()=>{this._bindParameters.hudVisibilityTexture=this._renderContext.offscreenRenderingHelper.hudVisibilityTexture;
Y=this._renderInternalSlot(M.RenderSlot.OCCLUSION_PIXELS)},this._multipassTerrain&&this._transparentTerrain);return Y};ca._renderLineCallouts=function(Y){this._bindParameters.renderTransparentlyOccludedHUD=Y;Y===z.HUDTransparentRenderStyle.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderInternalSlot(M.RenderSlot.LINE_CALLOUTS),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,void 0,!0,!0):this._renderInternalSlot(M.RenderSlot.LINE_CALLOUTS)};ca._renderHUD=
function(Y,da){this._hasHUDElements&&(this._oitEnabled?(this._renderOrderIndependentTransparency(()=>this._renderHUDElements(Y),!0),this._rctx.bindFramebuffer(da),this._compositingHelper.composite(this._bindParameters,this._offscreenRendering.hudColorTexture,W.AlphaMode.PremultipliedAlpha)):Y===z.HUDTransparentRenderStyle.Occluded?this._offscreenRendering.renderToTargets(()=>this._renderHUDElements(z.HUDTransparentRenderStyle.Occluded),this._offscreenRendering.currentColorTarget,this._offscreenRendering.tmpDepth,
void 0,!0,!0):this._renderHUDElements(Y))};ca._renderHUDElements=function(Y){this._bindParameters.renderTransparentlyOccludedHUD=Y;this._renderInternalSlot(M.RenderSlot.LINE_CALLOUTS_HUD_DEPTH);this._renderInternalSlot(M.RenderSlot.HUD_MATERIAL);this._renderInternalSlot(M.RenderSlot.LABEL_MATERIAL)};ca._renderHighlights=function(Y,da){if(this.needsHighlight){var ha=this._highlight,ja=this._offscreenRendering.renderToTargets(()=>{this._renderGeometryAndTransparentTerrainPass(L.RenderPass.MATERIAL_HIGHLIGHT);
this._rctx.clearSafe(X.ClearBufferBit.DEPTH_BUFFER_BIT);this._renderHUDElements(z.HUDTransparentRenderStyle.Both)},this._offscreenRendering.highlight,this._offscreenRendering.tmpDepth,[0,0,0,0],!0,!0);this._bindParameters.highlightColorTexture=ja.colorTexture;this.needsShadowHighlight&&this._shadowHighlight.render(da,Y);ha.render(this._bindParameters,ja,Y)}else this._offscreenRendering.disposeTarget(this._offscreenRendering.highlight)};ca._accumulateShadows=function(Y,da,ha){this.needsShadowCast&&
this._shadowAccumulator.renderAccumulation(this._offscreenRendering.linearDepthTexture,Y,da,ha)};ca._renderOrderIndependentTransparency=function(Y,da){const ha=ma=>{this._bindParameters.transparencyPassType=ma;this._offscreenRendering.renderOITPass(()=>Y(),ma,da)},ja=this._renderContext.pass;this._renderContext.pass=L.RenderPass.MATERIAL_ALPHA;ha(A.TransparencyPassType.Alpha);this._renderContext.pass=L.RenderPass.MATERIAL;ha(A.TransparencyPassType.Color);ha(A.TransparencyPassType.FrontFace);this._offscreenRendering.compositeTransparentOntoOpaque(this._bindParameters,
da);this._bindParameters.transparencyPassType=A.TransparencyPassType.NONE;this._renderContext.pass=ja;this._oitUsed=!0};ca._disposeOITBuffers=function(){this._oitUsed||(this._offscreenRendering.disposeTarget(this._offscreenRendering.alphaFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.colorFloatTarget),this._offscreenRendering.disposeTarget(this._offscreenRendering.frontFaceTarget));this._oitUsed=!1};ca._renderOccluded=function(){let Y=0;this._materialRenderers.forEach((pa,
na)=>{na&&na.isVisible()&&na.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparentStencil&&(Y|=na.renderOccluded,aa.push(na))});const da=this._offscreenRendering,ha=(pa,na,wa,xa,sa)=>{0!==(Y&na)&&(da.renderToTargets(wa,da.tmpColor,da.mainDepth,[0,0,0,0],xa,sa),da.compositeOccludedOntoMain(this._bindParameters,pa))};0!==aa.length&&(this._renderInternalSlot(M.RenderSlot.OCCLUDER_MATERIAL,aa),ha(.5,F.RenderOccludedFlag.OccludeAndTransparentStencil,()=>this._renderInternalSlot(M.RenderSlot.TRANSPARENT_OCCLUDER_MATERIAL,
aa),!1,!1),aa.length=0);this._materialRenderers.forEach((pa,na)=>{na&&na.isVisible()&&(na.renderOccluded===F.RenderOccludedFlag.OccludeAndTransparent||na.renderOccluded===F.RenderOccludedFlag.Transparent||na.renderOccluded===F.RenderOccludedFlag.Opaque)&&(Y|=na.renderOccluded,ba.push(na))});const ja=this._renderPlugins.renderOccludedFlags;if(Y|=ja){var ma=pa=>{this._renderContext.renderOccludedMask=pa;ja>F.RenderOccludedFlag.Occlude&&this._renderSlot(M.RenderSlot.OCCLUDED_TERRAIN);this._renderInternalSlot(M.RenderSlot.OPAQUE_MATERIAL,
ba);this._renderInternalSlot(M.RenderSlot.TRANSPARENT_MATERIAL,ba);this._renderInternalSlot(M.RenderSlot.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL,ba);this._renderContext.resetRenderOccludedMask()};this._renderContext.pass=L.RenderPass.MATERIAL;ha(.5,F.RenderOccludedFlag.OccludeAndTransparent,()=>ma(F.RenderOccludedFlag.OccludeAndTransparent),!0,A.StencilBits.OutlineVisualElementMask);ha(.5,F.RenderOccludedFlag.Transparent,()=>ma(F.RenderOccludedFlag.Transparent),!0,A.StencilBits.OutlineVisualElementMask);
ha(1,F.RenderOccludedFlag.Opaque,()=>ma(F.RenderOccludedFlag.Opaque),!0,A.StencilBits.OutlineVisualElementMask);ba.length=0}};ca._renderAntiAliasing=function(Y,da){if(Y===A.AntiAliasingMode.SMAA){if(this._smaaPass.enable(()=>this._requestRender())&&m.isSome(da))return this._smaaPass.render(da),!0}else this._smaaPass.disable();return!1};ca._ensureCameraBindParameters=function(Y,da){this._bindParameters.camera=Y;this._bindParameters.contentCamera=da};ca._ensureBindParameters=function(Y,da){var ha;this._ensureCameraBindParameters(Y,
da);Y=this._renderContext.offscreenRenderingHelper;this._bindParameters.hudVisibilityTexture=Y.hudVisibilityTexture;this._bindParameters.highlightDepthTexture=null!=(ha=Y.depthTexture)?ha:this._getFallbackDepthTexture()};ca._ensureBindParametersSSR=function(){this.hasWaterReflection?(this._renderContext.lastFrameCamera.equals(this._bindParameters.camera)?this._reprojectionMatrix=k.IDENTITY:(q.invert(ia,this._bindParameters.camera.viewMatrix),q.invert(ea,this._bindParameters.camera.projectionMatrix),
q.multiply(ka,ia,ea),q.multiply(ka,this._renderContext.lastFrameCamera.viewMatrix,ka),q.multiply(ka,this._renderContext.lastFrameCamera.projectionMatrix,ka),this._reprojectionMatrix=ka),this._bindParameters.ssr.lastFrameColorTexture=this._offscreenRendering.lastFrameColorTexture):this._bindParameters.ssr.lastFrameColorTexture=null;this._bindParameters.ssr.enabled=this.hasWaterReflection};ca._renderInternalSlot=function(Y,da){let ha=!1;this._bindParameters.slot=Y;m.isSome(da)?da.forEach(ja=>{ja.shouldRender(this._renderContext)&&
(ja=this._materialRenderers.get(ja),m.isSome(ja)&&(ha=ja.render(this._renderContext.pass,this._bindParameters)||ha))}):this._materialRenderers.forEach((ja,ma)=>{ma.shouldRender(this._renderContext)&&ja.render(this._renderContext.pass,this._bindParameters)&&(ha=!0)});return ha};ca._getFallbackDepthTexture=function(){this._fallbackDepthStencilTexture||(this._fallbackDepthStencilTexture=D.createEmptyDepthTexture(this._rctx));return this._fallbackDepthStencilTexture};b._createClass(Z,[{key:"_bindParameters",
get:function(){return this._renderContext.bindParameters}},{key:"hasWater",get:function(){return this._hasWater||this._hasOverlayWater}},{key:"hasWaterReflection",get:function(){return this.hasWater&&this._waterReflectionEnabled}},{key:"updating",get:function(){return this._antialiasing===A.AntiAliasingMode.SMAA&&this._smaaPass.updating||m.isSome(this._edgeView)&&this._edgeView.updating||this._shadowAccumulator.running||!this.isCameraFinal}},{key:"edgeView",get:function(){return this._edgeView}},
{key:"isCameraFinal",get:function(){return q.equals(this._bindParameters.ssr.reprojectionMatrix,k.IDENTITY)}},{key:"_reprojectionMatrix",set:function(Y){l.update(this._bindParameters.ssr.reprojectionMatrix,Y)&&this.notifyChange("isCameraFinal")}},{key:"shadowsEnabled",get:function(){var Y;return!(null==(Y=this._shadowMap)||!Y.enabled)}},{key:"hasSlicePlane",get:function(){return!!this._sliceHelper.plane}},{key:"renderPlugins",get:function(){return this._renderPlugins}},{key:"_hasOITSupport",get:function(){return this._rctx.driverTest.floatBufferBlendWorking}},
{key:"animationTimestep",get:function(){return this._animationTimestep}},{key:"_needsLinearDepth",get:function(){return this._ssaoHelper.enabled||this._renderPlugins.needsLinearDepth||this._hasWater&&this._waterReflectionEnabled||this.needsShadowHighlight||this.needsShadowCast}},{key:"needsNormal",get:function(){return this._ssaoHelper.enabled}},{key:"needsDepthRange",get:function(){return this._shadowMap.enabled||this.needsShadowCast}},{key:"needsHighlight",get:function(){return this._hasHighlights||
this._renderPlugins.needsHighlight}},{key:"needsShadowHighlight",get:function(){return this._shadowMap.enabled&&this._shadowHighlight.isVisible&&this.needsHighlight}},{key:"needsShadowCast",get:function(){return this._shadowAccumulator.isAccumulating}},{key:"gpuMemoryUsage",get:function(){var Y,da,ha,ja,ma,pa,na,wa,xa,sa;return{offscreen:null!=(Y=null==(da=this._offscreenRendering)?void 0:da.gpuMemoryUsage)?Y:0,highlights:(null!=(ha=null==(ja=this._highlight)?void 0:ja.gpuMemoryUsage)?ha:0)+(null!=
(ma=null==(pa=this._shadowHighlight)?void 0:pa.gpuMemoryUsage)?ma:0),shadows:null!=(na=null==(wa=this._shadowMap)?void 0:wa.gpuMemoryUsage)?na:0,ssao:null!=(xa=null==(sa=this._ssaoHelper)?void 0:sa.gpuMemoryUsage)?xa:0}}},{key:"test",get:function(){const Y=this;return{offscreen:this._offscreenRendering,shadowMap:this._shadowMap,ssao:this._ssaoHelper,highlight:this._highlight,lighting:this._bindParameters.lighting,materialRenderers:this._materialRenderers,shadowAccumulator:this._shadowAccumulator,
getFramebufferTexture:da=>{switch(da){case a.FramebufferId.Color:return Y._offscreenRendering.colorTexture;case a.FramebufferId.LinearDepth:return Y._offscreenRendering.linearDepthTexture;case a.FramebufferId.Normals:return Y._offscreenRendering.normalTexture;case a.FramebufferId.ShadowMap:return Y._shadowMap.depthTexture;case a.FramebufferId.HudVisibility:return Y._offscreenRendering.hudVisibilityTexture;case a.FramebufferId.Highlight:return Y._offscreenRendering.highlightTexture}}}}}]);return Z}(n);
c.__decorate([e.property()],a.Renderer.prototype,"_shadowAccumulator",void 0);c.__decorate([e.property()],a.Renderer.prototype,"_smaaPass",void 0);c.__decorate([e.property()],a.Renderer.prototype,"_antialiasing",void 0);c.__decorate([e.property()],a.Renderer.prototype,"_edgeView",void 0);c.__decorate([e.property()],a.Renderer.prototype,"updating",null);c.__decorate([e.property()],a.Renderer.prototype,"isCameraFinal",null);a.Renderer=c.__decorate([t.subclass("esri.views.3d.webgl-engine.lib.Renderer")],
a.Renderer);a.FramebufferId=void 0;(function(la){la[la.Color=0]="Color";la[la.LinearDepth=1]="LinearDepth";la[la.Normals=2]="Normals";la[la.ShadowMap=3]="ShadowMap";la[la.HudVisibility=4]="HudVisibility";la[la.Highlight=5]="Highlight"})(a.FramebufferId||(a.FramebufferId={}));const ba=[],aa=[],ea=k.create(),ia=k.create(),ka=k.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/support/animationUtils":function(){define(["exports","../../../core/time"],
function(a,b){b=b.Milliseconds(1E3/30);a.MAXIMUM_ANIMATION_LOAD=.5;a.MINIMUM_IDLE_ANIMATION_MS=b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/renderPasses/RenderPassManager":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ./AllRenderPasses ./RenderPass ../util/TwoVectorPosition ../../lib/depthRange ../../lib/RenderPass ../../lib/RenderSlot".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){let q=function(){function f(z,A){this.rctx=z;this.shaderTechniqueRepository=A;this.canRender=!0;this._materialPassParameters=new h.MaterialPassParameters;this._shadowPassParameters=new h.ShadowMapPassParameters;this._highlightPassParameters=new h.HighlightPassParameters;this._systems=new Set;this._passes={materialOpaque:new d.RenderPass(z,A),materialTransparent:new d.RenderPass(z,A,d.RenderPassSorting.BackToFront),materialIntegratedMesh:new d.RenderPass(z,A),
shadowMap:new d.RenderPass(z,A),highlight:new d.RenderPass(z,A),highlightIntegratedMesh:new d.RenderPass(z,A),highlightShadowMap:new d.RenderPass(z,A),defaultShadowMap:new d.RenderPass(z,A)}}var w=f.prototype;w.register=function(z){this._systems.add(z)};w.prepareRender=function(z){if(0!==this._systems.size){for(const A of Object.values(this._passes))A.prepareSubmit();this._systems.forEach(A=>A.submit(this._passes,z.bindParameters));for(const A of Object.values(this._passes))A.finishSubmit();this.shaderTechniqueRepository.frameUpdate()}};
w.render=function(z){if(0!==this._systems.size)switch(this._configure(z),z.bindParameters.slot){case t.RenderSlot.OPAQUE_MATERIAL:switch(z.pass){case p.RenderPass.MATERIAL:return this._materialPassParameters.subPass=h.MaterialSubPass.Color,this._passes.materialOpaque.dispatch(this._materialPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_DEPTH:return this._materialPassParameters.subPass=h.MaterialSubPass.Depth,this._passes.materialOpaque.dispatch(this._materialPassParameters,z.bindParameters);
case p.RenderPass.MATERIAL_NORMAL:return this._materialPassParameters.subPass=h.MaterialSubPass.Normal,this._passes.materialOpaque.dispatch(this._materialPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlight.dispatch(this._highlightPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL:return this._passes.shadowMap.dispatch(this._shadowPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT:return this._passes.highlightShadowMap.dispatch(this._shadowPassParameters,
z.bindParameters);case p.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT:return this._passes.defaultShadowMap.dispatch(this._shadowPassParameters,z.bindParameters)}break;case t.RenderSlot.TRANSPARENT_MATERIAL:switch(z.pass){case p.RenderPass.MATERIAL:return this._materialPassParameters.subPass=h.MaterialSubPass.Color,this._passes.materialTransparent.dispatch(this._materialPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_ALPHA:return this._materialPassParameters.subPass=h.MaterialSubPass.Alpha,
this._passes.materialTransparent.dispatch(this._materialPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_DEPTH:return this._materialPassParameters.subPass=h.MaterialSubPass.Depth,this._passes.materialTransparent.dispatch(this._materialPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_NORMAL:return this._materialPassParameters.subPass=h.MaterialSubPass.Normal,this._passes.materialTransparent.dispatch(this._materialPassParameters,z.bindParameters)}break;case t.RenderSlot.INTEGRATED_MESH:switch(z.pass){case p.RenderPass.MATERIAL:return this._materialPassParameters.subPass=
h.MaterialSubPass.Color,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_DEPTH:return this._materialPassParameters.subPass=h.MaterialSubPass.Depth,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,z.bindParameters);case p.RenderPass.MATERIAL_NORMAL:return this._materialPassParameters.subPass=h.MaterialSubPass.Normal,this._passes.materialIntegratedMesh.dispatch(this._materialPassParameters,z.bindParameters);
case p.RenderPass.MATERIAL_HIGHLIGHT:return this._passes.highlightIntegratedMesh.dispatch(this._highlightPassParameters,z.bindParameters)}}};w.notifyDirty=function(){this._context.requestRender()};w.slots=function(){return[t.RenderSlot.OPAQUE_MATERIAL,t.RenderSlot.TRANSPARENT_MATERIAL,t.RenderSlot.INTEGRATED_MESH]};w.initializeRenderContext=function(z){this._context=z};w.uninitializeRenderContext=function(){};w.queryDepthRange=function(z){const A={near:Infinity,far:-Infinity};this._systems.forEach(x=>
{x=x.queryShadowCasterDepthRange(z);c.isSome(x)&&g.union(A,x,A)});return A};w._configure=function(z){this._updateParameters(z,z.pass===p.RenderPass.MATERIAL_DEPTH_SHADOWMAP_ALL||z.pass===p.RenderPass.MATERIAL_DEPTH_SHADOWMAP_HIGHLIGHT||z.pass===p.RenderPass.MATERIAL_DEPTH_SHADOWMAP_DEFAULT?this._shadowPassParameters:z.pass===p.RenderPass.MATERIAL_HIGHLIGHT?this._highlightPassParameters:this._materialPassParameters)};w._updateParameters=function(z,A){const x=z.bindParameters.camera,B=x.viewInverseTransposeMatrix;
v.set(k,B[3],B[7],B[11]);y.set(k);v.copy(A.transformWorldFromViewTH,y.high);v.copy(A.transformWorldFromViewTL,y.low);v.copy(A.slicePlaneLocalOrigin,k);n.fromMat4(A.transformViewFromCameraRelativeRS,x.viewMatrix);u.copy(A.transformProjFromView,x.projectionMatrix);A.identifier===h.RenderPassIdentifier.Material&&(this._materialPassParameters.transparent=z.bindParameters.slot===t.RenderSlot.TRANSPARENT_MATERIAL,this._materialPassParameters.integratedMesh=z.bindParameters.slot===t.RenderSlot.INTEGRATED_MESH,
n.transpose(r,A.transformViewFromCameraRelativeRS),n.invert(A.transformNormalViewFromGlobal,r))};b._createClass(f,[{key:"needsHighlight",get:function(){return 0<this._passes.highlight.count||0<this._passes.highlightIntegratedMesh.count}},{key:"needsTransparentPass",get:function(){return 0<this._passes.materialTransparent.count}}]);return f}();const k=m.create(),r=l.create(),y=new e.TwoVectorPosition;a.RenderPassManager=q;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/core/renderPasses/RenderPass":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../lib/basicInterfaces ../../../../webgl/enums".split(" "),function(a,b,c,n,l,u){a.RenderPassSorting=void 0;(function(h){h[h.FrontToBack=0]="FrontToBack";h[h.BackToFront=1]="BackToFront"})(a.RenderPassSorting||(a.RenderPassSorting={}));let v=function(){function h(e,g,p=a.RenderPassSorting.FrontToBack){this._rctx=
e;this._techniqueRepository=g;this._sorting=p;this._draws=new n({initialSize:32,allocator:t=>t||{material:null,geometry:null,geometryRanges:null,bindDrawParams:null,depthSquaredHint:0,indexType:0}});this._previouslyBoundDraw=new Map}var d=h.prototype;d.submitDraw=function(e,g,p,t){const q=this._draws.pushNew();q.geometry=g;q.geometryRanges=p;q.material=e;q.depthSquaredHint=t;q.indexType=g.indexed?c.unwrap(g.vao.indexBuffer).indexType:0};d.dispatch=function(e,g){const p=this._rctx;this._previouslyBoundDraw.clear();
let t=null;const q=this._draws.map(f=>f.material.prepareTechnique(this._techniqueRepository,e,g,f.geometry.parameters)),k=this._draws.length;for(let f=0;f<k;f++){var r=q[f];if(r!==t||r.configuration.transparencyPassType!==l.TransparencyPassType.NONE)p.bindTechnique(r,e,g),t=r;var y=this._draws.data[f];const w=y.geometry;p.bindVAO(w.vao);this._previouslyBoundDraw.get(r)!==y.material&&(r.bindDraw(y.material,g),this._previouslyBoundDraw.set(r,y.material));r=y.geometryRanges;const z=r.length;if(0!==y.indexType){const A=
m.get(y.indexType);for(let x=0;x<z;x+=2)p.drawElements(w.primitiveType,r[x+1],y.indexType,r[x]*A)}else for(y=0;y<z;y+=2)p.drawArrays(w.primitiveType,r[y],r[y+1])}};d.prepareSubmit=function(){this._draws.clear()};d.finishSubmit=function(){const e=this._sorting===a.RenderPassSorting.FrontToBack?1:-1;this._draws.sort((g,p)=>{const t=e*(g.depthSquaredHint-p.depthSquaredHint);return 0!==t?t:g.geometry.vao.size-p.geometry.vao.size})};b._createClass(h,[{key:"count",get:function(){return this._draws.length}}]);
return h}();const m=new Map;m.set(u.DataType.UNSIGNED_BYTE,1);m.set(u.DataType.UNSIGNED_SHORT,2);m.set(u.DataType.UNSIGNED_INT,4);a.RenderPass=v;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/Highlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../chunks/vec2 ../../../../chunks/vec4 ../../../../chunks/vec4f64 ../core/shaderTechnique/ShaderTechniqueConfiguration ./DefaultVertexAttributeLocations ./DefaultVertexBufferLayouts ./glUtil3D ../shaders/HighlightApplyTechnique ../../../../chunks/HighlightBlur.glsl ../shaders/HighlightBlurTechnique ../../../../chunks/HighlightDownsample.glsl ../shaders/HighlightDownsampleTechnique ../shaders/HighlightPassParameters ../../../webgl/BufferObject ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util ../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z){let A=function(){function x(C,D){this._techniqueRep=C;this._rctx=D;this.viewportToRestore=u.create();this._passParameters=new k.HighlightPassParameters;this._downsampleDrawParameters=new t.HighlightDownsampleDrawParameters;this._blurDrawParameters=new g.HighlightBlurDrawParameters;this._grid={coverageMipmap:null,vao:null,verticalCellCount:0,horizontalCellCount:0,cellPixelSize:0,mipmapLevels:0,viewportWidth:0,viewportHeight:0}}var B=x.prototype;B._assertResources=
function(){if(!this.quadVAO){this.quadVAO=d.createQuadVAO(this._rctx);var C={colorTarget:y.TargetType.TEXTURE,depthStencilTarget:y.DepthStencilTargetType.NONE,width:0,height:0},D={target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGBA,dataType:y.PixelType.UNSIGNED_BYTE,samplingMode:y.TextureSamplingMode.LINEAR,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0};this.blur0Fbo=new f.FramebufferObject(this._rctx,C,D);this.blur1Fbo=new f.FramebufferObject(this._rctx,C,D);C=new v.ShaderTechniqueConfiguration;
this._blurTechnique=this._techniqueRep.acquire(p.HighlightBlurTechnique,C);this._downsampleTechnique=this._techniqueRep.acquire(q.HighlightDownsampleTechnique,C);this._applyTechnique=this._techniqueRep.acquire(e.HighlightApplyTechnique,C)}};B.dispose=function(){this._blurTechnique=c.releaseMaybe(this._blurTechnique);this._downsampleTechnique=c.releaseMaybe(this._downsampleTechnique);this._applyTechnique=c.releaseMaybe(this._applyTechnique);if(this._grid.coverageMipmap)for(let C=1;C<this._grid.coverageMipmap.length;C++)this._grid.coverageMipmap[C].dispose();
this._grid.vao&&this._grid.vao.dispose(!0);this.quadVAO&&(this.quadVAO.dispose(!0),this.quadVAO=null);this.blur0Fbo=c.disposeMaybe(this.blur0Fbo);this.blur1Fbo=c.disposeMaybe(this.blur1Fbo)};B.setDefaultOptions=function(C){this._passParameters={...new k.HighlightPassParameters,...C}};B.render=function(C,D,E){this._passParameters.highlightColorTexture=D.colorTexture;this._assertResources();var F=C.camera;l.copy(this.viewportToRestore,F.fullViewport);var G=F.pixelRatio;const O=Math.ceil(F.fullWidth/
G);F=Math.ceil(F.fullHeight/G);this.blur0Fbo.resize(O,F);this.blur1Fbo.resize(O,F);G=this._rctx;G.bindVAO(this.quadVAO);let K=null;this._gridUpdateResources(D,32);this._gridComputeMipmap(C);this._passParameters.coverageTexture=this._grid.coverageMipmap[this._grid.mipmapLevels].colorTexture;K=this._grid.vao;const L=G.bindTechnique(this._blurTechnique,this._passParameters,C);G.bindVAO(K);G.bindFramebuffer(this.blur0Fbo);G.setViewport(0,0,O,F);G.setClearColor(0,0,0,0);G.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);
this._blurDrawParameters.blurInputTexture=D.colorTexture;n.set(this._blurDrawParameters.blurSize,1/O,0);L.bindDraw(this._blurDrawParameters,C);G.drawArrays(this._blurTechnique.primitiveType,0,w.vertexCount(K,"geometry"));G.bindFramebuffer(this.blur1Fbo);G.clear(y.ClearBufferBit.COLOR_BUFFER_BIT);this._blurDrawParameters.blurInputTexture=this.blur0Fbo.colorTexture;n.set(this._blurDrawParameters.blurSize,0,1/F);L.bindDraw(this._blurDrawParameters,C);G.drawArrays(this._blurTechnique.primitiveType,0,
w.vertexCount(K,"geometry"));G.bindFramebuffer(E);G.setViewport(this.viewportToRestore[0],this.viewportToRestore[1],this.viewportToRestore[2],this.viewportToRestore[3]);this._passParameters.blurColorTexture=this.blur1Fbo.colorTexture;G.bindTechnique(this._applyTechnique,this._passParameters,C);G.drawArrays(this._applyTechnique.primitiveType,0,w.vertexCount(K,"geometry"));G.bindVAO(null)};B._gridUpdateResources=function(C,D){const E=this._rctx,F=this._grid;var G=!1;null===F.coverageMipmap&&(F.coverageMipmap=
[C],G=!0);if(F.viewportWidth!==C.width||F.viewportHeight!==C.height)G=!0,F.viewportWidth=C.width,F.viewportHeight=C.height;F.coverageMipmap[0]=C;F.cellPixelSize!==D&&(F.cellPixelSize=D,G=!0);if(G){for(D=1;D<F.coverageMipmap.length;D++)F.coverageMipmap[D].dispose();F.mipmapLevels=Math.ceil(Math.log(F.cellPixelSize)*Math.LOG2E);F.coverageMipmap.length=F.mipmapLevels+1;for(D=0;D<F.mipmapLevels;D++)G=F.coverageMipmap[D],F.coverageMipmap[D+1]=new f.FramebufferObject(E,{colorTarget:y.TargetType.TEXTURE,
depthStencilTarget:y.DepthStencilTargetType.NONE,width:Math.ceil(G.width/2),height:Math.ceil(G.height/2)},{target:y.TextureType.TEXTURE_2D,pixelFormat:y.PixelFormat.RGB,dataType:y.PixelType.UNSIGNED_SHORT_5_6_5,samplingMode:y.TextureSamplingMode.LINEAR,wrapMode:y.TextureWrapMode.CLAMP_TO_EDGE,width:Math.ceil(G.width/2),height:Math.ceil(G.height/2)})}G=Math.ceil(C.height/F.cellPixelSize);var O=Math.ceil(C.width/F.cellPixelSize);if(!F.vao||F.verticalCellCount!==G||F.horizontalCellCount!==O){F.verticalCellCount=
G;F.horizontalCellCount=O;C=G+1;D=O+1;G=1/G;O=1/O;const K=new Float32Array(24*C*D);let L=0;for(let R=0;R<C;R++)for(let M=0;M<D;M++)K[L+0]=(M-.5)*O*2-1,K[L+1]=(R-.5)*G*2-1,K[L+2]=M*O,K[L+3]=R*G,K[L+4]=(M+.5)*O*2-1,K[L+5]=(R-.5)*G*2-1,K[L+6]=M*O,K[L+7]=R*G,K[L+8]=(M-.5)*O*2-1,K[L+9]=(R+.5)*G*2-1,K[L+10]=M*O,K[L+11]=R*G,K[L+12]=(M-.5)*O*2-1,K[L+13]=(R+.5)*G*2-1,K[L+14]=M*O,K[L+15]=R*G,K[L+16]=(M+.5)*O*2-1,K[L+17]=(R-.5)*G*2-1,K[L+18]=M*O,K[L+19]=R*G,K[L+20]=(M+.5)*O*2-1,K[L+21]=(R+.5)*G*2-1,K[L+22]=
M*O,K[L+23]=R*G,L+=24;F.vao&&F.vao.dispose(!0);F.vao=new z.VertexArrayObject(E,m.Default3D,{geometry:h.Pos2Tex},{geometry:r.BufferObject.createVertex(E,y.Usage.STATIC_DRAW,K)})}};B._gridComputeMipmap=function(C){const D=this._rctx,E=this._grid,F=D.bindTechnique(this._downsampleTechnique,this._passParameters,C);D.bindVAO(this.quadVAO);for(let G=0;G<E.mipmapLevels;G++){D.bindFramebuffer(E.coverageMipmap[G+1]);const O=E.coverageMipmap[G+1].width,K=E.coverageMipmap[G+1].height;this._downsampleDrawParameters.inputTexture=
E.coverageMipmap[G].colorTexture;n.set(this._downsampleDrawParameters.invFramebufferDim,1/O,1/K);F.bindDraw(this._downsampleDrawParameters,C);D.setViewport(0,0,O,K);D.drawArrays(y.PrimitiveType.TRIANGLE_STRIP,0,w.vertexCount(this.quadVAO,"geometry"))}};b._createClass(x,[{key:"gpuMemoryUsage",get:function(){let C=(c.isSome(this.blur0Fbo)?this.blur0Fbo.gpuMemoryUsage:0)+(c.isSome(this.blur1Fbo)?this.blur1Fbo.gpuMemoryUsage:0);if(this._grid.coverageMipmap)for(const D of this._grid.coverageMipmap)C+=
D.gpuMemoryUsage;return C}},{key:"test",get:function(){return{coverage:this._grid.coverageMipmap,blur:[this.blur0Fbo,this.blur1Fbo]}}}]);return x}();a.Highlight=A;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HighlightApplyTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightApply.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d){l=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);var p=g.prototype;p.initializeProgram=function(t){const q=g.shader.get().build();return new v.Program(t.rctx,q,u.Default3D)};p.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.SRC_ALPHA,h.BlendFactor.ONE,h.BlendFactor.ONE_MINUS_SRC_ALPHA,h.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:d.defaultColorWriteParams})};return g}(l.ShaderTechnique);
l.shader=new n.ReloadableShaderModule(m.HighlightApply,()=>new Promise((e,g)=>a(["./HighlightApply.glsl"],e,g)));b.HighlightApplyTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HighlightApply.glsl":function(){define("exports ./vec4 ./vec4f64 ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m){function h(){const e=new u.ShaderBuilder,{vertex:g,fragment:p}=e,t=g.code,q=p.code;e.attributes.add(m.VertexAttribute.POSITION,"vec2");e.varyings.add("uv","vec2");e.attributes.add(m.VertexAttribute.UV0,"vec2");g.uniforms.add(new v.Texture2DPassUniform("coverageTex",k=>k.coverageTexture));t.add(l.glsl`void main() {
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
return;
}
gl_Position = vec4(position, 0.0, 1.0);
uv = position.xy * 0.5 + vec2(0.5);
}`);p.uniforms.add(new v.Texture2DPassUniform("tex",k=>k.blurColorTexture));p.uniforms.add(new v.Texture2DPassUniform("origin",k=>k.highlightColorTexture));p.uniforms.add(new n.Float4PassUniform("uColor",k=>k.color));p.uniforms.add(new n.Float4PassUniform("haloColor",k=>k.haloColor));p.uniforms.add(new n.Float4PassUniform("opacities",k=>b.set(d,k.haloOpacity,k.haloOpacityOccluded,k.fillOpacity,k.fillOpacityOccluded)));p.constants.add("outlineSize","float",8.6);p.constants.add("blurSize","float",.4);
q.add(l.glsl`void main() {
vec4 blurredHighlightValue = texture2D(tex, uv);
float highlightIntensity = blurredHighlightValue.a;
if (highlightIntensity == 0.0) {
discard;
}
vec4 origin_color = texture2D(origin, uv);
float outlineIntensity;
float fillIntensity;
if (blurredHighlightValue.g > blurredHighlightValue.b) {
outlineIntensity = haloColor.w * opacities[1];
fillIntensity = uColor.w * opacities[3];
}
else {
outlineIntensity = haloColor.w * opacities[0];
fillIntensity = uColor.w * opacities[2];
}
float inner = 1.0 - outlineSize / 9.0;
float outer = 1.0 - (outlineSize + blurSize) / 9.0;
float outlineFactor = smoothstep(outer, inner, highlightIntensity);
float fillFactor = any(notEqual(origin_color, vec4(0.0, 0.0, 0.0, 0.0))) ? 1.0 : 0.0;
float intensity = outlineIntensity * outlineFactor * (1.0 - fillFactor) + fillIntensity * fillFactor;
gl_FragColor = vec4(mix(haloColor.rgb, uColor.rgb, fillFactor), intensity);
}`);return e}const d=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:h},Symbol.toStringTag,{value:"Module"}));a.HighlightApply=c;a.build=h})},"esri/chunks/HighlightBlur.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h){function d(){const p=new u.ShaderBuilder,{vertex:t,fragment:q}=p,k=t.code,r=q.code;p.attributes.add(h.VertexAttribute.POSITION,"vec2");p.attributes.add(h.VertexAttribute.UV0,"vec2");p.varyings.add("blurCoordinate","vec3");t.uniforms.add(new m.Texture2DPassUniform("coverageTex",y=>y.coverageTexture));q.uniforms.add(new n.Float2DrawUniform("blurSize",y=>y.blurSize));k.add(l.glsl`void main() {
gl_Position = vec4(position, 0.0, 1.0);
vec4 cov = texture2D(coverageTex, uv0);
if (cov.r == 0.0) {
gl_Position = vec4(0.0);
}
blurCoordinate = vec3(gl_Position.xy * 0.5 + vec2(0.5), max(cov.g, cov.b));
}`);q.uniforms.add(new v.Texture2DDrawUniform("tex",y=>y.blurInputTexture));r.add(l.glsl`void main() {
vec2 uv = blurCoordinate.xy;
vec4 center = texture2D(tex, uv);
if (blurCoordinate.z == 1.0) {
gl_FragColor = center;
} else {
vec4 sum = vec4(0.0);
sum += center * 0.204164;
sum += texture2D(tex, uv + blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv - blurSize * 1.407333) * 0.304005;
sum += texture2D(tex, uv + blurSize * 3.294215) * 0.093913;
sum += texture2D(tex, uv - blurSize * 3.294215) * 0.093913;
gl_FragColor = sum;
}
}`);return p}let e=function(p){function t(){var q=p.apply(this,arguments)||this;q.blurSize=c.create();return q}b._inheritsLoose(t,p);return t}(l.NoParameters);const g=Object.freeze(Object.defineProperty({__proto__:null,HighlightBlurDrawParameters:e,build:d},Symbol.toStringTag,{value:"Module"}));a.HighlightBlur=g;a.HighlightBlurDrawParameters=e;a.build=d})},"esri/views/3d/webgl-engine/shaders/HighlightBlurTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightBlur.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h){l=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var g=e.prototype;g.initializeProgram=function(p){const t=e.shader.get().build();return new v.Program(p.rctx,t,u.Default3D)};g.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return e}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(m.HighlightBlur,()=>new Promise((d,e)=>a(["./HighlightBlur.glsl"],d,e)));b.HighlightBlurTechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/HighlightDownsample.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./vec2f64 ../views/3d/webgl-engine/core/shaderModules/Float2DrawUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DDrawUniform ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,
b,c,n,l,u,v,m){function h(){const g=new u.ShaderBuilder,{vertex:p,fragment:t}=g,q=p.code,k=t.code;g.attributes.add(m.VertexAttribute.POSITION,"vec2");q.add(l.glsl`void main() {
gl_Position = vec4(vec2(1.0) - position * 2.0, 0.0, 1.0);
}`);t.uniforms.add(new v.Texture2DDrawUniform("tex",r=>r.inputTexture));t.uniforms.add(new n.Float2DrawUniform("invFramebufferDim",r=>r.invFramebufferDim));k.add(l.glsl`void main() {
vec2 coord = gl_FragCoord.xy * invFramebufferDim;
vec4 value = texture2D(tex, coord);
float mx = floor(max(value.g, value.b));
gl_FragColor = vec4(ceil(value.r), mx, mx, 1.0);
}`);return g}let d=function(g){function p(){var t=g.apply(this,arguments)||this;t.invFramebufferDim=c.create();return t}b._inheritsLoose(p,g);return p}(l.NoParameters);const e=Object.freeze(Object.defineProperty({__proto__:null,HighlightDownsampleDrawParameters:d,build:h},Symbol.toStringTag,{value:"Module"}));a.HighlightDownsample=e;a.HighlightDownsampleDrawParameters=d;a.build=h})},"esri/views/3d/webgl-engine/shaders/HighlightDownsampleTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/HighlightDownsample.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h){l=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var g=e.prototype;g.initializeProgram=function(p){const t=e.shader.get().build();return new v.Program(p.rctx,t,u.Default3D)};g.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return e}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(m.HighlightDownsample,()=>new Promise((d,e)=>a(["./HighlightDownsample.glsl"],d,e)));b.HighlightDownsampleTechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/HighlightPassParameters":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/vec4f32","../../../../chunks/vec4f64","../core/shaderModules/interfaces"],function(a,b,c,n,l){l=function(u){function v(){var m=u.apply(this,arguments)||this;m.color=c.fromValues(1,0,1,1);m.haloColor=c.fromValues(1,0,1,1);m.haloOpacity=1;m.haloOpacityOccluded=
.25;m.fillOpacity=.2;m.fillOpacityOccluded=.05;m.shadowColor=n.fromValues(1,0,1,1);m.shadowOpacity=.15;m.occludedShadowOpacity=.075;return m}b._inheritsLoose(v,u);return v}(l.NoParameters);a.HighlightPassParameters=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/OffscreenRendering":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ./basicInterfaces ./RenderTargetHelper ../shaders/CompositingTechniqueConfiguration ../../../webgl/context-util ../../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m){let h=function(){function g(t,q){this._rctx=t;this._compositingHelper=q;this._mainColorTarget=0;this._dimensions={width:4,height:4};this._needLastFrameColorTexture=!1;this._background={type:"color",color:[0,0,0,1]};const k=t.type===v.ContextType.WEBGL2,r=this._renderTargetHelper=new l.RenderTargetHelper(t);this.mainColorTargets=[r.registerColorTarget({name:"mainColorTarget0"}),r.registerColorTarget({name:"mainColorTarget1"})];this.frontFaceTarget=r.registerColorTarget({name:"frontFaceTarget"});
t=y=>r.registerColorTarget({name:y,dataType:m.PixelType.FLOAT,internalFormat:k?m.SizedPixelFormat.RGBA32F:m.PixelFormat.RGBA,samplingMode:m.TextureSamplingMode.NEAREST});this.colorFloatTarget=t("colorFloatTarget");this.alphaFloatTarget=t("alphaFloatTarget");this.mainDepth=r.registerDepthTarget({name:"mainDepth"});this.linearDepth=r.registerColorTarget({name:"linearDepth",samplingMode:m.TextureSamplingMode.NEAREST});this.terrainLinearDepth=r.registerColorTarget({name:"terrainLinearDepth"});this.geometryLinearDepth=
r.registerColorTarget({name:"geometryLinearDepth"});this.normal=r.registerColorTarget({name:"normal"});this.highlight=r.registerColorTarget({name:"highlight",internalFormat:k?m.SizedPixelFormat.RGBA4:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_SHORT_4_4_4_4});this.hudVisibility=r.registerColorTarget({name:"hudVisibility",internalFormat:k?m.SizedPixelFormat.RGBA4:m.PixelFormat.RGBA,dataType:m.PixelType.UNSIGNED_SHORT_4_4_4_4});this.tmpColor=r.registerColorTarget({name:"tmpColor"});this.tmpDepth=
r.registerDepthTarget({name:"tmpDepth"});this.hudColor=r.registerColorTarget({name:"hudColor"})}var p=g.prototype;p.dispose=function(){this._renderTargetHelper.dispose()};p.getFramebuffer=function(t,q){return this._renderTargetHelper.getFramebuffer(this._dimensions,t,q)};p.advanceCurrentRenderTarget=function(){this._mainColorTarget=0===this._mainColorTarget&&this._needLastFrameColorTexture?1:0};p.initializeFrame=function(t){const q=this._rctx;this._dimensions.width=t.fullWidth;this._dimensions.height=
t.fullHeight;this.bindTarget(this.currentColorTarget,this.mainDepth);q.setClearStencil(0);t=this._background.color;q.setClearColor(t[0]*t[3],t[1]*t[3],t[2]*t[3],t[3]);q.clearSafe(m.ClearBufferBit.COLOR_BUFFER_BIT|m.ClearBufferBit.DEPTH_BUFFER_BIT|m.ClearBufferBit.STENCIL_BUFFER_BIT)};p.composite=function(t){c.isSome(this.colorTexture)&&this._compositingHelper.composite(t,this.colorTexture,u.AlphaMode.None)};p.renderTmpAndCompositeToMain=function(t,q,k,r=!1){this.renderToTargets(t,this.tmpColor,r?
this.tmpDepth:this.mainDepth,d);this._compositingHelper.composite(q,this._getColorTexture(this.tmpColor),k)};p.renderHUDVisibility=function(t,q=!1){this.renderToTargets(t,this.hudVisibility,q?this.tmpDepth:this.mainDepth,e)};p.compositeTransparentTerrainOntoHUDVisibility=function(t){this.renderToTargets(()=>this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),u.AlphaMode.None,1,u.CompositingFunction.TransparentToHUDVisibility),this.hudVisibility,this.tmpDepth)};p.renderOITPass=
function(t,q,k){let r,y;switch(q){case n.TransparencyPassType.Color:r=this.colorFloatTarget;y=[0,0,0,0];break;case n.TransparencyPassType.Alpha:r=this.alphaFloatTarget;y=[1,1,1,1];break;case n.TransparencyPassType.FrontFace:r=this.frontFaceTarget,y=[0,0,0,0]}k?this.renderToTargets(t,r,this.tmpDepth,y,!0,!0):this.renderToTargets(t,r,this.mainDepth,y,!1)};p.compositeTransparentTerrainOntoMain=function(t){this.bindFramebuffer();this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),
u.AlphaMode.PremultipliedAlpha)};p.compositeOccludedOntoMain=function(t,q){this.bindFramebuffer();this._compositingHelper.composite(t,this._getColorTexture(this.tmpColor),u.AlphaMode.PremultipliedAlpha,q)};p.compositeTransparentOntoOpaque=function(t,q){q?(this.bindTarget(this.hudColor,this.tmpDepth),this._rctx.setClearColor(0,0,0,1E-13),this._rctx.clearSafe(m.ClearBufferBit.COLOR_BUFFER_BIT)):this.bindFramebuffer();this._compositingHelper.compositeTransparent(t,this._getColorTexture(this.colorFloatTarget),
this._getColorTexture(this.alphaFloatTarget),this._getColorTexture(this.frontFaceTarget))};p.bindFramebuffer=function(){this._rctx.bindFramebuffer(this.framebuffer)};p.renderDepthDetached=function(t){this.bindTarget(this.currentColorTarget);t();this.bindTarget(this.currentColorTarget,this.mainDepth)};p.disposeTarget=function(t){this._renderTargetHelper.disposeTargetResource(t)};p.renderToTargets=function(t,q,k,r,y=!1,f=!1){const w=this._rctx;q=this.bindTarget(q,k);k=0;r&&(w.setClearColor(r[0],r[1],
r[2],Math.max(1E-13,r[3])),k|=m.ClearBufferBit.COLOR_BUFFER_BIT);y&&(k|=m.ClearBufferBit.DEPTH_BUFFER_BIT);!1===f?f=0:(!0===f&&(f=255),k|=m.ClearBufferBit.STENCIL_BUFFER_BIT);k&&w.clearSafe(k,f);t();w.gl.flush();this.bindTarget(this.currentColorTarget,this.mainDepth);return q};p.bindTarget=function(t,q){t=this._renderTargetHelper.getFramebuffer(this._dimensions,t,q);this._rctx.bindFramebuffer(t);return t};p._getColorTexture=function(t){return this._renderTargetHelper.getColorTexture(t,this._dimensions)};
b._createClass(g,[{key:"width",get:function(){return this._dimensions.width}},{key:"height",get:function(){return this._dimensions.height}},{key:"background",get:function(){return this._background},set:function(t){this._background=t}},{key:"currentColorTarget",get:function(){return this.mainColorTargets[this._mainColorTarget]}},{key:"previousColorTarget",get:function(){return this.mainColorTargets[1-this._mainColorTarget]}},{key:"framebuffer",get:function(){return this.getFramebuffer(this.currentColorTarget,
this.mainDepth)}},{key:"colorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.currentColorTarget)}},{key:"depthTexture",get:function(){return this._renderTargetHelper.getAllocatedDepthTexture(this.mainDepth)}},{key:"linearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.linearDepth)}},{key:"terrainLinearDepthTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.terrainLinearDepth)}},{key:"geometryLinearDepthTexture",
get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.geometryLinearDepth)}},{key:"lastFrameColorTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.previousColorTarget)}},{key:"normalTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.normal)}},{key:"highlightTexture",get:function(){return this._renderTargetHelper.getAllocatedColorTexture(this.highlight)}},{key:"hudVisibilityTexture",get:function(){return this._getColorTexture(this.hudVisibility)}},
{key:"tmpColorTexture",get:function(){return this._getColorTexture(this.tmpColor)}},{key:"hudColorTexture",get:function(){return this._getColorTexture(this.hudColor)}},{key:"mainColorTexture",get:function(){return this._getColorTexture(this.currentColorTarget)}},{key:"needLastFrameColorTexture",get:function(){return this._needLastFrameColorTexture},set:function(t){!t&&this._needLastFrameColorTexture&&(this._mainColorTarget=0,this.disposeTarget(this.mainColorTargets[1]));this._needLastFrameColorTexture=
t}},{key:"gpuMemoryUsage",get:function(){let t=0;this._renderTargetHelper&&(t+=this._renderTargetHelper.gpuMemoryUsage);return t}}]);return g}();const d=[0,0,0,0],e=[0,1,0,1];a.OffscreenRendering=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderTargetHelper":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/uid ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Renderbuffer ../../../webgl/Texture ../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h){const d={dataType:l.PixelType.UNSIGNED_BYTE,internalFormat:l.PixelFormat.RGBA},e={};let g=function(){function p(q){this.rctx=q;this._activeTargets=new Set;this._depthTextures=new Map;this._depthBuffers=new Map;this._colorTextures=new Map;this._framebuffers=new Map;this.depthTextureSupported=q.capabilities.depthTexture}var t=p.prototype;t.dispose=function(){this._depthBuffers.forEach(q=>q.dispose());this._depthBuffers.clear();this._depthTextures.forEach(q=>q.dispose());
this._depthTextures.clear();this._colorTextures.forEach(q=>q.dispose());this._colorTextures.clear();this._framebuffers.forEach(q=>q.dispose());this._framebuffers.clear();this._activeTargets.clear()};t.disposeTargetResource=function(q){q=q.id;this._activeTargets.has(q)&&(this._activeTargets.delete(q),this._disposeWithFramebuffers(this._depthTextures,q),this._disposeWithFramebuffers(this._depthBuffers,q),this._disposeWithFramebuffers(this._colorTextures,q))};t._disposeWithFramebuffers=function(q,k){const r=
q.get(k);r&&(this._framebuffers.forEach((y,f)=>{if(y.colorAttachment===r||y.depthStencilAttachment===r)y.detachAll(),y.dispose(),this._framebuffers.delete(f)}),r.dispose(),q.delete(k))};t.getDepthTexture=function(q,k){if(!this.depthTextureSupported)return null;let r=this._depthTextures.get(q.id);!r||r.descriptor.width===k.width&&r.descriptor.height===k.height||(r.dispose(),r=null);r||(r=new m.Texture(this.rctx,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.DEPTH_STENCIL,dataType:l.PixelType.UNSIGNED_INT_24_8,
samplingMode:l.TextureSamplingMode.NEAREST,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:k.width,height:k.height}),this._depthTextures.set(q.id,r),this._activeTargets.add(q.id));return r};t.getAllocatedDepthTexture=function(q){return this._depthTextures.get(q.id)};t.getDepthBuffer=function(q,k){if(this.depthTextureSupported)return null;let r=this._depthBuffers.get(q.id);r?r.descriptor.width===k.width&&r.descriptor.height===k.height||r.resize(k.width,k.height):(r=new v.Renderbuffer(this.rctx,{internalFormat:l.RenderbufferFormat.DEPTH_STENCIL,
...k}),this._depthBuffers.set(q.id,r),this._activeTargets.add(q.id));return r};t.getColorTexture=function(q,k){let r=this._colorTextures.get(q.id);!r||r.descriptor.width===k.width&&r.descriptor.height===k.height||(r.dispose(),r=null);r||(r=new m.Texture(this.rctx,{target:l.TextureType.TEXTURE_2D,pixelFormat:l.PixelFormat.RGBA,internalFormat:q.internalFormat,dataType:q.dataType,samplingMode:null!=q.samplingMode?q.samplingMode:l.TextureSamplingMode.LINEAR,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,width:k.width,
height:k.height}),this._colorTextures.set(q.id,r),this._activeTargets.add(q.id));return r};t.getAllocatedColorTexture=function(q){return this._colorTextures.get(q.id)};t.registerDepthTarget=function(q={}){return{id:n.generateUID(),...e,...q}};t.registerColorTarget=function(q={}){return{id:n.generateUID(),...d,...q}};t.getFramebuffer=function(q,k,r){const y=this._getKey(k,r);let f=this._framebuffers.get(y);k=this.getColorTexture(k,q);if(this.depthTextureSupported){var w=r?this.getDepthTexture(r,q):
void 0;if(!f)return f=c.isSome(r)?new u.FramebufferObject(this.rctx,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.DEPTH_STENCIL_TEXTURE},k,w):new u.FramebufferObject(this.rctx,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},k),this._framebuffers.set(y,f),f;if(f.width!==q.width||f.height!==q.height||f.colorTexture!==k||f.depthStencilTexture!==w)f.detachAll(),f.resize(q.width,q.height),f.attachColorTexture(k),f.attachDepthStencilTexture(w);
return f}w=r?this.getDepthBuffer(r,q):void 0;if(!f)return f=new u.FramebufferObject(this.rctx,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:r?l.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER:l.DepthStencilTargetType.NONE},k,w),this._framebuffers.set(y,f),f;if(f.width!==q.width||f.height!==q.height||f.colorTexture!==k)f.detachAll(),f.resize(q.width,q.height),f.attachColorTexture(k),f.attachDepthStencilBuffer(w);return f};t._getKey=function(q,k){return`${q.id}_${k?k.id:"X"}_${q.name}${k?
"_"+k.name:""}`};b._createClass(p,[{key:"gpuMemoryUsage",get:function(){let q=0;const k=new Set,r=y=>{k.has(y)||(k.add(y),q+=h.getGpuMemoryUsage(y))};this._depthTextures.forEach(r);this._colorTextures.forEach(r);this._depthBuffers.forEach(r);return q}}]);return p}();a.RenderTargetHelper=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderPluginManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/PooledArray ../../../../core/promiseUtils ./depthRange ./RenderSlot".split(" "),
function(a,b,c,n,l,u){let v=function(){function h(e){this.context=e;this._renderPlugins=new c;this.slots=[];for(e=0;e<u.RenderSlot.MAX_SLOTS;++e)this.slots[e]=[]}var d=h.prototype;d.add=function(e,g,p){const t=()=>{if(null!=p&&p.aborted)throw g.uninitializeRenderContext(),n.createAbortError();this._renderPlugins.push(g);for(const k of e)this.slots[k].push(g);this.context.requestRender()},q=g.initializeRenderContext(this.context,p);if(n.isPromiseLike(q))return q.then(t);t()};d.remove=function(e){if(null!=
this._renderPlugins.removeUnordered(e)){for(let g=0;g<this.slots.length;++g)this.slots[g]=this.slots[g].filter(p=>p!==e);e.uninitializeRenderContext();this.context.requestRender()}};d.prepareRender=function(){this._renderPlugins.forAll(e=>{e.prepareRender&&e.prepareRender(this.context.renderContext)})};d.updateAnimation=function(e){let g=!1;this._renderPlugins.forAll(p=>{p.updateAnimation&&(g=p.updateAnimation(e)||g)});return g};d.render=function(){const e=[];this.slots[this.context.renderContext.bindParameters.slot].filter(g=>
{if(!g.canRender)return!1;if("prepareTechnique"in g)return(g=g.prepareTechnique(this.context.renderContext))?(e.push(g),!0):!1;e.push(null);return!0}).forEach((g,p)=>g.render(this.context.renderContext,e[p]))};d.queryDepthRange=function(e){const g=m;g.near=Infinity;g.far=-Infinity;this._renderPlugins.forAll(p=>{p.queryDepthRange&&(p=p.queryDepthRange(e))&&l.union(g,p,g)});return g};b._createClass(h,[{key:"needsTransparentPass",get:function(){return this._renderPlugins.some(e=>e.needsTransparentPass)}},
{key:"needsHighlight",get:function(){return this._renderPlugins.some(e=>e.needsHighlight)}},{key:"needsLinearDepth",get:function(){return this._renderPlugins.some(e=>e.needsLinearDepth)}},{key:"needsLaserlineWithContrastControl",get:function(){const e=this.slots[u.RenderSlot.LASERLINES_CONTRAST_CONTROL];return!!e&&0<e.length}},{key:"renderOccludedFlags",get:function(){return this._renderPlugins.reduce((e,g)=>e|g.renderOccludedFlags,0)}}]);return h}();const m={near:0,far:0};a.RenderPluginManager=v;
Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowAccumulator":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/arrayUtils ../../../../core/Handles ../../../../core/mathUtils ../../../../core/maybe ../../../../core/reactiveUtils ../../../../core/accessorSupport/decorators/property ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../core/shaderTechnique/ShaderTechniqueConfiguration ./BindParameters ./Camera ./depthRange ./glUtil3D ./ShadowCastRenderer ./ShadowMap ../../../../chunks/ShadowCastAccumulate.glsl ../shaders/ShadowCastAccumulateTechnique ../../../support/Scheduler ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F){var G;a.ShadowAccumulator=G=function(K){function L(M,J,I,P,N,V){var S=K.call(this,{})||this;S._rctx=M;S._stage=I;S._prepareForShadowMapPass=P;S._renderToShadowMap=N;S._requestRender=V;S._progress=0;S._sampleCount=0;S._passParameters=new x.ShadowCastAccumulatePassParameters;S._enabled=!1;S._cachedLightDirections=[];S._depthRange=f.ZERO;S._previewing=!1;S._handles=new u;S._cameraForcedForScreenshot=!1;S._bindParameters=new r.BindParameters(new A.ShadowMap(M,
I.viewingMode),null,null);S._bindParameters.shadowMap.enabled=!0;S._bindParameters.camera=new y.Camera;S._vao=w.createQuadVAO(M);S._fbo=new E.FramebufferObject(M,{colorTarget:D.TargetType.TEXTURE,depthStencilTarget:D.DepthStencilTargetType.NONE,width:0,height:0},{target:D.TextureType.TEXTURE_2D,pixelFormat:D.PixelFormat.RGBA,dataType:D.PixelType.UNSIGNED_BYTE,samplingMode:D.TextureSamplingMode.LINEAR,wrapMode:D.TextureWrapMode.CLAMP_TO_EDGE,width:0,height:0});S._accumulationRenderer=new z.ShadowCastRenderer(J,
M,b._assertThisInitialized(S),V);S._handles.add(S._stage.resourceController.scheduler.registerTask(C.TaskPriority.SHADOW_ACCUMULATOR,b._assertThisInitialized(S)));S._handles.add(h.watch(()=>I.renderView,T=>{S._handles.remove(G.renderViewHandleKey);m.isNone(T)||S._handles.add(T.events.on("force-camera-for-screenshot",()=>S._cameraForcedForScreenshot=!0),G.renderViewHandleKey)},h.syncAndInitial));return S}b._inheritsLoose(L,K);var R=L.prototype;R.normalizeCtorArgs=function(){return{}};R.runTask=function(M){for(this._prepareForShadowMapPass(this._bindParameters);!M.done&&
!this._isDoneAccumulating;)this._accumulateShadow(),M.madeProgress();this._requestRender()};R.renderAccumulation=function(M,J,I,P){this._passParameters.linearDepthTexture=M;this._depthRange=J;this._updateCamera(I);this._bindParameters.contentCamera=P;this.notifyChange("canAccumulate");if(this.isAccumulating&&this.canAccumulate){(this._previewing||0===this._progress||this._cameraForcedForScreenshot)&&this._clear();M=this._cameraForcedForScreenshot?this._sampleCount:Math.min(G.previewSamples,this._sampleCount-
this._progress);for(J=0;J<M;++J)this._accumulateShadow();this._cameraForcedForScreenshot=!1}};R.render=function(M){this._accumulationRenderer.render(M)};R.dispose=function(){this._stop();this._handles.destroy();this._accumulationRenderer=m.disposeMaybe(this._accumulationRenderer);this._bindParameters.shadowMap.dispose();this._fbo=m.disposeMaybe(this._fbo);this._vao=m.disposeMaybe(this._vao);this._accumulationTechnique=m.releaseMaybe(this._accumulationTechnique);this._sampleCount=this._cachedLightDirections.length=
0};R.setOptions=function(M){void 0!==M.enabled&&(this.enabled=M.enabled);void 0!==M.previewing&&(this.previewing=M.previewing);void 0!==M.lightDirections&&(this.lightDirections=M.lightDirections);this._accumulationRenderer.setOptions(M)};R.readAccumulatedShadow=function(M,J){if(!this._isActive||1>this._progress||0>M||M>this._fbo.width||0>J||J>this._fbo.height)return 0;const I=O;this._fbo.readPixels(M,J,1,1,D.PixelFormat.RGBA,D.PixelType.UNSIGNED_BYTE,I);return I[0]/this._progress};R._start=function(){this._progress=
0;this._enabled=!0};R._stop=function(){this._enabled=!1};R._invalidate=function(){this._progress=0;this._requestRenderIfEnabled()};R._clear=function(){this._rctx.bindFramebuffer(this._fbo);this._rctx.setClearColor(0,0,0,0);this._rctx.clearSafe(D.ClearBufferBit.COLOR_BUFFER_BIT);this._progress=0};R._accumulateShadow=function(){this._renderToShadowMap(this._bindParameters,this._lightDirections[this._progress],this._depthRange);this._passParameters.origin=this._bindParameters.camera.center;this._rctx.bindFramebuffer(this._fbo);
const M=this.accumulationTechnique;this._rctx.bindTechnique(M,this._passParameters,this._bindParameters);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(M.primitiveType,0,F.vertexCount(this._vao,"geometry"));this._progress++};R._updateCamera=function(M){M.equals(this._bindParameters.camera)||(this._bindParameters.camera.copyFrom(M),this._fbo.resize(M.fullWidth,M.fullHeight),this._opacityFromElevation=1-v.smoothstep(z.shadowCastDisableElevationMin,z.shadowCastDisableElevationMax,M.relativeElevation))};
R._requestRenderIfEnabled=function(){this._enabled&&this._requestRender()};b._createClass(L,[{key:"computedSamples",get:function(){return this._progress}},{key:"shadowCastTexture",get:function(){return this._fbo.colorTexture}},{key:"isAccumulating",get:function(){return this._isPreviewing||this._isRefining}},{key:"accumulationTechnique",get:function(){m.isNone(this._accumulationTechnique)&&(this._accumulationTechnique=new B.ShadowCastAccumulateTechnique({rctx:this._rctx,viewingMode:this._stage.viewingMode},
new k.ShaderTechniqueConfiguration));return this._accumulationTechnique}},{key:"_isRefining",get:function(){return this._isActive&&!this._isDoneAccumulating&&!this._previewing}},{key:"_isPreviewing",get:function(){return this._isActive&&this._previewing}},{key:"_isActive",get:function(){return this._enabled&&0<this._sampleCount}},{key:"canAccumulate",get:function(){return null!==this._passParameters.linearDepthTexture&&this._depthRange!==f.ZERO&&this._opacityFromElevation>z.shadowCastDisabledElevationThreshold}},
{key:"_isDoneAccumulating",get:function(){return this._progress>=this._sampleCount}},{key:"_lightDirections",get:function(){return this._cachedLightDirections},set:function(M){const J=this._cachedLightDirections;if(!l.equals(J,M,t.equals)){var I=M.length;J.length=I;this._sampleCount=Math.min(x.shadowCastMaxSamples,I);for(let P=0;P<I;++P){const N=M[P],V=J[P]||q.create();t.copy(V,N);J[P]=V}this._invalidate()}}},{key:"_opacityFromElevation",get:function(){return this._accumulationRenderer.opacityFromElevation},
set:function(M){this._accumulationRenderer.opacityFromElevation=M}},{key:"running",get:function(){return this._isRefining&&this.canAccumulate&&0<this._progress}},{key:"previewing",set:function(M){this._previewing!==M&&(this._previewing=M,this._requestRenderIfEnabled())}},{key:"lightDirections",set:function(M){this._lightDirections=M}},{key:"enabled",set:function(M){M!==this._enabled&&(M?this._start():this._stop())}},{key:"test",get:function(){const M=this;return{lightDirections:this._lightDirections,
get isDone(){return M._isDoneAccumulating},get isActive(){return M._isActive}}}}]);return L}(n);a.ShadowAccumulator.previewSamples=6;a.ShadowAccumulator.renderViewHandleKey="renderView";c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_progress",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_sampleCount",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_enabled",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_depthRange",void 0);
c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_previewing",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_accumulationRenderer",void 0);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isRefining",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isActive",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"canAccumulate",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"_isDoneAccumulating",null);c.__decorate([d.property()],
a.ShadowAccumulator.prototype,"_opacityFromElevation",null);c.__decorate([d.property()],a.ShadowAccumulator.prototype,"running",null);a.ShadowAccumulator=G=c.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.ShadowAccumulator")],a.ShadowAccumulator);const O=new Uint8Array(4);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowCastRenderer":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../chunks/vec4 ../../../../chunks/vec4f64 ./glUtil3D ../shaders/ShadowCastVisualizeTechnique ../shaders/ShadowCastVisualizeTechniqueConfiguration ../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){const r=g.fromValues(.01,0,.25,1),y=1/512;a.ShadowCastRenderer=function(f){function w(A,x,B,C){var D=f.call(this,{})||this;D._techniqueRepository=A;D._rctx=x;D._shadowAccumulator=B;D._requestRender=C;D._passParameters={shadowCastMap:D._shadowCastTexture,sampleScale:0,color:r,threshold:.5,bandSize:.1,opacityFromElevation:1,__tagStrict:"NoParameters"};D._techniqueConfig=new q.ShadowCastVisualizeTechniqueConfiguration;D._enabled=!1;D._vao=p.createQuadVAO(x);
D._techniqueConfig.visualization=q.ShadowCastVisualization.Gradient;return D}b._inheritsLoose(w,f);var z=w.prototype;z.normalizeCtorArgs=function(){return{}};z.dispose=function(){this._stop();this._vao=l.disposeMaybe(this._vao);this._techniqueRepository.release(this._technique);this._shadowAccumulator=this._technique=null};z.render=function(A){if(this._isRenderingVisualization){this._passParameters.sampleScale=1/this._computedSamples;var x=this.visualizeShadowCastTechnique;this._rctx.bindVAO(this._vao);
this._rctx.bindTechnique(x,this._passParameters,A);this._rctx.drawArrays(x.primitiveType,0,k.vertexCount(this._vao,"geometry"))}};z.setOptions=function(A){void 0!==A.enabled&&this._setEnabled(A.enabled);void 0!==A.color&&this._setColor(A.color);void 0!==A.threshold&&(this._threshold=A.threshold);void 0!==A.visualization&&(this._visualization=A.visualization);void 0!==A.bandSize&&(this._bandSize=A.bandSize);void 0!==A.bandsEnabled&&(this._bandsEnabled=A.bandsEnabled)};z._setColor=function(A){e.exactEquals(A,
this._passParameters.color)||(e.copy(this._passParameters.color,A),this._requestRenderIfRunning())};z._setEnabled=function(A){A!==this._enabled&&(A?this._start():this._stop())};z._requestRenderIfRunning=function(){this._enabled&&this._requestRender()};z._start=function(){this._enabled=!0;this._requestRender()};z._stop=function(){this._enabled=!1;this._requestRender()};b._createClass(w,[{key:"visualizeShadowCastTechnique",get:function(){return this._technique=this._techniqueRepository.releaseAndAcquire(t.ShadowCastVisualizeTechnique,
this._techniqueConfig,this._technique)}},{key:"opacityFromElevation",get:function(){return this._passParameters.opacityFromElevation},set:function(A){this._passParameters.opacityFromElevation!==A&&(this._passParameters.opacityFromElevation=A,this.notifyChange("opacityFromElevation"))}},{key:"_isRenderingVisualization",get:function(){return this._enabled&&0<this._computedSamples&&this.opacityFromElevation>y}},{key:"_computedSamples",get:function(){return this._shadowAccumulator.computedSamples}},{key:"_shadowCastTexture",
get:function(){return this._shadowAccumulator.shadowCastTexture}},{key:"_threshold",get:function(){return this._passParameters.threshold},set:function(A){this._threshold!==A&&(this._passParameters.threshold=A,this._requestRenderIfRunning())}},{key:"_visualization",get:function(){return this._techniqueConfig.visualization},set:function(A){A!==this._visualization&&(this._techniqueConfig.visualization=A,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}},
{key:"_bandSize",get:function(){return this._passParameters.bandSize},set:function(A){A!==this._bandSize&&(this._passParameters.bandSize=A,this._requestRenderIfRunning())}},{key:"_bandsEnabled",get:function(){return this._techniqueConfig.bandsEnabled},set:function(A){A!==this._bandsEnabled&&(this._techniqueConfig.bandsEnabled=A,this._techniqueRepository.release(this._technique),this._technique=null,this._requestRenderIfRunning())}}]);return w}(n);c.__decorate([u.property()],a.ShadowCastRenderer.prototype,
"opacityFromElevation",null);a.ShadowCastRenderer=c.__decorate([d.subclass("esri.views.3d.webgl-engine.lib.ShadowCastRenderer")],a.ShadowCastRenderer);a.shadowCastDisableElevationMax=5E4;a.shadowCastDisableElevationMin=4E4;a.shadowCastDisabledElevationThreshold=y;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/OrderIndependentTransparency ../lib/Program ../../../../chunks/ShadowCastVisualize.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){l=function(g){function p(q,k){var r;return r=g.call(this,q,k,()=>r.destroy())||this}c._inheritsLoose(p,g);var t=p.prototype;t.initializeProgram=function(q){const k=p.shader.get().build(this.configuration);return new m.Program(q.rctx,k,u.Default3D)};t.initializePipeline=function(){return e.makePipelineState({blending:v.blendingDefault,colorWrite:e.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(p,[{key:"primitiveType",get:function(){return d.PrimitiveType.TRIANGLE_STRIP}}]);
return p}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(h.ShadowCastVisualize,()=>new Promise((g,p)=>a(["./ShadowCastVisualize.glsl"],g,p)));b.ShadowCastVisualizeTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ShadowCastVisualize.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ./ShadowCastAccumulate.glsl ../views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){function p(q){const k=new h.ShaderBuilder,r=k.fragment;r.include(l.RgbaFloatEncoding);r.include(c.ReadLinearDepth);k.include(n.CameraSpace);k.include(b.ScreenSpacePass);const {visualization:y,bandsEnabled:f}=q;r.constants.add("inverseSampleValue","float",e.shadowCastMaxSamples);r.uniforms.add([new d.Texture2DPassUniform("shadowCastMap",z=>z.shadowCastMap),new v.FloatPassUniform("sampleScale",z=>z.sampleScale),new v.FloatPassUniform("opacityFromElevation",z=>z.opacityFromElevation),
new u.Float4PassUniform("uColor",z=>z.color)]);q=y===g.ShadowCastVisualization.Gradient;const w=y===g.ShadowCastVisualization.Threshold;q&&f?r.uniforms.add(new v.FloatPassUniform("bandSize",z=>z.bandSize)):w&&r.uniforms.add(new v.FloatPassUniform("threshold",z=>z.threshold));r.code.add(m.glsl`
      void main(void) {
        vec4 record = texture2D(shadowCastMap, uv);
        float pixelSamples = record.r * inverseSampleValue;
        if (pixelSamples < 1.0) {
          discard;
        }

        float strength = pixelSamples * sampleScale;

        ${w?m.glsl`
            if (strength <= threshold) {
              discard;
            }`:""}

        ${q&&f?m.glsl`strength = ceil(strength / bandSize) * bandSize;`:""}

        gl_FragColor = vec4(uColor.xyz, uColor.a * opacityFromElevation ${q?m.glsl`* strength`:""});
      }
    `);return k}const t=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}));a.ShadowCastVisualize=t;a.build=p})},"esri/chunks/ShadowCastAccumulate.glsl":function(){define("exports ./_rollupPluginBabelHelpers ./mat4 ./mat4f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(){const f=new p.ShaderBuilder,w=f.fragment;w.include(h.RgbaFloatEncoding);w.include(u.ReadLinearDepth);f.include(m.CameraSpace);f.include(l.ScreenSpacePass);f.include(v.ReadShadowMapPass,{receiveShadows:!0});w.uniforms.add([new t.Texture2DPassUniform("depthMap",z=>z.linearDepthTexture),new g.Matrix4PassUniform("inverseViewMatrix",(z,A)=>c.invert(y,c.translate(y,A.camera.viewMatrix,A.camera.center))),new d.Float2PassUniform("nearFar",(z,A)=>A.camera.nearFar)]);
w.constants.add("sampleValue","float",r);w.code.add(e.glsl`void main(void) {
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth > nearFar.y || -currentPixelDepth < nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthShadow = readShadowMapDepth(uvShadow, shadowMapTex);
bool shadow = depthShadow < lvpos.z;
if (!shadow) {
discard;
}
gl_FragColor = vec4(sampleValue);
}`);return f}let k=function(f){function w(){return f.apply(this,arguments)||this}b._inheritsLoose(w,f);return w}(v.ReadShadowMapBindParameters);const r=1/255,y=n.create();n=Object.freeze(Object.defineProperty({__proto__:null,ShadowCastAccumulatePassParameters:k,shadowCastMaxSamples:255,build:q},Symbol.toStringTag,{value:"Module"}));a.ShadowCastAccumulate=n;a.ShadowCastAccumulatePassParameters=k;a.build=q;a.shadowCastMaxSamples=255})},"esri/views/3d/webgl-engine/shaders/ShadowCastVisualizeTechniqueConfiguration":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){a.ShadowCastVisualization=void 0;(function(u){u[u.Gradient=0]="Gradient";u[u.Threshold=1]="Threshold";u[u.COUNT=2]="COUNT"})(a.ShadowCastVisualization||(a.ShadowCastVisualization={}));let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.visualization=a.ShadowCastVisualization.Gradient;m.bandsEnabled=!1;return m}b._inheritsLoose(v,u);
return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.ShadowCastVisualization.COUNT})],l.prototype,"visualization",void 0);c.__decorate([n.parameter()],l.prototype,"bandsEnabled",void 0);a.ShadowCastVisualizeTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowCastAccumulateTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowCastAccumulate.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d){l=function(e){function g(t,q){var k;return k=e.call(this,t,q,()=>k.destroy())||this}c._inheritsLoose(g,e);var p=g.prototype;p.initializeProgram=function(t){const q=g.shader.get().build();return new v.Program(t.rctx,q,u.Default3D)};p.initializePipeline=function(){return d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ONE),colorWrite:d.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(g,
[{key:"primitiveType",get:function(){return h.PrimitiveType.TRIANGLE_STRIP}}]);return g}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(m.ShadowCastAccumulate,()=>new Promise((e,g)=>a(["./ShadowCastAccumulate.glsl"],e,g)));b.ShadowCastAccumulateTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/ShadowHighlight":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/mathUtils ../../../../core/maybe ../../../../chunks/vec3 ../../../../chunks/vec3f64 ../../../ViewingMode ../core/shaderLibrary/shading/ReadShadowMap.glsl ./glUtil3D ../shaders/ShadowHighlightTechnique ../../../webgl/Util".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){let g=function(){function t(k,r){this._rctx=k;this._viewingMode=r;this._maxOpacity=1;this._passParameters=new d.ShadowHighlightPassParameters;this._drawParameters=new m.ReadShadowMapBindParameters;this._vao=h.createQuadVAO(this._rctx)}var q=t.prototype;q.render=function(k,r){if(k.shadowMap.enabled&&k.linearDepthTexture&&this.isVisible){var y=this.technique;this._drawParameters.origin=k.camera.center;this._rctx.bindFramebuffer(r);this._rctx.bindTechnique(y,this._passParameters,
k).bindDraw(this._drawParameters,k);this._rctx.bindVAO(this._vao);this._rctx.drawArrays(y.primitiveType,0,e.vertexCount(this._vao,"geometry"))}};q.setDefaultOptions=function(k){this._passParameters={...this._passParameters,...k};this._updateMaxOpacity()};q.updateParameters=function(k,r){this._passParameters.opacityElevation=1-c.smoothstep(4E4,5E4,k.relativeElevation);k=this._viewingMode===v.ViewingMode.Global?l.normalize(p,k.center):l.set(p,0,0,1);r=l.dot(k,r);this._passParameters.dayNightTerminator=
c.smoothstep(0,1,c.clamp(30*r,0,1))};q.dispose=function(){this._vao=n.disposeMaybe(this._vao);this._technique=n.releaseMaybe(this._technique)};q._updateMaxOpacity=function(){this._maxOpacity=Math.max(this._passParameters.shadowOpacity,this._passParameters.occludedShadowOpacity)*this._passParameters.shadowColor[3]};b._createClass(t,[{key:"technique",get:function(){n.isNone(this._technique)&&(this._technique=new d.ShadowHighlightTechnique({rctx:this._rctx,viewingMode:this._viewingMode}));return this._technique}},
{key:"gpuMemoryUsage",get:function(){var k,r;return null!=(k=null==(r=this._vao)?void 0:r.size)?k:0}},{key:"isVisible",get:function(){const {opacityElevation:k,dayNightTerminator:r}=this._passParameters;return.001953125<=this._maxOpacity*k*r}}]);return t}();const p=u.create();a.ShadowHighlight=g;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/ShadowHighlightTechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/vec4f64 ../core/shaderModules/interfaces ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ../lib/DefaultVertexAttributeLocations ../lib/Program ../../../../chunks/ShadowHighlight.glsl ../../../webgl/enums ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){l=function(p){function t(){var q=p.apply(this,arguments)||this;q.shadowColor=n.fromValues(1,0,1,1);q.shadowOpacity=.2;q.occludedShadowOpacity=.1;q.opacityElevation=1;q.dayNightTerminator=1;return q}c._inheritsLoose(t,p);return t}(l.NoParameters);v=function(p){function t(k){var r;return r=p.call(this,k,null,()=>r.destroy())||this}c._inheritsLoose(t,p);var q=t.prototype;q.initializeProgram=function(k){const r=t.shader.get().build();return new h.Program(k.rctx,r,m.Default3D)};
q.initializePipeline=function(){return g.makePipelineState({blending:g.separateBlendingParams(e.BlendFactor.SRC_ALPHA,e.BlendFactor.ONE,e.BlendFactor.ONE_MINUS_SRC_ALPHA,e.BlendFactor.ONE_MINUS_SRC_ALPHA),colorWrite:g.defaultColorWriteParams,depthTest:null,depthWrite:null})};c._createClass(t,[{key:"primitiveType",get:function(){return e.PrimitiveType.TRIANGLE_STRIP}}]);return t}(v.ShaderTechnique);v.shader=new u.ReloadableShaderModule(d.ShadowHighlight,()=>new Promise((p,t)=>a(["./ShadowHighlight.glsl"],
p,t)));b.ShadowHighlightPassParameters=l;b.ShadowHighlightTechnique=v;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/ShadowHighlight.glsl":function(){define("exports ../core/maybe ./mat4 ./mat4f64 ./vec2 ./vec2f64 ./vec3 ./vec3f64 ../views/3d/webgl-engine/core/shaderLibrary/ScreenSpacePass ../views/3d/webgl-engine/core/shaderLibrary/output/OutputHighlight.glsl ../views/3d/webgl-engine/core/shaderLibrary/output/ReadLinearDepth.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/ReadShadowMap.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/CameraSpace.glsl ../views/3d/webgl-engine/core/shaderLibrary/util/RgbaFloatEncoding.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float3PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4PassUniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DPassUniform ../views/3d/webgl-engine/lib/ShadowMap".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x){function B(){const G=new z.ShaderBuilder;G.include(g.ReadShadowMapDraw,{receiveShadows:!0});const O=G.fragment;O.include(t.RgbaFloatEncoding);O.include(e.ReadLinearDepth);G.include(p.CameraSpace);G.include(h.ScreenSpacePass);O.uniforms.add([new A.Texture2DPassUniform("defaultDepthTex",(K,L)=>L.shadowMap.getSnapshot(x.SnapshotSlot.Default)),new A.Texture2DPassUniform("highlightDepthTex",(K,L)=>L.shadowMap.getSnapshot(x.SnapshotSlot.Highlight)),
new A.Texture2DPassUniform("depthMap",(K,L)=>L.linearDepthTexture),new A.Texture2DPassUniform("highlightMap",(K,L)=>L.highlightColorTexture),new r.Float4PassUniform("uColor",K=>K.shadowColor),new q.Float2PassUniform("nearFar",(K,L)=>L.camera.nearFar),new y.FloatPassUniform("opacity",K=>K.shadowOpacity),new y.FloatPassUniform("occludedOpacity",K=>K.occludedShadowOpacity),new y.FloatPassUniform("terminationFactor",K=>K.opacityElevation*K.dayNightTerminator),new k.Float3PassUniform("lightingMainDirectionView",
(K,L)=>v.normalize(E,v.transformMat4(E,L.lighting.lightingMainDirection,L.camera.viewInverseTransposeMatrix))),new q.Float2PassUniform("texelSize",(K,L)=>b.isSome(L.linearDepthTexture)?l.set(F,1/L.linearDepthTexture.descriptor.width,1/L.linearDepthTexture.descriptor.height):u.ZEROS),new w.Matrix4PassUniform("inverseViewMatrix",(K,L)=>c.invert(D,c.translate(D,L.camera.viewMatrix,L.camera.center)))]);O.constants.add("unoccludedHighlightFlag","vec4",d.unoccludedHighlightFlag).add("highlightedThreshold",
"float",C.highlightedThreshold).add("selfShadowThreshold","float",C.selfShadowThreshold);O.code.add(f.glsl`vec3 normalFromDepth(vec3 pixelPos, vec2 fragCoord, vec2 uv, vec2 texelSize, sampler2D depthMap, vec2 nearFar) {
float leftPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(-1.0, 0.0) * texelSize, nearFar);
float rightPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(1.0, 0.0) * texelSize, nearFar);
float bottomPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, -1.0) * texelSize, nearFar);
float topPixelDepth = linearDepthFromTexture(depthMap, uv + vec2(0.0, 1.0) * texelSize, nearFar);
bool pickLeft = abs(pixelPos.z - leftPixelDepth) < abs(pixelPos.z - rightPixelDepth);
bool pickBottom = abs(pixelPos.z - bottomPixelDepth) < abs(pixelPos.z - topPixelDepth);
vec3 fragCoordHorizontal = pickLeft
? vec3(fragCoord + vec2(-1.0, 0.0), leftPixelDepth)
: vec3(fragCoord + vec2(1.0, 0.0), rightPixelDepth);
vec3 fragCoordVertical = pickBottom
? vec3(fragCoord + vec2(0.0, -1.0), bottomPixelDepth)
: vec3(fragCoord + vec2(0.0, 1.0), topPixelDepth);
vec3 verticalPixelPos = reconstructPosition(fragCoordHorizontal.xy, fragCoordHorizontal.z);
vec3 horizontalPixelPos = reconstructPosition(fragCoordVertical.xy, fragCoordVertical.z);
vec3 normal = normalize(cross(verticalPixelPos - pixelPos, horizontalPixelPos - pixelPos));
return pickLeft == pickBottom ? normal : -normal;
}`);O.code.add(f.glsl`void main(void) {
vec4 highlightInfo = texture2D(highlightMap, uv);
float visiblyHighlighted = (1.0 - clamp(distance(unoccludedHighlightFlag, highlightInfo), 0.0, 1.0)) * highlightInfo.a;
if (visiblyHighlighted > highlightedThreshold) {
discard;
}
float depth = rgba2float(texture2D(depthMap, uv));
if (depth == 0.0) {
discard;
}
float currentPixelDepth = linearDepthFromFloat(depth, nearFar);
if (-currentPixelDepth>nearFar.y || -currentPixelDepth<nearFar.x) {
discard;
}
vec4 currentPixelPos = vec4(reconstructPosition(gl_FragCoord.xy, currentPixelDepth), 1.0);
vec4 worldSpacePos = inverseViewMatrix * currentPixelPos;
mat4 shadowMatrix;
float linearDepth = -currentPixelDepth;
int i = chooseCascade(linearDepth, shadowMatrix);
if (i >= numCascades) {
discard;
}
vec3 lvpos = lightSpacePosition(worldSpacePos.xyz, shadowMatrix);
if (lvpos.z >= 1.0 || lvpos.x < 0.0 || lvpos.x > 1.0 || lvpos.y < 0.0 || lvpos.y > 1.0) {
discard;
}
vec2 uvShadow = cascadeCoordinates(i, lvpos);
float depthHighlight = readShadowMapDepth(uvShadow, highlightDepthTex);
bool shadowHighlight = depthHighlight < lvpos.z;
if (!shadowHighlight) {
discard;
}
float depthDefault = readShadowMapDepth(uvShadow, defaultDepthTex);
bool shadowDefault = depthDefault < lvpos.z;
vec3 normal = normalFromDepth(currentPixelPos.xyz, gl_FragCoord.xy, uv, texelSize, depthMap, nearFar);
bool shaded = dot(normal, lightingMainDirectionView) < selfShadowThreshold;
float fragOpacity = (shadowDefault || shaded) ? occludedOpacity : opacity;
gl_FragColor = vec4(uColor.rgb, uColor.a * fragOpacity * terminationFactor);
}`);return G}const C={highlightedThreshold:.99999,selfShadowThreshold:.025},D=n.create(),E=m.create(),F=u.create();n=Object.freeze(Object.defineProperty({__proto__:null,build:B},Symbol.toStringTag,{value:"Module"}));a.ShadowHighlight=n;a.build=B})},"esri/views/3d/webgl-engine/lib/SliceHelper":function(){define(["../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/boundedPlane"],function(a,b){const c=b.create();return function(){function n(){this._plane=b.create()}a._createClass(n,[{key:"isEnabled",
get:function(){return!b.equals(this.plane,c)}},{key:"plane",get:function(){return this._plane},set:function(l){b.copy(l||c,this._plane)}}]);return n}()})},"esri/views/3d/webgl-engine/lib/SmaaRenderPass":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ../../../../support/requestImageUtils ./glUtil3D ./SMAATechnique ./SMAATechniqueConfiguration ../../../webgl/enums ../../../webgl/FramebufferObject ../../../webgl/Texture".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){b.SmaaRenderPass=function(w){function z(x,B){var C=w.call(this,{})||this;C.rctx=x;C._techniqueRep=B;C._isEnabled=!1;return C}c._inheritsLoose(z,w);var A=z.prototype;A.normalizeCtorArgs=function(){return{}};A.dispose=function(){this._abortController=u.abortMaybe(this._abortController);this.disable()};A._loadResources=function(x){if(u.isSome(this._abortController))return!1;if(u.isSome(this._searchTexture))return!0;this._abortController=new AbortController;
const B=this._abortController.signal;(new Promise((C,D)=>a(["./SmaaRenderPassData"],C,D))).then(C=>this._loadTextures(C,B)).then(()=>x()).finally(()=>this._abortController=null);return!1};A._loadTextures=function(x,B){v.throwIfAborted(B);return Promise.all([this._loadTextureFromBase64(x.areaTexture,r.TextureSamplingMode.LINEAR,r.PixelFormat.RGB),this._loadTextureFromBase64(x.searchTexure,r.TextureSamplingMode.NEAREST,r.PixelFormat.LUMINANCE)]).then(([C,D])=>{v.isAborted(B)?(C.dispose(),D.dispose(),
v.throwIfAborted(B)):(this._areaTexture=C,this._searchTexture=D)})};A.enable=function(x){if(this._isEnabled)return!0;if(!this._edgeDetectTechnique||!this._blendWeightsTechnique||!this._blurTechnique){const B=new k.SMAATechniqueConfiguration,C=(D,E)=>this._techniqueRep.releaseAndAcquire(q.SMAATechnique,D,E);B.output=k.SMAAOutput.EdgeDetector;this._edgeDetectTechnique=C(B,this._edgeDetectTechnique);B.output=k.SMAAOutput.BlendWeight;this._blendWeightsTechnique=C(B,this._blendWeightsTechnique);B.output=
k.SMAAOutput.Blur;this._blurTechnique=C(B,this._blurTechnique)}if(!this._loadResources(x))return!1;this._vao=t.createScreenSizeTriangleVAO(this.rctx);this._edges=new y.FramebufferObject(this.rctx,{colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.NONE},{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGB,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.LINEAR,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});this._blend=new y.FramebufferObject(this.rctx,
{colorTarget:r.TargetType.TEXTURE,depthStencilTarget:r.DepthStencilTargetType.NONE},{target:r.TextureType.TEXTURE_2D,pixelFormat:r.PixelFormat.RGBA,dataType:r.PixelType.UNSIGNED_BYTE,samplingMode:r.TextureSamplingMode.LINEAR,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,width:4,height:4});return this._isEnabled=!0};A.disable=function(){this._isEnabled&&(this._vao=u.disposeMaybe(this._vao),this._areaTexture=u.disposeMaybe(this._areaTexture),this._searchTexture=u.disposeMaybe(this._searchTexture),this._blend=
u.disposeMaybe(this._blend),this._edges=u.disposeMaybe(this._edges),this._isEnabled=!1)};A.render=function(x){if(this._isEnabled){var B=this.rctx,C=B.getBoundFramebufferObject(),D=x.descriptor.width,E=x.descriptor.height;B.bindVAO(this._vao);B.setViewport(0,0,D,E);this._edges.resize(D,E);B.bindFramebuffer(this._edges);B.setClearColor(0,0,0,1);B.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);var F=B.bindTechnique(this._edgeDetectTechnique);F.bindTexture("tColor",x);F.setUniform4f("resolution",1/D,1/E,D,
E);B.drawArrays(r.PrimitiveType.TRIANGLES,0,3);this._blend.resize(D,E);B.bindFramebuffer(this._blend);B.setClearColor(0,0,1,1);B.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);F=B.bindTechnique(this._blendWeightsTechnique);F.setUniform4f("resolution",1/D,1/E,D,E);F.bindTexture("tSearch",this._searchTexture);F.bindTexture("tArea",this._areaTexture);F.bindTexture("tEdges",this._edges.colorTexture);B.drawArrays(r.PrimitiveType.TRIANGLES,0,3);B.bindFramebuffer(C);B.setClearColor(0,1,0,1);B.clear(r.ClearBufferBit.COLOR_BUFFER_BIT);
C=B.bindTechnique(this._blurTechnique);C.setUniform4f("resolution",1/D,1/E,D,E);C.bindTexture("tColor",x);C.bindTexture("tBlendWeights",this._blend.colorTexture);B.drawArrays(r.PrimitiveType.TRIANGLES,0,3)}};A._loadTextureFromBase64=function(x,B,C){return p.requestImage(x).then(D=>new f.Texture(this.rctx,{pixelFormat:C,dataType:r.PixelType.UNSIGNED_BYTE,wrapMode:r.TextureWrapMode.CLAMP_TO_EDGE,width:D.width,height:D.height,samplingMode:B},D))};c._createClass(z,[{key:"updating",get:function(){return u.isSome(this._abortController)}}]);
return z}(l);n.__decorate([m.property()],b.SmaaRenderPass.prototype,"_abortController",void 0);n.__decorate([m.property({readOnly:!0})],b.SmaaRenderPass.prototype,"updating",null);b.SmaaRenderPass=n.__decorate([g.subclass("esri.views.3d.webgl-engine.lib.SmaaRenderPass")],b.SmaaRenderPass);Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/SMAATechnique":function(){define("require exports ../../../../chunks/_rollupPluginBabelHelpers ../core/shaderTechnique/ReloadableShaderModule ../core/shaderTechnique/ShaderTechnique ./DefaultVertexAttributeLocations ./Program ../../../../chunks/SMAA.glsl ../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h){l=function(d){function e(){return d.apply(this,arguments)||this}c._inheritsLoose(e,d);var g=e.prototype;g.initializeProgram=function(p){const t=e.shader.get().build(this.configuration);return new v.Program(p.rctx,t,u.Default3D)};g.initializePipeline=function(){return h.makePipelineState({colorWrite:h.defaultColorWriteParams})};return e}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(m.SMAA,()=>new Promise((d,e)=>a(["../shaders/SMAA.glsl"],d,e)));b.SMAATechnique=
l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/SMAA.glsl":function(){define("exports ../views/3d/webgl-engine/core/shaderModules/Float4Uniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/core/shaderModules/Texture2DUniform ../views/3d/webgl-engine/lib/SMAATechniqueConfiguration ../views/3d/webgl-engine/lib/VertexAttribute".split(" "),function(a,
b,c,n,l,u,v){function m(e){const g=new n.ShaderBuilder;e.output===u.SMAAOutput.EdgeDetector&&(g.attributes.add(v.VertexAttribute.POSITION,"vec2"),g.vertex.uniforms.add(new b.Float4Uniform("resolution")),g.varyings.add("fTexCoord","vec2"),g.varyings.add("fOffset[3]","vec4"),g.vertex.code.add(c.glsl`void SMAAEdgeDetectionVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0,  1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4(  1.0, 0.0, 0.0, -1.0 );
fOffset[2] = texcoord.xyxy + resolution.xyxy * vec4( -2.0, 0.0, 0.0,  2.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAAEdgeDetectionVS( fTexCoord );
}`),g.fragment.uniforms.add(new l.Texture2DUniform("tColor")),g.fragment.code.add(c.glsl`
      vec4 SMAAColorEdgeDetectionPS( vec2 texcoord, vec4 offset[3], sampler2D colorTex ) {
        vec2 threshold = vec2( ${c.glsl.float(h.threshold)} );

        // Calculate color deltas:
        vec4 delta;
        vec3 C = texture2D( colorTex, texcoord ).rgb;

        vec3 Cleft = texture2D( colorTex, offset[0].xy ).rgb;
        vec3 t = abs( C - Cleft );
        delta.x = max( max( t.r, t.g ), t.b );

        vec3 Ctop = texture2D( colorTex, offset[0].zw ).rgb;
        t = abs( C - Ctop );
        delta.y = max( max( t.r, t.g ), t.b );

        // We do the usual threshold:
        vec2 edges = step( threshold, delta.xy );

        // Then discard if there is no edge:
        if ( dot( edges, vec2( 1.0, 1.0 ) ) == 0.0 )
            discard;

        // Calculate right and bottom deltas:
        vec3 Cright = texture2D( colorTex, offset[1].xy ).rgb;
        t = abs( C - Cright );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Cbottom  = texture2D( colorTex, offset[1].zw ).rgb;
        t = abs( C - Cbottom );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the maximum delta in the direct neighborhood:
        float maxDelta = max( max( max( delta.x, delta.y ), delta.z ), delta.w );

        // Calculate left-left and top-top deltas:
        vec3 Cleftleft  = texture2D( colorTex, offset[2].xy ).rgb;
        t = abs( C - Cleftleft );
        delta.z = max( max( t.r, t.g ), t.b );

        vec3 Ctoptop = texture2D( colorTex, offset[2].zw ).rgb;
        t = abs( C - Ctoptop );
        delta.w = max( max( t.r, t.g ), t.b );

        // Calculate the final maximum delta:
        maxDelta = max( max( maxDelta, delta.z ), delta.w );

        // Local contrast adaptation in action:
        edges.xy *= step( maxDelta, float(${c.glsl.float(h.localConstrastAdaption)}) * delta.xy );

        return vec4( edges, 0.0, 0.0 );
      }

      void main() {
        gl_FragColor = SMAAColorEdgeDetectionPS( fTexCoord, fOffset, tColor );
      }
    `));e.output===u.SMAAOutput.BlendWeight&&(g.attributes.add(v.VertexAttribute.POSITION,"vec2"),g.vertex.uniforms.add(new b.Float4Uniform("resolution")),g.varyings.add("fTexCoord","vec2"),g.varyings.add("fOffset[3]","vec4"),g.varyings.add("fPixCoord","vec2"),g.vertex.code.add(c.glsl`
      void SMAABlendingWeightCalculationVS( vec2 texcoord ) {
        fPixCoord = texcoord * resolution.zw;
        fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -0.25, 0.125, 1.25, 0.125 );
        fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( -0.125, 0.25, -0.125, -1.25 );
        fOffset[2] = vec4( fOffset[0].xz, fOffset[1].yw ) + vec4( -2.0, 2.0, -2.0, 2.0 ) * resolution.xxyy * float( ${c.glsl.int(h.maxSearchSteps)} );
      }

      void main() {
        fTexCoord = (position + 1.0 ) * 0.5;
        gl_Position = vec4(position, 0, 1);
        SMAABlendingWeightCalculationVS( fTexCoord );
      }
    `),g.fragment.uniforms.add(new l.Texture2DUniform("tEdges")),g.fragment.uniforms.add(new l.Texture2DUniform("tArea")),g.fragment.uniforms.add(new l.Texture2DUniform("tSearch")),g.fragment.uniforms.add(new l.Texture2DUniform("tColor")),g.fragment.uniforms.add(new b.Float4Uniform("resolution")),g.fragment.code.add(c.glsl`
      #define SMAA_AREATEX_PIXEL_SIZE ( 1.0 / vec2( 160.0, 560.0 ) )
      #define SMAA_AREATEX_SUBTEX_SIZE ( 1.0 / 7.0 )

      vec4 SMAASampleLevelZeroOffset(sampler2D texture, vec2 coord, vec2 offset) {
        return texture2D(texture, coord + offset.x * resolution.xy, 0.0);
      }

      vec2 round( vec2 x ) {
        return sign( x ) * floor( abs( x ) + 0.5 );
      }

      float SMAASearchLength( sampler2D searchTex, vec2 e, float bias, float scale ) {
        e.r = bias + e.r * scale;
        return 255.0 * texture2D( searchTex, e, 0.0 ).r;
      }

      float SMAASearchXLeft( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(h.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x > end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x += 0.25 * resolution.x;
        texcoord.x += resolution.x;
        texcoord.x += 2.0 * resolution.x;
        texcoord.x -= resolution.x * SMAASearchLength(searchTex, e, 0.0, 0.5);
        return texcoord.x;
      }

      float SMAASearchXRight( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 0.0, 1.0 );
        for ( int i = 0; i < ${c.glsl.int(h.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 2.0, 0.0 ) * resolution.xy;
          if ( ! ( texcoord.x < end && e.g > 0.8281 && e.r == 0.0 ) ) break;
        }
        texcoord.x -= 0.25 * resolution.x;
        texcoord.x -= resolution.x;
        texcoord.x -= 2.0 * resolution.x;
        texcoord.x += resolution.x * SMAASearchLength( searchTex, e, 0.5, 0.5 );
        return texcoord.x;
      }

      float SMAASearchYUp( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(h.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord += vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y > end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y -= 0.25 * resolution.y;
        texcoord.y -= resolution.y;
        texcoord.y -= 2.0 * resolution.y;
        texcoord.y += resolution.y * SMAASearchLength( searchTex, e.gr, 0.0, 0.5 );
        return texcoord.y;
      }

      float SMAASearchYDown( sampler2D edgesTex, sampler2D searchTex, vec2 texcoord, float end ) {
        vec2 e = vec2( 1.0, 0.0 );
        for ( int i = 0; i < ${c.glsl.int(h.maxSearchSteps)}; i ++ ) {
          e = texture2D( edgesTex, texcoord, 0.0 ).rg;
          texcoord -= vec2( 0.0, 2.0 ) * resolution.xy;
          if ( ! ( texcoord.y < end && e.r > 0.8281 && e.g == 0.0 ) ) break;
        }
        texcoord.y += 0.25 * resolution.y;
        texcoord.y += resolution.y;
        texcoord.y += 2.0 * resolution.y;
        texcoord.y -= resolution.y * SMAASearchLength( searchTex, e.gr, 0.5, 0.5 );
        return texcoord.y;
      }

      vec2 SMAAArea( sampler2D areaTex, vec2 dist, float e1, float e2, float offset ) {
        vec2 texcoord = float( ${c.glsl.int(h.maxDistanceAreaTex)} ) * round( 4.0 * vec2( e1, e2 ) ) + dist;
        texcoord = SMAA_AREATEX_PIXEL_SIZE * texcoord + ( 0.5 * SMAA_AREATEX_PIXEL_SIZE );
        texcoord.y += SMAA_AREATEX_SUBTEX_SIZE * offset;
        return texture2D( areaTex, texcoord, 0.0 ).rg;
      }

      vec4 SMAABlendingWeightCalculationPS( vec2 texcoord, vec2 pixcoord, vec4 offset[ 3 ], sampler2D edgesTex, sampler2D areaTex, sampler2D searchTex, ivec4 subsampleIndices ) {
        vec4 weights = vec4( 0.0, 0.0, 0.0, 0.0 );
        vec2 e = texture2D( edgesTex, texcoord ).rg;
        if ( e.g > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.x = SMAASearchXLeft( edgesTex, searchTex, offset[ 0 ].xy, offset[ 2 ].x );
          coords.y = offset[ 1 ].y;
          d.x = coords.x;
          float e1 = texture2D( edgesTex, coords, 0.0 ).r;
          coords.x = SMAASearchXRight( edgesTex, searchTex, offset[ 0 ].zw, offset[ 2 ].y );
          d.y = coords.x;
          d = d * resolution.z - pixcoord.x;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 1.0, 0.0 ) ).r;
          weights.rg = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.y ) );
        }

        if ( e.r > 0.0 ) {
          vec2 d;
          vec2 coords;
          coords.y = SMAASearchYUp( edgesTex, searchTex, offset[ 1 ].xy, offset[ 2 ].z );
          coords.x = offset[ 0 ].x;
          d.x = coords.y;
          float e1 = texture2D( edgesTex, coords, 0.0 ).g;
          coords.y = SMAASearchYDown( edgesTex, searchTex, offset[ 1 ].zw, offset[ 2 ].w );
          d.y = coords.y;
          d = d * resolution.w - pixcoord.y;
          vec2 sqrt_d = sqrt( abs( d ) );
          coords.y -= 1.0 * resolution.y;
          float e2 = SMAASampleLevelZeroOffset( edgesTex, coords, vec2( 0.0, 1.0 ) ).g;
          weights.ba = SMAAArea( areaTex, sqrt_d, e1, e2, float( subsampleIndices.x ) );

          // for some reason the following lines are necessary to prevent
          // texture lookup precision issues on some Intel integrated graphics chips
          vec4 dbg = (offset[ 0 ]+offset[ 1 ]+offset[ 2 ] + coords.xyyx);
          weights.r += 0.00000001 * dot(vec4(0,1,0,1),dbg);
        }
        return weights;
      }

      void main() {
        gl_FragColor = SMAABlendingWeightCalculationPS( fTexCoord, fPixCoord, fOffset, tEdges, tArea, tSearch, ivec4( 0.0 ) );
      }
    `));e.output===u.SMAAOutput.Blur&&(g.attributes.add(v.VertexAttribute.POSITION,"vec2"),g.vertex.uniforms.add(new b.Float4Uniform("resolution")),g.varyings.add("fTexCoord","vec2"),g.varyings.add("fOffset[2]","vec4"),g.vertex.code.add(c.glsl`void SMAANeighborhoodBlendingVS( vec2 texcoord ) {
fOffset[0] = texcoord.xyxy + resolution.xyxy * vec4( -1.0, 0.0, 0.0, 1.0 );
fOffset[1] = texcoord.xyxy + resolution.xyxy * vec4( 1.0, 0.0, 0.0, -1.0 );
}
void main() {
fTexCoord = (position + 1.0 ) * 0.5;
gl_Position = vec4(position, 0, 1);
SMAANeighborhoodBlendingVS(fTexCoord);
}`),g.fragment.uniforms.add(new l.Texture2DUniform("tBlendWeights")),g.fragment.uniforms.add(new l.Texture2DUniform("tColor")),g.fragment.uniforms.add(new b.Float4Uniform("resolution")),g.fragment.code.add(c.glsl`vec4 SMAANeighborhoodBlendingPS( vec2 texcoord, vec4 offset[ 2 ], sampler2D colorTex, sampler2D blendTex ) {
vec4 a;
a.xz = texture2D( blendTex, texcoord ).xz;
a.y = texture2D( blendTex, offset[ 1 ].zw ).g;
a.w = texture2D( blendTex, offset[ 1 ].xy ).a;
if ( dot(a, vec4( 1.0, 1.0, 1.0, 1.0 )) < 1e-5 ) {
return texture2D( colorTex, texcoord, 0.0 );
} else {
vec2 offset;
offset.x = a.a > a.b ? a.a : -a.b;
offset.y = a.g > a.r ? -a.g : a.r;
if ( abs( offset.x ) > abs( offset.y )) {
offset.y = 0.0;
} else {
offset.x = 0.0;
}
vec4 C = texture2D( colorTex, texcoord, 0.0 );
texcoord += sign( offset ) * resolution.xy;
vec4 Cop = texture2D( colorTex, texcoord, 0.0 );
float s = abs( offset.x ) > abs( offset.y ) ? abs( offset.x ) : abs( offset.y );
vec4 mixed = mix(C, Cop, s);
return mixed;
}
}
void main() {
gl_FragColor = SMAANeighborhoodBlendingPS( fTexCoord, fOffset, tColor, tBlendWeights );
}`));return g}const h={threshold:.05,localConstrastAdaption:2,maxSearchSteps:8,maxDistanceAreaTex:16},d=Object.freeze(Object.defineProperty({__proto__:null,build:m},Symbol.toStringTag,{value:"Module"}));a.SMAA=d;a.build=m})},"esri/views/3d/webgl-engine/lib/SMAATechniqueConfiguration":function(){define(["exports","../../../../chunks/_rollupPluginBabelHelpers","../../../../chunks/tslib.es6","../core/shaderTechnique/ShaderTechniqueConfiguration"],function(a,b,c,n){a.SMAAOutput=void 0;(function(u){u[u.EdgeDetector=
0]="EdgeDetector";u[u.BlendWeight=1]="BlendWeight";u[u.Blur=2]="Blur";u[u.COUNT=3]="COUNT"})(a.SMAAOutput||(a.SMAAOutput={}));let l=function(u){function v(){var m=u.apply(this,arguments)||this;m.output=a.SMAAOutput.EdgeDetector;return m}b._inheritsLoose(v,u);return v}(n.ShaderTechniqueConfiguration);c.__decorate([n.parameter({count:a.SMAAOutput.COUNT})],l.prototype,"output",void 0);a.SMAATechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeView":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../core/Accessor ../../../../../core/arrayUtils ../../../../../core/Logger ../../../../../core/mathUtils ../../../../../core/maybe ../../../../../core/promiseUtils ../../../../../core/accessorSupport/decorators/property ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../chunks/mat3 ../../../../../chunks/mat3f64 ../../../../../chunks/mat4f64 ../../../../../chunks/vec3 ../../../../../chunks/vec3f64 ../../../../../core/support/WatchUpdatingTracking ../../../../../chunks/sphere ../../../../../chunks/vec33 ../../../../ViewingMode ../../collections/Component/Material/shader/ComponentData.glsl ../../core/util/TwoVectorPosition ../GridLocalOriginFactory ../localOriginHelper ../LocalOriginManager ../Object3D ../VertexAttribute ./bufferLayouts ./edgeBufferWriters ./edgePreprocessing ./EdgeRenderer ./EdgeShaderParameters ./EdgeWorkerHandle ./interfaces ./strokes ./util ../TextureBackedBuffer/BufferManager ../../../../webgl/BufferObject ../../../../webgl/enums ../../../../webgl/VertexArrayObject".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B,C,D,E,F,G,O,K,L,R,M,J,I,P,N,V,S,T,H){function U(ba){let aa=null,ea=null;for(let ka=0;ka<ba.geometries.length;ka++){var ia;const la=ba.geometryRecords[ka];if(la.material.supportsEdges){if(!aa)aa=la.transformation;else if(!l.equals(aa,la.transformation))return!1;if(!ea&&m.isSome(la.origin))ea=la;else if(m.isSome(null==(ia=ea)?void 0:ia.origin)&&m.isSome(la.origin)&&ea.origin.id!==la.origin.id)return!1}}return!0}const W=u.getLogger("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView");
a.EdgeView=function(ba){function aa(ia){var ka=ba.call(this,ia)||this;ka.updatingHandles=new f.WatchUpdatingTracking;ka.perObjectData=new Map;ka.perObjectDataEvictionCache=new Set;ka.renderers=new Map;ka.numberOfRenderedEdges={[I.Transparency.TRANSPARENT]:0,[I.Transparency.OPAQUE]:0};ka.gpuMemoryUsage=0;ka.workerAbort=new AbortController;ka.tmpModelPosition=y.create();ka.localOrigins=new E.LocalOriginManager(new C.GridLocalOriginFactory(ia.renderSR));return ka}b._inheritsLoose(aa,ba);var ea=aa.prototype;
ea.initialize=function(){this.worker=new J(this.schedule);this.componentColorManager=new V.BufferManager(this.rctx,3);const ia=O.VertexLayout.createBuffer(4);for(let ka=0;4>ka;ka++)ia.sideness.set(ka,0,0===ka||3===ka?0:1),ia.sideness.set(ka,1,0===ka||1===ka?0:1);this.verticesBufferObject=S.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ia.buffer)};ea.destroy=function(){this.destroyed||(this.perObjectData.forEach(ia=>this._discardObjectEntry(ia)),this.perObjectData.clear(),this.strokesTexture=
m.disposeMaybe(this.strokesTexture),this.componentColorManager=m.destroyMaybe(this.componentColorManager),this.workerAbort.abort(),this.worker.destroy(),this.verticesBufferObject=m.disposeMaybe(this.verticesBufferObject),this.renderers.clear(),this.updatingHandles.destroy())};ea.shouldRender=function(){return 0<this.renderers.size};ea.addComponentObject=function(){var ia=b._asyncToGenerator(function*(ka,la,Z,ca,Y,da,ha,ja){if(this.hasObject(ka))return this.getObjectMemoryUsage(ka);let ma;Z=new Q(new Promise(pa=>
ma=pa),Z.center,Z.radius);this.perObjectData.set(ka,Z);ka=yield this.updatingHandles.addPromise(this._addComponentGeometry(la,Z,ca,Y,da,ha,ja));this.setNeedsRender();ma();return ka});return function(ka,la,Z,ca,Y,da,ha,ja){return ia.apply(this,arguments)}}();ea.addOrUpdateObject3D=function(){var ia=b._asyncToGenerator(function*(ka,la,Z,ca){if(this.destroyed)W.warn("Attempt to add an object to a destroyed instance");else{var Y=this.perObjectData.get(ka);0<(null==Y?void 0:Y.renderables.length)&&this.perObjectDataEvictionCache.add(Y);
var da,ha=ka.boundingVolumeWorldSpace.bounds;ha=new Q(new Promise(ma=>da=ma),w.getCenter(ha),w.getRadius(ha));this.perObjectData.set(ka,ha);var ja=[];if(Z.mergeGeometries&&1<ka.geometries.length&&U(ka))ja.push(this._addObjectMergedGeometries(ka,ha,la,Z,ca));else for(let ma=0;ma<ka.geometries.length;ma++){const pa=ka.geometryRecords[ma];pa.material.supportsEdges&&ja.push(this._addGeometry(ka,ha,ka.geometries[ma],pa,la[0],Z,ca))}yield this.updatingHandles.addPromise(Promise.all(ja));this.perObjectDataEvictionCache.delete(ha);
this._discardObjectEntry(Y);this.setNeedsRender();da()}});return function(ka,la,Z,ca){return ia.apply(this,arguments)}}();ea._discardObjectEntry=function(ia){ia&&(ia.renderables.length&&(ia.renderables.forEach(ka=>this._removeRenderable(ka)),this.setNeedsRender()),ia.loaded=null)};ea.hasObject=function(ia){return this.perObjectData.has(ia)};ea.updateAllComponentOpacities=function(){var ia=b._asyncToGenerator(function*(ka,la){const Z=la instanceof Array?ca=>la[ca]:()=>la;(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(ca=>
{const Y=ca.components.meta.length;for(let da=0;da<Y;da++){const ha=Z(da),ja=ca.components.meta[da],ma=ja.index;ja.material.opacity=ha;ca.components.buffer.textureBuffer.setDataElement(ma,1,3,255*ha)}this._updateTransparency(ca)});this.setNeedsRender()});return function(ka,la){return ia.apply(this,arguments)}}();ea.getObjectMemoryUsage=function(){var ia=b._asyncToGenerator(function*(ka){return(yield this._getObjectEntry(ka)).renderables.reduce((la,Z)=>la+Z.statistics.gpuMemoryUsage,0)});return function(ka){return ia.apply(this,
arguments)}}();ea.updateAllComponentMaterials=function(){var ia=b._asyncToGenerator(function*(ka,la,Z,ca){const Y=ka instanceof F.Object3D,da=!!Z.hasSlicePlane,ha=N.determineRendererType(la),ja=R.EdgeRenderer.getKey(ha,da,Y);(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(ma=>{if(ja!==ma.rendererKey){var pa=this.renderers.get(ma.rendererKey);const na=this._acquireRenderer(ha,da,Y);pa.removeRenderable(ma);pa.refCount.decrement();ma.rendererKey=ja;na.addRenderable(ma)}for(pa=
0;pa<la.length;pa++)ma.components.meta[pa].material=la[pa];ca&&this._updateComponentBuffer(ma.components);this._updateTransparency(ma)});this.setNeedsRender()});return function(ka,la,Z,ca){return ia.apply(this,arguments)}}();ea.updateAllVerticalOffsets=function(){var ia=b._asyncToGenerator(function*(ka,la){(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(Z=>{const ca=Z.components.meta;for(let da=0;da<ca.length;da++){var Y;Z.components.meta[da].verticalOffset=null!=
(Y=null==la?void 0:la[da])?Y:0}this._updateComponentBuffer(Z.components)});this.setNeedsRender()});return function(ka,la){return ia.apply(this,arguments)}}();ea.updateObjectVisibility=function(){var ia=b._asyncToGenerator(function*(ka,la){(yield this.updatingHandles.addPromise(this._getObjectEntry(ka))).renderables.forEach(Z=>Z.visible=la);this.setNeedsRender()});return function(ka,la){return ia.apply(this,arguments)}}();ea.removeObject=function(ia){const ka=this.perObjectData.get(ia);ka&&(this.perObjectData.delete(ia),
this._discardObjectEntry(ka))};ea._getObjectEntry=function(){var ia=b._asyncToGenerator(function*(ka){ka=this.perObjectData.get(ka);if(!ka)throw"no object";yield ka.loaded;if(null==ka.loaded)throw h.createAbortError();return ka});return function(ka){return ia.apply(this,arguments)}}();ea.removeAll=function(){this.perObjectData.forEach((ia,ka)=>this.removeObject(ka))};ea.render=function(ia,ka){this.numberOfRenderedEdges[ka]=0;if(!m.isNone(this.componentColorManager)){this.localOrigins.updateViewMatrices(ia.camera.viewMatrix);
var la=ia.camera.viewInverseTransposeMatrix,Z=y.create(),ca=new B.TwoVectorPosition,Y=0,da=0;this.renderers.forEach(ja=>{0===ja.refCount.value?(this.renderers.delete(ja.key),ja.dispose()):ja.forEachRenderable(ma=>{ma.visible&&(Y+=ma.statistics.averageEdgeLength,da++,ma.regular&&ja.updateTechnique(ia,!1),ma.silhouette&&ja.updateTechnique(ia,!0))},ka)});this.componentColorManager.garbageCollect();this.componentColorManager.updateTextures();if(0!==da){var ha=new M.EdgePassParameters(40*Y/da,ia.camera.perScreenPixelRatio,
ka);r.set(Z,la[3],la[7],la[11]);ca.set(Z);r.copy(ha.transformWorldFromViewTH,ca.high);r.copy(ha.transformWorldFromViewTL,ca.low);t.fromMat4(ha.transformViewFromCameraRelativeRS,ia.camera.viewMatrix);t.transpose(X,ha.transformViewFromCameraRelativeRS);t.invert(ha.transformNormalViewFromGlobal,X);ha.transformProjFromView=ia.camera.projectionMatrix;this._updateObjectCameraDistances(ia);this.renderers.forEach(ja=>{this._renderRegularEdges(ja,ia,ha);this._renderSilhouetteEdges(ja,ia,ha)})}}};ea._updateTransparency=
function(ia){const ka=N.determineEdgeTransparency(ia.components.meta),la=N.determineObjectTransparency(ia.components.meta);if(ka!==ia.edgeTransparency||la!==ia.objectTransparency)ia.edgeTransparency=ka,ia.objectTransparency=la,this.renderers.get(ia.rendererKey).setRenderablesDirty()};ea._computeModelTransformWithLocalOrigin=function(ia,ka,la){ia.getCombinedStaticTransformation(ka,la);m.isSome(ka.origin)?this.localOrigins.register(ka.origin):(ia=r.set(this.tmpModelPosition,la[12],la[13],la[14]),ka.origin=
this.localOrigins.acquire(ia));D.applyToModelMatrix(ka.origin.vec3,la);return ka.origin};ea._updateComponentBuffer=function(ia){const {meta:ka,buffer:la}=ia;ia=new Uint8Array(4);for(let ca=0;ca<ka.length;ca++){var Z=ka[ca].material;const Y=ka[ca].index,da=v.clamp(Math.round(Z.size*R.LINE_WIDTH_FRACTION_FACTOR),0,255),ha=v.clamp(Z.extensionLength,-R.EXTENSION_LENGTH_OFFSET,255-R.EXTENSION_LENGTH_OFFSET)+R.EXTENSION_LENGTH_OFFSET,ja="solid"===Z.type?L.EdgeType.SOLID:L.EdgeType.SKETCH,ma=255*Z.opacity;
Z=Z.color;la.textureBuffer.setData(Y,0,255*Z[0],255*Z[1],255*Z[2],255*Z[3]);la.textureBuffer.setData(Y,1,da,ha,ja,ma);x.encodeElevationOffset(ka[ca].verticalOffset,ia);la.textureBuffer.setData(Y,2,ia[0],ia[1],ia[2],ia[3])}};ea._createComponentBuffers=function(ia){if(m.isNone(this.componentColorManager))return null;const ka=[],la=this.componentColorManager.getBuffer(ia.length);for(let Z=0;Z<ia.length;Z++){const ca=ia[Z],Y=la.acquireIndex();ka.push({index:Y,verticalOffset:0,material:ca})}ia={meta:ka,
buffer:la};this._updateComponentBuffer(ia);return ia};ea._extractEdges=function(ia,ka,la,Z,ca,Y=ca.length){return this.worker.process({data:ka,indices:ca,indicesLength:Y,writerSettings:ia,skipDeduplicate:la},this.workerAbort.signal,Z)};ea._createEdgeResources=function(ia){const ka={};if(m.isNone(this.verticesBufferObject))return ka;if(0<ia.regular.lodInfo.lengths.length){var la=new H.VertexArrayObject(this.rctx,O.EdgeShaderAttributeLocations,{vertices:O.glVertexLayout,instances:K.RegularEdgeBufferWriter.glLayout},
{vertices:this.verticesBufferObject,instances:S.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ia.regular.instancesData.buffer)});ka.regular={vao:la,lod:ia.regular.lodInfo}}0<ia.silhouette.lodInfo.lengths.length&&(la=new H.VertexArrayObject(this.rctx,O.EdgeShaderAttributeLocations,{vertices:O.glVertexLayout,instances:K.SilhouetteEdgeBufferWriter.glLayout},{vertices:this.verticesBufferObject,instances:S.BufferObject.createVertex(this.rctx,T.Usage.STATIC_DRAW,ia.silhouette.instancesData.buffer)}),
ka.silhouette={vao:la,lod:ia.silhouette.lodInfo});return ka};ea._addGeometry=function(){var ia=b._asyncToGenerator(function*(ka,la,Z,ca,Y,da,ha){const ja=Z.vertexAttributes.get(G.VertexAttribute.POSITION),ma=Z.indices.get(G.VertexAttribute.POSITION),pa=k.create();ka=this._computeModelTransformWithLocalOrigin(ka,ca,pa);return this._addPositionData(la,{position:ja,indices:ma,modelTransform:pa,origin:ka},Z.edgeIndicesLength,Y,da,ha)});return function(ka,la,Z,ca,Y,da,ha){return ia.apply(this,arguments)}}();
ea._addPositionData=function(){var ia=b._asyncToGenerator(function*(ka,la,Z,ca,Y,da=!1){if(null!=ka.loaded){var ha=this._createComponentBuffers([ca]);if(!(m.isNone(ha)||0>=Z)){ca=this._acquireRenderer(ca.type,!!Y.hasSlicePlane,!0);var {modelTransform:ja,origin:ma}=la;Y=la.indices;la=la.position;var pa=la.data.length/la.size,na=O.EdgeInputBufferLayout.createBuffer(pa);for(let sa=0;sa<pa;sa++)na.position.set(sa,0,la.data[sa*la.size]),na.position.set(sa,1,la.data[sa*la.size+1]),na.position.set(sa,2,
la.data[sa*la.size+2]);N.fillComponenBufferIndices(ha.meta,[0,na.componentIndex.count],na.componentIndex);da=yield this.updatingHandles.addPromise(this._extractEdges(ca.writerSettings,na,!1,da,Y,Z));if(null!=ka.loaded){var {regular:wa,silhouette:xa}=this._createEdgeResources(da);Z=(wa?wa.vao.size:0)+(xa?xa.vao.size:0);ha={regular:wa,silhouette:xa,transform:{modelMatrix:ja,origin:ma},statistics:{gpuMemoryUsage:Z,externalMemoryUsage:!1,averageEdgeLength:da.averageEdgeLength},components:ha,visible:!0,
edgeTransparency:N.determineEdgeTransparency(ha.meta),objectTransparency:N.determineObjectTransparency(ha.meta),distanceToCamera:0,rendererKey:ca.key};ka.renderables.push(ha);ca.addRenderable(ha);this.gpuMemoryUsage+=Z}}}});return function(ka,la,Z,ca,Y){return ia.apply(this,arguments)}}();ea._addComponentGeometry=function(){var ia=b._asyncToGenerator(function*(ka,la,Z,ca,Y,da,ha){if(null==la.loaded)return 0;const ja=this._createComponentBuffers(da);if(m.isNone(ja))return 0;da=N.determineRendererType(da);
ha=this._acquireRenderer(da,ha.hasSlicePlane||!1,!1);da=O.EdgeInputBufferLayout.createBuffer(Z.count);z.copy(da.position,Z);N.fillComponenBufferIndices(ja.meta,Y,da.componentIndex,ca);ca=yield this.updatingHandles.addPromise(this._extractEdges(ha.writerSettings,da,!0,!1,ca));if(null==la.loaded)return 0;const {regular:ma,silhouette:pa}=this._createEdgeResources(ca);Z=(ma?ma.vao.size:0)+(pa?pa.vao.size:0);ka={regular:ma,silhouette:pa,transform:ka,statistics:{gpuMemoryUsage:Z,externalMemoryUsage:!0,
averageEdgeLength:ca.averageEdgeLength},components:ja,visible:!0,edgeTransparency:N.determineEdgeTransparency(ja.meta),objectTransparency:N.determineObjectTransparency(ja.meta),distanceToCamera:0,rendererKey:ha.key};la.renderables.push(ka);ha.addRenderable(ka);return Z});return function(ka,la,Z,ca,Y,da,ha){return ia.apply(this,arguments)}}();ea._addObjectMergedGeometries=function(){var ia=b._asyncToGenerator(function*(ka,la,Z,ca,Y){var da=new Map,ha=0,ja=null,ma=0;for(var pa=0;pa<ka.geometries.length;pa++){var na=
ka.geometries[pa],wa=ka.geometryRecords[pa];wa.material.supportsEdges&&(!ja&&wa.origin&&(ja=wa),wa=na.vertexAttributes.get(G.VertexAttribute.POSITION),ma+=wa.data.length/wa.size,ha+=na.edgeIndicesLength)}ma=65536<=ma?Uint32Array:Uint16Array;ha=ha?new ma(ha):null;ma=[];pa=0;for(na=0;na<ka.geometries.length;na++){wa=ka.geometries[na];if(!ka.geometryRecords[na].material.supportsEdges)continue;var xa=wa.vertexAttributes.get(G.VertexAttribute.POSITION);const sa=wa.indices.get(G.VertexAttribute.POSITION);
let ya=da.get(xa.data);if(null==ya){ya=ma.length/3;for(let ra=0;ra<xa.data.length;ra+=xa.size)ma.push(xa.data[ra+0]),ma.push(xa.data[ra+1]),ma.push(xa.data[ra+2]);da.set(xa.data,ya)}if(sa)for(xa=0;xa<wa.edgeIndicesLength;xa++)ha[pa++]=ya+sa[xa]}ja=ja||ka.geometryRecords[0];da=k.create();ja=this._computeModelTransformWithLocalOrigin(ka,ja,da);for(pa=0;pa<ka.geometryRecords.length;pa++)ka.geometryRecords[pa].origin=ja;yield this.updatingHandles.addPromise(this._addPositionData(la,{position:{data:ma,
size:3},indices:ha,modelTransform:da,origin:ja},ha.length,Z[0],ca,Y))});return function(ka,la,Z,ca,Y){return ia.apply(this,arguments)}}();ea._acquireRenderer=function(ia,ka,la){const Z=R.EdgeRenderer.getKey(ia,ka,la);let ca=this.renderers.get(Z);m.isNone(this.strokesTexture)&&(this.strokesTexture=P.generateStrokesTexture(this.rctx));ca||(ca=new R.EdgeRenderer(this.rctx,this.techniqueRepository,{type:ia,hasSlicePlane:ka,strokesTexture:this.strokesTexture,legacy:la,spherical:this.viewingMode===A.ViewingMode.Global}),
this.renderers.set(Z,ca));ca.refCount.increment();return ca};ea._removeRenderable=function(ia){ia.regular&&(ia.regular.vao.vertexBuffers.instances.dispose(),ia.regular.vao.dispose(!1),ia.regular.vao=null);ia.silhouette&&(ia.silhouette.vao.vertexBuffers.instances.dispose(),ia.silhouette.vao.dispose(!1),ia.silhouette.vao=null);const ka=this.renderers.get(ia.rendererKey);if(ka){ka.removeRenderable(ia);ka.refCount.decrement();"origin"in ia.transform&&this.localOrigins.release(ia.transform.origin);this.gpuMemoryUsage-=
ia.statistics.externalMemoryUsage?0:ia.statistics.gpuMemoryUsage;for(const la of ia.components.meta)ia.components.buffer.releaseIndex(la.index)}};ea._updateObjectCameraDistances=function(ia){const ka=ia.camera.eye,la=ia.camera.viewForward,Z=y.create();ia=ca=>{const {center:Y,radius:da}=ca;r.sub(Z,Y,ka);const ha=r.dot(Z,la),ja=ha<-da?Infinity:ha<da?0:ha-da;ca.renderables.forEach(ma=>ma.distanceToCamera=ja)};this.perObjectData.forEach(ia);this.perObjectDataEvictionCache.forEach(ia)};ea._renderRegularEdges=
function(ia,ka,la){const Z=ia.bindRegularEdges(la,ka),ca=la.transparency;ia.forEachRenderable(Y=>{if(Y.visible&&Y.regular){var da=N.computeEdgeCount(Y.regular.lod.lengths,Y.distanceToCamera,la),ha="origin"in Y.transform?this.localOrigins.getViewMatrix(Y.transform.origin):k.IDENTITY;ia.renderRegularEdges(Z,Y,ka,da,ha);this.numberOfRenderedEdges[ca]+=da}},ca)};ea._renderSilhouetteEdges=function(ia,ka,la){const Z=ia.bindSilhouetteEdges(la,ka),ca=la.transparency;ia.forEachRenderable(Y=>{if(Y.visible&&
Y.silhouette){var da=N.computeEdgeCount(Y.silhouette.lod.lengths,Y.distanceToCamera,la),ha="origin"in Y.transform?this.localOrigins.getViewMatrix(Y.transform.origin):k.IDENTITY;ia.renderSilhouetteEdges(Z,Y,ka,da,ha);this.numberOfRenderedEdges[ca]+=da}},ca)};b._createClass(aa,[{key:"updating",get:function(){return this.updatingHandles.updating}},{key:"usedMemory",get:function(){return this.gpuMemoryUsage}},{key:"numberOfRenderedPrimitives",get:function(){return this.numberOfRenderedEdges[I.Transparency.TRANSPARENT]+
this.numberOfRenderedEdges[I.Transparency.OPAQUE]}}]);return aa}(n);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"rctx",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"renderSR",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"viewingMode",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"techniqueRepository",void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"setNeedsRender",
void 0);c.__decorate([d.property({constructOnly:!0})],a.EdgeView.prototype,"schedule",void 0);c.__decorate([d.property({readOnly:!0})],a.EdgeView.prototype,"updatingHandles",void 0);c.__decorate([d.property({readOnly:!0})],a.EdgeView.prototype,"updating",null);a.EdgeView=c.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.edgeRendering.EdgeView")],a.EdgeView);let Q=function(ba,aa,ea){this.center=aa;this.radius=ea;this.renderables=[];this.loaded=ba;this.loaded.then(()=>{null!=this.loaded&&(this.loaded=
!0)})};const X=q.create();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/localOriginHelper":function(){define(["exports"],function(a){a.applyToModelMatrix=function(b,c){const n=-b[0],l=-b[1];b=-b[2];const u=c[3],v=c[7],m=c[11],h=c[15];c[0]+=u*n;c[1]+=u*l;c[2]+=u*b;c[4]+=v*n;c[5]+=v*l;c[6]+=v*b;c[8]+=m*n;c[9]+=m*l;c[10]+=m*b;c[12]+=h*n;c[13]+=h*l;c[14]+=h*b};a.applyToViewMatrix=function(b,c){const n=b[0],l=b[1];b=b[2];c[12]+=
n*c[0]+l*c[4]+b*c[8];c[13]+=n*c[1]+l*c[5]+b*c[9];c[14]+=n*c[2]+l*c[6]+b*c[10];c[14]+=n*c[3]+l*c[7]+b*c[11]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/LocalOriginManager":function(){define(["exports","../../../../chunks/mat4","../../../../chunks/mat4f64","./localOriginHelper"],function(a,b,c,n){let l=function(){function u(m){this.factory=m;this.originData=new Map}var v=u.prototype;v.acquire=function(m){return this.register(this.factory.getOrigin(m))};
v.register=function(m){const h=this.originData.get(m.id);if(h)return h.refCount++,h.origin;this.originData.set(m.id,{refCount:1,viewMatrix:c.create(),origin:m});return m};v.release=function(m){const h=this.originData.get(m.id);h&&(h.refCount--,0===h.refCount&&this.originData.delete(m.id))};v.updateViewMatrices=function(m){this.originData.forEach(h=>{b.copy(h.viewMatrix,m);n.applyToViewMatrix(h.origin.vec3,h.viewMatrix)})};v.getViewMatrix=function(m){return this.originData.get(m.id).viewMatrix};return u}();
a.LocalOriginManager=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeRenderer":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../core/maybe ../../../../../core/PooledArray ../../../../../chunks/mat3 ../../../../../chunks/mat3f32 ../../../../../chunks/vec3 ../../../support/debugFlags ../../core/shaderLibrary/util/DoublePrecision.glsl ../../core/util/TwoVectorPosition ./EdgeShaderParameters ./EdgeShaderTechnique ./EdgeShaderTechniqueConfiguration ./interfaces ../../shaders/sources/edgeRenderer/EdgeUtil.glsl ../../../../webgl/enums".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){const r={type:"uber",hasSlicePlane:!1,strokesTexture:null,legacy:!0,spherical:!0};let y=function(){function z(){this._value=0}var A=z.prototype;A.increment=function(){this._value++};A.decrement=function(){this._value--};b._createClass(z,[{key:"value",get:function(){return this._value}}]);return z}();const f={solid:q.EdgeUtilMode.SOLID,sketch:q.EdgeUtilMode.SKETCH,uber:q.EdgeUtilMode.MIXED};q=function(){function z(x,B,C){this.rctx=x;this.shaderTechniqueRepository=
B;this._configuration=new p.EdgeShaderTechniqueConfiguration;this.refCount=new y;this.renderables=new Set;this.sortedRenderables={[t.Transparency.TRANSPARENT]:{[t.Transparency.TRANSPARENT]:new n,[t.Transparency.OPAQUE]:new n},[t.Transparency.OPAQUE]:{[t.Transparency.TRANSPARENT]:new n,[t.Transparency.OPAQUE]:new n}};this._renderablesDirty=!1;this._drawParameters=new e.EdgeDrawParameters;this._settings={...r,...C};this.key=z.getKey(this._settings.type,this._settings.hasSlicePlane,this._settings.legacy);
this.writerSettings={variants:this._settings.strokesTexture.variants,reducedPrecision:m.TESTS_DISABLE_OPTIMIZATIONS};this._configuration.legacy=this._settings.legacy;this._configuration.mode=f[this._settings.type];this._configuration.silhouette=!1;this._configuration.antialiasing=!!this.rctx.capabilities.blendMinMax;this._configuration.hasSlicePlane=this._settings.hasSlicePlane;this._configuration.doublePrecisionRequiresObfuscation=h.doublePrecisionRequiresObfuscation(x);this._configuration.spherical=
C.spherical}var A=z.prototype;A.dispose=function(){this._technique=c.releaseMaybe(this._technique)};A.addRenderable=function(x){this.renderables.add(x);this._renderablesDirty=!0};A.removeRenderable=function(x){this.renderables.delete(x);this._renderablesDirty=!0};A.setRenderablesDirty=function(){this._renderablesDirty=!0};A.forEachRenderable=function(x,B){this._renderablesDirty&&this._sortRenderables();this.sortedRenderables[B][t.Transparency.TRANSPARENT].forAll(x);this.sortedRenderables[B][t.Transparency.OPAQUE].forAll(x)};
A.updateTechnique=function(x,B){this._configuration.hasMultipassTerrain=!!x.multipassTerrain.enabled;this._configuration.cullAboveGround=!!x.multipassTerrain.cullAboveGround;this._configuration.silhouette=B;return this._technique=this.shaderTechniqueRepository.releaseAndAcquire(g.EdgeShaderTechnique,this._configuration,this._technique)};A.bindRegularEdges=function(x,B){return this.rctx.bindTechnique(this.updateTechnique(B,!1),x,B)};A.bindSilhouetteEdges=function(x,B){return this.rctx.bindTechnique(this.updateTechnique(B,
!0),x,B)};A.renderRegularEdges=function(x,B,C,D,E){this._render(x,B,B.regular.vao,C,D,E)};A.renderSilhouetteEdges=function(x,B,C,D,E){this._render(x,B,B.silhouette.vao,C,D,E)};A._render=function(x,B,C,D,E,F){this._bindDraw(x,B,D,F);this.rctx.bindVAO(C);this.rctx.capabilities.instancing.drawArraysInstanced(k.PrimitiveType.TRIANGLE_FAN,0,4,E)};A._bindDraw=function(x,B,C,D){B.components.buffer.textureBuffer.bind(x,"componentDataTex","componentDataTexInvDim");if("origin"in B.transform)x.setUniformMatrix4fv("localView",
D),x.setUniformMatrix4fv("model",B.transform.modelMatrix),v.copy(this._drawParameters.slicePlaneLocalOrigin,B.transform.origin.vec3);else{D=new d.TwoVectorPosition(B.transform.position);const E=l.transpose(w,l.invert(w,B.transform.rotationScale));this._drawParameters.transformWorldFromModelTL=D.low;this._drawParameters.transformWorldFromModelTH=D.high;this._drawParameters.transformWorldFromModelRS=B.transform.rotationScale;this._drawParameters.transformNormalGlobalFromModel=E;B=C.camera.viewInverseTransposeMatrix;
v.set(this._drawParameters.slicePlaneLocalOrigin,B[3],B[7],B[11])}x.bindDraw(this._drawParameters,C);"uber"!==this._settings.type&&"sketch"!==this._settings.type||this._setSketchUniforms(x)};A._setSketchUniforms=function(x){const B=this._settings.strokesTexture,C=B.texture;c.isNone(C)||(x.bindTexture("strokesTexture",C),x.setUniform2f("strokesTextureScale",1/C.descriptor.width,1/C.descriptor.height),x.setUniform1f("strokesLog2Resolution",Math.log2(B.resolution)),x.setUniform1f("strokesNormalizationScale",
B.normalizationScale),x.setUniform1f("strokesAmplitude",B.amplitude),x.setUniform1f("strokeVariants",B.variants))};A._sortRenderables=function(){this._renderablesDirty=!1;this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.TRANSPARENT].clear();this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.OPAQUE].clear();this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.TRANSPARENT].clear();this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.OPAQUE].clear();this.renderables.forEach(B=>
{B.objectTransparency!==t.Transparency.INVISIBLE&&B.edgeTransparency!==t.Transparency.INVISIBLE&&this.sortedRenderables[B.objectTransparency][B.edgeTransparency].push(B)});const x=(B,C)=>"origin"in B.transform&&"origin"in C.transform?B.transform.origin.id<C.transform.origin.id?-1:B.transform.origin.id>C.transform.origin.id?1:0:0;this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.TRANSPARENT].sort(x);this.sortedRenderables[t.Transparency.TRANSPARENT][t.Transparency.OPAQUE].sort(x);this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.TRANSPARENT].sort(x);
this.sortedRenderables[t.Transparency.OPAQUE][t.Transparency.OPAQUE].sort(x)};z.getKey=function(x,B,C){return`edges-t:${x}:${B}:${C}`};return z}();const w=u.create();a.EXTENSION_LENGTH_OFFSET=128;a.EdgeRenderer=q;a.LINE_WIDTH_FRACTION_FACTOR=8;a.componentDataInvDimName="componentDataTexInvDim";a.componentDataTexName="componentDataTex";Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderParameters":function(){define(["exports",
"../../../../../chunks/_rollupPluginBabelHelpers","../../../../../chunks/mat3f64","../../../../../chunks/vec3f64","../../core/shaderLibrary/attributes/VertexPosition.glsl"],function(a,b,c,n,l){let u=function(v){function m(h,d,e){var g=v.call(this)||this;g.distanceFalloffFactor=h;g.minimumEdgeLength=d;g.transparency=e;g.transformNormalViewFromGlobal=c.create();return g}b._inheritsLoose(m,v);return m}(l.VertexPositionPassParameters);l=function(v){function m(){var h=v.apply(this,arguments)||this;h.transformNormalViewFromGlobal=
c.create();h.slicePlaneLocalOrigin=n.create();h.transformNormalGlobalFromModel=c.create();return h}b._inheritsLoose(m,v);return m}(l.VertexPositionDrawParameters);a.EdgeDrawParameters=l;a.EdgePassParameters=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechnique":function(){define("require exports ../../../../../chunks/_rollupPluginBabelHelpers ../../core/shaderTechnique/ReloadableShaderModule ../../core/shaderTechnique/ShaderTechnique ../Program ./bufferLayouts ../../../../../chunks/EdgeShader.glsl ../../../../webgl/enums ../../../../webgl/renderState".split(" "),
function(a,b,c,n,l,u,v,m,h,d){l=function(e){function g(){return e.apply(this,arguments)||this}c._inheritsLoose(g,e);var p=g.prototype;p.initializeProgram=function(t){const q=g.shader.get().build(this.configuration);return new u.Program(t.rctx,q,v.EdgeShaderAttributeLocations)};p.initializePipeline=function(t){return t.blendMinMax?d.makePipelineState({blending:d.separateBlendingParams(h.BlendFactor.ONE,h.BlendFactor.ONE,h.BlendFactor.ZERO,h.BlendFactor.ONE,h.BlendOperation.ADD,t.blendMinMax.MAX),depthTest:{func:h.CompareFunction.LEQUAL},
colorWrite:d.defaultColorWriteParams}):d.makePipelineState({depthTest:{func:h.CompareFunction.LEQUAL},depthWrite:d.defaultDepthWriteParams,colorWrite:d.defaultColorWriteParams})};return g}(l.ShaderTechnique);l.shader=new n.ReloadableShaderModule(m.EdgeShader,()=>new Promise((e,g)=>a(["../../shaders/sources/edgeRenderer/EdgeShader.glsl"],e,g)));b.EdgeShaderTechnique=l;Object.defineProperties(b,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/chunks/EdgeShader.glsl":function(){define("exports ./vec2 ./vec2f64 ../views/3d/webgl-engine/core/shaderLibrary/Slice.glsl ../views/3d/webgl-engine/core/shaderLibrary/shading/MultipassTerrainTest.glsl ../views/3d/webgl-engine/core/shaderModules/Float2PassUniform ../views/3d/webgl-engine/core/shaderModules/Float4PassUniform ../views/3d/webgl-engine/core/shaderModules/FloatPassUniform ../views/3d/webgl-engine/core/shaderModules/interfaces ../views/3d/webgl-engine/core/shaderModules/Matrix4Uniform ../views/3d/webgl-engine/core/shaderModules/ShaderBuilder ../views/3d/webgl-engine/lib/VertexAttribute ../views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl ../views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w){function z(x){const B=new e.ShaderBuilder,C=B.vertex,D=B.fragment;x.legacy&&C.uniforms.add(new d.Matrix4Uniform("model"));x.antialiasing&&(C.code.add(h.glsl`#define ANTIALIASING 1`),D.code.add(h.glsl`#define ANTIALIASING 1`));B.include(p.AdjustProjectedPosition,x);B.include(r.EdgeUtil,x);B.include(y.LineAmplitude,x);B.include(w.UnpackAttributes,x);B.include(f.LineOffset,x);B.include(n.SliceDraw,x);B.include(q.DiscardNonSilhouetteEdges,x);B.include(t.DiscardByCoverage,
x);B.include(k.DiscardShortEdges,x);B.include(l.multipassTerrainTest,x);B.varyings.add("vColor","vec4");B.varyings.add("vRadius","float");B.varyings.add("vPosition","vec3");B.varyings.add("vWorldPosition","vec3");B.varyings.add("vViewPos","vec3");B.varyings.add("vLineLengthPixels","float");B.varyings.add("vSizeFalloffFactor","float");C.uniforms.add(new u.Float2PassUniform("pixelToNDC",(E,F)=>b.set(A,2/F.camera.fullViewport[2],2/F.camera.fullViewport[3])));C.uniforms.add(new v.Float4PassUniform("viewport",
(E,F)=>F.camera.fullViewport));C.uniforms.add(new m.FloatPassUniform("pixelRatio",(E,F)=>F.camera.pixelRatio));B.attributes.add(g.VertexAttribute.POSITION0,"vec3");B.attributes.add(g.VertexAttribute.POSITION1,"vec3");B.attributes.add(g.VertexAttribute.VARIANTOFFSET,"float");B.attributes.add(g.VertexAttribute.VARIANTSTROKE,"float");B.attributes.add(g.VertexAttribute.VARIANTEXTENSION,"float");C.code.add(h.glsl`const float opaqueCutoff = 1.0 / 255.0;
void calculateGeometricOutputs(vec3 viewPosV0, vec3 viewPosV1, vec3 worldPosV0, vec3 worldPosV1, vec3 worldNormal, UnpackedAttributes unpackedAttributes) {
vec2 sideness = unpackedAttributes.sideness;
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
vWorldPosition = mix(worldPosV0, worldPosV1, sidenessNorm.y).xyz;
vec3 viewPos = mix(viewPosV0, viewPosV1, sidenessNorm.y);
vViewPos = viewPos;
vec4 projPosV0 = projFromViewPosition(viewPosV0);
vec4 projPosV1 = projFromViewPosition(viewPosV1);
vec4 projPos = projFromViewPosition(viewPos);
vec3 screenSpaceLineNDC = (projPosV1.xyz / projPosV1.w - projPosV0.xyz / projPosV0.w);
vec2 ndcToPixel = viewport.zw * 0.5;
vec2 screenSpaceLinePixels = screenSpaceLineNDC.xy * ndcToPixel;
float lineLengthPixels = length(screenSpaceLinePixels);
float dzPerPixel = screenSpaceLineNDC.z / lineLengthPixels;
vec2 screenSpaceDirection = screenSpaceLinePixels / lineLengthPixels;
vec2 perpendicularScreenSpaceDirection = vec2(screenSpaceDirection.y, -screenSpaceDirection.x) * sideness.x;
float falloffFactor = distanceBasedPerspectiveFactor(-viewPos.z) * pixelRatio;
float lineWidthPixels = unpackedAttributes.lineWidthPixels * falloffFactor;
float extensionLengthPixels = calculateExtensionLength(unpackedAttributes.extensionLengthPixels, lineLengthPixels) * falloffFactor;
float lineAmplitudePixels = calculateLineAmplitude(unpackedAttributes) * pixelRatio;
vSizeFalloffFactor = falloffFactor;
float lineWidthAndAmplitudePixels = lineWidthPixels + lineAmplitudePixels + lineAmplitudePixels;
float extendedLineLengthPixels = lineLengthPixels + extensionLengthPixels + extensionLengthPixels;
#ifdef ANTIALIASING
const float aaPaddingPixels = 1.0;
float halfAAPaddedLineWidthAndAmplitudePixels = lineWidthAndAmplitudePixels * 0.5 + aaPaddingPixels;
float aaPaddedRoundedCapSizePixels = lineWidthPixels * 0.5 + aaPaddingPixels;
#else
float halfAAPaddedLineWidthAndAmplitudePixels = max(lineWidthAndAmplitudePixels, 1.0) * 0.5;
float aaPaddedRoundedCapSizePixels = max(lineWidthPixels, 1.0) * 0.5;
#endif
vec2 halfAAPaddedLineWidthAndAmplitudeNDC = halfAAPaddedLineWidthAndAmplitudePixels * pixelToNDC;
vec2 aaPaddedRoundedCapSizeNDC = aaPaddedRoundedCapSizePixels * pixelToNDC;
vec2 extensionLengthNDC = extensionLengthPixels * pixelToNDC;
vec2 ndcOffset = (
screenSpaceDirection * sideness.y * (aaPaddedRoundedCapSizeNDC + extensionLengthNDC)
+ perpendicularScreenSpaceDirection * halfAAPaddedLineWidthAndAmplitudeNDC
);
projPos.xy += ndcOffset * projPos.w;
projPos.z += (dzPerPixel * (aaPaddedRoundedCapSizePixels + extensionLengthPixels)) * sideness.y * projPos.w;
projPos = adjustProjectedPosition(projPos, worldNormal, 1.0 + max((lineWidthAndAmplitudePixels - 1.0) * 0.5, 0.0));
float aaPaddedLineWithCapsLengthPixels = extendedLineLengthPixels + aaPaddedRoundedCapSizePixels + aaPaddedRoundedCapSizePixels;
float pixelPositionAlongLine = aaPaddedLineWithCapsLengthPixels * sidenessNorm.y - aaPaddedRoundedCapSizePixels;
vPosition = vec3(
halfAAPaddedLineWidthAndAmplitudePixels * sideness.x,
pixelPositionAlongLine,
pixelPositionAlongLine / extendedLineLengthPixels
);
vRadius = lineWidthPixels * 0.5;
vLineLengthPixels = extendedLineLengthPixels;
discardShortEdges(unpackedAttributes, lineLengthPixels);
gl_Position = projPos;
}
void main() {
ComponentData component = readComponentData();
UnpackedAttributes unpackedAttributes = unpackAttributes(component);
vec3 worldPosV0, worldPosV1, viewPosV0, viewPosV1;
worldAndViewFromModelPosition(position0, component.verticalOffset, worldPosV0, viewPosV0);
worldAndViewFromModelPosition(position1, component.verticalOffset, worldPosV1, viewPosV1);
vColor = component.color;
if (vColor.a < opaqueCutoff) {
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return;
}
if (discardNonSilhouetteEdges(viewPosV0, worldPosV0)) {
return;
}
calculateGeometricOutputs(viewPosV0, viewPosV1, worldPosV0, worldPosV1, worldNormal(), unpackedAttributes);
calculateStyleOutputs(unpackedAttributes);
}`);B.fragment.code.add(h.glsl`
    vec2 lineWithCapsDistance(float radius, vec2 position, float lineLength) {
      float lineOffset = calculateLineOffset();
      float positionX = position.x - lineOffset;

      if (radius < 1.0) {
        // Handle this specifically for subpixel sizes:
        // 1. Compute correct coverage (note coverage is computed by
        //    0.5 - dist, so we make sure that that will lead to correct
        //    subpixel coverage
        // 2. Ignore rounded caps
        float coverageX = clamp(min(radius, positionX + 0.5) - max(-radius, positionX - 0.5), 0.0, 1.0);
        float coverageY = clamp(min(lineLength, position.y + 0.5) - max(0.0, position.y - 0.5), 0.0, 1.0);

        float coverage = min(coverageX, coverageY);

        return vec2(0.5 - coverage, 0.0);
      }
      else {
        // Between -radius -> 0 for start cap, 0 for line, 0 -> radius
        float positionOnCap = position.y - clamp(position.y, 0.0, lineLength);

        vec2 lineToPosition = vec2(positionX, positionOnCap);
        return vec2(length(lineToPosition) - radius, positionOnCap / radius);
      }
    }

    void main() {
      ${x.hasMultipassTerrain?"terrainDepthTest(gl_FragCoord, vViewPos.z);":""}
      float radius = vRadius * calculateLinePressure();

      vec2 distance = lineWithCapsDistance(radius, vPosition.xy, vLineLengthPixels);
      float coverage = clamp(0.5 - distance.x, 0.0, 1.0);

      discardByCoverage(radius, coverage);
      discardBySlice(vWorldPosition);

      float alpha = vColor.a * coverage;

      gl_FragColor = vec4(vColor.rgb, alpha);

    }
  `);return B}const A=c.create();c=Object.freeze(Object.defineProperty({__proto__:null,build:z},Symbol.toStringTag,{value:"Module"}));a.EdgeShader=c;a.build=z})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/AdjustProjectedPosition.glsl":function(){define("exports ../../../../../../chunks/vec2f64 ../../../core/shaderLibrary/util/IsNaN.glsl ../../../core/shaderModules/Float2PassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Matrix4Uniform".split(" "),
function(a,b,c,n,l,u,v,m){const h=b.fromValues(.5,-4E-4);a.AdjustProjectedPosition=function(d,e){d=d.vertex;d.include(c.IsNaN);d.constants.add("depthBias","vec2",h);d.uniforms.add(new n.Float2PassUniform("inverseViewport",(g,p)=>p.inverseViewport));e.legacy?(d.uniforms.add(new m.Matrix4Uniform("localView")),d.uniforms.add(new v.Matrix4PassUniform("proj",(g,p)=>p.camera.projectionMatrix)),d.code.add(l.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = proj * localView * vec4(globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`)):(d.uniforms.add(new u.Matrix3PassUniform("transformNormalViewFromGlobal",g=>g.transformNormalViewFromGlobal)),d.uniforms.add(new v.Matrix4PassUniform("transformProjFromView",g=>g.transformProjFromView)),d.code.add(l.glsl`vec2 calculateProjectedBiasXY(vec4 projPos, vec3 globalNormal) {
float offsetXY = depthBias.x;
vec4 projNormal = transformProjFromView * vec4(transformNormalViewFromGlobal * globalNormal, 0.0);
return offsetXY * projPos.w * 2.0 * inverseViewport * normalize(projNormal.xyz).xy;
}`));d.code.add(l.glsl`float _calculateProjectedBiasZ(vec4 projPos) {
float offsetZ = depthBias.y;
return sqrt(max(projPos.z,0.0)) * offsetZ;
}
vec4 adjustProjectedPosition(vec4 projPos, vec3 worldNormal, float lineWidth) {
vec2 offsetXY = calculateProjectedBiasXY(projPos, worldNormal);
if (!isNaN(offsetXY.x) && !isNaN(offsetXY.y)) {
projPos.xy += offsetXY;
}
projPos.z += _calculateProjectedBiasZ(projPos);
return projPos;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/core/shaderLibrary/util/IsNaN.glsl":function(){define(["exports","../../shaderModules/interfaces"],function(a,b){a.IsNaN=function(c){const n=b.glsl`bool isNaN( float val )
{
return ( val < 0.0 || 0.0 < val || val == 0.0 ) ? false : true;
}`;c.code.add(n)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardByCoverage.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardByCoverage=function(c,n){c=c.fragment;c.constants.add("coverageTestThreshold","float",.01);n.antialiasing?c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { if (coverage < coverageTestThreshold) discard; }`):
c.code.add(b.glsl`#define discardByCoverage(radius, coverage) { float coverageLimit = radius <= 0.5 ? coverageTestThreshold : 0.75; if (coverage < coverageLimit) discard; }`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardNonSilhouetteEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces"],function(a,b){a.DiscardNonSilhouetteEdges=function(c,n){c=c.vertex;n.silhouette?
(c.code.add(b.glsl`bool isSilhouetteEdge(vec3 viewDir, vec3 normalA, vec3 normalB) {
float faceAVisible = dot(viewDir, normalA);
float faceBVisible = dot(viewDir, normalB);
return faceAVisible * faceBVisible < 0.0;
}`),n.legacy?c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 viewNormalA = _modelToViewNormal(normalA);
vec3 viewNormalB = _modelToViewNormal(normalB);
vec3 viewDir = -viewPos;
if (isSilhouetteEdge(viewDir, viewNormalA, viewNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
vec3 worldNormalA = _modelToWorldNormal(normalA);
vec3 worldNormalB = _modelToWorldNormal(normalB);
vec3 viewDir = -worldPos;
if (isSilhouetteEdge(viewDir, worldNormalA, worldNormalB)) {
return false;
}
gl_Position = vec4(10.0, 10.0, 10.0, 1.0);
return true;
}`)):c.code.add(b.glsl`bool discardNonSilhouetteEdges(vec3 viewPos, vec3 worldPos) {
return false;
}`)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/DiscardShortEdges.glsl":function(){define(["exports","../../../core/shaderModules/interfaces","./EdgeUtil.glsl"],function(a,b,c){a.DiscardShortEdges=function(n,l){n=n.vertex;switch(l.mode){case c.EdgeUtilMode.SKETCH:n.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);
break;case c.EdgeUtilMode.MIXED:n.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) { if (unpackedAttributes.type <= 0.0 && lineLengthPixels <= 3.0) { gl_Position = vec4(10.0, 10.0, 10.0, 1.0); return; }}`);break;case c.EdgeUtilMode.SOLID:n.code.add(b.glsl`#define discardShortEdges(unpackedAttributes, lineLengthPixels) {}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/EdgeUtil.glsl":function(){define("exports ../../../collections/Component/Material/shader/ComponentData.glsl ../../../core/shaderLibrary/util/DoublePrecision.glsl ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float2Uniform ../../../core/shaderModules/Float3DrawUniform ../../../core/shaderModules/Float3PassUniform ../../../core/shaderModules/FloatPassUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Matrix3DrawUniform ../../../core/shaderModules/Matrix3PassUniform ../../../core/shaderModules/Matrix4PassUniform ../../../core/shaderModules/Texture2DUniform ../../../lib/VertexAttribute".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){a.EdgeUtilMode=void 0;(function(q){q[q.SOLID=0]="SOLID";q[q.SKETCH=1]="SKETCH";q[q.MIXED=2]="MIXED";q[q.COUNT=3]="COUNT"})(a.EdgeUtilMode||(a.EdgeUtilMode={}));a.EdgeUtil=function(q,k){const r=q.vertex;r.include(n.RgbaFloatEncoding);r.uniforms.add(new m.FloatPassUniform("distanceFalloffFactor",y=>y.distanceFalloffFactor));r.code.add(h.glsl`float distanceBasedPerspectiveFactor(float distance) {
return clamp(sqrt(distanceFalloffFactor / distance), 0.0, 1.0);
}`);r.uniforms.add(new p.Texture2DUniform("componentDataTex"));r.uniforms.add(new l.Float2Uniform("componentDataTexInvDim"));q.attributes.add(t.VertexAttribute.COMPONENTINDEX,"float");r.constants.add("componentColorFieldOffset","float",0);r.constants.add("componentOtherFieldOffset","float",1);r.constants.add("componentVerticalOffsetFieldOffset","float",2);r.constants.add("componentFieldCount","float",3);r.constants.add("lineWidthFractionFactor","float",8);r.constants.add("extensionLengthOffset","float",
128);r.constants.add("componentTexWidth","float",4096);r.constants.add("verticalOffsetScale","float",2*b.MAX_ELEVATION_OFFSET);r.code.add(h.glsl`vec2 _componentTextureCoords(float componentIndex, float fieldOffset) {
float fieldIndex = componentFieldCount * componentIndex + fieldOffset;
float rowIndex = floor(fieldIndex / componentTexWidth);
float colIndex = mod(fieldIndex, componentTexWidth);
vec2 linearIndex = vec2(
(colIndex + 0.5) / componentTexWidth,
(rowIndex + 0.5) * componentDataTexInvDim.y
);
return linearIndex;
}
struct ComponentData {
vec4 color;
float lineWidth;
float extensionLength;
float type;
float verticalOffset;
};
ComponentData readComponentData() {
vec2 colorIndex = _componentTextureCoords(componentIndex, componentColorFieldOffset);
vec2 otherIndex = _componentTextureCoords(componentIndex, componentOtherFieldOffset);
vec2 verticalOffsetIndex = _componentTextureCoords(componentIndex, componentVerticalOffsetFieldOffset);
vec4 colorValue = texture2D(componentDataTex, colorIndex);
vec4 otherValue = texture2D(componentDataTex, otherIndex);
float verticalOffset = (rgba2float(texture2D(componentDataTex, verticalOffsetIndex)) - 0.5) * verticalOffsetScale;
return ComponentData(
vec4(colorValue.rgb, colorValue.a * otherValue.w),
otherValue.x * (255.0 / lineWidthFractionFactor),
otherValue.y * 255.0 - extensionLengthOffset,
-(otherValue.z * 255.0) + 0.5,
verticalOffset
);
}`);k.legacy?r.code.add(h.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return (model * vec4(normal, 0.0)).xyz;
}
vec3 _modelToViewNormal(vec3 normal) {
return (localView * model * vec4(normal, 0.0)).xyz;
}`):(r.uniforms.add(new d.Matrix3DrawUniform("transformNormalGlobalFromModel",y=>y.transformNormalGlobalFromModel)),r.code.add(h.glsl`vec3 _modelToWorldNormal(vec3 normal) {
return transformNormalGlobalFromModel * normal;
}`));k.silhouette?(q.attributes.add(t.VertexAttribute.NORMALA,"vec3"),q.attributes.add(t.VertexAttribute.NORMALB,"vec3"),r.code.add(h.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normalize(normalA + normalB));
}`)):(q.attributes.add(t.VertexAttribute.NORMAL,"vec3"),r.code.add(h.glsl`vec3 worldNormal() {
return _modelToWorldNormal(normal);
}`));k.legacy?r.code.add(h.glsl`void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
worldPos = (model * vec4(modelPos, 1.0)).xyz;
viewPos = (localView * vec4(worldPos, 1.0)).xyz;
}`):(r.include(c.DoublePrecision,k),r.include(c.DoublePrecision,k),r.uniforms.add([new e.Matrix3PassUniform("transformViewFromCameraRelativeRS",y=>y.transformViewFromCameraRelativeRS),new d.Matrix3DrawUniform("transformWorldFromModelRS",y=>y.transformWorldFromModelRS),new u.Float3DrawUniform("transformWorldFromModelTL",y=>y.transformWorldFromModelTL),new u.Float3DrawUniform("transformWorldFromModelTH",y=>y.transformWorldFromModelTH),new v.Float3PassUniform("transformWorldFromViewTL",y=>y.transformWorldFromViewTL),
new v.Float3PassUniform("transformWorldFromViewTH",y=>y.transformWorldFromViewTH)]),r.code.add(h.glsl`
      void worldAndViewFromModelPosition(vec3 modelPos, float verticalOffset, out vec3 worldPos, out vec3 viewPos) {
        vec3 rotatedModelPosition = transformWorldFromModelRS * modelPos;

        vec3 transformCameraRelativeFromModel = dpAdd(
          transformWorldFromModelTL,
          transformWorldFromModelTH,
          -transformWorldFromViewTL,
          -transformWorldFromViewTH
        );

        worldPos = transformCameraRelativeFromModel + rotatedModelPosition;

        if (verticalOffset != 0.0) {
          vec3 vUp = ${k.spherical?h.glsl`normalize(transformWorldFromModelTL + rotatedModelPosition);`:h.glsl`vec3(0.0, 0.0, 1.0);`}
          worldPos += verticalOffset * vUp;
        }

        viewPos = transformViewFromCameraRelativeRS * worldPos;
      }
    `));r.uniforms.add(new g.Matrix4PassUniform("transformProjFromView",(y,f)=>f.camera.projectionMatrix));r.code.add(h.glsl`vec4 projFromViewPosition(vec3 position) {
return transformProjFromView * vec4(position, 1.0);
}`);r.code.add(h.glsl`float calculateExtensionLength(float extensionLength, float lineLength) {
return extensionLength / (log2(max(1.0, 256.0 / lineLength)) * 0.2 + 1.0);
}`)};a.usesSketchLogic=function(q){return q.mode===a.EdgeUtilMode.SKETCH||q.mode===a.EdgeUtilMode.MIXED};a.usesSolidLogic=function(q){return q.mode===a.EdgeUtilMode.SOLID||q.mode===a.EdgeUtilMode.MIXED};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineAmplitude.glsl":function(){define(["exports","../../../core/shaderModules/FloatUniform","../../../core/shaderModules/interfaces","./EdgeUtil.glsl",
"./UnpackAttributes.glsl"],function(a,b,c,n,l){a.LineAmplitude=function(u,v){const m=u.vertex;u.include(l.UnpackAttributes,v);n.usesSketchLogic(v)&&m.uniforms.add(new b.FloatUniform("strokesAmplitude"));switch(v.mode){case n.EdgeUtilMode.SOLID:m.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return 0.0;
}`);break;case n.EdgeUtilMode.SKETCH:m.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
return strokesAmplitude;
}`);break;case n.EdgeUtilMode.MIXED:m.code.add(c.glsl`float calculateLineAmplitude(UnpackedAttributes unpackedAttributes) {
float type = unpackedAttributes.type;
if (type <= 0.0) {
return strokesAmplitude;
}
else {
return 0.0;
}
}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/UnpackAttributes.glsl":function(){define(["exports","../../../../../../core/compilerUtils","../../../core/shaderModules/interfaces","../../../lib/VertexAttribute","./EdgeUtil.glsl"],function(a,b,c,n,l){a.UnpackAttributes=function(u,v){const m=u.vertex;u.attributes.add(n.VertexAttribute.SIDENESS,"vec2");v.mode===l.EdgeUtilMode.MIXED?m.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
float type;
};`):m.code.add(c.glsl`struct UnpackedAttributes {
vec2 sideness;
vec2 sidenessNorm;
float lineWidthPixels;
float extensionLengthPixels;
};`);switch(v.mode){case l.EdgeUtilMode.MIXED:m.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float fType = component.type;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
if (fType <= 0.0) {
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
}
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels, fType);
}`);break;case l.EdgeUtilMode.SKETCH:m.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
extensionLengthPixels *= variantExtension * 2.0 - 1.0;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case l.EdgeUtilMode.SOLID:m.code.add(c.glsl`UnpackedAttributes unpackAttributes(ComponentData component) {
vec2 sidenessNorm = sideness;
vec2 sideness = sidenessNorm * 2.0 - 1.0;
float extensionLengthPixels = component.extensionLength;
float lineWidth = component.lineWidth;
return UnpackedAttributes(sideness, sidenessNorm, lineWidth, extensionLengthPixels);
}`);break;case l.EdgeUtilMode.COUNT:break;default:b.neverReached(v.mode)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/shaders/sources/edgeRenderer/LineOffset.glsl":function(){define("exports ../../../core/shaderLibrary/util/RgbaFloatEncoding.glsl ../../../core/shaderModules/Float2Uniform ../../../core/shaderModules/FloatUniform ../../../core/shaderModules/interfaces ../../../core/shaderModules/Texture2DUniform ./EdgeUtil.glsl ./UnpackAttributes.glsl".split(" "),
function(a,b,c,n,l,u,v,m){a.LineOffset=function(h,d){const e=h.vertex;h.include(m.UnpackAttributes,d);const g=h.fragment;v.usesSketchLogic(d)&&(e.uniforms.add(new c.Float2Uniform("strokesTextureScale")),e.uniforms.add(new n.FloatUniform("strokesLog2Resolution")),e.uniforms.add(new n.FloatUniform("strokeVariants")),h.varyings.add("vStrokeUV","vec2"),g.uniforms.add(new u.Texture2DUniform("strokesTexture")),g.uniforms.add(new n.FloatUniform("strokesNormalizationScale")),e.code.add(l.glsl`void calculateStyleOutputsSketch(float lineLength, UnpackedAttributes unpackedAttributes) {
vec2 sidenessNorm = unpackedAttributes.sidenessNorm;
float lineIndex = clamp(ceil(log2(lineLength)), 0.0, strokesLog2Resolution);
vStrokeUV = vec2(exp2(lineIndex) * sidenessNorm.y, lineIndex * strokeVariants + variantStroke + 0.5) * strokesTextureScale;
vStrokeUV.x += variantOffset;
}`),h.fragment.include(b.RgbaFloatEncoding),g.code.add(l.glsl`float calculateLineOffsetSketch() {
float offsetNorm = rgba2float(texture2D(strokesTexture, vStrokeUV));
return (offsetNorm - 0.5) * strokesNormalizationScale;
}
float calculateLinePressureSketch() {
return rgba2float(texture2D(strokesTexture, vStrokeUV + vec2(0.0, 0.5)));
}`));switch(d.mode){case v.EdgeUtilMode.SOLID:e.code.add(l.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes) {}`);g.code.add(l.glsl`float calculateLineOffset() {
return 0.0;
}
float calculateLinePressure() {
return 1.0;
}`);break;case v.EdgeUtilMode.SKETCH:e.code.add(l.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}`);g.code.add(l.glsl`float calculateLineOffset() {
return calculateLineOffsetSketch();
}
float calculateLinePressure() {
return calculateLinePressureSketch();
}`);break;case v.EdgeUtilMode.MIXED:h.varyings.add("vType","float"),e.code.add(l.glsl`void calculateStyleOutputs(UnpackedAttributes unpackedAttributes)
{
vType = unpackedAttributes.type;
if (unpackedAttributes.type <= 0.0) {
calculateStyleOutputsSketch(vLineLengthPixels, unpackedAttributes);
}
}`),g.code.add(l.glsl`float calculateLineOffset() {
if (vType <= 0.0) {
return calculateLineOffsetSketch();
}
else {
return 0.0;
}
}
float calculateLinePressure() {
if (vType <= 0.0) {
return calculateLinePressureSketch();
}
else {
return 1.0;
}
}`)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeShaderTechniqueConfiguration":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../core/shaderTechnique/ShaderTechniqueConfiguration ../../materials/DefaultTechniqueConfiguration ../../shaders/sources/edgeRenderer/EdgeUtil.glsl".split(" "),function(a,b,c,n,l,u){l=function(v){function m(){var h=
v.apply(this,arguments)||this;h.mode=u.EdgeUtilMode.SOLID;h.hasSlicePlane=!1;h.silhouette=!1;h.legacy=!1;h.antialiasing=!1;h.doublePrecisionRequiresObfuscation=!1;h.hasMultipassTerrain=!1;h.cullAboveGround=!1;h.spherical=!1;return h}b._inheritsLoose(m,v);return m}(l.DefaultTechniqueConfiguration);c.__decorate([n.parameter({count:u.EdgeUtilMode.COUNT})],l.prototype,"mode",void 0);c.__decorate([n.parameter()],l.prototype,"hasSlicePlane",void 0);c.__decorate([n.parameter()],l.prototype,"silhouette",
void 0);c.__decorate([n.parameter()],l.prototype,"legacy",void 0);c.__decorate([n.parameter()],l.prototype,"antialiasing",void 0);c.__decorate([n.parameter()],l.prototype,"doublePrecisionRequiresObfuscation",void 0);c.__decorate([n.parameter()],l.prototype,"hasMultipassTerrain",void 0);c.__decorate([n.parameter()],l.prototype,"cullAboveGround",void 0);c.__decorate([n.parameter()],l.prototype,"spherical",void 0);a.EdgeShaderTechniqueConfiguration=l;Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/EdgeWorkerHandle":function(){define(["../../../../../chunks/_rollupPluginBabelHelpers","../../../../../core/typedArrayUtil","../../../../../core/workers/WorkerHandle","../../../support/buffer/workerHelper","./EdgeProcessingWorker"],function(a,b,c,n,l){return function(u){function v(h){return u.call(this,"EdgeProcessingWorker","extract",{extract:d=>[d.dataBuffer],extractComponentsEdgeLocations:d=>[d.dataBuffer],
extractEdgeLocations:d=>[d.dataBuffer]},h)||this}a._inheritsLoose(v,u);var m=v.prototype;m.process=function(){var h=a._asyncToGenerator(function*(d,e,g){if(g)return l.extract(d);d=this._packInput(d);e=yield this.invoke(d,e);return this._unpackOutput(e)});return function(d,e,g){return h.apply(this,arguments)}}();m.extractEdgeLocations=function(){var h=a._asyncToGenerator(function*(d,e){d=this._packInput(d);e=yield this.invokeMethod("extractEdgeLocations",d,e);return n.unpackInterleavedBuffer(e)});
return function(d,e){return h.apply(this,arguments)}}();m.extractComponentsEdgeLocations=function(){var h=a._asyncToGenerator(function*(d,e){d=this._packInput(d);e=yield this.invokeMethod("extractComponentsEdgeLocations",d,e);return n.unpackInterleavedBuffer(e)});return function(d,e){return h.apply(this,arguments)}}();m._packInput=function(h){return{dataBuffer:h.data.buffer,writerSettings:h.writerSettings,skipDeduplicate:h.skipDeduplicate,indicesBuffer:h.indices.buffer,indicesType:b.isUint32Array(h.indices)?
"Uint32Array":"Uint16Array",indicesLength:h.indicesLength}};m._unpackOutput=function(h){return{regular:{instancesData:n.unpackInterleavedBuffer(h.regular.instancesData),lodInfo:{lengths:new Float32Array(h.regular.lodInfo.lengths)}},silhouette:{instancesData:n.unpackInterleavedBuffer(h.silhouette.instancesData),lodInfo:{lengths:new Float32Array(h.silhouette.lodInfo.lengths)}},averageEdgeLength:h.averageEdgeLength}};return v}(c.WorkerHandle)})},"esri/views/3d/webgl-engine/lib/edgeRendering/strokes":function(){define("exports ../../../../../core/floatRGBA ../../../../../core/mathUtils ../../../../../core/maybe ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,n,l,u){function v(e,g){if(!e)return null;var p=e.length/2;const t=.1*p;p=Array(p);let q=0;g=g===m.PRESSURE;for(let k=0;k<e.length;k+=2){const r=(e[k]+e[k+1])/2;g?p[q++]=Math.min(t,1-.5*(1-r)):p[q++]=Math.min(t,.5*r)}return p}var m;(function(e){e[e.DISTANCE=0]="DISTANCE";e[e.PRESSURE=1]="PRESSURE"})(m||(m={}));let h=function(){function e(g,p,t,q,k){this.resolution=g;this.normalizationScale=p;this.amplitude=t;this.variants=q;this.texture=k}e.prototype.dispose=function(){this.texture=
n.disposeMaybe(this.texture)};return e}();const d={amplitude:8,resolution:256,strokes:[{distance:[-1.59027,-1.59426,-1.59674,-1.59766,-1.59702,-1.59479,-1.59095,-1.5855,-1.57843,-1.56973,-1.55942,-1.5475,-1.53398,-1.5189,-1.50226,-1.4841,-1.46446,-1.44337,-1.42088,-1.39703,-1.37188,-1.34547,-1.31786,-1.28912,-1.2593,-1.22847,-1.19668,-1.16402,-1.13053,-1.09629,-1.06137,-1.02582,-.98972,-.95313,-.91611,-.87872,-.84102,-.80306,-.76488,-.72654,-.68807,-.64952,-.61092,-.57232,-.53375,-.49527,-.45692,
-.41874,-.38078,-.34309,-.3057,-.26867,-.23204,-.19585,-.16015,-.12497,-.09036,-.05634,-.02296,.00977,.04183,.07321,.10389,.13386,.16313,.19169,.21956,.24672,.27321,.299,.32413,.34858,.37237,.3955,.41798,.43981,.461,.48154,.50145,.52073,.53939,.55744,.57488,.5917,.6079,.62347,.63837,.65259,.66609,.67885,.69083,.70201,.71235,.72183,.73042,.73812,.7449,.75076,.7557,.75973,.76284,.76507,.76642,.76692,.76659,.76545,.76352,.76083,.7574,.75324,.74837,.74279,.73652,.72959,.72199,.71377,.70493,.69553,.68558,
.67515,.66426,.65298,.64135,.62944,.6173,.60499,.59257,.58008,.56759,.55513,.54275,.5305,.51842,.50654,.4949,.48353,.47246,.4617,.45128,.44121,.43149,.42213,.41313,.40448,.39617,.38818,.3805,.37309,.36594,.35902,.35229,.34572,.33927,.33292,.32663,.32035,.31407,.30774,.30135,.29486,.28824,.28148,.27454,.26739,.26002,.25241,.24454,.23639,.22796,.21922,.21016,.20076,.19098,.18082,.17023,.1592,.14768,.13566,.1231,.10996,.09624,.08188,.06688,.05121,.03485,.01778,0,-.0185,-.03771,-.05763,-.07824,-.09952,
-.12144,-.14396,-.16706,-.19069,-.21481,-.23938,-.26436,-.28971,-.31539,-.34136,-.36759,-.39404,-.42067,-.44746,-.47437,-.50136,-.52839,-.55544,-.58248,-.60948,-.63642,-.66329,-.6901,-.71684,-.74352,-.77015,-.79675,-.82332,-.84988,-.87644,-.90301,-.92958,-.95615,-.98272,-1.00926,-1.03575,-1.06217,-1.08847,-1.11463,-1.1406,-1.16633,-1.19178,-1.2169,-1.24164,-1.26595,-1.28979,-1.31312,-1.3359,-1.35809,-1.37963,-1.4005,-1.42064,-1.44,-1.45853,-1.47616,-1.49285,-1.50853,-1.52313,-1.53659,-1.54886,-1.55986,
-1.56955,-1.57788,-1.5848],pressure:[-.01365,-.00206,.01025,.02327,.03696,.05129,.06619,.08163,.09755,.11393,.1307,.14784,.16531,.18308,.20111,.21938,.23786,.25651,.2753,.29419,.31315,.33215,.35115,.37015,.38913,.40806,.42694,.44576,.46449,.48313,.50167,.5201,.53839,.55653,.57448,.59222,.60971,.62692,.6438,.66033,.67648,.69221,.70753,.72242,.73688,.75093,.76456,.77779,.79063,.80309,.81517,.82686,.83817,.84911,.85967,.86987,.87972,.88924,.89845,.90734,.91594,.92425,.93229,.94005,.94754,.95475,.96166,
.96826,.97451,.9804,.98588,.99092,.99549,.99957,.99685,.99381,.99131,.98936,.98796,.98711,.98681,.98706,.98787,.98923,.99113,.99357,.99654,1,.99607,.99171,.98695,.98181,.97634,.97057,.96452,.95824,.95175,.94506,.93818,.93113,.92389,.91647,.90887,.90109,.89314,.88501,.87672,.86831,.85978,.85119,.84256,.83393,.82533,.8168,.80836,.80002,.79181,.78374,.77582,.7681,.76059,.75331,.74629,.73955,.73311,.72697,.72116,.71568,.71054,.70572,.70121,.697,.69304,.68931,.68576,.68236,.67905,.67582,.67262,.66941,
.66619,.66291,.65957,.65613,.65259,.64892,.6451,.6411,.6369,.63248,.62783,.62295,.61783,.61247,.60688,.60104,.59498,.58868,.58216,.57542,.56845,.56125,.5538,.5461,.53813,.52986,.52129,.51239,.50316,.49359,.4837,.47349,.46299,.45223,.44124,.43005,.41869,.40719,.39557,.38386,.37207,.36023,.34836,.33648,.32464,.31287,.30119,.28963,.27822,.26698,.25594,.2451,.23448,.22409,.21391,.20394,.19415,.18452,.17503,.16565,.15636,.14713,.13794,.1288,.11968,.11058,.10151,.09247,.08346,.07447,.06552,.05659,.0477,
.03885,.03007,.02137,.01278,.00433,-.00393,-.012,-.01983,-.02738,-.03463,-.04155,-.0481,-.05429,-.0601,-.06553,-.07057,-.07524,-.07954,-.08347,-.08703,-.09022,-.09303,-.09544,-.09744,-.09898,-.10004,-.10059,-.1006,-.10005,-.09892,-.0972,-.09487,-.09192,-.08833,-.08409,-.07918,-.07357,-.06724,-.06019,-.0524,-.04386,-.03455,-.02448]},{distance:[-3.46259,-3.47131,-3.47668,-3.47863,-3.47712,-3.4721,-3.46352,-3.45138,-3.43566,-3.41635,-3.39347,-3.36704,-3.33709,-3.30368,-3.26684,-3.22667,-3.18322,-3.1366,
-3.08689,-3.0342,-2.97865,-2.92036,-2.85946,-2.79607,-2.73034,-2.66241,-2.59242,-2.52052,-2.44686,-2.37159,-2.29485,-2.2168,-2.13757,-2.05731,-1.97616,-1.89426,-1.81174,-1.72875,-1.64543,-1.56191,-1.47833,-1.39483,-1.3115,-1.22847,-1.14581,-1.06361,-.98193,-.90083,-.82036,-.74054,-.66141,-.583,-.50532,-.4284,-.35228,-.277,-.20261,-.12916,-.05672,.01463,.08485,.15384,.22153,.28784,.35269,.41602,.47776,.53787,.59629,.653,.70799,.76123,.81274,.86253,.9106,.95698,1.0017,1.04477,1.0862,1.126,1.16415,1.20065,
1.23546,1.26857,1.29994,1.32953,1.35731,1.38321,1.40719,1.42921,1.44922,1.46719,1.48309,1.49691,1.50862,1.51825,1.52581,1.53133,1.53486,1.53644,1.53616,1.53409,1.53031,1.52493,1.51803,1.50972,1.50009,1.48924,1.47725,1.46421,1.45019,1.43527,1.4195,1.40295,1.38568,1.36778,1.34929,1.3303,1.31087,1.29108,1.27099,1.25066,1.23018,1.2096,1.18898,1.16838,1.14785,1.12745,1.10721,1.08719,1.06741,1.04791,1.02871,1.00986,.99136,.97324,.95551,.93819,.92127,.90476,.88866,.87296,.85767,.84277,.82823,.81406,.80022,
.7867,.77346,.76049,.74774,.73519,.72278,.71049,.69827,.68606,.67381,.66145,.64893,.63618,.62313,.60973,.5959,.5816,.56675,.5513,.53516,.51826,.50053,.4819,.46231,.44169,.42002,.39725,.37336,.34834,.32219,.2949,.2665,.23698,.20638,.17469,.14193,.10809,.07316,.03714,0,-.03827,-.07772,-.11836,-.16022,-.20332,-.24768,-.29332,-.34024,-.38844,-.43788,-.48854,-.54036,-.59329,-.64724,-.70211,-.75782,-.81425,-.87128,-.92881,-.98674,-1.04498,-1.10346,-1.1621,-1.22086,-1.27969,-1.33854,-1.3974,-1.45625,-1.51511,
-1.57396,-1.63283,-1.69173,-1.75067,-1.80968,-1.86875,-1.9279,-1.98712,-2.04639,-2.10568,-2.16495,-2.22416,-2.28322,-2.34208,-2.40063,-2.4588,-2.51647,-2.57354,-2.62989,-2.68543,-2.74002,-2.79357,-2.84597,-2.89711,-2.94689,-2.99521,-3.04195,-3.087,-3.13023,-3.17152,-3.21075,-3.24779,-3.28252,-3.3148,-3.34451,-3.37154,-3.39577,-3.41709,-3.43539,-3.45059],pressure:[.87183,.87151,.87129,.87118,.87117,.87128,.87149,.87182,.87225,.8728,.87347,.87424,.87513,.87613,.87723,.87845,.87978,.88122,.88276,.88441,
.88616,.88801,.88996,.892,.89414,.89637,.89868,.90108,.90356,.90611,.90874,.91144,.91421,.91704,.91993,.92287,.92587,.92892,.93201,.93514,.93831,.94151,.94474,.94799,.95126,.95456,.95786,.96118,.9645,.96783,.97116,.97448,.9778,.98111,.98441,.9877,.99096,.99421,.99742,.99938,.99622,.9931,.99001,.98697,.98397,.98101,.97811,.97526,.97246,.96972,.96703,.96441,.96185,.95935,.95691,.95455,.95225,.95002,.94786,.94577,.94376,.94182,.93995,.93817,.93646,.93483,.93328,.93181,.93042,.92911,.92788,.92673,.92566,
.92467,.92376,.92293,.92217,.92149,.92088,.92034,.91987,.91947,.91913,.91886,.91864,.91849,.91838,.91833,.91834,.91839,.91849,.91863,.91883,.91907,.91935,.91968,.92005,.92046,.92092,.92142,.92195,.92253,.92314,.9238,.92449,.92521,.92598,.92677,.9276,.92847,.92936,.93029,.93125,.93224,.93325,.9343,.93537,.93646,.93758,.93872,.93988,.94106,.94225,.94346,.94469,.94593,.94718,.94844,.94971,.95098,.95226,.95354,.95482,.9561,.95738,.95867,.95995,.96122,.9625,.96377,.96504,.9663,.96757,.96883,.97009,.97135,
.97261,.97387,.97513,.9764,.97767,.97895,.98023,.98153,.98284,.98416,.98549,.98684,.98821,.9896,.99101,.99244,.99389,.99537,.99688,.99842,1,.99839,.99675,.99508,.99336,.99161,.98982,.98799,.98613,.98422,.98228,.98029,.97827,.97622,.97414,.97202,.96987,.9677,.96551,.9633,.96107,.95882,.95656,.9543,.95202,.94975,.94747,.94519,.94292,.94065,.93838,.93613,.93388,.93164,.92941,.9272,.92499,.9228,.92062,.91846,.91631,.91418,.91207,.90998,.90792,.90588,.90387,.90189,.89995,.89804,.89617,.89434,.89256,.89083,
.88914,.88752,.88595,.88443,.88299,.88161,.8803,.87907,.87791,.87683,.87584,.87494,.87412,.8734,.87278,.87225]},{distance:[.39335,.43437,.47737,.52234,.56923,.61801,.66864,.72109,.7753,.83123,.88882,.94801,1.00875,1.07097,1.13461,1.1996,1.26586,1.33333,1.40193,1.47158,1.54221,1.61373,1.68607,1.75913,1.83284,1.90711,1.98186,2.05699,2.13243,2.20809,2.28387,2.35971,2.4355,2.51117,2.58663,2.66179,2.73658,2.81092,2.88473,2.95792,3.03043,3.10217,3.17308,3.24309,3.31211,3.3801,3.44697,3.51267,3.57712,3.64028,
3.70208,3.76247,3.8214,3.87881,3.93467,3.98892,4.04152,4.09244,4.14164,4.18908,4.23474,4.27859,4.32061,4.36077,4.39905,4.43544,4.46992,4.50249,4.53314,4.56185,4.58864,4.61349,4.63642,4.65745,4.67657,4.69381,4.7092,4.72274,4.73447,4.74441,4.75259,4.75903,4.76376,4.76682,4.76822,4.768,4.76618,4.76279,4.75786,4.75142,4.74348,4.73409,4.72326,4.71102,4.69739,4.68241,4.6661,4.64849,4.6296,4.60948,4.58816,4.56567,4.54204,4.51732,4.49154,4.46473,4.43694,4.4082,4.37854,4.348,4.31662,4.28443,4.25145,4.21773,
4.1833,4.14819,4.11243,4.07606,4.03912,4.00162,3.96361,3.92512,3.88618,3.84683,3.80708,3.76697,3.72653,3.68579,3.64478,3.60351,3.56202,3.52033,3.47845,3.43642,3.39425,3.35196,3.30957,3.2671,3.22455,3.18196,3.13933,3.09668,3.05402,3.01136,2.96873,2.92613,2.88357,2.84108,2.79865,2.75631,2.71407,2.67195,2.62994,2.58807,2.54634,2.50477,2.46338,2.42216,2.38114,2.34032,2.29971,2.25933,2.21916,2.17923,2.13954,2.10008,2.06087,2.02189,1.98316,1.94468,1.90644,1.86845,1.83069,1.79316,1.75586,1.71877,1.68189,
1.6452,1.60868,1.57232,1.53611,1.50004,1.46407,1.4282,1.39241,1.35668,1.321,1.28535,1.24972,1.2141,1.17849,1.14286,1.10723,1.07158,1.03593,1.00028,.96464,.92902,.89344,.85793,.8225,.78719,.75203,.71705,.68231,.64784,.61369,.57991,.54656,.51368,.48134,.44959,.41849,.3881,.35848,.32967,.30174,.27474,.24872,.22373,.19982,.17702,.15539,.13497,.11579,.09791,.08137,.06621,.05248,.04022,.02948,.02029,.01271,.00677,.00252,0,-7.6E-4,2.7E-4,.00314,.00788,.01451,.02307,.03357,.04604,.0605,.07697,.09546,.11599,
.13858,.16322,.18992,.21869,.24952,.28241,.31735,.35434],pressure:[.95248,.95236,.95228,.95223,.95222,.95224,.95231,.95241,.95256,.95274,.95296,.95322,.95352,.95385,.95423,.95465,.9551,.9556,.95613,.9567,.95731,.95796,.95864,.95936,.96012,.96091,.96173,.96259,.96348,.9644,.96535,.96633,.96734,.96838,.96944,.97053,.97164,.97277,.97393,.9751,.97629,.9775,.97873,.97997,.98122,.98249,.98376,.98505,.98634,.98763,.98893,.99023,.99154,.99284,.99414,.99544,.99673,.99802,.9993,.99942,.99816,.99691,.99568,
.99445,.99324,.99205,.99087,.98972,.98858,.98746,.98636,.98528,.98423,.9832,.98219,.98121,.98025,.97931,.9784,.97752,.97666,.97582,.97501,.97423,.97347,.97274,.97203,.97135,.9707,.97007,.96948,.9689,.96836,.96784,.96735,.96689,.96646,.96605,.96567,.96533,.965,.96471,.96445,.96421,.964,.96382,.96367,.96355,.96346,.96339,.96335,.96334,.96336,.9634,.96348,.96358,.9637,.96385,.96403,.96423,.96446,.96471,.96499,.96529,.96561,.96595,.96631,.96669,.96709,.96751,.96795,.9684,.96887,.96935,.96984,.97035,.97087,
.9714,.97194,.97249,.97304,.97361,.97418,.97476,.97534,.97592,.97651,.97711,.9777,.9783,.9789,.9795,.9801,.9807,.9813,.9819,.9825,.98309,.98369,.98428,.98486,.98545,.98603,.98661,.98718,.98775,.98832,.98888,.98944,.99,.99056,.99112,.99167,.99223,.99279,.99335,.99392,.99449,.99507,.99565,.99624,.99684,.99745,.99807,.9987,.99934,1,.99933,.99866,.99797,.99727,.99656,.99583,.9951,.99435,.99359,.99283,.99205,.99126,.99046,.98966,.98885,.98803,.9872,.98637,.98554,.9847,.98387,.98303,.98219,.98134,.9805,
.97967,.97883,.978,.97717,.97634,.97552,.97471,.97389,.97309,.97229,.9715,.97071,.96993,.96915,.96838,.96762,.96687,.96612,.96539,.96466,.96395,.96324,.96255,.96187,.9612,.96055,.95991,.95929,.95869,.95811,.95754,.957,.95648,.95599,.95552,.95508,.95467,.95428,.95393,.9536,.95331,.95305,.95283,.95264]},{distance:[2.85606,2.86149,2.86432,2.8645,2.862,2.85686,2.84912,2.83886,2.82618,2.81117,2.79393,2.77456,2.75314,2.72975,2.70447,2.67734,2.64844,2.61784,2.58564,2.55196,2.5169,2.48057,2.44305,2.40438,
2.36462,2.32383,2.28208,2.23943,2.19591,2.15153,2.10628,2.06016,2.01321,1.96548,1.91702,1.86793,1.8183,1.76829,1.71803,1.66767,1.61737,1.56726,1.51746,1.46803,1.41902,1.37044,1.32228,1.27452,1.22716,1.18023,1.13376,1.08781,1.04244,.99769,.95357,.91003,.86701,.82447,.78238,.74069,.69938,.65836,.61758,.57699,.53656,.49627,.45611,.41611,.37632,.33683,.29776,.25924,.22141,.18441,.14839,.11346,.07972,.04727,.01619,-.01348,-.0417,-.0684,-.09351,-.11698,-.13875,-.1588,-.17713,-.19381,-.20889,-.22242,-.23444,
-.24501,-.25421,-.26216,-.26897,-.27473,-.27951,-.28336,-.28631,-.28836,-.28948,-.28963,-.28873,-.28673,-.28355,-.27916,-.27354,-.26673,-.25878,-.2498,-.23992,-.22929,-.21802,-.20623,-.19398,-.18134,-.16836,-.1551,-.14163,-.12809,-.11461,-.1013,-.08826,-.07557,-.06335,-.0517,-.04077,-.03065,-.02143,-.01321,-.00606,0,.00496,.00888,.01181,.01385,.01511,.0157,.01574,.01533,.01458,.01358,.0124,.01112,.00979,.00851,.00738,.0065,.006,.00596,.00646,.00754,.00924,.01161,.01471,.01858,.02323,.02865,.03481,
.04169,.0493,.05765,.06677,.07671,.08754,.09934,.11222,.12628,.14159,.15823,.17624,.19561,.21632,.23828,.26142,.28563,.31083,.33696,.36397,.39185,.42057,.4501,.48036,.51125,.54264,.5744,.60646,.63871,.67105,.70337,.73556,.76751,.79918,.83048,.86139,.8919,.92202,.95184,.98144,1.01094,1.04045,1.0701,1.10002,1.13029,1.16103,1.1923,1.22416,1.25664,1.28979,1.32364,1.35824,1.39363,1.42985,1.4669,1.50475,1.54332,1.58252,1.62227,1.6625,1.70312,1.744,1.78501,1.82598,1.8668,1.90734,1.94754,1.98732,2.02666,
2.06555,2.10402,2.1421,2.17985,2.2173,2.25448,2.29139,2.328,2.36424,2.4,2.43515,2.46955,2.50309,2.53565,2.56717,2.59761,2.62692,2.65505,2.68191,2.7074,2.73138,2.75375,2.7744,2.79324,2.81017,2.82504,2.83772,2.8481],pressure:[.22758,.23641,.24578,.25568,.26609,.27699,.28835,.30016,.31237,.32495,.33789,.35113,.36466,.37843,.39241,.40658,.4209,.43535,.44989,.4645,.47916,.49385,.50853,.5232,.53784,.55243,.56696,.58141,.59578,.61004,.62419,.63821,.65209,.6658,.67934,.69268,.70582,.71873,.73139,.7438,.75594,
.76779,.77935,.79061,.80156,.81221,.82254,.83258,.84231,.85176,.86091,.86978,.87837,.88669,.89473,.9025,.91,.91725,.92425,.931,.93752,.9438,.94985,.95566,.96124,.96658,.97168,.97652,.98109,.98539,.98939,.99309,.99646,.99949,.99783,.99552,.99361,.99209,.99098,.99029,.99003,.99019,.99079,.99181,.99324,.9951,.99735,1,.99698,.99361,.98992,.98592,.98163,.97709,.97231,.96731,.96212,.95676,.95122,.94554,.93973,.93378,.92773,.92157,.91532,.90899,.90258,.89612,.88961,.88308,.87653,.87,.8635,.85705,.85068,
.8444,.83823,.83219,.82628,.82052,.81493,.80952,.8043,.79929,.7945,.78994,.78561,.78151,.77765,.77402,.77062,.76742,.76443,.76161,.75896,.75645,.75406,.75175,.74951,.7473,.74511,.74289,.74064,.73833,.73592,.73341,.73078,.728,.72507,.72197,.71869,.71522,.71156,.70769,.70363,.69936,.69489,.69021,.68533,.68023,.67492,.66939,.66363,.65765,.65145,.64501,.63833,.63143,.62428,.61691,.60931,.60148,.59344,.58521,.57679,.5682,.55948,.55063,.54167,.53264,.52354,.51439,.50522,.49603,.48686,.47773,.46865,.45964,
.45072,.44192,.43324,.42469,.41629,.40804,.39994,.392,.3842,.37655,.36903,.36164,.35437,.3472,.34012,.33312,.3262,.31933,.31251,.30574,.299,.2923,.28563,.27899,.27239,.26583,.25933,.25288,.24652,.24025,.2341,.22808,.22221,.21653,.21104,.20576,.20072,.19592,.19138,.18712,.18313,.17943,.17602,.17292,.17013,.16766,.16551,.16369,.16222,.1611,.16036,.16001,.16007,.16055,.16148,.16286,.16471,.16705,.16988,.17321,.17706,.18144,.18636,.19182,.19785,.20443,.21158,.2193]},{distance:[-2.31317,-2.3191,-2.32189,
-2.32154,-2.31811,-2.31174,-2.30254,-2.29062,-2.27609,-2.25904,-2.23954,-2.21767,-2.19355,-2.16732,-2.13907,-2.10885,-2.07672,-2.04268,-2.00677,-1.96911,-1.92985,-1.88914,-1.84713,-1.80397,-1.75979,-1.71467,-1.66864,-1.62171,-1.57395,-1.52546,-1.47625,-1.42628,-1.3755,-1.32384,-1.27131,-1.218,-1.16408,-1.10972,-1.05508,-1.00031,-.94551,-.89077,-.83615,-.7817,-.72757,-.6739,-.62076,-.56821,-.51625,-.46484,-.41397,-.36366,-.314,-.26506,-.21689,-.16957,-.12316,-.07766,-.03301,.01085,.05399,.09643,.13827,
.17967,.22079,.26176,.30265,.34342,.38397,.42414,.46381,.50285,.54115,.57863,.61524,.65093,.6856,.71914,.75153,.78275,.81283,.84182,.86972,.89651,.92208,.94634,.96919,.99052,1.01025,1.02835,1.04484,1.05976,1.07309,1.08479,1.09492,1.1036,1.11096,1.11714,1.12224,1.12627,1.12916,1.13083,1.13125,1.13036,1.12816,1.12466,1.11992,1.11397,1.10677,1.09827,1.08849,1.07746,1.06527,1.05203,1.03786,1.02283,1.00695,.99025,.97279,.9546,.93573,.9163,.8965,.8765,.85647,.83652,.81687,.79775,.77939,.76199,.74568,.73049,
.71635,.70316,.69082,.67925,.66834,.65804,.64831,.63911,.63032,.62184,.61363,.60564,.59788,.59036,.58308,.57597,.5689,.56177,.55447,.5469,.53896,.53062,.5219,.51283,.5034,.49355,.48335,.47287,.46223,.45154,.44085,.43012,.41923,.40805,.39648,.38441,.37176,.35849,.34458,.32999,.31461,.29833,.28109,.26288,.2437,.22361,.20265,.18082,.15807,.13434,.1096,.0838,.0569,.02894,0,-.0298,-.0604,-.09173,-.12364,-.15594,-.18843,-.22092,-.25331,-.28559,-.31781,-.35006,-.38244,-.41502,-.44785,-.48098,-.5144,-.54811,
-.58218,-.61666,-.65153,-.68677,-.72232,-.75807,-.79397,-.83002,-.86628,-.90281,-.93968,-.97693,-1.01465,-1.05282,-1.09139,-1.13031,-1.16956,-1.20917,-1.24905,-1.28907,-1.32908,-1.36891,-1.40844,-1.44765,-1.48658,-1.52527,-1.56376,-1.60206,-1.64016,-1.67801,-1.71552,-1.75264,-1.78936,-1.8257,-1.86161,-1.89702,-1.93182,-1.96584,-1.99894,-2.03102,-2.06203,-2.0919,-2.12056,-2.14794,-2.17397,-2.19852,-2.22138,-2.24235,-2.26129,-2.27805,-2.29243,-2.30422],pressure:[.9681,.97424,.98046,.98674,.99309,.9995,
.99404,.98754,.981,.97444,.96785,.96124,.95462,.94801,.94139,.93479,.92822,.92167,.91515,.90868,.90225,.89589,.88959,.88336,.87722,.87115,.86519,.85932,.85356,.84792,.84239,.83699,.83173,.8266,.82162,.81679,.81211,.80759,.80324,.79906,.79505,.79121,.78756,.78409,.78081,.77771,.77481,.77211,.76959,.76728,.76516,.76324,.76153,.76001,.75869,.75757,.75665,.75593,.7554,.75507,.75493,.75498,.75523,.75565,.75627,.75706,.75803,.75917,.76049,.76197,.76361,.76541,.76737,.76947,.77172,.77409,.7766,.77923,.78198,
.78484,.7878,.79086,.79401,.79724,.80055,.80394,.8074,.81092,.8145,.81813,.82182,.82556,.82934,.83317,.83703,.84093,.84487,.84884,.85284,.85687,.86094,.86503,.86915,.87329,.87746,.88166,.88587,.89011,.89436,.89863,.90291,.9072,.91149,.91579,.92009,.92438,.92867,.93295,.9372,.94144,.94566,.94985,.954,.95812,.96219,.96623,.97021,.97415,.97802,.98184,.9856,.9893,.99293,.9965,1,.99657,.9932,.98991,.98668,.98352,.98042,.97738,.9744,.97148,.9686,.96577,.96298,.96023,.95751,.95482,.95214,.94949,.94684,.9442,
.94156,.93892,.93627,.93361,.93094,.92825,.92555,.92284,.9201,.91735,.91458,.91179,.90899,.90616,.90332,.90047,.8976,.89472,.89183,.88893,.88603,.88314,.88024,.87735,.87448,.87162,.86878,.86597,.86319,.86044,.85774,.85508,.85247,.84993,.84744,.84503,.84269,.84042,.83825,.83616,.83417,.83227,.83048,.8288,.82724,.82578,.82445,.82324,.82215,.82119,.82037,.81967,.81911,.81868,.81839,.81824,.81823,.81835,.81862,.81903,.81957,.82026,.82109,.82206,.82317,.82443,.82583,.82737,.82906,.83089,.83287,.83499,
.83726,.83968,.84223,.84494,.84778,.85077,.8539,.85717,.86058,.86412,.86781,.87163,.87559,.87968,.88391,.88826,.89275,.89737,.90211,.90698,.91198,.91709,.92233,.92768,.93315,.93873,.94441,.95019,.95607,.96205]},{distance:[4.72925,4.81721,4.9037,4.98859,5.07177,5.15311,5.23249,5.3098,5.38491,5.45772,5.52811,5.59598,5.66122,5.72375,5.78346,5.84028,5.8941,5.94486,5.99248,6.03689,6.07803,6.11584,6.15028,6.18128,6.20882,6.23285,6.25336,6.27031,6.28369,6.29348,6.29969,6.3023,6.30133,6.29678,6.28867,6.27703,
6.26187,6.24324,6.22116,6.19567,6.16683,6.13468,6.09928,6.06068,6.01896,5.97417,5.92639,5.87569,5.82217,5.76589,5.70696,5.64545,5.58147,5.5151,5.44644,5.37559,5.30265,5.2277,5.15085,5.0722,4.99184,4.90987,4.82639,4.74151,4.65533,4.56794,4.47945,4.38996,4.29959,4.20843,4.11658,4.02416,3.93125,3.83796,3.74437,3.65057,3.55666,3.46272,3.36884,3.27509,3.18155,3.08831,2.99545,2.90303,2.81114,2.71984,2.62922,2.53933,2.45026,2.36207,2.27484,2.18862,2.10349,2.01951,1.93675,1.85528,1.77515,1.69644,1.61919,
1.54348,1.46935,1.39685,1.32605,1.25698,1.18967,1.12417,1.06049,.99863,.93862,.88044,.82408,.76953,.71676,.66574,.61644,.56882,.52282,.47841,.43553,.39413,.35414,.31551,.27817,.24206,.20712,.17328,.14048,.10866,.07776,.04772,.01848,-.00999,-.03776,-.06487,-.09134,-.11721,-.14251,-.16725,-.19144,-.21509,-.2382,-.26076,-.28275,-.30416,-.32496,-.34511,-.36459,-.38334,-.40134,-.41852,-.43485,-.45026,-.46471,-.47815,-.49052,-.50179,-.51189,-.52081,-.52849,-.5349,-.54003,-.54383,-.54627,-.54734,-.54702,
-.54528,-.54211,-.53752,-.53149,-.52403,-.51515,-.50487,-.4932,-.48015,-.46575,-.45001,-.43297,-.41463,-.39503,-.37419,-.35213,-.32887,-.30443,-.27885,-.25214,-.22432,-.19541,-.16544,-.13442,-.10235,-.06926,-.03514,0,.03616,.07336,.11159,.15088,.19125,.23272,.27531,.31906,.36401,.41019,.45764,.5064,.55651,.60802,.66096,.71538,.77129,.82874,.88776,.94836,1.01056,1.07438,1.13982,1.20687,1.27554,1.34581,1.41766,1.49107,1.56599,1.64239,1.72025,1.79951,1.88013,1.96209,2.04532,2.12979,2.21546,2.30226,2.39017,
2.47911,2.56905,2.65991,2.75164,2.84416,2.93742,3.03133,3.12582,3.2208,3.31619,3.41191,3.50785,3.60393,3.70006,3.79612,3.89202,3.98765,4.08291,4.17767,4.27182,4.36525,4.45783,4.54944,4.63995],pressure:[.30942,.30838,.30765,.30724,.30715,.30738,.30795,.30884,.31007,.31164,.31354,.31578,.31837,.32129,.32455,.32815,.33209,.33636,.34097,.34591,.35117,.35675,.36265,.36887,.37539,.38221,.38933,.39674,.40442,.41238,.4206,.42907,.43779,.44675,.45593,.46533,.47493,.48473,.49471,.50486,.51517,.52563,.53623,
.54694,.55777,.5687,.57971,.59079,.60194,.61313,.62435,.6356,.64686,.65811,.66935,.68056,.69174,.70286,.71391,.72489,.73579,.74659,.75728,.76785,.7783,.7886,.79876,.80877,.81861,.82827,.83776,.84706,.85617,.86507,.87378,.88227,.89056,.89863,.90649,.91412,.92153,.92872,.93568,.94241,.94892,.95519,.96122,.96702,.97258,.97791,.98299,.98783,.99242,.99677,.99911,.99525,.99164,.98827,.98515,.98228,.97966,.97728,.97514,.97324,.97159,.97017,.96898,.96801,.96727,.96674,.96641,.96629,.96635,.96661,.96703,.96762,
.96838,.96928,.97032,.97149,.97279,.9742,.97572,.97734,.97905,.98085,.98273,.98468,.98669,.98877,.99091,.99311,.99535,.99765,1,.9976,.99516,.99267,.99014,.98755,.98491,.98222,.97947,.97666,.97378,.97083,.96781,.96471,.96153,.95826,.9549,.95144,.94787,.9442,.94042,.93651,.93249,.92834,.92407,.91966,.91512,.91045,.90564,.90069,.8956,.89037,.885,.87949,.87384,.86806,.86214,.85608,.84988,.84356,.83711,.83053,.82383,.81702,.81009,.80306,.79594,.78872,.78141,.77403,.76657,.75905,.75148,.74385,.73619,.72849,
.72076,.71302,.70526,.69749,.68972,.68195,.67419,.66644,.65871,.65099,.64329,.63561,.62795,.62032,.61271,.60512,.59755,.59001,.58248,.57497,.56749,.56002,.55256,.54512,.5377,.5303,.52291,.51554,.50819,.50087,.49358,.48632,.4791,.47192,.4648,.45773,.45072,.44378,.43692,.43015,.42346,.41687,.41039,.40403,.39779,.39168,.38571,.37989,.37423,.36873,.36342,.35828,.35335,.34862,.34409,.3398,.33573,.3319,.32831,.32498,.32192,.31912,.3166,.31436,.31242,.31077]}]};a.StrokesTexture=h;a.generateStrokesTexture=
function(e){const g=d.resolution;var p=g/2;const t=new Uint8Array(4*g*g),q=4*g*p;p=d.amplitude;const k=2*p,r=4*g,y=Math.log2(g)+1,f=d.strokes.length;let w=(y-1)*f*r;for(const {distance:z,pressure:A}of d.strokes){let x=z,B=A,C=w;for(let D=0;D<y;D++){0!==D&&(x=v(x,m.DISTANCE),B=v(B,m.PRESSURE));for(let E=0;E<d.resolution;E++){const F=B?B[E%B.length]:1;b.packFloatRGBA((x?x[E%x.length]/k:0)+.5,t,C);b.packFloatRGBA(F,t,C+q);C+=4}C-=r*(f+1)}w+=r}e=new u.Texture(e,{pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,
hasMipmap:!1,samplingMode:l.TextureSamplingMode.LINEAR,width:g,height:g,wrapMode:l.TextureWrapMode.REPEAT},t);return new h(g,k,p,f,e)};a.rasterizeStrokes=function(){var e=d.resolution;const g=Math.log2(e)+1;var p=d.strokes.length;const t=d.amplitude,q=Math.ceil(2*t+.5);var k;for(k=0;1<=e;)k+=e,e/=2;k+=6*(g+1);p*=q;e=new Uint8ClampedArray(4*k*p);const r=4*k;e.fill(255);let y=24;for(const {distance:f,pressure:w}of d.strokes){let z=f,A=w,x=y;for(let B=0;B<g;B++){0!==B&&(z=v(z,m.DISTANCE),A=v(A,m.PRESSURE));
for(let C=0;C<z.length;C++){const D=z?z[C]:0,E=A?c.clamp(A[C],0,1):1;let F=x;for(let G=-t;G<q-t;G++){const O=255-255*c.clamp(1-(Math.abs(G-D+.5)-.5*E),0,1);e[F+0]=O;e[F+1]=O;e[F+2]=O;e[F+3]=255;F+=r}x+=4}x+=24}y+=q*r}return new ImageData(e,k,p)};a.strokesDefinition=d;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/edgeRendering/util":function(){define(["exports","../../../../../core/arrayUtils","../../../../../core/maybe",
"./interfaces"],function(a,b,c,n){a.computeEdgeCount=function(l,u,v){const m=l.length;u*=v.minimumEdgeLength;v=b.binaryIndexOf(l,u,!0);l=-1===v?u<l[0]?0:l.length:v;return m-l};a.determineEdgeTransparency=function(l){let u=n.Transparency.INVISIBLE;for(const {material:v}of l)if(0<v.size*v.color[3]*v.opacity){if(1>v.color[3]*v.opacity)return n.Transparency.TRANSPARENT;u=n.Transparency.OPAQUE}return u};a.determineObjectTransparency=function(l){let u=n.Transparency.INVISIBLE;for(const {material:v}of l)if(0<
v.size*v.color[3]*v.opacity){switch(v.objectTransparency){case n.Transparency.TRANSPARENT:case n.Transparency.INVISIBLE:return n.Transparency.TRANSPARENT;case n.Transparency.OPAQUE:if(1>v.opacity)return n.Transparency.TRANSPARENT}u=n.Transparency.OPAQUE}return u};a.determineRendererType=function(l){let u=null;for(const v of l)if(l=v.type,0<v.size*v.color[3])if(c.isNone(u))u=l;else if(u!==l)return"uber";return c.isSome(u)?u:"uber"};a.estimateLengthAtDistance=function(l,u,v,m){return m/l*v*2*Math.tan(.5*
u)};a.fillComponenBufferIndices=function(l,u,v,m){for(let d=0;d<l.length;d++){const e=l[d].index;var h=u[d];const g=u[d+1];if(m)for(;h<g;h++)v.set(m[h],e);else for(;h<g;h++)v.set(h,e)}};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/statistics/RendererPerformanceInfo":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/PerformanceSampler ../../../../core/time ../../../../core/accessorSupport/utils ../../../webgl/Measurement".split(" "),
function(a,b,c,n,l,u,v){a.Statistics=void 0;(function(e){e[e.Prepare=0]="Prepare";e[e.Shadowmap=1]="Shadowmap";e[e.Lineardepth=2]="Lineardepth";e[e.Normals=3]="Normals";e[e.SSAO=4]="SSAO";e[e.Opaque=5]="Opaque";e[e.OpaqueEdges=6]="OpaqueEdges";e[e.Transparent=7]="Transparent";e[e.TransparentEdges=8]="TransparentEdges";e[e.Hudvisibility=9]="Hudvisibility";e[e.TransparentTerrain=10]="TransparentTerrain";e[e.Atmosphere=11]="Atmosphere";e[e.Laserline=12]="Laserline";e[e.Occluded=13]="Occluded";e[e.Antialiasing=
14]="Antialiasing";e[e.Highlights=15]="Highlights";e[e.HudOccluded=16]="HudOccluded";e[e.HudNotoccluded=17]="HudNotoccluded"})(a.Statistics||(a.Statistics={}));const m="prepare;shadowmap;lineardepth;normals;ssao;opaque;opaque edges;transparent;transparent edges;hudvisibility;transparent terrain;atmosphere;laserline;occluded;antialiasing;highlights;hudOccluded;hudNotoccluded".split(";");let h=function(e){function g(){var p=e.call(this,"total")||this;p.total=0;p.frameCount=0;return p}b._inheritsLoose(g,
e);return g}(n),d=function(){function e(){this._startTime=l.Milliseconds(0);this._lastSample=l.Milliseconds(0);this._enableGPUTimer=0;this.totalTime=new h;this.gpuTime=new n("gpu",9);this.renderPassTimings=m.map(p=>new n(p))}var g=e.prototype;g.enableGPUTimer=function(){++this._enableGPUTimer;return{remove:u.once(()=>--this._enableGPUTimer)}};g.prerender=function(p){this._startTime=this._lastSample=l.Milliseconds(performance.now());this._enableGPUTimer&&(this._gpuTimer=v.startMeasurement(p))};g.advance=
function(p){const t=l.Milliseconds(performance.now());this.renderPassTimings[p].record(t-this._lastSample);this._lastSample=t};g.postrender=function(){c.isSome(this._gpuTimer)&&(this._gpuTimer.stop(t=>c.isSome(t)&&this.gpuTime.record(t),16),this._gpuTimer=null);const p=performance.now()-this._startTime;this.totalTime.record(p);this.totalTime.total+=p;this.totalTime.frameCount++};b._createClass(e,[{key:"elapsedTime",get:function(){return l.Milliseconds(performance.now()-this._startTime)}}]);return e}();
a.RenderTime=h;a.RendererPerformanceInfo=d;a.performanceStatsCategories=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Measurement":function(){define(["exports","../../core/maybe"],function(a,b){let c=function(){function u(m){this.timer=m;this.start=m.createQuery();m.createTimestamp(this.start)}var v=u.prototype;v.stop=function(m,h=50){this.end=this.timer.createQuery();this.timer.createTimestamp(this.end);this._checkQueryResult(m,h)};
v._checkQueryResult=function(m,h){if(this.timer.resultAvailable(this.end))if(this.timer.disjoint())m(null);else{var d=this.timer.getResult(this.start),e=this.timer.getResult(this.end);m((e-d)/1E6)}else setTimeout(()=>this._checkQueryResult(m,h),h)};return u}(),n=function(){function u(m){this.timer=m;this.query=m.createQuery();l=!0;this.timer.beginTimeElapsed(this.query)}var v=u.prototype;v.stop=function(m,h=50){this.timer.endTimeElapsed();l=!1;this._checkQueryResult(m,h)};v._checkQueryResult=function(m,
h){var d=this.timer.resultAvailable(this.query);const e=this.timer.disjoint();d&&!e?(d=this.timer.getResult(this.query),m(d/1E6)):e?m(null):setTimeout(()=>this._checkQueryResult(m,h),h)};return u}(),l=!1;a.startMeasurement=function(u){u=u.capabilities.disjointTimerQuery;return b.isNone(u)?null:0<u.timestampBits()?new c(u):l?null:new n(u)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/RenderingContext":function(){define(["exports",
"../../../../chunks/_rollupPluginBabelHelpers","../../../../core/maybe","../../../webgl/RenderingContext"],function(a,b,c,n){n=function(l){function u(m,h,d){m=l.call(this,m,h)||this;m.newCache=d;m._refCount=1;return m}b._inheritsLoose(u,l);var v=u.prototype;v.dispose=function(){0<--this._refCount||l.prototype.dispose.call(this)};v.ref=function(){++this._refCount};v.bindTechnique=function(m,h,d,e){this.useProgram(m.program);const g=c.isSome(d)?d.slot:null;m.bindPipelineState(this,g,e);c.isSome(h)&&
c.isSome(d)&&m.bindPass(h,d);return m.program};b._createClass(u,[{key:"test",get:function(){return this.programCache.test}}]);return u}(n.RenderingContext);a.RenderingContext=n;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/RenderingContext":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ../../core/promiseUtils ../../core/time ./checkWebGLError ./context-util ./ContextState ./enums ./InstanceCounter ./ProgramCache ./renderState ./Texture ./Util ./WebGLDriverTest ./capabilities/Capabilities ./capabilities/isWebGL2Context".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){function y(z,A,x,B){A?B!==A&&z.bindBuffer(x,A.glName):z.bindBuffer(x,null);return A}function f(z,A){switch(z){case h.PrimitiveType.POINTS:return 2*A;case h.PrimitiveType.TRIANGLES:return A/3;case h.PrimitiveType.TRIANGLE_STRIP:return A-2;case h.PrimitiveType.TRIANGLE_FAN:return A-2;default:return 0}}let w=function(){function z(x,B){this.gl=x;this.instanceCounter=new d.InstanceCounter;this.programCache=new e.ProgramCache(this);this._state=new m.ContextState;
this._numOfTriangles=this._numOfDrawCalls=0;this.type=r(x)?v.ContextType.WEBGL2:v.ContextType.WEBGL1;this._loadExtensions();this.configure(B)}var A=z.prototype;A.configure=function(x){this._capabilities=new k.Capabilities(this.gl,x);this._parameters=this._loadParameters(x);x=this.gl.getParameter(this.gl.VIEWPORT);this._state=new m.ContextState;this._state.viewport={x:x[0],y:x[1],width:x[2],height:x[3]};this._stateTracker=new g.StateTracker({setBlending:B=>{B?(this.setBlendingEnabled(!0),this.setBlendEquationSeparate(B.opRgb,
B.opAlpha),this.setBlendFunctionSeparate(B.srcRgb,B.dstRgb,B.srcAlpha,B.dstAlpha),B=B.color,this.setBlendColor(B.r,B.g,B.b,B.a)):this.setBlendingEnabled(!1)},setCulling:B=>{B?(this.setFaceCullingEnabled(!0),this.setCullFace(B.face),this.setFrontFace(B.mode)):this.setFaceCullingEnabled(!1)},setPolygonOffset:B=>{B?(this.setPolygonOffsetFillEnabled(!0),this.setPolygonOffset(B.factor,B.units)):this.setPolygonOffsetFillEnabled(!1)},setDepthTest:B=>{B?(this.setDepthTestEnabled(!0),this.setDepthFunction(B.func)):
this.setDepthTestEnabled(!1)},setStencilTest:B=>{if(B){this.setStencilTestEnabled(!0);const C=B.function;this.setStencilFunction(C.func,C.ref,C.mask);B=B.operation;this.setStencilOp(B.fail,B.zFail,B.zPass)}else this.setStencilTestEnabled(!1)},setDepthWrite:B=>{B?(this.setDepthWriteEnabled(!0),this.setDepthRange(B.zNear,B.zFar)):this.setDepthWriteEnabled(!1)},setColorWrite:B=>{B?this.setColorMask(B.r,B.g,B.b,B.a):this.setColorMask(!1,!1,!1,!1)},setStencilWrite:B=>{B?this.setStencilWriteMask(B.mask):
this.setStencilWriteMask(0)}});this.enforceState();this._driverTest=new q.WebGLDriverTest(this)};A.dispose=function(){this.programCache.dispose();this.bindVAO(null);this.unbindBuffer(h.BufferType.ARRAY_BUFFER);this.unbindBuffer(h.BufferType.ELEMENT_ARRAY_BUFFER);r(this.gl)&&(this.unbindBuffer(h.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(h.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(h.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(h.BufferType.COPY_READ_BUFFER),
this.unbindBuffer(h.BufferType.COPY_WRITE_BUFFER));this._state.textureUnitMap.length=0;u.webglDebugEnabled()&&this.instanceCounter.printResourceCount()};A.setPipelineState=function(x){this._stateTracker.setPipeline(x)};A.setBlendingEnabled=function(x){this._state.blend!==x&&(!0===x?this.gl.enable(this.gl.BLEND):this.gl.disable(this.gl.BLEND),this._state.blend=x,this._stateTracker.invalidateBlending())};A.externalProgramUpdate=function(){var x;null==(x=this._state.program)?void 0:x.stop();this._state.program=
null};A.externalTextureUnitUpdate=function(x,B){for(let C=0;C<x.length;++C)this._state.textureUnitMap[x[C]]=null;0<=B&&(this._state.activeTexture=B)};A.externalVertexArrayObjectUpdate=function(){const x=this.capabilities.vao;x&&(x.bindVertexArray(null),this._state.vertexArrayObject=null);this._state.vertexBuffer=null;this._state.indexBuffer=null};A.externalVertexBufferUpdate=function(){this._state.vertexBuffer=null};A.externalIndexBufferUpdate=function(){this._state.indexBuffer=null};A.setBlendColor=
function(x,B,C,D){if(x!==this._state.blendColor.r||B!==this._state.blendColor.g||C!==this._state.blendColor.b||D!==this._state.blendColor.a)this.gl.blendColor(x,B,C,D),this._state.blendColor.r=x,this._state.blendColor.g=B,this._state.blendColor.b=C,this._state.blendColor.a=D,this._stateTracker.invalidateBlending()};A.setBlendFunction=function(x,B){if(x!==this._state.blendFunction.srcRGB||B!==this._state.blendFunction.dstRGB)this.gl.blendFunc(x,B),this._state.blendFunction.srcRGB=x,this._state.blendFunction.srcAlpha=
x,this._state.blendFunction.dstRGB=B,this._state.blendFunction.dstAlpha=B,this._stateTracker.invalidateBlending()};A.setBlendFunctionSeparate=function(x,B,C,D){if(this._state.blendFunction.srcRGB!==x||this._state.blendFunction.srcAlpha!==C||this._state.blendFunction.dstRGB!==B||this._state.blendFunction.dstAlpha!==D)this.gl.blendFuncSeparate(x,B,C,D),this._state.blendFunction.srcRGB=x,this._state.blendFunction.srcAlpha=C,this._state.blendFunction.dstRGB=B,this._state.blendFunction.dstAlpha=D,this._stateTracker.invalidateBlending()};
A.setBlendEquation=function(x){this._state.blendEquation.mode!==x&&(this.gl.blendEquation(x),this._state.blendEquation.mode=x,this._state.blendEquation.modeAlpha=x,this._stateTracker.invalidateBlending())};A.setBlendEquationSeparate=function(x,B){if(this._state.blendEquation.mode!==x||this._state.blendEquation.modeAlpha!==B)this.gl.blendEquationSeparate(x,B),this._state.blendEquation.mode=x,this._state.blendEquation.modeAlpha=B,this._stateTracker.invalidateBlending()};A.setColorMask=function(x,B,
C,D){if(this._state.colorMask.r!==x||this._state.colorMask.g!==B||this._state.colorMask.b!==C||this._state.colorMask.a!==D)this.gl.colorMask(x,B,C,D),this._state.colorMask.r=x,this._state.colorMask.g=B,this._state.colorMask.b=C,this._state.colorMask.a=D,this._stateTracker.invalidateColorWrite()};A.setClearColor=function(x,B,C,D){if(this._state.clearColor.r!==x||this._state.clearColor.g!==B||this._state.clearColor.b!==C||this._state.clearColor.a!==D)this.gl.clearColor(x,B,C,D),this._state.clearColor.r=
x,this._state.clearColor.g=B,this._state.clearColor.b=C,this._state.clearColor.a=D};A.setFaceCullingEnabled=function(x){this._state.faceCulling!==x&&(!0===x?this.gl.enable(this.gl.CULL_FACE):this.gl.disable(this.gl.CULL_FACE),this._state.faceCulling=x,this._stateTracker.invalidateCulling())};A.setPolygonOffsetFillEnabled=function(x){this._state.polygonOffsetFill!==x&&(!0===x?this.gl.enable(this.gl.POLYGON_OFFSET_FILL):this.gl.disable(this.gl.POLYGON_OFFSET_FILL),this._state.polygonOffsetFill=x,this._stateTracker.invalidatePolygonOffset())};
A.setPolygonOffset=function(x,B){if(this._state.polygonOffset[0]!==x||this._state.polygonOffset[1]!==B)this._state.polygonOffset[0]=x,this._state.polygonOffset[1]=B,this.gl.polygonOffset(x,B),this._stateTracker.invalidatePolygonOffset()};A.setCullFace=function(x){this._state.cullFace!==x&&(this.gl.cullFace(x),this._state.cullFace=x,this._stateTracker.invalidateCulling())};A.setFrontFace=function(x){this._state.frontFace!==x&&(this.gl.frontFace(x),this._state.frontFace=x,this._stateTracker.invalidateCulling())};
A.setScissorTestEnabled=function(x){this._state.scissorTest!==x&&(!0===x?this.gl.enable(this.gl.SCISSOR_TEST):this.gl.disable(this.gl.SCISSOR_TEST),this._state.scissorTest=x)};A.setScissorRect=function(x,B,C,D){if(this._state.scissorRect.x!==x||this._state.scissorRect.y!==B||this._state.scissorRect.width!==C||this._state.scissorRect.height!==D)this.gl.scissor(x,B,C,D),this._state.scissorRect.x=x,this._state.scissorRect.y=B,this._state.scissorRect.width=C,this._state.scissorRect.height=D};A.setDepthTestEnabled=
function(x){this._state.depthTest!==x&&(!0===x?this.gl.enable(this.gl.DEPTH_TEST):this.gl.disable(this.gl.DEPTH_TEST),this._state.depthTest=x,this._stateTracker.invalidateDepthTest())};A.setClearDepth=function(x){this._state.clearDepth!==x&&(this.gl.clearDepth(x),this._state.clearDepth=x)};A.setDepthFunction=function(x){this._state.depthFunction!==x&&(this.gl.depthFunc(x),this._state.depthFunction=x,this._stateTracker.invalidateDepthTest())};A.setDepthWriteEnabled=function(x){this._state.depthWrite!==
x&&(this.gl.depthMask(x),this._state.depthWrite=x,this._stateTracker.invalidateDepthWrite())};A.setDepthRange=function(x,B){if(this._state.depthRange.zNear!==x||this._state.depthRange.zFar!==B)this.gl.depthRange(x,B),this._state.depthRange.zNear=x,this._state.depthRange.zFar=B,this._stateTracker.invalidateDepthWrite()};A.setStencilTestEnabled=function(x){this._state.stencilTest!==x&&(!0===x?this.gl.enable(this.gl.STENCIL_TEST):this.gl.disable(this.gl.STENCIL_TEST),this._state.stencilTest=x,this._stateTracker.invalidateStencilTest())};
A.setClearStencil=function(x){x!==this._state.clearStencil&&(this.gl.clearStencil(x),this._state.clearStencil=x)};A.setStencilFunction=function(x,B,C){if(this._state.stencilFunction.func!==x||this._state.stencilFunction.ref!==B||this._state.stencilFunction.mask!==C)this.gl.stencilFunc(x,B,C),this._state.stencilFunction.face=h.Face.FRONT_AND_BACK,this._state.stencilFunction.func=x,this._state.stencilFunction.ref=B,this._state.stencilFunction.mask=C,this._stateTracker.invalidateStencilTest()};A.setStencilFunctionSeparate=
function(x,B,C,D){if(this._state.stencilFunction.face!==x||this._state.stencilFunction.func!==B||this._state.stencilFunction.ref!==C||this._state.stencilFunction.mask!==D)this.gl.stencilFuncSeparate(x,B,C,D),this._state.stencilFunction.face=x,this._state.stencilFunction.func=B,this._state.stencilFunction.ref=C,this._state.stencilFunction.mask=D,this._stateTracker.invalidateStencilTest()};A.setStencilWriteMask=function(x){this._state.stencilWriteMask!==x&&(this.gl.stencilMask(x),this._state.stencilWriteMask=
x,this._stateTracker.invalidateStencilWrite())};A.setStencilOp=function(x,B,C){if(this._state.stencilOperation.face!==h.Face.FRONT_AND_BACK||this._state.stencilOperation.fail!==x||this._state.stencilOperation.zFail!==B||this._state.stencilOperation.zPass!==C)this.gl.stencilOp(x,B,C),this._state.stencilOperation.face=h.Face.FRONT_AND_BACK,this._state.stencilOperation.fail=x,this._state.stencilOperation.zFail=B,this._state.stencilOperation.zPass=C,this._stateTracker.invalidateStencilTest()};A.setStencilOpSeparate=
function(x,B,C,D){if(this._state.stencilOperation.face!==x||this._state.stencilOperation.fail!==B||this._state.stencilOperation.zFail!==C||this._state.stencilOperation.zPass!==D)this.gl.stencilOpSeparate(x,B,C,D),this._state.stencilOperation.face=x,this._state.stencilOperation.fail=B,this._state.stencilOperation.zFail=C,this._state.stencilOperation.zPass=D,this._stateTracker.invalidateStencilTest()};A.setActiveTexture=function(x,B=!1){const C=this._state.activeTexture;0<=x&&(B||x!==this._state.activeTexture)&&
(this.gl.activeTexture(h.BASE_TEXTURE_UNIT+x),this._state.activeTexture=x);return C};A.clear=function(x){x&&this.gl.clear(x)};A.clearSafe=function(x,B=255){x&&(x&h.ClearBufferBit.COLOR_BUFFER_BIT&&this.setColorMask(!0,!0,!0,!0),x&h.ClearBufferBit.DEPTH_BUFFER_BIT&&this.setDepthWriteEnabled(!0),x&h.ClearBufferBit.STENCIL_BUFFER_BIT&&this.setStencilWriteMask(B),this.gl.clear(x))};A.drawArrays=function(x,B,C){u.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=f(x,C));this.gl.drawArrays(x,
B,C);u.webglDebugEnabled()&&(x=t.getErrorString(this))&&console.error("drawArrays:",x)};A.drawElements=function(x,B,C,D){u.webglDebugEnabled()&&(this._numOfDrawCalls++,this._numOfTriangles+=f(x,B));this.gl.drawElements(x,B,C,D);if(u.webglDebugEnabled()){const O=t.getErrorString(this);if(O){var E,F=this.getBoundVAO(),G=null==F?void 0:F.indexBuffer;F={indexBuffer:G,vertexBuffers:null==F?void 0:F.vertexBuffers};x={mode:x,count:B,type:C,offset:D};G=null!=(E=c.applySome(G,K=>K.size))?E:0;B=D+B;console.error(`drawElements: ${O}${G<
B?`. Buffer is too small. Attempted to draw index ${B} of ${G}`:""}`,{args:x,vao:F})}}};A.logInfo=function(){u.webglDebugEnabled()&&console.log(`DrawCalls: ${this._numOfDrawCalls}, Triangles: ${this._numOfTriangles}`)};A.resetInfo=function(){u.webglDebugEnabled()&&(this._numOfTriangles=this._numOfDrawCalls=0)};A.setViewport=function(x,B,C,D){C=Math.max(Math.round(C),1);D=Math.max(Math.round(D),1);const E=this._state.viewport;if(E.x!==x||E.y!==B||E.width!==C||E.height!==D)E.x=x,E.y=B,E.width=C,E.height=
D,this.gl.viewport(x,B,C,D)};A.getViewport=function(){return{x:this._state.viewport.x,y:this._state.viewport.y,width:this._state.viewport.width,height:this._state.viewport.height}};A.useProgram=function(x){var B,C;this._state.program!==x&&(null==(B=this._state.program)?void 0:B.stop(),this._state.program=x,this.gl.useProgram(null!=(C=null==x?void 0:x.glName)?C:null))};A.bindTexture=function(x,B,C=!1){(B>=this.parameters.maxTextureImageUnits||0>B)&&console.error("Input texture unit is out of range of available units!");
const D=this._state.textureUnitMap[B];if(c.isNone(x)||null==x.glName)return c.isSome(D)&&(this.setActiveTexture(B,C),this.gl.bindTexture(D.descriptor.target,null)),this._state.textureUnitMap[B]=null,D;if(!C&&D===x)return x.isDirty&&(this.setActiveTexture(B,C),x.applyChanges()),D;this.setActiveTexture(B,C);this.gl.bindTexture(x.descriptor.target,x.glName);x.applyChanges();this._state.textureUnitMap[B]=x;return D};A.unbindTexture=function(x){if(!c.isNone(x))for(let B=0;B<this.parameters.maxTextureImageUnits;B++)this._state.textureUnitMap[B]===
x&&(this.bindTexture(null,B),this._state.textureUnitMap[B]=null)};A.bindFramebuffer=function(x,B=!1){if(B||this._state.readFramebuffer!==x||this._state.drawFramebuffer!==x)c.isNone(x)?(this.gl.bindFramebuffer(h.FramebufferTarget.FRAMEBUFFER,null),this._state.readFramebuffer=null,this._state.drawFramebuffer=null):(x.initializeAndBind(h.FramebufferTarget.FRAMEBUFFER),this._state.readFramebuffer=x,this._state.drawFramebuffer=x)};A.bindFramebufferSeparate=function(x,B,C=!1){const D=B===h.FramebufferTarget.READ_FRAMEBUFFER,
E=D?this._state.readFramebuffer:this._state.drawFramebuffer;if(C||E!==x)c.isNone(x)?this.gl.bindFramebuffer(B,null):x.initializeAndBind(B),D?this._state.readFramebuffer=c.unwrapOr(x,null):this._state.drawFramebuffer=c.unwrapOr(x,null)};A.blitFramebuffer=function(x,B,C=0,D=0,E=x.width,F=x.height,G=0,O=0,K=B.width,L=B.height,R=h.ClearBufferBit.COLOR_BUFFER_BIT,M=h.TextureSamplingMode.NEAREST){this.bindFramebufferSeparate(x,h.FramebufferTarget.READ_FRAMEBUFFER);this.bindFramebufferSeparate(B,h.FramebufferTarget.DRAW_FRAMEBUFFER);
this.gl.blitFramebuffer(C,D,E,F,G,O,K,L,R,M)};A.bindBuffer=function(x,B){if(x){var C;null!=(C=B)?C:B=x.bufferType;switch(B){case h.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=y(this.gl,x,B,this._state.vertexBuffer);break;case h.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=y(this.gl,x,B,this._state.indexBuffer);break;case h.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=y(this.gl,x,B,this._state.uniformBuffer);break;case h.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=
y(this.gl,x,B,this._state.pixelPackBuffer);break;case h.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=y(this.gl,x,B,this._state.pixelUnpackBuffer);break;case h.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=y(this.gl,x,B,this._state.copyReadBuffer);break;case h.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=y(this.gl,x,B,this._state.copyWriteBuffer)}}};A.bindRenderbuffer=function(x){const B=this.gl;x||(B.bindRenderbuffer(B.RENDERBUFFER,null),this._state.renderbuffer=
null);this._state.renderbuffer!==x&&(B.bindRenderbuffer(B.RENDERBUFFER,x.glName),this._state.renderbuffer=x)};A._getBufferBinding=function(x,B){if(B>=this.parameters.maxUniformBufferBindings||0>B)return console.error("Uniform buffer binding point is out of range!"),null;x=this._state.uniformBufferBindingPoints;let C=x[B];c.isNone(C)&&(C={buffer:null,offset:0,size:0},x[B]=C);return C};A.bindBufferBase=function(x,B,C){const D=this._getBufferBinding(x,B);c.isNone(D)||D.buffer===C&&0===D.offset&&0===
D.size||(this.gl.bindBufferBase(x,B,C?C.glName:null),D.buffer=C,D.offset=0,D.size=0)};A.bindBufferRange=function(x,B,C,D,E){const F=this._getBufferBinding(x,B);c.isNone(F)||F.buffer===C&&F.offset===D&&F.size===E||(0!==D%this._parameters.uniformBufferOffsetAlignment?console.error("Uniform buffer binding offset is not a multiple of the context offset alignment"):(this.gl.bindBufferRange(x,B,C.glName,D,E),F.buffer=C,F.offset=D,F.size=E))};A.bindUBO=function(x,B,C,D){c.isNone(B)?this.bindBufferBase(h.BufferType.UNIFORM_BUFFER,
x,null):(u.webglDebugEnabled()&&(null!=D?D:B.byteLength)>this._parameters.maxUniformBlockSize&&console.error("Attempting to bind more data than the maximum uniform block size"),B.initialize(),void 0!==C&&void 0!==D?this.bindBufferRange(h.BufferType.UNIFORM_BUFFER,x,B.buffer,C,D):this.bindBufferBase(h.BufferType.UNIFORM_BUFFER,x,B.buffer))};A.unbindUBO=function(x){for(let B=0,C=this._state.uniformBufferBindingPoints.length;B<C;B++){const D=this._state.uniformBufferBindingPoints[B];c.isSome(D)&&D.buffer===
x.buffer&&this.bindBufferBase(h.BufferType.UNIFORM_BUFFER,B,null)}};A.unbindBuffer=function(x){switch(x){case h.BufferType.ARRAY_BUFFER:this._state.vertexBuffer=y(this.gl,null,x,this._state.vertexBuffer);break;case h.BufferType.ELEMENT_ARRAY_BUFFER:this._state.indexBuffer=y(this.gl,null,x,this._state.indexBuffer);break;case h.BufferType.UNIFORM_BUFFER:this._state.uniformBuffer=y(this.gl,null,x,this._state.uniformBuffer);break;case h.BufferType.PIXEL_PACK_BUFFER:this._state.pixelPackBuffer=y(this.gl,
null,x,this._state.pixelPackBuffer);break;case h.BufferType.PIXEL_UNPACK_BUFFER:this._state.pixelUnpackBuffer=y(this.gl,null,x,this._state.pixelUnpackBuffer);break;case h.BufferType.COPY_READ_BUFFER:this._state.copyReadBuffer=y(this.gl,null,x,this._state.copyReadBuffer);break;case h.BufferType.COPY_WRITE_BUFFER:this._state.copyWriteBuffer=y(this.gl,null,x,this._state.copyWriteBuffer)}};A.bindVAO=function(x=null){c.isNone(x)?this._state.vertexArrayObject&&(this._state.vertexArrayObject.unbind(),this._state.vertexArrayObject=
null):this._state.vertexArrayObject!==x&&(x.bind(),this._state.vertexArrayObject=x)};A.clientWaitAsync=function(){var x=b._asyncToGenerator(function*(B=l.Milliseconds(10)){const C=this.gl,D=C.fenceSync(h.SyncCondition.SYNC_GPU_COMMANDS_COMPLETE,0);this.instanceCounter.increment(h.ResourceType.Sync,D);C.flush();let E;do yield n.after(B),E=C.clientWaitSync(D,0,0);while(E===h.ClientWaitSyncStatus.TIMEOUT_EXPIRED);this.instanceCounter.decrement(h.ResourceType.Sync,D);C.deleteSync(D);if(E===h.ClientWaitSyncStatus.WAIT_FAILED)throw Error("Client wait failed");
});return function(){return x.apply(this,arguments)}}();A.getBoundFramebufferObject=function(x=h.FramebufferTarget.FRAMEBUFFER){return x===h.FramebufferTarget.READ_FRAMEBUFFER?this._state.readFramebuffer:this._state.drawFramebuffer};A.getBoundVAO=function(){return this._state.vertexArrayObject};A.resetState=function(){this.useProgram(null);this.bindVAO(null);this.bindFramebuffer(null,!0);this.unbindBuffer(h.BufferType.ARRAY_BUFFER);this.unbindBuffer(h.BufferType.ELEMENT_ARRAY_BUFFER);r(this.gl)&&
(this.unbindBuffer(h.BufferType.UNIFORM_BUFFER),this._state.uniformBufferBindingPoints.length=0,this.unbindBuffer(h.BufferType.PIXEL_PACK_BUFFER),this.unbindBuffer(h.BufferType.PIXEL_UNPACK_BUFFER),this.unbindBuffer(h.BufferType.COPY_READ_BUFFER),this.unbindBuffer(h.BufferType.COPY_WRITE_BUFFER));for(let x=0;x<this.parameters.maxTextureImageUnits;++x)this.bindTexture(null,x);this.setBlendingEnabled(!1);this.setBlendFunction(h.BlendFactor.ONE,h.BlendFactor.ZERO);this.setBlendEquation(h.BlendOperation.ADD);
this.setBlendColor(0,0,0,0);this.setFaceCullingEnabled(!1);this.setCullFace(h.Face.BACK);this.setFrontFace(h.CullMode.CCW);this.setPolygonOffsetFillEnabled(!1);this.setPolygonOffset(0,0);this.setScissorTestEnabled(!1);this.setScissorRect(0,0,this.gl.canvas.width,this.gl.canvas.height);this.setDepthTestEnabled(!1);this.setDepthFunction(h.CompareFunction.LESS);this.setDepthRange(0,1);this.setStencilTestEnabled(!1);this.setStencilFunction(h.CompareFunction.ALWAYS,0,0);this.setStencilOp(h.StencilOperation.KEEP,
h.StencilOperation.KEEP,h.StencilOperation.KEEP);this.setClearColor(0,0,0,0);this.setClearDepth(1);this.setClearStencil(0);this.setColorMask(!0,!0,!0,!0);this.setStencilWriteMask(4294967295);this.setDepthWriteEnabled(!0);this.setViewport(0,0,this.gl.canvas.width,this.gl.canvas.height)};A.enforceState=function(){var x,B;const C=this.gl;var D=this.capabilities.vao;D&&D.bindVertexArray(null);for(let K=0;K<this.parameters.maxVertexAttributes;K++)C.disableVertexAttribArray(K);this._state.vertexBuffer?
C.bindBuffer(this._state.vertexBuffer.bufferType,this._state.vertexBuffer.glName):C.bindBuffer(h.BufferType.ARRAY_BUFFER,null);this._state.indexBuffer?C.bindBuffer(this._state.indexBuffer.bufferType,this._state.indexBuffer.glName):C.bindBuffer(h.BufferType.ELEMENT_ARRAY_BUFFER,null);if(r(C)){var E,F;this._state.uniformBuffer?C.bindBuffer(this._state.uniformBuffer.bufferType,this._state.uniformBuffer.glName):C.bindBuffer(h.BufferType.UNIFORM_BUFFER,null);for(var G=0;G<this._parameters.maxUniformBufferBindings;G++){var O=
this._state.uniformBufferBindingPoints[G];if(c.isSome(O)){const {buffer:K,offset:L,size:R}=O;null!==K?0===L&&0===R?C.bindBufferBase(h.BufferType.UNIFORM_BUFFER,G,K.glName):C.bindBufferRange(h.BufferType.UNIFORM_BUFFER,G,K.glName,L,R):C.bindBufferBase(h.BufferType.UNIFORM_BUFFER,G,null)}}this._state.pixelPackBuffer?C.bindBuffer(this._state.pixelPackBuffer.bufferType,this._state.pixelPackBuffer.glName):C.bindBuffer(h.BufferType.PIXEL_PACK_BUFFER,null);this._state.pixelUnpackBuffer?C.bindBuffer(this._state.pixelUnpackBuffer.bufferType,
this._state.pixelUnpackBuffer.glName):C.bindBuffer(h.BufferType.PIXEL_UNPACK_BUFFER,null);this._state.copyReadBuffer?C.bindBuffer(this._state.copyReadBuffer.bufferType,this._state.copyReadBuffer.glName):C.bindBuffer(h.BufferType.COPY_READ_BUFFER,null);this._state.copyWriteBuffer?C.bindBuffer(this._state.copyWriteBuffer.bufferType,this._state.copyWriteBuffer.glName):C.bindBuffer(h.BufferType.COPY_WRITE_BUFFER,null);C.bindFramebuffer(h.FramebufferTarget.READ_FRAMEBUFFER,null);C.readBuffer(C.BACK);this._state.readFramebuffer&&
(C.bindFramebuffer(h.FramebufferTarget.READ_FRAMEBUFFER,this._state.readFramebuffer.glName),C.readBuffer(h.ColorAttachment.COLOR_ATTACHMENT0));C.bindFramebuffer(h.FramebufferTarget.DRAW_FRAMEBUFFER,null!=(E=null==(F=this._state.drawFramebuffer)?void 0:F.glName)?E:null)}else this._state.readFramebuffer=this._state.drawFramebuffer,C.bindFramebuffer(h.FramebufferTarget.FRAMEBUFFER,null!=(G=null==(O=this._state.drawFramebuffer)?void 0:O.glName)?G:null);if(D&&this._state.vertexArrayObject){if(D=this._state.vertexArrayObject)this._state.vertexArrayObject.unbind(),
this._state.vertexArrayObject=null;this.bindVAO(D)}C.useProgram(null!=(x=null==(B=this._state.program)?void 0:B.glName)?x:null);C.blendColor(this._state.blendColor.r,this._state.blendColor.g,this._state.blendColor.b,this._state.blendColor.a);C.bindRenderbuffer(C.RENDERBUFFER,this._state.renderbuffer?this._state.renderbuffer.glName:null);!0===this._state.blend?C.enable(this.gl.BLEND):C.disable(this.gl.BLEND);C.blendEquationSeparate(this._state.blendEquation.mode,this._state.blendEquation.modeAlpha);
C.blendFuncSeparate(this._state.blendFunction.srcRGB,this._state.blendFunction.dstRGB,this._state.blendFunction.srcAlpha,this._state.blendFunction.dstAlpha);C.clearColor(this._state.clearColor.r,this._state.clearColor.g,this._state.clearColor.b,this._state.clearColor.a);C.clearDepth(this._state.clearDepth);C.clearStencil(this._state.clearStencil);C.colorMask(this._state.colorMask.r,this._state.colorMask.g,this._state.colorMask.b,this._state.colorMask.a);C.cullFace(this._state.cullFace);C.depthFunc(this._state.depthFunction);
C.depthRange(this._state.depthRange.zNear,this._state.depthRange.zFar);!0===this._state.depthTest?C.enable(C.DEPTH_TEST):C.disable(C.DEPTH_TEST);C.depthMask(this._state.depthWrite);C.frontFace(this._state.frontFace);C.lineWidth(1);!0===this._state.faceCulling?C.enable(C.CULL_FACE):C.disable(C.CULL_FACE);C.polygonOffset(this._state.polygonOffset[0],this._state.polygonOffset[1]);!0===this._state.polygonOffsetFill?C.enable(C.POLYGON_OFFSET_FILL):C.disable(C.POLYGON_OFFSET_FILL);C.scissor(this._state.scissorRect.x,
this._state.scissorRect.y,this._state.scissorRect.width,this._state.scissorRect.height);!0===this._state.scissorTest?C.enable(C.SCISSOR_TEST):C.disable(C.SCISSOR_TEST);C.stencilFunc(this._state.stencilFunction.func,this._state.stencilFunction.ref,this._state.stencilFunction.mask);C.stencilOpSeparate(this._state.stencilOperation.face,this._state.stencilOperation.fail,this._state.stencilOperation.zFail,this._state.stencilOperation.zPass);!0===this._state.stencilTest?C.enable(C.STENCIL_TEST):C.disable(C.STENCIL_TEST);
C.stencilMask(this._state.stencilWriteMask);for(x=0;x<this.parameters.maxTextureImageUnits;x++)C.activeTexture(h.BASE_TEXTURE_UNIT+x),C.bindTexture(h.TextureType.TEXTURE_2D,null),C.bindTexture(h.TextureType.TEXTURE_CUBE_MAP,null),r(C)&&(C.bindTexture(h.TextureType.TEXTURE_3D,null),C.bindTexture(h.TextureType.TEXTURE_2D_ARRAY,null)),B=this._state.textureUnitMap[x],c.isSome(B)&&C.bindTexture(B.descriptor.target,B.glName);C.activeTexture(h.BASE_TEXTURE_UNIT+this._state.activeTexture);C.viewport(this._state.viewport.x,
this._state.viewport.y,this._state.viewport.width,this._state.viewport.height);this.resetInfo()};A._loadExtensions=function(){this.type===v.ContextType.WEBGL1&&this.gl.getExtension("OES_element_index_uint");this.gl.getExtension("KHR_parallel_shader_compile")};A._loadParameters=function(x){var B,C=this.capabilities.textureFilterAnisotropic;x=null!=(B=x.maxAnisotropy)?B:Infinity;B=r(this.gl);const D=this.gl;C={versionString:this.gl.getParameter(this.gl.VERSION),maxVertexTextureImageUnits:this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),
maxVertexAttributes:this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS),maxMaxAnisotropy:C?Math.min(this.gl.getParameter(C.MAX_TEXTURE_MAX_ANISOTROPY),x):1,maxTextureImageUnits:this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),maxTextureSize:this.gl.getParameter(this.gl.MAX_TEXTURE_SIZE),maxUniformBufferBindings:B?D.getParameter(D.MAX_UNIFORM_BUFFER_BINDINGS):0,maxVertexUniformBlocks:B?D.getParameter(D.MAX_VERTEX_UNIFORM_BLOCKS):0,maxFragmentUniformBlocks:B?D.getParameter(D.MAX_FRAGMENT_UNIFORM_BLOCKS):
0,maxUniformBlockSize:B?D.getParameter(D.MAX_UNIFORM_BLOCK_SIZE):0,uniformBufferOffsetAlignment:B?D.getParameter(D.UNIFORM_BUFFER_OFFSET_ALIGNMENT):1,maxArrayTextureLayers:B?D.getParameter(D.MAX_ARRAY_TEXTURE_LAYERS):1,maxSamples:B?D.getParameter(D.MAX_SAMPLES):1};p.Texture.TEXTURE_UNIT_FOR_UPDATES=C.maxTextureImageUnits-1;return C};b._createClass(z,[{key:"driverTest",get:function(){return this._driverTest}},{key:"contextAttributes",get:function(){return this.gl.getContextAttributes()}},{key:"parameters",
get:function(){return this._parameters}},{key:"capabilities",get:function(){return this._capabilities}}]);return z}();a.RenderingContext=w;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ContextState":function(){define(["exports","./enums"],function(a,b){a.ContextState=function(){this.blend=!1;this.blendColor={r:0,g:0,b:0,a:0};this.blendFunction={srcRGB:b.BlendFactor.ONE,dstRGB:b.BlendFactor.ZERO,srcAlpha:b.BlendFactor.ONE,dstAlpha:b.BlendFactor.ZERO};
this.blendEquation={mode:b.BlendOperation.ADD,modeAlpha:b.BlendOperation.ADD};this.colorMask={r:!0,g:!0,b:!0,a:!0};this.faceCulling=!1;this.cullFace=b.Face.BACK;this.frontFace=b.CullMode.CCW;this.scissorTest=!1;this.scissorRect={x:0,y:0,width:0,height:0};this.depthTest=!1;this.depthFunction=b.CompareFunction.LESS;this.clearDepth=1;this.depthWrite=!0;this.depthRange={zNear:0,zFar:1};this.viewport=null;this.polygonOffsetFill=this.stencilTest=!1;this.polygonOffset=[0,0];this.stencilFunction={face:b.Face.FRONT_AND_BACK,
func:b.CompareFunction.ALWAYS,ref:0,mask:1};this.clearStencil=0;this.stencilWriteMask=1;this.stencilOperation={face:b.Face.FRONT_AND_BACK,fail:b.StencilOperation.KEEP,zFail:b.StencilOperation.KEEP,zPass:b.StencilOperation.KEEP};this.clearColor={r:0,g:0,b:0,a:0};this.copyWriteBuffer=this.copyReadBuffer=this.pixelUnpackBuffer=this.pixelPackBuffer=this.uniformBuffer=this.indexBuffer=this.vertexBuffer=this.program=null;this.uniformBufferBindingPoints=[];this.renderbuffer=this.drawFramebuffer=this.readFramebuffer=
null;this.activeTexture=0;this.textureUnitMap=[]};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/InstanceCounter":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../support/AllocationTracer","./enums"],function(a,b,c,n){const l={RECORD_ALLOCATIONS:!1};let u=function(){function v(){this._current=[];this._max=[];for(this._allocations=new c.AllocationTracer(l.RECORD_ALLOCATIONS);this._current.length<n.ResourceType.COUNT;)this._current.push(0),
this._max.push(0)}var m=v.prototype;m.resetMax=function(){for(this._max.length=0;this._max.length<this._current.length;)this._max.push(0)};m.increment=function(h,d){const e=++this._current[h];this._max[h]=Math.max(e,this._max[h]);this._allocations.add(d)};m.decrement=function(h,d){--this._current[h];this._allocations.remove(d)};m.printResourceCount=function(){if(0<this.total){console.log("Live objects:");for(let h=0;h<n.ResourceType.COUNT;++h){const d=this._current[h];0<d&&console.log(`${n.ResourceType[h]}: ${d}`)}}this._allocations.print()};
b._createClass(v,[{key:"max",get:function(){return this._max}},{key:"current",get:function(){return this._current}},{key:"total",get:function(){return this.current.reduce((h,d)=>h+d,0)}}]);return v}();a.InstanceCounter=u;a.test=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/AllocationTracer":function(){define(["exports"],function(a){let b=function(){function c(l){this._allocations=new Map;l?Error.stackTraceLimit=Infinity:(this.add=
()=>{},this.remove=()=>{})}var n=c.prototype;n.add=function(l){this._allocations.set(l,Error().stack)};n.remove=function(l){this._allocations.delete(l)};n.print=function(){if(0<this._allocations.size){console.log(`${this._allocations.size} live object allocations:`);const l=new Map;this._allocations.forEach(u=>{var v;l.set(u,(null!=(v=l.get(u))?v:0)+1)});l.forEach((u,v)=>{v=v.split("\n");v.shift();v.shift();console.log(`${u}: ${v.shift()}`);v.forEach(m=>console.log("   ",m))})}};return c}();a.AllocationTracer=
b;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ProgramCache":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","../../core/NestedMap","./Program"],function(a,b,c,n,l){let u=function(){function v(h){this._rctx=h;this._store=new n.NestedMap}var m=v.prototype;m.dispose=function(){this._store.forEach(h=>h.forEach(d=>d.dispose()));this._store.clear()};m.acquire=function(h,d,e,g){const p=this._store.get(h,
d);if(c.isSome(p))return p.ref(),p;e=new l.Program(this._rctx,h,d,e,g);e.ref();this._store.set(h,d,e);return e};b._createClass(v,[{key:"test",get:function(){let h=0;this._store.forEach(d=>d.forEach(e=>h+=e.hasGLName?2:1));return{cachedWebGLObjects:h}}}]);return v}();a.ProgramCache=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/Program":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/arrayUtils ../../core/has ../../core/maybe ./checkWebGLError ./context-util ./enums ./ShaderTranspiler".split(" "),
function(a,b,c,n,l,u,v,m,h){function d(t,q,k){t=t.gl;const r=t.createShader(q);t.shaderSource(r,k);t.compileShader(r);u.webglValidateShadersEnabled()&&!t.getShaderParameter(r,t.COMPILE_STATUS)&&(console.error("Compile error in ".concat(q===m.ShaderType.VERTEX_SHADER?"vertex":"fragment"," shader")),console.error(t.getShaderInfoLog(r)),console.error(e(k)));p.enabled&&(p.compiledLOC+=k.match(/\n/g).length+1);return r}function e(t){let q=2;return t.replace(/\n/g,()=>{var k=q++;k=1E3<=k?k.toString():("  "+
k).slice(-3);return"\n"+k+":"})}function g(t,q,k){const r=t.get(q);return r?c.update(r,k):(t.set(q,Array.from(k)),!0)}n=function(){function t(k,r,y,f,w=new Map){this._context=k;this._locations=f;this._uniformBlockBindings=w;this._refCount=1;this._compiled=!1;this._nameToUniformLocation={};this._nameToUniform1={};this._nameToUniform1v=new Map;this._nameToUniform2=new Map;this._nameToUniform3=new Map;this._nameToUniform4=new Map;this._nameToUniformMatrix3=new Map;this._nameToUniformMatrix4=new Map;
k||console.error("RenderingContext isn't initialized!");0===r.length&&console.error("Shaders source should not be empty!");this._context.type===v.ContextType.WEBGL2&&(r=h.transpileShader(r,m.ShaderType.VERTEX_SHADER),y=h.transpileShader(y,m.ShaderType.FRAGMENT_SHADER));this._vShader=d(this._context,m.ShaderType.VERTEX_SHADER,r);this._fShader=d(this._context,m.ShaderType.FRAGMENT_SHADER,y);this._vShader&&this._fShader||console.error("Error loading shaders!");this._context.instanceCounter.increment(m.ResourceType.Shader,
this);u.webglValidateShadersEnabled()&&(this.vertexShader=r,this.fragmentShader=y)}var q=t.prototype;q.dispose=function(){if(!(0<--this._refCount)){var k=this._context.gl;this._vShader&&(k.deleteShader(this._vShader),this._vShader=null,this._context.instanceCounter.decrement(m.ResourceType.Shader,this));this._fShader&&(k.deleteShader(this._fShader),this._fShader=null);this._glName&&(k.deleteProgram(this._glName),this._glName=null,this._context.instanceCounter.decrement(m.ResourceType.Program,this))}};
q.ref=function(){++this._refCount};q._getUniformLocation=function(k){void 0===this._nameToUniformLocation[k]&&(++p.numUniforms,this._nameToUniformLocation[k]=this._context.gl.getUniformLocation(this.glName,k));return this._nameToUniformLocation[k]};q.hasUniform=function(k){return null!==this._getUniformLocation(k)};q.setUniform1i=function(k,r){const y=this._nameToUniform1[k];if(void 0===y||r!==y)this._context.gl.uniform1i(this._getUniformLocation(k),r),this._nameToUniform1[k]=r};q.setUniform1iv=function(k,
r){g(this._nameToUniform1v,k,r)&&this._context.gl.uniform1iv(this._getUniformLocation(k),r)};q.setUniform2iv=function(k,r){g(this._nameToUniform2,k,r)&&this._context.gl.uniform2iv(this._getUniformLocation(k),r)};q.setUniform3iv=function(k,r){g(this._nameToUniform3,k,r)&&this._context.gl.uniform3iv(this._getUniformLocation(k),r)};q.setUniform4iv=function(k,r){g(this._nameToUniform4,k,r)&&this._context.gl.uniform4iv(this._getUniformLocation(k),r)};q.setUniform1f=function(k,r){const y=this._nameToUniform1[k];
if(void 0===y||r!==y)this._context.gl.uniform1f(this._getUniformLocation(k),r),this._nameToUniform1[k]=r};q.setUniform1fv=function(k,r){g(this._nameToUniform1v,k,r)&&this._context.gl.uniform1fv(this._getUniformLocation(k),r)};q.setUniform2f=function(k,r,y){const f=this._nameToUniform2.get(k);if(void 0===f)this._context.gl.uniform2f(this._getUniformLocation(k),r,y),this._nameToUniform2.set(k,[r,y]);else if(r!==f[0]||y!==f[1])this._context.gl.uniform2f(this._getUniformLocation(k),r,y),f[0]=r,f[1]=y};
q.setUniform2fv=function(k,r){g(this._nameToUniform2,k,r)&&this._context.gl.uniform2fv(this._getUniformLocation(k),r)};q.setUniform3f=function(k,r,y,f){const w=this._nameToUniform3.get(k);if(void 0===w)this._context.gl.uniform3f(this._getUniformLocation(k),r,y,f),this._nameToUniform3[k]=[r,y,f];else if(r!==w[0]||y!==w[1]||f!==w[2])this._context.gl.uniform3f(this._getUniformLocation(k),r,y,f),w[0]=r,w[1]=y,w[2]=f};q.setUniform3fv=function(k,r){g(this._nameToUniform3,k,r)&&this._context.gl.uniform3fv(this._getUniformLocation(k),
r)};q.setUniform4f=function(k,r,y,f,w){const z=this._nameToUniform4.get(k);if(void 0===z)this._context.gl.uniform4f(this._getUniformLocation(k),r,y,f,w),this._nameToUniform4.set(k,[r,y,f,w]);else if(void 0===z||r!==z[0]||y!==z[1]||f!==z[2]||w!==z[3])this._context.gl.uniform4f(this._getUniformLocation(k),r,y,f,w),z[0]=r,z[1]=y,z[2]=f,z[3]=w};q.setUniform4fv=function(k,r){g(this._nameToUniform4,k,r)&&this._context.gl.uniform4fv(this._getUniformLocation(k),r)};q.setUniformMatrix3fv=function(k,r,y=!1){g(this._nameToUniformMatrix3,
k,r)&&this._context.gl.uniformMatrix3fv(this._getUniformLocation(k),y,r)};q.setUniformMatrix4fv=function(k,r,y=!1){g(this._nameToUniformMatrix4,k,r)&&this._context.gl.uniformMatrix4fv(this._getUniformLocation(k),y,r)};q.stop=function(){};b._createClass(t,[{key:"glName",get:function(){if(l.isSome(this._glName))return this._glName;if(l.isNone(this._vShader))return null;const k=this._context.gl,r=k.createProgram();k.attachShader(r,this._vShader);k.attachShader(r,this._fShader);this._locations.forEach((y,
f)=>k.bindAttribLocation(r,y,f));k.linkProgram(r);u.webglValidateShadersEnabled()&&!k.getProgramParameter(r,k.LINK_STATUS)&&console.error("Could not link shader\n"+`validated: ${k.getProgramParameter(r,k.VALIDATE_STATUS)}`+`, gl error ${k.getError()}`+`, vertex: ${k.getShaderParameter(this._vShader,k.COMPILE_STATUS)}`+`, fragment: ${k.getShaderParameter(this._fShader,k.COMPILE_STATUS)}`+`, info log: ${k.getProgramInfoLog(r)}`+`, vertex source: ${this.vertexShader}`+`, fragment source: ${this.fragmentShader}`);
if(this._context.type===v.ContextType.WEBGL2)for(const [y,f]of this._uniformBlockBindings){const w=k.getUniformBlockIndex(r,y);4294967295>w&&k.uniformBlockBinding(r,w,f)}this._glName=r;this._context.instanceCounter.increment(m.ResourceType.Program,this);return r}},{key:"hasGLName",get:function(){return l.isSome(this._glName)}},{key:"isCompiled",get:function(){if(this._compiled)return!0;const k=this._context.gl.getExtension("KHR_parallel_shader_compile");return null==k?this._compiled=!0:this._compiled=
!!this._context.gl.getProgramParameter(this.glName,k.COMPLETION_STATUS_KHR)}}]);return t}();const p={compiledLOC:0,numUniforms:0,enabled:!1};a.Program=n;a.test=p;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/ShaderTranspiler":function(){define("exports ../../core/has ../../core/maybe ./enums ./reservedWordsGLSL3 ./testUtils".split(" "),function(a,b,c,n,l,u){function v(){function w(T){T.length&&R.push({type:r[G],data:T,position:I,line:M,
column:J})}function z(){L=L.length?[]:L;if("/"===K&&"*"===O)return I=F+E-1,G=0,K=O,E+1;if("/"===K&&"/"===O)return I=F+E-1,G=1,K=O,E+1;if("#"===O)return G=2,I=F+E,E;if(/\s/.test(O))return G=9,I=F+E,E;P=/\d/.test(O);N=/[^\w_]/.test(O);I=F+E;G=P?4:N?3:9999;return E}function A(){if(("\r"===O||"\n"===O)&&"\\"!==K)return w(L.join("")),G=999,E;L.push(O);K=O;return E+1}function x(){if("."===K&&/\d/.test(O))return G=5,E;if("/"===K&&"*"===O)return G=0,E;if("/"===K&&"/"===O)return G=1,E;if("."===O&&L.length){for(;B(L););
G=5;return E}if(";"===O||")"===O||"("===O){if(L.length)for(;B(L););w(O);G=999;return E+1}var T=2===L.length&&"\x3d"!==O;if(/[\w_\d\s]/.test(O)||T){for(;B(L););G=999;return E}L.push(O);K=O;return E+1}function B(T){var H=0;do{var U=q.indexOf(T.slice(0,T.length+H).join(""));var W=q[U];if(-1===U){if(0<H--+T.length)continue;W=T.slice(0,1).join("")}w(W);I+=W.length;L=L.slice(W.length);return L.length}while(1)}function C(){if("."===O||/[eE]/.test(O))return L.push(O),G=5,K=O,E+1;if("x"===O&&1===L.length&&
"0"===L[0])return G=11,L.push(O),K=O,E+1;if(/[^\d]/.test(O))return w(L.join("")),G=999,E;L.push(O);K=O;return E+1}function D(){"f"===O&&(L.push(O),K=O,E+=1);if(/[eE]/.test(O)||"-"===O&&/[eE]/.test(K))return L.push(O),K=O,E+1;if(/[^\d]/.test(O))return w(L.join("")),G=999,E;L.push(O);K=O;return E+1}var E=0,F=0,G=999,O,K,L=[],R=[],M=1,J=0,I=0,P=!1,N=!1,V="",S;return function(T){R=[];if(null!==T){T=T.replace?T.replace(/\r\n/g,"\n"):T;E=0;V+=T;for(S=V.length;O=V[E],E<S;){T=E;switch(G){case 0:"/"===O&&
"*"===K?(L.push(O),w(L.join("")),G=999):(L.push(O),K=O);E+=1;break;case 1:E=A();break;case 2:E=A();break;case 3:E=x();break;case 4:E=C();break;case 11:/[^a-fA-F0-9]/.test(O)?(w(L.join("")),G=999):(L.push(O),K=O,E+=1);break;case 5:E=D();break;case 9999:if(/[^\d\w_]/.test(O)){var H=L.join("");G=-1<t.indexOf(H)?8:-1<k.indexOf(H)?7:6;w(L.join(""));G=999}else L.push(O),K=O,E+=1;break;case 9:/[^\s]/g.test(O)?(w(L.join("")),G=999):(L.push(O),K=O,E+=1);break;case 999:E=z()}if(T!==E)switch(V[T]){case "\n":J=
0;++M;break;default:++J}}F+=E;V=V.slice(E);return R}L.length&&w(L.join(""));G=10;w("(eof)");return R}}function m(w){return w.map(z=>"eof"!==z.type?z.data:"").join("")}function h(w,z="100",A="300 es"){const x=/^\s*#version\s+([0-9]+(\s+[a-zA-Z]+)?)\s*/;for(const B of w)if("preprocessor"===B.type){const C=x.exec(B.data);if(C){w=C[1].replace(/\s\s+/g," ");if(w===A)return w;if(w===z)return B.data="#version "+A,z;throw Error("unknown glsl version: "+w);}}w.splice(0,0,{type:"preprocessor",data:"#version "+
A},{type:"whitespace",data:"\n"});return null}function d(w,z,A,x){x=x||A;for(const B of w)if("ident"===B.type&&B.data===A)return x in z?z[x]++:z[x]=0,d(w,z,x+"_"+z[x],x);return A}function e(w,z,A="afterVersion"){const x={data:"\n",type:"whitespace"},B=D=>D<w.length?/[^\r\n]$/.test(w[D].data):!1;let C=function(D){let E=-1,F=0,G=-1;for(let K=0;K<D.length;K++){var O=D[K];"preprocessor"===O.type&&(O.data.match(/#(if|ifdef|ifndef)\s+.+/)?++F:O.data.match(/#endif\s*.*/)&&--F);("afterVersion"===A||"afterPrecision"===
A)&&"preprocessor"===O.type&&/^#version/.test(O.data)&&(G=Math.max(G,K));if("afterPrecision"===A&&"keyword"===O.type&&"precision"===O.data){a:{for(O=K;O<D.length;O++){const L=D[O];if("operator"===L.type&&";"===L.data)break a}O=null}if(null===O)throw Error("precision statement not followed by any semicolons!");G=Math.max(G,O)}E<G&&0===F&&(E=K)}return E+1}(w);B(C-1)&&w.splice(C++,0,x);for(const D of z)w.splice(C++,0,D);B(C-1)&&B(C)&&w.splice(C,0,x)}function g(w,z,A,x="lowp"){e(w,[{type:"keyword",data:"out"},
{type:"whitespace",data:" "},{type:"keyword",data:x},{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"ident",data:z},{type:"operator",data:";"}],"afterPrecision")}function p(w,z,A,x,B="lowp"){e(w,[{type:"keyword",data:"layout"},{type:"operator",data:"("},{type:"keyword",data:"location"},{type:"whitespace",data:" "},{type:"operator",data:"\x3d"},{type:"whitespace",data:" "},{type:"integer",data:x.toString()},{type:"operator",data:")"},{type:"whitespace",data:" "},
{type:"keyword",data:"out"},{type:"whitespace",data:" "},{type:"keyword",data:B},{type:"whitespace",data:" "},{type:"keyword",data:A},{type:"whitespace",data:" "},{type:"ident",data:z},{type:"operator",data:";"}],"afterPrecision")}b={exports:{}};(function(w){(function(z){z=z();void 0!==z&&(w.exports=z)})(function(){return"precision highp mediump lowp attribute const uniform varying break continue do for while if else in out inout float int void bool true false discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler1D sampler2D sampler3D samplerCube sampler1DShadow sampler2DShadow struct asm class union enum typedef template this packed goto switch default inline noinline volatile public static extern external interface long short double half fixed unsigned input output hvec2 hvec3 hvec4 dvec2 dvec3 dvec4 fvec2 fvec3 fvec4 sampler2DRect sampler3DRect sampler2DRectShadow sizeof cast namespace using".split(" ")})})(b);
const t=b.exports;b={exports:{}};(function(w){(function(z){z=z();void 0!==z&&(w.exports=z)})(function(){"use strict;";return"\x3c\x3c\x3d \x3e\x3e\x3d ++ -- \x3c\x3c \x3e\x3e \x3c\x3d \x3e\x3d \x3d\x3d !\x3d \x26\x26 || +\x3d -\x3d *\x3d /\x3d %\x3d \x26\x3d ^^ ^\x3d |\x3d ( ) [ ] . ! ~ * / % + - \x3c \x3e \x26 ^ | ? : \x3d , ; { }".split(" ")})})(b);const q=b.exports;b={exports:{}};(function(w){(function(z){z=z();void 0!==z&&(w.exports=z)})(function(){return"abs acos all any asin atan ceil clamp cos cross dFdx dFdy degrees distance dot equal exp exp2 faceforward floor fract gl_BackColor gl_BackLightModelProduct gl_BackLightProduct gl_BackMaterial gl_BackSecondaryColor gl_ClipPlane gl_ClipVertex gl_Color gl_DepthRange gl_DepthRangeParameters gl_EyePlaneQ gl_EyePlaneR gl_EyePlaneS gl_EyePlaneT gl_Fog gl_FogCoord gl_FogFragCoord gl_FogParameters gl_FragColor gl_FragCoord gl_FragData gl_FragDepth gl_FragDepthEXT gl_FrontColor gl_FrontFacing gl_FrontLightModelProduct gl_FrontLightProduct gl_FrontMaterial gl_FrontSecondaryColor gl_LightModel gl_LightModelParameters gl_LightModelProducts gl_LightProducts gl_LightSource gl_LightSourceParameters gl_MaterialParameters gl_MaxClipPlanes gl_MaxCombinedTextureImageUnits gl_MaxDrawBuffers gl_MaxFragmentUniformComponents gl_MaxLights gl_MaxTextureCoords gl_MaxTextureImageUnits gl_MaxTextureUnits gl_MaxVaryingFloats gl_MaxVertexAttribs gl_MaxVertexTextureImageUnits gl_MaxVertexUniformComponents gl_ModelViewMatrix gl_ModelViewMatrixInverse gl_ModelViewMatrixInverseTranspose gl_ModelViewMatrixTranspose gl_ModelViewProjectionMatrix gl_ModelViewProjectionMatrixInverse gl_ModelViewProjectionMatrixInverseTranspose gl_ModelViewProjectionMatrixTranspose gl_MultiTexCoord0 gl_MultiTexCoord1 gl_MultiTexCoord2 gl_MultiTexCoord3 gl_MultiTexCoord4 gl_MultiTexCoord5 gl_MultiTexCoord6 gl_MultiTexCoord7 gl_Normal gl_NormalMatrix gl_NormalScale gl_ObjectPlaneQ gl_ObjectPlaneR gl_ObjectPlaneS gl_ObjectPlaneT gl_Point gl_PointCoord gl_PointParameters gl_PointSize gl_Position gl_ProjectionMatrix gl_ProjectionMatrixInverse gl_ProjectionMatrixInverseTranspose gl_ProjectionMatrixTranspose gl_SecondaryColor gl_TexCoord gl_TextureEnvColor gl_TextureMatrix gl_TextureMatrixInverse gl_TextureMatrixInverseTranspose gl_TextureMatrixTranspose gl_Vertex greaterThan greaterThanEqual inversesqrt length lessThan lessThanEqual log log2 matrixCompMult max min mix mod normalize not notEqual pow radians reflect refract sign sin smoothstep sqrt step tan texture2D texture2DLod texture2DProj texture2DProjLod textureCube textureCubeLod texture2DLodEXT texture2DProjLodEXT textureCubeLodEXT texture2DGradEXT texture2DProjGradEXT textureCubeGradEXT".split(" ")})})(b);
const k=b.exports;var r="block-comment line-comment preprocessor operator integer float ident builtin keyword whitespace eof integer".split(" ");const y=["GL_OES_standard_derivatives","GL_EXT_frag_depth","GL_EXT_draw_buffers","GL_EXT_shader_texture_lod"],f=new Map;a.transpileShader=function(w,z){var A=u.shaderTranspiler.enableCache?f.get(w):null;if(c.isSome(A))return A;A=v();var x=[];x=x.concat(A(w));A=x=x.concat(A(null));if("300 es"===h(A,"100","300 es"))return w;var B=x=null;const C={},D={};for(let O=
0;O<A.length;++O){const K=A[O];switch(K.type){case "keyword":z===n.ShaderType.VERTEX_SHADER&&"attribute"===K.data?K.data="in":"varying"===K.data&&(K.data=z===n.ShaderType.VERTEX_SHADER?"out":"in");break;case "builtin":/^texture(2D|Cube)(Proj)?(Lod|Grad)?(EXT)?$/.test(K.data.trim())&&(K.data=K.data.replace(/(2D|Cube|EXT)/g,""));z===n.ShaderType.FRAGMENT_SHADER&&"gl_FragColor"===K.data&&(x||(x=d(A,C,"fragColor"),g(A,x,"vec4")),K.data=x);if(z===n.ShaderType.FRAGMENT_SHADER&&"gl_FragData"===K.data){{var E=
void 0;let L=void 0;var F=A;var G=O+1;let R=-1;for(;G<F.length;G++){const M=F[G];if("operator"===M.type&&("["===M.data&&(L=G),"]"===M.data)){E=G;break}"integer"===M.type&&(R=parseInt(M.data,10))}L&&E&&F.splice(L,E-L+1);F=R}E=d(A,C,"fragData");p(A,E,"vec4",F,"mediump");K.data=E}else z===n.ShaderType.FRAGMENT_SHADER&&"gl_FragDepthEXT"===K.data&&(B||(B=d(A,C,"gl_FragDepth")),K.data=B);break;case "ident":if(l.includes(K.data)){if(F=z===n.ShaderType.VERTEX_SHADER)a:{for(F=O-1;0<=F;F--)if(E=A[F],"whitespace"!==
E.type&&"block-comment"!==E.type)if("keyword"===E.type){if("attribute"===E.data||"in"===E.data){F=!0;break a}}else break;F=!1}if(F)throw Error("attribute in vertex shader uses a name that is a reserved word in glsl 300 es");K.data in D||(D[K.data]=d(A,C,K.data));K.data=D[K.data]}}}for(z=A.length-1;0<=z;--z)x=A[z],"preprocessor"===x.type&&((B=x.data.match(/#extension\s+(.*):/))&&B[1]&&y.includes(B[1].trim())&&(B=A[z+1],A.splice(z,B&&"whitespace"===B.type?2:1)),(B=x.data.match(/#ifdef\s+(.*)/))&&B[1]&&
y.includes(B[1].trim())&&(x.data="#if 1"),(B=x.data.match(/#ifndef\s+(.*)/))&&B[1]&&y.includes(B[1].trim())&&(x.data="#if 0"));A=m(A);u.shaderTranspiler.enableCache&&f.set(w,A);return A};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/reservedWordsGLSL3":function(){define(function(){return"layout centroid smooth case mat2x2 mat2x3 mat2x4 mat3x2 mat3x3 mat3x4 mat4x2 mat4x3 mat4x4 uint uvec2 uvec3 uvec4 samplerCubeShadow sampler2DArray sampler2DArrayShadow isampler2D isampler3D isamplerCube isampler2DArray usampler2D usampler3D usamplerCube usampler2DArray coherent restrict readonly writeonly resource atomic_uint noperspective patch sample subroutine common partition active filter image1D image2D image3D imageCube iimage1D iimage2D iimage3D iimageCube uimage1D uimage2D uimage3D uimageCube image1DArray image2DArray iimage1DArray iimage2DArray uimage1DArray uimage2DArray image1DShadow image2DShadow image1DArrayShadow image2DArrayShadow imageBuffer iimageBuffer uimageBuffer sampler1DArray sampler1DArrayShadow isampler1D isampler1DArray usampler1D usampler1DArray isampler2DRect usampler2DRect samplerBuffer isamplerBuffer usamplerBuffer sampler2DMS isampler2DMS usampler2DMS sampler2DMSArray isampler2DMSArray usampler2DMSArray trunc round roundEven isnan isinf floatBitsToInt floatBitsToUint intBitsToFloat uintBitsToFloat packSnorm2x16 unpackSnorm2x16 packUnorm2x16 unpackUnorm2x16 packHalf2x16 unpackHalf2x16 outerProduct transpose determinant inverse texture textureSize textureProj textureLod textureOffset texelFetch texelFetchOffset textureProjOffset textureLodOffset textureProjLod textureProjLodOffset textureGrad textureGradOffset textureProjGrad textureProjGradOffset".split(" ")})},
"esri/views/webgl/testUtils":function(){define(["exports"],function(a){a.shaderTranspiler={enableCache:!1};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/WebGLDriverTest":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../../core/maybe ./testDoublePrecisionArithmetic ./testFloatBufferBlend ./testSamplerPrecision ./testSVGPremultipliedAlpha".split(" "),function(a,b,c,n,l,u,v){let m=function(){function h(d){this.context=
d;this._floatBufferBlendWorking=l.testFloatBufferBlend(d);v.testSVGPremultipliedAlpha(d).then(e=>this._svgAlwaysPremultipliesAlpha=!e)}b._createClass(h,[{key:"floatBufferBlendWorking",get:function(){if(c.isNone(this._floatBufferBlendWorking))throw Error("floatBufferBlendWorking test not yet available");return this._floatBufferBlendWorking}},{key:"svgAlwaysPremultipliesAlpha",get:function(){if(c.isNone(this._svgAlwaysPremultipliesAlpha))throw Error("svgAlwaysPremultipliesAlpha test not yet available");
return this._svgAlwaysPremultipliesAlpha}},{key:"doublePrecisionRequiresObfuscation",get:function(){if(c.isNone(this._doublePrecisionRequiresObfuscation)){const d=n.testDoublePrecisionArithmetic(this.context,!1),e=n.testDoublePrecisionArithmetic(this.context,!0);this._doublePrecisionRequiresObfuscation=0!==d&&(0===e||5<d/e)}return this._doublePrecisionRequiresObfuscation}},{key:"ignoresSamplerPrecision",get:function(){c.isNone(this._ignoresSamplerPrecision)&&(this._ignoresSamplerPrecision=u.testSamplerPrecision(this.context));
return this._ignoresSamplerPrecision}}]);return h}();a.WebGLDriverTest=m;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testDoublePrecisionArithmetic":function(){define("exports ../../core/floatRGBA ../../chunks/vec3f64 ./BufferObject ./doublePrecisionUtils ./enums ./FramebufferObject ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,n,l,u,v,m,h){a.testDoublePrecisionArithmetic=function(d,e){var g=new v.FramebufferObject(d,
{colorTarget:u.TargetType.TEXTURE,depthStencilTarget:u.DepthStencilTargetType.NONE},{target:u.TextureType.TEXTURE_2D,wrapMode:u.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:u.PixelFormat.RGBA,dataType:u.PixelType.UNSIGNED_BYTE,samplingMode:u.TextureSamplingMode.NEAREST,width:1,height:1});const p=n.BufferObject.createVertex(d,u.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),t=new m.VertexArrayObject(d,new Map([["position",0]]),{geometry:[new h.VertexElementDescriptor("position",2,u.DataType.UNSIGNED_SHORT,
0,4)]},{geometry:p}),q=c.fromValues(5633261.287538229,2626832.878767164,1434988.0495278358),k=c.fromValues(5633271.46742708,2626873.6381334523,1434963.231608387);e=d.programCache.acquire(`\n\n  precision highp float;\n\n  attribute vec2 position;\n\n  uniform vec3 u_highA;\n  uniform vec3 u_lowA;\n  uniform vec3 u_highB;\n  uniform vec3 u_lowB;\n\n  varying vec4 v_color;\n\n  ${e?"#define DOUBLE_PRECISION_REQUIRES_OBFUSCATION":""}\n\n  #ifdef DOUBLE_PRECISION_REQUIRES_OBFUSCATION\n\n  vec3 dpPlusFrc(vec3 a, vec3 b) {\n    return mix(a, a + b, vec3(notEqual(b, vec3(0))));\n  }\n\n  vec3 dpMinusFrc(vec3 a, vec3 b) {\n    return mix(vec3(0), a - b, vec3(notEqual(a, b)));\n  }\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = dpPlusFrc(hiA, hiB);\n    vec3 e = dpMinusFrc(t1, hiA);\n    vec3 t2 = dpMinusFrc(hiB, e) + dpMinusFrc(hiA, dpMinusFrc(t1, e)) + loA + loB;\n    return t1 + t2;\n  }\n\n  #else\n\n  vec3 dpAdd(vec3 hiA, vec3 loA, vec3 hiB, vec3 loB) {\n    vec3 t1 = hiA + hiB;\n    vec3 e = t1 - hiA;\n    vec3 t2 = ((hiB - e) + (hiA - (t1 - e))) + loA + loB;\n    return t1 + t2;\n  }\n\n  #endif\n\n  const float MAX_RGBA_FLOAT =\n    255.0 / 256.0 +\n    255.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 +\n    255.0 / 256.0 / 256.0 / 256.0 / 256.0;\n\n  const vec4 FIXED_POINT_FACTORS = vec4(1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0);\n\n  vec4 float2rgba(const float value) {\n    // Make sure value is in the domain we can represent\n    float valueInValidDomain = clamp(value, 0.0, MAX_RGBA_FLOAT);\n\n    // Decompose value in 32bit fixed point parts represented as\n    // uint8 rgba components. Decomposition uses the fractional part after multiplying\n    // by a power of 256 (this removes the bits that are represented in the previous\n    // component) and then converts the fractional part to 8bits.\n    vec4 fixedPointU8 = floor(fract(valueInValidDomain * FIXED_POINT_FACTORS) * 256.0);\n\n    // Convert uint8 values (from 0 to 255) to floating point representation for\n    // the shader\n    const float toU8AsFloat = 1.0 / 255.0;\n\n    return fixedPointU8 * toU8AsFloat;\n  }\n\n  void main() {\n    vec3 val = dpAdd(u_highA, u_lowA, -u_highB, -u_lowB);\n\n    v_color = float2rgba(val.z / 25.0);\n\n    gl_Position = vec4(position * 2.0 - 1.0, 0.0, 1.0);\n  }\n  `,
"\n  precision highp float;\n\n  varying vec4 v_color;\n\n  void main() {\n    gl_FragColor \x3d v_color;\n  }\n  ",new Map([["position",0]]));var r=new Float32Array(6);l.encodeDoubleArray(q,r,3);var y=new Float32Array(6);l.encodeDoubleArray(k,y,3);d.useProgram(e);e.setUniform3f("u_highA",r[0],r[2],r[4]);e.setUniform3f("u_lowA",r[1],r[3],r[5]);e.setUniform3f("u_highB",y[0],y[2],y[4]);e.setUniform3f("u_lowB",y[1],y[3],y[5]);r=e;y=d.getBoundFramebufferObject();const {x:f,y:w,width:z,height:A}=d.getViewport();
d.bindFramebuffer(g);d.setViewport(0,0,1,1);d.bindVAO(t);d.drawArrays(u.PrimitiveType.TRIANGLE_STRIP,0,4);e=new Uint8Array(4);g.readPixels(0,0,1,1,u.PixelFormat.RGBA,u.PixelType.UNSIGNED_BYTE,e);r.dispose();t.dispose(!1);p.dispose();g.dispose();d.setViewport(f,w,z,A);d.bindFramebuffer(y);d=(q[2]-k[2])/25;g=b.unpackFloatRGBA(e);return Math.abs(d-g)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testFloatBufferBlend":function(){define("exports ../3d/webgl-engine/lib/OrderIndependentTransparency ./BufferObject ./context-util ./enums ./FramebufferObject ./renderState ./VertexArrayObject ./VertexElementDescriptor".split(" "),
function(a,b,c,n,l,u,v,m,h){var d={exports:{}};(function(e){(function(g){g=g();void 0!==g&&(e.exports=g)})(function(){function g(A){if(null==w){w={};z={};for(var x in A)"number"==typeof A[x]&&(w[A[x]]=x,z[x]=A[x])}}function p(){if(null==w)throw"WebGLDebugUtils.init(ctx) not called";}function t(A){p();var x=w[A];return void 0!==x?"gl."+x:"/*UNKNOWN WebGL ENUM*/ 0x"+A.toString(16)}function q(A,x,B,C){A=f[A];if(void 0!==A&&(A=A[x],void 0!==A&&A[B])){if("object"===typeof A[B]&&void 0!==A[B].enumBitwiseOr){x=
A[B].enumBitwiseOr;B=0;A=[];for(var D=0;D<x.length;++D){var E=z[x[D]];0!==(C&E)&&(B|=E,A.push(t(E)))}return B===C?A.join(" | "):t(C)}return t(C)}return null===C?"null":void 0===C?"undefined":C.toString()}function k(A,x,B){A.__defineGetter__(B,function(){return x[B]});A.__defineSetter__(B,function(C){x[B]=C})}function r(A,x,B,C){function D(K,L){return function(){B&&B(L,arguments);var R=K[L].apply(K,arguments),M=C.getError();0!=M&&(E[M]=!0,x(M,L,arguments));return R}}C=C||A;g(A);x=x||function(K,L,R){for(var M=
"",J=R.length,I=0;I<J;++I)M+=(0==I?"":", ")+q(L,J,I,R[I]);K="WebGL error "+t(K)+" in "+L+"("+M+")";window.console&&window.console.error?window.console.error(K):window.console&&window.console.log&&window.console.log(K)};var E={},F={},G;for(G in A)if("function"==typeof A[G])if("getExtension"!=G)F[G]=D(A,G);else{var O=D(A,G);F[G]=function(){var K=O.apply(A,arguments);return r(K,x,B,C)}}else k(F,A,G);F.getError=function(){for(var K in E)if(E.hasOwnProperty(K)&&E[K])return E[K]=!1,K;return A.NO_ERROR};
return F}function y(A){var x=A.getParameter(A.MAX_VERTEX_ATTRIBS),B=A.createBuffer();A.bindBuffer(A.ARRAY_BUFFER,B);for(var C=0;C<x;++C)A.disableVertexAttribArray(C),A.vertexAttribPointer(C,4,A.FLOAT,!1,0,0),A.vertexAttrib1f(C,0);A.deleteBuffer(B);x=A.getParameter(A.MAX_TEXTURE_IMAGE_UNITS);for(C=0;C<x;++C)A.activeTexture(A.TEXTURE0+C),A.bindTexture(A.TEXTURE_CUBE_MAP,null),A.bindTexture(A.TEXTURE_2D,null);A.activeTexture(A.TEXTURE0);A.useProgram(null);A.bindBuffer(A.ARRAY_BUFFER,null);A.bindBuffer(A.ELEMENT_ARRAY_BUFFER,
null);A.bindFramebuffer(A.FRAMEBUFFER,null);A.bindRenderbuffer(A.RENDERBUFFER,null);A.disable(A.BLEND);A.disable(A.CULL_FACE);A.disable(A.DEPTH_TEST);A.disable(A.DITHER);A.disable(A.SCISSOR_TEST);A.blendColor(0,0,0,0);A.blendEquation(A.FUNC_ADD);A.blendFunc(A.ONE,A.ZERO);A.clearColor(0,0,0,0);A.clearDepth(1);A.clearStencil(-1);A.colorMask(!0,!0,!0,!0);A.cullFace(A.BACK);A.depthFunc(A.LESS);A.depthMask(!0);A.depthRange(0,1);A.frontFace(A.CCW);A.hint(A.GENERATE_MIPMAP_HINT,A.DONT_CARE);A.lineWidth(1);
A.pixelStorei(A.PACK_ALIGNMENT,4);A.pixelStorei(A.UNPACK_ALIGNMENT,4);A.pixelStorei(A.UNPACK_FLIP_Y_WEBGL,!1);A.pixelStorei(A.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1);A.UNPACK_COLORSPACE_CONVERSION_WEBGL&&A.pixelStorei(A.UNPACK_COLORSPACE_CONVERSION_WEBGL,A.BROWSER_DEFAULT_WEBGL);A.polygonOffset(0,0);A.sampleCoverage(1,!1);A.scissor(0,0,A.canvas.width,A.canvas.height);A.stencilFunc(A.ALWAYS,0,4294967295);A.stencilMask(4294967295);A.stencilOp(A.KEEP,A.KEEP,A.KEEP);A.viewport(0,0,A.canvas.width,A.canvas.height);
for(A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT|A.STENCIL_BUFFER_BIT);A.getError(););}var f={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},
texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},
bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,
1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},w=null,z=null;return{init:g,mightBeEnum:function(A){p();return void 0!==w[A]},glEnumToString:t,glFunctionArgToString:q,glFunctionArgsToString:function(A,x){for(var B="",C=x.length,
D=0;D<C;++D)B+=(0==D?"":", ")+q(A,C,D,x[D]);return B},makeDebugContext:r,makeLostContextSimulatingCanvas:function(A){function x(T){return"function"==typeof T?T:function(H){T.handleEvent(H)}}function B(){for(var T=Object.keys(S),H=0;H<T.length;++H)delete S[T]}function C(){++P;M||I==P&&A.loseContext()}function D(T,H){var U=T[H];return function(){C();if(!M)return U.apply(T,arguments)}}function E(T){return{statusMessage:T,preventDefault:function(){N=!0}}}function F(T){for(var H in T)"function"==typeof T[H]?
L[H]=D(T,H):k(L,T,H);L.getError=function(){C();if(!M)for(var Q;Q=G.getError();)S[Q]=!0;for(Q in S)if(S[Q])return delete S[Q],Q;return L.NO_ERROR};var U="createBuffer createFramebuffer createProgram createRenderbuffer createShader createTexture".split(" ");for(H=0;H<U.length;++H){var W=U[H];L[W]=function(Q){return function(){C();if(M)return null;var X=Q.apply(T,arguments);X.__webglDebugContextLostId__=R;J.push(X);return X}}(T[W])}U="getActiveAttrib getActiveUniform getBufferParameter getContextAttributes getAttachedShaders getFramebufferAttachmentParameter getParameter getProgramParameter getProgramInfoLog getRenderbufferParameter getShaderParameter getShaderInfoLog getShaderSource getTexParameter getUniform getUniformLocation getVertexAttrib".split(" ");
for(H=0;H<U.length;++H)W=U[H],L[W]=function(Q){return function(){C();return M?null:Q.apply(T,arguments)}}(L[W]);U="isBuffer isEnabled isFramebuffer isProgram isRenderbuffer isShader isTexture".split(" ");for(H=0;H<U.length;++H)W=U[H],L[W]=function(Q){return function(){C();return M?!1:Q.apply(T,arguments)}}(L[W]);L.checkFramebufferStatus=function(Q){return function(){C();return M?L.FRAMEBUFFER_UNSUPPORTED:Q.apply(T,arguments)}}(L.checkFramebufferStatus);L.getAttribLocation=function(Q){return function(){C();
return M?-1:Q.apply(T,arguments)}}(L.getAttribLocation);L.getVertexAttribOffset=function(Q){return function(){C();return M?0:Q.apply(T,arguments)}}(L.getVertexAttribOffset);L.isContextLost=function(){return M};return L}var G,O=[],K=[];var L={};var R=1,M=!1,J=[],I=0,P=0,N=!1,V=0,S={};A.getContext=function(T){return function(){var H=T.apply(A,arguments);if(H instanceof WebGLRenderingContext){if(H!=G){if(G)throw"got different context";G=H;L=F(G)}return L}return H}}(A.getContext);(function(T){var H=T.addEventListener;
T.addEventListener=function(U,W,Q){switch(U){case "webglcontextlost":O.push(x(W));break;case "webglcontextrestored":K.push(x(W));break;default:H.apply(T,arguments)}}})(A);A.loseContext=function(){if(!M){M=!0;I=0;for(++R;G.getError(););B();S[G.CONTEXT_LOST_WEBGL]=!0;var T=E("context lost"),H=O.slice();setTimeout(function(){for(var U=0;U<H.length;++U)H[U](T);0<=V&&setTimeout(function(){A.restoreContext()},V)},0)}};A.restoreContext=function(){M&&K.length&&setTimeout(function(){if(!N)throw"can not restore. webglcontestlost listener did not call event.preventDefault";
for(var T=0;T<J.length;++T){var H=J[T];H instanceof WebGLBuffer?G.deleteBuffer(H):H instanceof WebGLFramebuffer?G.deleteFramebuffer(H):H instanceof WebGLProgram?G.deleteProgram(H):H instanceof WebGLRenderbuffer?G.deleteRenderbuffer(H):H instanceof WebGLShader?G.deleteShader(H):H instanceof WebGLTexture&&G.deleteTexture(H)}y(G);M=!1;P=0;N=!1;T=K.slice();H=E("context restored");for(var U=0;U<T.length;++U)T[U](H)},0)};A.loseContextInNCalls=function(T){if(M)throw"You can not ask a lost contet to be lost";
I=P+T};A.getNumCalls=function(){return P};A.setRestoreTimeout=function(T){V=T};return A},resetToInitialState:y}})})(d);a.testFloatBufferBlend=function(e){var g,p,t;if(!e.gl)return!1;if(e.type===n.ContextType.WEBGL1){var q,k;return!(null==(q=e.capabilities.textureFloat)||!q.textureFloat||null==(k=e.capabilities.colorBufferFloat)||!k.textureFloat)}if(!((null==(g=e.capabilities.textureFloat)?0:g.textureFloat)&&(null==(p=e.capabilities.colorBufferFloat)?0:p.textureFloat)&&(null==(t=e.capabilities.colorBufferFloat)?
0:t.floatBlend)))return!1;g=new u.FramebufferObject(e,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},{target:l.TextureType.TEXTURE_2D,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.FLOAT,internalFormat:l.SizedPixelFormat.RGBA32F,samplingMode:l.TextureSamplingMode.NEAREST,width:1,height:1});p=c.BufferObject.createVertex(e,l.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1]));t=new m.VertexArrayObject(e,new Map([["a_pos",
0]]),{geometry:[new h.VertexElementDescriptor("a_pos",2,l.DataType.UNSIGNED_SHORT,0,4)]},{geometry:p});q=e.programCache.acquire("\n  precision highp float;\n  attribute vec2 a_pos;\n\n  void main() {\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n   precision highp float;\n\n   void main() {\n    gl_FragColor \x3d vec4(0.5, 0.5, 0.5, 0.5);\n   }\n  ",new Map([["a_pos",0]]));e.useProgram(q);k=e.getBoundFramebufferObject();const {x:r,y,width:f,height:w}=e.getViewport();e.bindFramebuffer(g);
e.setViewport(0,0,1,1);e.bindVAO(t);e.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4);var z=v.makePipelineState({blending:b.blendingAlpha});e.setPipelineState(z);e.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4);d.exports.init(e);z=e.gl.getError();e.setViewport(r,y,f,w);e.bindFramebuffer(k);q.dispose();t.dispose(!1);p.dispose();g.dispose();return 1282===z?(console.warn("Device claims support for WebGL extension EXT_float_blend but does not support it. Using fall back."),!1):!0};Object.defineProperties(a,
{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testSamplerPrecision":function(){define("exports ../../core/Logger ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject ./VertexElementDescriptor".split(" "),function(a,b,c,n,l,u,v,m){const h=b.getLogger("esri.views.WebGLDriverTest");a.testSamplerPrecision=function(d){var e=new l.FramebufferObject(d,{colorTarget:n.TargetType.TEXTURE,depthStencilTarget:n.DepthStencilTargetType.NONE},{target:n.TextureType.TEXTURE_2D,
wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:1,height:1});const g=new Uint8Array(4),p=c.BufferObject.createVertex(d,n.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),t=new v.VertexArrayObject(d,new Map([["a_position",0]]),{geometry:[new m.VertexElementDescriptor("a_position",2,n.DataType.SHORT,0,4)]},{geometry:p}),q=d.programCache.acquire("\nprecision highp float;\nattribute vec2 a_pos;\nuniform highp sampler2D u_texture;\nvarying vec4 v_color;\n\nfloat getBit(in float bitset, in int bitIndex) {\n  float offset \x3d pow(2.0, float(bitIndex));\n  return mod(floor(bitset / offset), 2.0);\n}\n\nvoid main() {\n  vec4 value \x3d texture2D(u_texture, vec2(0.0));\n  float bit \x3d getBit(value.x * 255.0, 1);\n\n  v_color \x3d bit * vec4(1.0);\n  gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n}\n",
"\nprecision highp float;\nvarying vec4 v_color;\n\nvoid main() {\n  gl_FragColor \x3d v_color;\n}\n",new Map([["a_pos",0]]));d.useProgram(q);var k=new u.Texture(d,{target:n.TextureType.TEXTURE_2D,wrapMode:n.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:n.PixelFormat.RGBA,dataType:n.PixelType.UNSIGNED_BYTE,samplingMode:n.TextureSamplingMode.NEAREST,width:1,height:1},new Uint8Array([2,255,0,0]));q.setUniform1i("u_texture",0);d.bindTexture(k,0);k=d.getBoundFramebufferObject();d.bindFramebuffer(e);d.useProgram(q);
const {x:r,y,width:f,height:w}=d.getViewport();d.setViewport(0,0,1,1);d.bindVAO(t);d.drawArrays(n.PrimitiveType.TRIANGLE_STRIP,0,4);d.setViewport(r,y,f,w);e.readPixels(0,0,1,1,n.PixelFormat.RGBA,n.PixelType.UNSIGNED_BYTE,g);q.dispose();t.dispose(!1);p.dispose();e.dispose();(e=255!==g[0]||255!==g[1]||255!==g[2]||255!==g[3])&&h.warn(`A problem was detected with your graphics driver. Your driver does not appear to honor sampler precision specifiers, which may result in rendering issues due to numerical instability. We recommend ensuring that your drivers have been updated to the latest version. Applying lowp sampler workaround. [${g[0]}.${g[1]}.${g[2]}.${g[3]}]`);
d.bindFramebuffer(k);return e};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/testSVGPremultipliedAlpha":function(){define("exports ../../chunks/_rollupPluginBabelHelpers ../2d/engine/webgl/DefaultVertexAttributeLayouts ./BufferObject ./enums ./FramebufferObject ./Texture ./VertexArrayObject".split(" "),function(a,b,c,n,l,u,v,m){function h(){h=b._asyncToGenerator(function*(d){const e=new Image;e.src="data:image/svg+xml,%3C%3Fxml version\x3d'1.0' encoding\x3d'UTF-8'%3F%3E%3Csvg width\x3d'5' height\x3d'5' version\x3d'1.1' viewBox\x3d'0 0 5 5' xmlns\x3d'http://www.w3.org/2000/svg'%3E%3Crect width\x3d'5' height\x3d'5' fill\x3d'%23f00' fill-opacity\x3d'.5'/%3E%3C/svg%3E%0A";
e.width=5;e.height=5;yield e.decode();if(!d.gl)return!0;const g=new u.FramebufferObject(d,{colorTarget:l.TargetType.TEXTURE,depthStencilTarget:l.DepthStencilTargetType.NONE},{target:l.TextureType.TEXTURE_2D,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,pixelFormat:l.PixelFormat.RGBA,dataType:l.PixelType.UNSIGNED_BYTE,samplingMode:l.TextureSamplingMode.NEAREST,width:1,height:1}),p=n.BufferObject.createVertex(d,l.Usage.STATIC_DRAW,new Uint16Array([0,0,1,0,0,1,1,1])),t=new m.VertexArrayObject(d,new Map([["a_pos",
0]]),c.Pos2us,{geometry:p}),q=d.programCache.acquire("\n  precision highp float;\n\n  attribute vec2 a_pos;\n  varying vec2 v_uv;\n\n  void main() {\n    v_uv \x3d a_pos;\n    gl_Position \x3d vec4(a_pos * 2.0 - 1.0, 0.0, 1.0);\n  }\n  ","\n  precision highp float;\n\n  varying vec2 v_uv;\n  uniform sampler2D u_texture;\n\n  void main() {\n    gl_FragColor \x3d texture2D(u_texture, v_uv);\n  }\n  ",new Map([["a_pos",0]]));d.useProgram(q);const k=new v.Texture(d,{dataType:l.PixelType.UNSIGNED_BYTE,
pixelFormat:l.PixelFormat.RGBA,preMultiplyAlpha:!1,wrapMode:l.TextureWrapMode.CLAMP_TO_EDGE,samplingMode:l.TextureSamplingMode.LINEAR},e);d.bindTexture(k,0);q.setUniform1i("u_texture",0);const r=d.getBoundFramebufferObject(),{x:y,y:f,width:w,height:z}=d.getViewport();d.bindFramebuffer(g);d.setViewport(0,0,1,1);d.setClearColor(0,0,0,0);d.setBlendingEnabled(!1);d.clearSafe(l.ClearBufferBit.COLOR_BUFFER_BIT);d.bindVAO(t);d.drawArrays(l.PrimitiveType.TRIANGLE_STRIP,0,4);const A=new Uint8Array(4);g.readPixels(0,
0,1,1,l.PixelFormat.RGBA,l.PixelType.UNSIGNED_BYTE,A);q.dispose();t.dispose(!1);p.dispose();g.dispose();k.dispose();d.setViewport(y,f,w,z);d.bindFramebuffer(r);e.src="";return 255===A[0]});return h.apply(this,arguments)}a.testSVGPremultipliedAlpha=function(d){return h.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/2d/engine/webgl/DefaultVertexAttributeLayouts":function(){define(["exports","../../../webgl/enums","../../../webgl/VertexElementDescriptor"],
function(a,b,c){const n={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,2)]},l={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.BYTE,0,4),new c.VertexElementDescriptor("a_tex",2,b.DataType.BYTE,2,4)]};b={geometry:[new c.VertexElementDescriptor("a_pos",2,b.DataType.UNSIGNED_SHORT,0,4)]};a.Pos2b=n;a.Pos2us=b;a.PosTex2b=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/Capabilities":function(){define("exports ../../../chunks/_rollupPluginBabelHelpers ./DisjointTimerQuery ./DrawBuffers ./Instancing ./load ./LoseContext ./VertexArrayObjects".split(" "),
function(a,b,c,n,l,u,v,m){let h=function(){function d(e,g){this.gl=e;this._textureFloatLinear=this._fragDepth=this._shaderTextureLOD=this._standardDerivatives=this._depthTexture=null;this._disabledExtensions=g.disabledExtensions||{};this._debugWebGLExtensions=g.debugWebGLExtensions||{}}d.prototype.enable=function(e){return this[e]};b._createClass(d,[{key:"drawBuffers",get:function(){this._drawBuffers||(this._drawBuffers=n.load(this.gl,this._disabledExtensions));return this._drawBuffers}},{key:"instancing",
get:function(){this._instancing||(this._instancing=l.load(this.gl));return this._instancing}},{key:"vao",get:function(){this._vertexArrayObject||(this._vertexArrayObject=m.load(this.gl,this._disabledExtensions));return this._vertexArrayObject}},{key:"compressedTextureETC",get:function(){this._compressedTextureETC||(this._compressedTextureETC=u.loadCompressedTextureETC(this.gl,this._disabledExtensions));return this._compressedTextureETC}},{key:"compressedTextureS3TC",get:function(){this._compressedTextureS3TC||
(this._compressedTextureS3TC=u.loadCompressedTextureS3TC(this.gl,this._disabledExtensions));return this._compressedTextureS3TC}},{key:"textureFilterAnisotropic",get:function(){this._textureFilterAnisotropic||(this._textureFilterAnisotropic=u.loadTextureFilterAnisotropicCapability(this.gl,this._disabledExtensions));return this._textureFilterAnisotropic}},{key:"disjointTimerQuery",get:function(){this._disjointTimerQuery||(this._disjointTimerQuery=c.createDisjointTimerQuery(this.gl,this._disabledExtensions));
return this._disjointTimerQuery}},{key:"textureFloat",get:function(){this._textureFloat||(this._textureFloat=u.loadTextureFloat(this.gl,this._disabledExtensions));return this._textureFloat}},{key:"colorBufferFloat",get:function(){this._colorBufferFloat||(this._colorBufferFloat=u.loadColorBufferFloat(this.gl,this._disabledExtensions));return this._colorBufferFloat}},{key:"blendMinMax",get:function(){this._minMaxBlending||(this._minMaxBlending=u.loadMinMaxBlending(this.gl,this._disabledExtensions));
return this._minMaxBlending}},{key:"depthTexture",get:function(){null===this._depthTexture&&(this._depthTexture=u.loadBooleanExtension(this.gl,this._disabledExtensions,"depthTexture",!0,["WEBGL_depth_texture","MOZ_WEBGL_depth_texture","WEBKIT_WEBGL_depth_texture"]));return this._depthTexture}},{key:"standardDerivatives",get:function(){null===this._standardDerivatives&&(this._standardDerivatives=u.loadBooleanExtension(this.gl,this._disabledExtensions,"standardDerivatives",!0,["OES_standard_derivatives"]));
return this._standardDerivatives}},{key:"shaderTextureLOD",get:function(){null===this._shaderTextureLOD&&(this._shaderTextureLOD=u.loadBooleanExtension(this.gl,this._disabledExtensions,"shaderTextureLOD",!0,["EXT_shader_texture_lod"]));return this._shaderTextureLOD}},{key:"fragDepth",get:function(){null===this._fragDepth&&(this._fragDepth=u.loadBooleanExtension(this.gl,this._disabledExtensions,"fragDepth",!0,["EXT_frag_depth"]));return this._fragDepth}},{key:"loseContext",get:function(){this._loseContext||
(this._loseContext=v.load(this.gl,this._debugWebGLExtensions));return this._loseContext}},{key:"textureNorm16",get:function(){this._textureNorm16||(this._textureNorm16=u.loadTextureNorm16(this.gl,this._disabledExtensions));return this._textureNorm16}},{key:"textureFloatLinear",get:function(){null===this._textureFloatLinear&&(this._textureFloatLinear=u.loadBooleanExtension(this.gl,this._disabledExtensions,"textureFloatLinear",!1,["OES_texture_float_linear"]));return this._textureFloatLinear}}]);return d}();
a.Capabilities=h;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/DisjointTimerQuery":function(){define(["exports","./isWebGL2Context"],function(a,b){let c=function(n,l,u,v,m,h,d,e){this.createQuery=n;this.resultAvailable=l;this.getResult=u;this.disjoint=v;this.beginTimeElapsed=m;this.endTimeElapsed=h;this.createTimestamp=d;this.timestampBits=e};a.DisjointTimerQuery=c;a.createDisjointTimerQuery=function(n,l){if(l.disjointTimerQuery)return null;
let u=n.getExtension("EXT_disjoint_timer_query_webgl2");return u&&b(n)?new c(()=>n.createQuery(),v=>n.getQueryParameter(v,n.QUERY_RESULT_AVAILABLE),v=>n.getQueryParameter(v,n.QUERY_RESULT),()=>n.getParameter(u.GPU_DISJOINT_EXT),v=>n.beginQuery(u.TIME_ELAPSED_EXT,v),()=>n.endQuery(u.TIME_ELAPSED_EXT),v=>u.queryCounterEXT(v,u.TIMESTAMP_EXT),()=>n.getQuery(u.TIMESTAMP_EXT,u.QUERY_COUNTER_BITS_EXT)):(u=n.getExtension("EXT_disjoint_timer_query"))?new c(()=>u.createQueryEXT(),v=>u.getQueryObjectEXT(v,u.QUERY_RESULT_AVAILABLE_EXT),
v=>u.getQueryObjectEXT(v,u.QUERY_RESULT_EXT),()=>n.getParameter(u.GPU_DISJOINT_EXT),v=>u.beginQueryEXT(u.TIME_ELAPSED_EXT,v),()=>u.endQueryEXT(u.TIME_ELAPSED_EXT),v=>u.queryCounterEXT(v,u.TIMESTAMP_EXT),()=>u.getQueryEXT(u.TIMESTAMP_EXT,u.QUERY_COUNTER_BITS_EXT)):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/DrawBuffers":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,n){return n.disjointTimerQuery?
null:b(c)?{drawBuffers:c.drawBuffers.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS}:n.drawBuffers?null:(c=c.getExtension("WEBGL_draw_buffers"))?{drawBuffers:c.drawBuffersWEBGL.bind(c),MAX_DRAW_BUFFERS:c.MAX_DRAW_BUFFERS_WEBGL,MAX_COLOR_ATTACHMENTS:c.MAX_COLOR_ATTACHMENTS_WEBGL}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/Instancing":function(){define(["exports","./isWebGL2Context"],
function(a,b){a.load=function(c){return b(c)?{drawArraysInstanced:c.drawArraysInstanced.bind(c),drawElementsInstanced:c.drawElementsInstanced.bind(c),vertexAttribDivisor:c.vertexAttribDivisor.bind(c)}:(c=c.getExtension("ANGLE_instanced_arrays"))?{drawArraysInstanced:c.drawArraysInstancedANGLE.bind(c),drawElementsInstanced:c.drawElementsInstancedANGLE.bind(c),vertexAttribDivisor:c.vertexAttribDivisorANGLE.bind(c)}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/webgl/capabilities/load":function(){define(["exports","./isWebGL2Context"],function(a,b){a.loadBooleanExtension=function(c,n,l,u,v){if(u&&b(c))return!0;if(n[l])return!1;for(const m of v)if(c.getExtension(m))return!0;return!1};a.loadColorBufferFloat=function(c,n){if(b(c)){var l=!n.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float")||!n.colorBufferFloat&&c.getExtension("EXT_color_buffer_float"),u=!n.colorBufferFloat&&c.getExtension("EXT_color_buffer_float");n=!n.floatBlend&&
!n.colorBufferFloat&&c.getExtension("EXT_float_blend");return l||u||n?{textureFloat:!!u,textureHalfFloat:!!l,floatBlend:!!n,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,RGB16F:c.RGB16F}:null}return c instanceof WebGLRenderingContext?(l=!n.colorBufferHalfFloat&&c.getExtension("EXT_color_buffer_half_float"),u=!n.colorBufferFloat&&c.getExtension("WEBGL_color_buffer_float"),c=!n.floatBlend&&!n.colorBufferFloat&&c.getExtension("EXT_float_blend"),
l||u||c?{textureFloat:!!u,textureHalfFloat:!!l,floatBlend:!!c,RGBA16F:l?l.RGBA16F_EXT:void 0,RGB16F:l?l.RGB16F_EXT:void 0,RGBA32F:u?u.RGBA32F_EXT:void 0}:null):null};a.loadCompressedTextureETC=function(c,n){return n.compressedTextureETC?null:(c=c.getExtension("WEBGL_compressed_texture_etc"))?{COMPRESSED_R11_EAC:c.COMPRESSED_R11_EAC,COMPRESSED_SIGNED_R11_EAC:c.COMPRESSED_SIGNED_R11_EAC,COMPRESSED_RG11_EAC:c.COMPRESSED_RG11_EAC,COMPRESSED_SIGNED_RG11_EAC:c.COMPRESSED_SIGNED_RG11_EAC,COMPRESSED_RGB8_ETC2:c.COMPRESSED_RGB8_ETC2,
COMPRESSED_SRGB8_ETC2:c.COMPRESSED_SRGB8_ETC2,COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2:c.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2,COMPRESSED_RGBA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC,COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC}:null};a.loadCompressedTextureS3TC=function(c,n){return n.compressedTextureS3TC?null:(c=c.getExtension("WEBGL_compressed_texture_s3tc"))?{COMPRESSED_RGB_S3TC_DXT1:c.COMPRESSED_RGB_S3TC_DXT1_EXT,
COMPRESSED_RGBA_S3TC_DXT1:c.COMPRESSED_RGBA_S3TC_DXT1_EXT,COMPRESSED_RGBA_S3TC_DXT3:c.COMPRESSED_RGBA_S3TC_DXT3_EXT,COMPRESSED_RGBA_S3TC_DXT5:c.COMPRESSED_RGBA_S3TC_DXT5_EXT}:null};a.loadMinMaxBlending=function(c,n){return b(c)?{MIN:c.MIN,MAX:c.MAX}:n.blendMinMax?null:(c=c.getExtension("EXT_blend_minmax"))?{MIN:c.MIN_EXT,MAX:c.MAX_EXT}:null};a.loadTextureFilterAnisotropicCapability=function(c,n){return n.textureFilterAnisotropic?null:(c=c.getExtension("EXT_texture_filter_anisotropic")||c.getExtension("MOZ_EXT_texture_filter_anisotropic")||
c.getExtension("WEBKIT_EXT_texture_filter_anisotropic"))?{MAX_TEXTURE_MAX_ANISOTROPY:c.MAX_TEXTURE_MAX_ANISOTROPY_EXT,TEXTURE_MAX_ANISOTROPY:c.TEXTURE_MAX_ANISOTROPY_EXT}:null};a.loadTextureFloat=function(c,n){if(b(c))return{textureFloat:!0,textureFloatLinear:!n.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!0,textureHalfFloatLinear:!0,HALF_FLOAT:c.HALF_FLOAT,R16F:c.R16F,RG16F:c.RG16F,RGBA16F:c.RGBA16F,R32F:c.R32F,RG32F:c.RG32F,RGBA32F:c.RGBA32F,R11F_G11F_B10F:c.R11F_G11F_B10F,
RGB16F:c.RGB16F};if(c instanceof WebGLRenderingContext){const l=!n.textureHalfFloat&&c.getExtension("OES_texture_half_float");return{textureFloat:!n.textureFloat&&!!c.getExtension("OES_texture_float"),textureFloatLinear:!n.textureFloatLinear&&!!c.getExtension("OES_texture_float_linear"),textureHalfFloat:!!l,textureHalfFloatLinear:!n.textureHalfFloatLinear&&!!c.getExtension("OES_texture_half_float_linear"),HALF_FLOAT:l?l.HALF_FLOAT_OES:void 0}}return null};a.loadTextureNorm16=function(c,n){return!b(c)||
n.textureNorm16?null:(c=c.getExtension("EXT_texture_norm16"))?{R16:c.R16_EXT,RG16:c.RG16_EXT,RGB16:c.RGB16_EXT,RGBA16:c.RGBA16_EXT,R16_SNORM:c.R16_SNORM_EXT,RG16_SNORM:c.RG16_SNORM_EXT,RGB16_SNORM:c.RGB16_SNORM_EXT,RGBA16_SNORM:c.RGBA16_SNORM_EXT}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/LoseContext":function(){define(["exports"],function(a){a.load=function(b,c){const n=c.loseContext&&b.getExtension("WEBGL_lose_context");
return n?{loseRenderingContext:()=>n.loseContext()}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities/VertexArrayObjects":function(){define(["exports","./isWebGL2Context"],function(a,b){a.load=function(c,n){return b(c)?{createVertexArray:c.createVertexArray.bind(c),deleteVertexArray:c.deleteVertexArray.bind(c),bindVertexArray:c.bindVertexArray.bind(c)}:n.vao?null:(c=c.getExtension("OES_vertex_array_object")||c.getExtension("MOZ_OES_vertex_array_object")||
c.getExtension("WEBKIT_OES_vertex_array_object"))?{createVertexArray:c.createVertexArrayOES.bind(c),deleteVertexArray:c.deleteVertexArrayOES.bind(c),bindVertexArray:c.bindVertexArrayOES.bind(c)}:null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/TextureRepository":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../chunks/tslib.es6 ../../../../core/Accessor ../../../../core/Evented ../../../../core/Logger ../../../../core/maybe ../../../../core/promiseUtils ../../../../core/accessorSupport/decorators/property ../../../../core/arrayUtils ../../../../core/has ../../../../core/accessorSupport/ensureType ../../../../core/accessorSupport/decorators/subclass ./basicInterfaces ./ContentObjectType ./TextureTechnique ./TextureTechniqueConfiguration ./Util ../../../support/Scheduler".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){const w=u.getLogger("esri.views.3d.webgl-engine.lib.TextureRepository");a.TextureRepository=function(A){function x(C,D,E){var F=A.call(this,{})||this;F._stage=C;F._techniqueRepository=D;F._rctx=E;F._textures=new Map;F._loadingCount=0;F._frameUpdates=new Map;F.events=new l;F._frameTask=C.resourceController.scheduler.registerTask(f.TaskPriority.TEXTURE_UNLOAD);return F}b._inheritsLoose(x,A);var B=x.prototype;B.normalizeCtorArgs=function(){return{}};B.dispose=
function(){this._frameTask.remove();this._stage.forEachOfType(q.ContentObjectType.Texture,C=>C.unload())};B.acquire=function(C){const D=this._textures.get(C);return D?(D.ref(),v.unwrapOr(D.loadingPromise,D)):this._createNewRef(C)};B.update=function(){let C=!1;this._frameUpdates.forEach(D=>{const E=D.texture.frameUpdate(this._rctx,this.textureTechnique,D.previousToken);0<=E&&E!==D.previousToken&&(D.previousToken=E,C=!0)});C&&this.events.emit("changed",t.RenderRequestType.BACKGROUND)};B._createNewRef=
function(C){const D=this._stage.getObject(C);if(v.isNone(D))return y.assert(void 0!==D),null;const E=D.events.on("unloaded",()=>{E.remove();this._onTextureUnloaded(C)}),F=new z(C,()=>{this._frameTask.schedule(()=>{F.isUnreferenced&&D.unload()})});this._textures.set(C,F);F.ref();if(v.isSome(D.glTexture))return this._updateGLTexture(F,D.glTexture),D.requiresFrameUpdates&&this._frameUpdates.set(C,{texture:D,previousToken:-1}),F;this._loadingCount++;F.loadingPromise=this._stage.schedule(()=>{const G=
D.load(this._rctx,()=>this.textureTechnique),O=L=>{this._loadingCount--;F.loadingPromise=null;this._updateGLTexture(F,L);D.requiresFrameUpdates&&this._frameUpdates.set(C,{texture:D,previousToken:-1});return F},K=L=>{this._loadingCount--;F.loadingPromise=null;m.isAbortError(L)||w.error(L);return null};return m.isPromiseLike(G)?G.then(O,K):O(G)});return F.loadingPromise};B._updateGLTexture=function(C,D){C.glTexture=D;this.events.emit("changed",t.RenderRequestType.UPDATE)};B._onTextureUnloaded=function(C){this._textures.delete(C);
this._frameUpdates.delete(C)};b._createClass(x,[{key:"updating",get:function(){return 0<this._loadingCount||this._frameTask.updating}},{key:"textureTechnique",get:function(){v.isNone(this._textureTechnique)&&(this._textureTechnique=this._techniqueRepository.acquire(k.TextureTechnique,new r.TextureTechniqueConfiguration));return this._textureTechnique}}]);return x}(n);c.__decorate([h.property()],a.TextureRepository.prototype,"_loadingCount",void 0);c.__decorate([h.property()],a.TextureRepository.prototype,
"_frameTask",void 0);c.__decorate([h.property()],a.TextureRepository.prototype,"updating",null);a.TextureRepository=c.__decorate([p.subclass("esri.views.3d.webgl-engine.lib.TextureRepository")],a.TextureRepository);let z=function(){function A(B,C){this.id=B;this._release=C;this._refCount=0}var x=A.prototype;x.ref=function(){++this._refCount};x.release=function(){--this._refCount;0<this._refCount||(0===this._refCount?this._release():(w.error("Cannot dereference texture that has no references!"),this._refCount=
0))};b._createClass(A,[{key:"isUnreferenced",get:function(){return 0===this._refCount}}]);return A}();Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/materials/internal/WaterTextureRepository":function(){define("exports ../../../../../chunks/_rollupPluginBabelHelpers ../../../../../chunks/tslib.es6 ../../../../../assets ../../../../../core/Accessor ../../../../../core/Logger ../../../../../core/accessorSupport/decorators/property ../../../../../core/arrayUtils ../../../../../core/has ../../../../../core/accessorSupport/ensureType ../../../../../core/accessorSupport/decorators/subclass ../../../../../support/requestImageUtils ../../lib/basicInterfaces ../../../../webgl/enums ../../../../webgl/Texture".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){const k=u.getLogger("esri.views.3d.webgl-engine.materials.internal.waterMaterialUtils");a.WaterTextureRepository=function(r){function y(){var w=r.apply(this,arguments)||this;w._data=[];w._state=p.ResourceState.NOT_LOADED;return w}b._inheritsLoose(y,r);var f=y.prototype;f.dispose=function(){this._state=p.ResourceState.NOT_LOADED;this._data.forEach(w=>w.dispose());this._data.length=0};f.loadTextures=function(w){const z=[n.getAssetUrl("esri/images/materials/water/normals.jpg"),
n.getAssetUrl("esri/images/materials/water/perturbation.jpg")];this._state=p.ResourceState.LOADING;Promise.all(z.map(A=>g.requestImage(A))).then(A=>{A.forEach(x=>this._data.push(new q.Texture(w,{target:t.TextureType.TEXTURE_2D,pixelFormat:t.PixelFormat.RGBA,dataType:t.PixelType.UNSIGNED_BYTE,wrapMode:t.TextureWrapMode.REPEAT,samplingMode:t.TextureSamplingMode.LINEAR_MIPMAP_LINEAR,hasMipmap:!0,maxAnisotropy:8,width:x.width,height:x.height},x)));this._state=p.ResourceState.LOADED}).catch(A=>{k.error("Failed to load textures for water material.",
A);this._state=p.ResourceState.NOT_LOADED})};f.bind=function(w){this._state===p.ResourceState.LOADED&&(w.bindTexture("texWaveNormal",this._data[0]),w.bindTexture("texWavePerturbation",this._data[1]))};b._createClass(y,[{key:"updating",get:function(){return this._state===p.ResourceState.LOADING}},{key:"resourceState",get:function(){return this._state}}]);return y}(l);c.__decorate([v.property()],a.WaterTextureRepository.prototype,"_state",void 0);c.__decorate([v.property({type:Boolean,readOnly:!0})],
a.WaterTextureRepository.prototype,"updating",null);a.WaterTextureRepository=c.__decorate([e.subclass("esri.views.3d.webgl-engine.materials.internal.WaterTextureRepository")],a.WaterTextureRepository);Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/contextCache":function(){define(["exports"],function(a){const b=new Map;a.getContextCache=function(){return b};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},
"esri/views/3d/webgl-engine/parts/ScreenshotManager":function(){define("exports ../../../../chunks/_rollupPluginBabelHelpers ../../../../core/maybe ../../../../core/promiseUtils ../../../../chunks/vec4f64 ../lib/AutoDisposable ../lib/basicInterfaces ../../../support/screenshotUtils ../../../webgl/enums ../../../webgl/FramebufferObject".split(" "),function(a,b,c,n,l,u,v,m,h,d){u=function(e){function g(t,q,k,r,y,f){var w=e.call(this)||this;w._rctx=t;w._renderScene=q;w._requestRenderScene=k;w._renderOverlay=
r;w._forceCameraHook=y;w._disposeOffscreenBuffers=f;w.supersample=!0;w._screenshotQueue=[];return w}b._inheritsLoose(g,e);var p=g.prototype;p.dispose=function(){this._rctx=null};p.takeScreenshot=function(t){this._requestRenderScene(v.RenderRequestType.BACKGROUND);const q=n.createResolver();this._screenshotQueue.push({settings:t,resolver:q});return q.promise};p.update=function(t){for(const q of this._screenshotQueue){if(this.isDisposed){q.resolver.reject();continue}const k=this._renderScreenshot(t,
{...q.settings,pixelRatio:q.settings.pixelRatio*t.viewCamera.pixelRatio});q.resolver(k)}this._screenshotQueue.length=0};p._renderScreenshotOverlay=function(t,q,k){if(c.isNone(this._renderOverlay))return q;t.width=q.width;t.height=q.height;const r=t.getContext("2d"),y=k.pixelRatio;r.save();r.translate(0,q.height);r.scale(1,-1);k.region&&r.translate(-k.region.x,-k.region.y);r.scale(y,y);q=this._renderOverlay(t,q);r.restore();return q};p._readbackScreenshot=function(t,q){return t.resample?this._readbackScreenshotResampled(t,
q):this._readbackScreenshotImmediate(t,q)};p._readbackScreenshotResampled=function(t,q){const {framebufferWidth:k,framebufferHeight:r,region:y,resample:f}=t,w=this._ensureScreenshotEncodeCanvas();let z=m.createEmptyImageData(k,r,w);this._rctx.gl.readPixels(0,0,k,r,h.PixelFormat.RGBA,h.DataType.UNSIGNED_BYTE,new Uint8Array(z.data.buffer));q();z=this._renderScreenshotOverlay(w,z,{...t,region:null});t=m.createEmptyImageData(y.width,y.height,w);return m.resampleHermite(z,t,!0,f.region.x,r-(f.region.y+
f.region.height),f.region.width,f.region.height)};p._readbackScreenshotImmediate=function(t,q){const {framebufferHeight:k,region:r}=t,y=this._ensureScreenshotEncodeCanvas(),f=m.createEmptyImageData(r.width,r.height,y);this._rctx.gl.readPixels(r.x,k-(r.y+r.height),r.width,r.height,h.PixelFormat.RGBA,h.DataType.UNSIGNED_BYTE,new Uint8Array(f.data.buffer));q();return this._renderScreenshotOverlay(y,f,t)};p._renderScreenshot=function(t,q){let k=null;const r=t.viewCamera,{framebufferWidth:y,framebufferHeight:f}=
q;var w=!1;t=q.disableDecorations&&t.frameHasDecorations;var z=q.ignorePadding&&r.pixelRatio!==q.pixelRatio;if(t=y!==r.fullWidth||f!==r.fullHeight||t||z){z=r.clone();if(q.ignorePadding){w=l.clone(z.padding);for(var A=0;4>A;A++)w[A]=Math.round(w[A]/z.pixelRatio*q.pixelRatio);z.padding=w}z.fullWidth=y;z.fullHeight=f;z.pixelRatio=q.pixelRatio;w=r.fovX-z.fovX;A=r.fovY-z.fovY;0>w&&w<A?z.fovX=r.fovX:0>A&&A<w&&(z.fovY=r.fovY);this._forceCameraHook(z);w=!0;k=new d.FramebufferObject(this._rctx,{width:z.fullWidth,
height:z.fullHeight,colorTarget:h.TargetType.TEXTURE,depthStencilTarget:h.DepthStencilTargetType.DEPTH_STENCIL_RENDER_BUFFER});this._renderScene(k,z,q.disableDecorations?v.Decorations.OFF:v.Decorations.ON);this._disposeOffscreenBuffers()}z=()=>{this._rctx.bindFramebuffer(null);c.disposeMaybe(k)};q=this._readbackScreenshot(q,z);z();if(t&&!this._rctx.contextAttributes.alpha)for(t=3;t<q.data.length;t+=4)q.data[t]=255;w&&this._forceCameraHook(r);return q};p._ensureScreenshotEncodeCanvas=function(){this._screenshotEncodeCanvas||
(this._screenshotEncodeCanvas=document.createElement("canvas"));return this._screenshotEncodeCanvas};return g}(u.AutoDisposable);a.ScreenshotManager=u;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/parts/testUtils":function(){define(["exports","./contextCache"],function(a,b){a.contextCache={enabled:!1,disposeContextCache:()=>{const c=b.getContextCache();c.forEach(n=>n.dispose());c.clear()}};Object.defineProperties(a,{__esModule:{value:!0},
[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/intersectorUtilsConversions":function(){define("exports ../../../../core/maybe ../../../../chunks/mat4 ../../../../chunks/vec3f64 ../../../../geometry/support/aaBoundingBox ../../../../chunks/sphere ../../layers/i3s/Intersector ../../terrain/Intersector ./intersectorUtils ./lodRendering/Intersector".split(" "),function(a,b,c,n,l,u,v,m,h,d){function e(y,f){return b.isNone(y)?null:h.isObjectIntersectorResult(y)||h.isHudIntersectorResult(y)?
g(y.target.object.metadata,f):v.isPclIntersectorResult(y)?(y=y.target.createGraphic(),{type:"graphic",graphic:y,layer:y.layer}):m.isOverlayIntersectorResult(y)||d.isLodIntersectorResult(y)?g(y.target,f):v.isI3sIntersectorResult(y)?p(y.target,f):null}function g(y,f){if(b.isNone(y)||b.isNone(y.graphicUid))return null;const w=k(y,f);if(b.isNone(w))return null;if(w===f.graphics)return b.isNone(f.graphicsView)||"number"!==typeof y.graphicUid?null:f.graphicsView.getHit(y.graphicUid);f=f.allLayerViews.find(z=>
z.layer===w);return!f||f.suspended||b.isNone(y.graphicUid)?null:"getHit"in f?f.getHit(y.graphicUid):null}function p(y,f){const w=k(y,f);return b.isNone(w)?null:(f=f.allLayerViews.find(z=>z.layer===w))&&!f.suspended&&"getGraphicFromIntersectorTarget"in f?q(f.getGraphicFromIntersectorTarget(y)):null}function t(y,f){const w=k(y,f);return b.isNone(w)?null:(f=f.allLayerViews.find(z=>z.layer===w))&&!f.suspended&&"getAABBFromIntersectorTarget"in f?f.getAABBFromIntersectorTarget(y):null}function q(y){return b.isSome(y)?
{type:"graphic",graphic:y,layer:y.layer}:null}function k(y,f){return b.isNone(y.layerUid)?null:b.isSome(f.graphicsView)&&y.layerUid===f.graphicsView.processor.layer.id?f.graphics:f.map.findLayerByUid(y.layerUid)}const r=n.create();a.getIntersectedFeatureBSRadius=function(y,f){return h.isObjectIntersectorResult(y)||h.isHudIntersectorResult(y)?u.getRadius(y.target.object.boundingVolumeWorldSpace.bounds):d.isLodIntersectorResult(y)?(c.getScaling(r,y.transformation),y.target.baseBoundingSphere.radius*
Math.max(r[0],r[1],r[2])):v.isI3sIntersectorResult(y)?b.applySome(t(y.target,f),w=>.5*l.diameter(w)):null};a.hasLod=function(y){return h.isObjectIntersectorResult(y)||h.isHudIntersectorResult(y)?!1:d.isLodIntersectorResult(y)?1<y.target.numLodLevels:v.isI3sIntersectorResult(y)?!0:!1};a.toGraphic=function(y,f){y=e(y,f);return b.isSome(y)&&"graphic"===y.type?y.graphic:null};a.toHit=e;a.toOwner=function(y,f){if(h.isObjectIntersectorResult(y)||h.isHudIntersectorResult(y))return k(y.target.object.metadata,
f);if(m.isTerrainIntersectorResult(y)){var w;return null==(w=f.map)?void 0:w.ground}return v.isPclIntersectorResult(y)||v.isI3sIntersectorResult(y)||m.isOverlayIntersectorResult(y)?k(y.target,f):null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/layers/i3s/Intersector":function(){define(["exports","../../webgl-engine/lib/IntersectorInterfaces","../../webgl-engine/lib/intersectorUtils"],function(a,b,c){a.isI3sIntersectorResult=function(n){return c.isValidIntersectorResult(n)&&
n.intersector===b.IntersectorType.I3S&&!!n.target};a.isPclIntersectorResult=function(n){return c.isValidIntersectorResult(n)&&n.intersector===b.IntersectorType.PCL&&!!n.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/terrain/Intersector":function(){define(["exports","../webgl-engine/lib/IntersectorInterfaces","../webgl-engine/lib/intersectorUtils"],function(a,b,c){a.isOverlayIntersectorResult=function(n){return c.isValidIntersectorResult(n)&&
n.intersector===b.IntersectorType.OVERLAY&&!!n.target};a.isTerrainIntersectorResult=function(n){return c.isValidIntersectorResult(n)&&n.intersector===b.IntersectorType.TERRAIN&&!!n.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/3d/webgl-engine/lib/lodRendering/Intersector":function(){define(["exports","../IntersectorInterfaces","../intersectorUtils"],function(a,b,c){a.isLodIntersectorResult=function(n){return c.isValidIntersectorResult(n)&&
n.intersector===b.IntersectorType.LOD&&!!n.target};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/hitTestSelectUtils":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe"],function(a,b,c){function n(){n=b._asyncToGenerator(function*(u,v){if("2d"===u.type)return u.hitTest(v);u=yield u.hitTest(v);if(0===u.results.length)return u;v=u.results[0];const m=c.isSome(v.distance)?1.05*v.distance:v.distance;
v=u.results.findIndex(h=>h.distance>m);-1!==v&&(u.results=u.results.slice(0,v));return u});return n.apply(this,arguments)}function l(u){return c.isSome(u)&&"graphic"===u.type}a.filterGraphicHits=function(u){return u.filter(l)};a.findFirstGraphicHit=function(u){var v;return null!=(v=u.find(l))?v:null};a.hitTestSelectSimilarDistance=function(u,v){return n.apply(this,arguments)};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/support/WebGLRequirements":function(){define(["exports",
"../../core/Error","../webgl/capabilities","../webgl/context-util"],function(a,b,c,n){a.check=function(l){const u=c.getWebGLCapabilities(l);if(!u.available)return new b("webgl:required","WebGL is required but not supported.");if("3d"===l&&u.majorPerformanceCaveat)return new b("webgl:major-performance-caveat-detected","Your WebGL implementation doesn't seem to support hardware accelerated rendering. Check your browser settings or if your GPU is in a blocklist.");if(!u.supportsHighPrecisionFragment)return new b("webgl:high-precision-fragment-required",
"WebGL support for high precision fragment shaders is required but not supported.");if(!u.supportsVertexShaderSamplers)return new b("webgl:vertex-shader-samplers-required","WebGL support for vertex shader samplers is required but not supported.");if(u.type===n.ContextType.WEBGL1){if(!u.supportsElementIndexUint)return new b("webgl:element-index-uint-required","WebGL support for uint vertex indices is required but not supported.");if(!u.supportsStandardDerivatives)return new b("webgl:standard-derivatives-required",
"WebGL support for standard derivatives is required but not supported.");if(!u.supportsInstancedArrays)return new b("webgl:instanced-arrays-required","WebGL support for instanced rendering is required but not supported.")}return null};Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/webgl/capabilities":function(){define(["exports","../../chunks/_rollupPluginBabelHelpers","../../core/maybe","./context-util"],function(a,b,c,n){function l(t){switch(t){case n.ContextType.WEBGL1:return u();
case n.ContextType.WEBGL2:return v()}}function u(){if(!h){{const t=new g,q=m(n.ContextType.WEBGL1,t);c.isNone(q)||(t.supportsElementIndexUint=null!==q.getExtension("OES_element_index_uint"),t.supportsStandardDerivatives=null!==q.getExtension("OES_standard_derivatives"),t.supportsInstancedArrays=null!==q.getExtension("ANGLE_instanced_arrays"),t.supportsTextureFloat=null!==q.getExtension("OES_texture_float"),t.supportsTextureHalfFloat=null!==q.getExtension("OES_texture_half_float"),t.supportsColorBufferFloat=
null!==q.getExtension("WEBGL_color_buffer_float"),t.supportsColorBufferFloatBlend=null!==q.getExtension("EXT_float_blend"),t.supportsColorBufferHalfFloat=null!==q.getExtension("EXT_color_buffer_half_float"));h=t}}return h}function v(){if(!d){{const t=new p,q=m(n.ContextType.WEBGL2,t);c.isNone(q)||(t.supportsColorBufferFloat=null!==q.getExtension("EXT_color_buffer_float"),t.supportsColorBufferFloatBlend=null!==q.getExtension("EXT_float_blend"),t.supportsColorBufferHalfFloat=t.supportsColorBufferFloat||
null!==q.getExtension("EXT_color_buffer_half_float"));d=t}}return d}function m(t,q){const k=document.createElement("canvas");if(!k)return null;let r=n.createContext(k,t,{failIfMajorPerformanceCaveat:!0});c.isNone(r)&&(r=n.createContext(k,t),c.isSome(r)&&(q.majorPerformanceCaveat=!0));if(c.isNone(r))return r;if(t===n.ContextType.WEBGL1){if(t=r.getParameter(r.VERSION),t=null==t?void 0:t.match(/^WebGL\s+([\d.]*)/))t=parseFloat(t[1]),q.available=.94<=t}else q.available=!0;q.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE);
q.supportsVertexShaderSamplers=0<r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS);if(t=r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT))q.supportsHighPrecisionFragment=0<t.precision;return r}let h,d,e=function(){this.majorPerformanceCaveat=this.available=!1;this.maxTextureSize=0;this.supportsColorBufferHalfFloat=this.supportsColorBufferFloatBlend=this.supportsColorBufferFloat=this.supportsTextureHalfFloat=this.supportsTextureFloat=this.supportsInstancedArrays=this.supportsStandardDerivatives=
this.supportsElementIndexUint=this.supportsHighPrecisionFragment=this.supportsVertexShaderSamplers=!1},g=function(t){function q(){var k=t.apply(this,arguments)||this;k.type=n.ContextType.WEBGL1;return k}b._inheritsLoose(q,t);return q}(e),p=function(t){function q(){var k=t.apply(this,arguments)||this;k.type=n.ContextType.WEBGL2;k.supportsElementIndexUint=!0;k.supportsStandardDerivatives=!0;k.supportsInstancedArrays=!0;k.supportsTextureFloat=!0;k.supportsTextureHalfFloat=!0;return k}b._inheritsLoose(q,
t);return q}(e);a.getWebGL1Capabilities=u;a.getWebGL2Capabilities=v;a.getWebGLCapabilities=function(t){for(t=n.getContextTypes(t);1<t.length;){const q=l(t.shift());if(q.available)return q}return l(t.shift())};a.getWebGLVersionCapabilities=l;Object.defineProperties(a,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})})},"esri/views/ui/3d/DefaultUI3D":function(){define("../../../chunks/_rollupPluginBabelHelpers ../../../chunks/tslib.es6 ../../../core/accessorSupport/decorators/property ../../../core/arrayUtils ../../../core/has ../../../core/accessorSupport/ensureType ../../../core/accessorSupport/decorators/subclass ../DefaultUI".split(" "),
function(a,b,c,n,l,u,v,m){n=function(h){function d(e){e=h.call(this,e)||this;e.components=["attribution","zoom","navigation-toggle","compass"];return e}a._inheritsLoose(d,h);return d}(m);b.__decorate([c.property()],n.prototype,"components",void 0);return n=b.__decorate([v.subclass("esri.views.ui.3d.DefaultUI3D")],n)})},"esri/views/ui/DefaultUI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/has ../../core/Logger ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./Component ./UI ../../widgets/Attribution ../../widgets/Compass ../../widgets/NavigationToggle ../../widgets/Zoom".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){n.getLogger("esri.views.ui.DefaultUI");c=function(k){function r(f){f=k.call(this,f)||this;f._defaultPositionLookup={attribution:"manual",compass:"top-left","navigation-toggle":"top-left",zoom:"top-left"};f.components=[];return f}a._inheritsLoose(r,k);var y=r.prototype;y.initialize=function(){this._handles.add([l.watch(()=>this.components,this._componentsWatcher.bind(this),l.initial),l.watch(()=>this.view,this._updateViewAwareWidgets.bind(this),l.initial)])};
y._add=function(f,w,z,A){if("string"===typeof f&&this._defaultPositionLookup[f]){if(this._find(f))return;f=this._createComponent(f)}k.prototype._add.call(this,f,w,z,A)};y._removeComponents=function(f){f.forEach(w=>{if(w=this._find(w))this.remove(w),w.destroy()})};y._updateViewAwareWidgets=function(f){this.components.forEach(w=>{(w=(w=this._find(w))&&w.widget)&&void 0!==w.view&&(w.view=f)})};y._componentsWatcher=function(f,w){this._removeComponents(w);this._addComponents(f);this._adjustPadding(f)};
y._adjustPadding=function(f){f.includes("attribution")||this._isOverridden("padding")||({top:f}=this.padding,this.padding=f)};y._addComponents=function(f){this.initialized&&f.forEach(w=>this.add(this._createComponent(w),this._defaultPositionLookup[w]))};y._createComponent=function(f){const w=this._createWidget(f);if(w)return new d({id:f,node:w})};y._createWidget=function(f){if("attribution"===f)return this._createAttribution();if("compass"===f)return this._createCompass();if("navigation-toggle"===
f)return this._createNavigationToggle();if("zoom"===f)return this._createZoom()};y._createAttribution=function(){return new g({view:this.view})};y._createCompass=function(){return new p({view:this.view})};y._createNavigationToggle=function(){return new t({view:this.view})};y._createZoom=function(){return new q({view:this.view})};return r}(e);b.__decorate([u.property()],c.prototype,"components",void 0);return c=b.__decorate([h.subclass("esri.views.ui.DefaultUI")],c)})},"esri/views/ui/Component":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/domUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h){c=function(d){function e(){var p=d.apply(this,arguments)||this;p.widget=null;return p}a._inheritsLoose(e,d);var g=e.prototype;g.destroy=function(){this.widget&&this.widget.destroy();this.node=null};g.castNode=function(p){if(!p)return this._set("widget",null),null;if("string"===typeof p||p&&"nodeType"in p)return this._set("widget",null),n.byId(p);p&&"function"===typeof p.render&&!p.domNode&&(p.domNode=document.createElement("div"));this._set("widget",p);return p.domNode};
a._createClass(e,[{key:"id",get:function(){return this.get("widget.id")||this.get("node.id")}},{key:"node",set:function(p){const t=this._get("node");p!==t&&(p&&p.classList.add("esri-component"),t&&t.classList.remove("esri-component"),this._set("node",p))}}]);return e}(c);b.__decorate([l.property({dependsOn:[]})],c.prototype,"id",null);b.__decorate([l.property()],c.prototype,"node",null);b.__decorate([m.cast("node")],c.prototype,"castNode",null);b.__decorate([l.property({readOnly:!0})],c.prototype,
"widget",void 0);return c=b.__decorate([h.subclass("esri.views.ui.Component")],c)})},"esri/views/ui/UI":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/domUtils ../../core/Evented ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/decorators/cast ../../core/accessorSupport/decorators/subclass ../../support/themeUtils ./Component ../../widgets/support/widgetUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){function q(f){const w="object"===typeof f&&null!==f&&Object.getPrototypeOf(f);return null!==w&&w!==Object.prototype||!("component"in f||"index"in f||"position"in f)?null:f}function k(f,{top:w,bottom:z,left:A,right:x}){f.style.top=w;f.style.bottom=z;f.style.left=A;f.style.right=x}const r={left:0,top:0,bottom:0,right:0},y={bottom:30,top:15,right:15,left:15};n=function(f){function w(A){var x=f.call(this,A)||this;x._cornerNameToContainerLookup={};x._positionNameToContainerLookup=
{};x._components=[];x._componentToKey=new Map;x._handles=new l;x.view=null;x._applyViewPadding=()=>{const B=x.container;B&&k(B,x._toPxPosition(x._getViewPadding()))};x._applyUIPadding=()=>{const B=x._innerContainer;B&&k(B,x._toPxPosition(x.padding))};x._initContainers();return x}a._inheritsLoose(w,f);var z=w.prototype;z.initialize=function(){this._handles.add([u.watch(()=>{var A;return[null==(A=this.view)?void 0:A.padding,this.container]},this._applyViewPadding,u.initial),u.watch(()=>this.padding,
this._applyUIPadding,u.initial)])};z.destroy=function(){this.container=null;for(const A of this._components)A.destroy();this._components.length=0;this._handles.destroy();this._componentToKey.clear()};z.castPadding=function(A){return"number"===typeof A?{bottom:A,top:A,right:A,left:A}:{...y,...A}};z.add=function(A,x){let B,C;if(Array.isArray(A))A.forEach(E=>this.add(E,x));else{var D=q(A);D&&({index:B,position:x,component:A,key:C}=D);x&&"object"===typeof x&&({index:B,key:C,position:x}=x);!A||x&&!this._isValidPosition(x)||
this._add(A,x,B,C)}};z.remove=function(A,x){if(A){if(Array.isArray(A))return A.map(D=>this.remove(D,x));var B=this._find(A);if(B){var C=this._componentToKey;if(!C.has(A)||C.get(A)===x)return C=this._components.indexOf(B),B.node.parentNode&&B.node.parentNode.removeChild(B.node),this._componentToKey.delete(A),this._components.splice(C,1)[0]}}};z.empty=function(A){if(Array.isArray(A))return A.map(x=>this.empty(x)).reduce((x,B)=>x.concat(B));A=A||"manual";return"manual"===A?Array.prototype.slice.call(this._manualContainer.children).filter(x=>
!x.classList.contains("esri-ui-corner")).map(x=>this.remove(x)):this._isValidPosition(A)?Array.prototype.slice.call(this._cornerNameToContainerLookup[A].children).map(this.remove,this):null};z.move=function(A,x){Array.isArray(A)&&A.forEach(D=>this.move(D,x));if(A){var B=q(A)||q(x);if(B){var C=B.index;x=B.position;A=B.component||A}(!x||this._isValidPosition(x))&&(A=this.remove(A))&&this.add(A,{position:x,index:C})}};z.find=function(A){return A?(A=this._findById(A))&&(A.widget||A.node):null};z.getPosition=
function(A){for(const x in this._positionNameToContainerLookup)if(this._positionNameToContainerLookup[x].contains(A))return x;return null};z._add=function(A,x,B,C){A instanceof p||(A=new p({node:A}));this._place({component:A,position:x,index:B});this._components.push(A);C&&this._componentToKey.set(A,C)};z._find=function(A){return A?A instanceof p?this._findByComponent(A):"string"===typeof A?this._findById(A):this._findByNode(A.domNode||A):null};z._getViewPadding=function(){return this.get("view.padding")||
r};z._attachContainers=function(A){A.appendChild(this._innerContainer);A.appendChild(this._manualContainer)};z._initContainers=function(){var A=document.createElement("div");A.classList.add("esri-ui-inner-container");A.classList.add("esri-ui-corner-container");const x=document.createElement("div");x.classList.add("esri-ui-inner-container");x.classList.add("esri-ui-manual-container");const B=document.createElement("div");B.classList.add("esri-ui-top-left");B.classList.add("esri-ui-corner");A.appendChild(B);
const C=document.createElement("div");C.classList.add("esri-ui-top-right");C.classList.add("esri-ui-corner");A.appendChild(C);const D=document.createElement("div");D.classList.add("esri-ui-bottom-left");D.classList.add("esri-ui-corner");A.appendChild(D);const E=document.createElement("div");E.classList.add("esri-ui-bottom-right");E.classList.add("esri-ui-corner");A.appendChild(E);this._innerContainer=A;this._manualContainer=x;A=t.isRTL();this._cornerNameToContainerLookup={"top-left":B,"top-right":C,
"bottom-left":D,"bottom-right":E,"top-leading":A?C:B,"top-trailing":A?B:C,"bottom-leading":A?E:D,"bottom-trailing":A?D:E};this._positionNameToContainerLookup={manual:x,...this._cornerNameToContainerLookup}};z._isValidPosition=function(A){return!!this._positionNameToContainerLookup[A]};z._place=function(A){const x=A.component,B=A.index;A=this._positionNameToContainerLookup[A.position||"manual"];var C=-1<B,D=x.widget;D&&!D._started&&"function"===typeof D.postMixInProperties&&"function"===typeof D.buildRendering&&
"function"===typeof D.postCreate&&"function"===typeof D.startup&&x.widget.startup();C?(C=Array.prototype.slice.call(A.children),0===B?A.firstChild?c.insertBefore(x.node,A.firstChild):A.appendChild(x.node):B>=C.length?A.appendChild(x.node):c.insertBefore(x.node,C[B])):A.appendChild(x.node)};z._toPxPosition=function(A){return{top:this._toPxUnit(A.top),left:this._toPxUnit(A.left),right:this._toPxUnit(A.right),bottom:this._toPxUnit(A.bottom)}};z._toPxUnit=function(A){return 0===A?"0":A+"px"};z._findByComponent=
function(A){let x=null,B;this._components.some(C=>{(B=C===A)&&(x=C);return B});return x};z._findById=function(A){let x=null,B;this._components.some(C=>{(B=C.id===A)&&(x=C);return B});return x};z._findByNode=function(A){let x=null,B;this._components.some(C=>{(B=C.node===A)&&(x=C);return B});return x};a._createClass(w,[{key:"container",set:function(A){const x=this._get("container");A!==x&&(A&&(A.classList.add("esri-ui"),g.setCalciteThemeClass(A),this._attachContainers(A)),x&&(x.classList.remove("esri-ui"),
k(x,{top:"",bottom:"",left:"",right:""}),c.empty(x)),this._set("container",A))}},{key:"height",get:function(){const A=this.get("view.height")||0;if(0===A)return A;const x=this._getViewPadding();return Math.max(A-(x.top+x.bottom),0)}},{key:"padding",get:function(){return this._get("padding")},set:function(A){A?this._override("padding",A):this._clearOverride("padding")}},{key:"width",get:function(){const A=this.get("view.width")||0;if(0===A)return A;const x=this._getViewPadding();return Math.max(A-
(x.left+x.right),0)}}]);return w}(n.EventedAccessor);b.__decorate([v.property()],n.prototype,"container",null);b.__decorate([v.property()],n.prototype,"height",null);b.__decorate([v.property({value:y})],n.prototype,"padding",null);b.__decorate([d.cast("padding")],n.prototype,"castPadding",null);b.__decorate([v.property()],n.prototype,"view",void 0);b.__decorate([v.property()],n.prototype,"width",null);return n=b.__decorate([e.subclass("esri.views.ui.UI")],n)})},"esri/widgets/Attribution":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/reactiveUtils ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Attribution/AttributionViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){l=function(k){function r(f,w){var z=k.call(this,f,w)||this;z._isOpen=!1;z._attributionTextOverflowed=!1;z._prevSourceNodeHeight=0;z._resizeObserver=new ResizeObserver(A=>A.forEach(({target:x})=>z._checkSourceTextOverflow(x)));z.iconClass="esri-icon-description";z.itemDelimiter=" | ";z.label=void 0;z.messages=null;z.view=null;z.viewModel=new e;return z}a._inheritsLoose(r,k);var y=r.prototype;y.initialize=function(){this.own(c.on(()=>{var f;return null==(f=this.viewModel)?
void 0:f.items},"change",()=>this.scheduleRender()))};y.destroy=function(){var f;null==(f=this._resizeObserver)?void 0:f.disconnect()};y.render=function(){return t.tsx("div",{bind:this,class:this.classes("esri-attribution esri-widget",{["esri-attribution--open"]:this._isOpen}),dir:"ltr",onclick:this._toggleState,onkeydown:this._toggleState},this.renderSourcesNode(),this.renderPoweredBy())};y.renderPoweredBy=function(){return t.tsx("div",{class:"esri-attribution__powered-by"},"Powered by"," ",t.tsx("a",
{class:"esri-attribution__link",href:"http://www.esri.com/",target:"_blank",rel:"noreferrer"},"Esri"))};y.renderSourcesNode=function(){const f=this._isOpen,w=this._isInteractive,z=w?"0":"",{attributionText:A}=this;return t.tsx("div",{afterCreate:this._afterSourcesNodeCreate,bind:this,class:this.classes("esri-attribution__sources",{["esri-attribution__sources--open"]:f,["esri-interactive"]:w}),innerHTML:A,tabindex:z})};y._afterSourcesNodeCreate=function(f){this._prevSourceNodeHeight=f.clientWidth;
this._resizeObserver.observe(f)};y._checkSourceTextOverflow=function(f){let w=!1;const {clientHeight:z,clientWidth:A,scrollWidth:x}=f;f=x>A;const B=this._attributionTextOverflowed!==f;this._attributionTextOverflowed=f;B&&(w=!0);this._isOpen&&(f=z<this._prevSourceNodeHeight,this._prevSourceNodeHeight=z,f&&(this._isOpen=!1,w=!0));w&&this.scheduleRender()};y._toggleState=function(){this._isInteractive&&(this._isOpen=!this._isOpen)};a._createClass(r,[{key:"_isInteractive",get:function(){return this._isOpen||
this._attributionTextOverflowed}},{key:"attributionText",get:function(){return this.viewModel.items.reduce((f,w)=>{f.includes(w.text)||f.push(w.text);return f},[]).join(this.itemDelimiter)}}]);return r}(d);b.__decorate([m.property()],l.prototype,"_isOpen",void 0);b.__decorate([m.property()],l.prototype,"_isInteractive",null);b.__decorate([m.property()],l.prototype,"_attributionTextOverflowed",void 0);b.__decorate([m.property()],l.prototype,"_prevSourceNodeHeight",void 0);b.__decorate([m.property({readOnly:!0,
dependsOn:["viewModel.items.length","itemDelimiter"]})],l.prototype,"attributionText",null);b.__decorate([m.property()],l.prototype,"iconClass",void 0);b.__decorate([m.property()],l.prototype,"itemDelimiter",void 0);b.__decorate([m.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],l.prototype,"label",void 0);b.__decorate([m.property(),p.messageBundle("esri/widgets/Attribution/t9n/Attribution")],l.prototype,"messages",void 0);b.__decorate([n.aliasOf("viewModel.view")],l.prototype,
"view",void 0);b.__decorate([m.property({type:e})],l.prototype,"viewModel",void 0);b.__decorate([g.accessibleHandler()],l.prototype,"_toggleState",null);return l=b.__decorate([h.subclass("esri.widgets.Attribution")],l)})},"esri/widgets/Attribution/AttributionViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../geometry ../../core/asyncUtils ../../core/Collection ../../core/HandleOwner ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../../geometry/support/contains ../../geometry/support/webMercatorUtils ../../geometry/SpatialReference".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){function k(w,z){return w&&"copyright"in w&&(!z||"function"===typeof w.originOf&&"user"===w.originOf("copyright"))}function r(w,z){return w.length!==z.length||w.some((A,x)=>A.text!==z[x].text)}function y(w,z,A){A&&z&&(w.find(x=>x.layerView===z&&x.text===A)||w.push({text:A,layerView:z}))}const f=[];c=function(w){function z(x){var B=w.call(this,x)||this;B._clear=()=>{B._fetchedAttributionData.clear();B._pendingAttributions.clear();B.handles.remove("suspension");
B.notifyChange("state")};B._pendingAttributions=new Set;B._fetchedAttributionData=new Map;B.items=new l;B.view=null;B._allLayerViewsChange=C=>{B.handles.remove("suspension");const D=B.get("view.allLayerViews");D&&B.handles.add(D.map(E=>v.watch(()=>{var F;return[E.suspended,null==(F=E.layer)?void 0:F.attributionVisible]},()=>B._updateAttributionItems())),"suspension");C&&C.removed&&C.removed.forEach(E=>{B._pendingAttributions.delete(E);B._fetchedAttributionData.delete(E)});B._updateAttributionItems()};
B.handles.add([v.on(()=>{var C;return null==(C=B.view)?void 0:C.allLayerViews},"change",C=>B._allLayerViewsChange(C),{onListenerAdd:()=>B._allLayerViewsChange(),onListenerRemove:B._clear}),v.when(()=>{var C;return!0===(null==(C=B.view)?void 0:C.stationary)},()=>B._updateAttributionItems())]);return B}a._inheritsLoose(z,w);var A=z.prototype;A.destroy=function(){this.view=null;this._fetchedAttributionData.clear();this._pendingAttributions.clear();this.items.removeAll()};A._updateAttributionItems=function(){const x=
this.get("view.allLayerViews");f.length=0;x?(x.forEach(B=>{var C;if(!B.suspended&&null!=(C=B.layer)&&C.attributionVisible)if(C=B.layer,k(C,"user"))y(f,B,C.copyright);else if(C.hasAttributionData)if(this._fetchedAttributionData.has(B)){var D=this._fetchedAttributionData.get(B);D?y(f,B,this._getDynamicAttribution(D,this.view,C)):k(C)&&y(f,B,C.copyright)}else this._fetchAttributionData(B);else(D=C.get("portalItem.accessInformation"))?y(f,B,D):y(f,B,C.copyright)}),r(this.items,f)&&(this.items.removeAll(),
this.items.addMany(f)),f.length=0,this.notifyChange("state")):this._clear()};A._fetchAttributionData=function(){var x=a._asyncToGenerator(function*(B){if(!this._pendingAttributions.has(B)){this._pendingAttributions.add(B);var C=yield n.result(B.layer.fetchAttributionData());this._pendingAttributions.has(B)&&(C=C.ok?this._createContributionIndex(C.value,"bing-maps"===B.layer.type):null,this._pendingAttributions.delete(B),this._fetchedAttributionData.set(B,C));this._updateAttributionItems()}});return function(B){return x.apply(this,
arguments)}}();A._createContributionIndex=function(x,B){x=x.contributors;const C={};if(!x)return C;for(let G=0;G<x.length;G++){const O=x[G];var D=O.coverageAreas;if(!D)return;for(const K of D){var E=K.bbox,F=K.zoomMin-(B&&K.zoomMin?1:0);D=K.zoomMax-(B&&K.zoomMax?1:0);for(E={extent:t.geographicToWebMercator({xmin:E[1],ymin:E[0],xmax:E[3],ymax:E[2],spatialReference:q.WGS84}),attribution:O.attribution||"",score:null!=K.score?K.score:100,id:G};F<=D;F++)C[F]=C[F]||[],C[F].push(E)}}C.maxKey=Math.max.apply(null,
Object.keys(C));return C};A._getDynamicAttribution=function(x,B,C){const {extent:D,scale:E}=B;C=C.tileInfo.scaleToZoom(E);C=Math.min(x.maxKey,Math.round(C));if(!D||null==C||-1>=C)return"";x=x[C];const F=t.project(D.center.clone().normalize(),B.spatialReference),G={};return x?x.filter(O=>{const K=!G[O.id]&&F&&p.extentContainsPoint(O.extent,F);K&&(G[O.id]=!0);return K}).sort((O,K)=>K.score-O.score||O.objectId-K.objectId).map(O=>O.attribution).join(", "):""};a._createClass(z,[{key:"state",get:function(){return this.get("view.ready")?
0<this._pendingAttributions.size?"loading":"ready":"disabled"}}]);return z}(u.HandleOwner);b.__decorate([m.property({readOnly:!0,type:l})],c.prototype,"items",void 0);b.__decorate([m.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([m.property()],c.prototype,"view",void 0);return c=b.__decorate([g.subclass("esri.widgets.Attribution.AttributionViewModel")],c)})},"esri/widgets/Compass":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./Compass/CompassViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){n=function(q){function k(y,f){y=q.call(this,y,f)||this;y.goToOverride=null;y.iconClass="esri-icon-locate-circled";y.label=void 0;y.messages=null;y.view=null;y.viewModel=new d;return y}a._inheritsLoose(k,q);var r=k.prototype;r.reset=function(){return this.viewModel.reset()};r.render=function(){const {orientation:y,state:f}=this.viewModel;var w="disabled"===f,z="compass"===("rotation"===f?"rotation":"compass");const A=w?-1:0;w={["esri-disabled"]:w,["esri-interactive"]:!w};
z={["esri-icon-compass"]:z,["esri-icon-dial"]:!z};const {messages:x}=this;return p.tsx("div",{bind:this,class:this.classes("esri-compass esri-widget--button esri-widget",w),onclick:this._reset,onkeydown:this._reset,role:"button",tabIndex:A,"aria-label":x.reset,title:x.reset},p.tsx("span",{"aria-hidden":"true",class:this.classes("esri-compass__icon",z),styles:this._toRotationTransform(y)}),p.tsx("span",{class:"esri-icon-font-fallback-text"},x.reset))};r._reset=function(){this.viewModel.reset()};r._toRotationTransform=
function(y){return{transform:`rotateZ(${y.z}deg)`}};return k}(h);b.__decorate([c.aliasOf("viewModel.goToOverride")],n.prototype,"goToOverride",void 0);b.__decorate([v.property()],n.prototype,"iconClass",void 0);b.__decorate([v.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],n.prototype,"label",void 0);b.__decorate([v.property(),g.messageBundle("esri/widgets/Compass/t9n/Compass")],n.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],n.prototype,"view",void 0);
b.__decorate([v.property({type:d})],n.prototype,"viewModel",void 0);b.__decorate([e.accessibleHandler()],n.prototype,"_reset",null);return n=b.__decorate([m.subclass("esri.widgets.Compass")],n)})},"esri/widgets/Compass/CompassViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/maybe ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../support/GoTo".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){c=function(p){function t(k){k=p.call(this,k)||this;k._handles=new n;k.orientation={x:0,y:0,z:0};k.view=null;k._updateForCamera=k._updateForCamera.bind(a._assertThisInitialized(k));k._updateForRotation=k._updateForRotation.bind(a._assertThisInitialized(k));k._updateRotationWatcher=k._updateRotationWatcher.bind(a._assertThisInitialized(k));return k}a._inheritsLoose(t,p);var q=t.prototype;q.initialize=function(){this._handles.add(u.watch(()=>this.view,this._updateRotationWatcher,
u.initial))};q.destroy=function(){this._handles=l.removeMaybe(this._handles);this.view=null};q.reset=function(){if(this.get("view.ready")){var k={};"2d"===this.view.type?k.rotation=0:k.heading=0;this.callGoTo({target:k})}};q._updateForRotation=function(k){void 0!==k&&null!==k&&(this.orientation={z:k})};q._updateForCamera=function(k){k&&(this.orientation={x:0,y:0,z:-k.heading})};q._updateRotationWatcher=function(k){this._handles.removeAll();k&&this._handles.add("2d"===k.type?u.watch(()=>null==k?void 0:
k.rotation,this._updateForRotation,u.initial):u.watch(()=>null==k?void 0:k.camera,this._updateForCamera,u.initial))};a._createClass(t,[{key:"canShowNorth",get:function(){const k=this.get("view.spatialReference");return!(!k||!k.isWebMercator&&!k.isGeographic)}},{key:"state",get:function(){return this.get("view.ready")?this.canShowNorth?"compass":"rotation":"disabled"}}]);return t}(g.GoToMixin(c));b.__decorate([v.property({readOnly:!0})],c.prototype,"canShowNorth",null);b.__decorate([v.property()],
c.prototype,"orientation",void 0);b.__decorate([v.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([v.property()],c.prototype,"view",void 0);return c=b.__decorate([e.subclass("esri.widgets.CompassViewModel")],c)})},"esri/widgets/NavigationToggle":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./NavigationToggle/NavigationToggleViewModel ./support/decorators/accessibleHandler ./support/decorators/messageBundle ./support/jsxFactory ./support/widgetUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){n=function(q){function k(y,f){y=q.call(this,y,f)||this;y.iconClass="esri-icon-pan2";y.label=void 0;y.messages=null;y.view=null;y.viewModel=new d;return y}a._inheritsLoose(k,q);var r=k.prototype;r.toggle=function(){return this.viewModel.toggle()};r.render=function(){const y="disabled"===this.get("viewModel.state");var f="pan"===this.get("viewModel.navigationMode");const w={["esri-navigation-toggle__button--active"]:f};f={["esri-navigation-toggle__button--active"]:!f};
const z=y?-1:0,A=this.messages.toggle;return p.tsx("div",{bind:this,class:this.classes("esri-navigation-toggle esri-widget",{["esri-disabled"]:y,["esri-navigation-toggle--horizontal"]:"horizontal"===this.layout}),onclick:this._toggle,onkeydown:this._toggle,tabIndex:z,"aria-label":A,title:A},p.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button","esri-navigation-toggle__button--pan",w)},p.tsx("span",{class:"esri-icon-pan"})),p.tsx("div",{class:this.classes("esri-navigation-toggle__button esri-widget--button",
"esri-navigation-toggle__button--rotate",f)},p.tsx("span",{class:"esri-icon-rotate"})))};r._toggle=function(){this.toggle()};a._createClass(k,[{key:"layout",set:function(y){"horizontal"!==y&&(y="vertical");this._set("layout",y)}}]);return k}(h);b.__decorate([v.property()],n.prototype,"iconClass",void 0);b.__decorate([v.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],n.prototype,"label",void 0);b.__decorate([v.property({value:"vertical"})],n.prototype,"layout",null);b.__decorate([v.property(),
g.messageBundle("esri/widgets/NavigationToggle/t9n/NavigationToggle")],n.prototype,"messages",void 0);b.__decorate([c.aliasOf("viewModel.view")],n.prototype,"view",void 0);b.__decorate([v.property({type:d})],n.prototype,"viewModel",void 0);b.__decorate([e.accessibleHandler()],n.prototype,"_toggle",null);return n=b.__decorate([m.subclass("esri.widgets.NavigationToggle")],n)})},"esri/widgets/NavigationToggle/NavigationToggleViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/Handles ../../core/reactiveUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m,h,d){c=function(e){function g(t){t=e.call(this,t)||this;t._handles=new n;t.navigationMode="pan";t.view=null;return t}a._inheritsLoose(g,e);var p=g.prototype;p.initialize=function(){this._handles.add(l.when(()=>{var t;return null==(t=this.view)?void 0:t.inputManager},()=>this._setNavigationMode()))};p.destroy=function(){this._handles.destroy();this.view=this._handles=null};p.toggle=function(){"disabled"!==this.state&&(this.navigationMode="pan"!==this.navigationMode?"pan":"rotate",
this._setNavigationMode())};p._setNavigationMode=function(){this.get("view.inputManager").primaryDragAction="pan"===this.navigationMode?"pan":"rotate"};a._createClass(g,[{key:"state",get:function(){return this.get("view.ready")&&"3d"===this.view.type?"ready":"disabled"}}]);return g}(c);b.__decorate([u.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([u.property()],c.prototype,"navigationMode",void 0);b.__decorate([u.property()],c.prototype,"view",void 0);return c=b.__decorate([d.subclass("esri.widgets.NavigationToggleViewModel")],
c)})},"esri/widgets/Zoom":function(){define("../chunks/_rollupPluginBabelHelpers ../chunks/tslib.es6 ../core/accessorSupport/decorators/aliasOf ../core/arrayUtils ../core/has ../core/accessorSupport/ensureType ../core/accessorSupport/decorators/property ../core/accessorSupport/decorators/subclass ./Widget ./support/widgetUtils ./support/decorators/messageBundle ./support/jsxFactory ./Zoom/IconButton ./Zoom/ZoomViewModel".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){n=function(q){function k(y,
f){y=q.call(this,y,f)||this;y.iconClass="esri-icon-zoom-in-magnifying-glass";y.label=void 0;y.messages=null;y.view=null;y.viewModel=new t;return y}a._inheritsLoose(k,q);var r=k.prototype;r.initialize=function(){this._zoomInButton=new p({action:this.zoomIn.bind(this),iconClass:"esri-icon-plus"});this._zoomOutButton=new p({action:this.zoomOut.bind(this),iconClass:"esri-icon-minus"})};r.destroy=function(){this._zoomInButton.destroy();this._zoomOutButton.destroy();this._zoomOutButton=this._zoomInButton=
null};r.render=function(){const y=this.viewModel,f={["esri-zoom--horizontal"]:"horizontal"===this.layout};this._zoomInButton.enabled="ready"===y.state&&y.canZoomIn;this._zoomOutButton.enabled="ready"===y.state&&y.canZoomOut;this._zoomInButton.title=this.messages.zoomIn;this._zoomOutButton.title=this.messages.zoomOut;return g.tsx("div",{class:this.classes("esri-zoom esri-widget",f)},this._zoomInButton.render(),this._zoomOutButton.render())};r.zoomIn=function(){return this.viewModel.zoomIn()};r.zoomOut=
function(){return this.viewModel.zoomOut()};a._createClass(k,[{key:"layout",set:function(y){"horizontal"!==y&&(y="vertical");this._set("layout",y)}}]);return k}(h);b.__decorate([v.property()],n.prototype,"iconClass",void 0);b.__decorate([v.property({aliasOf:{source:"messages.widgetLabel",overridable:!0}})],n.prototype,"label",void 0);b.__decorate([v.property({value:"vertical"})],n.prototype,"layout",null);b.__decorate([v.property(),e.messageBundle("esri/widgets/Zoom/t9n/Zoom")],n.prototype,"messages",
void 0);b.__decorate([c.aliasOf("viewModel.view")],n.prototype,"view",void 0);b.__decorate([v.property({type:t})],n.prototype,"viewModel",void 0);return n=b.__decorate([m.subclass("esri.widgets.Zoom")],n)})},"esri/widgets/Zoom/IconButton":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ../Widget ../support/decorators/accessibleHandler ../support/jsxFactory ../support/widgetUtils".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){n=function(g){function p(){var q=g.apply(this,arguments)||this;q.enabled=!0;q.iconClass="";q.title="";return q}a._inheritsLoose(p,g);var t=p.prototype;t.render=function(){const q=this.enabled?0:-1,k={[this.iconClass]:!!this.iconClass};return d.tsx("div",{bind:this,class:this.classes("esri-widget--button esri-widget",{["esri-disabled"]:!this.enabled,["esri-interactive"]:this.enabled}),onclick:this._triggerAction,onkeydown:this._triggerAction,role:"button",tabIndex:q,
title:this.title},d.tsx("span",{"aria-hidden":"true",role:"presentation",class:this.classes("esri-icon",k)}),d.tsx("span",{class:"esri-icon-font-fallback-text"},this.title))};t._triggerAction=function(){this.action.call(this)};return p}(m);b.__decorate([c.property()],n.prototype,"action",void 0);b.__decorate([c.property()],n.prototype,"enabled",void 0);b.__decorate([c.property()],n.prototype,"iconClass",void 0);b.__decorate([c.property()],n.prototype,"title",void 0);b.__decorate([h.accessibleHandler()],
n.prototype,"_triggerAction",null);return n=b.__decorate([v.subclass("esri.widgets.IconButton")],n)})},"esri/widgets/Zoom/ZoomViewModel":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/promiseUtils ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass ./ZoomConditions2D ./ZoomConditions3D".split(" "),function(a,b,c,n,l,u,
v,m,h,d,e){c=function(g){function p(q){q=g.call(this,q)||this;q.canZoomIn=!1;q.canZoomOut=!1;return q}a._inheritsLoose(p,g);var t=p.prototype;t.destroy=function(){this.view=null};t.zoomIn=function(){if(this.canZoomIn){var q=this.view;"2d"===q.type?q.mapViewNavigation.zoomIn():n.ignoreAbortErrors(q.goTo({zoomFactor:2}))}};t.zoomOut=function(){if(this.canZoomOut){var q=this.view;"2d"===q.type?q.mapViewNavigation.zoomOut():n.ignoreAbortErrors(q.goTo({zoomFactor:.5}))}};a._createClass(p,[{key:"state",
get:function(){return this.get("view.ready")?"ready":"disabled"}},{key:"view",set:function(q){q?"2d"===q.type?this._zoomConditions=new d({view:q}):"3d"===q.type&&(this._zoomConditions=new e({view:q})):this._zoomConditions=null;this._set("view",q)}}]);return p}(c);b.__decorate([l.property()],c.prototype,"_zoomConditions",void 0);b.__decorate([l.property({aliasOf:"_zoomConditions.canZoomIn",readOnly:!0})],c.prototype,"canZoomIn",void 0);b.__decorate([l.property({aliasOf:"_zoomConditions.canZoomOut",
readOnly:!0})],c.prototype,"canZoomOut",void 0);b.__decorate([l.property({readOnly:!0})],c.prototype,"state",null);b.__decorate([l.property()],c.prototype,"view",null);return c=b.__decorate([h.subclass("esri.widgets.Zoom.ZoomViewModel")],c)})},"esri/widgets/Zoom/ZoomConditions2D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){c=function(h){function d(){return h.apply(this,arguments)||this}a._inheritsLoose(d,h);a._createClass(d,[{key:"canZoomIn",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),g=this.get("view.constraints.effectiveMaxScale");return 0===g||e>g}},{key:"canZoomOut",get:function(){if(!this.get("view.ready"))return!1;const e=this.get("view.animation.target.scale")||this.get("view.scale"),g=this.get("view.constraints.effectiveMinScale");
return 0===g||e<g}}]);return d}(c);b.__decorate([n.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([n.property()],c.prototype,"view",void 0);return c=b.__decorate([m.subclass("esri.widgets.Zoom.ZoomConditions2D")],c)})},"esri/widgets/Zoom/ZoomConditions3D":function(){define("../../chunks/_rollupPluginBabelHelpers ../../chunks/tslib.es6 ../../core/Accessor ../../core/accessorSupport/decorators/property ../../core/arrayUtils ../../core/has ../../core/accessorSupport/ensureType ../../core/accessorSupport/decorators/subclass".split(" "),
function(a,b,c,n,l,u,v,m){c=function(h){function d(){return h.apply(this,arguments)||this}a._inheritsLoose(d,h);a._createClass(d,[{key:"canZoomIn",get:function(){return!!this.get("view.ready")}},{key:"canZoomOut",get:function(){return!!this.get("view.ready")}}]);return d}(c);b.__decorate([n.property({readOnly:!0})],c.prototype,"canZoomIn",null);b.__decorate([n.property({readOnly:!0})],c.prototype,"canZoomOut",null);b.__decorate([n.property()],c.prototype,"view",void 0);return c=b.__decorate([m.subclass("esri.widgets.Zoom.ZoomConditions3D")],
c)})},"jimu/DataManager":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./WidgetManager"],function(a,b,c,n){var l=null;var u=a(null,{constructor:function(){c.subscribe("publishData",b.hitch(this,this.onDataPublished));c.subscribe("fetchData",b.hitch(this,this.onFetchData));c.subscribe("clearAllData",b.hitch(this,this.onClearAllData));c.subscribe("removeData",b.hitch(this,this.onRemoveData));c.subscribe("clearDataHistory",b.hitch(this,this.onClearDataHistory));this.widgetManager=
n.getInstance()},_dataStore:{},onDataPublished:function(v,m,h,d){"undefined"===typeof d&&(d=!1);this._dataStore[m]?(this._dataStore[m].current=h,d&&(this._dataStore[m].history?this._dataStore[m].history.push(h):this._dataStore[m].history=[h])):(this._dataStore[m]={current:h},d&&(this._dataStore[m].history=[h]))},onFetchData:function(v){var m;if(v)"framework"===v?this._dataStore[v]?c.publish("dataFetched","framework","framework",this._dataStore[v].current,this._dataStore[v].history):c.publish("noData",
"framework","framework"):(m=this.widgetManager.getWidgetById(v))?this._dataStore[v]?c.publish("dataFetched",m.name,v,this._dataStore[v].current,this._dataStore[v].history):c.publish("noData",m.name,v):c.publish("noData",void 0,v);else for(var h in this._dataStore)(m=this.widgetManager.getWidgetById(h))&&c.publish("dataFetched",m.name,h,this._dataStore[h].current,this._dataStore[h].history)},onClearAllData:function(){this._dataStore={};c.publish("allDataCleared")},onRemoveData:function(v){delete this._dataStore[v];
c.publish("dataRemoved",v)},onClearDataHistory:function(v){this._dataStore[v]&&(this._dataStore[v].history=[]);c.publish("dataHistoryCleared",v)}});u.getInstance=function(){null===l&&(l=new u);return l};return u})},"jimu/BaseWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/topic dijit/_WidgetBase dijit/_TemplatedMixin jimu/utils ./PanelManager".split(" "),function(a,b,c,n,l,u,v,m,h){return a([u,v],{type:"widget",id:void 0,label:void 0,icon:void 0,
uri:void 0,position:{},config:void 0,openAtStart:!1,sceneView:null,appConfig:null,folderUrl:null,state:"closed",windowState:"normal",started:!1,name:"",baseClass:null,templateString:"\x3cdiv\x3e\x3c/div\x3e",moveTopOnActive:!0,constructor:function(){this.listenWidgetNames=[];this.listenWidgetIds=[];this.own(l.subscribe("publishData",b.hitch(this,this._onReceiveData)));this.own(l.subscribe("dataFetched",b.hitch(this,this._onReceiveData)));this.own(l.subscribe("noData",b.hitch(this,this._onNoData)))},
startup:function(){this.inherited(arguments);this.started=!0},onOpen:function(){},onClose:function(){},onNormalize:function(){},onMinimize:function(){},onMaximize:function(){},onActive:function(){},onDeActive:function(){},onSignIn:function(d){},onSignOut:function(){},onPositionChange:function(d){this.setPosition(d)},setPosition:function(d,e){this.position=d;var g=m.getPositionStyle(this.position);g.position="absolute";e||(e="map"===d.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);n.place(this.domNode,
e);n.setStyle(this.domNode,g);this.started&&this.resize()},getPosition:function(){return this.position},getMarginBox:function(){return n.getMarginBox(this.domNode)},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){},onConfigChanged:function(d){},onAppConfigChanged:function(d,e,g){},onAction:function(d,e){},getPanel:function(){if(!1===this.inPanel)return null;if("widgetOnScreen"===this.gid||"widgetPool"===this.gid)return h.getInstance().getPanelById(this.id+
"_panel");var d=h.getInstance().getPanelById(this.gid+"_panel");return d?d:h.getInstance().getPanelById(this.id+"_panel")},publishData:function(d,e){"undefined"===typeof e&&(e=!1);l.publish("publishData",this.name,this.id,d,e)},fetchData:function(d){d?l.publish("fetchData",d):0!==this.listenWidgetIds.length?c.forEach(this.listenWidgetIds,function(e){l.publish("fetchData",e)},this):l.publish("fetchData")},fetchDataByName:function(d){d=this.widgetManager.getWidgetsByName(d);c.forEach(d,function(e){this.fetchData(e.id)},
this)},openWidgetById:function(d){return this.widgetManager.triggerWidgetOpen(d)},_onReceiveData:function(d,e,g,p){if(e!==this.id&&!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onReceiveData(d,e,g,p)},onReceiveData:function(d,e,g,p){},_onNoData:function(d,e){if(!(0!==this.listenWidgetIds.length&&0>this.listenWidgetIds.indexOf(e)))this.onNoData(d,e)},onNoData:function(d,e){}})})},"jimu/PanelManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dojo/_base/fx dojo/Deferred dojo/promise/all dojo/on dojo/topic dojo/when require ./utils ./WidgetManager".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){var t=null;var q=a(null,{constructor:function(){this.panels=[];this.widgetManager=p.getInstance();m(window,"resize",b.hitch(this,this.onWindowResize));this.activePanel=null;h.subscribe("/dnd/move/start",b.hitch(this,this._onMoveStart));h.subscribe("widgetActived",b.hitch(this,this._onWidgetActived))},showPanel:function(k){var r=new u,y=this.getPanelById(k.id+"_panel");y?("closed"===y.state&&this.openPanel(y),r.resolve(y)):v({Panel:this._loadPanelClass(k.panel.uri),
nls:this._loadThemeI18N(k.panel.uri)}).then(b.hitch(this,function(f){var w=k.id+"_panel",z=this.getPanelById(w),A={label:k.label,config:k,uri:k.panel.uri,position:k.panel.position,sceneView:this.sceneView,widgetManager:this.widgetManager,panelManager:this,id:w,gid:k.gid,nls:f.nls};b.mixin(A,k.panel.options);try{z=new f.Panel(A),console.log("panel ["+w+"] created.")}catch(x){console.log("create panel error: "+x+", panelId: "+w);r.reject(x);return}z.setPosition(k.panel.position);g.setVerticalCenter(z.domNode);
this.openPanel(z);this.panels.push(z);m(z.domNode,"click",b.hitch(this,this._onPanelClick,z));r.resolve(z)}));return r},setSceneView:function(k){this.sceneView=k;m(this.sceneView,"resize",b.hitch(this,this.onMapResize))},closeOtherPanelsInTheSameGroup:function(k){if("string"===typeof k&&(k=this.getPanelById(k),!k))return;for(var r=0;r<this.panels.length;r++)this.panels[r].gid===k.gid&&this.panels[r].id!==k.id&&this.closePanel(this.panels[r])},closeAllPanelsInGroup:function(k){for(var r=0;r<this.panels.length;r++)this.panels[r].gid===
k&&this.closePanel(this.panels[r])},openPanel:function(k){var r=new u;if("string"===typeof k&&(k=this.getPanelById(k),!k))return r.reject(),r;if(!k.started)try{k.started=!0,k.startup()}catch(y){console.error("fail to startup panel "+k.id+". "+y.stack)}if("opened"===k.state)return r.resolve(k),r;k.setState("opened");return this.playOpenPanelAnimation(k).then(b.hitch(this,function(){n.setStyle(k.domNode,"display","");k.onOpen();this._activePanel(k);return k}))},closePanel:function(k){var r=new u;return"string"===
typeof k&&(k=this.getPanelById(k),!k)||"closed"===k.state?(r.resolve(),r):this.playClosePanelAnimation(k).then(function(){this.activePanel&&this.activePanel.id===k.id&&(this.activePanel.onDeActive(),this.activePanel=null);k.setState("closed");k.onClose();k.domNode&&n.setStyle(k.domNode,"display","none")})},minimizePanel:function(k){if("string"===typeof k&&(k=this.getPanelById(k),!k))return;"closed"===k.state&&this.openPanel(k);k.setWindowState("minimized");try{k.onMinimize()}catch(r){console.log(console.error("fail to minimize panel "+
k.id+". "+r.stack))}},maximizePanel:function(k){if("string"===typeof k&&(k=this.getPanelById(k),!k))return;"closed"===k.state&&this.openPanel(k);k.setWindowState("maximized");try{k.onMaximize()}catch(r){console.log(console.error("fail to maximize panel "+k.id+". "+r.stack))}},normalizePanel:function(k){if("string"===typeof k&&(k=this.getPanelById(k),!k))return;"closed"===k.state&&this.openPanel(k);k.setWindowState("normal");try{k.onNormalize()}catch(r){console.log(console.error("fail to noralize panel "+
k.id+". "+r.stack))}},changeWindowStateTo:function(k,r){if("string"===typeof k&&(k=this.getPanelById(k),!k))return;"normal"===r?this.normalizePanel(k):"minimized"===r?this.minimizePanel(k):"maximized"===r?this.maximizePanel(k):console.log("error state: "+r)},getPanelById:function(k){for(var r=0;r<this.panels.length;r++)if(this.panels[r].id===k)return this.panels[r]},onWindowResize:function(){for(var k=0;k<this.panels.length;k++)"closed"!==this.panels[k].state&&"map"!==this.panels[k].position.relativeTo&&
this.panels[k].resize()},onMapResize:function(){for(var k=0;k<this.panels.length;k++)"closed"!==this.panels[k].state&&"map"===this.panels[k].position.relativeTo&&this.panels[k].resize()},destroyPanel:function(k){if("string"===typeof k&&(k=this.getPanelById(k),!k))return;if(k.domNode){"closed"!==k.state&&this.closePanel(k);this._removePanel(k);try{k.destroy()}catch(r){console.log(console.error("fail to destroy panel "+k.id+". "+r.stack))}}},destroyAllPanels:function(){var k=c.map(this.panels,function(r){return r.id});
c.forEach(k,function(r){this.destroyPanel(r)},this);this.panels=[]},playOpenPanelAnimation:function(k){if("string"===typeof k&&(k=this.getPanelById(k),!k)||!k.openAnimation||0===k.animationDuration)return d();var r=new u;"string"===typeof k.openAnimation?"fadeIn"===k.openAnimation?(n.setStyle(k.domNode,{opacity:0,display:""}),l.fadeIn({node:k.domNode,duration:k.animationDuration,onEnd:function(){r.resolve()}}).play()):r.resolve():r.resolve();return r},playClosePanelAnimation:function(k){if("string"===
typeof k&&(k=this.getPanelById(k),!k)||!k.closeAnimation||0===k.animationDuration)return d();var r=new u;"string"===typeof k.closeAnimation&&("fadeOut"===k.closeAnimation?l.fadeOut({node:k.domNode,duration:k.animationDuration,onEnd:function(){r.resolve()}}).play():r.resolve());return r},getPositionOnMobile:function(k){if("string"===typeof k&&(k=this.getPanelById(k),!k))return{};var r=n.getMarginBox(window.jimuConfig.layoutId),y=r.h/2;k.titleHeight||(k.titleHeight=35);return"maximized"===k.windowState?
{left:0,right:0,top:0,bottom:0,width:"auto",height:"auto",contentHeight:r.h-k.titleHeight,borderRadiusStyle:{borderTopLeftRadius:0,borderTopRightRadius:0,borderBottomLeftRadius:0,borderBottomRightRadius:0}}:"minimized"===k.windowState?r.h>r.w?{left:0,right:0,top:"auto",bottom:0,width:"auto",height:k.titleHeight,contentHeight:0,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:{left:r.w-r.w/2,right:0,top:"auto",bottom:0,width:r.w/
2,height:k.titleHeight,contentHeight:r.h,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}:r.h>r.w?{left:0,right:0,top:y,bottom:0,width:"auto",height:"auto",contentHeight:r.h-y-k.titleHeight,borderRadiusStyle:{borderTopLeftRadius:"4px",borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:0}}:
{left:r.w-r.w/2,right:0,top:0,bottom:0,width:r.w/2,height:"auto",contentHeight:r.h-y-k.titleHeight,borderRadiusStyle:window.isRTL?{borderTopLeftRadius:0,borderTopRightRadius:"4px",borderBottomLeftRadius:0,borderBottomRightRadius:"4px"}:{borderTopLeftRadius:"4px",borderTopRightRadius:0,borderBottomLeftRadius:"4px",borderBottomRightRadius:0}}},_onPanelClick:function(k){this._activePanel(k)},_activePanel:function(k){if(this.activePanel){if(this.activePanel.id===k.id){this.activePanel.moveTopOnActive&&
n.setStyle(this.activePanel.domNode,"zIndex",101);return}"active"===this.activePanel.state&&(this.activePanel.setState("opened"),n.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive())}var r=this.widgetManager.activeWidget;r&&"active"===r.state&&r.getPanel()!==k&&(r.setState("opened"),!1===r.inPanel&&n.setStyle(r.domNode,"zIndex","undefined"!==typeof r.position.zIndex?r.position.zIndex:
"auto"),r.onDeActive(),this.widgetManager.activeWidget=null);this.activePanel=k;"active"!==this.activePanel.state&&(this.activePanel.setState("active"),this.activePanel.moveTopOnActive&&n.setStyle(this.activePanel.domNode,"zIndex",101),this.activePanel.onActive())},_removePanel:function(k){var r=this.panels.indexOf(k);-1<r&&this.panels.splice(r,1);this.activePanel&&this.activePanel.id===k.id&&(this.activePanel=null)},_onMoveStart:function(k){c.forEach(this.panels,function(r){r.domNode===k.node&&this._activePanel(r)},
this)},_onWidgetActived:function(k){this.activePanel&&"active"===this.activePanel.state&&k.getPanel()!==this.activePanel&&(this.activePanel.setState("opened"),n.setStyle(this.activePanel.domNode,"zIndex","undefined"!==typeof this.activePanel.position.zIndex?this.activePanel.position.zIndex:"auto"),this.activePanel.onDeActive(),this.activePanel=null)},_loadPanelClass:function(k){var r=new u;e([k],function(y){r.resolve(y)});return r},_loadThemeI18N:function(k){var r=new u;k.startWith("themes")?(k=k.split("/"),
e(["dojo/i18n!"+(k[0]+"/"+k[1]+"/nls/strings")],function(y){r.resolve(y)})):r.resolve({});return r}});q.getInstance=function(){null===t&&(t=new q,window._panelManager=t);return t};return q})},"jimu/BaseWidgetFrame":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/html","dijit/_WidgetBase"],function(a,b,c,n){return a([n],{widget:null,baseClass:"jimu-widget-frame jimu-container",postCreate:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode);
this.widget&&this.setWidget(this.widget)},startup:function(){this.inherited(arguments);this.widget&&this.widget.startup()},resize:function(){this.widget&&"closed"!==this.widget.state&&b.isFunction(this.widget.resize)&&this.widget.resize()},setLoading:function(l){this.loading=l;this.loading.placeAt(this.containerNode)},getWidget:function(){return this.widget},setWidget:function(l){this.widget=l;this.loading&&this.loading.destroy();c.place(l.domNode,this.containerNode);this.resize()},destroy:function(){if(this.widget&&
this.widget.domNode)try{this.widget.destroy()}catch(l){console.error("destroy widget error. widget: ["+this.widget.uri+"], "+l.stack)}this.loading&&this.loading.domNode&&this.loading.destroy()}})})},"jimu/BaseWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/html dijit/_WidgetBase dijit/_Container ./dijit/LoadingIndicator ./BaseWidgetFrame ./utils".split(" "),function(a,b,c,n,l,u,v,m,h){return a([l,u],{baseClass:"jimu-panel jimu-container",started:!1,state:"closed",
windowState:"normal",moveTopOnActive:!0,openAnimation:null,closeAnimation:null,animationDuration:0,startup:function(){this.inherited(arguments);this.loadAllWidgetsInOrder();this.started=!0},loadAllWidgetsInOrder:function(){var d=this.getAllWidgetConfigs();d=Array.isArray(this.config.widgets)?this.config.widgets:[this.config];c.forEach(d,function(e){if(!1!==e.visible){var g=new v;var p=this.createFrame(e);this.addChild(p);p.setLoading(g);this.widgetManager.loadWidget(e).then(b.hitch(this,function(t){p.setWidget(t);
t.startup()}))}},this)},getAllWidgetConfigs:function(){var d=[];return d=Array.isArray(this.config.widgets)?this.config.widgets:[this.config]},getWidgetById:function(d){for(var e=this.getChildren(),g=0;g<e.length;g++)if(e[g].getWidget()&&e[g].getWidget().id===d)return e[g].getWidget()},createFrame:function(d){return new m},setPosition:function(d,e){this.position=d;var g=h.getPositionStyle(this.position);g.position="absolute";e||(e="map"===d.relativeTo?this.sceneView.map.id:window.jimuConfig.layoutId);
this.started?this.resize():this.openAnimation&&(g.display="none");n.place(this.domNode,e);n.setStyle(this.domNode,g)},getPosition:function(){return this.position},setState:function(d){this.state=d},setWindowState:function(d){this.windowState=d},resize:function(){this.getChildren().forEach(function(d){d.resize()})},onPositionChange:function(d){this.setPosition(d)},onOpen:function(){c.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.openWidget(d.getWidget())},this)},onClose:function(){c.forEach(this.getChildren(),
function(d){d.getWidget()&&this.widgetManager.closeWidget(d.getWidget())},this)},onMaximize:function(){c.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.maximizeWidget(d.getWidget())},this)},onMinimize:function(){c.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.minimizeWidget(d.getWidget())},this)},onNormalize:function(){c.forEach(this.getChildren(),function(d){d.getWidget()&&this.widgetManager.normalizeWidget(d.getWidget())},this)},onActive:function(){},
onDeActive:function(){},updateConfig:function(d){this._updateConfig(d)},reloadWidget:function(d){this.isWidgetInPanel(d)&&(this._updateConfig(d),this.getChildren().forEach(function(e){e.getWidget()&&e.getWidget().id===d.id&&(e.getWidget().destroy(),e.setLoading(new v),this.widgetManager.loadWidget(d).then(b.hitch(this,function(g){e.setWidget(g);g.startup();"closed"===this.state&&this.widgetManager.closeWidget(g)})))},this))},isWidgetInPanel:function(d){return c.some(this.getAllWidgetConfigs(),function(e){if(d.id===
e.id)return!0})?!0:!1},_updateConfig:function(d){if(Array.isArray(this.config.widgets)){for(var e=-1,g=0;g<this.config.widgets.length;g++)this.config.widgets[g].id===d.id&&(e=g);0<e&&(this.config.widgets[e]=d)}else this.config=d},destroy:function(){this.getChildren().forEach(function(d){try{d.domNode&&d.destroy()}catch(e){console.error("destroy widget frame error."+e.stack)}});this.inherited(arguments)}})})},"dijit/_Container":function(){define(["dojo/_base/array","dojo/_base/declare","dojo/dom-construct",
"dojo/_base/kernel"],function(a,b,c,n){return b("dijit._Container",null,{buildRendering:function(){this.inherited(arguments);this.containerNode||(this.containerNode=this.domNode)},addChild:function(l,u){var v=this.containerNode;if(0<u){for(v=v.firstChild;0<u;)1==v.nodeType&&u--,v=v.nextSibling;v?u="before":(v=this.containerNode,u="last")}c.place(l.domNode,v,u);this._started&&!l._started&&l.startup()},removeChild:function(l){"number"==typeof l&&(l=this.getChildren()[l]);l&&(l=l.domNode)&&l.parentNode&&
l.parentNode.removeChild(l)},hasChildren:function(){return 0<this.getChildren().length},_getSiblingOfChild:function(l,u){var v=this.getChildren();l=a.indexOf(v,l);return v[l+u]},getIndexOfChild:function(l){return a.indexOf(this.getChildren(),l)}})})},"jimu/dijit/LoadingIndicator":function(){define(["dojo/_base/declare","dijit/_WidgetBase","dojo/dom-style","dojo/dom-construct"],function(a,b,c,n){return a(b,{baseClass:"jimu-loading-indicator",declaredClass:"jimu.dijit.LoadingIndicator",hidden:!1,postCreate:function(){this.inherited(arguments);
(this.hidden=!0===this.hidden)&&c.set(this.domNode,{display:"none"});c.set(this.domNode,{width:"100%",height:"100%"});n.place(' \x3cdiv class\x3d"loading-container"\x3e\x3cdiv data-dojo-attach-point\x3d"loadingNode" class\x3d"img-div"\x3e\x3c/div\x3e\x3c/div\x3e',this.domNode)},show:function(){this.domNode&&c.set(this.domNode,"display","block")},hide:function(){this.domNode&&c.set(this.domNode,"display","none")}})})},"jimu/BaseWidgetSetting":function(){define(["dojo/_base/declare","dojo/_base/lang",
"dojo/on","dijit/_WidgetBase","dijit/_TemplatedMixin"],function(a,b,c,n,l){return a([n,l],{templateString:"\x3cdiv\x3e\x3c/div\x3e",postCreate:function(){this.own(c(window,"resize",b.hitch(this,this._onWindowResize)))},getConfig:function(){},resize:function(){},_onWindowResize:function(){this.resize()}})})},"jimu/PoolControllerMixin":function(){define(["dojo/_base/declare","dojo/_base/array","jimu/PanelManager"],function(a,b,c){return a(null,{constructor:function(){this.panelManager=c.getInstance()},
postCreate:function(){this.controlledWidgets||(this.controlledWidgets="all");this.controlledGroups||(this.controlledGroups="all")},getOpenedIds:function(){},setOpenedIds:function(n){},getConfigById:function(n){for(var l=this.getAllConfigs(),u=0;u<l.length;u++)if(l[u].id===n)return l[u]},getAllConfigs:function(){var n=[];n=n.concat(this.getWidgetConfigs(),this.getGroupConfigs());n=b.filter(n,function(l){return l.visible});return n.sort(function(l,u){return l.index-u.index})},getAllConfigsIncludeInvisible:function(){var n=
[];n=n.concat(this.getWidgetConfigs(),this.getGroupConfigs());return n.sort(function(l,u){return l.index-u.index})},isControlled:function(n){return b.some(this.getAllConfigsIncludeInvisible(),function(l){return l.id===n})},widgetIsControlled:function(n){return b.some(this.getAllConfigsIncludeInvisible(),function(l){return l.id===n?!0:b.some(l.widgets,function(u){return u.id===n})})},getGroupConfigs:function(){var n=[];if(!this.appConfig.widgetPool)return n;this.appConfig.widgetPool.groups&&b.forEach(this.appConfig.widgetPool.groups,
function(l){this.controlledGroups&&(Array.isArray(this.controlledGroups)?-1<this.controlledGroups.indexOf(l.id)&&n.push(l):"all"===this.controlledGroups&&n.push(l))},this);return n},getWidgetConfigs:function(){var n=[];if(!this.appConfig.widgetPool)return n;this.appConfig.widgetPool.widgets&&b.forEach(this.appConfig.widgetPool.widgets,function(l){this.controlledWidgets&&(Array.isArray(this.controlledWidgets)?-1<this.controlledWidgets.indexOf(l.id)&&n.push(l):"all"===this.controlledWidgets&&n.push(l))},
this);return n}})})},"jimu/SpatialReference/utils":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/Deferred dojo/promise/all dojo/request esri/geometry/SpatialReference ./unitUtils".split(" "),function(a,b,c,n,l,u,v,m){var h=null,d=null,e=!1;a=a(null,function(){});var g=require.toUrl("jimu"),p=u(g+"/SpatialReference/wkidDetails.json",{handleAs:"json"}),t=u(g+"/SpatialReference/transform.json",{handleAs:"json"});a.loadResource=function(){var q=new n;if(h&&d)return q.resolve(),
q;l([p,t]).then(function(k){h=k[0];d=k[1];e=!0;q.resolve()},function(k){console.error(k);e=!1;q.reject(k)});return q};a.getAllCSUnits=function(){if(e){var q=[];c.forEach(h.wkids,b.hitch(this,function(k){k=this.getCSUnit(k);-1===c.indexOf(q,k)&&q.push(k)}));return q}};a.convertUnit=function(q,k,r){if(e)return m.convertUnit(q,k,r)};a.getUnitRate=function(q,k){if(e)return m.getUnitRate(q,k)};a.isProjectUnit=function(q){if(e)return m.isProjectUnit(q)};a.isGeographicUnit=function(q){if(e)return m.isGeographicUnit(q)};
a.getGeographicUnits=function(){if(e)return m.getGeographicUnits()};a.getProjectUnits=function(){if(e)return m.getProjectUnits()};a.getCSUnit=function(q){if(e){q=this.getCSStr(q);var k=0,r=0;k=q.lastIndexOf("UNIT");r=q.indexOf(",",k);return q.slice(k+6,r-1)}};a.isSameSR=function(q,k){if(e)return q=this.indexOfWkid(q),k=this.indexOfWkid(k),h.labels[q]===h.labels[k]};a.isValidWkid=function(q){if(e)return-1<this.indexOfWkid(q)};a.getSRLabel=function(q){if(e&&this.isValidWkid(q))return q=this.indexOfWkid(q),
h.labels[q]};a.indexOfWkid=function(q){if(e)return c.indexOf(h.wkids,q)};a.isWebMercator=function(q){return v.prototype._isWebMercator?v.prototype._isWebMercator.apply({wkid:parseInt(q,10)},[]):(new v(parseInt(q,10))).isWebMercator};a.standardizeWkid=function(q){return this.isWebMercator(q)?3857:parseInt(q,10)};a.isValidTfWkid=function(q){if(e)return-1<this.indexOfTfWkid(q)};a.getTransformationLabel=function(q){if(e)return this.isValidTfWkid(q)?(q=this.indexOfTfWkid(q),d.labels[q]):""};a.indexOfTfWkid=
function(q){if(e)return c.indexOf(d.tfWkids,q)};a.isGeographicCS=function(q){if(e)return this.isValidWkid(q)?h.details[this.indexOfWkid(q)].startWith("GEOGCS"):!1};a.isProjectedCS=function(q){if(e)return this.isValidWkid(q)?h.details[this.indexOfWkid(q)].startWith("PROJCS"):!1};a.getGeoCSByProj=function(q){if(e&&this.isProjectedCS(q))return q=this.getSpheroidStr(q),q=c.indexOf(h.details,q),h.wkids[q]};a.getSpheroidStr=function(q){if(e){if(this.isGeographicCS(q))return h.details[this.indexOfWkid(q)];
if(this.isProjectedCS(q)){q=h.details[this.indexOfWkid(q)];var k=q.indexOf("GEOGCS"),r=q.indexOf("PROJECTION")-1;return q.slice(k,r)}return null}};a.getCSStr=function(q){if(e)return h.details[this.indexOfWkid(q)]};a.isSameSpheroid=function(q,k){if(e)return q=this.getSpheroidStr(q),k=this.getSpheroidStr(k),q&&k&&q===k?!0:!1};return a})},"dojo/request":function(){define(["./request/default!"],function(a){return a})},"dojo/request/default":function(){define(["exports","require","../has"],function(a,
b,c){var n=c("config-requestProvider");if(c("host-browser")||c("host-webworker"))var l="./xhr";n||(n=l);a.getPlatformDefaultId=function(){return l};a.load=function(u,v,m,h){b(["platform"==u?l:n],function(d){m(d)})}})},"jimu/SpatialReference/unitUtils":function(){define(["dojo/_base/declare","dojo/_base/array"],function(a,b){var c="INCHES FOOT FOOT_US YARDS MILES NAUTICAL_MILES MILLIMETERS CENTIMETERS METER KILOMETERS DECIMETERS LINK_CLARKE FOOT_GOLD_COAST FOOT_CLARKE CHAIN_SEARS_1992_TRUNCATED YARD_INDIAN CHAIN_BENOIT_1895_B YARD_SEARS CHAIN_SEARS FOOT_SEARS YARD_INDIAN_1937 50_KILOMETERS 150_KILOMETERS".split(" "),
n="DECIMAL_DEGREES DEGREE_MINUTE_SECONDS DEGREE GRAD MGRS USNG".split(" "),l={INCHES:.0254,FOOT:.3048,FOOT_US:.3048006096012192,YARDS:.9144,MILES:1609.344,NAUTICAL_MILES:1852,MILLIMETERS:.001,CENTIMETERS:.01,METER:1,KILOMETERS:1E3,DECIMETERS:.1,LINK_CLARKE:.2011661949,FOOT_GOLD_COAST:.3047997101815088,FOOT_CLARKE:.304797265,CHAIN_SEARS_1922_TRUNCATED:20.116756,YARD_INDIAN:.9143985307444408,CHAIN_BENOIT_1895_B:20.11678249437587,YARD_SEARS:.9143984146160287,CHAIN_SEARS:20.11676512155263,FOOT_SEARS:.3047994715386762,
YARD_INDIAN_1937:.91439523,"50_KILOMETERS":5E4,"150_KILOMETERS":15E4,DEGREE:.0174532925199433,DECIMAL_DEGREES:.0174532925199433,MGRS:.0174532925199433,USNG:.0174532925199433,DEGREE_MINUTE_SECONDS:.0174532925199433,GRAD:.01570796326794897};a=a(null,function(){});a.convertUnit=function(u,v,m){return l[u.toUpperCase()]/l[v.toUpperCase()]*m};a.getUnitRate=function(u,v){return l[u.toUpperCase()]/l[v.toUpperCase()]};a.isProjectUnit=function(u){return-1<b.indexOf(c,u.toUpperCase())};a.isGeographicUnit=function(u){return-1<
b.indexOf(n,u.toUpperCase())};a.getGeographicUnits=function(){return n};a.getProjectUnits=function(){return c};return a})},"jimu/OnScreenWidgetPanel":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/html dojo/on dojo/dnd/move dijit/_TemplatedMixin jimu/BaseWidgetPanel jimu/utils dojox/layout/ResizeHandle dojo/touch".split(" "),function(a,b,c,n,l,u,v,m,h){return a([v,u],{baseClass:"jimu-panel jimu-on-screen-widget-panel",_positionInfoBox:null,_originalBox:null,widgetIcon:null,_resizeOnOpen:!0,
templateString:'\x3cdiv data-dojo-attach-point\x3d"boxNode"\x3e\x3cdiv class\x3d"jimu-panel-title jimu-main-background" data-dojo-attach-point\x3d"titleNode"\x3e\x3cdiv class\x3d"title-label jimu-vcenter-text jimu-float-leading jimu-leading-padding1"data-dojo-attach-point\x3d"titleLabelNode"\x3e${label}\x3c/div\x3e\x3cdiv class\x3d"close-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"closeNode"data-dojo-attach-event\x3d"onclick:_onCloseBtnClicked,press:_onCloseBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"max-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"maxNode"data-dojo-attach-event\x3d"onclick:_onMaxBtnClicked"\x3e\x3c/div\x3e\x3cdiv class\x3d"foldable-btn jimu-vcenter jimu-float-trailing" data-dojo-attach-point\x3d"foldableNode"data-dojo-attach-event\x3d"onclick:_onFoldableBtnClicked"\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d"jimu-panel-content" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/div\x3e\x3c/div\x3e',
postCreate:function(){this._originalBox={w:400,h:410}},startup:function(){this.inherited(arguments);this._normalizePositionObj(this.position);this._makeOriginalBox();this.makePositionInfoBox();this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w)},_onMaxBtnClicked:function(d){d.stopPropagation();this._getPositionInfo().isRunInMobile&&("maximized"===this.windowState?this.panelManager.normalizePanel(this):this.panelManager.maximizePanel(this),this._setMobilePosition())},_onFoldableBtnClicked:function(d){d.stopPropagation();
this._getPositionInfo().isRunInMobile&&("minimized"===this.windowState?(c.removeClass(this.foldableNode,"fold-up"),c.addClass(this.foldableNode,"fold-down"),this.panelManager.normalizePanel(this)):(c.removeClass(this.foldableNode,"fold-down"),c.addClass(this.foldableNode,"fold-up"),this.panelManager.minimizePanel(this)),this._setMobilePosition())},_onCloseBtnClicked:function(d){this.panelManager.closePanel(this);d.stopPropagation()},_normalizePositionObj:function(d){var e=this._getLayoutBox();d.left=
isFinite(d.left)?d.left:e.w-d.right;d.top=isFinite(d.top)?d.top:e.h-d.bottom;delete d.right;delete d.bottom;this.position=b.mixin(b.clone(this.position),d)},makePositionInfoBox:function(){this._positionInfoBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},_makeOriginalBox:function(){this._originalBox={w:this.position.width||400,h:this.position.height||410,l:this.position.left||0,t:this.position.top||0}},makeResizable:function(){this.disableResizable();
this.resizeHandle=(new h({targetId:this,minWidth:this._originalBox.w,minHeight:this._originalBox.h,activeResize:!1})).placeAt(this.domNode);this.resizeHandle.startup()},disableResizable:function(){this.resizeHandle&&(this.resizeHandle.destroy(),this.resizeHandle=null)},makeMoveable:function(d,e){this.disableMoveable();var g=c.getMarginBox(jimuConfig.layoutId);g.l=g.l-d+e;g.w+=2*(d-e);this.moveable=new l.boxConstrainedMoveable(this.domNode,{box:g,handle:this.titleNode,within:!0});this.own(n(this.moveable,
"Moving",b.hitch(this,this.onMoving)));this.own(n(this.moveable,"MoveStop",b.hitch(this,this.onMoveStop)))},disableMoveable:function(){this.moveable&&(this.moveable.destroy(),this.moveable=null)},createHandleNode:function(){return this.titleNode},onOpen:function(){this._resizeOnOpen&&(this.resize(),this._resizeOnOpen=!1);this.inherited(arguments)},_switchToMobileUI:function(){c.removeClass(this.titleNode,"title-normal");c.addClass(this.titleNode,"title-full");c.setStyle(this.foldableNode,"display",
"block");c.setStyle(this.maxNode,"display","block");"normal"===this.windowState?(c.removeClass(this.foldableNode,"fold-up"),c.addClass(this.foldableNode,"fold-down")):(c.removeClass(this.foldableNode,"fold-down"),c.addClass(this.foldableNode,"fold-up"))},_switchToDesktopUI:function(){c.removeClass(this.titleNode,"title-full");c.addClass(this.titleNode,"title-normal");c.setStyle(this.foldableNode,"display","none");c.setStyle(this.maxNode,"display","none")},resize:function(d){var e=this._getPositionInfo(),
g={left:e.position.left,top:e.position.top,width:this._positionInfoBox.w,height:this._positionInfoBox.h};d&&(d.t=this.domNode.offsetTop,g.left=isFinite(d.l)?d.l:g.left,g.top=isFinite(d.t)?d.t:g.top,g.width=isFinite(d.w)?d.w:g.width,g.height=isFinite(d.h)?d.h:g.height,this._normalizePositionObj(b.clone(g)),this.makePositionInfoBox(),g.width=this._positionInfoBox.w,g.height=this._positionInfoBox.h);e.position=g;this._onResponsible(e);this.inherited(arguments)},_onResponsible:function(d){d.isRunInMobile?
(this._setMobilePosition(),this.disableMoveable(),this.disableResizable(),this._switchToMobileUI()):(this._setDesktopPosition(d.position),this.makeResizable(),this.makeMoveable(this._positionInfoBox.w,.25*this._positionInfoBox.w),this._switchToDesktopUI())},setPosition:function(d){this._normalizePositionObj(d);this.makePositionInfoBox();d=this._getPositionInfo();this._onResponsible(d)},destroy:function(){this.widgetIcon=null;this.inherited(arguments)},_getLayoutBox:function(){var d=jimuConfig.layoutId;
d="map"===this.position.relativeTo?jimuConfig.mapId:jimuConfig.layoutId;return c.getMarginBox(d)},_getPositionInfo:function(){var d={isRunInMobile:!1,position:{left:0,top:5}},e=this._getLayoutBox(),g=this._positionInfoBox.l;if(window.appInfo.isRunInMobile)return d.isRunInMobile=!0,d;d.position.left=window.isRTL?e.w-g:g;g=this._positionInfoBox.t;var p=e.h-g;g>=p?g>=this._positionInfoBox.h&&(d.position.top=this._positionInfoBox.t-this._positionInfoBox.h-40-3):p>=this._positionInfoBox.h&&(d.position.top=
this._positionInfoBox.t+40+3);!d.isRunInMobile&&d.position.left+this._positionInfoBox.w>e.w&&(d.position.left-=this._positionInfoBox.w);return d},_setMobilePosition:function(){c.place(this.domNode,jimuConfig.layoutId);var d=this.panelManager.getPositionOnMobile(this);this.position.zIndex&&(d.zIndex=this.position.zIndex);var e=m.getPositionStyle(d);b.mixin(e,d.borderRadiusStyle);c.setStyle(this.domNode,e)},_setDesktopPosition:function(d){c.place(this.domNode,jimuConfig.mapId);c.setStyle(this.domNode,
{left:d.left+"px",right:"auto",top:d.top+"px",width:(d.width||this.position.width||this._originalBox.w)+"px",height:(d.height||this.position.height||this._originalBox.h)+"px"})},onMoving:function(d){c.setStyle(d.node,"opacity",.9)},onMoveStop:function(d){c.setStyle(d.node,"opacity",1);d=c.getMarginBox(d.node);this._normalizePositionObj(b.clone({left:d.l,top:d.t,width:d.w,height:d.h}));this.makePositionInfoBox()}})})},"dojox/layout/ResizeHandle":function(){define("dojo/_base/kernel dojo/_base/lang dojo/_base/connect dojo/_base/array dojo/_base/event dojo/_base/fx dojo/_base/window dojo/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/declare dojo/touch dijit/_base/manager dijit/_Widget dijit/_TemplatedMixin".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){a.experimental("dojox.layout.ResizeHandle");var y=p("dojox.layout._ResizeHelper",k,{show:function(){g.set(this.domNode,"display","")},hide:function(){g.set(this.domNode,"display","none")},resize:function(f){e.setMarginBox(this.domNode,f)}});return p("dojox.layout.ResizeHandle",[k,r],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,
minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'\x3cdiv dojoAttachPoint\x3d"resizeHandle" class\x3d"dojoxResizeHandle"\x3e\x3cdiv\x3e\x3c/div\x3e\x3c/div\x3e',postCreate:function(){this.connect(this.resizeHandle,t.press,"_beginSizing");this.activeResize?this.animateSizing=!1:(this._resizeHelper=q.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=(new y({id:"dojoxGlobalResizeHelper"})).placeAt(v.body()),
d.add(this._resizeHelper.domNode,this.activeResizeClass)));this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight});this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight});this._resizeX=this._resizeY=!1;var f=b.partial(d.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case "xy":this._resizeX=this._resizeY=!0;f("dojoxResizeNW");break;case "x":this._resizeX=!0;f("dojoxResizeW");break;case "y":this._resizeY=!0,f("dojoxResizeN")}},_beginSizing:function(f){if(!this._isSizing&&
(c.publish(this.startTopic,[this]),this.targetDomNode=(this.targetWidget=q.byId(this.targetId))?this.targetWidget.domNode:h.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var w=e.position(this.targetDomNode,!0);this._resizeHelper.resize({l:w.x,t:w.y,w:w.w,h:w.h});this._resizeHelper.show();this.isLeftToRight()||(this._resizeHelper.startPosition={l:w.x,t:w.y})}this._isSizing=!0;this.startPoint={x:f.clientX,y:f.clientY};
w=g.getComputedStyle(this.targetDomNode);var z="border-model"===e.boxModel?{w:0,h:0}:e.getPadBorderExtents(this.targetDomNode,w),A=e.getMarginExtents(this.targetDomNode,w);this.startSize={w:g.get(this.targetDomNode,"width",w),h:g.get(this.targetDomNode,"height",w),pbw:z.w,pbh:z.h,mw:A.w,mh:A.h};this.isLeftToRight()||"absolute"!=g.get(this.targetDomNode,"position")||(w=e.position(this.targetDomNode,!0),this.startPosition={l:w.x,t:w.y});this._pconnects=[c.connect(v.doc,t.move,this,"_updateSizing"),
c.connect(v.doc,t.release,this,"_endSizing")];l.stop(f)}},_updateSizing:function(f){if(this.activeResize)this._changeSizing(f);else{var w=this._getNewCoords(f,"border",this._resizeHelper.startPosition);if(!1===w)return;this._resizeHelper.resize(w)}f.preventDefault()},_getNewCoords:function(f,w,z){try{if(!f.clientX||!f.clientY)return!1}catch(B){return!1}this._activeResizeLastEvent=f;var A=(this.isLeftToRight()?1:-1)*(this.startPoint.x-f.clientX),x=this.startPoint.y-f.clientY;f=this.startSize.w-(this._resizeX?
A:0);x=this._checkConstraints(f,this.startSize.h-(this._resizeY?x:0));(z=z||this.startPosition)&&this._resizeX&&(x.l=z.l+A,x.w!=f&&(x.l+=f-x.w),x.t=z.t);switch(w){case "margin":x.w+=this.startSize.mw,x.h+=this.startSize.mh;case "border":x.w+=this.startSize.pbw,x.h+=this.startSize.pbh}return x},_checkConstraints:function(f,w){if(this.minSize){var z=this.minSize;f<z.w&&(f=z.w);w<z.h&&(w=z.h)}this.constrainMax&&this.maxSize&&(z=this.maxSize,f>z.w&&(f=z.w),w>z.h&&(w=z.h));if(this.fixedAspect){z=this.startSize.w;
var A=this.startSize.h,x=z*w-A*f;0>x?f=w*z/A:0<x&&(w=f*A/z)}return{w:f,h:w}},_changeSizing:function(f){var w=this.targetWidget&&b.isFunction(this.targetWidget.resize),z=this._getNewCoords(f,w&&"margin");if(!1!==z&&(w?this.targetWidget.resize(z):this.animateSizing?m[this.animateMethod]([u.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:z.w}},duration:this.animateDuration}),u.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:z.h}},
duration:this.animateDuration})]).play():g.set(this.targetDomNode,{width:z.w+"px",height:z.h+"px"}),this.intermediateChanges))this.onResize(f)},_endSizing:function(f){n.forEach(this._pconnects,c.disconnect);var w=b.partial(c.publish,this.endTopic,[this]);this.activeResize?w():(this._resizeHelper.hide(),this._changeSizing(f),setTimeout(w,this.animateDuration+15));this._isSizing=!1;this.onResize(f)},onResize:function(f){}})})},"dojo/fx":function(){define("./_base/lang ./Evented ./_base/kernel ./_base/array ./aspect ./_base/fx ./dom ./dom-style ./dom-geometry ./ready require".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){c.isAsync||d(0,function(){e(["./fx/Toggler"])});c=c.fx={};d={_fire:function(t,q){this[t]&&this[t].apply(this,q||[]);return this}};var g=function(t){this._index=-1;this._animations=t||[];this._current=this._onAnimateCtx=this._onEndCtx=null;this.duration=0;n.forEach(this._animations,function(q){q&&("undefined"!=typeof q.duration&&(this.duration+=q.duration),q.delay&&(this.duration+=q.delay))},this)};g.prototype=new b;a.extend(g,{_onAnimate:function(){this._fire("onAnimate",
arguments)},_onEnd:function(){this._onAnimateCtx.remove();this._onEndCtx.remove();this._onAnimateCtx=this._onEndCtx=null;this._index+1==this._animations.length?this._fire("onEnd"):(this._current=this._animations[++this._index],this._onAnimateCtx=l.after(this._current,"onAnimate",a.hitch(this,"_onAnimate"),!0),this._onEndCtx=l.after(this._current,"onEnd",a.hitch(this,"_onEnd"),!0),this._current.play(0,!0))},play:function(t,q){this._current||(this._current=this._animations[this._index=0]);if(!q&&"playing"==
this._current.status())return this;var k=l.after(this._current,"beforeBegin",a.hitch(this,function(){this._fire("beforeBegin")}),!0),r=l.after(this._current,"onBegin",a.hitch(this,function(f){this._fire("onBegin",arguments)}),!0),y=l.after(this._current,"onPlay",a.hitch(this,function(f){this._fire("onPlay",arguments);k.remove();r.remove();y.remove()}));this._onAnimateCtx&&this._onAnimateCtx.remove();this._onAnimateCtx=l.after(this._current,"onAnimate",a.hitch(this,"_onAnimate"),!0);this._onEndCtx&&
this._onEndCtx.remove();this._onEndCtx=l.after(this._current,"onEnd",a.hitch(this,"_onEnd"),!0);this._current.play.apply(this._current,arguments);return this},pause:function(){if(this._current){var t=l.after(this._current,"onPause",a.hitch(this,function(q){this._fire("onPause",arguments);t.remove()}),!0);this._current.pause()}return this},gotoPercent:function(t,q){this.pause();var k=this.duration*t;this._current=null;n.some(this._animations,function(r,y){if(k<=r.duration)return this._current=r,this._index=
y,!0;k-=r.duration;return!1},this);this._current&&this._current.gotoPercent(k/this._current.duration);q&&this.play();return this},stop:function(t){if(this._current){if(t){for(;this._index+1<this._animations.length;++this._index)this._animations[this._index].stop(!0);this._current=this._animations[this._index]}var q=l.after(this._current,"onStop",a.hitch(this,function(k){this._fire("onStop",arguments);q.remove()}),!0);this._current.stop()}return this},status:function(){return this._current?this._current.status():
"stopped"},destroy:function(){this.stop();this._onAnimateCtx&&this._onAnimateCtx.remove();this._onEndCtx&&this._onEndCtx.remove()}});a.extend(g,d);c.chain=function(t){return new g(a.isArray(t)?t:Array.prototype.slice.call(t,0))};var p=function(t){this._animations=t||[];this._connects=[];this.duration=this._finished=0;n.forEach(t,function(k){var r=k.duration;k.delay&&(r+=k.delay);this.duration<r&&(this.duration=r);this._connects.push(l.after(k,"onEnd",a.hitch(this,"_onEnd"),!0))},this);this._pseudoAnimation=
new u.Animation({curve:[0,1],duration:this.duration});var q=this;n.forEach("beforeBegin onBegin onPlay onAnimate onPause onStop onEnd".split(" "),function(k){q._connects.push(l.after(q._pseudoAnimation,k,function(){q._fire(k,arguments)},!0))})};a.extend(p,{_doAction:function(t,q){n.forEach(this._animations,function(k){k[t].apply(k,q)});return this},_onEnd:function(){++this._finished>this._animations.length&&this._fire("onEnd")},_call:function(t,q){var k=this._pseudoAnimation;k[t].apply(k,q)},play:function(t,
q){this._finished=0;this._doAction("play",arguments);this._call("play",arguments);return this},pause:function(){this._doAction("pause",arguments);this._call("pause",arguments);return this},gotoPercent:function(t,q){var k=this.duration*t;n.forEach(this._animations,function(r){r.gotoPercent(r.duration<k?1:k/r.duration,q)});this._call("gotoPercent",arguments);return this},stop:function(t){this._doAction("stop",arguments);this._call("stop",arguments);return this},status:function(){return this._pseudoAnimation.status()},
destroy:function(){this.stop();n.forEach(this._connects,function(t){t.remove()})}});a.extend(p,d);c.combine=function(t){return new p(a.isArray(t)?t:Array.prototype.slice.call(t,0))};c.wipeIn=function(t){var q=t.node=v.byId(t.node),k=q.style,r;t=u.animateProperty(a.mixin({properties:{height:{start:function(){r=k.overflow;k.overflow="hidden";if("hidden"==k.visibility||"none"==k.display)return k.height="1px",k.display="",k.visibility="",1;var f=m.get(q,"height");return Math.max(f,1)},end:function(){return q.scrollHeight}}}},
t));var y=function(){k.height="auto";k.overflow=r};l.after(t,"onStop",y,!0);l.after(t,"onEnd",y,!0);return t};c.wipeOut=function(t){var q=(t.node=v.byId(t.node)).style,k;t=u.animateProperty(a.mixin({properties:{height:{end:1}}},t));l.after(t,"beforeBegin",function(){k=q.overflow;q.overflow="hidden";q.display=""},!0);var r=function(){q.overflow=k;q.height="auto";q.display="none"};l.after(t,"onStop",r,!0);l.after(t,"onEnd",r,!0);return t};c.slideTo=function(t){var q=null,k=null,r=function(y){return function(){var f=
m.getComputedStyle(y),w=f.position;q="absolute"==w?y.offsetTop:parseInt(f.top)||0;k="absolute"==w?y.offsetLeft:parseInt(f.left)||0;"absolute"!=w&&"relative"!=w&&(f=h.position(y,!0),q=f.y,k=f.x,y.style.position="absolute",y.style.top=q+"px",y.style.left=k+"px")}}(t.node=v.byId(t.node));r();t=u.animateProperty(a.mixin({properties:{top:t.top||0,left:t.left||0}},t));l.after(t,"beforeBegin",r,!0);return t};return c})},"dijit/_base/manager":function(){define(["dojo/_base/array","dojo/_base/config","dojo/_base/lang",
"../registry","../main"],function(a,b,c,n,l){var u={};a.forEach("byId getUniqueId findWidgets _destroyAll byNode getEnclosingWidget".split(" "),function(v){u[v]=n[v]});c.mixin(u,{defaultDuration:b.defaultDuration||200});c.mixin(l,u);return l})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){function t(){}function q(k){return function(r,y,f,w){return r&&"string"==typeof y&&r[y]==t?r.on(y.substring(2).toLowerCase(),v.hitch(f,w)):k.apply(c,arguments)}}a.around(c,"connect",q);u.connect&&a.around(u,"connect",q);a=n("dijit._Widget",[e,g,p],{onClick:t,onDblClick:t,onKeyDown:t,onKeyPress:t,onKeyUp:t,onMouseDown:t,onMouseMove:t,onMouseOut:t,onMouseOver:t,onMouseLeave:t,onMouseEnter:t,onMouseUp:t,constructor:function(k){this._toConnect={};for(var r in k)this[r]===
t&&(this._toConnect[r.replace(/^on/,"").toLowerCase()]=k[r],delete k[r])},postCreate:function(){this.inherited(arguments);for(var k in this._toConnect)this.on(k,this._toConnect[k]);delete this._toConnect},on:function(k,r){return this[this._onMap(k)]===t?c.connect(this.domNode,k.toLowerCase(),this,r):this.inherited(arguments)},_setFocusedAttr:function(k){this._focused=k;this._set("focused",k)},setAttribute:function(k,r){u.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(k,r)},attr:function(k,r){return 2<=arguments.length||"object"===typeof k?this.set.apply(this,arguments):this.get(k)},getDescendants:function(){u.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?m("[widgetId]",this.containerNode).map(d.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});l("dijit-legacy-requires")&&h(0,function(){require(["dijit/_base"])});
return a})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(a,b,c,n,l,u){a=n("dijit._OnDijitClickMixin",null,{connect:function(v,m,h){return this.inherited(arguments,[v,"ondijitclick"==m?u:m,h])}});a.a11yclick=u;return a})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(a,b,c,n){function l(m){if((m.keyCode===a.ENTER||m.keyCode===a.SPACE)&&!/input|button|textarea/i.test(m.target.nodeName))for(m=
m.target;m;m=m.parentNode)if(m.dojoClick)return!0}var u;c(document,"keydown",function(m){l(m)?(u=m.target,m.preventDefault()):u=null});c(document,"keyup",function(m){l(m)&&m.target==u&&(u=null,c.emit(m.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:m.ctrlKey,shiftKey:m.shiftKey,metaKey:m.metaKey,altKey:m.altKey,_origType:m.type}))});var v=function(m,h){m.dojoClick=!0;return c(m,"click",h)};v.click=v;v.press=function(m,h){var d=c(m,n.press,function(g){("mousedown"!=g.type||b.isLeft(g))&&h(g)}),e=
c(m,"keydown",function(g){g.keyCode!==a.ENTER&&g.keyCode!==a.SPACE||h(g)});return{remove:function(){d.remove();e.remove()}}};v.release=function(m,h){var d=c(m,n.release,function(g){("mouseup"!=g.type||b.isLeft(g))&&h(g)}),e=c(m,"keyup",function(g){g.keyCode!==a.ENTER&&g.keyCode!==a.SPACE||h(g)});return{remove:function(){d.remove();e.remove()}}};v.move=n.move;return v})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(a,b,c,n){n.extend(b,
{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return c("dijit._FocusMixin",null,{_focusManager:a})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r){var y,f,w=new (b([g,
v],{curNode:null,activeStack:[],constructor:function(){var A=m.hitch(this,function(x){c.isDescendant(this.curNode,x)&&this.set("curNode",null);c.isDescendant(this.prevNode,x)&&this.set("prevNode",null)});a.before(u,"empty",A);a.before(u,"destroy",A)},registerIframe:function(A){return this.registerWin(A.contentWindow,A)},registerWin:function(A,x){var B=this,C=A.document&&A.document.body;if(C){var D=h(A.document,"pointerdown",function(G){G&&G.target&&null==G.target.parentNode||B._onTouchNode(x||G.target,
"mouse")}),E=h(C,"focusin",function(G){if(G.target.tagName){var O=G.target.tagName.toLowerCase();"#document"!=O&&"body"!=O&&(q.isFocusable(G.target)?B._onFocusNode(x||G.target):B._onTouchNode(x||G.target))}}),F=h(C,"focusout",function(G){B._onBlurNode(x||G.target)});return{remove:function(){D.remove();E.remove();F.remove();C=D=E=F=null}}}},_onBlurNode:function(A){A=(new Date).getTime();A<y+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(m.hitch(this,
function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),A<f+100||(this._clearActiveWidgetsTimer=setTimeout(m.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(A,x){f=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);l.contains(A,"dijitPopup")&&(A=A.firstChild);var B=
[];try{for(;A;){var C=n.get(A,"dijitPopupParent");if(C)A=k.byId(C).domNode;else if(A.tagName&&"body"==A.tagName.toLowerCase()){if(A===p.body())break;A=t.get(A.ownerDocument).frameElement}else{var D=A.getAttribute&&A.getAttribute("widgetId"),E=D&&k.byId(D);!E||"mouse"==x&&E.get("disabled")||B.unshift(D);A=A.parentNode}}}catch(F){}this._setStack(B,x)},_onFocusNode:function(A){A&&9!=A.nodeType&&(y=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),
this._onTouchNode(A),A!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",A)))},_setStack:function(A,x){var B=this.activeStack,C=B.length-1,D=A.length-1;if(A[D]!=B[C]){this.set("activeStack",A);var E;for(E=C;0<=E&&B[E]!=A[E];E--)if(C=k.byId(B[E]))C._hasBeenBlurred=!0,C.set("focused",!1),C._focusManager==this&&C._onBlur(x),this.emit("widget-blur",C,x);for(E++;E<=D;E++)if(C=k.byId(A[E]))C.set("focused",!0),C._focusManager==this&&C._onFocus(x),this.emit("widget-focus",C,x)}},focus:function(A){if(A)try{A.focus()}catch(x){}}}));
d(function(){var A=w.registerWin(t.get(document));e("ie")&&h(window,"unload",function(){A&&(A.remove(),A=null)})});r.focus=function(A){w.focus(A)};for(var z in w)/^_/.test(z)||(r.focus[z]="function"==typeof w[z]?m.hitch(w,z):w[z]);w.watch(function(A,x,B){r.focus[A]=B});return w})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(a,b,c,n,l,u,v){var m={_isElementShown:function(h){var d=n.get(h);return"hidden"!=
d.visibility&&"collapsed"!=d.visibility&&"none"!=d.display&&"hidden"!=c.get(h,"type")},hasDefaultTabStop:function(h){switch(h.nodeName.toLowerCase()){case "a":return c.has(h,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":try{var d=h.contentDocument;if("designMode"in d&&"on"==d.designMode)return!0;var e=d.body}catch(g){try{e=h.contentWindow.document.body}catch(p){return!1}}return e&&("true"==e.contentEditable||e.firstChild&&"true"==
e.firstChild.contentEditable);default:return"true"==h.contentEditable}},effectiveTabIndex:function(h){if(!c.get(h,"disabled"))return c.has(h,"tabIndex")?+c.get(h,"tabIndex"):m.hasDefaultTabStop(h)?0:void 0},isTabNavigable:function(h){return 0<=m.effectiveTabIndex(h)},isFocusable:function(h){return-1<=m.effectiveTabIndex(h)},_getTabNavigable:function(h){function d(A){return A&&"input"==A.tagName.toLowerCase()&&A.type&&"radio"==A.type.toLowerCase()&&A.name&&A.name.toLowerCase()}function e(A){return y[d(A)]||
A}var g,p,t,q,k,r,y={},f=m._isElementShown,w=m.effectiveTabIndex,z=function(A){for(A=A.firstChild;A;A=A.nextSibling)if(!(1!=A.nodeType||9>=u("ie")&&"HTML"!==A.scopeName)&&f(A)){var x=w(A);if(0<=x){if(0==x)g||(g=A),p=A;else if(0<x){if(!t||x<q)q=x,t=A;if(!k||x>=r)r=x,k=A}x=d(A);c.get(A,"checked")&&x&&(y[x]=A)}"SELECT"!=A.nodeName.toUpperCase()&&z(A)}};f(h)&&z(h);return{first:e(g),last:e(p),lowest:e(t),highest:e(k)}},getFirstInTabbingOrder:function(h,d){h=m._getTabNavigable(b.byId(h,d));return h.lowest?
h.lowest:h.first},getLastInTabbingOrder:function(h,d){h=m._getTabNavigable(b.byId(h,d));return h.last?h.last:h.highest}};l.mixin(v,m);return m})},"dojo/uacss":function(){define(["./dom-geometry","./_base/lang","./domReady","./sniff","./_base/window"],function(a,b,c,n,l){var u=l.doc.documentElement;l=n("ie");var v=n("opera"),m=Math.floor,h=a.boxModel.replace(/-/,"");v={dj_quirks:0,dj_opera:v,dj_khtml:0,dj_webkit:n("webkit"),dj_safari:n("safari"),dj_chrome:n("chrome"),dj_edge:1,dj_gecko:1,dj_ios:n("ios"),
dj_android:0};l&&(v.dj_ie=!0,v["dj_ie"+m(l)]=!0,v.dj_iequirks=0);v["dj_ff"+m(1)]=!0;v["dj_"+h]=!0;var d="",e;for(e in v)v[e]&&(d+=e+" ");u.className=b.trim(u.className+" "+d);c(function(){if(!a.isBodyLtr()){var g="dj_rtl dijitRtl "+d.replace(/ /g,"-rtl ");u.className=b.trim(u.className+" "+g+"dj_rtl dijitRtl "+d.replace(/ /g,"-rtl "))}});return n})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(a,b,c,n){c(function(){b("highcontrast")&&
a.add(n.body(),"dijit_a11y")});return b})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(a,b,c,n,l,u,v){l.add("highcontrast",function(){var m=v.doc.createElement("div");try{m.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(b.blankGif||a.toUrl("./resources/blank.gif"))+'");';v.body().appendChild(m);var h=n.getComputedStyle(m),d=h.backgroundImage;
return h.borderTopColor==h.borderRightColor||d&&("none"==d||"url(invalid-url:)"==d)}catch(e){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+e.toString()),!1}finally{8>=l("ie")?m.outerHTML="":v.body().removeChild(m)}});u(function(){l("highcontrast")&&c.add(v.body(),"dj_a11y")});return l})},"dijit/layout/_LayoutWidget":function(){define("dojo/_base/lang ../_Widget ../_Container ../_Contained ../Viewport dojo/_base/declare dojo/dom-class dojo/dom-geometry dojo/dom-style".split(" "),
function(a,b,c,n,l,u,v,m,h){return u("dijit.layout._LayoutWidget",[b,c,n],{baseClass:"dijitLayoutContainer",isLayoutContainer:!0,_setTitleAttr:null,buildRendering:function(){this.inherited(arguments);v.add(this.domNode,"dijitContainer")},startup:function(){if(!this._started){this.inherited(arguments);var d=this.getParent&&this.getParent();d&&d.isLayoutContainer||(this.resize(),this.own(l.on("resize",a.hitch(this,"resize"))))}},resize:function(d,e){var g=this.domNode;d&&m.setMarginBox(g,d);e=e||{};
a.mixin(e,d||{});"h"in e&&"w"in e||(e=a.mixin(m.getMarginBox(g),e));d=h.getComputedStyle(g);var p=m.getMarginExtents(g,d),t=m.getBorderExtents(g,d);e=this._borderBox={w:e.w-(p.w+t.w),h:e.h-(p.h+t.h)};p=m.getPadExtents(g,d);this._contentBox={l:h.toPixelValue(g,d.paddingLeft),t:h.toPixelValue(g,d.paddingTop),w:e.w-p.w,h:e.h-p.h};this.layout()},layout:function(){},_setupChild:function(d){v.add(d.domNode,this.baseClass+"-child "+(d.baseClass?this.baseClass+"-"+d.baseClass:""))},addChild:function(d,e){this.inherited(arguments);
this._started&&this._setupChild(d)},removeChild:function(d){v.remove(d.domNode,this.baseClass+"-child"+(d.baseClass?" "+this.baseClass+"-"+d.baseClass:""));this.inherited(arguments)}})})},"dijit/_Contained":function(){define(["dojo/_base/declare","./registry"],function(a,b){return a("dijit._Contained",null,{_getSibling:function(c){var n=this.getParent();return n&&n._getSiblingOfChild&&n._getSiblingOfChild(this,"previous"==c?-1:1)||null},getPreviousSibling:function(){return this._getSibling("previous")},
getNextSibling:function(){return this._getSibling("next")},getIndexInParent:function(){var c=this.getParent();return c&&c.getIndexOfChild?c.getIndexOfChild(this):-1}})})},"dijit/Viewport":function(){define(["dojo/Evented","dojo/on","dojo/domReady","dojo/sniff","dojo/window"],function(a,b,c,n,l){var u=new a,v;c(function(){var m=l.getBox();u._rlh=b(window,"resize",function(){var d=l.getBox();if(m.h!=d.h||m.w!=d.w)m=d,u.emit("resize")});if(8==n("ie")){var h=screen.deviceXDPI;setInterval(function(){screen.deviceXDPI!=
h&&(h=screen.deviceXDPI,u.emit("resize"))},500)}n("ios")&&(b(document,"focusin",function(d){v=d.target}),b(document,"focusout",function(d){v=null}))});u.getEffectiveBox=function(m){m=l.getBox(m);var h=v&&v.tagName&&v.tagName.toLowerCase();n("ios")&&v&&!v.readOnly&&("textarea"==h||"input"==h&&/^(color|email|number|password|search|tel|text|url)$/.test(v.type))&&(m.h*=0==orientation||180==orientation?.66:.4,h=v.getBoundingClientRect(),m.h=Math.max(m.h,h.top+h.height));return m};return u})},"dijit/Menu":function(){define("require dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/on dojo/sniff dojo/_base/window dojo/window ./popup ./DropDownMenu dojo/ready".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){e("dijit-legacy-requires")&&k(0,function(){a(["dijit/MenuItem","dijit/PopupMenuItem","dijit/CheckedMenuItem","dijit/MenuSeparator"])});return c("dijit.Menu",q,{constructor:function(){this._bindings=[]},targetNodeIds:[],selector:"",contextMenuForWindow:!1,leftClickToOpen:!1,refocus:!0,postCreate:function(){this.contextMenuForWindow?this.bindDomNode(this.ownerDocumentBody):b.forEach(this.targetNodeIds,this.bindDomNode,this);this.inherited(arguments)},_iframeContentWindow:function(r){return p.get(this._iframeContentDocument(r))||
this._iframeContentDocument(r).__parent__||r.name&&document.frames[r.name]||null},_iframeContentDocument:function(r){return r.contentDocument||r.contentWindow&&r.contentWindow.document||r.name&&document.frames[r.name]&&document.frames[r.name].document||null},bindDomNode:function(r){r=n.byId(r,this.ownerDocument);if("iframe"==r.tagName.toLowerCase()){var y=r;var f=this._iframeContentWindow(y);f=g.body(f.document)}else f=r==g.body(this.ownerDocument)?this.ownerDocument.documentElement:r;var w={node:r,
iframe:y};l.set(r,"_dijitMenu"+this.id,this._bindings.push(w));var z=h.hitch(this,function(A){var x=this.selector,B=x?function(D){return d.selector(x,D)}:function(D){return D},C=this;return[d(A,B(this.leftClickToOpen?"click":"contextmenu"),function(D){D.stopPropagation();D.preventDefault();(new Date).getTime()<C._lastKeyDown+500||C._scheduleOpen(this,y,{x:D.pageX,y:D.pageY},D.target)}),d(A,B("keydown"),function(D){if(93==D.keyCode||D.shiftKey&&D.keyCode==m.F10||C.leftClickToOpen&&D.keyCode==m.SPACE)D.stopPropagation(),
D.preventDefault(),C._scheduleOpen(this,y,null,D.target),C._lastKeyDown=(new Date).getTime()})]});w.connects=f?z(f):[];y&&(w.onloadHandler=h.hitch(this,function(){var A=this._iframeContentWindow(y);A=g.body(A.document);w.connects=z(A)}),y.addEventListener?y.addEventListener("load",w.onloadHandler,!1):y.attachEvent("onload",w.onloadHandler))},unBindDomNode:function(r){try{var y=n.byId(r,this.ownerDocument)}catch(A){return}r="_dijitMenu"+this.id;if(y&&l.has(y,r)){for(var f=l.get(y,r)-1,w=this._bindings[f],
z;z=w.connects.pop();)z.remove();(z=w.iframe)&&(z.removeEventListener?z.removeEventListener("load",w.onloadHandler,!1):z.detachEvent("onload",w.onloadHandler));l.remove(y,r);delete this._bindings[f]}},_scheduleOpen:function(r,y,f,w){this._openTimer||(this._openTimer=this.defer(function(){delete this._openTimer;this._openMyself({target:w,delegatedTarget:r,iframe:y,coords:f})},1))},_openMyself:function(r){function y(){D.refocus&&E&&E.focus();t.close(D)}var f=r.target,w=r.iframe,z=r.coords,A=!z;this.currentTarget=
r.delegatedTarget;if(z){if(w){r=u.position(w,!0);f=this._iframeContentWindow(w);f=u.docScroll(f.document);var x=v.getComputedStyle(w),B=v.toPixelValue,C=(e("ie"),B(w,x.paddingLeft))+(e("ie"),0);w=(e("ie"),B(w,x.paddingTop))+(e("ie"),0);z.x+=r.x+C-f.x;z.y+=r.y+w-f.y}}else z=u.position(f,!0),z.x+=10,z.y+=10;var D=this;w=this._focusManager.get("prevNode");r=this._focusManager.get("curNode");var E=!r||n.isDescendant(r,this.domNode)?w:r;t.open({popup:this,x:z.x,y:z.y,onExecute:y,onCancel:y,orient:this.isLeftToRight()?
"L":"R"});this.focus();A||this.defer(function(){this._cleanUp(!0)});this._onBlur=function(){this.inherited("_onBlur",arguments);t.close(this)}},destroy:function(){b.forEach(this._bindings,function(r){r&&this.unBindDomNode(r.node)},this);this.inherited(arguments)}})})},"dijit/popup":function(){define("dojo/_base/array dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on ./place ./BackgroundIframe ./Viewport ./main dojo/touch".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){function r(){this._popupWrapper&&(u.destroy(this._popupWrapper),delete this._popupWrapper)}c=c(null,{_stack:[],_beginZIndex:1E3,_idGen:1,_repositionAll:function(){if(this._firstAroundNode){var y=this._firstAroundPosition,f=v.position(this._firstAroundNode,!0),w=f.x-y.x;y=f.y-y.y;if(w||y)for(this._firstAroundPosition=f,f=0;f<this._stack.length;f++){var z=this._stack[f].wrapper.style;z.top=parseFloat(z.top)+y+"px";"auto"==z.right?z.left=parseFloat(z.left)+w+
"px":z.right=parseFloat(z.right)-w+"px"}this._aroundMoveListener=setTimeout(e.hitch(this,"_repositionAll"),w||y?10:50)}},_createWrapper:function(y){var f=y._popupWrapper,w=y.domNode;f||(f=u.create("div",{"class":"dijitPopup",style:{display:"none"},role:"region","aria-label":y["aria-label"]||y.label||y.name||y.id},y.ownerDocumentBody),f.appendChild(w),w=w.style,w.display="",w.visibility="",w.position="",w.top="0px",y._popupWrapper=f,b.after(y,"destroy",r,!0),"ontouchend"in document&&g(f,"touchend",
function(z){/^(input|button|textarea)$/i.test(z.target.tagName)||z.preventDefault()}),f.dojoClick=!0);return f},moveOffScreen:function(y){var f=this._createWrapper(y);y=v.isBodyLtr(y.ownerDocument);var w={visibility:"hidden",top:"-9999px",display:""};w[y?"left":"right"]="-9999px";w[y?"right":"left"]="auto";m.set(f,w);return f},hide:function(y){var f=this._createWrapper(y);m.set(f,{display:"none",height:"auto",overflowY:"visible",border:""});y=y.domNode;"_originalStyle"in y&&(y.style.cssText=y._originalStyle)},
getTopPopup:function(){for(var y=this._stack,f=y.length-1;0<f&&y[f].parent===y[f-1].widget;f--);return y[f]},open:function(y){for(var f=this._stack,w=y.popup,z=w.domNode,A=y.orient||["below","below-alt","above","above-alt"],x=y.parent?y.parent.isLeftToRight():v.isBodyLtr(w.ownerDocument),B=y.around,C=y.around&&y.around.id?y.around.id+"_dropdown":"popup_"+this._idGen++;f.length&&(!y.parent||!n.isDescendant(y.parent.domNode,f[f.length-1].widget.domNode));)this.close(f[f.length-1].widget);var D=this.moveOffScreen(w);
w.startup&&!w._started&&w.startup();var E=v.position(z);if("maxHeight"in y&&-1!=y.maxHeight)var F=y.maxHeight||Infinity;else{F=q.getEffectiveBox(this.ownerDocument);var G=B?v.position(B,!1):{y:y.y-(y.padding||0),h:2*(y.padding||0)};F=Math.floor(Math.max(G.y,F.h-(G.y+G.h)))}E.h>F&&(E=m.getComputedStyle(z),m.set(D,{overflowY:"scroll",height:F+"px",border:E.borderLeftWidth+" "+E.borderLeftStyle+" "+E.borderLeftColor}),z._originalStyle=z.style.cssText,z.style.border="none");l.set(D,{id:C,style:{zIndex:this._beginZIndex+
f.length},"class":"dijitPopup "+(w.baseClass||w["class"]||"").split(" ")[0]+"Popup",dijitPopupParent:y.parent?y.parent.id:""});0==f.length&&B&&(this._firstAroundNode=B,this._firstAroundPosition=v.position(B,!0),this._aroundMoveListener=setTimeout(e.hitch(this,"_repositionAll"),50));h("config-bgIframe")&&!w.bgIframe&&(w.bgIframe=new t(D));C=w.orient?e.hitch(w,"orient"):null;A=B?p.around(D,B,A,x,C):p.at(D,y,"R"==A?["TR","BR","TL","BL"]:["TL","BL","TR","BR"],y.padding,C);D.style.visibility="visible";
z.style.visibility="visible";z=[];z.push(g(D,"keydown",e.hitch(this,function(O){if(O.keyCode==d.ESCAPE&&y.onCancel)O.stopPropagation(),O.preventDefault(),y.onCancel();else if(O.keyCode==d.TAB&&(O.stopPropagation(),O.preventDefault(),(O=this.getTopPopup())&&O.onCancel))O.onCancel()})));w.onCancel&&y.onCancel&&z.push(w.on("cancel",y.onCancel));z.push(w.on(w.onExecute?"execute":"change",e.hitch(this,function(){var O=this.getTopPopup();if(O&&O.onExecute)O.onExecute()})));f.push({widget:w,wrapper:D,parent:y.parent,
onExecute:y.onExecute,onCancel:y.onCancel,onClose:y.onClose,handlers:z});if(w.onOpen)w.onOpen(A);return A},close:function(y){for(var f=this._stack;y&&a.some(f,function(B){return B.widget==y})||!y&&f.length;){var w=f.pop(),z=w.widget,A=w.onClose;z.bgIframe&&(z.bgIframe.destroy(),delete z.bgIframe);if(z.onClose)z.onClose();for(var x;x=w.handlers.pop();)x.remove();z&&z.domNode&&this.hide(z);A&&A()}0==f.length&&this._aroundMoveListener&&(clearTimeout(this._aroundMoveListener),this._firstAroundNode=this._firstAroundPosition=
this._aroundMoveListener=null)}});return k.popup=new c})},"dijit/place":function(){define("dojo/_base/array dojo/dom-geometry dojo/dom-style dojo/_base/kernel dojo/_base/window ./Viewport ./main".split(" "),function(a,b,c,n,l,u,v){function m(d,e,g,p){var t=u.getEffectiveBox(d.ownerDocument);d.parentNode&&"body"==String(d.parentNode.tagName).toLowerCase()||l.body(d.ownerDocument).appendChild(d);var q=null;a.some(e,function(y){var f=y.corner,w=y.pos,z=0,A={w:{L:t.l+t.w-w.x,R:w.x-t.l,M:t.w}[f.charAt(1)],
h:{T:t.t+t.h-w.y,B:w.y-t.t,M:t.h}[f.charAt(0)]},x=d.style;x.left=x.right="auto";g&&(z=g(d,y.aroundCorner,f,A,p),z="undefined"==typeof z?0:z);var B=d.style,C=B.display,D=B.visibility;"none"==B.display&&(B.visibility="hidden",B.display="");x=b.position(d);B.display=C;B.visibility=D;C={L:w.x,R:w.x-x.w,M:Math.max(t.l,Math.min(t.l+t.w,w.x+(x.w>>1))-x.w)}[f.charAt(1)];D={T:w.y,B:w.y-x.h,M:Math.max(t.t,Math.min(t.t+t.h,w.y+(x.h>>1))-x.h)}[f.charAt(0)];w=Math.max(t.l,C);B=Math.max(t.t,D);C=Math.min(t.l+t.w,
C+x.w)-w;D=Math.min(t.t+t.h,D+x.h)-B;z+=x.w-C+(x.h-D);if(null==q||z<q.overflow)q={corner:f,aroundCorner:y.aroundCorner,x:w,y:B,w:C,h:D,overflow:z,spaceAvailable:A};return!z});q.overflow&&g&&g(d,q.aroundCorner,q.corner,q.spaceAvailable,p);e=q.y;var k=q.x,r=l.body(d.ownerDocument);/relative|absolute/.test(c.get(r,"position"))&&(e-=c.get(r,"marginTop"),k-=c.get(r,"marginLeft"));r=d.style;r.top=e+"px";r.left=k+"px";r.right="auto";return q}var h={TL:"BR",TR:"BL",BL:"TR",BR:"TL"};return v.place={at:function(d,
e,g,p,t){g=a.map(g,function(q){var k={corner:q,aroundCorner:h[q],pos:{x:e.x,y:e.y}};p&&(k.pos.x+="L"==q.charAt(1)?p.x:-p.x,k.pos.y+="T"==q.charAt(0)?p.y:-p.y);return k});return m(d,g,t)},around:function(d,e,g,p,t){function q(E,F){D.push({aroundCorner:E,corner:F,pos:{x:{L:A,R:A+B,M:A+(B>>1)}[E.charAt(1)],y:{T:x,B:x+C,M:x+(C>>1)}[E.charAt(0)]}})}if("string"==typeof e||"offsetWidth"in e||"ownerSVGElement"in e){var k=b.position(e,!0);if(/^(above|below)/.test(g[0])){var r=b.getBorderExtents(e),y=e.firstChild?
b.getBorderExtents(e.firstChild):{t:0,l:0,b:0,r:0},f=b.getBorderExtents(d),w=d.firstChild?b.getBorderExtents(d.firstChild):{t:0,l:0,b:0,r:0};k.y+=Math.min(r.t+y.t,f.t+w.t);k.h-=Math.min(r.t+y.t,f.t+w.t)+Math.min(r.b+y.b,f.b+w.b)}}else k=e;if(e.parentNode)for(r="absolute"==c.getComputedStyle(e).position,e=e.parentNode;e&&1==e.nodeType&&"BODY"!=e.nodeName;){y=b.position(e,!0);f=c.getComputedStyle(e);/relative|absolute/.test(f.position)&&(r=!1);if(!r&&/hidden|auto|scroll/.test(f.overflow)){w=Math.min(k.y+
k.h,y.y+y.h);var z=Math.min(k.x+k.w,y.x+y.w);k.x=Math.max(k.x,y.x);k.y=Math.max(k.y,y.y);k.h=w-k.y;k.w=z-k.x}"absolute"==f.position&&(r=!0);e=e.parentNode}var A=k.x,x=k.y,B="w"in k?k.w:k.w=k.width,C="h"in k?k.h:(n.deprecated("place.around: dijit/place.__Rectangle: { x:"+A+", y:"+x+", height:"+k.height+", width:"+B+" } has been deprecated.  Please use { x:"+A+", y:"+x+", h:"+k.height+", w:"+B+" }","","2.0"),k.h=k.height),D=[];a.forEach(g,function(E){var F=p;switch(E){case "above-centered":q("TM","BM");
break;case "below-centered":q("BM","TM");break;case "after-centered":F=!F;case "before-centered":q(F?"ML":"MR",F?"MR":"ML");break;case "after":F=!F;case "before":q(F?"TL":"TR",F?"TR":"TL");q(F?"BL":"BR",F?"BR":"BL");break;case "below-alt":F=!F;case "below":q(F?"BL":"BR",F?"TL":"TR");q(F?"BR":"BL",F?"TR":"TL");break;case "above-alt":F=!F;case "above":q(F?"TL":"TR",F?"BL":"BR");q(F?"TR":"TL",F?"BR":"BL");break;default:q(E.aroundCorner,E.corner)}});d=m(d,D,t,{w:B,h:C});d.aroundNodePos=k;return d}}})},
"dijit/BackgroundIframe":function(){define("require ./main dojo/_base/config dojo/dom-construct dojo/dom-style dojo/_base/lang dojo/on dojo/sniff".split(" "),function(a,b,c,n,l,u,v,m){m.add("config-bgIframe",(m("ie")||0)&&!/IEMobile\/10\.0/.test(navigator.userAgent));var h=new function(){var d=[];this.pop=function(){if(d.length){var e=d.pop();e.style.display=""}else 9>m("ie")?(e=c.dojoBlankHtmlUrl||a.toUrl("dojo/resources/blank.html")||'javascript:""',e=document.createElement("\x3ciframe src\x3d'"+
e+"' role\x3d'presentation' style\x3d'position: absolute; left: 0px; top: 0px;z-index: -1; filter:Alpha(Opacity\x3d\"0\");'\x3e")):(e=n.create("iframe"),e.src='javascript:""',e.className="dijitBackgroundIframe",e.setAttribute("role","presentation"),l.set(e,"opacity",.1)),e.tabIndex=-1;return e};this.push=function(e){e.style.display="none";d.push(e)}};b.BackgroundIframe=function(d){if(!d.id)throw Error("no id");if(m("config-bgIframe")){var e=this.iframe=h.pop();d.appendChild(e);7>m("ie")?(this.resize(d),
this._conn=v(d,"resize",u.hitch(this,"resize",d))):l.set(e,{width:"100%",height:"100%"})}};u.extend(b.BackgroundIframe,{resize:function(d){this.iframe&&l.set(this.iframe,{width:d.offsetWidth+"px",height:d.offsetHeight+"px"})},destroy:function(){this._conn&&(this._conn.remove(),this._conn=null);this.iframe&&(this.iframe.parentNode.removeChild(this.iframe),h.push(this.iframe),delete this.iframe)}});return b.BackgroundIframe})},"dijit/DropDownMenu":function(){define(["dojo/_base/declare","dojo/keys",
"dojo/text!./templates/Menu.html","./_MenuBase"],function(a,b,c,n){return a("dijit.DropDownMenu",n,{templateString:c,baseClass:"dijitMenu",_onUpArrow:function(){this.focusPrev()},_onDownArrow:function(){this.focusNext()},_onRightArrow:function(l){this._moveToPopup(l);l.stopPropagation();l.preventDefault()},_onLeftArrow:function(l){if(this.parentMenu)if(this.parentMenu._isMenuBar)this.parentMenu.focusPrev();else this.onCancel(!1);else l.stopPropagation(),l.preventDefault()}})})},"dijit/_MenuBase":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/lang dojo/mouse dojo/on dojo/window ./a11yclick ./registry ./_Widget ./_CssStateMixin ./_KeyNavContainer ./_TemplatedMixin".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q){return b("dijit._MenuBase",[g,q,t,p],{selected:null,_setSelectedAttr:function(k){this.selected!=k&&(this.selected&&(this.selected._setSelected(!1),this._onChildDeselect(this.selected)),k&&k._setSelected(!0),this._set("selected",k))},activated:!1,_setActivatedAttr:function(k){l.toggle(this.domNode,"dijitMenuActive",k);l.toggle(this.domNode,"dijitMenuPassive",!k);this._set("activated",k)},parentMenu:null,popupDelay:500,passivePopupDelay:Infinity,autoFocus:!1,
childSelector:function(k){var r=e.byNode(k);return k.parentNode==this.containerNode&&r&&r.focus},postCreate:function(){var k=this,r="string"==typeof this.childSelector?this.childSelector:u.hitch(this,"childSelector");this.own(m(this.containerNode,m.selector(r,v.enter),function(){k.onItemHover(e.byNode(this))}),m(this.containerNode,m.selector(r,v.leave),function(){k.onItemUnhover(e.byNode(this))}),m(this.containerNode,m.selector(r,d),function(y){k.onItemClick(e.byNode(this),y);y.stopPropagation()}),
m(this.containerNode,m.selector(r,"focusin"),function(){k._onItemFocus(e.byNode(this))}));this.inherited(arguments)},onKeyboardSearch:function(k,r,y,f){this.inherited(arguments);if(k&&(-1==f||k.popup&&1==f))this.onItemClick(k,r)},_keyboardSearchCompare:function(k,r){return k.shortcutKey?r==k.shortcutKey.toLowerCase()?-1:0:this.inherited(arguments)?1:0},onExecute:function(){},onCancel:function(){},_moveToPopup:function(k){if(this.focusedChild&&this.focusedChild.popup&&!this.focusedChild.disabled)this.onItemClick(this.focusedChild,
k);else(k=this._getTopMenu())&&k._isMenuBar&&k.focusNext()},_onPopupHover:function(){this.set("selected",this.currentPopupItem);this._stopPendingCloseTimer()},onItemHover:function(k){this.activated?(this.set("selected",k),!k.popup||k.disabled||this.hover_timer||(this.hover_timer=this.defer(function(){this._openItemPopup(k)},this.popupDelay))):Infinity>this.passivePopupDelay&&(this.passive_hover_timer&&this.passive_hover_timer.remove(),this.passive_hover_timer=this.defer(function(){this.onItemClick(k,
{type:"click"})},this.passivePopupDelay));this._hoveredChild=k;k._set("hovering",!0)},_onChildDeselect:function(k){this._stopPopupTimer();this.currentPopupItem==k&&(this._stopPendingCloseTimer(),this._pendingClose_timer=this.defer(function(){this.currentPopupItem=this._pendingClose_timer=null;k._closePopup()},this.popupDelay))},onItemUnhover:function(k){this._hoveredChild==k&&(this._hoveredChild=null);this.passive_hover_timer&&(this.passive_hover_timer.remove(),this.passive_hover_timer=null);k._set("hovering",
!1)},_stopPopupTimer:function(){this.hover_timer&&(this.hover_timer=this.hover_timer.remove())},_stopPendingCloseTimer:function(){this._pendingClose_timer&&(this._pendingClose_timer=this._pendingClose_timer.remove())},_getTopMenu:function(){for(var k=this;k.parentMenu;k=k.parentMenu);return k},onItemClick:function(k,r){this.passive_hover_timer&&this.passive_hover_timer.remove();this.focusChild(k);if(k.disabled)return!1;k.popup?(this.set("selected",k),this.set("activated",!0),r=/^key/.test(r._origType||
r.type)||0==r.clientX&&0==r.clientY,this._openItemPopup(k,r)):(this.onExecute(),k._onClick?k._onClick(r):k.onClick(r))},_openItemPopup:function(k,r){if(k!=this.currentPopupItem){this.currentPopupItem&&(this._stopPendingCloseTimer(),this.currentPopupItem._closePopup());this._stopPopupTimer();var y=k.popup;y.parentMenu=this;this.own(this._mouseoverHandle=m.once(y.domNode,"mouseover",u.hitch(this,"_onPopupHover")));var f=this;k._openPopup({parent:this,orient:this._orient||["after","before"],onCancel:function(){r&&
f.focusChild(k);f._cleanUp()},onExecute:u.hitch(this,"_cleanUp",!0),onClose:function(){f._mouseoverHandle&&(f._mouseoverHandle.remove(),delete f._mouseoverHandle)}},r);this.currentPopupItem=k}},onOpen:function(){this.isShowingNow=!0;this.set("activated",!0)},onClose:function(){this.set("activated",!1);this.set("selected",null);this.isShowingNow=!1;this.parentMenu=null},_closeChild:function(){this._stopPopupTimer();this.currentPopupItem&&(this.focused&&(n.set(this.selected.focusNode,"tabIndex",this.tabIndex),
this.selected.focusNode.focus()),this.currentPopupItem._closePopup(),this.currentPopupItem=null)},_onItemFocus:function(k){if(this._hoveredChild&&this._hoveredChild!=k)this.onItemUnhover(this._hoveredChild);this.set("selected",k)},_onBlur:function(){this._cleanUp(!0);this.inherited(arguments)},_cleanUp:function(k){this._closeChild();"undefined"==typeof this.isShowingNow&&this.set("activated",!1);k&&this.set("selected",null)}})})},"dijit/_CssStateMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/dom-class dojo/has dojo/_base/lang dojo/on dojo/domReady dojo/touch dojo/_base/window ./a11yclick ./registry".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){b=b("dijit._CssStateMixin",[],{hovering:!1,active:!1,_applyAttributes:function(){this.inherited(arguments);a.forEach("disabled readOnly checked selected focused state hovering active _opened".split(" "),function(t){this.watch(t,u.hitch(this,"_setStateClass"))},this);for(var p in this.cssStateNodes||{})this._trackMouseState(this[p],this.cssStateNodes[p]);this._trackMouseState(this.domNode,this.baseClass);this._setStateClass()},_cssMouseEvent:function(p){if(!this.disabled)switch(p.type){case "mouseover":case "MSPointerOver":case "pointerover":this._set("hovering",
!0);this._set("active",this._mouseDown);break;case "mouseout":case "MSPointerOut":case "pointerout":this._set("hovering",!1);this._set("active",!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":this._set("active",!0);break;case "mouseup":case "dojotouchend":case "MSPointerUp":case "pointerup":case "keyup":this._set("active",!1)}},_setStateClass:function(){function p(f){t=t.concat(a.map(t,function(w){return w+f}),"dijit"+f)}var t=this.baseClass.split(" ");
this.isLeftToRight()||p("Rtl");var q="mixed"==this.checked?"Mixed":this.checked?"Checked":"";this.checked&&p(q);this.state&&p(this.state);this.selected&&p("Selected");this._opened&&p("Opened");this.disabled?p("Disabled"):this.readOnly?p("ReadOnly"):this.active?p("Active"):this.hovering&&p("Hover");this.focused&&p("Focused");q=this.stateNode||this.domNode;var k={};a.forEach(q.className.split(" "),function(f){k[f]=!0});"_stateClasses"in this&&a.forEach(this._stateClasses,function(f){delete k[f]});a.forEach(t,
function(f){k[f]=!0});var r=[],y;for(y in k)r.push(y);q.className=r.join(" ");this._stateClasses=t},_subnodeCssMouseEvent:function(p,t,q){function k(r){n.toggle(p,t+"Active",r)}if(!this.disabled&&!this.readOnly)switch(q.type){case "mouseover":case "MSPointerOver":case "pointerover":n.toggle(p,t+"Hover",!0);break;case "mouseout":case "MSPointerOut":case "pointerout":n.toggle(p,t+"Hover",!1);k(!1);break;case "mousedown":case "touchstart":case "MSPointerDown":case "pointerdown":case "keydown":k(!0);
break;case "mouseup":case "MSPointerUp":case "pointerup":case "dojotouchend":case "keyup":k(!1);break;case "focus":case "focusin":n.toggle(p,t+"Focused",!0);break;case "blur":case "focusout":n.toggle(p,t+"Focused",!1)}},_trackMouseState:function(p,t){p._cssState=t}});m(function(){function p(k,r,y){if(!y||!c.isDescendant(y,r))for(;r&&r!=y;r=r.parentNode)if(r._cssState){var f=g.getEnclosingWidget(r);f&&(r==f.domNode?f._cssMouseEvent(k):f._subnodeCssMouseEvent(r,r._cssState,k))}}var t=d.body(),q;v(t,
h.over,function(k){p(k,k.target,k.relatedTarget)});v(t,h.out,function(k){p(k,k.target,k.relatedTarget)});v(t,e.press,function(k){q=k.target;p(k,q)});v(t,e.release,function(k){p(k,q);q=null});v(t,"focusin, focusout",function(k){var r=k.target;if(r._cssState&&!r.getAttribute("widgetId")){var y=g.getEnclosingWidget(r);y&&y._subnodeCssMouseEvent(r,r._cssState,k)}})});return b})},"dijit/_KeyNavContainer":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/_base/kernel dojo/keys dojo/_base/lang ./registry ./_Container ./_FocusMixin ./_KeyNavMixin".split(" "),
function(a,b,c,n,l,u,v,m,h,d){return b("dijit._KeyNavContainer",[h,d,m],{connectKeyNavHandlers:function(e,g){var p=this._keyNavCodes={},t=u.hitch(this,"focusPrev"),q=u.hitch(this,"focusNext");a.forEach(e,function(k){p[k]=t});a.forEach(g,function(k){p[k]=q});p[l.HOME]=u.hitch(this,"focusFirstChild");p[l.END]=u.hitch(this,"focusLastChild")},startupKeyNavChildren:function(){n.deprecated("startupKeyNavChildren() call no longer needed","","2.0")},startup:function(){this.inherited(arguments);a.forEach(this.getChildren(),
u.hitch(this,"_startupChild"))},addChild:function(e,g){this.inherited(arguments);this._startupChild(e)},_startupChild:function(e){e.set("tabIndex","-1")},_getFirst:function(){var e=this.getChildren();return e.length?e[0]:null},_getLast:function(){var e=this.getChildren();return e.length?e[e.length-1]:null},focusNext:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,1))},focusPrev:function(){this.focusChild(this._getNextFocusableChild(this.focusedChild,-1),!0)},childSelector:function(e){return(e=
v.byNode(e))&&e.getParent()==this}})})},"dijit/_KeyNavMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dijit/registry dijit/_FocusMixin".split(" "),function(a,b,c,n,l,u,v,m){return b("dijit._KeyNavMixin",m,{tabIndex:"0",childSelector:null,postCreate:function(){this.inherited(arguments);c.set(this.domNode,"tabIndex",this.tabIndex);if(!this._keyNavCodes){var h=this._keyNavCodes={};h[n.HOME]=l.hitch(this,"focusFirstChild");h[n.END]=l.hitch(this,
"focusLastChild");h[this.isLeftToRight()?n.LEFT_ARROW:n.RIGHT_ARROW]=l.hitch(this,"_onLeftArrow");h[this.isLeftToRight()?n.RIGHT_ARROW:n.LEFT_ARROW]=l.hitch(this,"_onRightArrow");h[n.UP_ARROW]=l.hitch(this,"_onUpArrow");h[n.DOWN_ARROW]=l.hitch(this,"_onDownArrow")}var d=this;h="string"==typeof this.childSelector?this.childSelector:l.hitch(this,"childSelector");this.own(u(this.domNode,"keypress",l.hitch(this,"_onContainerKeypress")),u(this.domNode,"keydown",l.hitch(this,"_onContainerKeydown")),u(this.domNode,
"focus",l.hitch(this,"_onContainerFocus")),u(this.containerNode,u.selector(h,"focusin"),function(e){d._onChildFocus(v.getEnclosingWidget(this),e)}))},_onLeftArrow:function(){},_onRightArrow:function(){},_onUpArrow:function(){},_onDownArrow:function(){},focus:function(){this.focusFirstChild()},_getFirstFocusableChild:function(){return this._getNextFocusableChild(null,1)},_getLastFocusableChild:function(){return this._getNextFocusableChild(null,-1)},focusFirstChild:function(){this.focusChild(this._getFirstFocusableChild())},
focusLastChild:function(){this.focusChild(this._getLastFocusableChild())},focusChild:function(h,d){h&&(this.focusedChild&&h!==this.focusedChild&&this._onChildBlur(this.focusedChild),h.set("tabIndex",this.tabIndex),h.focus(d?"end":"start"))},_onContainerFocus:function(h){h.target!==this.domNode||this.focusedChild||this.focus()},_onFocus:function(){c.set(this.domNode,"tabIndex","-1");this.inherited(arguments)},_onBlur:function(h){c.set(this.domNode,"tabIndex",this.tabIndex);this.focusedChild&&(this.focusedChild.set("tabIndex",
"-1"),this.lastFocusedChild=this.focusedChild,this._set("focusedChild",null));this.inherited(arguments)},_onChildFocus:function(h){h&&h!=this.focusedChild&&(this.focusedChild&&!this.focusedChild._destroyed&&this.focusedChild.set("tabIndex","-1"),h.set("tabIndex",this.tabIndex),this.lastFocused=h,this._set("focusedChild",h))},_searchString:"",multiCharSearchDuration:1E3,onKeyboardSearch:function(h,d,e,g){h&&this.focusChild(h)},_keyboardSearchCompare:function(h,d){var e=h.domNode;h=(h.label||(e.focusNode?
e.focusNode.label:"")||e.innerText||e.textContent||"").replace(/^\s+/,"").substr(0,d.length).toLowerCase();return d.length&&h==d?-1:0},_isFormElement:function(h){return"INPUT"===h.tagName||"TEXTAREA"===h.tagName||"SELECT"===h.tagName||"BUTTON"===h.tagName},_onContainerKeydown:function(h){if(!this._isFormElement(document.activeElement)){var d=this._keyNavCodes[h.keyCode];d?(d(h,this.focusedChild),h.stopPropagation(),h.preventDefault(),this._searchString=""):h.keyCode!=n.SPACE||!this._searchTimer||
h.ctrlKey||h.altKey||h.metaKey||(h.stopImmediatePropagation(),h.preventDefault(),this._keyboardSearch(h," "))}},_onContainerKeypress:function(h){this._isFormElement(document.activeElement)||h.charCode<=n.SPACE||h.ctrlKey||h.altKey||h.metaKey||(h.preventDefault(),h.stopPropagation(),this._keyboardSearch(h,String.fromCharCode(h.charCode).toLowerCase()))},_keyboardSearch:function(h,d){var e=null,g,p=0;l.hitch(this,function(){this._searchTimer&&this._searchTimer.remove();this._searchString+=d;var t=/^(.)\1*$/.test(this._searchString)?
1:this._searchString.length;g=this._searchString.substr(0,t);this._searchTimer=this.defer(function(){this._searchTimer=null;this._searchString=""},this.multiCharSearchDuration);var q=this.focusedChild||null;if(1==t||!q)if(q=this._getNextFocusableChild(q,1),!q)return;t=q;do{var k=this._keyboardSearchCompare(q,g);k&&0==p++&&(e=q);if(-1==k){p=-1;break}q=this._getNextFocusableChild(q,1)}while(q&&q!=t)})();this.onKeyboardSearch(e,h,g,p)},_onChildBlur:function(){},_getNextFocusableChild:function(h,d){var e=
h;do{if(h)h=this._getNext(h,d);else if(h=this[0<d?"_getFirst":"_getLast"](),!h)break;if(null!=h&&h!=e&&h.isFocusable())return h}while(h!=e);return null},_getFirst:function(){return null},_getLast:function(){return null},_getNext:function(h,d){if(h)for(h=h.domNode;h;)if((h=h[0>d?"previousSibling":"nextSibling"])&&"getAttribute"in h){var e=v.byNode(h);if(e)return e}return null}})})},"dgrid/main":function(){define([],1)},"dgrid/OnDemandGrid":function(){define(["dojo/_base/declare","./Grid","./OnDemandList"],
function(a,b,c){return a([b,c],{})})},"dgrid/Grid":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/dom-class dojo/on dojo/has ./List ./util/misc dojo/_base/sniff".split(" "),function(a,b,c,n,l,u,v,m){function h(d,e){e&&e.nodeType&&d.appendChild(e)}a=a(v,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(d){return"object"!==typeof d?this.columns[d]:this.cell(d).column},listType:"grid",cell:function(d,e){if(d.column&&d.element)return d;
d.target&&d.target.nodeType&&(d=d.target);if(d.nodeType){do{if(this._rowIdToObject[d.id])break;var g=d.columnId;if(g){e=g;var p=d;break}d=d.parentNode}while(d&&d!==this.domNode)}if(!p&&"undefined"!==typeof e){var t=this.row(d);if(g=t&&t.element){g=g.getElementsByTagName("td");for(var q=0;q<g.length;q++)if(g[q].columnId===e){p=g[q];break}}}if(null!=d)return{row:t||this.row(d),column:e&&this.column(e),element:p}},createRowCells:function(d,e,g,p,t){var q=c.create("table",{className:"dgrid-row-table",
role:"presentation"}),k=9>u("ie")?c.create("tbody",null,q):q,r,y,f;g=g||this.subRows;var w=0;for(r=g.length;w<r;w++){var z=g[w];var A=c.create("tr",null,k);z.className&&(A.className=z.className);var x=0;for(y=z.length;x<y;x++){var B=z[x];var C=B.id;var D=B.field?" field-"+m.escapeCssIdentifier(B.field,"-"):"";(f="function"===typeof B.className?B.className(p):B.className)&&(D+=" "+f);D=c.create(d,{className:"dgrid-cell"+(C?" dgrid-column-"+m.escapeCssIdentifier(C,"-"):"")+D,role:"th"===d?"columnheader":
"gridcell"});D.columnId=C;if(C=B.colSpan)D.colSpan=C;if(C=B.rowSpan)D.rowSpan=C;e(D,B,p,t);A.appendChild(D)}}return q},_createBodyRowCell:function(d,e,g,p){var t=g;e.get?t=e.get(g):"field"in e&&"_item"!==e.field&&(t=g[e.field]);e.renderCell?h(d,e.renderCell(g,t,d,p)):this._defaultRenderCell.call(e,g,t,d,p)},_createHeaderRowCell:function(d,e){var g=e.headerNode=d,p=e.field;p&&(d.field=p);e.renderHeaderCell?h(g,e.renderHeaderCell(g)):("label"in e||e.field)&&g.appendChild(document.createTextNode("label"in
e?e.label:e.field));!1!==e.sortable&&p&&"_item"!==p&&(d.sortable=!0,d.className+=" dgrid-sortable")},left:function(d,e){d.element||(d=this.cell(d));return this.cell(this._move(d,-(e||1),"dgrid-cell"))},right:function(d,e){d.element||(d=this.cell(d));return this.cell(this._move(d,e||1,"dgrid-cell"))},_defaultRenderCell:function(d,e,g){if(this.formatter){var p=this.formatter,t=this.grid.formatterScope;d="string"===typeof p&&t?t[p](e,d):this.formatter(e,d);null!=d&&d.hasOwnProperty("html")?g.innerHTML=
d.html:null!=d&&g.appendChild(document.createTextNode(d))}else null!=e&&g.appendChild(document.createTextNode(e))},renderRow:function(d,e){d=this.createRowCells("td",b.hitch(this,"_createBodyRowCell"),e&&e.subRows,d,e);e=c.create("div",{role:"row"});e.appendChild(d);return e},renderHeader:function(){var d=this,e=this.headerNode;e.setAttribute("role","row");c.empty(e);var g=this.createRowCells("th",b.hitch(this,"_createHeaderRowCell"),this.subRows&&this.subRows.headerRows);this._rowIdToObject[g.id=
this.id+"-header"]=this.columns;e.appendChild(g);this._sortListener&&this._sortListener.remove();this._sortListener=l(g,"click,keydown",function(p){if("click"===p.type||32===p.keyCode||!u("opera")&&13===p.keyCode){var t=p.target;do if(t.sortable){var q=t.field||t.columnId;var k=d.sort[0];q=d.hasNeutralSort&&k&&k.property===q&&k.descending?[]:[{property:q,descending:k&&k.property===q&&!k.descending}];k={bubbles:!0,cancelable:!0,grid:d,parentType:p.type,sort:q};l.emit(p.target,"dgrid-sort",k)&&(d._sortNode=
t,d.set("sort",q));break}while((t=t.parentNode)&&t!==e)}})},resize:function(){var d=this.headerNode.firstChild,e=this.contentNode,g;this.inherited(arguments);e.style.width="";e&&d&&(g=d.offsetWidth)>e.offsetWidth&&(e.style.width=g+"px")},destroy:function(){this._destroyColumns();this._sortListener&&this._sortListener.remove();this.inherited(arguments)},_setSort:function(){this.inherited(arguments);this.updateSortArrow(this.sort)},_findSortArrowParent:function(d){var e=this.columns,g;for(g in e){var p=
e[g];if(p.field===d)return p.headerNode}},updateSortArrow:function(d,e){this._lastSortedArrow&&(this._lastSortedArrow.parentNode&&n.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),c.destroy(this._lastSortedArrow),delete this._lastSortedArrow);e&&(this.sort=d);d[0]&&(e=d[0].property,d=d[0].descending,e=this._sortNode||this._findSortArrowParent(e),delete this._sortNode,e&&(e=e.contents||e,this._lastSortedArrow=c.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"\x26nbsp;",
role:"presentation"},e,"first"),n.add(e,"dgrid-sort-"+(d?"down":"up")),this.resize()))},styleColumn:function(d,e){return this.addCssRule("#"+m.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+m.escapeCssIdentifier(d,"-"),e)},_configColumns:function(d,e){var g=[],p=e instanceof Array;m.each(e,function(t,q){"string"===typeof t&&(e[q]=t={label:t});p||t.field||(t.field=q);q=t.id=t.id||(isNaN(q)?q:d+q);this._configColumn&&(this._configColumn(t,e,d),q=t.id);p&&(this.columns[q]=t);t.grid?t.grid!==
this&&console.warn("Sharing column definition objects with multiple grids is not supported.",t.grid,this):t.grid=this;g.push(t)},this);return p?e:g},_destroyColumns:function(){this.cleanup()},configStructure:function(){var d=this.subRows,e=this._columns=this.columns;this.columns=!e||e instanceof Array?{}:e;if(d)for(e=0;e<d.length;e++)d[e]=this._configColumns(e+"-",d[e]);else this.subRows=[this._configColumns("",e)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(d){this._destroyColumns();
this.subRows=null;this.columns=d;this._updateColumns()},_setSubRows:function(d){this._destroyColumns();this.subRows=d;this._updateColumns()},_updateColumns:function(){this.configStructure();this.renderHeader();this.refresh();this._lastCollection&&this.renderArray(this._lastCollection);this._started&&(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});a.appendIfNode=h;return a})},"dgrid/List":function(){define("dojo/_base/declare dojo/_base/lang dojo/dom-class dojo/dom-construct dojo/on dojo/query dojo/sniff ./util/misc".split(" "),
function(a,b,c,n,l,u,v,m){function h(f,w){return u("#"+m.escapeCssIdentifier(f),w)[0]}function d(f,w){f.className="dgrid-scrollbar-measure";document.body.appendChild(f);w=f["offset"+w]-f["client"+w];f.className="";f.parentNode&&document.body.removeChild(f);return w}function e(f){c.replace(this.domNode,f,this._class||"");this._class=f}function g(){return this._class}var p=[];p.push("has-mozilla");v("touch")&&p.push("has-touch");c.add(document.documentElement,p);v.add("pointer",function(f){return"PointerEvent"in
f?"pointer":"MSPointerEvent"in f?"MSPointer":!1});var t,q;v.add("dom-scrollbar-width",function(f,w,z){return d(z,"Width")});v.add("dom-scrollbar-height",function(f,w,z){return d(z,"Height")});v.add("dom-rtl-scrollbar-left",function(f,w,z){f=document.createElement("div");z.className="dgrid-scrollbar-measure";z.setAttribute("dir","rtl");z.appendChild(f);document.body.appendChild(z);w=!!v("ie")||/\bEdge\//.test(navigator.userAgent)||f.offsetLeft>=v("dom-scrollbar-width");z.className="";z.parentNode&&
document.body.removeChild(z);n.destroy(f);z.removeAttribute("dir");return w});var k=0,r=function(){this._started&&this.resize()},y=a(null,{tabableHeader:!1,showHeader:!1,showFooter:!1,maintainOddEven:!0,cleanAddedRules:!0,addUiClasses:!0,highlightDuration:250,resizeThrottleDelay:m.defaultDelay,resizeThrottleMethod:"throttleDelayed",postscript:function(f,w){var z=this;(this._Row=function(A,x,B){this.id=A;this.data=x;this.element=B}).prototype.remove=function(){z.removeRow(this.element)};w&&(this.srcNodeRef=
w=w.nodeType?w:h(w));this.create(f,w)},listType:"list",create:function(f,w){w=this.domNode=w||document.createElement("div");if(f){this.params=f;a.safeMixin(this,f);var z=f["class"]||f.className||w.className}this.sort=this.sort||[];this._listeners=[];this._rowIdToObject={};this.postMixInProperties&&this.postMixInProperties();this.id=w.id=w.id||this.id||y.autoIdPrefix+k++;this.buildRendering();z&&e.call(this,z);this.postCreate();delete this.srcNodeRef;this.domNode.offsetHeight&&this.startup()},buildRendering:function(){var f=
this.domNode,w=this.addUiClasses,z=this;var A=this.isRTL="rtl"===(document.body.dir||document.documentElement.dir||document.body.style.direction).toLowerCase();f.className="";f.setAttribute("role","grid");c.add(f,"dgrid dgrid-"+this.listType+(w?" ui-widget":""));var x=this.headerNode=n.create("div",{className:"dgrid-header dgrid-header-row"+(w?" ui-widget-header":"")+(this.showHeader?"":" dgrid-header-hidden")},f);var B=this.bodyNode=n.create("div",{className:"dgrid-scroller"},f);B.tabIndex=-1;this.headerScrollNode=
n.create("div",{className:"dgrid-header dgrid-header-scroll dgrid-scrollbar-width"+(w?" ui-widget-header":"")},f);this.footerNode=n.create("div",{className:"dgrid-footer"+(this.showFooter?"":" dgrid-footer-hidden")},f);A&&(f.className+=" dgrid-rtl"+(v("dom-rtl-scrollbar-left")?" dgrid-rtl-swap":""));l(B,"scroll",function(C){z.showHeader&&(x.scrollLeft=C.scrollLeft||B.scrollLeft);C.stopPropagation();l.emit(f,"scroll",{scrollTarget:B})});this.configStructure();this.renderHeader();this.contentNode=this.touchNode=
n.create("div",{className:"dgrid-content"+(w?" ui-widget-content":"")},this.bodyNode);"string"===typeof this.resizeThrottleMethod&&m[this.resizeThrottleMethod]?w=m[this.resizeThrottleMethod](r,this,this.resizeThrottleDelay):"function"===typeof this.resizeThrottleMethod?w=this.resizeThrottleMethod(b.hitch(this,r),this.resizeThrottleDelay):(console.warn("Invalid value specified for resizeThrottleMethod:  "+this.resizeThrottleMethod),w=m.throttleDelayed(r,this,this.resizeThrottleDelay));this._resizeHandle=
l(window,"resize",w);this._listeners.push(this._resizeHandle)},postCreate:function(){},startup:function(){this._started||(this.inherited(arguments),this._started=!0,this.resize(),this.set("sort",this.sort))},configStructure:function(){},resize:function(){var f=this.bodyNode,w=this.footerNode;w=this.showFooter?w.offsetHeight:0;this.headerScrollNode.style.height=f.style.marginTop=this.headerNode.offsetHeight+"px";f.style.marginBottom=w+"px";t||(t=v("dom-scrollbar-width"),q=v("dom-scrollbar-height"),
v("ie")&&(t++,q++),m.addCssRule(".dgrid-scrollbar-width","width: "+t+"px"),m.addCssRule(".dgrid-scrollbar-height","height: "+q+"px"),17!==t&&(m.addCssRule(".dgrid-header-row","right: "+t+"px"),m.addCssRule(".dgrid-rtl-swap .dgrid-header-row","left: "+t+"px")))},addCssRule:function(f,w){f=m.addCssRule(f,w);this.cleanAddedRules&&this._listeners.push(f);return f},on:function(f,w){return l(this.domNode,f,w)},cleanup:function(){for(var f in this._rowIdToObject)if(this._rowIdToObject[f]!==this.columns){var w=
h(f,this.domNode);w&&this.removeRow(w,!0)}},destroy:function(){if(this._listeners){for(var f=this._listeners.length;f--;)this._listeners[f].remove();this._listeners=null}this._started=!1;this.cleanup();n.destroy(this.domNode)},refresh:function(){this.cleanup();this._rowIdToObject={};this._autoRowId=0;this.contentNode.innerHTML="";this.scrollTo({x:0,y:0})},highlightRow:function(f,w){var z="dgrid-highlight"+(this.addUiClasses?" ui-state-highlight":"");f=f.element||f;c.add(f,z);setTimeout(function(){c.remove(f,
z)},w||this.highlightDuration)},adjustRowIndices:function(f){var w=f.rowIndex;if(-1<w){do-1<f.rowIndex&&this.setRowIndex(f,w++,f.rowIndex);while((f=f.nextSibling)&&f.rowIndex!==w)}},renderArray:function(f,w,z){z=z||{};var A=z.start||0,x=document.createDocumentFragment(),B=[],C=0,D=f.length;w||(this._lastCollection=f);for(;C<D;)B[C]=this.insertRow(f[C],x,null,A++,z),C++;(f=w?w.parentNode:this.contentNode)&&f.parentNode&&(f!==this.contentNode||D)&&(f.insertBefore(x,w||null),D&&this.adjustRowIndices(B[D-
1]));return B},renderHeader:function(){},setRowIndex:function(f,w,z){f.rowIndex=w;this.maintainOddEven&&(w=1===w%2?"dgrid-row-odd":"dgrid-row-even",void 0!==z?(z=1===z%2?"dgrid-row-odd":"dgrid-row-even",z!==w&&c.replace(f,z,w)):c.add(f,w))},_autoRowId:0,insertRow:function(f,w,z,A,x){var B=this.id+"-row-"+(this.collection&&this.collection.getIdentity?this.collection.getIdentity(f):this._autoRowId++),C=h(B,this.domNode),D=C&&C.previousSibling;C&&(C===z&&(z=(z.connected||z).nextSibling),this.removeRow(C,
!1,x));C=this.renderRow(f,x);C.className=(C.className||"")+" dgrid-row "+(this.addUiClasses?" ui-state-default":"");this._rowIdToObject[C.id=B]=f;w.insertBefore(C,z||null);this.setRowIndex(C,A);D&&D.rowIndex!==C.rowIndex-1&&this.adjustRowIndices(D);return C},renderRow:function(f){var w=document.createElement("div");w.appendChild(document.createTextNode(f));return w},removeRow:function(f,w){f=f.element||f;delete this._rowIdToObject[f.id];w||n.destroy(f)},row:function(f){var w;if(f instanceof this._Row)return f;
f.target&&f.target.nodeType&&(f=f.target);if(f.nodeType){do{var z=f.id;if(w=this._rowIdToObject[z])return new this._Row(z.substring(this.id.length+5),w,f);f=f.parentNode}while(f&&f!==this.domNode)}else return"object"===typeof f?w=this.collection.getIdentity(f):(w=f,f=this._rowIdToObject[this.id+"-row-"+w]),new this._Row(w,f,h(this.id+"-row-"+w,this.domNode))},cell:function(f){return{row:this.row(f)}},_move:function(f,w,z,A){var x;var B=x=f.element;w=w||1;do if(f=x[0>w?"previousSibling":"nextSibling"]){do if((x=
f)&&-1<(x.className+" ").indexOf(z+" ")){B=x;w+=0>w?1:-1;break}while(f=(!A||!x.hidden)&&x[0>w?"lastChild":"firstChild"])}else if(x=x.parentNode,!x||x===this.bodyNode||x===this.headerNode)break;while(w);return B},up:function(f,w,z){f.element||(f=this.row(f));return this.row(this._move(f,-(w||1),"dgrid-row",z))},down:function(f,w,z){f.element||(f=this.row(f));return this.row(this._move(f,w||1,"dgrid-row",z))},scrollTo:function(f){"undefined"!==typeof f.x&&(this.bodyNode.scrollLeft=f.x);"undefined"!==
typeof f.y&&(this.bodyNode.scrollTop=f.y)},getScrollPosition:function(){return{x:this.bodyNode.scrollLeft,y:this.bodyNode.scrollTop}},get:function(f){var w="_get"+f.charAt(0).toUpperCase()+f.slice(1);return"function"===typeof this[w]?this[w].apply(this,[].slice.call(arguments,1)):this[f]},set:function(f,w){if("object"===typeof f)for(var z in f)this.set(z,f[z]);else z="_set"+f.charAt(0).toUpperCase()+f.slice(1),"function"===typeof this[z]?this[z].apply(this,[].slice.call(arguments,1)):this[f]=w;return this},
_getClass:g,_setClass:e,_getClassName:g,_setClassName:e,_setSort:function(f,w){this.sort="string"!==typeof f?f:[{property:f,descending:w}];this._applySort()},_applySort:function(){this.refresh();if(this._lastCollection){var f=this.sort;if(f&&0<f.length){var w=f[0].property,z=!!f[0].descending;this._lastCollection.sort(function(A,x){A=A[w];x=x[w];void 0===A&&(A="");void 0===x&&(x="");return A===x?0:A>x!==z?1:-1})}this.renderArray(this._lastCollection)}},_setShowHeader:function(f){var w=this.headerNode;
this.showHeader=f;c.toggle(w,"dgrid-header-hidden",!f);this.renderHeader();this.resize();f&&(w.scrollLeft=this.getScrollPosition().x)},_setShowFooter:function(f){this.showFooter=f;c.toggle(this.footerNode,"dgrid-footer-hidden",!f);this.resize()}});y.autoIdPrefix="dgrid_";return y})},"dgrid/util/misc":function(){define(["dojo/has"],function(a){var b=[],c,n,l,u=/([^A-Za-z0-9_\u00A0-\uFFFF-])/g,v=setTimeout,m=clearTimeout;a.add("requestidlecallback",function(d){return"function"===typeof d.requestIdleCallback});
var h={defaultDelay:15,throttle:function(d,e,g){var p=!1;g=g||h.defaultDelay;return function(){p||(p=!0,d.apply(e,arguments),v(function(){p=!1},g))}},throttleDelayed:function(d,e,g){var p=!1;g=g||h.defaultDelay;return function(){if(!p){p=!0;var t=arguments;v(function(){p=!1;d.apply(e,t)},g)}}},debounce:function(d,e,g){var p;g=g||h.defaultDelay;return function(){p&&(m(p),p=null);var t=arguments;p=v(function(){p=null;d.apply(e,t)},g)}},each:function(d,e,g){var p;if(d)if("number"===typeof d.length){var t=
0;for(p=d.length;t<p;t++)e.call(g,d[t],t,d)}else for(t in d)e.call(g,d[t],t,d)},addCssRule:function(d,e){c||(c=document.createElement("style"),document.getElementsByTagName("head")[0].appendChild(c),c=c.sheet||c.styleSheet,n=c.deleteRule?"deleteRule":"removeRule",l=c.cssRules?"cssRules":"rules");var g=b.length;b[g]=(c.cssRules||c.rules).length;c.addRule?c.addRule(d,e):c.insertRule(d+"{"+e+"}",b[g]);return{get:function(p){return c[l][b[g]].style[p]},set:function(p,t){"undefined"!==typeof b[g]&&(c[l][b[g]].style[p]=
t)},remove:function(){var p=b[g],t;if(void 0!==p){c[n](p);b[g]=void 0;var q=g+1;for(t=b.length;q<t;q++)b[q]>p&&b[q]--}}}},escapeCssIdentifier:function(d,e){return"string"===typeof d?d.replace(u,e||"\\$1"):d}};return h})},"dgrid/OnDemandList":function(){define("./List ./_StoreMixin dojo/_base/declare dojo/_base/lang dojo/dom-construct dojo/on dojo/when dojo/query ./util/misc".split(" "),function(a,b,c,n,l,u,v,m,h){function d(p){return p&&(0<=p.className.indexOf("dgrid-row")||0<=p.className.indexOf("dgrid-loading"))}
function e(p){return p&&0<=p.className.indexOf("dgrid-preload")}var g=0;return c([a,b],{minRowsPerPage:25,maxRowsPerPage:250,maxEmptySpace:Infinity,bufferRows:10,farOffRemoval:2E3,queryRowsOverlap:0,pagingMethod:"debounce",pagingDelay:h.defaultDelay,keepScrollPosition:!1,rowHeight:0,_deleteQueue:[],postCreate:function(){this.inherited(arguments);var p=this;u(this.bodyNode,"scroll",h[this.pagingMethod](function(t){p._processScroll(t)},null,this.pagingDelay))},renderQuery:function(p,t){var q=this,k=
t&&t.container||this.contentNode,r,y=0,f=t&&t.start||0;"level"in p&&(y=r=p.level);var w={query:p,count:0,level:y,top:!1};var z={node:l.create("div",{className:"dgrid-preload",style:{height:"0"}},k),count:0,query:p,next:w,level:y,top:!0};var A=z.node;A.rowIndex=0;w.previous=z;var x=w.node=l.create("div",{className:"dgrid-preload",style:{height:"0"}},k);z.id=g++;A.setAttribute("data-preloadid",z.id);w.id=g++;x.setAttribute("data-preloadid",w.id);x.rowIndex=this.minRowsPerPage;q._insertPreload(z);var B=
l.create("div",{className:"dgrid-loading"},x,"before");l.create("div",{className:"dgrid-below"},B).innerHTML=this.loadingMessage;t=n.mixin({start:0,count:this.minRowsPerPage},t);null!=r&&(t.queryLevel=r);return this._trackError(function(){var C=p(t);return q.renderQueryResults(C,x,t).then(function(D){return C.totalLength.then(function(E){var F=D.length,G=x.parentNode;!q._rows||"queryLevel"in t||(q._rows.min=0,q._rows.max=F===E?Infinity:F-1);l.destroy(B);"queryLevel"in t||(q._total=E);0===E&&G&&(q.noDataNode&&
l.destroy(q.noDataNode),q._insertNoDataNode(G));z.count=f;w.count=E-F-f;x.rowIndex=f+F;E?q._updatePreloadRowHeights(z):(x.style.display="none",A.style.display="none");q._previousScrollPosition&&G&&G.offsetHeight&&(q.scrollTo(q._previousScrollPosition),delete q._previousScrollPosition);return v(q._processScroll()).then(function(){return D})})}).otherwise(function(D){l.destroy(B);throw D;})})},_insertPreload:function(p){var t=this.preload;if(t){for(;t.node.compareDocumentPosition(p.node)&Node.DOCUMENT_POSITION_PRECEDING;)if(t=
t.previous,null==t)return;for(;t.node.compareDocumentPosition(p.node)&Node.DOCUMENT_POSITION_FOLLOWING&&t.next;)t=t.next;t.previous.next=p;p.previous=t.previous;p=p.next;p.next=t;t.previous=p}else this.preload=p},refresh:function(p){var t=this,q=p&&p.keepScrollPosition,k;"undefined"===typeof q&&(q=this.keepScrollPosition);q&&(this._previousScrollPosition=this.getScrollPosition());this.inherited(arguments);if(this._renderedCollection)return this.renderQuery(function(r){r=t._renderedCollection.fetchRange({start:r.start,
end:r.start+r.count});r.then(function(y){k=y});return r}).then(function(){t._emitRefreshComplete();return k})},resize:function(){this.inherited(arguments);this._processScroll()},cleanup:function(){this.inherited(arguments);this.preload=null},renderQueryResults:function(p){var t=this.inherited(arguments),q=this._getRenderedCollection(this.preload);q&&q.releaseRange&&t.then(function(k){k[0]&&!k[0].parentNode.tagName&&p.totalLength.then(function(){q.releaseRange(k[0].rowIndex,k[k.length-1].rowIndex+
1)})});return t},_getFirstRowSibling:function(p){return p.lastChild},_calcRowHeight:function(p){var t=p.nextSibling;return t&&!/\bdgrid-preload\b/.test(t.className)?t.offsetTop-p.offsetTop:p.offsetHeight},_calcAverageRowHeight:function(p){for(var t=p.length,q=0,k=0;k<t;k++)q+=this._calcRowHeight(p[k]);return t&&q?q/t:0},_updatePreloadRowHeights:function(){var p=this.preload,t=0;if(p){for(;p.previous;)p=p.previous;for(;p;)p.rowHeight||(p.rowHeight=this._calcAverageRowHeight(p.node.parentNode.querySelectorAll(".dgrid-row")),
this._adjustPreloadHeight(p)),t=p?p.rowHeight:t,p=p.next;this.rowHeight=t}},lastScrollTop:0,_processScroll:function(p){function t(J,I){I=I?"next":"previous";for(var P;P=J[I];)J=P;return J}function q(J,I){function P(){a:{var ka=!I;for(var la=J;la=la[I?"previous":"next"];)if(ka===la.top){ka=la;break a}ka=void 0}if(ka&&S!==ka&&!e(ka.top?ka.node.nextSibling:ka.node.previousSibling))return V(),J=ka,U=J.node,T=I?J.node.offsetTop-A:z-(J.node.offsetTop+J.node.offsetHeight),ea=(ka=N(U))&&ka.rowIndex,ba=void 0,
ka}function N(ka){var la=e(ka);(ka=ka[W])&&!d(ka)&&(ka=la&&e(ka)?null:(la=P())?la:N(ka));return ka}function V(){J.count+=Q;I&&(U.rowIndex-=Q);f._adjustPreloadHeight(J);Q=0;f._releaseRange(J,I,ea,ba)}var S=J;J=t(J,I);var T=I?J.node.offsetTop-A:z-(J.node.offsetTop+J.node.offsetHeight),H=f.farOffRemoval,U=J.node,W=I?"previousSibling":"nextSibling",Q=0,X=0,ba;if(T>2*H){var aa;var ea=(aa=N(U))&&aa.rowIndex;for(ba=void 0;aa&&S!==J;){var ia=f._calcRowHeight(aa);X+ia+H>T||!d(aa)?aa=P():(X+=ia,Q+=aa.count||
1,f._pruneRow(aa,I),"rowIndex"in aa&&(ba=aa.rowIndex),aa=N(aa))}V();f._deleteNodeQueue()}}function k(J,I){do J=I?J.next:J.previous;while(J&&!J.node.offsetWidth);return J}var r=this.preload,y;this._updatePreloadRowHeights();if(y=r&&r.rowHeight){var f=this,w=f.bodyNode,z=p&&p.scrollTop||this.getScrollPosition().y,A=w.offsetHeight+z;p=f.lastScrollTop;w=f.bufferRows*y;var x=w-y,B,C=!0;for(f.lastScrollTop=z;r&&!r.node.offsetWidth;)r=r.previous;for(;r&&r!==D;){var D=f.preload;f.preload=r;y=r.node;var E=
y.offsetTop;if(A+1+x<E)r=k(r,C=!1);else if(z-1-x>E+y.offsetHeight)r=k(r,C=!0);else{E=((y.top?z-w:A)-E)/r.rowHeight;var F=(A-z+2*w)/r.rowHeight;F+=Math.min(Math.abs(Math.max(Math.min((z-p)*r.rowHeight,f.maxRowsPerPage/2),f.maxRowsPerPage/-2)),10);y.top&&(E-=F);E=Math.max(E,0);10>E&&0<E&&F+E<f.maxRowsPerPage&&(F+=Math.max(0,E),E=0);F=Math.min(Math.max(F,f.minRowsPerPage),f.maxRowsPerPage,r.count);if(0===F)r=k(r,C);else{F=Math.ceil(F);E=Math.min(Math.floor(E),r.count-F);var G={};r.count-=F;var O=y,K=
f.queryRowsOverlap,L=!r.top&&r;if(L)r.previous&&(q(r),0<E&&e(y.previousSibling)?(E=Math.min(r.count,E),r.previous.count+=E,f._adjustPreloadHeight(r.previous,!0),y.rowIndex+=E,K=0):F+=E,r.count-=E),G.start=y.rowIndex-K,G.count=Math.min(F+K,f.maxRowsPerPage),y.rowIndex=G.start+G.count;else{if(r.next)if(O=y.nextSibling,q(r,!0),e(y.nextSibling))r.next.count+=r.count-E,r.next.node.rowIndex=E+F,f._adjustPreloadHeight(r.next),r.count=E,K=0,O=r.next.node;else var R=!0;G.start=r.count;G.count=Math.min(F+K,
f.maxRowsPerPage);G.scrollingUp=!0}R&&O&&O.offsetWidth&&(R=O.offsetTop);f._adjustPreloadHeight(r);"level"in r.query&&(G.queryLevel=r.query.level);if("queryLevel"in G||!(G.start>f._total||0>G.count)){var M=l.create("div",{className:"dgrid-loading",style:{height:F*r.rowHeight+"px"}},O,"before");l.create("div",{className:"dgrid-"+(L?"below":"above"),innerHTML:f.loadingMessage},M);M.count=F;f._trackError(function(){(function(J,I,P){var N=r.query(G);B=f.renderQueryResults(N,J,G).then(function(V){var S=
f._rows;!S||"queryLevel"in G||!V.length||(I?(S.max<=S.min&&(S.min=V[0].rowIndex),S.max=V[V.length-1].rowIndex):(S.max<=S.min&&(S.max=V[V.length-1].rowIndex),S.min=V[0].rowIndex));O=J.nextSibling;l.destroy(J);P&&O&&O.offsetWidth&&f.scrollTo({y:f.bodyNode.scrollTop+O.offsetTop-P});N.totalLength.then(function(T){"queryLevel"in G||(f._total=T,f._rows&&f._rows.max>=f._total-1&&(f._rows.max=Infinity));I&&(I.count=T-I.node.rowIndex,f._adjustPreloadHeight(I))});f._processScroll();return V},function(V){l.destroy(J);
throw V;})})(M,L,R)});r=r.previous}}}}return B}},_adjustPreloadHeight:function(p,t){p.node.style.height=this._calculatePreloadHeight(p,t)+"px"},_calculatePreloadHeight:function(p,t){return Math.min(p.count*p.rowHeight,t?Infinity:this.maxEmptySpace)},_pruneRow:function(p,t,q){this.removeRow(p,!0,q);this._queueNodeForDeletion(p)},_queueNodeForDeletion:function(p){this._deleteQueue.push(p)},_deleteNodeQueue:function(){for(var p=document.createElement("div"),t=this._deleteQueue,q=t.length;q--;)p.appendChild(t[q]);
this._deleteQueue=[];setTimeout(function(){l.destroy(p)},1)},_removePreloads:function(p){if(p&&p.length){var t=this,q=this._getHeadPreload();p.forEach(function(k){if(k=t._findPreload(k,q))k.previous&&(k.previous.next=k.next),k.next&&(k.next.previous=k.previous)})}},_getHeadPreload:function(){var p=this.preload;if(p)for(;p.previous;)p=p.previous;return p},_findPreload:function(p,t){for(t||(t=this._getHeadPreload());t;){if(t.node===p)return t;t=t.next}},_getRenderedCollection:function(){return this._renderedCollection},
_releaseRange:function(p,t,q,k){if(p){var r=p.level;p=this._getRenderedCollection(p);null!=k&&p.releaseRange&&"number"===typeof q&&"number"===typeof k&&(t?p.releaseRange(k,q+1):p.releaseRange(q,k+1),this._rows&&!r&&(this._rows[t?"max":"min"]=k,this._rows.max>=this._total-1&&(this._rows.max=Infinity)))}}})})},"dgrid/_StoreMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/Deferred dojo/aspect dojo/dom-construct dojo/has dojo/on dojo/when".split(" "),function(a,b,c,n,l,u,v,m){function h(d){if("object"!==
typeof d)d=Error(d);else if("cancel"===d.dojoType)return;v.emit(this.domNode,"dgrid-error",{grid:this,error:d,cancelable:!0,bubbles:!0})&&console.error(d)}return a(null,{collection:null,_renderedCollection:null,_rows:null,_observerHandle:null,_structureHandle:null,shouldTrackCollection:!0,getBeforePut:!0,noDataMessage:"",loadingMessage:"",_total:0,constructor:function(){this.dirty={};this._updating={};this._columnsWithSet={};this._structureHandle=n.before(this,"configStructure",b.hitch(this,function(){this._columnsWithSet=
{}}))},destroy:function(){this.inherited(arguments);this._structureHandle&&this._structureHandle.remove();this._renderedCollection&&this._cleanupCollection();this._refreshTimeout&&clearTimeout(this._refreshTimeout)},_configColumn:function(d){d.set&&(this._columnsWithSet[d.field]=d);this.inherited(arguments)},_setCollection:function(d){this._renderedCollection&&(this.cleanup(),this._cleanupCollection({shouldRevert:!d||d.storage!==this._renderedCollection.storage}));this.collection=d;if(this._started){if(d){var e=
d;this.sort&&0<this.sort.length&&(e=d.sort(this.sort));e.track&&this.shouldTrackCollection&&(e=e.track(),this._rows=[],this._observerHandle=this._observeCollection(e,this.contentNode,{rows:this._rows}));this._renderedCollection=e}this.refresh()}},_setStore:function(){this.collection||console.debug("set('store') call detected, but you probably meant set('collection')")},_getTotal:function(){return this._total},_cleanupCollection:function(d){d=d||{};this._observerHandle&&(this._observerHandle.remove(),
this._observerHandle=this._rows=null);!1!==d.shouldRevert&&(this.dirty={});this._renderedCollection=this.collection=null},_applySort:function(){this.collection?this.set("collection",this.collection):this.store&&console.debug("_StoreMixin found store property but not collection; this is often the sign of a mistake during migration from 0.3 to 0.4")},_emitRefreshComplete:function(){var d=this;this._refreshTimeout=setTimeout(function(){v.emit(d.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,
grid:d});d._refreshTimeout=null},0)},_insertNoDataNode:function(d){this._removeNoDataNode();d=d||this.contentNode;var e=this.noDataNode=l.create("div",{className:"dgrid-no-data",innerHTML:this.noDataMessage});d.insertBefore(e,this._getFirstRowSibling?this._getFirstRowSibling(d):null);return e},_removeNoDataNode:function(){return this.noDataNode?(l.destroy(this.noDataNode),delete this.noDataNode,!0):!1},row:function(){var d=this.inherited(arguments);d&&d.data&&"undefined"!==typeof d.id&&(d.id=this.collection.getIdentity(d.data));
return d},refresh:function(){var d=this.inherited(arguments);this.collection||this._insertNoDataNode();return d},refreshCell:function(d){if(!this.collection||!this._createBodyRowCell)throw Error("refreshCell requires a Grid with a collection.");this.inherited(arguments);return this.collection.get(d.row.id).then(b.hitch(this,"_refreshCellFromItem",d))},_refreshCellFromItem:function(d,e,g){var p=d.element;l.empty(p);var t=this.dirty&&this.dirty[d.row.id];t&&(e=b.delegate(e,t));this._createBodyRowCell(p,
d.column,e,g)},renderArray:function(){var d=this.inherited(arguments);this.collection||d.length&&this.noDataNode&&l.destroy(this.noDataNode);return d},insertRow:function(d,e,g,p,t){var q=this.collection,k=this.dirty;q=q&&q.getIdentity(d);var r;q in k&&!(q in this._updating)&&(r=k[q]);r&&(d=b.delegate(d,r));k=this.inherited(arguments);t&&t.rows&&(t.rows[p]=k);this.noDataNode&&(l.destroy(this.noDataNode),this.noDataNode=null);return k},updateDirty:function(d,e,g){var p=this.dirty,t=p[d];t||(t=p[d]=
{});t[e]=g},save:function(){function d(w,z){return function(A){var x=e._columnsWithSet,B=e._updating,C;if("function"===typeof A.set)A.set(z);else for(C in z)A[C]=z[C];for(C in x){var D=x[C].set(A);void 0!==D&&(A[C]=D)}B[w]=!0;return g.put(A).then(function(E){delete p[w];delete B[w];q[w]=E;return q})}}var e=this,g=this.collection,p=this.dirty,t=new c,q={},k=function(w){var z;return e.getBeforePut||!(z=e.row(w).data)?function(){return g.get(w)}:function(){return z}},r=t.then(function(){return q}),y;
for(y in p){var f=d(y,p[y]);r=r.then(k(y)).then(f)}t.resolve();return r},revert:function(){this.dirty={};this.refresh()},_trackError:function(d){"string"===typeof d&&(d=b.hitch(this,d));var e=this;try{var g=m(d())}catch(p){d=new c,d.reject(p),g=d.promise}g.otherwise(function(p){h.call(e,p)});return g},removeRow:function(d,e,g){var p={element:d};e||this.up(p).element!==d||this.down(p).element!==d||this._insertNoDataNode();(p=g&&g.rows||this._rows)&&delete p[d.rowIndex];return this.inherited(arguments)},
renderQueryResults:function(d,e,g){g=b.mixin({rows:this._rows},g);var p=this;return d.then(function(t){t=p.renderArray(t,e,g);delete p._lastCollection;return t})},_observeCollection:function(d,e,g){var p=this,t=g.rows,q,k=[d.on("delete, update",function(r){var y=r.previousIndex,f=r.index;void 0!==y&&t[y]&&("max"in t&&(void 0===f||f<t.min||f>t.max)&&t.max--,0>t.max&&(t.max=0),q=t[y],q.parentNode===e&&p.removeRow(q,!1,g),t.splice(y,1),("delete"===r.type||"update"===r.type&&(y<f||void 0===f))&&t[y]&&
t[y].rowIndex--);"delete"===r.type&&(q=null)}),d.on("add, update",function(r){var y=r.previousIndex,f=r.index;if(void 0!==f&&(!("max"in t)||f>=t.min&&f<=t.max)){"max"in t&&(void 0===y||y<t.min||y>t.max)&&t.max++;if(t.length){if(y=t[f],!y&&(y=t[f-1]))y=(y.connected||y).nextSibling}else y=p._getFirstRowSibling&&p._getFirstRowSibling(e);q&&y&&q.id===y.id&&(y=(y.connected||y).nextSibling);y&&!y.parentNode&&(y=document.getElementById(y.id));t.splice(f,0,void 0);q=p.insertRow(r.target,e,y,f,g);p.highlightRow(q)}q=
null}),d.on("add, delete, update",function(r){var y="undefined"!==typeof r.previousIndex?r.previousIndex:Infinity,f="undefined"!==typeof r.index?r.index:Infinity,w=Math.min(y,f);y!==f&&t[w]&&p.adjustRowIndices(t[w]);Infinity!==y&&p._processScroll&&(t[y]||t[y-1])&&p._processScroll();p._onNotification(t,r,d);d===p._renderedCollection&&"totalLength"in r&&(p._total=r.totalLength)})];return{remove:function(){for(;0<k.length;)k.pop().remove()}}},_onNotification:function(){}})})},"dgrid/Selection":function(){define("dojo/_base/declare dojo/aspect dojo/dom-class dojo/mouse dojo/on dojo/sniff dojo/has!touch?./util/touch dojo/query dojo/dom".split(" "),
function(a,b,c,n,l,u,v){function m(q,k){k=q.unselectable=k?"on":"";q=q.getElementsByTagName("*");for(var r=q.length;--r;)"INPUT"!==q[r].tagName&&"TEXTAREA"!==q[r].tagName&&(q[r].unselectable=k)}function h(q,k){var r=q.bodyNode,y=k?"text":"-moz-none";d&&"msUserSelect"!==d?r.style[d]=y:u("dom-selectstart")?k||q._selectstartHandle?k&&q._selectstartHandle&&(q._selectstartHandle.remove(),delete q._selectstartHandle):q._selectstartHandle=l(r,"selectstart",function(f){var w=f.target&&f.target.tagName;"INPUT"!==
w&&"TEXTAREA"!==w&&f.preventDefault()}):(m(r,!k),k||q._unselectableHandle)?k&&q._unselectableHandle&&(q._unselectableHandle.remove(),delete q._unselectableHandle):q._unselectableHandle=b.after(q,"renderRow",function(f){m(f,!0);return f})}u.add("dom-comparedocumentposition",function(q,k,r){return!!r.compareDocumentPosition});u.add("dom-selectstart","undefined"!==typeof document.onselectstart);var d=u("css-user-select"),e=u("pointer"),g=e&&"MS"===e.slice(0,2),p=e?e+(g?"Down":"down"):"mousedown",t=e?
e+(g?"Up":"up"):"mouseup";"WebkitUserSelect"===d&&"undefined"!==typeof document.documentElement.style.msUserSelect&&(d=!1);return a(null,{selectionDelegate:".dgrid-row",selectionEvents:p+","+t+",dgrid-cellfocusin",selectionTouchEvents:u("touch")?v.tap:null,deselectOnRefresh:!0,allowSelectAll:!1,selection:{},selectionMode:"extended",allowTextSelection:void 0,_selectionTargetType:"rows",create:function(){this.selection={};return this.inherited(arguments)},postCreate:function(){this.inherited(arguments);
this._initSelectionEvents();var q=this.selectionMode;this.selectionMode="";this._setSelectionMode(q)},destroy:function(){this.inherited(arguments);this._selectstartHandle&&this._selectstartHandle.remove();this._unselectableHandle&&this._unselectableHandle.remove();this._removeDeselectSignals&&this._removeDeselectSignals()},_setSelectionMode:function(q){q!==this.selectionMode&&(this.clearSelection(),this.selectionMode=q,this._selectionHandlerName="_"+q+"SelectionHandler",this._setAllowTextSelection(this.allowTextSelection))},
_setAllowTextSelection:function(q){"undefined"!==typeof q?h(this,q):h(this,"none"===this.selectionMode);this.allowTextSelection=q},_handleSelect:function(q,k){if(!n.isRight(q)&&this[this._selectionHandlerName]&&this.allowSelect(this.row(k))&&("dgrid-cellfocusin"!==q.type||"mousedown"!==q.parentType)&&(q.type!==t||k===this._waitForMouseUp)){this._waitForMouseUp=null;this._selectionTriggerEvent=q;if(!q.keyCode||!q.ctrlKey||32===q.keyCode)if(!q.shiftKey&&q.type===p&&this.isSelected(k))this._waitForMouseUp=
k;else this[this._selectionHandlerName](q,k);this._selectionTriggerEvent=null}},_singleSelectionHandler:function(q,k){q=q.keyCode?q.ctrlKey:q.metaKey;this._lastSelected===k?this.select(k,null,!q||!this.isSelected(k)):(this.clearSelection(),this.select(k),this._lastSelected=k)},_multipleSelectionHandler:function(q,k){var r=this._lastSelected,y=q.keyCode?q.ctrlKey:q.metaKey;if(!q.shiftKey){var f=y?null:!0;r=null}this.select(k,r,f);r||(this._lastSelected=k)},_extendedSelectionHandler:function(q,k){if(q.metaKey||
!this.isSelected(k)||1!==this.getSelectedCount())(2===q.button?this.isSelected(k):q.keyCode?q.ctrlKey:q.metaKey)||this.clearSelection(null,!0),this._multipleSelectionHandler(q,k)},_toggleSelectionHandler:function(q,k){this.select(k,null,null)},_initSelectionEvents:function(){var q=this,k=this.contentNode,r=this.selectionDelegate;this._selectionEventQueues={deselect:[],select:[]};u("touch")&&!u("pointer")&&this.selectionTouchEvents?(l(k,v.selector(r,this.selectionTouchEvents),function(y){q._handleSelect(y,
this);q._ignoreMouseSelect=this}),l(k,l.selector(r,this.selectionEvents),function(y){q._ignoreMouseSelect!==this?q._handleSelect(y,this):y.type===t&&(q._ignoreMouseSelect=null)})):l(k,l.selector(r,this.selectionEvents),function(y){q._handleSelect(y,this)});this.addKeyHandler&&this.addKeyHandler(32,function(y){q._handleSelect(y,y.target)});if(this.allowSelectAll)this.on("keydown",function(y){y.metaKey&&65===y.keyCode&&!/\bdgrid-input\b/.test(y.target.className)&&(y.preventDefault(),q[q.allSelected?
"clearSelection":"selectAll"]())});this._setCollection&&this._listeners.push(b.before(this,"_setCollection",function(y){q._updateDeselectionAspect(y)}));this._updateDeselectionAspect()},_updateDeselectionAspect:function(q){function k(f,w){if((f=r.row(f))&&r.selection[f.id])r[w](f)}var r=this;this._removeDeselectSignals&&this._removeDeselectSignals();var y=q&&q.track&&this._observeCollection?[b.before(this,"_observeCollection",function(f){y.push(f.on("delete",function(w){"undefined"===typeof w.index&&
k(w.id,"deselect")}))}),b.after(this,"_observeCollection",function(f){y.push(f.on("update",function(w){"undefined"!==typeof w.index&&k(f.getIdentity(w.target),"select")}))},!0)]:[b.before(this,"removeRow",function(f,w){w||(f=this.row(f))&&f.id in this.selection&&this.deselect(f)})];this._removeDeselectSignals=function(){for(var f=y.length;f--;)y[f].remove();y=[]}},allowSelect:function(){return!0},_fireSelectionEvent:function(q){var k=this._selectionEventQueues[q],r=this._selectionTriggerEvent;var y=
{bubbles:!0,grid:this};r&&(y.parentType=r.type);y[this._selectionTargetType]=k;this._selectionEventQueues[q]=[];l.emit(this.contentNode,"dgrid-"+q,y)},_fireSelectionEvents:function(){var q=this._selectionEventQueues,k;for(k in q)q[k].length&&this._fireSelectionEvent(k)},_select:function(q,k,r){"undefined"===typeof r&&(r=!0);q.element||(q=this.row(q));if(!1===r||this.allowSelect(q)){var y=this.selection;var f=!!y[q.id];null===r&&(r=!f);var w=q.element;r||this.allSelected?y[q.id]=r:delete this.selection[q.id];
w&&(r?c.add(w,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):c.remove(w,"dgrid-selected ui-state-active"));r!==f&&w&&this._selectionEventQueues[(r?"":"de")+"select"].push(q);if(k)if(k.element||(k=this.row(k)),k){if(k=k.element)for(y=this._determineSelectionDirection(w,k),y||(k=document.getElementById(k.id),y=this._determineSelectionDirection(w,k));q.element!==k&&(q=this[y](q));)this._select(q,null,r)}else this._lastSelected=w,console.warn("The selection range has been reset because the beginning of the selection is no longer in the DOM. If you are using OnDemandList, you may wish to increase farOffRemoval to avoid this, but note that keeping more nodes in the DOM may impact performance.")}},
_determineSelectionDirection:u("dom-comparedocumentposition")?function(q,k){q=k.compareDocumentPosition(q);return q&1?!1:2===q?"down":"up"}:function(q,k){return 1>k.sourceIndex?!1:k.sourceIndex>q.sourceIndex?"down":"up"},select:function(q,k,r){this._select(q,k,r);this._fireSelectionEvents()},deselect:function(q,k){this.select(q,k,!1)},clearSelection:function(q,k){this.allSelected=!1;for(var r in this.selection)q!==r&&this._select(r,null,!1);k||(this._lastSelected=null);this._fireSelectionEvents()},
selectAll:function(){this.allSelected=!0;this.selection={};for(var q in this._rowIdToObject){var k=this.row(this._rowIdToObject[q]);this._select(k.id,null,!0)}this._fireSelectionEvents()},getSelectedCount:function(){var q=0,k;for(k in this.selection)k&&(q+=1);return q},isSelected:function(q){if("undefined"===typeof q||null===q)return!1;q.element||(q=this.row(q));return q.id in this.selection?!!this.selection[q.id]:this.allSelected&&(!q.data||this.allowSelect(q))},refresh:function(){this.deselectOnRefresh&&
this.clearSelection();this._lastSelected=null;return this.inherited(arguments)},renderArray:function(){var q=this.inherited(arguments),k=this.selection,r,y;for(r=0;r<q.length;r++){var f=this.row(q[r]);(y=f.id in k?k[f.id]:this.allSelected)&&this.select(f,null,y)}this._fireSelectionEvents();return q}})})},"dojo/store/Memory":function(){define(["../_base/declare","./util/QueryResults","./util/SimpleQueryEngine"],function(a,b,c){return a("dojo.store.Memory",null,{constructor:function(n){for(var l in n)this[l]=
n[l];this.setData(this.data||[])},data:null,idProperty:"id",index:null,queryEngine:c,get:function(n){return this.data[this.index[n]]},getIdentity:function(n){return n[this.idProperty]},put:function(n,l){var u=this.data,v=this.index,m=this.idProperty;m=n[m]=l&&"id"in l?l.id:m in n?n[m]:Math.random();if(m in v){if(l&&!1===l.overwrite)throw Error("Object already exists");u[v[m]]=n}else v[m]=u.push(n)-1;return m},add:function(n,l){(l=l||{}).overwrite=!1;return this.put(n,l)},remove:function(n){var l=
this.index,u=this.data;if(n in l)return u.splice(l[n],1),this.setData(u),!0},query:function(n,l){return b(this.queryEngine(n,l)(this.data))},setData:function(n){n.items?(this.idProperty=n.identifier||this.idProperty,n=this.data=n.items):this.data=n;this.index={};for(var l=0,u=n.length;l<u;l++)this.index[n[l][this.idProperty]]=l}})})},"dojo/store/util/QueryResults":function(){define(["../../_base/array","../../_base/lang","../../when"],function(a,b,c){var n=function(l){function u(m){l[m]=function(){var h=
arguments,d=c(l,function(e){Array.prototype.unshift.call(h,e);return n(a[m].apply(a,h))});if("forEach"!==m||v)return d}}if(!l)return l;var v=!!l.then;v&&(l=b.delegate(l));u("forEach");u("filter");u("map");null==l.total&&(l.total=c(l,function(m){return m.length}));return l};b.setObject("dojo.store.util.QueryResults",n);return n})},"dojo/store/util/SimpleQueryEngine":function(){define(["../../_base/array"],function(a){return function(b,c){function n(u){u=a.filter(u,b);var v=c&&c.sort;v&&u.sort("function"==
typeof v?v:function(h,d){for(var e,g=0;e=v[g];g++){var p=h[e.attribute],t=d[e.attribute];p=null!=p?p.valueOf():p;t=null!=t?t.valueOf():t;if(p!=t)return!!e.descending==(null==p||p>t)?-1:1}return 0});if(c&&(c.start||c.count)){var m=u.length;u=u.slice(c.start||0,(c.start||0)+(c.count||Infinity));u.total=m}return u}switch(typeof b){default:throw Error("Can not query with a "+typeof b);case "object":case "undefined":var l=b;b=function(u){for(var v in l){var m=l[v];if(m&&m.test){if(!m.test(u[v],u))return!1}else if(m!=
u[v])return!1}return!0};break;case "string":if(!this[b])throw Error("No filter function "+b+" was found in store");b=this[b];case "function":}n.matches=b;return n}})},"dojo/dnd/Source":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom-class ../dom-geometry ../mouse ../ready ../topic ./common ./Selector ./Manager".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g){c.isAsync||m(0,function(){require(["dojo/dnd/AutoSource","dojo/dnd/Target"])});var p=b("dojo.dnd.Source",
e,{isSource:!0,horizontal:!1,copyOnly:!1,selfCopy:!1,selfAccept:!0,skipForm:!1,withHandles:!1,autoSync:!1,delay:0,accept:["text"],generateText:!0,constructor:function(t,q){n.mixin(this,n.mixin({},q));t=this.accept;if(t.length)for(this.accept={},q=0;q<t.length;++q)this.accept[t[q]]=1;this.mouseDown=this.isDragging=!1;this.targetBox=this.targetAnchor=null;this.before=!0;this._lastY=this._lastX=0;this.sourceState="";this.isSource&&l.add(this.node,"dojoDndSource");this.targetState="";this.accept&&l.add(this.node,
"dojoDndTarget");this.horizontal&&l.add(this.node,"dojoDndHorizontal");this.topics=[h.subscribe("/dnd/source/over",n.hitch(this,"onDndSourceOver")),h.subscribe("/dnd/start",n.hitch(this,"onDndStart")),h.subscribe("/dnd/drop",n.hitch(this,"onDndDrop")),h.subscribe("/dnd/cancel",n.hitch(this,"onDndCancel"))]},checkAcceptance:function(t,q){if(this==t)return!this.copyOnly||this.selfAccept;for(var k=0;k<q.length;++k){for(var r=t.getItem(q[k].id).type,y=!1,f=0;f<r.length;++f)if(r[f]in this.accept){y=!0;
break}if(!y)return!1}return!0},copyState:function(t,q){if(t)return!0;2>arguments.length&&(q=this==g.manager().target);if(q){if(this.copyOnly)return this.selfCopy}else return this.copyOnly;return!1},destroy:function(){p.superclass.destroy.call(this);a.forEach(this.topics,function(t){t.remove()});this.targetAnchor=null},onMouseMove:function(t){if(!this.isDragging||"Disabled"!=this.targetState){p.superclass.onMouseMove.call(this,t);var q=g.manager();if(!this.isDragging&&this.mouseDown&&this.isSource&&
(Math.abs(t.pageX-this._lastX)>this.delay||Math.abs(t.pageY-this._lastY)>this.delay)){var k=this.getSelectedNodes();k.length&&q.startDrag(this,k,this.copyState(d.getCopyKeyState(t),!0))}this.isDragging&&(k=!1,this.current&&(this.targetBox&&this.targetAnchor==this.current||(this.targetBox=u.position(this.current,!0)),k=this.horizontal?t.pageX-this.targetBox.x<this.targetBox.w/2==u.isBodyLtr(this.current.ownerDocument):t.pageY-this.targetBox.y<this.targetBox.h/2),this.current!=this.targetAnchor||k!=
this.before)&&(this._markTargetAnchor(k),q.canDrop(!this.current||q.source!=this||!(this.current.id in this.selection)))}},onMouseDown:function(t){this.mouseDown||!this._legalMouseDown(t)||this.skipForm&&d.isFormElement(t)||(this.mouseDown=!0,this._lastX=t.pageX,this._lastY=t.pageY,p.superclass.onMouseDown.call(this,t))},onMouseUp:function(t){this.mouseDown&&(this.mouseDown=!1,p.superclass.onMouseUp.call(this,t))},onDndSourceOver:function(t){this!==t?(this.mouseDown=!1,this.targetAnchor&&this._unmarkTargetAnchor()):
this.isDragging&&(t=g.manager(),t.canDrop("Disabled"!=this.targetState&&(!this.current||t.source!=this||!(this.current.id in this.selection))))},onDndStart:function(t,q,k){this.autoSync&&this.sync();this.isSource&&this._changeState("Source",this==t?k?"Copied":"Moved":"");q=this.accept&&this.checkAcceptance(t,q);this._changeState("Target",q?"":"Disabled");this==t&&g.manager().overSource(this);this.isDragging=!0},onDndDrop:function(t,q,k,r){if(this==r)this.onDrop(t,q,k);this.onDndCancel()},onDndCancel:function(){this.targetAnchor&&
(this._unmarkTargetAnchor(),this.targetAnchor=null);this.before=!0;this.mouseDown=this.isDragging=!1;this._changeState("Source","");this._changeState("Target","")},onDrop:function(t,q,k){if(this!=t)this.onDropExternal(t,q,k);else this.onDropInternal(q,k)},onDropExternal:function(t,q,k){var r=this._normalizedCreator;this._normalizedCreator=this.creator?function(y,f){return r.call(this,t.getItem(y.id).data,f)}:k?function(y){var f=t.getItem(y.id);y=y.cloneNode(!0);y.id=d.getUniqueId();return{node:y,
data:f.data,type:f.type}}:function(y){var f=t.getItem(y.id);t.delItem(y.id);return{node:y,data:f.data,type:f.type}};this.selectNone();k||this.creator||t.selectNone();this.insertNodes(!0,q,this.before,this.current);!k&&this.creator&&t.deleteSelectedNodes();this._normalizedCreator=r},onDropInternal:function(t,q){var k=this._normalizedCreator;if(!(this.current&&this.current.id in this.selection)){if(q)this._normalizedCreator=this.creator?function(r,y){return k.call(this,this.getItem(r.id).data,y)}:function(r){var y=
this.getItem(r.id);r=r.cloneNode(!0);r.id=d.getUniqueId();return{node:r,data:y.data,type:y.type}};else{if(!this.current)return;this._normalizedCreator=function(r){var y=this.getItem(r.id);return{node:r,data:y.data,type:y.type}}}this._removeSelection();this.insertNodes(!0,t,this.before,this.current);this._normalizedCreator=k}},onDraggingOver:function(){},onDraggingOut:function(){},onOverEvent:function(){p.superclass.onOverEvent.call(this);g.manager().overSource(this);if(this.isDragging&&"Disabled"!=
this.targetState)this.onDraggingOver()},onOutEvent:function(){p.superclass.onOutEvent.call(this);g.manager().outSource(this);if(this.isDragging&&"Disabled"!=this.targetState)this.onDraggingOut()},_markTargetAnchor:function(t){if(this.current!=this.targetAnchor||this.before!=t)this.targetAnchor&&this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetAnchor=this.current,this.targetBox=null,this.before=t,this.targetAnchor&&this._addItemClass(this.targetAnchor,this.before?"Before":
"After")},_unmarkTargetAnchor:function(){this.targetAnchor&&(this._removeItemClass(this.targetAnchor,this.before?"Before":"After"),this.targetBox=this.targetAnchor=null,this.before=!0)},_markDndStatus:function(t){this._changeState("Source",t?"Copied":"Moved")},_legalMouseDown:function(t){if("touchstart"!=t.type&&!v.isLeft(t))return!1;if(!this.withHandles)return!0;for(t=t.target;t&&t!==this.node;t=t.parentNode){if(l.contains(t,"dojoDndHandle"))return!0;if(l.contains(t,"dojoDndItem")||l.contains(t,
"dojoDndIgnore"))break}return!1}});return p})},"dojo/dnd/Selector":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../dom ../dom-construct ../mouse ../_base/NodeList ../on ../touch ./common ./Container".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g){var p=b("dojo.dnd.Selector",g,{constructor:function(t,q){q||(q={});this.singular=q.singular;this.autoSync=q.autoSync;this.selection={};this.anchor=null;this.simpleSelection=!1;this.events.push(h(this.node,d.press,n.hitch(this,
"onMouseDown")),h(this.node,d.release,n.hitch(this,"onMouseUp")))},singular:!1,getSelectedNodes:function(){var t=new m,q=e._empty,k;for(k in this.selection)k in q||t.push(l.byId(k));return t},selectNone:function(){return this._removeSelection()._removeAnchor()},selectAll:function(){this.forInItems(function(t,q){this._addItemClass(l.byId(q),"Selected");this.selection[q]=1},this);return this._removeAnchor()},deleteSelectedNodes:function(){var t=e._empty,q;for(q in this.selection)if(!(q in t)){var k=
l.byId(q);this.delItem(q);u.destroy(k)}this.anchor=null;this.selection={};return this},forInSelectedItems:function(t,q){q=q||c.global;var k=this.selection,r=e._empty,y;for(y in k)y in r||t.call(q,this.getItem(y),y,this)},sync:function(){p.superclass.sync.call(this);this.anchor&&!this.getItem(this.anchor.id)&&(this.anchor=null);var t=[],q=e._empty,k;for(k in this.selection)k in q||this.getItem(k)||t.push(k);a.forEach(t,function(r){delete this.selection[r]},this);return this},insertNodes:function(t,
q,k,r){var y=this._normalizedCreator;this._normalizedCreator=function(f,w){f=y.call(this,f,w);t?(this.anchor?this.anchor!=f.node&&(this._removeItemClass(f.node,"Anchor"),this._addItemClass(f.node,"Selected")):(this.anchor=f.node,this._removeItemClass(f.node,"Selected"),this._addItemClass(this.anchor,"Anchor")),this.selection[f.node.id]=1):(this._removeItemClass(f.node,"Selected"),this._removeItemClass(f.node,"Anchor"));return f};p.superclass.insertNodes.call(this,q,k,r);this._normalizedCreator=y;
return this},destroy:function(){p.superclass.destroy.call(this);this.selection=this.anchor=null},onMouseDown:function(t){this.autoSync&&this.sync();if(this.current)if(!this.singular&&!e.getCopyKeyState(t)&&!t.shiftKey&&this.current.id in this.selection)this.simpleSelection=!0,v.isLeft(t)&&(t.stopPropagation(),t.preventDefault());else{if(!this.singular&&t.shiftKey){e.getCopyKeyState(t)||this._removeSelection();var q=this.getAllNodes();if(q.length&&(this.anchor||(this.anchor=q[0],this._addItemClass(this.anchor,
"Anchor")),this.selection[this.anchor.id]=1,this.anchor!=this.current)){for(var k=0,r;k<q.length&&(r=q[k],r!=this.anchor&&r!=this.current);++k);for(++k;k<q.length;++k){r=q[k];if(r==this.anchor||r==this.current)break;this._addItemClass(r,"Selected");this.selection[r.id]=1}this._addItemClass(this.current,"Selected");this.selection[this.current.id]=1}}else this.singular?this.anchor==this.current?e.getCopyKeyState(t)&&this.selectNone():(this.selectNone(),this.anchor=this.current,this._addItemClass(this.anchor,
"Anchor"),this.selection[this.current.id]=1):e.getCopyKeyState(t)?this.anchor==this.current?(delete this.selection[this.anchor.id],this._removeAnchor()):this.current.id in this.selection?(this._removeItemClass(this.current,"Selected"),delete this.selection[this.current.id]):(this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this._addItemClass(this.anchor,"Selected")),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1):this.current.id in this.selection||
(this.selectNone(),this.anchor=this.current,this._addItemClass(this.current,"Anchor"),this.selection[this.current.id]=1);t.stopPropagation();t.preventDefault()}},onMouseUp:function(){this.simpleSelection&&(this.simpleSelection=!1,this.selectNone(),this.current&&(this.anchor=this.current,this._addItemClass(this.anchor,"Anchor"),this.selection[this.current.id]=1))},onMouseMove:function(){this.simpleSelection=!1},onOverEvent:function(){this.onmousemoveEvent=h(this.node,d.move,n.hitch(this,"onMouseMove"))},
onOutEvent:function(){this.onmousemoveEvent&&(this.onmousemoveEvent.remove(),delete this.onmousemoveEvent)},_removeSelection:function(){var t=e._empty,q;for(q in this.selection)if(!(q in t)){var k=l.byId(q);k&&this._removeItemClass(k,"Selected")}this.selection={};return this},_removeAnchor:function(){this.anchor&&(this._removeItemClass(this.anchor,"Anchor"),this.anchor=null);return this}});return p})},"dojo/_base/NodeList":function(){define(["./kernel","../query","./array","./html","../NodeList-dom"],
function(a,b,c){b=b.NodeList;var n=b.prototype;n.connect=b._adaptAsForEach(function(){return a.connect.apply(this,arguments)});n.coords=b._adaptAsMap(a.coords);b.events="blur focus change click error keydown keypress keyup load mousedown mouseenter mouseleave mousemove mouseout mouseover mouseup submit".split(" ");c.forEach(b.events,function(l){var u="on"+l;n[u]=function(v,m){return this.connect(u,v,m)}});return a.NodeList=b})},"dojo/dnd/Container":function(){define("../_base/array ../_base/declare ../_base/kernel ../_base/lang ../_base/window ../dom ../dom-class ../dom-construct ../Evented ../has ../on ../query ../touch ./common".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){b=b("dojo.dnd.Container",h,{skipForm:!1,allowNested:!1,constructor:function(q,k){this.node=u.byId(q);k||(k={});this.creator=k.creator||null;this.skipForm=k.skipForm;this.parent=k.dropParent&&u.byId(k.dropParent);this.map={};this.current=null;this.containerState="";v.add(this.node,"dojoDndContainer");k&&k._skipStartup||this.startup();this.events=[e(this.node,p.over,n.hitch(this,"onMouseOver")),e(this.node,p.out,n.hitch(this,"onMouseOut")),e(this.node,"dragstart",
n.hitch(this,"onSelectStart")),e(this.node,"selectstart",n.hitch(this,"onSelectStart"))]},creator:function(){},getItem:function(q){return this.map[q]},setItem:function(q,k){this.map[q]=k},delItem:function(q){delete this.map[q]},forInItems:function(q,k){k=k||c.global;var r=this.map,y=t._empty,f;for(f in r)f in y||q.call(k,r[f],f,this);return k},clearItems:function(){this.map={}},getAllNodes:function(){return g((this.allowNested?"":"\x3e ")+".dojoDndItem",this.parent)},sync:function(){var q={};this.getAllNodes().forEach(function(k){if(k.id){var r=
this.getItem(k.id);if(r){q[k.id]=r;return}}else k.id=t.getUniqueId();r=k.getAttribute("dndType");var y=k.getAttribute("dndData");q[k.id]={data:y||k.innerHTML,type:r?r.split(/\s*,\s*/):["text"]}},this);this.map=q;return this},insertNodes:function(q,k,r){this.parent.firstChild?k?r||(r=this.parent.firstChild):r&&(r=r.nextSibling):r=null;if(r)for(k=0;k<q.length;++k){var y=this._normalizedCreator(q[k]);this.setItem(y.node.id,{data:y.data,type:y.type});r.parentNode.insertBefore(y.node,r)}else for(k=0;k<
q.length;++k)y=this._normalizedCreator(q[k]),this.setItem(y.node.id,{data:y.data,type:y.type}),this.parent.appendChild(y.node);return this},destroy:function(){a.forEach(this.events,function(q){q.remove()});this.clearItems();this.node=this.parent=this.current=null},markupFactory:function(q,k,r){q._skipStartup=!0;return new r(k,q)},startup:function(){if(!this.parent&&(this.parent=this.node,"table"==this.parent.tagName.toLowerCase())){var q=this.parent.getElementsByTagName("tbody");q&&q.length&&(this.parent=
q[0])}this.defaultCreator=t._defaultCreator(this.parent);this.sync()},onMouseOver:function(q){for(var k=q.relatedTarget;k&&k!=this.node;)try{k=k.parentNode}catch(r){k=null}k||(this._changeState("Container","Over"),this.onOverEvent());k=this._getChildByEvent(q);this.current!=k&&(this.current&&this._removeItemClass(this.current,"Over"),k&&this._addItemClass(k,"Over"),this.current=k)},onMouseOut:function(q){for(q=q.relatedTarget;q;){if(q==this.node)return;try{q=q.parentNode}catch(k){q=null}}this.current&&
(this._removeItemClass(this.current,"Over"),this.current=null);this._changeState("Container","");this.onOutEvent()},onSelectStart:function(q){this.withHandles||this.skipForm&&t.isFormElement(q)||(q.stopPropagation(),q.preventDefault())},onOverEvent:function(){},onOutEvent:function(){},_changeState:function(q,k){var r="dojoDnd"+q;q=q.toLowerCase()+"State";v.replace(this.node,r+k,r+this[q]);this[q]=k},_addItemClass:function(q,k){v.add(q,"dojoDndItem"+k)},_removeItemClass:function(q,k){v.remove(q,"dojoDndItem"+
k)},_getChildByEvent:function(q){if(q=q.target)for(var k=q.parentNode;k;q=k,k=q.parentNode)if((k==this.parent||this.allowNested)&&v.contains(q,"dojoDndItem"))return q;return null},_normalizedCreator:function(q,k){q=(this.creator||this.defaultCreator).call(this,q,k);n.isArray(q.type)||(q.type=["text"]);q.node.id||(q.node.id=t.getUniqueId());v.add(q.node,"dojoDndItem");return q}});t._createNode=function(q){return q?function(k){return m.create(q,{innerHTML:k})}:t._createSpan};t._createTrTd=function(q){var k=
m.create("tr");m.create("td",{innerHTML:q},k);return k};t._createSpan=function(q){return m.create("span",{innerHTML:q})};t._defaultCreatorNodes={ul:"li",ol:"li",div:"div",p:"div"};t._defaultCreator=function(q){q=q.tagName.toLowerCase();var k="tbody"==q||"thead"==q?t._createTrTd:t._createNode(t._defaultCreatorNodes[q]);return function(r,y){var f=r&&n.isObject(r);if(f&&r.tagName&&r.nodeType&&r.getAttribute){var w=r.getAttribute("dndData")||r.innerHTML;f=(f=r.getAttribute("dndType"))?f.split(/\s*,\s*/):
["text"]}else w=f&&r.data?r.data:r,f=f&&r.type?r.type:["text"],r=("avatar"==y?t._createSpan:k)(String(w));r.id||(r.id=t.getUniqueId());return{node:r,data:w,type:f}}};return b})},"dojo/dnd/Manager":function(){define("../_base/array ../_base/declare ../_base/lang ../_base/window ../dom-class ../Evented ../has ../keys ../on ../topic ../touch ./common ./autoscroll ./Avatar".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t){var q=b("dojo.dnd.Manager",[u],{constructor:function(){this.source=this.avatar=
null;this.nodes=[];this.copy=!0;this.target=null;this.canDropFlag=!1;this.events=[]},OFFSET_X:v("touch")?4:16,OFFSET_Y:v("touch")?4:16,overSource:function(k){this.avatar&&(this.target=k&&"Disabled"!=k.targetState?k:null,this.canDropFlag=!!this.target,this.avatar.update());d.publish("/dnd/source/over",k)},outSource:function(k){this.avatar?this.target==k&&(this.target=null,this.canDropFlag=!1,this.avatar.update(),d.publish("/dnd/source/over",null)):d.publish("/dnd/source/over",null)},startDrag:function(k,
r,y){function f(w){w.preventDefault();w.stopPropagation()}p.autoScrollStart(n.doc);this.source=k;this.nodes=r;this.copy=!!y;this.avatar=this.makeAvatar();n.body().appendChild(this.avatar.node);d.publish("/dnd/start",k,r,this.copy);this.events=[h(n.doc,e.move,c.hitch(this,"onMouseMove")),h(n.doc,e.release,c.hitch(this,"onMouseUp")),h(n.doc,"keydown",c.hitch(this,"onKeyDown")),h(n.doc,"keyup",c.hitch(this,"onKeyUp")),h(n.doc,"dragstart",f),h(n.body(),"selectstart",f)];k="dojoDnd"+(y?"Copy":"Move");
l.add(n.body(),k)},canDrop:function(k){k=!(!this.target||!k);this.canDropFlag!=k&&(this.canDropFlag=k,this.avatar.update())},stopDrag:function(){l.remove(n.body(),["dojoDndCopy","dojoDndMove"]);a.forEach(this.events,function(k){k.remove()});this.events=[];this.avatar.destroy();this.source=this.target=this.avatar=null;this.nodes=[]},makeAvatar:function(){return new t(this)},updateAvatar:function(){this.avatar.update()},onMouseMove:function(k){var r=this.avatar;r&&(p.autoScrollNodes(k),r=r.node.style,
r.left=k.pageX+this.OFFSET_X+"px",r.top=k.pageY+this.OFFSET_Y+"px",r=!!this.source.copyState(g.getCopyKeyState(k)),this.copy!=r&&this._setCopyStatus(r));v("touch")&&k.preventDefault()},onMouseUp:function(k){if(this.avatar){if(this.target&&this.canDropFlag){var r=!!this.source.copyState(g.getCopyKeyState(k));d.publish("/dnd/drop/before",this.source,this.nodes,r,this.target,k);d.publish("/dnd/drop",this.source,this.nodes,r,this.target,k)}else d.publish("/dnd/cancel");this.stopDrag()}},onKeyDown:function(k){if(this.avatar)switch(k.keyCode){case m.CTRL:k=
!!this.source.copyState(!0);this.copy!=k&&this._setCopyStatus(k);break;case m.ESCAPE:d.publish("/dnd/cancel"),this.stopDrag()}},onKeyUp:function(k){this.avatar&&k.keyCode==m.CTRL&&(k=!!this.source.copyState(!1),this.copy!=k&&this._setCopyStatus(k))},_setCopyStatus:function(k){this.copy=k;this.source._markDndStatus(this.copy);this.updateAvatar();l.replace(n.body(),"dojoDnd"+(this.copy?"Copy":"Move"),"dojoDnd"+(this.copy?"Move":"Copy"))}});g._manager=null;q.manager=g.manager=function(){g._manager||
(g._manager=new q);return g._manager};return q})},"dojo/dnd/Avatar":function(){define("../_base/declare ../_base/window ../dom ../dom-attr ../dom-class ../dom-construct ../hccss ../query".split(" "),function(a,b,c,n,l,u,v,m){return a("dojo.dnd.Avatar",null,{constructor:function(h){this.manager=h;this.construct()},construct:function(){var h=u.create("table",{"class":"dojoDndAvatar",style:{position:"absolute",zIndex:"1999",margin:"0px"}}),d=this.manager.source,e=u.create("tbody",null,h),g=u.create("tr",
null,e),p=u.create("td",null,g),t=Math.min(5,this.manager.nodes.length),q=0;v("highcontrast")&&u.create("span",{id:"a11yIcon",innerHTML:this.manager.copy?"+":"\x3c"},p);u.create("span",{innerHTML:d.generateText?this._generateText():""},p);for(n.set(g,{"class":"dojoDndAvatarHeader",style:{opacity:.9}});q<t;++q){if(d.creator)var k=d._normalizedCreator(d.getItem(this.manager.nodes[q].id).data,"avatar").node;else k=this.manager.nodes[q].cloneNode(!0),"tr"==k.tagName.toLowerCase()&&(g=u.create("table"),
u.create("tbody",null,g).appendChild(k),k=g);k.id="";g=u.create("tr",null,e);p=u.create("td",null,g);p.appendChild(k);n.set(g,{"class":"dojoDndAvatarItem",style:{opacity:(9-q)/10}})}this.node=h},destroy:function(){u.destroy(this.node);this.node=!1},update:function(){l.toggle(this.node,"dojoDndAvatarCanDrop",this.manager.canDropFlag);if(v("highcontrast")){var h=c.byId("a11yIcon"),d="+";this.manager.canDropFlag&&!this.manager.copy?d="\x3c ":this.manager.canDropFlag||this.manager.copy?this.manager.canDropFlag||
(d="x"):d="o";h.innerHTML=d}m("tr.dojoDndAvatarHeader td span"+(v("highcontrast")?" span":""),this.node).forEach(function(e){e.innerHTML=this.manager.source.generateText?this._generateText():""},this)},_generateText:function(){return this.manager.nodes.length.toString()}})})},"dijit/CheckedMenuItem":function(){define(["dojo/_base/declare","dojo/dom-class","./MenuItem","dojo/text!./templates/CheckedMenuItem.html","./hccss"],function(a,b,c,n){return a("dijit.CheckedMenuItem",c,{baseClass:"dijitMenuItem dijitCheckedMenuItem",
templateString:n,checked:!1,_setCheckedAttr:function(l){this.domNode.setAttribute("aria-checked",l?"true":"false");this._set("checked",l)},iconClass:"",role:"menuitemcheckbox",checkedChar:"\x26#10003;",onChange:function(){},_onClick:function(l){this.disabled||(this.set("checked",!this.checked),this.onChange(this.checked));this.onClick(l)}})})},"dijit/MenuItem":function(){define("dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/_base/kernel dojo/sniff dojo/_base/lang ./_Widget ./_TemplatedMixin ./_Contained ./_CssStateMixin dojo/text!./templates/MenuItem.html".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g){v=a("dijit.MenuItem"+(u("dojo-bidi")?"_NoBidi":""),[m,h,d,e],{templateString:g,baseClass:"dijitMenuItem",label:"",_setLabelAttr:function(p){this._set("label",p);var t="";var q=p.search(/{\S}/);if(0<=q){t=p.charAt(q+1);var k=p.substr(0,q);p=p.substr(q+3);q=k+t+p;p=k+'\x3cspan class\x3d"dijitMenuItemShortcutKey"\x3e'+t+"\x3c/span\x3e"+p}else q=p;this.domNode.setAttribute("aria-label",q+" "+this.accelKey);this.containerNode.innerHTML=p;this._set("shortcutKey",t)},iconClass:"dijitNoIcon",
_setIconClassAttr:{node:"iconNode",type:"class"},accelKey:"",disabled:!1,_fillContent:function(p){!p||"label"in this.params||this._set("label",p.innerHTML)},buildRendering:function(){this.inherited(arguments);c.set(this.containerNode,"id",this.id+"_text");this.accelKeyNode&&c.set(this.accelKeyNode,"id",this.id+"_accel");b.setSelectable(this.domNode,!1)},onClick:function(){},focus:function(){try{8==u("ie")&&this.containerNode.focus(),this.focusNode.focus()}catch(p){}},_setSelected:function(p){n.toggle(this.domNode,
"dijitMenuItemSelected",p)},setLabel:function(p){l.deprecated("dijit.MenuItem.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",p)},setDisabled:function(p){l.deprecated("dijit.Menu.setDisabled() is deprecated.  Use set('disabled', bool) instead.","","2.0");this.set("disabled",p)},_setDisabledAttr:function(p){this.focusNode.setAttribute("aria-disabled",p?"true":"false");this._set("disabled",p)},_setAccelKeyAttr:function(p){this.accelKeyNode&&(this.accelKeyNode.style.display=
p?"":"none",this.accelKeyNode.innerHTML=p,c.set(this.containerNode,"colSpan",p?"1":"2"));this._set("accelKey",p)}});u("dojo-bidi")&&(v=a("dijit.MenuItem",v,{_setLabelAttr:function(p){this.inherited(arguments);"auto"===this.textDir&&this.applyTextDir(this.textDirNode)}}));return v})},"dijit/form/Select":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/i18n dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormSelectWidget ../_HasDropDown ../DropDownMenu ../MenuItem ../MenuSeparator ../Tooltip ../_KeyNavMixin ../registry dojo/text!./templates/Select.html dojo/i18n!./nls/validate".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f){function w(A){return function(x){this._isLoaded?this.inherited(A,arguments):this.loadDropDown(m.hitch(this,A,x))}}var z=b("dijit.form._SelectMenu",p,{autoFocus:!0,buildRendering:function(){this.inherited(arguments);this.domNode.setAttribute("role","listbox")},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(A){A.preventDefault();A.stopPropagation()}))},focus:function(){var A=!1,x=this.parentWidget.value;
m.isArray(x)&&(x=x[x.length-1]);x&&a.forEach(this.parentWidget._getChildren(),function(B){B.option&&x===B.option.value&&(A=!0,this.focusChild(B,!1))},this);A||this.inherited(arguments)}});l=b("dijit.form.Select"+(d("dojo-bidi")?"_NoBidi":""),[e,g,r],{baseClass:"dijitSelect dijitValidationTextBox",templateString:f,_buttonInputDisabled:d("ie")?"disabled":"",required:!1,state:"",message:"",tooltipPosition:[],emptyLabel:"\x26#160;",_isLoaded:!1,_childrenLoaded:!1,labelType:"html",_fillContent:function(){this.inherited(arguments);
if(this.options.length&&!this.value&&this.srcNodeRef){var A=this.srcNodeRef.selectedIndex||0;this._set("value",this.options[0<=A?A:0].value)}this.dropDown=new z({id:this.id+"_menu",parentWidget:this});n.add(this.dropDown.domNode,this.baseClass.replace(/\s+|$/g,"Menu "))},_getMenuItemForOption:function(A){if(A.value||A.label){var x=m.hitch(this,"_setValueAttr",A);A=new t({option:A,label:("text"===this.labelType?(A.label||"").toString().replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):A.label)||this.emptyLabel,
onClick:x,ownerDocument:this.ownerDocument,dir:this.dir,textDir:this.textDir,disabled:A.disabled||!1});A.focusNode.setAttribute("role","option");return A}return new q({ownerDocument:this.ownerDocument})},_addOptionItem:function(A){this.dropDown&&this.dropDown.addChild(this._getMenuItemForOption(A))},_getChildren:function(){return this.dropDown?this.dropDown.getChildren():[]},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(A){}},focusChild:function(A){A&&this.set("value",
A.option)},_getFirst:function(){var A=this._getChildren();return A.length?A[0]:null},_getLast:function(){var A=this._getChildren();return A.length?A[A.length-1]:null},childSelector:function(A){return(A=y.byNode(A))&&A.getParent()==this.dropDown},onKeyboardSearch:function(A,x,B,C){A&&this.focusChild(A)},_loadChildren:function(A){if(!0===A)if(this.dropDown&&(delete this.dropDown.focusedChild,this.focusedChild=null),this.options.length)this.inherited(arguments);else{a.forEach(this._getChildren(),function(B){B.destroyRecursive()});
var x=new t({ownerDocument:this.ownerDocument,label:this.emptyLabel});this.dropDown.addChild(x)}else this._updateSelection();this._isLoaded=!1;this._childrenLoaded=!0;this._loadingStore||this._setValueAttr(this.value,!1)},_refreshState:function(){this._started&&this.validate(this.focused)},startup:function(){this.inherited(arguments);this._refreshState()},_setValueAttr:function(A){this.inherited(arguments);c.set(this.valueNode,"value",this.get("value"));this._refreshState()},_setNameAttr:"valueNode",
_setDisabledAttr:function(A){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(A){this._set("required",A);this.focusNode.setAttribute("aria-required",A);this._refreshState()},_setOptionsAttr:function(A){this._isLoaded=!1;this._set("options",A)},_setDisplay:function(A){A=("text"===this.labelType?(A||"").replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;"):A)||this.emptyLabel;this.containerNode.innerHTML='\x3cspan role\x3d"option" aria-selected\x3d"true" class\x3d"dijitReset dijitInline '+
this.baseClass.replace(/\s+|$/g,"Label ")+'"\x3e'+A+"\x3c/span\x3e"},validate:function(A){A=this.disabled||this.isValid(A);this._set("state",A?"":this._hasBeenBlurred?"Error":"Incomplete");this.focusNode.setAttribute("aria-invalid",A?"false":"true");var x=A?"":this._missingMsg;x&&this.focused&&this._hasBeenBlurred?k.show(x,this.domNode,this.tooltipPosition,!this.isLeftToRight()):k.hide(this.domNode);this._set("message",x);return A},isValid:function(){return!this.required||0===this.value||!/^\s*$/.test(this.value||
"")},reset:function(){this.inherited(arguments);k.hide(this.domNode);this._refreshState()},postMixInProperties:function(){this.inherited(arguments);this._missingMsg=u.getLocalization("dijit.form","validate",this.lang).missingMessage},postCreate:function(){this.inherited(arguments);this.own(h(this.domNode,"selectstart",function(x){x.preventDefault();x.stopPropagation()}));this.domNode.setAttribute("aria-expanded","false");var A=this._keyNavCodes;delete A[v.LEFT_ARROW];delete A[v.RIGHT_ARROW]},_setStyleAttr:function(A){this.inherited(arguments);
n.toggle(this.domNode,this.baseClass.replace(/\s+|$/g,"FixedWidth "),!!this.domNode.style.width)},isLoaded:function(){return this._isLoaded},loadDropDown:function(A){this._loadChildren(!0);this._isLoaded=!0;A()},destroy:function(A){this.dropDown&&!this.dropDown._destroyed&&(this.dropDown.destroyRecursive(A),delete this.dropDown);k.hide(this.domNode);this.inherited(arguments)},_onFocus:function(){this.validate(!0)},_onBlur:function(){k.hide(this.domNode);this.inherited(arguments);this.validate(!1)}});
d("dojo-bidi")&&(l=b("dijit.form.Select",l,{_setDisplay:function(A){this.inherited(arguments);this.applyTextDir(this.containerNode)}}));l._Menu=z;l.prototype._onContainerKeydown=w("_onContainerKeydown");l.prototype._onContainerKeypress=w("_onContainerKeypress");return l})},"dijit/form/_FormSelectWidget":function(){define("dojo/_base/array dojo/_base/Deferred dojo/aspect dojo/data/util/sorter dojo/_base/declare dojo/dom dojo/dom-class dojo/_base/kernel dojo/_base/lang dojo/query dojo/when dojo/store/util/QueryResults ./_FormValueWidget".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p){return l("dijit.form._FormSelectWidget",p,{multiple:!1,options:null,store:null,_setStoreAttr:function(t){this._created&&this._deprecatedSetStore(t)},query:null,_setQueryAttr:function(t){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{query:t})},queryOptions:null,_setQueryOptionsAttr:function(t){this._created&&this._deprecatedSetStore(this.store,this.selectedValue,{queryOptions:t})},labelAttr:"",onFetch:null,sortByLabel:!0,loadChildrenOnOpen:!1,
onLoadDeferred:null,getOptions:function(t){var q=this.options||[];if(null==t)return q;if(h.isArrayLike(t))return a.map(t,"return this.getOptions(item);",this);h.isString(t)&&(t={value:t});h.isObject(t)&&(a.some(q,function(k,r){for(var y in t)if(!(y in k)||k[y]!=t[y])return!1;t=r;return!0})||(t=-1));return 0<=t&&t<q.length?q[t]:null},addOption:function(t){a.forEach(h.isArrayLike(t)?t:[t],function(q){q&&h.isObject(q)&&this.options.push(q)},this);this._loadChildren()},removeOption:function(t){t=this.getOptions(h.isArrayLike(t)?
t:[t]);a.forEach(t,function(q){q&&(this.options=a.filter(this.options,function(k){return k.value!==q.value||k.label!==q.label}),this._removeOptionItem(q))},this);this._loadChildren()},updateOption:function(t){a.forEach(h.isArrayLike(t)?t:[t],function(q){var k=this.getOptions({value:q.value}),r;if(k)for(r in q)k[r]=q[r]},this);this._loadChildren()},setStore:function(t,q,k){m.deprecated(this.declaredClass+"::setStore(store, selectedValue, fetchArgs) is deprecated. Use set('query', fetchArgs.query), set('queryOptions', fetchArgs.queryOptions), set('store', store), or set('value', selectedValue) instead.",
"","2.0");this._deprecatedSetStore(t,q,k)},_deprecatedSetStore:function(t,q,k){var r=this.store;k=k||{};if(r!==t){for(var y;y=this._notifyConnections.pop();)y.remove();t.get||(h.mixin(t,{_oldAPI:!0,get:function(f){var w=new b;this.fetchItemByIdentity({identity:f,onItem:function(z){w.resolve(z)},onError:function(z){w.reject(z)}});return w.promise},query:function(f,w){var z=new b(function(){A.abort&&A.abort()});z.total=new b;var A=this.fetch(h.mixin({query:f,onBegin:function(x){z.total.resolve(x)},
onComplete:function(x){z.resolve(x)},onError:function(x){z.reject(x)}},w));return new g(z)}}),t.getFeatures()["dojo.data.api.Notification"]&&(this._notifyConnections=[c.after(t,"onNew",h.hitch(this,"_onNewItem"),!0),c.after(t,"onDelete",h.hitch(this,"_onDeleteItem"),!0),c.after(t,"onSet",h.hitch(this,"_onSetItem"),!0)]));this._set("store",t)}this.options&&this.options.length&&this.removeOption(this.options);this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&
(this._observeHandle.remove(),this._observeHandle=null);k.query&&this._set("query",k.query);k.queryOptions&&this._set("queryOptions",k.queryOptions);t&&t.query&&(this._loadingStore=!0,this.onLoadDeferred=new b,this._queryRes=t.query(this.query,this.queryOptions),e(this._queryRes,h.hitch(this,function(f){if(this.sortByLabel&&!k.sort&&f.length)if(t.getValue)f.sort(n.createSortFunction([{attribute:t.getLabelAttributes(f[0])[0]}],t));else{var w=this.labelAttr;f.sort(function(z,A){return z[w]>A[w]?1:A[w]>
z[w]?-1:0})}k.onFetch&&(f=k.onFetch.call(this,f,k));a.forEach(f,function(z){this._addOptionForItem(z)},this);this._queryRes.observe&&(this._observeHandle=this._queryRes.observe(h.hitch(this,function(z,A,x){A==x?this._onSetItem(z):(-1!=A&&this._onDeleteItem(z),-1!=x&&this._onNewItem(z))}),!0));this._loadingStore=!1;this.set("value","_pendingValue"in this?this._pendingValue:q);delete this._pendingValue;this.loadChildrenOnOpen?this._pseudoLoadChildren(f):this._loadChildren();this.onLoadDeferred.resolve(!0);
this.onSetStore()}),h.hitch(this,function(f){console.error("dijit.form.Select: "+f.toString());this.onLoadDeferred.reject(f)})));return r},_setValueAttr:function(t,q){this._onChangeActive||(q=null);if(this._loadingStore)this._pendingValue=t;else if(null!=t){t=h.isArrayLike(t)?a.map(t,function(y){return h.isObject(y)?y:{value:y}}):h.isObject(t)?[t]:[{value:t}];t=a.filter(this.getOptions(t),function(y){return y&&y.value});var k=this.getOptions()||[];this.multiple||t[0]&&t[0].value||!k.length||(t[0]=
k[0]);a.forEach(k,function(y){y.selected=a.some(t,function(f){return f.value===y.value})});k=a.map(t,function(y){return y.value});if("undefined"!=typeof k&&"undefined"!=typeof k[0]){var r=a.map(t,function(y){return y.label});this._setDisplay(this.multiple?r:r[0]);this.inherited(arguments,[this.multiple?k:k[0],q]);this._updateSelection()}}},_getDisplayedValueAttr:function(){var t=a.map([].concat(this.get("selectedOptions")),function(q){return q&&"label"in q?q.label:q?q.value:null},this);return this.multiple?
t:t[0]},_setDisplayedValueAttr:function(t){this.set("value",this.getOptions("string"==typeof t?{label:t}:t))},_loadChildren:function(){this._loadingStore||(a.forEach(this._getChildren(),function(t){t.destroyRecursive()}),a.forEach(this.options,this._addOptionItem,this),this._updateSelection())},_updateSelection:function(){this.focusedChild=null;this._set("value",this._getValueFromOpts());var t=[].concat(this.value);if(t&&t[0]){var q=this;a.forEach(this._getChildren(),function(k){var r=a.some(t,function(y){return k.option&&
y===k.option.value});r&&!q.multiple&&(q.focusedChild=k);v.toggle(k.domNode,this.baseClass.replace(/\s+|$/g,"SelectedOption "),r);k.domNode.setAttribute("aria-selected",r?"true":"false")},this)}},_getValueFromOpts:function(){var t=this.getOptions()||[];if(!this.multiple&&t.length){var q=a.filter(t,function(k){return k.selected})[0];if(q&&q.value)return q.value;t[0].selected=!0;return t[0].value}return this.multiple?a.map(a.filter(t,function(k){return k.selected}),function(k){return k.value})||[]:""},
_onNewItem:function(t,q){q&&q.parent||this._addOptionForItem(t)},_onDeleteItem:function(t){this.removeOption({value:this.store.getIdentity(t)})},_onSetItem:function(t){this.updateOption(this._getOptionObjForItem(t))},_getOptionObjForItem:function(t){var q=this.store,k=this.labelAttr&&this.labelAttr in t?t[this.labelAttr]:q.getLabel(t);return{value:k?q.getIdentity(t):null,label:k,item:t}},_addOptionForItem:function(t){var q=this.store;q.isItemLoaded&&!q.isItemLoaded(t)?q.loadItem({item:t,onItem:function(k){this._addOptionForItem(k)},
scope:this}):(t=this._getOptionObjForItem(t),this.addOption(t))},constructor:function(t){this._oValue=(t||{}).value||null;this._notifyConnections=[]},buildRendering:function(){this.inherited(arguments);u.setSelectable(this.focusNode,!1)},_fillContent:function(){this.options||(this.options=this.srcNodeRef?d("\x3e *",this.srcNodeRef).map(function(t){return"separator"===t.getAttribute("type")?{value:"",label:"",selected:!1,disabled:!1}:{value:t.getAttribute("data-"+m._scopeName+"-value")||t.getAttribute("value"),
label:String(t.innerHTML),selected:t.getAttribute("selected")||!1,disabled:t.getAttribute("disabled")||!1}},this):[]);this.value?this.multiple&&"string"==typeof this.value&&this._set("value",this.value.split(",")):this._set("value",this._getValueFromOpts())},postCreate:function(){this.inherited(arguments);c.after(this,"onChange",h.hitch(this,"_updateSelection"));var t=this.store;t&&(t.getIdentity||t.getFeatures()["dojo.data.api.Identity"])&&(this.store=null,this._deprecatedSetStore(t,this._oValue,
{query:this.query,queryOptions:this.queryOptions}));this._storeInitialized=!0},startup:function(){this._loadChildren();this.inherited(arguments)},destroy:function(){for(var t;t=this._notifyConnections.pop();)t.remove();this._queryRes&&this._queryRes.close&&this._queryRes.close();this._observeHandle&&this._observeHandle.remove&&(this._observeHandle.remove(),this._observeHandle=null);this.inherited(arguments)},_addOptionItem:function(){},_removeOptionItem:function(){},_setDisplay:function(){},_getChildren:function(){return[]},
_getSelectedOptionsAttr:function(){return this.getOptions({selected:!0})},_pseudoLoadChildren:function(){},onSetStore:function(){}})})},"dojo/data/util/sorter":function(){define(["../../_base/lang"],function(a){var b={};a.setObject("dojo.data.util.sorter",b);b.basicComparator=function(c,n){var l=-1;null===c&&(c=void 0);null===n&&(n=void 0);if(c==n)l=0;else if(c>n||null==c)l=1;return l};b.createSortFunction=function(c,n){function l(p,t,q,k){return function(r,y){r=k.getValue(r,p);y=k.getValue(y,p);
return t*q(r,y)}}for(var u=[],v,m=n.comparatorMap,h=b.basicComparator,d=0;d<c.length;d++){v=c[d];var e=v.attribute;if(e){v=v.descending?-1:1;var g=h;m&&("string"!==typeof e&&"toString"in e&&(e=e.toString()),g=m[e]||h);u.push(l(e,v,g,n))}}return function(p,t){for(var q=0;q<u.length;){var k=u[q++](p,t);if(0!==k)return k}return 0}};return b})},"dijit/form/_FormValueWidget":function(){define(["dojo/_base/declare","dojo/sniff","./_FormWidget","./_FormValueMixin"],function(a,b,c,n){return a("dijit.form._FormValueWidget",
[c,n],{_layoutHackIE7:function(){if(7==b("ie"))for(var l=this.domNode,u=l.parentNode,v=l.firstChild||l,m=v.style.filter,h=this;u&&0==u.clientHeight;)(function(){var d=h.connect(u,"onscroll",function(){h.disconnect(d);v.style.filter=(new Date).getMilliseconds();h.defer(function(){v.style.filter=m})})})(),u=u.parentNode}})})},"dijit/form/_FormWidget":function(){define("dojo/_base/declare dojo/sniff dojo/_base/kernel dojo/ready ../_Widget ../_CssStateMixin ../_TemplatedMixin ./_FormWidgetMixin".split(" "),
function(a,b,c,n,l,u,v,m){b("dijit-legacy-requires")&&n(0,function(){require(["dijit/form/_FormValueWidget"])});return a("dijit.form._FormWidget",[l,v,u,m],{setDisabled:function(h){c.deprecated("setDisabled("+h+") is deprecated. Use set('disabled',"+h+") instead.","","2.0");this.set("disabled",h)},setValue:function(h){c.deprecated("dijit.form._FormWidget:setValue("+h+") is deprecated.  Use set('value',"+h+") instead.","","2.0");this.set("value",h)},getValue:function(){c.deprecated(this.declaredClass+
"::getValue() is deprecated. Use get('value') instead.","","2.0");return this.get("value")},postMixInProperties:function(){this.nameAttrSetting=this.name?'name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"";this.inherited(arguments)}})})},"dijit/form/_FormWidgetMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff dojo/window ../a11y".split(" "),function(a,b,c,n,l,u,v,m,h,d){return b("dijit.form._FormWidgetMixin",
null,{name:"",alt:"",value:"",type:"text","aria-label":"focusNode",tabIndex:"0",_setTabIndexAttr:"focusNode",disabled:!1,intermediateChanges:!1,scrollOnFocus:!0,_setIdAttr:"focusNode",_setDisabledAttr:function(e){this._set("disabled",e);/^(button|input|select|textarea|optgroup|option|fieldset)$/i.test(this.focusNode.tagName)?c.set(this.focusNode,"disabled",e):this.focusNode.setAttribute("aria-disabled",e?"true":"false");this.valueNode&&c.set(this.valueNode,"disabled",e);e?(this._set("hovering",!1),
this._set("active",!1),e="tabIndex"in this.attributeMap?this.attributeMap.tabIndex:"_setTabIndexAttr"in this?this._setTabIndexAttr:"focusNode",a.forEach(l.isArray(e)?e:[e],function(g){g=this[g];m("webkit")||d.hasDefaultTabStop(g)?g.setAttribute("tabIndex","-1"):g.removeAttribute("tabIndex")},this)):""!=this.tabIndex&&this.set("tabIndex",this.tabIndex)},_onFocus:function(e){if("mouse"==e&&this.isFocusable())var g=this.own(v(this.focusNode,"focus",function(){p.remove();g.remove()}))[0],p=this.own(v(this.ownerDocumentBody,
"pointerup",l.hitch(this,function(t){p.remove();g.remove();this.focused&&("touchend"==t.type?this.defer("focus"):this.focus())})))[0];this.scrollOnFocus&&this.defer(function(){h.scrollIntoView(this.domNode)});this.inherited(arguments)},isFocusable:function(){return!this.disabled&&this.focusNode&&"none"!=n.get(this.domNode,"display")},focus:function(){if(!this.disabled&&this.focusNode.focus)try{this.focusNode.focus()}catch(e){}},compare:function(e,g){return"number"==typeof e&&"number"==typeof g?isNaN(e)&&
isNaN(g)?0:e-g:e>g?1:e<g?-1:0},onChange:function(){},_onChangeActive:!1,_handleOnChange:function(e,g){void 0!=this._lastValueReported||null!==g&&this._onChangeActive||(this._resetValue=this._lastValueReported=e);this._pendingOnChange=this._pendingOnChange||typeof e!=typeof this._lastValueReported||0!=this.compare(e,this._lastValueReported);(this.intermediateChanges||g||void 0===g)&&this._pendingOnChange&&(this._lastValueReported=e,this._pendingOnChange=!1,this._onChangeActive&&(this._onChangeHandle&&
this._onChangeHandle.remove(),this._onChangeHandle=this.defer(function(){this._onChangeHandle=null;this.onChange(e)})))},create:function(){this.inherited(arguments);this._onChangeActive=!0},destroy:function(){this._onChangeHandle&&(this._onChangeHandle.remove(),this.onChange(this._lastValueReported));this.inherited(arguments)}})})},"dijit/form/_FormValueMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/on dojo/sniff ./_FormWidgetMixin".split(" "),function(a,
b,c,n,l,u,v){return a("dijit.form._FormValueMixin",v,{readOnly:!1,_setReadOnlyAttr:function(m){b.set(this.focusNode,"readOnly",m);this._set("readOnly",m)},postCreate:function(){this.inherited(arguments);void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.value)},_setValueAttr:function(m,h){this._handleOnChange(m,h)},_handleOnChange:function(m,h){this._set("value",m);this.inherited(arguments)},undo:function(){this._setValueAttr(this._lastValueReported,!1)},reset:function(){this._hasBeenBlurred=
!1;this._setValueAttr(this._resetValue,!0)}})})},"dijit/_HasDropDown":function(){define("dojo/_base/declare dojo/_base/Deferred dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/has dojo/keys dojo/_base/lang dojo/on dojo/touch ./registry ./focus ./popup ./_FocusMixin".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k){return a("dijit._HasDropDown",k,{_buttonNode:null,_arrowWrapperNode:null,_popupStateNode:null,_aroundNode:null,dropDown:null,autoWidth:!0,forceWidth:!1,maxHeight:-1,
dropDownPosition:["below","above"],_stopClickEvents:!0,_onDropDownMouseDown:function(r){this.disabled||this.readOnly||("MSPointerDown"!=r.type&&r.preventDefault(),this.own(e.once(this.ownerDocument,g.release,d.hitch(this,"_onDropDownMouseUp"))),this.toggleDropDown())},_onDropDownMouseUp:function(r){var y=this.dropDown,f=!1;if(r&&this._opened){var w=u.position(this._buttonNode,!0);if(!(r.pageX>=w.x&&r.pageX<=w.x+w.w&&r.pageY>=w.y&&r.pageY<=w.y+w.h)){for(w=r.target;w&&!f;)l.contains(w,"dijitPopup")?
f=!0:w=w.parentNode;if(f){w=r.target;if(y.onItemClick){for(var z;w&&!(z=p.byNode(w));)w=w.parentNode;if(z&&z.onClick&&z.getParent)z.getParent().onItemClick(z,r)}return}}}this._opened?y.focus&&(!1!==y.autoFocus||"mouseup"==r.type&&!this.hovering)&&(this._focusDropDownTimer=this.defer(function(){y.focus();delete this._focusDropDownTimer})):this.focus&&this.defer("focus")},_onDropDownClick:function(r){this._stopClickEvents&&(r.stopPropagation(),r.preventDefault())},buildRendering:function(){this.inherited(arguments);
this._buttonNode=this._buttonNode||this.focusNode||this.domNode;this._popupStateNode=this._popupStateNode||this.focusNode||this._buttonNode;var r={after:this.isLeftToRight()?"Right":"Left",before:this.isLeftToRight()?"Left":"Right",above:"Up",below:"Down",left:"Left",right:"Right"}[this.dropDownPosition[0]]||this.dropDownPosition[0]||"Down";l.add(this._arrowWrapperNode||this._buttonNode,"dijit"+r+"ArrowButton")},postCreate:function(){this.inherited(arguments);var r=this.focusNode||this.domNode;this.own(e(this._buttonNode,
g.press,d.hitch(this,"_onDropDownMouseDown")),e(this._buttonNode,"click",d.hitch(this,"_onDropDownClick")),e(r,"keydown",d.hitch(this,"_onKey")),e(r,"keyup",d.hitch(this,"_onKeyUp")))},destroy:function(){this._opened&&this.closeDropDown(!0);this.dropDown&&(this.dropDown._destroyed||this.dropDown.destroyRecursive(),delete this.dropDown);this.inherited(arguments)},_onKey:function(r){if(!this.disabled&&!this.readOnly){var y=this.dropDown,f=r.target;y&&this._opened&&y.handleKey&&!1===y.handleKey(r)?(r.stopPropagation(),
r.preventDefault()):y&&this._opened&&r.keyCode==h.ESCAPE?(this.closeDropDown(),r.stopPropagation(),r.preventDefault()):!this._opened&&(r.keyCode==h.DOWN_ARROW||(r.keyCode==h.ENTER||r.keyCode==h.SPACE&&(!this._searchTimer||r.ctrlKey||r.altKey||r.metaKey))&&("input"!==(f.tagName||"").toLowerCase()||f.type&&"text"!==f.type.toLowerCase()))&&(this._toggleOnKeyUp=!0,r.stopPropagation(),r.preventDefault())}},_onKeyUp:function(){if(this._toggleOnKeyUp){delete this._toggleOnKeyUp;this.toggleDropDown();var r=
this.dropDown;r&&r.focus&&this.defer(d.hitch(r,"focus"),1)}},_onBlur:function(){this.closeDropDown(!1);this.inherited(arguments)},isLoaded:function(){return!0},loadDropDown:function(r){r()},loadAndOpenDropDown:function(){var r=new b,y=d.hitch(this,function(){this.openDropDown();r.resolve(this.dropDown)});this.isLoaded()?y():this.loadDropDown(y);return r},toggleDropDown:function(){this.disabled||this.readOnly||(this._opened?this.closeDropDown(!0):this.loadAndOpenDropDown())},openDropDown:function(){var r=
this.dropDown,y=r.domNode,f=this._aroundNode||this.domNode,w=this,z=q.open({parent:this,popup:r,around:f,orient:this.dropDownPosition,maxHeight:this.maxHeight,onExecute:function(){w.closeDropDown(!0)},onCancel:function(){w.closeDropDown(!0)},onClose:function(){n.set(w._popupStateNode,"popupActive",!1);l.remove(w._popupStateNode,"dijitHasDropDownOpen");w._set("_opened",!1)}});if(this.forceWidth||this.autoWidth&&f.offsetWidth>r._popupWrapper.offsetWidth){f=f.offsetWidth-r._popupWrapper.offsetWidth;
var A={w:r.domNode.offsetWidth+f};this._origStyle=y.style.cssText;d.isFunction(r.resize)?r.resize(A):u.setMarginBox(y,A);"R"==z.corner[1]&&(r._popupWrapper.style.left=r._popupWrapper.style.left.replace("px","")-f+"px")}n.set(this._popupStateNode,"popupActive","true");l.add(this._popupStateNode,"dijitHasDropDownOpen");this._set("_opened",!0);this._popupStateNode.setAttribute("aria-expanded","true");this._popupStateNode.setAttribute("aria-owns",r.id);"presentation"===y.getAttribute("role")||y.getAttribute("aria-labelledby")||
y.setAttribute("aria-labelledby",this.id);return z},closeDropDown:function(r){this._focusDropDownTimer&&(this._focusDropDownTimer.remove(),delete this._focusDropDownTimer);this._opened&&(this._popupStateNode.setAttribute("aria-expanded","false"),r&&this.focus&&this.focus(),q.close(this.dropDown),this._opened=!1);this._origStyle&&(this.dropDown.domNode.style.cssText=this._origStyle,delete this._origStyle)}})})},"dijit/MenuSeparator":function(){define("dojo/_base/declare dojo/dom ./_WidgetBase ./_TemplatedMixin ./_Contained dojo/text!./templates/MenuSeparator.html".split(" "),
function(a,b,c,n,l,u){return a("dijit.MenuSeparator",[c,n,l],{templateString:u,buildRendering:function(){this.inherited(arguments);b.setSelectable(this.domNode,!1)},isFocusable:function(){return!1}})})},"dijit/Tooltip":function(){define("dojo/_base/array dojo/_base/declare dojo/_base/fx dojo/dom dojo/dom-class dojo/dom-geometry dojo/dom-style dojo/_base/lang dojo/mouse dojo/on dojo/sniff ./_base/manager ./place ./_Widget ./_TemplatedMixin ./BackgroundIframe dojo/text!./templates/Tooltip.html ./main".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y){function f(){}var w=b("dijit._MasterTooltip",[t,q],{duration:g.defaultDuration,templateString:r,postCreate:function(){this.ownerDocumentBody.appendChild(this.domNode);this.bgIframe=new k(this.domNode);this.fadeIn=c.fadeIn({node:this.domNode,duration:this.duration,onEnd:m.hitch(this,"_onShow")});this.fadeOut=c.fadeOut({node:this.domNode,duration:this.duration,onEnd:m.hitch(this,"_onHide")})},show:function(A,x,B,C,D,E,F){if(!this.aroundNode||this.aroundNode!==
x||this.containerNode.innerHTML!=A)if("playing"==this.fadeOut.status())this._onDeck=arguments;else{this.containerNode.innerHTML=A;D&&this.set("textDir",D);this.containerNode.align=C?"right":"left";var G=p.around(this.domNode,x,B&&B.length?B:z.defaultPosition,!C,m.hitch(this,"orient")),O=G.aroundNodePos;"M"==G.corner.charAt(0)&&"M"==G.aroundCorner.charAt(0)?(this.connectorNode.style.top=O.y+(O.h-this.connectorNode.offsetHeight>>1)-G.y+"px",this.connectorNode.style.left=""):"M"==G.corner.charAt(1)&&
"M"==G.aroundCorner.charAt(1)?this.connectorNode.style.left=O.x+(O.w-this.connectorNode.offsetWidth>>1)-G.x+"px":(this.connectorNode.style.left="",this.connectorNode.style.top="");v.set(this.domNode,"opacity",0);this.fadeIn.play();this.isShowingNow=!0;this.aroundNode=x;this.onMouseEnter=E||f;this.onMouseLeave=F||f}},orient:function(A,x,B,C,D){this.connectorNode.style.top="";var E=C.h;C=C.w;A.className="dijitTooltip "+{"MR-ML":"dijitTooltipRight","ML-MR":"dijitTooltipLeft","TM-BM":"dijitTooltipAbove",
"BM-TM":"dijitTooltipBelow","BL-TL":"dijitTooltipBelow dijitTooltipABLeft","TL-BL":"dijitTooltipAbove dijitTooltipABLeft","BR-TR":"dijitTooltipBelow dijitTooltipABRight","TR-BR":"dijitTooltipAbove dijitTooltipABRight","BR-BL":"dijitTooltipRight","BL-BR":"dijitTooltipLeft"}[x+"-"+B];this.domNode.style.width="auto";var F=u.position(this.domNode);e("ie")&&(F.w+=2);u.setMarginBox(this.domNode,{w:Math.min(Math.max(C,1),F.w)});"B"==B.charAt(0)&&"B"==x.charAt(0)?(A=u.position(A),x=this.connectorNode.offsetHeight,
A.h>E?(this.connectorNode.style.top=E-(D.h+x>>1)+"px",this.connectorNode.style.bottom=""):(this.connectorNode.style.bottom=Math.min(Math.max(D.h/2-x/2,0),A.h-x)+"px",this.connectorNode.style.top="")):(this.connectorNode.style.top="",this.connectorNode.style.bottom="");return Math.max(0,F.w-C)},_onShow:function(){e("ie")&&(this.domNode.style.filter="")},hide:function(A){this._onDeck&&this._onDeck[1]==A?this._onDeck=null:this.aroundNode===A&&(this.fadeIn.stop(),this.isShowingNow=!1,this.aroundNode=
null,this.fadeOut.play());this.onMouseEnter=this.onMouseLeave=f},_onHide:function(){this.domNode.style.cssText="";this.containerNode.innerHTML="";this._onDeck&&(this.show.apply(this,this._onDeck),this._onDeck=null)}});e("dojo-bidi")&&w.extend({_setAutoTextDir:function(A){this.applyTextDir(A);a.forEach(A.children,function(x){this._setAutoTextDir(x)},this)},_setTextDirAttr:function(A){this._set("textDir",A);"auto"==A?this._setAutoTextDir(this.containerNode):this.containerNode.dir=this.textDir}});y.showTooltip=
function(A,x,B,C,D,E,F){B&&(B=a.map(B,function(G){return{after:"after-centered",before:"before-centered"}[G]||G}));z._masterTT||(y._masterTT=z._masterTT=new w);return z._masterTT.show(A,x,B,C,D,E,F)};y.hideTooltip=function(A){return z._masterTT&&z._masterTT.hide(A)};var z=b("dijit.Tooltip",t,{label:"",showDelay:400,hideDelay:400,connectId:[],position:[],selector:"",_setConnectIdAttr:function(A){a.forEach(this._connections||[],function(x){a.forEach(x,function(B){B.remove()})},this);this._connectIds=
a.filter(m.isArrayLike(A)?A:A?[A]:[],function(x){return n.byId(x,this.ownerDocument)},this);this._connections=a.map(this._connectIds,function(x){x=n.byId(x,this.ownerDocument);var B=this.selector,C=B?function(E){return d.selector(B,E)}:function(E){return E},D=this;return[d(x,C(h.enter),function(){D._onHover(this)}),d(x,C("focusin"),function(){D._onHover(this)}),d(x,C(h.leave),m.hitch(D,"_onUnHover")),d(x,C("focusout"),m.hitch(D,"set","state","DORMANT"))]},this);this._set("connectId",A)},addTarget:function(A){A=
A.id||A;-1==a.indexOf(this._connectIds,A)&&this.set("connectId",this._connectIds.concat(A))},removeTarget:function(A){A=a.indexOf(this._connectIds,A.id||A);0<=A&&(this._connectIds.splice(A,1),this.set("connectId",this._connectIds))},buildRendering:function(){this.inherited(arguments);l.add(this.domNode,"dijitTooltipData")},startup:function(){this.inherited(arguments);var A=this.connectId;a.forEach(m.isArrayLike(A)?A:[A],this.addTarget,this)},getContent:function(A){return this.label||this.domNode.innerHTML},
state:"DORMANT",_setStateAttr:function(A){if(!(this.state==A||"SHOW TIMER"==A&&"SHOWING"==this.state||"HIDE TIMER"==A&&"DORMANT"==this.state)){this._hideTimer&&(this._hideTimer.remove(),delete this._hideTimer);this._showTimer&&(this._showTimer.remove(),delete this._showTimer);switch(A){case "DORMANT":this._connectNode&&(z.hide(this._connectNode),delete this._connectNode,this.onHide());break;case "SHOW TIMER":"SHOWING"!=this.state&&(this._showTimer=this.defer(function(){this.set("state","SHOWING")},
this.showDelay));break;case "SHOWING":var x=this.getContent(this._connectNode);if(!x){this.set("state","DORMANT");return}z.show(x,this._connectNode,this.position,!this.isLeftToRight(),this.textDir,m.hitch(this,"set","state","SHOWING"),m.hitch(this,"set","state","HIDE TIMER"));this.onShow(this._connectNode,this.position);break;case "HIDE TIMER":this._hideTimer=this.defer(function(){this.set("state","DORMANT")},this.hideDelay)}this._set("state",A)}},_onHover:function(A){this._connectNode&&A!=this._connectNode&&
this.set("state","DORMANT");this._connectNode=A;this.set("state","SHOW TIMER")},_onUnHover:function(A){this.set("state","HIDE TIMER")},open:function(A){this.set("state","DORMANT");this._connectNode=A;this.set("state","SHOWING")},close:function(){this.set("state","DORMANT")},onShow:function(){},onHide:function(){},destroy:function(){this.set("state","DORMANT");a.forEach(this._connections||[],function(A){a.forEach(A,function(x){x.remove()})},this);this.inherited(arguments)}});z._MasterTooltip=w;z.show=
y.showTooltip;z.hide=y.hideTooltip;z.defaultPosition=["after-centered","before-centered"];return z})},"dijit/form/NumberSpinner":function(){define(["dojo/_base/declare","dojo/keys","./_Spinner","./NumberTextBox"],function(a,b,c,n){return a("dijit.form.NumberSpinner",[c,n.Mixin],{baseClass:"dijitTextBox dijitSpinner dijitNumberTextBox",adjust:function(l,u){var v=this.constraints,m=isNaN(l),h=!isNaN(v.max),d=!isNaN(v.min);m&&0!=u&&(l=0<u?d?v.min:h?v.max:0:h?this.constraints.max:d?v.min:0);u=l+u;if(m||
isNaN(u))return l;h&&u>v.max&&(u=v.max);d&&u<v.min&&(u=v.min);return u},_onKeyDown:function(l){if(!(this.disabled||this.readOnly||l.keyCode!=b.HOME&&l.keyCode!=b.END||l.ctrlKey||l.altKey||l.metaKey||"undefined"==typeof this.get("value"))){var u=this.constraints[l.keyCode==b.HOME?"min":"max"];"number"==typeof u&&this._setValueAttr(u,!1);l.stopPropagation();l.preventDefault()}}})})},"dijit/form/_Spinner":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/sniff dojo/mouse dojo/on ../typematic ./RangeBoundTextBox dojo/text!./templates/Spinner.html ./_TextBoxMixin".split(" "),
function(a,b,c,n,l,u,v,m,h,d){return a("dijit.form._Spinner",m,{defaultTimeout:500,minimumTimeout:10,timeoutChangeRate:.9,smallDelta:1,largeDelta:10,templateString:h,baseClass:"dijitTextBox dijitSpinner",cssStateNodes:{upArrowNode:"dijitUpArrowButton",downArrowNode:"dijitDownArrowButton"},adjust:function(e){return e},_arrowPressed:function(e,g,p){this.disabled||this.readOnly||(this._setValueAttr(this.adjust(this.get("value"),g*p),!1),d.selectInputText(this.textbox,this.textbox.value.length))},_arrowReleased:function(){this._wheelTimer=
null},_typematicCallback:function(e,g,p){var t=this.smallDelta;g==this.textbox&&(g=p.keyCode,t=g==b.PAGE_UP||g==b.PAGE_DOWN?this.largeDelta:this.smallDelta,g=g==b.UP_ARROW||g==b.PAGE_UP?this.upArrowNode:this.downArrowNode);-1==e?this._arrowReleased(g):this._arrowPressed(g,g==this.upArrowNode?1:-1,t)},_wheelTimer:null,_mouseWheeled:function(e){if(this.focused){e.stopPropagation();e.preventDefault();var g=e.wheelDelta/120;Math.floor(g)!=g&&(g=0<e.wheelDelta?1:-1);e=e.detail?-1*e.detail:g;if(0!==e){var p=
this[0<e?"upArrowNode":"downArrowNode"];this._arrowPressed(p,e,this.smallDelta);this._wheelTimer&&this._wheelTimer.remove();this._wheelTimer=this.defer(function(){this._arrowReleased(p)},50)}}},_setConstraintsAttr:function(e){this.inherited(arguments);this.focusNode&&(void 0!==this.constraints.min?this.focusNode.setAttribute("aria-valuemin",this.constraints.min):this.focusNode.removeAttribute("aria-valuemin"),void 0!==this.constraints.max?this.focusNode.setAttribute("aria-valuemax",this.constraints.max):
this.focusNode.removeAttribute("aria-valuemax"))},_setValueAttr:function(e,g){this.focusNode.setAttribute("aria-valuenow",e);this.inherited(arguments)},postCreate:function(){this.inherited(arguments);this.own(u(this.domNode,l.wheel,c.hitch(this,"_mouseWheeled")),v.addListener(this.upArrowNode,this.textbox,{keyCode:b.UP_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),v.addListener(this.downArrowNode,this.textbox,
{keyCode:b.DOWN_ARROW,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),v.addListener(this.upArrowNode,this.textbox,{keyCode:b.PAGE_UP,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,this.defaultTimeout,this.minimumTimeout),v.addListener(this.downArrowNode,this.textbox,{keyCode:b.PAGE_DOWN,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1},this,"_typematicCallback",this.timeoutChangeRate,
this.defaultTimeout,this.minimumTimeout))}})})},"dijit/typematic":function(){define("dojo/_base/array dojo/_base/connect dojo/_base/lang dojo/on dojo/sniff ./main".split(" "),function(a,b,c,n,l,u){var v=u.typematic={_fireEventAndReload:function(){this._timer=null;this._callback(++this._count,this._node,this._evt);this._currentTimeout=Math.max(0>this._currentTimeout?this._initialDelay:1<this._subsequentDelay?this._subsequentDelay:Math.round(this._currentTimeout*this._subsequentDelay),this._minDelay);
this._timer=setTimeout(c.hitch(this,"_fireEventAndReload"),this._currentTimeout)},trigger:function(m,h,d,e,g,p,t,q){if(g!=this._obj){this.stop();this._initialDelay=t||500;this._subsequentDelay=p||.9;this._minDelay=q||10;this._obj=g;this._node=d;this._count=this._currentTimeout=-1;this._callback=c.hitch(h,e);this._evt={faux:!0};for(var k in m)"layerX"!=k&&"layerY"!=k&&(h=m[k],"function"!=typeof h&&"undefined"!=typeof h&&(this._evt[k]=h));this._fireEventAndReload()}},stop:function(){this._timer&&(clearTimeout(this._timer),
this._timer=null);this._obj&&(this._callback(-1,this._node,this._evt),this._obj=null)},addKeyListener:function(m,h,d,e,g,p,t){var q="keyCode"in h?"keyCode":"charCode"in h?"charCode":"charOrCode",k=[n(m,"keyCode"in h?"keydown":"charCode"in h?"keypress":b._keypress,c.hitch(this,function(r){r[q]!=h[q]||void 0!==h.ctrlKey&&h.ctrlKey!=r.ctrlKey||void 0!==h.altKey&&h.altKey!=r.altKey||void 0!==h.metaKey&&h.metaKey!=(r.metaKey||!1)||void 0!==h.shiftKey&&h.shiftKey!=r.shiftKey?v._obj==h&&v.stop():(r.stopPropagation(),
r.preventDefault(),v.trigger(r,d,m,e,h,g,p,t))})),n(m,"keyup",c.hitch(this,function(){v._obj==h&&v.stop()}))];return{remove:function(){a.forEach(k,function(r){r.remove()})}}},addMouseListener:function(m,h,d,e,g,p){var t=[n(m,"mousedown",c.hitch(this,function(q){q.preventDefault();v.trigger(q,h,m,d,m,e,g,p)})),n(m,"mouseup",c.hitch(this,function(q){this._obj&&q.preventDefault();v.stop()})),n(m,"mouseout",c.hitch(this,function(q){this._obj&&q.preventDefault();v.stop()})),n(m,"dblclick",c.hitch(this,
function(q){q.preventDefault();9>l("ie")&&(v.trigger(q,h,m,d,m,e,g,p),setTimeout(c.hitch(this,v.stop),50))}))];return{remove:function(){a.forEach(t,function(q){q.remove()})}}},addListener:function(m,h,d,e,g,p,t,q){var k=[this.addKeyListener(h,d,e,g,p,t,q),this.addMouseListener(m,e,g,p,t,q)];return{remove:function(){a.forEach(k,function(r){r.remove()})}}}};return v})},"dijit/form/RangeBoundTextBox":function(){define(["dojo/_base/declare","dojo/i18n","./MappedTextBox","dojo/i18n!./nls/validate"],function(a,
b,c){return a("dijit.form.RangeBoundTextBox",c,{rangeMessage:"",rangeCheck:function(n,l){return("min"in l?0<=this.compare(n,l.min):!0)&&("max"in l?0>=this.compare(n,l.max):!0)},isInRange:function(){return this.rangeCheck(this.get("value"),this.constraints)},_isDefinitelyOutOfRange:function(){var n=this.get("value");if(null==n)return!1;var l=!1;"min"in this.constraints&&(l=this.constraints.min,l=0>this.compare(n,"number"==typeof l&&0<=l&&0!=n?0:l));!l&&"max"in this.constraints&&(l=this.constraints.max,
l=0<this.compare(n,"number"!=typeof l||0<l?l:0));return l},_isValidSubset:function(){return this.inherited(arguments)&&!this._isDefinitelyOutOfRange()},isValid:function(n){return this.inherited(arguments)&&(this._isEmpty(this.textbox.value)&&!this.required||this.isInRange(n))},getErrorMessage:function(n){var l=this.get("value");return null==l||""===l||"number"==typeof l&&isNaN(l)||this.isInRange(n)?this.inherited(arguments):this.rangeMessage},postMixInProperties:function(){this.inherited(arguments);
this.rangeMessage||(this.messages=b.getLocalization("dijit.form","validate",this.lang),this.rangeMessage=this.messages.rangeMessage)}})})},"dijit/form/MappedTextBox":function(){define(["dojo/_base/declare","dojo/sniff","dojo/dom-construct","./ValidationTextBox"],function(a,b,c,n){return a("dijit.form.MappedTextBox",n,{postMixInProperties:function(){this.inherited(arguments);this.nameAttrSetting=""},_setNameAttr:"valueNode",serialize:function(l){return l.toString?l.toString():""},toString:function(){var l=
this.filter(this.get("value"));return null!=l?"string"==typeof l?l:this.serialize(l,this.constraints):""},validate:function(){this.valueNode.value=this.toString();return this.inherited(arguments)},buildRendering:function(){this.inherited(arguments);this.valueNode=c.place("\x3cinput type\x3d'hidden'"+(this.name?' name\x3d"'+this.name.replace(/"/g,"\x26quot;")+'"':"")+"/\x3e",this.textbox,"after")},reset:function(){this.valueNode.value="";this.inherited(arguments)}})})},"dijit/form/ValidationTextBox":function(){define("dojo/_base/declare dojo/_base/kernel dojo/_base/lang dojo/i18n ./TextBox ../Tooltip dojo/text!./templates/ValidationTextBox.html dojo/i18n!./nls/validate".split(" "),
function(a,b,c,n,l,u,v){var m=a("dijit.form.ValidationTextBox",l,{templateString:v,required:!1,promptMessage:"",invalidMessage:"$_unset_$",missingMessage:"$_unset_$",message:"",constraints:{},pattern:".*",regExp:"",regExpGen:function(){},state:"",tooltipPosition:[],_deprecateRegExp:function(h,d){d!=m.prototype[h]&&(b.deprecated("ValidationTextBox id\x3d"+this.id+", set('"+h+"', ...) is deprecated.  Use set('pattern', ...) instead.","","2.0"),this.set("pattern",d))},_setRegExpGenAttr:function(h){this._deprecateRegExp("regExpGen",
h);this._set("regExpGen",this._computeRegexp)},_setRegExpAttr:function(h){this._deprecateRegExp("regExp",h)},_setValueAttr:function(){this.inherited(arguments);this._refreshState()},validator:function(h,d){return(new RegExp("^(?:"+this._computeRegexp(d)+")"+(this.required?"":"?")+"$")).test(h)&&(!this.required||!this._isEmpty(h))&&(this._isEmpty(h)||void 0!==this.parse(h,d))},_isValidSubset:function(){return 0==this.textbox.value.search(this._partialre)},isValid:function(){return this.validator(this.textbox.value,
this.get("constraints"))},_isEmpty:function(h){return(this.trim?/^\s*$/:/^$/).test(h)},getErrorMessage:function(){var h="$_unset_$"==this.invalidMessage?this.messages.invalidMessage:this.invalidMessage?this.invalidMessage:this.promptMessage,d="$_unset_$"==this.missingMessage?this.messages.missingMessage:this.missingMessage?this.missingMessage:h;return this.required&&this._isEmpty(this.textbox.value)?d:h},getPromptMessage:function(){return this.promptMessage},_maskValidSubsetError:!0,validate:function(h){var d=
"",e=this.disabled||this.isValid(h);e&&(this._maskValidSubsetError=!0);var g=this._isEmpty(this.textbox.value),p=!e&&h&&this._isValidSubset();this._set("state",e?"":((!this._hasBeenBlurred||h)&&g||p)&&(this._maskValidSubsetError||p&&!this._hasBeenBlurred&&h)?"Incomplete":"Error");this.focusNode.setAttribute("aria-invalid","Error"==this.state?"true":"false");"Error"==this.state?(this._maskValidSubsetError=h&&p,d=this.getErrorMessage(h)):"Incomplete"==this.state?(d=this.getPromptMessage(h),this._maskValidSubsetError=
!this._hasBeenBlurred||h):g&&(d=this.getPromptMessage(h));this.set("message",d);return e},displayMessage:function(h){h&&this.focused?u.show(h,this.domNode,this.tooltipPosition,!this.isLeftToRight()):u.hide(this.domNode)},_refreshState:function(){this._created&&this.validate(this.focused);this.inherited(arguments)},constructor:function(h){this.constraints=c.clone(this.constraints);this.baseClass+=" dijitValidationTextBox"},startup:function(){this.inherited(arguments);this._refreshState()},_setConstraintsAttr:function(h){!h.locale&&
this.lang&&(h.locale=this.lang);this._set("constraints",h);this._refreshState()},_setPatternAttr:function(h){this._set("pattern",h);this._refreshState()},_computeRegexp:function(h){var d=this.pattern;"function"==typeof d&&(d=d.call(this,h));if(d!=this._lastRegExp){var e="";this._lastRegExp=d;".*"!=d&&d.replace(/\\.|\[\]|\[.*?[^\\]{1}\]|\{.*?\}|\(\?[=:!]|./g,function(g){switch(g.charAt(0)){case "{":case "+":case "?":case "*":case "^":case "$":case "|":case "(":e+=g;break;case ")":e+="|$)";break;default:e+=
"(?:"+g+"|$)"}});try{"".search(e)}catch(g){e=this.pattern,console.warn("RegExp error in "+this.declaredClass+": "+this.pattern)}this._partialre="^(?:"+e+")$"}return d},postMixInProperties:function(){this.inherited(arguments);this.messages=n.getLocalization("dijit.form","validate",this.lang);this._setConstraintsAttr(this.constraints)},_setDisabledAttr:function(h){this.inherited(arguments);this._refreshState()},_setRequiredAttr:function(h){this._set("required",h);this.focusNode.setAttribute("aria-required",
h);this._refreshState()},_setMessageAttr:function(h){this._set("message",h);this.displayMessage(h)},reset:function(){this._maskValidSubsetError=!0;this.inherited(arguments)},_onBlur:function(){this.displayMessage("");this.inherited(arguments)},destroy:function(){u.hide(this.domNode);this.inherited(arguments)}});return m})},"dijit/form/TextBox":function(){define("dojo/_base/declare dojo/dom-construct dojo/dom-style dojo/_base/kernel dojo/_base/lang dojo/on dojo/sniff ./_FormValueWidget ./_TextBoxMixin dojo/text!./templates/TextBox.html ../main".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){m=a("dijit.form.TextBox"+(v("dojo-bidi")?"_NoBidi":""),[m,h],{templateString:d,_singleNodeTemplate:'\x3cinput class\x3d"dijit dijitReset dijitLeft dijitInputField" data-dojo-attach-point\x3d"textbox,focusNode" autocomplete\x3d"off" type\x3d"${type}" ${!nameAttrSetting} /\x3e',_buttonInputDisabled:v("ie")?"disabled":"",baseClass:"dijitTextBox",postMixInProperties:function(){var g=this.type.toLowerCase();if(this.templateString&&"input"==this.templateString.toLowerCase()||
("hidden"==g||"file"==g)&&this.templateString==this.constructor.prototype.templateString)this.templateString=this._singleNodeTemplate;this.inherited(arguments)},postCreate:function(){this.inherited(arguments);9>v("ie")&&this.defer(function(){try{var g=c.getComputedStyle(this.domNode);if(g){var p=g.fontFamily;if(p){var t=this.domNode.getElementsByTagName("INPUT");if(t)for(g=0;g<t.length;g++)t[g].style.fontFamily=p}}}catch(q){}})},_setPlaceHolderAttr:function(g){this._set("placeHolder",g);this._phspan||
(this._attachPoints.push("_phspan"),this._phspan=b.create("span",{className:"dijitPlaceHolder dijitInputField"},this.textbox,"after"),this.own(u(this._phspan,"mousedown",function(p){p.preventDefault()}),u(this._phspan,"touchend, pointerup, MSPointerUp",l.hitch(this,function(){this.focus()}))));this._phspan.innerHTML="";this._phspan.appendChild(this._phspan.ownerDocument.createTextNode(g));this._updatePlaceHolder()},_onInput:function(g){this.inherited(arguments);this._updatePlaceHolder()},_updatePlaceHolder:function(){this._phspan&&
(this._phspan.style.display=this.placeHolder&&!this.textbox.value?"":"none")},_setValueAttr:function(g,p,t){this.inherited(arguments);this._updatePlaceHolder()},getDisplayedValue:function(){n.deprecated(this.declaredClass+"::getDisplayedValue() is deprecated. Use get('displayedValue') instead.","","2.0");return this.get("displayedValue")},setDisplayedValue:function(g){n.deprecated(this.declaredClass+"::setDisplayedValue() is deprecated. Use set('displayedValue', ...) instead.","","2.0");this.set("displayedValue",
g)},_onBlur:function(g){this.disabled||(this.inherited(arguments),this._updatePlaceHolder(),this.selectOnClick&&(this.textbox.selectionStart=this.textbox.selectionEnd=void 0))},_onFocus:function(g){this.disabled||this.readOnly||(this.inherited(arguments),this._updatePlaceHolder())}});9>v("ie")&&(m.prototype._isTextSelected=function(){var g=this.ownerDocument.selection.createRange();return g.parentElement()==this.textbox&&0<g.text.length},e._setSelectionRange=h._setSelectionRange=function(g,p,t){g.createTextRange&&
(g=g.createTextRange(),g.collapse(!0),g.moveStart("character",-99999),g.moveStart("character",p),g.moveEnd("character",t-p),g.select())});v("dojo-bidi")&&(m=a("dijit.form.TextBox",m,{_setPlaceHolderAttr:function(g){this.inherited(arguments);this.applyTextDir(this._phspan)}}));return m})},"dijit/form/_TextBoxMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom dojo/sniff dojo/keys dojo/_base/lang dojo/on ../main".split(" "),function(a,b,c,n,l,u,v,m){var h=b("dijit.form._TextBoxMixin"+
(n("dojo-bidi")?"_NoBidi":""),null,{trim:!1,uppercase:!1,lowercase:!1,propercase:!1,maxLength:"",selectOnClick:!1,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints)},_setValueAttr:function(d,e,g){if(void 0!==d){var p=this.filter(d);"string"!=typeof g&&(g=null===p||"number"==typeof p&&isNaN(p)?"":this.filter(this.format(p,this.constraints)),0!=this.compare(p,this.filter(this.parse(g,this.constraints)))&&(g=null))}null==g||"number"==typeof g&&isNaN(g)||
this.textbox.value==g||(this.textbox.value=g,this._set("displayedValue",this.get("displayedValue")));this.inherited(arguments,[p,e])},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value)},_setDisplayedValueAttr:function(d){null==d?d="":"string"!=typeof d&&(d=String(d));this.textbox.value=d;this._setValueAttr(this.get("value"),void 0);this._set("displayedValue",this.get("displayedValue"))},format:function(d){return null==d?"":d.toString?d.toString():d},parse:function(d){return d},
_refreshState:function(){},onInput:function(){},_onInput:function(d){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent||d);delete this._lastInputProducingEvent;this.intermediateChanges&&this._handleOnChange(this.get("value"),!1)},_processInput:function(){this._refreshState();this._set("displayedValue",this.get("displayedValue"))},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);this.own(v(this.textbox,
"keydown, keypress, paste, cut, compositionend",u.hitch(this,function(d){if("keydown"==d.type&&229!=d.keyCode){var e=d.keyCode;switch(e){case l.SHIFT:case l.ALT:case l.CTRL:case l.META:case l.CAPS_LOCK:case l.NUM_LOCK:case l.SCROLL_LOCK:return}if(!d.ctrlKey&&!d.metaKey&&!d.altKey){switch(e){case l.NUMPAD_0:case l.NUMPAD_1:case l.NUMPAD_2:case l.NUMPAD_3:case l.NUMPAD_4:case l.NUMPAD_5:case l.NUMPAD_6:case l.NUMPAD_7:case l.NUMPAD_8:case l.NUMPAD_9:case l.NUMPAD_MULTIPLY:case l.NUMPAD_PLUS:case l.NUMPAD_ENTER:case l.NUMPAD_MINUS:case l.NUMPAD_PERIOD:case l.NUMPAD_DIVIDE:return}if(65<=
e&&90>=e||48<=e&&57>=e||e==l.SPACE)return;e=!1;for(var g in l)if(l[g]===d.keyCode){e=!0;break}if(!e)return}}(e=32<=d.charCode?String.fromCharCode(d.charCode):d.charCode)||(e=65<=d.keyCode&&90>=d.keyCode||48<=d.keyCode&&57>=d.keyCode||d.keyCode==l.SPACE?String.fromCharCode(d.keyCode):d.keyCode);e||(e=229);if("keypress"==d.type){if("string"!=typeof e)return;if("a"<=e&&"z">=e||"A"<=e&&"Z">=e||"0"<=e&&"9">=e||" "===e)if(d.ctrlKey||d.metaKey||d.altKey)return}var p={faux:!0},t;for(t in d)/^(layer[XY]|returnValue|keyLocation)$/.test(t)||
(g=d[t],"function"!=typeof g&&"undefined"!=typeof g&&(p[t]=g));u.mixin(p,{charOrCode:e,_wasConsumed:!1,preventDefault:function(){p._wasConsumed=!0;d.preventDefault()},stopPropagation:function(){d.stopPropagation()}});this._lastInputProducingEvent=p;!1===this.onInput(p)&&(p.preventDefault(),p.stopPropagation());if(!p._wasConsumed&&9>=n("ie"))switch(d.keyCode){case l.TAB:case l.ESCAPE:case l.DOWN_ARROW:case l.UP_ARROW:case l.LEFT_ARROW:case l.RIGHT_ARROW:break;default:d.keyCode==l.ENTER&&"textarea"!=
this.textbox.tagName.toLowerCase()||this.defer(function(){this.textbox.value!==this._lastInputEventValue&&v.emit(this.textbox,"input",{bubbles:!0})})}})),v(this.textbox,"input",u.hitch(this,"_onInput")),v(this.domNode,"keypress",function(d){d.stopPropagation()}))},_blankValue:"",filter:function(d){if(null===d)return this._blankValue;if("string"!=typeof d)return d;this.trim&&(d=u.trim(d));this.uppercase&&(d=d.toUpperCase());this.lowercase&&(d=d.toLowerCase());this.propercase&&(d=d.replace(/[^\s]+/g,
function(e){return e.substring(0,1).toUpperCase()+e.substring(1)}));return d},_setBlurValue:function(){this._setValueAttr(this.get("value"),!0)},_onBlur:function(d){this.disabled||(this._setBlurValue(),this.inherited(arguments))},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd},_onFocus:function(d){this.disabled||this.readOnly||(this.selectOnClick&&"mouse"==d&&(this._selectOnClickHandle=v.once(this.domNode,"mouseup, touchend",u.hitch(this,function(e){this._isTextSelected()||
h.selectInputText(this.textbox)})),this.own(this._selectOnClickHandle),this.defer(function(){this._selectOnClickHandle&&(this._selectOnClickHandle.remove(),this._selectOnClickHandle=null)},500)),this.inherited(arguments),this._refreshState())},reset:function(){this.textbox.value="";this.inherited(arguments)}});n("dojo-bidi")&&(h=b("dijit.form._TextBoxMixin",h,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode)},_setDisplayedValueAttr:function(){this.inherited(arguments);
this.applyTextDir(this.focusNode)},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments)}}));h._setSelectionRange=m._setSelectionRange=function(d,e,g){d.setSelectionRange&&d.setSelectionRange(e,g)};h.selectInputText=m.selectInputText=function(d,e,g){d=c.byId(d);isNaN(e)&&(e=0);isNaN(g)&&(g=d.value?d.value.length:0);try{d.focus(),h._setSelectionRange(d,e,g)}catch(p){}};return h})},"dijit/form/NumberTextBox":function(){define("dojo/_base/declare dojo/_base/lang dojo/i18n dojo/string dojo/number ./RangeBoundTextBox".split(" "),
function(a,b,c,n,l,u){var v=function(h){h=h||{};var d=c.getLocalization("dojo.cldr","number",c.normalizeLocale(h.locale)),e=h.pattern?h.pattern:d[(h.type||"decimal")+"Format"];h="number"==typeof h.places?h.places:"string"===typeof h.places&&0<h.places.length?h.places.replace(/.*,/,""):-1!=e.indexOf(".")?e.split(".")[1].replace(/[^#0]/g,"").length:0;return{sep:d.decimal,places:h}},m=a("dijit.form.NumberTextBoxMixin",null,{pattern:function(h){return"("+(this.focused&&this.editOptions?this._regExpGenerator(b.delegate(h,
this.editOptions))+"|":"")+this._regExpGenerator(h)+")"},value:NaN,editOptions:{pattern:"#.######"},_formatter:l.format,_regExpGenerator:l.regexp,_decimalInfo:v(),postMixInProperties:function(){this.inherited(arguments);this._set("type","text")},_setConstraintsAttr:function(h){var d="number"==typeof h.places?h.places:0;d&&d++;"number"!=typeof h.max&&(h.max=9*Math.pow(10,15-d));"number"!=typeof h.min&&(h.min=-9*Math.pow(10,15-d));this.inherited(arguments,[h]);this.focusNode&&this.focusNode.value&&
!isNaN(this.value)&&this.set("value",this.value);this._decimalInfo=v(h)},_onFocus:function(h){if(!this.disabled&&!this.readOnly){var d=this.get("value");"number"!=typeof d||isNaN(d)||(d=this.format(d,this.constraints),void 0!==d&&(this.textbox.value=d,"mouse"!==h&&this.textbox.select()));this.inherited(arguments)}},format:function(h,d){var e=String(h);if("number"!=typeof h)return e;if(isNaN(h))return"";if(!("rangeCheck"in this&&this.rangeCheck(h,d))&&!1!==d.exponent&&/\de[-+]?\d/i.test(e))return e;
this.editOptions&&this.focused&&(d=b.mixin({},d,this.editOptions));return this._formatter(h,d)},_parser:l.parse,parse:function(h,d){var e=b.mixin({},d,this.editOptions&&this.focused?this.editOptions:{});if(this.focused&&null!=e.places){var g=e.places;g="number"===typeof g?g:Number(g.split(",").pop());e.places="0,"+g}e=this._parser(h,e);this.editOptions&&this.focused&&isNaN(e)&&(e=this._parser(h,d));return e},_getDisplayedValueAttr:function(){var h=this.inherited(arguments);return isNaN(h)?this.textbox.value:
h},filter:function(h){if(null==h||"string"==typeof h&&""==h)return NaN;"number"!=typeof h||isNaN(h)||0==h||(h=l.round(h,this._decimalInfo.places));return this.inherited(arguments,[h])},serialize:function(h,d){return"number"!=typeof h||isNaN(h)?"":this.inherited(arguments)},_setBlurValue:function(){var h=b.hitch(b.delegate(this,{focused:!0}),"get")("value");this._setValueAttr(h,!0)},_setValueAttr:function(h,d,e){if(void 0!==h&&void 0===e)if(e=String(h),"number"==typeof h)if(isNaN(h))e="";else{if("rangeCheck"in
this&&this.rangeCheck(h,this.constraints)||!1===this.constraints.exponent||!/\de[-+]?\d/i.test(e))e=void 0}else h?h=void 0:(e="",h=NaN);this.inherited(arguments,[h,d,e])},_getValueAttr:function(){var h=this.inherited(arguments);if(isNaN(h)&&""!==this.textbox.value){if(!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)&&(new RegExp("^"+l._realNumberRegexp(b.delegate(this.constraints))+"$")).test(this.textbox.value))return h=Number(this.textbox.value),isNaN(h)?void 0:h}else return h},
isValid:function(h){if(!this.focused||this._isEmpty(this.textbox.value))return this.inherited(arguments);var d=this.get("value");return!isNaN(d)&&this.rangeCheck(d,this.constraints)?!1!==this.constraints.exponent&&/\de[-+]?\d/i.test(this.textbox.value)?!0:this.inherited(arguments):!1},_isValidSubset:function(){var h="number"==typeof this.constraints.min,d="number"==typeof this.constraints.max,e=this.get("value");if(isNaN(e)||!h&&!d)return this.inherited(arguments);var g=e|0,p=0>e,t=-1!=this.textbox.value.indexOf(this._decimalInfo.sep),
q=(this.maxLength||20)-this.textbox.value.length,k=t?this.textbox.value.split(this._decimalInfo.sep)[1].replace(/[^0-9]/g,""):"";g=t?g+"."+k:g+"";q=n.rep("9",q);t=e;p?t=Number(g+q):e=Number(g+q);return!(h&&e<this.constraints.min||d&&t>this.constraints.max)}});a=a("dijit.form.NumberTextBox",[u,m],{baseClass:"dijitTextBox dijitNumberTextBox"});a.Mixin=m;return a})},"dijit/ColorPalette":function(){define("require dojo/text!./templates/ColorPalette.html ./_Widget ./_TemplatedMixin ./_PaletteMixin ./hccss dojo/i18n dojo/_base/Color dojo/_base/declare dojo/dom-construct dojo/string dojo/i18n!dojo/nls/colors dojo/colors".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e){var g=h("dijit.ColorPalette",[c,n,l],{palette:"7x10",_palettes:{"7x10":["white seashell cornsilk lemonchiffon lightyellow palegreen paleturquoise lightcyan lavender plum".split(" "),"lightgray pink bisque moccasin khaki lightgreen lightseagreen lightskyblue cornflowerblue violet".split(" "),"silver lightcoral sandybrown orange palegoldenrod chartreuse mediumturquoise skyblue mediumslateblue orchid".split(" "),"gray red orangered darkorange yellow limegreen darkseagreen royalblue slateblue mediumorchid".split(" "),
"dimgray crimson chocolate coral gold forestgreen seagreen blue blueviolet darkorchid".split(" "),"darkslategray firebrick saddlebrown sienna olive green darkcyan mediumblue darkslateblue darkmagenta".split(" "),"black darkred maroon brown darkolivegreen darkgreen midnightblue navy indigo purple".split(" ")],"3x4":[["white","lime","green","blue"],["silver","yellow","fuchsia","navy"],["gray","red","purple","black"]]},templateString:b,baseClass:"dijitColorPalette",_dyeFactory:function(p,t,q,k){return new this._dyeClass(p,
t,q,k)},buildRendering:function(){this.inherited(arguments);this._dyeClass=h(g._Color,{palette:this.palette});this._preparePalette(this._palettes[this.palette],v.getLocalization("dojo","colors",this.lang))}});g._Color=h("dijit._Color",m,{template:"\x3cspan class\x3d'dijitInline dijitPaletteImg'\x3e\x3cimg src\x3d'${blankGif}' alt\x3d'${alt}' title\x3d'${title}' class\x3d'dijitColorPaletteSwatch' style\x3d'background-color: ${color}'/\x3e\x3c/span\x3e",hcTemplate:"\x3cspan class\x3d'dijitInline dijitPaletteImg' style\x3d'position: relative; overflow: hidden; height: 12px; width: 14px;'\x3e\x3cimg src\x3d'${image}' alt\x3d'${alt}' title\x3d'${title}' style\x3d'position: absolute; left: ${left}px; top: ${top}px; ${size}'/\x3e\x3c/span\x3e",
_imagePaths:{"7x10":a.toUrl("./themes/a11y/colors7x10.png"),"3x4":a.toUrl("./themes/a11y/colors3x4.png")},constructor:function(p,t,q,k){this._title=k;this._row=t;this._col=q;this.setColor(m.named[p])},getValue:function(){return this.toHex()},fillCell:function(p,t){t=e.substitute(u("highcontrast")?this.hcTemplate:this.template,{color:this.toHex(),blankGif:t,alt:this._title,title:this._title,image:this._imagePaths[this.palette].toString(),left:-20*this._col-5,top:-20*this._row-5,size:"7x10"==this.palette?
"height: 145px; width: 206px":"height: 64px; width: 86px"});d.place(t,p)}});return g})},"dijit/_PaletteMixin":function(){define("dojo/_base/declare dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/keys dojo/_base/lang dojo/on ./_CssStateMixin ./a11yclick ./focus ./typematic".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){return a("dijit._PaletteMixin",m,{defaultTimeout:500,timeoutChangeRate:.9,value:"",_selectedCell:-1,tabIndex:"0",cellClass:"dijitPaletteCell",dyeClass:null,_dyeFactory:function(g){return new ("string"==
typeof this.dyeClass?u.getObject(this.dyeClass):this.dyeClass)(g)},_preparePalette:function(g,p){this._cells=[];var t=this._blankGif;this.own(v(this.gridNode,h,u.hitch(this,"_onCellClick")));for(var q=0;q<g.length;q++)for(var k=n.create("tr",{tabIndex:"-1",role:"row"},this.gridNode),r=0;r<g[q].length;r++){var y=g[q][r];if(y){var f=this._dyeFactory(y,q,r,p[y]);y=n.create("td",{"class":this.cellClass,tabIndex:"-1",title:p[y],role:"gridcell"},k);f.fillCell(y,t);y.idx=this._cells.length;this._cells.push({node:y,
dye:f})}}this._xDim=g[0].length;this._yDim=g.length;var w={UP_ARROW:-this._xDim,DOWN_ARROW:this._xDim,RIGHT_ARROW:this.isLeftToRight()?1:-1,LEFT_ARROW:this.isLeftToRight()?-1:1},z;for(z in w)this.own(e.addKeyListener(this.domNode,{keyCode:l[z],ctrlKey:!1,altKey:!1,shiftKey:!1},this,function(){var A=w[z];return function(x){this._navigateByKey(A,x)}}(),this.timeoutChangeRate,this.defaultTimeout))},postCreate:function(){this.inherited(arguments);this._setCurrent(this._cells[0].node)},focus:function(){d.focus(this._currentFocus)},
_onCellClick:function(g){for(var p=g.target;"TD"!=p.tagName;){if(!p.parentNode||p==this.gridNode)return;p=p.parentNode}var t=this._getDye(p).getValue();this._setCurrent(p);d.focus(p);this._setValueAttr(t,!0);g.stopPropagation();g.preventDefault()},_setCurrent:function(g){"_currentFocus"in this&&b.set(this._currentFocus,"tabIndex","-1");(this._currentFocus=g)&&b.set(g,"tabIndex",this.tabIndex)},_setValueAttr:function(g,p){0<=this._selectedCell&&c.remove(this._cells[this._selectedCell].node,this.cellClass+
"Selected");this._selectedCell=-1;if(g)for(var t=0;t<this._cells.length;t++)if(g==this._cells[t].dye.getValue()){this._selectedCell=t;c.add(this._cells[t].node,this.cellClass+"Selected");break}this._set("value",0<=this._selectedCell?g:null);if(p||void 0===p)this.onChange(g)},onChange:function(){},_navigateByKey:function(g,p){-1!=p&&(g=this._currentFocus.idx+g,g<this._cells.length&&-1<g&&(g=this._cells[g].node,this._setCurrent(g),this.defer(u.hitch(d,"focus",g))))},_getDye:function(g){return this._cells[g.idx].dye}})})},
"dojo/colors":function(){define(["./_base/kernel","./_base/lang","./_base/Color","./_base/array"],function(a,b,c,n){var l={};b.setObject("dojo.colors",l);var u=function(m,h,d){0>d&&++d;1<d&&--d;var e=6*d;return 1>e?m+(h-m)*e:1>2*d?h:2>3*d?m+(h-m)*(2/3-d)*6:m};a.colorFromRgb=c.fromRgb=function(m,h){var d=m.toLowerCase().match(/^(rgba?|hsla?)\(([\s\.\-,%0-9]+)\)/);if(d){m=d[2].split(/\s*,\s*/);var e=m.length;d=d[1];if("rgb"==d&&3==e||"rgba"==d&&4==e)return d=m[0],"%"==d.charAt(d.length-1)?(d=n.map(m,
function(t){return 2.56*parseFloat(t)}),4==e&&(d[3]=m[3]),c.fromArray(d,h)):c.fromArray(m,h);if("hsl"==d&&3==e||"hsla"==d&&4==e){d=(parseFloat(m[0])%360+360)%360/360;var g=parseFloat(m[1])/100,p=parseFloat(m[2])/100;g=.5>=p?p*(g+1):p+g-p*g;p=2*p-g;d=[256*u(p,g,d+1/3),256*u(p,g,d),256*u(p,g,d-1/3),1];4==e&&(d[3]=m[3]);return c.fromArray(d,h)}}return null};var v=function(m,h,d){m=Number(m);return isNaN(m)?d:m<h?h:m>d?d:m};c.prototype.sanitize=function(){this.r=Math.round(v(this.r,0,255));this.g=Math.round(v(this.g,
0,255));this.b=Math.round(v(this.b,0,255));this.a=v(this.a,0,1);return this};l.makeGrey=c.makeGrey=function(m,h){return c.fromArray([m,m,m,h])};b.mixin(c.named,{aliceblue:[240,248,255],antiquewhite:[250,235,215],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],blanchedalmond:[255,235,205],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,
149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,
0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],
lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,
0,255],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],oldlace:[253,245,230],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,
232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,
250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],whitesmoke:[245,245,245],yellowgreen:[154,205,50]});return c})},"dijit/form/HorizontalSlider":function(){define("dojo/_base/array dojo/_base/declare dojo/dnd/move dojo/_base/fx dojo/dom-geometry dojo/dom-style dojo/keys dojo/_base/lang dojo/sniff dojo/dnd/Moveable dojo/dnd/Mover dojo/query dojo/mouse dojo/on ../_base/manager ../focus ../typematic ./Button ./_FormValueWidget ../_Container dojo/text!./templates/HorizontalSlider.html".split(" "),
function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z){var A=b("dijit.form._SliderMover",e,{onMouseMove:function(x){var B=this.widget,C=B._abspos;C||(C=B._abspos=l.position(B.sliderBarContainer,!0),B._setPixelValue_=m.hitch(B,"_setPixelValue"),B._isReversed_=B._isReversed());x=x[B._mousePixelCoord]-C[B._startingPixelCoord];B._setPixelValue_(B._isReversed_?C[B._pixelCount]-x:x,C[B._pixelCount],!1)},destroy:function(x){e.prototype.destroy.apply(this,arguments);var B=this.widget;B._abspos=null;B._setValueAttr(B.value,
!0)}});c=b("dijit.form.HorizontalSlider",[f,w],{templateString:z,value:0,showButtons:!0,minimum:0,maximum:100,discreteValues:Infinity,pageIncrement:2,clickSelect:!0,slideDuration:q.defaultDuration,_setIdAttr:"",_setNameAttr:"valueNode",baseClass:"dijitSlider",cssStateNodes:{incrementButton:"dijitSliderIncrementButton",decrementButton:"dijitSliderDecrementButton",focusNode:"dijitSliderThumb"},_mousePixelCoord:"pageX",_pixelCount:"w",_startingPixelCoord:"x",_handleOffsetCoord:"left",_progressPixelSize:"width",
_onKeyUp:function(x){this.disabled||this.readOnly||x.altKey||x.ctrlKey||x.metaKey||this._setValueAttr(this.value,!0)},_onKeyDown:function(x){if(!(this.disabled||this.readOnly||x.altKey||x.ctrlKey||x.metaKey)){switch(x.keyCode){case v.HOME:this._setValueAttr(this.minimum,!1);break;case v.END:this._setValueAttr(this.maximum,!1);break;case this._descending||this.isLeftToRight()?v.RIGHT_ARROW:v.LEFT_ARROW:case !1===this._descending?v.DOWN_ARROW:v.UP_ARROW:case !1===this._descending?v.PAGE_DOWN:v.PAGE_UP:this.increment(x);
break;case this._descending||this.isLeftToRight()?v.LEFT_ARROW:v.RIGHT_ARROW:case !1===this._descending?v.UP_ARROW:v.DOWN_ARROW:case !1===this._descending?v.PAGE_UP:v.PAGE_DOWN:this.decrement(x);break;default:return}x.stopPropagation();x.preventDefault()}},_onHandleClick:function(x){this.disabled||this.readOnly||(h("ie")||k.focus(this.sliderHandle),x.stopPropagation(),x.preventDefault())},_isReversed:function(){return!this.isLeftToRight()},_onBarClick:function(x){if(!this.disabled&&!this.readOnly&&
this.clickSelect){k.focus(this.sliderHandle);x.stopPropagation();x.preventDefault();var B=l.position(this.sliderBarContainer,!0),C=x[this._mousePixelCoord]-B[this._startingPixelCoord];this._setPixelValue(this._isReversed()?B[this._pixelCount]-C:C,B[this._pixelCount],!0);this._movable.onMouseDown(x)}},_setPixelValue:function(x,B,C){if(!this.disabled&&!this.readOnly){var D=this.discreteValues;if(1>=D||Infinity==D)D=B;D--;this._setValueAttr(Math.max(Math.min((this.maximum-this.minimum)*Math.round(x/
(B/D))/D+this.minimum,this.maximum),this.minimum),C)}},_setValueAttr:function(x,B){this._set("value",x);this.valueNode.value=x;this.focusNode.setAttribute("aria-valuenow",x);this.inherited(arguments);var C=this.maximum>this.minimum?(x-this.minimum)/(this.maximum-this.minimum):0,D=!1===this._descending?this.remainingBar:this.progressBar,E=!1===this._descending?this.progressBar:this.remainingBar;this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);if(B&&0<this.slideDuration&&
D.style[this._progressPixelSize]){var F=this,G={},O=parseFloat(D.style[this._progressPixelSize]),K=this.slideDuration*(C-O/100);0!=K&&(0>K&&(K=0-K),G[this._progressPixelSize]={start:O,end:100*C,units:"%"},this._inProgressAnim=n.animateProperty({node:D,duration:K,onAnimate:function(L){E.style[F._progressPixelSize]=100-parseFloat(L[F._progressPixelSize])+"%"},onEnd:function(){delete F._inProgressAnim},properties:G}),this._inProgressAnim.play())}else D.style[this._progressPixelSize]=100*C+"%",E.style[this._progressPixelSize]=
100*(1-C)+"%"},_bumpValue:function(x,B){if(!(this.disabled||this.readOnly||this.maximum<=this.minimum)){var C=u.getComputedStyle(this.sliderBarContainer),D=l.getContentBox(this.sliderBarContainer,C);C=this.discreteValues;if(1>=C||Infinity==C)C=D[this._pixelCount];C--;x=Math.round((this.value-this.minimum)*C/(this.maximum-this.minimum))+x;0>x&&(x=0);x>C&&(x=C);x=x*(this.maximum-this.minimum)/C+this.minimum;this._setValueAttr(x,B)}},_onClkBumper:function(x){this.disabled||this.readOnly||!this.clickSelect||
this._setValueAttr(x,!0)},_onClkIncBumper:function(){this._onClkBumper(!1===this._descending?this.minimum:this.maximum)},_onClkDecBumper:function(){this._onClkBumper(!1===this._descending?this.maximum:this.minimum)},decrement:function(x){this._bumpValue(x.keyCode==v.PAGE_DOWN?-this.pageIncrement:-1)},increment:function(x){this._bumpValue(x.keyCode==v.PAGE_UP?this.pageIncrement:1)},_mouseWheeled:function(x){this.focused&&(x.stopPropagation(),x.preventDefault(),this._bumpValue(0>x.wheelDelta?-1:1,!0))},
startup:function(){this._started||(a.forEach(this.getChildren(),function(x){this[x.container]!=this.containerNode&&this[x.container].appendChild(x.domNode)},this),this.inherited(arguments))},_typematicCallback:function(x,B,C){if(-1==x)this._setValueAttr(this.value,!0);else this[B==(this._descending?this.incrementButton:this.decrementButton)?"decrement":"increment"](C)},buildRendering:function(){this.inherited(arguments);this.showButtons&&(this.incrementButton.style.display="",this.decrementButton.style.display=
"");var x=g('label[for\x3d"'+this.id+'"]');x.length&&(x[0].id||(x[0].id=this.id+"_label"),this.focusNode.setAttribute("aria-labelledby",x[0].id));this.focusNode.setAttribute("aria-valuemin",this.minimum);this.focusNode.setAttribute("aria-valuemax",this.maximum)},postCreate:function(){this.inherited(arguments);this.showButtons&&this.own(r.addMouseListener(this.decrementButton,this,"_typematicCallback",25,500),r.addMouseListener(this.incrementButton,this,"_typematicCallback",25,500));this.own(t(this.domNode,
p.wheel,m.hitch(this,"_mouseWheeled")));var x=b(A,{widget:this});this._movable=new d(this.sliderHandle,{mover:x});this._layoutHackIE7()},destroy:function(){this._movable.destroy();this._inProgressAnim&&"stopped"!=this._inProgressAnim.status&&this._inProgressAnim.stop(!0);this.inherited(arguments)}});c._Mover=A;return c})},"dijit/form/Button":function(){define("require dojo/_base/declare dojo/dom-class dojo/has dojo/_base/kernel dojo/_base/lang dojo/ready ./_FormWidget ./_ButtonMixin dojo/text!./templates/Button.html ../a11yclick".split(" "),
function(a,b,c,n,l,u,v,m,h,d){n("dijit-legacy-requires")&&v(0,function(){a(["dijit/form/DropDownButton","dijit/form/ComboButton","dijit/form/ToggleButton"])});v=b("dijit.form.Button"+(n("dojo-bidi")?"_NoBidi":""),[m,h],{showLabel:!0,iconClass:"dijitNoIcon",_setIconClassAttr:{node:"iconNode",type:"class"},baseClass:"dijitButton",templateString:d,_setValueAttr:"valueNode",_setNameAttr:function(e){this.valueNode&&this.valueNode.setAttribute("name",e)},postCreate:function(){this.inherited(arguments);
this._setLabelFromContainer()},_setLabelFromContainer:function(){this.containerNode&&!this.label&&(this.label=u.trim(this.containerNode.innerHTML),this.onLabelSet())},_setShowLabelAttr:function(e){this.containerNode&&c.toggle(this.containerNode,"dijitDisplayNone",!e);this._set("showLabel",e)},setLabel:function(e){l.deprecated("dijit.form.Button.setLabel() is deprecated.  Use set('label', ...) instead.","","2.0");this.set("label",e)},onLabelSet:function(){this.inherited(arguments);this.showLabel||
"title"in this.params||(this.titleNode.title=u.trim(this.containerNode.innerText||this.containerNode.textContent||""))}});n("dojo-bidi")&&(v=b("dijit.form.Button",v,{onLabelSet:function(){this.inherited(arguments);this.titleNode.title&&this.applyTextDir(this.titleNode,this.titleNode.title)},_setTextDirAttr:function(e){this._created&&this.textDir!=e&&(this._set("textDir",e),this._setLabelAttr(this.label))}}));return v})},"dijit/form/_ButtonMixin":function(){define(["dojo/_base/declare","dojo/dom",
"dojo/has","../registry"],function(a,b,c,n){var l=a("dijit.form._ButtonMixin"+(c("dojo-bidi")?"_NoBidi":""),null,{label:"",type:"button",__onClick:function(u){u.stopPropagation();u.preventDefault();this.disabled||this.valueNode.click(u);return!1},_onClick:function(u){if(this.disabled)return u.stopPropagation(),u.preventDefault(),!1;!1===this.onClick(u)&&u.preventDefault();var v=u.defaultPrevented;if(!v&&"submit"==this.type&&!(this.valueNode||this.focusNode).form)for(var m=this.domNode;m.parentNode;m=
m.parentNode){var h=n.byNode(m);if(h&&"function"==typeof h._onSubmit){h._onSubmit(u);u.preventDefault();v=!0;break}}return!v},postCreate:function(){this.inherited(arguments);b.setSelectable(this.focusNode,!1)},onClick:function(){return!0},_setLabelAttr:function(u){this._set("label",u);(this.containerNode||this.focusNode).innerHTML=u;this.onLabelSet()},onLabelSet:function(){}});c("dojo-bidi")&&(l=a("dijit.form._ButtonMixin",l,{onLabelSet:function(){this.inherited(arguments);this.applyTextDir(this.containerNode||
this.focusNode)}}));return l})},"dijit/form/HorizontalRule":function(){define(["dojo/_base/declare","../_Widget","../_TemplatedMixin"],function(a,b,c){return a("dijit.form.HorizontalRule",[b,c],{templateString:'\x3cdiv class\x3d"dijitRuleContainer dijitRuleContainerH"\x3e\x3c/div\x3e',count:3,container:"containerNode",ruleStyle:"",_positionPrefix:'\x3cdiv class\x3d"dijitRuleMark dijitRuleMarkH" style\x3d"left:',_positionSuffix:"%;",_suffix:'"\x3e\x3c/div\x3e',_genHTML:function(n){return this._positionPrefix+
n+this._positionSuffix+this.ruleStyle+this._suffix},_isHorizontal:!0,buildRendering:function(){this.inherited(arguments);if(1==this.count)var n=this._genHTML(50,0);else{var l,u=100/(this.count-1);if(!this._isHorizontal||this.isLeftToRight()){n=this._genHTML(0,0);for(l=1;l<this.count-1;l++)n+=this._genHTML(u*l,l);n+=this._genHTML(100,this.count-1)}else{n=this._genHTML(100,0);for(l=1;l<this.count-1;l++)n+=this._genHTML(100-u*l,l);n+=this._genHTML(0,this.count-1)}}this.domNode.innerHTML=n}})})},"dojo/_base/query":function(){define(["../query",
"./NodeList"],function(a){return a})},"dijit/form/CheckBox":function(){define("require dojo/_base/declare dojo/dom-attr dojo/has dojo/query dojo/ready ./ToggleButton ./_CheckBoxMixin dojo/text!./templates/CheckBox.html dojo/NodeList-dom ../a11yclick".split(" "),function(a,b,c,n,l,u,v,m,h){n("dijit-legacy-requires")&&u(0,function(){a(["dijit/form/RadioButton"])});return b("dijit.form.CheckBox",[v,m],{templateString:h,baseClass:"dijitCheckBox",_setValueAttr:function(d,e){"string"==typeof d&&(this.inherited(arguments),
d=!0);this._created&&this.set("checked",d,e)},_getValueAttr:function(){return this.checked&&this._get("value")},_setIconClassAttr:null,_setNameAttr:"focusNode",postMixInProperties:function(){this.inherited(arguments);this.checkedAttrSetting=""},_fillContent:function(){},_onFocus:function(){this.id&&l("label[for\x3d'"+this.id+"']").addClass("dijitFocusedLabel");this.inherited(arguments)},_onBlur:function(){this.id&&l("label[for\x3d'"+this.id+"']").removeClass("dijitFocusedLabel");this.inherited(arguments)}})})},
"dijit/form/ToggleButton":function(){define(["dojo/_base/declare","dojo/_base/kernel","./Button","./_ToggleButtonMixin"],function(a,b,c,n){return a("dijit.form.ToggleButton",[c,n],{baseClass:"dijitToggleButton",setChecked:function(l){b.deprecated("setChecked("+l+") is deprecated. Use set('checked',"+l+") instead.","","2.0");this.set("checked",l)}})})},"dijit/form/_ToggleButtonMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(a,b){return a("dijit.form._ToggleButtonMixin",null,
{checked:!1,_aria_attr:"aria-pressed",_onClick:function(c){var n=this.checked;this._set("checked",!n);var l=this.inherited(arguments);this.set("checked",l?this.checked:n);return l},_setCheckedAttr:function(c,n){this._set("checked",c);var l=this.focusNode||this.domNode;this._created&&b.get(l,"checked")!=!!c&&b.set(l,"checked",!!c);l.setAttribute(this._aria_attr,String(c));this._handleOnChange(c,n)},postCreate:function(){this.inherited(arguments);var c=this.focusNode||this.domNode;this.checked&&c.setAttribute("checked",
"checked");void 0===this._resetValue&&(this._lastValueReported=this._resetValue=this.checked)},reset:function(){this._hasBeenBlurred=!1;this.set("checked",this.params.checked||!1)}})})},"dijit/form/_CheckBoxMixin":function(){define(["dojo/_base/declare","dojo/dom-attr"],function(a,b){return a("dijit.form._CheckBoxMixin",null,{type:"checkbox",value:"on",readOnly:!1,_aria_attr:"aria-checked",_setReadOnlyAttr:function(c){this._set("readOnly",c);b.set(this.focusNode,"readOnly",c)},_setLabelAttr:void 0,
_getSubmitValue:function(c){return null==c||""===c?"on":c},_setValueAttr:function(c){c=this._getSubmitValue(c);this._set("value",c);b.set(this.focusNode,"value",c)},reset:function(){this.inherited(arguments);this._set("value",this._getSubmitValue(this.params.value));b.set(this.focusNode,"value",this.value)},_onClick:function(c){return this.readOnly?(c.stopPropagation(),c.preventDefault(),!1):this.inherited(arguments)}})})},"dijit/form/ComboBox":function(){define(["dojo/_base/declare","./ValidationTextBox",
"./ComboBoxMixin"],function(a,b,c){return a("dijit.form.ComboBox",[b,c],{})})},"dijit/form/ComboBoxMixin":function(){define("dojo/_base/declare dojo/Deferred dojo/_base/kernel dojo/_base/lang dojo/store/util/QueryResults ./_AutoCompleterMixin ./_ComboBoxMenu ../_HasDropDown dojo/text!./templates/DropDownBox.html".split(" "),function(a,b,c,n,l,u,v,m,h){return a("dijit.form.ComboBoxMixin",[m,u],{dropDownClass:v,hasDownArrow:!0,templateString:h,baseClass:"dijitTextBox dijitComboBox",cssStateNodes:{_buttonNode:"dijitDownArrowButton"},
_setHasDownArrowAttr:function(d){this._set("hasDownArrow",d);this._buttonNode.style.display=d?"":"none"},_showResultList:function(){this.displayMessage("");this.inherited(arguments)},_setStoreAttr:function(d){d.get||n.mixin(d,{_oldAPI:!0,get:function(e){var g=new b;this.fetchItemByIdentity({identity:e,onItem:function(p){g.resolve(p)},onError:function(p){g.reject(p)}});return g.promise},query:function(e,g){var p=new b(function(){t.abort&&t.abort()});p.total=new b;var t=this.fetch(n.mixin({query:e,
onBegin:function(q){p.total.resolve(q)},onComplete:function(q){p.resolve(q)},onError:function(q){p.reject(q)}},g));return l(p)}});this._set("store",d)},postMixInProperties:function(){var d=this.params.store||this.store;d&&this._setStoreAttr(d);this.inherited(arguments);if(!this.params.store&&this.store&&!this.store._oldAPI){var e=this.declaredClass;n.mixin(this.store,{getValue:function(g,p){c.deprecated(e+".store.getValue(item, attr) is deprecated for builtin store.  Use item.attr directly","","2.0");
return g[p]},getLabel:function(g){c.deprecated(e+".store.getLabel(item) is deprecated for builtin store.  Use item.label directly","","2.0");return g.name},fetch:function(g){c.deprecated(e+".store.fetch() is deprecated for builtin store.","Use store.query()","2.0");require(["dojo/data/ObjectStore"],n.hitch(this,function(p){(new p({objectStore:this})).fetch(g)}))}})}},buildRendering:function(){this.inherited(arguments);this.focusNode.setAttribute("aria-autocomplete",this.autoComplete?"both":"list")}})})},
"dijit/form/_AutoCompleterMixin":function(){define("dojo/aspect dojo/_base/declare dojo/dom-attr dojo/keys dojo/_base/lang dojo/query dojo/regexp dojo/sniff ./DataList ./_TextBoxMixin ./_SearchMixin".split(" "),function(a,b,c,n,l,u,v,m,h,d,e){b=b("dijit.form._AutoCompleterMixin",e,{item:null,autoComplete:!0,highlightMatch:"first",labelAttr:"",labelType:"text",maxHeight:-1,_stopClickEvents:!1,_getCaretPos:function(g){var p=0;if("number"==typeof g.selectionStart)p=g.selectionStart;else if(m("ie")){var t=
g.ownerDocument.selection.createRange().duplicate();g=g.createTextRange();t.move("character",0);g.move("character",0);try{g.setEndPoint("EndToEnd",t),p=String(g.text).replace(/\r/g,"").length}catch(q){}}return p},_setCaretPos:function(g,p){p=parseInt(p);d.selectInputText(g,p,p)},_setDisabledAttr:function(g){this.inherited(arguments);this.domNode.setAttribute("aria-disabled",g?"true":"false")},_onKey:function(g){if(!(32<=g.charCode)){var p=g.charCode||g.keyCode;if(p!=n.ALT&&p!=n.CTRL&&p!=n.META&&p!=
n.SHIFT){var t=this.dropDown,q=null;this._abortQuery();this.inherited(arguments);if(!(g.altKey||g.ctrlKey||g.metaKey))switch(this._opened&&(q=t.getHighlightedOption()),p){case n.PAGE_DOWN:case n.DOWN_ARROW:case n.PAGE_UP:case n.UP_ARROW:this._opened&&this._announceOption(q);g.stopPropagation();g.preventDefault();break;case n.ENTER:if(q){if(q==t.nextButton){this._nextSearch(1);g.stopPropagation();g.preventDefault();break}else if(q==t.previousButton){this._nextSearch(-1);g.stopPropagation();g.preventDefault();
break}g.stopPropagation();g.preventDefault()}else this._setBlurValue(),this._setCaretPos(this.focusNode,this.focusNode.value.length);case n.TAB:p=this.get("displayedValue");if(t&&(p==t._messages.previousMessage||p==t._messages.nextMessage))break;q&&this._selectOption(q);case n.ESCAPE:this._opened&&(this._lastQuery=null,this.closeDropDown())}}}},_autoCompleteText:function(g){var p=this.focusNode;d.selectInputText(p,p.value.length);var t=this.ignoreCase?"toLowerCase":"substr";0==g[t](0).indexOf(this.focusNode.value[t](0))?
(t=this.autoComplete?this._getCaretPos(p):p.value.length,t+1>p.value.length&&(p.value=g,d.selectInputText(p,t))):(p.value=g,d.selectInputText(p))},_openResultList:function(g,p,t){var q=this.dropDown.getHighlightedOption();this.dropDown.clearResultList();g.length||0!=t.start?(this._nextSearch=this.dropDown.onPage=l.hitch(this,function(k){g.nextPage(-1!==k);this.focus()}),this.dropDown.createOptions(g,t,l.hitch(this,"_getMenuLabelFromItem")),this._showResultList(),"direction"in t?(t.direction?this.dropDown.highlightFirstOption():
t.direction||this.dropDown.highlightLastOption(),q&&this._announceOption(this.dropDown.getHighlightedOption())):!this.autoComplete||this._prev_key_backspace||/^[*]+$/.test(p[this.searchAttr].toString())||this._announceOption(this.dropDown.containerNode.firstChild.nextSibling)):this.closeDropDown()},_showResultList:function(){this.closeDropDown(!0);this.openDropDown();this.domNode.setAttribute("aria-expanded","true")},loadDropDown:function(){this._startSearchAll()},isLoaded:function(){return!1},closeDropDown:function(){this._abortQuery();
this._opened&&(this.inherited(arguments),this.domNode.setAttribute("aria-expanded","false"))},_setBlurValue:function(){var g=this.get("displayedValue"),p=this.dropDown;!p||g!=p._messages.previousMessage&&g!=p._messages.nextMessage?"undefined"==typeof this.item?(this.item=null,this.set("displayedValue",g)):(this.value!=this._lastValueReported&&this._handleOnChange(this.value,!0),this._refreshState()):this._setValueAttr(this._lastValueReported,!0);this.focusNode.removeAttribute("aria-activedescendant")},
_setItemAttr:function(g,p,t){var q="";g&&(t||(t=this.store._oldAPI?this.store.getValue(g,this.searchAttr):g[this.searchAttr]),q=this._getValueField()!=this.searchAttr?this.store.getIdentity(g):t);this.set("value",q,p,t,g)},_announceOption:function(g){if(g){if(g==this.dropDown.nextButton||g==this.dropDown.previousButton){var p=g.innerHTML;this.item=void 0;this.value=""}else{var t=this.dropDown.items[g.getAttribute("item")];p=(this.store._oldAPI?this.store.getValue(t,this.searchAttr):t[this.searchAttr]).toString();
this.set("item",t,!1,p)}this.focusNode.value=this.focusNode.value.substring(0,this._lastInput.length);this.focusNode.setAttribute("aria-activedescendant",c.get(g,"id"));this._autoCompleteText(p)}},_selectOption:function(g){this.closeDropDown();g&&this._announceOption(g);this._setCaretPos(this.focusNode,this.focusNode.value.length);this._handleOnChange(this.value,!0);this.focusNode.removeAttribute("aria-activedescendant")},_startSearchAll:function(){this._startSearch("")},_startSearchFromInput:function(){this.item=
void 0;this.inherited(arguments)},_startSearch:function(g){if(!this.dropDown){var p=this.id+"_popup";this.dropDown=new (l.isString(this.dropDownClass)?l.getObject(this.dropDownClass,!1):this.dropDownClass)({onChange:l.hitch(this,this._selectOption),id:p,dir:this.dir,textDir:this.textDir})}this._lastInput=g;this.inherited(arguments)},_getValueField:function(){return this.searchAttr},postMixInProperties:function(){this.inherited(arguments);if(!this.store&&this.srcNodeRef&&(this.store=new h({},this.srcNodeRef),
!("value"in this.params))){var g=this.item=this.store.fetchSelectedItem();if(g){var p=this._getValueField();this.value=this.store._oldAPI?this.store.getValue(g,p):g[p]}}},postCreate:function(){var g=u('label[for\x3d"'+this.id+'"]');g.length&&(g[0].id||(g[0].id=this.id+"_label"),this.domNode.setAttribute("aria-labelledby",g[0].id));this.inherited(arguments);a.after(this,"onSearch",l.hitch(this,"_openResultList"),!0)},_getMenuLabelFromItem:function(g){g=this.labelFunc(g,this.store);var p=this.labelType;
"none"!=this.highlightMatch&&"text"==this.labelType&&this._lastInput&&(g=this.doHighlight(g,this._lastInput),p="html");return{html:"html"==p,label:g}},doHighlight:function(g,p){var t=(this.ignoreCase?"i":"")+("all"==this.highlightMatch?"g":""),q=this.queryExpr.indexOf("${0}");p=v.escapeString(p);return this._escapeHtml(g.replace(new RegExp((0==q?"^":"")+"("+p+")"+(q==this.queryExpr.length-4?"$":""),t),"\uffff$1\uffff")).replace(/\uFFFF([^\uFFFF]+)\uFFFF/g,'\x3cspan class\x3d"dijitComboBoxHighlightMatch"\x3e$1\x3c/span\x3e')},
_escapeHtml:function(g){return g=String(g).replace(/&/gm,"\x26amp;").replace(/</gm,"\x26lt;").replace(/>/gm,"\x26gt;").replace(/"/gm,"\x26quot;")},reset:function(){this.item=null;this.inherited(arguments)},labelFunc:function(g,p){return(p._oldAPI?p.getValue(g,this.labelAttr||this.searchAttr):g[this.labelAttr||this.searchAttr]).toString()},_setValueAttr:function(g,p,t,q){this._set("item",q||null);null==g&&(g="");this.inherited(arguments)}});m("dojo-bidi")&&b.extend({_setTextDirAttr:function(g){this.inherited(arguments);
this.dropDown&&this.dropDown._set("textDir",g)}});return b})},"dijit/form/DataList":function(){define("dojo/_base/declare dojo/dom dojo/_base/lang dojo/query dojo/store/Memory ../registry".split(" "),function(a,b,c,n,l,u){function v(m){return{id:m.value,value:m.value,name:c.trim(m.innerText||m.textContent||"")}}return a("dijit.form.DataList",l,{constructor:function(m,h){this.domNode=b.byId(h);c.mixin(this,m);this.id&&u.add(this);this.domNode.style.display="none";this.inherited(arguments,[{data:n("option",
this.domNode).map(v)}])},destroy:function(){u.remove(this.id)},fetchSelectedItem:function(){var m=n("\x3e option[selected]",this.domNode)[0]||n("\x3e option",this.domNode)[0];return m&&v(m)}})})},"dijit/form/_SearchMixin":function(){define("dojo/_base/declare dojo/keys dojo/_base/lang dojo/query dojo/string dojo/when ../registry".split(" "),function(a,b,c,n,l,u,v){return a("dijit.form._SearchMixin",null,{pageSize:Infinity,store:null,fetchProperties:{},query:{},list:"",_setListAttr:function(m){this._set("list",
m)},searchDelay:200,searchAttr:"name",queryExpr:"${0}*",ignoreCase:!0,_patternToRegExp:function(m){return new RegExp("^"+m.replace(/(\\.)|(\*)|(\?)|\W/g,function(h,d,e,g){return e?".*":g?".":d?d:"\\"+h})+"$",this.ignoreCase?"mi":"m")},_abortQuery:function(){this.searchTimer&&(this.searchTimer=this.searchTimer.remove());this._queryDeferHandle&&(this._queryDeferHandle=this._queryDeferHandle.remove());this._fetchHandle&&(this._fetchHandle.abort&&(this._cancelingQuery=!0,this._fetchHandle.abort(),this._cancelingQuery=
!1),this._fetchHandle.cancel&&(this._cancelingQuery=!0,this._fetchHandle.cancel(),this._cancelingQuery=!1),this._fetchHandle=null)},_processInput:function(m){if(!this.disabled&&!this.readOnly){m=m.charOrCode;this._prev_key_backspace=!1;if(m===b.DELETE||m===b.BACKSPACE)this._maskValidSubsetError=this._prev_key_backspace=!0;if(this.store)this.searchTimer=this.defer("_startSearchFromInput",1);else this.onSearch()}},onSearch:function(){},_startSearchFromInput:function(){this._startSearch(this.focusNode.value)},
_startSearch:function(m){this._abortQuery();var h=this,d=c.clone(this.query),e={start:0,count:this.pageSize,queryOptions:{ignoreCase:this.ignoreCase,deep:!0}},g=l.substitute(this.queryExpr,[m.replace(/([\\\*\?])/g,"\\$1")]),p=function(){var q=h._fetchHandle=h.store.query(d,e);h.disabled||h.readOnly||t!==h._lastQuery||u(q,function(k){h._fetchHandle=null;h.disabled||h.readOnly||t!==h._lastQuery||u(q.total,function(r){k.total=r;var y=h.pageSize;if(isNaN(y)||y>k.total)y=k.total;k.nextPage=function(f){e.direction=
f=!1!==f;e.count=y;f?(e.start+=k.length,e.start>=k.total&&(e.count=0)):(e.start-=y,0>e.start&&(e.count=Math.max(y+e.start,0),e.start=0));0>=e.count?(k.length=0,h.onSearch(k,d,e)):p()};h.onSearch(k,d,e)})},function(k){h._fetchHandle=null;h._cancelingQuery||console.error(h.declaredClass+" "+k.toString())})};c.mixin(e,this.fetchProperties);if(this.store._oldAPI)var t=g;else t=this._patternToRegExp(g),t.toString=function(){return g};this._lastQuery=d[this.searchAttr]=t;this._queryDeferHandle=this.defer(p,
this.searchDelay)},constructor:function(){this.query={};this.fetchProperties={}},postMixInProperties:function(){if(!this.store){var m=this.list;m&&(this.store=v.byId(m))}this.inherited(arguments)}})})},"dijit/form/_ComboBoxMenu":function(){define("dojo/_base/declare dojo/dom-class dojo/dom-style dojo/keys ../_WidgetBase ../_TemplatedMixin ./_ComboBoxMenuMixin ./_ListMouseMixin".split(" "),function(a,b,c,n,l,u,v,m){return a("dijit.form._ComboBoxMenu",[l,u,m,v],{templateString:"\x3cdiv class\x3d'dijitReset dijitMenu' data-dojo-attach-point\x3d'containerNode' style\x3d'overflow: auto; overflow-x: hidden;' role\x3d'listbox'\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuPreviousButton' data-dojo-attach-point\x3d'previousButton' role\x3d'option'\x3e\x3c/div\x3e\x3cdiv class\x3d'dijitMenuItem dijitMenuNextButton' data-dojo-attach-point\x3d'nextButton' role\x3d'option'\x3e\x3c/div\x3e\x3c/div\x3e",
baseClass:"dijitComboBoxMenu",postCreate:function(){this.inherited(arguments);this.isLeftToRight()||(b.add(this.previousButton,"dijitMenuItemRtl"),b.add(this.nextButton,"dijitMenuItemRtl"));this.containerNode.setAttribute("role","listbox")},_createMenuItem:function(){var h=this.ownerDocument.createElement("div");h.className="dijitReset dijitMenuItem"+(this.isLeftToRight()?"":" dijitMenuItemRtl");h.setAttribute("role","option");return h},onHover:function(h){b.add(h,"dijitMenuItemHover")},onUnhover:function(h){b.remove(h,
"dijitMenuItemHover")},onSelect:function(h){b.add(h,"dijitMenuItemSelected")},onDeselect:function(h){b.remove(h,"dijitMenuItemSelected")},_page:function(h){var d=0,e=this.domNode.scrollTop,g=c.get(this.domNode,"height");for(this.getHighlightedOption()||this.selectNextNode();d<g;){var p=this.getHighlightedOption();if(h){if(!p.previousSibling||"none"==p.previousSibling.style.display)break;this.selectPreviousNode()}else{if(!p.nextSibling||"none"==p.nextSibling.style.display)break;this.selectNextNode()}p=
this.domNode.scrollTop;d+=(p-e)*(h?-1:1);e=p}},handleKey:function(h){switch(h.keyCode){case n.DOWN_ARROW:return this.selectNextNode(),!1;case n.PAGE_DOWN:return this._page(!1),!1;case n.UP_ARROW:return this.selectPreviousNode(),!1;case n.PAGE_UP:return this._page(!0),!1;default:return!0}}})})},"dijit/form/_ComboBoxMenuMixin":function(){define("dojo/_base/array dojo/_base/declare dojo/dom-attr dojo/has dojo/i18n dojo/i18n!./nls/ComboBox".split(" "),function(a,b,c,n,l){var u=b("dijit.form._ComboBoxMenuMixin"+
(n("dojo-bidi")?"_NoBidi":""),null,{_messages:null,postMixInProperties:function(){this.inherited(arguments);this._messages=l.getLocalization("dijit.form","ComboBox",this.lang)},buildRendering:function(){this.inherited(arguments);this.previousButton.innerHTML=this._messages.previousMessage;this.nextButton.innerHTML=this._messages.nextMessage},_setValueAttr:function(v){this._set("value",v);this.onChange(v)},onClick:function(v){if(v==this.previousButton)this._setSelectedAttr(null),this.onPage(-1);else if(v==
this.nextButton)this._setSelectedAttr(null),this.onPage(1);else this.onChange(v)},onChange:function(){},onPage:function(){},onClose:function(){this._setSelectedAttr(null)},_createOption:function(v,m){var h=this._createMenuItem();v=m(v);v.html?h.innerHTML=v.label:h.appendChild(h.ownerDocument.createTextNode(v.label));""==h.innerHTML&&(h.innerHTML="\x26#160;");return h},createOptions:function(v,m,h){this.items=v;this.previousButton.style.display=0==m.start?"none":"";c.set(this.previousButton,"id",this.id+
"_prev");a.forEach(v,function(e,g){e=this._createOption(e,h);e.setAttribute("item",g);c.set(e,"id",this.id+g);this.nextButton.parentNode.insertBefore(e,this.nextButton)},this);var d=!1;v.total&&!v.total.then&&-1!=v.total?m.start+m.count<v.total?d=!0:m.start+m.count>v.total&&m.count==v.length&&(d=!0):m.count==v.length&&(d=!0);this.nextButton.style.display=d?"":"none";c.set(this.nextButton,"id",this.id+"_next")},clearResultList:function(){for(var v=this.containerNode;2<v.childNodes.length;)v.removeChild(v.childNodes[v.childNodes.length-
2]);this._setSelectedAttr(null)},highlightFirstOption:function(){this.selectFirstNode()},highlightLastOption:function(){this.selectLastNode()},selectFirstNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.previousButton&&this.selectNextNode()},selectLastNode:function(){this.inherited(arguments);this.getHighlightedOption()==this.nextButton&&this.selectPreviousNode()},getHighlightedOption:function(){return this.selected}});n("dojo-bidi")&&(u=b("dijit.form._ComboBoxMenuMixin",
u,{_createOption:function(){var v=this.inherited(arguments);this.applyTextDir(v);return v}}));return u})},"dijit/form/_ListMouseMixin":function(){define(["dojo/_base/declare","dojo/on","dojo/touch","./_ListBase"],function(a,b,c,n){return a("dijit.form._ListMouseMixin",n,{postCreate:function(){this.inherited(arguments);this.domNode.dojoClick=!0;this._listConnect("click","_onClick");this._listConnect("mousedown","_onMouseDown");this._listConnect("mouseup","_onMouseUp");this._listConnect("mouseover",
"_onMouseOver");this._listConnect("mouseout","_onMouseOut")},_onClick:function(l,u){this._setSelectedAttr(u,!1);this._deferredClick&&this._deferredClick.remove();this._deferredClick=this.defer(function(){this._deferredClick=null;this.onClick(u)})},_onMouseDown:function(l,u){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging=!0;this._setSelectedAttr(u,!1)},_onMouseUp:function(l,u){this._isDragging=!1;var v=this.selected,m=this._hoveredNode;v&&u==v?this.defer(function(){this._onClick(l,
v)}):m&&this.defer(function(){this._onClick(l,m)})},_onMouseOut:function(l,u){this._hoveredNode&&(this.onUnhover(this._hoveredNode),this._hoveredNode=null);this._isDragging&&(this._cancelDrag=(new Date).getTime()+1E3)},_onMouseOver:function(l,u){this._cancelDrag&&((new Date).getTime()>this._cancelDrag&&(this._isDragging=!1),this._cancelDrag=null);this._hoveredNode=u;this.onHover(u);this._isDragging&&this._setSelectedAttr(u,!1)}})})},"dijit/form/_ListBase":function(){define(["dojo/_base/declare","dojo/on",
"dojo/window"],function(a,b,c){return a("dijit.form._ListBase",null,{selected:null,_listConnect:function(n,l){var u=this;return u.own(b(u.containerNode,b.selector(function(v,m,h){return v.parentNode==h},n),function(v){u[l](v,this)}))},selectFirstNode:function(){for(var n=this.containerNode.firstChild;n&&"none"==n.style.display;)n=n.nextSibling;this._setSelectedAttr(n,!0)},selectLastNode:function(){for(var n=this.containerNode.lastChild;n&&"none"==n.style.display;)n=n.previousSibling;this._setSelectedAttr(n,
!0)},selectNextNode:function(){var n=this.selected;if(n){for(n=n.nextSibling;n&&"none"==n.style.display;)n=n.nextSibling;n?this._setSelectedAttr(n,!0):this.selectFirstNode()}else this.selectFirstNode()},selectPreviousNode:function(){var n=this.selected;if(n){for(n=n.previousSibling;n&&"none"==n.style.display;)n=n.previousSibling;n?this._setSelectedAttr(n,!0):this.selectLastNode()}else this.selectLastNode()},_setSelectedAttr:function(n,l){if(this.selected!=n){var u=this.selected;if(u)this.onDeselect(u);
n&&(l&&c.scrollIntoView(n),this.onSelect(n));this._set("selected",n)}else if(n)this.onSelect(n)}})})},"url:jimu/dijit/templates/LoadingShelter.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"loading-container"\x3e\r\n      \x3cdiv data-dojo-attach-point\x3d"imgDiv" class\x3d"img-div"\x3e\r\n      \x3c/div\x3e\r\n      \x3cp data-dojo-attach-point\x3d"textNode"\x3e\x3c/p\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e',"url:dijit/templates/Menu.html":'\x3ctable class\x3d"dijit dijitMenu dijitMenuPassive dijitReset dijitMenuTable" role\x3d"menu" tabIndex\x3d"${tabIndex}"\r\n\t   cellspacing\x3d"0"\x3e\r\n\t\x3ctbody class\x3d"dijitReset" data-dojo-attach-point\x3d"containerNode"\x3e\x3c/tbody\x3e\r\n\x3c/table\x3e\r\n',
"url:dijit/templates/MenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"menuitem" tabIndex\x3d"-1"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan role\x3d"presentation" class\x3d"dijitInline dijitIcon dijitMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,textDirNode"\r\n\t\trole\x3d"presentation"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan data-dojo-attach-point\x3d"arrowWrapper" style\x3d"visibility: hidden"\x3e\r\n\t\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuExpand"\x3e\x3c/span\x3e\r\n\t\t\t\x3cspan class\x3d"dijitMenuExpandA11y"\x3e+\x3c/span\x3e\r\n\t\t\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/CheckedMenuItem.html":'\x3ctr class\x3d"dijitReset" data-dojo-attach-point\x3d"focusNode" role\x3d"${role}" tabIndex\x3d"-1" aria-checked\x3d"${checked}"\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemIconCell" role\x3d"presentation"\x3e\r\n\t\t\x3cspan class\x3d"dijitInline dijitIcon dijitMenuItemIcon dijitCheckedMenuItemIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\x3e\r\n\t\t\x3cspan class\x3d"dijitMenuItemIconChar dijitCheckedMenuItemIconChar"\x3e${!checkedChar}\x3c/span\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemLabel" colspan\x3d"2" data-dojo-attach-point\x3d"containerNode,labelNode,textDirNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuItemAccelKey" style\x3d"display: none" data-dojo-attach-point\x3d"accelKeyNode"\x3e\x3c/td\x3e\r\n\t\x3ctd class\x3d"dijitReset dijitMenuArrowCell" role\x3d"presentation"\x3e\x26#160;\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/MenuSeparator.html":'\x3ctr class\x3d"dijitMenuSeparator" role\x3d"separator"\x3e\r\n\t\x3ctd class\x3d"dijitMenuSeparatorIconCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\t\x3ctd colspan\x3d"3" class\x3d"dijitMenuSeparatorLabelCell"\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorTop dijitMenuSeparatorLabel"\x3e\x3c/div\x3e\r\n\t\t\x3cdiv class\x3d"dijitMenuSeparatorBottom"\x3e\x3c/div\x3e\r\n\t\x3c/td\x3e\r\n\x3c/tr\x3e\r\n',
"url:dijit/templates/Tooltip.html":'\x3cdiv class\x3d"dijitTooltip dijitTooltipLeft" id\x3d"dojoTooltip" data-dojo-attach-event\x3d"mouseenter:onMouseEnter,mouseleave:onMouseLeave"\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipConnector" data-dojo-attach-point\x3d"connectorNode"\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitTooltipContainer dijitTooltipContents" data-dojo-attach-point\x3d"containerNode" role\x3d\'alert\'\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/Select.html":'\x3ctable class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tdata-dojo-attach-point\x3d"_buttonNode,tableNode,focusNode,_popupStateNode" cellspacing\x3d\'0\' cellpadding\x3d\'0\'\r\n\trole\x3d"listbox" aria-haspopup\x3d"true"\r\n\t\x3e\x3ctbody role\x3d"presentation"\x3e\x3ctr role\x3d"presentation"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitStretch dijitButtonContents" role\x3d"presentation"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitButtonText"  data-dojo-attach-point\x3d"containerNode,textDirNode" role\x3d"presentation"\x3e\x3c/div\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitReset dijitValidationContainer"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\t\x3e\x3cinput type\x3d"hidden" ${!nameAttrSetting} data-dojo-attach-point\x3d"valueNode" value\x3d"${value}" aria-hidden\x3d"true"\r\n\t\t/\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode" role\x3d"presentation"\r\n\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t${_buttonInputDisabled}\r\n\t\t/\x3e\x3c/td\r\n\t\x3e\x3c/tr\x3e\x3c/tbody\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/TextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft" id\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/ValidationTextBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputInner" data-dojo-attach-point\x3d\'textbox,focusNode\' autocomplete\x3d"off"\r\n\t\t\t${!nameAttrSetting} type\x3d\'${type}\'\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/form/templates/Spinner.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}" role\x3d"presentation"\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitButtonNode dijitSpinnerButtonContainer"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitSpinnerButtonInner" type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitUpArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"upArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9650; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\t\x3e\x3cdiv class\x3d"dijitReset dijitLeft dijitButtonNode dijitArrowButton dijitDownArrowButton"\r\n\t\t\tdata-dojo-attach-point\x3d"downArrowNode"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitArrowButtonInner"\r\n\t\t\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t\t\t\t\t${_buttonInputDisabled}\r\n\t\t\t/\x3e\x3c/div\r\n\t\t\x3e\x3c/div\r\n\t\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' data-dojo-attach-point\x3d"textbox,focusNode" type\x3d"${type}" data-dojo-attach-event\x3d"onkeydown:_onKeyDown"\r\n\t\t\trole\x3d"spinbutton" autocomplete\x3d"off" ${!nameAttrSetting}\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"url:dijit/templates/ColorPalette.html":'\x3cdiv class\x3d"dijitInline dijitColorPalette" role\x3d"grid"\x3e\r\n\t\x3ctable data-dojo-attach-point\x3d"paletteTableNode" class\x3d"dijitPaletteTable" cellSpacing\x3d"0" cellPadding\x3d"0" role\x3d"presentation"\x3e\r\n\t\t\x3ctbody data-dojo-attach-point\x3d"gridNode"\x3e\x3c/tbody\x3e\r\n\t\x3c/table\x3e\r\n\x3c/div\x3e\r\n',"url:dijit/form/templates/Button.html":'\x3cspan class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonNode"\r\n\t\tdata-dojo-attach-event\x3d"ondijitclick:__onClick" role\x3d"presentation"\r\n\t\t\x3e\x3cspan class\x3d"dijitReset dijitStretch dijitButtonContents"\r\n\t\t\tdata-dojo-attach-point\x3d"titleNode,focusNode"\r\n\t\t\trole\x3d"button" aria-labelledby\x3d"${id}_label"\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitIcon" data-dojo-attach-point\x3d"iconNode"\x3e\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitToggleButtonIconChar"\x3e\x26#x25CF;\x3c/span\r\n\t\t\t\x3e\x3cspan class\x3d"dijitReset dijitInline dijitButtonText"\r\n\t\t\t\tid\x3d"${id}_label"\r\n\t\t\t\tdata-dojo-attach-point\x3d"containerNode"\r\n\t\t\t\x3e\x3c/span\r\n\t\t\x3e\x3c/span\r\n\t\x3e\x3c/span\r\n\t\x3e\x3cinput ${!nameAttrSetting} type\x3d"${type}" value\x3d"${value}" class\x3d"dijitOffScreen"\r\n\t\tdata-dojo-attach-event\x3d"onclick:_onClick"\r\n\t\ttabIndex\x3d"-1" aria-hidden\x3d"true" data-dojo-attach-point\x3d"valueNode"\r\n/\x3e\x3c/span\x3e\r\n',
"url:dijit/form/templates/HorizontalSlider.html":'\x3ctable class\x3d"dijit dijitReset dijitSlider dijitSliderH" cellspacing\x3d"0" cellpadding\x3d"0" border\x3d"0" rules\x3d"none" data-dojo-attach-event\x3d"onkeydown:_onKeyDown, onkeyup:_onKeyUp"\r\n\trole\x3d"presentation"\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"topDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationT dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderDecrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"decrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e-\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderLeftBumper" data-dojo-attach-event\x3d"press:_onClkDecBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cinput data-dojo-attach-point\x3d"valueNode" type\x3d"hidden" ${!nameAttrSetting}\r\n\t\t\t/\x3e\x3cdiv class\x3d"dijitReset dijitSliderBarContainerH" role\x3d"presentation" data-dojo-attach-point\x3d"sliderBarContainer"\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"progressBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderProgressBar dijitSliderProgressBarH" data-dojo-attach-event\x3d"press:_onBarClick"\r\n\t\t\t\t\t\x3e\x3cdiv class\x3d"dijitSliderMoveable dijitSliderMoveableH"\r\n\t\t\t\t\t\t\x3e\x3cdiv data-dojo-attach-point\x3d"sliderHandle,focusNode" class\x3d"dijitSliderImageHandle dijitSliderImageHandleH" data-dojo-attach-event\x3d"press:_onHandleClick" role\x3d"slider"\x3e\x3c/div\r\n\t\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3c/div\r\n\t\t\t\t\x3e\x3cdiv role\x3d"presentation" data-dojo-attach-point\x3d"remainingBar" class\x3d"dijitSliderBar dijitSliderBarH dijitSliderRemainingBar dijitSliderRemainingBarH" data-dojo-attach-event\x3d"press:_onBarClick"\x3e\x3c/div\r\n\t\t\t\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderBar dijitSliderBumper dijitSliderBumperH dijitSliderRightBumper" data-dojo-attach-event\x3d"press:_onClkIncBumper"\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset dijitSliderButtonContainer dijitSliderButtonContainerH"\r\n\t\t\t\x3e\x3cdiv class\x3d"dijitSliderIncrementIconH" style\x3d"display:none" data-dojo-attach-point\x3d"incrementButton"\x3e\x3cspan class\x3d"dijitSliderButtonInner"\x3e+\x3c/span\x3e\x3c/div\r\n\t\t\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\t\x3e\x3ctr class\x3d"dijitReset"\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\t\x3e\x3ctd data-dojo-attach-point\x3d"containerNode,bottomDecoration" class\x3d"dijitReset dijitSliderDecoration dijitSliderDecorationB dijitSliderDecorationH"\x3e\x3c/td\r\n\t\t\x3e\x3ctd class\x3d"dijitReset" colspan\x3d"2"\x3e\x3c/td\r\n\t\x3e\x3c/tr\r\n\x3e\x3c/table\x3e\r\n',
"url:dijit/form/templates/CheckBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline" role\x3d"presentation"\r\n\t\x3e\x3cinput\r\n\t \t${!nameAttrSetting} type\x3d"${type}" role\x3d"${type}" aria-checked\x3d"false" ${checkedAttrSetting}\r\n\t\tclass\x3d"dijitReset dijitCheckBoxInput"\r\n\t\tdata-dojo-attach-point\x3d"focusNode"\r\n\t \tdata-dojo-attach-event\x3d"ondijitclick:_onClick"\r\n/\x3e\x3c/div\x3e\r\n',"url:dijit/form/templates/DropDownBox.html":'\x3cdiv class\x3d"dijit dijitReset dijitInline dijitLeft"\r\n\tid\x3d"widget_${id}"\r\n\trole\x3d"combobox"\r\n\taria-haspopup\x3d"true"\r\n\tdata-dojo-attach-point\x3d"_popupStateNode"\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitRight dijitButtonNode dijitArrowButton dijitDownArrowButton dijitArrowButtonContainer\'\r\n\t\tdata-dojo-attach-point\x3d"_buttonNode" role\x3d"presentation"\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitArrowButtonInner" value\x3d"\x26#9660; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"button presentation" aria-hidden\x3d"true"\r\n\t\t\t${_buttonInputDisabled}\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d\'dijitReset dijitValidationContainer\'\r\n\t\t\x3e\x3cinput class\x3d"dijitReset dijitInputField dijitValidationIcon dijitValidationInner" value\x3d"\x26#935; " type\x3d"text" tabIndex\x3d"-1" readonly\x3d"readonly" role\x3d"presentation"\r\n\t/\x3e\x3c/div\r\n\t\x3e\x3cdiv class\x3d"dijitReset dijitInputField dijitInputContainer"\r\n\t\t\x3e\x3cinput class\x3d\'dijitReset dijitInputInner\' ${!nameAttrSetting} type\x3d"${type}" autocomplete\x3d"off"\r\n\t\t\tdata-dojo-attach-point\x3d"textbox,focusNode" role\x3d"textbox"\r\n\t/\x3e\x3c/div\r\n\x3e\x3c/div\x3e\r\n',
"*now":function(a){a(['dojo/i18n!*preload*jimu/nls/main*["ar","bg","bs","ca","cs","da","de","en","el","es","et","fi","fr","he","hr","hu","id","it","ja","ko","lt","lv","nb","nl","pl","pt-br","pt-pt","ro","ru","sk","sl","sr","sv","th","tr","zh-cn","uk","vi","zh-hk","zh-tw","ROOT"]'])}}});
define("./ConfigManager ./LayoutManager ./DataManager dojo/_base/html dojo/_base/lang dojo/_base/array dojo/on dojo/mouse dojo/topic dojo/cookie dojo/Deferred dojo/promise/all dojo/io-query dojo/domReady! esri/config esri/request esri/core/urlUtils esri/identity/IdentityManager jimu/portalUrlUtils ./utils require dojo/i18n dojo/i18n!./nls/main dojo/ready".split(" "),function(a,b,c,n,l,u,v,m,h,d,e,g,p,t,q,k,r,y,f,w,z,A,x,B){function C(){var F=window.location.search;if(""===F)return{};F=p.queryToObject(F.substr(1));
for(var G in F)F[G]=w.sanitizeHTML(F[G]);return F}u={};h=w.getEsriConfigRequestObject();h.timeout=18E4;"function"!==typeof d.getAll&&(d.getAll=function(F){var G=[];(F=d(F))&&G.push(F);return G});window.jimuNls=x;y.setProtocolErrorHandler(function(){return!0});y=w.getAncestorWindow();var D=!1;try{D=0===y.location.href.indexOf("https://")}catch(F){}var E=/\/SceneServer\/layers\/\d+\/?$/;h.interceptors=[{before:function(F){F&&"object"===typeof F.requestOptions&&!F.requestOptions.content&&E.test(F.url)&&
(F.content={f:"json"});F.requestOptions.query&&F.requestOptions.query.printFlag&&(F.timeout=3E5);D&&(F.url=F.url.replace(/^http(s?):\/\//gi,"https://"));-1===F.url.indexOf("/queryRelatedRecords?")||w.isHostedService(F.url)||(F.url=F.url.replace("FeatureServer","MapServer"))}}];v(window,"mousedown",function(F){if(m.isMiddle(F))return F.preventDefault(),F.stopPropagation(),F.returnValue=!1});String.prototype.startWith=function(F){return this.substr(0,F.length)===F?!0:!1};String.prototype.endWith=function(F){return this.substr(this.length-
F.length,F.length)===F?!0:!1};"undefined"===typeof jimuConfig&&(jimuConfig={});jimuConfig=l.mixin({loadingId:"main-loading",loadingImageId:"app-loading",loadingGifId:"loading-gif",layoutId:"jimu-layout-manager",mapId:"map",mainPageId:"main-page",timeout:5E3,breakPoints:[600,1280]},jimuConfig);window.wabVersion="2.25";window.productVersion="Online 10.2";u.initApp=function(){console.log("jimu.js init...");var F=C();c.getInstance();n.setStyle(jimuConfig.loadingId,"display","none");n.setStyle(jimuConfig.mainPageId,
"display","block");var G=b.getInstance({mapId:jimuConfig.mapId,urlParams:F},jimuConfig.layoutId);F=a.getInstance(F);G.startup();F.loadConfig();B(function(){setTimeout(function(){n.removeClass(document.body,"dj_a11y")},50)})};return u});